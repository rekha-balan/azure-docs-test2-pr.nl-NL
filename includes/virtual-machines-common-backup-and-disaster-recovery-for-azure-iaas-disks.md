---
title: include file
description: include file
services: storage
author: luywang
ms.service: storage
ms.topic: include
ms.date: 06/05/2018
ms.author: luywang
ms.custom: include file
ms.openlocfilehash: 7f093a1878bc3cf7e91cc14ec7a68b1a84764a49
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44856168"
---
# <a name="backup-and-disaster-recovery-for-azure-iaas-disks"></a><span data-ttu-id="c3b79-103">Backup and disaster recovery for Azure IaaS disks</span><span class="sxs-lookup"><span data-stu-id="c3b79-103">Backup and disaster recovery for Azure IaaS disks</span></span>

<span data-ttu-id="c3b79-104">This article explains how to plan for backup and disaster recovery (DR) of IaaS virtual machines (VMs) and disks in Azure.</span><span class="sxs-lookup"><span data-stu-id="c3b79-104">This article explains how to plan for backup and disaster recovery (DR) of IaaS virtual machines (VMs) and disks in Azure.</span></span> <span data-ttu-id="c3b79-105">This document covers both managed and unmanaged disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-105">This document covers both managed and unmanaged disks.</span></span>

<span data-ttu-id="c3b79-106">First, we cover the built-in fault tolerance capabilities in the Azure platform that helps guard against local failures.</span><span class="sxs-lookup"><span data-stu-id="c3b79-106">First, we cover the built-in fault tolerance capabilities in the Azure platform that helps guard against local failures.</span></span> <span data-ttu-id="c3b79-107">We then discuss the disaster scenarios not fully covered by the built-in capabilities.</span><span class="sxs-lookup"><span data-stu-id="c3b79-107">We then discuss the disaster scenarios not fully covered by the built-in capabilities.</span></span> <span data-ttu-id="c3b79-108">We also show several examples of workload scenarios where different backup and DR considerations can apply.</span><span class="sxs-lookup"><span data-stu-id="c3b79-108">We also show several examples of workload scenarios where different backup and DR considerations can apply.</span></span> <span data-ttu-id="c3b79-109">We then review possible solutions for the DR of IaaS disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-109">We then review possible solutions for the DR of IaaS disks.</span></span> 

## <a name="introduction"></a><span data-ttu-id="c3b79-110">Introduction</span><span class="sxs-lookup"><span data-stu-id="c3b79-110">Introduction</span></span>

<span data-ttu-id="c3b79-111">The Azure platform uses various methods for redundancy and fault tolerance to help protect customers from localized hardware failures.</span><span class="sxs-lookup"><span data-stu-id="c3b79-111">The Azure platform uses various methods for redundancy and fault tolerance to help protect customers from localized hardware failures.</span></span> <span data-ttu-id="c3b79-112">Local failures can include problems with an Azure Storage server machine that stores part of the data for a virtual disk or failures of an SSD or HDD on that server.</span><span class="sxs-lookup"><span data-stu-id="c3b79-112">Local failures can include problems with an Azure Storage server machine that stores part of the data for a virtual disk or failures of an SSD or HDD on that server.</span></span> <span data-ttu-id="c3b79-113">Such isolated hardware component failures can happen during normal operations.</span><span class="sxs-lookup"><span data-stu-id="c3b79-113">Such isolated hardware component failures can happen during normal operations.</span></span> 

<span data-ttu-id="c3b79-114">The Azure platform is designed to be resilient to these failures.</span><span class="sxs-lookup"><span data-stu-id="c3b79-114">The Azure platform is designed to be resilient to these failures.</span></span> <span data-ttu-id="c3b79-115">Major disasters can result in failures or the inaccessibility of many storage servers or even a whole datacenter.</span><span class="sxs-lookup"><span data-stu-id="c3b79-115">Major disasters can result in failures or the inaccessibility of many storage servers or even a whole datacenter.</span></span> <span data-ttu-id="c3b79-116">Although your VMs and disks are normally protected from localized failures, additional steps are necessary to protect your workload from region-wide catastrophic failures, such as a major disaster, that can affect your VM and disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-116">Although your VMs and disks are normally protected from localized failures, additional steps are necessary to protect your workload from region-wide catastrophic failures, such as a major disaster, that can affect your VM and disks.</span></span>

<span data-ttu-id="c3b79-117">In addition to the possibility of platform failures, problems with a customer application or data can occur.</span><span class="sxs-lookup"><span data-stu-id="c3b79-117">In addition to the possibility of platform failures, problems with a customer application or data can occur.</span></span> <span data-ttu-id="c3b79-118">For example, a new version of your application might inadvertently make a change to the data that causes it to break.</span><span class="sxs-lookup"><span data-stu-id="c3b79-118">For example, a new version of your application might inadvertently make a change to the data that causes it to break.</span></span> <span data-ttu-id="c3b79-119">In that case, you might want to revert the application and the data to a prior version that contains the last known good state.</span><span class="sxs-lookup"><span data-stu-id="c3b79-119">In that case, you might want to revert the application and the data to a prior version that contains the last known good state.</span></span> <span data-ttu-id="c3b79-120">This requires maintaining regular backups.</span><span class="sxs-lookup"><span data-stu-id="c3b79-120">This requires maintaining regular backups.</span></span>

<span data-ttu-id="c3b79-121">For regional disaster recovery, you must back up your IaaS VM disks to a different region.</span><span class="sxs-lookup"><span data-stu-id="c3b79-121">For regional disaster recovery, you must back up your IaaS VM disks to a different region.</span></span> 

<span data-ttu-id="c3b79-122">Before we look at backup and DR options, let’s recap a few methods available for handling localized failures.</span><span class="sxs-lookup"><span data-stu-id="c3b79-122">Before we look at backup and DR options, let’s recap a few methods available for handling localized failures.</span></span>

### <a name="azure-iaas-resiliency"></a><span data-ttu-id="c3b79-123">Azure IaaS resiliency</span><span class="sxs-lookup"><span data-stu-id="c3b79-123">Azure IaaS resiliency</span></span>

<span data-ttu-id="c3b79-124">*Resiliency* refers to the tolerance for normal failures that occur in hardware components.</span><span class="sxs-lookup"><span data-stu-id="c3b79-124">*Resiliency* refers to the tolerance for normal failures that occur in hardware components.</span></span> <span data-ttu-id="c3b79-125">Resiliency is the ability to recover from failures and continue to function.</span><span class="sxs-lookup"><span data-stu-id="c3b79-125">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="c3b79-126">It's not about avoiding failures, but responding to failures in a way that avoids downtime or data loss.</span><span class="sxs-lookup"><span data-stu-id="c3b79-126">It's not about avoiding failures, but responding to failures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="c3b79-127">The goal of resiliency is to return the application to a fully functioning state following a failure.</span><span class="sxs-lookup"><span data-stu-id="c3b79-127">The goal of resiliency is to return the application to a fully functioning state following a failure.</span></span> <span data-ttu-id="c3b79-128">Azure virtual machines and disks are designed to be resilient to common hardware faults.</span><span class="sxs-lookup"><span data-stu-id="c3b79-128">Azure virtual machines and disks are designed to be resilient to common hardware faults.</span></span> <span data-ttu-id="c3b79-129">Let's look at how the Azure IaaS platform provides this resiliency.</span><span class="sxs-lookup"><span data-stu-id="c3b79-129">Let's look at how the Azure IaaS platform provides this resiliency.</span></span>

<span data-ttu-id="c3b79-130">A virtual machine consists mainly of two parts: a compute server and the persistent disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-130">A virtual machine consists mainly of two parts: a compute server and the persistent disks.</span></span> <span data-ttu-id="c3b79-131">Both affect the fault tolerance of a virtual machine.</span><span class="sxs-lookup"><span data-stu-id="c3b79-131">Both affect the fault tolerance of a virtual machine.</span></span>

<span data-ttu-id="c3b79-132">If the Azure compute host server that houses your VM experiences a hardware failure, which is rare, Azure is designed to automatically restore the VM on another server.</span><span class="sxs-lookup"><span data-stu-id="c3b79-132">If the Azure compute host server that houses your VM experiences a hardware failure, which is rare, Azure is designed to automatically restore the VM on another server.</span></span> <span data-ttu-id="c3b79-133">If this scenario, your computer reboots, and the VM comes back up after some time.</span><span class="sxs-lookup"><span data-stu-id="c3b79-133">If this scenario, your computer reboots, and the VM comes back up after some time.</span></span> <span data-ttu-id="c3b79-134">Azure automatically detects such hardware failures and executes recoveries to help ensure the customer VM is available as soon as possible.</span><span class="sxs-lookup"><span data-stu-id="c3b79-134">Azure automatically detects such hardware failures and executes recoveries to help ensure the customer VM is available as soon as possible.</span></span>

<span data-ttu-id="c3b79-135">Regarding IaaS disks, the durability of data is critical for a persistent storage platform.</span><span class="sxs-lookup"><span data-stu-id="c3b79-135">Regarding IaaS disks, the durability of data is critical for a persistent storage platform.</span></span> <span data-ttu-id="c3b79-136">Azure customers have important business applications running on IaaS, and they depend on the persistence of the data.</span><span class="sxs-lookup"><span data-stu-id="c3b79-136">Azure customers have important business applications running on IaaS, and they depend on the persistence of the data.</span></span> <span data-ttu-id="c3b79-137">Azure designs protection for these IaaS disks, with three redundant copies of the data that is stored locally.</span><span class="sxs-lookup"><span data-stu-id="c3b79-137">Azure designs protection for these IaaS disks, with three redundant copies of the data that is stored locally.</span></span> <span data-ttu-id="c3b79-138">These copies provide for high durability against local failures.</span><span class="sxs-lookup"><span data-stu-id="c3b79-138">These copies provide for high durability against local failures.</span></span> <span data-ttu-id="c3b79-139">If one of the hardware components that holds your disk fails, your VM is not affected, because there are two additional copies to support disk requests.</span><span class="sxs-lookup"><span data-stu-id="c3b79-139">If one of the hardware components that holds your disk fails, your VM is not affected, because there are two additional copies to support disk requests.</span></span> <span data-ttu-id="c3b79-140">It works fine, even if two different hardware components that support a disk fail at the same time (which is rare).</span><span class="sxs-lookup"><span data-stu-id="c3b79-140">It works fine, even if two different hardware components that support a disk fail at the same time (which is rare).</span></span> 

<span data-ttu-id="c3b79-141">To ensure that you always maintain three replicas, Azure Storage automatically spawns a new copy of the data in the background if one of the three copies becomes unavailable.</span><span class="sxs-lookup"><span data-stu-id="c3b79-141">To ensure that you always maintain three replicas, Azure Storage automatically spawns a new copy of the data in the background if one of the three copies becomes unavailable.</span></span> <span data-ttu-id="c3b79-142">Therefore, it should not be necessary to use RAID with Azure disks for fault tolerance.</span><span class="sxs-lookup"><span data-stu-id="c3b79-142">Therefore, it should not be necessary to use RAID with Azure disks for fault tolerance.</span></span> <span data-ttu-id="c3b79-143">A simple RAID 0 configuration should be sufficient for striping the disks, if necessary, to create larger volumes.</span><span class="sxs-lookup"><span data-stu-id="c3b79-143">A simple RAID 0 configuration should be sufficient for striping the disks, if necessary, to create larger volumes.</span></span>

<span data-ttu-id="c3b79-144">Because of this architecture, Azure has consistently delivered enterprise-grade durability for IaaS disks, with an industry-leading zero percent [annualized failure rate](https://en.wikipedia.org/wiki/Annualized_failure_rate).</span><span class="sxs-lookup"><span data-stu-id="c3b79-144">Because of this architecture, Azure has consistently delivered enterprise-grade durability for IaaS disks, with an industry-leading zero percent [annualized failure rate](https://en.wikipedia.org/wiki/Annualized_failure_rate).</span></span>

<span data-ttu-id="c3b79-145">Localized hardware faults on the compute host or in the Storage platform can sometimes result in of the temporary unavailability of the VM that is covered by the [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) for VM availability.</span><span class="sxs-lookup"><span data-stu-id="c3b79-145">Localized hardware faults on the compute host or in the Storage platform can sometimes result in of the temporary unavailability of the VM that is covered by the [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) for VM availability.</span></span> <span data-ttu-id="c3b79-146">Azure also provides an industry-leading SLA for single VM instances that use Azure Premium SSD disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-146">Azure also provides an industry-leading SLA for single VM instances that use Azure Premium SSD disks.</span></span>

<span data-ttu-id="c3b79-147">To safeguard application workloads from downtime due to the temporary unavailability of a disk or VM, customers can use [availability sets](../articles/virtual-machines/windows/manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="c3b79-147">To safeguard application workloads from downtime due to the temporary unavailability of a disk or VM, customers can use [availability sets](../articles/virtual-machines/windows/manage-availability.md).</span></span> <span data-ttu-id="c3b79-148">Two or more virtual machines in an availability set provide redundancy for the application.</span><span class="sxs-lookup"><span data-stu-id="c3b79-148">Two or more virtual machines in an availability set provide redundancy for the application.</span></span> <span data-ttu-id="c3b79-149">Azure then creates these VMs and disks in separate fault domains with different power, network, and server components.</span><span class="sxs-lookup"><span data-stu-id="c3b79-149">Azure then creates these VMs and disks in separate fault domains with different power, network, and server components.</span></span> 

<span data-ttu-id="c3b79-150">Because of these separate fault domains, localized hardware failures typically do not affect multiple VMs in the set at the same time.</span><span class="sxs-lookup"><span data-stu-id="c3b79-150">Because of these separate fault domains, localized hardware failures typically do not affect multiple VMs in the set at the same time.</span></span> <span data-ttu-id="c3b79-151">Having separate fault domains provides high availability for your application.</span><span class="sxs-lookup"><span data-stu-id="c3b79-151">Having separate fault domains provides high availability for your application.</span></span> <span data-ttu-id="c3b79-152">It's considered a good practice to use availability sets when high availability is required.</span><span class="sxs-lookup"><span data-stu-id="c3b79-152">It's considered a good practice to use availability sets when high availability is required.</span></span> <span data-ttu-id="c3b79-153">The next section covers the disaster recovery aspect.</span><span class="sxs-lookup"><span data-stu-id="c3b79-153">The next section covers the disaster recovery aspect.</span></span>

### <a name="backup-and-disaster-recovery"></a><span data-ttu-id="c3b79-154">Backup and disaster recovery</span><span class="sxs-lookup"><span data-stu-id="c3b79-154">Backup and disaster recovery</span></span>

<span data-ttu-id="c3b79-155">Disaster recovery is the ability to recover from rare, but major, incidents.</span><span class="sxs-lookup"><span data-stu-id="c3b79-155">Disaster recovery is the ability to recover from rare, but major, incidents.</span></span> <span data-ttu-id="c3b79-156">These incidents include non-transient, wide-scale failures, such as service disruption that affects an entire region.</span><span class="sxs-lookup"><span data-stu-id="c3b79-156">These incidents include non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="c3b79-157">Disaster recovery includes data backup and archiving, and might include manual intervention, such as restoring a database from a backup.</span><span class="sxs-lookup"><span data-stu-id="c3b79-157">Disaster recovery includes data backup and archiving, and might include manual intervention, such as restoring a database from a backup.</span></span>

<span data-ttu-id="c3b79-158">The Azure platform’s built-in protection against localized failures might not fully protect the VMs/disks if a major disaster causes large-scale outages.</span><span class="sxs-lookup"><span data-stu-id="c3b79-158">The Azure platform’s built-in protection against localized failures might not fully protect the VMs/disks if a major disaster causes large-scale outages.</span></span> <span data-ttu-id="c3b79-159">These large-scale outages include catastrophic events, such as if a datacenter is hit by a hurricane, earthquake, fire, or if there is a large-scale hardware unit failure.</span><span class="sxs-lookup"><span data-stu-id="c3b79-159">These large-scale outages include catastrophic events, such as if a datacenter is hit by a hurricane, earthquake, fire, or if there is a large-scale hardware unit failure.</span></span> <span data-ttu-id="c3b79-160">In addition, you might encounter failures due to application or data issues.</span><span class="sxs-lookup"><span data-stu-id="c3b79-160">In addition, you might encounter failures due to application or data issues.</span></span>

<span data-ttu-id="c3b79-161">To help protect your IaaS workloads from outages, you should plan for redundancy and have backups to enable recovery.</span><span class="sxs-lookup"><span data-stu-id="c3b79-161">To help protect your IaaS workloads from outages, you should plan for redundancy and have backups to enable recovery.</span></span> <span data-ttu-id="c3b79-162">For disaster recovery, you should back up in a different geographic location away from the primary site.</span><span class="sxs-lookup"><span data-stu-id="c3b79-162">For disaster recovery, you should back up in a different geographic location away from the primary site.</span></span> <span data-ttu-id="c3b79-163">This approach helps ensure your backup is not affected by the same event that originally affected the VM or disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-163">This approach helps ensure your backup is not affected by the same event that originally affected the VM or disks.</span></span> <span data-ttu-id="c3b79-164">For more information, see [Disaster recovery for Azure applications](/azure/architecture/resiliency/disaster-recovery-azure-applications).</span><span class="sxs-lookup"><span data-stu-id="c3b79-164">For more information, see [Disaster recovery for Azure applications](/azure/architecture/resiliency/disaster-recovery-azure-applications).</span></span>

<span data-ttu-id="c3b79-165">Your DR considerations might include the following aspects:</span><span class="sxs-lookup"><span data-stu-id="c3b79-165">Your DR considerations might include the following aspects:</span></span>

- <span data-ttu-id="c3b79-166">High availability: The ability of the application to continue running in a healthy state, without significant downtime.</span><span class="sxs-lookup"><span data-stu-id="c3b79-166">High availability: The ability of the application to continue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="c3b79-167">By *healthy state*, this state means that the application is responsive, and users can connect to the application and interact with it.</span><span class="sxs-lookup"><span data-stu-id="c3b79-167">By *healthy state*, this state means that the application is responsive, and users can connect to the application and interact with it.</span></span> <span data-ttu-id="c3b79-168">Certain mission-critical applications and databases might be required to always be available, even when there are failures in the platform.</span><span class="sxs-lookup"><span data-stu-id="c3b79-168">Certain mission-critical applications and databases might be required to always be available, even when there are failures in the platform.</span></span> <span data-ttu-id="c3b79-169">For these workloads, you might need to plan redundancy for the application, as well as the data.</span><span class="sxs-lookup"><span data-stu-id="c3b79-169">For these workloads, you might need to plan redundancy for the application, as well as the data.</span></span>

- <span data-ttu-id="c3b79-170">Data durability: In some cases, the main consideration is ensuring that the data is preserved if a disaster happens.</span><span class="sxs-lookup"><span data-stu-id="c3b79-170">Data durability: In some cases, the main consideration is ensuring that the data is preserved if a disaster happens.</span></span> <span data-ttu-id="c3b79-171">Therefore, you might need a backup of your data in a different site.</span><span class="sxs-lookup"><span data-stu-id="c3b79-171">Therefore, you might need a backup of your data in a different site.</span></span> <span data-ttu-id="c3b79-172">For such workloads, you might not need full redundancy for the application, but only a regular backup of the disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-172">For such workloads, you might not need full redundancy for the application, but only a regular backup of the disks.</span></span>

## <a name="backup-and-dr-scenarios"></a><span data-ttu-id="c3b79-173">Backup and DR scenarios</span><span class="sxs-lookup"><span data-stu-id="c3b79-173">Backup and DR scenarios</span></span>

<span data-ttu-id="c3b79-174">Let’s look at a few typical examples of application workload scenarios and the considerations for planning for disaster recovery.</span><span class="sxs-lookup"><span data-stu-id="c3b79-174">Let’s look at a few typical examples of application workload scenarios and the considerations for planning for disaster recovery.</span></span>

### <a name="scenario-1-major-database-solutions"></a><span data-ttu-id="c3b79-175">Scenario 1: Major database solutions</span><span class="sxs-lookup"><span data-stu-id="c3b79-175">Scenario 1: Major database solutions</span></span>

<span data-ttu-id="c3b79-176">Consider a production database server, like SQL Server or Oracle, that can support high availability.</span><span class="sxs-lookup"><span data-stu-id="c3b79-176">Consider a production database server, like SQL Server or Oracle, that can support high availability.</span></span> <span data-ttu-id="c3b79-177">Critical production applications and users depend on this database.</span><span class="sxs-lookup"><span data-stu-id="c3b79-177">Critical production applications and users depend on this database.</span></span> <span data-ttu-id="c3b79-178">The disaster recovery plan for this system might need to support the following requirements:</span><span class="sxs-lookup"><span data-stu-id="c3b79-178">The disaster recovery plan for this system might need to support the following requirements:</span></span>

- <span data-ttu-id="c3b79-179">The data must be protected and recoverable.</span><span class="sxs-lookup"><span data-stu-id="c3b79-179">The data must be protected and recoverable.</span></span>
- <span data-ttu-id="c3b79-180">The server must be available for use.</span><span class="sxs-lookup"><span data-stu-id="c3b79-180">The server must be available for use.</span></span>

<span data-ttu-id="c3b79-181">The disaster recovery plan might require maintaining a replica of the database in a different region as a backup.</span><span class="sxs-lookup"><span data-stu-id="c3b79-181">The disaster recovery plan might require maintaining a replica of the database in a different region as a backup.</span></span> <span data-ttu-id="c3b79-182">Depending on the requirements for server availability and data recovery, the solution might range from an active-active or active-passive replica site to periodic offline backups of the data.</span><span class="sxs-lookup"><span data-stu-id="c3b79-182">Depending on the requirements for server availability and data recovery, the solution might range from an active-active or active-passive replica site to periodic offline backups of the data.</span></span> <span data-ttu-id="c3b79-183">Relational databases, such as SQL Server and Oracle, provide various options for replication.</span><span class="sxs-lookup"><span data-stu-id="c3b79-183">Relational databases, such as SQL Server and Oracle, provide various options for replication.</span></span> <span data-ttu-id="c3b79-184">For SQL Server, use [SQL Server AlwaysOn Availability Groups](https://msdn.microsoft.com/library/hh510230.aspx) for high availability.</span><span class="sxs-lookup"><span data-stu-id="c3b79-184">For SQL Server, use [SQL Server AlwaysOn Availability Groups](https://msdn.microsoft.com/library/hh510230.aspx) for high availability.</span></span>

<span data-ttu-id="c3b79-185">NoSQL databases, like MongoDB, also support [replicas](https://docs.mongodb.com/manual/replication/) for redundancy.</span><span class="sxs-lookup"><span data-stu-id="c3b79-185">NoSQL databases, like MongoDB, also support [replicas](https://docs.mongodb.com/manual/replication/) for redundancy.</span></span> <span data-ttu-id="c3b79-186">The replicas for high availability are used.</span><span class="sxs-lookup"><span data-stu-id="c3b79-186">The replicas for high availability are used.</span></span>

### <a name="scenario-2-a-cluster-of-redundant-vms"></a><span data-ttu-id="c3b79-187">Scenario 2: A cluster of redundant VMs</span><span class="sxs-lookup"><span data-stu-id="c3b79-187">Scenario 2: A cluster of redundant VMs</span></span>

<span data-ttu-id="c3b79-188">Consider a workload handled by a cluster of VMs that provide redundancy and load balancing.</span><span class="sxs-lookup"><span data-stu-id="c3b79-188">Consider a workload handled by a cluster of VMs that provide redundancy and load balancing.</span></span> <span data-ttu-id="c3b79-189">One example is a Cassandra cluster deployed in a region.</span><span class="sxs-lookup"><span data-stu-id="c3b79-189">One example is a Cassandra cluster deployed in a region.</span></span> <span data-ttu-id="c3b79-190">This type of architecture already provides a high level of redundancy within that region.</span><span class="sxs-lookup"><span data-stu-id="c3b79-190">This type of architecture already provides a high level of redundancy within that region.</span></span> <span data-ttu-id="c3b79-191">However, to protect the workload from a regional-level failure, you should consider spreading the cluster across two regions or making periodic backups to another region.</span><span class="sxs-lookup"><span data-stu-id="c3b79-191">However, to protect the workload from a regional-level failure, you should consider spreading the cluster across two regions or making periodic backups to another region.</span></span>

### <a name="scenario-3-iaas-application-workload"></a><span data-ttu-id="c3b79-192">Scenario 3: IaaS application workload</span><span class="sxs-lookup"><span data-stu-id="c3b79-192">Scenario 3: IaaS application workload</span></span>

<span data-ttu-id="c3b79-193">Let's look at the IaaS application workload.</span><span class="sxs-lookup"><span data-stu-id="c3b79-193">Let's look at the IaaS application workload.</span></span> <span data-ttu-id="c3b79-194">For example, this application might be a typical production workload running on an Azure VM.</span><span class="sxs-lookup"><span data-stu-id="c3b79-194">For example, this application might be a typical production workload running on an Azure VM.</span></span> <span data-ttu-id="c3b79-195">It might be a web server or file server holding the content and other resources of a site.</span><span class="sxs-lookup"><span data-stu-id="c3b79-195">It might be a web server or file server holding the content and other resources of a site.</span></span> <span data-ttu-id="c3b79-196">It might also be a custom-built business application running on a VM that stored its data, resources, and application state on the VM disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-196">It might also be a custom-built business application running on a VM that stored its data, resources, and application state on the VM disks.</span></span> <span data-ttu-id="c3b79-197">In this case, it's important to make sure you take backups on a regular basis.</span><span class="sxs-lookup"><span data-stu-id="c3b79-197">In this case, it's important to make sure you take backups on a regular basis.</span></span> <span data-ttu-id="c3b79-198">Backup frequency should be based on the nature of the VM workload.</span><span class="sxs-lookup"><span data-stu-id="c3b79-198">Backup frequency should be based on the nature of the VM workload.</span></span> <span data-ttu-id="c3b79-199">For example, if the application runs every day and modifies data, then the backup should be taken every hour.</span><span class="sxs-lookup"><span data-stu-id="c3b79-199">For example, if the application runs every day and modifies data, then the backup should be taken every hour.</span></span>

<span data-ttu-id="c3b79-200">Another example is a reporting server that pulls data from other sources and generates aggregated reports.</span><span class="sxs-lookup"><span data-stu-id="c3b79-200">Another example is a reporting server that pulls data from other sources and generates aggregated reports.</span></span> <span data-ttu-id="c3b79-201">The loss of this VM or disks might lead to the loss of the reports.</span><span class="sxs-lookup"><span data-stu-id="c3b79-201">The loss of this VM or disks might lead to the loss of the reports.</span></span> <span data-ttu-id="c3b79-202">However, it might be possible to rerun the reporting process and regenerate the output.</span><span class="sxs-lookup"><span data-stu-id="c3b79-202">However, it might be possible to rerun the reporting process and regenerate the output.</span></span> <span data-ttu-id="c3b79-203">In that case, you don’t really have a loss of data, even if the reporting server is hit with a disaster.</span><span class="sxs-lookup"><span data-stu-id="c3b79-203">In that case, you don’t really have a loss of data, even if the reporting server is hit with a disaster.</span></span> <span data-ttu-id="c3b79-204">As a result, you might have a higher level of tolerance for losing part of the data on the reporting server.</span><span class="sxs-lookup"><span data-stu-id="c3b79-204">As a result, you might have a higher level of tolerance for losing part of the data on the reporting server.</span></span> <span data-ttu-id="c3b79-205">In that case, less frequent backups are an option to reduce costs.</span><span class="sxs-lookup"><span data-stu-id="c3b79-205">In that case, less frequent backups are an option to reduce costs.</span></span>

### <a name="scenario-4-iaas-application-data-issues"></a><span data-ttu-id="c3b79-206">Scenario 4: IaaS application data issues</span><span class="sxs-lookup"><span data-stu-id="c3b79-206">Scenario 4: IaaS application data issues</span></span>

<span data-ttu-id="c3b79-207">IaaS application data issues are another possibility.</span><span class="sxs-lookup"><span data-stu-id="c3b79-207">IaaS application data issues are another possibility.</span></span> <span data-ttu-id="c3b79-208">Consider an application that computes, maintains, and serves critical commercial data, such as pricing information.</span><span class="sxs-lookup"><span data-stu-id="c3b79-208">Consider an application that computes, maintains, and serves critical commercial data, such as pricing information.</span></span> <span data-ttu-id="c3b79-209">A new version of your application had a software bug that incorrectly computed the pricing and corrupted the existing commerce data served by the platform.</span><span class="sxs-lookup"><span data-stu-id="c3b79-209">A new version of your application had a software bug that incorrectly computed the pricing and corrupted the existing commerce data served by the platform.</span></span> <span data-ttu-id="c3b79-210">Here, the best course of action is to revert to the earlier version of the application and the data.</span><span class="sxs-lookup"><span data-stu-id="c3b79-210">Here, the best course of action is to revert to the earlier version of the application and the data.</span></span> <span data-ttu-id="c3b79-211">To enable this, take periodic backups of your system.</span><span class="sxs-lookup"><span data-stu-id="c3b79-211">To enable this, take periodic backups of your system.</span></span>

## <a name="disaster-recovery-solution-azure-backup"></a><span data-ttu-id="c3b79-212">Disaster recovery solution: Azure Backup</span><span class="sxs-lookup"><span data-stu-id="c3b79-212">Disaster recovery solution: Azure Backup</span></span> 

<span data-ttu-id="c3b79-213">[Azure Backup](https://azure.microsoft.com/services/backup/) is used for backups and DR, and it works with [managed disks](../articles/virtual-machines/windows/managed-disks-overview.md) as well as [unmanaged disks](../articles/virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks).</span><span class="sxs-lookup"><span data-stu-id="c3b79-213">[Azure Backup](https://azure.microsoft.com/services/backup/) is used for backups and DR, and it works with [managed disks](../articles/virtual-machines/windows/managed-disks-overview.md) as well as [unmanaged disks](../articles/virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks).</span></span> <span data-ttu-id="c3b79-214">You can create a backup job with time-based backups, easy VM restoration, and backup retention policies.</span><span class="sxs-lookup"><span data-stu-id="c3b79-214">You can create a backup job with time-based backups, easy VM restoration, and backup retention policies.</span></span> 

<span data-ttu-id="c3b79-215">If you use [Premium SSD disks](../articles/virtual-machines/windows/premium-storage.md), [managed disks](../articles/virtual-machines/windows/managed-disks-overview.md), or other disk types with the [locally redundant storage](../articles/storage/common/storage-redundancy-lrs.md) option, it's especially important to make periodic DR backups.</span><span class="sxs-lookup"><span data-stu-id="c3b79-215">If you use [Premium SSD disks](../articles/virtual-machines/windows/premium-storage.md), [managed disks](../articles/virtual-machines/windows/managed-disks-overview.md), or other disk types with the [locally redundant storage](../articles/storage/common/storage-redundancy-lrs.md) option, it's especially important to make periodic DR backups.</span></span> <span data-ttu-id="c3b79-216">Azure Backup stores the data in your recovery services vault for long-term retention.</span><span class="sxs-lookup"><span data-stu-id="c3b79-216">Azure Backup stores the data in your recovery services vault for long-term retention.</span></span> <span data-ttu-id="c3b79-217">Choose the [geo-redundant storage](../articles/storage/common/storage-redundancy-grs.md) option for the backup recovery services vault.</span><span class="sxs-lookup"><span data-stu-id="c3b79-217">Choose the [geo-redundant storage](../articles/storage/common/storage-redundancy-grs.md) option for the backup recovery services vault.</span></span> <span data-ttu-id="c3b79-218">That option ensures that backups are replicated to a different Azure region for safeguarding from regional disasters.</span><span class="sxs-lookup"><span data-stu-id="c3b79-218">That option ensures that backups are replicated to a different Azure region for safeguarding from regional disasters.</span></span>

<span data-ttu-id="c3b79-219">For [unmanaged disks](../articles/virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks), you can use the locally redundant storage type for IaaS disks, but ensure that Azure Backup is enabled with the geo-redundant storage option for the recovery services vault.</span><span class="sxs-lookup"><span data-stu-id="c3b79-219">For [unmanaged disks](../articles/virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks), you can use the locally redundant storage type for IaaS disks, but ensure that Azure Backup is enabled with the geo-redundant storage option for the recovery services vault.</span></span>

> [!NOTE]
> <span data-ttu-id="c3b79-220">If you use the [geo-redundant storage](../articles/storage/common/storage-redundancy-grs.md) or [read-access geo-redundant storage](../articles/storage/common/storage-redundancy-grs.md#read-access-geo-redundant-storage) option for your unmanaged disks, you still need consistent snapshots for backup and DR.</span><span class="sxs-lookup"><span data-stu-id="c3b79-220">If you use the [geo-redundant storage](../articles/storage/common/storage-redundancy-grs.md) or [read-access geo-redundant storage](../articles/storage/common/storage-redundancy-grs.md#read-access-geo-redundant-storage) option for your unmanaged disks, you still need consistent snapshots for backup and DR.</span></span> <span data-ttu-id="c3b79-221">Use either [Azure Backup](https://azure.microsoft.com/services/backup/) or [consistent snapshots](#alternative-solution-consistent-snapshots).</span><span class="sxs-lookup"><span data-stu-id="c3b79-221">Use either [Azure Backup](https://azure.microsoft.com/services/backup/) or [consistent snapshots](#alternative-solution-consistent-snapshots).</span></span>

 <span data-ttu-id="c3b79-222">The following table is a summary of the solutions available for DR.</span><span class="sxs-lookup"><span data-stu-id="c3b79-222">The following table is a summary of the solutions available for DR.</span></span>

| <span data-ttu-id="c3b79-223">Scenario</span><span class="sxs-lookup"><span data-stu-id="c3b79-223">Scenario</span></span> | <span data-ttu-id="c3b79-224">Automatic replication</span><span class="sxs-lookup"><span data-stu-id="c3b79-224">Automatic replication</span></span> | <span data-ttu-id="c3b79-225">DR solution</span><span class="sxs-lookup"><span data-stu-id="c3b79-225">DR solution</span></span> |
| --- | --- | --- |
| <span data-ttu-id="c3b79-226">Premium SSD disks</span><span class="sxs-lookup"><span data-stu-id="c3b79-226">Premium SSD disks</span></span> | <span data-ttu-id="c3b79-227">Local ([locally redundant storage](../articles/storage/common/storage-redundancy-lrs.md))</span><span class="sxs-lookup"><span data-stu-id="c3b79-227">Local ([locally redundant storage](../articles/storage/common/storage-redundancy-lrs.md))</span></span> | [<span data-ttu-id="c3b79-228">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="c3b79-228">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="c3b79-229">Managed disks</span><span class="sxs-lookup"><span data-stu-id="c3b79-229">Managed disks</span></span> | <span data-ttu-id="c3b79-230">Local ([locally redundant storage](../articles/storage/common/storage-redundancy-lrs.md))</span><span class="sxs-lookup"><span data-stu-id="c3b79-230">Local ([locally redundant storage](../articles/storage/common/storage-redundancy-lrs.md))</span></span> | [<span data-ttu-id="c3b79-231">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="c3b79-231">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="c3b79-232">Unmanaged locally redundant storage disks</span><span class="sxs-lookup"><span data-stu-id="c3b79-232">Unmanaged locally redundant storage disks</span></span> | <span data-ttu-id="c3b79-233">Local ([locally redundant storage](../articles/storage/common/storage-redundancy-lrs.md))</span><span class="sxs-lookup"><span data-stu-id="c3b79-233">Local ([locally redundant storage](../articles/storage/common/storage-redundancy-lrs.md))</span></span> | [<span data-ttu-id="c3b79-234">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="c3b79-234">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="c3b79-235">Unmanaged geo-redundant storage disks</span><span class="sxs-lookup"><span data-stu-id="c3b79-235">Unmanaged geo-redundant storage disks</span></span> | <span data-ttu-id="c3b79-236">Cross region ([geo-redundant storage](../articles/storage/common/storage-redundancy-grs.md))</span><span class="sxs-lookup"><span data-stu-id="c3b79-236">Cross region ([geo-redundant storage](../articles/storage/common/storage-redundancy-grs.md))</span></span> | [<span data-ttu-id="c3b79-237">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="c3b79-237">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="c3b79-238">Consistent snapshots</span><span class="sxs-lookup"><span data-stu-id="c3b79-238">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |
| <span data-ttu-id="c3b79-239">Unmanaged read-access geo-redundant storage disks</span><span class="sxs-lookup"><span data-stu-id="c3b79-239">Unmanaged read-access geo-redundant storage disks</span></span> | <span data-ttu-id="c3b79-240">Cross region ([read-access geo-redundant storage](../articles/storage/common/storage-redundancy-grs.md#read-access-geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="c3b79-240">Cross region ([read-access geo-redundant storage](../articles/storage/common/storage-redundancy-grs.md#read-access-geo-redundant-storage))</span></span> | [<span data-ttu-id="c3b79-241">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="c3b79-241">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="c3b79-242">Consistent snapshots</span><span class="sxs-lookup"><span data-stu-id="c3b79-242">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |

<span data-ttu-id="c3b79-243">High availability is best met by using managed disks in an availability set along with Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="c3b79-243">High availability is best met by using managed disks in an availability set along with Azure Backup.</span></span> <span data-ttu-id="c3b79-244">If you use unmanaged disks, you can still use Azure Backup for DR.</span><span class="sxs-lookup"><span data-stu-id="c3b79-244">If you use unmanaged disks, you can still use Azure Backup for DR.</span></span> <span data-ttu-id="c3b79-245">If you are unable to use Azure Backup, then taking [consistent snapshots](#alternative-solution-consistent-snapshots), as described in a later section, is an alternative solution for backup and DR.</span><span class="sxs-lookup"><span data-stu-id="c3b79-245">If you are unable to use Azure Backup, then taking [consistent snapshots](#alternative-solution-consistent-snapshots), as described in a later section, is an alternative solution for backup and DR.</span></span>

<span data-ttu-id="c3b79-246">Your choices for high availability, backup, and DR at application or infrastructure levels can be represented as follows:</span><span class="sxs-lookup"><span data-stu-id="c3b79-246">Your choices for high availability, backup, and DR at application or infrastructure levels can be represented as follows:</span></span>

| <span data-ttu-id="c3b79-247">Level</span><span class="sxs-lookup"><span data-stu-id="c3b79-247">Level</span></span> |   <span data-ttu-id="c3b79-248">High availability</span><span class="sxs-lookup"><span data-stu-id="c3b79-248">High availability</span></span>   | <span data-ttu-id="c3b79-249">Backup or DR</span><span class="sxs-lookup"><span data-stu-id="c3b79-249">Backup or DR</span></span> |
| --- | --- | --- |
| <span data-ttu-id="c3b79-250">Application</span><span class="sxs-lookup"><span data-stu-id="c3b79-250">Application</span></span> | <span data-ttu-id="c3b79-251">SQL Server AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="c3b79-251">SQL Server AlwaysOn</span></span> | <span data-ttu-id="c3b79-252">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="c3b79-252">Azure Backup</span></span> |
| <span data-ttu-id="c3b79-253">Infrastructure</span><span class="sxs-lookup"><span data-stu-id="c3b79-253">Infrastructure</span></span>    | <span data-ttu-id="c3b79-254">Availability set</span><span class="sxs-lookup"><span data-stu-id="c3b79-254">Availability set</span></span>  | <span data-ttu-id="c3b79-255">Geo-redundant storage with consistent snapshots</span><span class="sxs-lookup"><span data-stu-id="c3b79-255">Geo-redundant storage with consistent snapshots</span></span> |

### <a name="using-azure-backup"></a><span data-ttu-id="c3b79-256">Using Azure Backup</span><span class="sxs-lookup"><span data-stu-id="c3b79-256">Using Azure Backup</span></span> 

<span data-ttu-id="c3b79-257">[Azure Backup](../articles/backup/backup-azure-vms-introduction.md) can back up your VMs running Windows or Linux to the Azure recovery services vault.</span><span class="sxs-lookup"><span data-stu-id="c3b79-257">[Azure Backup](../articles/backup/backup-azure-vms-introduction.md) can back up your VMs running Windows or Linux to the Azure recovery services vault.</span></span> <span data-ttu-id="c3b79-258">Backing up and restoring business-critical data is complicated by the fact that business-critical data must be backed up while the applications that produce the data are running.</span><span class="sxs-lookup"><span data-stu-id="c3b79-258">Backing up and restoring business-critical data is complicated by the fact that business-critical data must be backed up while the applications that produce the data are running.</span></span> 

<span data-ttu-id="c3b79-259">To address this issue, Azure Backup provides application-consistent backups for Microsoft workloads.</span><span class="sxs-lookup"><span data-stu-id="c3b79-259">To address this issue, Azure Backup provides application-consistent backups for Microsoft workloads.</span></span> <span data-ttu-id="c3b79-260">It uses the volume shadow service to ensure that data is written correctly to storage.</span><span class="sxs-lookup"><span data-stu-id="c3b79-260">It uses the volume shadow service to ensure that data is written correctly to storage.</span></span> <span data-ttu-id="c3b79-261">For Linux VMs, only file-consistent backups are possible, because Linux does not have functionality equivalent to the volume shadow service.</span><span class="sxs-lookup"><span data-stu-id="c3b79-261">For Linux VMs, only file-consistent backups are possible, because Linux does not have functionality equivalent to the volume shadow service.</span></span>

![Azure Backup flow][1]

<span data-ttu-id="c3b79-263">When Azure Backup initiates a backup job at the scheduled time, it triggers the backup extension installed in the VM to take a point-in-time snapshot.</span><span class="sxs-lookup"><span data-stu-id="c3b79-263">When Azure Backup initiates a backup job at the scheduled time, it triggers the backup extension installed in the VM to take a point-in-time snapshot.</span></span> <span data-ttu-id="c3b79-264">A snapshot is taken in coordination with the volume shadow service to get a consistent snapshot of the disks in the virtual machine without having to shut it down.</span><span class="sxs-lookup"><span data-stu-id="c3b79-264">A snapshot is taken in coordination with the volume shadow service to get a consistent snapshot of the disks in the virtual machine without having to shut it down.</span></span> <span data-ttu-id="c3b79-265">The backup extension in the VM flushes all writes before taking a consistent snapshot of all of the disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-265">The backup extension in the VM flushes all writes before taking a consistent snapshot of all of the disks.</span></span> <span data-ttu-id="c3b79-266">After taking the snapshot, the data is transferred by Azure Backup to the backup vault.</span><span class="sxs-lookup"><span data-stu-id="c3b79-266">After taking the snapshot, the data is transferred by Azure Backup to the backup vault.</span></span> <span data-ttu-id="c3b79-267">To make the backup process more efficient, the service identifies and transfers only the blocks of data that have changed after the last backup.</span><span class="sxs-lookup"><span data-stu-id="c3b79-267">To make the backup process more efficient, the service identifies and transfers only the blocks of data that have changed after the last backup.</span></span>

<span data-ttu-id="c3b79-268">To restore, you can view the available backups through Azure Backup and then initiate a restore.</span><span class="sxs-lookup"><span data-stu-id="c3b79-268">To restore, you can view the available backups through Azure Backup and then initiate a restore.</span></span> <span data-ttu-id="c3b79-269">You can create and restore Azure backups through the [Azure portal](https://portal.azure.com/), by [using PowerShell](../articles/backup/backup-azure-vms-automation.md), or by using the [Azure CLI](/cli/azure/).</span><span class="sxs-lookup"><span data-stu-id="c3b79-269">You can create and restore Azure backups through the [Azure portal](https://portal.azure.com/), by [using PowerShell](../articles/backup/backup-azure-vms-automation.md), or by using the [Azure CLI](/cli/azure/).</span></span> 

### <a name="steps-to-enable-a-backup"></a><span data-ttu-id="c3b79-270">Steps to enable a backup</span><span class="sxs-lookup"><span data-stu-id="c3b79-270">Steps to enable a backup</span></span>

<span data-ttu-id="c3b79-271">Use the following steps to enable backups of your VMs by using the [Azure portal](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="c3b79-271">Use the following steps to enable backups of your VMs by using the [Azure portal](https://portal.azure.com/).</span></span> <span data-ttu-id="c3b79-272">There is some variation depending on your exact scenario.</span><span class="sxs-lookup"><span data-stu-id="c3b79-272">There is some variation depending on your exact scenario.</span></span> <span data-ttu-id="c3b79-273">Refer to the [Azure Backup](../articles/backup/backup-azure-vms-introduction.md) documentation for full details.</span><span class="sxs-lookup"><span data-stu-id="c3b79-273">Refer to the [Azure Backup](../articles/backup/backup-azure-vms-introduction.md) documentation for full details.</span></span> <span data-ttu-id="c3b79-274">Azure Backup also [supports VMs with managed disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span><span class="sxs-lookup"><span data-stu-id="c3b79-274">Azure Backup also [supports VMs with managed disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span></span>

1.  <span data-ttu-id="c3b79-275">Create a recovery services vault for a VM:</span><span class="sxs-lookup"><span data-stu-id="c3b79-275">Create a recovery services vault for a VM:</span></span>

    <span data-ttu-id="c3b79-276">a.</span><span class="sxs-lookup"><span data-stu-id="c3b79-276">a.</span></span> <span data-ttu-id="c3b79-277">In the [Azure portal](https://portal.azure.com/), browse **All resources** and find **Recovery Services vaults**.</span><span class="sxs-lookup"><span data-stu-id="c3b79-277">In the [Azure portal](https://portal.azure.com/), browse **All resources** and find **Recovery Services vaults**.</span></span>

    <span data-ttu-id="c3b79-278">b.</span><span class="sxs-lookup"><span data-stu-id="c3b79-278">b.</span></span> <span data-ttu-id="c3b79-279">On the **Recovery Services vaults** menu, click **Add** and follow the steps to create a new vault in the same region as the VM.</span><span class="sxs-lookup"><span data-stu-id="c3b79-279">On the **Recovery Services vaults** menu, click **Add** and follow the steps to create a new vault in the same region as the VM.</span></span> <span data-ttu-id="c3b79-280">For example, if your VM is in the West US region, pick West US for the vault.</span><span class="sxs-lookup"><span data-stu-id="c3b79-280">For example, if your VM is in the West US region, pick West US for the vault.</span></span>

1.  <span data-ttu-id="c3b79-281">Verify the storage replication for the newly created vault.</span><span class="sxs-lookup"><span data-stu-id="c3b79-281">Verify the storage replication for the newly created vault.</span></span> <span data-ttu-id="c3b79-282">Access the vault under **Recovery Services vaults** and go to **Settings** > **Backup Configuration**.</span><span class="sxs-lookup"><span data-stu-id="c3b79-282">Access the vault under **Recovery Services vaults** and go to **Settings** > **Backup Configuration**.</span></span> <span data-ttu-id="c3b79-283">Ensure the **geo-redundant storage** option is selected by default.</span><span class="sxs-lookup"><span data-stu-id="c3b79-283">Ensure the **geo-redundant storage** option is selected by default.</span></span> <span data-ttu-id="c3b79-284">This option ensures that your vault is automatically replicated to a secondary datacenter.</span><span class="sxs-lookup"><span data-stu-id="c3b79-284">This option ensures that your vault is automatically replicated to a secondary datacenter.</span></span> <span data-ttu-id="c3b79-285">For example, your vault in West US is automatically replicated to East US.</span><span class="sxs-lookup"><span data-stu-id="c3b79-285">For example, your vault in West US is automatically replicated to East US.</span></span>

1.  <span data-ttu-id="c3b79-286">Configure the backup policy and select the VM from the same UI.</span><span class="sxs-lookup"><span data-stu-id="c3b79-286">Configure the backup policy and select the VM from the same UI.</span></span>

1.  <span data-ttu-id="c3b79-287">Make sure the Backup Agent is installed on the VM.</span><span class="sxs-lookup"><span data-stu-id="c3b79-287">Make sure the Backup Agent is installed on the VM.</span></span> <span data-ttu-id="c3b79-288">If your VM is created by using an Azure gallery image, then the Backup Agent is already installed.</span><span class="sxs-lookup"><span data-stu-id="c3b79-288">If your VM is created by using an Azure gallery image, then the Backup Agent is already installed.</span></span> <span data-ttu-id="c3b79-289">Otherwise (that is, if you use a custom image), use the instructions to [install the VM agent on a virtual machine](../articles/backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span><span class="sxs-lookup"><span data-stu-id="c3b79-289">Otherwise (that is, if you use a custom image), use the instructions to [install the VM agent on a virtual machine](../articles/backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span></span>

1.  <span data-ttu-id="c3b79-290">Make sure that the VM allows network connectivity for the backup service to function.</span><span class="sxs-lookup"><span data-stu-id="c3b79-290">Make sure that the VM allows network connectivity for the backup service to function.</span></span> <span data-ttu-id="c3b79-291">Follow the instructions for [network connectivity](../articles/backup/backup-azure-arm-vms-prepare.md#establish-network-connectivity).</span><span class="sxs-lookup"><span data-stu-id="c3b79-291">Follow the instructions for [network connectivity](../articles/backup/backup-azure-arm-vms-prepare.md#establish-network-connectivity).</span></span>

1.  <span data-ttu-id="c3b79-292">After the previous steps are completed, the backup runs at regular intervals as specified in the backup policy.</span><span class="sxs-lookup"><span data-stu-id="c3b79-292">After the previous steps are completed, the backup runs at regular intervals as specified in the backup policy.</span></span> <span data-ttu-id="c3b79-293">If necessary, you can trigger the first backup manually from the vault dashboard on the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="c3b79-293">If necessary, you can trigger the first backup manually from the vault dashboard on the Azure portal.</span></span>

<span data-ttu-id="c3b79-294">For automating Azure Backup by using scripts, refer to [PowerShell cmdlets for VM backup](../articles/backup/backup-azure-vms-automation.md).</span><span class="sxs-lookup"><span data-stu-id="c3b79-294">For automating Azure Backup by using scripts, refer to [PowerShell cmdlets for VM backup](../articles/backup/backup-azure-vms-automation.md).</span></span>

### <a name="steps-for-recovery"></a><span data-ttu-id="c3b79-295">Steps for recovery</span><span class="sxs-lookup"><span data-stu-id="c3b79-295">Steps for recovery</span></span>

<span data-ttu-id="c3b79-296">If you need to repair or rebuild a VM, you can restore the VM from any of the backup recovery points in the vault.</span><span class="sxs-lookup"><span data-stu-id="c3b79-296">If you need to repair or rebuild a VM, you can restore the VM from any of the backup recovery points in the vault.</span></span> <span data-ttu-id="c3b79-297">There are a couple of different options for performing the recovery:</span><span class="sxs-lookup"><span data-stu-id="c3b79-297">There are a couple of different options for performing the recovery:</span></span>

-   <span data-ttu-id="c3b79-298">You can create a new VM as a point-in-time representation of your backed-up VM.</span><span class="sxs-lookup"><span data-stu-id="c3b79-298">You can create a new VM as a point-in-time representation of your backed-up VM.</span></span>

-   <span data-ttu-id="c3b79-299">You can restore the disks, and then use the template for the VM to customize and rebuild the restored VM.</span><span class="sxs-lookup"><span data-stu-id="c3b79-299">You can restore the disks, and then use the template for the VM to customize and rebuild the restored VM.</span></span> 

<span data-ttu-id="c3b79-300">For more information, see the instructions to [use the Azure portal to restore virtual machines](../articles/backup/backup-azure-arm-restore-vms.md).</span><span class="sxs-lookup"><span data-stu-id="c3b79-300">For more information, see the instructions to [use the Azure portal to restore virtual machines](../articles/backup/backup-azure-arm-restore-vms.md).</span></span> <span data-ttu-id="c3b79-301">This document also explains the specific steps for restoring backed-up VMs to a paired datacenter by using your geo-redundant backup vault if there is a disaster at the primary datacenter.</span><span class="sxs-lookup"><span data-stu-id="c3b79-301">This document also explains the specific steps for restoring backed-up VMs to a paired datacenter by using your geo-redundant backup vault if there is a disaster at the primary datacenter.</span></span> <span data-ttu-id="c3b79-302">In that case, Azure Backup uses the Compute service from the secondary region to create the restored virtual machine.</span><span class="sxs-lookup"><span data-stu-id="c3b79-302">In that case, Azure Backup uses the Compute service from the secondary region to create the restored virtual machine.</span></span>

<span data-ttu-id="c3b79-303">You can also use PowerShell for [restoring a VM](../articles/backup/backup-azure-arm-restore-vms.md#restore-a-vm-during-an-azure-datacenter-disaster) or for [creating a new VM from restored disks](../articles/backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span><span class="sxs-lookup"><span data-stu-id="c3b79-303">You can also use PowerShell for [restoring a VM](../articles/backup/backup-azure-arm-restore-vms.md#restore-a-vm-during-an-azure-datacenter-disaster) or for [creating a new VM from restored disks](../articles/backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span></span>

## <a name="alternative-solution-consistent-snapshots"></a><span data-ttu-id="c3b79-304">Alternative solution: Consistent snapshots</span><span class="sxs-lookup"><span data-stu-id="c3b79-304">Alternative solution: Consistent snapshots</span></span>

<span data-ttu-id="c3b79-305">If you are unable to use Azure Backup, you can implement your own backup mechanism by using snapshots.</span><span class="sxs-lookup"><span data-stu-id="c3b79-305">If you are unable to use Azure Backup, you can implement your own backup mechanism by using snapshots.</span></span> <span data-ttu-id="c3b79-306">Creating consistent snapshots for all the disks used by a VM and then replicating those snapshots to another region is complicated.</span><span class="sxs-lookup"><span data-stu-id="c3b79-306">Creating consistent snapshots for all the disks used by a VM and then replicating those snapshots to another region is complicated.</span></span> <span data-ttu-id="c3b79-307">For this reason, Azure considers using the Backup service as a better option than building a custom solution.</span><span class="sxs-lookup"><span data-stu-id="c3b79-307">For this reason, Azure considers using the Backup service as a better option than building a custom solution.</span></span> 

<span data-ttu-id="c3b79-308">If you use read-access geo-redundant storage/geo-redundant storage for disks, snapshots are automatically replicated to a secondary datacenter.</span><span class="sxs-lookup"><span data-stu-id="c3b79-308">If you use read-access geo-redundant storage/geo-redundant storage for disks, snapshots are automatically replicated to a secondary datacenter.</span></span> <span data-ttu-id="c3b79-309">If you use locally redundant storage for disks, you need to replicate the data yourself.</span><span class="sxs-lookup"><span data-stu-id="c3b79-309">If you use locally redundant storage for disks, you need to replicate the data yourself.</span></span> <span data-ttu-id="c3b79-310">For more information, see [Back up Azure-unmanaged VM disks with incremental snapshots](../articles/virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="c3b79-310">For more information, see [Back up Azure-unmanaged VM disks with incremental snapshots](../articles/virtual-machines/windows/incremental-snapshots.md).</span></span>

<span data-ttu-id="c3b79-311">A snapshot is a representation of an object at a specific point in time.</span><span class="sxs-lookup"><span data-stu-id="c3b79-311">A snapshot is a representation of an object at a specific point in time.</span></span> <span data-ttu-id="c3b79-312">A snapshot incurs billing for the incremental size of the data it holds.</span><span class="sxs-lookup"><span data-stu-id="c3b79-312">A snapshot incurs billing for the incremental size of the data it holds.</span></span> <span data-ttu-id="c3b79-313">For more information, see [Create a blob snapshot](../articles/storage/blobs/storage-blob-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="c3b79-313">For more information, see [Create a blob snapshot](../articles/storage/blobs/storage-blob-snapshots.md).</span></span>

### <a name="create-snapshots-while-the-vm-is-running"></a><span data-ttu-id="c3b79-314">Create snapshots while the VM is running</span><span class="sxs-lookup"><span data-stu-id="c3b79-314">Create snapshots while the VM is running</span></span>

<span data-ttu-id="c3b79-315">Although you can take a snapshot at any time, if the VM is running, there is still data being streamed to the disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-315">Although you can take a snapshot at any time, if the VM is running, there is still data being streamed to the disks.</span></span> <span data-ttu-id="c3b79-316">The snapshots might contain partial operations that were in flight.</span><span class="sxs-lookup"><span data-stu-id="c3b79-316">The snapshots might contain partial operations that were in flight.</span></span> <span data-ttu-id="c3b79-317">Also, if there are several disks involved, the snapshots of different disks might have occurred at different times.</span><span class="sxs-lookup"><span data-stu-id="c3b79-317">Also, if there are several disks involved, the snapshots of different disks might have occurred at different times.</span></span> <span data-ttu-id="c3b79-318">These scenarios may cause to the snapshots to be uncoordinated.</span><span class="sxs-lookup"><span data-stu-id="c3b79-318">These scenarios may cause to the snapshots to be uncoordinated.</span></span> <span data-ttu-id="c3b79-319">This lack of co-ordination is especially problematic for striped volumes whose files might be corrupted if changes were being made during backup.</span><span class="sxs-lookup"><span data-stu-id="c3b79-319">This lack of co-ordination is especially problematic for striped volumes whose files might be corrupted if changes were being made during backup.</span></span>

<span data-ttu-id="c3b79-320">To avoid this situation, the backup process must implement the following steps:</span><span class="sxs-lookup"><span data-stu-id="c3b79-320">To avoid this situation, the backup process must implement the following steps:</span></span>

1.  <span data-ttu-id="c3b79-321">Freeze all the disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-321">Freeze all the disks.</span></span>

1.  <span data-ttu-id="c3b79-322">Flush all the pending writes.</span><span class="sxs-lookup"><span data-stu-id="c3b79-322">Flush all the pending writes.</span></span>

1.  <span data-ttu-id="c3b79-323">[Create a blob snapshot](../articles/storage/blobs/storage-blob-snapshots.md) for all the disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-323">[Create a blob snapshot](../articles/storage/blobs/storage-blob-snapshots.md) for all the disks.</span></span>

<span data-ttu-id="c3b79-324">Some Windows applications, like SQL Server, provide a coordinated backup mechanism via a volume shadow service to create application-consistent backups.</span><span class="sxs-lookup"><span data-stu-id="c3b79-324">Some Windows applications, like SQL Server, provide a coordinated backup mechanism via a volume shadow service to create application-consistent backups.</span></span> <span data-ttu-id="c3b79-325">On Linux, you can use a tool like *fsfreeze* for coordinating the disks.</span><span class="sxs-lookup"><span data-stu-id="c3b79-325">On Linux, you can use a tool like *fsfreeze* for coordinating the disks.</span></span> <span data-ttu-id="c3b79-326">This tool provides file-consistent backups, but not application-consistent snapshots.</span><span class="sxs-lookup"><span data-stu-id="c3b79-326">This tool provides file-consistent backups, but not application-consistent snapshots.</span></span> <span data-ttu-id="c3b79-327">This process is complex, so you should consider using [Azure Backup](../articles/backup/backup-azure-vms-introduction.md) or a third-party backup solution that already implements this procedure.</span><span class="sxs-lookup"><span data-stu-id="c3b79-327">This process is complex, so you should consider using [Azure Backup](../articles/backup/backup-azure-vms-introduction.md) or a third-party backup solution that already implements this procedure.</span></span>

<span data-ttu-id="c3b79-328">The previous process results in a collection of coordinated snapshots for all of the VM disks, representing a specific point-in-time view of the VM.</span><span class="sxs-lookup"><span data-stu-id="c3b79-328">The previous process results in a collection of coordinated snapshots for all of the VM disks, representing a specific point-in-time view of the VM.</span></span> <span data-ttu-id="c3b79-329">This is a backup restore point for the VM.</span><span class="sxs-lookup"><span data-stu-id="c3b79-329">This is a backup restore point for the VM.</span></span> <span data-ttu-id="c3b79-330">You can repeat the process at scheduled intervals to create periodic backups.</span><span class="sxs-lookup"><span data-stu-id="c3b79-330">You can repeat the process at scheduled intervals to create periodic backups.</span></span> <span data-ttu-id="c3b79-331">See [Copy the backups to another region](#copy-the-snapshots-to-another-region) for steps to copy the snapshots to another region for DR.</span><span class="sxs-lookup"><span data-stu-id="c3b79-331">See [Copy the backups to another region](#copy-the-snapshots-to-another-region) for steps to copy the snapshots to another region for DR.</span></span>

### <a name="create-snapshots-while-the-vm-is-offline"></a><span data-ttu-id="c3b79-332">Create snapshots while the VM is offline</span><span class="sxs-lookup"><span data-stu-id="c3b79-332">Create snapshots while the VM is offline</span></span>

<span data-ttu-id="c3b79-333">Another option to create consistent backups is to shut down the VM and take blob snapshots of each disk.</span><span class="sxs-lookup"><span data-stu-id="c3b79-333">Another option to create consistent backups is to shut down the VM and take blob snapshots of each disk.</span></span> <span data-ttu-id="c3b79-334">Taking blob snapshots is easier than coordinating snapshots of a running VM, but it requires a few minutes of downtime.</span><span class="sxs-lookup"><span data-stu-id="c3b79-334">Taking blob snapshots is easier than coordinating snapshots of a running VM, but it requires a few minutes of downtime.</span></span>

1. <span data-ttu-id="c3b79-335">Shut down the VM.</span><span class="sxs-lookup"><span data-stu-id="c3b79-335">Shut down the VM.</span></span>

1. <span data-ttu-id="c3b79-336">Create a snapshot of each virtual hard drive blob, which only takes a few seconds.</span><span class="sxs-lookup"><span data-stu-id="c3b79-336">Create a snapshot of each virtual hard drive blob, which only takes a few seconds.</span></span>

    <span data-ttu-id="c3b79-337">To create a snapshot, you can use [PowerShell](../articles/storage/common/storage-powershell-guide-full.md), the [Azure Storage REST API](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](/cli/azure/), or one of the Azure Storage client libraries, such as [the Storage client library for .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="c3b79-337">To create a snapshot, you can use [PowerShell](../articles/storage/common/storage-powershell-guide-full.md), the [Azure Storage REST API](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](/cli/azure/), or one of the Azure Storage client libraries, such as [the Storage client library for .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

1. <span data-ttu-id="c3b79-338">Start the VM, which ends the downtime.</span><span class="sxs-lookup"><span data-stu-id="c3b79-338">Start the VM, which ends the downtime.</span></span> <span data-ttu-id="c3b79-339">Typically, the entire process finishes within a few minutes.</span><span class="sxs-lookup"><span data-stu-id="c3b79-339">Typically, the entire process finishes within a few minutes.</span></span>

<span data-ttu-id="c3b79-340">This process yields a collection of consistent snapshots for all the disks, providing a backup restore point for the VM.</span><span class="sxs-lookup"><span data-stu-id="c3b79-340">This process yields a collection of consistent snapshots for all the disks, providing a backup restore point for the VM.</span></span>

### <a name="copy-the-snapshots-to-another-region"></a><span data-ttu-id="c3b79-341">Copy the snapshots to another region</span><span class="sxs-lookup"><span data-stu-id="c3b79-341">Copy the snapshots to another region</span></span>

<span data-ttu-id="c3b79-342">Creation of the snapshots alone might not be sufficient for DR.</span><span class="sxs-lookup"><span data-stu-id="c3b79-342">Creation of the snapshots alone might not be sufficient for DR.</span></span> <span data-ttu-id="c3b79-343">You must also replicate the snapshot backups to another region.</span><span class="sxs-lookup"><span data-stu-id="c3b79-343">You must also replicate the snapshot backups to another region.</span></span>

<span data-ttu-id="c3b79-344">If you use geo-redundant storage or read-access geo-redundant storage for your disks, then the snapshots are replicated to the secondary region automatically.</span><span class="sxs-lookup"><span data-stu-id="c3b79-344">If you use geo-redundant storage or read-access geo-redundant storage for your disks, then the snapshots are replicated to the secondary region automatically.</span></span> <span data-ttu-id="c3b79-345">There can be a few minutes of lag before the replication.</span><span class="sxs-lookup"><span data-stu-id="c3b79-345">There can be a few minutes of lag before the replication.</span></span> <span data-ttu-id="c3b79-346">If the primary datacenter goes down before the snapshots finish replicating, you cannot access the snapshots from the secondary datacenter.</span><span class="sxs-lookup"><span data-stu-id="c3b79-346">If the primary datacenter goes down before the snapshots finish replicating, you cannot access the snapshots from the secondary datacenter.</span></span> <span data-ttu-id="c3b79-347">The likelihood of this is small.</span><span class="sxs-lookup"><span data-stu-id="c3b79-347">The likelihood of this is small.</span></span>

> [!NOTE] 
> <span data-ttu-id="c3b79-348">Only having the disks in a geo-redundant storage or read-access geo-redundant storage account does not protect the VM from disasters.</span><span class="sxs-lookup"><span data-stu-id="c3b79-348">Only having the disks in a geo-redundant storage or read-access geo-redundant storage account does not protect the VM from disasters.</span></span> <span data-ttu-id="c3b79-349">You must also create coordinated snapshots or use Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="c3b79-349">You must also create coordinated snapshots or use Azure Backup.</span></span> <span data-ttu-id="c3b79-350">This is required to recover a VM to a consistent state.</span><span class="sxs-lookup"><span data-stu-id="c3b79-350">This is required to recover a VM to a consistent state.</span></span>

<span data-ttu-id="c3b79-351">If you use locally redundant storage, you must copy the snapshots to a different storage account immediately after creating the snapshot.</span><span class="sxs-lookup"><span data-stu-id="c3b79-351">If you use locally redundant storage, you must copy the snapshots to a different storage account immediately after creating the snapshot.</span></span> <span data-ttu-id="c3b79-352">The copy target might be a locally redundant storage account in a different region, resulting in the copy being in a remote region.</span><span class="sxs-lookup"><span data-stu-id="c3b79-352">The copy target might be a locally redundant storage account in a different region, resulting in the copy being in a remote region.</span></span> <span data-ttu-id="c3b79-353">You can also copy the snapshot to a read-access geo-redundant storage account in the same region.</span><span class="sxs-lookup"><span data-stu-id="c3b79-353">You can also copy the snapshot to a read-access geo-redundant storage account in the same region.</span></span> <span data-ttu-id="c3b79-354">In this case, the snapshot is lazily replicated to the remote secondary region.</span><span class="sxs-lookup"><span data-stu-id="c3b79-354">In this case, the snapshot is lazily replicated to the remote secondary region.</span></span> <span data-ttu-id="c3b79-355">Your backup is protected from disasters at the primary site after the copying and replication is complete.</span><span class="sxs-lookup"><span data-stu-id="c3b79-355">Your backup is protected from disasters at the primary site after the copying and replication is complete.</span></span>

<span data-ttu-id="c3b79-356">To copy your incremental snapshots for DR efficiently, review the instructions in [Back up Azure unmanaged VM disks with incremental snapshots](../articles/virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="c3b79-356">To copy your incremental snapshots for DR efficiently, review the instructions in [Back up Azure unmanaged VM disks with incremental snapshots](../articles/virtual-machines/windows/incremental-snapshots.md).</span></span>

![Back up Azure unmanaged VM disks with incremental snapshots][2]

### <a name="recovery-from-snapshots"></a><span data-ttu-id="c3b79-358">Recovery from snapshots</span><span class="sxs-lookup"><span data-stu-id="c3b79-358">Recovery from snapshots</span></span>

<span data-ttu-id="c3b79-359">To retrieve a snapshot, copy it to make a new blob.</span><span class="sxs-lookup"><span data-stu-id="c3b79-359">To retrieve a snapshot, copy it to make a new blob.</span></span> <span data-ttu-id="c3b79-360">If you are copying the snapshot from the primary account, you can copy the snapshot over to the base blob of the snapshot.</span><span class="sxs-lookup"><span data-stu-id="c3b79-360">If you are copying the snapshot from the primary account, you can copy the snapshot over to the base blob of the snapshot.</span></span> <span data-ttu-id="c3b79-361">This process reverts the disk to the snapshot.</span><span class="sxs-lookup"><span data-stu-id="c3b79-361">This process reverts the disk to the snapshot.</span></span> <span data-ttu-id="c3b79-362">This process is known as promoting the snapshot.</span><span class="sxs-lookup"><span data-stu-id="c3b79-362">This process is known as promoting the snapshot.</span></span> <span data-ttu-id="c3b79-363">If you are copying the snapshot backup from a secondary account, in the case of a read-access geo-redundant storage account, you must copy it to a primary account.</span><span class="sxs-lookup"><span data-stu-id="c3b79-363">If you are copying the snapshot backup from a secondary account, in the case of a read-access geo-redundant storage account, you must copy it to a primary account.</span></span> <span data-ttu-id="c3b79-364">You can copy a snapshot by [using PowerShell](../articles/storage/common/storage-powershell-guide-full.md) or by using the AzCopy utility.</span><span class="sxs-lookup"><span data-stu-id="c3b79-364">You can copy a snapshot by [using PowerShell](../articles/storage/common/storage-powershell-guide-full.md) or by using the AzCopy utility.</span></span> <span data-ttu-id="c3b79-365">For more information, see [Transfer data with the AzCopy command-line utility](https://docs.microsoft.com/azure/storage/common/storage-use-azcopy).</span><span class="sxs-lookup"><span data-stu-id="c3b79-365">For more information, see [Transfer data with the AzCopy command-line utility](https://docs.microsoft.com/azure/storage/common/storage-use-azcopy).</span></span>

<span data-ttu-id="c3b79-366">For VMs with multiple disks, you must copy all the snapshots that are part of the same coordinated restore point.</span><span class="sxs-lookup"><span data-stu-id="c3b79-366">For VMs with multiple disks, you must copy all the snapshots that are part of the same coordinated restore point.</span></span> <span data-ttu-id="c3b79-367">After you copy the snapshots to writable VHD blobs, you can use the blobs to recreate your VM by using the template for the VM.</span><span class="sxs-lookup"><span data-stu-id="c3b79-367">After you copy the snapshots to writable VHD blobs, you can use the blobs to recreate your VM by using the template for the VM.</span></span>

## <a name="other-options"></a><span data-ttu-id="c3b79-368">Other options</span><span class="sxs-lookup"><span data-stu-id="c3b79-368">Other options</span></span>

### <a name="sql-server"></a><span data-ttu-id="c3b79-369">SQL Server</span><span class="sxs-lookup"><span data-stu-id="c3b79-369">SQL Server</span></span>

<span data-ttu-id="c3b79-370">SQL Server running in a VM has its own built-in capabilities to back up your SQL Server database to Azure Blob storage or a file share.</span><span class="sxs-lookup"><span data-stu-id="c3b79-370">SQL Server running in a VM has its own built-in capabilities to back up your SQL Server database to Azure Blob storage or a file share.</span></span> <span data-ttu-id="c3b79-371">If the storage account is geo-redundant storage or read-access geo-redundant storage, you can access those backups in the storage account’s secondary datacenter in the event of a disaster, with the same restrictions as previously discussed.</span><span class="sxs-lookup"><span data-stu-id="c3b79-371">If the storage account is geo-redundant storage or read-access geo-redundant storage, you can access those backups in the storage account’s secondary datacenter in the event of a disaster, with the same restrictions as previously discussed.</span></span> <span data-ttu-id="c3b79-372">For more information, see [Back up and restore for SQL Server in Azure virtual machines](../articles/virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="c3b79-372">For more information, see [Back up and restore for SQL Server in Azure virtual machines](../articles/virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span></span> <span data-ttu-id="c3b79-373">In addition to back up and restore, [SQL Server AlwaysOn availability groups](../articles/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) can maintain secondary replicas of databases.</span><span class="sxs-lookup"><span data-stu-id="c3b79-373">In addition to back up and restore, [SQL Server AlwaysOn availability groups](../articles/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) can maintain secondary replicas of databases.</span></span> <span data-ttu-id="c3b79-374">This ability greatly reduces the disaster recovery time.</span><span class="sxs-lookup"><span data-stu-id="c3b79-374">This ability greatly reduces the disaster recovery time.</span></span>

## <a name="other-considerations"></a><span data-ttu-id="c3b79-375">Other considerations</span><span class="sxs-lookup"><span data-stu-id="c3b79-375">Other considerations</span></span>

<span data-ttu-id="c3b79-376">This article has discussed how to back up or take snapshots of your VMs and their disks to support disaster recovery and how to use those backups or snapshots to recover your data.</span><span class="sxs-lookup"><span data-stu-id="c3b79-376">This article has discussed how to back up or take snapshots of your VMs and their disks to support disaster recovery and how to use those backups or snapshots to recover your data.</span></span> <span data-ttu-id="c3b79-377">With the Azure Resource Manager model, many people use templates to create their VMs and other infrastructures in Azure.</span><span class="sxs-lookup"><span data-stu-id="c3b79-377">With the Azure Resource Manager model, many people use templates to create their VMs and other infrastructures in Azure.</span></span> <span data-ttu-id="c3b79-378">You can use a template to create a VM that has the same configuration every time.</span><span class="sxs-lookup"><span data-stu-id="c3b79-378">You can use a template to create a VM that has the same configuration every time.</span></span> <span data-ttu-id="c3b79-379">If you use custom images for creating your VMs, you must also make sure that your images are protected by using a read-access geo-redundant storage account to store them.</span><span class="sxs-lookup"><span data-stu-id="c3b79-379">If you use custom images for creating your VMs, you must also make sure that your images are protected by using a read-access geo-redundant storage account to store them.</span></span>

<span data-ttu-id="c3b79-380">Consequently, your backup process can be a combination of two things:</span><span class="sxs-lookup"><span data-stu-id="c3b79-380">Consequently, your backup process can be a combination of two things:</span></span>

- <span data-ttu-id="c3b79-381">Back up the data (disks).</span><span class="sxs-lookup"><span data-stu-id="c3b79-381">Back up the data (disks).</span></span>
- <span data-ttu-id="c3b79-382">Back up the configuration (templates and custom images).</span><span class="sxs-lookup"><span data-stu-id="c3b79-382">Back up the configuration (templates and custom images).</span></span>

<span data-ttu-id="c3b79-383">Depending on the backup option you choose, you might have to handle the backup of both the data and the configuration, or the backup service might handle all of that for you.</span><span class="sxs-lookup"><span data-stu-id="c3b79-383">Depending on the backup option you choose, you might have to handle the backup of both the data and the configuration, or the backup service might handle all of that for you.</span></span>

## <a name="appendix-understanding-the-impact-of-data-redundancy"></a><span data-ttu-id="c3b79-384">Appendix: Understanding the impact of data redundancy</span><span class="sxs-lookup"><span data-stu-id="c3b79-384">Appendix: Understanding the impact of data redundancy</span></span>

<span data-ttu-id="c3b79-385">For storage accounts in Azure, there are three types of data redundancy that you should consider regarding disaster recovery: locally redundant, geo-redundant, or geo-redundant with read access.</span><span class="sxs-lookup"><span data-stu-id="c3b79-385">For storage accounts in Azure, there are three types of data redundancy that you should consider regarding disaster recovery: locally redundant, geo-redundant, or geo-redundant with read access.</span></span> 

<span data-ttu-id="c3b79-386">Locally redundant storage retains three copies of the data in the same datacenter.</span><span class="sxs-lookup"><span data-stu-id="c3b79-386">Locally redundant storage retains three copies of the data in the same datacenter.</span></span> <span data-ttu-id="c3b79-387">When the VM writes the data, all three copies are updated before success is returned to the caller, so you know they are identical.</span><span class="sxs-lookup"><span data-stu-id="c3b79-387">When the VM writes the data, all three copies are updated before success is returned to the caller, so you know they are identical.</span></span> <span data-ttu-id="c3b79-388">Your disk is protected from local failures, because it's unlikely that all three copies are affected at the same time.</span><span class="sxs-lookup"><span data-stu-id="c3b79-388">Your disk is protected from local failures, because it's unlikely that all three copies are affected at the same time.</span></span> <span data-ttu-id="c3b79-389">In the case of locally redundant storage, there is no geo-redundancy, so the disk is not protected from catastrophic failures that can affect an entire datacenter or storage unit.</span><span class="sxs-lookup"><span data-stu-id="c3b79-389">In the case of locally redundant storage, there is no geo-redundancy, so the disk is not protected from catastrophic failures that can affect an entire datacenter or storage unit.</span></span>

<span data-ttu-id="c3b79-390">With geo-redundant storage and read-access geo-redundant storage, three copies of your data are retained in the primary region that is selected by you.</span><span class="sxs-lookup"><span data-stu-id="c3b79-390">With geo-redundant storage and read-access geo-redundant storage, three copies of your data are retained in the primary region that is selected by you.</span></span> <span data-ttu-id="c3b79-391">Three more copies of your data are retained in a corresponding secondary region that is set by Azure.</span><span class="sxs-lookup"><span data-stu-id="c3b79-391">Three more copies of your data are retained in a corresponding secondary region that is set by Azure.</span></span> <span data-ttu-id="c3b79-392">For example, if you store data in West US, the data is replicated to East US.</span><span class="sxs-lookup"><span data-stu-id="c3b79-392">For example, if you store data in West US, the data is replicated to East US.</span></span> <span data-ttu-id="c3b79-393">Copy retention is done asynchronously, and there is a small delay between updates to the primary and secondary sites.</span><span class="sxs-lookup"><span data-stu-id="c3b79-393">Copy retention is done asynchronously, and there is a small delay between updates to the primary and secondary sites.</span></span> <span data-ttu-id="c3b79-394">Replicas of the disks on the secondary site are consistent on a per-disk basis (with the delay), but replicas of multiple active disks might not be in sync with each other.</span><span class="sxs-lookup"><span data-stu-id="c3b79-394">Replicas of the disks on the secondary site are consistent on a per-disk basis (with the delay), but replicas of multiple active disks might not be in sync with each other.</span></span> <span data-ttu-id="c3b79-395">To have consistent replicas across multiple disks, consistent snapshots are needed.</span><span class="sxs-lookup"><span data-stu-id="c3b79-395">To have consistent replicas across multiple disks, consistent snapshots are needed.</span></span>

<span data-ttu-id="c3b79-396">The main difference between geo-redundant storage and read-access geo-redundant storage is that with read-access geo-redundant storage, you can read the secondary copy at any time.</span><span class="sxs-lookup"><span data-stu-id="c3b79-396">The main difference between geo-redundant storage and read-access geo-redundant storage is that with read-access geo-redundant storage, you can read the secondary copy at any time.</span></span> <span data-ttu-id="c3b79-397">If there is a problem that renders the data in the primary region inaccessible, the Azure team makes every effort to restore access.</span><span class="sxs-lookup"><span data-stu-id="c3b79-397">If there is a problem that renders the data in the primary region inaccessible, the Azure team makes every effort to restore access.</span></span> <span data-ttu-id="c3b79-398">While the primary is down, if you have read-access geo-redundant storage enabled, you can access the data in the secondary datacenter.</span><span class="sxs-lookup"><span data-stu-id="c3b79-398">While the primary is down, if you have read-access geo-redundant storage enabled, you can access the data in the secondary datacenter.</span></span> <span data-ttu-id="c3b79-399">Therefore, if you plan to read from the replica while the primary is inaccessible, then read-access geo-redundant storage should be considered.</span><span class="sxs-lookup"><span data-stu-id="c3b79-399">Therefore, if you plan to read from the replica while the primary is inaccessible, then read-access geo-redundant storage should be considered.</span></span>

<span data-ttu-id="c3b79-400">If it turns out to be a significant outage, the Azure team might trigger a geo-failover and change the primary DNS entries to point to secondary storage.</span><span class="sxs-lookup"><span data-stu-id="c3b79-400">If it turns out to be a significant outage, the Azure team might trigger a geo-failover and change the primary DNS entries to point to secondary storage.</span></span> <span data-ttu-id="c3b79-401">At this point, if you have either geo-redundant storage or read-access geo-redundant storage enabled, you can access the data in the region that used to be the secondary.</span><span class="sxs-lookup"><span data-stu-id="c3b79-401">At this point, if you have either geo-redundant storage or read-access geo-redundant storage enabled, you can access the data in the region that used to be the secondary.</span></span> <span data-ttu-id="c3b79-402">In other words, if your storage account is geo-redundant storage and there is a problem, you can access the secondary storage only if there is a geo-failover.</span><span class="sxs-lookup"><span data-stu-id="c3b79-402">In other words, if your storage account is geo-redundant storage and there is a problem, you can access the secondary storage only if there is a geo-failover.</span></span>

<span data-ttu-id="c3b79-403">For more information, see [What to do if an Azure Storage outage occurs](../articles/storage/common/storage-disaster-recovery-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="c3b79-403">For more information, see [What to do if an Azure Storage outage occurs](../articles/storage/common/storage-disaster-recovery-guidance.md).</span></span> 

>[!NOTE] 
><span data-ttu-id="c3b79-404">Microsoft controls whether a failover occurs.</span><span class="sxs-lookup"><span data-stu-id="c3b79-404">Microsoft controls whether a failover occurs.</span></span> <span data-ttu-id="c3b79-405">Failover is not controlled per storage account, so it's not decided by individual customers.</span><span class="sxs-lookup"><span data-stu-id="c3b79-405">Failover is not controlled per storage account, so it's not decided by individual customers.</span></span> <span data-ttu-id="c3b79-406">To implement disaster recovery for specific storage accounts or virtual machine disks, you must use the techniques described previously in this article.</span><span class="sxs-lookup"><span data-stu-id="c3b79-406">To implement disaster recovery for specific storage accounts or virtual machine disks, you must use the techniques described previously in this article.</span></span>



[1]: ./media/virtual-machines-common-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-1.png
[2]: ./media/virtual-machines-common-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-2.png
