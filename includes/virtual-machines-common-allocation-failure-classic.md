---
title: include file
description: include file
services: virtual-machines-windows, azure-resource-manager
author: genlin
ms.service: virtual-machines-windows
ms.topic: include
ms.date: 04/14/2018
ms.author: genli
ms.custom: include file
ms.openlocfilehash: f403e060859df6d1de96a3c0d478d57df2677eee
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44856049"
---
<span data-ttu-id="da5ca-103">The following are common allocation scenarios that cause an allocation request to be pinned.</span><span class="sxs-lookup"><span data-stu-id="da5ca-103">The following are common allocation scenarios that cause an allocation request to be pinned.</span></span> <span data-ttu-id="da5ca-104">We'll dive into each scenario later in this article.</span><span class="sxs-lookup"><span data-stu-id="da5ca-104">We'll dive into each scenario later in this article.</span></span>

- <span data-ttu-id="da5ca-105">Resize a VM or add VMs or role instances to an existing cloud service</span><span class="sxs-lookup"><span data-stu-id="da5ca-105">Resize a VM or add VMs or role instances to an existing cloud service</span></span>
- <span data-ttu-id="da5ca-106">Restart partially stopped (deallocated) VMs</span><span class="sxs-lookup"><span data-stu-id="da5ca-106">Restart partially stopped (deallocated) VMs</span></span>
- <span data-ttu-id="da5ca-107">Restart fully stopped (deallocated) VMs</span><span class="sxs-lookup"><span data-stu-id="da5ca-107">Restart fully stopped (deallocated) VMs</span></span>
- <span data-ttu-id="da5ca-108">Staging and production deployments (platform as a service only)</span><span class="sxs-lookup"><span data-stu-id="da5ca-108">Staging and production deployments (platform as a service only)</span></span>
- <span data-ttu-id="da5ca-109">Affinity group (VM or service proximity)</span><span class="sxs-lookup"><span data-stu-id="da5ca-109">Affinity group (VM or service proximity)</span></span>
- <span data-ttu-id="da5ca-110">Affinity–group-based virtual network</span><span class="sxs-lookup"><span data-stu-id="da5ca-110">Affinity–group-based virtual network</span></span>

<span data-ttu-id="da5ca-111">When you receive an allocation error, check whether any of the listed scenarios apply to your error.</span><span class="sxs-lookup"><span data-stu-id="da5ca-111">When you receive an allocation error, check whether any of the listed scenarios apply to your error.</span></span> <span data-ttu-id="da5ca-112">Use the allocation error that’s returned by the Azure platform to identify the corresponding scenario.</span><span class="sxs-lookup"><span data-stu-id="da5ca-112">Use the allocation error that’s returned by the Azure platform to identify the corresponding scenario.</span></span> <span data-ttu-id="da5ca-113">If your request is pinned, remove some of the pinning constraints to open your request to more clusters, thereby increasing the chance of allocation success.</span><span class="sxs-lookup"><span data-stu-id="da5ca-113">If your request is pinned, remove some of the pinning constraints to open your request to more clusters, thereby increasing the chance of allocation success.</span></span>
<span data-ttu-id="da5ca-114">In general, if the error does not state that "the requested VM size is not supported," you can always retry at a later time.</span><span class="sxs-lookup"><span data-stu-id="da5ca-114">In general, if the error does not state that "the requested VM size is not supported," you can always retry at a later time.</span></span> <span data-ttu-id="da5ca-115">This is because enough resources may have been freed in the cluster to accommodate your request.</span><span class="sxs-lookup"><span data-stu-id="da5ca-115">This is because enough resources may have been freed in the cluster to accommodate your request.</span></span> <span data-ttu-id="da5ca-116">If the problem is that the requested VM size is not supported, try a different VM size.</span><span class="sxs-lookup"><span data-stu-id="da5ca-116">If the problem is that the requested VM size is not supported, try a different VM size.</span></span> <span data-ttu-id="da5ca-117">Otherwise, the only option is to remove the pinning constraint.</span><span class="sxs-lookup"><span data-stu-id="da5ca-117">Otherwise, the only option is to remove the pinning constraint.</span></span>

<span data-ttu-id="da5ca-118">Two common failure scenarios are related to affinity groups.</span><span class="sxs-lookup"><span data-stu-id="da5ca-118">Two common failure scenarios are related to affinity groups.</span></span> <span data-ttu-id="da5ca-119">In the past, an affinity group was used to provide close proximity to VMs and service instances, or it was used to enable the creation of a virtual network.</span><span class="sxs-lookup"><span data-stu-id="da5ca-119">In the past, an affinity group was used to provide close proximity to VMs and service instances, or it was used to enable the creation of a virtual network.</span></span> <span data-ttu-id="da5ca-120">With the introduction of regional virtual networks, affinity groups are no longer required to create a virtual network.</span><span class="sxs-lookup"><span data-stu-id="da5ca-120">With the introduction of regional virtual networks, affinity groups are no longer required to create a virtual network.</span></span> <span data-ttu-id="da5ca-121">With the reduction of network latency in Azure infrastructure, the recommendation to use affinity groups for VMs or service proximity has changed.</span><span class="sxs-lookup"><span data-stu-id="da5ca-121">With the reduction of network latency in Azure infrastructure, the recommendation to use affinity groups for VMs or service proximity has changed.</span></span>

<span data-ttu-id="da5ca-122">The following Diagram presents the taxonomy of the (pinned) allocation scenarios.</span><span class="sxs-lookup"><span data-stu-id="da5ca-122">The following Diagram presents the taxonomy of the (pinned) allocation scenarios.</span></span> 

![Pinned Allocation Taxonomy](./media/virtual-machines-common-allocation-failure/Allocation3.png)

## <a name="resize-a-vm-or-add-vms-or-role-instances-to-an-existing-cloud-service"></a><span data-ttu-id="da5ca-124">Resize a VM or add VMs or role instances to an existing cloud service</span><span class="sxs-lookup"><span data-stu-id="da5ca-124">Resize a VM or add VMs or role instances to an existing cloud service</span></span>
<span data-ttu-id="da5ca-125">**Error**</span><span class="sxs-lookup"><span data-stu-id="da5ca-125">**Error**</span></span>

<span data-ttu-id="da5ca-126">Upgrade_VMSizeNotSupported or GeneralError</span><span class="sxs-lookup"><span data-stu-id="da5ca-126">Upgrade_VMSizeNotSupported or GeneralError</span></span>

<span data-ttu-id="da5ca-127">**Cause of cluster pinning**</span><span class="sxs-lookup"><span data-stu-id="da5ca-127">**Cause of cluster pinning**</span></span>

<span data-ttu-id="da5ca-128">A request to resize a VM or add a VM or a role instance to an existing cloud service has to be attempted at the original cluster that hosts the existing cloud service.</span><span class="sxs-lookup"><span data-stu-id="da5ca-128">A request to resize a VM or add a VM or a role instance to an existing cloud service has to be attempted at the original cluster that hosts the existing cloud service.</span></span> <span data-ttu-id="da5ca-129">Creating a new cloud service allows the Azure platform to find another cluster that has free resources or supports the VM size that you requested.</span><span class="sxs-lookup"><span data-stu-id="da5ca-129">Creating a new cloud service allows the Azure platform to find another cluster that has free resources or supports the VM size that you requested.</span></span>

<span data-ttu-id="da5ca-130">**Workaround**</span><span class="sxs-lookup"><span data-stu-id="da5ca-130">**Workaround**</span></span>

<span data-ttu-id="da5ca-131">If the error is Upgrade_VMSizeNotSupported\*, try a different VM size.</span><span class="sxs-lookup"><span data-stu-id="da5ca-131">If the error is Upgrade_VMSizeNotSupported\*, try a different VM size.</span></span> <span data-ttu-id="da5ca-132">If using a different VM size is not an option, but if it's acceptable to use a different virtual IP address (VIP), create a new cloud service to host the new VM and add the new cloud service to the regional virtual network where the existing VMs are running.</span><span class="sxs-lookup"><span data-stu-id="da5ca-132">If using a different VM size is not an option, but if it's acceptable to use a different virtual IP address (VIP), create a new cloud service to host the new VM and add the new cloud service to the regional virtual network where the existing VMs are running.</span></span> <span data-ttu-id="da5ca-133">If your existing cloud service does not use a regional virtual network, you can still create a new virtual network for the new cloud service, and then connect your [existing virtual network to the new virtual network](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/).</span><span class="sxs-lookup"><span data-stu-id="da5ca-133">If your existing cloud service does not use a regional virtual network, you can still create a new virtual network for the new cloud service, and then connect your [existing virtual network to the new virtual network](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/).</span></span> <span data-ttu-id="da5ca-134">See more about [regional virtual networks](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).</span><span class="sxs-lookup"><span data-stu-id="da5ca-134">See more about [regional virtual networks](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).</span></span>

<span data-ttu-id="da5ca-135">If the error is GeneralError\*, it's likely that the type of resource (such as a particular VM size) is supported by the cluster, but the cluster does not have free resources at the moment.</span><span class="sxs-lookup"><span data-stu-id="da5ca-135">If the error is GeneralError\*, it's likely that the type of resource (such as a particular VM size) is supported by the cluster, but the cluster does not have free resources at the moment.</span></span> <span data-ttu-id="da5ca-136">Similar to the above scenario, add the desired compute resource through creating a new cloud service (note that the new cloud service has to use a different VIP) and use a regional virtual network to connect your cloud services.</span><span class="sxs-lookup"><span data-stu-id="da5ca-136">Similar to the above scenario, add the desired compute resource through creating a new cloud service (note that the new cloud service has to use a different VIP) and use a regional virtual network to connect your cloud services.</span></span>

## <a name="restart-partially-stopped-deallocated-vms"></a><span data-ttu-id="da5ca-137">Restart partially stopped (deallocated) VMs</span><span class="sxs-lookup"><span data-stu-id="da5ca-137">Restart partially stopped (deallocated) VMs</span></span>
<span data-ttu-id="da5ca-138">**Error**</span><span class="sxs-lookup"><span data-stu-id="da5ca-138">**Error**</span></span>

<span data-ttu-id="da5ca-139">GeneralError\*</span><span class="sxs-lookup"><span data-stu-id="da5ca-139">GeneralError\*</span></span>

<span data-ttu-id="da5ca-140">**Cause of cluster pinning**</span><span class="sxs-lookup"><span data-stu-id="da5ca-140">**Cause of cluster pinning**</span></span>

<span data-ttu-id="da5ca-141">Partial deallocation means that you stopped (deallocated) one or more, but not all, VMs in a cloud service.</span><span class="sxs-lookup"><span data-stu-id="da5ca-141">Partial deallocation means that you stopped (deallocated) one or more, but not all, VMs in a cloud service.</span></span> <span data-ttu-id="da5ca-142">When you stop (deallocate) a VM, the associated resources are released.</span><span class="sxs-lookup"><span data-stu-id="da5ca-142">When you stop (deallocate) a VM, the associated resources are released.</span></span> <span data-ttu-id="da5ca-143">Restarting that stopped (deallocated) VM is therefore a new allocation request.</span><span class="sxs-lookup"><span data-stu-id="da5ca-143">Restarting that stopped (deallocated) VM is therefore a new allocation request.</span></span> <span data-ttu-id="da5ca-144">Restarting VMs in a partially deallocated cloud service is equivalent to adding VMs to an existing cloud service.</span><span class="sxs-lookup"><span data-stu-id="da5ca-144">Restarting VMs in a partially deallocated cloud service is equivalent to adding VMs to an existing cloud service.</span></span> <span data-ttu-id="da5ca-145">The allocation request has to be attempted at the original cluster that hosts the existing cloud service.</span><span class="sxs-lookup"><span data-stu-id="da5ca-145">The allocation request has to be attempted at the original cluster that hosts the existing cloud service.</span></span> <span data-ttu-id="da5ca-146">Creating a different cloud service allows the Azure platform to find another cluster that has free resource or supports the VM size that you requested.</span><span class="sxs-lookup"><span data-stu-id="da5ca-146">Creating a different cloud service allows the Azure platform to find another cluster that has free resource or supports the VM size that you requested.</span></span>

<span data-ttu-id="da5ca-147">**Workaround**</span><span class="sxs-lookup"><span data-stu-id="da5ca-147">**Workaround**</span></span>

<span data-ttu-id="da5ca-148">If it's acceptable to use a different VIP, delete the stopped (deallocated) VMs (but keep the associated disks) and add the VMs back through a different cloud service.</span><span class="sxs-lookup"><span data-stu-id="da5ca-148">If it's acceptable to use a different VIP, delete the stopped (deallocated) VMs (but keep the associated disks) and add the VMs back through a different cloud service.</span></span> <span data-ttu-id="da5ca-149">Use a regional virtual network to connect your cloud services:</span><span class="sxs-lookup"><span data-stu-id="da5ca-149">Use a regional virtual network to connect your cloud services:</span></span>

* <span data-ttu-id="da5ca-150">If your existing cloud service uses a regional virtual network, simply add the new cloud service to the same virtual network.</span><span class="sxs-lookup"><span data-stu-id="da5ca-150">If your existing cloud service uses a regional virtual network, simply add the new cloud service to the same virtual network.</span></span>
* <span data-ttu-id="da5ca-151">If your existing cloud service does not use a regional virtual network, create a new virtual network for the new cloud service, and then [connect your existing virtual network to the new virtual network](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/).</span><span class="sxs-lookup"><span data-stu-id="da5ca-151">If your existing cloud service does not use a regional virtual network, create a new virtual network for the new cloud service, and then [connect your existing virtual network to the new virtual network](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/).</span></span> <span data-ttu-id="da5ca-152">See more about [regional virtual networks](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).</span><span class="sxs-lookup"><span data-stu-id="da5ca-152">See more about [regional virtual networks](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).</span></span>

## <a name="restart-fully-stopped-deallocated-vms"></a><span data-ttu-id="da5ca-153">Restart fully stopped (deallocated) VMs</span><span class="sxs-lookup"><span data-stu-id="da5ca-153">Restart fully stopped (deallocated) VMs</span></span>
<span data-ttu-id="da5ca-154">**Error**</span><span class="sxs-lookup"><span data-stu-id="da5ca-154">**Error**</span></span>

<span data-ttu-id="da5ca-155">GeneralError\*</span><span class="sxs-lookup"><span data-stu-id="da5ca-155">GeneralError\*</span></span>

<span data-ttu-id="da5ca-156">**Cause of cluster pinning**</span><span class="sxs-lookup"><span data-stu-id="da5ca-156">**Cause of cluster pinning**</span></span>

<span data-ttu-id="da5ca-157">Full deallocation means that you stopped (deallocated) all VMs from a cloud service.</span><span class="sxs-lookup"><span data-stu-id="da5ca-157">Full deallocation means that you stopped (deallocated) all VMs from a cloud service.</span></span> <span data-ttu-id="da5ca-158">The allocation requests to restart these VMs have to be attempted at the original cluster that hosts the cloud service.</span><span class="sxs-lookup"><span data-stu-id="da5ca-158">The allocation requests to restart these VMs have to be attempted at the original cluster that hosts the cloud service.</span></span> <span data-ttu-id="da5ca-159">Creating a new cloud service allows the Azure platform to find another cluster that has free resources or supports the VM size that you requested.</span><span class="sxs-lookup"><span data-stu-id="da5ca-159">Creating a new cloud service allows the Azure platform to find another cluster that has free resources or supports the VM size that you requested.</span></span>

<span data-ttu-id="da5ca-160">**Workaround**</span><span class="sxs-lookup"><span data-stu-id="da5ca-160">**Workaround**</span></span>

<span data-ttu-id="da5ca-161">If it's acceptable to use a different VIP, delete the original stopped (deallocated) VMs (but keep the associated disks) and delete the corresponding cloud service (the associated compute resources were already released when you stopped (deallocated) the VMs).</span><span class="sxs-lookup"><span data-stu-id="da5ca-161">If it's acceptable to use a different VIP, delete the original stopped (deallocated) VMs (but keep the associated disks) and delete the corresponding cloud service (the associated compute resources were already released when you stopped (deallocated) the VMs).</span></span> <span data-ttu-id="da5ca-162">Create a new cloud service to add the VMs back.</span><span class="sxs-lookup"><span data-stu-id="da5ca-162">Create a new cloud service to add the VMs back.</span></span>

## <a name="stagingproduction-deployments-platform-as-a-service-only"></a><span data-ttu-id="da5ca-163">Staging/production deployments (platform as a service only)</span><span class="sxs-lookup"><span data-stu-id="da5ca-163">Staging/production deployments (platform as a service only)</span></span>
<span data-ttu-id="da5ca-164">**Error**</span><span class="sxs-lookup"><span data-stu-id="da5ca-164">**Error**</span></span>

<span data-ttu-id="da5ca-165">New_General\* or New_VMSizeNotSupported\*</span><span class="sxs-lookup"><span data-stu-id="da5ca-165">New_General\* or New_VMSizeNotSupported\*</span></span>

<span data-ttu-id="da5ca-166">**Cause of cluster pinning**</span><span class="sxs-lookup"><span data-stu-id="da5ca-166">**Cause of cluster pinning**</span></span>

<span data-ttu-id="da5ca-167">The staging deployment and the production deployment of a cloud service are hosted in the same cluster.</span><span class="sxs-lookup"><span data-stu-id="da5ca-167">The staging deployment and the production deployment of a cloud service are hosted in the same cluster.</span></span> <span data-ttu-id="da5ca-168">When you add the second deployment, the corresponding allocation request will be attempted in the same cluster that hosts the first deployment.</span><span class="sxs-lookup"><span data-stu-id="da5ca-168">When you add the second deployment, the corresponding allocation request will be attempted in the same cluster that hosts the first deployment.</span></span>

<span data-ttu-id="da5ca-169">**Workaround**</span><span class="sxs-lookup"><span data-stu-id="da5ca-169">**Workaround**</span></span>

<span data-ttu-id="da5ca-170">Delete the first deployment and the original cloud service and redeploy the cloud service.</span><span class="sxs-lookup"><span data-stu-id="da5ca-170">Delete the first deployment and the original cloud service and redeploy the cloud service.</span></span> <span data-ttu-id="da5ca-171">This action may land the first deployment in a cluster that has enough free resources to fit both deployments or in a cluster that supports the VM sizes that you requested.</span><span class="sxs-lookup"><span data-stu-id="da5ca-171">This action may land the first deployment in a cluster that has enough free resources to fit both deployments or in a cluster that supports the VM sizes that you requested.</span></span>

## <a name="affinity-group-vmservice-proximity"></a><span data-ttu-id="da5ca-172">Affinity group (VM/service proximity)</span><span class="sxs-lookup"><span data-stu-id="da5ca-172">Affinity group (VM/service proximity)</span></span>
<span data-ttu-id="da5ca-173">**Error**</span><span class="sxs-lookup"><span data-stu-id="da5ca-173">**Error**</span></span>

<span data-ttu-id="da5ca-174">New_General\* or New_VMSizeNotSupported\*</span><span class="sxs-lookup"><span data-stu-id="da5ca-174">New_General\* or New_VMSizeNotSupported\*</span></span>

<span data-ttu-id="da5ca-175">**Cause of cluster pinning**</span><span class="sxs-lookup"><span data-stu-id="da5ca-175">**Cause of cluster pinning**</span></span>

<span data-ttu-id="da5ca-176">Any compute resource assigned to an affinity group is tied to one cluster.</span><span class="sxs-lookup"><span data-stu-id="da5ca-176">Any compute resource assigned to an affinity group is tied to one cluster.</span></span> <span data-ttu-id="da5ca-177">New compute resource requests in that affinity group are attempted in the same cluster where the existing resources are hosted.</span><span class="sxs-lookup"><span data-stu-id="da5ca-177">New compute resource requests in that affinity group are attempted in the same cluster where the existing resources are hosted.</span></span> <span data-ttu-id="da5ca-178">This is true whether the new resources are created through a new cloud service or through an existing cloud service.</span><span class="sxs-lookup"><span data-stu-id="da5ca-178">This is true whether the new resources are created through a new cloud service or through an existing cloud service.</span></span>

<span data-ttu-id="da5ca-179">**Workaround**</span><span class="sxs-lookup"><span data-stu-id="da5ca-179">**Workaround**</span></span>

<span data-ttu-id="da5ca-180">If an affinity group is not necessary, do not use an affinity group, or group your compute resources into multiple affinity groups.</span><span class="sxs-lookup"><span data-stu-id="da5ca-180">If an affinity group is not necessary, do not use an affinity group, or group your compute resources into multiple affinity groups.</span></span>

## <a name="affinity-group-based-virtual-network"></a><span data-ttu-id="da5ca-181">Affinity-group-based virtual network</span><span class="sxs-lookup"><span data-stu-id="da5ca-181">Affinity-group-based virtual network</span></span>
<span data-ttu-id="da5ca-182">**Error**</span><span class="sxs-lookup"><span data-stu-id="da5ca-182">**Error**</span></span>

<span data-ttu-id="da5ca-183">New_General\* or New_VMSizeNotSupported\*</span><span class="sxs-lookup"><span data-stu-id="da5ca-183">New_General\* or New_VMSizeNotSupported\*</span></span>

<span data-ttu-id="da5ca-184">**Cause of cluster pinning**</span><span class="sxs-lookup"><span data-stu-id="da5ca-184">**Cause of cluster pinning**</span></span>

<span data-ttu-id="da5ca-185">Before regional virtual networks were introduced, you were required to associate a virtual network with an affinity group.</span><span class="sxs-lookup"><span data-stu-id="da5ca-185">Before regional virtual networks were introduced, you were required to associate a virtual network with an affinity group.</span></span> <span data-ttu-id="da5ca-186">As a result, compute resources placed into an affinity group are bound by the same constraints as described in the "Allocation scenario: Affinity group (VM/service proximity)" section above.</span><span class="sxs-lookup"><span data-stu-id="da5ca-186">As a result, compute resources placed into an affinity group are bound by the same constraints as described in the "Allocation scenario: Affinity group (VM/service proximity)" section above.</span></span> <span data-ttu-id="da5ca-187">The compute resources are tied to one cluster.</span><span class="sxs-lookup"><span data-stu-id="da5ca-187">The compute resources are tied to one cluster.</span></span>

<span data-ttu-id="da5ca-188">**Workaround**</span><span class="sxs-lookup"><span data-stu-id="da5ca-188">**Workaround**</span></span>

<span data-ttu-id="da5ca-189">If you do not need an affinity group, create a new regional virtual network for the new resources you're adding, and then [connect your existing virtual network to the new virtual network](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/).</span><span class="sxs-lookup"><span data-stu-id="da5ca-189">If you do not need an affinity group, create a new regional virtual network for the new resources you're adding, and then [connect your existing virtual network to the new virtual network](https://azure.microsoft.com/blog/vnet-to-vnet-connecting-virtual-networks-in-azure-across-different-regions/).</span></span> <span data-ttu-id="da5ca-190">See more about [regional virtual networks](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).</span><span class="sxs-lookup"><span data-stu-id="da5ca-190">See more about [regional virtual networks](https://azure.microsoft.com/blog/2014/05/14/regional-virtual-networks/).</span></span>

<span data-ttu-id="da5ca-191">Alternatively, you can [migrate your affinity-group-based virtual network to a regional virtual network](https://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/), and then add the desired resources again.</span><span class="sxs-lookup"><span data-stu-id="da5ca-191">Alternatively, you can [migrate your affinity-group-based virtual network to a regional virtual network](https://azure.microsoft.com/blog/2014/11/26/migrating-existing-services-to-regional-scope/), and then add the desired resources again.</span></span>
