# <a name="azure-premium-storage-design-for-high-performance"></a><span data-ttu-id="413a7-101">Azure Premium Storage: Design for High Performance</span><span class="sxs-lookup"><span data-stu-id="413a7-101">Azure Premium Storage: Design for High Performance</span></span>

<span data-ttu-id="413a7-102">This article provides guidelines for building high performance applications using Azure Premium Storage.</span><span class="sxs-lookup"><span data-stu-id="413a7-102">This article provides guidelines for building high performance applications using Azure Premium Storage.</span></span> <span data-ttu-id="413a7-103">You can use the instructions provided in this document combined with performance best practices applicable to technologies used by your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-103">You can use the instructions provided in this document combined with performance best practices applicable to technologies used by your application.</span></span> <span data-ttu-id="413a7-104">To illustrate the guidelines, we have used SQL Server running on Premium Storage as an example throughout this document.</span><span class="sxs-lookup"><span data-stu-id="413a7-104">To illustrate the guidelines, we have used SQL Server running on Premium Storage as an example throughout this document.</span></span>

<span data-ttu-id="413a7-105">While we address performance scenarios for the Storage layer in this article, you will need to optimize the application layer.</span><span class="sxs-lookup"><span data-stu-id="413a7-105">While we address performance scenarios for the Storage layer in this article, you will need to optimize the application layer.</span></span> <span data-ttu-id="413a7-106">For example, if you are hosting a SharePoint Farm on Azure Premium Storage, you can use the SQL Server examples from this article to optimize the database server.</span><span class="sxs-lookup"><span data-stu-id="413a7-106">For example, if you are hosting a SharePoint Farm on Azure Premium Storage, you can use the SQL Server examples from this article to optimize the database server.</span></span> <span data-ttu-id="413a7-107">Additionally, optimize the SharePoint Farm's Web server and Application server to get the most performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-107">Additionally, optimize the SharePoint Farm's Web server and Application server to get the most performance.</span></span>

<span data-ttu-id="413a7-108">This article will help answer following common questions about optimizing application performance on Azure Premium Storage,</span><span class="sxs-lookup"><span data-stu-id="413a7-108">This article will help answer following common questions about optimizing application performance on Azure Premium Storage,</span></span>

* <span data-ttu-id="413a7-109">How to measure your application performance?</span><span class="sxs-lookup"><span data-stu-id="413a7-109">How to measure your application performance?</span></span>  
* <span data-ttu-id="413a7-110">Why are you not seeing expected high performance?</span><span class="sxs-lookup"><span data-stu-id="413a7-110">Why are you not seeing expected high performance?</span></span>  
* <span data-ttu-id="413a7-111">Which factors influence your application performance on Premium Storage?</span><span class="sxs-lookup"><span data-stu-id="413a7-111">Which factors influence your application performance on Premium Storage?</span></span>  
* <span data-ttu-id="413a7-112">How do these factors influence performance of your application on Premium Storage?</span><span class="sxs-lookup"><span data-stu-id="413a7-112">How do these factors influence performance of your application on Premium Storage?</span></span>  
* <span data-ttu-id="413a7-113">How can you optimize for IOPS, Bandwidth and Latency?</span><span class="sxs-lookup"><span data-stu-id="413a7-113">How can you optimize for IOPS, Bandwidth and Latency?</span></span>  

<span data-ttu-id="413a7-114">We have provided these guidelines specifically for Premium Storage because workloads running on Premium Storage are highly performance sensitive.</span><span class="sxs-lookup"><span data-stu-id="413a7-114">We have provided these guidelines specifically for Premium Storage because workloads running on Premium Storage are highly performance sensitive.</span></span> <span data-ttu-id="413a7-115">We have provided examples where appropriate.</span><span class="sxs-lookup"><span data-stu-id="413a7-115">We have provided examples where appropriate.</span></span> <span data-ttu-id="413a7-116">You can also apply some of these guidelines to applications running on IaaS VMs with Standard Storage disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-116">You can also apply some of these guidelines to applications running on IaaS VMs with Standard Storage disks.</span></span>

<span data-ttu-id="413a7-117">Before you begin, if you are new to Premium Storage, first read the [Premium Storage: High-Performance Storage for Azure Virtual Machine Workloads](../articles/virtual-machines/windows/premium-storage.md) and [Azure Storage Scalability and Performance Targets](../articles/storage/common/storage-scalability-targets.md) articles.</span><span class="sxs-lookup"><span data-stu-id="413a7-117">Before you begin, if you are new to Premium Storage, first read the [Premium Storage: High-Performance Storage for Azure Virtual Machine Workloads](../articles/virtual-machines/windows/premium-storage.md) and [Azure Storage Scalability and Performance Targets](../articles/storage/common/storage-scalability-targets.md) articles.</span></span>

## <a name="application-performance-indicators"></a><span data-ttu-id="413a7-118">Application Performance Indicators</span><span class="sxs-lookup"><span data-stu-id="413a7-118">Application Performance Indicators</span></span>
<span data-ttu-id="413a7-119">We assess whether an application is performing well or not using performance indicators like, how fast an application is processing a user request, how much data an application is processing per request, how many requests is an application processing in a specific period of time, how long a user has to wait to get a response after submitting their request.</span><span class="sxs-lookup"><span data-stu-id="413a7-119">We assess whether an application is performing well or not using performance indicators like, how fast an application is processing a user request, how much data an application is processing per request, how many requests is an application processing in a specific period of time, how long a user has to wait to get a response after submitting their request.</span></span> <span data-ttu-id="413a7-120">The technical terms for these performance indicators are, IOPS, Throughput or Bandwidth, and Latency.</span><span class="sxs-lookup"><span data-stu-id="413a7-120">The technical terms for these performance indicators are, IOPS, Throughput or Bandwidth, and Latency.</span></span>

<span data-ttu-id="413a7-121">In this section, we will discuss the common performance indicators in the context of Premium Storage.</span><span class="sxs-lookup"><span data-stu-id="413a7-121">In this section, we will discuss the common performance indicators in the context of Premium Storage.</span></span> <span data-ttu-id="413a7-122">In the following section, Gathering Application Requirements, you will learn how to measure these performance indicators for your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-122">In the following section, Gathering Application Requirements, you will learn how to measure these performance indicators for your application.</span></span> <span data-ttu-id="413a7-123">Later in Optimizing Application Performance, you will learn about the factors affecting these performance indicators and recommendations to optimize them.</span><span class="sxs-lookup"><span data-stu-id="413a7-123">Later in Optimizing Application Performance, you will learn about the factors affecting these performance indicators and recommendations to optimize them.</span></span>

## <a name="iops"></a><span data-ttu-id="413a7-124">IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-124">IOPS</span></span>
<span data-ttu-id="413a7-125">IOPS is number of requests that your application is sending to the storage disks in one second.</span><span class="sxs-lookup"><span data-stu-id="413a7-125">IOPS is number of requests that your application is sending to the storage disks in one second.</span></span> <span data-ttu-id="413a7-126">An input/output operation could be read or write, sequential or random.</span><span class="sxs-lookup"><span data-stu-id="413a7-126">An input/output operation could be read or write, sequential or random.</span></span> <span data-ttu-id="413a7-127">OLTP applications like an online retail website need to process many concurrent user requests immediately.</span><span class="sxs-lookup"><span data-stu-id="413a7-127">OLTP applications like an online retail website need to process many concurrent user requests immediately.</span></span> <span data-ttu-id="413a7-128">The user requests are insert and update intensive database transactions, which the application must process quickly.</span><span class="sxs-lookup"><span data-stu-id="413a7-128">The user requests are insert and update intensive database transactions, which the application must process quickly.</span></span> <span data-ttu-id="413a7-129">Therefore, OLTP applications require very high IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-129">Therefore, OLTP applications require very high IOPS.</span></span> <span data-ttu-id="413a7-130">Such applications handle millions of small and random IO requests.</span><span class="sxs-lookup"><span data-stu-id="413a7-130">Such applications handle millions of small and random IO requests.</span></span> <span data-ttu-id="413a7-131">If you have such an application, you must design the application infrastructure to optimize for IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-131">If you have such an application, you must design the application infrastructure to optimize for IOPS.</span></span> <span data-ttu-id="413a7-132">In the later section, *Optimizing Application Performance*, we discuss in detail all the factors that you must consider to get high IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-132">In the later section, *Optimizing Application Performance*, we discuss in detail all the factors that you must consider to get high IOPS.</span></span>

<span data-ttu-id="413a7-133">When you attach a premium storage disk to your high scale VM, Azure provisions for you a guaranteed number of IOPS as per the disk specification.</span><span class="sxs-lookup"><span data-stu-id="413a7-133">When you attach a premium storage disk to your high scale VM, Azure provisions for you a guaranteed number of IOPS as per the disk specification.</span></span> <span data-ttu-id="413a7-134">For example, a P50 disk provisions 7500 IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-134">For example, a P50 disk provisions 7500 IOPS.</span></span> <span data-ttu-id="413a7-135">Each high scale VM size also has a specific IOPS limit that it can sustain.</span><span class="sxs-lookup"><span data-stu-id="413a7-135">Each high scale VM size also has a specific IOPS limit that it can sustain.</span></span> <span data-ttu-id="413a7-136">For example, a Standard GS5 VM has 80,000 IOPS limit.</span><span class="sxs-lookup"><span data-stu-id="413a7-136">For example, a Standard GS5 VM has 80,000 IOPS limit.</span></span>

## <a name="throughput"></a><span data-ttu-id="413a7-137">Throughput</span><span class="sxs-lookup"><span data-stu-id="413a7-137">Throughput</span></span>
<span data-ttu-id="413a7-138">Throughput or Bandwidth is the amount of data that your application is sending to the storage disks in a specified interval.</span><span class="sxs-lookup"><span data-stu-id="413a7-138">Throughput or Bandwidth is the amount of data that your application is sending to the storage disks in a specified interval.</span></span> <span data-ttu-id="413a7-139">If your application is performing input/output operations with large IO unit sizes, it requires high Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-139">If your application is performing input/output operations with large IO unit sizes, it requires high Throughput.</span></span> <span data-ttu-id="413a7-140">Data warehouse applications tend to issue scan intensive operations that access large portions of data at a time and commonly perform bulk operations.</span><span class="sxs-lookup"><span data-stu-id="413a7-140">Data warehouse applications tend to issue scan intensive operations that access large portions of data at a time and commonly perform bulk operations.</span></span> <span data-ttu-id="413a7-141">In other words, such applications require higher Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-141">In other words, such applications require higher Throughput.</span></span> <span data-ttu-id="413a7-142">If you have such an application, you must design its infrastructure to optimize for Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-142">If you have such an application, you must design its infrastructure to optimize for Throughput.</span></span> <span data-ttu-id="413a7-143">In the next section, we discuss in detail the factors you must tune to achieve this.</span><span class="sxs-lookup"><span data-stu-id="413a7-143">In the next section, we discuss in detail the factors you must tune to achieve this.</span></span>

<span data-ttu-id="413a7-144">When you attach a premium storage disk to a high scale VM, Azure provisions Throughput as per that disk specification.</span><span class="sxs-lookup"><span data-stu-id="413a7-144">When you attach a premium storage disk to a high scale VM, Azure provisions Throughput as per that disk specification.</span></span> <span data-ttu-id="413a7-145">For example, a P50 disk provisions 250 MB per second disk Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-145">For example, a P50 disk provisions 250 MB per second disk Throughput.</span></span> <span data-ttu-id="413a7-146">Each high scale VM size also has as specific Throughput limit that it can sustain.</span><span class="sxs-lookup"><span data-stu-id="413a7-146">Each high scale VM size also has as specific Throughput limit that it can sustain.</span></span> <span data-ttu-id="413a7-147">For example, Standard GS5 VM has a maximum throughput of 2,000 MB per second.</span><span class="sxs-lookup"><span data-stu-id="413a7-147">For example, Standard GS5 VM has a maximum throughput of 2,000 MB per second.</span></span> 

<span data-ttu-id="413a7-148">There is a relation between Throughput and IOPS as shown in the formula below.</span><span class="sxs-lookup"><span data-stu-id="413a7-148">There is a relation between Throughput and IOPS as shown in the formula below.</span></span>

![](media/premium-storage-performance/image1.png)

<span data-ttu-id="413a7-149">Therefore, it is important to determine the optimal Throughput and IOPS values that your application requires.</span><span class="sxs-lookup"><span data-stu-id="413a7-149">Therefore, it is important to determine the optimal Throughput and IOPS values that your application requires.</span></span> <span data-ttu-id="413a7-150">As you try to optimize one, the other also gets affected.</span><span class="sxs-lookup"><span data-stu-id="413a7-150">As you try to optimize one, the other also gets affected.</span></span> <span data-ttu-id="413a7-151">In a later section, *Optimizing Application Performance*, we will discuss in more details about optimizing IOPS and Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-151">In a later section, *Optimizing Application Performance*, we will discuss in more details about optimizing IOPS and Throughput.</span></span>

## <a name="latency"></a><span data-ttu-id="413a7-152">Latency</span><span class="sxs-lookup"><span data-stu-id="413a7-152">Latency</span></span>
<span data-ttu-id="413a7-153">Latency is the time it takes an application to receive a single request, send it to the storage disks and send the response to the client.</span><span class="sxs-lookup"><span data-stu-id="413a7-153">Latency is the time it takes an application to receive a single request, send it to the storage disks and send the response to the client.</span></span> <span data-ttu-id="413a7-154">This is a critical measure of an application's performance in addition to IOPS and Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-154">This is a critical measure of an application's performance in addition to IOPS and Throughput.</span></span> <span data-ttu-id="413a7-155">The Latency of a premium storage disk is the time it takes to retrieve the information for a request and communicate it back to your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-155">The Latency of a premium storage disk is the time it takes to retrieve the information for a request and communicate it back to your application.</span></span> <span data-ttu-id="413a7-156">Premium Storage provides consistent low latencies.</span><span class="sxs-lookup"><span data-stu-id="413a7-156">Premium Storage provides consistent low latencies.</span></span> <span data-ttu-id="413a7-157">If you enable ReadOnly host caching on premium storage disks, you can get much lower read latency.</span><span class="sxs-lookup"><span data-stu-id="413a7-157">If you enable ReadOnly host caching on premium storage disks, you can get much lower read latency.</span></span> <span data-ttu-id="413a7-158">We will discuss Disk Caching in more detail in later section on *Optimizing Application Performance*.</span><span class="sxs-lookup"><span data-stu-id="413a7-158">We will discuss Disk Caching in more detail in later section on *Optimizing Application Performance*.</span></span>

<span data-ttu-id="413a7-159">When you are optimizing your application to get higher IOPS and Throughput, it will affect the Latency of your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-159">When you are optimizing your application to get higher IOPS and Throughput, it will affect the Latency of your application.</span></span> <span data-ttu-id="413a7-160">After tuning the application performance, always evaluate the Latency of the application to avoid unexpected high latency behavior.</span><span class="sxs-lookup"><span data-stu-id="413a7-160">After tuning the application performance, always evaluate the Latency of the application to avoid unexpected high latency behavior.</span></span>

## <a name="gather-application-performance-requirements"></a><span data-ttu-id="413a7-161">Gather Application Performance Requirements</span><span class="sxs-lookup"><span data-stu-id="413a7-161">Gather Application Performance Requirements</span></span>
<span data-ttu-id="413a7-162">The first step in designing high performance applications running on Azure Premium Storage is, to understand the performance requirements of your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-162">The first step in designing high performance applications running on Azure Premium Storage is, to understand the performance requirements of your application.</span></span> <span data-ttu-id="413a7-163">After you gather performance requirements, you can optimize your application to achieve the most optimal performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-163">After you gather performance requirements, you can optimize your application to achieve the most optimal performance.</span></span>

<span data-ttu-id="413a7-164">In the previous section, we explained the common performance indicators, IOPS, Throughput and Latency.</span><span class="sxs-lookup"><span data-stu-id="413a7-164">In the previous section, we explained the common performance indicators, IOPS, Throughput and Latency.</span></span> <span data-ttu-id="413a7-165">You must identify which of these performance indicators are critical to your application to deliver the desired user experience.</span><span class="sxs-lookup"><span data-stu-id="413a7-165">You must identify which of these performance indicators are critical to your application to deliver the desired user experience.</span></span> <span data-ttu-id="413a7-166">For example, high IOPS matters most to OLTP applications processing millions of transactions in a second.</span><span class="sxs-lookup"><span data-stu-id="413a7-166">For example, high IOPS matters most to OLTP applications processing millions of transactions in a second.</span></span> <span data-ttu-id="413a7-167">Whereas, high Throughput is critical for Data Warehouse applications processing large amounts of data in a second.</span><span class="sxs-lookup"><span data-stu-id="413a7-167">Whereas, high Throughput is critical for Data Warehouse applications processing large amounts of data in a second.</span></span> <span data-ttu-id="413a7-168">Extremely low Latency is crucial for real-time applications like live video streaming websites.</span><span class="sxs-lookup"><span data-stu-id="413a7-168">Extremely low Latency is crucial for real-time applications like live video streaming websites.</span></span>

<span data-ttu-id="413a7-169">Next, measure the maximum performance requirements of your application throughout its lifetime.</span><span class="sxs-lookup"><span data-stu-id="413a7-169">Next, measure the maximum performance requirements of your application throughout its lifetime.</span></span> <span data-ttu-id="413a7-170">Use the sample checklist below as a start.</span><span class="sxs-lookup"><span data-stu-id="413a7-170">Use the sample checklist below as a start.</span></span> <span data-ttu-id="413a7-171">Record the maximum performance requirements during normal, peak and off-hours workload periods.</span><span class="sxs-lookup"><span data-stu-id="413a7-171">Record the maximum performance requirements during normal, peak and off-hours workload periods.</span></span> <span data-ttu-id="413a7-172">By identifying requirements for all workloads levels, you will be able to determine the overall performance requirement of your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-172">By identifying requirements for all workloads levels, you will be able to determine the overall performance requirement of your application.</span></span> <span data-ttu-id="413a7-173">For example, the normal workload of an e-commerce website will be the transactions it serves during most days in a year.</span><span class="sxs-lookup"><span data-stu-id="413a7-173">For example, the normal workload of an e-commerce website will be the transactions it serves during most days in a year.</span></span> <span data-ttu-id="413a7-174">The peak workload of the website will be the transactions it serves during holiday season or special sale events.</span><span class="sxs-lookup"><span data-stu-id="413a7-174">The peak workload of the website will be the transactions it serves during holiday season or special sale events.</span></span> <span data-ttu-id="413a7-175">The peak workload is typically experienced for a limited period, but can require your application to scale two or more times its normal operation.</span><span class="sxs-lookup"><span data-stu-id="413a7-175">The peak workload is typically experienced for a limited period, but can require your application to scale two or more times its normal operation.</span></span> <span data-ttu-id="413a7-176">Find out the 50 percentile, 90 percentile and 99 percentile requirements.</span><span class="sxs-lookup"><span data-stu-id="413a7-176">Find out the 50 percentile, 90 percentile and 99 percentile requirements.</span></span> <span data-ttu-id="413a7-177">This helps filter out any outliers in the performance requirements and you can focus your efforts on optimizing for the right values.</span><span class="sxs-lookup"><span data-stu-id="413a7-177">This helps filter out any outliers in the performance requirements and you can focus your efforts on optimizing for the right values.</span></span>

<span data-ttu-id="413a7-178">**Application Performance Requirements Checklist**</span><span class="sxs-lookup"><span data-stu-id="413a7-178">**Application Performance Requirements Checklist**</span></span>

| <span data-ttu-id="413a7-179">**Performance requirements**</span><span class="sxs-lookup"><span data-stu-id="413a7-179">**Performance requirements**</span></span> | <span data-ttu-id="413a7-180">**50 Percentile**</span><span class="sxs-lookup"><span data-stu-id="413a7-180">**50 Percentile**</span></span> | <span data-ttu-id="413a7-181">**90 Percentile**</span><span class="sxs-lookup"><span data-stu-id="413a7-181">**90 Percentile**</span></span> | <span data-ttu-id="413a7-182">**99  Percentile**</span><span class="sxs-lookup"><span data-stu-id="413a7-182">**99  Percentile**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="413a7-183">Max.</span><span class="sxs-lookup"><span data-stu-id="413a7-183">Max.</span></span> <span data-ttu-id="413a7-184">Transactions per second</span><span class="sxs-lookup"><span data-stu-id="413a7-184">Transactions per second</span></span> | | | |
| <span data-ttu-id="413a7-185">% Read operations</span><span class="sxs-lookup"><span data-stu-id="413a7-185">% Read operations</span></span> | | | |
| <span data-ttu-id="413a7-186">% Write operations</span><span class="sxs-lookup"><span data-stu-id="413a7-186">% Write operations</span></span> | | | |
| <span data-ttu-id="413a7-187">% Random operations</span><span class="sxs-lookup"><span data-stu-id="413a7-187">% Random operations</span></span> | | | |
| <span data-ttu-id="413a7-188">% Sequential operations</span><span class="sxs-lookup"><span data-stu-id="413a7-188">% Sequential operations</span></span> | | | |
| <span data-ttu-id="413a7-189">IO request size</span><span class="sxs-lookup"><span data-stu-id="413a7-189">IO request size</span></span> | | | |
| <span data-ttu-id="413a7-190">Average Throughput</span><span class="sxs-lookup"><span data-stu-id="413a7-190">Average Throughput</span></span> | | | |
| <span data-ttu-id="413a7-191">Max.</span><span class="sxs-lookup"><span data-stu-id="413a7-191">Max.</span></span> <span data-ttu-id="413a7-192">Throughput</span><span class="sxs-lookup"><span data-stu-id="413a7-192">Throughput</span></span> | | | |
| <span data-ttu-id="413a7-193">Min.</span><span class="sxs-lookup"><span data-stu-id="413a7-193">Min.</span></span> <span data-ttu-id="413a7-194">Latency</span><span class="sxs-lookup"><span data-stu-id="413a7-194">Latency</span></span> | | | |
| <span data-ttu-id="413a7-195">Average Latency</span><span class="sxs-lookup"><span data-stu-id="413a7-195">Average Latency</span></span> | | | |
| <span data-ttu-id="413a7-196">Max.</span><span class="sxs-lookup"><span data-stu-id="413a7-196">Max.</span></span> <span data-ttu-id="413a7-197">CPU</span><span class="sxs-lookup"><span data-stu-id="413a7-197">CPU</span></span> | | | |
| <span data-ttu-id="413a7-198">Average CPU</span><span class="sxs-lookup"><span data-stu-id="413a7-198">Average CPU</span></span> | | | |
| <span data-ttu-id="413a7-199">Max.</span><span class="sxs-lookup"><span data-stu-id="413a7-199">Max.</span></span> <span data-ttu-id="413a7-200">Memory</span><span class="sxs-lookup"><span data-stu-id="413a7-200">Memory</span></span> | | | |
| <span data-ttu-id="413a7-201">Average Memory</span><span class="sxs-lookup"><span data-stu-id="413a7-201">Average Memory</span></span> | | | |
| <span data-ttu-id="413a7-202">Queue Depth</span><span class="sxs-lookup"><span data-stu-id="413a7-202">Queue Depth</span></span> | | | |

> [!NOTE]
> <span data-ttu-id="413a7-203">You should consider scaling these numbers based on expected future growth of your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-203">You should consider scaling these numbers based on expected future growth of your application.</span></span> <span data-ttu-id="413a7-204">It is a good idea to plan for growth ahead of time, because it could be harder to change the infrastructure for improving performance later.</span><span class="sxs-lookup"><span data-stu-id="413a7-204">It is a good idea to plan for growth ahead of time, because it could be harder to change the infrastructure for improving performance later.</span></span>
>
>

<span data-ttu-id="413a7-205">If you have an existing application and want to move to Premium Storage, first build the checklist above for the existing application.</span><span class="sxs-lookup"><span data-stu-id="413a7-205">If you have an existing application and want to move to Premium Storage, first build the checklist above for the existing application.</span></span> <span data-ttu-id="413a7-206">Then, build a prototype of your application on Premium Storage and design the application based on guidelines described in *Optimizing Application Performance* in a later section of this document.</span><span class="sxs-lookup"><span data-stu-id="413a7-206">Then, build a prototype of your application on Premium Storage and design the application based on guidelines described in *Optimizing Application Performance* in a later section of this document.</span></span> <span data-ttu-id="413a7-207">The next section describes the tools you can use to gather the performance measurements.</span><span class="sxs-lookup"><span data-stu-id="413a7-207">The next section describes the tools you can use to gather the performance measurements.</span></span>

<span data-ttu-id="413a7-208">Create a checklist similar to your existing application for the prototype.</span><span class="sxs-lookup"><span data-stu-id="413a7-208">Create a checklist similar to your existing application for the prototype.</span></span> <span data-ttu-id="413a7-209">Using Benchmarking tools you can simulate the workloads and measure performance on the prototype application.</span><span class="sxs-lookup"><span data-stu-id="413a7-209">Using Benchmarking tools you can simulate the workloads and measure performance on the prototype application.</span></span> <span data-ttu-id="413a7-210">See the section on [Benchmarking](#benchmarking) to learn more.</span><span class="sxs-lookup"><span data-stu-id="413a7-210">See the section on [Benchmarking](#benchmarking) to learn more.</span></span> <span data-ttu-id="413a7-211">By doing so you can determine whether Premium Storage can match or surpass your application performance requirements.</span><span class="sxs-lookup"><span data-stu-id="413a7-211">By doing so you can determine whether Premium Storage can match or surpass your application performance requirements.</span></span> <span data-ttu-id="413a7-212">Then you can implement the same guidelines for your production application.</span><span class="sxs-lookup"><span data-stu-id="413a7-212">Then you can implement the same guidelines for your production application.</span></span>

### <a name="counters-to-measure-application-performance-requirements"></a><span data-ttu-id="413a7-213">Counters to measure application performance requirements</span><span class="sxs-lookup"><span data-stu-id="413a7-213">Counters to measure application performance requirements</span></span>
<span data-ttu-id="413a7-214">The best way to measure performance requirements of your application, is to use performance-monitoring tools provided by the operating system of the server.</span><span class="sxs-lookup"><span data-stu-id="413a7-214">The best way to measure performance requirements of your application, is to use performance-monitoring tools provided by the operating system of the server.</span></span> <span data-ttu-id="413a7-215">You can use PerfMon for Windows and iostat for Linux.</span><span class="sxs-lookup"><span data-stu-id="413a7-215">You can use PerfMon for Windows and iostat for Linux.</span></span> <span data-ttu-id="413a7-216">These tools capture counters corresponding to each measure explained in the above section.</span><span class="sxs-lookup"><span data-stu-id="413a7-216">These tools capture counters corresponding to each measure explained in the above section.</span></span> <span data-ttu-id="413a7-217">You must capture the values of these counters when your application is running its normal, peak and off-hours workloads.</span><span class="sxs-lookup"><span data-stu-id="413a7-217">You must capture the values of these counters when your application is running its normal, peak and off-hours workloads.</span></span>

<span data-ttu-id="413a7-218">The PerfMon counters are available for processor, memory and, each logical disk and physical disk of your server.</span><span class="sxs-lookup"><span data-stu-id="413a7-218">The PerfMon counters are available for processor, memory and, each logical disk and physical disk of your server.</span></span> <span data-ttu-id="413a7-219">When you use premium storage disks with a VM, the physical disk counters are for each premium storage disk, and logical disk counters are for each volume created on the premium storage disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-219">When you use premium storage disks with a VM, the physical disk counters are for each premium storage disk, and logical disk counters are for each volume created on the premium storage disks.</span></span> <span data-ttu-id="413a7-220">You must capture the values for the disks that host your application workload.</span><span class="sxs-lookup"><span data-stu-id="413a7-220">You must capture the values for the disks that host your application workload.</span></span> <span data-ttu-id="413a7-221">If there is a one to one mapping between logical and physical disks, you can refer to physical disk counters; otherwise refer to the logical disk counters.</span><span class="sxs-lookup"><span data-stu-id="413a7-221">If there is a one to one mapping between logical and physical disks, you can refer to physical disk counters; otherwise refer to the logical disk counters.</span></span> <span data-ttu-id="413a7-222">On Linux, the iostat command generates a CPU and disk utilization report.</span><span class="sxs-lookup"><span data-stu-id="413a7-222">On Linux, the iostat command generates a CPU and disk utilization report.</span></span> <span data-ttu-id="413a7-223">The disk utilization report provides statistics per physical device or partition.</span><span class="sxs-lookup"><span data-stu-id="413a7-223">The disk utilization report provides statistics per physical device or partition.</span></span> <span data-ttu-id="413a7-224">If you have a database server with its data and log on separate disks, collect this data for both disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-224">If you have a database server with its data and log on separate disks, collect this data for both disks.</span></span> <span data-ttu-id="413a7-225">Below table describes counters for disks, processor and memory:</span><span class="sxs-lookup"><span data-stu-id="413a7-225">Below table describes counters for disks, processor and memory:</span></span>

| <span data-ttu-id="413a7-226">Counter</span><span class="sxs-lookup"><span data-stu-id="413a7-226">Counter</span></span> | <span data-ttu-id="413a7-227">Description</span><span class="sxs-lookup"><span data-stu-id="413a7-227">Description</span></span> | <span data-ttu-id="413a7-228">PerfMon</span><span class="sxs-lookup"><span data-stu-id="413a7-228">PerfMon</span></span> | <span data-ttu-id="413a7-229">Iostat</span><span class="sxs-lookup"><span data-stu-id="413a7-229">Iostat</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="413a7-230">**IOPS or Transactions per second**</span><span class="sxs-lookup"><span data-stu-id="413a7-230">**IOPS or Transactions per second**</span></span> |<span data-ttu-id="413a7-231">Number of I/O requests issued to the storage disk per second.</span><span class="sxs-lookup"><span data-stu-id="413a7-231">Number of I/O requests issued to the storage disk per second.</span></span> |<span data-ttu-id="413a7-232">Disk Reads/sec</span><span class="sxs-lookup"><span data-stu-id="413a7-232">Disk Reads/sec</span></span> <br> <span data-ttu-id="413a7-233">Disk Writes/sec</span><span class="sxs-lookup"><span data-stu-id="413a7-233">Disk Writes/sec</span></span> |<span data-ttu-id="413a7-234">tps</span><span class="sxs-lookup"><span data-stu-id="413a7-234">tps</span></span> <br> <span data-ttu-id="413a7-235">r/s</span><span class="sxs-lookup"><span data-stu-id="413a7-235">r/s</span></span> <br> <span data-ttu-id="413a7-236">w/s</span><span class="sxs-lookup"><span data-stu-id="413a7-236">w/s</span></span> |
| <span data-ttu-id="413a7-237">**Disk Reads and Writes**</span><span class="sxs-lookup"><span data-stu-id="413a7-237">**Disk Reads and Writes**</span></span> |<span data-ttu-id="413a7-238">% of Reads and Write operations performed on the disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-238">% of Reads and Write operations performed on the disk.</span></span> |<span data-ttu-id="413a7-239">% Disk Read Time</span><span class="sxs-lookup"><span data-stu-id="413a7-239">% Disk Read Time</span></span> <br> <span data-ttu-id="413a7-240">% Disk Write Time</span><span class="sxs-lookup"><span data-stu-id="413a7-240">% Disk Write Time</span></span> |<span data-ttu-id="413a7-241">r/s</span><span class="sxs-lookup"><span data-stu-id="413a7-241">r/s</span></span> <br> <span data-ttu-id="413a7-242">w/s</span><span class="sxs-lookup"><span data-stu-id="413a7-242">w/s</span></span> |
| <span data-ttu-id="413a7-243">**Throughput**</span><span class="sxs-lookup"><span data-stu-id="413a7-243">**Throughput**</span></span> |<span data-ttu-id="413a7-244">Amount of data read from or written to the disk per second.</span><span class="sxs-lookup"><span data-stu-id="413a7-244">Amount of data read from or written to the disk per second.</span></span> |<span data-ttu-id="413a7-245">Disk Read Bytes/sec</span><span class="sxs-lookup"><span data-stu-id="413a7-245">Disk Read Bytes/sec</span></span> <br> <span data-ttu-id="413a7-246">Disk Write Bytes/sec</span><span class="sxs-lookup"><span data-stu-id="413a7-246">Disk Write Bytes/sec</span></span> |<span data-ttu-id="413a7-247">kB_read/s</span><span class="sxs-lookup"><span data-stu-id="413a7-247">kB_read/s</span></span> <br> <span data-ttu-id="413a7-248">kB_wrtn/s</span><span class="sxs-lookup"><span data-stu-id="413a7-248">kB_wrtn/s</span></span> |
| <span data-ttu-id="413a7-249">**Latency**</span><span class="sxs-lookup"><span data-stu-id="413a7-249">**Latency**</span></span> |<span data-ttu-id="413a7-250">Total time to complete a disk IO request.</span><span class="sxs-lookup"><span data-stu-id="413a7-250">Total time to complete a disk IO request.</span></span> |<span data-ttu-id="413a7-251">Average Disk sec/Read</span><span class="sxs-lookup"><span data-stu-id="413a7-251">Average Disk sec/Read</span></span> <br> <span data-ttu-id="413a7-252">Average disk sec/Write</span><span class="sxs-lookup"><span data-stu-id="413a7-252">Average disk sec/Write</span></span> |<span data-ttu-id="413a7-253">await</span><span class="sxs-lookup"><span data-stu-id="413a7-253">await</span></span> <br> <span data-ttu-id="413a7-254">svctm</span><span class="sxs-lookup"><span data-stu-id="413a7-254">svctm</span></span> |
| <span data-ttu-id="413a7-255">**IO size**</span><span class="sxs-lookup"><span data-stu-id="413a7-255">**IO size**</span></span> |<span data-ttu-id="413a7-256">The size of I/O requests issues to the storage disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-256">The size of I/O requests issues to the storage disks.</span></span> |<span data-ttu-id="413a7-257">Average Disk Bytes/Read</span><span class="sxs-lookup"><span data-stu-id="413a7-257">Average Disk Bytes/Read</span></span> <br> <span data-ttu-id="413a7-258">Average Disk Bytes/Write</span><span class="sxs-lookup"><span data-stu-id="413a7-258">Average Disk Bytes/Write</span></span> |<span data-ttu-id="413a7-259">avgrq-sz</span><span class="sxs-lookup"><span data-stu-id="413a7-259">avgrq-sz</span></span> |
| <span data-ttu-id="413a7-260">**Queue Depth**</span><span class="sxs-lookup"><span data-stu-id="413a7-260">**Queue Depth**</span></span> |<span data-ttu-id="413a7-261">Number of outstanding I/O requests waiting to be read from or written to the storage disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-261">Number of outstanding I/O requests waiting to be read from or written to the storage disk.</span></span> |<span data-ttu-id="413a7-262">Current Disk Queue Length</span><span class="sxs-lookup"><span data-stu-id="413a7-262">Current Disk Queue Length</span></span> |<span data-ttu-id="413a7-263">avgqu-sz</span><span class="sxs-lookup"><span data-stu-id="413a7-263">avgqu-sz</span></span> |
| <span data-ttu-id="413a7-264">**Max. Memory**</span><span class="sxs-lookup"><span data-stu-id="413a7-264">**Max. Memory**</span></span> |<span data-ttu-id="413a7-265">Amount of memory required to run application smoothly</span><span class="sxs-lookup"><span data-stu-id="413a7-265">Amount of memory required to run application smoothly</span></span> |<span data-ttu-id="413a7-266">% Committed Bytes in Use</span><span class="sxs-lookup"><span data-stu-id="413a7-266">% Committed Bytes in Use</span></span> |<span data-ttu-id="413a7-267">Use vmstat</span><span class="sxs-lookup"><span data-stu-id="413a7-267">Use vmstat</span></span> |
| <span data-ttu-id="413a7-268">**Max. CPU**</span><span class="sxs-lookup"><span data-stu-id="413a7-268">**Max. CPU**</span></span> |<span data-ttu-id="413a7-269">Amount CPU required to run application smoothly</span><span class="sxs-lookup"><span data-stu-id="413a7-269">Amount CPU required to run application smoothly</span></span> |<span data-ttu-id="413a7-270">% Processor time</span><span class="sxs-lookup"><span data-stu-id="413a7-270">% Processor time</span></span> |<span data-ttu-id="413a7-271">%util</span><span class="sxs-lookup"><span data-stu-id="413a7-271">%util</span></span> |

<span data-ttu-id="413a7-272">Learn more about [iostat](https://linux.die.net/man/1/iostat) and [PerfMon](https://msdn.microsoft.com/library/aa645516.aspx).</span><span class="sxs-lookup"><span data-stu-id="413a7-272">Learn more about [iostat](https://linux.die.net/man/1/iostat) and [PerfMon](https://msdn.microsoft.com/library/aa645516.aspx).</span></span>

## <a name="optimizing-application-performance"></a><span data-ttu-id="413a7-273">Optimizing Application Performance</span><span class="sxs-lookup"><span data-stu-id="413a7-273">Optimizing Application Performance</span></span>
<span data-ttu-id="413a7-274">The main factors that influence performance of an application running on Premium Storage are Nature of IO Requests, VM size, Disk size, Number of disks, Disk Caching, Multithreading and Queue Depth.</span><span class="sxs-lookup"><span data-stu-id="413a7-274">The main factors that influence performance of an application running on Premium Storage are Nature of IO Requests, VM size, Disk size, Number of disks, Disk Caching, Multithreading and Queue Depth.</span></span> <span data-ttu-id="413a7-275">You can control some of these factors with knobs provided by the system.</span><span class="sxs-lookup"><span data-stu-id="413a7-275">You can control some of these factors with knobs provided by the system.</span></span> <span data-ttu-id="413a7-276">Most applications may not give you an option to alter the IO size and Queue Depth directly.</span><span class="sxs-lookup"><span data-stu-id="413a7-276">Most applications may not give you an option to alter the IO size and Queue Depth directly.</span></span> <span data-ttu-id="413a7-277">For example, if you are using SQL Server, you cannot choose the IO size and queue depth.</span><span class="sxs-lookup"><span data-stu-id="413a7-277">For example, if you are using SQL Server, you cannot choose the IO size and queue depth.</span></span> <span data-ttu-id="413a7-278">SQL Server chooses the optimal IO size and queue depth values to get the most performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-278">SQL Server chooses the optimal IO size and queue depth values to get the most performance.</span></span> <span data-ttu-id="413a7-279">It is important to understand the effects of both types of factors on your application performance, so that you can provision appropriate resources to meet performance needs.</span><span class="sxs-lookup"><span data-stu-id="413a7-279">It is important to understand the effects of both types of factors on your application performance, so that you can provision appropriate resources to meet performance needs.</span></span>

<span data-ttu-id="413a7-280">Throughout this section, refer to the application requirements checklist that you created, to identify how much you need to optimize your application performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-280">Throughout this section, refer to the application requirements checklist that you created, to identify how much you need to optimize your application performance.</span></span> <span data-ttu-id="413a7-281">Based on that, you will be able to determine which factors from this section you will need to tune.</span><span class="sxs-lookup"><span data-stu-id="413a7-281">Based on that, you will be able to determine which factors from this section you will need to tune.</span></span> <span data-ttu-id="413a7-282">To witness the effects of each factor on your application performance, run benchmarking tools on your application setup.</span><span class="sxs-lookup"><span data-stu-id="413a7-282">To witness the effects of each factor on your application performance, run benchmarking tools on your application setup.</span></span> <span data-ttu-id="413a7-283">Refer to the [Benchmarking](#Benchmarking) section at the end of this article for steps to run common benchmarking tools on Windows and Linux VMs.</span><span class="sxs-lookup"><span data-stu-id="413a7-283">Refer to the [Benchmarking](#Benchmarking) section at the end of this article for steps to run common benchmarking tools on Windows and Linux VMs.</span></span>

### <a name="optimizing-iops-throughput-and-latency-at-a-glance"></a><span data-ttu-id="413a7-284">Optimizing IOPS, Throughput and Latency at a glance</span><span class="sxs-lookup"><span data-stu-id="413a7-284">Optimizing IOPS, Throughput and Latency at a glance</span></span>

<span data-ttu-id="413a7-285">The table below summarizes performance factors and the steps necessary to optimize IOPS, throughput and latency.</span><span class="sxs-lookup"><span data-stu-id="413a7-285">The table below summarizes performance factors and the steps necessary to optimize IOPS, throughput and latency.</span></span> <span data-ttu-id="413a7-286">The sections following this summary will describe each factor is much more depth.</span><span class="sxs-lookup"><span data-stu-id="413a7-286">The sections following this summary will describe each factor is much more depth.</span></span>

<span data-ttu-id="413a7-287">For more information on VM sizes and on the IOPS, throughput, and latency available for each type of VM, see [Linux VM sizes](../articles/virtual-machines/linux/sizes.md) or [Windows VM sizes](../articles/virtual-machines/windows/sizes.md).</span><span class="sxs-lookup"><span data-stu-id="413a7-287">For more information on VM sizes and on the IOPS, throughput, and latency available for each type of VM, see [Linux VM sizes](../articles/virtual-machines/linux/sizes.md) or [Windows VM sizes](../articles/virtual-machines/windows/sizes.md).</span></span>

| &nbsp; | <span data-ttu-id="413a7-288">**IOPS**</span><span class="sxs-lookup"><span data-stu-id="413a7-288">**IOPS**</span></span> | <span data-ttu-id="413a7-289">**Throughput**</span><span class="sxs-lookup"><span data-stu-id="413a7-289">**Throughput**</span></span> | <span data-ttu-id="413a7-290">**Latency**</span><span class="sxs-lookup"><span data-stu-id="413a7-290">**Latency**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="413a7-291">**Example Scenario**</span><span class="sxs-lookup"><span data-stu-id="413a7-291">**Example Scenario**</span></span> |<span data-ttu-id="413a7-292">Enterprise OLTP application requiring very high transactions per second rate.</span><span class="sxs-lookup"><span data-stu-id="413a7-292">Enterprise OLTP application requiring very high transactions per second rate.</span></span> |<span data-ttu-id="413a7-293">Enterprise Data warehousing application processing large amounts of data.</span><span class="sxs-lookup"><span data-stu-id="413a7-293">Enterprise Data warehousing application processing large amounts of data.</span></span> |<span data-ttu-id="413a7-294">Near real-time applications requiring instant responses to user requests, like online gaming.</span><span class="sxs-lookup"><span data-stu-id="413a7-294">Near real-time applications requiring instant responses to user requests, like online gaming.</span></span> |
| <span data-ttu-id="413a7-295">Performance factors</span><span class="sxs-lookup"><span data-stu-id="413a7-295">Performance factors</span></span> | &nbsp; | &nbsp; | &nbsp; |
| <span data-ttu-id="413a7-296">**IO size**</span><span class="sxs-lookup"><span data-stu-id="413a7-296">**IO size**</span></span> |<span data-ttu-id="413a7-297">Smaller IO size yields higher IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-297">Smaller IO size yields higher IOPS.</span></span> |<span data-ttu-id="413a7-298">Larger IO size to yields higher Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-298">Larger IO size to yields higher Throughput.</span></span> | &nbsp;|
| <span data-ttu-id="413a7-299">**VM size**</span><span class="sxs-lookup"><span data-stu-id="413a7-299">**VM size**</span></span> |<span data-ttu-id="413a7-300">Use a VM size that offers IOPS greater than your application requirement.</span><span class="sxs-lookup"><span data-stu-id="413a7-300">Use a VM size that offers IOPS greater than your application requirement.</span></span> |<span data-ttu-id="413a7-301">Use a VM size with throughput limit greater than your application requirement.</span><span class="sxs-lookup"><span data-stu-id="413a7-301">Use a VM size with throughput limit greater than your application requirement.</span></span> |<span data-ttu-id="413a7-302">Use a VM size that offers scale limits greater than your application requirement.</span><span class="sxs-lookup"><span data-stu-id="413a7-302">Use a VM size that offers scale limits greater than your application requirement.</span></span> |
| <span data-ttu-id="413a7-303">**Disk size**</span><span class="sxs-lookup"><span data-stu-id="413a7-303">**Disk size**</span></span> |<span data-ttu-id="413a7-304">Use a disk size that offers IOPS greater than your application requirement.</span><span class="sxs-lookup"><span data-stu-id="413a7-304">Use a disk size that offers IOPS greater than your application requirement.</span></span> |<span data-ttu-id="413a7-305">Use a disk size with Throughput limit greater than your application requirement.</span><span class="sxs-lookup"><span data-stu-id="413a7-305">Use a disk size with Throughput limit greater than your application requirement.</span></span> |<span data-ttu-id="413a7-306">Use a disk size that offers scale limits greater than your application requirement.</span><span class="sxs-lookup"><span data-stu-id="413a7-306">Use a disk size that offers scale limits greater than your application requirement.</span></span> |
| <span data-ttu-id="413a7-307">**VM and Disk Scale Limits**</span><span class="sxs-lookup"><span data-stu-id="413a7-307">**VM and Disk Scale Limits**</span></span> |<span data-ttu-id="413a7-308">IOPS limit of the VM size chosen should be greater than total IOPS driven by premium storage disks attached to it.</span><span class="sxs-lookup"><span data-stu-id="413a7-308">IOPS limit of the VM size chosen should be greater than total IOPS driven by premium storage disks attached to it.</span></span> |<span data-ttu-id="413a7-309">Throughput limit of the VM size chosen should be greater than total Throughput driven by premium storage disks attached to it.</span><span class="sxs-lookup"><span data-stu-id="413a7-309">Throughput limit of the VM size chosen should be greater than total Throughput driven by premium storage disks attached to it.</span></span> |<span data-ttu-id="413a7-310">Scale limits of the VM size chosen must be greater than total scale limits of attached premium storage disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-310">Scale limits of the VM size chosen must be greater than total scale limits of attached premium storage disks.</span></span> |
| <span data-ttu-id="413a7-311">**Disk Caching**</span><span class="sxs-lookup"><span data-stu-id="413a7-311">**Disk Caching**</span></span> |<span data-ttu-id="413a7-312">Enable ReadOnly Cache on premium storage disks with Read heavy operations to get higher Read IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-312">Enable ReadOnly Cache on premium storage disks with Read heavy operations to get higher Read IOPS.</span></span> | &nbsp; |<span data-ttu-id="413a7-313">Enable ReadOnly Cache on premium storage disks with Ready heavy operations to get very low Read latencies.</span><span class="sxs-lookup"><span data-stu-id="413a7-313">Enable ReadOnly Cache on premium storage disks with Ready heavy operations to get very low Read latencies.</span></span> |
| <span data-ttu-id="413a7-314">**Disk Striping**</span><span class="sxs-lookup"><span data-stu-id="413a7-314">**Disk Striping**</span></span> |<span data-ttu-id="413a7-315">Use multiple disks and stripe them together to get a combined higher IOPS and Throughput limit.</span><span class="sxs-lookup"><span data-stu-id="413a7-315">Use multiple disks and stripe them together to get a combined higher IOPS and Throughput limit.</span></span> <span data-ttu-id="413a7-316">Note that the combined limit per VM should be higher than the combined limits of attached premium disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-316">Note that the combined limit per VM should be higher than the combined limits of attached premium disks.</span></span> | &nbsp; | &nbsp; |
| <span data-ttu-id="413a7-317">**Stripe Size**</span><span class="sxs-lookup"><span data-stu-id="413a7-317">**Stripe Size**</span></span> |<span data-ttu-id="413a7-318">Smaller stripe size for random small IO pattern seen in OLTP applications.</span><span class="sxs-lookup"><span data-stu-id="413a7-318">Smaller stripe size for random small IO pattern seen in OLTP applications.</span></span> <span data-ttu-id="413a7-319">E.g., use stripe size of 64KB for SQL Server OLTP application.</span><span class="sxs-lookup"><span data-stu-id="413a7-319">E.g., use stripe size of 64KB for SQL Server OLTP application.</span></span> |<span data-ttu-id="413a7-320">Larger stripe size for sequential large IO pattern seen in Data Warehouse applications.</span><span class="sxs-lookup"><span data-stu-id="413a7-320">Larger stripe size for sequential large IO pattern seen in Data Warehouse applications.</span></span> <span data-ttu-id="413a7-321">E.g., use 256KB stripe size for SQL Server Data warehouse application.</span><span class="sxs-lookup"><span data-stu-id="413a7-321">E.g., use 256KB stripe size for SQL Server Data warehouse application.</span></span> | &nbsp; |
| <span data-ttu-id="413a7-322">**Multithreading**</span><span class="sxs-lookup"><span data-stu-id="413a7-322">**Multithreading**</span></span> |<span data-ttu-id="413a7-323">Use multithreading to push higher number of requests to Premium Storage that will lead to higher IOPS and Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-323">Use multithreading to push higher number of requests to Premium Storage that will lead to higher IOPS and Throughput.</span></span> <span data-ttu-id="413a7-324">For example, on SQL Server set a high MAXDOP value to allocate more CPUs to SQL Server.</span><span class="sxs-lookup"><span data-stu-id="413a7-324">For example, on SQL Server set a high MAXDOP value to allocate more CPUs to SQL Server.</span></span> | &nbsp; | &nbsp; |
| <span data-ttu-id="413a7-325">**Queue Depth**</span><span class="sxs-lookup"><span data-stu-id="413a7-325">**Queue Depth**</span></span> |<span data-ttu-id="413a7-326">Larger Queue Depth yields higher IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-326">Larger Queue Depth yields higher IOPS.</span></span> |<span data-ttu-id="413a7-327">Larger Queue Depth yields higher Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-327">Larger Queue Depth yields higher Throughput.</span></span> |<span data-ttu-id="413a7-328">Smaller Queue Depth yields lower latencies.</span><span class="sxs-lookup"><span data-stu-id="413a7-328">Smaller Queue Depth yields lower latencies.</span></span> |

## <a name="nature-of-io-requests"></a><span data-ttu-id="413a7-329">Nature of IO Requests</span><span class="sxs-lookup"><span data-stu-id="413a7-329">Nature of IO Requests</span></span>
<span data-ttu-id="413a7-330">An IO request is a unit of input/output operation that your application will be performing.</span><span class="sxs-lookup"><span data-stu-id="413a7-330">An IO request is a unit of input/output operation that your application will be performing.</span></span> <span data-ttu-id="413a7-331">Identifying the nature of IO requests, random or sequential, read or write, small or large, will help you determine the performance requirements of your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-331">Identifying the nature of IO requests, random or sequential, read or write, small or large, will help you determine the performance requirements of your application.</span></span> <span data-ttu-id="413a7-332">It is very important to understand the nature of IO requests, to make the right decisions when designing your application infrastructure.</span><span class="sxs-lookup"><span data-stu-id="413a7-332">It is very important to understand the nature of IO requests, to make the right decisions when designing your application infrastructure.</span></span>

<span data-ttu-id="413a7-333">IO size is one of the more important factors.</span><span class="sxs-lookup"><span data-stu-id="413a7-333">IO size is one of the more important factors.</span></span> <span data-ttu-id="413a7-334">The IO size is the size of the input/output operation request generated by your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-334">The IO size is the size of the input/output operation request generated by your application.</span></span> <span data-ttu-id="413a7-335">The IO size has a significant impact on performance especially on the IOPS and Bandwidth that the application is able to achieve.</span><span class="sxs-lookup"><span data-stu-id="413a7-335">The IO size has a significant impact on performance especially on the IOPS and Bandwidth that the application is able to achieve.</span></span> <span data-ttu-id="413a7-336">The following formula shows the relationship between IOPS, IO size and Bandwidth/Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-336">The following formula shows the relationship between IOPS, IO size and Bandwidth/Throughput.</span></span>  
    ![](media/premium-storage-performance/image1.png)

<span data-ttu-id="413a7-337">Some applications allow you to alter their IO size, while some applications do not.</span><span class="sxs-lookup"><span data-stu-id="413a7-337">Some applications allow you to alter their IO size, while some applications do not.</span></span> <span data-ttu-id="413a7-338">For example, SQL Server determines the optimal IO size itself, and does not provide users with any knobs to change it.</span><span class="sxs-lookup"><span data-stu-id="413a7-338">For example, SQL Server determines the optimal IO size itself, and does not provide users with any knobs to change it.</span></span> <span data-ttu-id="413a7-339">On the other hand, Oracle provides a parameter called [DB\_BLOCK\_SIZE](https://docs.oracle.com/cd/B19306_01/server.102/b14211/iodesign.htm#i28815) using which you can configure the I/O request size of the database.</span><span class="sxs-lookup"><span data-stu-id="413a7-339">On the other hand, Oracle provides a parameter called [DB\_BLOCK\_SIZE](https://docs.oracle.com/cd/B19306_01/server.102/b14211/iodesign.htm#i28815) using which you can configure the I/O request size of the database.</span></span>

<span data-ttu-id="413a7-340">If you are using an application, which does not allow you to change the IO size, use the guidelines in this article to optimize the performance KPI that is most relevant to your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-340">If you are using an application, which does not allow you to change the IO size, use the guidelines in this article to optimize the performance KPI that is most relevant to your application.</span></span> <span data-ttu-id="413a7-341">For example,</span><span class="sxs-lookup"><span data-stu-id="413a7-341">For example,</span></span>

* <span data-ttu-id="413a7-342">An OLTP application generates millions of small and random IO requests.</span><span class="sxs-lookup"><span data-stu-id="413a7-342">An OLTP application generates millions of small and random IO requests.</span></span> <span data-ttu-id="413a7-343">To handle these type of IO requests, you must design your application infrastructure to get higher IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-343">To handle these type of IO requests, you must design your application infrastructure to get higher IOPS.</span></span>  
* <span data-ttu-id="413a7-344">A data warehousing application generates large and sequential IO requests.</span><span class="sxs-lookup"><span data-stu-id="413a7-344">A data warehousing application generates large and sequential IO requests.</span></span> <span data-ttu-id="413a7-345">To handle these type of IO requests, you must design your application infrastructure to get higher Bandwidth or Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-345">To handle these type of IO requests, you must design your application infrastructure to get higher Bandwidth or Throughput.</span></span>

<span data-ttu-id="413a7-346">If you are using an application, which allows you to change the IO size, use this rule of thumb for the IO size in addition to other performance guidelines,</span><span class="sxs-lookup"><span data-stu-id="413a7-346">If you are using an application, which allows you to change the IO size, use this rule of thumb for the IO size in addition to other performance guidelines,</span></span>

* <span data-ttu-id="413a7-347">Smaller IO size to get higher IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-347">Smaller IO size to get higher IOPS.</span></span> <span data-ttu-id="413a7-348">For example, 8 KB for an OLTP application.</span><span class="sxs-lookup"><span data-stu-id="413a7-348">For example, 8 KB for an OLTP application.</span></span>  
* <span data-ttu-id="413a7-349">Larger IO size to get higher Bandwidth/Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-349">Larger IO size to get higher Bandwidth/Throughput.</span></span> <span data-ttu-id="413a7-350">For example, 1024 KB for a data warehouse application.</span><span class="sxs-lookup"><span data-stu-id="413a7-350">For example, 1024 KB for a data warehouse application.</span></span>

<span data-ttu-id="413a7-351">Here is an example on how you can calculate the IOPS and Throughput/Bandwidth for your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-351">Here is an example on how you can calculate the IOPS and Throughput/Bandwidth for your application.</span></span> <span data-ttu-id="413a7-352">Consider an application using a P30 disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-352">Consider an application using a P30 disk.</span></span> <span data-ttu-id="413a7-353">The maximum IOPS and Throughput/Bandwidth a P30 disk can achieve is 5000 IOPS and 200 MB per second respectively.</span><span class="sxs-lookup"><span data-stu-id="413a7-353">The maximum IOPS and Throughput/Bandwidth a P30 disk can achieve is 5000 IOPS and 200 MB per second respectively.</span></span> <span data-ttu-id="413a7-354">Now, if your application requires the maximum IOPS from the P30 disk and you use a smaller IO size like 8 KB, the resulting Bandwidth you will be able to get is 40 MB per second.</span><span class="sxs-lookup"><span data-stu-id="413a7-354">Now, if your application requires the maximum IOPS from the P30 disk and you use a smaller IO size like 8 KB, the resulting Bandwidth you will be able to get is 40 MB per second.</span></span> <span data-ttu-id="413a7-355">However, if your application requires the maximum Throughput/Bandwidth from P30 disk, and you use a larger IO size like 1024 KB, the resulting IOPS will be less, 200 IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-355">However, if your application requires the maximum Throughput/Bandwidth from P30 disk, and you use a larger IO size like 1024 KB, the resulting IOPS will be less, 200 IOPS.</span></span> <span data-ttu-id="413a7-356">Therefore, tune the IO size such that it meets both your application's IOPS and Throughput/Bandwidth requirement.</span><span class="sxs-lookup"><span data-stu-id="413a7-356">Therefore, tune the IO size such that it meets both your application's IOPS and Throughput/Bandwidth requirement.</span></span> <span data-ttu-id="413a7-357">Table below summarizes the different IO sizes and their corresponding IOPS and Throughput for a P30 disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-357">Table below summarizes the different IO sizes and their corresponding IOPS and Throughput for a P30 disk.</span></span>

| <span data-ttu-id="413a7-358">Application Requirement</span><span class="sxs-lookup"><span data-stu-id="413a7-358">Application Requirement</span></span> | <span data-ttu-id="413a7-359">I/O size</span><span class="sxs-lookup"><span data-stu-id="413a7-359">I/O size</span></span> | <span data-ttu-id="413a7-360">IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-360">IOPS</span></span> | <span data-ttu-id="413a7-361">Throughput/Bandwidth</span><span class="sxs-lookup"><span data-stu-id="413a7-361">Throughput/Bandwidth</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="413a7-362">Max IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-362">Max IOPS</span></span> |<span data-ttu-id="413a7-363">8 KB</span><span class="sxs-lookup"><span data-stu-id="413a7-363">8 KB</span></span> |<span data-ttu-id="413a7-364">5,000</span><span class="sxs-lookup"><span data-stu-id="413a7-364">5,000</span></span> |<span data-ttu-id="413a7-365">40 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-365">40 MB per second</span></span> |
| <span data-ttu-id="413a7-366">Max Throughput</span><span class="sxs-lookup"><span data-stu-id="413a7-366">Max Throughput</span></span> |<span data-ttu-id="413a7-367">1024 KB</span><span class="sxs-lookup"><span data-stu-id="413a7-367">1024 KB</span></span> |<span data-ttu-id="413a7-368">200</span><span class="sxs-lookup"><span data-stu-id="413a7-368">200</span></span> |<span data-ttu-id="413a7-369">200 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-369">200 MB per second</span></span> |
| <span data-ttu-id="413a7-370">Max Throughput + high IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-370">Max Throughput + high IOPS</span></span> |<span data-ttu-id="413a7-371">64 KB</span><span class="sxs-lookup"><span data-stu-id="413a7-371">64 KB</span></span> |<span data-ttu-id="413a7-372">3,200</span><span class="sxs-lookup"><span data-stu-id="413a7-372">3,200</span></span> |<span data-ttu-id="413a7-373">200 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-373">200 MB per second</span></span> |
| <span data-ttu-id="413a7-374">Max IOPS + high Throughput</span><span class="sxs-lookup"><span data-stu-id="413a7-374">Max IOPS + high Throughput</span></span> |<span data-ttu-id="413a7-375">32 KB</span><span class="sxs-lookup"><span data-stu-id="413a7-375">32 KB</span></span> |<span data-ttu-id="413a7-376">5,000</span><span class="sxs-lookup"><span data-stu-id="413a7-376">5,000</span></span> |<span data-ttu-id="413a7-377">160 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-377">160 MB per second</span></span> |

<span data-ttu-id="413a7-378">To get IOPS and Bandwidth higher than the maximum value of a single premium storage disk, use multiple premium disks striped together.</span><span class="sxs-lookup"><span data-stu-id="413a7-378">To get IOPS and Bandwidth higher than the maximum value of a single premium storage disk, use multiple premium disks striped together.</span></span> <span data-ttu-id="413a7-379">For example, stripe two P30 disks to get a combined IOPS of 10,000 IOPS or a combined Throughput of 400 MB per second.</span><span class="sxs-lookup"><span data-stu-id="413a7-379">For example, stripe two P30 disks to get a combined IOPS of 10,000 IOPS or a combined Throughput of 400 MB per second.</span></span> <span data-ttu-id="413a7-380">As explained in the next section, you must use a VM size that supports the combined disk IOPS and Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-380">As explained in the next section, you must use a VM size that supports the combined disk IOPS and Throughput.</span></span>

> [!NOTE]
> <span data-ttu-id="413a7-381">As you increase either IOPS or Throughput the other also increases, make sure you do not hit throughput or IOPS limits of the disk or VM when increasing either one.</span><span class="sxs-lookup"><span data-stu-id="413a7-381">As you increase either IOPS or Throughput the other also increases, make sure you do not hit throughput or IOPS limits of the disk or VM when increasing either one.</span></span>
>
>

<span data-ttu-id="413a7-382">To witness the effects of IO size on application performance, you can run benchmarking tools on your VM and disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-382">To witness the effects of IO size on application performance, you can run benchmarking tools on your VM and disks.</span></span> <span data-ttu-id="413a7-383">Create multiple test runs and use different IO size for each run to see the impact.</span><span class="sxs-lookup"><span data-stu-id="413a7-383">Create multiple test runs and use different IO size for each run to see the impact.</span></span> <span data-ttu-id="413a7-384">Refer to the [Benchmarking](#Benchmarking) section at the end of this article for more details.</span><span class="sxs-lookup"><span data-stu-id="413a7-384">Refer to the [Benchmarking](#Benchmarking) section at the end of this article for more details.</span></span>

## <a name="high-scale-vm-sizes"></a><span data-ttu-id="413a7-385">High Scale VM Sizes</span><span class="sxs-lookup"><span data-stu-id="413a7-385">High Scale VM Sizes</span></span>
<span data-ttu-id="413a7-386">When you start designing an application, one of the first things to do is, choose a VM to host your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-386">When you start designing an application, one of the first things to do is, choose a VM to host your application.</span></span> <span data-ttu-id="413a7-387">Premium Storage comes with High Scale VM sizes that can run applications requiring higher compute power and a high local disk I/O performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-387">Premium Storage comes with High Scale VM sizes that can run applications requiring higher compute power and a high local disk I/O performance.</span></span> <span data-ttu-id="413a7-388">These VMs provide faster processors, a higher memory-to-core ratio, and a Solid-State Drive (SSD) for the local disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-388">These VMs provide faster processors, a higher memory-to-core ratio, and a Solid-State Drive (SSD) for the local disk.</span></span> <span data-ttu-id="413a7-389">Examples of High Scale VMs supporting Premium Storage are the DS, DSv2 and GS series VMs.</span><span class="sxs-lookup"><span data-stu-id="413a7-389">Examples of High Scale VMs supporting Premium Storage are the DS, DSv2 and GS series VMs.</span></span>

<span data-ttu-id="413a7-390">High Scale VMs are available in different sizes with a different number of CPU cores, memory, OS and temporary disk size.</span><span class="sxs-lookup"><span data-stu-id="413a7-390">High Scale VMs are available in different sizes with a different number of CPU cores, memory, OS and temporary disk size.</span></span> <span data-ttu-id="413a7-391">Each VM size also has maximum number of data disks that you can attach to the VM.</span><span class="sxs-lookup"><span data-stu-id="413a7-391">Each VM size also has maximum number of data disks that you can attach to the VM.</span></span> <span data-ttu-id="413a7-392">Therefore, the chosen VM size will affect how much processing, memory, and storage capacity is available for your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-392">Therefore, the chosen VM size will affect how much processing, memory, and storage capacity is available for your application.</span></span> <span data-ttu-id="413a7-393">It also affects the Compute and Storage cost.</span><span class="sxs-lookup"><span data-stu-id="413a7-393">It also affects the Compute and Storage cost.</span></span> <span data-ttu-id="413a7-394">For example, below are the specifications of the largest VM size in a DS series, DSv2 series and a GS series:</span><span class="sxs-lookup"><span data-stu-id="413a7-394">For example, below are the specifications of the largest VM size in a DS series, DSv2 series and a GS series:</span></span>

| <span data-ttu-id="413a7-395">VM size</span><span class="sxs-lookup"><span data-stu-id="413a7-395">VM size</span></span> | <span data-ttu-id="413a7-396">CPU cores</span><span class="sxs-lookup"><span data-stu-id="413a7-396">CPU cores</span></span> | <span data-ttu-id="413a7-397">Memory</span><span class="sxs-lookup"><span data-stu-id="413a7-397">Memory</span></span> | <span data-ttu-id="413a7-398">VM disk sizes</span><span class="sxs-lookup"><span data-stu-id="413a7-398">VM disk sizes</span></span> | <span data-ttu-id="413a7-399">Max.</span><span class="sxs-lookup"><span data-stu-id="413a7-399">Max.</span></span> <span data-ttu-id="413a7-400">data disks</span><span class="sxs-lookup"><span data-stu-id="413a7-400">data disks</span></span> | <span data-ttu-id="413a7-401">Cache size</span><span class="sxs-lookup"><span data-stu-id="413a7-401">Cache size</span></span> | <span data-ttu-id="413a7-402">IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-402">IOPS</span></span> | <span data-ttu-id="413a7-403">Bandwidth Cache IO limits</span><span class="sxs-lookup"><span data-stu-id="413a7-403">Bandwidth Cache IO limits</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="413a7-404">Standard_DS14</span><span class="sxs-lookup"><span data-stu-id="413a7-404">Standard_DS14</span></span> |<span data-ttu-id="413a7-405">16</span><span class="sxs-lookup"><span data-stu-id="413a7-405">16</span></span> |<span data-ttu-id="413a7-406">112 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-406">112 GB</span></span> |<span data-ttu-id="413a7-407">OS = 1023 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-407">OS = 1023 GB</span></span> <br> <span data-ttu-id="413a7-408">Local SSD = 224 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-408">Local SSD = 224 GB</span></span> |<span data-ttu-id="413a7-409">32</span><span class="sxs-lookup"><span data-stu-id="413a7-409">32</span></span> |<span data-ttu-id="413a7-410">576 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-410">576 GB</span></span> |<span data-ttu-id="413a7-411">50,000 IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-411">50,000 IOPS</span></span> <br> <span data-ttu-id="413a7-412">512 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-412">512 MB per second</span></span> |<span data-ttu-id="413a7-413">4,000 IOPS and 33 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-413">4,000 IOPS and 33 MB per second</span></span> |
| <span data-ttu-id="413a7-414">Standard_GS5</span><span class="sxs-lookup"><span data-stu-id="413a7-414">Standard_GS5</span></span> |<span data-ttu-id="413a7-415">32</span><span class="sxs-lookup"><span data-stu-id="413a7-415">32</span></span> |<span data-ttu-id="413a7-416">448 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-416">448 GB</span></span> |<span data-ttu-id="413a7-417">OS = 1023 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-417">OS = 1023 GB</span></span> <br> <span data-ttu-id="413a7-418">Local SSD = 896 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-418">Local SSD = 896 GB</span></span> |<span data-ttu-id="413a7-419">64</span><span class="sxs-lookup"><span data-stu-id="413a7-419">64</span></span> |<span data-ttu-id="413a7-420">4224 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-420">4224 GB</span></span> |<span data-ttu-id="413a7-421">80,000 IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-421">80,000 IOPS</span></span> <br> <span data-ttu-id="413a7-422">2,000 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-422">2,000 MB per second</span></span> |<span data-ttu-id="413a7-423">5,000 IOPS and 50 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-423">5,000 IOPS and 50 MB per second</span></span> |

<span data-ttu-id="413a7-424">To view a complete list of all available Azure VM sizes, refer to [Windows VM sizes](../articles/virtual-machines/windows/sizes.md) or [Linux VM sizes](../articles/virtual-machines/linux/sizes.md).</span><span class="sxs-lookup"><span data-stu-id="413a7-424">To view a complete list of all available Azure VM sizes, refer to [Windows VM sizes](../articles/virtual-machines/windows/sizes.md) or [Linux VM sizes](../articles/virtual-machines/linux/sizes.md).</span></span> <span data-ttu-id="413a7-425">Choose a VM size that can meet and scale to your desired application performance requirements.</span><span class="sxs-lookup"><span data-stu-id="413a7-425">Choose a VM size that can meet and scale to your desired application performance requirements.</span></span> <span data-ttu-id="413a7-426">In addition to this, take into account following important considerations when choosing VM sizes.</span><span class="sxs-lookup"><span data-stu-id="413a7-426">In addition to this, take into account following important considerations when choosing VM sizes.</span></span>

<span data-ttu-id="413a7-427">*Scale Limits*</span><span class="sxs-lookup"><span data-stu-id="413a7-427">*Scale Limits*</span></span>  
<span data-ttu-id="413a7-428">The maximum IOPS limits per VM and per disk are different and independent of each other.</span><span class="sxs-lookup"><span data-stu-id="413a7-428">The maximum IOPS limits per VM and per disk are different and independent of each other.</span></span> <span data-ttu-id="413a7-429">Make sure that the application is driving IOPS within the limits of the VM as well as the premium disks attached to it.</span><span class="sxs-lookup"><span data-stu-id="413a7-429">Make sure that the application is driving IOPS within the limits of the VM as well as the premium disks attached to it.</span></span> <span data-ttu-id="413a7-430">Otherwise, application performance will experience throttling.</span><span class="sxs-lookup"><span data-stu-id="413a7-430">Otherwise, application performance will experience throttling.</span></span>

<span data-ttu-id="413a7-431">As an example, suppose an application requirement is a maximum of 4,000 IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-431">As an example, suppose an application requirement is a maximum of 4,000 IOPS.</span></span> <span data-ttu-id="413a7-432">To achieve this, you provision a P30 disk on a DS1 VM.</span><span class="sxs-lookup"><span data-stu-id="413a7-432">To achieve this, you provision a P30 disk on a DS1 VM.</span></span> <span data-ttu-id="413a7-433">The P30 disk can deliver up to 5,000 IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-433">The P30 disk can deliver up to 5,000 IOPS.</span></span> <span data-ttu-id="413a7-434">However, the DS1 VM is limited to 3,200 IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-434">However, the DS1 VM is limited to 3,200 IOPS.</span></span> <span data-ttu-id="413a7-435">Consequently, the application performance will be constrained by the VM limit at 3,200 IOPS and there will be degraded performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-435">Consequently, the application performance will be constrained by the VM limit at 3,200 IOPS and there will be degraded performance.</span></span> <span data-ttu-id="413a7-436">To prevent this situation, choose a VM and disk size that will both meet application requirements.</span><span class="sxs-lookup"><span data-stu-id="413a7-436">To prevent this situation, choose a VM and disk size that will both meet application requirements.</span></span>

<span data-ttu-id="413a7-437">*Cost of Operation*</span><span class="sxs-lookup"><span data-stu-id="413a7-437">*Cost of Operation*</span></span>  
<span data-ttu-id="413a7-438">In many cases, it is possible that your overall cost of operation using Premium Storage is lower than using Standard Storage.</span><span class="sxs-lookup"><span data-stu-id="413a7-438">In many cases, it is possible that your overall cost of operation using Premium Storage is lower than using Standard Storage.</span></span>

<span data-ttu-id="413a7-439">For example, consider an application requiring 16,000 IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-439">For example, consider an application requiring 16,000 IOPS.</span></span> <span data-ttu-id="413a7-440">To achieve this performance, you will need a Standard\_D14 Azure IaaS VM, which can give a maximum IOPS of 16,000 using 32 standard storage 1TB disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-440">To achieve this performance, you will need a Standard\_D14 Azure IaaS VM, which can give a maximum IOPS of 16,000 using 32 standard storage 1TB disks.</span></span> <span data-ttu-id="413a7-441">Each 1TB standard storage disk can achieve a maximum of 500 IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-441">Each 1TB standard storage disk can achieve a maximum of 500 IOPS.</span></span> <span data-ttu-id="413a7-442">The estimated cost of this VM per month will be $1,570.</span><span class="sxs-lookup"><span data-stu-id="413a7-442">The estimated cost of this VM per month will be $1,570.</span></span> <span data-ttu-id="413a7-443">The monthly cost of 32 standard storage disks will be $1,638.</span><span class="sxs-lookup"><span data-stu-id="413a7-443">The monthly cost of 32 standard storage disks will be $1,638.</span></span> <span data-ttu-id="413a7-444">The estimated total monthly cost will be $3,208.</span><span class="sxs-lookup"><span data-stu-id="413a7-444">The estimated total monthly cost will be $3,208.</span></span>

<span data-ttu-id="413a7-445">However, if you hosted the same application on Premium Storage, you will need a smaller VM size and fewer premium storage disks, thus reducing the overall cost.</span><span class="sxs-lookup"><span data-stu-id="413a7-445">However, if you hosted the same application on Premium Storage, you will need a smaller VM size and fewer premium storage disks, thus reducing the overall cost.</span></span> <span data-ttu-id="413a7-446">A Standard\_DS13 VM can meet the 16,000 IOPS requirement using four P30 disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-446">A Standard\_DS13 VM can meet the 16,000 IOPS requirement using four P30 disks.</span></span> <span data-ttu-id="413a7-447">The DS13 VM has a maximum IOPS of 25,600 and each P30 disk has a maximum IOPS of 5,000.</span><span class="sxs-lookup"><span data-stu-id="413a7-447">The DS13 VM has a maximum IOPS of 25,600 and each P30 disk has a maximum IOPS of 5,000.</span></span> <span data-ttu-id="413a7-448">Overall, this configuration can achieve 5,000 x 4 = 20,000 IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-448">Overall, this configuration can achieve 5,000 x 4 = 20,000 IOPS.</span></span> <span data-ttu-id="413a7-449">The estimated cost of this VM per month will be $1,003.</span><span class="sxs-lookup"><span data-stu-id="413a7-449">The estimated cost of this VM per month will be $1,003.</span></span> <span data-ttu-id="413a7-450">The monthly cost of four P30 premium storage disks will be $544.34.</span><span class="sxs-lookup"><span data-stu-id="413a7-450">The monthly cost of four P30 premium storage disks will be $544.34.</span></span> <span data-ttu-id="413a7-451">The estimated total monthly cost will be $1,544.</span><span class="sxs-lookup"><span data-stu-id="413a7-451">The estimated total monthly cost will be $1,544.</span></span>

<span data-ttu-id="413a7-452">Table below summarizes the cost breakdown of this scenario for Standard and Premium Storage.</span><span class="sxs-lookup"><span data-stu-id="413a7-452">Table below summarizes the cost breakdown of this scenario for Standard and Premium Storage.</span></span>

| &nbsp; | <span data-ttu-id="413a7-453">**Standard**</span><span class="sxs-lookup"><span data-stu-id="413a7-453">**Standard**</span></span> | <span data-ttu-id="413a7-454">**Premium**</span><span class="sxs-lookup"><span data-stu-id="413a7-454">**Premium**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="413a7-455">**Cost of VM per month**</span><span class="sxs-lookup"><span data-stu-id="413a7-455">**Cost of VM per month**</span></span> |<span data-ttu-id="413a7-456">$1,570.58 (Standard\_D14)</span><span class="sxs-lookup"><span data-stu-id="413a7-456">$1,570.58 (Standard\_D14)</span></span> |<span data-ttu-id="413a7-457">$1,003.66 (Standard\_DS13)</span><span class="sxs-lookup"><span data-stu-id="413a7-457">$1,003.66 (Standard\_DS13)</span></span> |
| <span data-ttu-id="413a7-458">**Cost of Disks per month**</span><span class="sxs-lookup"><span data-stu-id="413a7-458">**Cost of Disks per month**</span></span> |<span data-ttu-id="413a7-459">$1,638.40 (32 x 1 TB disks)</span><span class="sxs-lookup"><span data-stu-id="413a7-459">$1,638.40 (32 x 1 TB disks)</span></span> |<span data-ttu-id="413a7-460">$544.34 (4 x P30 disks)</span><span class="sxs-lookup"><span data-stu-id="413a7-460">$544.34 (4 x P30 disks)</span></span> |
| <span data-ttu-id="413a7-461">**Overall Cost per month**</span><span class="sxs-lookup"><span data-stu-id="413a7-461">**Overall Cost per month**</span></span> |<span data-ttu-id="413a7-462">$3,208.98</span><span class="sxs-lookup"><span data-stu-id="413a7-462">$3,208.98</span></span> |<span data-ttu-id="413a7-463">$1,544.34</span><span class="sxs-lookup"><span data-stu-id="413a7-463">$1,544.34</span></span> |

<span data-ttu-id="413a7-464">*Linux Distros*</span><span class="sxs-lookup"><span data-stu-id="413a7-464">*Linux Distros*</span></span>  

<span data-ttu-id="413a7-465">With Azure Premium Storage, you get the same level of Performance for VMs running Windows and Linux.</span><span class="sxs-lookup"><span data-stu-id="413a7-465">With Azure Premium Storage, you get the same level of Performance for VMs running Windows and Linux.</span></span> <span data-ttu-id="413a7-466">We support many flavors of Linux distros, and you can see the complete list [here](../articles/virtual-machines/linux/endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="413a7-466">We support many flavors of Linux distros, and you can see the complete list [here](../articles/virtual-machines/linux/endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span> <span data-ttu-id="413a7-467">It is important to note that different distros are better suited for different types of workloads.</span><span class="sxs-lookup"><span data-stu-id="413a7-467">It is important to note that different distros are better suited for different types of workloads.</span></span> <span data-ttu-id="413a7-468">You will see different levels of performance depending on the distro your workload is running on.</span><span class="sxs-lookup"><span data-stu-id="413a7-468">You will see different levels of performance depending on the distro your workload is running on.</span></span> <span data-ttu-id="413a7-469">Test the Linux distros with your application and choose the one that works best.</span><span class="sxs-lookup"><span data-stu-id="413a7-469">Test the Linux distros with your application and choose the one that works best.</span></span>

<span data-ttu-id="413a7-470">When running Linux with Premium Storage, check the latest updates about required drivers to ensure high performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-470">When running Linux with Premium Storage, check the latest updates about required drivers to ensure high performance.</span></span>

## <a name="premium-storage-disk-sizes"></a><span data-ttu-id="413a7-471">Premium Storage Disk Sizes</span><span class="sxs-lookup"><span data-stu-id="413a7-471">Premium Storage Disk Sizes</span></span>
<span data-ttu-id="413a7-472">Azure Premium Storage offers eight disk sizes currently.</span><span class="sxs-lookup"><span data-stu-id="413a7-472">Azure Premium Storage offers eight disk sizes currently.</span></span> <span data-ttu-id="413a7-473">Each disk size has a different scale limit for IOPS, Bandwidth and Storage.</span><span class="sxs-lookup"><span data-stu-id="413a7-473">Each disk size has a different scale limit for IOPS, Bandwidth and Storage.</span></span> <span data-ttu-id="413a7-474">Choose the right Premium Storage Disk size depending on the application requirements and the high scale VM size.</span><span class="sxs-lookup"><span data-stu-id="413a7-474">Choose the right Premium Storage Disk size depending on the application requirements and the high scale VM size.</span></span> <span data-ttu-id="413a7-475">The table below shows the eight disks sizes and their capabilities.</span><span class="sxs-lookup"><span data-stu-id="413a7-475">The table below shows the eight disks sizes and their capabilities.</span></span> <span data-ttu-id="413a7-476">P4, P6, and P15 sizes are currently only supported for Managed Disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-476">P4, P6, and P15 sizes are currently only supported for Managed Disks.</span></span>

| <span data-ttu-id="413a7-477">Premium Disks Type</span><span class="sxs-lookup"><span data-stu-id="413a7-477">Premium Disks Type</span></span>  | <span data-ttu-id="413a7-478">P4</span><span class="sxs-lookup"><span data-stu-id="413a7-478">P4</span></span>    | <span data-ttu-id="413a7-479">P6</span><span class="sxs-lookup"><span data-stu-id="413a7-479">P6</span></span>    | <span data-ttu-id="413a7-480">P10</span><span class="sxs-lookup"><span data-stu-id="413a7-480">P10</span></span>   | <span data-ttu-id="413a7-481">P15</span><span class="sxs-lookup"><span data-stu-id="413a7-481">P15</span></span> | <span data-ttu-id="413a7-482">P20</span><span class="sxs-lookup"><span data-stu-id="413a7-482">P20</span></span>   | <span data-ttu-id="413a7-483">P30</span><span class="sxs-lookup"><span data-stu-id="413a7-483">P30</span></span>   | <span data-ttu-id="413a7-484">P40</span><span class="sxs-lookup"><span data-stu-id="413a7-484">P40</span></span>   | <span data-ttu-id="413a7-485">P50</span><span class="sxs-lookup"><span data-stu-id="413a7-485">P50</span></span>   | 
|---------------------|-------|-------|-------|-------|-------|-------|-------|-------|
| <span data-ttu-id="413a7-486">Disk size</span><span class="sxs-lookup"><span data-stu-id="413a7-486">Disk size</span></span>           | <span data-ttu-id="413a7-487">32 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-487">32 GB</span></span> | <span data-ttu-id="413a7-488">64 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-488">64 GB</span></span> | <span data-ttu-id="413a7-489">128 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-489">128 GB</span></span>| <span data-ttu-id="413a7-490">256 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-490">256 GB</span></span>| <span data-ttu-id="413a7-491">512 GB</span><span class="sxs-lookup"><span data-stu-id="413a7-491">512 GB</span></span>            | <span data-ttu-id="413a7-492">1024 GB (1 TB)</span><span class="sxs-lookup"><span data-stu-id="413a7-492">1024 GB (1 TB)</span></span>    | <span data-ttu-id="413a7-493">2048 GB (2 TB)</span><span class="sxs-lookup"><span data-stu-id="413a7-493">2048 GB (2 TB)</span></span>    | <span data-ttu-id="413a7-494">4095 GB (4 TB)</span><span class="sxs-lookup"><span data-stu-id="413a7-494">4095 GB (4 TB)</span></span>    | 
| <span data-ttu-id="413a7-495">IOPS per disk</span><span class="sxs-lookup"><span data-stu-id="413a7-495">IOPS per disk</span></span>       | <span data-ttu-id="413a7-496">120</span><span class="sxs-lookup"><span data-stu-id="413a7-496">120</span></span>   | <span data-ttu-id="413a7-497">240</span><span class="sxs-lookup"><span data-stu-id="413a7-497">240</span></span>   | <span data-ttu-id="413a7-498">500</span><span class="sxs-lookup"><span data-stu-id="413a7-498">500</span></span>   | <span data-ttu-id="413a7-499">1100</span><span class="sxs-lookup"><span data-stu-id="413a7-499">1100</span></span> | <span data-ttu-id="413a7-500">2300</span><span class="sxs-lookup"><span data-stu-id="413a7-500">2300</span></span>              | <span data-ttu-id="413a7-501">5000</span><span class="sxs-lookup"><span data-stu-id="413a7-501">5000</span></span>              | <span data-ttu-id="413a7-502">7500</span><span class="sxs-lookup"><span data-stu-id="413a7-502">7500</span></span>              | <span data-ttu-id="413a7-503">7500</span><span class="sxs-lookup"><span data-stu-id="413a7-503">7500</span></span>              | 
| <span data-ttu-id="413a7-504">Throughput per disk</span><span class="sxs-lookup"><span data-stu-id="413a7-504">Throughput per disk</span></span> | <span data-ttu-id="413a7-505">25 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-505">25 MB per second</span></span>  | <span data-ttu-id="413a7-506">50 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-506">50 MB per second</span></span>  | <span data-ttu-id="413a7-507">100 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-507">100 MB per second</span></span> |<span data-ttu-id="413a7-508">125 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-508">125 MB per second</span></span> | <span data-ttu-id="413a7-509">150 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-509">150 MB per second</span></span> | <span data-ttu-id="413a7-510">200 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-510">200 MB per second</span></span> | <span data-ttu-id="413a7-511">250 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-511">250 MB per second</span></span> | <span data-ttu-id="413a7-512">250 MB per second</span><span class="sxs-lookup"><span data-stu-id="413a7-512">250 MB per second</span></span> | 


<span data-ttu-id="413a7-513">How many disks you choose depends on the disk size chosen.</span><span class="sxs-lookup"><span data-stu-id="413a7-513">How many disks you choose depends on the disk size chosen.</span></span> <span data-ttu-id="413a7-514">You could use a single P50 disk or multiple P10 disks to meet your application requirement.</span><span class="sxs-lookup"><span data-stu-id="413a7-514">You could use a single P50 disk or multiple P10 disks to meet your application requirement.</span></span> <span data-ttu-id="413a7-515">Take into account considerations listed below when making the choice.</span><span class="sxs-lookup"><span data-stu-id="413a7-515">Take into account considerations listed below when making the choice.</span></span>

<span data-ttu-id="413a7-516">*Scale Limits (IOPS and Throughput)*</span><span class="sxs-lookup"><span data-stu-id="413a7-516">*Scale Limits (IOPS and Throughput)*</span></span>  
<span data-ttu-id="413a7-517">The IOPS and Throughput limits of each Premium disk size is different and independent from the VM scale limits.</span><span class="sxs-lookup"><span data-stu-id="413a7-517">The IOPS and Throughput limits of each Premium disk size is different and independent from the VM scale limits.</span></span> <span data-ttu-id="413a7-518">Make sure that the total IOPS and Throughput from the disks are within scale limits of the chosen VM size.</span><span class="sxs-lookup"><span data-stu-id="413a7-518">Make sure that the total IOPS and Throughput from the disks are within scale limits of the chosen VM size.</span></span>

<span data-ttu-id="413a7-519">For example, if an application requirement is a maximum of 250 MB/sec Throughput and you are using a DS4 VM with a single P30 disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-519">For example, if an application requirement is a maximum of 250 MB/sec Throughput and you are using a DS4 VM with a single P30 disk.</span></span> <span data-ttu-id="413a7-520">The DS4 VM can give up to 256 MB/sec Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-520">The DS4 VM can give up to 256 MB/sec Throughput.</span></span> <span data-ttu-id="413a7-521">However, a single P30 disk has Throughput limit of 200 MB/sec. Consequently, the application will be constrained at 200 MB/sec due to the disk limit.</span><span class="sxs-lookup"><span data-stu-id="413a7-521">However, a single P30 disk has Throughput limit of 200 MB/sec. Consequently, the application will be constrained at 200 MB/sec due to the disk limit.</span></span> <span data-ttu-id="413a7-522">To overcome this limit, provision more than one data disks to the VM or resize your disks to P40 or P50.</span><span class="sxs-lookup"><span data-stu-id="413a7-522">To overcome this limit, provision more than one data disks to the VM or resize your disks to P40 or P50.</span></span>

> [!NOTE]
> <span data-ttu-id="413a7-523">Reads served by the cache are not included in the disk IOPS and Throughput, hence not subject to disk limits.</span><span class="sxs-lookup"><span data-stu-id="413a7-523">Reads served by the cache are not included in the disk IOPS and Throughput, hence not subject to disk limits.</span></span> <span data-ttu-id="413a7-524">Cache has its separate IOPS and Throughput limit per VM.</span><span class="sxs-lookup"><span data-stu-id="413a7-524">Cache has its separate IOPS and Throughput limit per VM.</span></span>
>
> <span data-ttu-id="413a7-525">For example, initially your reads and writes are 60MB/sec and 40MB/sec respectively.</span><span class="sxs-lookup"><span data-stu-id="413a7-525">For example, initially your reads and writes are 60MB/sec and 40MB/sec respectively.</span></span> <span data-ttu-id="413a7-526">Over time, the cache warms up and serves more and more of the reads from the cache.</span><span class="sxs-lookup"><span data-stu-id="413a7-526">Over time, the cache warms up and serves more and more of the reads from the cache.</span></span> <span data-ttu-id="413a7-527">Then, you can get higher write Throughput from the disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-527">Then, you can get higher write Throughput from the disk.</span></span>
>
>

<span data-ttu-id="413a7-528">*Number of Disks*</span><span class="sxs-lookup"><span data-stu-id="413a7-528">*Number of Disks*</span></span>  
<span data-ttu-id="413a7-529">Determine the number of disks you will need by assessing application requirements.</span><span class="sxs-lookup"><span data-stu-id="413a7-529">Determine the number of disks you will need by assessing application requirements.</span></span> <span data-ttu-id="413a7-530">Each VM size also has a limit on the number of disks that you can attach to the VM.</span><span class="sxs-lookup"><span data-stu-id="413a7-530">Each VM size also has a limit on the number of disks that you can attach to the VM.</span></span> <span data-ttu-id="413a7-531">Typically, this is twice the number of cores.</span><span class="sxs-lookup"><span data-stu-id="413a7-531">Typically, this is twice the number of cores.</span></span> <span data-ttu-id="413a7-532">Ensure that the VM size you choose can support the number of disks needed.</span><span class="sxs-lookup"><span data-stu-id="413a7-532">Ensure that the VM size you choose can support the number of disks needed.</span></span>

<span data-ttu-id="413a7-533">Remember, the Premium Storage disks have higher performance capabilities compared to Standard Storage disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-533">Remember, the Premium Storage disks have higher performance capabilities compared to Standard Storage disks.</span></span> <span data-ttu-id="413a7-534">Therefore, if you are migrating your application from Azure IaaS VM using Standard Storage to Premium Storage, you will likely need fewer premium disks to achieve the same or higher performance for your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-534">Therefore, if you are migrating your application from Azure IaaS VM using Standard Storage to Premium Storage, you will likely need fewer premium disks to achieve the same or higher performance for your application.</span></span>

## <a name="disk-caching"></a><span data-ttu-id="413a7-535">Disk Caching</span><span class="sxs-lookup"><span data-stu-id="413a7-535">Disk Caching</span></span>
<span data-ttu-id="413a7-536">High Scale VMs that leverage Azure Premium Storage have a multi-tier caching technology called BlobCache.</span><span class="sxs-lookup"><span data-stu-id="413a7-536">High Scale VMs that leverage Azure Premium Storage have a multi-tier caching technology called BlobCache.</span></span> <span data-ttu-id="413a7-537">BlobCache uses a combination of the Virtual Machine RAM and local SSD for caching.</span><span class="sxs-lookup"><span data-stu-id="413a7-537">BlobCache uses a combination of the Virtual Machine RAM and local SSD for caching.</span></span> <span data-ttu-id="413a7-538">This cache is available for the Premium Storage persistent disks and the VM local disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-538">This cache is available for the Premium Storage persistent disks and the VM local disks.</span></span> <span data-ttu-id="413a7-539">By default, this cache setting is set to Read/Write for OS disks and ReadOnly for data disks hosted on Premium Storage.</span><span class="sxs-lookup"><span data-stu-id="413a7-539">By default, this cache setting is set to Read/Write for OS disks and ReadOnly for data disks hosted on Premium Storage.</span></span> <span data-ttu-id="413a7-540">With disk caching enabled on the Premium Storage disks, the high scale VMs can achieve extremely high levels of performance that exceed the underlying disk performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-540">With disk caching enabled on the Premium Storage disks, the high scale VMs can achieve extremely high levels of performance that exceed the underlying disk performance.</span></span>

> [!WARNING]
> <span data-ttu-id="413a7-541">Changing the cache setting of an Azure disk detaches and re-attaches the target disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-541">Changing the cache setting of an Azure disk detaches and re-attaches the target disk.</span></span> <span data-ttu-id="413a7-542">If it is the operating system disk, the VM is restarted.</span><span class="sxs-lookup"><span data-stu-id="413a7-542">If it is the operating system disk, the VM is restarted.</span></span> <span data-ttu-id="413a7-543">Stop all applications/services that might be affected by this disruption before changing the disk cache setting.</span><span class="sxs-lookup"><span data-stu-id="413a7-543">Stop all applications/services that might be affected by this disruption before changing the disk cache setting.</span></span>
>
>

<span data-ttu-id="413a7-544">To learn more about how BlobCache works, refer to the Inside [Azure Premium Storage](https://azure.microsoft.com/blog/azure-premium-storage-now-generally-available-2/) blog post.</span><span class="sxs-lookup"><span data-stu-id="413a7-544">To learn more about how BlobCache works, refer to the Inside [Azure Premium Storage](https://azure.microsoft.com/blog/azure-premium-storage-now-generally-available-2/) blog post.</span></span>

<span data-ttu-id="413a7-545">It is important to enable cache on the right set of disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-545">It is important to enable cache on the right set of disks.</span></span> <span data-ttu-id="413a7-546">Whether you should enable disk caching on a premium disk or not will depend on the workload pattern that disk will be handling.</span><span class="sxs-lookup"><span data-stu-id="413a7-546">Whether you should enable disk caching on a premium disk or not will depend on the workload pattern that disk will be handling.</span></span> <span data-ttu-id="413a7-547">Table below shows the default cache settings for OS and Data disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-547">Table below shows the default cache settings for OS and Data disks.</span></span>

| <span data-ttu-id="413a7-548">**Disk Type**</span><span class="sxs-lookup"><span data-stu-id="413a7-548">**Disk Type**</span></span> | <span data-ttu-id="413a7-549">**Default Cache Setting**</span><span class="sxs-lookup"><span data-stu-id="413a7-549">**Default Cache Setting**</span></span> |
| --- | --- |
| <span data-ttu-id="413a7-550">OS disk</span><span class="sxs-lookup"><span data-stu-id="413a7-550">OS disk</span></span> |<span data-ttu-id="413a7-551">ReadWrite</span><span class="sxs-lookup"><span data-stu-id="413a7-551">ReadWrite</span></span> |
| <span data-ttu-id="413a7-552">Data disk</span><span class="sxs-lookup"><span data-stu-id="413a7-552">Data disk</span></span> |<span data-ttu-id="413a7-553">ReadOnly</span><span class="sxs-lookup"><span data-stu-id="413a7-553">ReadOnly</span></span> |

<span data-ttu-id="413a7-554">Following are the recommended disk cache settings for data disks,</span><span class="sxs-lookup"><span data-stu-id="413a7-554">Following are the recommended disk cache settings for data disks,</span></span>

| <span data-ttu-id="413a7-555">**Disk Caching Setting**</span><span class="sxs-lookup"><span data-stu-id="413a7-555">**Disk Caching Setting**</span></span> | <span data-ttu-id="413a7-556">**Recommendation on when to use this setting**</span><span class="sxs-lookup"><span data-stu-id="413a7-556">**Recommendation on when to use this setting**</span></span> |
| --- | --- |
| <span data-ttu-id="413a7-557">None</span><span class="sxs-lookup"><span data-stu-id="413a7-557">None</span></span> |<span data-ttu-id="413a7-558">Configure host-cache as None for write-only and write-heavy disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-558">Configure host-cache as None for write-only and write-heavy disks.</span></span> |
| <span data-ttu-id="413a7-559">ReadOnly</span><span class="sxs-lookup"><span data-stu-id="413a7-559">ReadOnly</span></span> |<span data-ttu-id="413a7-560">Configure host-cache as ReadOnly for read-only and read-write disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-560">Configure host-cache as ReadOnly for read-only and read-write disks.</span></span> |
| <span data-ttu-id="413a7-561">ReadWrite</span><span class="sxs-lookup"><span data-stu-id="413a7-561">ReadWrite</span></span> |<span data-ttu-id="413a7-562">Configure host-cache as ReadWrite only if your application properly  handles writing cached data to persistent disks when needed.</span><span class="sxs-lookup"><span data-stu-id="413a7-562">Configure host-cache as ReadWrite only if your application properly  handles writing cached data to persistent disks when needed.</span></span> |

<span data-ttu-id="413a7-563">*ReadOnly*</span><span class="sxs-lookup"><span data-stu-id="413a7-563">*ReadOnly*</span></span>  
<span data-ttu-id="413a7-564">By configuring ReadOnly caching on Premium Storage data disks, you can achieve low Read latency and get very high Read IOPS and Throughput for your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-564">By configuring ReadOnly caching on Premium Storage data disks, you can achieve low Read latency and get very high Read IOPS and Throughput for your application.</span></span> <span data-ttu-id="413a7-565">This is due two reasons,</span><span class="sxs-lookup"><span data-stu-id="413a7-565">This is due two reasons,</span></span>

1. <span data-ttu-id="413a7-566">Reads performed from cache, which is on the VM memory and local SSD, are much faster than reads from the data disk, which is on the Azure blob storage.</span><span class="sxs-lookup"><span data-stu-id="413a7-566">Reads performed from cache, which is on the VM memory and local SSD, are much faster than reads from the data disk, which is on the Azure blob storage.</span></span>  
1. <span data-ttu-id="413a7-567">Premium Storage does not count the Reads served from cache, towards the disk IOPS and Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-567">Premium Storage does not count the Reads served from cache, towards the disk IOPS and Throughput.</span></span> <span data-ttu-id="413a7-568">Therefore, your application is able to achieve higher total IOPS and Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-568">Therefore, your application is able to achieve higher total IOPS and Throughput.</span></span>

<span data-ttu-id="413a7-569">*ReadWrite*</span><span class="sxs-lookup"><span data-stu-id="413a7-569">*ReadWrite*</span></span>  
<span data-ttu-id="413a7-570">By default, the OS disks have ReadWrite caching enabled.</span><span class="sxs-lookup"><span data-stu-id="413a7-570">By default, the OS disks have ReadWrite caching enabled.</span></span> <span data-ttu-id="413a7-571">We have recently added support for ReadWrite caching on data disks as well.</span><span class="sxs-lookup"><span data-stu-id="413a7-571">We have recently added support for ReadWrite caching on data disks as well.</span></span> <span data-ttu-id="413a7-572">If you are using ReadWrite caching, you must have a proper way to write the data from cache to persistent disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-572">If you are using ReadWrite caching, you must have a proper way to write the data from cache to persistent disks.</span></span> <span data-ttu-id="413a7-573">For example, SQL Server handles writing cached data to the persistent storage disks on its own.</span><span class="sxs-lookup"><span data-stu-id="413a7-573">For example, SQL Server handles writing cached data to the persistent storage disks on its own.</span></span> <span data-ttu-id="413a7-574">Using ReadWrite cache with an application that does not handle persisting the required data can lead to data loss, if the VM crashes.</span><span class="sxs-lookup"><span data-stu-id="413a7-574">Using ReadWrite cache with an application that does not handle persisting the required data can lead to data loss, if the VM crashes.</span></span>

<span data-ttu-id="413a7-575">As an example, you can apply these guidelines to SQL Server running on Premium Storage by doing the following,</span><span class="sxs-lookup"><span data-stu-id="413a7-575">As an example, you can apply these guidelines to SQL Server running on Premium Storage by doing the following,</span></span>

1. <span data-ttu-id="413a7-576">Configure "ReadOnly" cache on premium storage disks hosting data files.</span><span class="sxs-lookup"><span data-stu-id="413a7-576">Configure "ReadOnly" cache on premium storage disks hosting data files.</span></span>  
   <span data-ttu-id="413a7-577">a.</span><span class="sxs-lookup"><span data-stu-id="413a7-577">a.</span></span>  <span data-ttu-id="413a7-578">The fast reads from cache lower the SQL Server query time since data pages are retrieved much faster from the cache compared to directly from the data disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-578">The fast reads from cache lower the SQL Server query time since data pages are retrieved much faster from the cache compared to directly from the data disks.</span></span>  
   <span data-ttu-id="413a7-579">b.</span><span class="sxs-lookup"><span data-stu-id="413a7-579">b.</span></span>  <span data-ttu-id="413a7-580">Serving reads from cache, means there is additional Throughput available from premium data disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-580">Serving reads from cache, means there is additional Throughput available from premium data disks.</span></span> <span data-ttu-id="413a7-581">SQL Server can use this additional Throughput towards retrieving more data pages and other operations like backup/restore, batch loads, and index rebuilds.</span><span class="sxs-lookup"><span data-stu-id="413a7-581">SQL Server can use this additional Throughput towards retrieving more data pages and other operations like backup/restore, batch loads, and index rebuilds.</span></span>  
1. <span data-ttu-id="413a7-582">Configure "None" cache on premium storage disks hosting the log files.</span><span class="sxs-lookup"><span data-stu-id="413a7-582">Configure "None" cache on premium storage disks hosting the log files.</span></span>  
   <span data-ttu-id="413a7-583">a.</span><span class="sxs-lookup"><span data-stu-id="413a7-583">a.</span></span>  <span data-ttu-id="413a7-584">Log files have primarily write-heavy operations.</span><span class="sxs-lookup"><span data-stu-id="413a7-584">Log files have primarily write-heavy operations.</span></span> <span data-ttu-id="413a7-585">Therefore, they do not benefit from the ReadOnly cache.</span><span class="sxs-lookup"><span data-stu-id="413a7-585">Therefore, they do not benefit from the ReadOnly cache.</span></span>

## <a name="disk-striping"></a><span data-ttu-id="413a7-586">Disk Striping</span><span class="sxs-lookup"><span data-stu-id="413a7-586">Disk Striping</span></span>
<span data-ttu-id="413a7-587">When a high scale VM is attached with several premium storage persistent disks, the disks can be striped together to aggregate their IOPs, bandwidth, and storage capacity.</span><span class="sxs-lookup"><span data-stu-id="413a7-587">When a high scale VM is attached with several premium storage persistent disks, the disks can be striped together to aggregate their IOPs, bandwidth, and storage capacity.</span></span>

<span data-ttu-id="413a7-588">On Windows, you can use Storage Spaces to stripe disks together.</span><span class="sxs-lookup"><span data-stu-id="413a7-588">On Windows, you can use Storage Spaces to stripe disks together.</span></span> <span data-ttu-id="413a7-589">You must configure one column for each disk in a pool.</span><span class="sxs-lookup"><span data-stu-id="413a7-589">You must configure one column for each disk in a pool.</span></span> <span data-ttu-id="413a7-590">Otherwise, the overall performance of striped volume can be lower than expected, due to uneven distribution of traffic across the disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-590">Otherwise, the overall performance of striped volume can be lower than expected, due to uneven distribution of traffic across the disks.</span></span>

<span data-ttu-id="413a7-591">Important: Using Server Manager UI, you can set the total number of columns up to 8 for a striped volume.</span><span class="sxs-lookup"><span data-stu-id="413a7-591">Important: Using Server Manager UI, you can set the total number of columns up to 8 for a striped volume.</span></span> <span data-ttu-id="413a7-592">When attaching more than 8 disks, use PowerShell to create the volume.</span><span class="sxs-lookup"><span data-stu-id="413a7-592">When attaching more than 8 disks, use PowerShell to create the volume.</span></span> <span data-ttu-id="413a7-593">Using PowerShell, you can set the number of columns equal to the number of disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-593">Using PowerShell, you can set the number of columns equal to the number of disks.</span></span> <span data-ttu-id="413a7-594">For example, if there are 16 disks in a single stripe set; specify 16 columns in the *NumberOfColumns* parameter of the *New-VirtualDisk* PowerShell cmdlet.</span><span class="sxs-lookup"><span data-stu-id="413a7-594">For example, if there are 16 disks in a single stripe set; specify 16 columns in the *NumberOfColumns* parameter of the *New-VirtualDisk* PowerShell cmdlet.</span></span>

<span data-ttu-id="413a7-595">On Linux, use the MDADM utility to stripe disks together.</span><span class="sxs-lookup"><span data-stu-id="413a7-595">On Linux, use the MDADM utility to stripe disks together.</span></span> <span data-ttu-id="413a7-596">For detailed steps on striping disks on Linux refer to [Configure Software RAID on Linux](../articles/virtual-machines/linux/configure-raid.md).</span><span class="sxs-lookup"><span data-stu-id="413a7-596">For detailed steps on striping disks on Linux refer to [Configure Software RAID on Linux](../articles/virtual-machines/linux/configure-raid.md).</span></span>

<span data-ttu-id="413a7-597">*Stripe Size*</span><span class="sxs-lookup"><span data-stu-id="413a7-597">*Stripe Size*</span></span>  
<span data-ttu-id="413a7-598">An important configuration in disk striping is the stripe size.</span><span class="sxs-lookup"><span data-stu-id="413a7-598">An important configuration in disk striping is the stripe size.</span></span> <span data-ttu-id="413a7-599">The stripe size or block size is the smallest chunk of data that application can address on a striped volume.</span><span class="sxs-lookup"><span data-stu-id="413a7-599">The stripe size or block size is the smallest chunk of data that application can address on a striped volume.</span></span> <span data-ttu-id="413a7-600">The stripe size you configure depends on the type of application and its request pattern.</span><span class="sxs-lookup"><span data-stu-id="413a7-600">The stripe size you configure depends on the type of application and its request pattern.</span></span> <span data-ttu-id="413a7-601">If you choose the wrong stripe size, it could lead to IO misalignment, which leads to degraded performance of your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-601">If you choose the wrong stripe size, it could lead to IO misalignment, which leads to degraded performance of your application.</span></span>

<span data-ttu-id="413a7-602">For example, if an IO request generated by your application is bigger than the disk stripe size, the storage system writes it across stripe unit boundaries on more than one disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-602">For example, if an IO request generated by your application is bigger than the disk stripe size, the storage system writes it across stripe unit boundaries on more than one disk.</span></span> <span data-ttu-id="413a7-603">When it is time to access that data, it will have to seek across more than one stripe units to complete the request.</span><span class="sxs-lookup"><span data-stu-id="413a7-603">When it is time to access that data, it will have to seek across more than one stripe units to complete the request.</span></span> <span data-ttu-id="413a7-604">The cumulative effect of such behavior can lead to substantial performance degradation.</span><span class="sxs-lookup"><span data-stu-id="413a7-604">The cumulative effect of such behavior can lead to substantial performance degradation.</span></span> <span data-ttu-id="413a7-605">On the other hand, if the IO request size is smaller than stripe size, and if it is random in nature, the IO requests may add up on the same disk causing a bottleneck and ultimately degrading the IO performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-605">On the other hand, if the IO request size is smaller than stripe size, and if it is random in nature, the IO requests may add up on the same disk causing a bottleneck and ultimately degrading the IO performance.</span></span>

<span data-ttu-id="413a7-606">Depending on the type of workload your application is running, choose an appropriate stripe size.</span><span class="sxs-lookup"><span data-stu-id="413a7-606">Depending on the type of workload your application is running, choose an appropriate stripe size.</span></span> <span data-ttu-id="413a7-607">For random small IO requests, use a smaller stripe size.</span><span class="sxs-lookup"><span data-stu-id="413a7-607">For random small IO requests, use a smaller stripe size.</span></span> <span data-ttu-id="413a7-608">Whereas, for large sequential IO requests use a larger stripe size.</span><span class="sxs-lookup"><span data-stu-id="413a7-608">Whereas, for large sequential IO requests use a larger stripe size.</span></span> <span data-ttu-id="413a7-609">Find out the stripe size recommendations for the application you will be running on Premium Storage.</span><span class="sxs-lookup"><span data-stu-id="413a7-609">Find out the stripe size recommendations for the application you will be running on Premium Storage.</span></span> <span data-ttu-id="413a7-610">For SQL Server, configure stripe size of 64KB for OLTP workloads and 256KB for data warehousing workloads.</span><span class="sxs-lookup"><span data-stu-id="413a7-610">For SQL Server, configure stripe size of 64KB for OLTP workloads and 256KB for data warehousing workloads.</span></span> <span data-ttu-id="413a7-611">See [Performance best practices for SQL Server on Azure VMs](../articles/virtual-machines/windows/sql/virtual-machines-windows-sql-performance.md#disks-guidance) to learn more.</span><span class="sxs-lookup"><span data-stu-id="413a7-611">See [Performance best practices for SQL Server on Azure VMs](../articles/virtual-machines/windows/sql/virtual-machines-windows-sql-performance.md#disks-guidance) to learn more.</span></span>

> [!NOTE]
> <span data-ttu-id="413a7-612">You can stripe together a maximum of 32 premium storage disks on a DS series VM and 64 premium storage disks on a GS series VM.</span><span class="sxs-lookup"><span data-stu-id="413a7-612">You can stripe together a maximum of 32 premium storage disks on a DS series VM and 64 premium storage disks on a GS series VM.</span></span>
>
>

## <a name="multi-threading"></a><span data-ttu-id="413a7-613">Multi-threading</span><span class="sxs-lookup"><span data-stu-id="413a7-613">Multi-threading</span></span>
<span data-ttu-id="413a7-614">Azure has designed Premium Storage platform to be massively parallel.</span><span class="sxs-lookup"><span data-stu-id="413a7-614">Azure has designed Premium Storage platform to be massively parallel.</span></span> <span data-ttu-id="413a7-615">Therefore, a multi-threaded application achieves much higher performance than a single-threaded application.</span><span class="sxs-lookup"><span data-stu-id="413a7-615">Therefore, a multi-threaded application achieves much higher performance than a single-threaded application.</span></span> <span data-ttu-id="413a7-616">A multi-threaded application splits up its tasks across multiple threads and increases efficiency of its execution by utilizing the VM and disk resources to the maximum.</span><span class="sxs-lookup"><span data-stu-id="413a7-616">A multi-threaded application splits up its tasks across multiple threads and increases efficiency of its execution by utilizing the VM and disk resources to the maximum.</span></span>

<span data-ttu-id="413a7-617">For example, if your application is running on a single core VM using two threads, the CPU can switch between the two threads to achieve efficiency.</span><span class="sxs-lookup"><span data-stu-id="413a7-617">For example, if your application is running on a single core VM using two threads, the CPU can switch between the two threads to achieve efficiency.</span></span> <span data-ttu-id="413a7-618">While one thread is waiting on a disk IO to complete, the CPU can switch to the other thread.</span><span class="sxs-lookup"><span data-stu-id="413a7-618">While one thread is waiting on a disk IO to complete, the CPU can switch to the other thread.</span></span> <span data-ttu-id="413a7-619">In this way, two threads can accomplish more than a single thread would.</span><span class="sxs-lookup"><span data-stu-id="413a7-619">In this way, two threads can accomplish more than a single thread would.</span></span> <span data-ttu-id="413a7-620">If the VM has more than one core, it further decreases running time since each core can execute tasks in parallel.</span><span class="sxs-lookup"><span data-stu-id="413a7-620">If the VM has more than one core, it further decreases running time since each core can execute tasks in parallel.</span></span>

<span data-ttu-id="413a7-621">You may not be able to change the way an off-the-shelf application implements single threading or multi-threading.</span><span class="sxs-lookup"><span data-stu-id="413a7-621">You may not be able to change the way an off-the-shelf application implements single threading or multi-threading.</span></span> <span data-ttu-id="413a7-622">For example, SQL Server is capable of handling multi-CPU and multi-core.</span><span class="sxs-lookup"><span data-stu-id="413a7-622">For example, SQL Server is capable of handling multi-CPU and multi-core.</span></span> <span data-ttu-id="413a7-623">However, SQL Server decides under what conditions it will leverage one or more threads to process a query.</span><span class="sxs-lookup"><span data-stu-id="413a7-623">However, SQL Server decides under what conditions it will leverage one or more threads to process a query.</span></span> <span data-ttu-id="413a7-624">It can run queries and build indexes using multi-threading.</span><span class="sxs-lookup"><span data-stu-id="413a7-624">It can run queries and build indexes using multi-threading.</span></span> <span data-ttu-id="413a7-625">For a query that involves joining large tables and sorting data before returning to the user, SQL Server will likely use multiple threads.</span><span class="sxs-lookup"><span data-stu-id="413a7-625">For a query that involves joining large tables and sorting data before returning to the user, SQL Server will likely use multiple threads.</span></span> <span data-ttu-id="413a7-626">However, a user cannot control whether SQL Server executes a query using a single thread or multiple threads.</span><span class="sxs-lookup"><span data-stu-id="413a7-626">However, a user cannot control whether SQL Server executes a query using a single thread or multiple threads.</span></span>

<span data-ttu-id="413a7-627">There are configuration settings that you can alter to influence this multi-threading or parallel processing of an application.</span><span class="sxs-lookup"><span data-stu-id="413a7-627">There are configuration settings that you can alter to influence this multi-threading or parallel processing of an application.</span></span> <span data-ttu-id="413a7-628">For example, in case of SQL Server it is the maximum Degree of Parallelism configuration.</span><span class="sxs-lookup"><span data-stu-id="413a7-628">For example, in case of SQL Server it is the maximum Degree of Parallelism configuration.</span></span> <span data-ttu-id="413a7-629">This setting called MAXDOP, allows you to configure the maximum number of processors SQL Server can use when parallel processing.</span><span class="sxs-lookup"><span data-stu-id="413a7-629">This setting called MAXDOP, allows you to configure the maximum number of processors SQL Server can use when parallel processing.</span></span> <span data-ttu-id="413a7-630">You can configure MAXDOP for individual queries or index operations.</span><span class="sxs-lookup"><span data-stu-id="413a7-630">You can configure MAXDOP for individual queries or index operations.</span></span> <span data-ttu-id="413a7-631">This is beneficial when you want to balance resources of your system for a performance critical application.</span><span class="sxs-lookup"><span data-stu-id="413a7-631">This is beneficial when you want to balance resources of your system for a performance critical application.</span></span>

<span data-ttu-id="413a7-632">For example, say your application using SQL Server is executing a large query and an index operation at the same time.</span><span class="sxs-lookup"><span data-stu-id="413a7-632">For example, say your application using SQL Server is executing a large query and an index operation at the same time.</span></span> <span data-ttu-id="413a7-633">Let us assume that you wanted the index operation to be more performant compared to the large query.</span><span class="sxs-lookup"><span data-stu-id="413a7-633">Let us assume that you wanted the index operation to be more performant compared to the large query.</span></span> <span data-ttu-id="413a7-634">In such a case, you can set MAXDOP value of the index operation to be higher than the MAXDOP value for the query.</span><span class="sxs-lookup"><span data-stu-id="413a7-634">In such a case, you can set MAXDOP value of the index operation to be higher than the MAXDOP value for the query.</span></span> <span data-ttu-id="413a7-635">This way, SQL Server has more number of processors that it can leverage for the index operation compared to the number of processors it can dedicate to the large query.</span><span class="sxs-lookup"><span data-stu-id="413a7-635">This way, SQL Server has more number of processors that it can leverage for the index operation compared to the number of processors it can dedicate to the large query.</span></span> <span data-ttu-id="413a7-636">Remember, you do not control the number of threads SQL Server will use for each operation.</span><span class="sxs-lookup"><span data-stu-id="413a7-636">Remember, you do not control the number of threads SQL Server will use for each operation.</span></span> <span data-ttu-id="413a7-637">You can control the maximum number of processors being dedicated for multi-threading.</span><span class="sxs-lookup"><span data-stu-id="413a7-637">You can control the maximum number of processors being dedicated for multi-threading.</span></span>

<span data-ttu-id="413a7-638">Learn more about [Degrees of Parallelism](https://technet.microsoft.com/library/ms188611.aspx) in SQL Server.</span><span class="sxs-lookup"><span data-stu-id="413a7-638">Learn more about [Degrees of Parallelism](https://technet.microsoft.com/library/ms188611.aspx) in SQL Server.</span></span> <span data-ttu-id="413a7-639">Find out such settings that influence multi-threading in your application and their configurations to optimize performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-639">Find out such settings that influence multi-threading in your application and their configurations to optimize performance.</span></span>

## <a name="queue-depth"></a><span data-ttu-id="413a7-640">Queue Depth</span><span class="sxs-lookup"><span data-stu-id="413a7-640">Queue Depth</span></span>
<span data-ttu-id="413a7-641">The Queue Depth or Queue Length or Queue Size is the number of pending IO requests in the system.</span><span class="sxs-lookup"><span data-stu-id="413a7-641">The Queue Depth or Queue Length or Queue Size is the number of pending IO requests in the system.</span></span> <span data-ttu-id="413a7-642">The value of Queue Depth determines how many IO operations your application can line up, which the storage disks will be processing.</span><span class="sxs-lookup"><span data-stu-id="413a7-642">The value of Queue Depth determines how many IO operations your application can line up, which the storage disks will be processing.</span></span> <span data-ttu-id="413a7-643">It affects all the three application performance indicators that we discussed in this article viz., IOPS, Throughput and Latency.</span><span class="sxs-lookup"><span data-stu-id="413a7-643">It affects all the three application performance indicators that we discussed in this article viz., IOPS, Throughput and Latency.</span></span>

<span data-ttu-id="413a7-644">Queue Depth and multi-threading are closely related.</span><span class="sxs-lookup"><span data-stu-id="413a7-644">Queue Depth and multi-threading are closely related.</span></span> <span data-ttu-id="413a7-645">The Queue Depth value indicates how much multi-threading can be achieved by the application.</span><span class="sxs-lookup"><span data-stu-id="413a7-645">The Queue Depth value indicates how much multi-threading can be achieved by the application.</span></span> <span data-ttu-id="413a7-646">If the Queue Depth is large, application can execute more operations concurrently, in other words, more multi-threading.</span><span class="sxs-lookup"><span data-stu-id="413a7-646">If the Queue Depth is large, application can execute more operations concurrently, in other words, more multi-threading.</span></span> <span data-ttu-id="413a7-647">If the Queue Depth is small, even though application is multi-threaded, it will not have enough requests lined up for concurrent execution.</span><span class="sxs-lookup"><span data-stu-id="413a7-647">If the Queue Depth is small, even though application is multi-threaded, it will not have enough requests lined up for concurrent execution.</span></span>

<span data-ttu-id="413a7-648">Typically, off the shelf applications do not allow you to change the queue depth, because if set incorrectly it will do more harm than good.</span><span class="sxs-lookup"><span data-stu-id="413a7-648">Typically, off the shelf applications do not allow you to change the queue depth, because if set incorrectly it will do more harm than good.</span></span> <span data-ttu-id="413a7-649">Applications will set the right value of queue depth to get the optimal performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-649">Applications will set the right value of queue depth to get the optimal performance.</span></span> <span data-ttu-id="413a7-650">However, it is important to understand this concept so that you can troubleshoot performance issues with your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-650">However, it is important to understand this concept so that you can troubleshoot performance issues with your application.</span></span> <span data-ttu-id="413a7-651">You can also observe the effects of queue depth by running benchmarking tools on your system.</span><span class="sxs-lookup"><span data-stu-id="413a7-651">You can also observe the effects of queue depth by running benchmarking tools on your system.</span></span>

<span data-ttu-id="413a7-652">Some applications provide settings to influence the Queue Depth.</span><span class="sxs-lookup"><span data-stu-id="413a7-652">Some applications provide settings to influence the Queue Depth.</span></span> <span data-ttu-id="413a7-653">For example, the MAXDOP (maximum degree of parallelism) setting in SQL Server explained in previous section.</span><span class="sxs-lookup"><span data-stu-id="413a7-653">For example, the MAXDOP (maximum degree of parallelism) setting in SQL Server explained in previous section.</span></span> <span data-ttu-id="413a7-654">MAXDOP is a way to influence Queue Depth and multi-threading, although it does not directly change the Queue Depth value of SQL Server.</span><span class="sxs-lookup"><span data-stu-id="413a7-654">MAXDOP is a way to influence Queue Depth and multi-threading, although it does not directly change the Queue Depth value of SQL Server.</span></span>

<span data-ttu-id="413a7-655">*High Queue Depth*</span><span class="sxs-lookup"><span data-stu-id="413a7-655">*High Queue Depth*</span></span>  
<span data-ttu-id="413a7-656">A high queue depth lines up more operations on the disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-656">A high queue depth lines up more operations on the disk.</span></span> <span data-ttu-id="413a7-657">The disk knows the next request in its queue ahead of time.</span><span class="sxs-lookup"><span data-stu-id="413a7-657">The disk knows the next request in its queue ahead of time.</span></span> <span data-ttu-id="413a7-658">Consequently, the disk can schedule operations ahead of time and process them in an optimal sequence.</span><span class="sxs-lookup"><span data-stu-id="413a7-658">Consequently, the disk can schedule operations ahead of time and process them in an optimal sequence.</span></span> <span data-ttu-id="413a7-659">Since the application is sending more requests to the disk, the disk can process more parallel IOs.</span><span class="sxs-lookup"><span data-stu-id="413a7-659">Since the application is sending more requests to the disk, the disk can process more parallel IOs.</span></span> <span data-ttu-id="413a7-660">Ultimately, the application will be able to achieve higher IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-660">Ultimately, the application will be able to achieve higher IOPS.</span></span> <span data-ttu-id="413a7-661">Since application is processing more requests, the total Throughput of the application also increases.</span><span class="sxs-lookup"><span data-stu-id="413a7-661">Since application is processing more requests, the total Throughput of the application also increases.</span></span>

<span data-ttu-id="413a7-662">Typically, an application can achieve maximum Throughput with 8-16+ outstanding IOs per attached disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-662">Typically, an application can achieve maximum Throughput with 8-16+ outstanding IOs per attached disk.</span></span> <span data-ttu-id="413a7-663">If a Queue Depth is one, application is not pushing enough IOs to the system, and it will process less amount of in a given period.</span><span class="sxs-lookup"><span data-stu-id="413a7-663">If a Queue Depth is one, application is not pushing enough IOs to the system, and it will process less amount of in a given period.</span></span> <span data-ttu-id="413a7-664">In other words, less Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-664">In other words, less Throughput.</span></span>

<span data-ttu-id="413a7-665">For example, in SQL Server, setting the MAXDOP value for a query to "4" informs SQL Server that it can use up to four cores to execute the query.</span><span class="sxs-lookup"><span data-stu-id="413a7-665">For example, in SQL Server, setting the MAXDOP value for a query to "4" informs SQL Server that it can use up to four cores to execute the query.</span></span> <span data-ttu-id="413a7-666">SQL Server will determine what is best queue depth value and the number of cores for the query execution.</span><span class="sxs-lookup"><span data-stu-id="413a7-666">SQL Server will determine what is best queue depth value and the number of cores for the query execution.</span></span>

<span data-ttu-id="413a7-667">*Optimal Queue Depth*</span><span class="sxs-lookup"><span data-stu-id="413a7-667">*Optimal Queue Depth*</span></span>  
<span data-ttu-id="413a7-668">Very high queue depth value also has its drawbacks.</span><span class="sxs-lookup"><span data-stu-id="413a7-668">Very high queue depth value also has its drawbacks.</span></span> <span data-ttu-id="413a7-669">If queue depth value is too high, the application will try to drive very high IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-669">If queue depth value is too high, the application will try to drive very high IOPS.</span></span> <span data-ttu-id="413a7-670">Unless application has persistent disks with sufficient provisioned IOPS, this can negatively affect application latencies.</span><span class="sxs-lookup"><span data-stu-id="413a7-670">Unless application has persistent disks with sufficient provisioned IOPS, this can negatively affect application latencies.</span></span> <span data-ttu-id="413a7-671">Following formula shows the relationship between IOPS, Latency and Queue Depth.</span><span class="sxs-lookup"><span data-stu-id="413a7-671">Following formula shows the relationship between IOPS, Latency and Queue Depth.</span></span>  
    ![](media/premium-storage-performance/image6.png)

<span data-ttu-id="413a7-672">You should not configure Queue Depth to any high value, but to an optimal value, which can deliver enough IOPS for the application without affecting latencies.</span><span class="sxs-lookup"><span data-stu-id="413a7-672">You should not configure Queue Depth to any high value, but to an optimal value, which can deliver enough IOPS for the application without affecting latencies.</span></span> <span data-ttu-id="413a7-673">For example, if the application latency needs to be 1 millisecond, the Queue Depth required to achieve 5,000 IOPS is, QD = 5000 x 0.001 = 5.</span><span class="sxs-lookup"><span data-stu-id="413a7-673">For example, if the application latency needs to be 1 millisecond, the Queue Depth required to achieve 5,000 IOPS is, QD = 5000 x 0.001 = 5.</span></span>

<span data-ttu-id="413a7-674">*Queue Depth for Striped Volume*</span><span class="sxs-lookup"><span data-stu-id="413a7-674">*Queue Depth for Striped Volume*</span></span>  
<span data-ttu-id="413a7-675">For a striped volume, maintain a high enough queue depth such that, every disk has a peak queue depth individually.</span><span class="sxs-lookup"><span data-stu-id="413a7-675">For a striped volume, maintain a high enough queue depth such that, every disk has a peak queue depth individually.</span></span> <span data-ttu-id="413a7-676">For example, consider an application that pushes a queue depth of 2 and there are 4 disks in the stripe.</span><span class="sxs-lookup"><span data-stu-id="413a7-676">For example, consider an application that pushes a queue depth of 2 and there are 4 disks in the stripe.</span></span> <span data-ttu-id="413a7-677">The two IO requests will go to two disks and remaining two disks will be idle.</span><span class="sxs-lookup"><span data-stu-id="413a7-677">The two IO requests will go to two disks and remaining two disks will be idle.</span></span> <span data-ttu-id="413a7-678">Therefore, configure the queue depth such that all the disks can be busy.</span><span class="sxs-lookup"><span data-stu-id="413a7-678">Therefore, configure the queue depth such that all the disks can be busy.</span></span> <span data-ttu-id="413a7-679">Formula below shows how to determine the queue depth of striped volumes.</span><span class="sxs-lookup"><span data-stu-id="413a7-679">Formula below shows how to determine the queue depth of striped volumes.</span></span>  
    ![](media/premium-storage-performance/image7.png)

## <a name="throttling"></a><span data-ttu-id="413a7-680">Throttling</span><span class="sxs-lookup"><span data-stu-id="413a7-680">Throttling</span></span>
<span data-ttu-id="413a7-681">Azure Premium Storage provisions specified number of IOPS and Throughput depending on the VM sizes and disk sizes you choose.</span><span class="sxs-lookup"><span data-stu-id="413a7-681">Azure Premium Storage provisions specified number of IOPS and Throughput depending on the VM sizes and disk sizes you choose.</span></span> <span data-ttu-id="413a7-682">Anytime your application tries to drive IOPS or Throughput above these limits of what the VM or disk can handle, Premium Storage will throttle it.</span><span class="sxs-lookup"><span data-stu-id="413a7-682">Anytime your application tries to drive IOPS or Throughput above these limits of what the VM or disk can handle, Premium Storage will throttle it.</span></span> <span data-ttu-id="413a7-683">This manifests in the form of degraded performance in your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-683">This manifests in the form of degraded performance in your application.</span></span> <span data-ttu-id="413a7-684">This can mean higher latency, lower Throughput or lower IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-684">This can mean higher latency, lower Throughput or lower IOPS.</span></span> <span data-ttu-id="413a7-685">If Premium Storage does not throttle, your application could completely fail by exceeding what its resources are capable of achieving.</span><span class="sxs-lookup"><span data-stu-id="413a7-685">If Premium Storage does not throttle, your application could completely fail by exceeding what its resources are capable of achieving.</span></span> <span data-ttu-id="413a7-686">So, to avoid performance issues due to throttling, always provision sufficient resources for your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-686">So, to avoid performance issues due to throttling, always provision sufficient resources for your application.</span></span> <span data-ttu-id="413a7-687">Take into consideration what we discussed in the VM sizes and Disk sizes sections above.</span><span class="sxs-lookup"><span data-stu-id="413a7-687">Take into consideration what we discussed in the VM sizes and Disk sizes sections above.</span></span> <span data-ttu-id="413a7-688">Benchmarking is the best way to figure out what resources you will need to host your application.</span><span class="sxs-lookup"><span data-stu-id="413a7-688">Benchmarking is the best way to figure out what resources you will need to host your application.</span></span>

## <a name="benchmarking"></a><span data-ttu-id="413a7-689">Benchmarking</span><span class="sxs-lookup"><span data-stu-id="413a7-689">Benchmarking</span></span>
<span data-ttu-id="413a7-690">Benchmarking is the process of simulating different workloads on your application and measuring the application performance for each workload.</span><span class="sxs-lookup"><span data-stu-id="413a7-690">Benchmarking is the process of simulating different workloads on your application and measuring the application performance for each workload.</span></span> <span data-ttu-id="413a7-691">Using the steps described in an earlier section, you have gathered the application performance requirements.</span><span class="sxs-lookup"><span data-stu-id="413a7-691">Using the steps described in an earlier section, you have gathered the application performance requirements.</span></span> <span data-ttu-id="413a7-692">By running benchmarking tools on the VMs hosting the application, you can determine the performance levels that your application can achieve with Premium Storage.</span><span class="sxs-lookup"><span data-stu-id="413a7-692">By running benchmarking tools on the VMs hosting the application, you can determine the performance levels that your application can achieve with Premium Storage.</span></span> <span data-ttu-id="413a7-693">In this section, we provide you examples of benchmarking a Standard DS14 VM provisioned with Azure Premium Storage disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-693">In this section, we provide you examples of benchmarking a Standard DS14 VM provisioned with Azure Premium Storage disks.</span></span>

<span data-ttu-id="413a7-694">We have used common benchmarking tools Iometer and FIO, for Windows and Linux respectively.</span><span class="sxs-lookup"><span data-stu-id="413a7-694">We have used common benchmarking tools Iometer and FIO, for Windows and Linux respectively.</span></span> <span data-ttu-id="413a7-695">These tools spawn multiple threads simulating a production like workload, and measure the system performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-695">These tools spawn multiple threads simulating a production like workload, and measure the system performance.</span></span> <span data-ttu-id="413a7-696">Using the tools you can also configure parameters like block size and queue depth, which you normally cannot change for an application.</span><span class="sxs-lookup"><span data-stu-id="413a7-696">Using the tools you can also configure parameters like block size and queue depth, which you normally cannot change for an application.</span></span> <span data-ttu-id="413a7-697">This gives you more flexibility to drive the maximum performance on a high scale VM provisioned with premium disks for different types of application workloads.</span><span class="sxs-lookup"><span data-stu-id="413a7-697">This gives you more flexibility to drive the maximum performance on a high scale VM provisioned with premium disks for different types of application workloads.</span></span> <span data-ttu-id="413a7-698">To learn more about each benchmarking tool visit [Iometer](http://www.iometer.org/) and [FIO](http://freecode.com/projects/fio).</span><span class="sxs-lookup"><span data-stu-id="413a7-698">To learn more about each benchmarking tool visit [Iometer](http://www.iometer.org/) and [FIO](http://freecode.com/projects/fio).</span></span>

<span data-ttu-id="413a7-699">To follow the examples below, create a Standard DS14 VM and attach 11 Premium Storage disks to the VM.</span><span class="sxs-lookup"><span data-stu-id="413a7-699">To follow the examples below, create a Standard DS14 VM and attach 11 Premium Storage disks to the VM.</span></span> <span data-ttu-id="413a7-700">Of the 11 disks, configure 10 disks with host caching as "None" and stripe them into a volume called NoCacheWrites.</span><span class="sxs-lookup"><span data-stu-id="413a7-700">Of the 11 disks, configure 10 disks with host caching as "None" and stripe them into a volume called NoCacheWrites.</span></span> <span data-ttu-id="413a7-701">Configure host caching as "ReadOnly" on the remaining disk and create a volume called CacheReads with this disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-701">Configure host caching as "ReadOnly" on the remaining disk and create a volume called CacheReads with this disk.</span></span> <span data-ttu-id="413a7-702">Using this setup, you will be able to see the maximum Read and Write performance from a Standard DS14 VM.</span><span class="sxs-lookup"><span data-stu-id="413a7-702">Using this setup, you will be able to see the maximum Read and Write performance from a Standard DS14 VM.</span></span> <span data-ttu-id="413a7-703">For detailed steps about creating a DS14 VM with premium disks, go to [Create and use a Premium Storage account for a virtual machine data disk](../articles/virtual-machines/windows/premium-storage.md).</span><span class="sxs-lookup"><span data-stu-id="413a7-703">For detailed steps about creating a DS14 VM with premium disks, go to [Create and use a Premium Storage account for a virtual machine data disk](../articles/virtual-machines/windows/premium-storage.md).</span></span>

<span data-ttu-id="413a7-704">*Warming up the Cache*</span><span class="sxs-lookup"><span data-stu-id="413a7-704">*Warming up the Cache*</span></span>  
<span data-ttu-id="413a7-705">The disk with ReadOnly host caching will be able to give higher IOPS than the disk limit.</span><span class="sxs-lookup"><span data-stu-id="413a7-705">The disk with ReadOnly host caching will be able to give higher IOPS than the disk limit.</span></span> <span data-ttu-id="413a7-706">To get this maximum read performance from the host cache, first you must warm up the cache of this disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-706">To get this maximum read performance from the host cache, first you must warm up the cache of this disk.</span></span> <span data-ttu-id="413a7-707">This ensures that the Read IOs which benchmarking tool will drive on CacheReads volume actually hits the cache and not the disk directly.</span><span class="sxs-lookup"><span data-stu-id="413a7-707">This ensures that the Read IOs which benchmarking tool will drive on CacheReads volume actually hits the cache and not the disk directly.</span></span> <span data-ttu-id="413a7-708">The cache hits result in additional IOPS from the single cache enabled disk.</span><span class="sxs-lookup"><span data-stu-id="413a7-708">The cache hits result in additional IOPS from the single cache enabled disk.</span></span>

> <span data-ttu-id="413a7-709">**Important:**</span><span class="sxs-lookup"><span data-stu-id="413a7-709">**Important:**</span></span>  
> <span data-ttu-id="413a7-710">You must warm up the cache before running benchmarking, every time VM is rebooted.</span><span class="sxs-lookup"><span data-stu-id="413a7-710">You must warm up the cache before running benchmarking, every time VM is rebooted.</span></span>
>
>

#### <a name="iometer"></a><span data-ttu-id="413a7-711">Iometer</span><span class="sxs-lookup"><span data-stu-id="413a7-711">Iometer</span></span>
<span data-ttu-id="413a7-712">[Download the Iometer tool](http://sourceforge.net/projects/iometer/files/iometer-stable/2006-07-27/iometer-2006.07.27.win32.i386-setup.exe/download) on the VM.</span><span class="sxs-lookup"><span data-stu-id="413a7-712">[Download the Iometer tool](http://sourceforge.net/projects/iometer/files/iometer-stable/2006-07-27/iometer-2006.07.27.win32.i386-setup.exe/download) on the VM.</span></span>

<span data-ttu-id="413a7-713">*Test file*</span><span class="sxs-lookup"><span data-stu-id="413a7-713">*Test file*</span></span>  
<span data-ttu-id="413a7-714">Iometer uses a test file that is stored on the volume on which you will run the benchmarking test.</span><span class="sxs-lookup"><span data-stu-id="413a7-714">Iometer uses a test file that is stored on the volume on which you will run the benchmarking test.</span></span> <span data-ttu-id="413a7-715">It drives Reads and Writes on this test file to measure the disk IOPS and Throughput.</span><span class="sxs-lookup"><span data-stu-id="413a7-715">It drives Reads and Writes on this test file to measure the disk IOPS and Throughput.</span></span> <span data-ttu-id="413a7-716">Iometer creates this test file if you have not provided one.</span><span class="sxs-lookup"><span data-stu-id="413a7-716">Iometer creates this test file if you have not provided one.</span></span> <span data-ttu-id="413a7-717">Create a 200GB test file called iobw.tst on the CacheReads and NoCacheWrites volumes.</span><span class="sxs-lookup"><span data-stu-id="413a7-717">Create a 200GB test file called iobw.tst on the CacheReads and NoCacheWrites volumes.</span></span>

<span data-ttu-id="413a7-718">*Access Specifications*</span><span class="sxs-lookup"><span data-stu-id="413a7-718">*Access Specifications*</span></span>  
<span data-ttu-id="413a7-719">The specifications, request IO size, % read/write, % random/sequential are configured using the "Access Specifications" tab in Iometer.</span><span class="sxs-lookup"><span data-stu-id="413a7-719">The specifications, request IO size, % read/write, % random/sequential are configured using the "Access Specifications" tab in Iometer.</span></span> <span data-ttu-id="413a7-720">Create an access specification for each of the scenarios described below.</span><span class="sxs-lookup"><span data-stu-id="413a7-720">Create an access specification for each of the scenarios described below.</span></span> <span data-ttu-id="413a7-721">Create the access specifications and "Save" with an appropriate name like  RandomWrites\_8K, RandomReads\_8K.</span><span class="sxs-lookup"><span data-stu-id="413a7-721">Create the access specifications and "Save" with an appropriate name like  RandomWrites\_8K, RandomReads\_8K.</span></span> <span data-ttu-id="413a7-722">Select the corresponding specification when running the test scenario.</span><span class="sxs-lookup"><span data-stu-id="413a7-722">Select the corresponding specification when running the test scenario.</span></span>

<span data-ttu-id="413a7-723">An example of access specifications for maximum Write IOPS scenario is shown below,</span><span class="sxs-lookup"><span data-stu-id="413a7-723">An example of access specifications for maximum Write IOPS scenario is shown below,</span></span>  
    ![](media/premium-storage-performance/image8.png)

<span data-ttu-id="413a7-724">*Maximum IOPS Test Specifications*</span><span class="sxs-lookup"><span data-stu-id="413a7-724">*Maximum IOPS Test Specifications*</span></span>  
<span data-ttu-id="413a7-725">To demonstrate maximum IOPs, use smaller request size.</span><span class="sxs-lookup"><span data-stu-id="413a7-725">To demonstrate maximum IOPs, use smaller request size.</span></span> <span data-ttu-id="413a7-726">Use 8K request size and create specifications for Random Writes and Reads.</span><span class="sxs-lookup"><span data-stu-id="413a7-726">Use 8K request size and create specifications for Random Writes and Reads.</span></span>

| <span data-ttu-id="413a7-727">Access Specification</span><span class="sxs-lookup"><span data-stu-id="413a7-727">Access Specification</span></span> | <span data-ttu-id="413a7-728">Request size</span><span class="sxs-lookup"><span data-stu-id="413a7-728">Request size</span></span> | <span data-ttu-id="413a7-729">Random %</span><span class="sxs-lookup"><span data-stu-id="413a7-729">Random %</span></span> | <span data-ttu-id="413a7-730">Read %</span><span class="sxs-lookup"><span data-stu-id="413a7-730">Read %</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="413a7-731">RandomWrites\_8K</span><span class="sxs-lookup"><span data-stu-id="413a7-731">RandomWrites\_8K</span></span> |<span data-ttu-id="413a7-732">8K</span><span class="sxs-lookup"><span data-stu-id="413a7-732">8K</span></span> |<span data-ttu-id="413a7-733">100</span><span class="sxs-lookup"><span data-stu-id="413a7-733">100</span></span> |<span data-ttu-id="413a7-734">0</span><span class="sxs-lookup"><span data-stu-id="413a7-734">0</span></span> |
| <span data-ttu-id="413a7-735">RandomReads\_8K</span><span class="sxs-lookup"><span data-stu-id="413a7-735">RandomReads\_8K</span></span> |<span data-ttu-id="413a7-736">8K</span><span class="sxs-lookup"><span data-stu-id="413a7-736">8K</span></span> |<span data-ttu-id="413a7-737">100</span><span class="sxs-lookup"><span data-stu-id="413a7-737">100</span></span> |<span data-ttu-id="413a7-738">100</span><span class="sxs-lookup"><span data-stu-id="413a7-738">100</span></span> |

<span data-ttu-id="413a7-739">*Maximum Throughput Test Specifications*</span><span class="sxs-lookup"><span data-stu-id="413a7-739">*Maximum Throughput Test Specifications*</span></span>  
<span data-ttu-id="413a7-740">To demonstrate maximum Throughput, use larger request size.</span><span class="sxs-lookup"><span data-stu-id="413a7-740">To demonstrate maximum Throughput, use larger request size.</span></span> <span data-ttu-id="413a7-741">Use 64K request size and create specifications for Random Writes and Reads.</span><span class="sxs-lookup"><span data-stu-id="413a7-741">Use 64K request size and create specifications for Random Writes and Reads.</span></span>

| <span data-ttu-id="413a7-742">Access Specification</span><span class="sxs-lookup"><span data-stu-id="413a7-742">Access Specification</span></span> | <span data-ttu-id="413a7-743">Request size</span><span class="sxs-lookup"><span data-stu-id="413a7-743">Request size</span></span> | <span data-ttu-id="413a7-744">Random %</span><span class="sxs-lookup"><span data-stu-id="413a7-744">Random %</span></span> | <span data-ttu-id="413a7-745">Read %</span><span class="sxs-lookup"><span data-stu-id="413a7-745">Read %</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="413a7-746">RandomWrites\_64K</span><span class="sxs-lookup"><span data-stu-id="413a7-746">RandomWrites\_64K</span></span> |<span data-ttu-id="413a7-747">64K</span><span class="sxs-lookup"><span data-stu-id="413a7-747">64K</span></span> |<span data-ttu-id="413a7-748">100</span><span class="sxs-lookup"><span data-stu-id="413a7-748">100</span></span> |<span data-ttu-id="413a7-749">0</span><span class="sxs-lookup"><span data-stu-id="413a7-749">0</span></span> |
| <span data-ttu-id="413a7-750">RandomReads\_64K</span><span class="sxs-lookup"><span data-stu-id="413a7-750">RandomReads\_64K</span></span> |<span data-ttu-id="413a7-751">64K</span><span class="sxs-lookup"><span data-stu-id="413a7-751">64K</span></span> |<span data-ttu-id="413a7-752">100</span><span class="sxs-lookup"><span data-stu-id="413a7-752">100</span></span> |<span data-ttu-id="413a7-753">100</span><span class="sxs-lookup"><span data-stu-id="413a7-753">100</span></span> |

<span data-ttu-id="413a7-754">*Running the Iometer Test*</span><span class="sxs-lookup"><span data-stu-id="413a7-754">*Running the Iometer Test*</span></span>  
<span data-ttu-id="413a7-755">Perform the steps below to warm up cache</span><span class="sxs-lookup"><span data-stu-id="413a7-755">Perform the steps below to warm up cache</span></span>

1. <span data-ttu-id="413a7-756">Create two access specifications with values shown below,</span><span class="sxs-lookup"><span data-stu-id="413a7-756">Create two access specifications with values shown below,</span></span>

   | <span data-ttu-id="413a7-757">Name</span><span class="sxs-lookup"><span data-stu-id="413a7-757">Name</span></span> | <span data-ttu-id="413a7-758">Request size</span><span class="sxs-lookup"><span data-stu-id="413a7-758">Request size</span></span> | <span data-ttu-id="413a7-759">Random %</span><span class="sxs-lookup"><span data-stu-id="413a7-759">Random %</span></span> | <span data-ttu-id="413a7-760">Read %</span><span class="sxs-lookup"><span data-stu-id="413a7-760">Read %</span></span> |
   | --- | --- | --- | --- |
   | <span data-ttu-id="413a7-761">RandomWrites\_1MB</span><span class="sxs-lookup"><span data-stu-id="413a7-761">RandomWrites\_1MB</span></span> |<span data-ttu-id="413a7-762">1MB</span><span class="sxs-lookup"><span data-stu-id="413a7-762">1MB</span></span> |<span data-ttu-id="413a7-763">100</span><span class="sxs-lookup"><span data-stu-id="413a7-763">100</span></span> |<span data-ttu-id="413a7-764">0</span><span class="sxs-lookup"><span data-stu-id="413a7-764">0</span></span> |
   | <span data-ttu-id="413a7-765">RandomReads\_1MB</span><span class="sxs-lookup"><span data-stu-id="413a7-765">RandomReads\_1MB</span></span> |<span data-ttu-id="413a7-766">1MB</span><span class="sxs-lookup"><span data-stu-id="413a7-766">1MB</span></span> |<span data-ttu-id="413a7-767">100</span><span class="sxs-lookup"><span data-stu-id="413a7-767">100</span></span> |<span data-ttu-id="413a7-768">100</span><span class="sxs-lookup"><span data-stu-id="413a7-768">100</span></span> |
1. <span data-ttu-id="413a7-769">Run the Iometer test for initializing cache disk with following parameters.</span><span class="sxs-lookup"><span data-stu-id="413a7-769">Run the Iometer test for initializing cache disk with following parameters.</span></span> <span data-ttu-id="413a7-770">Use three worker threads for the target volume and a queue depth of 128.</span><span class="sxs-lookup"><span data-stu-id="413a7-770">Use three worker threads for the target volume and a queue depth of 128.</span></span> <span data-ttu-id="413a7-771">Set the "Run time" duration of the test to 2hrs on the "Test Setup" tab.</span><span class="sxs-lookup"><span data-stu-id="413a7-771">Set the "Run time" duration of the test to 2hrs on the "Test Setup" tab.</span></span>

   | <span data-ttu-id="413a7-772">Scenario</span><span class="sxs-lookup"><span data-stu-id="413a7-772">Scenario</span></span> | <span data-ttu-id="413a7-773">Target Volume</span><span class="sxs-lookup"><span data-stu-id="413a7-773">Target Volume</span></span> | <span data-ttu-id="413a7-774">Name</span><span class="sxs-lookup"><span data-stu-id="413a7-774">Name</span></span> | <span data-ttu-id="413a7-775">Duration</span><span class="sxs-lookup"><span data-stu-id="413a7-775">Duration</span></span> |
   | --- | --- | --- | --- |
   | <span data-ttu-id="413a7-776">Initialize Cache Disk</span><span class="sxs-lookup"><span data-stu-id="413a7-776">Initialize Cache Disk</span></span> |<span data-ttu-id="413a7-777">CacheReads</span><span class="sxs-lookup"><span data-stu-id="413a7-777">CacheReads</span></span> |<span data-ttu-id="413a7-778">RandomWrites\_1MB</span><span class="sxs-lookup"><span data-stu-id="413a7-778">RandomWrites\_1MB</span></span> |<span data-ttu-id="413a7-779">2hrs</span><span class="sxs-lookup"><span data-stu-id="413a7-779">2hrs</span></span> |
1. <span data-ttu-id="413a7-780">Run the Iometer test for warming up cache disk with following parameters.</span><span class="sxs-lookup"><span data-stu-id="413a7-780">Run the Iometer test for warming up cache disk with following parameters.</span></span> <span data-ttu-id="413a7-781">Use three worker threads for the target volume and a queue depth of 128.</span><span class="sxs-lookup"><span data-stu-id="413a7-781">Use three worker threads for the target volume and a queue depth of 128.</span></span> <span data-ttu-id="413a7-782">Set the "Run time" duration of the test to 2hrs on the "Test Setup" tab.</span><span class="sxs-lookup"><span data-stu-id="413a7-782">Set the "Run time" duration of the test to 2hrs on the "Test Setup" tab.</span></span>

   | <span data-ttu-id="413a7-783">Scenario</span><span class="sxs-lookup"><span data-stu-id="413a7-783">Scenario</span></span> | <span data-ttu-id="413a7-784">Target Volume</span><span class="sxs-lookup"><span data-stu-id="413a7-784">Target Volume</span></span> | <span data-ttu-id="413a7-785">Name</span><span class="sxs-lookup"><span data-stu-id="413a7-785">Name</span></span> | <span data-ttu-id="413a7-786">Duration</span><span class="sxs-lookup"><span data-stu-id="413a7-786">Duration</span></span> |
   | --- | --- | --- | --- |
   | <span data-ttu-id="413a7-787">Warm up Cache Disk</span><span class="sxs-lookup"><span data-stu-id="413a7-787">Warm up Cache Disk</span></span> |<span data-ttu-id="413a7-788">CacheReads</span><span class="sxs-lookup"><span data-stu-id="413a7-788">CacheReads</span></span> |<span data-ttu-id="413a7-789">RandomReads\_1MB</span><span class="sxs-lookup"><span data-stu-id="413a7-789">RandomReads\_1MB</span></span> |<span data-ttu-id="413a7-790">2hrs</span><span class="sxs-lookup"><span data-stu-id="413a7-790">2hrs</span></span> |

<span data-ttu-id="413a7-791">After cache disk is warmed up, proceed with the test scenarios listed below.</span><span class="sxs-lookup"><span data-stu-id="413a7-791">After cache disk is warmed up, proceed with the test scenarios listed below.</span></span> <span data-ttu-id="413a7-792">To run the Iometer test, use at least three worker threads for **each** target volume.</span><span class="sxs-lookup"><span data-stu-id="413a7-792">To run the Iometer test, use at least three worker threads for **each** target volume.</span></span> <span data-ttu-id="413a7-793">For each worker thread, select the target volume, set queue depth and select one of the saved test specifications, as shown in the table below, to run the corresponding test scenario.</span><span class="sxs-lookup"><span data-stu-id="413a7-793">For each worker thread, select the target volume, set queue depth and select one of the saved test specifications, as shown in the table below, to run the corresponding test scenario.</span></span> <span data-ttu-id="413a7-794">The table also shows expected results for IOPS and Throughput when running these tests.</span><span class="sxs-lookup"><span data-stu-id="413a7-794">The table also shows expected results for IOPS and Throughput when running these tests.</span></span> <span data-ttu-id="413a7-795">For all scenarios, a small IO size of 8KB and a high queue depth of 128 is used.</span><span class="sxs-lookup"><span data-stu-id="413a7-795">For all scenarios, a small IO size of 8KB and a high queue depth of 128 is used.</span></span>

| <span data-ttu-id="413a7-796">Test Scenario</span><span class="sxs-lookup"><span data-stu-id="413a7-796">Test Scenario</span></span> | <span data-ttu-id="413a7-797">Target Volume</span><span class="sxs-lookup"><span data-stu-id="413a7-797">Target Volume</span></span> | <span data-ttu-id="413a7-798">Name</span><span class="sxs-lookup"><span data-stu-id="413a7-798">Name</span></span> | <span data-ttu-id="413a7-799">Result</span><span class="sxs-lookup"><span data-stu-id="413a7-799">Result</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="413a7-800">Max.</span><span class="sxs-lookup"><span data-stu-id="413a7-800">Max.</span></span> <span data-ttu-id="413a7-801">Read IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-801">Read IOPS</span></span> |<span data-ttu-id="413a7-802">CacheReads</span><span class="sxs-lookup"><span data-stu-id="413a7-802">CacheReads</span></span> |<span data-ttu-id="413a7-803">RandomWrites\_8K</span><span class="sxs-lookup"><span data-stu-id="413a7-803">RandomWrites\_8K</span></span> |<span data-ttu-id="413a7-804">50,000 IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-804">50,000 IOPS</span></span> |
| <span data-ttu-id="413a7-805">Max.</span><span class="sxs-lookup"><span data-stu-id="413a7-805">Max.</span></span> <span data-ttu-id="413a7-806">Write IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-806">Write IOPS</span></span> |<span data-ttu-id="413a7-807">NoCacheWrites</span><span class="sxs-lookup"><span data-stu-id="413a7-807">NoCacheWrites</span></span> |<span data-ttu-id="413a7-808">RandomReads\_8K</span><span class="sxs-lookup"><span data-stu-id="413a7-808">RandomReads\_8K</span></span> |<span data-ttu-id="413a7-809">64,000 IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-809">64,000 IOPS</span></span> |
| <span data-ttu-id="413a7-810">Max.</span><span class="sxs-lookup"><span data-stu-id="413a7-810">Max.</span></span> <span data-ttu-id="413a7-811">Combined IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-811">Combined IOPS</span></span> |<span data-ttu-id="413a7-812">CacheReads</span><span class="sxs-lookup"><span data-stu-id="413a7-812">CacheReads</span></span> |<span data-ttu-id="413a7-813">RandomWrites\_8K</span><span class="sxs-lookup"><span data-stu-id="413a7-813">RandomWrites\_8K</span></span> |<span data-ttu-id="413a7-814">100,000 IOPS</span><span class="sxs-lookup"><span data-stu-id="413a7-814">100,000 IOPS</span></span> |
| <span data-ttu-id="413a7-815">NoCacheWrites</span><span class="sxs-lookup"><span data-stu-id="413a7-815">NoCacheWrites</span></span> |<span data-ttu-id="413a7-816">RandomReads\_8K</span><span class="sxs-lookup"><span data-stu-id="413a7-816">RandomReads\_8K</span></span> | &nbsp; | &nbsp; |
| <span data-ttu-id="413a7-817">Max.</span><span class="sxs-lookup"><span data-stu-id="413a7-817">Max.</span></span> <span data-ttu-id="413a7-818">Read MB/sec</span><span class="sxs-lookup"><span data-stu-id="413a7-818">Read MB/sec</span></span> |<span data-ttu-id="413a7-819">CacheReads</span><span class="sxs-lookup"><span data-stu-id="413a7-819">CacheReads</span></span> |<span data-ttu-id="413a7-820">RandomWrites\_64K</span><span class="sxs-lookup"><span data-stu-id="413a7-820">RandomWrites\_64K</span></span> |<span data-ttu-id="413a7-821">524 MB/sec</span><span class="sxs-lookup"><span data-stu-id="413a7-821">524 MB/sec</span></span> |
| <span data-ttu-id="413a7-822">Max.</span><span class="sxs-lookup"><span data-stu-id="413a7-822">Max.</span></span> <span data-ttu-id="413a7-823">Write MB/sec</span><span class="sxs-lookup"><span data-stu-id="413a7-823">Write MB/sec</span></span> |<span data-ttu-id="413a7-824">NoCacheWrites</span><span class="sxs-lookup"><span data-stu-id="413a7-824">NoCacheWrites</span></span> |<span data-ttu-id="413a7-825">RandomReads\_64K</span><span class="sxs-lookup"><span data-stu-id="413a7-825">RandomReads\_64K</span></span> |<span data-ttu-id="413a7-826">524 MB/sec</span><span class="sxs-lookup"><span data-stu-id="413a7-826">524 MB/sec</span></span> |
| <span data-ttu-id="413a7-827">Combined MB/sec</span><span class="sxs-lookup"><span data-stu-id="413a7-827">Combined MB/sec</span></span> |<span data-ttu-id="413a7-828">CacheReads</span><span class="sxs-lookup"><span data-stu-id="413a7-828">CacheReads</span></span> |<span data-ttu-id="413a7-829">RandomWrites\_64K</span><span class="sxs-lookup"><span data-stu-id="413a7-829">RandomWrites\_64K</span></span> |<span data-ttu-id="413a7-830">1000 MB/sec</span><span class="sxs-lookup"><span data-stu-id="413a7-830">1000 MB/sec</span></span> |
| <span data-ttu-id="413a7-831">NoCacheWrites</span><span class="sxs-lookup"><span data-stu-id="413a7-831">NoCacheWrites</span></span> |<span data-ttu-id="413a7-832">RandomReads\_64K</span><span class="sxs-lookup"><span data-stu-id="413a7-832">RandomReads\_64K</span></span> | &nbsp; | &nbsp; |

<span data-ttu-id="413a7-833">Below are screenshots of the Iometer test results for combined IOPS and Throughput scenarios.</span><span class="sxs-lookup"><span data-stu-id="413a7-833">Below are screenshots of the Iometer test results for combined IOPS and Throughput scenarios.</span></span>

<span data-ttu-id="413a7-834">*Combined Reads and Writes Maximum IOPS*</span><span class="sxs-lookup"><span data-stu-id="413a7-834">*Combined Reads and Writes Maximum IOPS*</span></span>  
![](media/premium-storage-performance/image9.png)

<span data-ttu-id="413a7-835">*Combined Reads and Writes Maximum Throughput*</span><span class="sxs-lookup"><span data-stu-id="413a7-835">*Combined Reads and Writes Maximum Throughput*</span></span>  
![](media/premium-storage-performance/image10.png)

### <a name="fio"></a><span data-ttu-id="413a7-836">FIO</span><span class="sxs-lookup"><span data-stu-id="413a7-836">FIO</span></span>
<span data-ttu-id="413a7-837">FIO is a popular tool to benchmark storage on the Linux VMs.</span><span class="sxs-lookup"><span data-stu-id="413a7-837">FIO is a popular tool to benchmark storage on the Linux VMs.</span></span> <span data-ttu-id="413a7-838">It has the flexibility to select different IO sizes, sequential or random reads and writes.</span><span class="sxs-lookup"><span data-stu-id="413a7-838">It has the flexibility to select different IO sizes, sequential or random reads and writes.</span></span> <span data-ttu-id="413a7-839">It spawns worker threads or processes to perform the specified I/O operations.</span><span class="sxs-lookup"><span data-stu-id="413a7-839">It spawns worker threads or processes to perform the specified I/O operations.</span></span> <span data-ttu-id="413a7-840">You can specify the type of I/O operations each worker thread must perform using job files.</span><span class="sxs-lookup"><span data-stu-id="413a7-840">You can specify the type of I/O operations each worker thread must perform using job files.</span></span> <span data-ttu-id="413a7-841">We created one job file per scenario illustrated in the examples below.</span><span class="sxs-lookup"><span data-stu-id="413a7-841">We created one job file per scenario illustrated in the examples below.</span></span> <span data-ttu-id="413a7-842">You can change the specifications in these job files to benchmark different workloads running on Premium Storage.</span><span class="sxs-lookup"><span data-stu-id="413a7-842">You can change the specifications in these job files to benchmark different workloads running on Premium Storage.</span></span> <span data-ttu-id="413a7-843">In the examples, we are using a Standard DS 14 VM running **Ubuntu**.</span><span class="sxs-lookup"><span data-stu-id="413a7-843">In the examples, we are using a Standard DS 14 VM running **Ubuntu**.</span></span> <span data-ttu-id="413a7-844">Use the same setup described in the beginning of the [Benchmarking section](#Benchmarking) and warm up the cache before running the benchmarking tests.</span><span class="sxs-lookup"><span data-stu-id="413a7-844">Use the same setup described in the beginning of the [Benchmarking section](#Benchmarking) and warm up the cache before running the benchmarking tests.</span></span>

<span data-ttu-id="413a7-845">Before you begin, [download FIO](https://github.com/axboe/fio) and install it on your virtual machine.</span><span class="sxs-lookup"><span data-stu-id="413a7-845">Before you begin, [download FIO](https://github.com/axboe/fio) and install it on your virtual machine.</span></span>

<span data-ttu-id="413a7-846">Run the following command for Ubuntu,</span><span class="sxs-lookup"><span data-stu-id="413a7-846">Run the following command for Ubuntu,</span></span>

```
apt-get install fio
```

<span data-ttu-id="413a7-847">We will use four worker threads for driving Write operations and four worker threads for driving Read operations on the disks.</span><span class="sxs-lookup"><span data-stu-id="413a7-847">We will use four worker threads for driving Write operations and four worker threads for driving Read operations on the disks.</span></span> <span data-ttu-id="413a7-848">The Write workers will be driving traffic on the "nocache" volume, which has 10 disks with cache set to "None".</span><span class="sxs-lookup"><span data-stu-id="413a7-848">The Write workers will be driving traffic on the "nocache" volume, which has 10 disks with cache set to "None".</span></span> <span data-ttu-id="413a7-849">The Read workers will be driving traffic on the "readcache" volume, which has 1 disk with cache set to "ReadOnly".</span><span class="sxs-lookup"><span data-stu-id="413a7-849">The Read workers will be driving traffic on the "readcache" volume, which has 1 disk with cache set to "ReadOnly".</span></span>

<span data-ttu-id="413a7-850">*Maximum Write IOPS*</span><span class="sxs-lookup"><span data-stu-id="413a7-850">*Maximum Write IOPS*</span></span>  
<span data-ttu-id="413a7-851">Create the job file with following specifications to get maximum Write IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-851">Create the job file with following specifications to get maximum Write IOPS.</span></span> <span data-ttu-id="413a7-852">Name it "fiowrite.ini".</span><span class="sxs-lookup"><span data-stu-id="413a7-852">Name it "fiowrite.ini".</span></span>

```
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=8k

[writer1]
rw=randwrite
directory=/mnt/nocache
[writer2]
rw=randwrite
directory=/mnt/nocache
[writer3]
rw=randwrite
directory=/mnt/nocache
[writer4]
rw=randwrite
directory=/mnt/nocache
```

<span data-ttu-id="413a7-853">Note the follow key things that are in line with the design guidelines discussed in previous sections.</span><span class="sxs-lookup"><span data-stu-id="413a7-853">Note the follow key things that are in line with the design guidelines discussed in previous sections.</span></span> <span data-ttu-id="413a7-854">These specifications are essential to drive maximum IOPS,</span><span class="sxs-lookup"><span data-stu-id="413a7-854">These specifications are essential to drive maximum IOPS,</span></span>  

* <span data-ttu-id="413a7-855">A high queue depth of 256.</span><span class="sxs-lookup"><span data-stu-id="413a7-855">A high queue depth of 256.</span></span>  
* <span data-ttu-id="413a7-856">A small block size of 8KB.</span><span class="sxs-lookup"><span data-stu-id="413a7-856">A small block size of 8KB.</span></span>  
* <span data-ttu-id="413a7-857">Multiple threads performing random writes.</span><span class="sxs-lookup"><span data-stu-id="413a7-857">Multiple threads performing random writes.</span></span>

<span data-ttu-id="413a7-858">Run the following command to kick off the FIO test for 30 seconds,</span><span class="sxs-lookup"><span data-stu-id="413a7-858">Run the following command to kick off the FIO test for 30 seconds,</span></span>  

```
sudo fio --runtime 30 fiowrite.ini
```

<span data-ttu-id="413a7-859">While the test runs, you will be able to see the number of write IOPS the VM and Premium disks are delivering.</span><span class="sxs-lookup"><span data-stu-id="413a7-859">While the test runs, you will be able to see the number of write IOPS the VM and Premium disks are delivering.</span></span> <span data-ttu-id="413a7-860">As shown in the sample below, the DS14 VM is delivering its maximum write IOPS limit of 50,000 IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-860">As shown in the sample below, the DS14 VM is delivering its maximum write IOPS limit of 50,000 IOPS.</span></span>  
    ![](media/premium-storage-performance/image11.png)

<span data-ttu-id="413a7-861">*Maximum Read IOPS*</span><span class="sxs-lookup"><span data-stu-id="413a7-861">*Maximum Read IOPS*</span></span>  
<span data-ttu-id="413a7-862">Create the job file with following specifications to get maximum Read IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-862">Create the job file with following specifications to get maximum Read IOPS.</span></span> <span data-ttu-id="413a7-863">Name it "fioread.ini".</span><span class="sxs-lookup"><span data-stu-id="413a7-863">Name it "fioread.ini".</span></span>

```
[global]
size=30g
direct=1
iodepth=256
ioengine=libaio
bs=8k

[reader1]
rw=randread
directory=/mnt/readcache
[reader2]
rw=randread
directory=/mnt/readcache
[reader3]
rw=randread
directory=/mnt/readcache
[reader4]
rw=randread
directory=/mnt/readcache
```

<span data-ttu-id="413a7-864">Note the follow key things that are in line with the design guidelines discussed in previous sections.</span><span class="sxs-lookup"><span data-stu-id="413a7-864">Note the follow key things that are in line with the design guidelines discussed in previous sections.</span></span> <span data-ttu-id="413a7-865">These specifications are essential to drive maximum IOPS,</span><span class="sxs-lookup"><span data-stu-id="413a7-865">These specifications are essential to drive maximum IOPS,</span></span>

* <span data-ttu-id="413a7-866">A high queue depth of 256.</span><span class="sxs-lookup"><span data-stu-id="413a7-866">A high queue depth of 256.</span></span>  
* <span data-ttu-id="413a7-867">A small block size of 8KB.</span><span class="sxs-lookup"><span data-stu-id="413a7-867">A small block size of 8KB.</span></span>  
* <span data-ttu-id="413a7-868">Multiple threads performing random writes.</span><span class="sxs-lookup"><span data-stu-id="413a7-868">Multiple threads performing random writes.</span></span>

<span data-ttu-id="413a7-869">Run the following command to kick off the FIO test for 30 seconds,</span><span class="sxs-lookup"><span data-stu-id="413a7-869">Run the following command to kick off the FIO test for 30 seconds,</span></span>

```
sudo fio --runtime 30 fioread.ini
```

<span data-ttu-id="413a7-870">While the test runs, you will be able to see the number of read IOPS the VM and Premium disks are delivering.</span><span class="sxs-lookup"><span data-stu-id="413a7-870">While the test runs, you will be able to see the number of read IOPS the VM and Premium disks are delivering.</span></span> <span data-ttu-id="413a7-871">As shown in the sample below, the DS14 VM is delivering more than 64,000 Read IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-871">As shown in the sample below, the DS14 VM is delivering more than 64,000 Read IOPS.</span></span> <span data-ttu-id="413a7-872">This is a combination of the disk and the cache performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-872">This is a combination of the disk and the cache performance.</span></span>  
    ![](media/premium-storage-performance/image12.png)

<span data-ttu-id="413a7-873">*Maximum Read and Write IOPS*</span><span class="sxs-lookup"><span data-stu-id="413a7-873">*Maximum Read and Write IOPS*</span></span>  
<span data-ttu-id="413a7-874">Create the job file with following specifications to get maximum combined Read and Write IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-874">Create the job file with following specifications to get maximum combined Read and Write IOPS.</span></span> <span data-ttu-id="413a7-875">Name it "fioreadwrite.ini".</span><span class="sxs-lookup"><span data-stu-id="413a7-875">Name it "fioreadwrite.ini".</span></span>

```
[global]
size=30g
direct=1
iodepth=128
ioengine=libaio
bs=4k

[reader1]
rw=randread
directory=/mnt/readcache
[reader2]
rw=randread
directory=/mnt/readcache
[reader3]
rw=randread
directory=/mnt/readcache
[reader4]
rw=randread
directory=/mnt/readcache

[writer1]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer2]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer3]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
[writer4]
rw=randwrite
directory=/mnt/nocache
rate_iops=12500
```

<span data-ttu-id="413a7-876">Note the follow key things that are in line with the design guidelines discussed in previous sections.</span><span class="sxs-lookup"><span data-stu-id="413a7-876">Note the follow key things that are in line with the design guidelines discussed in previous sections.</span></span> <span data-ttu-id="413a7-877">These specifications are essential to drive maximum IOPS,</span><span class="sxs-lookup"><span data-stu-id="413a7-877">These specifications are essential to drive maximum IOPS,</span></span>

* <span data-ttu-id="413a7-878">A high queue depth of 128.</span><span class="sxs-lookup"><span data-stu-id="413a7-878">A high queue depth of 128.</span></span>  
* <span data-ttu-id="413a7-879">A small block size of 4KB.</span><span class="sxs-lookup"><span data-stu-id="413a7-879">A small block size of 4KB.</span></span>  
* <span data-ttu-id="413a7-880">Multiple threads performing random reads and writes.</span><span class="sxs-lookup"><span data-stu-id="413a7-880">Multiple threads performing random reads and writes.</span></span>

<span data-ttu-id="413a7-881">Run the following command to kick off the FIO test for 30 seconds,</span><span class="sxs-lookup"><span data-stu-id="413a7-881">Run the following command to kick off the FIO test for 30 seconds,</span></span>

```
sudo fio --runtime 30 fioreadwrite.ini
```

<span data-ttu-id="413a7-882">While the test runs, you will be able to see the number of combined read and write IOPS the VM and Premium disks are delivering.</span><span class="sxs-lookup"><span data-stu-id="413a7-882">While the test runs, you will be able to see the number of combined read and write IOPS the VM and Premium disks are delivering.</span></span> <span data-ttu-id="413a7-883">As shown in the sample below, the DS14 VM is delivering more than 100,000 combined Read and Write IOPS.</span><span class="sxs-lookup"><span data-stu-id="413a7-883">As shown in the sample below, the DS14 VM is delivering more than 100,000 combined Read and Write IOPS.</span></span> <span data-ttu-id="413a7-884">This is a combination of the disk and the cache performance.</span><span class="sxs-lookup"><span data-stu-id="413a7-884">This is a combination of the disk and the cache performance.</span></span>  
    ![](media/premium-storage-performance/image13.png)

<span data-ttu-id="413a7-885">*Maximum Combined Throughput*</span><span class="sxs-lookup"><span data-stu-id="413a7-885">*Maximum Combined Throughput*</span></span>  
<span data-ttu-id="413a7-886">To get the maximum combined Read and Write Throughput, use a larger block size and large queue depth with multiple threads performing reads and writes.</span><span class="sxs-lookup"><span data-stu-id="413a7-886">To get the maximum combined Read and Write Throughput, use a larger block size and large queue depth with multiple threads performing reads and writes.</span></span> <span data-ttu-id="413a7-887">You can use a block size of 64KB and queue depth of 128.</span><span class="sxs-lookup"><span data-stu-id="413a7-887">You can use a block size of 64KB and queue depth of 128.</span></span>

## <a name="next-steps"></a><span data-ttu-id="413a7-888">Next Steps</span><span class="sxs-lookup"><span data-stu-id="413a7-888">Next Steps</span></span>
<span data-ttu-id="413a7-889">Learn more about Azure Premium Storage:</span><span class="sxs-lookup"><span data-stu-id="413a7-889">Learn more about Azure Premium Storage:</span></span>

* [<span data-ttu-id="413a7-890">Premium Storage: High-Performance Storage for Azure Virtual Machine Workloads</span><span class="sxs-lookup"><span data-stu-id="413a7-890">Premium Storage: High-Performance Storage for Azure Virtual Machine Workloads</span></span>](../articles/virtual-machines/windows/premium-storage.md)  

<span data-ttu-id="413a7-891">For SQL Server users, read articles on Performance Best Practices for SQL Server:</span><span class="sxs-lookup"><span data-stu-id="413a7-891">For SQL Server users, read articles on Performance Best Practices for SQL Server:</span></span>

* [<span data-ttu-id="413a7-892">Performance Best Practices for SQL Server in Azure Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="413a7-892">Performance Best Practices for SQL Server in Azure Virtual Machines</span></span>](../articles/virtual-machines/windows/sql/virtual-machines-windows-sql-performance.md)
* [<span data-ttu-id="413a7-893">Azure Premium Storage provides highest performance for SQL Server in Azure VM</span><span class="sxs-lookup"><span data-stu-id="413a7-893">Azure Premium Storage provides highest performance for SQL Server in Azure VM</span></span>](http://blogs.technet.com/b/dataplatforminsider/archive/2015/04/23/azure-premium-storage-provides-highest-performance-for-sql-server-in-azure-vm.aspx)
