---
title: Deploy an App on Virtual Machine Scale Sets| Microsoft Docs
description: Deploy an app on Virtual Machine Scale Sets
services: virtual-machine-scale-sets
documentationcenter: ''
author: gbowerman
manager: timlt
editor: ''
tags: azure-resource-manager
ms.assetid: f8892199-f2e2-4b82-988a-28ca8a7fd1eb
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/07/2017
ms.author: guybo
ms.openlocfilehash: f39840ab2fb31775c9703799393d8c386a8451ee
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44672139"
---
# <a name="deploy-an-app-on-virtual-machine-scale-sets"></a><span data-ttu-id="1e95d-103">Deploy an App on Virtual Machine Scale Sets</span><span class="sxs-lookup"><span data-stu-id="1e95d-103">Deploy an App on Virtual Machine Scale Sets</span></span>
<span data-ttu-id="1e95d-104">An application running on a VM Scale Set is typically deployed in one of three ways:</span><span class="sxs-lookup"><span data-stu-id="1e95d-104">An application running on a VM Scale Set is typically deployed in one of three ways:</span></span>

* <span data-ttu-id="1e95d-105">Install new software on a platform image at deployment time</span><span class="sxs-lookup"><span data-stu-id="1e95d-105">Install new software on a platform image at deployment time</span></span>
* <span data-ttu-id="1e95d-106">Create a custom VM image that includes both the OS and the application in a single VHD</span><span class="sxs-lookup"><span data-stu-id="1e95d-106">Create a custom VM image that includes both the OS and the application in a single VHD</span></span>
* <span data-ttu-id="1e95d-107">Deploy a platform or a custom image as a container host and your app as one or more containers</span><span class="sxs-lookup"><span data-stu-id="1e95d-107">Deploy a platform or a custom image as a container host and your app as one or more containers</span></span>

## <a name="install-new-software-on-a-platform-image-at-deployment-time"></a><span data-ttu-id="1e95d-108">Install new software on a platform image at deployment time</span><span class="sxs-lookup"><span data-stu-id="1e95d-108">Install new software on a platform image at deployment time</span></span>
<span data-ttu-id="1e95d-109">A platform image in this context is an operating system image from the Azure Marketplace, like Ubuntu 16.04, Windows Server 2012 R2, etc.</span><span class="sxs-lookup"><span data-stu-id="1e95d-109">A platform image in this context is an operating system image from the Azure Marketplace, like Ubuntu 16.04, Windows Server 2012 R2, etc.</span></span>

<span data-ttu-id="1e95d-110">You can install new software on a platform image using a [VM Extension](../virtual-machines/windows/extensions-features.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="1e95d-110">You can install new software on a platform image using a [VM Extension](../virtual-machines/windows/extensions-features.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span> <span data-ttu-id="1e95d-111">A VM extension is software that runs when a VM is deployed.</span><span class="sxs-lookup"><span data-stu-id="1e95d-111">A VM extension is software that runs when a VM is deployed.</span></span> <span data-ttu-id="1e95d-112">You can run any code you like at deployment time using a custom script extension.</span><span class="sxs-lookup"><span data-stu-id="1e95d-112">You can run any code you like at deployment time using a custom script extension.</span></span> <span data-ttu-id="1e95d-113">[Here](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-webapp-dsc-autoscale) is an example Azure Resource Manager Template that uses an [Azure Desired State Configuration (DSC) extension](virtual-machine-scale-sets-dsc.md) to install IIS and a .NET MVC application integrated with Azure autoscale.</span><span class="sxs-lookup"><span data-stu-id="1e95d-113">[Here](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-windows-webapp-dsc-autoscale) is an example Azure Resource Manager Template that uses an [Azure Desired State Configuration (DSC) extension](virtual-machine-scale-sets-dsc.md) to install IIS and a .NET MVC application integrated with Azure autoscale.</span></span>

<span data-ttu-id="1e95d-114">An advantage of this approach is you have a level of separation between your application code and the OS, and can maintain your application separately.</span><span class="sxs-lookup"><span data-stu-id="1e95d-114">An advantage of this approach is you have a level of separation between your application code and the OS, and can maintain your application separately.</span></span> <span data-ttu-id="1e95d-115">Of course that means there are also more moving parts, and VM deployment time could be longer if there is a lot for the script to download and configure.</span><span class="sxs-lookup"><span data-stu-id="1e95d-115">Of course that means there are also more moving parts, and VM deployment time could be longer if there is a lot for the script to download and configure.</span></span>

>[!NOTE]
><span data-ttu-id="1e95d-116">If you pass sensitive information in your Custom Script Extension command (such as a password), be sure to specify the `commandToExecute` in the `protectedSettings` attribute of the Custom Script Extension instead of the `settings` attribute.</span><span class="sxs-lookup"><span data-stu-id="1e95d-116">If you pass sensitive information in your Custom Script Extension command (such as a password), be sure to specify the `commandToExecute` in the `protectedSettings` attribute of the Custom Script Extension instead of the `settings` attribute.</span></span>

## <a name="create-a-custom-vm-image-that-includes-both-the-os-and-the-application-in-a-single-vhd"></a><span data-ttu-id="1e95d-117">Create a custom VM image that includes both the OS and the application in a single VHD</span><span class="sxs-lookup"><span data-stu-id="1e95d-117">Create a custom VM image that includes both the OS and the application in a single VHD</span></span> 
<span data-ttu-id="1e95d-118">Here the scale set consists of a set of VMs copied from an image created by you, which you have to maintain.</span><span class="sxs-lookup"><span data-stu-id="1e95d-118">Here the scale set consists of a set of VMs copied from an image created by you, which you have to maintain.</span></span> <span data-ttu-id="1e95d-119">This approach requires no extra configuration at VM deployment time.</span><span class="sxs-lookup"><span data-stu-id="1e95d-119">This approach requires no extra configuration at VM deployment time.</span></span> <span data-ttu-id="1e95d-120">However, in the `2016-03-30` version of VM Scale Sets (and earlier versions), the OS disks for the VMs in the scale set are limited to a single storage account.</span><span class="sxs-lookup"><span data-stu-id="1e95d-120">However, in the `2016-03-30` version of VM Scale Sets (and earlier versions), the OS disks for the VMs in the scale set are limited to a single storage account.</span></span> <span data-ttu-id="1e95d-121">Thus, you can have a maximum of 40 VMs in a scale set, as opposed to the 100 VM per scale set limit with platform images.</span><span class="sxs-lookup"><span data-stu-id="1e95d-121">Thus, you can have a maximum of 40 VMs in a scale set, as opposed to the 100 VM per scale set limit with platform images.</span></span> <span data-ttu-id="1e95d-122">See [Scale Set Design Overview](virtual-machine-scale-sets-design-overview.md) for more details.</span><span class="sxs-lookup"><span data-stu-id="1e95d-122">See [Scale Set Design Overview](virtual-machine-scale-sets-design-overview.md) for more details.</span></span>

>[!NOTE]
><span data-ttu-id="1e95d-123">VM Scale Sets API version `2016-04-30-preview` supports using Azure Managed Disks for the Operating System disk and any extra data disks.</span><span class="sxs-lookup"><span data-stu-id="1e95d-123">VM Scale Sets API version `2016-04-30-preview` supports using Azure Managed Disks for the Operating System disk and any extra data disks.</span></span> <span data-ttu-id="1e95d-124">For more information, see [Managed Disks Overview](../storage/storage-managed-disks-overview.md) and [Use Attached Data Disks](virtual-machine-scale-sets-attached-disks.md).</span><span class="sxs-lookup"><span data-stu-id="1e95d-124">For more information, see [Managed Disks Overview](../storage/storage-managed-disks-overview.md) and [Use Attached Data Disks](virtual-machine-scale-sets-attached-disks.md).</span></span> 

## <a name="deploy-a-platform-or-a-custom-image-as-a-container-host-and-your-app-as-one-or-more-containers"></a><span data-ttu-id="1e95d-125">Deploy a platform or a custom image as a container host and your app as one or more containers</span><span class="sxs-lookup"><span data-stu-id="1e95d-125">Deploy a platform or a custom image as a container host and your app as one or more containers</span></span>
<span data-ttu-id="1e95d-126">A platform or a custom image is basically a container host, so you can install your application as one or more containers.</span><span class="sxs-lookup"><span data-stu-id="1e95d-126">A platform or a custom image is basically a container host, so you can install your application as one or more containers.</span></span>  <span data-ttu-id="1e95d-127">You can manage your application containers with an orchestrator or configuration management tool.</span><span class="sxs-lookup"><span data-stu-id="1e95d-127">You can manage your application containers with an orchestrator or configuration management tool.</span></span> <span data-ttu-id="1e95d-128">The nice thing about this approach is that you have abstracted your cloud infrastructure from the application layer and can maintain them separately.</span><span class="sxs-lookup"><span data-stu-id="1e95d-128">The nice thing about this approach is that you have abstracted your cloud infrastructure from the application layer and can maintain them separately.</span></span>

## <a name="what-happens-when-a-vm-scale-set-scales-out"></a><span data-ttu-id="1e95d-129">What happens when a VM Scale Set scales out?</span><span class="sxs-lookup"><span data-stu-id="1e95d-129">What happens when a VM Scale Set scales out?</span></span>
<span data-ttu-id="1e95d-130">When you add one or more VMs to a scale set by increasing the capacity – whether manually or through autoscale – the application is automatically installed.</span><span class="sxs-lookup"><span data-stu-id="1e95d-130">When you add one or more VMs to a scale set by increasing the capacity – whether manually or through autoscale – the application is automatically installed.</span></span> <span data-ttu-id="1e95d-131">For example if the scale set has extensions defined, they run on a new VM each time it is created.</span><span class="sxs-lookup"><span data-stu-id="1e95d-131">For example if the scale set has extensions defined, they run on a new VM each time it is created.</span></span> <span data-ttu-id="1e95d-132">If the scale set is based on a custom image, any new VM is a copy of the source custom image.</span><span class="sxs-lookup"><span data-stu-id="1e95d-132">If the scale set is based on a custom image, any new VM is a copy of the source custom image.</span></span> <span data-ttu-id="1e95d-133">If the scale set VMs are container hosts, then you might have startup code to load the containers in a Custom Script Extension, or an extension might install an agent that registers with a cluster orchestrator (such as Azure Container Service).</span><span class="sxs-lookup"><span data-stu-id="1e95d-133">If the scale set VMs are container hosts, then you might have startup code to load the containers in a Custom Script Extension, or an extension might install an agent that registers with a cluster orchestrator (such as Azure Container Service).</span></span>

## <a name="how-do-you-manage-application-updates-in-vm-scale-sets"></a><span data-ttu-id="1e95d-134">How do you manage application updates in VM Scale Sets?</span><span class="sxs-lookup"><span data-stu-id="1e95d-134">How do you manage application updates in VM Scale Sets?</span></span>
<span data-ttu-id="1e95d-135">For application updates in VM Scale Sets, three main approaches follow from the three preceding application deployment methods:</span><span class="sxs-lookup"><span data-stu-id="1e95d-135">For application updates in VM Scale Sets, three main approaches follow from the three preceding application deployment methods:</span></span>

* <span data-ttu-id="1e95d-136">Updating with VM extensions.</span><span class="sxs-lookup"><span data-stu-id="1e95d-136">Updating with VM extensions.</span></span> <span data-ttu-id="1e95d-137">Any VM extensions that are defined for a VM Scale Set are executed each time a new VM is deployed, an existing VM is reimaged, or a VM extension is updated.</span><span class="sxs-lookup"><span data-stu-id="1e95d-137">Any VM extensions that are defined for a VM Scale Set are executed each time a new VM is deployed, an existing VM is reimaged, or a VM extension is updated.</span></span> <span data-ttu-id="1e95d-138">If you need to update your application, directly updating an application through extensions is a viable approach – you simply update the extension definition.</span><span class="sxs-lookup"><span data-stu-id="1e95d-138">If you need to update your application, directly updating an application through extensions is a viable approach – you simply update the extension definition.</span></span> <span data-ttu-id="1e95d-139">One simple way to do so is by changing the fileUris to point to the new software.</span><span class="sxs-lookup"><span data-stu-id="1e95d-139">One simple way to do so is by changing the fileUris to point to the new software.</span></span>

* <span data-ttu-id="1e95d-140">The immutable custom image approach.</span><span class="sxs-lookup"><span data-stu-id="1e95d-140">The immutable custom image approach.</span></span> <span data-ttu-id="1e95d-141">When you bake the application (or app components) into a VM image you can focus on building a reliable pipeline to automate build, test, and deployment of the images.</span><span class="sxs-lookup"><span data-stu-id="1e95d-141">When you bake the application (or app components) into a VM image you can focus on building a reliable pipeline to automate build, test, and deployment of the images.</span></span> <span data-ttu-id="1e95d-142">You can design your architecture to facilitate rapid swapping of a staged scale set into production.</span><span class="sxs-lookup"><span data-stu-id="1e95d-142">You can design your architecture to facilitate rapid swapping of a staged scale set into production.</span></span> <span data-ttu-id="1e95d-143">A good example of this approach is the [Azure Spinnaker driver work](https://github.com/spinnaker/deck/tree/master/app/scripts/modules/azure) - [http://www.spinnaker.io/](http://www.spinnaker.io/).</span><span class="sxs-lookup"><span data-stu-id="1e95d-143">A good example of this approach is the [Azure Spinnaker driver work](https://github.com/spinnaker/deck/tree/master/app/scripts/modules/azure) - [http://www.spinnaker.io/](http://www.spinnaker.io/).</span></span>

<span data-ttu-id="1e95d-144">Packer and Terraform also support Azure Resource Manager, so you can also define your images “as code” and build them in Azure, then use the VHD in your scale set.</span><span class="sxs-lookup"><span data-stu-id="1e95d-144">Packer and Terraform also support Azure Resource Manager, so you can also define your images “as code” and build them in Azure, then use the VHD in your scale set.</span></span> <span data-ttu-id="1e95d-145">However, doing so would become problematic for Marketplace images, where extensions/custom scripts become more important since you don’t directly manipulate bits from Marketplace.</span><span class="sxs-lookup"><span data-stu-id="1e95d-145">However, doing so would become problematic for Marketplace images, where extensions/custom scripts become more important since you don’t directly manipulate bits from Marketplace.</span></span>

* <span data-ttu-id="1e95d-146">Update containers.</span><span class="sxs-lookup"><span data-stu-id="1e95d-146">Update containers.</span></span> <span data-ttu-id="1e95d-147">Abstract the application lifecycle management to a level above the cloud infrastructure, for example by encapsulating applications, and app components into containers and manage these containers through container orchestrators and configuration managers like Chef/Puppet.</span><span class="sxs-lookup"><span data-stu-id="1e95d-147">Abstract the application lifecycle management to a level above the cloud infrastructure, for example by encapsulating applications, and app components into containers and manage these containers through container orchestrators and configuration managers like Chef/Puppet.</span></span>

<span data-ttu-id="1e95d-148">The scale set VMs then become a stable substrate for the containers and only require occasional security and OS-related updates.</span><span class="sxs-lookup"><span data-stu-id="1e95d-148">The scale set VMs then become a stable substrate for the containers and only require occasional security and OS-related updates.</span></span> <span data-ttu-id="1e95d-149">As mentioned, the Azure Container Service is a good example of taking this approach and building a service around it.</span><span class="sxs-lookup"><span data-stu-id="1e95d-149">As mentioned, the Azure Container Service is a good example of taking this approach and building a service around it.</span></span>

## <a name="how-do-you-roll-out-an-os-update-across-update-domains"></a><span data-ttu-id="1e95d-150">How do you roll out an OS update across update domains?</span><span class="sxs-lookup"><span data-stu-id="1e95d-150">How do you roll out an OS update across update domains?</span></span>
<span data-ttu-id="1e95d-151">Suppose you want to update your OS image while keeping the VM Scale Set running.</span><span class="sxs-lookup"><span data-stu-id="1e95d-151">Suppose you want to update your OS image while keeping the VM Scale Set running.</span></span> <span data-ttu-id="1e95d-152">One way to do so is to update the VM images one VM at a time.</span><span class="sxs-lookup"><span data-stu-id="1e95d-152">One way to do so is to update the VM images one VM at a time.</span></span> <span data-ttu-id="1e95d-153">You can do so with PowerShell or Azure CLI.</span><span class="sxs-lookup"><span data-stu-id="1e95d-153">You can do so with PowerShell or Azure CLI.</span></span> <span data-ttu-id="1e95d-154">There are separate commands to update the VM Scale Set model (how its configuration is defined), and to issue "manual upgrade" calls on individual VMs.</span><span class="sxs-lookup"><span data-stu-id="1e95d-154">There are separate commands to update the VM Scale Set model (how its configuration is defined), and to issue "manual upgrade" calls on individual VMs.</span></span> <span data-ttu-id="1e95d-155">The [Upgrade a Virtual Machine Scale Set](./virtual-machine-scale-sets-upgrade-scale-set.md) Azure document also provides further information on what options are available to perform OS upgrades across a VM Scale Set.</span><span class="sxs-lookup"><span data-stu-id="1e95d-155">The [Upgrade a Virtual Machine Scale Set](./virtual-machine-scale-sets-upgrade-scale-set.md) Azure document also provides further information on what options are available to perform OS upgrades across a VM Scale Set.</span></span>

