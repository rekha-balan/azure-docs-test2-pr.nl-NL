---
title: Working with large Azure Virtual Machine Scale Sets | Microsoft Docs
description: What you need to know to use large Azure virtual machine scale sets
services: virtual-machine-scale-sets
documentationcenter: ''
author: gbowerman
manager: timlt
editor: ''
tags: azure-resource-manager
ms.assetid: 76ac7fd7-2e05-4762-88ca-3b499e87906e
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 2/7/2017
ms.author: guybo
ms.openlocfilehash: 6654e0700794c417a65fe0ec504b5054b177c06a
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44552868"
---
# <a name="working-with-large-virtual-machine-scale-sets"></a><span data-ttu-id="fe362-103">Working with large virtual machine scale sets</span><span class="sxs-lookup"><span data-stu-id="fe362-103">Working with large virtual machine scale sets</span></span>
<span data-ttu-id="fe362-104">You can now create Azure [virtual machine scale sets](/azure/virtual-machine-scale-sets/) with a capacity of up to 1,000 VMs.</span><span class="sxs-lookup"><span data-stu-id="fe362-104">You can now create Azure [virtual machine scale sets](/azure/virtual-machine-scale-sets/) with a capacity of up to 1,000 VMs.</span></span> <span data-ttu-id="fe362-105">In this document, a _large virtual machine scale set_ is defined as a scale set capable of scaling to greater than 100 VMs.</span><span class="sxs-lookup"><span data-stu-id="fe362-105">In this document, a _large virtual machine scale set_ is defined as a scale set capable of scaling to greater than 100 VMs.</span></span> <span data-ttu-id="fe362-106">This capability is set by a scale set property (_singlePlacementGroup=False_).</span><span class="sxs-lookup"><span data-stu-id="fe362-106">This capability is set by a scale set property (_singlePlacementGroup=False_).</span></span> 

<span data-ttu-id="fe362-107">Certain aspects of large scale sets, such as load balancing and fault domains behave differently to a standard scale set.</span><span class="sxs-lookup"><span data-stu-id="fe362-107">Certain aspects of large scale sets, such as load balancing and fault domains behave differently to a standard scale set.</span></span> <span data-ttu-id="fe362-108">This document explains the characteristics of large scale sets, and describes what you need to know to successfully use them in your applications.</span><span class="sxs-lookup"><span data-stu-id="fe362-108">This document explains the characteristics of large scale sets, and describes what you need to know to successfully use them in your applications.</span></span> 

<span data-ttu-id="fe362-109">A common approach for deploying cloud infrastructure at large scale is to create a set of _scale units_, for example by creating multiple VMs scale sets across multiple VNETs and storage accounts.</span><span class="sxs-lookup"><span data-stu-id="fe362-109">A common approach for deploying cloud infrastructure at large scale is to create a set of _scale units_, for example by creating multiple VMs scale sets across multiple VNETs and storage accounts.</span></span> <span data-ttu-id="fe362-110">This approach provides easier management compared to single VMs, and multiple scale units are useful for many applications, particularly those that require other stackable components like multiple virtual networks and endpoints.</span><span class="sxs-lookup"><span data-stu-id="fe362-110">This approach provides easier management compared to single VMs, and multiple scale units are useful for many applications, particularly those that require other stackable components like multiple virtual networks and endpoints.</span></span> <span data-ttu-id="fe362-111">If your application requires a single large cluster however, it can be more straightforward to deploy a single scale set of up to 1,000 VMs.</span><span class="sxs-lookup"><span data-stu-id="fe362-111">If your application requires a single large cluster however, it can be more straightforward to deploy a single scale set of up to 1,000 VMs.</span></span> <span data-ttu-id="fe362-112">Example scenarios include centralized big data deployments, or compute grids requiring simple management of a large pool of worker nodes.</span><span class="sxs-lookup"><span data-stu-id="fe362-112">Example scenarios include centralized big data deployments, or compute grids requiring simple management of a large pool of worker nodes.</span></span> <span data-ttu-id="fe362-113">Combined with VM scale set [attached data disks](virtual-machine-scale-sets-attached-disks.md), large scale sets enable you to deploy a scalable infrastructure consisting of thousands of cores and petabytes of storage, as a single operation.</span><span class="sxs-lookup"><span data-stu-id="fe362-113">Combined with VM scale set [attached data disks](virtual-machine-scale-sets-attached-disks.md), large scale sets enable you to deploy a scalable infrastructure consisting of thousands of cores and petabytes of storage, as a single operation.</span></span>

## <a name="placement-groups"></a><span data-ttu-id="fe362-114">Placement groups</span><span class="sxs-lookup"><span data-stu-id="fe362-114">Placement groups</span></span> 
<span data-ttu-id="fe362-115">What makes a _large_ scale set special is not the number of VMs, but the number of _placement groups_ it contains.</span><span class="sxs-lookup"><span data-stu-id="fe362-115">What makes a _large_ scale set special is not the number of VMs, but the number of _placement groups_ it contains.</span></span> <span data-ttu-id="fe362-116">A placement group is a construct similar to an Azure availability set, with its own fault domains and upgrade domains.</span><span class="sxs-lookup"><span data-stu-id="fe362-116">A placement group is a construct similar to an Azure availability set, with its own fault domains and upgrade domains.</span></span> <span data-ttu-id="fe362-117">By default, a scale set consists of a single placement group with a maximum size of 100 VMs.</span><span class="sxs-lookup"><span data-stu-id="fe362-117">By default, a scale set consists of a single placement group with a maximum size of 100 VMs.</span></span> <span data-ttu-id="fe362-118">If a scale set property called _singlePlacementGroup_ is set to _false_, the scale set can be composed of multiple placement groups and has a range of 0-1,000 VMs.</span><span class="sxs-lookup"><span data-stu-id="fe362-118">If a scale set property called _singlePlacementGroup_ is set to _false_, the scale set can be composed of multiple placement groups and has a range of 0-1,000 VMs.</span></span> <span data-ttu-id="fe362-119">When set to the default value of _true_, a scale set is composed of a single placement group, and has a range of 0-100 VMs.</span><span class="sxs-lookup"><span data-stu-id="fe362-119">When set to the default value of _true_, a scale set is composed of a single placement group, and has a range of 0-100 VMs.</span></span>

## <a name="checklist-for-using-large-scale-sets"></a><span data-ttu-id="fe362-120">Checklist for using large scale sets</span><span class="sxs-lookup"><span data-stu-id="fe362-120">Checklist for using large scale sets</span></span>
<span data-ttu-id="fe362-121">To decide whether your application can make effective use of large scale sets, consider the following requirements:</span><span class="sxs-lookup"><span data-stu-id="fe362-121">To decide whether your application can make effective use of large scale sets, consider the following requirements:</span></span>

- <span data-ttu-id="fe362-122">Large scale sets require Azure Managed Disks.</span><span class="sxs-lookup"><span data-stu-id="fe362-122">Large scale sets require Azure Managed Disks.</span></span> <span data-ttu-id="fe362-123">Scale sets that are not created with Managed Disks require multiple storage accounts (one for every 20 VMs).</span><span class="sxs-lookup"><span data-stu-id="fe362-123">Scale sets that are not created with Managed Disks require multiple storage accounts (one for every 20 VMs).</span></span> <span data-ttu-id="fe362-124">Large scale sets are designed to work exclusively with Managed Disks to reduce your storage management overhead, and to avoid the risk of running into subscription limits for storage accounts.</span><span class="sxs-lookup"><span data-stu-id="fe362-124">Large scale sets are designed to work exclusively with Managed Disks to reduce your storage management overhead, and to avoid the risk of running into subscription limits for storage accounts.</span></span> <span data-ttu-id="fe362-125">If you do not use Managed Disks, your scale set is limited to 100 VMs.</span><span class="sxs-lookup"><span data-stu-id="fe362-125">If you do not use Managed Disks, your scale set is limited to 100 VMs.</span></span>
- <span data-ttu-id="fe362-126">Scale sets created from Azure Marketplace images can scale up to 1,000 VMs.</span><span class="sxs-lookup"><span data-stu-id="fe362-126">Scale sets created from Azure Marketplace images can scale up to 1,000 VMs.</span></span>
- <span data-ttu-id="fe362-127">Scale sets created from custom images (VM images you create and upload yourself) can currently scale up to 100 VMs.</span><span class="sxs-lookup"><span data-stu-id="fe362-127">Scale sets created from custom images (VM images you create and upload yourself) can currently scale up to 100 VMs.</span></span>
- <span data-ttu-id="fe362-128">Layer-4 load balancing with the Azure Load Balancer is not yet supported for scale sets composed of multiple placement groups.</span><span class="sxs-lookup"><span data-stu-id="fe362-128">Layer-4 load balancing with the Azure Load Balancer is not yet supported for scale sets composed of multiple placement groups.</span></span> <span data-ttu-id="fe362-129">If you need to use the Azure Load Balancer make sure the scale set is configured to use a single placement group, which is the default setting.</span><span class="sxs-lookup"><span data-stu-id="fe362-129">If you need to use the Azure Load Balancer make sure the scale set is configured to use a single placement group, which is the default setting.</span></span>
- <span data-ttu-id="fe362-130">Layer-7 load balancing with the Azure Application Gateway is supported for all scale sets.</span><span class="sxs-lookup"><span data-stu-id="fe362-130">Layer-7 load balancing with the Azure Application Gateway is supported for all scale sets.</span></span>
- <span data-ttu-id="fe362-131">A scale set is defined with a single subnet - make sure your subnet has an address space large enough for all the VMs you need.</span><span class="sxs-lookup"><span data-stu-id="fe362-131">A scale set is defined with a single subnet - make sure your subnet has an address space large enough for all the VMs you need.</span></span> <span data-ttu-id="fe362-132">By default a scale set overprovisions (creates extra VMs at deployment time or when scaling out, which you are not charged for) to improve deployment reliability and performance.</span><span class="sxs-lookup"><span data-stu-id="fe362-132">By default a scale set overprovisions (creates extra VMs at deployment time or when scaling out, which you are not charged for) to improve deployment reliability and performance.</span></span> <span data-ttu-id="fe362-133">Allow for an address space 20% greater than the number of VMs you plan to scale to.</span><span class="sxs-lookup"><span data-stu-id="fe362-133">Allow for an address space 20% greater than the number of VMs you plan to scale to.</span></span>
- <span data-ttu-id="fe362-134">If you are planning to deploy many VMs, your Compute core quota limits may need to be increased.</span><span class="sxs-lookup"><span data-stu-id="fe362-134">If you are planning to deploy many VMs, your Compute core quota limits may need to be increased.</span></span>
- <span data-ttu-id="fe362-135">Fault domains and upgrade domains are only consistent within a placement group.</span><span class="sxs-lookup"><span data-stu-id="fe362-135">Fault domains and upgrade domains are only consistent within a placement group.</span></span> <span data-ttu-id="fe362-136">This architecture does not change the overall availability of a scale set, as VMs are evenly distributed across distinct physical hardware, but it does means that if you need to guarantee two VMs are on different hardware, make sure they are in different fault domains in the same placement group.</span><span class="sxs-lookup"><span data-stu-id="fe362-136">This architecture does not change the overall availability of a scale set, as VMs are evenly distributed across distinct physical hardware, but it does means that if you need to guarantee two VMs are on different hardware, make sure they are in different fault domains in the same placement group.</span></span> <span data-ttu-id="fe362-137">Fault domain and placement group ID are shown in the _instance view_ of a scale set VM.</span><span class="sxs-lookup"><span data-stu-id="fe362-137">Fault domain and placement group ID are shown in the _instance view_ of a scale set VM.</span></span> <span data-ttu-id="fe362-138">You can view the instance view of a scale set VM in the [Azure Resource Explorer](https://resources.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="fe362-138">You can view the instance view of a scale set VM in the [Azure Resource Explorer](https://resources.azure.com/).</span></span>


## <a name="creating-a-large-scale-set"></a><span data-ttu-id="fe362-139">Creating a large scale set</span><span class="sxs-lookup"><span data-stu-id="fe362-139">Creating a large scale set</span></span>
<span data-ttu-id="fe362-140">When you create a scale set in the Azure portal, you can allow it to scale to multiple placement groups by setting the _Limit to a single placement group_ option to _False_ in the _Basics_ blade.</span><span class="sxs-lookup"><span data-stu-id="fe362-140">When you create a scale set in the Azure portal, you can allow it to scale to multiple placement groups by setting the _Limit to a single placement group_ option to _False_ in the _Basics_ blade.</span></span> <span data-ttu-id="fe362-141">With this option set to _False_, you can specify an _Instance count_ value of up to 1,000.</span><span class="sxs-lookup"><span data-stu-id="fe362-141">With this option set to _False_, you can specify an _Instance count_ value of up to 1,000.</span></span>

![](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machine-scale-sets/media/virtual-machine-scale-sets-placement-groups/portal-large-scale.png)

<span data-ttu-id="fe362-142">You can create a large VM scale set using the [Azure CLI](https://github.com/Azure/azure-cli) _az vmss create_ command.</span><span class="sxs-lookup"><span data-stu-id="fe362-142">You can create a large VM scale set using the [Azure CLI](https://github.com/Azure/azure-cli) _az vmss create_ command.</span></span> <span data-ttu-id="fe362-143">This command sets intelligent defaults such as subnet size based on the _instance-count_ argument:</span><span class="sxs-lookup"><span data-stu-id="fe362-143">This command sets intelligent defaults such as subnet size based on the _instance-count_ argument:</span></span>

```bash
az group create -l southcentralus -n biginfra
az vmss create -g biginfra -n bigvmss --image ubuntults --instance-count 1000
```
<span data-ttu-id="fe362-144">Note that the _vmss create_ command defaults certain configuration values if you do not specify them.</span><span class="sxs-lookup"><span data-stu-id="fe362-144">Note that the _vmss create_ command defaults certain configuration values if you do not specify them.</span></span> <span data-ttu-id="fe362-145">To see the available options that you can override, try:</span><span class="sxs-lookup"><span data-stu-id="fe362-145">To see the available options that you can override, try:</span></span>
```bash
az vmss create --help
```

<span data-ttu-id="fe362-146">If you are creating a large scale set by composing an Azure Resource Manager template, make sure the template creates a scale set based on Azure Managed Disks.</span><span class="sxs-lookup"><span data-stu-id="fe362-146">If you are creating a large scale set by composing an Azure Resource Manager template, make sure the template creates a scale set based on Azure Managed Disks.</span></span> <span data-ttu-id="fe362-147">You can set the _singlePlacementGroup_ property to _false_ in the _properties_ section of the _Microsoft.Compute/virtualMAchineScaleSets_ resource.</span><span class="sxs-lookup"><span data-stu-id="fe362-147">You can set the _singlePlacementGroup_ property to _false_ in the _properties_ section of the _Microsoft.Compute/virtualMAchineScaleSets_ resource.</span></span> <span data-ttu-id="fe362-148">The following JSON fragment shows the beginning of a scale set template, including the 1,000 VM capacity and the _"singlePlacementGroup" : false_ setting:</span><span class="sxs-lookup"><span data-stu-id="fe362-148">The following JSON fragment shows the beginning of a scale set template, including the 1,000 VM capacity and the _"singlePlacementGroup" : false_ setting:</span></span>
```json
{
  "type": "Microsoft.Compute/virtualMachineScaleSets",
  "location": "australiaeast",
  "name": "bigvmss",
  "sku": {
    "name": "Standard_DS1_v2",
    "tier": "Standard",
    "capacity": 1000
  },
  "properties": {
    "singlePlacementGroup": false,
    "upgradePolicy": {
      "mode": "Automatic"
    }
```
<span data-ttu-id="fe362-149">For a complete example of a large scale set template, refer to [https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json](https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json).</span><span class="sxs-lookup"><span data-stu-id="fe362-149">For a complete example of a large scale set template, refer to [https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json](https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json).</span></span>

## <a name="converting-an-existing-scale-set-to-span-multiple-placement-groups"></a><span data-ttu-id="fe362-150">Converting an existing scale set to span multiple placement groups</span><span class="sxs-lookup"><span data-stu-id="fe362-150">Converting an existing scale set to span multiple placement groups</span></span>
<span data-ttu-id="fe362-151">To make an existing VM scale set capable of scaling to more than 100 VMs, you need to change the _singplePlacementGroup_ property to _false_ in the scale set model.</span><span class="sxs-lookup"><span data-stu-id="fe362-151">To make an existing VM scale set capable of scaling to more than 100 VMs, you need to change the _singplePlacementGroup_ property to _false_ in the scale set model.</span></span> <span data-ttu-id="fe362-152">You can test changing this property with the [Azure Resource Explorer](https://resources.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="fe362-152">You can test changing this property with the [Azure Resource Explorer](https://resources.azure.com/).</span></span> <span data-ttu-id="fe362-153">Find an existing scale set, select _Edit_ and change the _singlePlacementGroup_ property.</span><span class="sxs-lookup"><span data-stu-id="fe362-153">Find an existing scale set, select _Edit_ and change the _singlePlacementGroup_ property.</span></span> <span data-ttu-id="fe362-154">If you do not see this property, you may be viewing the scale set with an older version of the Microsoft.Compute API.</span><span class="sxs-lookup"><span data-stu-id="fe362-154">If you do not see this property, you may be viewing the scale set with an older version of the Microsoft.Compute API.</span></span>

>[!NOTE] 
<span data-ttu-id="fe362-155">You can change a scale set from supporting a single placement group only (the default behavior) to a supporting multiple placement groups, but you cannot convert the other way around.</span><span class="sxs-lookup"><span data-stu-id="fe362-155">You can change a scale set from supporting a single placement group only (the default behavior) to a supporting multiple placement groups, but you cannot convert the other way around.</span></span> <span data-ttu-id="fe362-156">Therefore make sure you understand the properties of large scale sets before converting.</span><span class="sxs-lookup"><span data-stu-id="fe362-156">Therefore make sure you understand the properties of large scale sets before converting.</span></span> <span data-ttu-id="fe362-157">In particular, make sure you do not need layer-4 load balancing with the Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="fe362-157">In particular, make sure you do not need layer-4 load balancing with the Azure Load Balancer.</span></span>

## <a name="additional-notes"></a><span data-ttu-id="fe362-158">Additional notes</span><span class="sxs-lookup"><span data-stu-id="fe362-158">Additional notes</span></span>
<span data-ttu-id="fe362-159">Support for large scale sets, scale sets with attached data disks, and Azure Managed disks was added to the [_2016-04-30-preview_](https://github.com/Azure/azure-rest-api-specs/blob/master/arm-compute/2016-04-30-preview/swagger/compute.json) version of the Microsoft.Compute APi.</span><span class="sxs-lookup"><span data-stu-id="fe362-159">Support for large scale sets, scale sets with attached data disks, and Azure Managed disks was added to the [_2016-04-30-preview_](https://github.com/Azure/azure-rest-api-specs/blob/master/arm-compute/2016-04-30-preview/swagger/compute.json) version of the Microsoft.Compute APi.</span></span> <span data-ttu-id="fe362-160">You can use any SDK or command-line tool built with this version or later of the API.</span><span class="sxs-lookup"><span data-stu-id="fe362-160">You can use any SDK or command-line tool built with this version or later of the API.</span></span>




