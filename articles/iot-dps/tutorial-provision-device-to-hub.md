---
title: Provision a device using Azure IoT Hub Device Provisioning Service | Microsoft Docs
description: Provision your device to a single IoT hub using the Azure IoT Hub Device Provisioning Service
author: wesmc7777
ms.author: wesmc
ms.date: 04/12/2018
ms.topic: tutorial
ms.service: iot-dps
services: iot-dps
manager: timlt
ms.custom: mvc
ms.openlocfilehash: 1b9d6342d30c5f5e9ef80213664447c48a62494c
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44866350"
---
# <a name="provision-the-device-to-an-iot-hub-using-the-azure-iot-hub-device-provisioning-service"></a><span data-ttu-id="08850-103">Provision the device to an IoT hub using the Azure IoT Hub Device Provisioning Service</span><span class="sxs-lookup"><span data-stu-id="08850-103">Provision the device to an IoT hub using the Azure IoT Hub Device Provisioning Service</span></span>

<span data-ttu-id="08850-104">In the previous tutorial, you learned how to set up a device to connect to your Device Provisioning service.</span><span class="sxs-lookup"><span data-stu-id="08850-104">In the previous tutorial, you learned how to set up a device to connect to your Device Provisioning service.</span></span> <span data-ttu-id="08850-105">In this tutorial, you learn how to use this service to provision your device to a single IoT hub, using auto-provisioning and **_enrollment lists_**.</span><span class="sxs-lookup"><span data-stu-id="08850-105">In this tutorial, you learn how to use this service to provision your device to a single IoT hub, using auto-provisioning and **_enrollment lists_**.</span></span> <span data-ttu-id="08850-106">This tutorial shows you how to:</span><span class="sxs-lookup"><span data-stu-id="08850-106">This tutorial shows you how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="08850-107">Enroll the device</span><span class="sxs-lookup"><span data-stu-id="08850-107">Enroll the device</span></span>
> * <span data-ttu-id="08850-108">Start the device</span><span class="sxs-lookup"><span data-stu-id="08850-108">Start the device</span></span>
> * <span data-ttu-id="08850-109">Verify the device is registered</span><span class="sxs-lookup"><span data-stu-id="08850-109">Verify the device is registered</span></span>

## <a name="prerequisites"></a><span data-ttu-id="08850-110">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="08850-110">Prerequisites</span></span>

<span data-ttu-id="08850-111">Before you proceed, make sure to configure your device as discussed in the tutorial [Setup a device to provision using Azure IoT Hub Device Provisioning Service](./tutorial-set-up-device.md).</span><span class="sxs-lookup"><span data-stu-id="08850-111">Before you proceed, make sure to configure your device as discussed in the tutorial [Setup a device to provision using Azure IoT Hub Device Provisioning Service](./tutorial-set-up-device.md).</span></span>

<span data-ttu-id="08850-112">If you're unfamiliar with the process of auto-provisioning, be sure to review [Auto-provisioning concepts](concepts-auto-provisioning.md) before continuing.</span><span class="sxs-lookup"><span data-stu-id="08850-112">If you're unfamiliar with the process of auto-provisioning, be sure to review [Auto-provisioning concepts](concepts-auto-provisioning.md) before continuing.</span></span>

<a id="enrolldevice"></a>
## <a name="enroll-the-device"></a><span data-ttu-id="08850-113">Enroll the device</span><span class="sxs-lookup"><span data-stu-id="08850-113">Enroll the device</span></span>

<span data-ttu-id="08850-114">This step involves adding the device's unique security artifacts to the Device Provisioning Service.</span><span class="sxs-lookup"><span data-stu-id="08850-114">This step involves adding the device's unique security artifacts to the Device Provisioning Service.</span></span> <span data-ttu-id="08850-115">These security artifacts are based on the device's [Attestation mechanism](concepts-device.md#attestation-mechanism) as follows:</span><span class="sxs-lookup"><span data-stu-id="08850-115">These security artifacts are based on the device's [Attestation mechanism](concepts-device.md#attestation-mechanism) as follows:</span></span>

- <span data-ttu-id="08850-116">For TPM-based devices you need:</span><span class="sxs-lookup"><span data-stu-id="08850-116">For TPM-based devices you need:</span></span>
    - <span data-ttu-id="08850-117">The *Endorsement Key* that is unique to each TPM chip or simulation, which is obtained from the TPM chip manufacturer.</span><span class="sxs-lookup"><span data-stu-id="08850-117">The *Endorsement Key* that is unique to each TPM chip or simulation, which is obtained from the TPM chip manufacturer.</span></span>  <span data-ttu-id="08850-118">Read the [Understand TPM Endorsement Key](https://technet.microsoft.com/library/cc770443.aspx) for more information.</span><span class="sxs-lookup"><span data-stu-id="08850-118">Read the [Understand TPM Endorsement Key](https://technet.microsoft.com/library/cc770443.aspx) for more information.</span></span>
    - <span data-ttu-id="08850-119">The *Registration ID* that is used to uniquely identify a device in the namespace/scope.</span><span class="sxs-lookup"><span data-stu-id="08850-119">The *Registration ID* that is used to uniquely identify a device in the namespace/scope.</span></span> <span data-ttu-id="08850-120">This ID may or may not be the same as the device ID.</span><span class="sxs-lookup"><span data-stu-id="08850-120">This ID may or may not be the same as the device ID.</span></span> <span data-ttu-id="08850-121">The ID is mandatory for every device.</span><span class="sxs-lookup"><span data-stu-id="08850-121">The ID is mandatory for every device.</span></span> <span data-ttu-id="08850-122">For TPM-based devices, the registration ID may be derived from the TPM itself, for example, an SHA-256 hash of the TPM Endorsement Key.</span><span class="sxs-lookup"><span data-stu-id="08850-122">For TPM-based devices, the registration ID may be derived from the TPM itself, for example, an SHA-256 hash of the TPM Endorsement Key.</span></span>

    <span data-ttu-id="08850-123">[![Enrollment information for TPM in the portal](./media/tutorial-provision-device-to-hub/tpm-device-enrollment.png)](./media/tutorial-provision-device-to-hub/tpm-device-enrollment.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="08850-123">[![Enrollment information for TPM in the portal](./media/tutorial-provision-device-to-hub/tpm-device-enrollment.png)](./media/tutorial-provision-device-to-hub/tpm-device-enrollment.png#lightbox)</span></span>  

- <span data-ttu-id="08850-124">For X.509 based devices you need:</span><span class="sxs-lookup"><span data-stu-id="08850-124">For X.509 based devices you need:</span></span>
    - <span data-ttu-id="08850-125">The [certificate issued to the X.509](https://msdn.microsoft.com/library/windows/desktop/bb540819.aspx) chip or simulation, in the form of either a *.pem* or a *.cer* file.</span><span class="sxs-lookup"><span data-stu-id="08850-125">The [certificate issued to the X.509](https://msdn.microsoft.com/library/windows/desktop/bb540819.aspx) chip or simulation, in the form of either a *.pem* or a *.cer* file.</span></span> <span data-ttu-id="08850-126">For individual enrollment, you need to use the per-device  *signer certificate* for your X.509 system, while for enrollment groups, you need to use the *root certificate*.</span><span class="sxs-lookup"><span data-stu-id="08850-126">For individual enrollment, you need to use the per-device  *signer certificate* for your X.509 system, while for enrollment groups, you need to use the *root certificate*.</span></span> 

    <span data-ttu-id="08850-127">[![Add individual enrollment for X.509 attestation in the portal](./media/tutorial-provision-device-to-hub/individual-enrollment.png)](./media/tutorial-provision-device-to-hub/individual-enrollment.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="08850-127">[![Add individual enrollment for X.509 attestation in the portal](./media/tutorial-provision-device-to-hub/individual-enrollment.png)](./media/tutorial-provision-device-to-hub/individual-enrollment.png#lightbox)</span></span>

<span data-ttu-id="08850-128">There are two ways to enroll the device to the Device Provisioning Service:</span><span class="sxs-lookup"><span data-stu-id="08850-128">There are two ways to enroll the device to the Device Provisioning Service:</span></span>

- <span data-ttu-id="08850-129">**Enrollment Groups** This represents a group of devices that share a specific attestation mechanism.</span><span class="sxs-lookup"><span data-stu-id="08850-129">**Enrollment Groups** This represents a group of devices that share a specific attestation mechanism.</span></span> <span data-ttu-id="08850-130">We recommend using an enrollment group for a large number of devices, which share a desired initial configuration, or for devices all going to the same tenant.</span><span class="sxs-lookup"><span data-stu-id="08850-130">We recommend using an enrollment group for a large number of devices, which share a desired initial configuration, or for devices all going to the same tenant.</span></span> <span data-ttu-id="08850-131">For more information on Identity attestation for enrollment groups, see [Security](concepts-security.md#controlling-device-access-to-the-provisioning-service-with-x509-certificates).</span><span class="sxs-lookup"><span data-stu-id="08850-131">For more information on Identity attestation for enrollment groups, see [Security](concepts-security.md#controlling-device-access-to-the-provisioning-service-with-x509-certificates).</span></span>

    <span data-ttu-id="08850-132">[![Add group enrollment for X.509 attestation in the portal](./media/tutorial-provision-device-to-hub/group-enrollment.png)](./media/tutorial-provision-device-to-hub/group-enrollment.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="08850-132">[![Add group enrollment for X.509 attestation in the portal](./media/tutorial-provision-device-to-hub/group-enrollment.png)](./media/tutorial-provision-device-to-hub/group-enrollment.png#lightbox)</span></span>

- <span data-ttu-id="08850-133">**Individual Enrollments** This represents an entry for a single device that may register with the Device Provisioning Service.</span><span class="sxs-lookup"><span data-stu-id="08850-133">**Individual Enrollments** This represents an entry for a single device that may register with the Device Provisioning Service.</span></span> <span data-ttu-id="08850-134">Individual enrollments may use either x509 certificates or SAS tokens (in a real or virtual TPM) as attestation mechanisms.</span><span class="sxs-lookup"><span data-stu-id="08850-134">Individual enrollments may use either x509 certificates or SAS tokens (in a real or virtual TPM) as attestation mechanisms.</span></span> <span data-ttu-id="08850-135">We recommend using individual enrollments for devices that require unique initial configurations, and devices that can only use SAS tokens via TPM or virtual TPM as the attestation mechanism.</span><span class="sxs-lookup"><span data-stu-id="08850-135">We recommend using individual enrollments for devices that require unique initial configurations, and devices that can only use SAS tokens via TPM or virtual TPM as the attestation mechanism.</span></span> <span data-ttu-id="08850-136">Individual enrollments may have the desired IoT hub device ID specified.</span><span class="sxs-lookup"><span data-stu-id="08850-136">Individual enrollments may have the desired IoT hub device ID specified.</span></span>

<span data-ttu-id="08850-137">Now you enroll the device with your Device Provisioning Service instance, using the required security artifacts based on the device's attestation mechanism:</span><span class="sxs-lookup"><span data-stu-id="08850-137">Now you enroll the device with your Device Provisioning Service instance, using the required security artifacts based on the device's attestation mechanism:</span></span> 

1. <span data-ttu-id="08850-138">Sign in to the Azure portal, click on the **All resources** button on the left-hand menu and open your Device Provisioning service.</span><span class="sxs-lookup"><span data-stu-id="08850-138">Sign in to the Azure portal, click on the **All resources** button on the left-hand menu and open your Device Provisioning service.</span></span>

2. <span data-ttu-id="08850-139">On the Device Provisioning Service summary blade, select **Manage enrollments**.</span><span class="sxs-lookup"><span data-stu-id="08850-139">On the Device Provisioning Service summary blade, select **Manage enrollments**.</span></span> <span data-ttu-id="08850-140">Select either **Individual Enrollments** tab or the **Enrollment Groups** tab as per your device setup.</span><span class="sxs-lookup"><span data-stu-id="08850-140">Select either **Individual Enrollments** tab or the **Enrollment Groups** tab as per your device setup.</span></span> <span data-ttu-id="08850-141">Click the **Add** button at the top.</span><span class="sxs-lookup"><span data-stu-id="08850-141">Click the **Add** button at the top.</span></span> <span data-ttu-id="08850-142">Select **TPM** or **X.509** as the identity attestation *Mechanism*, and enter the appropriate security artifacts as discussed previously.</span><span class="sxs-lookup"><span data-stu-id="08850-142">Select **TPM** or **X.509** as the identity attestation *Mechanism*, and enter the appropriate security artifacts as discussed previously.</span></span> <span data-ttu-id="08850-143">You may enter a new **IoT Hub device ID**.</span><span class="sxs-lookup"><span data-stu-id="08850-143">You may enter a new **IoT Hub device ID**.</span></span> <span data-ttu-id="08850-144">Once complete, click the **Save** button.</span><span class="sxs-lookup"><span data-stu-id="08850-144">Once complete, click the **Save** button.</span></span> 

3. <span data-ttu-id="08850-145">When the device is successfully enrolled, you should see it displayed in the portal as follows:</span><span class="sxs-lookup"><span data-stu-id="08850-145">When the device is successfully enrolled, you should see it displayed in the portal as follows:</span></span>

    ![Successful TPM enrollment in the portal](./media/tutorial-provision-device-to-hub/tpm-enrollment-success.png)

<span data-ttu-id="08850-147">After enrollment, the provisioning service then waits for the device to boot and connect with it at any later point in time.</span><span class="sxs-lookup"><span data-stu-id="08850-147">After enrollment, the provisioning service then waits for the device to boot and connect with it at any later point in time.</span></span> <span data-ttu-id="08850-148">When your device boots for the first time, the client SDK library interacts with your chip to extract the security artifacts from the device, and verifies registration with your Device Provisioning service.</span><span class="sxs-lookup"><span data-stu-id="08850-148">When your device boots for the first time, the client SDK library interacts with your chip to extract the security artifacts from the device, and verifies registration with your Device Provisioning service.</span></span> 

## <a name="start-the-iot-device"></a><span data-ttu-id="08850-149">Start the IoT device</span><span class="sxs-lookup"><span data-stu-id="08850-149">Start the IoT device</span></span>

<span data-ttu-id="08850-150">Your IoT device can be a real device, or a simulated device.</span><span class="sxs-lookup"><span data-stu-id="08850-150">Your IoT device can be a real device, or a simulated device.</span></span> <span data-ttu-id="08850-151">Since the IoT device has now been enrolled with a Device Provisioning Service instance, the device can now boot up, and call the provisioning service to be recognized using the attestation mechanism.</span><span class="sxs-lookup"><span data-stu-id="08850-151">Since the IoT device has now been enrolled with a Device Provisioning Service instance, the device can now boot up, and call the provisioning service to be recognized using the attestation mechanism.</span></span> <span data-ttu-id="08850-152">Once the provisioning service has recognized the device, it will be assigned to an IoT hub.</span><span class="sxs-lookup"><span data-stu-id="08850-152">Once the provisioning service has recognized the device, it will be assigned to an IoT hub.</span></span> 

<span data-ttu-id="08850-153">Simulated device examples, using both TPM and X.509 attestation, are included for C, Java, C#, Node.js, and Python.</span><span class="sxs-lookup"><span data-stu-id="08850-153">Simulated device examples, using both TPM and X.509 attestation, are included for C, Java, C#, Node.js, and Python.</span></span> <span data-ttu-id="08850-154">For example, a simulated device using TPM and the [Azure IoT C SDK](https://github.com/Azure/azure-iot-sdk-c) would follow the process covered in the [Simulate first boot sequence for a device](quick-create-simulated-device.md#simulate-first-boot-sequence-for-the-device) section.</span><span class="sxs-lookup"><span data-stu-id="08850-154">For example, a simulated device using TPM and the [Azure IoT C SDK](https://github.com/Azure/azure-iot-sdk-c) would follow the process covered in the [Simulate first boot sequence for a device](quick-create-simulated-device.md#simulate-first-boot-sequence-for-the-device) section.</span></span> <span data-ttu-id="08850-155">The same device using X.509 certificate attestation would refer to this [boot sequence](quick-create-simulated-device-x509.md#simulate-first-boot-sequence-for-the-device) section.</span><span class="sxs-lookup"><span data-stu-id="08850-155">The same device using X.509 certificate attestation would refer to this [boot sequence](quick-create-simulated-device-x509.md#simulate-first-boot-sequence-for-the-device) section.</span></span>

<span data-ttu-id="08850-156">Refer to the [How-to guide for the MXChip Iot DevKit](how-to-connect-mxchip-iot-devkit.md) as an example for a real device.</span><span class="sxs-lookup"><span data-stu-id="08850-156">Refer to the [How-to guide for the MXChip Iot DevKit](how-to-connect-mxchip-iot-devkit.md) as an example for a real device.</span></span>

<span data-ttu-id="08850-157">Start the device to allow your device's client application to start the registration with your Device Provisioning service.</span><span class="sxs-lookup"><span data-stu-id="08850-157">Start the device to allow your device's client application to start the registration with your Device Provisioning service.</span></span>  

## <a name="verify-the-device-is-registered"></a><span data-ttu-id="08850-158">Verify the device is registered</span><span class="sxs-lookup"><span data-stu-id="08850-158">Verify the device is registered</span></span>

<span data-ttu-id="08850-159">Once your device boots, the following actions should take place:</span><span class="sxs-lookup"><span data-stu-id="08850-159">Once your device boots, the following actions should take place:</span></span>

1. <span data-ttu-id="08850-160">The device sends a registration request to your Device Provisioning service.</span><span class="sxs-lookup"><span data-stu-id="08850-160">The device sends a registration request to your Device Provisioning service.</span></span>
2. <span data-ttu-id="08850-161">For TPM devices, the Device Provisioning Service sends back a registration challenge to which your device responds.</span><span class="sxs-lookup"><span data-stu-id="08850-161">For TPM devices, the Device Provisioning Service sends back a registration challenge to which your device responds.</span></span> 
3. <span data-ttu-id="08850-162">On successful registration, the Device Provisioning Service sends the IoT hub URI, device ID, and the encrypted key back to the device.</span><span class="sxs-lookup"><span data-stu-id="08850-162">On successful registration, the Device Provisioning Service sends the IoT hub URI, device ID, and the encrypted key back to the device.</span></span> 
4. <span data-ttu-id="08850-163">The IoT Hub client application on the device then connects to your hub.</span><span class="sxs-lookup"><span data-stu-id="08850-163">The IoT Hub client application on the device then connects to your hub.</span></span> 
5. <span data-ttu-id="08850-164">On successful connection to the hub, you should see the device appear in the IoT hub's **IoT Devices** explorer.</span><span class="sxs-lookup"><span data-stu-id="08850-164">On successful connection to the hub, you should see the device appear in the IoT hub's **IoT Devices** explorer.</span></span> 

    ![Successful connection to hub in the portal](./media/tutorial-provision-device-to-hub/hub-connect-success.png)

<span data-ttu-id="08850-166">For more information, see the TPM simulator sample application, [dps_client_sample](https://github.com/Azure/azure-iot-device-auth/blob/master/dps_client/samples/dps_client_sample/dps_client_sample.c).</span><span class="sxs-lookup"><span data-stu-id="08850-166">For more information, see the TPM simulator sample application, [dps_client_sample](https://github.com/Azure/azure-iot-device-auth/blob/master/dps_client/samples/dps_client_sample/dps_client_sample.c).</span></span> 

## <a name="next-steps"></a><span data-ttu-id="08850-167">Next steps</span><span class="sxs-lookup"><span data-stu-id="08850-167">Next steps</span></span>
<span data-ttu-id="08850-168">In this tutorial, you learned how to:</span><span class="sxs-lookup"><span data-stu-id="08850-168">In this tutorial, you learned how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="08850-169">Enroll the device</span><span class="sxs-lookup"><span data-stu-id="08850-169">Enroll the device</span></span>
> * <span data-ttu-id="08850-170">Start the device</span><span class="sxs-lookup"><span data-stu-id="08850-170">Start the device</span></span>
> * <span data-ttu-id="08850-171">Verify the device is registered</span><span class="sxs-lookup"><span data-stu-id="08850-171">Verify the device is registered</span></span>

<span data-ttu-id="08850-172">Advance to the next tutorial to learn how to provision multiple devices across load-balanced hubs.</span><span class="sxs-lookup"><span data-stu-id="08850-172">Advance to the next tutorial to learn how to provision multiple devices across load-balanced hubs.</span></span> 

> [!div class="nextstepaction"]
> [<span data-ttu-id="08850-173">Provision devices across load-balanced IoT hubs</span><span class="sxs-lookup"><span data-stu-id="08850-173">Provision devices across load-balanced IoT hubs</span></span>](./tutorial-provision-multiple-hubs.md)
