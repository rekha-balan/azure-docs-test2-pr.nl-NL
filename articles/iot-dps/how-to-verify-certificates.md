---
title: How to do proof-of-possession for X.509 CA certificates with Azure IoT Hub Device Provisioning Service | Microsoft Docs
description: How to verify X.509 CA certificates with your Device Provisioning Service
author: wesmc7777
ms.author: wesmc
ms.date: 02/26/2018
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: timlt
ms.openlocfilehash: 6a6782c5e1cd7b5f42b619cd52470b640813a905
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44866983"
---
# <a name="how-to-do-proof-of-possession-for-x509-ca-certificates-with-your-device-provisioning-service"></a><span data-ttu-id="c8a57-103">How to do proof-of-possession for X.509 CA certificates with your Device Provisioning Service</span><span class="sxs-lookup"><span data-stu-id="c8a57-103">How to do proof-of-possession for X.509 CA certificates with your Device Provisioning Service</span></span>

<span data-ttu-id="c8a57-104">A verified X.509 Certificate Authority (CA) certificate is a CA certificate that has been uploaded and registered to your provisioning service and has gone through proof-of-possession with the service.</span><span class="sxs-lookup"><span data-stu-id="c8a57-104">A verified X.509 Certificate Authority (CA) certificate is a CA certificate that has been uploaded and registered to your provisioning service and has gone through proof-of-possession with the service.</span></span> 

<span data-ttu-id="c8a57-105">Proof-of-possession involves the following steps:</span><span class="sxs-lookup"><span data-stu-id="c8a57-105">Proof-of-possession involves the following steps:</span></span>
1. <span data-ttu-id="c8a57-106">Get a unique verification code generated by the provisioning service for your X.509 CA certificate.</span><span class="sxs-lookup"><span data-stu-id="c8a57-106">Get a unique verification code generated by the provisioning service for your X.509 CA certificate.</span></span> <span data-ttu-id="c8a57-107">You can do this from the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="c8a57-107">You can do this from the Azure portal.</span></span>
2. <span data-ttu-id="c8a57-108">Create an X.509 verification certificate with the verification code as its subject and sign the certificate with the private key associated with your X.509 CA certificate.</span><span class="sxs-lookup"><span data-stu-id="c8a57-108">Create an X.509 verification certificate with the verification code as its subject and sign the certificate with the private key associated with your X.509 CA certificate.</span></span>
3. <span data-ttu-id="c8a57-109">Upload the signed verification certificate to the service.</span><span class="sxs-lookup"><span data-stu-id="c8a57-109">Upload the signed verification certificate to the service.</span></span> <span data-ttu-id="c8a57-110">The service validates the verification certificate using the public portion of the CA certificate to be verified, thus proving that you are in possession of the CA certificate's private key.</span><span class="sxs-lookup"><span data-stu-id="c8a57-110">The service validates the verification certificate using the public portion of the CA certificate to be verified, thus proving that you are in possession of the CA certificate's private key.</span></span>

<span data-ttu-id="c8a57-111">Verified certificates play an important role when using enrollment groups.</span><span class="sxs-lookup"><span data-stu-id="c8a57-111">Verified certificates play an important role when using enrollment groups.</span></span> <span data-ttu-id="c8a57-112">Verifying certificate ownership provides an additional security layer by ensuring that the uploader of the certificate is in possession of the certificate's private key.</span><span class="sxs-lookup"><span data-stu-id="c8a57-112">Verifying certificate ownership provides an additional security layer by ensuring that the uploader of the certificate is in possession of the certificate's private key.</span></span> <span data-ttu-id="c8a57-113">Verification prevents a malicious actor sniffing your traffic from extracting an intermediate certificate and using that certificate to create an enrollment group in their own provisioning service, effectively hijacking your devices.</span><span class="sxs-lookup"><span data-stu-id="c8a57-113">Verification prevents a malicious actor sniffing your traffic from extracting an intermediate certificate and using that certificate to create an enrollment group in their own provisioning service, effectively hijacking your devices.</span></span> <span data-ttu-id="c8a57-114">By proving ownership of the root or an intermediate certificate in a certificate chain, you're proving that you have permission to generate leaf certificates for the devices that will be registering as a part of that enrollment group.</span><span class="sxs-lookup"><span data-stu-id="c8a57-114">By proving ownership of the root or an intermediate certificate in a certificate chain, you're proving that you have permission to generate leaf certificates for the devices that will be registering as a part of that enrollment group.</span></span> <span data-ttu-id="c8a57-115">For this reason, the root or intermediate certificate configured in an enrollment group must either be a verified certificate or must roll up to a verified certificate in the certificate chain a device presents when it authenticates with the service.</span><span class="sxs-lookup"><span data-stu-id="c8a57-115">For this reason, the root or intermediate certificate configured in an enrollment group must either be a verified certificate or must roll up to a verified certificate in the certificate chain a device presents when it authenticates with the service.</span></span> <span data-ttu-id="c8a57-116">To learn more about enrollment groups, see [X.509 certificates](concepts-security.md#x509-certificates) and [Controlling device access to the provisioning service with X.509 certificates](concepts-security.md#controlling-device-access-to-the-provisioning-service-with-x509-certificates).</span><span class="sxs-lookup"><span data-stu-id="c8a57-116">To learn more about enrollment groups, see [X.509 certificates](concepts-security.md#x509-certificates) and [Controlling device access to the provisioning service with X.509 certificates](concepts-security.md#controlling-device-access-to-the-provisioning-service-with-x509-certificates).</span></span>

## <a name="register-the-public-part-of-an-x509-certificate-and-get-a-verification-code"></a><span data-ttu-id="c8a57-117">Register the public part of an X.509 certificate and get a verification code</span><span class="sxs-lookup"><span data-stu-id="c8a57-117">Register the public part of an X.509 certificate and get a verification code</span></span>

<span data-ttu-id="c8a57-118">To register a CA certificate with your provisioning service and get a verification code that you can use during proof-of-possession, follow these steps.</span><span class="sxs-lookup"><span data-stu-id="c8a57-118">To register a CA certificate with your provisioning service and get a verification code that you can use during proof-of-possession, follow these steps.</span></span> 

1. <span data-ttu-id="c8a57-119">In the Azure portal, navigate to your provisioning service and open **Certificates** from the left-hand menu.</span><span class="sxs-lookup"><span data-stu-id="c8a57-119">In the Azure portal, navigate to your provisioning service and open **Certificates** from the left-hand menu.</span></span> 
2. <span data-ttu-id="c8a57-120">Click **Add** to add a new certificate.</span><span class="sxs-lookup"><span data-stu-id="c8a57-120">Click **Add** to add a new certificate.</span></span>
3. <span data-ttu-id="c8a57-121">Enter a friendly display name for your certificate.</span><span class="sxs-lookup"><span data-stu-id="c8a57-121">Enter a friendly display name for your certificate.</span></span> <span data-ttu-id="c8a57-122">Browse to the .cer or .pem file that represents the public part of your X.509 certificate.</span><span class="sxs-lookup"><span data-stu-id="c8a57-122">Browse to the .cer or .pem file that represents the public part of your X.509 certificate.</span></span> <span data-ttu-id="c8a57-123">Click **Upload**.</span><span class="sxs-lookup"><span data-stu-id="c8a57-123">Click **Upload**.</span></span>
4. <span data-ttu-id="c8a57-124">Once you get a notification that your certificate is successfully uploaded, click **Save**.</span><span class="sxs-lookup"><span data-stu-id="c8a57-124">Once you get a notification that your certificate is successfully uploaded, click **Save**.</span></span>

    ![Upload certificate](./media/how-to-verify-certificates/add-new-cert.png)  

   <span data-ttu-id="c8a57-126">Your certificate will show in the **Certificate Explorer** list.</span><span class="sxs-lookup"><span data-stu-id="c8a57-126">Your certificate will show in the **Certificate Explorer** list.</span></span> <span data-ttu-id="c8a57-127">Note that the **STATUS** of this certificate is *Unverified*.</span><span class="sxs-lookup"><span data-stu-id="c8a57-127">Note that the **STATUS** of this certificate is *Unverified*.</span></span>

5. <span data-ttu-id="c8a57-128">Click on the certificate that you added in the previous step.</span><span class="sxs-lookup"><span data-stu-id="c8a57-128">Click on the certificate that you added in the previous step.</span></span>

6. <span data-ttu-id="c8a57-129">In **Certificate Details**, click **Generate Verification Code**.</span><span class="sxs-lookup"><span data-stu-id="c8a57-129">In **Certificate Details**, click **Generate Verification Code**.</span></span>

7. <span data-ttu-id="c8a57-130">The provisioning service creates a **Verification Code** that you can use to validate the certificate ownership.</span><span class="sxs-lookup"><span data-stu-id="c8a57-130">The provisioning service creates a **Verification Code** that you can use to validate the certificate ownership.</span></span> <span data-ttu-id="c8a57-131">Copy the code to your clipboard.</span><span class="sxs-lookup"><span data-stu-id="c8a57-131">Copy the code to your clipboard.</span></span> 

   ![Verify certificate](./media/how-to-verify-certificates/verify-cert.png)  

## <a name="digitally-sign-the-verification-code-to-create-a-verification-certificate"></a><span data-ttu-id="c8a57-133">Digitally sign the verification code to create a verification certificate</span><span class="sxs-lookup"><span data-stu-id="c8a57-133">Digitally sign the verification code to create a verification certificate</span></span>

<span data-ttu-id="c8a57-134">Now, you need to sign the *Verification Code* with the private key associated with your X.509 CA certificate, which generates a signature.</span><span class="sxs-lookup"><span data-stu-id="c8a57-134">Now, you need to sign the *Verification Code* with the private key associated with your X.509 CA certificate, which generates a signature.</span></span> <span data-ttu-id="c8a57-135">This is known as [Proof of possession](https://tools.ietf.org/html/rfc5280#section-3.1) and results in a signed verification certificate.</span><span class="sxs-lookup"><span data-stu-id="c8a57-135">This is known as [Proof of possession](https://tools.ietf.org/html/rfc5280#section-3.1) and results in a signed verification certificate.</span></span>

<span data-ttu-id="c8a57-136">Microsoft provides tools and samples that can help you create a signed verification certificate:</span><span class="sxs-lookup"><span data-stu-id="c8a57-136">Microsoft provides tools and samples that can help you create a signed verification certificate:</span></span> 

- <span data-ttu-id="c8a57-137">The **Azure IoT Hub C SDK** provides PowerShell (Windows) and Bash (Linux) scripts to help you create CA and leaf certificates for development and to perform proof-of-possession using a verification code.</span><span class="sxs-lookup"><span data-stu-id="c8a57-137">The **Azure IoT Hub C SDK** provides PowerShell (Windows) and Bash (Linux) scripts to help you create CA and leaf certificates for development and to perform proof-of-possession using a verification code.</span></span> <span data-ttu-id="c8a57-138">You can download the [files](https://github.com/Azure/azure-iot-sdk-c/tree/master/tools/CACertificates) relevant to your system to a working folder and follow the instructions in the [Managing CA certificates readme](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md) to perform proof-of-possession on a CA certificate.</span><span class="sxs-lookup"><span data-stu-id="c8a57-138">You can download the [files](https://github.com/Azure/azure-iot-sdk-c/tree/master/tools/CACertificates) relevant to your system to a working folder and follow the instructions in the [Managing CA certificates readme](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md) to perform proof-of-possession on a CA certificate.</span></span> 
- <span data-ttu-id="c8a57-139">The **Azure IoT Hub C# SDK** contains the [Group Certificate Verification Sample](https://github.com/Azure/azure-iot-sdk-csharp/tree/master/provisioning/service/samples/GroupCertificateVerificationSample), which you can use to do proof-of-possession.</span><span class="sxs-lookup"><span data-stu-id="c8a57-139">The **Azure IoT Hub C# SDK** contains the [Group Certificate Verification Sample](https://github.com/Azure/azure-iot-sdk-csharp/tree/master/provisioning/service/samples/GroupCertificateVerificationSample), which you can use to do proof-of-possession.</span></span>
 
> [!IMPORTANT]
> <span data-ttu-id="c8a57-140">In addition to performing proof-of-possession, the PowerShell and Bash scripts cited previously also allow you to create root certificates, intermediate certificates, and leaf certificates that can be used to authenticate and provision devices.</span><span class="sxs-lookup"><span data-stu-id="c8a57-140">In addition to performing proof-of-possession, the PowerShell and Bash scripts cited previously also allow you to create root certificates, intermediate certificates, and leaf certificates that can be used to authenticate and provision devices.</span></span> <span data-ttu-id="c8a57-141">These certificates should be used for development only.</span><span class="sxs-lookup"><span data-stu-id="c8a57-141">These certificates should be used for development only.</span></span> <span data-ttu-id="c8a57-142">They should never be used in a production environment.</span><span class="sxs-lookup"><span data-stu-id="c8a57-142">They should never be used in a production environment.</span></span> 

<span data-ttu-id="c8a57-143">The PowerShell and Bash scripts provided in the documentation and SDKs rely on [OpenSSL](https://www.openssl.org/).</span><span class="sxs-lookup"><span data-stu-id="c8a57-143">The PowerShell and Bash scripts provided in the documentation and SDKs rely on [OpenSSL](https://www.openssl.org/).</span></span> <span data-ttu-id="c8a57-144">You may also use OpenSSL or other third-party tools to help you do proof-of-possession.</span><span class="sxs-lookup"><span data-stu-id="c8a57-144">You may also use OpenSSL or other third-party tools to help you do proof-of-possession.</span></span> <span data-ttu-id="c8a57-145">For more information about tooling provided with the SDKs, see [How to use tools provided in the SDKs](how-to-use-sdk-tools.md).</span><span class="sxs-lookup"><span data-stu-id="c8a57-145">For more information about tooling provided with the SDKs, see [How to use tools provided in the SDKs](how-to-use-sdk-tools.md).</span></span> 


## <a name="upload-the-signed-verification-certificate"></a><span data-ttu-id="c8a57-146">Upload the signed verification certificate</span><span class="sxs-lookup"><span data-stu-id="c8a57-146">Upload the signed verification certificate</span></span>

1. <span data-ttu-id="c8a57-147">Upload the resulting signature as a verification certificate to your provisioning service in the portal.</span><span class="sxs-lookup"><span data-stu-id="c8a57-147">Upload the resulting signature as a verification certificate to your provisioning service in the portal.</span></span> <span data-ttu-id="c8a57-148">In **Certificate Details** on the Azure portal, use the  _File Explorer_ icon next to the **Verification Certificate .pem or .cer file** field to upload the signed verification certificate from your system.</span><span class="sxs-lookup"><span data-stu-id="c8a57-148">In **Certificate Details** on the Azure portal, use the  _File Explorer_ icon next to the **Verification Certificate .pem or .cer file** field to upload the signed verification certificate from your system.</span></span>

2. <span data-ttu-id="c8a57-149">Once the certificate is successfully uploaded, click **Verify**.</span><span class="sxs-lookup"><span data-stu-id="c8a57-149">Once the certificate is successfully uploaded, click **Verify**.</span></span> <span data-ttu-id="c8a57-150">The **STATUS** of your certificate changes to **_Verified_** in the **Certificate Explorer** list.</span><span class="sxs-lookup"><span data-stu-id="c8a57-150">The **STATUS** of your certificate changes to **_Verified_** in the **Certificate Explorer** list.</span></span> <span data-ttu-id="c8a57-151">Click **Refresh** if it does not update automatically.</span><span class="sxs-lookup"><span data-stu-id="c8a57-151">Click **Refresh** if it does not update automatically.</span></span>

   ![Upload certificate verification](./media/how-to-verify-certificates/upload-cert-verification.png)  

## <a name="next-steps"></a><span data-ttu-id="c8a57-153">Next steps</span><span class="sxs-lookup"><span data-stu-id="c8a57-153">Next steps</span></span>

- <span data-ttu-id="c8a57-154">To learn about how to use the portal to create an enrollment group, see [Managing device enrollments with Azure portal](how-to-manage-enrollments.md).</span><span class="sxs-lookup"><span data-stu-id="c8a57-154">To learn about how to use the portal to create an enrollment group, see [Managing device enrollments with Azure portal](how-to-manage-enrollments.md).</span></span>
- <span data-ttu-id="c8a57-155">To learn about how to use the service SDKs to create an enrollment group, see [Managing device enrollments with service SDKs](how-to-manage-enrollments-sdks.md).</span><span class="sxs-lookup"><span data-stu-id="c8a57-155">To learn about how to use the service SDKs to create an enrollment group, see [Managing device enrollments with service SDKs](how-to-manage-enrollments-sdks.md).</span></span>










