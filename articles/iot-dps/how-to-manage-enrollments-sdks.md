---
title: Manage device enrollments using Azure Device Provisioning Service SDKs | Microsoft Docs
description: How to manage device enrollments in the IoT Hub Device Provisioning Service using the Service SDKs
author: yzhong94
ms.author: yizhon
ms.date: 04/04/18
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: arjmands
ms.openlocfilehash: 9a68d928c70e1e233f6de7df13441a1f688f456a
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44865280"
---
# <a name="how-to-manage-device-enrollments-with-azure-device-provisioning-service-sdks"></a><span data-ttu-id="2bed0-103">How to manage device enrollments with Azure Device Provisioning Service SDKs</span><span class="sxs-lookup"><span data-stu-id="2bed0-103">How to manage device enrollments with Azure Device Provisioning Service SDKs</span></span>
<span data-ttu-id="2bed0-104">A *device enrollment* creates a record of a single device or a group of devices that may at some point register with the Device Provisioning Service.</span><span class="sxs-lookup"><span data-stu-id="2bed0-104">A *device enrollment* creates a record of a single device or a group of devices that may at some point register with the Device Provisioning Service.</span></span> <span data-ttu-id="2bed0-105">The enrollment record contains the initial desired configuration for the device(s) as part of that enrollment, including the desired IoT hub.</span><span class="sxs-lookup"><span data-stu-id="2bed0-105">The enrollment record contains the initial desired configuration for the device(s) as part of that enrollment, including the desired IoT hub.</span></span> <span data-ttu-id="2bed0-106">This article shows you how to manage device enrollments for your provisioning service programmatically using the Azure IoT Provisioning Service SDKs.</span><span class="sxs-lookup"><span data-stu-id="2bed0-106">This article shows you how to manage device enrollments for your provisioning service programmatically using the Azure IoT Provisioning Service SDKs.</span></span>  <span data-ttu-id="2bed0-107">The SDKs are available on GitHub in the same repository as Azure IoT SDKs.</span><span class="sxs-lookup"><span data-stu-id="2bed0-107">The SDKs are available on GitHub in the same repository as Azure IoT SDKs.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="2bed0-108">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="2bed0-108">Prerequisites</span></span>
* <span data-ttu-id="2bed0-109">Obtain the connection string from your Device Provisioning Service instance.</span><span class="sxs-lookup"><span data-stu-id="2bed0-109">Obtain the connection string from your Device Provisioning Service instance.</span></span>
* <span data-ttu-id="2bed0-110">Obtain the device security artifacts for the [attestation mechanism](concepts-security.md#attestation-mechanism) used:</span><span class="sxs-lookup"><span data-stu-id="2bed0-110">Obtain the device security artifacts for the [attestation mechanism](concepts-security.md#attestation-mechanism) used:</span></span>
    * <span data-ttu-id="2bed0-111">[**Trusted Platform Module (TPM)**](/azure/iot-dps/concepts-security#trusted-platform-module):</span><span class="sxs-lookup"><span data-stu-id="2bed0-111">[**Trusted Platform Module (TPM)**](/azure/iot-dps/concepts-security#trusted-platform-module):</span></span>
        * <span data-ttu-id="2bed0-112">Individual enrollment: Registration ID and TPM Endorsement Key from a physical device or from TPM Simulator.</span><span class="sxs-lookup"><span data-stu-id="2bed0-112">Individual enrollment: Registration ID and TPM Endorsement Key from a physical device or from TPM Simulator.</span></span>
        * <span data-ttu-id="2bed0-113">Enrollment group does not apply to TPM attestation.</span><span class="sxs-lookup"><span data-stu-id="2bed0-113">Enrollment group does not apply to TPM attestation.</span></span>
    * <span data-ttu-id="2bed0-114">[**X.509**](/azure/iot-dps/concepts-security):</span><span class="sxs-lookup"><span data-stu-id="2bed0-114">[**X.509**](/azure/iot-dps/concepts-security):</span></span>
        * <span data-ttu-id="2bed0-115">Individual enrollment: The [Leaf certificate](/azure/iot-dps/concepts-security#leaf-certificate) from physical device or from the SDK [DICE](https://azure.microsoft.com/blog/azure-iot-supports-new-security-hardware-to-strengthen-iot-security/) Emulator.</span><span class="sxs-lookup"><span data-stu-id="2bed0-115">Individual enrollment: The [Leaf certificate](/azure/iot-dps/concepts-security#leaf-certificate) from physical device or from the SDK [DICE](https://azure.microsoft.com/blog/azure-iot-supports-new-security-hardware-to-strengthen-iot-security/) Emulator.</span></span>
        * <span data-ttu-id="2bed0-116">Enrollment group: The [CA/root certificate](/azure/iot-dps/concepts-security#root-certificate) or the [intermediate certificate](/azure/iot-dps/concepts-security#intermediate-certificate), used to produce device certificate on a physical device.</span><span class="sxs-lookup"><span data-stu-id="2bed0-116">Enrollment group: The [CA/root certificate](/azure/iot-dps/concepts-security#root-certificate) or the [intermediate certificate](/azure/iot-dps/concepts-security#intermediate-certificate), used to produce device certificate on a physical device.</span></span>  <span data-ttu-id="2bed0-117">It can also be generated from the SDK DICE emulator.</span><span class="sxs-lookup"><span data-stu-id="2bed0-117">It can also be generated from the SDK DICE emulator.</span></span>
* <span data-ttu-id="2bed0-118">Exact API calls may be different due to language differences.</span><span class="sxs-lookup"><span data-stu-id="2bed0-118">Exact API calls may be different due to language differences.</span></span> <span data-ttu-id="2bed0-119">Please review the samples provided on GitHub for details:</span><span class="sxs-lookup"><span data-stu-id="2bed0-119">Please review the samples provided on GitHub for details:</span></span>
   * [<span data-ttu-id="2bed0-120">Java Provisioning Service Client samples</span><span class="sxs-lookup"><span data-stu-id="2bed0-120">Java Provisioning Service Client samples</span></span>](https://github.com/Azure/azure-iot-sdk-java/tree/master/provisioning/provisioning-samples)
   * [<span data-ttu-id="2bed0-121">Node.js Provisioning Service Client samples</span><span class="sxs-lookup"><span data-stu-id="2bed0-121">Node.js Provisioning Service Client samples</span></span>](https://github.com/Azure/azure-iot-sdk-node/tree/master/provisioning/service/samples)
   * [<span data-ttu-id="2bed0-122">.NET Provisioning Service Client samples</span><span class="sxs-lookup"><span data-stu-id="2bed0-122">.NET Provisioning Service Client samples</span></span>](https://github.com/Azure/azure-iot-sdk-csharp/tree/master/provisioning/service/samples)

## <a name="create-a-device-enrollment"></a><span data-ttu-id="2bed0-123">Create a device enrollment</span><span class="sxs-lookup"><span data-stu-id="2bed0-123">Create a device enrollment</span></span>
<span data-ttu-id="2bed0-124">There are two ways you can enroll your devices with the provisioning service:</span><span class="sxs-lookup"><span data-stu-id="2bed0-124">There are two ways you can enroll your devices with the provisioning service:</span></span>

* <span data-ttu-id="2bed0-125">An **Enrollment group** is an entry for a group of devices that share a common attestation mechanism of X.509 certificates, signed by the [root certificate](https://docs.microsoft.com/azure/iot-dps/concepts-security#root-certificate) or the [intermediate certificate](https://docs.microsoft.com/azure/iot-dps/concepts-security#intermediate-certificate).</span><span class="sxs-lookup"><span data-stu-id="2bed0-125">An **Enrollment group** is an entry for a group of devices that share a common attestation mechanism of X.509 certificates, signed by the [root certificate](https://docs.microsoft.com/azure/iot-dps/concepts-security#root-certificate) or the [intermediate certificate](https://docs.microsoft.com/azure/iot-dps/concepts-security#intermediate-certificate).</span></span> <span data-ttu-id="2bed0-126">We recommend using an enrollment group for a large number of devices that share a desired initial configuration, or for devices all going to the same tenant.</span><span class="sxs-lookup"><span data-stu-id="2bed0-126">We recommend using an enrollment group for a large number of devices that share a desired initial configuration, or for devices all going to the same tenant.</span></span> <span data-ttu-id="2bed0-127">Note that you can only enroll devices that use the X.509 attestation mechanism as *enrollment groups*.</span><span class="sxs-lookup"><span data-stu-id="2bed0-127">Note that you can only enroll devices that use the X.509 attestation mechanism as *enrollment groups*.</span></span> 

    <span data-ttu-id="2bed0-128">You can create an enrollment group with the SDKs following this workflow:</span><span class="sxs-lookup"><span data-stu-id="2bed0-128">You can create an enrollment group with the SDKs following this workflow:</span></span>

    1. <span data-ttu-id="2bed0-129">For enrollment group, the attestation mechanism uses X.509 root certificate.</span><span class="sxs-lookup"><span data-stu-id="2bed0-129">For enrollment group, the attestation mechanism uses X.509 root certificate.</span></span>  <span data-ttu-id="2bed0-130">Call Service SDK API ```X509Attestation.createFromRootCertificate``` with root certificate to create attestation for enrollment.</span><span class="sxs-lookup"><span data-stu-id="2bed0-130">Call Service SDK API ```X509Attestation.createFromRootCertificate``` with root certificate to create attestation for enrollment.</span></span>  <span data-ttu-id="2bed0-131">X.509 root certificate is provided in either a PEM file or as a string.</span><span class="sxs-lookup"><span data-stu-id="2bed0-131">X.509 root certificate is provided in either a PEM file or as a string.</span></span>
    1. <span data-ttu-id="2bed0-132">Create a new ```EnrollmentGroup``` variable using the ```attestation``` created and a unique ```enrollmentGroupId```.</span><span class="sxs-lookup"><span data-stu-id="2bed0-132">Create a new ```EnrollmentGroup``` variable using the ```attestation``` created and a unique ```enrollmentGroupId```.</span></span>  <span data-ttu-id="2bed0-133">Optionally, you can set parameters like ```Device ID```, ```IoTHubHostName```, ```ProvisioningStatus```.</span><span class="sxs-lookup"><span data-stu-id="2bed0-133">Optionally, you can set parameters like ```Device ID```, ```IoTHubHostName```, ```ProvisioningStatus```.</span></span>
    2. <span data-ttu-id="2bed0-134">Call Service SDK API ```createOrUpdateEnrollmentGroup``` in your backend application with ```EnrollmentGroup``` to create an enrollment group.</span><span class="sxs-lookup"><span data-stu-id="2bed0-134">Call Service SDK API ```createOrUpdateEnrollmentGroup``` in your backend application with ```EnrollmentGroup``` to create an enrollment group.</span></span>

* <span data-ttu-id="2bed0-135">An **Individual enrollment** is an entry for a single device that may register.</span><span class="sxs-lookup"><span data-stu-id="2bed0-135">An **Individual enrollment** is an entry for a single device that may register.</span></span> <span data-ttu-id="2bed0-136">Individual enrollments may use either X.509 certificates or SAS tokens (from a physical or virtual TPM) as attestation mechanisms.</span><span class="sxs-lookup"><span data-stu-id="2bed0-136">Individual enrollments may use either X.509 certificates or SAS tokens (from a physical or virtual TPM) as attestation mechanisms.</span></span> <span data-ttu-id="2bed0-137">We recommend using individual enrollments for devices that require unique initial configurations, or for devices which can only use SAS tokens via TPM or virtual TPM as the attestation mechanism.</span><span class="sxs-lookup"><span data-stu-id="2bed0-137">We recommend using individual enrollments for devices that require unique initial configurations, or for devices which can only use SAS tokens via TPM or virtual TPM as the attestation mechanism.</span></span> <span data-ttu-id="2bed0-138">Individual enrollments may have the desired IoT hub device ID specified.</span><span class="sxs-lookup"><span data-stu-id="2bed0-138">Individual enrollments may have the desired IoT hub device ID specified.</span></span>

    <span data-ttu-id="2bed0-139">You can create an individual enrollment with the SDKs following this workflow:</span><span class="sxs-lookup"><span data-stu-id="2bed0-139">You can create an individual enrollment with the SDKs following this workflow:</span></span>
    
    1. <span data-ttu-id="2bed0-140">Choose your ```attestation``` mechanism, which can be TPM or X.509.</span><span class="sxs-lookup"><span data-stu-id="2bed0-140">Choose your ```attestation``` mechanism, which can be TPM or X.509.</span></span>
        1. <span data-ttu-id="2bed0-141">**TPM**: Using the Endorsement Key from a physical device or from TPM Simulator as the input, you can call Service SDK API ```TpmAttestation``` to create attestation for enrollment.</span><span class="sxs-lookup"><span data-stu-id="2bed0-141">**TPM**: Using the Endorsement Key from a physical device or from TPM Simulator as the input, you can call Service SDK API ```TpmAttestation``` to create attestation for enrollment.</span></span> 
        2. <span data-ttu-id="2bed0-142">**X.509**: Using the client certificate as the input, you can call Service SDK API ```X509Attestation.createFromClientCertificate``` to create attestation for enrollment.</span><span class="sxs-lookup"><span data-stu-id="2bed0-142">**X.509**: Using the client certificate as the input, you can call Service SDK API ```X509Attestation.createFromClientCertificate``` to create attestation for enrollment.</span></span>
    2. <span data-ttu-id="2bed0-143">Create a new ```IndividualEnrollment``` variable with using the ```attestation``` created and a unique ```registrationId``` as input, which is on your device or generated from the TPM Simulator.</span><span class="sxs-lookup"><span data-stu-id="2bed0-143">Create a new ```IndividualEnrollment``` variable with using the ```attestation``` created and a unique ```registrationId``` as input, which is on your device or generated from the TPM Simulator.</span></span>  <span data-ttu-id="2bed0-144">Optionally, you can set parameters like ```Device ID```, ```IoTHubHostName```, ```ProvisioningStatus```.</span><span class="sxs-lookup"><span data-stu-id="2bed0-144">Optionally, you can set parameters like ```Device ID```, ```IoTHubHostName```, ```ProvisioningStatus```.</span></span>
    3. <span data-ttu-id="2bed0-145">Call Service SDK API ```createOrUpdateIndividualEnrollment``` in your backend application with ```IndividualEnrollment``` to create an individual enrollment.</span><span class="sxs-lookup"><span data-stu-id="2bed0-145">Call Service SDK API ```createOrUpdateIndividualEnrollment``` in your backend application with ```IndividualEnrollment``` to create an individual enrollment.</span></span>

<span data-ttu-id="2bed0-146">After you have successfully created an enrollment, the Device Provisioning Service returns an enrollment result.</span><span class="sxs-lookup"><span data-stu-id="2bed0-146">After you have successfully created an enrollment, the Device Provisioning Service returns an enrollment result.</span></span> <span data-ttu-id="2bed0-147">This workflow is demonstrated in the samples [mentioned previously](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="2bed0-147">This workflow is demonstrated in the samples [mentioned previously](#prerequisites).</span></span>

## <a name="update-an-enrollment-entry"></a><span data-ttu-id="2bed0-148">Update an enrollment entry</span><span class="sxs-lookup"><span data-stu-id="2bed0-148">Update an enrollment entry</span></span>

<span data-ttu-id="2bed0-149">After you have created an enrollment entry, you may want to update the enrollment.</span><span class="sxs-lookup"><span data-stu-id="2bed0-149">After you have created an enrollment entry, you may want to update the enrollment.</span></span>  <span data-ttu-id="2bed0-150">Potential scenarios include updating the desired property, updating the attestation method, or revoking device access.</span><span class="sxs-lookup"><span data-stu-id="2bed0-150">Potential scenarios include updating the desired property, updating the attestation method, or revoking device access.</span></span>  <span data-ttu-id="2bed0-151">There are different APIs for individual enrollment and group enrollment, but no distinction for attestation mechanism.</span><span class="sxs-lookup"><span data-stu-id="2bed0-151">There are different APIs for individual enrollment and group enrollment, but no distinction for attestation mechanism.</span></span>

<span data-ttu-id="2bed0-152">You can update an enrollment entry following this workflow:</span><span class="sxs-lookup"><span data-stu-id="2bed0-152">You can update an enrollment entry following this workflow:</span></span>
* <span data-ttu-id="2bed0-153">**Individual enrollment**:</span><span class="sxs-lookup"><span data-stu-id="2bed0-153">**Individual enrollment**:</span></span>
    1. <span data-ttu-id="2bed0-154">Get the latest enrollment from the provisioning service first with Service SDK API ```getIndividualEnrollment```.</span><span class="sxs-lookup"><span data-stu-id="2bed0-154">Get the latest enrollment from the provisioning service first with Service SDK API ```getIndividualEnrollment```.</span></span>
    2. <span data-ttu-id="2bed0-155">Modify the parameter of the latest enrollment as necessary.</span><span class="sxs-lookup"><span data-stu-id="2bed0-155">Modify the parameter of the latest enrollment as necessary.</span></span> 
    3. <span data-ttu-id="2bed0-156">Using the latest enrollment, call Service SDK API ```createOrUpdateIndividualEnrollment``` to update your enrollment entry.</span><span class="sxs-lookup"><span data-stu-id="2bed0-156">Using the latest enrollment, call Service SDK API ```createOrUpdateIndividualEnrollment``` to update your enrollment entry.</span></span>
* <span data-ttu-id="2bed0-157">**Group enrollment**:</span><span class="sxs-lookup"><span data-stu-id="2bed0-157">**Group enrollment**:</span></span>
    1. <span data-ttu-id="2bed0-158">Get the latest enrollment from the provisioning service first with Service SDK API ```getEnrollmentGroup```.</span><span class="sxs-lookup"><span data-stu-id="2bed0-158">Get the latest enrollment from the provisioning service first with Service SDK API ```getEnrollmentGroup```.</span></span>
    2. <span data-ttu-id="2bed0-159">Modify the parameter of the latest enrollment as necessary.</span><span class="sxs-lookup"><span data-stu-id="2bed0-159">Modify the parameter of the latest enrollment as necessary.</span></span>
    3. <span data-ttu-id="2bed0-160">Using the latest enrollment, call Service SDK API ```createOrUpdateEnrollmentGroup``` to update your enrollment entry.</span><span class="sxs-lookup"><span data-stu-id="2bed0-160">Using the latest enrollment, call Service SDK API ```createOrUpdateEnrollmentGroup``` to update your enrollment entry.</span></span>

<span data-ttu-id="2bed0-161">This workflow is demonstrated in the samples [mentioned previously](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="2bed0-161">This workflow is demonstrated in the samples [mentioned previously](#prerequisites).</span></span>

## <a name="remove-an-enrollment-entry"></a><span data-ttu-id="2bed0-162">Remove an enrollment entry</span><span class="sxs-lookup"><span data-stu-id="2bed0-162">Remove an enrollment entry</span></span>

* <span data-ttu-id="2bed0-163">**Individual enrollment** can be deleted by calling Service SDK API ```deleteIndividualEnrollment``` using ```registrationId```.</span><span class="sxs-lookup"><span data-stu-id="2bed0-163">**Individual enrollment** can be deleted by calling Service SDK API ```deleteIndividualEnrollment``` using ```registrationId```.</span></span>
* <span data-ttu-id="2bed0-164">**Group enrollment** can be deleted by calling Service SDK API ```deleteEnrollmentGroup``` using ```enrollmentGroupId```.</span><span class="sxs-lookup"><span data-stu-id="2bed0-164">**Group enrollment** can be deleted by calling Service SDK API ```deleteEnrollmentGroup``` using ```enrollmentGroupId```.</span></span>

<span data-ttu-id="2bed0-165">This workflow is demonstrated in the samples [mentioned previously](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="2bed0-165">This workflow is demonstrated in the samples [mentioned previously](#prerequisites).</span></span>

## <a name="bulk-operation-on-individual-enrollments"></a><span data-ttu-id="2bed0-166">Bulk operation on individual enrollments</span><span class="sxs-lookup"><span data-stu-id="2bed0-166">Bulk operation on individual enrollments</span></span>

<span data-ttu-id="2bed0-167">You can perform bulk operation to create, update, or remove multiple individual enrollments following this workflow:</span><span class="sxs-lookup"><span data-stu-id="2bed0-167">You can perform bulk operation to create, update, or remove multiple individual enrollments following this workflow:</span></span>

1. <span data-ttu-id="2bed0-168">Create a variable that contains multiple ```IndividualEnrollment```.</span><span class="sxs-lookup"><span data-stu-id="2bed0-168">Create a variable that contains multiple ```IndividualEnrollment```.</span></span>  <span data-ttu-id="2bed0-169">Implementation of this variable is different for every language.</span><span class="sxs-lookup"><span data-stu-id="2bed0-169">Implementation of this variable is different for every language.</span></span>  <span data-ttu-id="2bed0-170">Review the bulk operation sample on GitHub for details.</span><span class="sxs-lookup"><span data-stu-id="2bed0-170">Review the bulk operation sample on GitHub for details.</span></span>
2. <span data-ttu-id="2bed0-171">Call Service SDK API ```runBulkOperation``` with a ```BulkOperationMode``` for desired operation and your variable for individual enrollments.</span><span class="sxs-lookup"><span data-stu-id="2bed0-171">Call Service SDK API ```runBulkOperation``` with a ```BulkOperationMode``` for desired operation and your variable for individual enrollments.</span></span> <span data-ttu-id="2bed0-172">Four modes are supported: create, update, updateIfMatchEtag, and delete.</span><span class="sxs-lookup"><span data-stu-id="2bed0-172">Four modes are supported: create, update, updateIfMatchEtag, and delete.</span></span>

<span data-ttu-id="2bed0-173">After you have successfully performed an operation, the Device Provisioning Service would return a bulk operation result.</span><span class="sxs-lookup"><span data-stu-id="2bed0-173">After you have successfully performed an operation, the Device Provisioning Service would return a bulk operation result.</span></span>

<span data-ttu-id="2bed0-174">This workflow is demonstrated in the samples [mentioned previously](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="2bed0-174">This workflow is demonstrated in the samples [mentioned previously](#prerequisites).</span></span>
