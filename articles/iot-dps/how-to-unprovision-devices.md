---
title: How to deprovision devices that have been provisioned with Azure IoT Hub Device Provisioning Service | Microsoft Docs
description: How to deprovision devices that have been provisioned with Azure IoT Hub Device Provisioning Service
author: wesmc7777
ms.author: wesmc
ms.date: 05/11/2018
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: timlt
ms.openlocfilehash: 3c6e2a9006d73d269422292dc959866d3f6d8a82
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44858025"
---
# <a name="how-to-deprovision-devices-that-were-previously-auto-provisioned"></a><span data-ttu-id="2156b-103">How to deprovision devices that were previously auto-provisioned</span><span class="sxs-lookup"><span data-stu-id="2156b-103">How to deprovision devices that were previously auto-provisioned</span></span> 

<span data-ttu-id="2156b-104">You may find it necessary to deprovision devices that were previously auto-provisioned through the Device Provisioning Service.</span><span class="sxs-lookup"><span data-stu-id="2156b-104">You may find it necessary to deprovision devices that were previously auto-provisioned through the Device Provisioning Service.</span></span> <span data-ttu-id="2156b-105">For example, a device may be sold or moved to a different IoT hub, or it may be lost, stolen, or otherwise compromised.</span><span class="sxs-lookup"><span data-stu-id="2156b-105">For example, a device may be sold or moved to a different IoT hub, or it may be lost, stolen, or otherwise compromised.</span></span> 

<span data-ttu-id="2156b-106">In general, deprovisioning a device involves two steps:</span><span class="sxs-lookup"><span data-stu-id="2156b-106">In general, deprovisioning a device involves two steps:</span></span>

1. <span data-ttu-id="2156b-107">Disenroll the device from your provisioning service, to prevent future auto-provisioning.</span><span class="sxs-lookup"><span data-stu-id="2156b-107">Disenroll the device from your provisioning service, to prevent future auto-provisioning.</span></span> <span data-ttu-id="2156b-108">Depending on whether you want to revoke access temporarily or permanently, you may want to either disable or delete an enrollment entry.</span><span class="sxs-lookup"><span data-stu-id="2156b-108">Depending on whether you want to revoke access temporarily or permanently, you may want to either disable or delete an enrollment entry.</span></span> <span data-ttu-id="2156b-109">For devices that use X.509 attestation, you may want to disable/delete an entry in the hierarchy of your existing enrollment groups.</span><span class="sxs-lookup"><span data-stu-id="2156b-109">For devices that use X.509 attestation, you may want to disable/delete an entry in the hierarchy of your existing enrollment groups.</span></span>  
 
   - <span data-ttu-id="2156b-110">To learn how to disenroll a device, see [How to disenroll a device from Azure IoT Hub Device Provisioning Service](how-to-revoke-device-access-portal.md).</span><span class="sxs-lookup"><span data-stu-id="2156b-110">To learn how to disenroll a device, see [How to disenroll a device from Azure IoT Hub Device Provisioning Service](how-to-revoke-device-access-portal.md).</span></span>
   - <span data-ttu-id="2156b-111">To learn how to disenroll a device programmatically using one of the provisioning service SDKs, see [Manage device enrollments with service SDKs](how-to-manage-enrollments-sdks.md).</span><span class="sxs-lookup"><span data-stu-id="2156b-111">To learn how to disenroll a device programmatically using one of the provisioning service SDKs, see [Manage device enrollments with service SDKs](how-to-manage-enrollments-sdks.md).</span></span>

2. <span data-ttu-id="2156b-112">Deregister the device from your IoT Hub, to prevent future communications and data transfer.</span><span class="sxs-lookup"><span data-stu-id="2156b-112">Deregister the device from your IoT Hub, to prevent future communications and data transfer.</span></span> <span data-ttu-id="2156b-113">Again, you can temporarily disable or permanently delete the device's entry in the identity registry for the IoT Hub where it was provisioned.</span><span class="sxs-lookup"><span data-stu-id="2156b-113">Again, you can temporarily disable or permanently delete the device's entry in the identity registry for the IoT Hub where it was provisioned.</span></span> <span data-ttu-id="2156b-114">See [Disable devices](/azure/iot-hub/iot-hub-devguide-identity-registry#disable-devices) to learn more about disablement.</span><span class="sxs-lookup"><span data-stu-id="2156b-114">See [Disable devices](/azure/iot-hub/iot-hub-devguide-identity-registry#disable-devices) to learn more about disablement.</span></span> <span data-ttu-id="2156b-115">See "Device Management / IoT Devices" for your IoT Hub resource, in the [Azure portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="2156b-115">See "Device Management / IoT Devices" for your IoT Hub resource, in the [Azure portal](https://portal.azure.com).</span></span>

<span data-ttu-id="2156b-116">The exact steps you take to deprovision a device depend on its attestation mechanism and its applicable enrollment entry with your provisioning service.</span><span class="sxs-lookup"><span data-stu-id="2156b-116">The exact steps you take to deprovision a device depend on its attestation mechanism and its applicable enrollment entry with your provisioning service.</span></span> <span data-ttu-id="2156b-117">The following sections provide an overview of the process, based on the enrollment and attestation type.</span><span class="sxs-lookup"><span data-stu-id="2156b-117">The following sections provide an overview of the process, based on the enrollment and attestation type.</span></span>

## <a name="individual-enrollments"></a><span data-ttu-id="2156b-118">Individual enrollments</span><span class="sxs-lookup"><span data-stu-id="2156b-118">Individual enrollments</span></span>
<span data-ttu-id="2156b-119">Devices that use TPM attestation or X.509 attestation with a leaf certificate are provisioned through an individual enrollment entry.</span><span class="sxs-lookup"><span data-stu-id="2156b-119">Devices that use TPM attestation or X.509 attestation with a leaf certificate are provisioned through an individual enrollment entry.</span></span> 

<span data-ttu-id="2156b-120">To deprovision a device that has an individual enrollment:</span><span class="sxs-lookup"><span data-stu-id="2156b-120">To deprovision a device that has an individual enrollment:</span></span> 

1. <span data-ttu-id="2156b-121">Disenroll the device from your provisioning service:</span><span class="sxs-lookup"><span data-stu-id="2156b-121">Disenroll the device from your provisioning service:</span></span>

   - <span data-ttu-id="2156b-122">For devices that use TPM attestation, delete the individual enrollment entry to permanently revoke the device's access to the provisioning service, or disable the entry to temporarily revoke its access.</span><span class="sxs-lookup"><span data-stu-id="2156b-122">For devices that use TPM attestation, delete the individual enrollment entry to permanently revoke the device's access to the provisioning service, or disable the entry to temporarily revoke its access.</span></span> 
   - <span data-ttu-id="2156b-123">For devices that use X.509 attestation, you can either delete or disable the entry.</span><span class="sxs-lookup"><span data-stu-id="2156b-123">For devices that use X.509 attestation, you can either delete or disable the entry.</span></span> <span data-ttu-id="2156b-124">Be aware, though, if you delete an individual enrollment for a device that uses X.509 and an enabled enrollment group exists for a signing certificate in that device's certificate chain, the device can re-enroll.</span><span class="sxs-lookup"><span data-stu-id="2156b-124">Be aware, though, if you delete an individual enrollment for a device that uses X.509 and an enabled enrollment group exists for a signing certificate in that device's certificate chain, the device can re-enroll.</span></span> <span data-ttu-id="2156b-125">For such devices, it may be safer to disable the enrollment entry.</span><span class="sxs-lookup"><span data-stu-id="2156b-125">For such devices, it may be safer to disable the enrollment entry.</span></span> <span data-ttu-id="2156b-126">Doing so prevents the device from re-enrolling, regardless of whether an enabled enrollment group exists for one of its signing certificates.</span><span class="sxs-lookup"><span data-stu-id="2156b-126">Doing so prevents the device from re-enrolling, regardless of whether an enabled enrollment group exists for one of its signing certificates.</span></span>

2. <span data-ttu-id="2156b-127">Disable or delete the device in the identity registry of the IoT hub that it was provisioned to.</span><span class="sxs-lookup"><span data-stu-id="2156b-127">Disable or delete the device in the identity registry of the IoT hub that it was provisioned to.</span></span> 


## <a name="enrollment-groups"></a><span data-ttu-id="2156b-128">Enrollment groups</span><span class="sxs-lookup"><span data-stu-id="2156b-128">Enrollment groups</span></span>
<span data-ttu-id="2156b-129">With X.509 attestation, devices can also be provisioned through an enrollment group.</span><span class="sxs-lookup"><span data-stu-id="2156b-129">With X.509 attestation, devices can also be provisioned through an enrollment group.</span></span> <span data-ttu-id="2156b-130">Enrollment groups are configured with a signing certificate, either an intermediate or root CA certificate, and control access to the provisioning service for devices with that certificate in their certificate chain.</span><span class="sxs-lookup"><span data-stu-id="2156b-130">Enrollment groups are configured with a signing certificate, either an intermediate or root CA certificate, and control access to the provisioning service for devices with that certificate in their certificate chain.</span></span> <span data-ttu-id="2156b-131">To learn more about enrollment groups and X.509 certificates with the provisioning service, see [X.509 certificates](concepts-security.md#x509-certificates).</span><span class="sxs-lookup"><span data-stu-id="2156b-131">To learn more about enrollment groups and X.509 certificates with the provisioning service, see [X.509 certificates](concepts-security.md#x509-certificates).</span></span> 

<span data-ttu-id="2156b-132">To see a list of devices that have been provisioned through an enrollment group, you can view the enrollment group's details.</span><span class="sxs-lookup"><span data-stu-id="2156b-132">To see a list of devices that have been provisioned through an enrollment group, you can view the enrollment group's details.</span></span> <span data-ttu-id="2156b-133">This is an easy way to understand which IoT hub each device has been provisioned to.</span><span class="sxs-lookup"><span data-stu-id="2156b-133">This is an easy way to understand which IoT hub each device has been provisioned to.</span></span> <span data-ttu-id="2156b-134">To view the device list:</span><span class="sxs-lookup"><span data-stu-id="2156b-134">To view the device list:</span></span> 

1. <span data-ttu-id="2156b-135">Log in to the Azure portal and click **All resources** on the left-hand menu.</span><span class="sxs-lookup"><span data-stu-id="2156b-135">Log in to the Azure portal and click **All resources** on the left-hand menu.</span></span>
2. <span data-ttu-id="2156b-136">Click your provisioning service in the list of resources.</span><span class="sxs-lookup"><span data-stu-id="2156b-136">Click your provisioning service in the list of resources.</span></span>
3. <span data-ttu-id="2156b-137">In your provisioning service, click **Manage enrollments**, then select **Enrollment Groups** tab.</span><span class="sxs-lookup"><span data-stu-id="2156b-137">In your provisioning service, click **Manage enrollments**, then select **Enrollment Groups** tab.</span></span>
4. <span data-ttu-id="2156b-138">Click the enrollment group to open it.</span><span class="sxs-lookup"><span data-stu-id="2156b-138">Click the enrollment group to open it.</span></span>

   ![View enrollment group entry in the portal](./media/how-to-unprovision-devices/view-enrollment-group.png)

<span data-ttu-id="2156b-140">With enrollment groups, there are two scenarios to consider:</span><span class="sxs-lookup"><span data-stu-id="2156b-140">With enrollment groups, there are two scenarios to consider:</span></span>

- <span data-ttu-id="2156b-141">To deprovision all of the devices that have been provisioned through an enrollment group:</span><span class="sxs-lookup"><span data-stu-id="2156b-141">To deprovision all of the devices that have been provisioned through an enrollment group:</span></span>
  1. <span data-ttu-id="2156b-142">Disable the enrollment group to blacklist its signing certificate.</span><span class="sxs-lookup"><span data-stu-id="2156b-142">Disable the enrollment group to blacklist its signing certificate.</span></span> 
  2. <span data-ttu-id="2156b-143">Use the list of provisioned devices for that enrollment group to disable or delete each device from the identity registry of its respective IoT hub.</span><span class="sxs-lookup"><span data-stu-id="2156b-143">Use the list of provisioned devices for that enrollment group to disable or delete each device from the identity registry of its respective IoT hub.</span></span> 
  3. <span data-ttu-id="2156b-144">After disabling or deleting all devices from their respective IoT hubs, you can optionally delete the enrollment group.</span><span class="sxs-lookup"><span data-stu-id="2156b-144">After disabling or deleting all devices from their respective IoT hubs, you can optionally delete the enrollment group.</span></span> <span data-ttu-id="2156b-145">Be aware, though, that, if you delete the enrollment group and there is an enabled enrollment group for a signing certificate higher up in the certificate chain of one or more of the devices, those devices can re-enroll.</span><span class="sxs-lookup"><span data-stu-id="2156b-145">Be aware, though, that, if you delete the enrollment group and there is an enabled enrollment group for a signing certificate higher up in the certificate chain of one or more of the devices, those devices can re-enroll.</span></span> 

- <span data-ttu-id="2156b-146">To deprovision a single device from an enrollment group:</span><span class="sxs-lookup"><span data-stu-id="2156b-146">To deprovision a single device from an enrollment group:</span></span>
  1. <span data-ttu-id="2156b-147">Create a disabled individual enrollment for its leaf (device) certificate.</span><span class="sxs-lookup"><span data-stu-id="2156b-147">Create a disabled individual enrollment for its leaf (device) certificate.</span></span> <span data-ttu-id="2156b-148">This revokes access to the provisioning service for that device while still permitting access for other devices that have the enrollment group's signing certificate in their chain.</span><span class="sxs-lookup"><span data-stu-id="2156b-148">This revokes access to the provisioning service for that device while still permitting access for other devices that have the enrollment group's signing certificate in their chain.</span></span> <span data-ttu-id="2156b-149">Do not delete the disabled individual enrollment for the device.</span><span class="sxs-lookup"><span data-stu-id="2156b-149">Do not delete the disabled individual enrollment for the device.</span></span> <span data-ttu-id="2156b-150">Doing so will allow the device to re-enroll through the enrollment group.</span><span class="sxs-lookup"><span data-stu-id="2156b-150">Doing so will allow the device to re-enroll through the enrollment group.</span></span> 
  2. <span data-ttu-id="2156b-151">Use the list of provisioned devices for that enrollment group to find the IoT hub that the device was provisioned to and disable or delete it from that hub's identity registry.</span><span class="sxs-lookup"><span data-stu-id="2156b-151">Use the list of provisioned devices for that enrollment group to find the IoT hub that the device was provisioned to and disable or delete it from that hub's identity registry.</span></span> 
  
  










