---
title: How to disenroll a device from Azure IoT Hub Device Provisioning Service
description: How to disenroll a device to prevent provisioning through Azure IoT Hub Device Provisioning Service
author: wesmc7777
ms.author: wesmc
ms.date: 04/05/2018
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: timlt
ms.openlocfilehash: d0720c23e0831b446a92855383fab06b0bfacbc7
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44856263"
---
# <a name="how-to-disenroll-a-device-from-azure-iot-hub-device-provisioning-service"></a><span data-ttu-id="512be-103">How to disenroll a device from Azure IoT Hub Device Provisioning Service</span><span class="sxs-lookup"><span data-stu-id="512be-103">How to disenroll a device from Azure IoT Hub Device Provisioning Service</span></span>

<span data-ttu-id="512be-104">Proper management of device credentials is crucial for high-profile systems like IoT solutions.</span><span class="sxs-lookup"><span data-stu-id="512be-104">Proper management of device credentials is crucial for high-profile systems like IoT solutions.</span></span> <span data-ttu-id="512be-105">A best practice for such systems is to have a clear plan of how to revoke access for devices when their credentials, whether a shared access signatures (SAS) token or an X.509 certificate, might be compromised.</span><span class="sxs-lookup"><span data-stu-id="512be-105">A best practice for such systems is to have a clear plan of how to revoke access for devices when their credentials, whether a shared access signatures (SAS) token or an X.509 certificate, might be compromised.</span></span> 

<span data-ttu-id="512be-106">Enrollment in the Device Provisioning Service enables a device to be [auto-provisioned](concepts-auto-provisioning.md).</span><span class="sxs-lookup"><span data-stu-id="512be-106">Enrollment in the Device Provisioning Service enables a device to be [auto-provisioned](concepts-auto-provisioning.md).</span></span> <span data-ttu-id="512be-107">A provisioned device is one that has been registered with IoT Hub, allowing it to receive its initial [device twin](~/articles/iot-hub/iot-hub-devguide-device-twins.md) state and begin reporting telemetry data.</span><span class="sxs-lookup"><span data-stu-id="512be-107">A provisioned device is one that has been registered with IoT Hub, allowing it to receive its initial [device twin](~/articles/iot-hub/iot-hub-devguide-device-twins.md) state and begin reporting telemetry data.</span></span> <span data-ttu-id="512be-108">This article describes how to disenroll a device from your provisioning service instance, preventing it from being provisioned again in the future.</span><span class="sxs-lookup"><span data-stu-id="512be-108">This article describes how to disenroll a device from your provisioning service instance, preventing it from being provisioned again in the future.</span></span>

> [!NOTE] 
> <span data-ttu-id="512be-109">Be aware of the retry policy of devices that you revoke access for.</span><span class="sxs-lookup"><span data-stu-id="512be-109">Be aware of the retry policy of devices that you revoke access for.</span></span> <span data-ttu-id="512be-110">For example, a device that has an infinite retry policy might continuously try to register with the provisioning service.</span><span class="sxs-lookup"><span data-stu-id="512be-110">For example, a device that has an infinite retry policy might continuously try to register with the provisioning service.</span></span> <span data-ttu-id="512be-111">That situation consumes service resources and possibly affects performance.</span><span class="sxs-lookup"><span data-stu-id="512be-111">That situation consumes service resources and possibly affects performance.</span></span>

## <a name="blacklist-devices-by-using-an-individual-enrollment-entry"></a><span data-ttu-id="512be-112">Blacklist devices by using an individual enrollment entry</span><span class="sxs-lookup"><span data-stu-id="512be-112">Blacklist devices by using an individual enrollment entry</span></span>

<span data-ttu-id="512be-113">Individual enrollments apply to a single device and can use either X.509 certificates or SAS tokens (in a real or virtual TPM) as the attestation mechanism.</span><span class="sxs-lookup"><span data-stu-id="512be-113">Individual enrollments apply to a single device and can use either X.509 certificates or SAS tokens (in a real or virtual TPM) as the attestation mechanism.</span></span> <span data-ttu-id="512be-114">(Devices that use SAS tokens as their attestation mechanism can be provisioned only through an individual enrollment.) To blacklist a device that has an individual enrollment, you can either disable or delete its enrollment entry.</span><span class="sxs-lookup"><span data-stu-id="512be-114">(Devices that use SAS tokens as their attestation mechanism can be provisioned only through an individual enrollment.) To blacklist a device that has an individual enrollment, you can either disable or delete its enrollment entry.</span></span> 

<span data-ttu-id="512be-115">To temporarily blacklist the device by disabling its enrollment entry:</span><span class="sxs-lookup"><span data-stu-id="512be-115">To temporarily blacklist the device by disabling its enrollment entry:</span></span> 

1. <span data-ttu-id="512be-116">Sign in to the Azure portal and select **All resources** from the left menu.</span><span class="sxs-lookup"><span data-stu-id="512be-116">Sign in to the Azure portal and select **All resources** from the left menu.</span></span>
2. <span data-ttu-id="512be-117">In the list of resources, select the provisioning service that you want to blacklist your device from.</span><span class="sxs-lookup"><span data-stu-id="512be-117">In the list of resources, select the provisioning service that you want to blacklist your device from.</span></span>
3. <span data-ttu-id="512be-118">In your provisioning service, select **Manage enrollments**, and then select the **Individual Enrollments** tab.</span><span class="sxs-lookup"><span data-stu-id="512be-118">In your provisioning service, select **Manage enrollments**, and then select the **Individual Enrollments** tab.</span></span>
4. <span data-ttu-id="512be-119">Select the enrollment entry for the device that you want to blacklist.</span><span class="sxs-lookup"><span data-stu-id="512be-119">Select the enrollment entry for the device that you want to blacklist.</span></span> 
5. <span data-ttu-id="512be-120">Scroll to the bottom, and select **Disable** on the **Enable entry** switch, and then select **Save**.</span><span class="sxs-lookup"><span data-stu-id="512be-120">Scroll to the bottom, and select **Disable** on the **Enable entry** switch, and then select **Save**.</span></span>  

   <span data-ttu-id="512be-121">[![Disable individual enrollment entry in the portal](./media/how-to-revoke-device-access-portal/disable-individual-enrollment.png)](./media/how-to-revoke-device-access-portal/disable-individual-enrollment.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="512be-121">[![Disable individual enrollment entry in the portal](./media/how-to-revoke-device-access-portal/disable-individual-enrollment.png)](./media/how-to-revoke-device-access-portal/disable-individual-enrollment.png#lightbox)</span></span>  

<span data-ttu-id="512be-122">To permanently blacklist the device by deleting its enrollment entry:</span><span class="sxs-lookup"><span data-stu-id="512be-122">To permanently blacklist the device by deleting its enrollment entry:</span></span>

1. <span data-ttu-id="512be-123">Sign in to the Azure portal and select **All resources** from the left menu.</span><span class="sxs-lookup"><span data-stu-id="512be-123">Sign in to the Azure portal and select **All resources** from the left menu.</span></span>
2. <span data-ttu-id="512be-124">In the list of resources, select the provisioning service that you want to blacklist your device from.</span><span class="sxs-lookup"><span data-stu-id="512be-124">In the list of resources, select the provisioning service that you want to blacklist your device from.</span></span>
3. <span data-ttu-id="512be-125">In your provisioning service, select **Manage enrollments**, and then select the **Individual Enrollments** tab.</span><span class="sxs-lookup"><span data-stu-id="512be-125">In your provisioning service, select **Manage enrollments**, and then select the **Individual Enrollments** tab.</span></span>
4. <span data-ttu-id="512be-126">Select the check box next to the enrollment entry for the device that you want to blacklist.</span><span class="sxs-lookup"><span data-stu-id="512be-126">Select the check box next to the enrollment entry for the device that you want to blacklist.</span></span> 
5. <span data-ttu-id="512be-127">Select **Delete** at the top of the window, and then select **Yes** to confirm that you want to remove the enrollment.</span><span class="sxs-lookup"><span data-stu-id="512be-127">Select **Delete** at the top of the window, and then select **Yes** to confirm that you want to remove the enrollment.</span></span> 

   ![Delete individual enrollment entry in the portal](./media/how-to-revoke-device-access-portal/delete-individual-enrollment.png)
    
<span data-ttu-id="512be-129">After you finish the procedure, you should see your entry removed from the list of individual enrollments.</span><span class="sxs-lookup"><span data-stu-id="512be-129">After you finish the procedure, you should see your entry removed from the list of individual enrollments.</span></span>  

## <a name="blacklist-an-x509-intermediate-or-root-ca-certificate-by-using-an-enrollment-group"></a><span data-ttu-id="512be-130">Blacklist an X.509 intermediate or root CA certificate by using an enrollment group</span><span class="sxs-lookup"><span data-stu-id="512be-130">Blacklist an X.509 intermediate or root CA certificate by using an enrollment group</span></span>

<span data-ttu-id="512be-131">X.509 certificates are typically arranged in a certificate chain of trust.</span><span class="sxs-lookup"><span data-stu-id="512be-131">X.509 certificates are typically arranged in a certificate chain of trust.</span></span> <span data-ttu-id="512be-132">If a certificate at any stage in a chain becomes compromised, trust is broken.</span><span class="sxs-lookup"><span data-stu-id="512be-132">If a certificate at any stage in a chain becomes compromised, trust is broken.</span></span> <span data-ttu-id="512be-133">The certificate must be blacklisted to prevent Device Provisioning Service from provisioning devices downstream in any chain that contains that certificate.</span><span class="sxs-lookup"><span data-stu-id="512be-133">The certificate must be blacklisted to prevent Device Provisioning Service from provisioning devices downstream in any chain that contains that certificate.</span></span> <span data-ttu-id="512be-134">To learn more about X.509 certificates and how they are used with the provisioning service, see [X.509 certificates](./concepts-security.md#x509-certificates).</span><span class="sxs-lookup"><span data-stu-id="512be-134">To learn more about X.509 certificates and how they are used with the provisioning service, see [X.509 certificates](./concepts-security.md#x509-certificates).</span></span> 

<span data-ttu-id="512be-135">An enrollment group is an entry for devices that share a common attestation mechanism of X.509 certificates signed by the same intermediate or root CA.</span><span class="sxs-lookup"><span data-stu-id="512be-135">An enrollment group is an entry for devices that share a common attestation mechanism of X.509 certificates signed by the same intermediate or root CA.</span></span> <span data-ttu-id="512be-136">The enrollment group entry is configured with the X.509 certificate associated with the intermediate or root CA.</span><span class="sxs-lookup"><span data-stu-id="512be-136">The enrollment group entry is configured with the X.509 certificate associated with the intermediate or root CA.</span></span> <span data-ttu-id="512be-137">The entry is also configured with any configuration values, such as twin state and IoT hub connection, that are shared by devices with that certificate in their certificate chain.</span><span class="sxs-lookup"><span data-stu-id="512be-137">The entry is also configured with any configuration values, such as twin state and IoT hub connection, that are shared by devices with that certificate in their certificate chain.</span></span> <span data-ttu-id="512be-138">To blacklist the certificate, you can either disable or delete its enrollment group.</span><span class="sxs-lookup"><span data-stu-id="512be-138">To blacklist the certificate, you can either disable or delete its enrollment group.</span></span>

<span data-ttu-id="512be-139">To temporarily blacklist the certificate by disabling its enrollment group:</span><span class="sxs-lookup"><span data-stu-id="512be-139">To temporarily blacklist the certificate by disabling its enrollment group:</span></span> 

1. <span data-ttu-id="512be-140">Sign in to the Azure portal and select **All resources** from the left menu.</span><span class="sxs-lookup"><span data-stu-id="512be-140">Sign in to the Azure portal and select **All resources** from the left menu.</span></span>
2. <span data-ttu-id="512be-141">In the list of resources, select the provisioning service that you want to blacklist the signing certificate from.</span><span class="sxs-lookup"><span data-stu-id="512be-141">In the list of resources, select the provisioning service that you want to blacklist the signing certificate from.</span></span>
3. <span data-ttu-id="512be-142">In your provisioning service, select **Manage enrollments**, and then select the **Enrollment Groups** tab.</span><span class="sxs-lookup"><span data-stu-id="512be-142">In your provisioning service, select **Manage enrollments**, and then select the **Enrollment Groups** tab.</span></span>
4. <span data-ttu-id="512be-143">Select the enrollment group using the certificate that you want to blacklist.</span><span class="sxs-lookup"><span data-stu-id="512be-143">Select the enrollment group using the certificate that you want to blacklist.</span></span>
5. <span data-ttu-id="512be-144">Select **Disable** on the **Enable entry** switch, and then select **Save**.</span><span class="sxs-lookup"><span data-stu-id="512be-144">Select **Disable** on the **Enable entry** switch, and then select **Save**.</span></span>  

   ![Disable enrollment group entry in the portal](./media/how-to-revoke-device-access-portal/disable-enrollment-group.png)

    
<span data-ttu-id="512be-146">To permanently blacklist the certificate by deleting its enrollment group:</span><span class="sxs-lookup"><span data-stu-id="512be-146">To permanently blacklist the certificate by deleting its enrollment group:</span></span>

1. <span data-ttu-id="512be-147">Sign in to the Azure portal and select **All resources** from the left menu.</span><span class="sxs-lookup"><span data-stu-id="512be-147">Sign in to the Azure portal and select **All resources** from the left menu.</span></span>
2. <span data-ttu-id="512be-148">In the list of resources, select the provisioning service that you want to blacklist your device from.</span><span class="sxs-lookup"><span data-stu-id="512be-148">In the list of resources, select the provisioning service that you want to blacklist your device from.</span></span>
3. <span data-ttu-id="512be-149">In your provisioning service, select **Manage enrollments**, and then select the **Enrollment Groups** tab.</span><span class="sxs-lookup"><span data-stu-id="512be-149">In your provisioning service, select **Manage enrollments**, and then select the **Enrollment Groups** tab.</span></span>
4. <span data-ttu-id="512be-150">Select the check box next to the enrollment group for the certificate that you want to blacklist.</span><span class="sxs-lookup"><span data-stu-id="512be-150">Select the check box next to the enrollment group for the certificate that you want to blacklist.</span></span> 
5. <span data-ttu-id="512be-151">Select **Delete** at the top of the window, and then select **Yes** to confirm that you want to remove the enrollment group.</span><span class="sxs-lookup"><span data-stu-id="512be-151">Select **Delete** at the top of the window, and then select **Yes** to confirm that you want to remove the enrollment group.</span></span> 

   ![Delete enrollment group entry in the portal](./media/how-to-revoke-device-access-portal/delete-enrollment-group.png)

<span data-ttu-id="512be-153">After you finish the procedure, you should see your entry removed from the list of enrollment groups.</span><span class="sxs-lookup"><span data-stu-id="512be-153">After you finish the procedure, you should see your entry removed from the list of enrollment groups.</span></span>  

> [!NOTE]
> <span data-ttu-id="512be-154">If you delete an enrollment group for a certificate, devices that have the certificate in their certificate chain might still be able to enroll if an enabled enrollment group for the root certificate or another intermediate certificate higher up in their certificate chain exists.</span><span class="sxs-lookup"><span data-stu-id="512be-154">If you delete an enrollment group for a certificate, devices that have the certificate in their certificate chain might still be able to enroll if an enabled enrollment group for the root certificate or another intermediate certificate higher up in their certificate chain exists.</span></span>

## <a name="blacklist-specific-devices-in-an-enrollment-group"></a><span data-ttu-id="512be-155">Blacklist specific devices in an enrollment group</span><span class="sxs-lookup"><span data-stu-id="512be-155">Blacklist specific devices in an enrollment group</span></span>

<span data-ttu-id="512be-156">Devices that implement the X.509 attestation mechanism use the device's certificate chain and private key to authenticate.</span><span class="sxs-lookup"><span data-stu-id="512be-156">Devices that implement the X.509 attestation mechanism use the device's certificate chain and private key to authenticate.</span></span> <span data-ttu-id="512be-157">When a device connects and authenticates with Device Provisioning Service, the service first looks for an individual enrollment that matches the device's credentials.</span><span class="sxs-lookup"><span data-stu-id="512be-157">When a device connects and authenticates with Device Provisioning Service, the service first looks for an individual enrollment that matches the device's credentials.</span></span> <span data-ttu-id="512be-158">The service then searches enrollment groups to determine whether the device can be provisioned.</span><span class="sxs-lookup"><span data-stu-id="512be-158">The service then searches enrollment groups to determine whether the device can be provisioned.</span></span> <span data-ttu-id="512be-159">If the service finds a disabled individual enrollment for the device, it prevents the device from connecting.</span><span class="sxs-lookup"><span data-stu-id="512be-159">If the service finds a disabled individual enrollment for the device, it prevents the device from connecting.</span></span> <span data-ttu-id="512be-160">The service prevents the connection even if an enabled enrollment group for an intermediate or root CA in the device's certificate chain exists.</span><span class="sxs-lookup"><span data-stu-id="512be-160">The service prevents the connection even if an enabled enrollment group for an intermediate or root CA in the device's certificate chain exists.</span></span> 

<span data-ttu-id="512be-161">To blacklist an individual device in an enrollment group, follow these steps:</span><span class="sxs-lookup"><span data-stu-id="512be-161">To blacklist an individual device in an enrollment group, follow these steps:</span></span>

1. <span data-ttu-id="512be-162">Sign in to the Azure portal and select **All resources** from the left menu.</span><span class="sxs-lookup"><span data-stu-id="512be-162">Sign in to the Azure portal and select **All resources** from the left menu.</span></span>
2. <span data-ttu-id="512be-163">From the list of resources, select the provisioning service that contains the enrollment group for the device that you want to blacklist.</span><span class="sxs-lookup"><span data-stu-id="512be-163">From the list of resources, select the provisioning service that contains the enrollment group for the device that you want to blacklist.</span></span>
3. <span data-ttu-id="512be-164">In your provisioning service, select **Manage enrollments**, and then select the **Individual Enrollments** tab.</span><span class="sxs-lookup"><span data-stu-id="512be-164">In your provisioning service, select **Manage enrollments**, and then select the **Individual Enrollments** tab.</span></span>
4. <span data-ttu-id="512be-165">Select the **Add** button at the top.</span><span class="sxs-lookup"><span data-stu-id="512be-165">Select the **Add** button at the top.</span></span> 
5. <span data-ttu-id="512be-166">Select **X.509** as the attestation mechanism for the device, and upload the device certificate.</span><span class="sxs-lookup"><span data-stu-id="512be-166">Select **X.509** as the attestation mechanism for the device, and upload the device certificate.</span></span> <span data-ttu-id="512be-167">This is the signed end-entity certificate installed on the device.</span><span class="sxs-lookup"><span data-stu-id="512be-167">This is the signed end-entity certificate installed on the device.</span></span> <span data-ttu-id="512be-168">The device uses it to generate certificates for authentication.</span><span class="sxs-lookup"><span data-stu-id="512be-168">The device uses it to generate certificates for authentication.</span></span>
6. <span data-ttu-id="512be-169">For **IoT Hub device ID**, enter the ID for the device.</span><span class="sxs-lookup"><span data-stu-id="512be-169">For **IoT Hub device ID**, enter the ID for the device.</span></span> 
7. <span data-ttu-id="512be-170">Select **Disable** on the **Enable entry** switch, and then select **Save**.</span><span class="sxs-lookup"><span data-stu-id="512be-170">Select **Disable** on the **Enable entry** switch, and then select **Save**.</span></span> 

    <span data-ttu-id="512be-171">[![Use disabled individual enrollment entry to disable device from group enrollment, in the portal](./media/how-to-revoke-device-access-portal/disable-individual-enrollment-in-enrollment-group.png)](./media/how-to-revoke-device-access-portal/disable-individual-enrollment-in-enrollment-group.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="512be-171">[![Use disabled individual enrollment entry to disable device from group enrollment, in the portal](./media/how-to-revoke-device-access-portal/disable-individual-enrollment-in-enrollment-group.png)](./media/how-to-revoke-device-access-portal/disable-individual-enrollment-in-enrollment-group.png#lightbox)</span></span>

<span data-ttu-id="512be-172">When you successfully create your enrollment, you should see your device appear on the **Individual Enrollments** tab.</span><span class="sxs-lookup"><span data-stu-id="512be-172">When you successfully create your enrollment, you should see your device appear on the **Individual Enrollments** tab.</span></span>

## <a name="next-steps"></a><span data-ttu-id="512be-173">Next steps</span><span class="sxs-lookup"><span data-stu-id="512be-173">Next steps</span></span>

<span data-ttu-id="512be-174">Disenrollment is also part of the larger deprovisioning process.</span><span class="sxs-lookup"><span data-stu-id="512be-174">Disenrollment is also part of the larger deprovisioning process.</span></span> <span data-ttu-id="512be-175">Deprovisioning a device includes both disenrollment from the provisioning service, and deregistering from IoT hub.</span><span class="sxs-lookup"><span data-stu-id="512be-175">Deprovisioning a device includes both disenrollment from the provisioning service, and deregistering from IoT hub.</span></span> <span data-ttu-id="512be-176">To learn about the full process, see [How to deprovision devices that were previously auto-provisioned](how-to-unprovision-devices.md)</span><span class="sxs-lookup"><span data-stu-id="512be-176">To learn about the full process, see [How to deprovision devices that were previously auto-provisioned](how-to-unprovision-devices.md)</span></span> 

