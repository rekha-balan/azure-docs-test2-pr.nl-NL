---
title: Outbound connections in Azure (Classic) | Microsoft Docs
description: This article explains how Azure enables cloud services to communicate with public internet services.
services: load-balancer
documentationcenter: na
author: KumudD
manager: jeconnoc
editor: ''
ms.assetid: ''
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/13/2018
ms.author: kumud
ms.openlocfilehash: bd446923f84d22537b7a49a8ef6124f343141d73
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44967565"
---
# <a name="outbound-connections-classic"></a><span data-ttu-id="2af9e-103">Outbound connections (Classic)</span><span class="sxs-lookup"><span data-stu-id="2af9e-103">Outbound connections (Classic)</span></span>

<span data-ttu-id="2af9e-104">Azure provides outbound connectivity for customer deployments through several different mechanisms.</span><span class="sxs-lookup"><span data-stu-id="2af9e-104">Azure provides outbound connectivity for customer deployments through several different mechanisms.</span></span> <span data-ttu-id="2af9e-105">This article describes what the scenarios are, when they apply, how they work, and how to manage them.</span><span class="sxs-lookup"><span data-stu-id="2af9e-105">This article describes what the scenarios are, when they apply, how they work, and how to manage them.</span></span>

>[!NOTE]
><span data-ttu-id="2af9e-106">This article covers Classic deployments only.</span><span class="sxs-lookup"><span data-stu-id="2af9e-106">This article covers Classic deployments only.</span></span>  <span data-ttu-id="2af9e-107">Review [Outbound connections](load-balancer-outbound-connections.md) for all Resource Manager deployment scenarios in Azure.</span><span class="sxs-lookup"><span data-stu-id="2af9e-107">Review [Outbound connections](load-balancer-outbound-connections.md) for all Resource Manager deployment scenarios in Azure.</span></span>

<span data-ttu-id="2af9e-108">A deployment in Azure can communicate with endpoints outside Azure in the public IP address space.</span><span class="sxs-lookup"><span data-stu-id="2af9e-108">A deployment in Azure can communicate with endpoints outside Azure in the public IP address space.</span></span> <span data-ttu-id="2af9e-109">When an instance initiates an outbound flow to a destination in the public IP address space, Azure dynamically maps the private IP address to a public IP address.</span><span class="sxs-lookup"><span data-stu-id="2af9e-109">When an instance initiates an outbound flow to a destination in the public IP address space, Azure dynamically maps the private IP address to a public IP address.</span></span> <span data-ttu-id="2af9e-110">After this mapping is created, return traffic for this outbound originated flow can also reach the private IP address where the flow originated.</span><span class="sxs-lookup"><span data-stu-id="2af9e-110">After this mapping is created, return traffic for this outbound originated flow can also reach the private IP address where the flow originated.</span></span>

<span data-ttu-id="2af9e-111">Azure uses source network address translation (SNAT) to perform this function.</span><span class="sxs-lookup"><span data-stu-id="2af9e-111">Azure uses source network address translation (SNAT) to perform this function.</span></span> <span data-ttu-id="2af9e-112">When multiple private IP addresses are masquerading behind a single public IP address, Azure uses [port address translation (PAT)](#pat) to masquerade private IP addresses.</span><span class="sxs-lookup"><span data-stu-id="2af9e-112">When multiple private IP addresses are masquerading behind a single public IP address, Azure uses [port address translation (PAT)](#pat) to masquerade private IP addresses.</span></span> <span data-ttu-id="2af9e-113">Ephemeral ports are used for PAT and are [preallocated](#preallocatedports) based on pool size.</span><span class="sxs-lookup"><span data-stu-id="2af9e-113">Ephemeral ports are used for PAT and are [preallocated](#preallocatedports) based on pool size.</span></span>

<span data-ttu-id="2af9e-114">There are multiple [outbound scenarios](#scenarios).</span><span class="sxs-lookup"><span data-stu-id="2af9e-114">There are multiple [outbound scenarios](#scenarios).</span></span> <span data-ttu-id="2af9e-115">You can combine these scenarios as needed.</span><span class="sxs-lookup"><span data-stu-id="2af9e-115">You can combine these scenarios as needed.</span></span> <span data-ttu-id="2af9e-116">Review them carefully to understand the capabilities, constraints, and patterns as they apply to your deployment model and application scenario.</span><span class="sxs-lookup"><span data-stu-id="2af9e-116">Review them carefully to understand the capabilities, constraints, and patterns as they apply to your deployment model and application scenario.</span></span> <span data-ttu-id="2af9e-117">Review guidance for [managing these scenarios](#snatexhaust).</span><span class="sxs-lookup"><span data-stu-id="2af9e-117">Review guidance for [managing these scenarios](#snatexhaust).</span></span>

## <a name="scenarios"></a><span data-ttu-id="2af9e-118">Scenario overview</span><span class="sxs-lookup"><span data-stu-id="2af9e-118">Scenario overview</span></span>

<span data-ttu-id="2af9e-119">Azure provides three different methods to achieve outbound connectivity Classic deployments.</span><span class="sxs-lookup"><span data-stu-id="2af9e-119">Azure provides three different methods to achieve outbound connectivity Classic deployments.</span></span>  <span data-ttu-id="2af9e-120">Not all Classic deployments have all three scenarios available to them:</span><span class="sxs-lookup"><span data-stu-id="2af9e-120">Not all Classic deployments have all three scenarios available to them:</span></span>

| <span data-ttu-id="2af9e-121">Scenario</span><span class="sxs-lookup"><span data-stu-id="2af9e-121">Scenario</span></span> | <span data-ttu-id="2af9e-122">Method</span><span class="sxs-lookup"><span data-stu-id="2af9e-122">Method</span></span> | <span data-ttu-id="2af9e-123">IP Protocols</span><span class="sxs-lookup"><span data-stu-id="2af9e-123">IP Protocols</span></span> | <span data-ttu-id="2af9e-124">Description</span><span class="sxs-lookup"><span data-stu-id="2af9e-124">Description</span></span> | <span data-ttu-id="2af9e-125">Web Worker Role</span><span class="sxs-lookup"><span data-stu-id="2af9e-125">Web Worker Role</span></span> | <span data-ttu-id="2af9e-126">IaaS</span><span class="sxs-lookup"><span data-stu-id="2af9e-126">IaaS</span></span> | 
| --- | --- | --- | --- | --- | --- |
| [<span data-ttu-id="2af9e-127">1. VM with an Instance Level Public IP address</span><span class="sxs-lookup"><span data-stu-id="2af9e-127">1. VM with an Instance Level Public IP address</span></span>](#ilpip) | <span data-ttu-id="2af9e-128">SNAT, port masquerading not used</span><span class="sxs-lookup"><span data-stu-id="2af9e-128">SNAT, port masquerading not used</span></span> | <span data-ttu-id="2af9e-129">TCP, UDP, ICMP, ESP</span><span class="sxs-lookup"><span data-stu-id="2af9e-129">TCP, UDP, ICMP, ESP</span></span> | <span data-ttu-id="2af9e-130">Azure uses the public IP assigned Virtual Machine.</span><span class="sxs-lookup"><span data-stu-id="2af9e-130">Azure uses the public IP assigned Virtual Machine.</span></span> <span data-ttu-id="2af9e-131">The instance has all ephemeral ports available.</span><span class="sxs-lookup"><span data-stu-id="2af9e-131">The instance has all ephemeral ports available.</span></span> | <span data-ttu-id="2af9e-132">No</span><span class="sxs-lookup"><span data-stu-id="2af9e-132">No</span></span> | <span data-ttu-id="2af9e-133">Yes</span><span class="sxs-lookup"><span data-stu-id="2af9e-133">Yes</span></span> |
| [<span data-ttu-id="2af9e-134">2. public load-balanced endpoint</span><span class="sxs-lookup"><span data-stu-id="2af9e-134">2. public load-balanced endpoint</span></span>](#publiclbendpoint) | <span data-ttu-id="2af9e-135">SNAT with port masquerading (PAT) to the public endpoint</span><span class="sxs-lookup"><span data-stu-id="2af9e-135">SNAT with port masquerading (PAT) to the public endpoint</span></span> | <span data-ttu-id="2af9e-136">TCP, UDP</span><span class="sxs-lookup"><span data-stu-id="2af9e-136">TCP, UDP</span></span> | <span data-ttu-id="2af9e-137">Azure shares the public IP address public endpoint with multiple private endpoints.</span><span class="sxs-lookup"><span data-stu-id="2af9e-137">Azure shares the public IP address public endpoint with multiple private endpoints.</span></span> <span data-ttu-id="2af9e-138">Azure uses ephemeral ports of the public endpoint for PAT.</span><span class="sxs-lookup"><span data-stu-id="2af9e-138">Azure uses ephemeral ports of the public endpoint for PAT.</span></span> | <span data-ttu-id="2af9e-139">Yes</span><span class="sxs-lookup"><span data-stu-id="2af9e-139">Yes</span></span> | <span data-ttu-id="2af9e-140">Yes</span><span class="sxs-lookup"><span data-stu-id="2af9e-140">Yes</span></span> |
| [<span data-ttu-id="2af9e-141">3. Standalone VM </span><span class="sxs-lookup"><span data-stu-id="2af9e-141">3. Standalone VM </span></span>](#defaultsnat) | <span data-ttu-id="2af9e-142">SNAT with port masquerading (PAT)</span><span class="sxs-lookup"><span data-stu-id="2af9e-142">SNAT with port masquerading (PAT)</span></span> | <span data-ttu-id="2af9e-143">TCP, UDP</span><span class="sxs-lookup"><span data-stu-id="2af9e-143">TCP, UDP</span></span> | <span data-ttu-id="2af9e-144">Azure automatically designates a public IP address for SNAT, shares this public IP address with the entire deployment, and uses ephemeral ports of the public endpoint IP address for PAT.</span><span class="sxs-lookup"><span data-stu-id="2af9e-144">Azure automatically designates a public IP address for SNAT, shares this public IP address with the entire deployment, and uses ephemeral ports of the public endpoint IP address for PAT.</span></span> <span data-ttu-id="2af9e-145">This is a fallback scenario for the preceding scenarios.</span><span class="sxs-lookup"><span data-stu-id="2af9e-145">This is a fallback scenario for the preceding scenarios.</span></span> <span data-ttu-id="2af9e-146">We don't recommend it if you need visibility and control.</span><span class="sxs-lookup"><span data-stu-id="2af9e-146">We don't recommend it if you need visibility and control.</span></span> | <span data-ttu-id="2af9e-147">Yes</span><span class="sxs-lookup"><span data-stu-id="2af9e-147">Yes</span></span> | <span data-ttu-id="2af9e-148">Yes</span><span class="sxs-lookup"><span data-stu-id="2af9e-148">Yes</span></span> |

<span data-ttu-id="2af9e-149">This is a subset of outbound connection functionality available for Resource Manager deployments in Azure.</span><span class="sxs-lookup"><span data-stu-id="2af9e-149">This is a subset of outbound connection functionality available for Resource Manager deployments in Azure.</span></span>  

<span data-ttu-id="2af9e-150">Different deployments in Classic have different functionality:</span><span class="sxs-lookup"><span data-stu-id="2af9e-150">Different deployments in Classic have different functionality:</span></span>

| <span data-ttu-id="2af9e-151">Classic deployment</span><span class="sxs-lookup"><span data-stu-id="2af9e-151">Classic deployment</span></span> | <span data-ttu-id="2af9e-152">Functionality available</span><span class="sxs-lookup"><span data-stu-id="2af9e-152">Functionality available</span></span> | 
| --- | --- |
| <span data-ttu-id="2af9e-153">Virtual Machine</span><span class="sxs-lookup"><span data-stu-id="2af9e-153">Virtual Machine</span></span> | <span data-ttu-id="2af9e-154">scenario [1](#ilpip), [2](#publiclbendpoint), or [3](#defaultsnat)</span><span class="sxs-lookup"><span data-stu-id="2af9e-154">scenario [1](#ilpip), [2](#publiclbendpoint), or [3](#defaultsnat)</span></span> |
| <span data-ttu-id="2af9e-155">Web Worker Role</span><span class="sxs-lookup"><span data-stu-id="2af9e-155">Web Worker Role</span></span> | <span data-ttu-id="2af9e-156">only scenario [2](#publiclbendpoint), [3](#defaultsnat)</span><span class="sxs-lookup"><span data-stu-id="2af9e-156">only scenario [2](#publiclbendpoint), [3](#defaultsnat)</span></span> | 

<span data-ttu-id="2af9e-157">[Mitigation strategies](#snatexhaust) also have the same differences.</span><span class="sxs-lookup"><span data-stu-id="2af9e-157">[Mitigation strategies](#snatexhaust) also have the same differences.</span></span>

<span data-ttu-id="2af9e-158">The [algorithm used for preallocating ephemeral ports](#ephemeralports) for PAT for classic deployments is the same as for Azure Resource Manager resource deployments.</span><span class="sxs-lookup"><span data-stu-id="2af9e-158">The [algorithm used for preallocating ephemeral ports](#ephemeralports) for PAT for classic deployments is the same as for Azure Resource Manager resource deployments.</span></span>

### <a name="ilpip"></a><span data-ttu-id="2af9e-159">Scenario 1: VM with an Instance Level Public IP address</span><span class="sxs-lookup"><span data-stu-id="2af9e-159">Scenario 1: VM with an Instance Level Public IP address</span></span>

<span data-ttu-id="2af9e-160">In this scenario, the VM has an Instance Level Public IP (ILPIP) assigned to it.</span><span class="sxs-lookup"><span data-stu-id="2af9e-160">In this scenario, the VM has an Instance Level Public IP (ILPIP) assigned to it.</span></span> <span data-ttu-id="2af9e-161">As far as outbound connections are concerned, it doesn't matter whether the VM has  load balanced endpoint or not.</span><span class="sxs-lookup"><span data-stu-id="2af9e-161">As far as outbound connections are concerned, it doesn't matter whether the VM has  load balanced endpoint or not.</span></span> <span data-ttu-id="2af9e-162">This scenario takes precedence over the others.</span><span class="sxs-lookup"><span data-stu-id="2af9e-162">This scenario takes precedence over the others.</span></span> <span data-ttu-id="2af9e-163">When an ILPIP is used, the VM uses the ILPIP for all outbound flows.</span><span class="sxs-lookup"><span data-stu-id="2af9e-163">When an ILPIP is used, the VM uses the ILPIP for all outbound flows.</span></span>  

<span data-ttu-id="2af9e-164">A public IP assigned to a VM is a 1:1 relationship (rather than 1:many) and implemented as a stateless 1:1 NAT.</span><span class="sxs-lookup"><span data-stu-id="2af9e-164">A public IP assigned to a VM is a 1:1 relationship (rather than 1:many) and implemented as a stateless 1:1 NAT.</span></span>  <span data-ttu-id="2af9e-165">Port masquerading (PAT) is not used, and the VM has all ephemeral ports available for use.</span><span class="sxs-lookup"><span data-stu-id="2af9e-165">Port masquerading (PAT) is not used, and the VM has all ephemeral ports available for use.</span></span>

<span data-ttu-id="2af9e-166">If your application initiates many outbound flows and you experience SNAT port exhaustion, consider assigning an [ILPIP to mitigate SNAT constraints](#assignilpip).</span><span class="sxs-lookup"><span data-stu-id="2af9e-166">If your application initiates many outbound flows and you experience SNAT port exhaustion, consider assigning an [ILPIP to mitigate SNAT constraints](#assignilpip).</span></span> <span data-ttu-id="2af9e-167">Review [Managing SNAT exhaustion](#snatexhaust) in its entirety.</span><span class="sxs-lookup"><span data-stu-id="2af9e-167">Review [Managing SNAT exhaustion](#snatexhaust) in its entirety.</span></span>

### <a name="publiclbendpoint"></a><span data-ttu-id="2af9e-168">Scenario 2: Public load-balanced endpoint</span><span class="sxs-lookup"><span data-stu-id="2af9e-168">Scenario 2: Public load-balanced endpoint</span></span>

<span data-ttu-id="2af9e-169">In this scenario, the VM or Web Worker Role is associated with a public IP address through the load-balanced endpoint.</span><span class="sxs-lookup"><span data-stu-id="2af9e-169">In this scenario, the VM or Web Worker Role is associated with a public IP address through the load-balanced endpoint.</span></span> <span data-ttu-id="2af9e-170">The VM does not have a public IP address assigned to it.</span><span class="sxs-lookup"><span data-stu-id="2af9e-170">The VM does not have a public IP address assigned to it.</span></span> 

<span data-ttu-id="2af9e-171">When the load-balanced VM creates an outbound flow, Azure translates the private source IP address of the outbound flow to the public IP address of the public load-balanced endpoint.</span><span class="sxs-lookup"><span data-stu-id="2af9e-171">When the load-balanced VM creates an outbound flow, Azure translates the private source IP address of the outbound flow to the public IP address of the public load-balanced endpoint.</span></span> <span data-ttu-id="2af9e-172">Azure uses SNAT to perform this function.</span><span class="sxs-lookup"><span data-stu-id="2af9e-172">Azure uses SNAT to perform this function.</span></span> <span data-ttu-id="2af9e-173">Azure also uses [PAT](#pat) to masquerade multiple private IP addresses behind a public IP address.</span><span class="sxs-lookup"><span data-stu-id="2af9e-173">Azure also uses [PAT](#pat) to masquerade multiple private IP addresses behind a public IP address.</span></span> 

<span data-ttu-id="2af9e-174">Ephemeral ports of the load balancer's public IP address frontend are used to distinguish individual flows originated by the VM.</span><span class="sxs-lookup"><span data-stu-id="2af9e-174">Ephemeral ports of the load balancer's public IP address frontend are used to distinguish individual flows originated by the VM.</span></span> <span data-ttu-id="2af9e-175">SNAT dynamically uses [preallocated ephemeral ports](#preallocatedports) when outbound flows are created.</span><span class="sxs-lookup"><span data-stu-id="2af9e-175">SNAT dynamically uses [preallocated ephemeral ports](#preallocatedports) when outbound flows are created.</span></span> <span data-ttu-id="2af9e-176">In this context, the ephemeral ports used for SNAT are called SNAT ports.</span><span class="sxs-lookup"><span data-stu-id="2af9e-176">In this context, the ephemeral ports used for SNAT are called SNAT ports.</span></span>

<span data-ttu-id="2af9e-177">SNAT ports are preallocated as described in the [Understanding SNAT and PAT](#snat) section.</span><span class="sxs-lookup"><span data-stu-id="2af9e-177">SNAT ports are preallocated as described in the [Understanding SNAT and PAT](#snat) section.</span></span> <span data-ttu-id="2af9e-178">They're a finite resource that can be exhausted.</span><span class="sxs-lookup"><span data-stu-id="2af9e-178">They're a finite resource that can be exhausted.</span></span> <span data-ttu-id="2af9e-179">It's important to understand how they are [consumed](#pat).</span><span class="sxs-lookup"><span data-stu-id="2af9e-179">It's important to understand how they are [consumed](#pat).</span></span> <span data-ttu-id="2af9e-180">To understand how to design for this consumption and mitigate as necessary, review [Managing SNAT exhaustion](#snatexhaust).</span><span class="sxs-lookup"><span data-stu-id="2af9e-180">To understand how to design for this consumption and mitigate as necessary, review [Managing SNAT exhaustion](#snatexhaust).</span></span>

<span data-ttu-id="2af9e-181">When [multiple public load-balanced endpoints](load-balancer-multivip.md) exist, any of these public IP addresses are a [candidate for outbound flows](#multivipsnat), and one is selected at random.</span><span class="sxs-lookup"><span data-stu-id="2af9e-181">When [multiple public load-balanced endpoints](load-balancer-multivip.md) exist, any of these public IP addresses are a [candidate for outbound flows](#multivipsnat), and one is selected at random.</span></span>  

### <a name="defaultsnat"></a><span data-ttu-id="2af9e-182">Scenario 3: No public IP address associated</span><span class="sxs-lookup"><span data-stu-id="2af9e-182">Scenario 3: No public IP address associated</span></span>

<span data-ttu-id="2af9e-183">In this scenario, the VM or Web Worker ROle is not part of a public load-balanced endpoint.</span><span class="sxs-lookup"><span data-stu-id="2af9e-183">In this scenario, the VM or Web Worker ROle is not part of a public load-balanced endpoint.</span></span>  <span data-ttu-id="2af9e-184">And in the case of VM, it does not have an ILPIP address assigned to it.</span><span class="sxs-lookup"><span data-stu-id="2af9e-184">And in the case of VM, it does not have an ILPIP address assigned to it.</span></span> <span data-ttu-id="2af9e-185">When the VM creates an outbound flow, Azure translates the private source IP address of the outbound flow to a public source IP address.</span><span class="sxs-lookup"><span data-stu-id="2af9e-185">When the VM creates an outbound flow, Azure translates the private source IP address of the outbound flow to a public source IP address.</span></span> <span data-ttu-id="2af9e-186">The public IP address used for this outbound flow is not configurable and does not count against the subscription's public IP resource limit.</span><span class="sxs-lookup"><span data-stu-id="2af9e-186">The public IP address used for this outbound flow is not configurable and does not count against the subscription's public IP resource limit.</span></span>  <span data-ttu-id="2af9e-187">Azure automatically allocates this address.</span><span class="sxs-lookup"><span data-stu-id="2af9e-187">Azure automatically allocates this address.</span></span>

<span data-ttu-id="2af9e-188">Azure uses SNAT with port masquerading ([PAT](#pat)) to perform this function.</span><span class="sxs-lookup"><span data-stu-id="2af9e-188">Azure uses SNAT with port masquerading ([PAT](#pat)) to perform this function.</span></span> <span data-ttu-id="2af9e-189">This scenario is similar to [scenario 2](#lb), except there is no control over the IP address used.</span><span class="sxs-lookup"><span data-stu-id="2af9e-189">This scenario is similar to [scenario 2](#lb), except there is no control over the IP address used.</span></span> <span data-ttu-id="2af9e-190">This is a fallback scenario for when scenarios 1 and 2 do not exist.</span><span class="sxs-lookup"><span data-stu-id="2af9e-190">This is a fallback scenario for when scenarios 1 and 2 do not exist.</span></span> <span data-ttu-id="2af9e-191">We don't recommend this scenario if you want control over the outbound address.</span><span class="sxs-lookup"><span data-stu-id="2af9e-191">We don't recommend this scenario if you want control over the outbound address.</span></span> <span data-ttu-id="2af9e-192">If outbound connections are a critical part of your application, you should chose another scenario.</span><span class="sxs-lookup"><span data-stu-id="2af9e-192">If outbound connections are a critical part of your application, you should chose another scenario.</span></span>

<span data-ttu-id="2af9e-193">SNAT ports are preallocated as described in the [Understanding SNAT and PAT](#snat) section.</span><span class="sxs-lookup"><span data-stu-id="2af9e-193">SNAT ports are preallocated as described in the [Understanding SNAT and PAT](#snat) section.</span></span>  <span data-ttu-id="2af9e-194">The number of VMs or Web Worker Roles sharing the public IP address determines the number of preallocated ephemeral ports.</span><span class="sxs-lookup"><span data-stu-id="2af9e-194">The number of VMs or Web Worker Roles sharing the public IP address determines the number of preallocated ephemeral ports.</span></span>   <span data-ttu-id="2af9e-195">It's important to understand how they are [consumed](#pat).</span><span class="sxs-lookup"><span data-stu-id="2af9e-195">It's important to understand how they are [consumed](#pat).</span></span> <span data-ttu-id="2af9e-196">To understand how to design for this consumption and mitigate as necessary, review [Managing SNAT exhaustion](#snatexhaust).</span><span class="sxs-lookup"><span data-stu-id="2af9e-196">To understand how to design for this consumption and mitigate as necessary, review [Managing SNAT exhaustion](#snatexhaust).</span></span>

## <a name="snat"></a><span data-ttu-id="2af9e-197">Understanding SNAT and PAT</span><span class="sxs-lookup"><span data-stu-id="2af9e-197">Understanding SNAT and PAT</span></span>

### <a name="pat"></a><span data-ttu-id="2af9e-198">Port masquerading SNAT (PAT)</span><span class="sxs-lookup"><span data-stu-id="2af9e-198">Port masquerading SNAT (PAT)</span></span>

<span data-ttu-id="2af9e-199">When a deployment makes an outbound connection, each outbound connection source is rewritten.</span><span class="sxs-lookup"><span data-stu-id="2af9e-199">When a deployment makes an outbound connection, each outbound connection source is rewritten.</span></span> <span data-ttu-id="2af9e-200">The source is rewritten from the private IP address space to the public IP associated with the deployment (based on scenarios described above).</span><span class="sxs-lookup"><span data-stu-id="2af9e-200">The source is rewritten from the private IP address space to the public IP associated with the deployment (based on scenarios described above).</span></span> <span data-ttu-id="2af9e-201">In the public IP address space, the 5-tuple of the flow (source IP address, source port, IP transport protocol, destination IP address, destination port) must be unique.</span><span class="sxs-lookup"><span data-stu-id="2af9e-201">In the public IP address space, the 5-tuple of the flow (source IP address, source port, IP transport protocol, destination IP address, destination port) must be unique.</span></span>  

<span data-ttu-id="2af9e-202">Ephemeral ports (SNAT ports) are used to achieve this after rewriting the private source IP address, because multiple flows originate from a single public IP address.</span><span class="sxs-lookup"><span data-stu-id="2af9e-202">Ephemeral ports (SNAT ports) are used to achieve this after rewriting the private source IP address, because multiple flows originate from a single public IP address.</span></span> 

<span data-ttu-id="2af9e-203">One SNAT port is consumed per flow to a single destination IP address, port, and protocol.</span><span class="sxs-lookup"><span data-stu-id="2af9e-203">One SNAT port is consumed per flow to a single destination IP address, port, and protocol.</span></span> <span data-ttu-id="2af9e-204">For multiple flows to the same destination IP address, port, and protocol, each flow consumes a single SNAT port.</span><span class="sxs-lookup"><span data-stu-id="2af9e-204">For multiple flows to the same destination IP address, port, and protocol, each flow consumes a single SNAT port.</span></span> <span data-ttu-id="2af9e-205">This ensures that the flows are unique when they originate from the same public IP address and go to the same destination IP address, port, and protocol.</span><span class="sxs-lookup"><span data-stu-id="2af9e-205">This ensures that the flows are unique when they originate from the same public IP address and go to the same destination IP address, port, and protocol.</span></span> 

<span data-ttu-id="2af9e-206">Multiple flows, each to a different destination IP address, port, and protocol, share a single SNAT port.</span><span class="sxs-lookup"><span data-stu-id="2af9e-206">Multiple flows, each to a different destination IP address, port, and protocol, share a single SNAT port.</span></span> <span data-ttu-id="2af9e-207">The destination IP address, port, and protocol make flows unique without the need for additional source ports to distinguish flows in the public IP address space.</span><span class="sxs-lookup"><span data-stu-id="2af9e-207">The destination IP address, port, and protocol make flows unique without the need for additional source ports to distinguish flows in the public IP address space.</span></span>

<span data-ttu-id="2af9e-208">When SNAT port resources are exhausted, outbound flows fail until existing flows release SNAT ports.</span><span class="sxs-lookup"><span data-stu-id="2af9e-208">When SNAT port resources are exhausted, outbound flows fail until existing flows release SNAT ports.</span></span> <span data-ttu-id="2af9e-209">Load Balancer reclaims SNAT ports when the flow closes and uses a [4-minute idle timeout](#idletimeout) for reclaiming SNAT ports from idle flows.</span><span class="sxs-lookup"><span data-stu-id="2af9e-209">Load Balancer reclaims SNAT ports when the flow closes and uses a [4-minute idle timeout](#idletimeout) for reclaiming SNAT ports from idle flows.</span></span>

<span data-ttu-id="2af9e-210">For patterns to mitigate conditions that commonly lead to SNAT port exhaustion, review the [Managing SNAT](#snatexhaust) section.</span><span class="sxs-lookup"><span data-stu-id="2af9e-210">For patterns to mitigate conditions that commonly lead to SNAT port exhaustion, review the [Managing SNAT](#snatexhaust) section.</span></span>

### <a name="preallocatedports"></a><span data-ttu-id="2af9e-211">Ephemeral port preallocation for port masquerading SNAT (PAT)</span><span class="sxs-lookup"><span data-stu-id="2af9e-211">Ephemeral port preallocation for port masquerading SNAT (PAT)</span></span>

<span data-ttu-id="2af9e-212">Azure uses an algorithm to determine the number of preallocated SNAT ports available based on the size of the backend pool when using port masquerading SNAT ([PAT](#pat)).</span><span class="sxs-lookup"><span data-stu-id="2af9e-212">Azure uses an algorithm to determine the number of preallocated SNAT ports available based on the size of the backend pool when using port masquerading SNAT ([PAT](#pat)).</span></span> <span data-ttu-id="2af9e-213">SNAT ports are ephemeral ports available for a particular public IP source address.</span><span class="sxs-lookup"><span data-stu-id="2af9e-213">SNAT ports are ephemeral ports available for a particular public IP source address.</span></span>

<span data-ttu-id="2af9e-214">Azure preallocates SNAT ports when an instance is deployed based on how many VM or Web Worker Role instances share a given public IP address.</span><span class="sxs-lookup"><span data-stu-id="2af9e-214">Azure preallocates SNAT ports when an instance is deployed based on how many VM or Web Worker Role instances share a given public IP address.</span></span>  <span data-ttu-id="2af9e-215">When outbound flows are created, [PAT](#pat) dynamically consumes (up to the preallocated limit) and releases these ports when the flow closes or [idle timeouts](#ideltimeout) happen.</span><span class="sxs-lookup"><span data-stu-id="2af9e-215">When outbound flows are created, [PAT](#pat) dynamically consumes (up to the preallocated limit) and releases these ports when the flow closes or [idle timeouts](#ideltimeout) happen.</span></span>

<span data-ttu-id="2af9e-216">The following table shows the SNAT port preallocations for tiers of backend pool sizes:</span><span class="sxs-lookup"><span data-stu-id="2af9e-216">The following table shows the SNAT port preallocations for tiers of backend pool sizes:</span></span>

| <span data-ttu-id="2af9e-217">Instances</span><span class="sxs-lookup"><span data-stu-id="2af9e-217">Instances</span></span> | <span data-ttu-id="2af9e-218">Preallocated SNAT ports per instance</span><span class="sxs-lookup"><span data-stu-id="2af9e-218">Preallocated SNAT ports per instance</span></span> |
| --- | --- |
| <span data-ttu-id="2af9e-219">1-50</span><span class="sxs-lookup"><span data-stu-id="2af9e-219">1-50</span></span> | <span data-ttu-id="2af9e-220">1,024</span><span class="sxs-lookup"><span data-stu-id="2af9e-220">1,024</span></span> |
| <span data-ttu-id="2af9e-221">51-100</span><span class="sxs-lookup"><span data-stu-id="2af9e-221">51-100</span></span> | <span data-ttu-id="2af9e-222">512</span><span class="sxs-lookup"><span data-stu-id="2af9e-222">512</span></span> |
| <span data-ttu-id="2af9e-223">101-200</span><span class="sxs-lookup"><span data-stu-id="2af9e-223">101-200</span></span> | <span data-ttu-id="2af9e-224">256</span><span class="sxs-lookup"><span data-stu-id="2af9e-224">256</span></span> |
| <span data-ttu-id="2af9e-225">201-400</span><span class="sxs-lookup"><span data-stu-id="2af9e-225">201-400</span></span> | <span data-ttu-id="2af9e-226">128</span><span class="sxs-lookup"><span data-stu-id="2af9e-226">128</span></span> |

<span data-ttu-id="2af9e-227">Remember that the number of SNAT ports available does not translate directly to number of flows.</span><span class="sxs-lookup"><span data-stu-id="2af9e-227">Remember that the number of SNAT ports available does not translate directly to number of flows.</span></span> <span data-ttu-id="2af9e-228">A single SNAT port can be reused for multiple unique destinations.</span><span class="sxs-lookup"><span data-stu-id="2af9e-228">A single SNAT port can be reused for multiple unique destinations.</span></span> <span data-ttu-id="2af9e-229">Ports are consumed only if it's necessary to make flows unique.</span><span class="sxs-lookup"><span data-stu-id="2af9e-229">Ports are consumed only if it's necessary to make flows unique.</span></span> <span data-ttu-id="2af9e-230">For design and mitigation guidance, refer to the section about [how to manage this exhaustible resource](#snatexhaust) and the section that describes [PAT](#pat).</span><span class="sxs-lookup"><span data-stu-id="2af9e-230">For design and mitigation guidance, refer to the section about [how to manage this exhaustible resource](#snatexhaust) and the section that describes [PAT](#pat).</span></span>

<span data-ttu-id="2af9e-231">Changing the size of your deployment might affect some of your established flows.</span><span class="sxs-lookup"><span data-stu-id="2af9e-231">Changing the size of your deployment might affect some of your established flows.</span></span> <span data-ttu-id="2af9e-232">If the backend pool size increases and transitions into the next tier, half of your preallocated SNAT ports are reclaimed during the transition to the next larger backend pool tier.</span><span class="sxs-lookup"><span data-stu-id="2af9e-232">If the backend pool size increases and transitions into the next tier, half of your preallocated SNAT ports are reclaimed during the transition to the next larger backend pool tier.</span></span> <span data-ttu-id="2af9e-233">Flows that are associated with a reclaimed SNAT port will time out and must be reestablished.</span><span class="sxs-lookup"><span data-stu-id="2af9e-233">Flows that are associated with a reclaimed SNAT port will time out and must be reestablished.</span></span> <span data-ttu-id="2af9e-234">If a new flow is attempted, the flow will succeed immediately as long as preallocated ports are available.</span><span class="sxs-lookup"><span data-stu-id="2af9e-234">If a new flow is attempted, the flow will succeed immediately as long as preallocated ports are available.</span></span>

<span data-ttu-id="2af9e-235">If the deployment size decreases and transitions into a lower tier, the number of available SNAT ports increases.</span><span class="sxs-lookup"><span data-stu-id="2af9e-235">If the deployment size decreases and transitions into a lower tier, the number of available SNAT ports increases.</span></span> <span data-ttu-id="2af9e-236">In this case, existing allocated SNAT ports and their respective flows are not affected.</span><span class="sxs-lookup"><span data-stu-id="2af9e-236">In this case, existing allocated SNAT ports and their respective flows are not affected.</span></span>

<span data-ttu-id="2af9e-237">If a cloud service is redeployed or changed, the infrastructure may temporarily report the backend pool to be up to twice as large as actual and Azure will in turn preallocate less SNAT ports per instance than expected.</span><span class="sxs-lookup"><span data-stu-id="2af9e-237">If a cloud service is redeployed or changed, the infrastructure may temporarily report the backend pool to be up to twice as large as actual and Azure will in turn preallocate less SNAT ports per instance than expected.</span></span>  <span data-ttu-id="2af9e-238">This can temporarily increase the probability of SNAT port exhaustion.</span><span class="sxs-lookup"><span data-stu-id="2af9e-238">This can temporarily increase the probability of SNAT port exhaustion.</span></span> <span data-ttu-id="2af9e-239">Eventually the pool size will transition to actual size and Azure will automatically increase preallocated SNAT ports to the expected number as per the table above.</span><span class="sxs-lookup"><span data-stu-id="2af9e-239">Eventually the pool size will transition to actual size and Azure will automatically increase preallocated SNAT ports to the expected number as per the table above.</span></span>  <span data-ttu-id="2af9e-240">This behavior is by design and is not configurable.</span><span class="sxs-lookup"><span data-stu-id="2af9e-240">This behavior is by design and is not configurable.</span></span>

<span data-ttu-id="2af9e-241">SNAT ports allocations are IP transport protocol specific (TCP and UDP are maintained separately) and are released under the following conditions:</span><span class="sxs-lookup"><span data-stu-id="2af9e-241">SNAT ports allocations are IP transport protocol specific (TCP and UDP are maintained separately) and are released under the following conditions:</span></span>

### <a name="tcp-snat-port-release"></a><span data-ttu-id="2af9e-242">TCP SNAT port release</span><span class="sxs-lookup"><span data-stu-id="2af9e-242">TCP SNAT port release</span></span>

- <span data-ttu-id="2af9e-243">If both server/client sends FIN/ACK, SNAT port will be released after 240 seconds.</span><span class="sxs-lookup"><span data-stu-id="2af9e-243">If both server/client sends FIN/ACK, SNAT port will be released after 240 seconds.</span></span>
- <span data-ttu-id="2af9e-244">If a RST is seen, SNAT port will be released after 15 seconds.</span><span class="sxs-lookup"><span data-stu-id="2af9e-244">If a RST is seen, SNAT port will be released after 15 seconds.</span></span>
- <span data-ttu-id="2af9e-245">idle timeout has been reached</span><span class="sxs-lookup"><span data-stu-id="2af9e-245">idle timeout has been reached</span></span>

### <a name="udp-snat-port-release"></a><span data-ttu-id="2af9e-246">UDP SNAT port release</span><span class="sxs-lookup"><span data-stu-id="2af9e-246">UDP SNAT port release</span></span>

- <span data-ttu-id="2af9e-247">idle timeout has been reached</span><span class="sxs-lookup"><span data-stu-id="2af9e-247">idle timeout has been reached</span></span>

## <a name="problemsolving"></a> <span data-ttu-id="2af9e-248">Problem solving</span><span class="sxs-lookup"><span data-stu-id="2af9e-248">Problem solving</span></span> 

<span data-ttu-id="2af9e-249">This section is intended to help mitigate SNAT exhaustion and other scenarios which can occur with outbound connections in Azure.</span><span class="sxs-lookup"><span data-stu-id="2af9e-249">This section is intended to help mitigate SNAT exhaustion and other scenarios which can occur with outbound connections in Azure.</span></span>

### <a name="snatexhaust"></a> <span data-ttu-id="2af9e-250">Managing SNAT (PAT) port exhaustion</span><span class="sxs-lookup"><span data-stu-id="2af9e-250">Managing SNAT (PAT) port exhaustion</span></span>
<span data-ttu-id="2af9e-251">[Ephemeral ports](#preallocatedports) used for [PAT](#pat) are an exhaustible resource, as described in [no public IP associated](#defaultsnat) and [public load-balanced endpoint](#publiclbendpoint).</span><span class="sxs-lookup"><span data-stu-id="2af9e-251">[Ephemeral ports](#preallocatedports) used for [PAT](#pat) are an exhaustible resource, as described in [no public IP associated](#defaultsnat) and [public load-balanced endpoint](#publiclbendpoint).</span></span>

<span data-ttu-id="2af9e-252">If you know that you're initiating many outbound TCP or UDP connections to the same destination IP address and port, and you observe failing outbound connections or are advised by support that you're exhausting SNAT ports (preallocated [ephemeral ports](#preallocatedports) used by [PAT](#pat)), you have several general mitigation options.</span><span class="sxs-lookup"><span data-stu-id="2af9e-252">If you know that you're initiating many outbound TCP or UDP connections to the same destination IP address and port, and you observe failing outbound connections or are advised by support that you're exhausting SNAT ports (preallocated [ephemeral ports](#preallocatedports) used by [PAT](#pat)), you have several general mitigation options.</span></span> <span data-ttu-id="2af9e-253">Review these options and decide what is available and best for your scenario.</span><span class="sxs-lookup"><span data-stu-id="2af9e-253">Review these options and decide what is available and best for your scenario.</span></span> <span data-ttu-id="2af9e-254">It's possible that one or more can help manage this scenario.</span><span class="sxs-lookup"><span data-stu-id="2af9e-254">It's possible that one or more can help manage this scenario.</span></span>

<span data-ttu-id="2af9e-255">If you are having trouble understanding the outbound connection behavior, you can use IP stack statistics (netstat).</span><span class="sxs-lookup"><span data-stu-id="2af9e-255">If you are having trouble understanding the outbound connection behavior, you can use IP stack statistics (netstat).</span></span> <span data-ttu-id="2af9e-256">Or it can be helpful to observe connection behaviors by using packet captures.</span><span class="sxs-lookup"><span data-stu-id="2af9e-256">Or it can be helpful to observe connection behaviors by using packet captures.</span></span>

#### <a name="connectionreuse"></a><span data-ttu-id="2af9e-257">Modify the application to reuse connections</span><span class="sxs-lookup"><span data-stu-id="2af9e-257">Modify the application to reuse connections</span></span> 
<span data-ttu-id="2af9e-258">You can reduce demand for ephemeral ports that are used for SNAT by reusing connections in your application.</span><span class="sxs-lookup"><span data-stu-id="2af9e-258">You can reduce demand for ephemeral ports that are used for SNAT by reusing connections in your application.</span></span> <span data-ttu-id="2af9e-259">This is especially true for protocols like HTTP/1.1, where connection reuse is the default.</span><span class="sxs-lookup"><span data-stu-id="2af9e-259">This is especially true for protocols like HTTP/1.1, where connection reuse is the default.</span></span> <span data-ttu-id="2af9e-260">And other protocols that use HTTP as their transport (for example, REST) can benefit in turn.</span><span class="sxs-lookup"><span data-stu-id="2af9e-260">And other protocols that use HTTP as their transport (for example, REST) can benefit in turn.</span></span> 

<span data-ttu-id="2af9e-261">Reuse is always better than individual, atomic TCP connections for each request.</span><span class="sxs-lookup"><span data-stu-id="2af9e-261">Reuse is always better than individual, atomic TCP connections for each request.</span></span> <span data-ttu-id="2af9e-262">Reuse results in more performant, very efficient TCP transactions.</span><span class="sxs-lookup"><span data-stu-id="2af9e-262">Reuse results in more performant, very efficient TCP transactions.</span></span>

#### <a name="connection pooling"></a><span data-ttu-id="2af9e-263">Modify the application to use connection pooling</span><span class="sxs-lookup"><span data-stu-id="2af9e-263">Modify the application to use connection pooling</span></span>
<span data-ttu-id="2af9e-264">You can employ a connection pooling scheme in your application, where requests are internally distributed across a fixed set of connections (each reusing where possible).</span><span class="sxs-lookup"><span data-stu-id="2af9e-264">You can employ a connection pooling scheme in your application, where requests are internally distributed across a fixed set of connections (each reusing where possible).</span></span> <span data-ttu-id="2af9e-265">This scheme constrains the number of ephemeral ports in use and creates a more predictable environment.</span><span class="sxs-lookup"><span data-stu-id="2af9e-265">This scheme constrains the number of ephemeral ports in use and creates a more predictable environment.</span></span> <span data-ttu-id="2af9e-266">This scheme can also increase the throughput of requests by allowing multiple simultaneous operations when a single connection is blocking on the reply of an operation.</span><span class="sxs-lookup"><span data-stu-id="2af9e-266">This scheme can also increase the throughput of requests by allowing multiple simultaneous operations when a single connection is blocking on the reply of an operation.</span></span>  

<span data-ttu-id="2af9e-267">Connection pooling might already exist within the framework that you're using to develop your application or the configuration settings for your application.</span><span class="sxs-lookup"><span data-stu-id="2af9e-267">Connection pooling might already exist within the framework that you're using to develop your application or the configuration settings for your application.</span></span> <span data-ttu-id="2af9e-268">You can combine connection pooling with connection reuse.</span><span class="sxs-lookup"><span data-stu-id="2af9e-268">You can combine connection pooling with connection reuse.</span></span> <span data-ttu-id="2af9e-269">Your multiple requests then consume a fixed, predictable number of ports to the same destination IP address and port.</span><span class="sxs-lookup"><span data-stu-id="2af9e-269">Your multiple requests then consume a fixed, predictable number of ports to the same destination IP address and port.</span></span> <span data-ttu-id="2af9e-270">The requests also benefit from efficient use of TCP transactions reducing latency and resource utilization.</span><span class="sxs-lookup"><span data-stu-id="2af9e-270">The requests also benefit from efficient use of TCP transactions reducing latency and resource utilization.</span></span> <span data-ttu-id="2af9e-271">UDP transactions can also benefit, because managing the number of UDP flows can in turn avoid exhaust conditions and manage the SNAT port utilization.</span><span class="sxs-lookup"><span data-stu-id="2af9e-271">UDP transactions can also benefit, because managing the number of UDP flows can in turn avoid exhaust conditions and manage the SNAT port utilization.</span></span>

#### <a name="retry logic"></a><span data-ttu-id="2af9e-272">Modify the application to use less aggressive retry logic</span><span class="sxs-lookup"><span data-stu-id="2af9e-272">Modify the application to use less aggressive retry logic</span></span>
<span data-ttu-id="2af9e-273">When [preallocated ephemeral ports](#preallocatedports) used for [PAT](#pat) are exhausted or application failures occur, aggressive or brute force retries without decay and backoff logic cause exhaustion to occur or persist.</span><span class="sxs-lookup"><span data-stu-id="2af9e-273">When [preallocated ephemeral ports](#preallocatedports) used for [PAT](#pat) are exhausted or application failures occur, aggressive or brute force retries without decay and backoff logic cause exhaustion to occur or persist.</span></span> <span data-ttu-id="2af9e-274">You can reduce demand for ephemeral ports by using a less aggressive retry logic.</span><span class="sxs-lookup"><span data-stu-id="2af9e-274">You can reduce demand for ephemeral ports by using a less aggressive retry logic.</span></span> 

<span data-ttu-id="2af9e-275">Ephemeral ports have a 4-minute idle timeout (not adjustable).</span><span class="sxs-lookup"><span data-stu-id="2af9e-275">Ephemeral ports have a 4-minute idle timeout (not adjustable).</span></span> <span data-ttu-id="2af9e-276">If the retries are too aggressive, the exhaustion has no opportunity to clear up on its own.</span><span class="sxs-lookup"><span data-stu-id="2af9e-276">If the retries are too aggressive, the exhaustion has no opportunity to clear up on its own.</span></span> <span data-ttu-id="2af9e-277">Therefore, considering how--and how often--your application retries transactions is a critical part of the design.</span><span class="sxs-lookup"><span data-stu-id="2af9e-277">Therefore, considering how--and how often--your application retries transactions is a critical part of the design.</span></span>

#### <a name="assignilpip"></a><span data-ttu-id="2af9e-278">Assign an Instance Level Public IP to each VM</span><span class="sxs-lookup"><span data-stu-id="2af9e-278">Assign an Instance Level Public IP to each VM</span></span>
<span data-ttu-id="2af9e-279">Assigning an ILPIP changes your scenario to [Instance Level Public IP to a VM](#ilpip).</span><span class="sxs-lookup"><span data-stu-id="2af9e-279">Assigning an ILPIP changes your scenario to [Instance Level Public IP to a VM](#ilpip).</span></span> <span data-ttu-id="2af9e-280">All ephemeral ports of the public IP that are used for each VM are available to the VM.</span><span class="sxs-lookup"><span data-stu-id="2af9e-280">All ephemeral ports of the public IP that are used for each VM are available to the VM.</span></span> <span data-ttu-id="2af9e-281">(As opposed to scenarios where ephemeral ports of a public IP are shared with all the VMs associated with the respective deployment.) There are trade-offs to consider, such as the potential impact of whitelisting a large number of individual IP addresses.</span><span class="sxs-lookup"><span data-stu-id="2af9e-281">(As opposed to scenarios where ephemeral ports of a public IP are shared with all the VMs associated with the respective deployment.) There are trade-offs to consider, such as the potential impact of whitelisting a large number of individual IP addresses.</span></span>

>[!NOTE] 
><span data-ttu-id="2af9e-282">This option is not available for web worker roles.</span><span class="sxs-lookup"><span data-stu-id="2af9e-282">This option is not available for web worker roles.</span></span>

### <a name="idletimeout"></a><span data-ttu-id="2af9e-283">Use keepalives to reset the outbound idle timeout</span><span class="sxs-lookup"><span data-stu-id="2af9e-283">Use keepalives to reset the outbound idle timeout</span></span>

<span data-ttu-id="2af9e-284">Outbound connections have a 4-minute idle timeout.</span><span class="sxs-lookup"><span data-stu-id="2af9e-284">Outbound connections have a 4-minute idle timeout.</span></span> <span data-ttu-id="2af9e-285">This timeout is not adjustable.</span><span class="sxs-lookup"><span data-stu-id="2af9e-285">This timeout is not adjustable.</span></span> <span data-ttu-id="2af9e-286">However, you can use transport (for example, TCP keepalives) or application-layer keepalives to refresh an idle flow and reset this idle timeout if necessary.</span><span class="sxs-lookup"><span data-stu-id="2af9e-286">However, you can use transport (for example, TCP keepalives) or application-layer keepalives to refresh an idle flow and reset this idle timeout if necessary.</span></span>  <span data-ttu-id="2af9e-287">Check with the supplier of any packaged software on whether this is supported or how to enable it.</span><span class="sxs-lookup"><span data-stu-id="2af9e-287">Check with the supplier of any packaged software on whether this is supported or how to enable it.</span></span>  <span data-ttu-id="2af9e-288">Generally only one side needs to generate keepalives to reset the idle timeout.</span><span class="sxs-lookup"><span data-stu-id="2af9e-288">Generally only one side needs to generate keepalives to reset the idle timeout.</span></span> 

## <a name="discoveroutbound"></a><span data-ttu-id="2af9e-289">Discovering the public IP that a VM uses</span><span class="sxs-lookup"><span data-stu-id="2af9e-289">Discovering the public IP that a VM uses</span></span>
<span data-ttu-id="2af9e-290">There are many ways to determine the public source IP address of an outbound connection.</span><span class="sxs-lookup"><span data-stu-id="2af9e-290">There are many ways to determine the public source IP address of an outbound connection.</span></span> <span data-ttu-id="2af9e-291">OpenDNS provides a service that can show you the public IP address of your VM.</span><span class="sxs-lookup"><span data-stu-id="2af9e-291">OpenDNS provides a service that can show you the public IP address of your VM.</span></span> 

<span data-ttu-id="2af9e-292">By using the nslookup command, you can send a DNS query for the name myip.opendns.com to the OpenDNS resolver.</span><span class="sxs-lookup"><span data-stu-id="2af9e-292">By using the nslookup command, you can send a DNS query for the name myip.opendns.com to the OpenDNS resolver.</span></span> <span data-ttu-id="2af9e-293">The service returns the source IP address that was used to send the query.</span><span class="sxs-lookup"><span data-stu-id="2af9e-293">The service returns the source IP address that was used to send the query.</span></span> <span data-ttu-id="2af9e-294">When you run the following query from your VM, the response is the public IP used for that VM:</span><span class="sxs-lookup"><span data-stu-id="2af9e-294">When you run the following query from your VM, the response is the public IP used for that VM:</span></span>

    nslookup myip.opendns.com resolver1.opendns.com


## <a name="next-steps"></a><span data-ttu-id="2af9e-295">Next steps</span><span class="sxs-lookup"><span data-stu-id="2af9e-295">Next steps</span></span>

- <span data-ttu-id="2af9e-296">Learn more about [Load Balancer](load-balancer-overview.md) used in Resource Manager deployments.</span><span class="sxs-lookup"><span data-stu-id="2af9e-296">Learn more about [Load Balancer](load-balancer-overview.md) used in Resource Manager deployments.</span></span>
- <span data-ttu-id="2af9e-297">Learn mode about [outbound connection](load-balancer-outbound-connections.md) scenarios available in Resource Manager deployments.</span><span class="sxs-lookup"><span data-stu-id="2af9e-297">Learn mode about [outbound connection](load-balancer-outbound-connections.md) scenarios available in Resource Manager deployments.</span></span>
