---
title: Multiple Frontends for Azure Load Balancer | Microsoft Docs
description: Overview of Multiple Frontends on Azure Load Balancer
services: load-balancer
documentationcenter: na
author: chkuhtz
manager: narayan
editor: ''
ms.assetid: 748e50cd-3087-4c2e-a9e1-ac0ecce4f869
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/22/2018
ms.author: chkuhtz
ms.openlocfilehash: cf8fa396e0518e1c847225dfc1d8f91c3421bd11
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44825591"
---
# <a name="multiple-frontends-for-azure-load-balancer"></a><span data-ttu-id="6517b-103">Multiple Frontends for Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="6517b-103">Multiple Frontends for Azure Load Balancer</span></span>

<span data-ttu-id="6517b-104">Azure Load Balancer allows you to load balance services on multiple ports, multiple IP addresses, or both.</span><span class="sxs-lookup"><span data-stu-id="6517b-104">Azure Load Balancer allows you to load balance services on multiple ports, multiple IP addresses, or both.</span></span> <span data-ttu-id="6517b-105">You can use public and internal load balancer definitions to load balance flows across a set of VMs.</span><span class="sxs-lookup"><span data-stu-id="6517b-105">You can use public and internal load balancer definitions to load balance flows across a set of VMs.</span></span>

<span data-ttu-id="6517b-106">This article describes the fundamentals of this ability, important concepts, and constraints.</span><span class="sxs-lookup"><span data-stu-id="6517b-106">This article describes the fundamentals of this ability, important concepts, and constraints.</span></span> <span data-ttu-id="6517b-107">If you only intend to expose services on one IP address, you can find simplified instructions for [public](load-balancer-get-started-internet-portal.md) or [internal](load-balancer-get-started-ilb-arm-portal.md) load balancer configurations.</span><span class="sxs-lookup"><span data-stu-id="6517b-107">If you only intend to expose services on one IP address, you can find simplified instructions for [public](load-balancer-get-started-internet-portal.md) or [internal](load-balancer-get-started-ilb-arm-portal.md) load balancer configurations.</span></span> <span data-ttu-id="6517b-108">Adding multiple frontends is incremental to a single frontend configuration.</span><span class="sxs-lookup"><span data-stu-id="6517b-108">Adding multiple frontends is incremental to a single frontend configuration.</span></span> <span data-ttu-id="6517b-109">Using the concepts in this article, you can expand a simplified configuration at any time.</span><span class="sxs-lookup"><span data-stu-id="6517b-109">Using the concepts in this article, you can expand a simplified configuration at any time.</span></span>

<span data-ttu-id="6517b-110">When you define an Azure Load Balancer, a frontend and a backend pool configuration are connected with rules.</span><span class="sxs-lookup"><span data-stu-id="6517b-110">When you define an Azure Load Balancer, a frontend and a backend pool configuration are connected with rules.</span></span> <span data-ttu-id="6517b-111">The health probe referenced by the rule is used to determine how new flows are sent to a node in the backend pool.</span><span class="sxs-lookup"><span data-stu-id="6517b-111">The health probe referenced by the rule is used to determine how new flows are sent to a node in the backend pool.</span></span> <span data-ttu-id="6517b-112">The frontend (aka VIP) is defined by a 3-tuple comprised of an IP address (public or internal), a transport protocol (UDP or TCP), and a port number from the load balancing rule.</span><span class="sxs-lookup"><span data-stu-id="6517b-112">The frontend (aka VIP) is defined by a 3-tuple comprised of an IP address (public or internal), a transport protocol (UDP or TCP), and a port number from the load balancing rule.</span></span> <span data-ttu-id="6517b-113">The backend pool is a collection of Virtual Machine IP configurations (part of the NIC resource) which reference the Load Balancer backend pool.</span><span class="sxs-lookup"><span data-stu-id="6517b-113">The backend pool is a collection of Virtual Machine IP configurations (part of the NIC resource) which reference the Load Balancer backend pool.</span></span>

<span data-ttu-id="6517b-114">The following table contains some example frontend configurations:</span><span class="sxs-lookup"><span data-stu-id="6517b-114">The following table contains some example frontend configurations:</span></span>

| <span data-ttu-id="6517b-115">Frontend</span><span class="sxs-lookup"><span data-stu-id="6517b-115">Frontend</span></span> | <span data-ttu-id="6517b-116">IP address</span><span class="sxs-lookup"><span data-stu-id="6517b-116">IP address</span></span> | <span data-ttu-id="6517b-117">protocol</span><span class="sxs-lookup"><span data-stu-id="6517b-117">protocol</span></span> | <span data-ttu-id="6517b-118">port</span><span class="sxs-lookup"><span data-stu-id="6517b-118">port</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="6517b-119">1</span><span class="sxs-lookup"><span data-stu-id="6517b-119">1</span></span> |<span data-ttu-id="6517b-120">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="6517b-120">65.52.0.1</span></span> |<span data-ttu-id="6517b-121">TCP</span><span class="sxs-lookup"><span data-stu-id="6517b-121">TCP</span></span> |<span data-ttu-id="6517b-122">80</span><span class="sxs-lookup"><span data-stu-id="6517b-122">80</span></span> |
| <span data-ttu-id="6517b-123">2</span><span class="sxs-lookup"><span data-stu-id="6517b-123">2</span></span> |<span data-ttu-id="6517b-124">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="6517b-124">65.52.0.1</span></span> |<span data-ttu-id="6517b-125">TCP</span><span class="sxs-lookup"><span data-stu-id="6517b-125">TCP</span></span> |<span data-ttu-id="6517b-126">*8080*</span><span class="sxs-lookup"><span data-stu-id="6517b-126">*8080*</span></span> |
| <span data-ttu-id="6517b-127">3</span><span class="sxs-lookup"><span data-stu-id="6517b-127">3</span></span> |<span data-ttu-id="6517b-128">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="6517b-128">65.52.0.1</span></span> |<span data-ttu-id="6517b-129">*UDP*</span><span class="sxs-lookup"><span data-stu-id="6517b-129">*UDP*</span></span> |<span data-ttu-id="6517b-130">80</span><span class="sxs-lookup"><span data-stu-id="6517b-130">80</span></span> |
| <span data-ttu-id="6517b-131">4</span><span class="sxs-lookup"><span data-stu-id="6517b-131">4</span></span> |<span data-ttu-id="6517b-132">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="6517b-132">*65.52.0.2*</span></span> |<span data-ttu-id="6517b-133">TCP</span><span class="sxs-lookup"><span data-stu-id="6517b-133">TCP</span></span> |<span data-ttu-id="6517b-134">80</span><span class="sxs-lookup"><span data-stu-id="6517b-134">80</span></span> |

<span data-ttu-id="6517b-135">The table shows four different frontends.</span><span class="sxs-lookup"><span data-stu-id="6517b-135">The table shows four different frontends.</span></span> <span data-ttu-id="6517b-136">Frontends #1, #2 and #3 are a single frontend with multiple rules.</span><span class="sxs-lookup"><span data-stu-id="6517b-136">Frontends #1, #2 and #3 are a single frontend with multiple rules.</span></span> <span data-ttu-id="6517b-137">The same IP address is used but the port or protocol is different for each frontend.</span><span class="sxs-lookup"><span data-stu-id="6517b-137">The same IP address is used but the port or protocol is different for each frontend.</span></span> <span data-ttu-id="6517b-138">Frontends #1 and #4 are an example of multiple frontends, where the same frontend protocol and port are reused across multiple frontends.</span><span class="sxs-lookup"><span data-stu-id="6517b-138">Frontends #1 and #4 are an example of multiple frontends, where the same frontend protocol and port are reused across multiple frontends.</span></span>

<span data-ttu-id="6517b-139">Azure Load Balancer provides flexibility in defining the load balancing rules.</span><span class="sxs-lookup"><span data-stu-id="6517b-139">Azure Load Balancer provides flexibility in defining the load balancing rules.</span></span> <span data-ttu-id="6517b-140">A rule declares how an address and port on the frontend is mapped to the destination address and port on the backend.</span><span class="sxs-lookup"><span data-stu-id="6517b-140">A rule declares how an address and port on the frontend is mapped to the destination address and port on the backend.</span></span> <span data-ttu-id="6517b-141">Whether or not backend ports are reused across rules depends on the type of the rule.</span><span class="sxs-lookup"><span data-stu-id="6517b-141">Whether or not backend ports are reused across rules depends on the type of the rule.</span></span> <span data-ttu-id="6517b-142">Each type of rule has specific requirements that can affect host configuration and probe design.</span><span class="sxs-lookup"><span data-stu-id="6517b-142">Each type of rule has specific requirements that can affect host configuration and probe design.</span></span> <span data-ttu-id="6517b-143">There are two types of rules:</span><span class="sxs-lookup"><span data-stu-id="6517b-143">There are two types of rules:</span></span>

1. <span data-ttu-id="6517b-144">The default rule with no backend port reuse</span><span class="sxs-lookup"><span data-stu-id="6517b-144">The default rule with no backend port reuse</span></span>
2. <span data-ttu-id="6517b-145">The Floating IP rule where backend ports are reused</span><span class="sxs-lookup"><span data-stu-id="6517b-145">The Floating IP rule where backend ports are reused</span></span>

<span data-ttu-id="6517b-146">Azure Load Balancer allows you to mix both rule types on the same load balancer configuration.</span><span class="sxs-lookup"><span data-stu-id="6517b-146">Azure Load Balancer allows you to mix both rule types on the same load balancer configuration.</span></span> <span data-ttu-id="6517b-147">The load balancer can use them simultaneously for a given VM, or any combination, as long as you abide by the constraints of the rule.</span><span class="sxs-lookup"><span data-stu-id="6517b-147">The load balancer can use them simultaneously for a given VM, or any combination, as long as you abide by the constraints of the rule.</span></span> <span data-ttu-id="6517b-148">Which rule type you choose depends on the requirements of your application and the complexity of supporting that configuration.</span><span class="sxs-lookup"><span data-stu-id="6517b-148">Which rule type you choose depends on the requirements of your application and the complexity of supporting that configuration.</span></span> <span data-ttu-id="6517b-149">You should evaluate which rule types are best for your scenario.</span><span class="sxs-lookup"><span data-stu-id="6517b-149">You should evaluate which rule types are best for your scenario.</span></span>

<span data-ttu-id="6517b-150">We explore these scenarios further by starting with the default behavior.</span><span class="sxs-lookup"><span data-stu-id="6517b-150">We explore these scenarios further by starting with the default behavior.</span></span>

## <a name="rule-type-1-no-backend-port-reuse"></a><span data-ttu-id="6517b-151">Rule type #1: No backend port reuse</span><span class="sxs-lookup"><span data-stu-id="6517b-151">Rule type #1: No backend port reuse</span></span>

![Multiple frontend illustration with green and purple frontend](./media/load-balancer-multivip-overview/load-balancer-multivip.png)

<span data-ttu-id="6517b-153">In this scenario, the frontends are configured as follows:</span><span class="sxs-lookup"><span data-stu-id="6517b-153">In this scenario, the frontends are configured as follows:</span></span>

| <span data-ttu-id="6517b-154">Frontend</span><span class="sxs-lookup"><span data-stu-id="6517b-154">Frontend</span></span> | <span data-ttu-id="6517b-155">IP address</span><span class="sxs-lookup"><span data-stu-id="6517b-155">IP address</span></span> | <span data-ttu-id="6517b-156">protocol</span><span class="sxs-lookup"><span data-stu-id="6517b-156">protocol</span></span> | <span data-ttu-id="6517b-157">port</span><span class="sxs-lookup"><span data-stu-id="6517b-157">port</span></span> |
| --- | --- | --- | --- |
| ![green frontend](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="6517b-159">1</span><span class="sxs-lookup"><span data-stu-id="6517b-159">1</span></span> |<span data-ttu-id="6517b-160">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="6517b-160">65.52.0.1</span></span> |<span data-ttu-id="6517b-161">TCP</span><span class="sxs-lookup"><span data-stu-id="6517b-161">TCP</span></span> |<span data-ttu-id="6517b-162">80</span><span class="sxs-lookup"><span data-stu-id="6517b-162">80</span></span> |
| ![purple frontend](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="6517b-164">2</span><span class="sxs-lookup"><span data-stu-id="6517b-164">2</span></span> |<span data-ttu-id="6517b-165">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="6517b-165">*65.52.0.2*</span></span> |<span data-ttu-id="6517b-166">TCP</span><span class="sxs-lookup"><span data-stu-id="6517b-166">TCP</span></span> |<span data-ttu-id="6517b-167">80</span><span class="sxs-lookup"><span data-stu-id="6517b-167">80</span></span> |

<span data-ttu-id="6517b-168">The DIP is the destination of the inbound flow.</span><span class="sxs-lookup"><span data-stu-id="6517b-168">The DIP is the destination of the inbound flow.</span></span> <span data-ttu-id="6517b-169">In the backend pool, each VM exposes the desired service on a unique port on a DIP.</span><span class="sxs-lookup"><span data-stu-id="6517b-169">In the backend pool, each VM exposes the desired service on a unique port on a DIP.</span></span> <span data-ttu-id="6517b-170">This service is associated with the frontend through a rule definition.</span><span class="sxs-lookup"><span data-stu-id="6517b-170">This service is associated with the frontend through a rule definition.</span></span>

<span data-ttu-id="6517b-171">We define two rules:</span><span class="sxs-lookup"><span data-stu-id="6517b-171">We define two rules:</span></span>

| <span data-ttu-id="6517b-172">Rule</span><span class="sxs-lookup"><span data-stu-id="6517b-172">Rule</span></span> | <span data-ttu-id="6517b-173">Map frontend</span><span class="sxs-lookup"><span data-stu-id="6517b-173">Map frontend</span></span> | <span data-ttu-id="6517b-174">To backend pool</span><span class="sxs-lookup"><span data-stu-id="6517b-174">To backend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="6517b-175">1</span><span class="sxs-lookup"><span data-stu-id="6517b-175">1</span></span> |![green frontend](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="6517b-177">Frontend1:80</span><span class="sxs-lookup"><span data-stu-id="6517b-177">Frontend1:80</span></span> |![backend](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="6517b-179">DIP1:80,</span><span class="sxs-lookup"><span data-stu-id="6517b-179">DIP1:80,</span></span> ![backend](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="6517b-181">DIP2:80</span><span class="sxs-lookup"><span data-stu-id="6517b-181">DIP2:80</span></span> |
| <span data-ttu-id="6517b-182">2</span><span class="sxs-lookup"><span data-stu-id="6517b-182">2</span></span> |![VIP](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="6517b-184">Frontend2:80</span><span class="sxs-lookup"><span data-stu-id="6517b-184">Frontend2:80</span></span> |![backend](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="6517b-186">DIP1:81,</span><span class="sxs-lookup"><span data-stu-id="6517b-186">DIP1:81,</span></span> ![backend](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="6517b-188">DIP2:81</span><span class="sxs-lookup"><span data-stu-id="6517b-188">DIP2:81</span></span> |

<span data-ttu-id="6517b-189">The complete mapping in Azure Load Balancer is now as follows:</span><span class="sxs-lookup"><span data-stu-id="6517b-189">The complete mapping in Azure Load Balancer is now as follows:</span></span>

| <span data-ttu-id="6517b-190">Rule</span><span class="sxs-lookup"><span data-stu-id="6517b-190">Rule</span></span> | <span data-ttu-id="6517b-191">Frontend IP address</span><span class="sxs-lookup"><span data-stu-id="6517b-191">Frontend IP address</span></span> | <span data-ttu-id="6517b-192">protocol</span><span class="sxs-lookup"><span data-stu-id="6517b-192">protocol</span></span> | <span data-ttu-id="6517b-193">port</span><span class="sxs-lookup"><span data-stu-id="6517b-193">port</span></span> | <span data-ttu-id="6517b-194">Destination</span><span class="sxs-lookup"><span data-stu-id="6517b-194">Destination</span></span> | <span data-ttu-id="6517b-195">port</span><span class="sxs-lookup"><span data-stu-id="6517b-195">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![green rule](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="6517b-197">1</span><span class="sxs-lookup"><span data-stu-id="6517b-197">1</span></span> |<span data-ttu-id="6517b-198">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="6517b-198">65.52.0.1</span></span> |<span data-ttu-id="6517b-199">TCP</span><span class="sxs-lookup"><span data-stu-id="6517b-199">TCP</span></span> |<span data-ttu-id="6517b-200">80</span><span class="sxs-lookup"><span data-stu-id="6517b-200">80</span></span> |<span data-ttu-id="6517b-201">DIP IP Address</span><span class="sxs-lookup"><span data-stu-id="6517b-201">DIP IP Address</span></span> |<span data-ttu-id="6517b-202">80</span><span class="sxs-lookup"><span data-stu-id="6517b-202">80</span></span> |
| ![purple rule](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="6517b-204">2</span><span class="sxs-lookup"><span data-stu-id="6517b-204">2</span></span> |<span data-ttu-id="6517b-205">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="6517b-205">65.52.0.2</span></span> |<span data-ttu-id="6517b-206">TCP</span><span class="sxs-lookup"><span data-stu-id="6517b-206">TCP</span></span> |<span data-ttu-id="6517b-207">80</span><span class="sxs-lookup"><span data-stu-id="6517b-207">80</span></span> |<span data-ttu-id="6517b-208">DIP IP Address</span><span class="sxs-lookup"><span data-stu-id="6517b-208">DIP IP Address</span></span> |<span data-ttu-id="6517b-209">81</span><span class="sxs-lookup"><span data-stu-id="6517b-209">81</span></span> |

<span data-ttu-id="6517b-210">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span><span class="sxs-lookup"><span data-stu-id="6517b-210">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="6517b-211">By varying the destination port of the flow, multiple rules can deliver flows to the same DIP on different ports.</span><span class="sxs-lookup"><span data-stu-id="6517b-211">By varying the destination port of the flow, multiple rules can deliver flows to the same DIP on different ports.</span></span>

<span data-ttu-id="6517b-212">Health probes are always directed to the DIP of a VM.</span><span class="sxs-lookup"><span data-stu-id="6517b-212">Health probes are always directed to the DIP of a VM.</span></span> <span data-ttu-id="6517b-213">You must ensure you that your probe reflects the health of the VM.</span><span class="sxs-lookup"><span data-stu-id="6517b-213">You must ensure you that your probe reflects the health of the VM.</span></span>

## <a name="rule-type-2-backend-port-reuse-by-using-floating-ip"></a><span data-ttu-id="6517b-214">Rule type #2: backend port reuse by using Floating IP</span><span class="sxs-lookup"><span data-stu-id="6517b-214">Rule type #2: backend port reuse by using Floating IP</span></span>

<span data-ttu-id="6517b-215">Azure Load Balancer provides the flexibility to reuse the frontend port across multiple frontends regardless of the rule type used.</span><span class="sxs-lookup"><span data-stu-id="6517b-215">Azure Load Balancer provides the flexibility to reuse the frontend port across multiple frontends regardless of the rule type used.</span></span> <span data-ttu-id="6517b-216">Additionally, some application scenarios prefer or require the same port to be used by multiple application instances on a single VM in the backend pool.</span><span class="sxs-lookup"><span data-stu-id="6517b-216">Additionally, some application scenarios prefer or require the same port to be used by multiple application instances on a single VM in the backend pool.</span></span> <span data-ttu-id="6517b-217">Common examples of port reuse include clustering for high availability, network virtual appliances, and exposing multiple TLS endpoints without re-encryption.</span><span class="sxs-lookup"><span data-stu-id="6517b-217">Common examples of port reuse include clustering for high availability, network virtual appliances, and exposing multiple TLS endpoints without re-encryption.</span></span>

<span data-ttu-id="6517b-218">If you want to reuse the backend port across multiple rules, you must enable Floating IP in the rule definition.</span><span class="sxs-lookup"><span data-stu-id="6517b-218">If you want to reuse the backend port across multiple rules, you must enable Floating IP in the rule definition.</span></span>

<span data-ttu-id="6517b-219">"Floating IP" is Azure's terminology for a portion of what is known as Direct Server Return (DSR).</span><span class="sxs-lookup"><span data-stu-id="6517b-219">"Floating IP" is Azure's terminology for a portion of what is known as Direct Server Return (DSR).</span></span> <span data-ttu-id="6517b-220">DSR consists of two parts: a flow topology and an IP address mapping scheme.</span><span class="sxs-lookup"><span data-stu-id="6517b-220">DSR consists of two parts: a flow topology and an IP address mapping scheme.</span></span> <span data-ttu-id="6517b-221">At a platform level, Azure Load Balancer always operates in a DSR flow topology regardless of whether Floating IP is enabled or not.</span><span class="sxs-lookup"><span data-stu-id="6517b-221">At a platform level, Azure Load Balancer always operates in a DSR flow topology regardless of whether Floating IP is enabled or not.</span></span> <span data-ttu-id="6517b-222">This means that the outbound part of a flow is always correctly rewritten to flow directly back to the origin.</span><span class="sxs-lookup"><span data-stu-id="6517b-222">This means that the outbound part of a flow is always correctly rewritten to flow directly back to the origin.</span></span>

<span data-ttu-id="6517b-223">With the default rule type, Azure exposes a traditional load balancing IP address mapping scheme for ease of use.</span><span class="sxs-lookup"><span data-stu-id="6517b-223">With the default rule type, Azure exposes a traditional load balancing IP address mapping scheme for ease of use.</span></span> <span data-ttu-id="6517b-224">Enabling Floating IP changes the IP address mapping scheme to allow for additional flexibility as explained below.</span><span class="sxs-lookup"><span data-stu-id="6517b-224">Enabling Floating IP changes the IP address mapping scheme to allow for additional flexibility as explained below.</span></span>

<span data-ttu-id="6517b-225">The following diagram illustrates this configuration:</span><span class="sxs-lookup"><span data-stu-id="6517b-225">The following diagram illustrates this configuration:</span></span>

![Multiple frontend illustration with green and purple frontend with DSR](./media/load-balancer-multivip-overview/load-balancer-multivip-dsr.png)

<span data-ttu-id="6517b-227">For this scenario, every VM in the backend pool has three network interfaces:</span><span class="sxs-lookup"><span data-stu-id="6517b-227">For this scenario, every VM in the backend pool has three network interfaces:</span></span>

* <span data-ttu-id="6517b-228">DIP: a Virtual NIC associated with the VM (IP configuration of Azure's NIC resource)</span><span class="sxs-lookup"><span data-stu-id="6517b-228">DIP: a Virtual NIC associated with the VM (IP configuration of Azure's NIC resource)</span></span>
* <span data-ttu-id="6517b-229">Frontend 1: a loopback interface within guest OS that is configured with IP address of Frontend 1</span><span class="sxs-lookup"><span data-stu-id="6517b-229">Frontend 1: a loopback interface within guest OS that is configured with IP address of Frontend 1</span></span>
* <span data-ttu-id="6517b-230">Frontend 2: a loopback interface within guest OS that is configured with IP address of Frontend 2</span><span class="sxs-lookup"><span data-stu-id="6517b-230">Frontend 2: a loopback interface within guest OS that is configured with IP address of Frontend 2</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6517b-231">The configuration of the loopback interfaces is performed within the guest OS.</span><span class="sxs-lookup"><span data-stu-id="6517b-231">The configuration of the loopback interfaces is performed within the guest OS.</span></span> <span data-ttu-id="6517b-232">This configuration is not performed or managed by Azure.</span><span class="sxs-lookup"><span data-stu-id="6517b-232">This configuration is not performed or managed by Azure.</span></span> <span data-ttu-id="6517b-233">Without this configuration, the rules will not function.</span><span class="sxs-lookup"><span data-stu-id="6517b-233">Without this configuration, the rules will not function.</span></span> <span data-ttu-id="6517b-234">Health probe definitions use the DIP of the VM rather than the loopback interface representing the DSR Frontend.</span><span class="sxs-lookup"><span data-stu-id="6517b-234">Health probe definitions use the DIP of the VM rather than the loopback interface representing the DSR Frontend.</span></span> <span data-ttu-id="6517b-235">Therefore, your service must provide probe responses on a DIP port that reflect the status of the service offered on the loopback interface representing the DSR Frontend.</span><span class="sxs-lookup"><span data-stu-id="6517b-235">Therefore, your service must provide probe responses on a DIP port that reflect the status of the service offered on the loopback interface representing the DSR Frontend.</span></span>

<span data-ttu-id="6517b-236">Let's assume the same frontend configuration as in the previous scenario:</span><span class="sxs-lookup"><span data-stu-id="6517b-236">Let's assume the same frontend configuration as in the previous scenario:</span></span>

| <span data-ttu-id="6517b-237">Frontend</span><span class="sxs-lookup"><span data-stu-id="6517b-237">Frontend</span></span> | <span data-ttu-id="6517b-238">IP address</span><span class="sxs-lookup"><span data-stu-id="6517b-238">IP address</span></span> | <span data-ttu-id="6517b-239">protocol</span><span class="sxs-lookup"><span data-stu-id="6517b-239">protocol</span></span> | <span data-ttu-id="6517b-240">port</span><span class="sxs-lookup"><span data-stu-id="6517b-240">port</span></span> |
| --- | --- | --- | --- |
| ![green frontend](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="6517b-242">1</span><span class="sxs-lookup"><span data-stu-id="6517b-242">1</span></span> |<span data-ttu-id="6517b-243">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="6517b-243">65.52.0.1</span></span> |<span data-ttu-id="6517b-244">TCP</span><span class="sxs-lookup"><span data-stu-id="6517b-244">TCP</span></span> |<span data-ttu-id="6517b-245">80</span><span class="sxs-lookup"><span data-stu-id="6517b-245">80</span></span> |
| ![purple frontend](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="6517b-247">2</span><span class="sxs-lookup"><span data-stu-id="6517b-247">2</span></span> |<span data-ttu-id="6517b-248">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="6517b-248">*65.52.0.2*</span></span> |<span data-ttu-id="6517b-249">TCP</span><span class="sxs-lookup"><span data-stu-id="6517b-249">TCP</span></span> |<span data-ttu-id="6517b-250">80</span><span class="sxs-lookup"><span data-stu-id="6517b-250">80</span></span> |

<span data-ttu-id="6517b-251">We define two rules:</span><span class="sxs-lookup"><span data-stu-id="6517b-251">We define two rules:</span></span>

| <span data-ttu-id="6517b-252">Rule</span><span class="sxs-lookup"><span data-stu-id="6517b-252">Rule</span></span> | <span data-ttu-id="6517b-253">Frontend</span><span class="sxs-lookup"><span data-stu-id="6517b-253">Frontend</span></span> | <span data-ttu-id="6517b-254">Map to backend pool</span><span class="sxs-lookup"><span data-stu-id="6517b-254">Map to backend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="6517b-255">1</span><span class="sxs-lookup"><span data-stu-id="6517b-255">1</span></span> |![rule](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="6517b-257">Frontend1:80</span><span class="sxs-lookup"><span data-stu-id="6517b-257">Frontend1:80</span></span> |![backend](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="6517b-259">Frontend1:80 (in VM1 and VM2)</span><span class="sxs-lookup"><span data-stu-id="6517b-259">Frontend1:80 (in VM1 and VM2)</span></span> |
| <span data-ttu-id="6517b-260">2</span><span class="sxs-lookup"><span data-stu-id="6517b-260">2</span></span> |![rule](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="6517b-262">Frontend2:80</span><span class="sxs-lookup"><span data-stu-id="6517b-262">Frontend2:80</span></span> |![backend](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="6517b-264">Frontend2:80 (in VM1 and VM2)</span><span class="sxs-lookup"><span data-stu-id="6517b-264">Frontend2:80 (in VM1 and VM2)</span></span> |

<span data-ttu-id="6517b-265">The following table shows the complete mapping in the load balancer:</span><span class="sxs-lookup"><span data-stu-id="6517b-265">The following table shows the complete mapping in the load balancer:</span></span>

| <span data-ttu-id="6517b-266">Rule</span><span class="sxs-lookup"><span data-stu-id="6517b-266">Rule</span></span> | <span data-ttu-id="6517b-267">Frontend IP address</span><span class="sxs-lookup"><span data-stu-id="6517b-267">Frontend IP address</span></span> | <span data-ttu-id="6517b-268">protocol</span><span class="sxs-lookup"><span data-stu-id="6517b-268">protocol</span></span> | <span data-ttu-id="6517b-269">port</span><span class="sxs-lookup"><span data-stu-id="6517b-269">port</span></span> | <span data-ttu-id="6517b-270">Destination</span><span class="sxs-lookup"><span data-stu-id="6517b-270">Destination</span></span> | <span data-ttu-id="6517b-271">port</span><span class="sxs-lookup"><span data-stu-id="6517b-271">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![green rule](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="6517b-273">1</span><span class="sxs-lookup"><span data-stu-id="6517b-273">1</span></span> |<span data-ttu-id="6517b-274">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="6517b-274">65.52.0.1</span></span> |<span data-ttu-id="6517b-275">TCP</span><span class="sxs-lookup"><span data-stu-id="6517b-275">TCP</span></span> |<span data-ttu-id="6517b-276">80</span><span class="sxs-lookup"><span data-stu-id="6517b-276">80</span></span> |<span data-ttu-id="6517b-277">same as frontend (65.52.0.1)</span><span class="sxs-lookup"><span data-stu-id="6517b-277">same as frontend (65.52.0.1)</span></span> |<span data-ttu-id="6517b-278">same as frontend (80)</span><span class="sxs-lookup"><span data-stu-id="6517b-278">same as frontend (80)</span></span> |
| ![purple rule](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="6517b-280">2</span><span class="sxs-lookup"><span data-stu-id="6517b-280">2</span></span> |<span data-ttu-id="6517b-281">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="6517b-281">65.52.0.2</span></span> |<span data-ttu-id="6517b-282">TCP</span><span class="sxs-lookup"><span data-stu-id="6517b-282">TCP</span></span> |<span data-ttu-id="6517b-283">80</span><span class="sxs-lookup"><span data-stu-id="6517b-283">80</span></span> |<span data-ttu-id="6517b-284">same as frontend (65.52.0.2)</span><span class="sxs-lookup"><span data-stu-id="6517b-284">same as frontend (65.52.0.2)</span></span> |<span data-ttu-id="6517b-285">same as frontend (80)</span><span class="sxs-lookup"><span data-stu-id="6517b-285">same as frontend (80)</span></span> |

<span data-ttu-id="6517b-286">The destination of the inbound flow is the frontend IP address on the loopback interface in the VM.</span><span class="sxs-lookup"><span data-stu-id="6517b-286">The destination of the inbound flow is the frontend IP address on the loopback interface in the VM.</span></span> <span data-ttu-id="6517b-287">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span><span class="sxs-lookup"><span data-stu-id="6517b-287">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="6517b-288">By varying the destination IP address of the flow, port reuse is possible on the same VM.</span><span class="sxs-lookup"><span data-stu-id="6517b-288">By varying the destination IP address of the flow, port reuse is possible on the same VM.</span></span> <span data-ttu-id="6517b-289">Your service is exposed to the load balancer by binding it to the frontend’s IP address and port of the respective loopback interface.</span><span class="sxs-lookup"><span data-stu-id="6517b-289">Your service is exposed to the load balancer by binding it to the frontend’s IP address and port of the respective loopback interface.</span></span>

<span data-ttu-id="6517b-290">Notice that this example does not change the destination port.</span><span class="sxs-lookup"><span data-stu-id="6517b-290">Notice that this example does not change the destination port.</span></span> <span data-ttu-id="6517b-291">Even though this is a Floating IP scenario, Azure Load Balancer also supports defining a rule to rewrite the backend destination port and to make it different from the frontend destination port.</span><span class="sxs-lookup"><span data-stu-id="6517b-291">Even though this is a Floating IP scenario, Azure Load Balancer also supports defining a rule to rewrite the backend destination port and to make it different from the frontend destination port.</span></span>

<span data-ttu-id="6517b-292">The Floating IP rule type is the foundation of several load balancer configuration patterns.</span><span class="sxs-lookup"><span data-stu-id="6517b-292">The Floating IP rule type is the foundation of several load balancer configuration patterns.</span></span> <span data-ttu-id="6517b-293">One example that is currently available is the [SQL AlwaysOn with Multiple Listeners](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) configuration.</span><span class="sxs-lookup"><span data-stu-id="6517b-293">One example that is currently available is the [SQL AlwaysOn with Multiple Listeners](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) configuration.</span></span> <span data-ttu-id="6517b-294">Over time, we will document more of these scenarios.</span><span class="sxs-lookup"><span data-stu-id="6517b-294">Over time, we will document more of these scenarios.</span></span>

## <a name="limitations"></a><span data-ttu-id="6517b-295">Limitations</span><span class="sxs-lookup"><span data-stu-id="6517b-295">Limitations</span></span>

* <span data-ttu-id="6517b-296">Multiple frontend configurations are only supported with IaaS VMs.</span><span class="sxs-lookup"><span data-stu-id="6517b-296">Multiple frontend configurations are only supported with IaaS VMs.</span></span>
* <span data-ttu-id="6517b-297">With the Floating IP rule, your application must use the primary IP configuration for outbound flows.</span><span class="sxs-lookup"><span data-stu-id="6517b-297">With the Floating IP rule, your application must use the primary IP configuration for outbound flows.</span></span> <span data-ttu-id="6517b-298">If your application binds to the frontend IP address configured on the loopback interface in the guest OS, Azure's SNAT is not available to rewrite the outbound flow and the flow fails.</span><span class="sxs-lookup"><span data-stu-id="6517b-298">If your application binds to the frontend IP address configured on the loopback interface in the guest OS, Azure's SNAT is not available to rewrite the outbound flow and the flow fails.</span></span>
* <span data-ttu-id="6517b-299">Public IP addresses have an effect on billing.</span><span class="sxs-lookup"><span data-stu-id="6517b-299">Public IP addresses have an effect on billing.</span></span> <span data-ttu-id="6517b-300">For more information, see [IP Address pricing](https://azure.microsoft.com/pricing/details/ip-addresses/)</span><span class="sxs-lookup"><span data-stu-id="6517b-300">For more information, see [IP Address pricing](https://azure.microsoft.com/pricing/details/ip-addresses/)</span></span>
* <span data-ttu-id="6517b-301">Subscription limits apply.</span><span class="sxs-lookup"><span data-stu-id="6517b-301">Subscription limits apply.</span></span> <span data-ttu-id="6517b-302">For more information, see [Service limits](../azure-subscription-service-limits.md#networking-limits) for details.</span><span class="sxs-lookup"><span data-stu-id="6517b-302">For more information, see [Service limits](../azure-subscription-service-limits.md#networking-limits) for details.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6517b-303">Next steps</span><span class="sxs-lookup"><span data-stu-id="6517b-303">Next steps</span></span>

- <span data-ttu-id="6517b-304">Review [Outbound connections](load-balancer-outbound-connections.md) to understand the impact of multiple frontends on outbound connection behavior.</span><span class="sxs-lookup"><span data-stu-id="6517b-304">Review [Outbound connections](load-balancer-outbound-connections.md) to understand the impact of multiple frontends on outbound connection behavior.</span></span>
