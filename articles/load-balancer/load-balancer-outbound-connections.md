---
title: Understanding outbound connections in Azure | Microsoft Docs
description: This article explains how Azure enables VMs to communicate with public Internet services.
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: ''
ms.assetid: 5f666f2a-3a63-405a-abcd-b2e34d40e001
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/31/2016
ms.author: kumud
ms.openlocfilehash: 3d2ba1d63f4bb89ff51275044922fb86b5f70365
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44551134"
---
# <a name="understanding-outbound-connections-in-azure"></a><span data-ttu-id="66b76-103">Understanding outbound connections in Azure</span><span class="sxs-lookup"><span data-stu-id="66b76-103">Understanding outbound connections in Azure</span></span>

<span data-ttu-id="66b76-104">A Virtual Machine (VM) in Azure can communicate with endpoints outside of Azure in public IP address space.</span><span class="sxs-lookup"><span data-stu-id="66b76-104">A Virtual Machine (VM) in Azure can communicate with endpoints outside of Azure in public IP address space.</span></span> <span data-ttu-id="66b76-105">When a VM initiates an outbound flow to a destination in public IP address space, Azure maps the VM's private IP address to a public IP address and allows return traffic to reach the VM.</span><span class="sxs-lookup"><span data-stu-id="66b76-105">When a VM initiates an outbound flow to a destination in public IP address space, Azure maps the VM's private IP address to a public IP address and allows return traffic to reach the VM.</span></span>

<span data-ttu-id="66b76-106">Azure provides three different methods to achieve outbound connectivity.</span><span class="sxs-lookup"><span data-stu-id="66b76-106">Azure provides three different methods to achieve outbound connectivity.</span></span> <span data-ttu-id="66b76-107">Each method has its own capabilities and constraints.</span><span class="sxs-lookup"><span data-stu-id="66b76-107">Each method has its own capabilities and constraints.</span></span> <span data-ttu-id="66b76-108">Review each method carefully to choose which one meets your needs.</span><span class="sxs-lookup"><span data-stu-id="66b76-108">Review each method carefully to choose which one meets your needs.</span></span>

| <span data-ttu-id="66b76-109">Scenario</span><span class="sxs-lookup"><span data-stu-id="66b76-109">Scenario</span></span> | <span data-ttu-id="66b76-110">Method</span><span class="sxs-lookup"><span data-stu-id="66b76-110">Method</span></span> | <span data-ttu-id="66b76-111">Note</span><span class="sxs-lookup"><span data-stu-id="66b76-111">Note</span></span> |
| --- | --- | --- |
| <span data-ttu-id="66b76-112">Standalone VM (no load balancer, no Instance Level Public IP address)</span><span class="sxs-lookup"><span data-stu-id="66b76-112">Standalone VM (no load balancer, no Instance Level Public IP address)</span></span> |<span data-ttu-id="66b76-113">Default SNAT</span><span class="sxs-lookup"><span data-stu-id="66b76-113">Default SNAT</span></span> |<span data-ttu-id="66b76-114">Azure associates a public IP address for SNAT</span><span class="sxs-lookup"><span data-stu-id="66b76-114">Azure associates a public IP address for SNAT</span></span> |
| <span data-ttu-id="66b76-115">Load-balanced VM (no Instance Level Public IP address on VM)</span><span class="sxs-lookup"><span data-stu-id="66b76-115">Load-balanced VM (no Instance Level Public IP address on VM)</span></span> |<span data-ttu-id="66b76-116">SNAT using the load balancer</span><span class="sxs-lookup"><span data-stu-id="66b76-116">SNAT using the load balancer</span></span> |<span data-ttu-id="66b76-117">Azure uses a public IP address of the Load Balancer for SNAT</span><span class="sxs-lookup"><span data-stu-id="66b76-117">Azure uses a public IP address of the Load Balancer for SNAT</span></span> |
| <span data-ttu-id="66b76-118">VM with Instance Level Public IP address (with or without load balancer)</span><span class="sxs-lookup"><span data-stu-id="66b76-118">VM with Instance Level Public IP address (with or without load balancer)</span></span> |<span data-ttu-id="66b76-119">SNAT is not used</span><span class="sxs-lookup"><span data-stu-id="66b76-119">SNAT is not used</span></span> |<span data-ttu-id="66b76-120">Azure uses the public IP assigned to the VM</span><span class="sxs-lookup"><span data-stu-id="66b76-120">Azure uses the public IP assigned to the VM</span></span> |

<span data-ttu-id="66b76-121">If you do not want a VM to communicate with endpoints outside of Azure in public IP address space, you can use Network Security Groups (NSG) to block access.</span><span class="sxs-lookup"><span data-stu-id="66b76-121">If you do not want a VM to communicate with endpoints outside of Azure in public IP address space, you can use Network Security Groups (NSG) to block access.</span></span> <span data-ttu-id="66b76-122">Using NSGs is discussed in more detail in [Preventing Public Connectivity](#preventing-public-connectivity).</span><span class="sxs-lookup"><span data-stu-id="66b76-122">Using NSGs is discussed in more detail in [Preventing Public Connectivity](#preventing-public-connectivity).</span></span>

## <a name="standalone-vm-with-no-instance-level-public-ip-address"></a><span data-ttu-id="66b76-123">Standalone VM with no Instance Level Public IP address</span><span class="sxs-lookup"><span data-stu-id="66b76-123">Standalone VM with no Instance Level Public IP address</span></span>

<span data-ttu-id="66b76-124">In this scenario, the VM is not part of an Azure Load Balancer pool and does not have an Instance Level Public IP (ILPIP) address assigned to it.</span><span class="sxs-lookup"><span data-stu-id="66b76-124">In this scenario, the VM is not part of an Azure Load Balancer pool and does not have an Instance Level Public IP (ILPIP) address assigned to it.</span></span> <span data-ttu-id="66b76-125">When the VM creates an outbound flow, Azure translates the private source IP address of the outbound flow to a public source IP address.</span><span class="sxs-lookup"><span data-stu-id="66b76-125">When the VM creates an outbound flow, Azure translates the private source IP address of the outbound flow to a public source IP address.</span></span> <span data-ttu-id="66b76-126">The public IP address used for this outbound flow is not configurable and does not count against the subscription's public IP resource limit.</span><span class="sxs-lookup"><span data-stu-id="66b76-126">The public IP address used for this outbound flow is not configurable and does not count against the subscription's public IP resource limit.</span></span> <span data-ttu-id="66b76-127">Azure uses Source Network Address Translation (SNAT) to perform this function.</span><span class="sxs-lookup"><span data-stu-id="66b76-127">Azure uses Source Network Address Translation (SNAT) to perform this function.</span></span> <span data-ttu-id="66b76-128">Ephemeral ports of the public IP address are used to distinguish individual flows originated by the VM.</span><span class="sxs-lookup"><span data-stu-id="66b76-128">Ephemeral ports of the public IP address are used to distinguish individual flows originated by the VM.</span></span> <span data-ttu-id="66b76-129">SNAT dynamically allocates ephemeral ports when flows are created.</span><span class="sxs-lookup"><span data-stu-id="66b76-129">SNAT dynamically allocates ephemeral ports when flows are created.</span></span> <span data-ttu-id="66b76-130">In this context, the ephemeral ports used for SNAT are referred to as SNAT ports.</span><span class="sxs-lookup"><span data-stu-id="66b76-130">In this context, the ephemeral ports used for SNAT are referred to as SNAT ports.</span></span>

<span data-ttu-id="66b76-131">SNAT ports are a finite resource that can be exhausted.</span><span class="sxs-lookup"><span data-stu-id="66b76-131">SNAT ports are a finite resource that can be exhausted.</span></span> <span data-ttu-id="66b76-132">It is important to understand how they are consumed.</span><span class="sxs-lookup"><span data-stu-id="66b76-132">It is important to understand how they are consumed.</span></span> <span data-ttu-id="66b76-133">One SNAT port is consumed per flow to a single destination IP address.</span><span class="sxs-lookup"><span data-stu-id="66b76-133">One SNAT port is consumed per flow to a single destination IP address.</span></span> <span data-ttu-id="66b76-134">For multiple flows to the same destination IP address, each flow consumes a single SNAT port.</span><span class="sxs-lookup"><span data-stu-id="66b76-134">For multiple flows to the same destination IP address, each flow consumes a single SNAT port.</span></span> <span data-ttu-id="66b76-135">This ensures that the flows are unique when originated from the same public IP address to the same destination IP address.</span><span class="sxs-lookup"><span data-stu-id="66b76-135">This ensures that the flows are unique when originated from the same public IP address to the same destination IP address.</span></span> <span data-ttu-id="66b76-136">Multiple flows, each to a different destination IP address consume a single SNAT port per destination.</span><span class="sxs-lookup"><span data-stu-id="66b76-136">Multiple flows, each to a different destination IP address consume a single SNAT port per destination.</span></span> <span data-ttu-id="66b76-137">The destination IP address makes the flows unique.</span><span class="sxs-lookup"><span data-stu-id="66b76-137">The destination IP address makes the flows unique.</span></span>

<span data-ttu-id="66b76-138">You can use [Log Analytics for Load Balancer](load-balancer-monitor-log.md) and [Alert event logs to monitor for SNAT port exhaustion messages](load-balancer-monitor-log.md#alert-event-log).</span><span class="sxs-lookup"><span data-stu-id="66b76-138">You can use [Log Analytics for Load Balancer](load-balancer-monitor-log.md) and [Alert event logs to monitor for SNAT port exhaustion messages](load-balancer-monitor-log.md#alert-event-log).</span></span> <span data-ttu-id="66b76-139">When SNAT port resources are exhausted, outbound flows fail until SNAT ports are released by existing flows.</span><span class="sxs-lookup"><span data-stu-id="66b76-139">When SNAT port resources are exhausted, outbound flows fail until SNAT ports are released by existing flows.</span></span> <span data-ttu-id="66b76-140">Load Balancer uses a 4-minute idle timeout for reclaiming SNAT ports.</span><span class="sxs-lookup"><span data-stu-id="66b76-140">Load Balancer uses a 4-minute idle timeout for reclaiming SNAT ports.</span></span>

## <a name="load-balanced-vm-with-no-instance-level-public-ip-address"></a><span data-ttu-id="66b76-141">Load-balanced VM with no Instance Level Public IP address</span><span class="sxs-lookup"><span data-stu-id="66b76-141">Load-balanced VM with no Instance Level Public IP address</span></span>

<span data-ttu-id="66b76-142">In this scenario, the VM is part of an Azure Load Balancer pool.</span><span class="sxs-lookup"><span data-stu-id="66b76-142">In this scenario, the VM is part of an Azure Load Balancer pool.</span></span> <span data-ttu-id="66b76-143">The VM does not have a public IP address assigned to it.</span><span class="sxs-lookup"><span data-stu-id="66b76-143">The VM does not have a public IP address assigned to it.</span></span> <span data-ttu-id="66b76-144">When the load-balanced VM creates an outbound flow, Azure translates the private source IP address of the outbound flow to the public IP address of the public Load Balancer frontend.</span><span class="sxs-lookup"><span data-stu-id="66b76-144">When the load-balanced VM creates an outbound flow, Azure translates the private source IP address of the outbound flow to the public IP address of the public Load Balancer frontend.</span></span> <span data-ttu-id="66b76-145">Azure uses Source Network Address Translation (SNAT) to perform this function.</span><span class="sxs-lookup"><span data-stu-id="66b76-145">Azure uses Source Network Address Translation (SNAT) to perform this function.</span></span> <span data-ttu-id="66b76-146">Ephemeral ports of the Load Balancer's public IP address are used to distinguish individual flows originated by the VM.</span><span class="sxs-lookup"><span data-stu-id="66b76-146">Ephemeral ports of the Load Balancer's public IP address are used to distinguish individual flows originated by the VM.</span></span> <span data-ttu-id="66b76-147">SNAT dynamically allocates ephemeral ports when outbound flows are created.</span><span class="sxs-lookup"><span data-stu-id="66b76-147">SNAT dynamically allocates ephemeral ports when outbound flows are created.</span></span> <span data-ttu-id="66b76-148">In this context, the ephemeral ports used for SNAT are referred to as SNAT ports.</span><span class="sxs-lookup"><span data-stu-id="66b76-148">In this context, the ephemeral ports used for SNAT are referred to as SNAT ports.</span></span>

<span data-ttu-id="66b76-149">SNAT ports are a finite resource that can be exhausted.</span><span class="sxs-lookup"><span data-stu-id="66b76-149">SNAT ports are a finite resource that can be exhausted.</span></span> <span data-ttu-id="66b76-150">It is important to understand how they are consumed.</span><span class="sxs-lookup"><span data-stu-id="66b76-150">It is important to understand how they are consumed.</span></span> <span data-ttu-id="66b76-151">One SNAT port is consumed per flow to a single destination IP address.</span><span class="sxs-lookup"><span data-stu-id="66b76-151">One SNAT port is consumed per flow to a single destination IP address.</span></span> <span data-ttu-id="66b76-152">For multiple flows to the same destination IP address, each flow consumes a single SNAT port.</span><span class="sxs-lookup"><span data-stu-id="66b76-152">For multiple flows to the same destination IP address, each flow consumes a single SNAT port.</span></span> <span data-ttu-id="66b76-153">This ensures that the flows are unique when originated from the same public IP address to the same destination IP address.</span><span class="sxs-lookup"><span data-stu-id="66b76-153">This ensures that the flows are unique when originated from the same public IP address to the same destination IP address.</span></span> <span data-ttu-id="66b76-154">Multiple flows, each to a different destination IP address consume a single SNAT port per destination.</span><span class="sxs-lookup"><span data-stu-id="66b76-154">Multiple flows, each to a different destination IP address consume a single SNAT port per destination.</span></span> <span data-ttu-id="66b76-155">The destination IP address makes the flows unique.</span><span class="sxs-lookup"><span data-stu-id="66b76-155">The destination IP address makes the flows unique.</span></span>

<span data-ttu-id="66b76-156">You can use [Log Analytics for Load Balancer](load-balancer-monitor-log.md) and [Alert event logs to monitor for SNAT port exhaustion messages](load-balancer-monitor-log.md#alert-event-log).</span><span class="sxs-lookup"><span data-stu-id="66b76-156">You can use [Log Analytics for Load Balancer](load-balancer-monitor-log.md) and [Alert event logs to monitor for SNAT port exhaustion messages](load-balancer-monitor-log.md#alert-event-log).</span></span> <span data-ttu-id="66b76-157">When SNAT port resources are exhausted, outbound flows fail until SNAT ports are released by existing flows.</span><span class="sxs-lookup"><span data-stu-id="66b76-157">When SNAT port resources are exhausted, outbound flows fail until SNAT ports are released by existing flows.</span></span> <span data-ttu-id="66b76-158">Load Balancer uses a 4-minute idle timeout for reclaiming SNAT ports.</span><span class="sxs-lookup"><span data-stu-id="66b76-158">Load Balancer uses a 4-minute idle timeout for reclaiming SNAT ports.</span></span>

## <a name="vm-with-an-instance-level-public-ip-address-with-or-without-load-balancer"></a><span data-ttu-id="66b76-159">VM with an Instance Level Public IP address (with or without Load Balancer)</span><span class="sxs-lookup"><span data-stu-id="66b76-159">VM with an Instance Level Public IP address (with or without Load Balancer)</span></span>

<span data-ttu-id="66b76-160">In this scenario, the VM has an Instance Level Public IP (ILPIP) assigned to it.</span><span class="sxs-lookup"><span data-stu-id="66b76-160">In this scenario, the VM has an Instance Level Public IP (ILPIP) assigned to it.</span></span> <span data-ttu-id="66b76-161">It does not matter whether the VM is load balanced or not.</span><span class="sxs-lookup"><span data-stu-id="66b76-161">It does not matter whether the VM is load balanced or not.</span></span> <span data-ttu-id="66b76-162">When an ILPIP is used, Source Network Address Translation (SNAT) is not used.</span><span class="sxs-lookup"><span data-stu-id="66b76-162">When an ILPIP is used, Source Network Address Translation (SNAT) is not used.</span></span> <span data-ttu-id="66b76-163">The VM uses the ILPIP for all outbound flows.</span><span class="sxs-lookup"><span data-stu-id="66b76-163">The VM uses the ILPIP for all outbound flows.</span></span> <span data-ttu-id="66b76-164">If your application initiates many outbound flows and you experience SNAT exhaustion, you should consider assigning an ILPIP to avoid SNAT constraints.</span><span class="sxs-lookup"><span data-stu-id="66b76-164">If your application initiates many outbound flows and you experience SNAT exhaustion, you should consider assigning an ILPIP to avoid SNAT constraints.</span></span>

## <a name="discovering-the-public-ip-used-by-a-given-vm"></a><span data-ttu-id="66b76-165">Discovering the public IP used by a given VM</span><span class="sxs-lookup"><span data-stu-id="66b76-165">Discovering the public IP used by a given VM</span></span>

<span data-ttu-id="66b76-166">There are many ways to determine the public source IP address of an outbound connection.</span><span class="sxs-lookup"><span data-stu-id="66b76-166">There are many ways to determine the public source IP address of an outbound connection.</span></span> <span data-ttu-id="66b76-167">OpenDNS provides a service that can show you the public IP address of your VM.</span><span class="sxs-lookup"><span data-stu-id="66b76-167">OpenDNS provides a service that can show you the public IP address of your VM.</span></span> <span data-ttu-id="66b76-168">Using the nslookup command, you can send a DNS query for the name myip.opendns.com to the OpenDNS resolver.</span><span class="sxs-lookup"><span data-stu-id="66b76-168">Using the nslookup command, you can send a DNS query for the name myip.opendns.com to the OpenDNS resolver.</span></span> <span data-ttu-id="66b76-169">The service returns the source IP address that was used to send the query.</span><span class="sxs-lookup"><span data-stu-id="66b76-169">The service returns the source IP address that was used to send the query.</span></span> <span data-ttu-id="66b76-170">When you execute the following query from your VM, the response is the public IP used for that VM.</span><span class="sxs-lookup"><span data-stu-id="66b76-170">When you execute the following query from your VM, the response is the public IP used for that VM.</span></span>

    nslookup myip.opendns.com resolver1.opendns.com

## <a name="preventing-public-connectivity"></a><span data-ttu-id="66b76-171">Preventing Public Connectivity</span><span class="sxs-lookup"><span data-stu-id="66b76-171">Preventing Public Connectivity</span></span>

<span data-ttu-id="66b76-172">Sometimes it is undesirable for a VM to be allowed to create an outbound flow or there may be a requirement to manage which destinations can be reached with outbound flows.</span><span class="sxs-lookup"><span data-stu-id="66b76-172">Sometimes it is undesirable for a VM to be allowed to create an outbound flow or there may be a requirement to manage which destinations can be reached with outbound flows.</span></span> <span data-ttu-id="66b76-173">In this case, you use [Network Security Groups (NSG)](../virtual-network/virtual-networks-nsg.md) to manage the destinations that the VM can reach.</span><span class="sxs-lookup"><span data-stu-id="66b76-173">In this case, you use [Network Security Groups (NSG)](../virtual-network/virtual-networks-nsg.md) to manage the destinations that the VM can reach.</span></span> <span data-ttu-id="66b76-174">When you apply an NSG to a load-balanced VM, you need to pay attention to the [default tags](../virtual-network/virtual-networks-nsg.md#default-tags) and [default rules](../virtual-network/virtual-networks-nsg.md#default-rules).</span><span class="sxs-lookup"><span data-stu-id="66b76-174">When you apply an NSG to a load-balanced VM, you need to pay attention to the [default tags](../virtual-network/virtual-networks-nsg.md#default-tags) and [default rules](../virtual-network/virtual-networks-nsg.md#default-rules).</span></span>

<span data-ttu-id="66b76-175">You must ensure that the VM can receive health probe requests from Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="66b76-175">You must ensure that the VM can receive health probe requests from Azure Load Balancer.</span></span> <span data-ttu-id="66b76-176">If an NSG blocks health probe requests from the AZURE_LOADBALANCER default tag, your VM health probe fails and the VM is marked down.</span><span class="sxs-lookup"><span data-stu-id="66b76-176">If an NSG blocks health probe requests from the AZURE_LOADBALANCER default tag, your VM health probe fails and the VM is marked down.</span></span> <span data-ttu-id="66b76-177">Load Balancer stops sending new flows to that VM.</span><span class="sxs-lookup"><span data-stu-id="66b76-177">Load Balancer stops sending new flows to that VM.</span></span>

## <a name="limitations"></a><span data-ttu-id="66b76-178">Limitations</span><span class="sxs-lookup"><span data-stu-id="66b76-178">Limitations</span></span>

<span data-ttu-id="66b76-179">While not guaranteed, the maximum number of SNAT ports available today is 64,511 (65,535 - 1024 privileged ports).</span><span class="sxs-lookup"><span data-stu-id="66b76-179">While not guaranteed, the maximum number of SNAT ports available today is 64,511 (65,535 - 1024 privileged ports).</span></span>  <span data-ttu-id="66b76-180">This does not translate directly to number of connections, please see above for specifics on when and how SNAT ports are allocated and how to manage this exhaustible resource.</span><span class="sxs-lookup"><span data-stu-id="66b76-180">This does not translate directly to number of connections, please see above for specifics on when and how SNAT ports are allocated and how to manage this exhaustible resource.</span></span>

<span data-ttu-id="66b76-181">If [multiple (public) IP addresses are associated with a load balancer](load-balancer-multivip-overview.md), any of these public IP addresses are a candidate for outbound flows.</span><span class="sxs-lookup"><span data-stu-id="66b76-181">If [multiple (public) IP addresses are associated with a load balancer](load-balancer-multivip-overview.md), any of these public IP addresses are a candidate for outbound flows.</span></span>
