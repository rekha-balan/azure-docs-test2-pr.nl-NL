---
title: Performance Monitor feature in Network Performance Monitor solution in Azure Log Analytics | Microsoft Docs
description: The Performance Monitor capability in Network Performance Monitor helps you monitor network connectivity across various points in your network. You can monitor cloud deployments and on-premises locations, multiple data centers and branch offices, and mission-critical multitier applications or microservices.
services: log-analytics
documentationcenter: ''
author: abshamsft
manager: carmonm
editor: ''
ms.assetid: 5b9c9c83-3435-488c-b4f6-7653003ae18a
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 02/20/2018
ms.author: abshamsft
ms.component: na
ms.openlocfilehash: 3d51399edbb9679d1cf7b62b075ba34aa5ede42f
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44857068"
---
# <a name="network-performance-monitor-solution-performance-monitoring"></a><span data-ttu-id="3d277-104">Network Performance Monitor solution: Performance monitoring</span><span class="sxs-lookup"><span data-stu-id="3d277-104">Network Performance Monitor solution: Performance monitoring</span></span>

<span data-ttu-id="3d277-105">The Performance Monitor capability in [Network Performance Monitor](log-analytics-network-performance-monitor.md) helps you monitor network connectivity across various points in your network.</span><span class="sxs-lookup"><span data-stu-id="3d277-105">The Performance Monitor capability in [Network Performance Monitor](log-analytics-network-performance-monitor.md) helps you monitor network connectivity across various points in your network.</span></span> <span data-ttu-id="3d277-106">You can monitor cloud deployments and on-premises locations, multiple data centers and branch offices, and mission-critical multitier applications or microservices.</span><span class="sxs-lookup"><span data-stu-id="3d277-106">You can monitor cloud deployments and on-premises locations, multiple data centers and branch offices, and mission-critical multitier applications or microservices.</span></span> <span data-ttu-id="3d277-107">With Performance Monitor, you can detect network issues before your users complain.</span><span class="sxs-lookup"><span data-stu-id="3d277-107">With Performance Monitor, you can detect network issues before your users complain.</span></span> <span data-ttu-id="3d277-108">Key advantages are that you can:</span><span class="sxs-lookup"><span data-stu-id="3d277-108">Key advantages are that you can:</span></span> 

- <span data-ttu-id="3d277-109">Monitor loss and latency across various subnets and set alerts.</span><span class="sxs-lookup"><span data-stu-id="3d277-109">Monitor loss and latency across various subnets and set alerts.</span></span>
- <span data-ttu-id="3d277-110">Monitor all paths (including redundant paths) on the network.</span><span class="sxs-lookup"><span data-stu-id="3d277-110">Monitor all paths (including redundant paths) on the network.</span></span>
- <span data-ttu-id="3d277-111">Troubleshoot transient and point-in-time network issues, which are difficult to replicate.</span><span class="sxs-lookup"><span data-stu-id="3d277-111">Troubleshoot transient and point-in-time network issues, which are difficult to replicate.</span></span>
- <span data-ttu-id="3d277-112">Determine the specific segment on the network, which is responsible for degraded performance.</span><span class="sxs-lookup"><span data-stu-id="3d277-112">Determine the specific segment on the network, which is responsible for degraded performance.</span></span>
- <span data-ttu-id="3d277-113">Monitor the health of the network, without the need for SNMP.</span><span class="sxs-lookup"><span data-stu-id="3d277-113">Monitor the health of the network, without the need for SNMP.</span></span>


![Network Performance Monitor](media/log-analytics-network-performance-monitor/npm-performance-monitor.png)

## <a name="configuration"></a><span data-ttu-id="3d277-115">Configuration</span><span class="sxs-lookup"><span data-stu-id="3d277-115">Configuration</span></span>
<span data-ttu-id="3d277-116">To open the configuration for Network Performance Monitor, open the [Network Performance Monitor solution](log-analytics-network-performance-monitor.md), and select **Configure**.</span><span class="sxs-lookup"><span data-stu-id="3d277-116">To open the configuration for Network Performance Monitor, open the [Network Performance Monitor solution](log-analytics-network-performance-monitor.md), and select **Configure**.</span></span>

![Configure Network Performance Monitor](media/log-analytics-network-performance-monitor/npm-configure-button.png)

### <a name="create-new-networks"></a><span data-ttu-id="3d277-118">Create new networks</span><span class="sxs-lookup"><span data-stu-id="3d277-118">Create new networks</span></span>

<span data-ttu-id="3d277-119">A network in Network Performance Monitor is a logical container for subnets.</span><span class="sxs-lookup"><span data-stu-id="3d277-119">A network in Network Performance Monitor is a logical container for subnets.</span></span> <span data-ttu-id="3d277-120">It helps you organize the monitoring of your network infrastructure according to your needs.</span><span class="sxs-lookup"><span data-stu-id="3d277-120">It helps you organize the monitoring of your network infrastructure according to your needs.</span></span> <span data-ttu-id="3d277-121">You can create a network with a friendly name and add subnets to it according to your business logic.</span><span class="sxs-lookup"><span data-stu-id="3d277-121">You can create a network with a friendly name and add subnets to it according to your business logic.</span></span> <span data-ttu-id="3d277-122">For example, you can create a network named London and add all the subnets in your London data center.</span><span class="sxs-lookup"><span data-stu-id="3d277-122">For example, you can create a network named London and add all the subnets in your London data center.</span></span> <span data-ttu-id="3d277-123">Or you can create a network named *ContosoFrontEnd* and add to this network all the subnets named Contoso that serve the front end of your app.</span><span class="sxs-lookup"><span data-stu-id="3d277-123">Or you can create a network named *ContosoFrontEnd* and add to this network all the subnets named Contoso that serve the front end of your app.</span></span> <span data-ttu-id="3d277-124">The solution automatically creates a default network, which contains all the subnets discovered in your environment.</span><span class="sxs-lookup"><span data-stu-id="3d277-124">The solution automatically creates a default network, which contains all the subnets discovered in your environment.</span></span> 

<span data-ttu-id="3d277-125">Whenever you create a network, you add a subnet to it.</span><span class="sxs-lookup"><span data-stu-id="3d277-125">Whenever you create a network, you add a subnet to it.</span></span> <span data-ttu-id="3d277-126">Then that subnet is removed from the default network.</span><span class="sxs-lookup"><span data-stu-id="3d277-126">Then that subnet is removed from the default network.</span></span> <span data-ttu-id="3d277-127">If you delete a network, all its subnets are automatically returned to the default network.</span><span class="sxs-lookup"><span data-stu-id="3d277-127">If you delete a network, all its subnets are automatically returned to the default network.</span></span> <span data-ttu-id="3d277-128">The default network acts as a container for all the subnets that aren't contained in any user-defined network.</span><span class="sxs-lookup"><span data-stu-id="3d277-128">The default network acts as a container for all the subnets that aren't contained in any user-defined network.</span></span> <span data-ttu-id="3d277-129">You can't edit or delete the default network.</span><span class="sxs-lookup"><span data-stu-id="3d277-129">You can't edit or delete the default network.</span></span> <span data-ttu-id="3d277-130">It always remains in the system.</span><span class="sxs-lookup"><span data-stu-id="3d277-130">It always remains in the system.</span></span> <span data-ttu-id="3d277-131">You can create as many custom networks as you need.</span><span class="sxs-lookup"><span data-stu-id="3d277-131">You can create as many custom networks as you need.</span></span> <span data-ttu-id="3d277-132">In most cases, the subnets in your organization are arranged in more than one network.</span><span class="sxs-lookup"><span data-stu-id="3d277-132">In most cases, the subnets in your organization are arranged in more than one network.</span></span> <span data-ttu-id="3d277-133">Create one or more networks to group your subnets for your business logic.</span><span class="sxs-lookup"><span data-stu-id="3d277-133">Create one or more networks to group your subnets for your business logic.</span></span>

<span data-ttu-id="3d277-134">To create a new network:</span><span class="sxs-lookup"><span data-stu-id="3d277-134">To create a new network:</span></span>


1. <span data-ttu-id="3d277-135">Select the **Networks** tab.</span><span class="sxs-lookup"><span data-stu-id="3d277-135">Select the **Networks** tab.</span></span>
1. <span data-ttu-id="3d277-136">Select **Add network**, and then enter the network name and description.</span><span class="sxs-lookup"><span data-stu-id="3d277-136">Select **Add network**, and then enter the network name and description.</span></span> 
2. <span data-ttu-id="3d277-137">Select one or more subnets, and then select **Add**.</span><span class="sxs-lookup"><span data-stu-id="3d277-137">Select one or more subnets, and then select **Add**.</span></span> 
3. <span data-ttu-id="3d277-138">Select **Save** to save the configuration.</span><span class="sxs-lookup"><span data-stu-id="3d277-138">Select **Save** to save the configuration.</span></span> 


### <a name="create-monitoring-rules"></a><span data-ttu-id="3d277-139">Create monitoring rules</span><span class="sxs-lookup"><span data-stu-id="3d277-139">Create monitoring rules</span></span> 

<span data-ttu-id="3d277-140">Performance Monitor generates health events when the threshold of the performance of network connections between two subnetworks or between two networks is breached.</span><span class="sxs-lookup"><span data-stu-id="3d277-140">Performance Monitor generates health events when the threshold of the performance of network connections between two subnetworks or between two networks is breached.</span></span> <span data-ttu-id="3d277-141">The system can learn these thresholds automatically.</span><span class="sxs-lookup"><span data-stu-id="3d277-141">The system can learn these thresholds automatically.</span></span> <span data-ttu-id="3d277-142">You also can provide custom thresholds.</span><span class="sxs-lookup"><span data-stu-id="3d277-142">You also can provide custom thresholds.</span></span> <span data-ttu-id="3d277-143">The system automatically creates a default rule, which generates a health event whenever loss or latency between any pair of network or subnetwork links breaches the system-learned threshold.</span><span class="sxs-lookup"><span data-stu-id="3d277-143">The system automatically creates a default rule, which generates a health event whenever loss or latency between any pair of network or subnetwork links breaches the system-learned threshold.</span></span> <span data-ttu-id="3d277-144">This process helps the solution monitor your network infrastructure until you haven't created any monitoring rules explicitly.</span><span class="sxs-lookup"><span data-stu-id="3d277-144">This process helps the solution monitor your network infrastructure until you haven't created any monitoring rules explicitly.</span></span> <span data-ttu-id="3d277-145">If the default rule is enabled, all the nodes send synthetic transactions to all the other nodes that you enabled for monitoring.</span><span class="sxs-lookup"><span data-stu-id="3d277-145">If the default rule is enabled, all the nodes send synthetic transactions to all the other nodes that you enabled for monitoring.</span></span> <span data-ttu-id="3d277-146">The default rule is useful with small networks.</span><span class="sxs-lookup"><span data-stu-id="3d277-146">The default rule is useful with small networks.</span></span> <span data-ttu-id="3d277-147">An example is a scenario where you have a small number of servers running a microservice and you want to make sure that all the servers have connectivity to each other.</span><span class="sxs-lookup"><span data-stu-id="3d277-147">An example is a scenario where you have a small number of servers running a microservice and you want to make sure that all the servers have connectivity to each other.</span></span>

>[!NOTE]
> <span data-ttu-id="3d277-148">We recommend that you disable the default rule and create custom monitoring rules, especially with large networks where you use a large number of nodes for monitoring.</span><span class="sxs-lookup"><span data-stu-id="3d277-148">We recommend that you disable the default rule and create custom monitoring rules, especially with large networks where you use a large number of nodes for monitoring.</span></span> <span data-ttu-id="3d277-149">Custom monitoring rules can reduce the traffic generated by the solution and help you organize the monitoring of your network.</span><span class="sxs-lookup"><span data-stu-id="3d277-149">Custom monitoring rules can reduce the traffic generated by the solution and help you organize the monitoring of your network.</span></span>

<span data-ttu-id="3d277-150">Create monitoring rules according to your business logic.</span><span class="sxs-lookup"><span data-stu-id="3d277-150">Create monitoring rules according to your business logic.</span></span> <span data-ttu-id="3d277-151">An example is if you want to monitor the performance of the network connectivity of two office sites to headquarters.</span><span class="sxs-lookup"><span data-stu-id="3d277-151">An example is if you want to monitor the performance of the network connectivity of two office sites to headquarters.</span></span> <span data-ttu-id="3d277-152">Group all the subnets in office site1 in network O1.</span><span class="sxs-lookup"><span data-stu-id="3d277-152">Group all the subnets in office site1 in network O1.</span></span> <span data-ttu-id="3d277-153">Then group all the subnets in office site2 in network O2.</span><span class="sxs-lookup"><span data-stu-id="3d277-153">Then group all the subnets in office site2 in network O2.</span></span> <span data-ttu-id="3d277-154">Finally, group all the subnets in the headquarters in network H. Create two monitoring rules--one between O1 and H and the other between O2 and H.</span><span class="sxs-lookup"><span data-stu-id="3d277-154">Finally, group all the subnets in the headquarters in network H. Create two monitoring rules--one between O1 and H and the other between O2 and H.</span></span> 

<span data-ttu-id="3d277-155">To create custom monitoring rules:</span><span class="sxs-lookup"><span data-stu-id="3d277-155">To create custom monitoring rules:</span></span>

1. <span data-ttu-id="3d277-156">Select **Add Rule** on the **Monitor** tab, and enter the rule name and description.</span><span class="sxs-lookup"><span data-stu-id="3d277-156">Select **Add Rule** on the **Monitor** tab, and enter the rule name and description.</span></span>
2. <span data-ttu-id="3d277-157">Select the pair of network or subnetwork links to monitor from the lists.</span><span class="sxs-lookup"><span data-stu-id="3d277-157">Select the pair of network or subnetwork links to monitor from the lists.</span></span> 
3. <span data-ttu-id="3d277-158">Select the network that contains the subnetworks you want from the network drop-down list.</span><span class="sxs-lookup"><span data-stu-id="3d277-158">Select the network that contains the subnetworks you want from the network drop-down list.</span></span> <span data-ttu-id="3d277-159">Then select the subnetworks from the corresponding subnetwork drop-down list.</span><span class="sxs-lookup"><span data-stu-id="3d277-159">Then select the subnetworks from the corresponding subnetwork drop-down list.</span></span> <span data-ttu-id="3d277-160">If you want to monitor all the subnetworks in a network link, select **All subnetworks**.</span><span class="sxs-lookup"><span data-stu-id="3d277-160">If you want to monitor all the subnetworks in a network link, select **All subnetworks**.</span></span> <span data-ttu-id="3d277-161">Similarly, select the other subnetworks you want.</span><span class="sxs-lookup"><span data-stu-id="3d277-161">Similarly, select the other subnetworks you want.</span></span> <span data-ttu-id="3d277-162">To exclude monitoring for particular subnetwork links from the selections you made, select **Add Exception**.</span><span class="sxs-lookup"><span data-stu-id="3d277-162">To exclude monitoring for particular subnetwork links from the selections you made, select **Add Exception**.</span></span> 
4. <span data-ttu-id="3d277-163">Choose between ICMP and TCP protocols to execute synthetic transactions.</span><span class="sxs-lookup"><span data-stu-id="3d277-163">Choose between ICMP and TCP protocols to execute synthetic transactions.</span></span> 
5. <span data-ttu-id="3d277-164">If you don't want to create health events for the items you selected, clear **Enable Health Monitoring on the links covered by this rule**.</span><span class="sxs-lookup"><span data-stu-id="3d277-164">If you don't want to create health events for the items you selected, clear **Enable Health Monitoring on the links covered by this rule**.</span></span> 
6. <span data-ttu-id="3d277-165">Choose monitoring conditions.</span><span class="sxs-lookup"><span data-stu-id="3d277-165">Choose monitoring conditions.</span></span> <span data-ttu-id="3d277-166">To set custom thresholds for health-event generation, enter threshold values.</span><span class="sxs-lookup"><span data-stu-id="3d277-166">To set custom thresholds for health-event generation, enter threshold values.</span></span> <span data-ttu-id="3d277-167">Whenever the value of the condition exceeds its selected threshold for the selected network or subnetwork pair, a health event is generated.</span><span class="sxs-lookup"><span data-stu-id="3d277-167">Whenever the value of the condition exceeds its selected threshold for the selected network or subnetwork pair, a health event is generated.</span></span> 
7. <span data-ttu-id="3d277-168">Select **Save** to save the configuration.</span><span class="sxs-lookup"><span data-stu-id="3d277-168">Select **Save** to save the configuration.</span></span> 

<span data-ttu-id="3d277-169">After you save a monitoring rule, you can integrate that rule with Alert Management by selecting **Create Alert**.</span><span class="sxs-lookup"><span data-stu-id="3d277-169">After you save a monitoring rule, you can integrate that rule with Alert Management by selecting **Create Alert**.</span></span> <span data-ttu-id="3d277-170">An alert rule is automatically created with the search query.</span><span class="sxs-lookup"><span data-stu-id="3d277-170">An alert rule is automatically created with the search query.</span></span> <span data-ttu-id="3d277-171">Other required parameters are automatically filled in.</span><span class="sxs-lookup"><span data-stu-id="3d277-171">Other required parameters are automatically filled in.</span></span> <span data-ttu-id="3d277-172">Using an alert rule, you can receive e-mail-based alerts, in addition to the existing alerts within Network Performance Monitor.</span><span class="sxs-lookup"><span data-stu-id="3d277-172">Using an alert rule, you can receive e-mail-based alerts, in addition to the existing alerts within Network Performance Monitor.</span></span> <span data-ttu-id="3d277-173">Alerts also can trigger remedial actions with runbooks, or they can integrate with existing service management solutions by using webhooks.</span><span class="sxs-lookup"><span data-stu-id="3d277-173">Alerts also can trigger remedial actions with runbooks, or they can integrate with existing service management solutions by using webhooks.</span></span> <span data-ttu-id="3d277-174">Select **Manage Alert** to edit the alert settings.</span><span class="sxs-lookup"><span data-stu-id="3d277-174">Select **Manage Alert** to edit the alert settings.</span></span> 

<span data-ttu-id="3d277-175">You can now create more Performance Monitor rules or move to the solution dashboard to use the capability.</span><span class="sxs-lookup"><span data-stu-id="3d277-175">You can now create more Performance Monitor rules or move to the solution dashboard to use the capability.</span></span>

### <a name="choose-the-protocol"></a><span data-ttu-id="3d277-176">Choose the protocol</span><span class="sxs-lookup"><span data-stu-id="3d277-176">Choose the protocol</span></span>

<span data-ttu-id="3d277-177">Network Performance Monitor uses synthetic transactions to calculate network performance metrics like packet loss and link latency.</span><span class="sxs-lookup"><span data-stu-id="3d277-177">Network Performance Monitor uses synthetic transactions to calculate network performance metrics like packet loss and link latency.</span></span> <span data-ttu-id="3d277-178">To understand this concept better, consider a Network Performance Monitor agent connected to one end of a network link.</span><span class="sxs-lookup"><span data-stu-id="3d277-178">To understand this concept better, consider a Network Performance Monitor agent connected to one end of a network link.</span></span> <span data-ttu-id="3d277-179">This Network Performance Monitor agent sends probe packets to a second Network Performance Monitor agent connected to another end of the network.</span><span class="sxs-lookup"><span data-stu-id="3d277-179">This Network Performance Monitor agent sends probe packets to a second Network Performance Monitor agent connected to another end of the network.</span></span> <span data-ttu-id="3d277-180">The second agent replies with response packets.</span><span class="sxs-lookup"><span data-stu-id="3d277-180">The second agent replies with response packets.</span></span> <span data-ttu-id="3d277-181">This process repeats a few times.</span><span class="sxs-lookup"><span data-stu-id="3d277-181">This process repeats a few times.</span></span> <span data-ttu-id="3d277-182">By measuring the number of replies and the time taken to receive each reply, the first Network Performance Monitor agent assesses link latency and packet drops.</span><span class="sxs-lookup"><span data-stu-id="3d277-182">By measuring the number of replies and the time taken to receive each reply, the first Network Performance Monitor agent assesses link latency and packet drops.</span></span> 

<span data-ttu-id="3d277-183">The format, size, and sequence of these packets is determined by the protocol that you choose when you create monitoring rules.</span><span class="sxs-lookup"><span data-stu-id="3d277-183">The format, size, and sequence of these packets is determined by the protocol that you choose when you create monitoring rules.</span></span> <span data-ttu-id="3d277-184">Based on the protocol of the packets, the intermediate network devices, such as routers and switches, might process these packets differently.</span><span class="sxs-lookup"><span data-stu-id="3d277-184">Based on the protocol of the packets, the intermediate network devices, such as routers and switches, might process these packets differently.</span></span> <span data-ttu-id="3d277-185">Consequently, your protocol choice affects the accuracy of the results.</span><span class="sxs-lookup"><span data-stu-id="3d277-185">Consequently, your protocol choice affects the accuracy of the results.</span></span> <span data-ttu-id="3d277-186">Your protocol choice also determines whether you must take any manual steps after you deploy the Network Performance Monitor solution.</span><span class="sxs-lookup"><span data-stu-id="3d277-186">Your protocol choice also determines whether you must take any manual steps after you deploy the Network Performance Monitor solution.</span></span> 

<span data-ttu-id="3d277-187">Network Performance Monitor offers you the choice between ICMP and TCP protocols for executing synthetic transactions.</span><span class="sxs-lookup"><span data-stu-id="3d277-187">Network Performance Monitor offers you the choice between ICMP and TCP protocols for executing synthetic transactions.</span></span> <span data-ttu-id="3d277-188">If you choose ICMP when you create a synthetic transaction rule, the Network Performance Monitor agents use ICMP ECHO messages to calculate the network latency and packet loss.</span><span class="sxs-lookup"><span data-stu-id="3d277-188">If you choose ICMP when you create a synthetic transaction rule, the Network Performance Monitor agents use ICMP ECHO messages to calculate the network latency and packet loss.</span></span> <span data-ttu-id="3d277-189">ICMP ECHO uses the same message that's sent by the conventional ping utility.</span><span class="sxs-lookup"><span data-stu-id="3d277-189">ICMP ECHO uses the same message that's sent by the conventional ping utility.</span></span> <span data-ttu-id="3d277-190">When you use TCP as the protocol, Network Performance Monitor agents send TCP SYN packets over the network.</span><span class="sxs-lookup"><span data-stu-id="3d277-190">When you use TCP as the protocol, Network Performance Monitor agents send TCP SYN packets over the network.</span></span> <span data-ttu-id="3d277-191">This step is followed by a TCP handshake completion, and the connection is removed by using RST packets.</span><span class="sxs-lookup"><span data-stu-id="3d277-191">This step is followed by a TCP handshake completion, and the connection is removed by using RST packets.</span></span> 

<span data-ttu-id="3d277-192">Consider the following information before you choose a protocol:</span><span class="sxs-lookup"><span data-stu-id="3d277-192">Consider the following information before you choose a protocol:</span></span> 

* <span data-ttu-id="3d277-193">**Discovery of multiple network routes.**</span><span class="sxs-lookup"><span data-stu-id="3d277-193">**Discovery of multiple network routes.**</span></span> <span data-ttu-id="3d277-194">TCP is more accurate when discovering multiple routes, and it needs fewer agents in each subnet.</span><span class="sxs-lookup"><span data-stu-id="3d277-194">TCP is more accurate when discovering multiple routes, and it needs fewer agents in each subnet.</span></span> <span data-ttu-id="3d277-195">For example, one or two agents that use TCP can discover all redundant paths between subnets.</span><span class="sxs-lookup"><span data-stu-id="3d277-195">For example, one or two agents that use TCP can discover all redundant paths between subnets.</span></span> <span data-ttu-id="3d277-196">You need several agents that use ICMP to achieve similar results.</span><span class="sxs-lookup"><span data-stu-id="3d277-196">You need several agents that use ICMP to achieve similar results.</span></span> <span data-ttu-id="3d277-197">Using ICMP, if you have a number of routes between two subnets, you need more than 5N agents in either a source or destination subnet.</span><span class="sxs-lookup"><span data-stu-id="3d277-197">Using ICMP, if you have a number of routes between two subnets, you need more than 5N agents in either a source or destination subnet.</span></span>

* <span data-ttu-id="3d277-198">**Accuracy of results.**</span><span class="sxs-lookup"><span data-stu-id="3d277-198">**Accuracy of results.**</span></span> <span data-ttu-id="3d277-199">Routers and switches tend to assign lower priority to ICMP ECHO packets compared to TCP packets.</span><span class="sxs-lookup"><span data-stu-id="3d277-199">Routers and switches tend to assign lower priority to ICMP ECHO packets compared to TCP packets.</span></span> <span data-ttu-id="3d277-200">In certain situations, when network devices are heavily loaded, the data obtained by TCP more closely reflects the loss and latency experienced by applications.</span><span class="sxs-lookup"><span data-stu-id="3d277-200">In certain situations, when network devices are heavily loaded, the data obtained by TCP more closely reflects the loss and latency experienced by applications.</span></span> <span data-ttu-id="3d277-201">This occurs because most of the application traffic flows over TCP.</span><span class="sxs-lookup"><span data-stu-id="3d277-201">This occurs because most of the application traffic flows over TCP.</span></span> <span data-ttu-id="3d277-202">In such cases, ICMP provides less-accurate results compared to TCP.</span><span class="sxs-lookup"><span data-stu-id="3d277-202">In such cases, ICMP provides less-accurate results compared to TCP.</span></span> 

* <span data-ttu-id="3d277-203">**Firewall configuration.**</span><span class="sxs-lookup"><span data-stu-id="3d277-203">**Firewall configuration.**</span></span> <span data-ttu-id="3d277-204">TCP protocol requires that TCP packets are sent to a destination port.</span><span class="sxs-lookup"><span data-stu-id="3d277-204">TCP protocol requires that TCP packets are sent to a destination port.</span></span> <span data-ttu-id="3d277-205">The default port used by Network Performance Monitor agents is 8084.</span><span class="sxs-lookup"><span data-stu-id="3d277-205">The default port used by Network Performance Monitor agents is 8084.</span></span> <span data-ttu-id="3d277-206">You can change the port when you configure agents.</span><span class="sxs-lookup"><span data-stu-id="3d277-206">You can change the port when you configure agents.</span></span> <span data-ttu-id="3d277-207">Make sure that your network firewalls or network security group (NSG) rules (in Azure) allow traffic on the port.</span><span class="sxs-lookup"><span data-stu-id="3d277-207">Make sure that your network firewalls or network security group (NSG) rules (in Azure) allow traffic on the port.</span></span> <span data-ttu-id="3d277-208">You also need to make sure that the local firewall on the computers where agents are installed is configured to allow traffic on this port.</span><span class="sxs-lookup"><span data-stu-id="3d277-208">You also need to make sure that the local firewall on the computers where agents are installed is configured to allow traffic on this port.</span></span> <span data-ttu-id="3d277-209">You can use PowerShell scripts to configure firewall rules on your computers running Windows, but you need to configure your network firewall manually.</span><span class="sxs-lookup"><span data-stu-id="3d277-209">You can use PowerShell scripts to configure firewall rules on your computers running Windows, but you need to configure your network firewall manually.</span></span> <span data-ttu-id="3d277-210">In contrast, ICMP doesn't operate by using a port.</span><span class="sxs-lookup"><span data-stu-id="3d277-210">In contrast, ICMP doesn't operate by using a port.</span></span> <span data-ttu-id="3d277-211">In most enterprise scenarios, ICMP traffic is permitted through the firewalls to allow you to use network diagnostics tools like the ping utility.</span><span class="sxs-lookup"><span data-stu-id="3d277-211">In most enterprise scenarios, ICMP traffic is permitted through the firewalls to allow you to use network diagnostics tools like the ping utility.</span></span> <span data-ttu-id="3d277-212">If you can ping one machine from another, you can use the ICMP protocol without having to configure firewalls manually.</span><span class="sxs-lookup"><span data-stu-id="3d277-212">If you can ping one machine from another, you can use the ICMP protocol without having to configure firewalls manually.</span></span>

>[!NOTE] 
> <span data-ttu-id="3d277-213">Some firewalls might block ICMP, which might lead to retransmission that results in a large number of events in your security information and event management system.</span><span class="sxs-lookup"><span data-stu-id="3d277-213">Some firewalls might block ICMP, which might lead to retransmission that results in a large number of events in your security information and event management system.</span></span> <span data-ttu-id="3d277-214">Make sure the protocol that you choose isn't blocked by a network firewall or NSG.</span><span class="sxs-lookup"><span data-stu-id="3d277-214">Make sure the protocol that you choose isn't blocked by a network firewall or NSG.</span></span> <span data-ttu-id="3d277-215">Otherwise, Network Performance Monitor can't monitor the network segment.</span><span class="sxs-lookup"><span data-stu-id="3d277-215">Otherwise, Network Performance Monitor can't monitor the network segment.</span></span> <span data-ttu-id="3d277-216">We recommend that you use TCP for monitoring.</span><span class="sxs-lookup"><span data-stu-id="3d277-216">We recommend that you use TCP for monitoring.</span></span> <span data-ttu-id="3d277-217">Use ICMP in scenarios where you can't use TCP, such as when:</span><span class="sxs-lookup"><span data-stu-id="3d277-217">Use ICMP in scenarios where you can't use TCP, such as when:</span></span> 
>
> - <span data-ttu-id="3d277-218">You use Windows client-based nodes, because TCP raw sockets aren't allowed in Windows clients.</span><span class="sxs-lookup"><span data-stu-id="3d277-218">You use Windows client-based nodes, because TCP raw sockets aren't allowed in Windows clients.</span></span>
> - <span data-ttu-id="3d277-219">Your network firewall or NSG blocks TCP.</span><span class="sxs-lookup"><span data-stu-id="3d277-219">Your network firewall or NSG blocks TCP.</span></span>
> - <span data-ttu-id="3d277-220">You don't know how to switch the protocol.</span><span class="sxs-lookup"><span data-stu-id="3d277-220">You don't know how to switch the protocol.</span></span>

<span data-ttu-id="3d277-221">If you chose to use ICMP during deployment, you can switch to TCP at any time by editing the default monitoring rule.</span><span class="sxs-lookup"><span data-stu-id="3d277-221">If you chose to use ICMP during deployment, you can switch to TCP at any time by editing the default monitoring rule.</span></span>

1. <span data-ttu-id="3d277-222">Go to **Network Performance** > **Monitor** > **Configure** > **Monitor**.</span><span class="sxs-lookup"><span data-stu-id="3d277-222">Go to **Network Performance** > **Monitor** > **Configure** > **Monitor**.</span></span> <span data-ttu-id="3d277-223">Then select **Default rule**.</span><span class="sxs-lookup"><span data-stu-id="3d277-223">Then select **Default rule**.</span></span> 
2. <span data-ttu-id="3d277-224">Scroll to the **Protocol** section, and select the protocol that you want to use.</span><span class="sxs-lookup"><span data-stu-id="3d277-224">Scroll to the **Protocol** section, and select the protocol that you want to use.</span></span> 
3. <span data-ttu-id="3d277-225">Select **Save** to apply the setting.</span><span class="sxs-lookup"><span data-stu-id="3d277-225">Select **Save** to apply the setting.</span></span> 

<span data-ttu-id="3d277-226">Even if the default rule uses a specific protocol, you can create new rules with a different protocol.</span><span class="sxs-lookup"><span data-stu-id="3d277-226">Even if the default rule uses a specific protocol, you can create new rules with a different protocol.</span></span> <span data-ttu-id="3d277-227">You can even create a mix of rules where some rules use ICMP and others use TCP.</span><span class="sxs-lookup"><span data-stu-id="3d277-227">You can even create a mix of rules where some rules use ICMP and others use TCP.</span></span> 

## <a name="walkthrough"></a><span data-ttu-id="3d277-228">Walkthrough</span><span class="sxs-lookup"><span data-stu-id="3d277-228">Walkthrough</span></span> 

<span data-ttu-id="3d277-229">Now look at a simple investigation into the root cause for a health event.</span><span class="sxs-lookup"><span data-stu-id="3d277-229">Now look at a simple investigation into the root cause for a health event.</span></span>

<span data-ttu-id="3d277-230">On the solution dashboard, a health event shows that a network link is unhealthy.</span><span class="sxs-lookup"><span data-stu-id="3d277-230">On the solution dashboard, a health event shows that a network link is unhealthy.</span></span> <span data-ttu-id="3d277-231">To investigate the issue, select the **Network links being monitored** tile.</span><span class="sxs-lookup"><span data-stu-id="3d277-231">To investigate the issue, select the **Network links being monitored** tile.</span></span>

<span data-ttu-id="3d277-232">The drill-down page shows that the **DMZ2-DMZ1** network link is unhealthy.</span><span class="sxs-lookup"><span data-stu-id="3d277-232">The drill-down page shows that the **DMZ2-DMZ1** network link is unhealthy.</span></span> <span data-ttu-id="3d277-233">Select **View subnet links** for this network link.</span><span class="sxs-lookup"><span data-stu-id="3d277-233">Select **View subnet links** for this network link.</span></span> 


<span data-ttu-id="3d277-234">The drill-down page shows all the subnetwork links in the **DMZ2-DMZ1** network link.</span><span class="sxs-lookup"><span data-stu-id="3d277-234">The drill-down page shows all the subnetwork links in the **DMZ2-DMZ1** network link.</span></span> <span data-ttu-id="3d277-235">For both subnetwork links, the latency crossed the threshold, which makes the network link unhealthy.</span><span class="sxs-lookup"><span data-stu-id="3d277-235">For both subnetwork links, the latency crossed the threshold, which makes the network link unhealthy.</span></span> <span data-ttu-id="3d277-236">You also can see the latency trends of both subnetwork links.</span><span class="sxs-lookup"><span data-stu-id="3d277-236">You also can see the latency trends of both subnetwork links.</span></span> <span data-ttu-id="3d277-237">Use the time selection control in the graph to focus on the required time range.</span><span class="sxs-lookup"><span data-stu-id="3d277-237">Use the time selection control in the graph to focus on the required time range.</span></span> <span data-ttu-id="3d277-238">You can see the time of day when latency reached its peak.</span><span class="sxs-lookup"><span data-stu-id="3d277-238">You can see the time of day when latency reached its peak.</span></span> <span data-ttu-id="3d277-239">Search the logs later for this time period to investigate the issue.</span><span class="sxs-lookup"><span data-stu-id="3d277-239">Search the logs later for this time period to investigate the issue.</span></span> <span data-ttu-id="3d277-240">Select **View node links** to drill down further.</span><span class="sxs-lookup"><span data-stu-id="3d277-240">Select **View node links** to drill down further.</span></span> 
 
 ![Subnetwork Links page](media/log-analytics-network-performance-monitor/subnetwork-links.png) 

<span data-ttu-id="3d277-242">Similar to the previous page, the drill-down page for the particular subnetwork link lists its constituent node links.</span><span class="sxs-lookup"><span data-stu-id="3d277-242">Similar to the previous page, the drill-down page for the particular subnetwork link lists its constituent node links.</span></span> <span data-ttu-id="3d277-243">You can perform similar actions here as you did in the previous step.</span><span class="sxs-lookup"><span data-stu-id="3d277-243">You can perform similar actions here as you did in the previous step.</span></span> <span data-ttu-id="3d277-244">Select **View topology** to view the topology between the two nodes.</span><span class="sxs-lookup"><span data-stu-id="3d277-244">Select **View topology** to view the topology between the two nodes.</span></span> 
 
 ![Node Links page](media/log-analytics-network-performance-monitor/node-links.png) 

<span data-ttu-id="3d277-246">All the paths between the two selected nodes are plotted in the topology map.</span><span class="sxs-lookup"><span data-stu-id="3d277-246">All the paths between the two selected nodes are plotted in the topology map.</span></span> <span data-ttu-id="3d277-247">You can visualize the hop-by-hop topology of routes between two nodes on the topology map.</span><span class="sxs-lookup"><span data-stu-id="3d277-247">You can visualize the hop-by-hop topology of routes between two nodes on the topology map.</span></span> <span data-ttu-id="3d277-248">It gives you a clear picture of how many routes exist between the two nodes and what paths the data packets take.</span><span class="sxs-lookup"><span data-stu-id="3d277-248">It gives you a clear picture of how many routes exist between the two nodes and what paths the data packets take.</span></span> <span data-ttu-id="3d277-249">Network performance bottlenecks are shown in red.</span><span class="sxs-lookup"><span data-stu-id="3d277-249">Network performance bottlenecks are shown in red.</span></span> <span data-ttu-id="3d277-250">To locate a faulty network connection or a faulty network device, look at the red elements on the topology map.</span><span class="sxs-lookup"><span data-stu-id="3d277-250">To locate a faulty network connection or a faulty network device, look at the red elements on the topology map.</span></span> 

 ![Topology Dashboard with topology map](media/log-analytics-network-performance-monitor/topology-dashboard.png) 

<span data-ttu-id="3d277-252">You can review the loss, latency, and the number of hops in each path in the **Action** pane.</span><span class="sxs-lookup"><span data-stu-id="3d277-252">You can review the loss, latency, and the number of hops in each path in the **Action** pane.</span></span> <span data-ttu-id="3d277-253">Use the scrollbar to view the details of the unhealthy paths.</span><span class="sxs-lookup"><span data-stu-id="3d277-253">Use the scrollbar to view the details of the unhealthy paths.</span></span> <span data-ttu-id="3d277-254">Use the filters to select the paths with the unhealthy hop so that the topology for only the selected paths is plotted.</span><span class="sxs-lookup"><span data-stu-id="3d277-254">Use the filters to select the paths with the unhealthy hop so that the topology for only the selected paths is plotted.</span></span> <span data-ttu-id="3d277-255">To zoom in or out of the topology map, use your mouse wheel.</span><span class="sxs-lookup"><span data-stu-id="3d277-255">To zoom in or out of the topology map, use your mouse wheel.</span></span> 

<span data-ttu-id="3d277-256">In the following image, the root cause of the problem areas to the specific section of the network appear in the red paths and hops.</span><span class="sxs-lookup"><span data-stu-id="3d277-256">In the following image, the root cause of the problem areas to the specific section of the network appear in the red paths and hops.</span></span> <span data-ttu-id="3d277-257">Select a node in the topology map to reveal the properties of the node, which includes the FQDN and IP address.</span><span class="sxs-lookup"><span data-stu-id="3d277-257">Select a node in the topology map to reveal the properties of the node, which includes the FQDN and IP address.</span></span> <span data-ttu-id="3d277-258">Selecting a hop shows the IP address of the hop.</span><span class="sxs-lookup"><span data-stu-id="3d277-258">Selecting a hop shows the IP address of the hop.</span></span> 
 
![Topology map with node properties selected](media/log-analytics-network-performance-monitor/topology-dashboard-root-cause.png) 

## <a name="next-steps"></a><span data-ttu-id="3d277-260">Next steps</span><span class="sxs-lookup"><span data-stu-id="3d277-260">Next steps</span></span>
<span data-ttu-id="3d277-261">[Search logs](log-analytics-log-searches.md) to view detailed network performance data records.</span><span class="sxs-lookup"><span data-stu-id="3d277-261">[Search logs](log-analytics-log-searches.md) to view detailed network performance data records.</span></span>
