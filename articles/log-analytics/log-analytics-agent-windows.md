---
title: Connect Windows computers to Azure Log Analytics | Microsoft Docs
description: This article describes how to connect Windows computers hosted in other clouds or on-premises to Log Analytics with the Microsoft Monitoring Agent (MMA).
services: log-analytics
documentationcenter: ''
author: mgoedtel
manager: carmonm
editor: ''
ms.assetid: ''
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 03/12/2018
ms.author: magoedte
ms.component: na
ms.openlocfilehash: 975b3d30f242b877512312f8a5a030bde9349287
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44869142"
---
# <a name="connect-windows-computers-to-the-log-analytics-service-in-azure"></a><span data-ttu-id="e2f13-103">Connect Windows computers to the Log Analytics service in Azure</span><span class="sxs-lookup"><span data-stu-id="e2f13-103">Connect Windows computers to the Log Analytics service in Azure</span></span>

<span data-ttu-id="e2f13-104">In order to monitor and manage virtual machines or physical computers in your local datacenter or other cloud environment with Log Analytics, you need to deploy the Microsoft Monitoring Agent (MMA) and configure it to report to one or more Log Analytics workspaces.</span><span class="sxs-lookup"><span data-stu-id="e2f13-104">In order to monitor and manage virtual machines or physical computers in your local datacenter or other cloud environment with Log Analytics, you need to deploy the Microsoft Monitoring Agent (MMA) and configure it to report to one or more Log Analytics workspaces.</span></span>  <span data-ttu-id="e2f13-105">The agent also supports the Hybrid Runbook Worker role for Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="e2f13-105">The agent also supports the Hybrid Runbook Worker role for Azure Automation.</span></span>  

<span data-ttu-id="e2f13-106">On a monitored Windows computer, the agent is listed as the Microsoft Monitoring Agent service.</span><span class="sxs-lookup"><span data-stu-id="e2f13-106">On a monitored Windows computer, the agent is listed as the Microsoft Monitoring Agent service.</span></span> <span data-ttu-id="e2f13-107">The Microsoft Monitoring Agent service collects events from log files and Windows event log, performance data, and other telemetry.</span><span class="sxs-lookup"><span data-stu-id="e2f13-107">The Microsoft Monitoring Agent service collects events from log files and Windows event log, performance data, and other telemetry.</span></span> <span data-ttu-id="e2f13-108">Even when the agent is unable to communicate with the Log Analytics service it reports to, the agent continues to run and queues the collected data on the disk of the monitored computer.</span><span class="sxs-lookup"><span data-stu-id="e2f13-108">Even when the agent is unable to communicate with the Log Analytics service it reports to, the agent continues to run and queues the collected data on the disk of the monitored computer.</span></span> <span data-ttu-id="e2f13-109">When the connection is restored, the Microsoft Monitoring Agent service sends collected data to the service.</span><span class="sxs-lookup"><span data-stu-id="e2f13-109">When the connection is restored, the Microsoft Monitoring Agent service sends collected data to the service.</span></span>

<span data-ttu-id="e2f13-110">The agent may be installed by using one of the following methods.</span><span class="sxs-lookup"><span data-stu-id="e2f13-110">The agent may be installed by using one of the following methods.</span></span> <span data-ttu-id="e2f13-111">Most installations use a combination of these methods to install different sets of computers, as appropriate.</span><span class="sxs-lookup"><span data-stu-id="e2f13-111">Most installations use a combination of these methods to install different sets of computers, as appropriate.</span></span>  <span data-ttu-id="e2f13-112">Details on using each method are provided later in the article.</span><span class="sxs-lookup"><span data-stu-id="e2f13-112">Details on using each method are provided later in the article.</span></span>

* <span data-ttu-id="e2f13-113">Manual installation.</span><span class="sxs-lookup"><span data-stu-id="e2f13-113">Manual installation.</span></span> <span data-ttu-id="e2f13-114">Setup is manually run on the computer using the setup wizard, from the command line, or deployed using an existing software distribution tool.</span><span class="sxs-lookup"><span data-stu-id="e2f13-114">Setup is manually run on the computer using the setup wizard, from the command line, or deployed using an existing software distribution tool.</span></span>
* <span data-ttu-id="e2f13-115">Azure Automation Desired State Configuration (DSC).</span><span class="sxs-lookup"><span data-stu-id="e2f13-115">Azure Automation Desired State Configuration (DSC).</span></span> <span data-ttu-id="e2f13-116">Using DSC in Azure Automation with a script for Windows computers already deployed in your environment.</span><span class="sxs-lookup"><span data-stu-id="e2f13-116">Using DSC in Azure Automation with a script for Windows computers already deployed in your environment.</span></span>  
* <span data-ttu-id="e2f13-117">PowerShell script.</span><span class="sxs-lookup"><span data-stu-id="e2f13-117">PowerShell script.</span></span>
* <span data-ttu-id="e2f13-118">Resource Manager template for virtual machines running Windows on-premises in Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="e2f13-118">Resource Manager template for virtual machines running Windows on-premises in Azure Stack.</span></span>  

<span data-ttu-id="e2f13-119">To understand the supported configuration, review [supported Windows operating systems](log-analytics-concept-hybrid.md#supported-windows-operating-systems) and [network firewall configuration](log-analytics-concept-hybrid.md#network-firewall-requirements).</span><span class="sxs-lookup"><span data-stu-id="e2f13-119">To understand the supported configuration, review [supported Windows operating systems](log-analytics-concept-hybrid.md#supported-windows-operating-systems) and [network firewall configuration](log-analytics-concept-hybrid.md#network-firewall-requirements).</span></span>

## <a name="obtain-workspace-id-and-key"></a><span data-ttu-id="e2f13-120">Obtain workspace ID and key</span><span class="sxs-lookup"><span data-stu-id="e2f13-120">Obtain workspace ID and key</span></span>
<span data-ttu-id="e2f13-121">Before installing the Microsoft Monitoring Agent for Windows, you need the workspace ID and key for your Log Analytics workspace.</span><span class="sxs-lookup"><span data-stu-id="e2f13-121">Before installing the Microsoft Monitoring Agent for Windows, you need the workspace ID and key for your Log Analytics workspace.</span></span>  <span data-ttu-id="e2f13-122">This information is required during setup from each installation method to properly configure the agent and ensure it can successfully communicate with Log Analytics in Azure commercial and US Government cloud.</span><span class="sxs-lookup"><span data-stu-id="e2f13-122">This information is required during setup from each installation method to properly configure the agent and ensure it can successfully communicate with Log Analytics in Azure commercial and US Government cloud.</span></span>  

1. <span data-ttu-id="e2f13-123">In the Azure portal, click **All services**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-123">In the Azure portal, click **All services**.</span></span> <span data-ttu-id="e2f13-124">In the list of resources, type **Log Analytics**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-124">In the list of resources, type **Log Analytics**.</span></span> <span data-ttu-id="e2f13-125">As you begin typing, the list filters based on your input.</span><span class="sxs-lookup"><span data-stu-id="e2f13-125">As you begin typing, the list filters based on your input.</span></span> <span data-ttu-id="e2f13-126">Select **Log Analytics**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-126">Select **Log Analytics**.</span></span>
2. <span data-ttu-id="e2f13-127">In your list of Log Analytics workspaces, select the workspace you intend on configuring the agent to report to.</span><span class="sxs-lookup"><span data-stu-id="e2f13-127">In your list of Log Analytics workspaces, select the workspace you intend on configuring the agent to report to.</span></span>
3. <span data-ttu-id="e2f13-128">Select **Advanced settings**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-128">Select **Advanced settings**.</span></span><br><br> <span data-ttu-id="e2f13-129">![Log Analytics Advance Settings](media/log-analytics-quick-collect-azurevm/log-analytics-advanced-settings-01.png)</span><span class="sxs-lookup"><span data-stu-id="e2f13-129">![Log Analytics Advance Settings](media/log-analytics-quick-collect-azurevm/log-analytics-advanced-settings-01.png)</span></span><br><br>  
4. <span data-ttu-id="e2f13-130">Select **Connected Sources**, and then select **Windows Servers**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-130">Select **Connected Sources**, and then select **Windows Servers**.</span></span>   
5. <span data-ttu-id="e2f13-131">Copy and paste into your favorite editor, the **Workspace ID** and **Primary Key**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-131">Copy and paste into your favorite editor, the **Workspace ID** and **Primary Key**.</span></span>    
   
## <a name="install-the-agent-using-setup-wizard"></a><span data-ttu-id="e2f13-132">Install the agent using setup wizard</span><span class="sxs-lookup"><span data-stu-id="e2f13-132">Install the agent using setup wizard</span></span>
<span data-ttu-id="e2f13-133">The following steps install and configure the agent for Log Analytics in Azure and Azure Government cloud by using the setup wizard for the Microsoft Monitoring Agent on your computer.</span><span class="sxs-lookup"><span data-stu-id="e2f13-133">The following steps install and configure the agent for Log Analytics in Azure and Azure Government cloud by using the setup wizard for the Microsoft Monitoring Agent on your computer.</span></span>  

1. <span data-ttu-id="e2f13-134">In your Log Analyics workspace, from the **Windows Servers** page you navigated to earlier, select the appropriate **Download Windows Agent** version to download depending on the processor architecture of the Windows operating system.</span><span class="sxs-lookup"><span data-stu-id="e2f13-134">In your Log Analyics workspace, from the **Windows Servers** page you navigated to earlier, select the appropriate **Download Windows Agent** version to download depending on the processor architecture of the Windows operating system.</span></span>   
2. <span data-ttu-id="e2f13-135">Run Setup to install the agent on your computer.</span><span class="sxs-lookup"><span data-stu-id="e2f13-135">Run Setup to install the agent on your computer.</span></span>
2. <span data-ttu-id="e2f13-136">On the **Welcome** page, click **Next**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-136">On the **Welcome** page, click **Next**.</span></span>
3. <span data-ttu-id="e2f13-137">On the **License Terms** page, read the license and then click **I Agree**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-137">On the **License Terms** page, read the license and then click **I Agree**.</span></span>
4. <span data-ttu-id="e2f13-138">On the **Destination Folder** page, change or keep the default installation folder and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-138">On the **Destination Folder** page, change or keep the default installation folder and then click **Next**.</span></span>
5. <span data-ttu-id="e2f13-139">On the **Agent Setup Options** page, choose to connect the agent to Azure Log Analytics (OMS) and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-139">On the **Agent Setup Options** page, choose to connect the agent to Azure Log Analytics (OMS) and then click **Next**.</span></span>   
6. <span data-ttu-id="e2f13-140">On the **Azure Log Analytics** page, perform the following:</span><span class="sxs-lookup"><span data-stu-id="e2f13-140">On the **Azure Log Analytics** page, perform the following:</span></span>
   1. <span data-ttu-id="e2f13-141">Paste the **Workspace ID** and **Workspace Key (Primary Key)** that you copied earlier.</span><span class="sxs-lookup"><span data-stu-id="e2f13-141">Paste the **Workspace ID** and **Workspace Key (Primary Key)** that you copied earlier.</span></span>  <span data-ttu-id="e2f13-142">If the computer should report to a Log Analytics workspace in Azure Government cloud, select **Azure US Government** from the **Azure Cloud** drop-down list.</span><span class="sxs-lookup"><span data-stu-id="e2f13-142">If the computer should report to a Log Analytics workspace in Azure Government cloud, select **Azure US Government** from the **Azure Cloud** drop-down list.</span></span>  
   2. <span data-ttu-id="e2f13-143">If the computer needs to communicate through a proxy server to the Log Analytics service, click **Advanced** and provide the URL and port number of the proxy server.</span><span class="sxs-lookup"><span data-stu-id="e2f13-143">If the computer needs to communicate through a proxy server to the Log Analytics service, click **Advanced** and provide the URL and port number of the proxy server.</span></span>  <span data-ttu-id="e2f13-144">If your proxy server requires authentication, type the username and password to authenticate with the proxy server and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-144">If your proxy server requires authentication, type the username and password to authenticate with the proxy server and then click **Next**.</span></span>  
7. <span data-ttu-id="e2f13-145">Click **Next** once you have completed providing the necessary configuration settings.</span><span class="sxs-lookup"><span data-stu-id="e2f13-145">Click **Next** once you have completed providing the necessary configuration settings.</span></span><br><br> <span data-ttu-id="e2f13-146">![paste Workspace ID and Primary Key](media/log-analytics-quick-collect-windows-computer/log-analytics-mma-setup-laworkspace.png)</span><span class="sxs-lookup"><span data-stu-id="e2f13-146">![paste Workspace ID and Primary Key](media/log-analytics-quick-collect-windows-computer/log-analytics-mma-setup-laworkspace.png)</span></span><br><br>
8. <span data-ttu-id="e2f13-147">On the **Ready to Install** page, review your choices and then click **Install**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-147">On the **Ready to Install** page, review your choices and then click **Install**.</span></span>
9. <span data-ttu-id="e2f13-148">On the **Configuration completed successfully** page, click **Finish**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-148">On the **Configuration completed successfully** page, click **Finish**.</span></span>

<span data-ttu-id="e2f13-149">When complete, the **Microsoft Monitoring Agent** appears in **Control Panel**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-149">When complete, the **Microsoft Monitoring Agent** appears in **Control Panel**.</span></span> <span data-ttu-id="e2f13-150">To confirm it is reporting to Log Analytics, review [Verify agent connectivity to Log Analytics](#verify-agent-connectivity-to-log-analytics).</span><span class="sxs-lookup"><span data-stu-id="e2f13-150">To confirm it is reporting to Log Analytics, review [Verify agent connectivity to Log Analytics](#verify-agent-connectivity-to-log-analytics).</span></span> 

## <a name="install-the-agent-using-the-command-line"></a><span data-ttu-id="e2f13-151">Install the agent using the command line</span><span class="sxs-lookup"><span data-stu-id="e2f13-151">Install the agent using the command line</span></span>
<span data-ttu-id="e2f13-152">The downloaded file for the agent is a self-contained installation package.</span><span class="sxs-lookup"><span data-stu-id="e2f13-152">The downloaded file for the agent is a self-contained installation package.</span></span>  <span data-ttu-id="e2f13-153">The setup program for the agent and supporting files are contained in the package and need to be extracted in order to properly install using the command line shown in the following examples.</span><span class="sxs-lookup"><span data-stu-id="e2f13-153">The setup program for the agent and supporting files are contained in the package and need to be extracted in order to properly install using the command line shown in the following examples.</span></span>    

>[!NOTE]
><span data-ttu-id="e2f13-154">If you want to upgrade an agent, you need to use the Log Analytics scripting API.</span><span class="sxs-lookup"><span data-stu-id="e2f13-154">If you want to upgrade an agent, you need to use the Log Analytics scripting API.</span></span> <span data-ttu-id="e2f13-155">See the topic [Managing and maintaining the Log Analytics agent for Windows and Linux](log-analytics-agent-manage.md) for further information.</span><span class="sxs-lookup"><span data-stu-id="e2f13-155">See the topic [Managing and maintaining the Log Analytics agent for Windows and Linux](log-analytics-agent-manage.md) for further information.</span></span>

<span data-ttu-id="e2f13-156">The following table highlights the specific Log Analytics parameters supported by setup for the agent, including when deployed using Automation DSC.</span><span class="sxs-lookup"><span data-stu-id="e2f13-156">The following table highlights the specific Log Analytics parameters supported by setup for the agent, including when deployed using Automation DSC.</span></span>

|<span data-ttu-id="e2f13-157">MMA-specific options</span><span class="sxs-lookup"><span data-stu-id="e2f13-157">MMA-specific options</span></span>                   |<span data-ttu-id="e2f13-158">Notes</span><span class="sxs-lookup"><span data-stu-id="e2f13-158">Notes</span></span>         |
|---------------------------------------|--------------|
| <span data-ttu-id="e2f13-159">NOAPM=1</span><span class="sxs-lookup"><span data-stu-id="e2f13-159">NOAPM=1</span></span>                               | <span data-ttu-id="e2f13-160">Optional parameter.</span><span class="sxs-lookup"><span data-stu-id="e2f13-160">Optional parameter.</span></span> <span data-ttu-id="e2f13-161">Installs the agent without .NET Application Performance Monitoring.</span><span class="sxs-lookup"><span data-stu-id="e2f13-161">Installs the agent without .NET Application Performance Monitoring.</span></span>|   
|<span data-ttu-id="e2f13-162">ADD_OPINSIGHTS_WORKSPACE</span><span class="sxs-lookup"><span data-stu-id="e2f13-162">ADD_OPINSIGHTS_WORKSPACE</span></span>               | <span data-ttu-id="e2f13-163">1 = Configure the agent to report to a workspace</span><span class="sxs-lookup"><span data-stu-id="e2f13-163">1 = Configure the agent to report to a workspace</span></span>                |
|<span data-ttu-id="e2f13-164">OPINSIGHTS_WORKSPACE_ID</span><span class="sxs-lookup"><span data-stu-id="e2f13-164">OPINSIGHTS_WORKSPACE_ID</span></span>                | <span data-ttu-id="e2f13-165">Workspace Id (guid) for the workspace to add</span><span class="sxs-lookup"><span data-stu-id="e2f13-165">Workspace Id (guid) for the workspace to add</span></span>                    |
|<span data-ttu-id="e2f13-166">OPINSIGHTS_WORKSPACE_KEY</span><span class="sxs-lookup"><span data-stu-id="e2f13-166">OPINSIGHTS_WORKSPACE_KEY</span></span>               | <span data-ttu-id="e2f13-167">Workspace key used to initially authenticate with the workspace</span><span class="sxs-lookup"><span data-stu-id="e2f13-167">Workspace key used to initially authenticate with the workspace</span></span> |
|<span data-ttu-id="e2f13-168">OPINSIGHTS_WORKSPACE_AZURE_CLOUD_TYPE</span><span class="sxs-lookup"><span data-stu-id="e2f13-168">OPINSIGHTS_WORKSPACE_AZURE_CLOUD_TYPE</span></span>  | <span data-ttu-id="e2f13-169">Specify the cloud environment where the workspace is located</span><span class="sxs-lookup"><span data-stu-id="e2f13-169">Specify the cloud environment where the workspace is located</span></span> <br> <span data-ttu-id="e2f13-170">0 = Azure commercial cloud (default)</span><span class="sxs-lookup"><span data-stu-id="e2f13-170">0 = Azure commercial cloud (default)</span></span> <br> <span data-ttu-id="e2f13-171">1 = Azure Government</span><span class="sxs-lookup"><span data-stu-id="e2f13-171">1 = Azure Government</span></span> |
|<span data-ttu-id="e2f13-172">OPINSIGHTS_PROXY_URL</span><span class="sxs-lookup"><span data-stu-id="e2f13-172">OPINSIGHTS_PROXY_URL</span></span>               | <span data-ttu-id="e2f13-173">URI for the proxy to use</span><span class="sxs-lookup"><span data-stu-id="e2f13-173">URI for the proxy to use</span></span> |
|<span data-ttu-id="e2f13-174">OPINSIGHTS_PROXY_USERNAME</span><span class="sxs-lookup"><span data-stu-id="e2f13-174">OPINSIGHTS_PROXY_USERNAME</span></span>               | <span data-ttu-id="e2f13-175">Username to access an authenticated proxy</span><span class="sxs-lookup"><span data-stu-id="e2f13-175">Username to access an authenticated proxy</span></span> |
|<span data-ttu-id="e2f13-176">OPINSIGHTS_PROXY_PASSWORD</span><span class="sxs-lookup"><span data-stu-id="e2f13-176">OPINSIGHTS_PROXY_PASSWORD</span></span>               | <span data-ttu-id="e2f13-177">Password to access an authenticated proxy</span><span class="sxs-lookup"><span data-stu-id="e2f13-177">Password to access an authenticated proxy</span></span> |

1. <span data-ttu-id="e2f13-178">To extract the agent installation files, from an elevated command prompt run `MMASetup-<platform>.exe /c` and it will prompt you for the path to extract files to.</span><span class="sxs-lookup"><span data-stu-id="e2f13-178">To extract the agent installation files, from an elevated command prompt run `MMASetup-<platform>.exe /c` and it will prompt you for the path to extract files to.</span></span>  <span data-ttu-id="e2f13-179">Alternatively, you can specify the path by passing the arguments `MMASetup-<platform>.exe /c /t:<Path>`.</span><span class="sxs-lookup"><span data-stu-id="e2f13-179">Alternatively, you can specify the path by passing the arguments `MMASetup-<platform>.exe /c /t:<Path>`.</span></span>  
2. <span data-ttu-id="e2f13-180">To silently install the agent and configure it to report to a workspace in Azure commercial cloud, from the folder you extracted the setup files to type:</span><span class="sxs-lookup"><span data-stu-id="e2f13-180">To silently install the agent and configure it to report to a workspace in Azure commercial cloud, from the folder you extracted the setup files to type:</span></span> 
   
     ```dos
    setup.exe /qn NOAPM=1 ADD_OPINSIGHTS_WORKSPACE=1 OPINSIGHTS_WORKSPACE_AZURE_CLOUD_TYPE=0 OPINSIGHTS_WORKSPACE_ID=<your workspace id> OPINSIGHTS_WORKSPACE_KEY=<your workspace key> AcceptEndUserLicenseAgreement=1
    ```

   <span data-ttu-id="e2f13-181">or to configure the agent to report to Azure US Government cloud, type:</span><span class="sxs-lookup"><span data-stu-id="e2f13-181">or to configure the agent to report to Azure US Government cloud, type:</span></span> 

     ```dos
    setup.exe /qn NOAPM=1 ADD_OPINSIGHTS_WORKSPACE=1 OPINSIGHTS_WORKSPACE_AZURE_CLOUD_TYPE=1 OPINSIGHTS_WORKSPACE_ID=<your workspace id> OPINSIGHTS_WORKSPACE_KEY=<your workspace key> AcceptEndUserLicenseAgreement=1
    ```

## <a name="install-the-agent-using-dsc-in-azure-automation"></a><span data-ttu-id="e2f13-182">Install the agent using DSC in Azure Automation</span><span class="sxs-lookup"><span data-stu-id="e2f13-182">Install the agent using DSC in Azure Automation</span></span>

<span data-ttu-id="e2f13-183">You can use the following script example to install the agent using Azure Automation DSC.</span><span class="sxs-lookup"><span data-stu-id="e2f13-183">You can use the following script example to install the agent using Azure Automation DSC.</span></span>   <span data-ttu-id="e2f13-184">If you do not have an Automation account, see [Get started with Azure Automation](../automation/automation-offering-get-started.md) to understand requirements and steps for creating an Automation account required before using Automation DSC.</span><span class="sxs-lookup"><span data-stu-id="e2f13-184">If you do not have an Automation account, see [Get started with Azure Automation](../automation/automation-offering-get-started.md) to understand requirements and steps for creating an Automation account required before using Automation DSC.</span></span>  <span data-ttu-id="e2f13-185">If you are not familiar with Automation DSC, review [Getting started with Automation DSC](../automation/automation-dsc-getting-started.md).</span><span class="sxs-lookup"><span data-stu-id="e2f13-185">If you are not familiar with Automation DSC, review [Getting started with Automation DSC](../automation/automation-dsc-getting-started.md).</span></span>

<span data-ttu-id="e2f13-186">The following example installs the 64-bit agent, identified by the `URI` value.</span><span class="sxs-lookup"><span data-stu-id="e2f13-186">The following example installs the 64-bit agent, identified by the `URI` value.</span></span> <span data-ttu-id="e2f13-187">You can also use the 32-bit version by replacing the URI value.</span><span class="sxs-lookup"><span data-stu-id="e2f13-187">You can also use the 32-bit version by replacing the URI value.</span></span> <span data-ttu-id="e2f13-188">The URIs for both versions are:</span><span class="sxs-lookup"><span data-stu-id="e2f13-188">The URIs for both versions are:</span></span>

- <span data-ttu-id="e2f13-189">Windows 64-bit agent - https://go.microsoft.com/fwlink/?LinkId=828603</span><span class="sxs-lookup"><span data-stu-id="e2f13-189">Windows 64-bit agent - https://go.microsoft.com/fwlink/?LinkId=828603</span></span>
- <span data-ttu-id="e2f13-190">Windows 32-bit agent - https://go.microsoft.com/fwlink/?LinkId=828604</span><span class="sxs-lookup"><span data-stu-id="e2f13-190">Windows 32-bit agent - https://go.microsoft.com/fwlink/?LinkId=828604</span></span>


>[!NOTE]
><span data-ttu-id="e2f13-191">This procedure and script example does not support upgrading the agent already deployed to a Windows computer.</span><span class="sxs-lookup"><span data-stu-id="e2f13-191">This procedure and script example does not support upgrading the agent already deployed to a Windows computer.</span></span>

<span data-ttu-id="e2f13-192">The 32-bit and 64-bit versions of the agent package have different product codes and new versions released also have a unique value.</span><span class="sxs-lookup"><span data-stu-id="e2f13-192">The 32-bit and 64-bit versions of the agent package have different product codes and new versions released also have a unique value.</span></span>  <span data-ttu-id="e2f13-193">The product code is a GUID that is the principal identification of an application or product and is represented by the Windows Installer **ProductCode** property.</span><span class="sxs-lookup"><span data-stu-id="e2f13-193">The product code is a GUID that is the principal identification of an application or product and is represented by the Windows Installer **ProductCode** property.</span></span>  <span data-ttu-id="e2f13-194">The `ProductId value` in the **MMAgent.ps1** script has to match the product code from the 32-bit or 64-bit agent installer package.</span><span class="sxs-lookup"><span data-stu-id="e2f13-194">The `ProductId value` in the **MMAgent.ps1** script has to match the product code from the 32-bit or 64-bit agent installer package.</span></span>

<span data-ttu-id="e2f13-195">To retrieve the product code from the agent install package directly, you can use Orca.exe from the [Windows SDK Components for Windows Installer Developers](https://msdn.microsoft.com/library/windows/desktop/aa370834%28v=vs.85%29.aspx) that is a component of the Windows Software Development Kit or using PowerShell following an [example script](http://www.scconfigmgr.com/2014/08/22/how-to-get-msi-file-information-with-powershell/)  written by a Microsoft Valuable Professional (MVP).</span><span class="sxs-lookup"><span data-stu-id="e2f13-195">To retrieve the product code from the agent install package directly, you can use Orca.exe from the [Windows SDK Components for Windows Installer Developers](https://msdn.microsoft.com/library/windows/desktop/aa370834%28v=vs.85%29.aspx) that is a component of the Windows Software Development Kit or using PowerShell following an [example script](http://www.scconfigmgr.com/2014/08/22/how-to-get-msi-file-information-with-powershell/)  written by a Microsoft Valuable Professional (MVP).</span></span>  <span data-ttu-id="e2f13-196">For either approach, you first need to extract the **MOMagent.msi** file from the MMASetup installation package.</span><span class="sxs-lookup"><span data-stu-id="e2f13-196">For either approach, you first need to extract the **MOMagent.msi** file from the MMASetup installation package.</span></span>  <span data-ttu-id="e2f13-197">This is shown earlier in the first step under the section [Install the agent using the command line](#install-the-agent-using-the-command-line).</span><span class="sxs-lookup"><span data-stu-id="e2f13-197">This is shown earlier in the first step under the section [Install the agent using the command line](#install-the-agent-using-the-command-line).</span></span>  

1. <span data-ttu-id="e2f13-198">Import the xPSDesiredStateConfiguration DSC Module from [http://www.powershellgallery.com/packages/xPSDesiredStateConfiguration](http://www.powershellgallery.com/packages/xPSDesiredStateConfiguration) into Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="e2f13-198">Import the xPSDesiredStateConfiguration DSC Module from [http://www.powershellgallery.com/packages/xPSDesiredStateConfiguration](http://www.powershellgallery.com/packages/xPSDesiredStateConfiguration) into Azure Automation.</span></span>  
2.  <span data-ttu-id="e2f13-199">Create Azure Automation variable assets for *OPSINSIGHTS_WS_ID* and *OPSINSIGHTS_WS_KEY*.</span><span class="sxs-lookup"><span data-stu-id="e2f13-199">Create Azure Automation variable assets for *OPSINSIGHTS_WS_ID* and *OPSINSIGHTS_WS_KEY*.</span></span> <span data-ttu-id="e2f13-200">Set *OPSINSIGHTS_WS_ID* to your Log Analytics workspace ID and set *OPSINSIGHTS_WS_KEY* to the primary key of your workspace.</span><span class="sxs-lookup"><span data-stu-id="e2f13-200">Set *OPSINSIGHTS_WS_ID* to your Log Analytics workspace ID and set *OPSINSIGHTS_WS_KEY* to the primary key of your workspace.</span></span>
3.  <span data-ttu-id="e2f13-201">Copy the script and save it as MMAgent.ps1</span><span class="sxs-lookup"><span data-stu-id="e2f13-201">Copy the script and save it as MMAgent.ps1</span></span>

    ```PowerShell
    Configuration MMAgent
    {
        $OIPackageLocalPath = "C:\Deploy\MMASetup-AMD64.exe"
        $OPSINSIGHTS_WS_ID = Get-AutomationVariable -Name "OPSINSIGHTS_WS_ID"
        $OPSINSIGHTS_WS_KEY = Get-AutomationVariable -Name "OPSINSIGHTS_WS_KEY"

        Import-DscResource -ModuleName xPSDesiredStateConfiguration
        Import-DscResource -ModuleName PSDesiredStateConfiguration

        Node OMSnode {
            Service OIService
            {
                Name = "HealthService"
                State = "Running"
                DependsOn = "[Package]OI"
            }

            xRemoteFile OIPackage {
                Uri = "https://go.microsoft.com/fwlink/?LinkId=828603"
                DestinationPath = $OIPackageLocalPath
            }

            Package OI {
                Ensure = "Present"
                Path  = $OIPackageLocalPath
                Name = "Microsoft Monitoring Agent"
                ProductId = "8A7F2C51-4C7D-4BFD-9014-91D11F24AAE2"
                Arguments = '/C:"setup.exe /qn NOAPM=1 ADD_OPINSIGHTS_WORKSPACE=1 OPINSIGHTS_WORKSPACE_ID=' + $OPSINSIGHTS_WS_ID + ' OPINSIGHTS_WORKSPACE_KEY=' + $OPSINSIGHTS_WS_KEY + ' AcceptEndUserLicenseAgreement=1"'
                DependsOn = "[xRemoteFile]OIPackage"
            }
        }
    }

    ```

4. <span data-ttu-id="e2f13-202">[Import the MMAgent.ps1 configuration script](../automation/automation-dsc-getting-started.md#importing-a-configuration-into-azure-automation) into your Automation account.</span><span class="sxs-lookup"><span data-stu-id="e2f13-202">[Import the MMAgent.ps1 configuration script](../automation/automation-dsc-getting-started.md#importing-a-configuration-into-azure-automation) into your Automation account.</span></span> 
5. <span data-ttu-id="e2f13-203">[Assign a Windows computer or node](../automation/automation-dsc-getting-started.md#onboarding-an-azure-vm-for-management-with-azure-automation-state-configuration) to the configuration.</span><span class="sxs-lookup"><span data-stu-id="e2f13-203">[Assign a Windows computer or node](../automation/automation-dsc-getting-started.md#onboarding-an-azure-vm-for-management-with-azure-automation-state-configuration) to the configuration.</span></span> <span data-ttu-id="e2f13-204">Within 15 minutes, the node checks its configuration and the agent is pushed to the node.</span><span class="sxs-lookup"><span data-stu-id="e2f13-204">Within 15 minutes, the node checks its configuration and the agent is pushed to the node.</span></span>

## <a name="verify-agent-connectivity-to-log-analytics"></a><span data-ttu-id="e2f13-205">Verify agent connectivity to Log Analytics</span><span class="sxs-lookup"><span data-stu-id="e2f13-205">Verify agent connectivity to Log Analytics</span></span>

<span data-ttu-id="e2f13-206">Once installation of the agent is complete, verifying it is successfully connected and reporting can be accomplished in two ways.</span><span class="sxs-lookup"><span data-stu-id="e2f13-206">Once installation of the agent is complete, verifying it is successfully connected and reporting can be accomplished in two ways.</span></span>  

<span data-ttu-id="e2f13-207">From the computer in **Control Panel**, find the item **Microsoft Monitoring Agent**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-207">From the computer in **Control Panel**, find the item **Microsoft Monitoring Agent**.</span></span>  <span data-ttu-id="e2f13-208">Select it and on the **Azure Log Analytics (OMS)** tab, the agent should display a message stating: **The Microsoft Monitoring Agent has successfully connected to the Microsoft Operations Management Suite service.**</span><span class="sxs-lookup"><span data-stu-id="e2f13-208">Select it and on the **Azure Log Analytics (OMS)** tab, the agent should display a message stating: **The Microsoft Monitoring Agent has successfully connected to the Microsoft Operations Management Suite service.**</span></span><br><br> <span data-ttu-id="e2f13-209">![MMA connection status to Log Analytics](media/log-analytics-quick-collect-windows-computer/log-analytics-mma-laworkspace-status.png)</span><span class="sxs-lookup"><span data-stu-id="e2f13-209">![MMA connection status to Log Analytics](media/log-analytics-quick-collect-windows-computer/log-analytics-mma-laworkspace-status.png)</span></span>

<span data-ttu-id="e2f13-210">You can also perform a simple log search in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="e2f13-210">You can also perform a simple log search in the Azure portal.</span></span>  

1. <span data-ttu-id="e2f13-211">In the Azure portal, click **All services**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-211">In the Azure portal, click **All services**.</span></span> <span data-ttu-id="e2f13-212">In the list of resources, type **Log Analytics**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-212">In the list of resources, type **Log Analytics**.</span></span> <span data-ttu-id="e2f13-213">As you begin typing, the list filters based on your input.</span><span class="sxs-lookup"><span data-stu-id="e2f13-213">As you begin typing, the list filters based on your input.</span></span> <span data-ttu-id="e2f13-214">Select **Log Analytics**.</span><span class="sxs-lookup"><span data-stu-id="e2f13-214">Select **Log Analytics**.</span></span>  
2. <span data-ttu-id="e2f13-215">On the Log Analytics workspace page, select the target workspace and then select the **Log Search** tile.</span><span class="sxs-lookup"><span data-stu-id="e2f13-215">On the Log Analytics workspace page, select the target workspace and then select the **Log Search** tile.</span></span> 
2. <span data-ttu-id="e2f13-216">On the Log Search pane, in the query field type:</span><span class="sxs-lookup"><span data-stu-id="e2f13-216">On the Log Search pane, in the query field type:</span></span>  

    ```
    search * 
    | where Type == "Heartbeat" 
    | where Category == "Direct Agent" 
    | where TimeGenerated > ago(30m)  
    ```

<span data-ttu-id="e2f13-217">In the search results returned, you should see heartbeat records for the computer indicating it is connected and reporting to the service.</span><span class="sxs-lookup"><span data-stu-id="e2f13-217">In the search results returned, you should see heartbeat records for the computer indicating it is connected and reporting to the service.</span></span>   

## <a name="next-steps"></a><span data-ttu-id="e2f13-218">Next steps</span><span class="sxs-lookup"><span data-stu-id="e2f13-218">Next steps</span></span>

<span data-ttu-id="e2f13-219">Review [Managing and maintaining the Log Analytics agent for Windows and Linux](log-analytics-agent-manage.md) to learn about how to manage the agent during its deployment lifecycle on your machines.</span><span class="sxs-lookup"><span data-stu-id="e2f13-219">Review [Managing and maintaining the Log Analytics agent for Windows and Linux](log-analytics-agent-manage.md) to learn about how to manage the agent during its deployment lifecycle on your machines.</span></span>  
