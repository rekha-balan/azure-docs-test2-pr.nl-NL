---
title: Media streaming optimization with Azure CDN
description: Optimize streaming media files for smooth delivery
services: cdn
documentationcenter: ''
author: dksimpson
manager: akucer
editor: ''
ms.assetid: ''
ms.service: cdn
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/01/2018
ms.author: v-deasim
ms.openlocfilehash: 8a2b69aaa601e1d00152f57841a4d67f98680181
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44871110"
---
# <a name="media-streaming-optimization-with-azure-cdn"></a><span data-ttu-id="58162-103">Media streaming optimization with Azure CDN</span><span class="sxs-lookup"><span data-stu-id="58162-103">Media streaming optimization with Azure CDN</span></span> 
 
<span data-ttu-id="58162-104">Use of high-definition video is increasing on the internet, which creates difficulties for efficient delivery of large files.</span><span class="sxs-lookup"><span data-stu-id="58162-104">Use of high-definition video is increasing on the internet, which creates difficulties for efficient delivery of large files.</span></span> <span data-ttu-id="58162-105">Customers expect smooth playback of video on demand or live video assets on a variety of networks and clients all over the world.</span><span class="sxs-lookup"><span data-stu-id="58162-105">Customers expect smooth playback of video on demand or live video assets on a variety of networks and clients all over the world.</span></span> <span data-ttu-id="58162-106">A fast and efficient delivery mechanism for media streaming files is critical to ensure a smooth and enjoyable consumer experience.</span><span class="sxs-lookup"><span data-stu-id="58162-106">A fast and efficient delivery mechanism for media streaming files is critical to ensure a smooth and enjoyable consumer experience.</span></span>  

<span data-ttu-id="58162-107">Live streaming media is especially difficult to deliver because of the large sizes and number of concurrent viewers.</span><span class="sxs-lookup"><span data-stu-id="58162-107">Live streaming media is especially difficult to deliver because of the large sizes and number of concurrent viewers.</span></span> <span data-ttu-id="58162-108">Long delays cause users to leave.</span><span class="sxs-lookup"><span data-stu-id="58162-108">Long delays cause users to leave.</span></span> <span data-ttu-id="58162-109">Because live streams can't be cached ahead of time and large latencies aren't acceptable to viewers, video fragments must be delivered in a timely manner.</span><span class="sxs-lookup"><span data-stu-id="58162-109">Because live streams can't be cached ahead of time and large latencies aren't acceptable to viewers, video fragments must be delivered in a timely manner.</span></span> 

<span data-ttu-id="58162-110">The request patterns of streaming also provide some new challenges.</span><span class="sxs-lookup"><span data-stu-id="58162-110">The request patterns of streaming also provide some new challenges.</span></span> <span data-ttu-id="58162-111">When a popular live stream or a new series is released for video on demand, thousands to millions of viewers might request the stream at the same time.</span><span class="sxs-lookup"><span data-stu-id="58162-111">When a popular live stream or a new series is released for video on demand, thousands to millions of viewers might request the stream at the same time.</span></span> <span data-ttu-id="58162-112">In this case, smart request consolidation is vital to not overwhelm the origin servers when the assets aren't cached yet.</span><span class="sxs-lookup"><span data-stu-id="58162-112">In this case, smart request consolidation is vital to not overwhelm the origin servers when the assets aren't cached yet.</span></span>
 

## <a name="media-streaming-optimizations-for-azure-cdn-from-microsoft"></a><span data-ttu-id="58162-113">Media streaming optimizations for Azure CDN from Microsoft</span><span class="sxs-lookup"><span data-stu-id="58162-113">Media streaming optimizations for Azure CDN from Microsoft</span></span>

<span data-ttu-id="58162-114">**Azure CDN Standard from Microsoft** endpoints deliver streaming media assets directly by using the general web delivery optimization type.</span><span class="sxs-lookup"><span data-stu-id="58162-114">**Azure CDN Standard from Microsoft** endpoints deliver streaming media assets directly by using the general web delivery optimization type.</span></span> 

<span data-ttu-id="58162-115">Media streaming optimization for **Azure CDN Standard from Microsoft** is effective for live or video-on-demand streaming media that uses individual media fragments for delivery.</span><span class="sxs-lookup"><span data-stu-id="58162-115">Media streaming optimization for **Azure CDN Standard from Microsoft** is effective for live or video-on-demand streaming media that uses individual media fragments for delivery.</span></span> <span data-ttu-id="58162-116">This process is different from a single large asset transferred via progressive download or by using byte-range requests.</span><span class="sxs-lookup"><span data-stu-id="58162-116">This process is different from a single large asset transferred via progressive download or by using byte-range requests.</span></span> <span data-ttu-id="58162-117">For information on that style of media delivery, see [Large file download optimization with Azure CDN](cdn-large-file-optimization.md).</span><span class="sxs-lookup"><span data-stu-id="58162-117">For information on that style of media delivery, see [Large file download optimization with Azure CDN](cdn-large-file-optimization.md).</span></span>

<span data-ttu-id="58162-118">The general media delivery or video-on-demand media delivery optimization types use Azure Content Delivery Network (CDN) with back-end optimizations to deliver media assets faster.</span><span class="sxs-lookup"><span data-stu-id="58162-118">The general media delivery or video-on-demand media delivery optimization types use Azure Content Delivery Network (CDN) with back-end optimizations to deliver media assets faster.</span></span> <span data-ttu-id="58162-119">They also use configurations for media assets based on best practices learned over time.</span><span class="sxs-lookup"><span data-stu-id="58162-119">They also use configurations for media assets based on best practices learned over time.</span></span>

### <a name="partial-cache-sharing"></a><span data-ttu-id="58162-120">Partial cache sharing</span><span class="sxs-lookup"><span data-stu-id="58162-120">Partial cache sharing</span></span>
<span data-ttu-id="58162-121">Partial cache sharing allows the CDN to serve partially cached content to new requests.</span><span class="sxs-lookup"><span data-stu-id="58162-121">Partial cache sharing allows the CDN to serve partially cached content to new requests.</span></span> <span data-ttu-id="58162-122">For example, if the first request to the CDN results in a cache miss, the request is sent to the origin.</span><span class="sxs-lookup"><span data-stu-id="58162-122">For example, if the first request to the CDN results in a cache miss, the request is sent to the origin.</span></span> <span data-ttu-id="58162-123">Although this incomplete content is loaded into the CDN cache, other requests to the CDN can start getting this data.</span><span class="sxs-lookup"><span data-stu-id="58162-123">Although this incomplete content is loaded into the CDN cache, other requests to the CDN can start getting this data.</span></span> 


## <a name="media-streaming-optimizations-for-azure-cdn-from-verizon"></a><span data-ttu-id="58162-124">Media streaming optimizations for Azure CDN from Verizon</span><span class="sxs-lookup"><span data-stu-id="58162-124">Media streaming optimizations for Azure CDN from Verizon</span></span>

<span data-ttu-id="58162-125">**Azure CDN Standard from Verizon** and **Azure CDN Premium from Verizon** endpoints deliver streaming media assets directly by using the general web delivery optimization type.</span><span class="sxs-lookup"><span data-stu-id="58162-125">**Azure CDN Standard from Verizon** and **Azure CDN Premium from Verizon** endpoints deliver streaming media assets directly by using the general web delivery optimization type.</span></span> <span data-ttu-id="58162-126">A few features on the CDN directly assist in delivering media assets by default.</span><span class="sxs-lookup"><span data-stu-id="58162-126">A few features on the CDN directly assist in delivering media assets by default.</span></span>

### <a name="partial-cache-sharing"></a><span data-ttu-id="58162-127">Partial cache sharing</span><span class="sxs-lookup"><span data-stu-id="58162-127">Partial cache sharing</span></span>

<span data-ttu-id="58162-128">Partial cache sharing allows the CDN to serve partially cached content to new requests.</span><span class="sxs-lookup"><span data-stu-id="58162-128">Partial cache sharing allows the CDN to serve partially cached content to new requests.</span></span> <span data-ttu-id="58162-129">For example, if the first request to the CDN results in a cache miss, the request is sent to the origin.</span><span class="sxs-lookup"><span data-stu-id="58162-129">For example, if the first request to the CDN results in a cache miss, the request is sent to the origin.</span></span> <span data-ttu-id="58162-130">Although this incomplete content is loaded into the CDN cache, other requests to the CDN can start getting this data.</span><span class="sxs-lookup"><span data-stu-id="58162-130">Although this incomplete content is loaded into the CDN cache, other requests to the CDN can start getting this data.</span></span> 

### <a name="cache-fill-wait-time"></a><span data-ttu-id="58162-131">Cache fill wait time</span><span class="sxs-lookup"><span data-stu-id="58162-131">Cache fill wait time</span></span>

 <span data-ttu-id="58162-132">The cache fill wait time feature forces the edge server to hold any subsequent requests for the same resource until HTTP response headers arrive from the origin server.</span><span class="sxs-lookup"><span data-stu-id="58162-132">The cache fill wait time feature forces the edge server to hold any subsequent requests for the same resource until HTTP response headers arrive from the origin server.</span></span> <span data-ttu-id="58162-133">If HTTP response headers from the origin  arrive before the timer expires, all requests that were put on hold are served out of the growing cache.</span><span class="sxs-lookup"><span data-stu-id="58162-133">If HTTP response headers from the origin  arrive before the timer expires, all requests that were put on hold are served out of the growing cache.</span></span> <span data-ttu-id="58162-134">At the same time, the cache is filled by data from the origin.</span><span class="sxs-lookup"><span data-stu-id="58162-134">At the same time, the cache is filled by data from the origin.</span></span> <span data-ttu-id="58162-135">By default, the cache fill wait time is set to 3,000 milliseconds.</span><span class="sxs-lookup"><span data-stu-id="58162-135">By default, the cache fill wait time is set to 3,000 milliseconds.</span></span> 

 
## <a name="media-streaming-optimizations-for-azure-cdn-from-akamai"></a><span data-ttu-id="58162-136">Media streaming optimizations for Azure CDN from Akamai</span><span class="sxs-lookup"><span data-stu-id="58162-136">Media streaming optimizations for Azure CDN from Akamai</span></span>
 
<span data-ttu-id="58162-137">**Azure CDN Standard from Akamai** offers a feature that delivers streaming media assets efficiently to users across the globe at scale.</span><span class="sxs-lookup"><span data-stu-id="58162-137">**Azure CDN Standard from Akamai** offers a feature that delivers streaming media assets efficiently to users across the globe at scale.</span></span> <span data-ttu-id="58162-138">The feature reduces latencies because it reduces the load on the origin servers.</span><span class="sxs-lookup"><span data-stu-id="58162-138">The feature reduces latencies because it reduces the load on the origin servers.</span></span> <span data-ttu-id="58162-139">This feature is available with the standard Akamai pricing tier.</span><span class="sxs-lookup"><span data-stu-id="58162-139">This feature is available with the standard Akamai pricing tier.</span></span> 

<span data-ttu-id="58162-140">Media streaming optimization for **Azure CDN Standard from Akamai** is effective for live or video-on-demand streaming media that uses individual media fragments for delivery.</span><span class="sxs-lookup"><span data-stu-id="58162-140">Media streaming optimization for **Azure CDN Standard from Akamai** is effective for live or video-on-demand streaming media that uses individual media fragments for delivery.</span></span> <span data-ttu-id="58162-141">This process is different from a single large asset transferred via progressive download or by using byte-range requests.</span><span class="sxs-lookup"><span data-stu-id="58162-141">This process is different from a single large asset transferred via progressive download or by using byte-range requests.</span></span> <span data-ttu-id="58162-142">For information on that style of media delivery, see [Large file optimization](cdn-large-file-optimization.md).</span><span class="sxs-lookup"><span data-stu-id="58162-142">For information on that style of media delivery, see [Large file optimization](cdn-large-file-optimization.md).</span></span>

<span data-ttu-id="58162-143">The general media delivery or video-on-demand media delivery optimization types use a CDN with back-end optimizations to deliver media assets faster.</span><span class="sxs-lookup"><span data-stu-id="58162-143">The general media delivery or video-on-demand media delivery optimization types use a CDN with back-end optimizations to deliver media assets faster.</span></span> <span data-ttu-id="58162-144">They also use configurations for media assets based on best practices learned over time.</span><span class="sxs-lookup"><span data-stu-id="58162-144">They also use configurations for media assets based on best practices learned over time.</span></span>

### <a name="configure-an-akamai-cdn-endpoint-to-optimize-media-streaming"></a><span data-ttu-id="58162-145">Configure an Akamai CDN endpoint to optimize media streaming</span><span class="sxs-lookup"><span data-stu-id="58162-145">Configure an Akamai CDN endpoint to optimize media streaming</span></span>
 
<span data-ttu-id="58162-146">You can configure your content delivery network (CDN) endpoint to optimize delivery for large files via the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="58162-146">You can configure your content delivery network (CDN) endpoint to optimize delivery for large files via the Azure portal.</span></span> <span data-ttu-id="58162-147">You can also use the REST APIs or any of the client SDKs to do this.</span><span class="sxs-lookup"><span data-stu-id="58162-147">You can also use the REST APIs or any of the client SDKs to do this.</span></span> <span data-ttu-id="58162-148">The following steps show the process via the Azure portal for an **Azure CDN Standard from Akamai** profile:</span><span class="sxs-lookup"><span data-stu-id="58162-148">The following steps show the process via the Azure portal for an **Azure CDN Standard from Akamai** profile:</span></span>

1. <span data-ttu-id="58162-149">To add a new endpoint, on an Akamai **CDN profile** page, select **Endpoint**.</span><span class="sxs-lookup"><span data-stu-id="58162-149">To add a new endpoint, on an Akamai **CDN profile** page, select **Endpoint**.</span></span>
  
    ![New endpoint](./media/cdn-media-streaming-optimization/cdn-new-akamai-endpoint.png)

2. <span data-ttu-id="58162-151">In the **Optimized for** drop-down list, select **Video on demand media streaming** for video-on-demand assets.</span><span class="sxs-lookup"><span data-stu-id="58162-151">In the **Optimized for** drop-down list, select **Video on demand media streaming** for video-on-demand assets.</span></span> <span data-ttu-id="58162-152">If you do a combination of live and video-on-demand streaming, select **General media streaming**.</span><span class="sxs-lookup"><span data-stu-id="58162-152">If you do a combination of live and video-on-demand streaming, select **General media streaming**.</span></span>

    ![Streaming selected](./media/cdn-media-streaming-optimization/02_Creating.png) 
 
<span data-ttu-id="58162-154">After you create the endpoint, it applies the optimization for all files that match certain criteria.</span><span class="sxs-lookup"><span data-stu-id="58162-154">After you create the endpoint, it applies the optimization for all files that match certain criteria.</span></span> <span data-ttu-id="58162-155">The following section describes this process.</span><span class="sxs-lookup"><span data-stu-id="58162-155">The following section describes this process.</span></span> 

### <a name="caching"></a><span data-ttu-id="58162-156">Caching</span><span class="sxs-lookup"><span data-stu-id="58162-156">Caching</span></span>

<span data-ttu-id="58162-157">If **Azure CDN Standard from Akamai** detects that the asset is a streaming manifest or fragment, it uses different caching expiration times from general web delivery.</span><span class="sxs-lookup"><span data-stu-id="58162-157">If **Azure CDN Standard from Akamai** detects that the asset is a streaming manifest or fragment, it uses different caching expiration times from general web delivery.</span></span> <span data-ttu-id="58162-158">(See the full list in the following table.) As always, cache-control or Expires headers sent from the origin are honored.</span><span class="sxs-lookup"><span data-stu-id="58162-158">(See the full list in the following table.) As always, cache-control or Expires headers sent from the origin are honored.</span></span> <span data-ttu-id="58162-159">If the asset is not a media asset, it caches by using the expiration times for general web delivery.</span><span class="sxs-lookup"><span data-stu-id="58162-159">If the asset is not a media asset, it caches by using the expiration times for general web delivery.</span></span>

<span data-ttu-id="58162-160">The short negative caching time is useful for origin offload when many users request a fragment that doesn’t exist yet.</span><span class="sxs-lookup"><span data-stu-id="58162-160">The short negative caching time is useful for origin offload when many users request a fragment that doesn’t exist yet.</span></span> <span data-ttu-id="58162-161">An example is a live stream where the packets aren't available from the origin that second.</span><span class="sxs-lookup"><span data-stu-id="58162-161">An example is a live stream where the packets aren't available from the origin that second.</span></span> <span data-ttu-id="58162-162">The longer caching interval also helps offload requests from the origin because video content isn't typically modified.</span><span class="sxs-lookup"><span data-stu-id="58162-162">The longer caching interval also helps offload requests from the origin because video content isn't typically modified.</span></span>
 

|   | <span data-ttu-id="58162-163">General web delivery</span><span class="sxs-lookup"><span data-stu-id="58162-163">General web delivery</span></span> | <span data-ttu-id="58162-164">General media streaming</span><span class="sxs-lookup"><span data-stu-id="58162-164">General media streaming</span></span> | <span data-ttu-id="58162-165">Video-on-demand media streaming</span><span class="sxs-lookup"><span data-stu-id="58162-165">Video-on-demand media streaming</span></span>  
--- | --- | --- | ---
<span data-ttu-id="58162-166">Caching: Positive</span><span class="sxs-lookup"><span data-stu-id="58162-166">Caching: Positive</span></span> <br> <span data-ttu-id="58162-167">HTTP 200, 203, 300,</span><span class="sxs-lookup"><span data-stu-id="58162-167">HTTP 200, 203, 300,</span></span> <br> <span data-ttu-id="58162-168">301, 302, and 410</span><span class="sxs-lookup"><span data-stu-id="58162-168">301, 302, and 410</span></span> | <span data-ttu-id="58162-169">7 days</span><span class="sxs-lookup"><span data-stu-id="58162-169">7 days</span></span> |<span data-ttu-id="58162-170">365 days</span><span class="sxs-lookup"><span data-stu-id="58162-170">365 days</span></span> | <span data-ttu-id="58162-171">365 days</span><span class="sxs-lookup"><span data-stu-id="58162-171">365 days</span></span>   
<span data-ttu-id="58162-172">Caching: Negative</span><span class="sxs-lookup"><span data-stu-id="58162-172">Caching: Negative</span></span> <br> <span data-ttu-id="58162-173">HTTP 204, 305, 404,</span><span class="sxs-lookup"><span data-stu-id="58162-173">HTTP 204, 305, 404,</span></span> <br> <span data-ttu-id="58162-174">and 405</span><span class="sxs-lookup"><span data-stu-id="58162-174">and 405</span></span> | <span data-ttu-id="58162-175">None</span><span class="sxs-lookup"><span data-stu-id="58162-175">None</span></span> | <span data-ttu-id="58162-176">1 second</span><span class="sxs-lookup"><span data-stu-id="58162-176">1 second</span></span> | <span data-ttu-id="58162-177">1 second</span><span class="sxs-lookup"><span data-stu-id="58162-177">1 second</span></span>
 
### <a name="deal-with-origin-failure"></a><span data-ttu-id="58162-178">Deal with origin failure</span><span class="sxs-lookup"><span data-stu-id="58162-178">Deal with origin failure</span></span>  

<span data-ttu-id="58162-179">General media delivery and video-on-demand media delivery also have origin timeouts and a retry log based on best practices for typical request patterns.</span><span class="sxs-lookup"><span data-stu-id="58162-179">General media delivery and video-on-demand media delivery also have origin timeouts and a retry log based on best practices for typical request patterns.</span></span> <span data-ttu-id="58162-180">For example, because general media delivery is for live and video-on-demand media delivery, it uses a shorter connection timeout due to the time-sensitive nature of live streaming.</span><span class="sxs-lookup"><span data-stu-id="58162-180">For example, because general media delivery is for live and video-on-demand media delivery, it uses a shorter connection timeout due to the time-sensitive nature of live streaming.</span></span>

<span data-ttu-id="58162-181">When a connection times out, the CDN retries a number of times before it sends a "504 - Gateway Timeout" error to the client.</span><span class="sxs-lookup"><span data-stu-id="58162-181">When a connection times out, the CDN retries a number of times before it sends a "504 - Gateway Timeout" error to the client.</span></span> 

<span data-ttu-id="58162-182">When a file matches the file type and size conditions list, the CDN uses the behavior for media streaming.</span><span class="sxs-lookup"><span data-stu-id="58162-182">When a file matches the file type and size conditions list, the CDN uses the behavior for media streaming.</span></span> <span data-ttu-id="58162-183">Otherwise, it uses general web delivery.</span><span class="sxs-lookup"><span data-stu-id="58162-183">Otherwise, it uses general web delivery.</span></span>
   
### <a name="conditions-for-media-streaming-optimization"></a><span data-ttu-id="58162-184">Conditions for media streaming optimization</span><span class="sxs-lookup"><span data-stu-id="58162-184">Conditions for media streaming optimization</span></span> 

<span data-ttu-id="58162-185">The following table lists the set of criteria to be satisfied for media streaming optimization:</span><span class="sxs-lookup"><span data-stu-id="58162-185">The following table lists the set of criteria to be satisfied for media streaming optimization:</span></span> 
 
<span data-ttu-id="58162-186">Supported streaming types</span><span class="sxs-lookup"><span data-stu-id="58162-186">Supported streaming types</span></span> | <span data-ttu-id="58162-187">File extensions</span><span class="sxs-lookup"><span data-stu-id="58162-187">File extensions</span></span>  
--- | ---  
<span data-ttu-id="58162-188">Apple HLS</span><span class="sxs-lookup"><span data-stu-id="58162-188">Apple HLS</span></span> | <span data-ttu-id="58162-189">m3u8, m3u, m3ub, key, ts, aac</span><span class="sxs-lookup"><span data-stu-id="58162-189">m3u8, m3u, m3ub, key, ts, aac</span></span>
<span data-ttu-id="58162-190">Adobe HDS</span><span class="sxs-lookup"><span data-stu-id="58162-190">Adobe HDS</span></span> | <span data-ttu-id="58162-191">f4m, f4x, drmmeta, bootstrap, f4f,</span><span class="sxs-lookup"><span data-stu-id="58162-191">f4m, f4x, drmmeta, bootstrap, f4f,</span></span><br><span data-ttu-id="58162-192">Seg-Frag URL structure</span><span class="sxs-lookup"><span data-stu-id="58162-192">Seg-Frag URL structure</span></span> <br> <span data-ttu-id="58162-193">(matching regex: ^(/.\*)Seq(\d+)-Frag(\d+)</span><span class="sxs-lookup"><span data-stu-id="58162-193">(matching regex: ^(/.\*)Seq(\d+)-Frag(\d+)</span></span>
<span data-ttu-id="58162-194">DASH</span><span class="sxs-lookup"><span data-stu-id="58162-194">DASH</span></span> | <span data-ttu-id="58162-195">mpd, dash, divx, ismv, m4s, m4v, mp4, mp4v,</span><span class="sxs-lookup"><span data-stu-id="58162-195">mpd, dash, divx, ismv, m4s, m4v, mp4, mp4v,</span></span> <br> <span data-ttu-id="58162-196">sidx, webm, mp4a, m4a, isma</span><span class="sxs-lookup"><span data-stu-id="58162-196">sidx, webm, mp4a, m4a, isma</span></span>
<span data-ttu-id="58162-197">Smooth streaming</span><span class="sxs-lookup"><span data-stu-id="58162-197">Smooth streaming</span></span> | <span data-ttu-id="58162-198">/manifest/, /QualityLevels/Fragments/</span><span class="sxs-lookup"><span data-stu-id="58162-198">/manifest/, /QualityLevels/Fragments/</span></span>
  
 
