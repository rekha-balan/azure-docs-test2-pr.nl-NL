---
title: Grant B2B users in Azure AD access to your on-premises applications | Microsoft Docs
description: Shows how to give cloud B2B users access to on-prem apps with Azure AD B2B collaboration.
services: active-directory
ms.service: active-directory
ms.component: B2B
ms.topic: article
ms.date: 04/20/2018
ms.author: mimart
author: msmimart
manager: mtillman
ms.reviewer: sasubram
ms.openlocfilehash: b7b1279dbb1256269705da3f8be6f6d2c1151368
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44869977"
---
# <a name="grant-b2b-users-in-azure-ad-access-to-your-on-premises-applications"></a><span data-ttu-id="f7797-103">Grant B2B users in Azure AD access to your on-premises applications</span><span class="sxs-lookup"><span data-stu-id="f7797-103">Grant B2B users in Azure AD access to your on-premises applications</span></span>

<span data-ttu-id="f7797-104">As an organization that uses Azure Active Directory (Azure AD) B2B collaboration capabilities to invite guest users from partner organizations to your Azure AD, you can now provide these B2B users access to on-premises apps.</span><span class="sxs-lookup"><span data-stu-id="f7797-104">As an organization that uses Azure Active Directory (Azure AD) B2B collaboration capabilities to invite guest users from partner organizations to your Azure AD, you can now provide these B2B users access to on-premises apps.</span></span> <span data-ttu-id="f7797-105">These on-premises apps can use SAML-based authentication or Integrated Windows Authentication (IWA) with Kerberos constrained delegation (KCD).</span><span class="sxs-lookup"><span data-stu-id="f7797-105">These on-premises apps can use SAML-based authentication or Integrated Windows Authentication (IWA) with Kerberos constrained delegation (KCD).</span></span>

## <a name="access-to-saml-apps"></a><span data-ttu-id="f7797-106">Access to SAML apps</span><span class="sxs-lookup"><span data-stu-id="f7797-106">Access to SAML apps</span></span>

<span data-ttu-id="f7797-107">If your on-premises app uses SAML-based authentication, you can easily make these apps available to your Azure AD B2B collaboration users through the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="f7797-107">If your on-premises app uses SAML-based authentication, you can easily make these apps available to your Azure AD B2B collaboration users through the Azure portal.</span></span>

<span data-ttu-id="f7797-108">You must do both of the following:</span><span class="sxs-lookup"><span data-stu-id="f7797-108">You must do both of the following:</span></span>

- <span data-ttu-id="f7797-109">Integrate the SAML app by using the non-gallery application template, as described in [Configuring single sign-on to applications that are not in the Azure Active Directory application gallery](../manage-apps/configure-single-sign-on-non-gallery-applications.md).</span><span class="sxs-lookup"><span data-stu-id="f7797-109">Integrate the SAML app by using the non-gallery application template, as described in [Configuring single sign-on to applications that are not in the Azure Active Directory application gallery](../manage-apps/configure-single-sign-on-non-gallery-applications.md).</span></span> <span data-ttu-id="f7797-110">Make sure to note what you use for the **Sign-on URL** value.</span><span class="sxs-lookup"><span data-stu-id="f7797-110">Make sure to note what you use for the **Sign-on URL** value.</span></span>
-  <span data-ttu-id="f7797-111">Use Azure AD Application Proxy to publish the on-premises app, with **Azure Active Directory** configured as the authentication source.</span><span class="sxs-lookup"><span data-stu-id="f7797-111">Use Azure AD Application Proxy to publish the on-premises app, with **Azure Active Directory** configured as the authentication source.</span></span> <span data-ttu-id="f7797-112">For instructions, see [Publish applications using Azure AD Application Proxy](../manage-apps/application-proxy-publish-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="f7797-112">For instructions, see [Publish applications using Azure AD Application Proxy](../manage-apps/application-proxy-publish-azure-portal.md).</span></span> 

   <span data-ttu-id="f7797-113">When you configure the **Internal Url** setting, use the sign-on URL that you specified in the non-gallery application template.</span><span class="sxs-lookup"><span data-stu-id="f7797-113">When you configure the **Internal Url** setting, use the sign-on URL that you specified in the non-gallery application template.</span></span> <span data-ttu-id="f7797-114">In this way, users can access the app from outside the organization boundary.</span><span class="sxs-lookup"><span data-stu-id="f7797-114">In this way, users can access the app from outside the organization boundary.</span></span> <span data-ttu-id="f7797-115">Application Proxy performs the SAML single sign-on for the on-premises app.</span><span class="sxs-lookup"><span data-stu-id="f7797-115">Application Proxy performs the SAML single sign-on for the on-premises app.</span></span>
 
   ![Shows on-premises app settings internal URL and authentication](media/hybrid-cloud-to-on-premises/OnPremAppSettings.PNG)

## <a name="access-to-iwa-and-kcd-apps"></a><span data-ttu-id="f7797-117">Access to IWA and KCD apps</span><span class="sxs-lookup"><span data-stu-id="f7797-117">Access to IWA and KCD apps</span></span>

<span data-ttu-id="f7797-118">To provide B2B users access to on-premises applications that are secured with Integrated Windows Authentication and Kerberos constrained delegation, you need the following components:</span><span class="sxs-lookup"><span data-stu-id="f7797-118">To provide B2B users access to on-premises applications that are secured with Integrated Windows Authentication and Kerberos constrained delegation, you need the following components:</span></span>

- <span data-ttu-id="f7797-119">**Authentication through Azure AD Application Proxy**.</span><span class="sxs-lookup"><span data-stu-id="f7797-119">**Authentication through Azure AD Application Proxy**.</span></span> <span data-ttu-id="f7797-120">B2B users must be able to authenticate to the on-premises application.</span><span class="sxs-lookup"><span data-stu-id="f7797-120">B2B users must be able to authenticate to the on-premises application.</span></span> <span data-ttu-id="f7797-121">To do this, you must publish the on-premises app through the Azure AD Application Proxy.</span><span class="sxs-lookup"><span data-stu-id="f7797-121">To do this, you must publish the on-premises app through the Azure AD Application Proxy.</span></span> <span data-ttu-id="f7797-122">For more information, see [Get started with Application Proxy and install the connector](../manage-apps/application-proxy-enable.md) and [Publish applications using Azure AD Application Proxy](../manage-apps/application-proxy-publish-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="f7797-122">For more information, see [Get started with Application Proxy and install the connector](../manage-apps/application-proxy-enable.md) and [Publish applications using Azure AD Application Proxy](../manage-apps/application-proxy-publish-azure-portal.md).</span></span>
- <span data-ttu-id="f7797-123">**Authorization via a B2B user object in the on-premises directory**.</span><span class="sxs-lookup"><span data-stu-id="f7797-123">**Authorization via a B2B user object in the on-premises directory**.</span></span> <span data-ttu-id="f7797-124">The application must be able to perform user access checks, and grant access to the correct resources.</span><span class="sxs-lookup"><span data-stu-id="f7797-124">The application must be able to perform user access checks, and grant access to the correct resources.</span></span> <span data-ttu-id="f7797-125">IWA and KCD require a user object in the on-premises Windows Server Active Directory to complete this authorization.</span><span class="sxs-lookup"><span data-stu-id="f7797-125">IWA and KCD require a user object in the on-premises Windows Server Active Directory to complete this authorization.</span></span> <span data-ttu-id="f7797-126">As described in [How single sign-on with KCD works](../manage-apps/application-proxy-configure-single-sign-on-with-kcd.md#how-single-sign-on-with-kcd-works), Application Proxy needs this user object to impersonate the user and get a Kerberos token to the app.</span><span class="sxs-lookup"><span data-stu-id="f7797-126">As described in [How single sign-on with KCD works](../manage-apps/application-proxy-configure-single-sign-on-with-kcd.md#how-single-sign-on-with-kcd-works), Application Proxy needs this user object to impersonate the user and get a Kerberos token to the app.</span></span> 

   <span data-ttu-id="f7797-127">For the B2B user scenario, there are two methods available that you can use to create the guest user objects that are required for authorization in the on-premises directory:</span><span class="sxs-lookup"><span data-stu-id="f7797-127">For the B2B user scenario, there are two methods available that you can use to create the guest user objects that are required for authorization in the on-premises directory:</span></span>

   - <span data-ttu-id="f7797-128">Microsoft Identity Manager (MIM) and the [MIM management agent for Microsoft Graph](#create-b2b-guest-user-objects-through-mim-preview).</span><span class="sxs-lookup"><span data-stu-id="f7797-128">Microsoft Identity Manager (MIM) and the [MIM management agent for Microsoft Graph](#create-b2b-guest-user-objects-through-mim-preview).</span></span> 
   - <span data-ttu-id="f7797-129">[A PowerShell script](#create-b2b-guest-user-objects-through-a-script-preview).</span><span class="sxs-lookup"><span data-stu-id="f7797-129">[A PowerShell script](#create-b2b-guest-user-objects-through-a-script-preview).</span></span> <span data-ttu-id="f7797-130">Using the script is a more lightweight solution that does not require MIM.</span><span class="sxs-lookup"><span data-stu-id="f7797-130">Using the script is a more lightweight solution that does not require MIM.</span></span> 

<span data-ttu-id="f7797-131">The following diagram provides a high-level overview of how Azure AD Application Proxy and the generation of the B2B user object in the on-premises directory work together to grant B2B users access to your on-premises IWA and KCD apps.</span><span class="sxs-lookup"><span data-stu-id="f7797-131">The following diagram provides a high-level overview of how Azure AD Application Proxy and the generation of the B2B user object in the on-premises directory work together to grant B2B users access to your on-premises IWA and KCD apps.</span></span> <span data-ttu-id="f7797-132">The numbered steps are described in detail below the diagram.</span><span class="sxs-lookup"><span data-stu-id="f7797-132">The numbered steps are described in detail below the diagram.</span></span>

![Diagram of MIM and B2B script solutions](media/hybrid-cloud-to-on-premises/MIMScriptSolution.PNG)

1.  <span data-ttu-id="f7797-134">A user from a partner organization (the Fabrikam tenant) is invited to the Contoso tenant.</span><span class="sxs-lookup"><span data-stu-id="f7797-134">A user from a partner organization (the Fabrikam tenant) is invited to the Contoso tenant.</span></span>
2.  <span data-ttu-id="f7797-135">A guest user object is created in the Contoso tenant (for example, a user object with a UPN of guest_fabrikam.com#EXT#@contoso.onmicrosoft.com).</span><span class="sxs-lookup"><span data-stu-id="f7797-135">A guest user object is created in the Contoso tenant (for example, a user object with a UPN of guest_fabrikam.com#EXT#@contoso.onmicrosoft.com).</span></span>
3.  <span data-ttu-id="f7797-136">The Fabrikam guest is imported from Contoso through MIM or through the B2B PowerShell script.</span><span class="sxs-lookup"><span data-stu-id="f7797-136">The Fabrikam guest is imported from Contoso through MIM or through the B2B PowerShell script.</span></span>
4.  <span data-ttu-id="f7797-137">A representation or “footprint” of the Fabrikam guest user object (Guest#EXT#) is created in the on-premises directory, Contoso.com, through MIM or through the B2B PowerShell script.</span><span class="sxs-lookup"><span data-stu-id="f7797-137">A representation or “footprint” of the Fabrikam guest user object (Guest#EXT#) is created in the on-premises directory, Contoso.com, through MIM or through the B2B PowerShell script.</span></span>
5.  <span data-ttu-id="f7797-138">The guest user accesses the on-premises application, app.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="f7797-138">The guest user accesses the on-premises application, app.contoso.com.</span></span>
6.  <span data-ttu-id="f7797-139">The authentication request is authorized through Application Proxy, using Kerberos constrained delegation.</span><span class="sxs-lookup"><span data-stu-id="f7797-139">The authentication request is authorized through Application Proxy, using Kerberos constrained delegation.</span></span> 
7.  <span data-ttu-id="f7797-140">Because the guest user object exists locally, the authentication is successful.</span><span class="sxs-lookup"><span data-stu-id="f7797-140">Because the guest user object exists locally, the authentication is successful.</span></span>

### <a name="lifecycle-management-policies"></a><span data-ttu-id="f7797-141">Lifecycle management policies</span><span class="sxs-lookup"><span data-stu-id="f7797-141">Lifecycle management policies</span></span>

<span data-ttu-id="f7797-142">You can manage the on-premises B2B user objects through lifecycle management policies.</span><span class="sxs-lookup"><span data-stu-id="f7797-142">You can manage the on-premises B2B user objects through lifecycle management policies.</span></span> <span data-ttu-id="f7797-143">For example:</span><span class="sxs-lookup"><span data-stu-id="f7797-143">For example:</span></span>

- <span data-ttu-id="f7797-144">You can set up multi-factor authentication (MFA) policies for the Guest user so that MFA is used during Application Proxy authentication.</span><span class="sxs-lookup"><span data-stu-id="f7797-144">You can set up multi-factor authentication (MFA) policies for the Guest user so that MFA is used during Application Proxy authentication.</span></span> <span data-ttu-id="f7797-145">For more information, see [Conditional access for B2B collaboration users](conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="f7797-145">For more information, see [Conditional access for B2B collaboration users](conditional-access.md).</span></span>
- <span data-ttu-id="f7797-146">Any sponsorships, access reviews, account verifications, etc. that are performed on the cloud B2B user applies to the on-premises users.</span><span class="sxs-lookup"><span data-stu-id="f7797-146">Any sponsorships, access reviews, account verifications, etc. that are performed on the cloud B2B user applies to the on-premises users.</span></span> <span data-ttu-id="f7797-147">For example, if the cloud user is deleted through your lifecycle management policies, the on-premises user is also deleted by MIM Sync or through Azure AD Connect sync. For more information, see [Manage guest access with Azure AD access reviews](../active-directory-azure-ad-controls-manage-guest-access-with-access-reviews.md).</span><span class="sxs-lookup"><span data-stu-id="f7797-147">For example, if the cloud user is deleted through your lifecycle management policies, the on-premises user is also deleted by MIM Sync or through Azure AD Connect sync. For more information, see [Manage guest access with Azure AD access reviews](../active-directory-azure-ad-controls-manage-guest-access-with-access-reviews.md).</span></span>

### <a name="create-b2b-guest-user-objects-through-mim-preview"></a><span data-ttu-id="f7797-148">Create B2B guest user objects through MIM (Preview)</span><span class="sxs-lookup"><span data-stu-id="f7797-148">Create B2B guest user objects through MIM (Preview)</span></span>

<span data-ttu-id="f7797-149">For information about how to use MIM 2016 Service Pack 1 and the MIM management agent for Microsoft Graph to create the guest user objects in the on-premises directory, see [Azure AD business-to-business (B2B) collaboration with Microsoft Identity Manager (MIM) 2016 SP1 with Azure Application Proxy (Public Preview)](https://docs.microsoft.com/microsoft-identity-manager/microsoft-identity-manager-2016-graph-b2b-scenario).</span><span class="sxs-lookup"><span data-stu-id="f7797-149">For information about how to use MIM 2016 Service Pack 1 and the MIM management agent for Microsoft Graph to create the guest user objects in the on-premises directory, see [Azure AD business-to-business (B2B) collaboration with Microsoft Identity Manager (MIM) 2016 SP1 with Azure Application Proxy (Public Preview)](https://docs.microsoft.com/microsoft-identity-manager/microsoft-identity-manager-2016-graph-b2b-scenario).</span></span>

### <a name="create-b2b-guest-user-objects-through-a-script-preview"></a><span data-ttu-id="f7797-150">Create B2B guest user objects through a script (Preview)</span><span class="sxs-lookup"><span data-stu-id="f7797-150">Create B2B guest user objects through a script (Preview)</span></span>

<span data-ttu-id="f7797-151">There’s a PowerShell sample script available that you can use as a starting point to create the guest user objects in your on-premises Active Directory.</span><span class="sxs-lookup"><span data-stu-id="f7797-151">There’s a PowerShell sample script available that you can use as a starting point to create the guest user objects in your on-premises Active Directory.</span></span>

<span data-ttu-id="f7797-152">You can download the script and the Readme file from the [Download Center](https://www.microsoft.com/download/details.aspx?id=51495).</span><span class="sxs-lookup"><span data-stu-id="f7797-152">You can download the script and the Readme file from the [Download Center](https://www.microsoft.com/download/details.aspx?id=51495).</span></span> <span data-ttu-id="f7797-153">Choose the **Script and Readme to pull Azure AD B2B users on-prem.zip** file.</span><span class="sxs-lookup"><span data-stu-id="f7797-153">Choose the **Script and Readme to pull Azure AD B2B users on-prem.zip** file.</span></span>

<span data-ttu-id="f7797-154">Before you use the script, make sure that you review the prerequisites and important considerations in the associated Readme file.</span><span class="sxs-lookup"><span data-stu-id="f7797-154">Before you use the script, make sure that you review the prerequisites and important considerations in the associated Readme file.</span></span> <span data-ttu-id="f7797-155">Also, understand that the script is made available only as a sample.</span><span class="sxs-lookup"><span data-stu-id="f7797-155">Also, understand that the script is made available only as a sample.</span></span> <span data-ttu-id="f7797-156">Your development team or a partner must customize and review the script before you run it.</span><span class="sxs-lookup"><span data-stu-id="f7797-156">Your development team or a partner must customize and review the script before you run it.</span></span>

## <a name="license-considerations"></a><span data-ttu-id="f7797-157">License considerations</span><span class="sxs-lookup"><span data-stu-id="f7797-157">License considerations</span></span>

<span data-ttu-id="f7797-158">Make sure that you have the correct Client Access Licenses (CALs) for external guest users who access on-premises apps.</span><span class="sxs-lookup"><span data-stu-id="f7797-158">Make sure that you have the correct Client Access Licenses (CALs) for external guest users who access on-premises apps.</span></span> <span data-ttu-id="f7797-159">For more information, see the "External Connectors" section of [Client Access Licenses and Management Licenses](https://www.microsoft.com/licensing/product-licensing/client-access-license.aspx).</span><span class="sxs-lookup"><span data-stu-id="f7797-159">For more information, see the "External Connectors" section of [Client Access Licenses and Management Licenses](https://www.microsoft.com/licensing/product-licensing/client-access-license.aspx).</span></span> <span data-ttu-id="f7797-160">Consult your Microsoft representative or local reseller regarding your specific licensing needs.</span><span class="sxs-lookup"><span data-stu-id="f7797-160">Consult your Microsoft representative or local reseller regarding your specific licensing needs.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f7797-161">Next steps</span><span class="sxs-lookup"><span data-stu-id="f7797-161">Next steps</span></span>

- [<span data-ttu-id="f7797-162">Azure Active Directory B2B collaboration for hybrid organizations</span><span class="sxs-lookup"><span data-stu-id="f7797-162">Azure Active Directory B2B collaboration for hybrid organizations</span></span>](hybrid-organizations.md)

- <span data-ttu-id="f7797-163">For an overview of Azure AD Connect, see [Integrate your on-premises directories with Azure Active Directory](../connect/active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="f7797-163">For an overview of Azure AD Connect, see [Integrate your on-premises directories with Azure Active Directory](../connect/active-directory-aadconnect.md).</span></span>

