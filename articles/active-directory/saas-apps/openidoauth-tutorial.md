---
title: Steps to configure an OpenID/OAuth application from Azure AD App gallery | Microsoft Docs
description: Steps to configure an OpenID/OAuth application from Azure AD App gallery.
services: active-directory
documentationCenter: na
author: jeevansd
manager: femila
ms.assetid: eedebb76-e78c-428f-9cf0-5891852e79fb
ms.service: active-directory
ms.component: saas-app-tutorial
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/25/2018
ms.author: jeedes
ms.openlocfilehash: 69e9d66458409bbc744416a58ceb508349418a76
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44966181"
---
# <a name="steps-to-configure-an-openidoauth-application-from-azure-ad-app-gallery"></a><span data-ttu-id="ddcc9-103">Steps to configure an OpenID/OAuth application from Azure AD App gallery</span><span class="sxs-lookup"><span data-stu-id="ddcc9-103">Steps to configure an OpenID/OAuth application from Azure AD App gallery</span></span>

## <a name="process-of-open-id-application-addition-from-gallery"></a><span data-ttu-id="ddcc9-104">Process of Open ID application addition from gallery</span><span class="sxs-lookup"><span data-stu-id="ddcc9-104">Process of Open ID application addition from gallery</span></span>

1. <span data-ttu-id="ddcc9-105">In the **[Azure portal](https://portal.azure.com)**, on the left navigation panel, click **Azure Active Directory** icon.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-105">In the **[Azure portal](https://portal.azure.com)**, on the left navigation panel, click **Azure Active Directory** icon.</span></span> 

    ![The Azure Active Directory button](./media/openidoauth-tutorial/tutorial_general_01.png)

2. <span data-ttu-id="ddcc9-107">Navigate to **Enterprise applications**.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-107">Navigate to **Enterprise applications**.</span></span> <span data-ttu-id="ddcc9-108">Then go to **All applications**.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-108">Then go to **All applications**.</span></span>

    ![The Enterprise applications blade](./media/openidoauth-tutorial/tutorial_general_02.png)

3. <span data-ttu-id="ddcc9-110">To add new application, click **New application** button on the top of dialog.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-110">To add new application, click **New application** button on the top of dialog.</span></span>

    ![The New application button](./media/openidoauth-tutorial/tutorial_general_03.png)

4. <span data-ttu-id="ddcc9-112">In the search box, type **Application name**, select the **desired application** from result panel and sign up to the application.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-112">In the search box, type **Application name**, select the **desired application** from result panel and sign up to the application.</span></span>

    ![Adding application](./media/openidoauth-tutorial/addfromgallery.png)

    > [!NOTE]
    > <span data-ttu-id="ddcc9-114">For Open ID Connect and OAuth apps the Add button is disabled by default.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-114">For Open ID Connect and OAuth apps the Add button is disabled by default.</span></span> <span data-ttu-id="ddcc9-115">Here the tenant admin should click on the **sign-up** button and provide the consent to the application.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-115">Here the tenant admin should click on the **sign-up** button and provide the consent to the application.</span></span> <span data-ttu-id="ddcc9-116">With that the application will get added into the customer tenant, no need to add explicitly, and do the configurations.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-116">With that the application will get added into the customer tenant, no need to add explicitly, and do the configurations.</span></span>

    ![Add button](./media/openidoauth-tutorial/addbutton.png)

5. <span data-ttu-id="ddcc9-118">When you click on sign up link, you are redirected to Azure AD page for login credentials.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-118">When you click on sign up link, you are redirected to Azure AD page for login credentials.</span></span>

6. <span data-ttu-id="ddcc9-119">After successful authentication, user has to accept the consent from consent page and after that, the application homepage will be displayed.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-119">After successful authentication, user has to accept the consent from consent page and after that, the application homepage will be displayed.</span></span>

    > [!NOTE]
    > <span data-ttu-id="ddcc9-120">Customers are allowed to only add one instance of the application.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-120">Customers are allowed to only add one instance of the application.</span></span> <span data-ttu-id="ddcc9-121">If you have already added one and tried to provide the consent again it will not be added again in the tenant.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-121">If you have already added one and tried to provide the consent again it will not be added again in the tenant.</span></span> <span data-ttu-id="ddcc9-122">So logically they can use only one app instance in the tenant.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-122">So logically they can use only one app instance in the tenant.</span></span>

## <a name="authentication-flow-using-openid-connect"></a><span data-ttu-id="ddcc9-123">Authentication flow using OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="ddcc9-123">Authentication flow using OpenID Connect</span></span>

<span data-ttu-id="ddcc9-124">The most basic sign-in flow contains the following steps - each of them is described in detail below.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-124">The most basic sign-in flow contains the following steps - each of them is described in detail below.</span></span>

![Authentication flow using OpenID Connect](./media/openidoauth-tutorial/authenticationflow.png)

* <span data-ttu-id="ddcc9-126">**Multi-tenant application** - A multi-tenant application is intended for use in many organizations, not just one organization.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-126">**Multi-tenant application** - A multi-tenant application is intended for use in many organizations, not just one organization.</span></span> <span data-ttu-id="ddcc9-127">These are typically software-as-a-service (SaaS) applications written by an independent software vendor (ISV).</span><span class="sxs-lookup"><span data-stu-id="ddcc9-127">These are typically software-as-a-service (SaaS) applications written by an independent software vendor (ISV).</span></span> <span data-ttu-id="ddcc9-128">Multi-tenant applications need to be provisioned in each directory where they will be used, which requires user or administrator consent to register them.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-128">Multi-tenant applications need to be provisioned in each directory where they will be used, which requires user or administrator consent to register them.</span></span> <span data-ttu-id="ddcc9-129">This consent process starts when an application has been registered in the directory and is given access to the Graph API or perhaps another web API.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-129">This consent process starts when an application has been registered in the directory and is given access to the Graph API or perhaps another web API.</span></span> <span data-ttu-id="ddcc9-130">When a user or administrator from a different organization sign up to use the application, they are presented with a dialog that displays the permissions the application requires.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-130">When a user or administrator from a different organization sign up to use the application, they are presented with a dialog that displays the permissions the application requires.</span></span> <span data-ttu-id="ddcc9-131">The user or administrator can then consent to the application, which gives the application access to the stated data, and finally registers the application in their directory.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-131">The user or administrator can then consent to the application, which gives the application access to the stated data, and finally registers the application in their directory.</span></span>

    > [!NOTE]
    > <span data-ttu-id="ddcc9-132">If you are making your application available to users in multiple directories, you need a mechanism to determine which tenant they’re in.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-132">If you are making your application available to users in multiple directories, you need a mechanism to determine which tenant they’re in.</span></span> <span data-ttu-id="ddcc9-133">A single tenant application only needs to look in its own directory for a user, while a multi-tenant application needs to identify a specific user from all the directories in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-133">A single tenant application only needs to look in its own directory for a user, while a multi-tenant application needs to identify a specific user from all the directories in Azure AD.</span></span> <span data-ttu-id="ddcc9-134">To accomplish this task, Azure AD provides a common authentication endpoint where any multi-tenant application can direct sign-in requests, instead of a tenant-specific endpoint.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-134">To accomplish this task, Azure AD provides a common authentication endpoint where any multi-tenant application can direct sign-in requests, instead of a tenant-specific endpoint.</span></span> <span data-ttu-id="ddcc9-135">This endpoint is [https://login.microsoftonline.com/common](https://login.microsoftonline.com/common) for all directories in Azure AD, whereas a tenant-specific endpoint might be [https://login.microsoftonline.com/contoso.onmicrosoft.com](https://login.microsoftonline.com/contoso.onmicrosoft.com).</span><span class="sxs-lookup"><span data-stu-id="ddcc9-135">This endpoint is [https://login.microsoftonline.com/common](https://login.microsoftonline.com/common) for all directories in Azure AD, whereas a tenant-specific endpoint might be [https://login.microsoftonline.com/contoso.onmicrosoft.com](https://login.microsoftonline.com/contoso.onmicrosoft.com).</span></span> <span data-ttu-id="ddcc9-136">The common endpoint is especially important to consider when developing your application because you’ll need the necessary logic to handle multiple tenants during sign-in, sign-out, and token validation.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-136">The common endpoint is especially important to consider when developing your application because you’ll need the necessary logic to handle multiple tenants during sign-in, sign-out, and token validation.</span></span>

<span data-ttu-id="ddcc9-137">Azure AD team by default promotes multi-tenant application as that can be easily accessed across various organizations and is easy to use after accepting the consent.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-137">Azure AD team by default promotes multi-tenant application as that can be easily accessed across various organizations and is easy to use after accepting the consent.</span></span>

## <a name="what-is-consent-framework"></a><span data-ttu-id="ddcc9-138">What is Consent Framework?</span><span class="sxs-lookup"><span data-stu-id="ddcc9-138">What is Consent Framework?</span></span>

<span data-ttu-id="ddcc9-139">The Azure AD consent framework makes it easy to develop multi-tenant web and native client applications.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-139">The Azure AD consent framework makes it easy to develop multi-tenant web and native client applications.</span></span> <span data-ttu-id="ddcc9-140">These applications allow sign-in by user accounts from an Azure AD tenant, different from the one where the application is registered.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-140">These applications allow sign-in by user accounts from an Azure AD tenant, different from the one where the application is registered.</span></span> <span data-ttu-id="ddcc9-141">They may also need to access web APIs such as the Microsoft Graph API (to access Azure Active Directory, Intune, and services in Office 365) and other Microsoft services' APIs, in addition to your own web APIs.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-141">They may also need to access web APIs such as the Microsoft Graph API (to access Azure Active Directory, Intune, and services in Office 365) and other Microsoft services' APIs, in addition to your own web APIs.</span></span> <span data-ttu-id="ddcc9-142">The framework is based on a user or an administrator giving consent to an application that asks to be registered in their directory, which may involve accessing directory data.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-142">The framework is based on a user or an administrator giving consent to an application that asks to be registered in their directory, which may involve accessing directory data.</span></span> <span data-ttu-id="ddcc9-143">After consent is given, the client application will be able to call the Microsoft Graph API on behalf of the user, and use the information as needed.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-143">After consent is given, the client application will be able to call the Microsoft Graph API on behalf of the user, and use the information as needed.</span></span>

<span data-ttu-id="ddcc9-144">The [Microsoft Graph API](https://graph.microsoft.io/) provides access to data in Office 365 (like calendars and messages from Exchange, sites and lists from SharePoint, documents from OneDrive, notebooks from OneNote, tasks from Planner, workbooks from Excel, etc.), as well as users and groups from Azure AD and other data objects from more Microsoft cloud services.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-144">The [Microsoft Graph API](https://graph.microsoft.io/) provides access to data in Office 365 (like calendars and messages from Exchange, sites and lists from SharePoint, documents from OneDrive, notebooks from OneNote, tasks from Planner, workbooks from Excel, etc.), as well as users and groups from Azure AD and other data objects from more Microsoft cloud services.</span></span>

<span data-ttu-id="ddcc9-145">The following steps show you how the consent experience works for both the application developer and user.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-145">The following steps show you how the consent experience works for both the application developer and user.</span></span>

1. <span data-ttu-id="ddcc9-146">Assume you have a web client application that needs to request specific permissions to access a resource/API.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-146">Assume you have a web client application that needs to request specific permissions to access a resource/API.</span></span> <span data-ttu-id="ddcc9-147">The Azure portal is used to declare permission requests at configuration time.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-147">The Azure portal is used to declare permission requests at configuration time.</span></span> <span data-ttu-id="ddcc9-148">Like other configuration settings, they become part of the application's Azure AD registration:</span><span class="sxs-lookup"><span data-stu-id="ddcc9-148">Like other configuration settings, they become part of the application's Azure AD registration:</span></span>

    ![Graph API](./media/openidoauth-tutorial/graphapi.png)

2. <span data-ttu-id="ddcc9-150">Consider that your application’s permissions have been updated, the application is running, and a user is about to use it for the first time.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-150">Consider that your application’s permissions have been updated, the application is running, and a user is about to use it for the first time.</span></span> <span data-ttu-id="ddcc9-151">First the application needs to obtain an authorization code from Azure AD’s /authorize endpoint.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-151">First the application needs to obtain an authorization code from Azure AD’s /authorize endpoint.</span></span> <span data-ttu-id="ddcc9-152">The authorization code can then be used to acquire a new access and refresh token.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-152">The authorization code can then be used to acquire a new access and refresh token.</span></span>

3. <span data-ttu-id="ddcc9-153">If the user is not already authenticated, Azure AD's /authorize endpoint prompts for sign-in.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-153">If the user is not already authenticated, Azure AD's /authorize endpoint prompts for sign-in.</span></span>

    ![Authentication](./media/openidoauth-tutorial/authentication.png)

4. <span data-ttu-id="ddcc9-155">After the user has signed in, Azure AD will determine if the user needs to be shown a consent page.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-155">After the user has signed in, Azure AD will determine if the user needs to be shown a consent page.</span></span> <span data-ttu-id="ddcc9-156">This determination is based on whether the user (or their organization’s administrator) has already granted the application consent.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-156">This determination is based on whether the user (or their organization’s administrator) has already granted the application consent.</span></span> <span data-ttu-id="ddcc9-157">If consent has not already been granted, Azure AD prompts the user for consent and displays the required permissions it needs to function.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-157">If consent has not already been granted, Azure AD prompts the user for consent and displays the required permissions it needs to function.</span></span> <span data-ttu-id="ddcc9-158">The set of permissions that is displayed in the consent dialog match the ones selected in the Delegated Permissions in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-158">The set of permissions that is displayed in the consent dialog match the ones selected in the Delegated Permissions in the Azure portal.</span></span>

    ![Consent page](./media/openidoauth-tutorial/consentpage.png)

<span data-ttu-id="ddcc9-160">Some permissions can be consented to by a regular user, while others require a tenant administrator’s consent.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-160">Some permissions can be consented to by a regular user, while others require a tenant administrator’s consent.</span></span>

## <a name="whats-the-difference-between-admin-consent-and-user-consent"></a><span data-ttu-id="ddcc9-161">What’s the difference between Admin consent and User consent?</span><span class="sxs-lookup"><span data-stu-id="ddcc9-161">What’s the difference between Admin consent and User consent?</span></span>

<span data-ttu-id="ddcc9-162">As an administrator, you can also consent to an application's delegated permissions on behalf of all the users in your tenant.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-162">As an administrator, you can also consent to an application's delegated permissions on behalf of all the users in your tenant.</span></span> <span data-ttu-id="ddcc9-163">Administrative consent prevents the consent dialog from appearing for every user in the tenant and can be done in the Azure portal by users with the administrator role.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-163">Administrative consent prevents the consent dialog from appearing for every user in the tenant and can be done in the Azure portal by users with the administrator role.</span></span> <span data-ttu-id="ddcc9-164">From the Settings page for your application, click Required Permissions and click on the Grant Permissions button.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-164">From the Settings page for your application, click Required Permissions and click on the Grant Permissions button.</span></span>

![Grant Permission](./media/openidoauth-tutorial/grantpermission.png)

> [!NOTE]
> <span data-ttu-id="ddcc9-166">Granting explicit consent using the Grant Permissions button is currently required for single page applications (SPA) that use ADAL.js.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-166">Granting explicit consent using the Grant Permissions button is currently required for single page applications (SPA) that use ADAL.js.</span></span> <span data-ttu-id="ddcc9-167">Otherwise, the application fails when the access token is requested.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-167">Otherwise, the application fails when the access token is requested.</span></span>

<span data-ttu-id="ddcc9-168">App-only permissions always require a tenant administrator’s consent.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-168">App-only permissions always require a tenant administrator’s consent.</span></span> <span data-ttu-id="ddcc9-169">If your application requests an app-only permission and a user tries to sign in to the application, an error message is displayed saying the user isn’t able to consent.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-169">If your application requests an app-only permission and a user tries to sign in to the application, an error message is displayed saying the user isn’t able to consent.</span></span>

<span data-ttu-id="ddcc9-170">If your application uses permissions that require admin consent, you need to have a gesture such as a button or link where the admin can initiate the action.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-170">If your application uses permissions that require admin consent, you need to have a gesture such as a button or link where the admin can initiate the action.</span></span> <span data-ttu-id="ddcc9-171">The request your application sends for this action is the usual OAuth2/OpenID Connect authorization request that also includes the prompt=admin_consent query string parameter.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-171">The request your application sends for this action is the usual OAuth2/OpenID Connect authorization request that also includes the prompt=admin_consent query string parameter.</span></span> <span data-ttu-id="ddcc9-172">Once the admin has consented and the service principal is created in the customer’s tenant, subsequent sign-in requests do not need the prompt=admin_consent parameter.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-172">Once the admin has consented and the service principal is created in the customer’s tenant, subsequent sign-in requests do not need the prompt=admin_consent parameter.</span></span> <span data-ttu-id="ddcc9-173">Since the administrator has decided the requested permissions are acceptable, no other users in the tenant are prompted for consent from that point forward.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-173">Since the administrator has decided the requested permissions are acceptable, no other users in the tenant are prompted for consent from that point forward.</span></span> <span data-ttu-id="ddcc9-174">A tenant administrator can disable the ability for regular users to consent to applications.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-174">A tenant administrator can disable the ability for regular users to consent to applications.</span></span> <span data-ttu-id="ddcc9-175">If this capability is disabled, admin consent is always required for the application to be used in the tenant.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-175">If this capability is disabled, admin consent is always required for the application to be used in the tenant.</span></span> <span data-ttu-id="ddcc9-176">If you want to test your application with end-user consent disabled, you can find the configuration switch in the [Azure portal](https://portal.azure.com/) in the [User settings](https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/UserSettings/menuId/) section under **Enterprise applications**</span><span class="sxs-lookup"><span data-stu-id="ddcc9-176">If you want to test your application with end-user consent disabled, you can find the configuration switch in the [Azure portal](https://portal.azure.com/) in the [User settings](https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/UserSettings/menuId/) section under **Enterprise applications**</span></span>

<span data-ttu-id="ddcc9-177">The prompt=admin_consent parameter can also be used by applications that request permissions that do not require admin consent.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-177">The prompt=admin_consent parameter can also be used by applications that request permissions that do not require admin consent.</span></span> <span data-ttu-id="ddcc9-178">An example of when this would be used is if the application requires an experience where the tenant admin “signs up” one time, and no other users are prompted for consent from that point on.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-178">An example of when this would be used is if the application requires an experience where the tenant admin “signs up” one time, and no other users are prompted for consent from that point on.</span></span>

<span data-ttu-id="ddcc9-179">If an application requires admin consent and an admin signs in without the prompt=admin_consent parameter being sent, when the admin successfully consents to the application it applies only for their user account.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-179">If an application requires admin consent and an admin signs in without the prompt=admin_consent parameter being sent, when the admin successfully consents to the application it applies only for their user account.</span></span> <span data-ttu-id="ddcc9-180">Regular users will still not be able to sign in or consent to the application.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-180">Regular users will still not be able to sign in or consent to the application.</span></span> <span data-ttu-id="ddcc9-181">This feature is useful if you want to give the tenant administrator the ability to explore your application before allowing other users access.</span><span class="sxs-lookup"><span data-stu-id="ddcc9-181">This feature is useful if you want to give the tenant administrator the ability to explore your application before allowing other users access.</span></span>