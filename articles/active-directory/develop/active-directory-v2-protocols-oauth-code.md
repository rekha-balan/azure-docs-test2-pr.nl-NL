---
title: Azure AD v2.0 OAuth Authorization Code Flow | Microsoft Docs
description: Building web applications using Azure AD's implementation of the OAuth 2.0 authentication protocol.
services: active-directory
documentationcenter: ''
author: dstrockis
manager: mbaldwin
editor: ''
ms.assetid: ae1d7d86-7098-468c-aa32-20df0a10ee3d
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.openlocfilehash: 5e3d84b08b7b7c6db1b7d8e31f0def4a6c7c1336
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44549809"
---
# <a name="v20-protocols---oauth-20-authorization-code-flow"></a><span data-ttu-id="7091f-103">v2.0 Protocols - OAuth 2.0 Authorization Code Flow</span><span class="sxs-lookup"><span data-stu-id="7091f-103">v2.0 Protocols - OAuth 2.0 Authorization Code Flow</span></span>
<span data-ttu-id="7091f-104">The OAuth 2.0 authorization code grant can be used in apps that are installed on a device to gain access to protected resources, such as web APIs.</span><span class="sxs-lookup"><span data-stu-id="7091f-104">The OAuth 2.0 authorization code grant can be used in apps that are installed on a device to gain access to protected resources, such as web APIs.</span></span>  <span data-ttu-id="7091f-105">Using the app model v2.0 's implementation of OAuth 2.0, you can add sign in and API access to your mobile and desktop apps.</span><span class="sxs-lookup"><span data-stu-id="7091f-105">Using the app model v2.0 's implementation of OAuth 2.0, you can add sign in and API access to your mobile and desktop apps.</span></span>  <span data-ttu-id="7091f-106">This guide is language-independent, and describes how to send and receive HTTP messages without using any of our open-source libraries.</span><span class="sxs-lookup"><span data-stu-id="7091f-106">This guide is language-independent, and describes how to send and receive HTTP messages without using any of our open-source libraries.</span></span>

<!-- TODO: Need link to libraries -->

> [!NOTE]
> <span data-ttu-id="7091f-107">Not all Azure Active Directory scenarios & features are supported by the v2.0 endpoint.</span><span class="sxs-lookup"><span data-stu-id="7091f-107">Not all Azure Active Directory scenarios & features are supported by the v2.0 endpoint.</span></span>  <span data-ttu-id="7091f-108">To determine if you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="7091f-108">To determine if you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
> 
> 

<span data-ttu-id="7091f-109">The OAuth 2.0 authorization code flow is described in in [section 4.1 of the OAuth 2.0 specification](http://tools.ietf.org/html/rfc6749).</span><span class="sxs-lookup"><span data-stu-id="7091f-109">The OAuth 2.0 authorization code flow is described in in [section 4.1 of the OAuth 2.0 specification](http://tools.ietf.org/html/rfc6749).</span></span>  <span data-ttu-id="7091f-110">It is used to perform authentication and authorization in the majority of app types, including [web apps](active-directory-v2-flows.md#web-apps) and [natively installed  apps](active-directory-v2-flows.md#mobile-and-native-apps).</span><span class="sxs-lookup"><span data-stu-id="7091f-110">It is used to perform authentication and authorization in the majority of app types, including [web apps](active-directory-v2-flows.md#web-apps) and [natively installed  apps](active-directory-v2-flows.md#mobile-and-native-apps).</span></span>  <span data-ttu-id="7091f-111">It enables apps to securely acquire access_tokens which can be used to access resources that are secured using the v2.0 endpoint.</span><span class="sxs-lookup"><span data-stu-id="7091f-111">It enables apps to securely acquire access_tokens which can be used to access resources that are secured using the v2.0 endpoint.</span></span>  

## <a name="protocol-diagram"></a><span data-ttu-id="7091f-112">Protocol diagram</span><span class="sxs-lookup"><span data-stu-id="7091f-112">Protocol diagram</span></span>
<span data-ttu-id="7091f-113">At a high level, the entire authentication flow for a native/mobile application looks a bit like this:</span><span class="sxs-lookup"><span data-stu-id="7091f-113">At a high level, the entire authentication flow for a native/mobile application looks a bit like this:</span></span>

![OAuth Auth Code Flow](https://docstestmedia1.blob.core.windows.net/azure-media/articles/media/active-directory-v2-flows/convergence_scenarios_native.png)

## <a name="request-an-authorization-code"></a><span data-ttu-id="7091f-115">Request an authorization code</span><span class="sxs-lookup"><span data-stu-id="7091f-115">Request an authorization code</span></span>
<span data-ttu-id="7091f-116">The authorization code flow begins with the client directing the user to the `/authorize` endpoint.</span><span class="sxs-lookup"><span data-stu-id="7091f-116">The authorization code flow begins with the client directing the user to the `/authorize` endpoint.</span></span>  <span data-ttu-id="7091f-117">In this request, the client indicates the permissions it needs to acquire from the user:</span><span class="sxs-lookup"><span data-stu-id="7091f-117">In this request, the client indicates the permissions it needs to acquire from the user:</span></span>

```
// Line breaks for legibility only

https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=openid%20offline_access%20https%3A%2F%2Fgraph.microsoft.com%2Fmail.read
&state=12345
```

> [!TIP]
> <span data-ttu-id="7091f-118">Click the link below to execute this request!</span><span class="sxs-lookup"><span data-stu-id="7091f-118">Click the link below to execute this request!</span></span> <span data-ttu-id="7091f-119">After signing in, your browser should be redirected to `https://localhost/myapp/` with a `code` in the address bar.</span><span class="sxs-lookup"><span data-stu-id="7091f-119">After signing in, your browser should be redirected to `https://localhost/myapp/` with a `code` in the address bar.</span></span>
> <span data-ttu-id="7091f-120"><a href="https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&response_type=code&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&response_mode=query&scope=openid%20offline_access%20https%3A%2F%2Fgraph.microsoft.com%2Fmail.read&state=12345" target="_blank">https://login.microsoftonline.com/common/oauth2/v2.0/authorize...</a></span><span class="sxs-lookup"><span data-stu-id="7091f-120"><a href="https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&response_type=code&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&response_mode=query&scope=openid%20offline_access%20https%3A%2F%2Fgraph.microsoft.com%2Fmail.read&state=12345" target="_blank">https://login.microsoftonline.com/common/oauth2/v2.0/authorize...</a></span></span>
> 
> 

| <span data-ttu-id="7091f-121">Parameter</span><span class="sxs-lookup"><span data-stu-id="7091f-121">Parameter</span></span> |  | <span data-ttu-id="7091f-122">Description</span><span class="sxs-lookup"><span data-stu-id="7091f-122">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="7091f-123">tenant</span><span class="sxs-lookup"><span data-stu-id="7091f-123">tenant</span></span> |<span data-ttu-id="7091f-124">required</span><span class="sxs-lookup"><span data-stu-id="7091f-124">required</span></span> |<span data-ttu-id="7091f-125">The `{tenant}` value in the path of the request can be used to control who can sign into the application.</span><span class="sxs-lookup"><span data-stu-id="7091f-125">The `{tenant}` value in the path of the request can be used to control who can sign into the application.</span></span>  <span data-ttu-id="7091f-126">The allowed values are `common`, `organizations`, `consumers`, and tenant identifiers.</span><span class="sxs-lookup"><span data-stu-id="7091f-126">The allowed values are `common`, `organizations`, `consumers`, and tenant identifiers.</span></span>  <span data-ttu-id="7091f-127">For more detail, see [protocol basics](active-directory-v2-protocols.md#endpoints).</span><span class="sxs-lookup"><span data-stu-id="7091f-127">For more detail, see [protocol basics](active-directory-v2-protocols.md#endpoints).</span></span> |
| <span data-ttu-id="7091f-128">client_id</span><span class="sxs-lookup"><span data-stu-id="7091f-128">client_id</span></span> |<span data-ttu-id="7091f-129">required</span><span class="sxs-lookup"><span data-stu-id="7091f-129">required</span></span> |<span data-ttu-id="7091f-130">The Application Id that the registration portal ([apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)) assigned your app.</span><span class="sxs-lookup"><span data-stu-id="7091f-130">The Application Id that the registration portal ([apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)) assigned your app.</span></span> |
| <span data-ttu-id="7091f-131">response_type</span><span class="sxs-lookup"><span data-stu-id="7091f-131">response_type</span></span> |<span data-ttu-id="7091f-132">required</span><span class="sxs-lookup"><span data-stu-id="7091f-132">required</span></span> |<span data-ttu-id="7091f-133">Must include `code` for the authorization code flow.</span><span class="sxs-lookup"><span data-stu-id="7091f-133">Must include `code` for the authorization code flow.</span></span> |
| <span data-ttu-id="7091f-134">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="7091f-134">redirect_uri</span></span> |<span data-ttu-id="7091f-135">recommended</span><span class="sxs-lookup"><span data-stu-id="7091f-135">recommended</span></span> |<span data-ttu-id="7091f-136">The redirect_uri of your app, where authentication responses can be sent and received by your app.</span><span class="sxs-lookup"><span data-stu-id="7091f-136">The redirect_uri of your app, where authentication responses can be sent and received by your app.</span></span>  <span data-ttu-id="7091f-137">It must exactly match one of the redirect_uris you registered in the portal, except it must be url encoded.</span><span class="sxs-lookup"><span data-stu-id="7091f-137">It must exactly match one of the redirect_uris you registered in the portal, except it must be url encoded.</span></span>  <span data-ttu-id="7091f-138">For native & mobile apps, you should use the default value of `https://login.microsoftonline.com/common/oauth2/nativeclient`.</span><span class="sxs-lookup"><span data-stu-id="7091f-138">For native & mobile apps, you should use the default value of `https://login.microsoftonline.com/common/oauth2/nativeclient`.</span></span> |
| <span data-ttu-id="7091f-139">scope</span><span class="sxs-lookup"><span data-stu-id="7091f-139">scope</span></span> |<span data-ttu-id="7091f-140">required</span><span class="sxs-lookup"><span data-stu-id="7091f-140">required</span></span> |<span data-ttu-id="7091f-141">A space-separated list of [scopes](active-directory-v2-scopes.md) that you want the user to consent to.</span><span class="sxs-lookup"><span data-stu-id="7091f-141">A space-separated list of [scopes](active-directory-v2-scopes.md) that you want the user to consent to.</span></span> |
| <span data-ttu-id="7091f-142">response_mode</span><span class="sxs-lookup"><span data-stu-id="7091f-142">response_mode</span></span> |<span data-ttu-id="7091f-143">recommended</span><span class="sxs-lookup"><span data-stu-id="7091f-143">recommended</span></span> |<span data-ttu-id="7091f-144">Specifies the method that should be used to send the resulting token back to your app.</span><span class="sxs-lookup"><span data-stu-id="7091f-144">Specifies the method that should be used to send the resulting token back to your app.</span></span>  <span data-ttu-id="7091f-145">Can be `query` or `form_post`.</span><span class="sxs-lookup"><span data-stu-id="7091f-145">Can be `query` or `form_post`.</span></span> |
| <span data-ttu-id="7091f-146">state</span><span class="sxs-lookup"><span data-stu-id="7091f-146">state</span></span> |<span data-ttu-id="7091f-147">recommended</span><span class="sxs-lookup"><span data-stu-id="7091f-147">recommended</span></span> |<span data-ttu-id="7091f-148">A value included in the request that will also be returned in the token response.</span><span class="sxs-lookup"><span data-stu-id="7091f-148">A value included in the request that will also be returned in the token response.</span></span>  <span data-ttu-id="7091f-149">It can be a string of any content that you wish.</span><span class="sxs-lookup"><span data-stu-id="7091f-149">It can be a string of any content that you wish.</span></span>  <span data-ttu-id="7091f-150">A randomly generated unique value is typically used for [preventing cross-site request forgery attacks](http://tools.ietf.org/html/rfc6749#section-10.12).</span><span class="sxs-lookup"><span data-stu-id="7091f-150">A randomly generated unique value is typically used for [preventing cross-site request forgery attacks](http://tools.ietf.org/html/rfc6749#section-10.12).</span></span>  <span data-ttu-id="7091f-151">The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span><span class="sxs-lookup"><span data-stu-id="7091f-151">The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |
| <span data-ttu-id="7091f-152">prompt</span><span class="sxs-lookup"><span data-stu-id="7091f-152">prompt</span></span> |<span data-ttu-id="7091f-153">optional</span><span class="sxs-lookup"><span data-stu-id="7091f-153">optional</span></span> |<span data-ttu-id="7091f-154">Indicates the type of user interaction that is required.</span><span class="sxs-lookup"><span data-stu-id="7091f-154">Indicates the type of user interaction that is required.</span></span>  <span data-ttu-id="7091f-155">The only valid values at this time are 'login', 'none', and 'consent'.</span><span class="sxs-lookup"><span data-stu-id="7091f-155">The only valid values at this time are 'login', 'none', and 'consent'.</span></span>  <span data-ttu-id="7091f-156">`prompt=login` will force the user to enter their credentials on that request, negating single-sign on.</span><span class="sxs-lookup"><span data-stu-id="7091f-156">`prompt=login` will force the user to enter their credentials on that request, negating single-sign on.</span></span>  <span data-ttu-id="7091f-157">`prompt=none` is the opposite - it will ensure that the user is not presented with any interactive prompt whatsoever.</span><span class="sxs-lookup"><span data-stu-id="7091f-157">`prompt=none` is the opposite - it will ensure that the user is not presented with any interactive prompt whatsoever.</span></span>  <span data-ttu-id="7091f-158">If the request cannot be completed silently via single-sign on, the v2.0 endpoint will return an error.</span><span class="sxs-lookup"><span data-stu-id="7091f-158">If the request cannot be completed silently via single-sign on, the v2.0 endpoint will return an error.</span></span>  <span data-ttu-id="7091f-159">`prompt=consent` will trigger the OAuth consent dialog after the user signs in, asking the user to grant permissions to the app.</span><span class="sxs-lookup"><span data-stu-id="7091f-159">`prompt=consent` will trigger the OAuth consent dialog after the user signs in, asking the user to grant permissions to the app.</span></span> |
| <span data-ttu-id="7091f-160">login_hint</span><span class="sxs-lookup"><span data-stu-id="7091f-160">login_hint</span></span> |<span data-ttu-id="7091f-161">optional</span><span class="sxs-lookup"><span data-stu-id="7091f-161">optional</span></span> |<span data-ttu-id="7091f-162">Can be used to pre-fill the username/email address field of the sign in page for the user, if you know their username ahead of time.</span><span class="sxs-lookup"><span data-stu-id="7091f-162">Can be used to pre-fill the username/email address field of the sign in page for the user, if you know their username ahead of time.</span></span>  <span data-ttu-id="7091f-163">Often apps will use this parameter during re-authentication, having already extracted the username from a previous sign-in using the `preferred_username` claim.</span><span class="sxs-lookup"><span data-stu-id="7091f-163">Often apps will use this parameter during re-authentication, having already extracted the username from a previous sign-in using the `preferred_username` claim.</span></span> |
| <span data-ttu-id="7091f-164">domain_hint</span><span class="sxs-lookup"><span data-stu-id="7091f-164">domain_hint</span></span> |<span data-ttu-id="7091f-165">optional</span><span class="sxs-lookup"><span data-stu-id="7091f-165">optional</span></span> |<span data-ttu-id="7091f-166">Can be one of `consumers` or `organizations`.</span><span class="sxs-lookup"><span data-stu-id="7091f-166">Can be one of `consumers` or `organizations`.</span></span>  <span data-ttu-id="7091f-167">If included, it will skip the email-based discovery process that user goes through on the v2.0 sign in page, leading to a slightly more streamlined user experience.</span><span class="sxs-lookup"><span data-stu-id="7091f-167">If included, it will skip the email-based discovery process that user goes through on the v2.0 sign in page, leading to a slightly more streamlined user experience.</span></span>  <span data-ttu-id="7091f-168">Often apps will use this parameter during re-authentication, by extracting the `tid` from a previous sign-in.</span><span class="sxs-lookup"><span data-stu-id="7091f-168">Often apps will use this parameter during re-authentication, by extracting the `tid` from a previous sign-in.</span></span>  <span data-ttu-id="7091f-169">If the `tid` claim value is `9188040d-6c67-4c5b-b112-36a304b66dad`, you should use `domain_hint=consumers`.</span><span class="sxs-lookup"><span data-stu-id="7091f-169">If the `tid` claim value is `9188040d-6c67-4c5b-b112-36a304b66dad`, you should use `domain_hint=consumers`.</span></span>  <span data-ttu-id="7091f-170">Otherwise, use `domain_hint=organizations`.</span><span class="sxs-lookup"><span data-stu-id="7091f-170">Otherwise, use `domain_hint=organizations`.</span></span> |

<span data-ttu-id="7091f-171">At this point, the user will be asked to enter their credentials and complete the authentication.</span><span class="sxs-lookup"><span data-stu-id="7091f-171">At this point, the user will be asked to enter their credentials and complete the authentication.</span></span>  <span data-ttu-id="7091f-172">The v2.0 endpoint will also ensure that the user has consented to the permissions indicated in the `scope` query parameter.</span><span class="sxs-lookup"><span data-stu-id="7091f-172">The v2.0 endpoint will also ensure that the user has consented to the permissions indicated in the `scope` query parameter.</span></span>  <span data-ttu-id="7091f-173">If the user has not consented to any of those permissions, it will ask the user to consent to the required permissions.</span><span class="sxs-lookup"><span data-stu-id="7091f-173">If the user has not consented to any of those permissions, it will ask the user to consent to the required permissions.</span></span>  <span data-ttu-id="7091f-174">Details of [permissions, consent, and multi-tenant apps are provided here](active-directory-v2-scopes.md).</span><span class="sxs-lookup"><span data-stu-id="7091f-174">Details of [permissions, consent, and multi-tenant apps are provided here](active-directory-v2-scopes.md).</span></span>

<span data-ttu-id="7091f-175">Once the user authenticates and grants consent, the v2.0 endpoint will return a response to your app at the indicated `redirect_uri`, using the method specified in the `response_mode` parameter.</span><span class="sxs-lookup"><span data-stu-id="7091f-175">Once the user authenticates and grants consent, the v2.0 endpoint will return a response to your app at the indicated `redirect_uri`, using the method specified in the `response_mode` parameter.</span></span>

#### <a name="successful-response"></a><span data-ttu-id="7091f-176">Successful response</span><span class="sxs-lookup"><span data-stu-id="7091f-176">Successful response</span></span>
<span data-ttu-id="7091f-177">A successful response using `response_mode=query` looks like:</span><span class="sxs-lookup"><span data-stu-id="7091f-177">A successful response using `response_mode=query` looks like:</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/nativeclient?
code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...
&state=12345
```

| <span data-ttu-id="7091f-178">Parameter</span><span class="sxs-lookup"><span data-stu-id="7091f-178">Parameter</span></span> | <span data-ttu-id="7091f-179">Description</span><span class="sxs-lookup"><span data-stu-id="7091f-179">Description</span></span> |
| --- | --- |
| <span data-ttu-id="7091f-180">code</span><span class="sxs-lookup"><span data-stu-id="7091f-180">code</span></span> |<span data-ttu-id="7091f-181">The authorization_code that the app requested.</span><span class="sxs-lookup"><span data-stu-id="7091f-181">The authorization_code that the app requested.</span></span> <span data-ttu-id="7091f-182">The app can use the authorization code to request an access token for the target resource.</span><span class="sxs-lookup"><span data-stu-id="7091f-182">The app can use the authorization code to request an access token for the target resource.</span></span>  <span data-ttu-id="7091f-183">Authorization_codes are very short lived, typically they expire after about 10 minutes.</span><span class="sxs-lookup"><span data-stu-id="7091f-183">Authorization_codes are very short lived, typically they expire after about 10 minutes.</span></span> |
| <span data-ttu-id="7091f-184">state</span><span class="sxs-lookup"><span data-stu-id="7091f-184">state</span></span> |<span data-ttu-id="7091f-185">If a state parameter is included in the request, the same value should appear in the response.</span><span class="sxs-lookup"><span data-stu-id="7091f-185">If a state parameter is included in the request, the same value should appear in the response.</span></span> <span data-ttu-id="7091f-186">The app should verify that the state values in the request and response are identical.</span><span class="sxs-lookup"><span data-stu-id="7091f-186">The app should verify that the state values in the request and response are identical.</span></span> |

#### <a name="error-response"></a><span data-ttu-id="7091f-187">Error response</span><span class="sxs-lookup"><span data-stu-id="7091f-187">Error response</span></span>
<span data-ttu-id="7091f-188">Error responses may also be sent to the `redirect_uri` so the app can handle them appropriately:</span><span class="sxs-lookup"><span data-stu-id="7091f-188">Error responses may also be sent to the `redirect_uri` so the app can handle them appropriately:</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/nativeclient?
error=access_denied
&error_description=the+user+canceled+the+authentication
```

| <span data-ttu-id="7091f-189">Parameter</span><span class="sxs-lookup"><span data-stu-id="7091f-189">Parameter</span></span> | <span data-ttu-id="7091f-190">Description</span><span class="sxs-lookup"><span data-stu-id="7091f-190">Description</span></span> |
| --- | --- |
| <span data-ttu-id="7091f-191">error</span><span class="sxs-lookup"><span data-stu-id="7091f-191">error</span></span> |<span data-ttu-id="7091f-192">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span><span class="sxs-lookup"><span data-stu-id="7091f-192">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="7091f-193">error_description</span><span class="sxs-lookup"><span data-stu-id="7091f-193">error_description</span></span> |<span data-ttu-id="7091f-194">A specific error message that can help a developer identify the root cause of an authentication error.</span><span class="sxs-lookup"><span data-stu-id="7091f-194">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |

#### <a name="error-codes-for-authorization-endpoint-errors"></a><span data-ttu-id="7091f-195">Error codes for authorization endpoint errors</span><span class="sxs-lookup"><span data-stu-id="7091f-195">Error codes for authorization endpoint errors</span></span>
<span data-ttu-id="7091f-196">The following table describes the various error codes that can be returned in the `error` parameter of the error response.</span><span class="sxs-lookup"><span data-stu-id="7091f-196">The following table describes the various error codes that can be returned in the `error` parameter of the error response.</span></span>

| <span data-ttu-id="7091f-197">Error Code</span><span class="sxs-lookup"><span data-stu-id="7091f-197">Error Code</span></span> | <span data-ttu-id="7091f-198">Description</span><span class="sxs-lookup"><span data-stu-id="7091f-198">Description</span></span> | <span data-ttu-id="7091f-199">Client Action</span><span class="sxs-lookup"><span data-stu-id="7091f-199">Client Action</span></span> |
| --- | --- | --- |
| <span data-ttu-id="7091f-200">invalid_request</span><span class="sxs-lookup"><span data-stu-id="7091f-200">invalid_request</span></span> |<span data-ttu-id="7091f-201">Protocol error, such as a missing required parameter.</span><span class="sxs-lookup"><span data-stu-id="7091f-201">Protocol error, such as a missing required parameter.</span></span> |<span data-ttu-id="7091f-202">Fix and resubmit the request.</span><span class="sxs-lookup"><span data-stu-id="7091f-202">Fix and resubmit the request.</span></span> <span data-ttu-id="7091f-203">This is a development error is typically caught during initial testing.</span><span class="sxs-lookup"><span data-stu-id="7091f-203">This is a development error is typically caught during initial testing.</span></span> |
| <span data-ttu-id="7091f-204">unauthorized_client</span><span class="sxs-lookup"><span data-stu-id="7091f-204">unauthorized_client</span></span> |<span data-ttu-id="7091f-205">The client application is not permitted to request an authorization code.</span><span class="sxs-lookup"><span data-stu-id="7091f-205">The client application is not permitted to request an authorization code.</span></span> |<span data-ttu-id="7091f-206">This usually occurs when the client application is not registered in Azure AD or is not added to the user's Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="7091f-206">This usually occurs when the client application is not registered in Azure AD or is not added to the user's Azure AD tenant.</span></span> <span data-ttu-id="7091f-207">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7091f-207">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span></span> |
| <span data-ttu-id="7091f-208">access_denied</span><span class="sxs-lookup"><span data-stu-id="7091f-208">access_denied</span></span> |<span data-ttu-id="7091f-209">Resource owner denied consent</span><span class="sxs-lookup"><span data-stu-id="7091f-209">Resource owner denied consent</span></span> |<span data-ttu-id="7091f-210">The client application can notify the user that it cannot proceed unless the user consents.</span><span class="sxs-lookup"><span data-stu-id="7091f-210">The client application can notify the user that it cannot proceed unless the user consents.</span></span> |
| <span data-ttu-id="7091f-211">unsupported_response_type</span><span class="sxs-lookup"><span data-stu-id="7091f-211">unsupported_response_type</span></span> |<span data-ttu-id="7091f-212">The authorization server does not support the response type in the request.</span><span class="sxs-lookup"><span data-stu-id="7091f-212">The authorization server does not support the response type in the request.</span></span> |<span data-ttu-id="7091f-213">Fix and resubmit the request.</span><span class="sxs-lookup"><span data-stu-id="7091f-213">Fix and resubmit the request.</span></span> <span data-ttu-id="7091f-214">This is a development error is typically caught during initial testing.</span><span class="sxs-lookup"><span data-stu-id="7091f-214">This is a development error is typically caught during initial testing.</span></span> |
| <span data-ttu-id="7091f-215">server_error</span><span class="sxs-lookup"><span data-stu-id="7091f-215">server_error</span></span> |<span data-ttu-id="7091f-216">The server encountered an unexpected error.</span><span class="sxs-lookup"><span data-stu-id="7091f-216">The server encountered an unexpected error.</span></span> |<span data-ttu-id="7091f-217">Retry the request.</span><span class="sxs-lookup"><span data-stu-id="7091f-217">Retry the request.</span></span> <span data-ttu-id="7091f-218">These errors can result from temporary conditions.</span><span class="sxs-lookup"><span data-stu-id="7091f-218">These errors can result from temporary conditions.</span></span> <span data-ttu-id="7091f-219">The client application might explain to the user that its response is delayed due a temporary error.</span><span class="sxs-lookup"><span data-stu-id="7091f-219">The client application might explain to the user that its response is delayed due a temporary error.</span></span> |
| <span data-ttu-id="7091f-220">temporarily_unavailable</span><span class="sxs-lookup"><span data-stu-id="7091f-220">temporarily_unavailable</span></span> |<span data-ttu-id="7091f-221">The server is temporarily too busy to handle the request.</span><span class="sxs-lookup"><span data-stu-id="7091f-221">The server is temporarily too busy to handle the request.</span></span> |<span data-ttu-id="7091f-222">Retry the request.</span><span class="sxs-lookup"><span data-stu-id="7091f-222">Retry the request.</span></span> <span data-ttu-id="7091f-223">The client application might explain to the user that its response is delayed due a temporary condition.</span><span class="sxs-lookup"><span data-stu-id="7091f-223">The client application might explain to the user that its response is delayed due a temporary condition.</span></span> |
| <span data-ttu-id="7091f-224">invalid_resource</span><span class="sxs-lookup"><span data-stu-id="7091f-224">invalid_resource</span></span> |<span data-ttu-id="7091f-225">The target resource is invalid because it does not exist, Azure AD cannot find it, or it is not correctly configured.</span><span class="sxs-lookup"><span data-stu-id="7091f-225">The target resource is invalid because it does not exist, Azure AD cannot find it, or it is not correctly configured.</span></span> |<span data-ttu-id="7091f-226">This indicates the resource, if it exists, has not been configured in the tenant.</span><span class="sxs-lookup"><span data-stu-id="7091f-226">This indicates the resource, if it exists, has not been configured in the tenant.</span></span> <span data-ttu-id="7091f-227">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7091f-227">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span></span> |

## <a name="request-an-access-token"></a><span data-ttu-id="7091f-228">Request an access token</span><span class="sxs-lookup"><span data-stu-id="7091f-228">Request an access token</span></span>
<span data-ttu-id="7091f-229">Now that you've acquired an authorization_code and have been granted permission by the user, you can redeem the `code` for an `access_token` to the desired resource, by sending a `POST` request to the `/token` endpoint:</span><span class="sxs-lookup"><span data-stu-id="7091f-229">Now that you've acquired an authorization_code and have been granted permission by the user, you can redeem the `code` for an `access_token` to the desired resource, by sending a `POST` request to the `/token` endpoint:</span></span>

```
// Line breaks for legibility only

POST /{tenant}/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&scope=https%3A%2F%2Fgraph.microsoft.com%2Fmail.read
&code=OAAABAAAAiL9Kn2Z27UubvWFPbm0gLWQJVzCTE9UkP3pSx1aXxUjq3n8b2JRLk4OxVXr...
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&grant_type=authorization_code
&client_secret=JqQX2PNo9bpM0uEihUPzyrh    // NOTE: Only required for web apps
```

> [!TIP]
> <span data-ttu-id="7091f-230">Try executing this request in Postman!</span><span class="sxs-lookup"><span data-stu-id="7091f-230">Try executing this request in Postman!</span></span> <span data-ttu-id="7091f-231">(Don't forget to replace the `code`) [![Run in Postman](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/develop/media/active-directory-v2-protocols-oauth-code/runInPostman.png)](https://app.getpostman.com/run-collection/8f5715ec514865a07e6a)</span><span class="sxs-lookup"><span data-stu-id="7091f-231">(Don't forget to replace the `code`) [![Run in Postman](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/develop/media/active-directory-v2-protocols-oauth-code/runInPostman.png)](https://app.getpostman.com/run-collection/8f5715ec514865a07e6a)</span></span>
> 
> 

| <span data-ttu-id="7091f-232">Parameter</span><span class="sxs-lookup"><span data-stu-id="7091f-232">Parameter</span></span> |  | <span data-ttu-id="7091f-233">Description</span><span class="sxs-lookup"><span data-stu-id="7091f-233">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="7091f-234">tenant</span><span class="sxs-lookup"><span data-stu-id="7091f-234">tenant</span></span> |<span data-ttu-id="7091f-235">required</span><span class="sxs-lookup"><span data-stu-id="7091f-235">required</span></span> |<span data-ttu-id="7091f-236">The `{tenant}` value in the path of the request can be used to control who can sign into the application.</span><span class="sxs-lookup"><span data-stu-id="7091f-236">The `{tenant}` value in the path of the request can be used to control who can sign into the application.</span></span>  <span data-ttu-id="7091f-237">The allowed values are `common`, `organizations`, `consumers`, and tenant identifiers.</span><span class="sxs-lookup"><span data-stu-id="7091f-237">The allowed values are `common`, `organizations`, `consumers`, and tenant identifiers.</span></span>  <span data-ttu-id="7091f-238">For more detail, see [protocol basics](active-directory-v2-protocols.md#endpoints).</span><span class="sxs-lookup"><span data-stu-id="7091f-238">For more detail, see [protocol basics](active-directory-v2-protocols.md#endpoints).</span></span> |
| <span data-ttu-id="7091f-239">client_id</span><span class="sxs-lookup"><span data-stu-id="7091f-239">client_id</span></span> |<span data-ttu-id="7091f-240">required</span><span class="sxs-lookup"><span data-stu-id="7091f-240">required</span></span> |<span data-ttu-id="7091f-241">The Application Id that the registration portal ([apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)) assigned your app.</span><span class="sxs-lookup"><span data-stu-id="7091f-241">The Application Id that the registration portal ([apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)) assigned your app.</span></span> |
| <span data-ttu-id="7091f-242">grant_type</span><span class="sxs-lookup"><span data-stu-id="7091f-242">grant_type</span></span> |<span data-ttu-id="7091f-243">required</span><span class="sxs-lookup"><span data-stu-id="7091f-243">required</span></span> |<span data-ttu-id="7091f-244">Must be `authorization_code` for the authorization code flow.</span><span class="sxs-lookup"><span data-stu-id="7091f-244">Must be `authorization_code` for the authorization code flow.</span></span> |
| <span data-ttu-id="7091f-245">scope</span><span class="sxs-lookup"><span data-stu-id="7091f-245">scope</span></span> |<span data-ttu-id="7091f-246">required</span><span class="sxs-lookup"><span data-stu-id="7091f-246">required</span></span> |<span data-ttu-id="7091f-247">A space-separated list of scopes.</span><span class="sxs-lookup"><span data-stu-id="7091f-247">A space-separated list of scopes.</span></span>  <span data-ttu-id="7091f-248">The scopes requested in this leg must be equivalent to or a subset of the scopes requested in the first leg.</span><span class="sxs-lookup"><span data-stu-id="7091f-248">The scopes requested in this leg must be equivalent to or a subset of the scopes requested in the first leg.</span></span>  <span data-ttu-id="7091f-249">If the scopes specified in this request span multiple resource servers, then the v2.0 endpoint will return a token for the resource specified in the first scope.</span><span class="sxs-lookup"><span data-stu-id="7091f-249">If the scopes specified in this request span multiple resource servers, then the v2.0 endpoint will return a token for the resource specified in the first scope.</span></span>  <span data-ttu-id="7091f-250">For a more detailed explanation of scopes, refer to [permissions, consent, and scopes](active-directory-v2-scopes.md).</span><span class="sxs-lookup"><span data-stu-id="7091f-250">For a more detailed explanation of scopes, refer to [permissions, consent, and scopes](active-directory-v2-scopes.md).</span></span> |
| <span data-ttu-id="7091f-251">code</span><span class="sxs-lookup"><span data-stu-id="7091f-251">code</span></span> |<span data-ttu-id="7091f-252">required</span><span class="sxs-lookup"><span data-stu-id="7091f-252">required</span></span> |<span data-ttu-id="7091f-253">The authorization_code that you acquired in the first leg of the flow.</span><span class="sxs-lookup"><span data-stu-id="7091f-253">The authorization_code that you acquired in the first leg of the flow.</span></span> |
| <span data-ttu-id="7091f-254">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="7091f-254">redirect_uri</span></span> |<span data-ttu-id="7091f-255">required</span><span class="sxs-lookup"><span data-stu-id="7091f-255">required</span></span> |<span data-ttu-id="7091f-256">The same redirect_uri value that was used to acquire the authorization_code.</span><span class="sxs-lookup"><span data-stu-id="7091f-256">The same redirect_uri value that was used to acquire the authorization_code.</span></span> |
| <span data-ttu-id="7091f-257">client_secret</span><span class="sxs-lookup"><span data-stu-id="7091f-257">client_secret</span></span> |<span data-ttu-id="7091f-258">required for web apps</span><span class="sxs-lookup"><span data-stu-id="7091f-258">required for web apps</span></span> |<span data-ttu-id="7091f-259">The application secret that you created in the app registration portal for your app.</span><span class="sxs-lookup"><span data-stu-id="7091f-259">The application secret that you created in the app registration portal for your app.</span></span>  <span data-ttu-id="7091f-260">It should not be used in a native app, because client_secrets cannot be reliably stored on devices.</span><span class="sxs-lookup"><span data-stu-id="7091f-260">It should not be used in a native app, because client_secrets cannot be reliably stored on devices.</span></span>  <span data-ttu-id="7091f-261">It is required for web apps and web APIs, which have the ability to store the client_secret securely on the server side.</span><span class="sxs-lookup"><span data-stu-id="7091f-261">It is required for web apps and web APIs, which have the ability to store the client_secret securely on the server side.</span></span> |

#### <a name="successful-response"></a><span data-ttu-id="7091f-262">Successful response</span><span class="sxs-lookup"><span data-stu-id="7091f-262">Successful response</span></span>
<span data-ttu-id="7091f-263">A successful token response will look like:</span><span class="sxs-lookup"><span data-stu-id="7091f-263">A successful token response will look like:</span></span>

```
{
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "token_type": "Bearer",
    "expires_in": 3599,
    "scope": "https%3A%2F%2Fgraph.microsoft.com%2Fmail.read",
    "refresh_token": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGAMxZGUTdM0t4B4...",
    "id_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIyZDRkMTFhMi1mODE0LTQ2YTctOD...",
}
```
| <span data-ttu-id="7091f-264">Parameter</span><span class="sxs-lookup"><span data-stu-id="7091f-264">Parameter</span></span> | <span data-ttu-id="7091f-265">Description</span><span class="sxs-lookup"><span data-stu-id="7091f-265">Description</span></span> |
| --- | --- |
| <span data-ttu-id="7091f-266">access_token</span><span class="sxs-lookup"><span data-stu-id="7091f-266">access_token</span></span> |<span data-ttu-id="7091f-267">The requested access token.</span><span class="sxs-lookup"><span data-stu-id="7091f-267">The requested access token.</span></span> <span data-ttu-id="7091f-268">The  app can use this token to authenticate to the secured resource, such as a web API.</span><span class="sxs-lookup"><span data-stu-id="7091f-268">The  app can use this token to authenticate to the secured resource, such as a web API.</span></span> |
| <span data-ttu-id="7091f-269">token_type</span><span class="sxs-lookup"><span data-stu-id="7091f-269">token_type</span></span> |<span data-ttu-id="7091f-270">Indicates the token type value.</span><span class="sxs-lookup"><span data-stu-id="7091f-270">Indicates the token type value.</span></span> <span data-ttu-id="7091f-271">The only type that Azure AD supports is Bearer</span><span class="sxs-lookup"><span data-stu-id="7091f-271">The only type that Azure AD supports is Bearer</span></span> |
| <span data-ttu-id="7091f-272">expires_in</span><span class="sxs-lookup"><span data-stu-id="7091f-272">expires_in</span></span> |<span data-ttu-id="7091f-273">How long the access token is valid (in seconds).</span><span class="sxs-lookup"><span data-stu-id="7091f-273">How long the access token is valid (in seconds).</span></span> |
| <span data-ttu-id="7091f-274">scope</span><span class="sxs-lookup"><span data-stu-id="7091f-274">scope</span></span> |<span data-ttu-id="7091f-275">The scopes that the access_token is valid for.</span><span class="sxs-lookup"><span data-stu-id="7091f-275">The scopes that the access_token is valid for.</span></span> |
| <span data-ttu-id="7091f-276">refresh_token</span><span class="sxs-lookup"><span data-stu-id="7091f-276">refresh_token</span></span> |<span data-ttu-id="7091f-277">An OAuth 2.0 refresh token.</span><span class="sxs-lookup"><span data-stu-id="7091f-277">An OAuth 2.0 refresh token.</span></span> <span data-ttu-id="7091f-278">The  app can use this token acquire additional access tokens after the current access token expires.</span><span class="sxs-lookup"><span data-stu-id="7091f-278">The  app can use this token acquire additional access tokens after the current access token expires.</span></span>  <span data-ttu-id="7091f-279">Refresh_tokens are long-lived, and can be used to retain access to resources for extended periods of time.</span><span class="sxs-lookup"><span data-stu-id="7091f-279">Refresh_tokens are long-lived, and can be used to retain access to resources for extended periods of time.</span></span>  <span data-ttu-id="7091f-280">For more detail, refer to the [v2.0 token reference](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="7091f-280">For more detail, refer to the [v2.0 token reference](active-directory-v2-tokens.md).</span></span> |
| <span data-ttu-id="7091f-281">id_token</span><span class="sxs-lookup"><span data-stu-id="7091f-281">id_token</span></span> |<span data-ttu-id="7091f-282">An unsigned JSON Web Token (JWT).</span><span class="sxs-lookup"><span data-stu-id="7091f-282">An unsigned JSON Web Token (JWT).</span></span> <span data-ttu-id="7091f-283">The  app can base64Url decode the segments of this token to request information about the user who signed in.</span><span class="sxs-lookup"><span data-stu-id="7091f-283">The  app can base64Url decode the segments of this token to request information about the user who signed in.</span></span> <span data-ttu-id="7091f-284">The  app can cache the values and display them, but it should not rely on them for any authorization or security boundaries.</span><span class="sxs-lookup"><span data-stu-id="7091f-284">The  app can cache the values and display them, but it should not rely on them for any authorization or security boundaries.</span></span>  <span data-ttu-id="7091f-285">For more information about id_tokens see the [v2.0 endpoint token reference](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="7091f-285">For more information about id_tokens see the [v2.0 endpoint token reference](active-directory-v2-tokens.md).</span></span> |

#### <a name="error-response"></a><span data-ttu-id="7091f-286">Error response</span><span class="sxs-lookup"><span data-stu-id="7091f-286">Error response</span></span>
<span data-ttu-id="7091f-287">Error responses will look like:</span><span class="sxs-lookup"><span data-stu-id="7091f-287">Error responses will look like:</span></span>

```
{
  "error": "invalid_scope",
  "error_description": "AADSTS70011: The provided value for the input parameter 'scope' is not valid. The scope https://foo.microsoft.com/mail.read is not valid.\r\nTrace ID: 255d1aef-8c98-452f-ac51-23d051240864\r\nCorrelation ID: fb3d2015-bc17-4bb9-bb85-30c5cf1aaaa7\r\nTimestamp: 2016-01-09 02:02:12Z",
  "error_codes": [
    70011
  ],
  "timestamp": "2016-01-09 02:02:12Z",
  "trace_id": "255d1aef-8c98-452f-ac51-23d051240864",
  "correlation_id": "fb3d2015-bc17-4bb9-bb85-30c5cf1aaaa7"
}
```

| <span data-ttu-id="7091f-288">Parameter</span><span class="sxs-lookup"><span data-stu-id="7091f-288">Parameter</span></span> | <span data-ttu-id="7091f-289">Description</span><span class="sxs-lookup"><span data-stu-id="7091f-289">Description</span></span> |
| --- | --- |
| <span data-ttu-id="7091f-290">error</span><span class="sxs-lookup"><span data-stu-id="7091f-290">error</span></span> |<span data-ttu-id="7091f-291">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span><span class="sxs-lookup"><span data-stu-id="7091f-291">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="7091f-292">error_description</span><span class="sxs-lookup"><span data-stu-id="7091f-292">error_description</span></span> |<span data-ttu-id="7091f-293">A specific error message that can help a developer identify the root cause of an authentication error.</span><span class="sxs-lookup"><span data-stu-id="7091f-293">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |
| <span data-ttu-id="7091f-294">error_codes</span><span class="sxs-lookup"><span data-stu-id="7091f-294">error_codes</span></span> |<span data-ttu-id="7091f-295">A list of STS specific error codes that can help in diagnostics.</span><span class="sxs-lookup"><span data-stu-id="7091f-295">A list of STS specific error codes that can help in diagnostics.</span></span> |
| <span data-ttu-id="7091f-296">timestamp</span><span class="sxs-lookup"><span data-stu-id="7091f-296">timestamp</span></span> |<span data-ttu-id="7091f-297">The time at which the error occurred.</span><span class="sxs-lookup"><span data-stu-id="7091f-297">The time at which the error occurred.</span></span> |
| <span data-ttu-id="7091f-298">trace_id</span><span class="sxs-lookup"><span data-stu-id="7091f-298">trace_id</span></span> |<span data-ttu-id="7091f-299">A unique identifier for the request that can help in diagnostics.</span><span class="sxs-lookup"><span data-stu-id="7091f-299">A unique identifier for the request that can help in diagnostics.</span></span> |
| <span data-ttu-id="7091f-300">correlation_id</span><span class="sxs-lookup"><span data-stu-id="7091f-300">correlation_id</span></span> |<span data-ttu-id="7091f-301">A unique identifier for the request that can help in diagnostics across components.</span><span class="sxs-lookup"><span data-stu-id="7091f-301">A unique identifier for the request that can help in diagnostics across components.</span></span> |

#### <a name="error-codes-for-token-endpoint-errors"></a><span data-ttu-id="7091f-302">Error codes for token endpoint errors</span><span class="sxs-lookup"><span data-stu-id="7091f-302">Error codes for token endpoint errors</span></span>
| <span data-ttu-id="7091f-303">Error Code</span><span class="sxs-lookup"><span data-stu-id="7091f-303">Error Code</span></span> | <span data-ttu-id="7091f-304">Description</span><span class="sxs-lookup"><span data-stu-id="7091f-304">Description</span></span> | <span data-ttu-id="7091f-305">Client Action</span><span class="sxs-lookup"><span data-stu-id="7091f-305">Client Action</span></span> |
| --- | --- | --- |
| <span data-ttu-id="7091f-306">invalid_request</span><span class="sxs-lookup"><span data-stu-id="7091f-306">invalid_request</span></span> |<span data-ttu-id="7091f-307">Protocol error, such as a missing required parameter.</span><span class="sxs-lookup"><span data-stu-id="7091f-307">Protocol error, such as a missing required parameter.</span></span> |<span data-ttu-id="7091f-308">Fix and resubmit the request</span><span class="sxs-lookup"><span data-stu-id="7091f-308">Fix and resubmit the request</span></span> |
| <span data-ttu-id="7091f-309">invalid_grant</span><span class="sxs-lookup"><span data-stu-id="7091f-309">invalid_grant</span></span> |<span data-ttu-id="7091f-310">The authorization code is invalid or has expired.</span><span class="sxs-lookup"><span data-stu-id="7091f-310">The authorization code is invalid or has expired.</span></span> |<span data-ttu-id="7091f-311">Try a new request to the `/authorize` endpoint</span><span class="sxs-lookup"><span data-stu-id="7091f-311">Try a new request to the `/authorize` endpoint</span></span> |
| <span data-ttu-id="7091f-312">unauthorized_client</span><span class="sxs-lookup"><span data-stu-id="7091f-312">unauthorized_client</span></span> |<span data-ttu-id="7091f-313">The authenticated client is not authorized to use this authorization grant type.</span><span class="sxs-lookup"><span data-stu-id="7091f-313">The authenticated client is not authorized to use this authorization grant type.</span></span> |<span data-ttu-id="7091f-314">This usually occurs when the client application is not registered in Azure AD or is not added to the user's Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="7091f-314">This usually occurs when the client application is not registered in Azure AD or is not added to the user's Azure AD tenant.</span></span> <span data-ttu-id="7091f-315">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7091f-315">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span></span> |
| <span data-ttu-id="7091f-316">invalid_client</span><span class="sxs-lookup"><span data-stu-id="7091f-316">invalid_client</span></span> |<span data-ttu-id="7091f-317">Client authentication failed.</span><span class="sxs-lookup"><span data-stu-id="7091f-317">Client authentication failed.</span></span> |<span data-ttu-id="7091f-318">The client credentials are not valid.</span><span class="sxs-lookup"><span data-stu-id="7091f-318">The client credentials are not valid.</span></span> <span data-ttu-id="7091f-319">To fix, the application administrator updates the credentials.</span><span class="sxs-lookup"><span data-stu-id="7091f-319">To fix, the application administrator updates the credentials.</span></span> |
| <span data-ttu-id="7091f-320">unsupported_grant_type</span><span class="sxs-lookup"><span data-stu-id="7091f-320">unsupported_grant_type</span></span> |<span data-ttu-id="7091f-321">The authorization server does not support the authorization grant type.</span><span class="sxs-lookup"><span data-stu-id="7091f-321">The authorization server does not support the authorization grant type.</span></span> |<span data-ttu-id="7091f-322">Change the grant type in the request.</span><span class="sxs-lookup"><span data-stu-id="7091f-322">Change the grant type in the request.</span></span> <span data-ttu-id="7091f-323">This type of error should occur only during development and be detected during initial testing.</span><span class="sxs-lookup"><span data-stu-id="7091f-323">This type of error should occur only during development and be detected during initial testing.</span></span> |
| <span data-ttu-id="7091f-324">invalid_resource</span><span class="sxs-lookup"><span data-stu-id="7091f-324">invalid_resource</span></span> |<span data-ttu-id="7091f-325">The target resource is invalid because it does not exist, Azure AD cannot find it, or it is not correctly configured.</span><span class="sxs-lookup"><span data-stu-id="7091f-325">The target resource is invalid because it does not exist, Azure AD cannot find it, or it is not correctly configured.</span></span> |<span data-ttu-id="7091f-326">This indicates the resource, if it exists, has not been configured in the tenant.</span><span class="sxs-lookup"><span data-stu-id="7091f-326">This indicates the resource, if it exists, has not been configured in the tenant.</span></span> <span data-ttu-id="7091f-327">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7091f-327">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span></span> |
| <span data-ttu-id="7091f-328">interaction_required</span><span class="sxs-lookup"><span data-stu-id="7091f-328">interaction_required</span></span> |<span data-ttu-id="7091f-329">The request requires user interaction.</span><span class="sxs-lookup"><span data-stu-id="7091f-329">The request requires user interaction.</span></span> <span data-ttu-id="7091f-330">For example, an additional authentication step is required.</span><span class="sxs-lookup"><span data-stu-id="7091f-330">For example, an additional authentication step is required.</span></span> |<span data-ttu-id="7091f-331">Retry the request with the same resource.</span><span class="sxs-lookup"><span data-stu-id="7091f-331">Retry the request with the same resource.</span></span> |
| <span data-ttu-id="7091f-332">temporarily_unavailable</span><span class="sxs-lookup"><span data-stu-id="7091f-332">temporarily_unavailable</span></span> |<span data-ttu-id="7091f-333">The server is temporarily too busy to handle the request.</span><span class="sxs-lookup"><span data-stu-id="7091f-333">The server is temporarily too busy to handle the request.</span></span> |<span data-ttu-id="7091f-334">Retry the request.</span><span class="sxs-lookup"><span data-stu-id="7091f-334">Retry the request.</span></span> <span data-ttu-id="7091f-335">The client application might explain to the user that its response is delayed due a temporary condition.</span><span class="sxs-lookup"><span data-stu-id="7091f-335">The client application might explain to the user that its response is delayed due a temporary condition.</span></span> |

## <a name="use-the-access-token"></a><span data-ttu-id="7091f-336">Use the access token</span><span class="sxs-lookup"><span data-stu-id="7091f-336">Use the access token</span></span>
<span data-ttu-id="7091f-337">Now that you've successfully acquired an `access_token`, you can use the token in requests to Web APIs by including it in the `Authorization` header:</span><span class="sxs-lookup"><span data-stu-id="7091f-337">Now that you've successfully acquired an `access_token`, you can use the token in requests to Web APIs by including it in the `Authorization` header:</span></span>

> [!TIP]
> <span data-ttu-id="7091f-338">Execute this request in Postman!</span><span class="sxs-lookup"><span data-stu-id="7091f-338">Execute this request in Postman!</span></span> <span data-ttu-id="7091f-339">(Replace the `Authorization` header first) [![Run in Postman](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/develop/media/active-directory-v2-protocols-oauth-code/runInPostman.png)](https://app.getpostman.com/run-collection/8f5715ec514865a07e6a)</span><span class="sxs-lookup"><span data-stu-id="7091f-339">(Replace the `Authorization` header first) [![Run in Postman](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/develop/media/active-directory-v2-protocols-oauth-code/runInPostman.png)](https://app.getpostman.com/run-collection/8f5715ec514865a07e6a)</span></span>
> 
> 

```
GET /v1.0/me/messages
Host: https://graph.microsoft.com
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
```

## <a name="refresh-the-access-token"></a><span data-ttu-id="7091f-340">Refresh the access token</span><span class="sxs-lookup"><span data-stu-id="7091f-340">Refresh the access token</span></span>
<span data-ttu-id="7091f-341">Access_tokens are short lived, and you must refresh them after they expire to continue accessing resources.</span><span class="sxs-lookup"><span data-stu-id="7091f-341">Access_tokens are short lived, and you must refresh them after they expire to continue accessing resources.</span></span>  <span data-ttu-id="7091f-342">You can do so by submitting another `POST` request to the `/token` endpoint, this time providing the `refresh_token` instead of the `code`:</span><span class="sxs-lookup"><span data-stu-id="7091f-342">You can do so by submitting another `POST` request to the `/token` endpoint, this time providing the `refresh_token` instead of the `code`:</span></span>

```
// Line breaks for legibility only

POST /{tenant}/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&scope=https%3A%2F%2Fgraph.microsoft.com%2Fmail.read
&refresh_token=OAAABAAAAiL9Kn2Z27UubvWFPbm0gLWQJVzCTE9UkP3pSx1aXxUjq...
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&grant_type=refresh_token
&client_secret=JqQX2PNo9bpM0uEihUPzyrh      // NOTE: Only required for web apps
```

> [!TIP]
> <span data-ttu-id="7091f-343">Try executing this request in Postman!</span><span class="sxs-lookup"><span data-stu-id="7091f-343">Try executing this request in Postman!</span></span> <span data-ttu-id="7091f-344">(Don't forget to replace the `refresh_token`) [![Run in Postman](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/develop/media/active-directory-v2-protocols-oauth-code/runInPostman.png)](https://app.getpostman.com/run-collection/8f5715ec514865a07e6a)</span><span class="sxs-lookup"><span data-stu-id="7091f-344">(Don't forget to replace the `refresh_token`) [![Run in Postman](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/develop/media/active-directory-v2-protocols-oauth-code/runInPostman.png)](https://app.getpostman.com/run-collection/8f5715ec514865a07e6a)</span></span>
> 
> 

| <span data-ttu-id="7091f-345">Parameter</span><span class="sxs-lookup"><span data-stu-id="7091f-345">Parameter</span></span> |  | <span data-ttu-id="7091f-346">Description</span><span class="sxs-lookup"><span data-stu-id="7091f-346">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="7091f-347">tenant</span><span class="sxs-lookup"><span data-stu-id="7091f-347">tenant</span></span> |<span data-ttu-id="7091f-348">required</span><span class="sxs-lookup"><span data-stu-id="7091f-348">required</span></span> |<span data-ttu-id="7091f-349">The `{tenant}` value in the path of the request can be used to control who can sign into the application.</span><span class="sxs-lookup"><span data-stu-id="7091f-349">The `{tenant}` value in the path of the request can be used to control who can sign into the application.</span></span>  <span data-ttu-id="7091f-350">The allowed values are `common`, `organizations`, `consumers`, and tenant identifiers.</span><span class="sxs-lookup"><span data-stu-id="7091f-350">The allowed values are `common`, `organizations`, `consumers`, and tenant identifiers.</span></span>  <span data-ttu-id="7091f-351">For more detail, see [protocol basics](active-directory-v2-protocols.md#endpoints).</span><span class="sxs-lookup"><span data-stu-id="7091f-351">For more detail, see [protocol basics](active-directory-v2-protocols.md#endpoints).</span></span> |
| <span data-ttu-id="7091f-352">client_id</span><span class="sxs-lookup"><span data-stu-id="7091f-352">client_id</span></span> |<span data-ttu-id="7091f-353">required</span><span class="sxs-lookup"><span data-stu-id="7091f-353">required</span></span> |<span data-ttu-id="7091f-354">The Application Id that the registration portal ([apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)) assigned your app.</span><span class="sxs-lookup"><span data-stu-id="7091f-354">The Application Id that the registration portal ([apps.dev.microsoft.com](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)) assigned your app.</span></span> |
| <span data-ttu-id="7091f-355">grant_type</span><span class="sxs-lookup"><span data-stu-id="7091f-355">grant_type</span></span> |<span data-ttu-id="7091f-356">required</span><span class="sxs-lookup"><span data-stu-id="7091f-356">required</span></span> |<span data-ttu-id="7091f-357">Must be `refresh_token` for this leg of the authorization code flow.</span><span class="sxs-lookup"><span data-stu-id="7091f-357">Must be `refresh_token` for this leg of the authorization code flow.</span></span> |
| <span data-ttu-id="7091f-358">scope</span><span class="sxs-lookup"><span data-stu-id="7091f-358">scope</span></span> |<span data-ttu-id="7091f-359">required</span><span class="sxs-lookup"><span data-stu-id="7091f-359">required</span></span> |<span data-ttu-id="7091f-360">A space-separated list of scopes.</span><span class="sxs-lookup"><span data-stu-id="7091f-360">A space-separated list of scopes.</span></span>  <span data-ttu-id="7091f-361">The scopes requested in this leg must be equivalent to or a subset of the scopes requested in the original authorization_code request leg.</span><span class="sxs-lookup"><span data-stu-id="7091f-361">The scopes requested in this leg must be equivalent to or a subset of the scopes requested in the original authorization_code request leg.</span></span>  <span data-ttu-id="7091f-362">If the scopes specified in this request span multiple resource servers, then the v2.0 endpoint will return a token for the resource specified in the first scope.</span><span class="sxs-lookup"><span data-stu-id="7091f-362">If the scopes specified in this request span multiple resource servers, then the v2.0 endpoint will return a token for the resource specified in the first scope.</span></span>  <span data-ttu-id="7091f-363">For a more detailed explanation of scopes, refer to [permissions, consent, and scopes](active-directory-v2-scopes.md).</span><span class="sxs-lookup"><span data-stu-id="7091f-363">For a more detailed explanation of scopes, refer to [permissions, consent, and scopes](active-directory-v2-scopes.md).</span></span> |
| <span data-ttu-id="7091f-364">refresh_token</span><span class="sxs-lookup"><span data-stu-id="7091f-364">refresh_token</span></span> |<span data-ttu-id="7091f-365">required</span><span class="sxs-lookup"><span data-stu-id="7091f-365">required</span></span> |<span data-ttu-id="7091f-366">The refresh_token that you acquired in the second leg of the flow.</span><span class="sxs-lookup"><span data-stu-id="7091f-366">The refresh_token that you acquired in the second leg of the flow.</span></span> |
| <span data-ttu-id="7091f-367">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="7091f-367">redirect_uri</span></span> |<span data-ttu-id="7091f-368">required</span><span class="sxs-lookup"><span data-stu-id="7091f-368">required</span></span> |<span data-ttu-id="7091f-369">The same redirect_uri value that was used to acquire the authorization_code.</span><span class="sxs-lookup"><span data-stu-id="7091f-369">The same redirect_uri value that was used to acquire the authorization_code.</span></span> |
| <span data-ttu-id="7091f-370">client_secret</span><span class="sxs-lookup"><span data-stu-id="7091f-370">client_secret</span></span> |<span data-ttu-id="7091f-371">required for web apps</span><span class="sxs-lookup"><span data-stu-id="7091f-371">required for web apps</span></span> |<span data-ttu-id="7091f-372">The application secret that you created in the app registration portal for your app.</span><span class="sxs-lookup"><span data-stu-id="7091f-372">The application secret that you created in the app registration portal for your app.</span></span>  <span data-ttu-id="7091f-373">It should not be used in a native  app, because client_secrets cannot be reliably stored on devices.</span><span class="sxs-lookup"><span data-stu-id="7091f-373">It should not be used in a native  app, because client_secrets cannot be reliably stored on devices.</span></span>  <span data-ttu-id="7091f-374">It is required for web apps and web APIs, which have the ability to store the client_secret securely on the server side.</span><span class="sxs-lookup"><span data-stu-id="7091f-374">It is required for web apps and web APIs, which have the ability to store the client_secret securely on the server side.</span></span> |

#### <a name="successful-response"></a><span data-ttu-id="7091f-375">Successful response</span><span class="sxs-lookup"><span data-stu-id="7091f-375">Successful response</span></span>
<span data-ttu-id="7091f-376">A successful token response will look like:</span><span class="sxs-lookup"><span data-stu-id="7091f-376">A successful token response will look like:</span></span>

```
{
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...",
    "token_type": "Bearer",
    "expires_in": 3599,
    "scope": "https%3A%2F%2Fgraph.microsoft.com%2Fmail.read",
    "refresh_token": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGAMxZGUTdM0t4B4...",
    "id_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiIyZDRkMTFhMi1mODE0LTQ2YTctOD...",
}
```
| <span data-ttu-id="7091f-377">Parameter</span><span class="sxs-lookup"><span data-stu-id="7091f-377">Parameter</span></span> | <span data-ttu-id="7091f-378">Description</span><span class="sxs-lookup"><span data-stu-id="7091f-378">Description</span></span> |
| --- | --- |
| <span data-ttu-id="7091f-379">access_token</span><span class="sxs-lookup"><span data-stu-id="7091f-379">access_token</span></span> |<span data-ttu-id="7091f-380">The requested access token.</span><span class="sxs-lookup"><span data-stu-id="7091f-380">The requested access token.</span></span> <span data-ttu-id="7091f-381">The  app can use this token to authenticate to the secured resource, such as a web API.</span><span class="sxs-lookup"><span data-stu-id="7091f-381">The  app can use this token to authenticate to the secured resource, such as a web API.</span></span> |
| <span data-ttu-id="7091f-382">token_type</span><span class="sxs-lookup"><span data-stu-id="7091f-382">token_type</span></span> |<span data-ttu-id="7091f-383">Indicates the token type value.</span><span class="sxs-lookup"><span data-stu-id="7091f-383">Indicates the token type value.</span></span> <span data-ttu-id="7091f-384">The only type that Azure AD supports is Bearer</span><span class="sxs-lookup"><span data-stu-id="7091f-384">The only type that Azure AD supports is Bearer</span></span> |
| <span data-ttu-id="7091f-385">expires_in</span><span class="sxs-lookup"><span data-stu-id="7091f-385">expires_in</span></span> |<span data-ttu-id="7091f-386">How long the access token is valid (in seconds).</span><span class="sxs-lookup"><span data-stu-id="7091f-386">How long the access token is valid (in seconds).</span></span> |
| <span data-ttu-id="7091f-387">scope</span><span class="sxs-lookup"><span data-stu-id="7091f-387">scope</span></span> |<span data-ttu-id="7091f-388">The scopes that the access_token is valid for.</span><span class="sxs-lookup"><span data-stu-id="7091f-388">The scopes that the access_token is valid for.</span></span> |
| <span data-ttu-id="7091f-389">refresh_token</span><span class="sxs-lookup"><span data-stu-id="7091f-389">refresh_token</span></span> |<span data-ttu-id="7091f-390">A new OAuth 2.0 refresh token.</span><span class="sxs-lookup"><span data-stu-id="7091f-390">A new OAuth 2.0 refresh token.</span></span> <span data-ttu-id="7091f-391">You should replace the old refresh token with this newly acquired refresh token to ensure your refresh tokens remain valid for as long as possible.</span><span class="sxs-lookup"><span data-stu-id="7091f-391">You should replace the old refresh token with this newly acquired refresh token to ensure your refresh tokens remain valid for as long as possible.</span></span> |
| <span data-ttu-id="7091f-392">id_token</span><span class="sxs-lookup"><span data-stu-id="7091f-392">id_token</span></span> |<span data-ttu-id="7091f-393">An unsigned JSON Web Token (JWT).</span><span class="sxs-lookup"><span data-stu-id="7091f-393">An unsigned JSON Web Token (JWT).</span></span> <span data-ttu-id="7091f-394">The  app can base64Url decode the segments of this token to request information about the user who signed in.</span><span class="sxs-lookup"><span data-stu-id="7091f-394">The  app can base64Url decode the segments of this token to request information about the user who signed in.</span></span> <span data-ttu-id="7091f-395">The  app can cache the values and display them, but it should not rely on them for any authorization or security boundaries.</span><span class="sxs-lookup"><span data-stu-id="7091f-395">The  app can cache the values and display them, but it should not rely on them for any authorization or security boundaries.</span></span>  <span data-ttu-id="7091f-396">For more information about id_tokens see the [v2.0 endpoint token reference](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="7091f-396">For more information about id_tokens see the [v2.0 endpoint token reference](active-directory-v2-tokens.md).</span></span> |

#### <a name="error-response"></a><span data-ttu-id="7091f-397">Error response</span><span class="sxs-lookup"><span data-stu-id="7091f-397">Error response</span></span>
```
{
  "error": "invalid_scope",
  "error_description": "AADSTS70011: The provided value for the input parameter 'scope' is not valid. The scope https://foo.microsoft.com/mail.read is not valid.\r\nTrace ID: 255d1aef-8c98-452f-ac51-23d051240864\r\nCorrelation ID: fb3d2015-bc17-4bb9-bb85-30c5cf1aaaa7\r\nTimestamp: 2016-01-09 02:02:12Z",
  "error_codes": [
    70011
  ],
  "timestamp": "2016-01-09 02:02:12Z",
  "trace_id": "255d1aef-8c98-452f-ac51-23d051240864",
  "correlation_id": "fb3d2015-bc17-4bb9-bb85-30c5cf1aaaa7"
}
```

| <span data-ttu-id="7091f-398">Parameter</span><span class="sxs-lookup"><span data-stu-id="7091f-398">Parameter</span></span> | <span data-ttu-id="7091f-399">Description</span><span class="sxs-lookup"><span data-stu-id="7091f-399">Description</span></span> |
| --- | --- |
| <span data-ttu-id="7091f-400">error</span><span class="sxs-lookup"><span data-stu-id="7091f-400">error</span></span> |<span data-ttu-id="7091f-401">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span><span class="sxs-lookup"><span data-stu-id="7091f-401">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="7091f-402">error_description</span><span class="sxs-lookup"><span data-stu-id="7091f-402">error_description</span></span> |<span data-ttu-id="7091f-403">A specific error message that can help a developer identify the root cause of an authentication error.</span><span class="sxs-lookup"><span data-stu-id="7091f-403">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |
| <span data-ttu-id="7091f-404">error_codes</span><span class="sxs-lookup"><span data-stu-id="7091f-404">error_codes</span></span> |<span data-ttu-id="7091f-405">A list of STS specific error codes that can help in diagnostics.</span><span class="sxs-lookup"><span data-stu-id="7091f-405">A list of STS specific error codes that can help in diagnostics.</span></span> |
| <span data-ttu-id="7091f-406">timestamp</span><span class="sxs-lookup"><span data-stu-id="7091f-406">timestamp</span></span> |<span data-ttu-id="7091f-407">The time at which the error occurred.</span><span class="sxs-lookup"><span data-stu-id="7091f-407">The time at which the error occurred.</span></span> |
| <span data-ttu-id="7091f-408">trace_id</span><span class="sxs-lookup"><span data-stu-id="7091f-408">trace_id</span></span> |<span data-ttu-id="7091f-409">A unique identifier for the request that can help in diagnostics.</span><span class="sxs-lookup"><span data-stu-id="7091f-409">A unique identifier for the request that can help in diagnostics.</span></span> |
| <span data-ttu-id="7091f-410">correlation_id</span><span class="sxs-lookup"><span data-stu-id="7091f-410">correlation_id</span></span> |<span data-ttu-id="7091f-411">A unique identifier for the request that can help in diagnostics across components.</span><span class="sxs-lookup"><span data-stu-id="7091f-411">A unique identifier for the request that can help in diagnostics across components.</span></span> |

<span data-ttu-id="7091f-412">For a description of the error codes and the recommended client action, please see [Error codes for token endpoint errors](#error-codes-for-token-endpoint-errors).</span><span class="sxs-lookup"><span data-stu-id="7091f-412">For a description of the error codes and the recommended client action, please see [Error codes for token endpoint errors](#error-codes-for-token-endpoint-errors).</span></span>





