---
title: How to enable cross-app SSO on Android using ADAL | Microsoft Docs
description: 'How to use the features of the ADAL SDK to enable Single Sign On across your applications. '
services: active-directory
documentationcenter: ''
author: CelesteDG
manager: mtillman
editor: ''
ms.assetid: 40710225-05ab-40a3-9aec-8b4e96b6b5e7
ms.service: active-directory
ms.component: develop
ms.workload: identity
ms.tgt_pltfrm: android
ms.devlang: java
ms.topic: article
ms.date: 06/13/2018
ms.author: celested
ms.reviewer: dadobali
ms.custom: aaddev
ms.openlocfilehash: 4abf6bd2d82753e22d4fde92e219109274ce36be
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44869479"
---
# <a name="how-to-enable-cross-app-sso-on-android-using-adal"></a><span data-ttu-id="2757d-103">How to enable cross-app SSO on Android using ADAL</span><span class="sxs-lookup"><span data-stu-id="2757d-103">How to enable cross-app SSO on Android using ADAL</span></span>
<span data-ttu-id="2757d-104">Providing Single Sign-On (SSO) so that users only need to enter their credentials once and have those credentials automatically work across applications is now an industry standard.</span><span class="sxs-lookup"><span data-stu-id="2757d-104">Providing Single Sign-On (SSO) so that users only need to enter their credentials once and have those credentials automatically work across applications is now an industry standard.</span></span> <span data-ttu-id="2757d-105">The difficulty in entering their username and password on a small screen, often times combined with an additional factor (2FA) like a phone call or a texted code, results in dissatisfaction if a user has to sign-on more than one time.</span><span class="sxs-lookup"><span data-stu-id="2757d-105">The difficulty in entering their username and password on a small screen, often times combined with an additional factor (2FA) like a phone call or a texted code, results in dissatisfaction if a user has to sign-on more than one time.</span></span>

<span data-ttu-id="2757d-106">In addition, if you apply an identity platform that other applications may use such as Microsoft Accounts or a work account from Microsoft365, customers expect that those credentials to be available to use across all their applications no matter the publisher.</span><span class="sxs-lookup"><span data-stu-id="2757d-106">In addition, if you apply an identity platform that other applications may use such as Microsoft Accounts or a work account from Microsoft365, customers expect that those credentials to be available to use across all their applications no matter the publisher.</span></span>

<span data-ttu-id="2757d-107">The Microsoft Identity platform, along with the Microsoft Identity SDKs, gives you the ability to delight your customers with SSO either within your own suite of applications or, as with the broker capability and Authenticator applications, across the entire device.</span><span class="sxs-lookup"><span data-stu-id="2757d-107">The Microsoft Identity platform, along with the Microsoft Identity SDKs, gives you the ability to delight your customers with SSO either within your own suite of applications or, as with the broker capability and Authenticator applications, across the entire device.</span></span>

<span data-ttu-id="2757d-108">This walkthrough will tell you how to configure the SDK within your application to provide SSO to your customers.</span><span class="sxs-lookup"><span data-stu-id="2757d-108">This walkthrough will tell you how to configure the SDK within your application to provide SSO to your customers.</span></span>

<span data-ttu-id="2757d-109">The document preceding assumes you know how to integrate your application with the [Microsoft Identity Android SDK](https://github.com/AzureAD/azure-activedirectory-library-for-android).</span><span class="sxs-lookup"><span data-stu-id="2757d-109">The document preceding assumes you know how to integrate your application with the [Microsoft Identity Android SDK](https://github.com/AzureAD/azure-activedirectory-library-for-android).</span></span>

## <a name="sso-concepts-in-the-microsoft-identity-platform"></a><span data-ttu-id="2757d-110">SSO Concepts in the Microsoft Identity Platform</span><span class="sxs-lookup"><span data-stu-id="2757d-110">SSO Concepts in the Microsoft Identity Platform</span></span>
### <a name="microsoft-identity-brokers"></a><span data-ttu-id="2757d-111">Microsoft Identity Brokers</span><span class="sxs-lookup"><span data-stu-id="2757d-111">Microsoft Identity Brokers</span></span>
<span data-ttu-id="2757d-112">Microsoft provides applications for every mobile platform that allow for the bridging of credentials across applications from different vendors and allows for special enhanced features that require a single secure place from where to validate credentials.</span><span class="sxs-lookup"><span data-stu-id="2757d-112">Microsoft provides applications for every mobile platform that allow for the bridging of credentials across applications from different vendors and allows for special enhanced features that require a single secure place from where to validate credentials.</span></span> <span data-ttu-id="2757d-113">The SDK calls these **brokers**.</span><span class="sxs-lookup"><span data-stu-id="2757d-113">The SDK calls these **brokers**.</span></span> <span data-ttu-id="2757d-114">On iOS and Android, the brokers are provided through downloadable applications that customers either install independently or can be pushed to the device by a company who manages some or all of the device for their employee.</span><span class="sxs-lookup"><span data-stu-id="2757d-114">On iOS and Android, the brokers are provided through downloadable applications that customers either install independently or can be pushed to the device by a company who manages some or all of the device for their employee.</span></span> <span data-ttu-id="2757d-115">These brokers support managing security just for some applications or the entire device based on what IT Administrators desire.</span><span class="sxs-lookup"><span data-stu-id="2757d-115">These brokers support managing security just for some applications or the entire device based on what IT Administrators desire.</span></span> <span data-ttu-id="2757d-116">In Windows, this functionality is provided by an account chooser built in to the operating system, known technically as the Web Authentication Broker.</span><span class="sxs-lookup"><span data-stu-id="2757d-116">In Windows, this functionality is provided by an account chooser built in to the operating system, known technically as the Web Authentication Broker.</span></span>

#### <a name="broker-assisted-logins"></a><span data-ttu-id="2757d-117">Broker assisted logins</span><span class="sxs-lookup"><span data-stu-id="2757d-117">Broker assisted logins</span></span>
<span data-ttu-id="2757d-118">Broker-assisted logins are login experiences that occur within the broker application and use the storage and security of the broker to share credentials across all applications on the device that apply the Microsoft Identity platform.</span><span class="sxs-lookup"><span data-stu-id="2757d-118">Broker-assisted logins are login experiences that occur within the broker application and use the storage and security of the broker to share credentials across all applications on the device that apply the Microsoft Identity platform.</span></span> <span data-ttu-id="2757d-119">The implication being your applications will rely on the broker to sign users in.</span><span class="sxs-lookup"><span data-stu-id="2757d-119">The implication being your applications will rely on the broker to sign users in.</span></span> <span data-ttu-id="2757d-120">On iOS and Android, these brokers are provided through downloadable applications that customers either install independently or can be pushed to the device by a company who manages the device for their user.</span><span class="sxs-lookup"><span data-stu-id="2757d-120">On iOS and Android, these brokers are provided through downloadable applications that customers either install independently or can be pushed to the device by a company who manages the device for their user.</span></span> <span data-ttu-id="2757d-121">An example of this type of application is the Microsoft Authenticator application on iOS.</span><span class="sxs-lookup"><span data-stu-id="2757d-121">An example of this type of application is the Microsoft Authenticator application on iOS.</span></span> <span data-ttu-id="2757d-122">In Windows, this functionality is provided by an account chooser built in to the operating system, known technically as the Web Authentication Broker.</span><span class="sxs-lookup"><span data-stu-id="2757d-122">In Windows, this functionality is provided by an account chooser built in to the operating system, known technically as the Web Authentication Broker.</span></span>
<span data-ttu-id="2757d-123">The experience varies by platform and can sometimes be disruptive to users if not managed correctly.</span><span class="sxs-lookup"><span data-stu-id="2757d-123">The experience varies by platform and can sometimes be disruptive to users if not managed correctly.</span></span> <span data-ttu-id="2757d-124">You're probably most familiar with this pattern if you have the Facebook application installed and use Facebook Connect from another application.</span><span class="sxs-lookup"><span data-stu-id="2757d-124">You're probably most familiar with this pattern if you have the Facebook application installed and use Facebook Connect from another application.</span></span> <span data-ttu-id="2757d-125">The Microsoft Identity platform uses the same pattern.</span><span class="sxs-lookup"><span data-stu-id="2757d-125">The Microsoft Identity platform uses the same pattern.</span></span>

<span data-ttu-id="2757d-126">On Android, the account chooser is displayed on top of your application, which is less disruptive to the user.</span><span class="sxs-lookup"><span data-stu-id="2757d-126">On Android, the account chooser is displayed on top of your application, which is less disruptive to the user.</span></span>

#### <a name="how-the-broker-gets-invoked"></a><span data-ttu-id="2757d-127">How the broker gets invoked</span><span class="sxs-lookup"><span data-stu-id="2757d-127">How the broker gets invoked</span></span>
<span data-ttu-id="2757d-128">If a compatible broker is installed on the device, like the Microsoft Authenticator application, the Microsoft Identity SDKs will automatically do the work of invoking the broker for you when a user indicates they wish to log in using any account from the Microsoft Identity platform.</span><span class="sxs-lookup"><span data-stu-id="2757d-128">If a compatible broker is installed on the device, like the Microsoft Authenticator application, the Microsoft Identity SDKs will automatically do the work of invoking the broker for you when a user indicates they wish to log in using any account from the Microsoft Identity platform.</span></span> 
 
 #### <a name="how-microsoft-ensures-the-application-is-valid"></a><span data-ttu-id="2757d-129">How Microsoft ensures the application is valid</span><span class="sxs-lookup"><span data-stu-id="2757d-129">How Microsoft ensures the application is valid</span></span>
 
 <span data-ttu-id="2757d-130">The need to ensure the identity of an application call the broker is crucial to the security provided in broker assisted logins.</span><span class="sxs-lookup"><span data-stu-id="2757d-130">The need to ensure the identity of an application call the broker is crucial to the security provided in broker assisted logins.</span></span> <span data-ttu-id="2757d-131">iOS and Android do not enforce unique identifiers that are valid only for a given application, so malicious applications may "spoof" a legitimate application's identifier and receive the tokens meant for the legitimate application.</span><span class="sxs-lookup"><span data-stu-id="2757d-131">iOS and Android do not enforce unique identifiers that are valid only for a given application, so malicious applications may "spoof" a legitimate application's identifier and receive the tokens meant for the legitimate application.</span></span> <span data-ttu-id="2757d-132">To ensure Microsoft is always communicating with the right application at runtime, the developer is asked to provide a custom redirectURI when registering their application with Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2757d-132">To ensure Microsoft is always communicating with the right application at runtime, the developer is asked to provide a custom redirectURI when registering their application with Microsoft.</span></span> <span data-ttu-id="2757d-133">**How developers should craft this redirect URI is discussed in detail below.**</span><span class="sxs-lookup"><span data-stu-id="2757d-133">**How developers should craft this redirect URI is discussed in detail below.**</span></span> <span data-ttu-id="2757d-134">This custom redirectURI contains the certificate thumbprint of the application and is ensured to be unique to the application by the Google Play Store.</span><span class="sxs-lookup"><span data-stu-id="2757d-134">This custom redirectURI contains the certificate thumbprint of the application and is ensured to be unique to the application by the Google Play Store.</span></span> <span data-ttu-id="2757d-135">When an application calls the broker, the broker asks the Android operating system to provide it with the certificate thumbprint that called the broker.</span><span class="sxs-lookup"><span data-stu-id="2757d-135">When an application calls the broker, the broker asks the Android operating system to provide it with the certificate thumbprint that called the broker.</span></span> <span data-ttu-id="2757d-136">The broker provides this certificate thumbprint to Microsoft in the call to the identity system.</span><span class="sxs-lookup"><span data-stu-id="2757d-136">The broker provides this certificate thumbprint to Microsoft in the call to the identity system.</span></span> <span data-ttu-id="2757d-137">If the certificate thumbprint of the application does not match the certificate thumbprint provided to us by the developer during registration, access is denied to the tokens for the resource the application is requesting.</span><span class="sxs-lookup"><span data-stu-id="2757d-137">If the certificate thumbprint of the application does not match the certificate thumbprint provided to us by the developer during registration, access is denied to the tokens for the resource the application is requesting.</span></span> <span data-ttu-id="2757d-138">This check ensures that only the application registered by the developer receives tokens.</span><span class="sxs-lookup"><span data-stu-id="2757d-138">This check ensures that only the application registered by the developer receives tokens.</span></span>

<span data-ttu-id="2757d-139">Brokered-SSO logins have the following benefits:</span><span class="sxs-lookup"><span data-stu-id="2757d-139">Brokered-SSO logins have the following benefits:</span></span>

* <span data-ttu-id="2757d-140">User experiences SSO across all their applications no matter the vendor.</span><span class="sxs-lookup"><span data-stu-id="2757d-140">User experiences SSO across all their applications no matter the vendor.</span></span>
* <span data-ttu-id="2757d-141">Your application can use more advanced business features such as Conditional Access and support Intune scenarios.</span><span class="sxs-lookup"><span data-stu-id="2757d-141">Your application can use more advanced business features such as Conditional Access and support Intune scenarios.</span></span>
* <span data-ttu-id="2757d-142">Your application can support certificate-based authentication for business users.</span><span class="sxs-lookup"><span data-stu-id="2757d-142">Your application can support certificate-based authentication for business users.</span></span>
* <span data-ttu-id="2757d-143">More secure sign-in experience as the identity of the application and the user are verified by the broker application with additional security algorithms and encryption.</span><span class="sxs-lookup"><span data-stu-id="2757d-143">More secure sign-in experience as the identity of the application and the user are verified by the broker application with additional security algorithms and encryption.</span></span>

<span data-ttu-id="2757d-144">Here is a representation of how the Microsoft Identity SDKs work with the broker applications to enable SSO:</span><span class="sxs-lookup"><span data-stu-id="2757d-144">Here is a representation of how the Microsoft Identity SDKs work with the broker applications to enable SSO:</span></span>

```
+------------+ +------------+   +-------------+
|            | |            |   |             |
|   App 1    | |   App 2    |   |   Someone   |
|            | |            |   |    Else's   |
|            | |            |   |     App     |
+------------+ +------------+   +-------------+
|  ADAL SDK  | |  ADAL SDK  |   |  ADAL SDK   |
+-----+------+-+-----+------+-  +-------+-----+
      |              |                  |
      |       +------v------+           |
      |       |             |           |
      |       | Microsoft   |           |
      +-------> Broker      |^----------+
              | Application
              |             |
              +-------------+
              |             |
              |   Broker    |
              |   Storage   |
              |             |
              +-------------+

```

<span data-ttu-id="2757d-145">Armed with this background information you should be able to better understand and implement SSO within your application using the Microsoft Identity platform and SDKs.</span><span class="sxs-lookup"><span data-stu-id="2757d-145">Armed with this background information you should be able to better understand and implement SSO within your application using the Microsoft Identity platform and SDKs.</span></span>

### <a name="turning-on-sso-for-broker-assisted-sso"></a><span data-ttu-id="2757d-146">Turning on SSO for broker assisted SSO</span><span class="sxs-lookup"><span data-stu-id="2757d-146">Turning on SSO for broker assisted SSO</span></span>
<span data-ttu-id="2757d-147">The ability for an application to use any broker that is installed on the device is **turned off by default**.</span><span class="sxs-lookup"><span data-stu-id="2757d-147">The ability for an application to use any broker that is installed on the device is **turned off by default**.</span></span> <span data-ttu-id="2757d-148">In order to use your application with the broker, you must do some additional configuration and add some code to your application.</span><span class="sxs-lookup"><span data-stu-id="2757d-148">In order to use your application with the broker, you must do some additional configuration and add some code to your application.</span></span>

<span data-ttu-id="2757d-149">The steps to follow are:</span><span class="sxs-lookup"><span data-stu-id="2757d-149">The steps to follow are:</span></span>

1. <span data-ttu-id="2757d-150">Enable broker mode in your application code's calling to the MS SDK</span><span class="sxs-lookup"><span data-stu-id="2757d-150">Enable broker mode in your application code's calling to the MS SDK</span></span>
2. <span data-ttu-id="2757d-151">Establish a new redirect URI and provide that to both the app and your app registration</span><span class="sxs-lookup"><span data-stu-id="2757d-151">Establish a new redirect URI and provide that to both the app and your app registration</span></span>
3. <span data-ttu-id="2757d-152">Setting up the correct permissions in the Android manifest</span><span class="sxs-lookup"><span data-stu-id="2757d-152">Setting up the correct permissions in the Android manifest</span></span>

#### <a name="step-1-enable-broker-mode-in-your-application"></a><span data-ttu-id="2757d-153">Step 1: Enable broker mode in your application</span><span class="sxs-lookup"><span data-stu-id="2757d-153">Step 1: Enable broker mode in your application</span></span>
<span data-ttu-id="2757d-154">The ability for your application to use the broker is turned on when you create the "settings" or initial setup of your Authentication instance.</span><span class="sxs-lookup"><span data-stu-id="2757d-154">The ability for your application to use the broker is turned on when you create the "settings" or initial setup of your Authentication instance.</span></span> <span data-ttu-id="2757d-155">To do this in your app:</span><span class="sxs-lookup"><span data-stu-id="2757d-155">To do this in your app:</span></span>

```
AuthenticationSettings.Instance.setUseBroker(true);
```

#### <a name="step-2-establish-a-new-redirect-uri-with-your-url-scheme"></a><span data-ttu-id="2757d-156">Step 2: Establish a new redirect URI with your URL Scheme</span><span class="sxs-lookup"><span data-stu-id="2757d-156">Step 2: Establish a new redirect URI with your URL Scheme</span></span>
<span data-ttu-id="2757d-157">In order to ensure that the right application recevies the returned the credential tokens, there is a need to make sure the call back to your application in a way that the Android operating system can verify.</span><span class="sxs-lookup"><span data-stu-id="2757d-157">In order to ensure that the right application recevies the returned the credential tokens, there is a need to make sure the call back to your application in a way that the Android operating system can verify.</span></span> <span data-ttu-id="2757d-158">The Android operating system uses the hash of the certificate in the Google Play store.</span><span class="sxs-lookup"><span data-stu-id="2757d-158">The Android operating system uses the hash of the certificate in the Google Play store.</span></span> <span data-ttu-id="2757d-159">This hash of the certificate cannot be spoofed by a rogue application.</span><span class="sxs-lookup"><span data-stu-id="2757d-159">This hash of the certificate cannot be spoofed by a rogue application.</span></span> <span data-ttu-id="2757d-160">Along with the URI of the broker application, Microsoft ensures that the tokens are returned to the correct application.</span><span class="sxs-lookup"><span data-stu-id="2757d-160">Along with the URI of the broker application, Microsoft ensures that the tokens are returned to the correct application.</span></span> <span data-ttu-id="2757d-161">A unique redirect URI is required to be registered on the application.</span><span class="sxs-lookup"><span data-stu-id="2757d-161">A unique redirect URI is required to be registered on the application.</span></span>

<span data-ttu-id="2757d-162">Your redirect URI must be in the proper form of:</span><span class="sxs-lookup"><span data-stu-id="2757d-162">Your redirect URI must be in the proper form of:</span></span>

`msauth://packagename/Base64UrlencodedSignature`

<span data-ttu-id="2757d-163">ex: *msauth://com.example.userapp/IcB5PxIyvbLkbFVtBI%2FitkW%2Fejk%3D*</span><span class="sxs-lookup"><span data-stu-id="2757d-163">ex: *msauth://com.example.userapp/IcB5PxIyvbLkbFVtBI%2FitkW%2Fejk%3D*</span></span>

<span data-ttu-id="2757d-164">You can register this redirect URI in your app registration using the [Azure portal](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="2757d-164">You can register this redirect URI in your app registration using the [Azure portal](https://portal.azure.com/).</span></span> <span data-ttu-id="2757d-165">For more information on Azure AD app registration, see [Integrating with Azure Active Directory](active-directory-how-to-integrate.md).</span><span class="sxs-lookup"><span data-stu-id="2757d-165">For more information on Azure AD app registration, see [Integrating with Azure Active Directory](active-directory-how-to-integrate.md).</span></span>

#### <a name="step-3-set-up-the-correct-permissions-in-your-application"></a><span data-ttu-id="2757d-166">Step 3: Set up the correct permissions in your application</span><span class="sxs-lookup"><span data-stu-id="2757d-166">Step 3: Set up the correct permissions in your application</span></span>
<span data-ttu-id="2757d-167">The broker application in Android uses the Accounts Manager feature of the Android OS to manage credentials across applications.</span><span class="sxs-lookup"><span data-stu-id="2757d-167">The broker application in Android uses the Accounts Manager feature of the Android OS to manage credentials across applications.</span></span> <span data-ttu-id="2757d-168">In order to use the broker in Android your app manifest must have permissions to use AccountManager accounts.</span><span class="sxs-lookup"><span data-stu-id="2757d-168">In order to use the broker in Android your app manifest must have permissions to use AccountManager accounts.</span></span> <span data-ttu-id="2757d-169">These permissions are discussed in detail in the [Google documentation for Account Manager here](http://developer.android.com/reference/android/accounts/AccountManager.html)</span><span class="sxs-lookup"><span data-stu-id="2757d-169">These permissions are discussed in detail in the [Google documentation for Account Manager here](http://developer.android.com/reference/android/accounts/AccountManager.html)</span></span>

<span data-ttu-id="2757d-170">In particular, these permissions are:</span><span class="sxs-lookup"><span data-stu-id="2757d-170">In particular, these permissions are:</span></span>

```
GET_ACCOUNTS
USE_CREDENTIALS
MANAGE_ACCOUNTS
```

### <a name="youve-configured-sso"></a><span data-ttu-id="2757d-171">You've configured SSO!</span><span class="sxs-lookup"><span data-stu-id="2757d-171">You've configured SSO!</span></span>
<span data-ttu-id="2757d-172">Now the Microsoft Identity SDK will automatically both share credentials across your applications and invoke the broker if it's present on their device.</span><span class="sxs-lookup"><span data-stu-id="2757d-172">Now the Microsoft Identity SDK will automatically both share credentials across your applications and invoke the broker if it's present on their device.</span></span>

