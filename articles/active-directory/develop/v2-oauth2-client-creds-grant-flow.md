---
title: Use Azure AD v2.0 to access secure resources without user interaction | Microsoft Docs
description: Build web applications by using the Azure AD implementation of the OAuth 2.0 authentication protocol.
services: active-directory
documentationcenter: ''
author: CelesteDG
manager: mtillman
editor: ''
ms.assetid: 9b7cfbd7-f89f-4e33-aff2-414edd584b07
ms.service: active-directory
ms.component: develop
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: celested
ms.reviewer: hirsin, dastrock
ms.custom: aaddev
ms.openlocfilehash: 02d5bf9ef293731ce707596a90cd7e9aa0b96450
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44857673"
---
# <a name="azure-active-directory-v20-and-the-oauth-20-client-credentials-flow"></a><span data-ttu-id="de78b-103">Azure Active Directory v2.0 and the OAuth 2.0 client credentials flow</span><span class="sxs-lookup"><span data-stu-id="de78b-103">Azure Active Directory v2.0 and the OAuth 2.0 client credentials flow</span></span>
<span data-ttu-id="de78b-104">You can use the [OAuth 2.0 client credentials grant](http://tools.ietf.org/html/rfc6749#section-4.4) specified in RFC 6749, sometimes called *two-legged OAuth*, to access web-hosted resources by using the identity of an application.</span><span class="sxs-lookup"><span data-stu-id="de78b-104">You can use the [OAuth 2.0 client credentials grant](http://tools.ietf.org/html/rfc6749#section-4.4) specified in RFC 6749, sometimes called *two-legged OAuth*, to access web-hosted resources by using the identity of an application.</span></span> <span data-ttu-id="de78b-105">This type of grant commonly is used for server-to-server interactions that must run in the background, without immediate interaction with a user.</span><span class="sxs-lookup"><span data-stu-id="de78b-105">This type of grant commonly is used for server-to-server interactions that must run in the background, without immediate interaction with a user.</span></span> <span data-ttu-id="de78b-106">These types of applications often are referred to as *daemons* or *service accounts*.</span><span class="sxs-lookup"><span data-stu-id="de78b-106">These types of applications often are referred to as *daemons* or *service accounts*.</span></span>

> [!NOTE]
> <span data-ttu-id="de78b-107">The v2.0 endpoint doesn't support all Azure Active Directory scenarios and features.</span><span class="sxs-lookup"><span data-stu-id="de78b-107">The v2.0 endpoint doesn't support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="de78b-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="de78b-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

<span data-ttu-id="de78b-109">In the more typical *three-legged OAuth*, a client application is granted permission to access a resource on behalf of a specific user.</span><span class="sxs-lookup"><span data-stu-id="de78b-109">In the more typical *three-legged OAuth*, a client application is granted permission to access a resource on behalf of a specific user.</span></span> <span data-ttu-id="de78b-110">The permission is delegated from the user to the application, usually during the [consent](v2-permissions-and-consent.md) process.</span><span class="sxs-lookup"><span data-stu-id="de78b-110">The permission is delegated from the user to the application, usually during the [consent](v2-permissions-and-consent.md) process.</span></span> <span data-ttu-id="de78b-111">However, in the client credentials flow, permissions are granted directly to the application itself.</span><span class="sxs-lookup"><span data-stu-id="de78b-111">However, in the client credentials flow, permissions are granted directly to the application itself.</span></span> <span data-ttu-id="de78b-112">When the app presents a token to a resource, the resource enforces that the app itself has authorization to perform an action, and not that the user has authorization.</span><span class="sxs-lookup"><span data-stu-id="de78b-112">When the app presents a token to a resource, the resource enforces that the app itself has authorization to perform an action, and not that the user has authorization.</span></span>

## <a name="protocol-diagram"></a><span data-ttu-id="de78b-113">Protocol diagram</span><span class="sxs-lookup"><span data-stu-id="de78b-113">Protocol diagram</span></span>
<span data-ttu-id="de78b-114">The entire client credentials flow looks similar to the next diagram.</span><span class="sxs-lookup"><span data-stu-id="de78b-114">The entire client credentials flow looks similar to the next diagram.</span></span> <span data-ttu-id="de78b-115">We describe each of the steps later in this article.</span><span class="sxs-lookup"><span data-stu-id="de78b-115">We describe each of the steps later in this article.</span></span>

![Client credentials flow](./media/v2-oauth2-client-creds-grant-flow/convergence_scenarios_client_creds.png)

## <a name="get-direct-authorization"></a><span data-ttu-id="de78b-117">Get direct authorization</span><span class="sxs-lookup"><span data-stu-id="de78b-117">Get direct authorization</span></span>
<span data-ttu-id="de78b-118">An app typically receives direct authorization to access a resource in one of two ways: through an access control list (ACL) at the resource, or through application permission assignment in Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="de78b-118">An app typically receives direct authorization to access a resource in one of two ways: through an access control list (ACL) at the resource, or through application permission assignment in Azure Active Directory (Azure AD).</span></span> <span data-ttu-id="de78b-119">These two methods are the most common in Azure AD, and we recommend them for clients and resources that perform the client credentials flow.</span><span class="sxs-lookup"><span data-stu-id="de78b-119">These two methods are the most common in Azure AD, and we recommend them for clients and resources that perform the client credentials flow.</span></span> <span data-ttu-id="de78b-120">A resource can choose to authorize its clients in other ways, however.</span><span class="sxs-lookup"><span data-stu-id="de78b-120">A resource can choose to authorize its clients in other ways, however.</span></span> <span data-ttu-id="de78b-121">Each resource server can choose the method that makes the most sense for its application.</span><span class="sxs-lookup"><span data-stu-id="de78b-121">Each resource server can choose the method that makes the most sense for its application.</span></span>

### <a name="access-control-lists"></a><span data-ttu-id="de78b-122">Access control lists</span><span class="sxs-lookup"><span data-stu-id="de78b-122">Access control lists</span></span>
<span data-ttu-id="de78b-123">A resource provider might enforce an authorization check based on a list of Application IDs that it knows and grants a specific level of access to.</span><span class="sxs-lookup"><span data-stu-id="de78b-123">A resource provider might enforce an authorization check based on a list of Application IDs that it knows and grants a specific level of access to.</span></span> <span data-ttu-id="de78b-124">When the resource receives a token from the v2.0 endpoint, it can decode the token and extract the client's Application ID from the `appid` and `iss` claims.</span><span class="sxs-lookup"><span data-stu-id="de78b-124">When the resource receives a token from the v2.0 endpoint, it can decode the token and extract the client's Application ID from the `appid` and `iss` claims.</span></span> <span data-ttu-id="de78b-125">Then it compares the application against an ACL that it maintains.</span><span class="sxs-lookup"><span data-stu-id="de78b-125">Then it compares the application against an ACL that it maintains.</span></span> <span data-ttu-id="de78b-126">The ACL's granularity and method might vary substantially between resources.</span><span class="sxs-lookup"><span data-stu-id="de78b-126">The ACL's granularity and method might vary substantially between resources.</span></span>

<span data-ttu-id="de78b-127">A common use case is to use an ACL to run tests for a web application or for a Web API.</span><span class="sxs-lookup"><span data-stu-id="de78b-127">A common use case is to use an ACL to run tests for a web application or for a Web API.</span></span> <span data-ttu-id="de78b-128">The Web API might grant only a subset of full permissions to a specific client.</span><span class="sxs-lookup"><span data-stu-id="de78b-128">The Web API might grant only a subset of full permissions to a specific client.</span></span> <span data-ttu-id="de78b-129">To run end-to-end tests on the API, create a test client that acquires tokens from the v2.0 endpoint and then sends them to the API.</span><span class="sxs-lookup"><span data-stu-id="de78b-129">To run end-to-end tests on the API, create a test client that acquires tokens from the v2.0 endpoint and then sends them to the API.</span></span> <span data-ttu-id="de78b-130">The API then checks the ACL for the test client's Application ID for full access to the API's entire functionality.</span><span class="sxs-lookup"><span data-stu-id="de78b-130">The API then checks the ACL for the test client's Application ID for full access to the API's entire functionality.</span></span> <span data-ttu-id="de78b-131">If you use this kind of ACL, be sure to validate not only the caller's `appid` value.</span><span class="sxs-lookup"><span data-stu-id="de78b-131">If you use this kind of ACL, be sure to validate not only the caller's `appid` value.</span></span> <span data-ttu-id="de78b-132">Also validate that the `iss` value of the token is trusted.</span><span class="sxs-lookup"><span data-stu-id="de78b-132">Also validate that the `iss` value of the token is trusted.</span></span>

<span data-ttu-id="de78b-133">This type of authorization is common for daemons and service accounts that need to access data owned by consumer users who have personal Microsoft accounts.</span><span class="sxs-lookup"><span data-stu-id="de78b-133">This type of authorization is common for daemons and service accounts that need to access data owned by consumer users who have personal Microsoft accounts.</span></span> <span data-ttu-id="de78b-134">For data owned by organizations, we recommend that you get the necessary authorization through application permissions.</span><span class="sxs-lookup"><span data-stu-id="de78b-134">For data owned by organizations, we recommend that you get the necessary authorization through application permissions.</span></span>

### <a name="application-permissions"></a><span data-ttu-id="de78b-135">Application permissions</span><span class="sxs-lookup"><span data-stu-id="de78b-135">Application permissions</span></span>
<span data-ttu-id="de78b-136">Instead of using ACLs, you can use APIs to expose a set of application permissions.</span><span class="sxs-lookup"><span data-stu-id="de78b-136">Instead of using ACLs, you can use APIs to expose a set of application permissions.</span></span> <span data-ttu-id="de78b-137">An application permission is granted to an application by an organization's administrator, and can be used only to access data owned by that organization and its employees.</span><span class="sxs-lookup"><span data-stu-id="de78b-137">An application permission is granted to an application by an organization's administrator, and can be used only to access data owned by that organization and its employees.</span></span> <span data-ttu-id="de78b-138">For example, Microsoft Graph exposes several application permissions to do the following:</span><span class="sxs-lookup"><span data-stu-id="de78b-138">For example, Microsoft Graph exposes several application permissions to do the following:</span></span>

* <span data-ttu-id="de78b-139">Read mail in all mailboxes</span><span class="sxs-lookup"><span data-stu-id="de78b-139">Read mail in all mailboxes</span></span>
* <span data-ttu-id="de78b-140">Read and write mail in all mailboxes</span><span class="sxs-lookup"><span data-stu-id="de78b-140">Read and write mail in all mailboxes</span></span>
* <span data-ttu-id="de78b-141">Send mail as any user</span><span class="sxs-lookup"><span data-stu-id="de78b-141">Send mail as any user</span></span>
* <span data-ttu-id="de78b-142">Read directory data</span><span class="sxs-lookup"><span data-stu-id="de78b-142">Read directory data</span></span>

<span data-ttu-id="de78b-143">For more information about application permissions, go to [Microsoft Graph](https://graph.microsoft.io).</span><span class="sxs-lookup"><span data-stu-id="de78b-143">For more information about application permissions, go to [Microsoft Graph](https://graph.microsoft.io).</span></span>

<span data-ttu-id="de78b-144">To use application permissions in your app, do the steps we discuss in the next sections.</span><span class="sxs-lookup"><span data-stu-id="de78b-144">To use application permissions in your app, do the steps we discuss in the next sections.</span></span>

#### <a name="request-the-permissions-in-the-app-registration-portal"></a><span data-ttu-id="de78b-145">Request the permissions in the app registration portal</span><span class="sxs-lookup"><span data-stu-id="de78b-145">Request the permissions in the app registration portal</span></span>
1. <span data-ttu-id="de78b-146">Go to your application in the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](quickstart-v2-register-an-app.md), if you haven't already.</span><span class="sxs-lookup"><span data-stu-id="de78b-146">Go to your application in the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](quickstart-v2-register-an-app.md), if you haven't already.</span></span> <span data-ttu-id="de78b-147">You'll need to use at least one Application Secret when you create your app.</span><span class="sxs-lookup"><span data-stu-id="de78b-147">You'll need to use at least one Application Secret when you create your app.</span></span>
2. <span data-ttu-id="de78b-148">Locate the **Microsoft Graph Permissions** section, and then add the **application permissions** that your app requires.</span><span class="sxs-lookup"><span data-stu-id="de78b-148">Locate the **Microsoft Graph Permissions** section, and then add the **application permissions** that your app requires.</span></span>
3. <span data-ttu-id="de78b-149">**Save** the app registration.</span><span class="sxs-lookup"><span data-stu-id="de78b-149">**Save** the app registration.</span></span>

#### <a name="recommended-sign-the-user-in-to-your-app"></a><span data-ttu-id="de78b-150">Recommended: Sign the user in to your app</span><span class="sxs-lookup"><span data-stu-id="de78b-150">Recommended: Sign the user in to your app</span></span>
<span data-ttu-id="de78b-151">Typically, when you build an application that uses application permissions, the app requires a page or view on which the admin approves the app's permissions.</span><span class="sxs-lookup"><span data-stu-id="de78b-151">Typically, when you build an application that uses application permissions, the app requires a page or view on which the admin approves the app's permissions.</span></span> <span data-ttu-id="de78b-152">This page can be part of the app's sign-in flow, part of the app's settings, or it can be a dedicated "connect" flow.</span><span class="sxs-lookup"><span data-stu-id="de78b-152">This page can be part of the app's sign-in flow, part of the app's settings, or it can be a dedicated "connect" flow.</span></span> <span data-ttu-id="de78b-153">In many cases, it makes sense for the app to show this "connect" view only after a user has signed in with a work or school Microsoft account.</span><span class="sxs-lookup"><span data-stu-id="de78b-153">In many cases, it makes sense for the app to show this "connect" view only after a user has signed in with a work or school Microsoft account.</span></span>

<span data-ttu-id="de78b-154">If you sign the user in to your app, you can identify the organization to which the user belongs before you ask the user to approve the application permissions.</span><span class="sxs-lookup"><span data-stu-id="de78b-154">If you sign the user in to your app, you can identify the organization to which the user belongs before you ask the user to approve the application permissions.</span></span> <span data-ttu-id="de78b-155">Although not strictly necessary, it can help you create a more intuitive experience for your users.</span><span class="sxs-lookup"><span data-stu-id="de78b-155">Although not strictly necessary, it can help you create a more intuitive experience for your users.</span></span> <span data-ttu-id="de78b-156">To sign the user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="de78b-156">To sign the user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span></span>

#### <a name="request-the-permissions-from-a-directory-admin"></a><span data-ttu-id="de78b-157">Request the permissions from a directory admin</span><span class="sxs-lookup"><span data-stu-id="de78b-157">Request the permissions from a directory admin</span></span>
<span data-ttu-id="de78b-158">When you're ready to request permissions from the organization's admin, you can redirect the user to the v2.0 *admin consent endpoint*.</span><span class="sxs-lookup"><span data-stu-id="de78b-158">When you're ready to request permissions from the organization's admin, you can redirect the user to the v2.0 *admin consent endpoint*.</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting the following request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| <span data-ttu-id="de78b-159">Parameter</span><span class="sxs-lookup"><span data-stu-id="de78b-159">Parameter</span></span> | <span data-ttu-id="de78b-160">Condition</span><span class="sxs-lookup"><span data-stu-id="de78b-160">Condition</span></span> | <span data-ttu-id="de78b-161">Description</span><span class="sxs-lookup"><span data-stu-id="de78b-161">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="de78b-162">tenant</span><span class="sxs-lookup"><span data-stu-id="de78b-162">tenant</span></span> |<span data-ttu-id="de78b-163">Required</span><span class="sxs-lookup"><span data-stu-id="de78b-163">Required</span></span> |<span data-ttu-id="de78b-164">The directory tenant that you want to request permission from.</span><span class="sxs-lookup"><span data-stu-id="de78b-164">The directory tenant that you want to request permission from.</span></span> <span data-ttu-id="de78b-165">This can be in GUID or friendly name format.</span><span class="sxs-lookup"><span data-stu-id="de78b-165">This can be in GUID or friendly name format.</span></span> <span data-ttu-id="de78b-166">If you don't know which tenant the user belongs to and you want to let them sign in with any tenant, use `common`.</span><span class="sxs-lookup"><span data-stu-id="de78b-166">If you don't know which tenant the user belongs to and you want to let them sign in with any tenant, use `common`.</span></span> |
| <span data-ttu-id="de78b-167">client_id</span><span class="sxs-lookup"><span data-stu-id="de78b-167">client_id</span></span> |<span data-ttu-id="de78b-168">Required</span><span class="sxs-lookup"><span data-stu-id="de78b-168">Required</span></span> |<span data-ttu-id="de78b-169">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span><span class="sxs-lookup"><span data-stu-id="de78b-169">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="de78b-170">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="de78b-170">redirect_uri</span></span> |<span data-ttu-id="de78b-171">Required</span><span class="sxs-lookup"><span data-stu-id="de78b-171">Required</span></span> |<span data-ttu-id="de78b-172">The redirect URI where you want the response to be sent for your app to handle.</span><span class="sxs-lookup"><span data-stu-id="de78b-172">The redirect URI where you want the response to be sent for your app to handle.</span></span> <span data-ttu-id="de78b-173">It must exactly match one of the redirect URIs that you registered in the portal, except that it must be URL encoded, and it can have additional path segments.</span><span class="sxs-lookup"><span data-stu-id="de78b-173">It must exactly match one of the redirect URIs that you registered in the portal, except that it must be URL encoded, and it can have additional path segments.</span></span> |
| <span data-ttu-id="de78b-174">state</span><span class="sxs-lookup"><span data-stu-id="de78b-174">state</span></span> |<span data-ttu-id="de78b-175">Recommended</span><span class="sxs-lookup"><span data-stu-id="de78b-175">Recommended</span></span> |<span data-ttu-id="de78b-176">A value that is included in the request that also is returned in the token response.</span><span class="sxs-lookup"><span data-stu-id="de78b-176">A value that is included in the request that also is returned in the token response.</span></span> <span data-ttu-id="de78b-177">It can be a string of any content that you want.</span><span class="sxs-lookup"><span data-stu-id="de78b-177">It can be a string of any content that you want.</span></span> <span data-ttu-id="de78b-178">The state is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span><span class="sxs-lookup"><span data-stu-id="de78b-178">The state is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |

<span data-ttu-id="de78b-179">At this point, Azure AD enforces that only a tenant administrator can sign in to complete the request.</span><span class="sxs-lookup"><span data-stu-id="de78b-179">At this point, Azure AD enforces that only a tenant administrator can sign in to complete the request.</span></span> <span data-ttu-id="de78b-180">The administrator will be asked to approve all the direct application permissions that you have requested for your app in the app registration portal.</span><span class="sxs-lookup"><span data-stu-id="de78b-180">The administrator will be asked to approve all the direct application permissions that you have requested for your app in the app registration portal.</span></span>

##### <a name="successful-response"></a><span data-ttu-id="de78b-181">Successful response</span><span class="sxs-lookup"><span data-stu-id="de78b-181">Successful response</span></span>
<span data-ttu-id="de78b-182">If the admin approves the permissions for your application, the successful response looks like this:</span><span class="sxs-lookup"><span data-stu-id="de78b-182">If the admin approves the permissions for your application, the successful response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| <span data-ttu-id="de78b-183">Parameter</span><span class="sxs-lookup"><span data-stu-id="de78b-183">Parameter</span></span> | <span data-ttu-id="de78b-184">Description</span><span class="sxs-lookup"><span data-stu-id="de78b-184">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="de78b-185">tenant</span><span class="sxs-lookup"><span data-stu-id="de78b-185">tenant</span></span> |<span data-ttu-id="de78b-186">The directory tenant that granted your application the permissions that it requested, in GUID format.</span><span class="sxs-lookup"><span data-stu-id="de78b-186">The directory tenant that granted your application the permissions that it requested, in GUID format.</span></span> |
| <span data-ttu-id="de78b-187">state</span><span class="sxs-lookup"><span data-stu-id="de78b-187">state</span></span> |<span data-ttu-id="de78b-188">A value that is included in the request that also is returned in the token response.</span><span class="sxs-lookup"><span data-stu-id="de78b-188">A value that is included in the request that also is returned in the token response.</span></span> <span data-ttu-id="de78b-189">It can be a string of any content that you want.</span><span class="sxs-lookup"><span data-stu-id="de78b-189">It can be a string of any content that you want.</span></span> <span data-ttu-id="de78b-190">The state is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span><span class="sxs-lookup"><span data-stu-id="de78b-190">The state is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |
| <span data-ttu-id="de78b-191">admin_consent</span><span class="sxs-lookup"><span data-stu-id="de78b-191">admin_consent</span></span> |<span data-ttu-id="de78b-192">Set to **true**.</span><span class="sxs-lookup"><span data-stu-id="de78b-192">Set to **true**.</span></span> |

##### <a name="error-response"></a><span data-ttu-id="de78b-193">Error response</span><span class="sxs-lookup"><span data-stu-id="de78b-193">Error response</span></span>
<span data-ttu-id="de78b-194">If the admin does not approve the permissions for your application, the failed response looks like this:</span><span class="sxs-lookup"><span data-stu-id="de78b-194">If the admin does not approve the permissions for your application, the failed response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| <span data-ttu-id="de78b-195">Parameter</span><span class="sxs-lookup"><span data-stu-id="de78b-195">Parameter</span></span> | <span data-ttu-id="de78b-196">Description</span><span class="sxs-lookup"><span data-stu-id="de78b-196">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="de78b-197">error</span><span class="sxs-lookup"><span data-stu-id="de78b-197">error</span></span> |<span data-ttu-id="de78b-198">An error code string that you can use to classify types of errors, and which you can use to react to errors.</span><span class="sxs-lookup"><span data-stu-id="de78b-198">An error code string that you can use to classify types of errors, and which you can use to react to errors.</span></span> |
| <span data-ttu-id="de78b-199">error_description</span><span class="sxs-lookup"><span data-stu-id="de78b-199">error_description</span></span> |<span data-ttu-id="de78b-200">A specific error message that can help you identify the root cause of an error.</span><span class="sxs-lookup"><span data-stu-id="de78b-200">A specific error message that can help you identify the root cause of an error.</span></span> |

<span data-ttu-id="de78b-201">After you've received a successful response from the app provisioning endpoint, your app has gained the direct application permissions that it requested.</span><span class="sxs-lookup"><span data-stu-id="de78b-201">After you've received a successful response from the app provisioning endpoint, your app has gained the direct application permissions that it requested.</span></span> <span data-ttu-id="de78b-202">Now you can request a token for the resource that you want.</span><span class="sxs-lookup"><span data-stu-id="de78b-202">Now you can request a token for the resource that you want.</span></span>

## <a name="get-a-token"></a><span data-ttu-id="de78b-203">Get a token</span><span class="sxs-lookup"><span data-stu-id="de78b-203">Get a token</span></span>
<span data-ttu-id="de78b-204">After you've acquired the necessary authorization for your application, proceed with acquiring access tokens for APIs.</span><span class="sxs-lookup"><span data-stu-id="de78b-204">After you've acquired the necessary authorization for your application, proceed with acquiring access tokens for APIs.</span></span> <span data-ttu-id="de78b-205">To get a token by using the client credentials grant, send a POST request to the `/token` v2.0 endpoint:</span><span class="sxs-lookup"><span data-stu-id="de78b-205">To get a token by using the client credentials grant, send a POST request to the `/token` v2.0 endpoint:</span></span>

### <a name="first-case-access-token-request-with-a-shared-secret"></a><span data-ttu-id="de78b-206">First case: Access token request with a shared secret</span><span class="sxs-lookup"><span data-stu-id="de78b-206">First case: Access token request with a shared secret</span></span>

```
POST /{tenant}/oauth2/v2.0/token HTTP/1.1           //Line breaks for clarity
Host: login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

client_id=535fb089-9ff3-47b6-9bfb-4f1264799865
&scope=https%3A%2F%2Fgraph.microsoft.com%2F.default
&client_secret=qWgdYAmab0YSkuL1qKv5bPX
&grant_type=client_credentials
```

```
curl -X POST -H "Content-Type: application/x-www-form-urlencoded" -d 'client_id=535fb089-9ff3-47b6-9bfb-4f1264799865&scope=https%3A%2F%2Fgraph.microsoft.com%2F.default&client_secret=qWgdYAmab0YSkuL1qKv5bPX&grant_type=client_credentials' 'https://login.microsoftonline.com/common/oauth2/v2.0/token'
```

| <span data-ttu-id="de78b-207">Parameter</span><span class="sxs-lookup"><span data-stu-id="de78b-207">Parameter</span></span> | <span data-ttu-id="de78b-208">Condition</span><span class="sxs-lookup"><span data-stu-id="de78b-208">Condition</span></span> | <span data-ttu-id="de78b-209">Description</span><span class="sxs-lookup"><span data-stu-id="de78b-209">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="de78b-210">tenant</span><span class="sxs-lookup"><span data-stu-id="de78b-210">tenant</span></span> |<span data-ttu-id="de78b-211">Required</span><span class="sxs-lookup"><span data-stu-id="de78b-211">Required</span></span> | <span data-ttu-id="de78b-212">The directory tenant the application plans to operate against, in GUID or domain-name format.</span><span class="sxs-lookup"><span data-stu-id="de78b-212">The directory tenant the application plans to operate against, in GUID or domain-name format.</span></span> |
| <span data-ttu-id="de78b-213">client_id</span><span class="sxs-lookup"><span data-stu-id="de78b-213">client_id</span></span> |<span data-ttu-id="de78b-214">Required</span><span class="sxs-lookup"><span data-stu-id="de78b-214">Required</span></span> |<span data-ttu-id="de78b-215">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span><span class="sxs-lookup"><span data-stu-id="de78b-215">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="de78b-216">scope</span><span class="sxs-lookup"><span data-stu-id="de78b-216">scope</span></span> |<span data-ttu-id="de78b-217">Required</span><span class="sxs-lookup"><span data-stu-id="de78b-217">Required</span></span> |<span data-ttu-id="de78b-218">The value passed for the `scope` parameter in this request should be the resource identifier (Application ID URI) of the resource you want, affixed with the `.default` suffix.</span><span class="sxs-lookup"><span data-stu-id="de78b-218">The value passed for the `scope` parameter in this request should be the resource identifier (Application ID URI) of the resource you want, affixed with the `.default` suffix.</span></span> <span data-ttu-id="de78b-219">For the Microsoft Graph example, the value is `https://graph.microsoft.com/.default`.</span><span class="sxs-lookup"><span data-stu-id="de78b-219">For the Microsoft Graph example, the value is `https://graph.microsoft.com/.default`.</span></span> <span data-ttu-id="de78b-220">This value informs the v2.0 endpoint that of all the direct application permissions you have configured for your app, it should issue a token for the ones associated with the resource you want to use.</span><span class="sxs-lookup"><span data-stu-id="de78b-220">This value informs the v2.0 endpoint that of all the direct application permissions you have configured for your app, it should issue a token for the ones associated with the resource you want to use.</span></span> |
| <span data-ttu-id="de78b-221">client_secret</span><span class="sxs-lookup"><span data-stu-id="de78b-221">client_secret</span></span> |<span data-ttu-id="de78b-222">Required</span><span class="sxs-lookup"><span data-stu-id="de78b-222">Required</span></span> |<span data-ttu-id="de78b-223">The Application Secret that you generated for your app in the app registration portal.</span><span class="sxs-lookup"><span data-stu-id="de78b-223">The Application Secret that you generated for your app in the app registration portal.</span></span> <span data-ttu-id="de78b-224">The client secret must be URL-encoded before being sent.</span><span class="sxs-lookup"><span data-stu-id="de78b-224">The client secret must be URL-encoded before being sent.</span></span>|
| <span data-ttu-id="de78b-225">grant_type</span><span class="sxs-lookup"><span data-stu-id="de78b-225">grant_type</span></span> |<span data-ttu-id="de78b-226">Required</span><span class="sxs-lookup"><span data-stu-id="de78b-226">Required</span></span> |<span data-ttu-id="de78b-227">Must be `client_credentials`.</span><span class="sxs-lookup"><span data-stu-id="de78b-227">Must be `client_credentials`.</span></span> |

### <a name="second-case-access-token-request-with-a-certificate"></a><span data-ttu-id="de78b-228">Second case: Access token request with a certificate</span><span class="sxs-lookup"><span data-stu-id="de78b-228">Second case: Access token request with a certificate</span></span>

```
POST /{tenant}/oauth2/v2.0/token HTTP/1.1               // Line breaks for clarity
Host: login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

scope=https%3A%2F%2Fgraph.microsoft.com%2F.default
&client_id=97e0a5b7-d745-40b6-94fe-5f77d35c6e05
&client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer
&client_assertion=eyJhbGciOiJSUzI1NiIsIng1dCI6Imd4OHRHeXN5amNScUtqRlBuZDdSRnd2d1pJMCJ9.eyJ{a lot of characters here}M8U3bSUKKJDEg
&grant_type=client_credentials
```

| <span data-ttu-id="de78b-229">Parameter</span><span class="sxs-lookup"><span data-stu-id="de78b-229">Parameter</span></span> | <span data-ttu-id="de78b-230">Condition</span><span class="sxs-lookup"><span data-stu-id="de78b-230">Condition</span></span> | <span data-ttu-id="de78b-231">Description</span><span class="sxs-lookup"><span data-stu-id="de78b-231">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="de78b-232">tenant</span><span class="sxs-lookup"><span data-stu-id="de78b-232">tenant</span></span> |<span data-ttu-id="de78b-233">Required</span><span class="sxs-lookup"><span data-stu-id="de78b-233">Required</span></span> | <span data-ttu-id="de78b-234">The directory tenant the application plans to operate against, in GUID or domain-name format.</span><span class="sxs-lookup"><span data-stu-id="de78b-234">The directory tenant the application plans to operate against, in GUID or domain-name format.</span></span> |
| <span data-ttu-id="de78b-235">client_id</span><span class="sxs-lookup"><span data-stu-id="de78b-235">client_id</span></span> |<span data-ttu-id="de78b-236">Required</span><span class="sxs-lookup"><span data-stu-id="de78b-236">Required</span></span> |<span data-ttu-id="de78b-237">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span><span class="sxs-lookup"><span data-stu-id="de78b-237">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="de78b-238">scope</span><span class="sxs-lookup"><span data-stu-id="de78b-238">scope</span></span> |<span data-ttu-id="de78b-239">Required</span><span class="sxs-lookup"><span data-stu-id="de78b-239">Required</span></span> |<span data-ttu-id="de78b-240">The value passed for the `scope` parameter in this request should be the resource identifier (Application ID URI) of the resource you want, affixed with the `.default` suffix.</span><span class="sxs-lookup"><span data-stu-id="de78b-240">The value passed for the `scope` parameter in this request should be the resource identifier (Application ID URI) of the resource you want, affixed with the `.default` suffix.</span></span> <span data-ttu-id="de78b-241">For the Microsoft Graph example, the value is `https://graph.microsoft.com/.default`.</span><span class="sxs-lookup"><span data-stu-id="de78b-241">For the Microsoft Graph example, the value is `https://graph.microsoft.com/.default`.</span></span> <span data-ttu-id="de78b-242">This value informs the v2.0 endpoint that of all the direct application permissions you have configured for your app, it should issue a token for the ones associated with the resource you want to use.</span><span class="sxs-lookup"><span data-stu-id="de78b-242">This value informs the v2.0 endpoint that of all the direct application permissions you have configured for your app, it should issue a token for the ones associated with the resource you want to use.</span></span> |
| <span data-ttu-id="de78b-243">client_assertion_type</span><span class="sxs-lookup"><span data-stu-id="de78b-243">client_assertion_type</span></span> |<span data-ttu-id="de78b-244">required</span><span class="sxs-lookup"><span data-stu-id="de78b-244">required</span></span> |<span data-ttu-id="de78b-245">The value must be `urn:ietf:params:oauth:client-assertion-type:jwt-bearer`</span><span class="sxs-lookup"><span data-stu-id="de78b-245">The value must be `urn:ietf:params:oauth:client-assertion-type:jwt-bearer`</span></span> |
| <span data-ttu-id="de78b-246">client_assertion</span><span class="sxs-lookup"><span data-stu-id="de78b-246">client_assertion</span></span> |<span data-ttu-id="de78b-247">required</span><span class="sxs-lookup"><span data-stu-id="de78b-247">required</span></span> | <span data-ttu-id="de78b-248">An assertion (a JSON Web Token) that you need to create and sign with the certificate you registered as credentials for your application.</span><span class="sxs-lookup"><span data-stu-id="de78b-248">An assertion (a JSON Web Token) that you need to create and sign with the certificate you registered as credentials for your application.</span></span> <span data-ttu-id="de78b-249">Read about [certificate credentials](active-directory-certificate-credentials.md) to learn how to register your certificate and the format of the assertion.</span><span class="sxs-lookup"><span data-stu-id="de78b-249">Read about [certificate credentials](active-directory-certificate-credentials.md) to learn how to register your certificate and the format of the assertion.</span></span>|
| <span data-ttu-id="de78b-250">grant_type</span><span class="sxs-lookup"><span data-stu-id="de78b-250">grant_type</span></span> |<span data-ttu-id="de78b-251">Required</span><span class="sxs-lookup"><span data-stu-id="de78b-251">Required</span></span> |<span data-ttu-id="de78b-252">Must be `client_credentials`.</span><span class="sxs-lookup"><span data-stu-id="de78b-252">Must be `client_credentials`.</span></span> |

<span data-ttu-id="de78b-253">Notice that the parameters are almost the same as in the case of the request by shared secret except that the client_secret parameter is replaced by two parameters: a client_assertion_type and client_assertion.</span><span class="sxs-lookup"><span data-stu-id="de78b-253">Notice that the parameters are almost the same as in the case of the request by shared secret except that the client_secret parameter is replaced by two parameters: a client_assertion_type and client_assertion.</span></span>

### <a name="successful-response"></a><span data-ttu-id="de78b-254">Successful response</span><span class="sxs-lookup"><span data-stu-id="de78b-254">Successful response</span></span>
<span data-ttu-id="de78b-255">A successful response looks like this:</span><span class="sxs-lookup"><span data-stu-id="de78b-255">A successful response looks like this:</span></span>

```
{
  "token_type": "Bearer",
  "expires_in": 3599,
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBP..."
}
```

| <span data-ttu-id="de78b-256">Parameter</span><span class="sxs-lookup"><span data-stu-id="de78b-256">Parameter</span></span> | <span data-ttu-id="de78b-257">Description</span><span class="sxs-lookup"><span data-stu-id="de78b-257">Description</span></span> |
| --- | --- |
| <span data-ttu-id="de78b-258">access_token</span><span class="sxs-lookup"><span data-stu-id="de78b-258">access_token</span></span> |<span data-ttu-id="de78b-259">The requested access token.</span><span class="sxs-lookup"><span data-stu-id="de78b-259">The requested access token.</span></span> <span data-ttu-id="de78b-260">The app can use this token to authenticate to the secured resource, such as to a Web API.</span><span class="sxs-lookup"><span data-stu-id="de78b-260">The app can use this token to authenticate to the secured resource, such as to a Web API.</span></span> |
| <span data-ttu-id="de78b-261">token_type</span><span class="sxs-lookup"><span data-stu-id="de78b-261">token_type</span></span> |<span data-ttu-id="de78b-262">Indicates the token type value.</span><span class="sxs-lookup"><span data-stu-id="de78b-262">Indicates the token type value.</span></span> <span data-ttu-id="de78b-263">The only type that Azure AD supports is `bearer`.</span><span class="sxs-lookup"><span data-stu-id="de78b-263">The only type that Azure AD supports is `bearer`.</span></span> |
| <span data-ttu-id="de78b-264">expires_in</span><span class="sxs-lookup"><span data-stu-id="de78b-264">expires_in</span></span> |<span data-ttu-id="de78b-265">How long the access token is valid (in seconds).</span><span class="sxs-lookup"><span data-stu-id="de78b-265">How long the access token is valid (in seconds).</span></span> |

### <a name="error-response"></a><span data-ttu-id="de78b-266">Error response</span><span class="sxs-lookup"><span data-stu-id="de78b-266">Error response</span></span>
<span data-ttu-id="de78b-267">An error response looks like this:</span><span class="sxs-lookup"><span data-stu-id="de78b-267">An error response looks like this:</span></span>

```
{
  "error": "invalid_scope",
  "error_description": "AADSTS70011: The provided value for the input parameter 'scope' is not valid. The scope https://foo.microsoft.com/.default is not valid.\r\nTrace ID: 255d1aef-8c98-452f-ac51-23d051240864\r\nCorrelation ID: fb3d2015-bc17-4bb9-bb85-30c5cf1aaaa7\r\nTimestamp: 2016-01-09 02:02:12Z",
  "error_codes": [
    70011
  ],
  "timestamp": "2016-01-09 02:02:12Z",
  "trace_id": "255d1aef-8c98-452f-ac51-23d051240864",
  "correlation_id": "fb3d2015-bc17-4bb9-bb85-30c5cf1aaaa7"
}
```

| <span data-ttu-id="de78b-268">Parameter</span><span class="sxs-lookup"><span data-stu-id="de78b-268">Parameter</span></span> | <span data-ttu-id="de78b-269">Description</span><span class="sxs-lookup"><span data-stu-id="de78b-269">Description</span></span> |
| --- | --- |
| <span data-ttu-id="de78b-270">error</span><span class="sxs-lookup"><span data-stu-id="de78b-270">error</span></span> |<span data-ttu-id="de78b-271">An error code string that you can use to classify types of errors that occur, and to react to errors.</span><span class="sxs-lookup"><span data-stu-id="de78b-271">An error code string that you can use to classify types of errors that occur, and to react to errors.</span></span> |
| <span data-ttu-id="de78b-272">error_description</span><span class="sxs-lookup"><span data-stu-id="de78b-272">error_description</span></span> |<span data-ttu-id="de78b-273">A specific error message that might help you identify the root cause of an authentication error.</span><span class="sxs-lookup"><span data-stu-id="de78b-273">A specific error message that might help you identify the root cause of an authentication error.</span></span> |
| <span data-ttu-id="de78b-274">error_codes</span><span class="sxs-lookup"><span data-stu-id="de78b-274">error_codes</span></span> |<span data-ttu-id="de78b-275">A list of STS-specific error codes that might help with diagnostics.</span><span class="sxs-lookup"><span data-stu-id="de78b-275">A list of STS-specific error codes that might help with diagnostics.</span></span> |
| <span data-ttu-id="de78b-276">timestamp</span><span class="sxs-lookup"><span data-stu-id="de78b-276">timestamp</span></span> |<span data-ttu-id="de78b-277">The time at which the error occurred.</span><span class="sxs-lookup"><span data-stu-id="de78b-277">The time at which the error occurred.</span></span> |
| <span data-ttu-id="de78b-278">trace_id</span><span class="sxs-lookup"><span data-stu-id="de78b-278">trace_id</span></span> |<span data-ttu-id="de78b-279">A unique identifier for the request that might help with diagnostics.</span><span class="sxs-lookup"><span data-stu-id="de78b-279">A unique identifier for the request that might help with diagnostics.</span></span> |
| <span data-ttu-id="de78b-280">correlation_id</span><span class="sxs-lookup"><span data-stu-id="de78b-280">correlation_id</span></span> |<span data-ttu-id="de78b-281">A unique identifier for the request that might help with diagnostics across components.</span><span class="sxs-lookup"><span data-stu-id="de78b-281">A unique identifier for the request that might help with diagnostics across components.</span></span> |

## <a name="use-a-token"></a><span data-ttu-id="de78b-282">Use a token</span><span class="sxs-lookup"><span data-stu-id="de78b-282">Use a token</span></span>
<span data-ttu-id="de78b-283">Now that you've acquired a token, use the token to make requests to the resource.</span><span class="sxs-lookup"><span data-stu-id="de78b-283">Now that you've acquired a token, use the token to make requests to the resource.</span></span> <span data-ttu-id="de78b-284">When the token expires, repeat the request to the `/token` endpoint to acquire a fresh access token.</span><span class="sxs-lookup"><span data-stu-id="de78b-284">When the token expires, repeat the request to the `/token` endpoint to acquire a fresh access token.</span></span>

```
GET /v1.0/me/messages
Host: https://graph.microsoft.com
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q...
```

```
// Pro tip: Try the following command! (Replace the token with your own.)
```

```
curl -X GET -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik5HVEZ2ZEstZnl0aEV1Q" 'https://graph.microsoft.com/v1.0/me/messages'
```

## <a name="code-sample"></a><span data-ttu-id="de78b-285">Code sample</span><span class="sxs-lookup"><span data-stu-id="de78b-285">Code sample</span></span>
<span data-ttu-id="de78b-286">To see an example of an application that implements the client credentials grant by using the admin consent endpoint, see our [v2.0 daemon code sample](https://github.com/Azure-Samples/active-directory-dotnet-daemon-v2).</span><span class="sxs-lookup"><span data-stu-id="de78b-286">To see an example of an application that implements the client credentials grant by using the admin consent endpoint, see our [v2.0 daemon code sample](https://github.com/Azure-Samples/active-directory-dotnet-daemon-v2).</span></span>
