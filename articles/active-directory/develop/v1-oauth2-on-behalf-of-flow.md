---
title: Azure AD service to service auth using OAuth2.0 On-Behalf-Of draft specification | Microsoft Docs
description: This article describes how to use HTTP messages to implement service to service authentication using the OAuth2.0 On-Behalf-Of flow.
services: active-directory
documentationcenter: .net
author: navyasric
manager: mtillman
editor: ''
ms.assetid: 09f6f318-e88b-4024-9ee1-e7f09fb19a82
ms.service: active-directory
ms.component: develop
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/06/2017
ms.author: celested
ms.reviewer: hirsin, nacanuma
ms.custom: aaddev
ms.openlocfilehash: ce29c6a9df49721ca23f84da3f1c97bcc83ab4a7
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44869065"
---
# <a name="service-to-service-calls-using-delegated-user-identity-in-the-on-behalf-of-flow"></a><span data-ttu-id="57ce0-103">Service to service calls using delegated user identity in the On-Behalf-Of flow</span><span class="sxs-lookup"><span data-stu-id="57ce0-103">Service to service calls using delegated user identity in the On-Behalf-Of flow</span></span>
<span data-ttu-id="57ce0-104">The OAuth 2.0 On-Behalf-Of (OBO) flow serves the use case where an application invokes a service/web API, which in turn needs to call another service/web API.</span><span class="sxs-lookup"><span data-stu-id="57ce0-104">The OAuth 2.0 On-Behalf-Of (OBO) flow serves the use case where an application invokes a service/web API, which in turn needs to call another service/web API.</span></span> <span data-ttu-id="57ce0-105">The idea is to propagate the delegated user identity and permissions through the request chain.</span><span class="sxs-lookup"><span data-stu-id="57ce0-105">The idea is to propagate the delegated user identity and permissions through the request chain.</span></span> <span data-ttu-id="57ce0-106">For the middle-tier service to make authenticated requests to the downstream service, it needs to secure an access token from Azure Active Directory (Azure AD), on behalf of the user.</span><span class="sxs-lookup"><span data-stu-id="57ce0-106">For the middle-tier service to make authenticated requests to the downstream service, it needs to secure an access token from Azure Active Directory (Azure AD), on behalf of the user.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="57ce0-107">Public clients that use the [OAuth 2.0 implicit grant](v1-oauth2-implicit-grant-flow.md) cannot use the OBO flow.</span><span class="sxs-lookup"><span data-stu-id="57ce0-107">Public clients that use the [OAuth 2.0 implicit grant](v1-oauth2-implicit-grant-flow.md) cannot use the OBO flow.</span></span> <span data-ttu-id="57ce0-108">These clients must pass their access token to a middle-tier confidential client to perform OBO flows.</span><span class="sxs-lookup"><span data-stu-id="57ce0-108">These clients must pass their access token to a middle-tier confidential client to perform OBO flows.</span></span> <span data-ttu-id="57ce0-109">For more info about which clients can perform OBO calls, see [Client limitations](#client-limitations).</span><span class="sxs-lookup"><span data-stu-id="57ce0-109">For more info about which clients can perform OBO calls, see [Client limitations](#client-limitations).</span></span>

## <a name="on-behalf-of-flow-diagram"></a><span data-ttu-id="57ce0-110">On-Behalf-Of flow diagram</span><span class="sxs-lookup"><span data-stu-id="57ce0-110">On-Behalf-Of flow diagram</span></span>
<span data-ttu-id="57ce0-111">Assume that the user has been authenticated on an application using the [OAuth 2.0 authorization code grant flow](v1-protocols-oauth-code.md).</span><span class="sxs-lookup"><span data-stu-id="57ce0-111">Assume that the user has been authenticated on an application using the [OAuth 2.0 authorization code grant flow](v1-protocols-oauth-code.md).</span></span> <span data-ttu-id="57ce0-112">At this point, the application has an access token (token A) with the user’s claims and consent to access the middle-tier web API (API A).</span><span class="sxs-lookup"><span data-stu-id="57ce0-112">At this point, the application has an access token (token A) with the user’s claims and consent to access the middle-tier web API (API A).</span></span> <span data-ttu-id="57ce0-113">Now, API A needs to make an authenticated request to the downstream web API (API B).</span><span class="sxs-lookup"><span data-stu-id="57ce0-113">Now, API A needs to make an authenticated request to the downstream web API (API B).</span></span>

<span data-ttu-id="57ce0-114">The steps that follow constitute the On-Behalf-Of flow and are explained with the help of the following diagram.</span><span class="sxs-lookup"><span data-stu-id="57ce0-114">The steps that follow constitute the On-Behalf-Of flow and are explained with the help of the following diagram.</span></span>

![OAuth2.0 On-Behalf-Of Flow](./media/v1-oauth2-on-behalf-of-flow/active-directory-protocols-oauth-on-behalf-of-flow.png)


1. <span data-ttu-id="57ce0-116">The client application makes a request to API A with the token A.</span><span class="sxs-lookup"><span data-stu-id="57ce0-116">The client application makes a request to API A with the token A.</span></span>
2. <span data-ttu-id="57ce0-117">API A authenticates to the Azure AD token issuance endpoint and requests a token to access API B.</span><span class="sxs-lookup"><span data-stu-id="57ce0-117">API A authenticates to the Azure AD token issuance endpoint and requests a token to access API B.</span></span>
3. <span data-ttu-id="57ce0-118">The Azure AD token issuance endpoint validates API A's credentials with token A and issues the access token for API B (token B).</span><span class="sxs-lookup"><span data-stu-id="57ce0-118">The Azure AD token issuance endpoint validates API A's credentials with token A and issues the access token for API B (token B).</span></span>
4. <span data-ttu-id="57ce0-119">The token B is set in the authorization header of the request to API B.</span><span class="sxs-lookup"><span data-stu-id="57ce0-119">The token B is set in the authorization header of the request to API B.</span></span>
5. <span data-ttu-id="57ce0-120">Data from the secured resource is returned by API B.</span><span class="sxs-lookup"><span data-stu-id="57ce0-120">Data from the secured resource is returned by API B.</span></span>

## <a name="register-the-application-and-service-in-azure-ad"></a><span data-ttu-id="57ce0-121">Register the application and service in Azure AD</span><span class="sxs-lookup"><span data-stu-id="57ce0-121">Register the application and service in Azure AD</span></span>
<span data-ttu-id="57ce0-122">Register both the client application and the middle-tier service in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="57ce0-122">Register both the client application and the middle-tier service in Azure AD.</span></span>
### <a name="register-the-middle-tier-service"></a><span data-ttu-id="57ce0-123">Register the middle-tier service</span><span class="sxs-lookup"><span data-stu-id="57ce0-123">Register the middle-tier service</span></span>
1. <span data-ttu-id="57ce0-124">Sign in to the [Azure portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="57ce0-124">Sign in to the [Azure portal](https://portal.azure.com).</span></span>
2. <span data-ttu-id="57ce0-125">On the top bar, click on your account and under the **Directory** list, choose the Active Directory tenant where you wish to register your application.</span><span class="sxs-lookup"><span data-stu-id="57ce0-125">On the top bar, click on your account and under the **Directory** list, choose the Active Directory tenant where you wish to register your application.</span></span>
3. <span data-ttu-id="57ce0-126">Click on **More Services** in the left hand nav, and choose **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="57ce0-126">Click on **More Services** in the left hand nav, and choose **Azure Active Directory**.</span></span>
4. <span data-ttu-id="57ce0-127">Click on **App registrations** and choose **New application registration**.</span><span class="sxs-lookup"><span data-stu-id="57ce0-127">Click on **App registrations** and choose **New application registration**.</span></span>
5. <span data-ttu-id="57ce0-128">Enter a friendly name for the application, and select the application type.</span><span class="sxs-lookup"><span data-stu-id="57ce0-128">Enter a friendly name for the application, and select the application type.</span></span> <span data-ttu-id="57ce0-129">Based on the application type set the sign-on URL or redirect URL to the base URL.</span><span class="sxs-lookup"><span data-stu-id="57ce0-129">Based on the application type set the sign-on URL or redirect URL to the base URL.</span></span> <span data-ttu-id="57ce0-130">Click on **Create** to create the application.</span><span class="sxs-lookup"><span data-stu-id="57ce0-130">Click on **Create** to create the application.</span></span>
6. <span data-ttu-id="57ce0-131">While still in the Azure portal, choose your application and click on **Settings**.</span><span class="sxs-lookup"><span data-stu-id="57ce0-131">While still in the Azure portal, choose your application and click on **Settings**.</span></span> <span data-ttu-id="57ce0-132">From the Settings menu, choose **Keys** and add a key - select a key duration of either 1 year or 2 years.</span><span class="sxs-lookup"><span data-stu-id="57ce0-132">From the Settings menu, choose **Keys** and add a key - select a key duration of either 1 year or 2 years.</span></span> <span data-ttu-id="57ce0-133">When you save this page, the key value will be displayed, copy and save the value in a safe location - you will need this key later to configure the application settings in your implementation - this key value will not be displayed again, nor retrievable by any other means, so please record it as soon as it is visible from the Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="57ce0-133">When you save this page, the key value will be displayed, copy and save the value in a safe location - you will need this key later to configure the application settings in your implementation - this key value will not be displayed again, nor retrievable by any other means, so please record it as soon as it is visible from the Azure Portal.</span></span>

### <a name="register-the-client-application"></a><span data-ttu-id="57ce0-134">Register the client application</span><span class="sxs-lookup"><span data-stu-id="57ce0-134">Register the client application</span></span>
1. <span data-ttu-id="57ce0-135">Sign in to the [Azure portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="57ce0-135">Sign in to the [Azure portal](https://portal.azure.com).</span></span>
2. <span data-ttu-id="57ce0-136">On the top bar, click on your account and under the **Directory** list, choose the Active Directory tenant where you wish to register your application.</span><span class="sxs-lookup"><span data-stu-id="57ce0-136">On the top bar, click on your account and under the **Directory** list, choose the Active Directory tenant where you wish to register your application.</span></span>
3. <span data-ttu-id="57ce0-137">Click on **More Services** in the left hand nav, and choose **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="57ce0-137">Click on **More Services** in the left hand nav, and choose **Azure Active Directory**.</span></span>
4. <span data-ttu-id="57ce0-138">Click on **App registrations** and choose **New application registration**.</span><span class="sxs-lookup"><span data-stu-id="57ce0-138">Click on **App registrations** and choose **New application registration**.</span></span>
5. <span data-ttu-id="57ce0-139">Enter a friendly name for the application, and select the application type.</span><span class="sxs-lookup"><span data-stu-id="57ce0-139">Enter a friendly name for the application, and select the application type.</span></span> <span data-ttu-id="57ce0-140">Based on the application type set the sign-on URL or redirect URL to the base URL.</span><span class="sxs-lookup"><span data-stu-id="57ce0-140">Based on the application type set the sign-on URL or redirect URL to the base URL.</span></span> <span data-ttu-id="57ce0-141">Click on **Create** to create the application.</span><span class="sxs-lookup"><span data-stu-id="57ce0-141">Click on **Create** to create the application.</span></span>
6. <span data-ttu-id="57ce0-142">Configure Permissions for your application - in the Settings menu, choose the **Required permissions** section, click on **Add**, then **Select an API**, and type the name of the middle-tier service in the textbox.</span><span class="sxs-lookup"><span data-stu-id="57ce0-142">Configure Permissions for your application - in the Settings menu, choose the **Required permissions** section, click on **Add**, then **Select an API**, and type the name of the middle-tier service in the textbox.</span></span> <span data-ttu-id="57ce0-143">Then, click on  **Select Permissions** and select 'Access *service name*'.</span><span class="sxs-lookup"><span data-stu-id="57ce0-143">Then, click on  **Select Permissions** and select 'Access *service name*'.</span></span>

### <a name="configure-known-client-applications"></a><span data-ttu-id="57ce0-144">Configure known client applications</span><span class="sxs-lookup"><span data-stu-id="57ce0-144">Configure known client applications</span></span>
<span data-ttu-id="57ce0-145">In this scenario, the middle-tier service has no user interaction to obtain the user's consent to access the downstream API.</span><span class="sxs-lookup"><span data-stu-id="57ce0-145">In this scenario, the middle-tier service has no user interaction to obtain the user's consent to access the downstream API.</span></span> <span data-ttu-id="57ce0-146">Therefore, the option to grant access to the downstream API must be presented upfront as a part of the consent step during authentication.</span><span class="sxs-lookup"><span data-stu-id="57ce0-146">Therefore, the option to grant access to the downstream API must be presented upfront as a part of the consent step during authentication.</span></span>
<span data-ttu-id="57ce0-147">To achieve this, follow the steps below to explicitly bind the client app's registration in Azure AD with the registration of the middle-tier service, which merges the consent required by both the client and middle-tier into a single dialog.</span><span class="sxs-lookup"><span data-stu-id="57ce0-147">To achieve this, follow the steps below to explicitly bind the client app's registration in Azure AD with the registration of the middle-tier service, which merges the consent required by both the client and middle-tier into a single dialog.</span></span>
1. <span data-ttu-id="57ce0-148">Navigate to the middle-tier service registration, and click on **Manifest** to open the manifest editor.</span><span class="sxs-lookup"><span data-stu-id="57ce0-148">Navigate to the middle-tier service registration, and click on **Manifest** to open the manifest editor.</span></span>
2. <span data-ttu-id="57ce0-149">In the manifest, locate the `knownClientApplications` array property, and add the Client ID of the client application as an element.</span><span class="sxs-lookup"><span data-stu-id="57ce0-149">In the manifest, locate the `knownClientApplications` array property, and add the Client ID of the client application as an element.</span></span>
3. <span data-ttu-id="57ce0-150">Save the manifest by clicking the save button.</span><span class="sxs-lookup"><span data-stu-id="57ce0-150">Save the manifest by clicking the save button.</span></span>

## <a name="service-to-service-access-token-request"></a><span data-ttu-id="57ce0-151">Service to service access token request</span><span class="sxs-lookup"><span data-stu-id="57ce0-151">Service to service access token request</span></span>
<span data-ttu-id="57ce0-152">To request an access token, make an HTTP POST to the tenant-specific Azure AD endpoint with the following parameters.</span><span class="sxs-lookup"><span data-stu-id="57ce0-152">To request an access token, make an HTTP POST to the tenant-specific Azure AD endpoint with the following parameters.</span></span>

```
https://login.microsoftonline.com/<tenant>/oauth2/token
```
<span data-ttu-id="57ce0-153">There are two cases depending on whether the client application chooses to be secured by a shared secret, or a certificate.</span><span class="sxs-lookup"><span data-stu-id="57ce0-153">There are two cases depending on whether the client application chooses to be secured by a shared secret, or a certificate.</span></span>

### <a name="first-case-access-token-request-with-a-shared-secret"></a><span data-ttu-id="57ce0-154">First case: Access token request with a shared secret</span><span class="sxs-lookup"><span data-stu-id="57ce0-154">First case: Access token request with a shared secret</span></span>
<span data-ttu-id="57ce0-155">When using a shared secret, a service-to-service access token request contains the following parameters:</span><span class="sxs-lookup"><span data-stu-id="57ce0-155">When using a shared secret, a service-to-service access token request contains the following parameters:</span></span>

| <span data-ttu-id="57ce0-156">Parameter</span><span class="sxs-lookup"><span data-stu-id="57ce0-156">Parameter</span></span> |  | <span data-ttu-id="57ce0-157">Description</span><span class="sxs-lookup"><span data-stu-id="57ce0-157">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="57ce0-158">grant_type</span><span class="sxs-lookup"><span data-stu-id="57ce0-158">grant_type</span></span> |<span data-ttu-id="57ce0-159">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-159">required</span></span> | <span data-ttu-id="57ce0-160">The type of the token request.</span><span class="sxs-lookup"><span data-stu-id="57ce0-160">The type of the token request.</span></span> <span data-ttu-id="57ce0-161">For a request using a JWT, the value must be **urn:ietf:params:oauth:grant-type:jwt-bearer**.</span><span class="sxs-lookup"><span data-stu-id="57ce0-161">For a request using a JWT, the value must be **urn:ietf:params:oauth:grant-type:jwt-bearer**.</span></span> |
| <span data-ttu-id="57ce0-162">assertion</span><span class="sxs-lookup"><span data-stu-id="57ce0-162">assertion</span></span> |<span data-ttu-id="57ce0-163">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-163">required</span></span> | <span data-ttu-id="57ce0-164">The value of the token used in the request.</span><span class="sxs-lookup"><span data-stu-id="57ce0-164">The value of the token used in the request.</span></span> |
| <span data-ttu-id="57ce0-165">client_id</span><span class="sxs-lookup"><span data-stu-id="57ce0-165">client_id</span></span> |<span data-ttu-id="57ce0-166">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-166">required</span></span> | <span data-ttu-id="57ce0-167">The App ID assigned to the calling service during registration with Azure AD.</span><span class="sxs-lookup"><span data-stu-id="57ce0-167">The App ID assigned to the calling service during registration with Azure AD.</span></span> <span data-ttu-id="57ce0-168">To find the App ID in the Azure Management Portal, click **Active Directory**, click the directory, and then click the application name.</span><span class="sxs-lookup"><span data-stu-id="57ce0-168">To find the App ID in the Azure Management Portal, click **Active Directory**, click the directory, and then click the application name.</span></span> |
| <span data-ttu-id="57ce0-169">client_secret</span><span class="sxs-lookup"><span data-stu-id="57ce0-169">client_secret</span></span> |<span data-ttu-id="57ce0-170">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-170">required</span></span> | <span data-ttu-id="57ce0-171">The key registered for the calling service in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="57ce0-171">The key registered for the calling service in Azure AD.</span></span> <span data-ttu-id="57ce0-172">This value should have been noted at the time of registration.</span><span class="sxs-lookup"><span data-stu-id="57ce0-172">This value should have been noted at the time of registration.</span></span> |
| <span data-ttu-id="57ce0-173">resource</span><span class="sxs-lookup"><span data-stu-id="57ce0-173">resource</span></span> |<span data-ttu-id="57ce0-174">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-174">required</span></span> | <span data-ttu-id="57ce0-175">The App ID URI of the receiving service (secured resource).</span><span class="sxs-lookup"><span data-stu-id="57ce0-175">The App ID URI of the receiving service (secured resource).</span></span> <span data-ttu-id="57ce0-176">To find the App ID URI, in the Azure Management Portal, click **Active Directory**, click the directory, click the application name, click **All settings** and then click **Properties**.</span><span class="sxs-lookup"><span data-stu-id="57ce0-176">To find the App ID URI, in the Azure Management Portal, click **Active Directory**, click the directory, click the application name, click **All settings** and then click **Properties**.</span></span> |
| <span data-ttu-id="57ce0-177">requested_token_use</span><span class="sxs-lookup"><span data-stu-id="57ce0-177">requested_token_use</span></span> |<span data-ttu-id="57ce0-178">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-178">required</span></span> | <span data-ttu-id="57ce0-179">Specifies how the request should be processed.</span><span class="sxs-lookup"><span data-stu-id="57ce0-179">Specifies how the request should be processed.</span></span> <span data-ttu-id="57ce0-180">In the On-Behalf-Of flow, the value must be **on_behalf_of**.</span><span class="sxs-lookup"><span data-stu-id="57ce0-180">In the On-Behalf-Of flow, the value must be **on_behalf_of**.</span></span> |
| <span data-ttu-id="57ce0-181">scope</span><span class="sxs-lookup"><span data-stu-id="57ce0-181">scope</span></span> |<span data-ttu-id="57ce0-182">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-182">required</span></span> | <span data-ttu-id="57ce0-183">A space separated list of scopes for the token request.</span><span class="sxs-lookup"><span data-stu-id="57ce0-183">A space separated list of scopes for the token request.</span></span> <span data-ttu-id="57ce0-184">For OpenID Connect, the scope **openid** must be specified.</span><span class="sxs-lookup"><span data-stu-id="57ce0-184">For OpenID Connect, the scope **openid** must be specified.</span></span>|

#### <a name="example"></a><span data-ttu-id="57ce0-185">Example</span><span class="sxs-lookup"><span data-stu-id="57ce0-185">Example</span></span>
<span data-ttu-id="57ce0-186">The following HTTP POST requests an access token for the https://graph.windows.net web API.</span><span class="sxs-lookup"><span data-stu-id="57ce0-186">The following HTTP POST requests an access token for the https://graph.windows.net web API.</span></span> <span data-ttu-id="57ce0-187">The `client_id` identifies the service that requests the access token.</span><span class="sxs-lookup"><span data-stu-id="57ce0-187">The `client_id` identifies the service that requests the access token.</span></span>

```
// line breaks for legibility only

POST /oauth2/token HTTP/1.1
Host: login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer
&client_id=625391af-c675-43e5-8e44-edd3e30ceb15
&client_secret=0Y1W%2BY3yYb3d9N8vSjvm8WrGzVZaAaHbHHcGbcgG%2BoI%3D
&resource=https%3A%2F%2Fgraph.windows.net
&assertion=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InowMzl6ZHNGdWl6cEJmQlZLMVRuMjVRSFlPMCIsImtpZCI6InowMzl6ZHNGdWl6cEJmQlZLMVRuMjVRSFlPMCJ9.eyJhdWQiOiJodHRwczovL2Rkb2JhbGlhbm91dGxvb2sub25taWNyb3NvZnQuY29tLzE5MjNmODYyLWU2ZGMtNDFhMy04MWRhLTgwMmJhZTAwYWY2ZCIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0LzI2MDM5Y2NlLTQ4OWQtNDAwMi04MjkzLTViMGM1MTM0ZWFjYi8iLCJpYXQiOjE0OTM0MjMxNTIsIm5iZiI6MTQ5MzQyMzE1MiwiZXhwIjoxNDkzNDY2NjUyLCJhY3IiOiIxIiwiYWlvIjoiWTJaZ1lCRFF2aTlVZEc0LzM0L3dpQndqbjhYeVp4YmR1TFhmVE1QeG8yYlN2elgreHBVQSIsImFtciI6WyJwd2QiXSwiYXBwaWQiOiJiMzE1MDA3OS03YmViLTQxN2YtYTA2YS0zZmRjNzhjMzI1NDUiLCJhcHBpZGFjciI6IjAiLCJlX2V4cCI6MzAyNDAwLCJmYW1pbHlfbmFtZSI6IlRlc3QiLCJnaXZlbl9uYW1lIjoiTmF2eWEiLCJpcGFkZHIiOiIxNjcuMjIwLjEuMTc3IiwibmFtZSI6Ik5hdnlhIFRlc3QiLCJvaWQiOiIxY2Q0YmNhYy1iODA4LTQyM2EtOWUyZi04MjdmYmIxYmI3MzkiLCJwbGF0ZiI6IjMiLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJzdWIiOiJEVXpYbkdKMDJIUk0zRW5pbDFxdjZCakxTNUllQy0tQ2ZpbzRxS1MzNEc4IiwidGlkIjoiMjYwMzljY2UtNDg5ZC00MDAyLTgyOTMtNWIwYzUxMzRlYWNiIiwidW5pcXVlX25hbWUiOiJuYXZ5YUBkZG9iYWxpYW5vdXRsb29rLm9ubWljcm9zb2Z0LmNvbSIsInVwbiI6Im5hdnlhQGRkb2JhbGlhbm91dGxvb2sub25taWNyb3NvZnQuY29tIiwidmVyIjoiMS4wIn0.R-Ke-XO7lK0r5uLwxB8g5CrcPAwRln5SccJCfEjU6IUqpqcjWcDzeDdNOySiVPDU_ZU5knJmzRCF8fcjFtPsaA4R7vdIEbDuOur15FXSvE8FvVSjP_49OH6hBYqoSUAslN3FMfbO6Z8YfCIY4tSOB2I6ahQ_x4ZWFWglC3w5mK-_4iX81bqi95eV4RUKefUuHhQDXtWhrSgIEC0YiluMvA4TnaJdLq_tWXIc4_Tq_KfpkvI004ONKgU7EAMEr1wZ4aDcJV2yf22gQ1sCSig6EGSTmmzDuEPsYiyd4NhidRZJP4HiiQh-hePBQsgcSgYGvz9wC6n57ufYKh2wm_Ti3Q
&requested_token_use=on_behalf_of
&scope=openid
```

### <a name="second-case-access-token-request-with-a-certificate"></a><span data-ttu-id="57ce0-188">Second case: Access token request with a certificate</span><span class="sxs-lookup"><span data-stu-id="57ce0-188">Second case: Access token request with a certificate</span></span>
<span data-ttu-id="57ce0-189">A service-to-service access token request with a certificate contains the following parameters:</span><span class="sxs-lookup"><span data-stu-id="57ce0-189">A service-to-service access token request with a certificate contains the following parameters:</span></span>

| <span data-ttu-id="57ce0-190">Parameter</span><span class="sxs-lookup"><span data-stu-id="57ce0-190">Parameter</span></span> |  | <span data-ttu-id="57ce0-191">Description</span><span class="sxs-lookup"><span data-stu-id="57ce0-191">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="57ce0-192">grant_type</span><span class="sxs-lookup"><span data-stu-id="57ce0-192">grant_type</span></span> |<span data-ttu-id="57ce0-193">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-193">required</span></span> | <span data-ttu-id="57ce0-194">The type of the token request.</span><span class="sxs-lookup"><span data-stu-id="57ce0-194">The type of the token request.</span></span> <span data-ttu-id="57ce0-195">For a request using a JWT, the value must be **urn:ietf:params:oauth:grant-type:jwt-bearer**.</span><span class="sxs-lookup"><span data-stu-id="57ce0-195">For a request using a JWT, the value must be **urn:ietf:params:oauth:grant-type:jwt-bearer**.</span></span> |
| <span data-ttu-id="57ce0-196">assertion</span><span class="sxs-lookup"><span data-stu-id="57ce0-196">assertion</span></span> |<span data-ttu-id="57ce0-197">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-197">required</span></span> | <span data-ttu-id="57ce0-198">The value of the token used in the request.</span><span class="sxs-lookup"><span data-stu-id="57ce0-198">The value of the token used in the request.</span></span> |
| <span data-ttu-id="57ce0-199">client_id</span><span class="sxs-lookup"><span data-stu-id="57ce0-199">client_id</span></span> |<span data-ttu-id="57ce0-200">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-200">required</span></span> | <span data-ttu-id="57ce0-201">The App ID assigned to the calling service during registration with Azure AD.</span><span class="sxs-lookup"><span data-stu-id="57ce0-201">The App ID assigned to the calling service during registration with Azure AD.</span></span> <span data-ttu-id="57ce0-202">To find the App ID in the Azure Management Portal, click **Active Directory**, click the directory, and then click the application name.</span><span class="sxs-lookup"><span data-stu-id="57ce0-202">To find the App ID in the Azure Management Portal, click **Active Directory**, click the directory, and then click the application name.</span></span> |
| <span data-ttu-id="57ce0-203">client_assertion_type</span><span class="sxs-lookup"><span data-stu-id="57ce0-203">client_assertion_type</span></span> |<span data-ttu-id="57ce0-204">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-204">required</span></span> |<span data-ttu-id="57ce0-205">The value must be `urn:ietf:params:oauth:client-assertion-type:jwt-bearer`</span><span class="sxs-lookup"><span data-stu-id="57ce0-205">The value must be `urn:ietf:params:oauth:client-assertion-type:jwt-bearer`</span></span> |
| <span data-ttu-id="57ce0-206">client_assertion</span><span class="sxs-lookup"><span data-stu-id="57ce0-206">client_assertion</span></span> |<span data-ttu-id="57ce0-207">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-207">required</span></span> | <span data-ttu-id="57ce0-208">An assertion (a JSON Web Token) that you need to create and sign with the certificate you registered as credentials for your application.</span><span class="sxs-lookup"><span data-stu-id="57ce0-208">An assertion (a JSON Web Token) that you need to create and sign with the certificate you registered as credentials for your application.</span></span> <span data-ttu-id="57ce0-209">Read about [certificate credentials](active-directory-certificate-credentials.md) to learn how to register your certificate and the format of the assertion.</span><span class="sxs-lookup"><span data-stu-id="57ce0-209">Read about [certificate credentials](active-directory-certificate-credentials.md) to learn how to register your certificate and the format of the assertion.</span></span>|
| <span data-ttu-id="57ce0-210">resource</span><span class="sxs-lookup"><span data-stu-id="57ce0-210">resource</span></span> |<span data-ttu-id="57ce0-211">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-211">required</span></span> | <span data-ttu-id="57ce0-212">The App ID URI of the receiving service (secured resource).</span><span class="sxs-lookup"><span data-stu-id="57ce0-212">The App ID URI of the receiving service (secured resource).</span></span> <span data-ttu-id="57ce0-213">To find the App ID URI, in the Azure Management Portal, click **Active Directory**, click the directory, click the application name, click **All settings** and then click **Properties**.</span><span class="sxs-lookup"><span data-stu-id="57ce0-213">To find the App ID URI, in the Azure Management Portal, click **Active Directory**, click the directory, click the application name, click **All settings** and then click **Properties**.</span></span> |
| <span data-ttu-id="57ce0-214">requested_token_use</span><span class="sxs-lookup"><span data-stu-id="57ce0-214">requested_token_use</span></span> |<span data-ttu-id="57ce0-215">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-215">required</span></span> | <span data-ttu-id="57ce0-216">Specifies how the request should be processed.</span><span class="sxs-lookup"><span data-stu-id="57ce0-216">Specifies how the request should be processed.</span></span> <span data-ttu-id="57ce0-217">In the On-Behalf-Of flow, the value must be **on_behalf_of**.</span><span class="sxs-lookup"><span data-stu-id="57ce0-217">In the On-Behalf-Of flow, the value must be **on_behalf_of**.</span></span> |
| <span data-ttu-id="57ce0-218">scope</span><span class="sxs-lookup"><span data-stu-id="57ce0-218">scope</span></span> |<span data-ttu-id="57ce0-219">required</span><span class="sxs-lookup"><span data-stu-id="57ce0-219">required</span></span> | <span data-ttu-id="57ce0-220">A space separated list of scopes for the token request.</span><span class="sxs-lookup"><span data-stu-id="57ce0-220">A space separated list of scopes for the token request.</span></span> <span data-ttu-id="57ce0-221">For OpenID Connect, the scope **openid** must be specified.</span><span class="sxs-lookup"><span data-stu-id="57ce0-221">For OpenID Connect, the scope **openid** must be specified.</span></span>|

<span data-ttu-id="57ce0-222">Notice that the parameters are almost the same as in the case of the request by shared secret except that the client_secret parameter is replaced by two parameters: a client_assertion_type and client_assertion.</span><span class="sxs-lookup"><span data-stu-id="57ce0-222">Notice that the parameters are almost the same as in the case of the request by shared secret except that the client_secret parameter is replaced by two parameters: a client_assertion_type and client_assertion.</span></span>

#### <a name="example"></a><span data-ttu-id="57ce0-223">Example</span><span class="sxs-lookup"><span data-stu-id="57ce0-223">Example</span></span>
<span data-ttu-id="57ce0-224">The following HTTP POST requests an access token for the https://graph.windows.net web API with a certificate.</span><span class="sxs-lookup"><span data-stu-id="57ce0-224">The following HTTP POST requests an access token for the https://graph.windows.net web API with a certificate.</span></span> <span data-ttu-id="57ce0-225">The `client_id` identifies the service that requests the access token.</span><span class="sxs-lookup"><span data-stu-id="57ce0-225">The `client_id` identifies the service that requests the access token.</span></span>

```
// line breaks for legibility only

POST /oauth2/token HTTP/1.1
Host: login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer
&client_id=625391af-c675-43e5-8e44-edd3e30ceb15
&client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer
&client_assertion=eyJhbGciOiJSUzI1NiIsIng1dCI6Imd4OHRHeXN5amNScUtqRlBuZDdSRnd2d1pJMCJ9.eyJ{a lot of characters here}M8U3bSUKKJDEg
&resource=https%3A%2F%2Fgraph.windows.net
&assertion=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InowMzl6ZHNGdWl6cEJmQlZLMVRuMjVRSFlPMCIsImtpZCI6InowMzl6ZHNGdWl6cEJmQlZLMVRuMjVRSFlPMCJ9.eyJhdWQiOiJodHRwczovL2Rkb2JhbGlhbm91dGxvb2sub25taWNyb3NvZnQuY29tLzE5MjNmODYyLWU2ZGMtNDFhMy04MWRhLTgwMmJhZTAwYWY2ZCIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0LzI2MDM5Y2NlLTQ4OWQtNDAwMi04MjkzLTViMGM1MTM0ZWFjYi8iLCJpYXQiOjE0OTM0MjMxNTIsIm5iZiI6MTQ5MzQyMzE1MiwiZXhwIjoxNDkzNDY2NjUyLCJhY3IiOiIxIiwiYWlvIjoiWTJaZ1lCRFF2aTlVZEc0LzM0L3dpQndqbjhYeVp4YmR1TFhmVE1QeG8yYlN2elgreHBVQSIsImFtciI6WyJwd2QiXSwiYXBwaWQiOiJiMzE1MDA3OS03YmViLTQxN2YtYTA2YS0zZmRjNzhjMzI1NDUiLCJhcHBpZGFjciI6IjAiLCJlX2V4cCI6MzAyNDAwLCJmYW1pbHlfbmFtZSI6IlRlc3QiLCJnaXZlbl9uYW1lIjoiTmF2eWEiLCJpcGFkZHIiOiIxNjcuMjIwLjEuMTc3IiwibmFtZSI6Ik5hdnlhIFRlc3QiLCJvaWQiOiIxY2Q0YmNhYy1iODA4LTQyM2EtOWUyZi04MjdmYmIxYmI3MzkiLCJwbGF0ZiI6IjMiLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJzdWIiOiJEVXpYbkdKMDJIUk0zRW5pbDFxdjZCakxTNUllQy0tQ2ZpbzRxS1MzNEc4IiwidGlkIjoiMjYwMzljY2UtNDg5ZC00MDAyLTgyOTMtNWIwYzUxMzRlYWNiIiwidW5pcXVlX25hbWUiOiJuYXZ5YUBkZG9iYWxpYW5vdXRsb29rLm9ubWljcm9zb2Z0LmNvbSIsInVwbiI6Im5hdnlhQGRkb2JhbGlhbm91dGxvb2sub25taWNyb3NvZnQuY29tIiwidmVyIjoiMS4wIn0.R-Ke-XO7lK0r5uLwxB8g5CrcPAwRln5SccJCfEjU6IUqpqcjWcDzeDdNOySiVPDU_ZU5knJmzRCF8fcjFtPsaA4R7vdIEbDuOur15FXSvE8FvVSjP_49OH6hBYqoSUAslN3FMfbO6Z8YfCIY4tSOB2I6ahQ_x4ZWFWglC3w5mK-_4iX81bqi95eV4RUKefUuHhQDXtWhrSgIEC0YiluMvA4TnaJdLq_tWXIc4_Tq_KfpkvI004ONKgU7EAMEr1wZ4aDcJV2yf22gQ1sCSig6EGSTmmzDuEPsYiyd4NhidRZJP4HiiQh-hePBQsgcSgYGvz9wC6n57ufYKh2wm_Ti3Q
&requested_token_use=on_behalf_of
&scope=openid
```

## <a name="service-to-service-access-token-response"></a><span data-ttu-id="57ce0-226">Service to service access token response</span><span class="sxs-lookup"><span data-stu-id="57ce0-226">Service to service access token response</span></span>
<span data-ttu-id="57ce0-227">A success response is a JSON OAuth 2.0 response with the following parameters.</span><span class="sxs-lookup"><span data-stu-id="57ce0-227">A success response is a JSON OAuth 2.0 response with the following parameters.</span></span>

| <span data-ttu-id="57ce0-228">Parameter</span><span class="sxs-lookup"><span data-stu-id="57ce0-228">Parameter</span></span> | <span data-ttu-id="57ce0-229">Description</span><span class="sxs-lookup"><span data-stu-id="57ce0-229">Description</span></span> |
| --- | --- |
| <span data-ttu-id="57ce0-230">token_type</span><span class="sxs-lookup"><span data-stu-id="57ce0-230">token_type</span></span> |<span data-ttu-id="57ce0-231">Indicates the token type value.</span><span class="sxs-lookup"><span data-stu-id="57ce0-231">Indicates the token type value.</span></span> <span data-ttu-id="57ce0-232">The only type that Azure AD supports is **Bearer**.</span><span class="sxs-lookup"><span data-stu-id="57ce0-232">The only type that Azure AD supports is **Bearer**.</span></span> <span data-ttu-id="57ce0-233">For more information about bearer tokens, see the [OAuth 2.0 Authorization Framework: Bearer Token Usage (RFC 6750)](http://www.rfc-editor.org/rfc/rfc6750.txt).</span><span class="sxs-lookup"><span data-stu-id="57ce0-233">For more information about bearer tokens, see the [OAuth 2.0 Authorization Framework: Bearer Token Usage (RFC 6750)](http://www.rfc-editor.org/rfc/rfc6750.txt).</span></span> |
| <span data-ttu-id="57ce0-234">scope</span><span class="sxs-lookup"><span data-stu-id="57ce0-234">scope</span></span> |<span data-ttu-id="57ce0-235">The scope of access granted in the token.</span><span class="sxs-lookup"><span data-stu-id="57ce0-235">The scope of access granted in the token.</span></span> |
| <span data-ttu-id="57ce0-236">expires_in</span><span class="sxs-lookup"><span data-stu-id="57ce0-236">expires_in</span></span> |<span data-ttu-id="57ce0-237">The length of time the access token is valid (in seconds).</span><span class="sxs-lookup"><span data-stu-id="57ce0-237">The length of time the access token is valid (in seconds).</span></span> |
| <span data-ttu-id="57ce0-238">expires_on</span><span class="sxs-lookup"><span data-stu-id="57ce0-238">expires_on</span></span> |<span data-ttu-id="57ce0-239">The time when the access token expires.</span><span class="sxs-lookup"><span data-stu-id="57ce0-239">The time when the access token expires.</span></span> <span data-ttu-id="57ce0-240">The date is represented as the number of seconds from 1970-01-01T0:0:0Z UTC until the expiration time.</span><span class="sxs-lookup"><span data-stu-id="57ce0-240">The date is represented as the number of seconds from 1970-01-01T0:0:0Z UTC until the expiration time.</span></span> <span data-ttu-id="57ce0-241">This value is used to determine the lifetime of cached tokens.</span><span class="sxs-lookup"><span data-stu-id="57ce0-241">This value is used to determine the lifetime of cached tokens.</span></span> |
| <span data-ttu-id="57ce0-242">resource</span><span class="sxs-lookup"><span data-stu-id="57ce0-242">resource</span></span> |<span data-ttu-id="57ce0-243">The App ID URI of the receiving service (secured resource).</span><span class="sxs-lookup"><span data-stu-id="57ce0-243">The App ID URI of the receiving service (secured resource).</span></span> |
| <span data-ttu-id="57ce0-244">access_token</span><span class="sxs-lookup"><span data-stu-id="57ce0-244">access_token</span></span> |<span data-ttu-id="57ce0-245">The requested access token.</span><span class="sxs-lookup"><span data-stu-id="57ce0-245">The requested access token.</span></span> <span data-ttu-id="57ce0-246">The calling service can use this token to authenticate to the receiving service.</span><span class="sxs-lookup"><span data-stu-id="57ce0-246">The calling service can use this token to authenticate to the receiving service.</span></span> |
| <span data-ttu-id="57ce0-247">id_token</span><span class="sxs-lookup"><span data-stu-id="57ce0-247">id_token</span></span> |<span data-ttu-id="57ce0-248">The requested id token.</span><span class="sxs-lookup"><span data-stu-id="57ce0-248">The requested id token.</span></span> <span data-ttu-id="57ce0-249">The calling service can use this to verify the user's identity and begin a session with the user.</span><span class="sxs-lookup"><span data-stu-id="57ce0-249">The calling service can use this to verify the user's identity and begin a session with the user.</span></span> |
| <span data-ttu-id="57ce0-250">refresh_token</span><span class="sxs-lookup"><span data-stu-id="57ce0-250">refresh_token</span></span> |<span data-ttu-id="57ce0-251">The refresh token for the requested access token.</span><span class="sxs-lookup"><span data-stu-id="57ce0-251">The refresh token for the requested access token.</span></span> <span data-ttu-id="57ce0-252">The calling service can use this token to request another access token after the current access token expires.</span><span class="sxs-lookup"><span data-stu-id="57ce0-252">The calling service can use this token to request another access token after the current access token expires.</span></span> |

### <a name="success-response-example"></a><span data-ttu-id="57ce0-253">Success response example</span><span class="sxs-lookup"><span data-stu-id="57ce0-253">Success response example</span></span>
<span data-ttu-id="57ce0-254">The following example shows a success response to a request for an access token for the https://graph.windows.net web API.</span><span class="sxs-lookup"><span data-stu-id="57ce0-254">The following example shows a success response to a request for an access token for the https://graph.windows.net web API.</span></span>

```
{
    "token_type":"Bearer",
    "scope":"User.Read",
    "expires_in":"43482",
    "ext_expires_in":"302683",
    "expires_on":"1493466951",
    "not_before":"1493423168",
    "resource":"https://graph.windows.net",
    "access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InowMzl6ZHNGdWl6cEJmQlZLMVRuMjVRSFlPMCIsImtpZCI6InowMzl6ZHNGdWl6cEJmQlZLMVRuMjVRSFlPMCJ9.eyJhdWQiOiJodHRwczovL2dyYXBoLndpbmRvd3MubmV0IiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvMjYwMzljY2UtNDg5ZC00MDAyLTgyOTMtNWIwYzUxMzRlYWNiLyIsImlhdCI6MTQ5MzQyMzE2OCwibmJmIjoxNDkzNDIzMTY4LCJleHAiOjE0OTM0NjY5NTEsImFjciI6IjEiLCJhaW8iOiJBU1FBMi84REFBQUE1NnZGVmp0WlNjNWdBVWwrY1Z0VFpyM0VvV2NvZEoveWV1S2ZqcTZRdC9NPSIsImFtciI6WyJwd2QiXSwiYXBwaWQiOiI2MjUzOTFhZi1jNjc1LTQzZTUtOGU0NC1lZGQzZTMwY2ViMTUiLCJhcHBpZGFjciI6IjEiLCJlX2V4cCI6MzAyNjgzLCJmYW1pbHlfbmFtZSI6IlRlc3QiLCJnaXZlbl9uYW1lIjoiTmF2eWEiLCJpcGFkZHIiOiIxNjcuMjIwLjEuMTc3IiwibmFtZSI6Ik5hdnlhIFRlc3QiLCJvaWQiOiIxY2Q0YmNhYy1iODA4LTQyM2EtOWUyZi04MjdmYmIxYmI3MzkiLCJwbGF0ZiI6IjMiLCJwdWlkIjoiMTAwMzNGRkZBMTJFRDdGRSIsInNjcCI6IlVzZXIuUmVhZCIsInN1YiI6IjNKTUlaSWJlYTc1R2hfWHdDN2ZzX0JDc3kxa1l1ekZKLTUyVm1Zd0JuM3ciLCJ0aWQiOiIyNjAzOWNjZS00ODlkLTQwMDItODI5My01YjBjNTEzNGVhY2IiLCJ1bmlxdWVfbmFtZSI6Im5hdnlhQGRkb2JhbGlhbm91dGxvb2sub25taWNyb3NvZnQuY29tIiwidXBuIjoibmF2eWFAZGRvYmFsaWFub3V0bG9vay5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiJ4Q3dmemhhLVAwV0pRT0x4Q0dnS0FBIiwidmVyIjoiMS4wIn0.cqmUVjfVbqWsxJLUI1Z4FRx1mNQAHP-L0F4EMN09r8FY9bIKeO-0q1eTdP11Nkj_k4BmtaZsTcK_mUygdMqEp9AfyVyA1HYvokcgGCW_Z6DMlVGqlIU4ssEkL9abgl1REHElPhpwBFFBBenOk9iHddD1GddTn6vJbKC3qAaNM5VarjSPu50bVvCrqKNvFixTb5bbdnSz-Qr6n6ACiEimiI1aNOPR2DeKUyWBPaQcU5EAK0ef5IsVJC1yaYDlAcUYIILMDLCD9ebjsy0t9pj_7lvjzUSrbMdSCCdzCqez_MSNxrk1Nu9AecugkBYp3UVUZOIyythVrj6-sVvLZKUutQ",
    "refresh_token":"AQABAAAAAABnfiG-mA6NTae7CdWW7QfdjKGu9-t1scy_TDEmLi4eLQMjJGt_nAoVu6A4oSu1KsRiz8XyQIPKQxSGfbf2FoSK-hm2K8TYzbJuswYusQpJaHUQnSqEvdaCeFuqXHBv84wjFhuanzF9dQZB_Ng5za9xKlUENrNtlq9XuLNVKzxEyeUM7JyxzdY7JiEphWImwgOYf6II316d0Z6-H3oYsFezf4Xsjz-MOBYEov0P64UaB5nJMvDyApV-NWpgklLASfNoSPGb67Bc02aFRZrm4kLk-xTl6eKE6hSo0XU2z2t70stFJDxvNQobnvNHrAmBaHWPAcC3FGwFnBOojpZB2tzG1gLEbmdROVDp8kHEYAwnRK947Py12fJNKExUdN0njmXrKxNZ_fEM33LHW1Tf4kMX_GvNmbWHtBnIyG0w5emb-b54ef5AwV5_tGUeivTCCysgucEc-S7G8Cz0xNJ_BOiM_4bAv9iFmrm9STkltpz0-Tftg8WKmaJiC0xXj6uTf4ZkX79mJJIuuM7XP4ARIcLpkktyg2Iym9jcZqymRkGH2Rm9sxBwC4eeZXM7M5a7TJ-5CqOdfuE3sBPq40RdEWMFLcrAzFvP0VDR8NKHIrPR1AcUruat9DETmTNJukdlJN3O41nWdZOVoJM-uKN3uz2wQ2Ld1z0Mb9_6YfMox9KTJNzRzcL52r4V_y3kB6ekaOZ9wQ3HxGBQ4zFt-2U0mSszIAA",
    "id_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJhdWQiOiI2MjUzOTFhZi1jNjc1LTQzZTUtOGU0NC1lZGQzZTMwY2ViMTUiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC8yNjAzOWNjZS00ODlkLTQwMDItODI5My01YjBjNTEzNGVhY2IvIiwiaWF0IjoxNDkzNDIzMTY4LCJuYmYiOjE0OTM0MjMxNjgsImV4cCI6MTQ5MzQ2Njk1MSwiYW1yIjpbInB3ZCJdLCJmYW1pbHlfbmFtZSI6IlRlc3QiLCJnaXZlbl9uYW1lIjoiTmF2eWEiLCJpcGFkZHIiOiIxNjcuMjIwLjEuMTc3IiwibmFtZSI6Ik5hdnlhIFRlc3QiLCJvaWQiOiIxY2Q0YmNhYy1iODA4LTQyM2EtOWUyZi04MjdmYmIxYmI3MzkiLCJwbGF0ZiI6IjMiLCJzdWIiOiJEVXpYbkdKMDJIUk0zRW5pbDFxdjZCakxTNUllQy0tQ2ZpbzRxS1MzNEc4IiwidGlkIjoiMjYwMzljY2UtNDg5ZC00MDAyLTgyOTMtNWIwYzUxMzRlYWNiIiwidW5pcXVlX25hbWUiOiJuYXZ5YUBkZG9iYWxpYW5vdXRsb29rLm9ubWljcm9zb2Z0LmNvbSIsInVwbiI6Im5hdnlhQGRkb2JhbGlhbm91dGxvb2sub25taWNyb3NvZnQuY29tIiwidXRpIjoieEN3ZnpoYS1QMFdKUU9MeENHZ0tBQSIsInZlciI6IjEuMCJ9."
}
```

### <a name="error-response-example"></a><span data-ttu-id="57ce0-255">Error response example</span><span class="sxs-lookup"><span data-stu-id="57ce0-255">Error response example</span></span>
<span data-ttu-id="57ce0-256">An error response is returned by Azure AD token endpoint when trying to acquire an access token for the downstream API, if the downstream API has a conditional access policy such as multi-factor authentication set on it.</span><span class="sxs-lookup"><span data-stu-id="57ce0-256">An error response is returned by Azure AD token endpoint when trying to acquire an access token for the downstream API, if the downstream API has a conditional access policy such as multi-factor authentication set on it.</span></span> <span data-ttu-id="57ce0-257">The middle-tier service should surface this error to the client application so that the client application can provide the user interaction to satisfy the conditional access policy.</span><span class="sxs-lookup"><span data-stu-id="57ce0-257">The middle-tier service should surface this error to the client application so that the client application can provide the user interaction to satisfy the conditional access policy.</span></span>

```
{
    "error":"interaction_required",
    "error_description":"AADSTS50079: Due to a configuration change made by your administrator, or because you moved to a new location, you must enroll in multi-factor authentication to access 'bf8d80f9-9098-4972-b203-500f535113b1'.\r\nTrace ID: b72a68c3-0926-4b8e-bc35-3150069c2800\r\nCorrelation ID: 73d656cf-54b1-4eb2-b429-26d8165a52d7\r\nTimestamp: 2017-05-01 22:43:20Z",
    "error_codes":[50079],
    "timestamp":"2017-05-01 22:43:20Z",
    "trace_id":"b72a68c3-0926-4b8e-bc35-3150069c2800",
    "correlation_id":"73d656cf-54b1-4eb2-b429-26d8165a52d7",
    "claims":"{\"access_token\":{\"polids\":{\"essential\":true,\"values\":[\"9ab03e19-ed42-4168-b6b7-7001fb3e933a\"]}}}"
}
```

## <a name="use-the-access-token-to-access-the-secured-resource"></a><span data-ttu-id="57ce0-258">Use the access token to access the secured resource</span><span class="sxs-lookup"><span data-stu-id="57ce0-258">Use the access token to access the secured resource</span></span>
<span data-ttu-id="57ce0-259">Now the middle-tier service can use the token acquired above to make authenticated requests to the downstream web API, by setting the token in the `Authorization` header.</span><span class="sxs-lookup"><span data-stu-id="57ce0-259">Now the middle-tier service can use the token acquired above to make authenticated requests to the downstream web API, by setting the token in the `Authorization` header.</span></span>

### <a name="example"></a><span data-ttu-id="57ce0-260">Example</span><span class="sxs-lookup"><span data-stu-id="57ce0-260">Example</span></span>
```
GET /me?api-version=2013-11-08 HTTP/1.1
Host: graph.windows.net
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InowMzl6ZHNGdWl6cEJmQlZLMVRuMjVRSFlPMCIsImtpZCI6InowMzl6ZHNGdWl6cEJmQlZLMVRuMjVRSFlPMCJ9.eyJhdWQiOiJodHRwczovL2dyYXBoLndpbmRvd3MubmV0IiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvMjYwMzljY2UtNDg5ZC00MDAyLTgyOTMtNWIwYzUxMzRlYWNiLyIsImlhdCI6MTQ5MzQyMzE2OCwibmJmIjoxNDkzNDIzMTY4LCJleHAiOjE0OTM0NjY5NTEsImFjciI6IjEiLCJhaW8iOiJBU1FBMi84REFBQUE1NnZGVmp0WlNjNWdBVWwrY1Z0VFpyM0VvV2NvZEoveWV1S2ZqcTZRdC9NPSIsImFtciI6WyJwd2QiXSwiYXBwaWQiOiI2MjUzOTFhZi1jNjc1LTQzZTUtOGU0NC1lZGQzZTMwY2ViMTUiLCJhcHBpZGFjciI6IjEiLCJlX2V4cCI6MzAyNjgzLCJmYW1pbHlfbmFtZSI6IlRlc3QiLCJnaXZlbl9uYW1lIjoiTmF2eWEiLCJpcGFkZHIiOiIxNjcuMjIwLjEuMTc3IiwibmFtZSI6Ik5hdnlhIFRlc3QiLCJvaWQiOiIxY2Q0YmNhYy1iODA4LTQyM2EtOWUyZi04MjdmYmIxYmI3MzkiLCJwbGF0ZiI6IjMiLCJwdWlkIjoiMTAwMzNGRkZBMTJFRDdGRSIsInNjcCI6IlVzZXIuUmVhZCIsInN1YiI6IjNKTUlaSWJlYTc1R2hfWHdDN2ZzX0JDc3kxa1l1ekZKLTUyVm1Zd0JuM3ciLCJ0aWQiOiIyNjAzOWNjZS00ODlkLTQwMDItODI5My01YjBjNTEzNGVhY2IiLCJ1bmlxdWVfbmFtZSI6Im5hdnlhQGRkb2JhbGlhbm91dGxvb2sub25taWNyb3NvZnQuY29tIiwidXBuIjoibmF2eWFAZGRvYmFsaWFub3V0bG9vay5vbm1pY3Jvc29mdC5jb20iLCJ1dGkiOiJ4Q3dmemhhLVAwV0pRT0x4Q0dnS0FBIiwidmVyIjoiMS4wIn0.cqmUVjfVbqWsxJLUI1Z4FRx1mNQAHP-L0F4EMN09r8FY9bIKeO-0q1eTdP11Nkj_k4BmtaZsTcK_mUygdMqEp9AfyVyA1HYvokcgGCW_Z6DMlVGqlIU4ssEkL9abgl1REHElPhpwBFFBBenOk9iHddD1GddTn6vJbKC3qAaNM5VarjSPu50bVvCrqKNvFixTb5bbdnSz-Qr6n6ACiEimiI1aNOPR2DeKUyWBPaQcU5EAK0ef5IsVJC1yaYDlAcUYIILMDLCD9ebjsy0t9pj_7lvjzUSrbMdSCCdzCqez_MSNxrk1Nu9AecugkBYp3UVUZOIyythVrj6-sVvLZKUutQ
```
## <a name="client-limitations"></a><span data-ttu-id="57ce0-261">Client limitations</span><span class="sxs-lookup"><span data-stu-id="57ce0-261">Client limitations</span></span>
<span data-ttu-id="57ce0-262">Public clients with wildcard reply URLs cannot use an `id_token` for OBO flows.</span><span class="sxs-lookup"><span data-stu-id="57ce0-262">Public clients with wildcard reply URLs cannot use an `id_token` for OBO flows.</span></span> <span data-ttu-id="57ce0-263">However, a confidential client can still redeem access tokens acquired through the implicit grant flow even if the public client has a wildcard redirect URI registered.</span><span class="sxs-lookup"><span data-stu-id="57ce0-263">However, a confidential client can still redeem access tokens acquired through the implicit grant flow even if the public client has a wildcard redirect URI registered.</span></span>

## <a name="next-steps"></a><span data-ttu-id="57ce0-264">Next steps</span><span class="sxs-lookup"><span data-stu-id="57ce0-264">Next steps</span></span>
<span data-ttu-id="57ce0-265">Learn more about the OAuth 2.0 protocol and another way to perform service to service auth using client credentials.</span><span class="sxs-lookup"><span data-stu-id="57ce0-265">Learn more about the OAuth 2.0 protocol and another way to perform service to service auth using client credentials.</span></span>
* [<span data-ttu-id="57ce0-266">Service to service auth using OAuth 2.0 client credentials grant in Azure AD</span><span class="sxs-lookup"><span data-stu-id="57ce0-266">Service to service auth using OAuth 2.0 client credentials grant in Azure AD</span></span>](v1-oauth2-client-creds-grant-flow.md)
* [<span data-ttu-id="57ce0-267">OAuth 2.0 in Azure AD</span><span class="sxs-lookup"><span data-stu-id="57ce0-267">OAuth 2.0 in Azure AD</span></span>](v1-protocols-oauth-code.md)
