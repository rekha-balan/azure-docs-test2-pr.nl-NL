---
title: Azure Active Directory v2.0 and the OpenID Connect protocol | Microsoft Docs
description: Build web applications by using the Azure AD v2.0 implementation of the OpenID Connect authentication protocol.
services: active-directory
documentationcenter: ''
author: CelesteDG
manager: mtillman
editor: ''
ms.assetid: a4875997-3aac-4e4c-b7fe-2b4b829151ce
ms.service: active-directory
ms.component: develop
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2018
ms.author: celested
ms.reviewer: hirsin
ms.custom: aaddev
ms.openlocfilehash: 4c7b46972a8c07675e1318a900c1f07043beb3de
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44870274"
---
# <a name="azure-active-directory-v20-and-the-openid-connect-protocol"></a><span data-ttu-id="5de23-103">Azure Active Directory v2.0 and the OpenID Connect protocol</span><span class="sxs-lookup"><span data-stu-id="5de23-103">Azure Active Directory v2.0 and the OpenID Connect protocol</span></span>

<span data-ttu-id="5de23-104">OpenID Connect is an authentication protocol built on OAuth 2.0 that you can use to securely sign in a user to a web application.</span><span class="sxs-lookup"><span data-stu-id="5de23-104">OpenID Connect is an authentication protocol built on OAuth 2.0 that you can use to securely sign in a user to a web application.</span></span> <span data-ttu-id="5de23-105">When you use the v2.0 endpoint's implementation of OpenID Connect, you can add sign-in and API access to your web-based apps.</span><span class="sxs-lookup"><span data-stu-id="5de23-105">When you use the v2.0 endpoint's implementation of OpenID Connect, you can add sign-in and API access to your web-based apps.</span></span> <span data-ttu-id="5de23-106">This article shows how to do this independent of language and describes how to send and receive HTTP messages without using any Microsoft open-source libraries.</span><span class="sxs-lookup"><span data-stu-id="5de23-106">This article shows how to do this independent of language and describes how to send and receive HTTP messages without using any Microsoft open-source libraries.</span></span>

> [!NOTE]
> <span data-ttu-id="5de23-107">The v2.0 endpoint does not support all Azure Active Directory (Azure AD) scenarios and features.</span><span class="sxs-lookup"><span data-stu-id="5de23-107">The v2.0 endpoint does not support all Azure Active Directory (Azure AD) scenarios and features.</span></span> <span data-ttu-id="5de23-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="5de23-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>

<span data-ttu-id="5de23-109">[OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) extends the OAuth 2.0 *authorization* protocol to use as an *authentication* protocol, so that you can do single sign-on using OAuth.</span><span class="sxs-lookup"><span data-stu-id="5de23-109">[OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) extends the OAuth 2.0 *authorization* protocol to use as an *authentication* protocol, so that you can do single sign-on using OAuth.</span></span> <span data-ttu-id="5de23-110">OpenID Connect introduces the concept of an *ID token*, which is a security token that allows the client to verify the identity of the user.</span><span class="sxs-lookup"><span data-stu-id="5de23-110">OpenID Connect introduces the concept of an *ID token*, which is a security token that allows the client to verify the identity of the user.</span></span> <span data-ttu-id="5de23-111">The ID token also gets basic profile information about the user.</span><span class="sxs-lookup"><span data-stu-id="5de23-111">The ID token also gets basic profile information about the user.</span></span> <span data-ttu-id="5de23-112">Because OpenID Connect extends OAuth 2.0, apps can securely acquire *access tokens*, which can be used to access resources that are secured by an [authorization server](active-directory-v2-protocols.md#the-basics).</span><span class="sxs-lookup"><span data-stu-id="5de23-112">Because OpenID Connect extends OAuth 2.0, apps can securely acquire *access tokens*, which can be used to access resources that are secured by an [authorization server](active-directory-v2-protocols.md#the-basics).</span></span> <span data-ttu-id="5de23-113">The v2.0 endpoint also allows third-party apps that are registered with Azure AD to issue access tokens for secured resources such as Web APIs.</span><span class="sxs-lookup"><span data-stu-id="5de23-113">The v2.0 endpoint also allows third-party apps that are registered with Azure AD to issue access tokens for secured resources such as Web APIs.</span></span> <span data-ttu-id="5de23-114">For more information about how to set up an application to issue access tokens, see [How to register an app with the v2.0 endpoint](quickstart-v2-register-an-app.md).</span><span class="sxs-lookup"><span data-stu-id="5de23-114">For more information about how to set up an application to issue access tokens, see [How to register an app with the v2.0 endpoint](quickstart-v2-register-an-app.md).</span></span> <span data-ttu-id="5de23-115">We recommend that you use OpenID Connect if you are building a [web application](v2-app-types.md#web-apps) that is hosted on a server and accessed via a browser.</span><span class="sxs-lookup"><span data-stu-id="5de23-115">We recommend that you use OpenID Connect if you are building a [web application](v2-app-types.md#web-apps) that is hosted on a server and accessed via a browser.</span></span>

## <a name="protocol-diagram-sign-in"></a><span data-ttu-id="5de23-116">Protocol diagram: Sign-in</span><span class="sxs-lookup"><span data-stu-id="5de23-116">Protocol diagram: Sign-in</span></span>

<span data-ttu-id="5de23-117">The most basic sign-in flow has the steps shown in the next diagram.</span><span class="sxs-lookup"><span data-stu-id="5de23-117">The most basic sign-in flow has the steps shown in the next diagram.</span></span> <span data-ttu-id="5de23-118">Each step is described in detail in this article.</span><span class="sxs-lookup"><span data-stu-id="5de23-118">Each step is described in detail in this article.</span></span>

![OpenID Connect protocol: Sign-in](./media/v2-protocols-oidc/convergence_scenarios_webapp.png)

## <a name="fetch-the-openid-connect-metadata-document"></a><span data-ttu-id="5de23-120">Fetch the OpenID Connect metadata document</span><span class="sxs-lookup"><span data-stu-id="5de23-120">Fetch the OpenID Connect metadata document</span></span>

<span data-ttu-id="5de23-121">OpenID Connect describes a metadata document that contains most of the information required for an app to perform sign-in.</span><span class="sxs-lookup"><span data-stu-id="5de23-121">OpenID Connect describes a metadata document that contains most of the information required for an app to perform sign-in.</span></span> <span data-ttu-id="5de23-122">This includes information such as the URLs to use and the location of the service's public signing keys.</span><span class="sxs-lookup"><span data-stu-id="5de23-122">This includes information such as the URLs to use and the location of the service's public signing keys.</span></span> <span data-ttu-id="5de23-123">For the v2.0 endpoint, this is the OpenID Connect metadata document you should use:</span><span class="sxs-lookup"><span data-stu-id="5de23-123">For the v2.0 endpoint, this is the OpenID Connect metadata document you should use:</span></span>

```
https://login.microsoftonline.com/{tenant}/v2.0/.well-known/openid-configuration
```
> [!TIP]
> <span data-ttu-id="5de23-124">Try it!</span><span class="sxs-lookup"><span data-stu-id="5de23-124">Try it!</span></span> <span data-ttu-id="5de23-125">Click [https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration](https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration) to see the `common` tenants configuration.</span><span class="sxs-lookup"><span data-stu-id="5de23-125">Click [https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration](https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration) to see the `common` tenants configuration.</span></span>

<span data-ttu-id="5de23-126">The `{tenant}` can take one of four values:</span><span class="sxs-lookup"><span data-stu-id="5de23-126">The `{tenant}` can take one of four values:</span></span>

| <span data-ttu-id="5de23-127">Value</span><span class="sxs-lookup"><span data-stu-id="5de23-127">Value</span></span> | <span data-ttu-id="5de23-128">Description</span><span class="sxs-lookup"><span data-stu-id="5de23-128">Description</span></span> |
| --- | --- |
| `common` |<span data-ttu-id="5de23-129">Users with both a personal Microsoft account and a work or school account from Azure Active Directory (Azure AD) can sign in to the application.</span><span class="sxs-lookup"><span data-stu-id="5de23-129">Users with both a personal Microsoft account and a work or school account from Azure Active Directory (Azure AD) can sign in to the application.</span></span> |
| `organizations` |<span data-ttu-id="5de23-130">Only users with work or school accounts from Azure AD can sign in to the application.</span><span class="sxs-lookup"><span data-stu-id="5de23-130">Only users with work or school accounts from Azure AD can sign in to the application.</span></span> |
| `consumers` |<span data-ttu-id="5de23-131">Only users with a personal Microsoft account can sign in to the application.</span><span class="sxs-lookup"><span data-stu-id="5de23-131">Only users with a personal Microsoft account can sign in to the application.</span></span> |
| <span data-ttu-id="5de23-132">`8eaef023-2b34-4da1-9baa-8bc8c9d6a490` or `contoso.onmicrosoft.com`</span><span class="sxs-lookup"><span data-stu-id="5de23-132">`8eaef023-2b34-4da1-9baa-8bc8c9d6a490` or `contoso.onmicrosoft.com`</span></span> |<span data-ttu-id="5de23-133">Only users with a work or school account from a specific Azure AD tenant can sign in to the application.</span><span class="sxs-lookup"><span data-stu-id="5de23-133">Only users with a work or school account from a specific Azure AD tenant can sign in to the application.</span></span> <span data-ttu-id="5de23-134">Either the friendly domain name of the Azure AD tenant or the tenant's GUID identifier can be used.</span><span class="sxs-lookup"><span data-stu-id="5de23-134">Either the friendly domain name of the Azure AD tenant or the tenant's GUID identifier can be used.</span></span> |

<span data-ttu-id="5de23-135">The metadata is a simple JavaScript Object Notation (JSON) document.</span><span class="sxs-lookup"><span data-stu-id="5de23-135">The metadata is a simple JavaScript Object Notation (JSON) document.</span></span> <span data-ttu-id="5de23-136">See the following snippet for an example.</span><span class="sxs-lookup"><span data-stu-id="5de23-136">See the following snippet for an example.</span></span> <span data-ttu-id="5de23-137">The snippet's contents are fully described in the [OpenID Connect specification](https://openid.net/specs/openid-connect-discovery-1_0.html#rfc.section.4.2).</span><span class="sxs-lookup"><span data-stu-id="5de23-137">The snippet's contents are fully described in the [OpenID Connect specification](https://openid.net/specs/openid-connect-discovery-1_0.html#rfc.section.4.2).</span></span>

```
{
  "authorization_endpoint": "https:\/\/login.microsoftonline.com\/common\/oauth2\/v2.0\/authorize",
  "token_endpoint": "https:\/\/login.microsoftonline.com\/common\/oauth2\/v2.0\/token",
  "token_endpoint_auth_methods_supported": [
    "client_secret_post",
    "private_key_jwt"
  ],
  "jwks_uri": "https:\/\/login.microsoftonline.com\/common\/discovery\/v2.0\/keys",

  ...

}
```

<span data-ttu-id="5de23-138">Typically, you would use this metadata document to configure an OpenID Connect library or SDK; the library would use the metadata to do its work.</span><span class="sxs-lookup"><span data-stu-id="5de23-138">Typically, you would use this metadata document to configure an OpenID Connect library or SDK; the library would use the metadata to do its work.</span></span> <span data-ttu-id="5de23-139">However, if you're not using a pre-build OpenID Connect library, you can follow the steps in the remainder of this article to perform sign-in in a web app by using the v2.0 endpoint.</span><span class="sxs-lookup"><span data-stu-id="5de23-139">However, if you're not using a pre-build OpenID Connect library, you can follow the steps in the remainder of this article to perform sign-in in a web app by using the v2.0 endpoint.</span></span>

## <a name="send-the-sign-in-request"></a><span data-ttu-id="5de23-140">Send the sign-in request</span><span class="sxs-lookup"><span data-stu-id="5de23-140">Send the sign-in request</span></span>

<span data-ttu-id="5de23-141">When your web app needs to authenticate the user, it can direct the user to the `/authorize` endpoint.</span><span class="sxs-lookup"><span data-stu-id="5de23-141">When your web app needs to authenticate the user, it can direct the user to the `/authorize` endpoint.</span></span> <span data-ttu-id="5de23-142">This request is similar to the first leg of the [OAuth 2.0 authorization code flow](v2-oauth2-auth-code-flow.md), with these important distinctions:</span><span class="sxs-lookup"><span data-stu-id="5de23-142">This request is similar to the first leg of the [OAuth 2.0 authorization code flow](v2-oauth2-auth-code-flow.md), with these important distinctions:</span></span>

* <span data-ttu-id="5de23-143">The request must include the `openid` scope in the `scope` parameter.</span><span class="sxs-lookup"><span data-stu-id="5de23-143">The request must include the `openid` scope in the `scope` parameter.</span></span>
* <span data-ttu-id="5de23-144">The `response_type` parameter must include `id_token`.</span><span class="sxs-lookup"><span data-stu-id="5de23-144">The `response_type` parameter must include `id_token`.</span></span>
* <span data-ttu-id="5de23-145">The request must include the `nonce` parameter.</span><span class="sxs-lookup"><span data-stu-id="5de23-145">The request must include the `nonce` parameter.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5de23-146">In order to succesfully request an ID token, the app registration in the [registration portal](https://apps.dev.microsoft.com) must have the **[Implicit grant](v2-oauth2-implicit-grant-flow.md)** enabled for the Web client.</span><span class="sxs-lookup"><span data-stu-id="5de23-146">In order to succesfully request an ID token, the app registration in the [registration portal](https://apps.dev.microsoft.com) must have the **[Implicit grant](v2-oauth2-implicit-grant-flow.md)** enabled for the Web client.</span></span> <span data-ttu-id="5de23-147">If it is not enabled, an `unsupported_response` error will be returned: "The provided value for the input parameter 'response_type' is not allowed for this client.</span><span class="sxs-lookup"><span data-stu-id="5de23-147">If it is not enabled, an `unsupported_response` error will be returned: "The provided value for the input parameter 'response_type' is not allowed for this client.</span></span> <span data-ttu-id="5de23-148">Expected value is 'code'"</span><span class="sxs-lookup"><span data-stu-id="5de23-148">Expected value is 'code'"</span></span>

<span data-ttu-id="5de23-149">For example:</span><span class="sxs-lookup"><span data-stu-id="5de23-149">For example:</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=id_token
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=form_post
&scope=openid
&state=12345
&nonce=678910
```

> [!TIP]
> <span data-ttu-id="5de23-150">Click the following link to execute this request.</span><span class="sxs-lookup"><span data-stu-id="5de23-150">Click the following link to execute this request.</span></span> <span data-ttu-id="5de23-151">After you sign in, your browser will be redirected to https://localhost/myapp/, with an ID token in the address bar.</span><span class="sxs-lookup"><span data-stu-id="5de23-151">After you sign in, your browser will be redirected to https://localhost/myapp/, with an ID token in the address bar.</span></span> <span data-ttu-id="5de23-152">Note that this request uses `response_mode=fragment` (for demonstration purposes only).</span><span class="sxs-lookup"><span data-stu-id="5de23-152">Note that this request uses `response_mode=fragment` (for demonstration purposes only).</span></span> <span data-ttu-id="5de23-153">We recommend that you use `response_mode=form_post`.</span><span class="sxs-lookup"><span data-stu-id="5de23-153">We recommend that you use `response_mode=form_post`.</span></span>
> <span data-ttu-id="5de23-154"><a href="https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&response_type=id_token&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&scope=openid&response_mode=fragment&state=12345&nonce=678910" target="_blank">https://login.microsoftonline.com/common/oauth2/v2.0/authorize...</a></span><span class="sxs-lookup"><span data-stu-id="5de23-154"><a href="https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&response_type=id_token&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&scope=openid&response_mode=fragment&state=12345&nonce=678910" target="_blank">https://login.microsoftonline.com/common/oauth2/v2.0/authorize...</a></span></span>

| <span data-ttu-id="5de23-155">Parameter</span><span class="sxs-lookup"><span data-stu-id="5de23-155">Parameter</span></span> | <span data-ttu-id="5de23-156">Condition</span><span class="sxs-lookup"><span data-stu-id="5de23-156">Condition</span></span> | <span data-ttu-id="5de23-157">Description</span><span class="sxs-lookup"><span data-stu-id="5de23-157">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="5de23-158">tenant</span><span class="sxs-lookup"><span data-stu-id="5de23-158">tenant</span></span> |<span data-ttu-id="5de23-159">Required</span><span class="sxs-lookup"><span data-stu-id="5de23-159">Required</span></span> |<span data-ttu-id="5de23-160">You can use the `{tenant}` value in the path of the request to control who can sign in to the application.</span><span class="sxs-lookup"><span data-stu-id="5de23-160">You can use the `{tenant}` value in the path of the request to control who can sign in to the application.</span></span> <span data-ttu-id="5de23-161">The allowed values are `common`, `organizations`, `consumers`, and tenant identifiers.</span><span class="sxs-lookup"><span data-stu-id="5de23-161">The allowed values are `common`, `organizations`, `consumers`, and tenant identifiers.</span></span> <span data-ttu-id="5de23-162">For more information, see [protocol basics](active-directory-v2-protocols.md#endpoints).</span><span class="sxs-lookup"><span data-stu-id="5de23-162">For more information, see [protocol basics](active-directory-v2-protocols.md#endpoints).</span></span> |
| <span data-ttu-id="5de23-163">client_id</span><span class="sxs-lookup"><span data-stu-id="5de23-163">client_id</span></span> |<span data-ttu-id="5de23-164">Required</span><span class="sxs-lookup"><span data-stu-id="5de23-164">Required</span></span> |<span data-ttu-id="5de23-165">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span><span class="sxs-lookup"><span data-stu-id="5de23-165">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="5de23-166">response_type</span><span class="sxs-lookup"><span data-stu-id="5de23-166">response_type</span></span> |<span data-ttu-id="5de23-167">Required</span><span class="sxs-lookup"><span data-stu-id="5de23-167">Required</span></span> |<span data-ttu-id="5de23-168">Must include `id_token` for OpenID Connect sign-in.</span><span class="sxs-lookup"><span data-stu-id="5de23-168">Must include `id_token` for OpenID Connect sign-in.</span></span> <span data-ttu-id="5de23-169">It might also include other `response_types` values, such as `code`.</span><span class="sxs-lookup"><span data-stu-id="5de23-169">It might also include other `response_types` values, such as `code`.</span></span> |
| <span data-ttu-id="5de23-170">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="5de23-170">redirect_uri</span></span> |<span data-ttu-id="5de23-171">Recommended</span><span class="sxs-lookup"><span data-stu-id="5de23-171">Recommended</span></span> |<span data-ttu-id="5de23-172">The redirect URI of your app, where authentication responses can be sent and received by your app.</span><span class="sxs-lookup"><span data-stu-id="5de23-172">The redirect URI of your app, where authentication responses can be sent and received by your app.</span></span> <span data-ttu-id="5de23-173">It must exactly match one of the redirect URIs you registered in the portal, except that it must be URL encoded.</span><span class="sxs-lookup"><span data-stu-id="5de23-173">It must exactly match one of the redirect URIs you registered in the portal, except that it must be URL encoded.</span></span> |
| <span data-ttu-id="5de23-174">scope</span><span class="sxs-lookup"><span data-stu-id="5de23-174">scope</span></span> |<span data-ttu-id="5de23-175">Required</span><span class="sxs-lookup"><span data-stu-id="5de23-175">Required</span></span> |<span data-ttu-id="5de23-176">A space-separated list of scopes.</span><span class="sxs-lookup"><span data-stu-id="5de23-176">A space-separated list of scopes.</span></span> <span data-ttu-id="5de23-177">For OpenID Connect, it must include the scope `openid`, which translates to the "Sign you in" permission in the consent UI.</span><span class="sxs-lookup"><span data-stu-id="5de23-177">For OpenID Connect, it must include the scope `openid`, which translates to the "Sign you in" permission in the consent UI.</span></span> <span data-ttu-id="5de23-178">You might also include other scopes in this request for requesting consent.</span><span class="sxs-lookup"><span data-stu-id="5de23-178">You might also include other scopes in this request for requesting consent.</span></span> |
| <span data-ttu-id="5de23-179">nonce</span><span class="sxs-lookup"><span data-stu-id="5de23-179">nonce</span></span> |<span data-ttu-id="5de23-180">Required</span><span class="sxs-lookup"><span data-stu-id="5de23-180">Required</span></span> |<span data-ttu-id="5de23-181">A value included in the request, generated by the app, that will be included in the resulting id_token value as a claim.</span><span class="sxs-lookup"><span data-stu-id="5de23-181">A value included in the request, generated by the app, that will be included in the resulting id_token value as a claim.</span></span> <span data-ttu-id="5de23-182">The app can verify this value to mitigate token replay attacks.</span><span class="sxs-lookup"><span data-stu-id="5de23-182">The app can verify this value to mitigate token replay attacks.</span></span> <span data-ttu-id="5de23-183">The value typically is a randomized, unique string that can be used to identify the origin of the request.</span><span class="sxs-lookup"><span data-stu-id="5de23-183">The value typically is a randomized, unique string that can be used to identify the origin of the request.</span></span> |
| <span data-ttu-id="5de23-184">response_mode</span><span class="sxs-lookup"><span data-stu-id="5de23-184">response_mode</span></span> |<span data-ttu-id="5de23-185">Recommended</span><span class="sxs-lookup"><span data-stu-id="5de23-185">Recommended</span></span> |<span data-ttu-id="5de23-186">Specifies the method that should be used to send the resulting authorization code back to your app.</span><span class="sxs-lookup"><span data-stu-id="5de23-186">Specifies the method that should be used to send the resulting authorization code back to your app.</span></span> <span data-ttu-id="5de23-187">Can be `form_post` or `fragment`.</span><span class="sxs-lookup"><span data-stu-id="5de23-187">Can be `form_post` or `fragment`.</span></span> <span data-ttu-id="5de23-188">For web applications, we recommend using `response_mode=form_post`, to ensure the most secure transfer of tokens to your application.</span><span class="sxs-lookup"><span data-stu-id="5de23-188">For web applications, we recommend using `response_mode=form_post`, to ensure the most secure transfer of tokens to your application.</span></span> |
| <span data-ttu-id="5de23-189">state</span><span class="sxs-lookup"><span data-stu-id="5de23-189">state</span></span> |<span data-ttu-id="5de23-190">Recommended</span><span class="sxs-lookup"><span data-stu-id="5de23-190">Recommended</span></span> |<span data-ttu-id="5de23-191">A value included in the request that also will be returned in the token response.</span><span class="sxs-lookup"><span data-stu-id="5de23-191">A value included in the request that also will be returned in the token response.</span></span> <span data-ttu-id="5de23-192">It can be a string of any content you want.</span><span class="sxs-lookup"><span data-stu-id="5de23-192">It can be a string of any content you want.</span></span> <span data-ttu-id="5de23-193">A randomly generated unique value typically is used to [prevent cross-site request forgery attacks](http://tools.ietf.org/html/rfc6749#section-10.12).</span><span class="sxs-lookup"><span data-stu-id="5de23-193">A randomly generated unique value typically is used to [prevent cross-site request forgery attacks](http://tools.ietf.org/html/rfc6749#section-10.12).</span></span> <span data-ttu-id="5de23-194">The state also is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view the user was on.</span><span class="sxs-lookup"><span data-stu-id="5de23-194">The state also is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view the user was on.</span></span> |
| <span data-ttu-id="5de23-195">prompt</span><span class="sxs-lookup"><span data-stu-id="5de23-195">prompt</span></span> |<span data-ttu-id="5de23-196">Optional</span><span class="sxs-lookup"><span data-stu-id="5de23-196">Optional</span></span> |<span data-ttu-id="5de23-197">Indicates the type of user interaction that is required.</span><span class="sxs-lookup"><span data-stu-id="5de23-197">Indicates the type of user interaction that is required.</span></span> <span data-ttu-id="5de23-198">The only valid values at this time are `login`, `none`, and `consent`.</span><span class="sxs-lookup"><span data-stu-id="5de23-198">The only valid values at this time are `login`, `none`, and `consent`.</span></span> <span data-ttu-id="5de23-199">The `prompt=login` claim forces the user to enter their credentials on that request, which negates single sign-on.</span><span class="sxs-lookup"><span data-stu-id="5de23-199">The `prompt=login` claim forces the user to enter their credentials on that request, which negates single sign-on.</span></span> <span data-ttu-id="5de23-200">The `prompt=none` claim is the opposite.</span><span class="sxs-lookup"><span data-stu-id="5de23-200">The `prompt=none` claim is the opposite.</span></span> <span data-ttu-id="5de23-201">This claim ensures that the user is not presented with any interactive prompt whatsoever.</span><span class="sxs-lookup"><span data-stu-id="5de23-201">This claim ensures that the user is not presented with any interactive prompt whatsoever.</span></span> <span data-ttu-id="5de23-202">If the request cannot be completed silently via single sign-on, the v2.0 endpoint returns an error.</span><span class="sxs-lookup"><span data-stu-id="5de23-202">If the request cannot be completed silently via single sign-on, the v2.0 endpoint returns an error.</span></span> <span data-ttu-id="5de23-203">The `prompt=consent` claim triggers the OAuth consent dialog after the user signs in.</span><span class="sxs-lookup"><span data-stu-id="5de23-203">The `prompt=consent` claim triggers the OAuth consent dialog after the user signs in.</span></span> <span data-ttu-id="5de23-204">The dialog asks the user to grant permissions to the app.</span><span class="sxs-lookup"><span data-stu-id="5de23-204">The dialog asks the user to grant permissions to the app.</span></span> |
| <span data-ttu-id="5de23-205">login_hint</span><span class="sxs-lookup"><span data-stu-id="5de23-205">login_hint</span></span> |<span data-ttu-id="5de23-206">Optional</span><span class="sxs-lookup"><span data-stu-id="5de23-206">Optional</span></span> |<span data-ttu-id="5de23-207">You can use this parameter to pre-fill the username and email address field of the sign-in page for the user, if you know the username ahead of time.</span><span class="sxs-lookup"><span data-stu-id="5de23-207">You can use this parameter to pre-fill the username and email address field of the sign-in page for the user, if you know the username ahead of time.</span></span> <span data-ttu-id="5de23-208">Often, apps use this parameter during reauthentication, after already extracting the username from an earlier sign-in by using the `preferred_username` claim.</span><span class="sxs-lookup"><span data-stu-id="5de23-208">Often, apps use this parameter during reauthentication, after already extracting the username from an earlier sign-in by using the `preferred_username` claim.</span></span> |
| <span data-ttu-id="5de23-209">domain_hint</span><span class="sxs-lookup"><span data-stu-id="5de23-209">domain_hint</span></span> |<span data-ttu-id="5de23-210">Optional</span><span class="sxs-lookup"><span data-stu-id="5de23-210">Optional</span></span> |<span data-ttu-id="5de23-211">This value can be `consumers` or `organizations`.</span><span class="sxs-lookup"><span data-stu-id="5de23-211">This value can be `consumers` or `organizations`.</span></span> <span data-ttu-id="5de23-212">If included, it skips the email-based discovery process that the user goes through on the v2.0 sign-in page, for a slightly more streamlined user experience.</span><span class="sxs-lookup"><span data-stu-id="5de23-212">If included, it skips the email-based discovery process that the user goes through on the v2.0 sign-in page, for a slightly more streamlined user experience.</span></span> <span data-ttu-id="5de23-213">Often, apps use this parameter during reauthentication by extracting the `tid` claim from the ID token.</span><span class="sxs-lookup"><span data-stu-id="5de23-213">Often, apps use this parameter during reauthentication by extracting the `tid` claim from the ID token.</span></span> <span data-ttu-id="5de23-214">If the `tid` claim value is `9188040d-6c67-4c5b-b112-36a304b66dad` (the Microsoft Account consumer tenant), use `domain_hint=consumers`.</span><span class="sxs-lookup"><span data-stu-id="5de23-214">If the `tid` claim value is `9188040d-6c67-4c5b-b112-36a304b66dad` (the Microsoft Account consumer tenant), use `domain_hint=consumers`.</span></span> <span data-ttu-id="5de23-215">Otherwise, use `domain_hint=organizations`.</span><span class="sxs-lookup"><span data-stu-id="5de23-215">Otherwise, use `domain_hint=organizations`.</span></span> |

<span data-ttu-id="5de23-216">At this point, the user is prompted to enter their credentials and complete the authentication.</span><span class="sxs-lookup"><span data-stu-id="5de23-216">At this point, the user is prompted to enter their credentials and complete the authentication.</span></span> <span data-ttu-id="5de23-217">The v2.0 endpoint verifies that the user has consented to the permissions indicated in the `scope` query parameter.</span><span class="sxs-lookup"><span data-stu-id="5de23-217">The v2.0 endpoint verifies that the user has consented to the permissions indicated in the `scope` query parameter.</span></span> <span data-ttu-id="5de23-218">If the user has not consented to any of those permissions, the v2.0 endpoint prompts the user to consent to the required permissions.</span><span class="sxs-lookup"><span data-stu-id="5de23-218">If the user has not consented to any of those permissions, the v2.0 endpoint prompts the user to consent to the required permissions.</span></span> <span data-ttu-id="5de23-219">You can read more about [permissions, consent, and multitenant apps](v2-permissions-and-consent.md).</span><span class="sxs-lookup"><span data-stu-id="5de23-219">You can read more about [permissions, consent, and multitenant apps](v2-permissions-and-consent.md).</span></span>

<span data-ttu-id="5de23-220">After the user authenticates and grants consent, the v2.0 endpoint returns a response to your app at the indicated redirect URI by using the method specified in the `response_mode` parameter.</span><span class="sxs-lookup"><span data-stu-id="5de23-220">After the user authenticates and grants consent, the v2.0 endpoint returns a response to your app at the indicated redirect URI by using the method specified in the `response_mode` parameter.</span></span>

### <a name="successful-response"></a><span data-ttu-id="5de23-221">Successful response</span><span class="sxs-lookup"><span data-stu-id="5de23-221">Successful response</span></span>

<span data-ttu-id="5de23-222">A successful response when you use `response_mode=form_post` looks like this:</span><span class="sxs-lookup"><span data-stu-id="5de23-222">A successful response when you use `response_mode=form_post` looks like this:</span></span>

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNB...&state=12345
```

| <span data-ttu-id="5de23-223">Parameter</span><span class="sxs-lookup"><span data-stu-id="5de23-223">Parameter</span></span> | <span data-ttu-id="5de23-224">Description</span><span class="sxs-lookup"><span data-stu-id="5de23-224">Description</span></span> |
| --- | --- |
| <span data-ttu-id="5de23-225">id_token</span><span class="sxs-lookup"><span data-stu-id="5de23-225">id_token</span></span> |<span data-ttu-id="5de23-226">The ID token that the app requested.</span><span class="sxs-lookup"><span data-stu-id="5de23-226">The ID token that the app requested.</span></span> <span data-ttu-id="5de23-227">You can use the `id_token` parameter to verify the user's identity and begin a session with the user.</span><span class="sxs-lookup"><span data-stu-id="5de23-227">You can use the `id_token` parameter to verify the user's identity and begin a session with the user.</span></span> <span data-ttu-id="5de23-228">For more information about ID tokens and their contents, see the [v2.0 endpoint tokens reference](v2-id-and-access-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="5de23-228">For more information about ID tokens and their contents, see the [v2.0 endpoint tokens reference](v2-id-and-access-tokens.md).</span></span> |
| <span data-ttu-id="5de23-229">state</span><span class="sxs-lookup"><span data-stu-id="5de23-229">state</span></span> |<span data-ttu-id="5de23-230">If a `state` parameter is included in the request, the same value should appear in the response.</span><span class="sxs-lookup"><span data-stu-id="5de23-230">If a `state` parameter is included in the request, the same value should appear in the response.</span></span> <span data-ttu-id="5de23-231">The app should verify that the state values in the request and response are identical.</span><span class="sxs-lookup"><span data-stu-id="5de23-231">The app should verify that the state values in the request and response are identical.</span></span> |

### <a name="error-response"></a><span data-ttu-id="5de23-232">Error response</span><span class="sxs-lookup"><span data-stu-id="5de23-232">Error response</span></span>

<span data-ttu-id="5de23-233">Error responses might also be sent to the redirect URI so that the app can handle them.</span><span class="sxs-lookup"><span data-stu-id="5de23-233">Error responses might also be sent to the redirect URI so that the app can handle them.</span></span> <span data-ttu-id="5de23-234">An error response looks like this:</span><span class="sxs-lookup"><span data-stu-id="5de23-234">An error response looks like this:</span></span>

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

error=access_denied&error_description=the+user+canceled+the+authentication
```

| <span data-ttu-id="5de23-235">Parameter</span><span class="sxs-lookup"><span data-stu-id="5de23-235">Parameter</span></span> | <span data-ttu-id="5de23-236">Description</span><span class="sxs-lookup"><span data-stu-id="5de23-236">Description</span></span> |
| --- | --- |
| <span data-ttu-id="5de23-237">error</span><span class="sxs-lookup"><span data-stu-id="5de23-237">error</span></span> |<span data-ttu-id="5de23-238">An error code string that you can use to classify types of errors that occur, and to react to errors.</span><span class="sxs-lookup"><span data-stu-id="5de23-238">An error code string that you can use to classify types of errors that occur, and to react to errors.</span></span> |
| <span data-ttu-id="5de23-239">error_description</span><span class="sxs-lookup"><span data-stu-id="5de23-239">error_description</span></span> |<span data-ttu-id="5de23-240">A specific error message that can help you identify the root cause of an authentication error.</span><span class="sxs-lookup"><span data-stu-id="5de23-240">A specific error message that can help you identify the root cause of an authentication error.</span></span> |

### <a name="error-codes-for-authorization-endpoint-errors"></a><span data-ttu-id="5de23-241">Error codes for authorization endpoint errors</span><span class="sxs-lookup"><span data-stu-id="5de23-241">Error codes for authorization endpoint errors</span></span>

<span data-ttu-id="5de23-242">The following table describes error codes that can be returned in the `error` parameter of the error response:</span><span class="sxs-lookup"><span data-stu-id="5de23-242">The following table describes error codes that can be returned in the `error` parameter of the error response:</span></span>

| <span data-ttu-id="5de23-243">Error code</span><span class="sxs-lookup"><span data-stu-id="5de23-243">Error code</span></span> | <span data-ttu-id="5de23-244">Description</span><span class="sxs-lookup"><span data-stu-id="5de23-244">Description</span></span> | <span data-ttu-id="5de23-245">Client action</span><span class="sxs-lookup"><span data-stu-id="5de23-245">Client action</span></span> |
| --- | --- | --- |
| <span data-ttu-id="5de23-246">invalid_request</span><span class="sxs-lookup"><span data-stu-id="5de23-246">invalid_request</span></span> |<span data-ttu-id="5de23-247">Protocol error, such as a missing, required parameter.</span><span class="sxs-lookup"><span data-stu-id="5de23-247">Protocol error, such as a missing, required parameter.</span></span> |<span data-ttu-id="5de23-248">Fix and resubmit the request.</span><span class="sxs-lookup"><span data-stu-id="5de23-248">Fix and resubmit the request.</span></span> <span data-ttu-id="5de23-249">This is a development error that typically is caught during initial testing.</span><span class="sxs-lookup"><span data-stu-id="5de23-249">This is a development error that typically is caught during initial testing.</span></span> |
| <span data-ttu-id="5de23-250">unauthorized_client</span><span class="sxs-lookup"><span data-stu-id="5de23-250">unauthorized_client</span></span> |<span data-ttu-id="5de23-251">The client application cannot request an authorization code.</span><span class="sxs-lookup"><span data-stu-id="5de23-251">The client application cannot request an authorization code.</span></span> |<span data-ttu-id="5de23-252">This usually occurs when the client application is not registered in Azure AD or is not added to the user's Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="5de23-252">This usually occurs when the client application is not registered in Azure AD or is not added to the user's Azure AD tenant.</span></span> <span data-ttu-id="5de23-253">The application can prompt the user with instructions to install the application and add it to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5de23-253">The application can prompt the user with instructions to install the application and add it to Azure AD.</span></span> |
| <span data-ttu-id="5de23-254">access_denied</span><span class="sxs-lookup"><span data-stu-id="5de23-254">access_denied</span></span> |<span data-ttu-id="5de23-255">The resource owner denied consent.</span><span class="sxs-lookup"><span data-stu-id="5de23-255">The resource owner denied consent.</span></span> |<span data-ttu-id="5de23-256">The client application can notify the user that it cannot proceed unless the user consents.</span><span class="sxs-lookup"><span data-stu-id="5de23-256">The client application can notify the user that it cannot proceed unless the user consents.</span></span> |
| <span data-ttu-id="5de23-257">unsupported_response_type</span><span class="sxs-lookup"><span data-stu-id="5de23-257">unsupported_response_type</span></span> |<span data-ttu-id="5de23-258">The authorization server does not support the response type in the request.</span><span class="sxs-lookup"><span data-stu-id="5de23-258">The authorization server does not support the response type in the request.</span></span> |<span data-ttu-id="5de23-259">Fix and resubmit the request.</span><span class="sxs-lookup"><span data-stu-id="5de23-259">Fix and resubmit the request.</span></span> <span data-ttu-id="5de23-260">This is a development error that typically is caught during initial testing.</span><span class="sxs-lookup"><span data-stu-id="5de23-260">This is a development error that typically is caught during initial testing.</span></span> |
| <span data-ttu-id="5de23-261">server_error</span><span class="sxs-lookup"><span data-stu-id="5de23-261">server_error</span></span> |<span data-ttu-id="5de23-262">The server encountered an unexpected error.</span><span class="sxs-lookup"><span data-stu-id="5de23-262">The server encountered an unexpected error.</span></span> |<span data-ttu-id="5de23-263">Retry the request.</span><span class="sxs-lookup"><span data-stu-id="5de23-263">Retry the request.</span></span> <span data-ttu-id="5de23-264">These errors can result from temporary conditions.</span><span class="sxs-lookup"><span data-stu-id="5de23-264">These errors can result from temporary conditions.</span></span> <span data-ttu-id="5de23-265">The client application might explain to the user that its response is delayed due to a temporary error.</span><span class="sxs-lookup"><span data-stu-id="5de23-265">The client application might explain to the user that its response is delayed due to a temporary error.</span></span> |
| <span data-ttu-id="5de23-266">temporarily_unavailable</span><span class="sxs-lookup"><span data-stu-id="5de23-266">temporarily_unavailable</span></span> |<span data-ttu-id="5de23-267">The server is temporarily too busy to handle the request.</span><span class="sxs-lookup"><span data-stu-id="5de23-267">The server is temporarily too busy to handle the request.</span></span> |<span data-ttu-id="5de23-268">Retry the request.</span><span class="sxs-lookup"><span data-stu-id="5de23-268">Retry the request.</span></span> <span data-ttu-id="5de23-269">The client application might explain to the user that its response is delayed due to a temporary condition.</span><span class="sxs-lookup"><span data-stu-id="5de23-269">The client application might explain to the user that its response is delayed due to a temporary condition.</span></span> |
| <span data-ttu-id="5de23-270">invalid_resource</span><span class="sxs-lookup"><span data-stu-id="5de23-270">invalid_resource</span></span> |<span data-ttu-id="5de23-271">The target resource is invalid because either it does not exist, Azure AD cannot find it, or it is not correctly configured.</span><span class="sxs-lookup"><span data-stu-id="5de23-271">The target resource is invalid because either it does not exist, Azure AD cannot find it, or it is not correctly configured.</span></span> |<span data-ttu-id="5de23-272">This indicates that the resource, if it exists, has not been configured in the tenant.</span><span class="sxs-lookup"><span data-stu-id="5de23-272">This indicates that the resource, if it exists, has not been configured in the tenant.</span></span> <span data-ttu-id="5de23-273">The application can prompt the user with instructions for installing the application and adding it to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5de23-273">The application can prompt the user with instructions for installing the application and adding it to Azure AD.</span></span> |

## <a name="validate-the-id-token"></a><span data-ttu-id="5de23-274">Validate the ID token</span><span class="sxs-lookup"><span data-stu-id="5de23-274">Validate the ID token</span></span>

<span data-ttu-id="5de23-275">Receiving an ID token is not sufficient to authenticate the user.</span><span class="sxs-lookup"><span data-stu-id="5de23-275">Receiving an ID token is not sufficient to authenticate the user.</span></span> <span data-ttu-id="5de23-276">You must also validate the ID token's signature and verify the claims in the token per your app's requirements.</span><span class="sxs-lookup"><span data-stu-id="5de23-276">You must also validate the ID token's signature and verify the claims in the token per your app's requirements.</span></span> <span data-ttu-id="5de23-277">The v2.0 endpoint uses [JSON Web Tokens (JWTs)](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html) and public key cryptography to sign tokens and verify that they are valid.</span><span class="sxs-lookup"><span data-stu-id="5de23-277">The v2.0 endpoint uses [JSON Web Tokens (JWTs)](http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html) and public key cryptography to sign tokens and verify that they are valid.</span></span>

<span data-ttu-id="5de23-278">You can choose to validate the ID token in client code, but a common practice is to send the ID token to a back-end server and perform the validation there.</span><span class="sxs-lookup"><span data-stu-id="5de23-278">You can choose to validate the ID token in client code, but a common practice is to send the ID token to a back-end server and perform the validation there.</span></span> <span data-ttu-id="5de23-279">After you've validated the signature of the ID token, you'll need to verify a few claims.</span><span class="sxs-lookup"><span data-stu-id="5de23-279">After you've validated the signature of the ID token, you'll need to verify a few claims.</span></span> <span data-ttu-id="5de23-280">For more information, including more about [validating tokens](v2-id-and-access-tokens.md#validating-tokens) and [important information about signing key rollover](v2-id-and-access-tokens.md#validating-tokens), see the [v2.0 tokens reference](v2-id-and-access-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="5de23-280">For more information, including more about [validating tokens](v2-id-and-access-tokens.md#validating-tokens) and [important information about signing key rollover](v2-id-and-access-tokens.md#validating-tokens), see the [v2.0 tokens reference](v2-id-and-access-tokens.md).</span></span> <span data-ttu-id="5de23-281">We recommend using a library to parse and validate tokens.</span><span class="sxs-lookup"><span data-stu-id="5de23-281">We recommend using a library to parse and validate tokens.</span></span> <span data-ttu-id="5de23-282">There's at least one of these libraries available for most languages and platforms.</span><span class="sxs-lookup"><span data-stu-id="5de23-282">There's at least one of these libraries available for most languages and platforms.</span></span>
<!--TODO: Improve the information on this-->

<span data-ttu-id="5de23-283">You also might want to validate additional claims, depending on your scenario.</span><span class="sxs-lookup"><span data-stu-id="5de23-283">You also might want to validate additional claims, depending on your scenario.</span></span> <span data-ttu-id="5de23-284">Some common validations include:</span><span class="sxs-lookup"><span data-stu-id="5de23-284">Some common validations include:</span></span>

* <span data-ttu-id="5de23-285">Ensure that the user or organization has signed up for the app.</span><span class="sxs-lookup"><span data-stu-id="5de23-285">Ensure that the user or organization has signed up for the app.</span></span>
* <span data-ttu-id="5de23-286">Ensure that the user has required authorization or privileges.</span><span class="sxs-lookup"><span data-stu-id="5de23-286">Ensure that the user has required authorization or privileges.</span></span>
* <span data-ttu-id="5de23-287">Ensure that a certain strength of authentication has occurred, such as multi-factor authentication.</span><span class="sxs-lookup"><span data-stu-id="5de23-287">Ensure that a certain strength of authentication has occurred, such as multi-factor authentication.</span></span>

<span data-ttu-id="5de23-288">For more information about the claims in an ID token, see the [v2.0 endpoint tokens reference](v2-id-and-access-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="5de23-288">For more information about the claims in an ID token, see the [v2.0 endpoint tokens reference](v2-id-and-access-tokens.md).</span></span>

<span data-ttu-id="5de23-289">After you have validated the ID token, you can begin a session with the user.</span><span class="sxs-lookup"><span data-stu-id="5de23-289">After you have validated the ID token, you can begin a session with the user.</span></span> <span data-ttu-id="5de23-290">Use the claims in the ID token to get information about the user in your app.</span><span class="sxs-lookup"><span data-stu-id="5de23-290">Use the claims in the ID token to get information about the user in your app.</span></span> <span data-ttu-id="5de23-291">You can use this information for display, records, authorizations, and so on.</span><span class="sxs-lookup"><span data-stu-id="5de23-291">You can use this information for display, records, authorizations, and so on.</span></span>

## <a name="send-a-sign-out-request"></a><span data-ttu-id="5de23-292">Send a sign-out request</span><span class="sxs-lookup"><span data-stu-id="5de23-292">Send a sign-out request</span></span>

<span data-ttu-id="5de23-293">When you want to sign out the user from your app, it isn't sufficient to clear your app's cookies or otherwise end the user's session.</span><span class="sxs-lookup"><span data-stu-id="5de23-293">When you want to sign out the user from your app, it isn't sufficient to clear your app's cookies or otherwise end the user's session.</span></span> <span data-ttu-id="5de23-294">You must also redirect the user to the v2.0 endpoint to sign out. If you don't do this, the user reauthenticates to your app without entering their credentials again, because they will have a valid single sign-in session with the v2.0 endpoint.</span><span class="sxs-lookup"><span data-stu-id="5de23-294">You must also redirect the user to the v2.0 endpoint to sign out. If you don't do this, the user reauthenticates to your app without entering their credentials again, because they will have a valid single sign-in session with the v2.0 endpoint.</span></span>

<span data-ttu-id="5de23-295">You can redirect the user to the `end_session_endpoint` listed in the OpenID Connect metadata document:</span><span class="sxs-lookup"><span data-stu-id="5de23-295">You can redirect the user to the `end_session_endpoint` listed in the OpenID Connect metadata document:</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/logout?
post_logout_redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
```

| <span data-ttu-id="5de23-296">Parameter</span><span class="sxs-lookup"><span data-stu-id="5de23-296">Parameter</span></span> | <span data-ttu-id="5de23-297">Condition</span><span class="sxs-lookup"><span data-stu-id="5de23-297">Condition</span></span> | <span data-ttu-id="5de23-298">Description</span><span class="sxs-lookup"><span data-stu-id="5de23-298">Description</span></span> |
| ----------------------- | ------------------------------- | ------------ |
| <span data-ttu-id="5de23-299">post_logout_redirect_uri</span><span class="sxs-lookup"><span data-stu-id="5de23-299">post_logout_redirect_uri</span></span> | <span data-ttu-id="5de23-300">Recommended</span><span class="sxs-lookup"><span data-stu-id="5de23-300">Recommended</span></span> | <span data-ttu-id="5de23-301">The URL that the user is redirected to after successfully signing out. If the parameter is not included, the user is shown a generic message that's generated by the v2.0 endpoint.</span><span class="sxs-lookup"><span data-stu-id="5de23-301">The URL that the user is redirected to after successfully signing out. If the parameter is not included, the user is shown a generic message that's generated by the v2.0 endpoint.</span></span> <span data-ttu-id="5de23-302">This URL must match one of the redirect URIs registered for your application in the app registration portal.</span><span class="sxs-lookup"><span data-stu-id="5de23-302">This URL must match one of the redirect URIs registered for your application in the app registration portal.</span></span> |

## <a name="single-sign-out"></a><span data-ttu-id="5de23-303">Single sign-out</span><span class="sxs-lookup"><span data-stu-id="5de23-303">Single sign-out</span></span>

<span data-ttu-id="5de23-304">When you redirect the user to the `end_session_endpoint`, the v2.0 endpoint clears the user's session from the browser.</span><span class="sxs-lookup"><span data-stu-id="5de23-304">When you redirect the user to the `end_session_endpoint`, the v2.0 endpoint clears the user's session from the browser.</span></span> <span data-ttu-id="5de23-305">However, the user may still be signed in to other applications that use Microsoft accounts for authentication.</span><span class="sxs-lookup"><span data-stu-id="5de23-305">However, the user may still be signed in to other applications that use Microsoft accounts for authentication.</span></span> <span data-ttu-id="5de23-306">To enable those applications to sign the user out simultaneously, the v2.0 endpoint sends an HTTP GET request to the registered `LogoutUrl` of all the applications that the user is currently signed in to.</span><span class="sxs-lookup"><span data-stu-id="5de23-306">To enable those applications to sign the user out simultaneously, the v2.0 endpoint sends an HTTP GET request to the registered `LogoutUrl` of all the applications that the user is currently signed in to.</span></span> <span data-ttu-id="5de23-307">Applications must respond to this request by clearing any session that identifies the user and returning a `200` response.</span><span class="sxs-lookup"><span data-stu-id="5de23-307">Applications must respond to this request by clearing any session that identifies the user and returning a `200` response.</span></span> <span data-ttu-id="5de23-308">If you wish to support single sign-out in your application, you must implement such a `LogoutUrl` in your application's code.</span><span class="sxs-lookup"><span data-stu-id="5de23-308">If you wish to support single sign-out in your application, you must implement such a `LogoutUrl` in your application's code.</span></span> <span data-ttu-id="5de23-309">You can set the `LogoutUrl` from the app registration portal.</span><span class="sxs-lookup"><span data-stu-id="5de23-309">You can set the `LogoutUrl` from the app registration portal.</span></span>

## <a name="protocol-diagram-access-token-acquisition"></a><span data-ttu-id="5de23-310">Protocol diagram: Access token acquisition</span><span class="sxs-lookup"><span data-stu-id="5de23-310">Protocol diagram: Access token acquisition</span></span>

<span data-ttu-id="5de23-311">Many web apps need to not only sign the user in, but also to access a web service on behalf of the user by using OAuth.</span><span class="sxs-lookup"><span data-stu-id="5de23-311">Many web apps need to not only sign the user in, but also to access a web service on behalf of the user by using OAuth.</span></span> <span data-ttu-id="5de23-312">This scenario combines OpenID Connect for user authentication while simultaneously getting an authorization code that you can use to get access tokens if you are using the OAuth authorization code flow.</span><span class="sxs-lookup"><span data-stu-id="5de23-312">This scenario combines OpenID Connect for user authentication while simultaneously getting an authorization code that you can use to get access tokens if you are using the OAuth authorization code flow.</span></span>

<span data-ttu-id="5de23-313">The full OpenID Connect sign-in and token acquisition flow looks similar to the next diagram.</span><span class="sxs-lookup"><span data-stu-id="5de23-313">The full OpenID Connect sign-in and token acquisition flow looks similar to the next diagram.</span></span> <span data-ttu-id="5de23-314">We describe each step in detail in the next sections of the article.</span><span class="sxs-lookup"><span data-stu-id="5de23-314">We describe each step in detail in the next sections of the article.</span></span>

![OpenID Connect  protocol: Token acquisition](./media/v2-protocols-oidc/convergence_scenarios_webapp_webapi.png)

## <a name="get-access-tokens"></a><span data-ttu-id="5de23-316">Get access tokens</span><span class="sxs-lookup"><span data-stu-id="5de23-316">Get access tokens</span></span>
<span data-ttu-id="5de23-317">To acquire access tokens, modify the sign-in request:</span><span class="sxs-lookup"><span data-stu-id="5de23-317">To acquire access tokens, modify the sign-in request:</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e        // Your registered Application ID
&response_type=id_token%20code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F       // Your registered redirect URI, URL encoded
&response_mode=form_post                              // 'form_post' or 'fragment'
&scope=openid%20                                      // Include both 'openid' and scopes that your app needs  
offline_access%20                                         
https%3A%2F%2Fgraph.microsoft.com%2Fmail.read
&state=12345                                          // Any value, provided by your app
&nonce=678910                                         // Any value, provided by your app
```

> [!TIP]
> <span data-ttu-id="5de23-318">Click the following link to execute this request.</span><span class="sxs-lookup"><span data-stu-id="5de23-318">Click the following link to execute this request.</span></span> <span data-ttu-id="5de23-319">After you sign in, your browser is redirected to https://localhost/myapp/, with an ID token and a code in the address bar.</span><span class="sxs-lookup"><span data-stu-id="5de23-319">After you sign in, your browser is redirected to https://localhost/myapp/, with an ID token and a code in the address bar.</span></span> <span data-ttu-id="5de23-320">Note that this request uses `response_mode=fragment` (for demonstration purposes only).</span><span class="sxs-lookup"><span data-stu-id="5de23-320">Note that this request uses `response_mode=fragment` (for demonstration purposes only).</span></span> <span data-ttu-id="5de23-321">We recommend that you use `response_mode=form_post`.</span><span class="sxs-lookup"><span data-stu-id="5de23-321">We recommend that you use `response_mode=form_post`.</span></span>
> <span data-ttu-id="5de23-322"><a href="https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&response_type=id_token%20code&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&response_mode=fragment&scope=openid%20offline_access%20https%3A%2F%2Fgraph.microsoft.com%2Fmail.read&state=12345&nonce=678910" target="_blank">https://login.microsoftonline.com/common/oauth2/v2.0/authorize...</a></span><span class="sxs-lookup"><span data-stu-id="5de23-322"><a href="https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&response_type=id_token%20code&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&response_mode=fragment&scope=openid%20offline_access%20https%3A%2F%2Fgraph.microsoft.com%2Fmail.read&state=12345&nonce=678910" target="_blank">https://login.microsoftonline.com/common/oauth2/v2.0/authorize...</a></span></span>
> 
> 

<span data-ttu-id="5de23-323">By including permission scopes in the request and by using `response_type=id_token code`, the v2.0 endpoint ensures that the user has consented to the permissions indicated in the `scope` query parameter.</span><span class="sxs-lookup"><span data-stu-id="5de23-323">By including permission scopes in the request and by using `response_type=id_token code`, the v2.0 endpoint ensures that the user has consented to the permissions indicated in the `scope` query parameter.</span></span> <span data-ttu-id="5de23-324">It returns an authorization code to your app to exchange for an access token.</span><span class="sxs-lookup"><span data-stu-id="5de23-324">It returns an authorization code to your app to exchange for an access token.</span></span>

### <a name="successful-response"></a><span data-ttu-id="5de23-325">Successful response</span><span class="sxs-lookup"><span data-stu-id="5de23-325">Successful response</span></span>

<span data-ttu-id="5de23-326">A successful response from using `response_mode=form_post` looks like this:</span><span class="sxs-lookup"><span data-stu-id="5de23-326">A successful response from using `response_mode=form_post` looks like this:</span></span>

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNB...&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&state=12345
```

| <span data-ttu-id="5de23-327">Parameter</span><span class="sxs-lookup"><span data-stu-id="5de23-327">Parameter</span></span> | <span data-ttu-id="5de23-328">Description</span><span class="sxs-lookup"><span data-stu-id="5de23-328">Description</span></span> |
| --- | --- |
| <span data-ttu-id="5de23-329">id_token</span><span class="sxs-lookup"><span data-stu-id="5de23-329">id_token</span></span> |<span data-ttu-id="5de23-330">The ID token that the app requested.</span><span class="sxs-lookup"><span data-stu-id="5de23-330">The ID token that the app requested.</span></span> <span data-ttu-id="5de23-331">You can use the ID token to verify the user's identity and begin a session with the user.</span><span class="sxs-lookup"><span data-stu-id="5de23-331">You can use the ID token to verify the user's identity and begin a session with the user.</span></span> <span data-ttu-id="5de23-332">You'll find more details about ID tokens and their contents in the [v2.0 endpoint tokens reference](v2-id-and-access-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="5de23-332">You'll find more details about ID tokens and their contents in the [v2.0 endpoint tokens reference](v2-id-and-access-tokens.md).</span></span> |
| <span data-ttu-id="5de23-333">code</span><span class="sxs-lookup"><span data-stu-id="5de23-333">code</span></span> |<span data-ttu-id="5de23-334">The authorization code that the app requested.</span><span class="sxs-lookup"><span data-stu-id="5de23-334">The authorization code that the app requested.</span></span> <span data-ttu-id="5de23-335">The app can use the authorization code to request an access token for the target resource.</span><span class="sxs-lookup"><span data-stu-id="5de23-335">The app can use the authorization code to request an access token for the target resource.</span></span> <span data-ttu-id="5de23-336">An authorization code is very short-lived.</span><span class="sxs-lookup"><span data-stu-id="5de23-336">An authorization code is very short-lived.</span></span> <span data-ttu-id="5de23-337">Typically, an authorization code expires in about 10 minutes.</span><span class="sxs-lookup"><span data-stu-id="5de23-337">Typically, an authorization code expires in about 10 minutes.</span></span> |
| <span data-ttu-id="5de23-338">state</span><span class="sxs-lookup"><span data-stu-id="5de23-338">state</span></span> |<span data-ttu-id="5de23-339">If a state parameter is included in the request, the same value should appear in the response.</span><span class="sxs-lookup"><span data-stu-id="5de23-339">If a state parameter is included in the request, the same value should appear in the response.</span></span> <span data-ttu-id="5de23-340">The app should verify that the state values in the request and response are identical.</span><span class="sxs-lookup"><span data-stu-id="5de23-340">The app should verify that the state values in the request and response are identical.</span></span> |

### <a name="error-response"></a><span data-ttu-id="5de23-341">Error response</span><span class="sxs-lookup"><span data-stu-id="5de23-341">Error response</span></span>

<span data-ttu-id="5de23-342">Error responses might also be sent to the redirect URI so that the app can handle them appropriately.</span><span class="sxs-lookup"><span data-stu-id="5de23-342">Error responses might also be sent to the redirect URI so that the app can handle them appropriately.</span></span> <span data-ttu-id="5de23-343">An error response looks like this:</span><span class="sxs-lookup"><span data-stu-id="5de23-343">An error response looks like this:</span></span>

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

error=access_denied&error_description=the+user+canceled+the+authentication
```

| <span data-ttu-id="5de23-344">Parameter</span><span class="sxs-lookup"><span data-stu-id="5de23-344">Parameter</span></span> | <span data-ttu-id="5de23-345">Description</span><span class="sxs-lookup"><span data-stu-id="5de23-345">Description</span></span> |
| --- | --- |
| <span data-ttu-id="5de23-346">error</span><span class="sxs-lookup"><span data-stu-id="5de23-346">error</span></span> |<span data-ttu-id="5de23-347">An error code string that you can use to classify types of errors that occur, and to react to errors.</span><span class="sxs-lookup"><span data-stu-id="5de23-347">An error code string that you can use to classify types of errors that occur, and to react to errors.</span></span> |
| <span data-ttu-id="5de23-348">error_description</span><span class="sxs-lookup"><span data-stu-id="5de23-348">error_description</span></span> |<span data-ttu-id="5de23-349">A specific error message that can help you identify the root cause of an authentication error.</span><span class="sxs-lookup"><span data-stu-id="5de23-349">A specific error message that can help you identify the root cause of an authentication error.</span></span> |

<span data-ttu-id="5de23-350">For a description of possible error codes and recommended client responses, see [Error codes for authorization endpoint errors](#error-codes-for-authorization-endpoint-errors).</span><span class="sxs-lookup"><span data-stu-id="5de23-350">For a description of possible error codes and recommended client responses, see [Error codes for authorization endpoint errors](#error-codes-for-authorization-endpoint-errors).</span></span>

<span data-ttu-id="5de23-351">When you have an authorization code and an ID token, you can sign the user in and get access tokens on their behalf.</span><span class="sxs-lookup"><span data-stu-id="5de23-351">When you have an authorization code and an ID token, you can sign the user in and get access tokens on their behalf.</span></span> <span data-ttu-id="5de23-352">To sign the user in, you must validate the ID token [exactly as described](#validate-the-id-token).</span><span class="sxs-lookup"><span data-stu-id="5de23-352">To sign the user in, you must validate the ID token [exactly as described](#validate-the-id-token).</span></span> <span data-ttu-id="5de23-353">To get access tokens, follow the steps described in [OAuth protocol documentation](v2-oauth2-auth-code-flow.md#request-an-access-token).</span><span class="sxs-lookup"><span data-stu-id="5de23-353">To get access tokens, follow the steps described in [OAuth protocol documentation](v2-oauth2-auth-code-flow.md#request-an-access-token).</span></span>
