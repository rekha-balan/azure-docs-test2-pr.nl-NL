---
title: Understand the OpenID Connect authentication code flow in Azure AD | Microsoft Docs
description: This article describes how to use HTTP messages to authorize access to web applications and web APIs in your tenant using Azure Active Directory and OpenID Connect.
services: active-directory
documentationcenter: .net
author: CelesteDG
manager: mtillman
editor: ''
ms.assetid: 29142f7e-d862-4076-9a1a-ecae5bcd9d9b
ms.service: active-directory
ms.component: develop
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/17/2018
ms.author: celested
ms.reviewer: hirsin
ms.custom: aaddev
ms.openlocfilehash: 940c576c60252be62b482b89a94544e7320a34b6
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44866642"
---
# <a name="authorize-access-to-web-applications-using-openid-connect-and-azure-active-directory"></a><span data-ttu-id="66068-103">Authorize access to web applications using OpenID Connect and Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="66068-103">Authorize access to web applications using OpenID Connect and Azure Active Directory</span></span>
<span data-ttu-id="66068-104">[OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) is a simple identity layer built on top of the OAuth 2.0 protocol.</span><span class="sxs-lookup"><span data-stu-id="66068-104">[OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) is a simple identity layer built on top of the OAuth 2.0 protocol.</span></span> <span data-ttu-id="66068-105">OAuth 2.0 defines mechanisms to obtain and use **access tokens** to access protected resources, but they do not define standard methods to provide identity information.</span><span class="sxs-lookup"><span data-stu-id="66068-105">OAuth 2.0 defines mechanisms to obtain and use **access tokens** to access protected resources, but they do not define standard methods to provide identity information.</span></span> <span data-ttu-id="66068-106">OpenID Connect implements authentication as an extension to the OAuth 2.0 authorization process.</span><span class="sxs-lookup"><span data-stu-id="66068-106">OpenID Connect implements authentication as an extension to the OAuth 2.0 authorization process.</span></span> <span data-ttu-id="66068-107">It provides information about the end user in the form of an `id_token` that verifies the identity of the user and provides basic profile information about the user.</span><span class="sxs-lookup"><span data-stu-id="66068-107">It provides information about the end user in the form of an `id_token` that verifies the identity of the user and provides basic profile information about the user.</span></span>

<span data-ttu-id="66068-108">OpenID Connect is our recommendation if you are building a web application that is hosted on a server and accessed via a browser.</span><span class="sxs-lookup"><span data-stu-id="66068-108">OpenID Connect is our recommendation if you are building a web application that is hosted on a server and accessed via a browser.</span></span>


[!INCLUDE [active-directory-protocols-getting-started](../../../includes/active-directory-protocols-getting-started.md)] 

## <a name="authentication-flow-using-openid-connect"></a><span data-ttu-id="66068-109">Authentication flow using OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="66068-109">Authentication flow using OpenID Connect</span></span>
<span data-ttu-id="66068-110">The most basic sign-in flow contains the following steps - each of them is described in detail below.</span><span class="sxs-lookup"><span data-stu-id="66068-110">The most basic sign-in flow contains the following steps - each of them is described in detail below.</span></span>

![OpenId Connect Authentication Flow](./media/v1-protocols-openid-connect-code/active-directory-oauth-code-flow-web-app.png)

## <a name="openid-connect-metadata-document"></a><span data-ttu-id="66068-112">OpenID Connect metadata document</span><span class="sxs-lookup"><span data-stu-id="66068-112">OpenID Connect metadata document</span></span>

<span data-ttu-id="66068-113">OpenID Connect describes a metadata document that contains most of the information required for an app to perform sign-in.</span><span class="sxs-lookup"><span data-stu-id="66068-113">OpenID Connect describes a metadata document that contains most of the information required for an app to perform sign-in.</span></span> <span data-ttu-id="66068-114">This includes information such as the URLs to use and the location of the service's public signing keys.</span><span class="sxs-lookup"><span data-stu-id="66068-114">This includes information such as the URLs to use and the location of the service's public signing keys.</span></span> <span data-ttu-id="66068-115">The OpenID Connect metadata document can be found at:</span><span class="sxs-lookup"><span data-stu-id="66068-115">The OpenID Connect metadata document can be found at:</span></span>

```
https://login.microsoftonline.com/{tenant}/.well-known/openid-configuration
```
<span data-ttu-id="66068-116">The metadata is a simple JavaScript Object Notation (JSON) document.</span><span class="sxs-lookup"><span data-stu-id="66068-116">The metadata is a simple JavaScript Object Notation (JSON) document.</span></span> <span data-ttu-id="66068-117">See the following snippet for an example.</span><span class="sxs-lookup"><span data-stu-id="66068-117">See the following snippet for an example.</span></span> <span data-ttu-id="66068-118">The snippet's contents are fully described in the [OpenID Connect specification](https://openid.net).</span><span class="sxs-lookup"><span data-stu-id="66068-118">The snippet's contents are fully described in the [OpenID Connect specification](https://openid.net).</span></span>

```
{
    "authorization_endpoint": "https://login.microsoftonline.com/common/oauth2/authorize",
    "token_endpoint": "https://login.microsoftonline.com/common/oauth2/token",
    "token_endpoint_auth_methods_supported":
    [
        "client_secret_post",
        "private_key_jwt"
    ],
    "jwks_uri": "https://login.microsoftonline.com/common/discovery/keys"
    
    ...
}
```

## <a name="send-the-sign-in-request"></a><span data-ttu-id="66068-119">Send the sign-in request</span><span class="sxs-lookup"><span data-stu-id="66068-119">Send the sign-in request</span></span>
<span data-ttu-id="66068-120">When your web application needs to authenticate the user, it must direct the user to the `/authorize` endpoint.</span><span class="sxs-lookup"><span data-stu-id="66068-120">When your web application needs to authenticate the user, it must direct the user to the `/authorize` endpoint.</span></span> <span data-ttu-id="66068-121">This request is similar to the first leg of the [OAuth 2.0 Authorization Code Flow](v1-protocols-oauth-code.md), with a few important distinctions:</span><span class="sxs-lookup"><span data-stu-id="66068-121">This request is similar to the first leg of the [OAuth 2.0 Authorization Code Flow](v1-protocols-oauth-code.md), with a few important distinctions:</span></span>

* <span data-ttu-id="66068-122">The request must include the scope `openid` in the `scope` parameter.</span><span class="sxs-lookup"><span data-stu-id="66068-122">The request must include the scope `openid` in the `scope` parameter.</span></span>
* <span data-ttu-id="66068-123">The `response_type` parameter must include `id_token`.</span><span class="sxs-lookup"><span data-stu-id="66068-123">The `response_type` parameter must include `id_token`.</span></span>
* <span data-ttu-id="66068-124">The request must include the `nonce` parameter.</span><span class="sxs-lookup"><span data-stu-id="66068-124">The request must include the `nonce` parameter.</span></span>

<span data-ttu-id="66068-125">So a sample request would look like this:</span><span class="sxs-lookup"><span data-stu-id="66068-125">So a sample request would look like this:</span></span>

```
// Line breaks for legibility only

GET https://login.microsoftonline.com/{tenant}/oauth2/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=id_token
&redirect_uri=http%3A%2F%2Flocalhost%3a12345
&response_mode=form_post
&scope=openid
&state=12345
&nonce=7362CAEA-9CA5-4B43-9BA3-34D7C303EBA7
```

| <span data-ttu-id="66068-126">Parameter</span><span class="sxs-lookup"><span data-stu-id="66068-126">Parameter</span></span> |  | <span data-ttu-id="66068-127">Description</span><span class="sxs-lookup"><span data-stu-id="66068-127">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="66068-128">tenant</span><span class="sxs-lookup"><span data-stu-id="66068-128">tenant</span></span> |<span data-ttu-id="66068-129">required</span><span class="sxs-lookup"><span data-stu-id="66068-129">required</span></span> |<span data-ttu-id="66068-130">The `{tenant}` value in the path of the request can be used to control who can sign into the application.</span><span class="sxs-lookup"><span data-stu-id="66068-130">The `{tenant}` value in the path of the request can be used to control who can sign into the application.</span></span> <span data-ttu-id="66068-131">The allowed values are tenant identifiers, for example, `8eaef023-2b34-4da1-9baa-8bc8c9d6a490` or `contoso.onmicrosoft.com` or `common` for tenant-independent tokens</span><span class="sxs-lookup"><span data-stu-id="66068-131">The allowed values are tenant identifiers, for example, `8eaef023-2b34-4da1-9baa-8bc8c9d6a490` or `contoso.onmicrosoft.com` or `common` for tenant-independent tokens</span></span> |
| <span data-ttu-id="66068-132">client_id</span><span class="sxs-lookup"><span data-stu-id="66068-132">client_id</span></span> |<span data-ttu-id="66068-133">required</span><span class="sxs-lookup"><span data-stu-id="66068-133">required</span></span> |<span data-ttu-id="66068-134">The Application Id assigned to your app when you registered it with Azure AD.</span><span class="sxs-lookup"><span data-stu-id="66068-134">The Application Id assigned to your app when you registered it with Azure AD.</span></span> <span data-ttu-id="66068-135">You can find this in the Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="66068-135">You can find this in the Azure Portal.</span></span> <span data-ttu-id="66068-136">Click **Azure Active Directory**, click **App Registrations**, choose the application and locate the Application Id on the application page.</span><span class="sxs-lookup"><span data-stu-id="66068-136">Click **Azure Active Directory**, click **App Registrations**, choose the application and locate the Application Id on the application page.</span></span> |
| <span data-ttu-id="66068-137">response_type</span><span class="sxs-lookup"><span data-stu-id="66068-137">response_type</span></span> |<span data-ttu-id="66068-138">required</span><span class="sxs-lookup"><span data-stu-id="66068-138">required</span></span> |<span data-ttu-id="66068-139">Must include `id_token` for OpenID Connect sign-in.</span><span class="sxs-lookup"><span data-stu-id="66068-139">Must include `id_token` for OpenID Connect sign-in.</span></span> <span data-ttu-id="66068-140">It may also include other response_types, such as `code`.</span><span class="sxs-lookup"><span data-stu-id="66068-140">It may also include other response_types, such as `code`.</span></span> |
| <span data-ttu-id="66068-141">scope</span><span class="sxs-lookup"><span data-stu-id="66068-141">scope</span></span> |<span data-ttu-id="66068-142">required</span><span class="sxs-lookup"><span data-stu-id="66068-142">required</span></span> |<span data-ttu-id="66068-143">A space-separated list of scopes.</span><span class="sxs-lookup"><span data-stu-id="66068-143">A space-separated list of scopes.</span></span> <span data-ttu-id="66068-144">For OpenID Connect, it must include the scope `openid`, which translates to the "Sign you in" permission in the consent UI.</span><span class="sxs-lookup"><span data-stu-id="66068-144">For OpenID Connect, it must include the scope `openid`, which translates to the "Sign you in" permission in the consent UI.</span></span> <span data-ttu-id="66068-145">You may also include other scopes in this request for requesting consent.</span><span class="sxs-lookup"><span data-stu-id="66068-145">You may also include other scopes in this request for requesting consent.</span></span> |
| <span data-ttu-id="66068-146">nonce</span><span class="sxs-lookup"><span data-stu-id="66068-146">nonce</span></span> |<span data-ttu-id="66068-147">required</span><span class="sxs-lookup"><span data-stu-id="66068-147">required</span></span> |<span data-ttu-id="66068-148">A value included in the request, generated by the app, that is included in the resulting `id_token` as a claim.</span><span class="sxs-lookup"><span data-stu-id="66068-148">A value included in the request, generated by the app, that is included in the resulting `id_token` as a claim.</span></span> <span data-ttu-id="66068-149">The app can then verify this value to mitigate token replay attacks.</span><span class="sxs-lookup"><span data-stu-id="66068-149">The app can then verify this value to mitigate token replay attacks.</span></span> <span data-ttu-id="66068-150">The value is typically a randomized, unique string or GUID that can be used to identify the origin of the request.</span><span class="sxs-lookup"><span data-stu-id="66068-150">The value is typically a randomized, unique string or GUID that can be used to identify the origin of the request.</span></span> |
| <span data-ttu-id="66068-151">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="66068-151">redirect_uri</span></span> |<span data-ttu-id="66068-152">recommended</span><span class="sxs-lookup"><span data-stu-id="66068-152">recommended</span></span> |<span data-ttu-id="66068-153">The redirect_uri of your app, where authentication responses can be sent and received by your app.</span><span class="sxs-lookup"><span data-stu-id="66068-153">The redirect_uri of your app, where authentication responses can be sent and received by your app.</span></span> <span data-ttu-id="66068-154">It must exactly match one of the redirect_uris you registered in the portal, except it must be url encoded.</span><span class="sxs-lookup"><span data-stu-id="66068-154">It must exactly match one of the redirect_uris you registered in the portal, except it must be url encoded.</span></span> |
| <span data-ttu-id="66068-155">response_mode</span><span class="sxs-lookup"><span data-stu-id="66068-155">response_mode</span></span> |<span data-ttu-id="66068-156">recommended</span><span class="sxs-lookup"><span data-stu-id="66068-156">recommended</span></span> |<span data-ttu-id="66068-157">Specifies the method that should be used to send the resulting authorization_code back to your app.</span><span class="sxs-lookup"><span data-stu-id="66068-157">Specifies the method that should be used to send the resulting authorization_code back to your app.</span></span> <span data-ttu-id="66068-158">Supported values are `form_post` for *HTTP form post* and `fragment` for *URL fragment*.</span><span class="sxs-lookup"><span data-stu-id="66068-158">Supported values are `form_post` for *HTTP form post* and `fragment` for *URL fragment*.</span></span> <span data-ttu-id="66068-159">For web applications, we recommend using `response_mode=form_post` to ensure the most secure transfer of tokens to your application.</span><span class="sxs-lookup"><span data-stu-id="66068-159">For web applications, we recommend using `response_mode=form_post` to ensure the most secure transfer of tokens to your application.</span></span> <span data-ttu-id="66068-160">The default, if `response_mode` is not included, is `fragment`.</span><span class="sxs-lookup"><span data-stu-id="66068-160">The default, if `response_mode` is not included, is `fragment`.</span></span>|
| <span data-ttu-id="66068-161">state</span><span class="sxs-lookup"><span data-stu-id="66068-161">state</span></span> |<span data-ttu-id="66068-162">recommended</span><span class="sxs-lookup"><span data-stu-id="66068-162">recommended</span></span> |<span data-ttu-id="66068-163">A value included in the request that is returned in the token response.</span><span class="sxs-lookup"><span data-stu-id="66068-163">A value included in the request that is returned in the token response.</span></span> <span data-ttu-id="66068-164">It can be a string of any content that you wish.</span><span class="sxs-lookup"><span data-stu-id="66068-164">It can be a string of any content that you wish.</span></span> <span data-ttu-id="66068-165">A randomly generated unique value is typically used for [preventing cross-site request forgery attacks](http://tools.ietf.org/html/rfc6749#section-10.12).</span><span class="sxs-lookup"><span data-stu-id="66068-165">A randomly generated unique value is typically used for [preventing cross-site request forgery attacks](http://tools.ietf.org/html/rfc6749#section-10.12).</span></span> <span data-ttu-id="66068-166">The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span><span class="sxs-lookup"><span data-stu-id="66068-166">The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |
| <span data-ttu-id="66068-167">prompt</span><span class="sxs-lookup"><span data-stu-id="66068-167">prompt</span></span> |<span data-ttu-id="66068-168">optional</span><span class="sxs-lookup"><span data-stu-id="66068-168">optional</span></span> |<span data-ttu-id="66068-169">Indicates the type of user interaction that is required.</span><span class="sxs-lookup"><span data-stu-id="66068-169">Indicates the type of user interaction that is required.</span></span> <span data-ttu-id="66068-170">Currently, the only valid values are 'login', 'none', and 'consent'.</span><span class="sxs-lookup"><span data-stu-id="66068-170">Currently, the only valid values are 'login', 'none', and 'consent'.</span></span> <span data-ttu-id="66068-171">`prompt=login` forces the user to enter their credentials on that request, negating single-sign on.</span><span class="sxs-lookup"><span data-stu-id="66068-171">`prompt=login` forces the user to enter their credentials on that request, negating single-sign on.</span></span> <span data-ttu-id="66068-172">`prompt=none` is the opposite - it ensures that the user is not presented with any interactive prompt whatsoever.</span><span class="sxs-lookup"><span data-stu-id="66068-172">`prompt=none` is the opposite - it ensures that the user is not presented with any interactive prompt whatsoever.</span></span> <span data-ttu-id="66068-173">If the request cannot be completed silently via single-sign on, the endpoint returns an error.</span><span class="sxs-lookup"><span data-stu-id="66068-173">If the request cannot be completed silently via single-sign on, the endpoint returns an error.</span></span> <span data-ttu-id="66068-174">`prompt=consent` triggers the OAuth consent dialog after the user signs in, asking the user to grant permissions to the app.</span><span class="sxs-lookup"><span data-stu-id="66068-174">`prompt=consent` triggers the OAuth consent dialog after the user signs in, asking the user to grant permissions to the app.</span></span> |
| <span data-ttu-id="66068-175">login_hint</span><span class="sxs-lookup"><span data-stu-id="66068-175">login_hint</span></span> |<span data-ttu-id="66068-176">optional</span><span class="sxs-lookup"><span data-stu-id="66068-176">optional</span></span> |<span data-ttu-id="66068-177">Can be used to pre-fill the username/email address field of the sign-in page for the user, if you know their username ahead of time.</span><span class="sxs-lookup"><span data-stu-id="66068-177">Can be used to pre-fill the username/email address field of the sign-in page for the user, if you know their username ahead of time.</span></span> <span data-ttu-id="66068-178">Often apps use this parameter during reauthentication, having already extracted the username from a previous sign-in using the `preferred_username` claim.</span><span class="sxs-lookup"><span data-stu-id="66068-178">Often apps use this parameter during reauthentication, having already extracted the username from a previous sign-in using the `preferred_username` claim.</span></span> |

<span data-ttu-id="66068-179">At this point, the user is asked to enter their credentials and complete the authentication.</span><span class="sxs-lookup"><span data-stu-id="66068-179">At this point, the user is asked to enter their credentials and complete the authentication.</span></span>

### <a name="sample-response"></a><span data-ttu-id="66068-180">Sample response</span><span class="sxs-lookup"><span data-stu-id="66068-180">Sample response</span></span>
<span data-ttu-id="66068-181">A sample response, after the user has authenticated, could look like this:</span><span class="sxs-lookup"><span data-stu-id="66068-181">A sample response, after the user has authenticated, could look like this:</span></span>

```
POST / HTTP/1.1
Host: localhost:12345
Content-Type: application/x-www-form-urlencoded

id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNB...&state=12345
```

| <span data-ttu-id="66068-182">Parameter</span><span class="sxs-lookup"><span data-stu-id="66068-182">Parameter</span></span> | <span data-ttu-id="66068-183">Description</span><span class="sxs-lookup"><span data-stu-id="66068-183">Description</span></span> |
| --- | --- |
| <span data-ttu-id="66068-184">id_token</span><span class="sxs-lookup"><span data-stu-id="66068-184">id_token</span></span> |<span data-ttu-id="66068-185">The `id_token` that the app requested.</span><span class="sxs-lookup"><span data-stu-id="66068-185">The `id_token` that the app requested.</span></span> <span data-ttu-id="66068-186">You can use the `id_token` to verify the user's identity and begin a session with the user.</span><span class="sxs-lookup"><span data-stu-id="66068-186">You can use the `id_token` to verify the user's identity and begin a session with the user.</span></span> |
| <span data-ttu-id="66068-187">state</span><span class="sxs-lookup"><span data-stu-id="66068-187">state</span></span> |<span data-ttu-id="66068-188">A value included in the request that is also returned in the token response.</span><span class="sxs-lookup"><span data-stu-id="66068-188">A value included in the request that is also returned in the token response.</span></span> <span data-ttu-id="66068-189">A randomly generated unique value is typically used for [preventing cross-site request forgery attacks](http://tools.ietf.org/html/rfc6749#section-10.12).</span><span class="sxs-lookup"><span data-stu-id="66068-189">A randomly generated unique value is typically used for [preventing cross-site request forgery attacks](http://tools.ietf.org/html/rfc6749#section-10.12).</span></span> <span data-ttu-id="66068-190">The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span><span class="sxs-lookup"><span data-stu-id="66068-190">The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |

### <a name="error-response"></a><span data-ttu-id="66068-191">Error response</span><span class="sxs-lookup"><span data-stu-id="66068-191">Error response</span></span>
<span data-ttu-id="66068-192">Error responses may also be sent to the `redirect_uri` so the app can handle them appropriately:</span><span class="sxs-lookup"><span data-stu-id="66068-192">Error responses may also be sent to the `redirect_uri` so the app can handle them appropriately:</span></span>

```
POST / HTTP/1.1
Host: localhost:12345
Content-Type: application/x-www-form-urlencoded

error=access_denied&error_description=the+user+canceled+the+authentication
```

| <span data-ttu-id="66068-193">Parameter</span><span class="sxs-lookup"><span data-stu-id="66068-193">Parameter</span></span> | <span data-ttu-id="66068-194">Description</span><span class="sxs-lookup"><span data-stu-id="66068-194">Description</span></span> |
| --- | --- |
| <span data-ttu-id="66068-195">error</span><span class="sxs-lookup"><span data-stu-id="66068-195">error</span></span> |<span data-ttu-id="66068-196">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span><span class="sxs-lookup"><span data-stu-id="66068-196">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="66068-197">error_description</span><span class="sxs-lookup"><span data-stu-id="66068-197">error_description</span></span> |<span data-ttu-id="66068-198">A specific error message that can help a developer identify the root cause of an authentication error.</span><span class="sxs-lookup"><span data-stu-id="66068-198">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |

#### <a name="error-codes-for-authorization-endpoint-errors"></a><span data-ttu-id="66068-199">Error codes for authorization endpoint errors</span><span class="sxs-lookup"><span data-stu-id="66068-199">Error codes for authorization endpoint errors</span></span>
<span data-ttu-id="66068-200">The following table describes the various error codes that can be returned in the `error` parameter of the error response.</span><span class="sxs-lookup"><span data-stu-id="66068-200">The following table describes the various error codes that can be returned in the `error` parameter of the error response.</span></span>

| <span data-ttu-id="66068-201">Error Code</span><span class="sxs-lookup"><span data-stu-id="66068-201">Error Code</span></span> | <span data-ttu-id="66068-202">Description</span><span class="sxs-lookup"><span data-stu-id="66068-202">Description</span></span> | <span data-ttu-id="66068-203">Client Action</span><span class="sxs-lookup"><span data-stu-id="66068-203">Client Action</span></span> |
| --- | --- | --- |
| <span data-ttu-id="66068-204">invalid_request</span><span class="sxs-lookup"><span data-stu-id="66068-204">invalid_request</span></span> |<span data-ttu-id="66068-205">Protocol error, such as a missing required parameter.</span><span class="sxs-lookup"><span data-stu-id="66068-205">Protocol error, such as a missing required parameter.</span></span> |<span data-ttu-id="66068-206">Fix and resubmit the request.</span><span class="sxs-lookup"><span data-stu-id="66068-206">Fix and resubmit the request.</span></span> <span data-ttu-id="66068-207">This is a development error, and is typically caught during initial testing.</span><span class="sxs-lookup"><span data-stu-id="66068-207">This is a development error, and is typically caught during initial testing.</span></span> |
| <span data-ttu-id="66068-208">unauthorized_client</span><span class="sxs-lookup"><span data-stu-id="66068-208">unauthorized_client</span></span> |<span data-ttu-id="66068-209">The client application is not permitted to request an authorization code.</span><span class="sxs-lookup"><span data-stu-id="66068-209">The client application is not permitted to request an authorization code.</span></span> |<span data-ttu-id="66068-210">This usually occurs when the client application is not registered in Azure AD or is not added to the user's Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="66068-210">This usually occurs when the client application is not registered in Azure AD or is not added to the user's Azure AD tenant.</span></span> <span data-ttu-id="66068-211">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="66068-211">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span></span> |
| <span data-ttu-id="66068-212">access_denied</span><span class="sxs-lookup"><span data-stu-id="66068-212">access_denied</span></span> |<span data-ttu-id="66068-213">Resource owner denied consent</span><span class="sxs-lookup"><span data-stu-id="66068-213">Resource owner denied consent</span></span> |<span data-ttu-id="66068-214">The client application can notify the user that it cannot proceed unless the user consents.</span><span class="sxs-lookup"><span data-stu-id="66068-214">The client application can notify the user that it cannot proceed unless the user consents.</span></span> |
| <span data-ttu-id="66068-215">unsupported_response_type</span><span class="sxs-lookup"><span data-stu-id="66068-215">unsupported_response_type</span></span> |<span data-ttu-id="66068-216">The authorization server does not support the response type in the request.</span><span class="sxs-lookup"><span data-stu-id="66068-216">The authorization server does not support the response type in the request.</span></span> |<span data-ttu-id="66068-217">Fix and resubmit the request.</span><span class="sxs-lookup"><span data-stu-id="66068-217">Fix and resubmit the request.</span></span> <span data-ttu-id="66068-218">This is a development error, and is typically caught during initial testing.</span><span class="sxs-lookup"><span data-stu-id="66068-218">This is a development error, and is typically caught during initial testing.</span></span> |
| <span data-ttu-id="66068-219">server_error</span><span class="sxs-lookup"><span data-stu-id="66068-219">server_error</span></span> |<span data-ttu-id="66068-220">The server encountered an unexpected error.</span><span class="sxs-lookup"><span data-stu-id="66068-220">The server encountered an unexpected error.</span></span> |<span data-ttu-id="66068-221">Retry the request.</span><span class="sxs-lookup"><span data-stu-id="66068-221">Retry the request.</span></span> <span data-ttu-id="66068-222">These errors can result from temporary conditions.</span><span class="sxs-lookup"><span data-stu-id="66068-222">These errors can result from temporary conditions.</span></span> <span data-ttu-id="66068-223">The client application might explain to the user that its response is delayed due to a temporary error.</span><span class="sxs-lookup"><span data-stu-id="66068-223">The client application might explain to the user that its response is delayed due to a temporary error.</span></span> |
| <span data-ttu-id="66068-224">temporarily_unavailable</span><span class="sxs-lookup"><span data-stu-id="66068-224">temporarily_unavailable</span></span> |<span data-ttu-id="66068-225">The server is temporarily too busy to handle the request.</span><span class="sxs-lookup"><span data-stu-id="66068-225">The server is temporarily too busy to handle the request.</span></span> |<span data-ttu-id="66068-226">Retry the request.</span><span class="sxs-lookup"><span data-stu-id="66068-226">Retry the request.</span></span> <span data-ttu-id="66068-227">The client application might explain to the user that its response is delayed due to a temporary condition.</span><span class="sxs-lookup"><span data-stu-id="66068-227">The client application might explain to the user that its response is delayed due to a temporary condition.</span></span> |
| <span data-ttu-id="66068-228">invalid_resource</span><span class="sxs-lookup"><span data-stu-id="66068-228">invalid_resource</span></span> |<span data-ttu-id="66068-229">The target resource is invalid because it does not exist, Azure AD cannot find it, or it is not correctly configured.</span><span class="sxs-lookup"><span data-stu-id="66068-229">The target resource is invalid because it does not exist, Azure AD cannot find it, or it is not correctly configured.</span></span> |<span data-ttu-id="66068-230">This indicates the resource, if it exists, has not been configured in the tenant.</span><span class="sxs-lookup"><span data-stu-id="66068-230">This indicates the resource, if it exists, has not been configured in the tenant.</span></span> <span data-ttu-id="66068-231">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="66068-231">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span></span> |

## <a name="validate-the-idtoken"></a><span data-ttu-id="66068-232">Validate the id_token</span><span class="sxs-lookup"><span data-stu-id="66068-232">Validate the id_token</span></span>
<span data-ttu-id="66068-233">Just receiving an `id_token` is not sufficient to authenticate the user; you must validate the signature and verify the claims in the `id_token` per your app's requirements.</span><span class="sxs-lookup"><span data-stu-id="66068-233">Just receiving an `id_token` is not sufficient to authenticate the user; you must validate the signature and verify the claims in the `id_token` per your app's requirements.</span></span> <span data-ttu-id="66068-234">The Azure AD endpoint uses JSON Web Tokens (JWTs) and public key cryptography to sign tokens and verify that they are valid.</span><span class="sxs-lookup"><span data-stu-id="66068-234">The Azure AD endpoint uses JSON Web Tokens (JWTs) and public key cryptography to sign tokens and verify that they are valid.</span></span>

<span data-ttu-id="66068-235">You can choose to validate the `id_token` in client code, but a common practice is to send the `id_token` to a backend server and perform the validation there.</span><span class="sxs-lookup"><span data-stu-id="66068-235">You can choose to validate the `id_token` in client code, but a common practice is to send the `id_token` to a backend server and perform the validation there.</span></span> <span data-ttu-id="66068-236">Once you've validated the signature of the `id_token`, there are a few claims you are required to verify.</span><span class="sxs-lookup"><span data-stu-id="66068-236">Once you've validated the signature of the `id_token`, there are a few claims you are required to verify.</span></span>

<span data-ttu-id="66068-237">You may also wish to validate additional claims depending on your scenario.</span><span class="sxs-lookup"><span data-stu-id="66068-237">You may also wish to validate additional claims depending on your scenario.</span></span> <span data-ttu-id="66068-238">Some common validations include:</span><span class="sxs-lookup"><span data-stu-id="66068-238">Some common validations include:</span></span>

* <span data-ttu-id="66068-239">Ensuring the user/organization has signed up for the app.</span><span class="sxs-lookup"><span data-stu-id="66068-239">Ensuring the user/organization has signed up for the app.</span></span>
* <span data-ttu-id="66068-240">Ensuring the user has proper authorization/privileges</span><span class="sxs-lookup"><span data-stu-id="66068-240">Ensuring the user has proper authorization/privileges</span></span>
* <span data-ttu-id="66068-241">Ensuring a certain strength of authentication has occurred, such as multi-factor authentication.</span><span class="sxs-lookup"><span data-stu-id="66068-241">Ensuring a certain strength of authentication has occurred, such as multi-factor authentication.</span></span>

<span data-ttu-id="66068-242">Once you have validated the `id_token`, you can begin a session with the user and use the claims in the `id_token` to obtain information about the user in your app.</span><span class="sxs-lookup"><span data-stu-id="66068-242">Once you have validated the `id_token`, you can begin a session with the user and use the claims in the `id_token` to obtain information about the user in your app.</span></span> <span data-ttu-id="66068-243">This information can be used for display, records, authorizations, etc. For more information about the token types and claims, read [Supported Token and Claim Types](v1-id-and-access-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="66068-243">This information can be used for display, records, authorizations, etc. For more information about the token types and claims, read [Supported Token and Claim Types](v1-id-and-access-tokens.md).</span></span>

## <a name="send-a-sign-out-request"></a><span data-ttu-id="66068-244">Send a sign-out request</span><span class="sxs-lookup"><span data-stu-id="66068-244">Send a sign-out request</span></span>
<span data-ttu-id="66068-245">When you wish to sign the user out of the app, it is not sufficient to clear your app's cookies or otherwise end the session with the user.</span><span class="sxs-lookup"><span data-stu-id="66068-245">When you wish to sign the user out of the app, it is not sufficient to clear your app's cookies or otherwise end the session with the user.</span></span> <span data-ttu-id="66068-246">You must also redirect the user to the `end_session_endpoint` for sign-out. If you fail to do so, the user will be able to reauthenticate to your app without entering their credentials again, because they will have a valid single sign-on session with the Azure AD endpoint.</span><span class="sxs-lookup"><span data-stu-id="66068-246">You must also redirect the user to the `end_session_endpoint` for sign-out. If you fail to do so, the user will be able to reauthenticate to your app without entering their credentials again, because they will have a valid single sign-on session with the Azure AD endpoint.</span></span>

<span data-ttu-id="66068-247">You can simply redirect the user to the `end_session_endpoint` listed in the OpenID Connect metadata document:</span><span class="sxs-lookup"><span data-stu-id="66068-247">You can simply redirect the user to the `end_session_endpoint` listed in the OpenID Connect metadata document:</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/logout?
post_logout_redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F

```

| <span data-ttu-id="66068-248">Parameter</span><span class="sxs-lookup"><span data-stu-id="66068-248">Parameter</span></span> |  | <span data-ttu-id="66068-249">Description</span><span class="sxs-lookup"><span data-stu-id="66068-249">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="66068-250">post_logout_redirect_uri</span><span class="sxs-lookup"><span data-stu-id="66068-250">post_logout_redirect_uri</span></span> |<span data-ttu-id="66068-251">recommended</span><span class="sxs-lookup"><span data-stu-id="66068-251">recommended</span></span> |<span data-ttu-id="66068-252">The URL that the user should be redirected to after successful logout.</span><span class="sxs-lookup"><span data-stu-id="66068-252">The URL that the user should be redirected to after successful logout.</span></span> <span data-ttu-id="66068-253">If not included, the user is shown a generic message.</span><span class="sxs-lookup"><span data-stu-id="66068-253">If not included, the user is shown a generic message.</span></span> |

## <a name="single-sign-out"></a><span data-ttu-id="66068-254">Single sign-out</span><span class="sxs-lookup"><span data-stu-id="66068-254">Single sign-out</span></span>
<span data-ttu-id="66068-255">When you redirect the user to the `end_session_endpoint`, Azure AD clears the user's session from the browser.</span><span class="sxs-lookup"><span data-stu-id="66068-255">When you redirect the user to the `end_session_endpoint`, Azure AD clears the user's session from the browser.</span></span> <span data-ttu-id="66068-256">However, the user may still be signed in to other applications that use Azure AD for authentication.</span><span class="sxs-lookup"><span data-stu-id="66068-256">However, the user may still be signed in to other applications that use Azure AD for authentication.</span></span> <span data-ttu-id="66068-257">To enable those applications to sign the user out simultaneously, Azure AD sends an HTTP GET request to the registered `LogoutUrl` of all the applications that the user is currently signed in to.</span><span class="sxs-lookup"><span data-stu-id="66068-257">To enable those applications to sign the user out simultaneously, Azure AD sends an HTTP GET request to the registered `LogoutUrl` of all the applications that the user is currently signed in to.</span></span> <span data-ttu-id="66068-258">Applications must respond to this request by clearing any session that identifies the user and returning a `200` response.</span><span class="sxs-lookup"><span data-stu-id="66068-258">Applications must respond to this request by clearing any session that identifies the user and returning a `200` response.</span></span> <span data-ttu-id="66068-259">If you wish to support single sign out in your application, you must implement such a `LogoutUrl` in your application's code.</span><span class="sxs-lookup"><span data-stu-id="66068-259">If you wish to support single sign out in your application, you must implement such a `LogoutUrl` in your application's code.</span></span> <span data-ttu-id="66068-260">You can set the `LogoutUrl` from the Azure portal:</span><span class="sxs-lookup"><span data-stu-id="66068-260">You can set the `LogoutUrl` from the Azure portal:</span></span>

1. <span data-ttu-id="66068-261">Navigate to the [Azure Portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="66068-261">Navigate to the [Azure Portal](https://portal.azure.com).</span></span>
2. <span data-ttu-id="66068-262">Choose your Active Directory by clicking on your account in the top right corner of the page.</span><span class="sxs-lookup"><span data-stu-id="66068-262">Choose your Active Directory by clicking on your account in the top right corner of the page.</span></span>
3. <span data-ttu-id="66068-263">From the left hand navigation panel, choose **Azure Active Directory**, then choose **App registrations** and select your application.</span><span class="sxs-lookup"><span data-stu-id="66068-263">From the left hand navigation panel, choose **Azure Active Directory**, then choose **App registrations** and select your application.</span></span>
4. <span data-ttu-id="66068-264">Click on **Settings**, then **Properties** and find the **Logout URL** text box.</span><span class="sxs-lookup"><span data-stu-id="66068-264">Click on **Settings**, then **Properties** and find the **Logout URL** text box.</span></span> 

## <a name="token-acquisition"></a><span data-ttu-id="66068-265">Token Acquisition</span><span class="sxs-lookup"><span data-stu-id="66068-265">Token Acquisition</span></span>
<span data-ttu-id="66068-266">Many web apps need to not only sign the user in, but also access a web service on behalf of that user using OAuth.</span><span class="sxs-lookup"><span data-stu-id="66068-266">Many web apps need to not only sign the user in, but also access a web service on behalf of that user using OAuth.</span></span> <span data-ttu-id="66068-267">This scenario combines OpenID Connect for user authentication while simultaneously acquiring an `authorization_code` that can be used to get `access_tokens` using the [OAuth Authorization Code Flow](v1-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token).</span><span class="sxs-lookup"><span data-stu-id="66068-267">This scenario combines OpenID Connect for user authentication while simultaneously acquiring an `authorization_code` that can be used to get `access_tokens` using the [OAuth Authorization Code Flow](v1-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token).</span></span>

## <a name="get-access-tokens"></a><span data-ttu-id="66068-268">Get Access Tokens</span><span class="sxs-lookup"><span data-stu-id="66068-268">Get Access Tokens</span></span>
<span data-ttu-id="66068-269">To acquire access tokens, you need to modify the sign-in request from above:</span><span class="sxs-lookup"><span data-stu-id="66068-269">To acquire access tokens, you need to modify the sign-in request from above:</span></span>

```
// Line breaks for legibility only

GET https://login.microsoftonline.com/{tenant}/oauth2/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e        // Your registered Application Id
&response_type=id_token+code
&redirect_uri=http%3A%2F%2Flocalhost%3a12345          // Your registered Redirect Uri, url encoded
&response_mode=form_post                              // `form_post' or 'fragment'
&scope=openid
&resource=https%3A%2F%2Fservice.contoso.com%2F        // The identifier of the protected resource (web API) that your application needs access to
&state=12345                                          // Any value, provided by your app
&nonce=678910                                         // Any value, provided by your app
```

<span data-ttu-id="66068-270">By including permission scopes in the request and using `response_type=code+id_token`, the `authorize` endpoint ensures that the user has consented to the permissions indicated in the `scope` query parameter, and return your app an authorization code to exchange for an access token.</span><span class="sxs-lookup"><span data-stu-id="66068-270">By including permission scopes in the request and using `response_type=code+id_token`, the `authorize` endpoint ensures that the user has consented to the permissions indicated in the `scope` query parameter, and return your app an authorization code to exchange for an access token.</span></span>

### <a name="successful-response"></a><span data-ttu-id="66068-271">Successful Response</span><span class="sxs-lookup"><span data-stu-id="66068-271">Successful Response</span></span>
<span data-ttu-id="66068-272">A successful response using `response_mode=form_post` looks like:</span><span class="sxs-lookup"><span data-stu-id="66068-272">A successful response using `response_mode=form_post` looks like:</span></span>

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNB...&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&state=12345
```

| <span data-ttu-id="66068-273">Parameter</span><span class="sxs-lookup"><span data-stu-id="66068-273">Parameter</span></span> | <span data-ttu-id="66068-274">Description</span><span class="sxs-lookup"><span data-stu-id="66068-274">Description</span></span> |
| --- | --- |
| <span data-ttu-id="66068-275">id_token</span><span class="sxs-lookup"><span data-stu-id="66068-275">id_token</span></span> |<span data-ttu-id="66068-276">The `id_token` that the app requested.</span><span class="sxs-lookup"><span data-stu-id="66068-276">The `id_token` that the app requested.</span></span> <span data-ttu-id="66068-277">You can use the `id_token` to verify the user's identity and begin a session with the user.</span><span class="sxs-lookup"><span data-stu-id="66068-277">You can use the `id_token` to verify the user's identity and begin a session with the user.</span></span> |
| <span data-ttu-id="66068-278">code</span><span class="sxs-lookup"><span data-stu-id="66068-278">code</span></span> |<span data-ttu-id="66068-279">The authorization_code that the app requested.</span><span class="sxs-lookup"><span data-stu-id="66068-279">The authorization_code that the app requested.</span></span> <span data-ttu-id="66068-280">The app can use the authorization code to request an access token for the target resource.</span><span class="sxs-lookup"><span data-stu-id="66068-280">The app can use the authorization code to request an access token for the target resource.</span></span> <span data-ttu-id="66068-281">Authorization_codes are short lived, and typically expire after about 10 minutes.</span><span class="sxs-lookup"><span data-stu-id="66068-281">Authorization_codes are short lived, and typically expire after about 10 minutes.</span></span> |
| <span data-ttu-id="66068-282">state</span><span class="sxs-lookup"><span data-stu-id="66068-282">state</span></span> |<span data-ttu-id="66068-283">If a state parameter is included in the request, the same value should appear in the response.</span><span class="sxs-lookup"><span data-stu-id="66068-283">If a state parameter is included in the request, the same value should appear in the response.</span></span> <span data-ttu-id="66068-284">The app should verify that the state values in the request and response are identical.</span><span class="sxs-lookup"><span data-stu-id="66068-284">The app should verify that the state values in the request and response are identical.</span></span> |

### <a name="error-response"></a><span data-ttu-id="66068-285">Error response</span><span class="sxs-lookup"><span data-stu-id="66068-285">Error response</span></span>
<span data-ttu-id="66068-286">Error responses may also be sent to the `redirect_uri` so the app can handle them appropriately:</span><span class="sxs-lookup"><span data-stu-id="66068-286">Error responses may also be sent to the `redirect_uri` so the app can handle them appropriately:</span></span>

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

error=access_denied&error_description=the+user+canceled+the+authentication
```

| <span data-ttu-id="66068-287">Parameter</span><span class="sxs-lookup"><span data-stu-id="66068-287">Parameter</span></span> | <span data-ttu-id="66068-288">Description</span><span class="sxs-lookup"><span data-stu-id="66068-288">Description</span></span> |
| --- | --- |
| <span data-ttu-id="66068-289">error</span><span class="sxs-lookup"><span data-stu-id="66068-289">error</span></span> |<span data-ttu-id="66068-290">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span><span class="sxs-lookup"><span data-stu-id="66068-290">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="66068-291">error_description</span><span class="sxs-lookup"><span data-stu-id="66068-291">error_description</span></span> |<span data-ttu-id="66068-292">A specific error message that can help a developer identify the root cause of an authentication error.</span><span class="sxs-lookup"><span data-stu-id="66068-292">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |

<span data-ttu-id="66068-293">For a description of the possible error codes and their recommended client action, see [Error codes for authorization endpoint errors](#error-codes-for-authorization-endpoint-errors).</span><span class="sxs-lookup"><span data-stu-id="66068-293">For a description of the possible error codes and their recommended client action, see [Error codes for authorization endpoint errors](#error-codes-for-authorization-endpoint-errors).</span></span>

<span data-ttu-id="66068-294">Once you've gotten an authorization `code` and an `id_token`, you can sign the user in and get access tokens on their behalf.</span><span class="sxs-lookup"><span data-stu-id="66068-294">Once you've gotten an authorization `code` and an `id_token`, you can sign the user in and get access tokens on their behalf.</span></span> <span data-ttu-id="66068-295">To sign the user in, you must validate the `id_token` exactly as described above.</span><span class="sxs-lookup"><span data-stu-id="66068-295">To sign the user in, you must validate the `id_token` exactly as described above.</span></span> <span data-ttu-id="66068-296">To get access tokens, you can follow the steps described in the "Use the authorization code to request an access token" section of our [OAuth protocol documentation](v1-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token).</span><span class="sxs-lookup"><span data-stu-id="66068-296">To get access tokens, you can follow the steps described in the "Use the authorization code to request an access token" section of our [OAuth protocol documentation](v1-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token).</span></span>
