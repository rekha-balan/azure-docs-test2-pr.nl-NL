---
title: Azure AD v2.0 OAuth2.0 On-Behalf-Of flow | Microsoft Docs
description: This article describes how to use HTTP messages to implement service to service authentication using the OAuth2.0 On-Behalf-Of flow.
services: active-directory
documentationcenter: ''
author: CelesteDG
manager: mtillman
editor: ''
ms.assetid: 09f6f318-e88b-4024-9ee1-e7f09fb19a82
ms.service: active-directory
ms.component: develop
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/06/2018
ms.author: celested
ms.reviewer: hirsin
ms.custom: aaddev
ms.openlocfilehash: da13b7b7b9bd39692db422a315383e0f12aae453
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44856746"
---
# <a name="azure-active-directory-v20-and-oauth-20-on-behalf-of-flow"></a><span data-ttu-id="b626d-103">Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow</span><span class="sxs-lookup"><span data-stu-id="b626d-103">Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow</span></span>
<span data-ttu-id="b626d-104">The OAuth 2.0 On-Behalf-Of flow serves the use case where an application invokes a service/web API, which in turn needs to call another service/web API.</span><span class="sxs-lookup"><span data-stu-id="b626d-104">The OAuth 2.0 On-Behalf-Of flow serves the use case where an application invokes a service/web API, which in turn needs to call another service/web API.</span></span> <span data-ttu-id="b626d-105">The idea is to propagate the delegated user identity and permissions through the request chain.</span><span class="sxs-lookup"><span data-stu-id="b626d-105">The idea is to propagate the delegated user identity and permissions through the request chain.</span></span> <span data-ttu-id="b626d-106">For the middle-tier service to make authenticated requests to the downstream service, it needs to secure an access token from Azure Active Directory (Azure AD), on behalf of the user.</span><span class="sxs-lookup"><span data-stu-id="b626d-106">For the middle-tier service to make authenticated requests to the downstream service, it needs to secure an access token from Azure Active Directory (Azure AD), on behalf of the user.</span></span>

> [!NOTE]
> <span data-ttu-id="b626d-107">The v2.0 endpoint doesn't support all Azure Active Directory scenarios and features.</span><span class="sxs-lookup"><span data-stu-id="b626d-107">The v2.0 endpoint doesn't support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="b626d-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="b626d-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="b626d-109">The [implicit grant](v2-oauth2-implicit-grant-flow.md) cannot be used for the On-Behalf-Of flow - SPAs must pass their (implicit flow) access token to a middle-tier confidential client to perform OBO flows.</span><span class="sxs-lookup"><span data-stu-id="b626d-109">The [implicit grant](v2-oauth2-implicit-grant-flow.md) cannot be used for the On-Behalf-Of flow - SPAs must pass their (implicit flow) access token to a middle-tier confidential client to perform OBO flows.</span></span> <span data-ttu-id="b626d-110">See [limitations](#client-limitations) for more details on which clients can perform On-Behalf-Of calls.</span><span class="sxs-lookup"><span data-stu-id="b626d-110">See [limitations](#client-limitations) for more details on which clients can perform On-Behalf-Of calls.</span></span>  

## <a name="protocol-diagram"></a><span data-ttu-id="b626d-111">Protocol diagram</span><span class="sxs-lookup"><span data-stu-id="b626d-111">Protocol diagram</span></span>
<span data-ttu-id="b626d-112">Assume that the user has been authenticated on an application using the [OAuth 2.0 authorization code grant flow](v2-oauth2-auth-code-flow.md).</span><span class="sxs-lookup"><span data-stu-id="b626d-112">Assume that the user has been authenticated on an application using the [OAuth 2.0 authorization code grant flow](v2-oauth2-auth-code-flow.md).</span></span> <span data-ttu-id="b626d-113">At this point, the application has an access token *for API A* (token A) with the user’s claims and consent to access the middle-tier web API (API A).</span><span class="sxs-lookup"><span data-stu-id="b626d-113">At this point, the application has an access token *for API A* (token A) with the user’s claims and consent to access the middle-tier web API (API A).</span></span> <span data-ttu-id="b626d-114">Now, API A needs to make an authenticated request to the downstream web API (API B).</span><span class="sxs-lookup"><span data-stu-id="b626d-114">Now, API A needs to make an authenticated request to the downstream web API (API B).</span></span>

<span data-ttu-id="b626d-115">The steps that follow constitute the On-Behalf-Of flow and are explained with the help of the following diagram.</span><span class="sxs-lookup"><span data-stu-id="b626d-115">The steps that follow constitute the On-Behalf-Of flow and are explained with the help of the following diagram.</span></span>

![OAuth2.0 On-Behalf-Of Flow](./media/v1-oauth2-on-behalf-of-flow/active-directory-protocols-oauth-on-behalf-of-flow.png)


1. <span data-ttu-id="b626d-117">The client application makes a request to API A with the token A (with an `aud` claim of API A).</span><span class="sxs-lookup"><span data-stu-id="b626d-117">The client application makes a request to API A with the token A (with an `aud` claim of API A).</span></span>
2. <span data-ttu-id="b626d-118">API A authenticates to the Azure AD token issuance endpoint and requests a token to access API B.</span><span class="sxs-lookup"><span data-stu-id="b626d-118">API A authenticates to the Azure AD token issuance endpoint and requests a token to access API B.</span></span>
3. <span data-ttu-id="b626d-119">The Azure AD token issuance endpoint validates API A's credentials with token A and issues the access token for API B (token B).</span><span class="sxs-lookup"><span data-stu-id="b626d-119">The Azure AD token issuance endpoint validates API A's credentials with token A and issues the access token for API B (token B).</span></span>
4. <span data-ttu-id="b626d-120">The token B is set in the authorization header of the request to API B.</span><span class="sxs-lookup"><span data-stu-id="b626d-120">The token B is set in the authorization header of the request to API B.</span></span>
5. <span data-ttu-id="b626d-121">Data from the secured resource is returned by API B.</span><span class="sxs-lookup"><span data-stu-id="b626d-121">Data from the secured resource is returned by API B.</span></span>

> [!NOTE]
> <span data-ttu-id="b626d-122">In this scenario, the middle-tier service has no user interaction to obtain the user's consent to access the downstream API.</span><span class="sxs-lookup"><span data-stu-id="b626d-122">In this scenario, the middle-tier service has no user interaction to obtain the user's consent to access the downstream API.</span></span> <span data-ttu-id="b626d-123">Therefore, the option to grant access to the downstream API is presented upfront as a part of the consent step during authentication.</span><span class="sxs-lookup"><span data-stu-id="b626d-123">Therefore, the option to grant access to the downstream API is presented upfront as a part of the consent step during authentication.</span></span>
>

## <a name="service-to-service-access-token-request"></a><span data-ttu-id="b626d-124">Service to service access token request</span><span class="sxs-lookup"><span data-stu-id="b626d-124">Service to service access token request</span></span>
<span data-ttu-id="b626d-125">To request an access token, make an HTTP POST to the tenant-specific Azure AD v2.0 endpoint with the following parameters.</span><span class="sxs-lookup"><span data-stu-id="b626d-125">To request an access token, make an HTTP POST to the tenant-specific Azure AD v2.0 endpoint with the following parameters.</span></span>

```
https://login.microsoftonline.com/<tenant>/oauth2/v2.0/token
```

<span data-ttu-id="b626d-126">There are two cases depending on whether the client application chooses to be secured by a shared secret, or a certificate.</span><span class="sxs-lookup"><span data-stu-id="b626d-126">There are two cases depending on whether the client application chooses to be secured by a shared secret, or a certificate.</span></span>

### <a name="first-case-access-token-request-with-a-shared-secret"></a><span data-ttu-id="b626d-127">First case: Access token request with a shared secret</span><span class="sxs-lookup"><span data-stu-id="b626d-127">First case: Access token request with a shared secret</span></span>
<span data-ttu-id="b626d-128">When using a shared secret, a service-to-service access token request contains the following parameters:</span><span class="sxs-lookup"><span data-stu-id="b626d-128">When using a shared secret, a service-to-service access token request contains the following parameters:</span></span>

| <span data-ttu-id="b626d-129">Parameter</span><span class="sxs-lookup"><span data-stu-id="b626d-129">Parameter</span></span> |  | <span data-ttu-id="b626d-130">Description</span><span class="sxs-lookup"><span data-stu-id="b626d-130">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="b626d-131">grant_type</span><span class="sxs-lookup"><span data-stu-id="b626d-131">grant_type</span></span> |<span data-ttu-id="b626d-132">required</span><span class="sxs-lookup"><span data-stu-id="b626d-132">required</span></span> | <span data-ttu-id="b626d-133">The type of the token request.</span><span class="sxs-lookup"><span data-stu-id="b626d-133">The type of the token request.</span></span> <span data-ttu-id="b626d-134">For a request using a JWT, the value must be **urn:ietf:params:oauth:grant-type:jwt-bearer**.</span><span class="sxs-lookup"><span data-stu-id="b626d-134">For a request using a JWT, the value must be **urn:ietf:params:oauth:grant-type:jwt-bearer**.</span></span> |
| <span data-ttu-id="b626d-135">client_id</span><span class="sxs-lookup"><span data-stu-id="b626d-135">client_id</span></span> |<span data-ttu-id="b626d-136">required</span><span class="sxs-lookup"><span data-stu-id="b626d-136">required</span></span> | <span data-ttu-id="b626d-137">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span><span class="sxs-lookup"><span data-stu-id="b626d-137">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="b626d-138">client_secret</span><span class="sxs-lookup"><span data-stu-id="b626d-138">client_secret</span></span> |<span data-ttu-id="b626d-139">required</span><span class="sxs-lookup"><span data-stu-id="b626d-139">required</span></span> | <span data-ttu-id="b626d-140">The Application secret that you generated for your app in the Application Registration Portal.</span><span class="sxs-lookup"><span data-stu-id="b626d-140">The Application secret that you generated for your app in the Application Registration Portal.</span></span> |
| <span data-ttu-id="b626d-141">assertion</span><span class="sxs-lookup"><span data-stu-id="b626d-141">assertion</span></span> |<span data-ttu-id="b626d-142">required</span><span class="sxs-lookup"><span data-stu-id="b626d-142">required</span></span> | <span data-ttu-id="b626d-143">The value of the token used in the request.</span><span class="sxs-lookup"><span data-stu-id="b626d-143">The value of the token used in the request.</span></span> |
| <span data-ttu-id="b626d-144">scope</span><span class="sxs-lookup"><span data-stu-id="b626d-144">scope</span></span> |<span data-ttu-id="b626d-145">required</span><span class="sxs-lookup"><span data-stu-id="b626d-145">required</span></span> | <span data-ttu-id="b626d-146">A space separated list of scopes for the token request.</span><span class="sxs-lookup"><span data-stu-id="b626d-146">A space separated list of scopes for the token request.</span></span> <span data-ttu-id="b626d-147">For more information, see [scopes](v2-permissions-and-consent.md).</span><span class="sxs-lookup"><span data-stu-id="b626d-147">For more information, see [scopes](v2-permissions-and-consent.md).</span></span>|
| <span data-ttu-id="b626d-148">requested_token_use</span><span class="sxs-lookup"><span data-stu-id="b626d-148">requested_token_use</span></span> |<span data-ttu-id="b626d-149">required</span><span class="sxs-lookup"><span data-stu-id="b626d-149">required</span></span> | <span data-ttu-id="b626d-150">Specifies how the request should be processed.</span><span class="sxs-lookup"><span data-stu-id="b626d-150">Specifies how the request should be processed.</span></span> <span data-ttu-id="b626d-151">In the On-Behalf-Of flow, the value must be **on_behalf_of**.</span><span class="sxs-lookup"><span data-stu-id="b626d-151">In the On-Behalf-Of flow, the value must be **on_behalf_of**.</span></span> |

#### <a name="example"></a><span data-ttu-id="b626d-152">Example</span><span class="sxs-lookup"><span data-stu-id="b626d-152">Example</span></span>
<span data-ttu-id="b626d-153">The following HTTP POST requests an access token and refresh token with `user.read` scope for the https://graph.microsoft.com web API.</span><span class="sxs-lookup"><span data-stu-id="b626d-153">The following HTTP POST requests an access token and refresh token with `user.read` scope for the https://graph.microsoft.com web API.</span></span>

```
//line breaks for legibility only

POST /oauth2/v2.0/token HTTP/1.1
Host: login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer
&client_id=2846f71b-a7a4-4987-bab3-760035b2f389
&client_secret=BYyVnAt56JpLwUcyo47XODd
&assertion=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6InowMzl6ZHNGdWl6cEJmQlZLMVRuMjVRSFlPMCJ9.eyJhdWQiOiIyODQ2ZjcxYi1hN2E0LTQ5ODctYmFiMy03NjAwMzViMmYzODkiLCJpc3MiOiJodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vNzJmOTg4YmYtODZmMS00MWFmLTkxYWItMmQ3Y2QwMTFkYjQ3L3YyLjAiLCJpYXQiOjE0OTM5MjA5MTYsIm5iZiI6MTQ5MzkyMDkxNiwiZXhwIjoxNDkzOTI0ODE2LCJhaW8iOiJBU1FBMi84REFBQUFnZm8vNk9CR0NaaFV2NjJ6MFFYSEZKR0VVYUIwRUlIV3NhcGducndMMnVrPSIsIm5hbWUiOiJOYXZ5YSBDYW51bWFsbGEiLCJvaWQiOiJkNWU5NzljNy0zZDJkLTQyYWYtOGYzMC03MjdkZDRjMmQzODMiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJuYWNhbnVtYUBtaWNyb3NvZnQuY29tIiwic3ViIjoiZ1Q5a1FMN2hXRUpUUGg1OWJlX1l5dVZNRDFOTEdiREJFWFRhbEQzU3FZYyIsInRpZCI6IjcyZjk4OGJmLTg2ZjEtNDFhZi05MWFiLTJkN2NkMDExZGI0NyIsInV0aSI6IjN5U3F4UHJweUVPd0ZsTWFFMU1PQUEiLCJ2ZXIiOiIyLjAifQ.TPPJSvpNCSCyUeIiKQoLMixN1-M-Y5U0QxtxVkpepjyoWNG0i49YFAJC6ADdCs5nJXr6f-ozIRuaiPzy29yRUOdSz_8KqG42luCyC1c951HyeDgqUJSz91Ku150D9kP5B9-2R-jgCerD_VVuxXUdkuPFEl3VEADC_1qkGBiIg0AyLLbz7DTMp5DvmbC09DhrQQiouHQGFSk2TPmksqHm3-b3RgeNM1rJmpLThis2ZWBEIPx662pjxL6NJDmV08cPVIcGX4KkFo54Z3rfwiYg4YssiUc4w-w3NJUBQhnzfTl4_Mtq2d7cVlul9uDzras091vFy32tWkrpa970UvdVfQ
&scope=https://graph.microsoft.com/user.read+offline_access
&requested_token_use=on_behalf_of
```

### <a name="second-case-access-token-request-with-a-certificate"></a><span data-ttu-id="b626d-154">Second case: Access token request with a certificate</span><span class="sxs-lookup"><span data-stu-id="b626d-154">Second case: Access token request with a certificate</span></span>
<span data-ttu-id="b626d-155">A service-to-service access token request with a certificate contains the following parameters:</span><span class="sxs-lookup"><span data-stu-id="b626d-155">A service-to-service access token request with a certificate contains the following parameters:</span></span>

| <span data-ttu-id="b626d-156">Parameter</span><span class="sxs-lookup"><span data-stu-id="b626d-156">Parameter</span></span> |  | <span data-ttu-id="b626d-157">Description</span><span class="sxs-lookup"><span data-stu-id="b626d-157">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="b626d-158">grant_type</span><span class="sxs-lookup"><span data-stu-id="b626d-158">grant_type</span></span> |<span data-ttu-id="b626d-159">required</span><span class="sxs-lookup"><span data-stu-id="b626d-159">required</span></span> | <span data-ttu-id="b626d-160">The type of the token request.</span><span class="sxs-lookup"><span data-stu-id="b626d-160">The type of the token request.</span></span> <span data-ttu-id="b626d-161">For a request using a JWT, the value must be **urn:ietf:params:oauth:grant-type:jwt-bearer**.</span><span class="sxs-lookup"><span data-stu-id="b626d-161">For a request using a JWT, the value must be **urn:ietf:params:oauth:grant-type:jwt-bearer**.</span></span> |
| <span data-ttu-id="b626d-162">client_id</span><span class="sxs-lookup"><span data-stu-id="b626d-162">client_id</span></span> |<span data-ttu-id="b626d-163">required</span><span class="sxs-lookup"><span data-stu-id="b626d-163">required</span></span> | <span data-ttu-id="b626d-164">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span><span class="sxs-lookup"><span data-stu-id="b626d-164">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="b626d-165">client_assertion_type</span><span class="sxs-lookup"><span data-stu-id="b626d-165">client_assertion_type</span></span> |<span data-ttu-id="b626d-166">required</span><span class="sxs-lookup"><span data-stu-id="b626d-166">required</span></span> |<span data-ttu-id="b626d-167">The value must be `urn:ietf:params:oauth:client-assertion-type:jwt-bearer`</span><span class="sxs-lookup"><span data-stu-id="b626d-167">The value must be `urn:ietf:params:oauth:client-assertion-type:jwt-bearer`</span></span> |
| <span data-ttu-id="b626d-168">client_assertion</span><span class="sxs-lookup"><span data-stu-id="b626d-168">client_assertion</span></span> |<span data-ttu-id="b626d-169">required</span><span class="sxs-lookup"><span data-stu-id="b626d-169">required</span></span> | <span data-ttu-id="b626d-170">An assertion (a JSON Web Token) that you need to create and sign with the certificate you registered as credentials for your application.</span><span class="sxs-lookup"><span data-stu-id="b626d-170">An assertion (a JSON Web Token) that you need to create and sign with the certificate you registered as credentials for your application.</span></span> <span data-ttu-id="b626d-171">Read about [certificate credentials](active-directory-certificate-credentials.md) to learn how to register your certificate and the format of the assertion.</span><span class="sxs-lookup"><span data-stu-id="b626d-171">Read about [certificate credentials](active-directory-certificate-credentials.md) to learn how to register your certificate and the format of the assertion.</span></span>|
| <span data-ttu-id="b626d-172">assertion</span><span class="sxs-lookup"><span data-stu-id="b626d-172">assertion</span></span> |<span data-ttu-id="b626d-173">required</span><span class="sxs-lookup"><span data-stu-id="b626d-173">required</span></span> | <span data-ttu-id="b626d-174">The value of the token used in the request.</span><span class="sxs-lookup"><span data-stu-id="b626d-174">The value of the token used in the request.</span></span> |
| <span data-ttu-id="b626d-175">requested_token_use</span><span class="sxs-lookup"><span data-stu-id="b626d-175">requested_token_use</span></span> |<span data-ttu-id="b626d-176">required</span><span class="sxs-lookup"><span data-stu-id="b626d-176">required</span></span> | <span data-ttu-id="b626d-177">Specifies how the request should be processed.</span><span class="sxs-lookup"><span data-stu-id="b626d-177">Specifies how the request should be processed.</span></span> <span data-ttu-id="b626d-178">In the On-Behalf-Of flow, the value must be **on_behalf_of**.</span><span class="sxs-lookup"><span data-stu-id="b626d-178">In the On-Behalf-Of flow, the value must be **on_behalf_of**.</span></span> |
| <span data-ttu-id="b626d-179">scope</span><span class="sxs-lookup"><span data-stu-id="b626d-179">scope</span></span> |<span data-ttu-id="b626d-180">required</span><span class="sxs-lookup"><span data-stu-id="b626d-180">required</span></span> | <span data-ttu-id="b626d-181">A space separated list of scopes for the token request.</span><span class="sxs-lookup"><span data-stu-id="b626d-181">A space separated list of scopes for the token request.</span></span> <span data-ttu-id="b626d-182">For more information, see [scopes](v2-permissions-and-consent.md).</span><span class="sxs-lookup"><span data-stu-id="b626d-182">For more information, see [scopes](v2-permissions-and-consent.md).</span></span>|

<span data-ttu-id="b626d-183">Notice that the parameters are almost the same as in the case of the request by shared secret except that the client_secret parameter is replaced by two parameters: a client_assertion_type and client_assertion.</span><span class="sxs-lookup"><span data-stu-id="b626d-183">Notice that the parameters are almost the same as in the case of the request by shared secret except that the client_secret parameter is replaced by two parameters: a client_assertion_type and client_assertion.</span></span>

#### <a name="example"></a><span data-ttu-id="b626d-184">Example</span><span class="sxs-lookup"><span data-stu-id="b626d-184">Example</span></span>
<span data-ttu-id="b626d-185">The following HTTP POST requests an access token with `user.read` scope for the https://graph.microsoft.com web API with a certificate.</span><span class="sxs-lookup"><span data-stu-id="b626d-185">The following HTTP POST requests an access token with `user.read` scope for the https://graph.microsoft.com web API with a certificate.</span></span>

```
// line breaks for legibility only

POST /oauth2/v2.0/token HTTP/1.1
Host: login.microsoftonline.com
Content-Type: application/x-www-form-urlencoded

grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer
&client_id=625391af-c675-43e5-8e44-edd3e30ceb15
&client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer
&client_assertion=eyJhbGciOiJSUzI1NiIsIng1dCI6Imd4OHRHeXN5amNScUtqRlBuZDdSRnd2d1pJMCJ9.eyJ{a lot of characters here}M8U3bSUKKJDEg
&assertion=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6InowMzl6ZHNGdWl6cEJmQlZLMVRuMjVRSFlPMCIsImtpZCI6InowMzl6ZHNGdWl6cEJmQlZLMVRuMjVRSFlPMCJ9.eyJhdWQiOiJodHRwczovL2Rkb2JhbGlhbm91dGxvb2sub25taWNyb3NvZnQuY29tLzE5MjNmODYyLWU2ZGMtNDFhMy04MWRhLTgwMmJhZTAwYWY2ZCIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0LzI2MDM5Y2NlLTQ4OWQtNDAwMi04MjkzLTViMGM1MTM0ZWFjYi8iLCJpYXQiOjE0OTM0MjMxNTIsIm5iZiI6MTQ5MzQyMzE1MiwiZXhwIjoxNDkzNDY2NjUyLCJhY3IiOiIxIiwiYWlvIjoiWTJaZ1lCRFF2aTlVZEc0LzM0L3dpQndqbjhYeVp4YmR1TFhmVE1QeG8yYlN2elgreHBVQSIsImFtciI6WyJwd2QiXSwiYXBwaWQiOiJiMzE1MDA3OS03YmViLTQxN2YtYTA2YS0zZmRjNzhjMzI1NDUiLCJhcHBpZGFjciI6IjAiLCJlX2V4cCI6MzAyNDAwLCJmYW1pbHlfbmFtZSI6IlRlc3QiLCJnaXZlbl9uYW1lIjoiTmF2eWEiLCJpcGFkZHIiOiIxNjcuMjIwLjEuMTc3IiwibmFtZSI6Ik5hdnlhIFRlc3QiLCJvaWQiOiIxY2Q0YmNhYy1iODA4LTQyM2EtOWUyZi04MjdmYmIxYmI3MzkiLCJwbGF0ZiI6IjMiLCJzY3AiOiJ1c2VyX2ltcGVyc29uYXRpb24iLCJzdWIiOiJEVXpYbkdKMDJIUk0zRW5pbDFxdjZCakxTNUllQy0tQ2ZpbzRxS1MzNEc4IiwidGlkIjoiMjYwMzljY2UtNDg5ZC00MDAyLTgyOTMtNWIwYzUxMzRlYWNiIiwidW5pcXVlX25hbWUiOiJuYXZ5YUBkZG9iYWxpYW5vdXRsb29rLm9ubWljcm9zb2Z0LmNvbSIsInVwbiI6Im5hdnlhQGRkb2JhbGlhbm91dGxvb2sub25taWNyb3NvZnQuY29tIiwidmVyIjoiMS4wIn0.R-Ke-XO7lK0r5uLwxB8g5CrcPAwRln5SccJCfEjU6IUqpqcjWcDzeDdNOySiVPDU_ZU5knJmzRCF8fcjFtPsaA4R7vdIEbDuOur15FXSvE8FvVSjP_49OH6hBYqoSUAslN3FMfbO6Z8YfCIY4tSOB2I6ahQ_x4ZWFWglC3w5mK-_4iX81bqi95eV4RUKefUuHhQDXtWhrSgIEC0YiluMvA4TnaJdLq_tWXIc4_Tq_KfpkvI004ONKgU7EAMEr1wZ4aDcJV2yf22gQ1sCSig6EGSTmmzDuEPsYiyd4NhidRZJP4HiiQh-hePBQsgcSgYGvz9wC6n57ufYKh2wm_Ti3Q
&requested_token_use=on_behalf_of
&scope=https://graph.microsoft.com/user.read+offline_access
```

## <a name="service-to-service-access-token-response"></a><span data-ttu-id="b626d-186">Service to service access token response</span><span class="sxs-lookup"><span data-stu-id="b626d-186">Service to service access token response</span></span>
<span data-ttu-id="b626d-187">A success response is a JSON OAuth 2.0 response with the following parameters.</span><span class="sxs-lookup"><span data-stu-id="b626d-187">A success response is a JSON OAuth 2.0 response with the following parameters.</span></span>

| <span data-ttu-id="b626d-188">Parameter</span><span class="sxs-lookup"><span data-stu-id="b626d-188">Parameter</span></span> | <span data-ttu-id="b626d-189">Description</span><span class="sxs-lookup"><span data-stu-id="b626d-189">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b626d-190">token_type</span><span class="sxs-lookup"><span data-stu-id="b626d-190">token_type</span></span> |<span data-ttu-id="b626d-191">Indicates the token type value.</span><span class="sxs-lookup"><span data-stu-id="b626d-191">Indicates the token type value.</span></span> <span data-ttu-id="b626d-192">The only type that Azure AD supports is **Bearer**.</span><span class="sxs-lookup"><span data-stu-id="b626d-192">The only type that Azure AD supports is **Bearer**.</span></span> <span data-ttu-id="b626d-193">For more information about bearer tokens, see the [OAuth 2.0 Authorization Framework: Bearer Token Usage (RFC 6750)](http://www.rfc-editor.org/rfc/rfc6750.txt).</span><span class="sxs-lookup"><span data-stu-id="b626d-193">For more information about bearer tokens, see the [OAuth 2.0 Authorization Framework: Bearer Token Usage (RFC 6750)](http://www.rfc-editor.org/rfc/rfc6750.txt).</span></span> |
| <span data-ttu-id="b626d-194">scope</span><span class="sxs-lookup"><span data-stu-id="b626d-194">scope</span></span> |<span data-ttu-id="b626d-195">The scope of access granted in the token.</span><span class="sxs-lookup"><span data-stu-id="b626d-195">The scope of access granted in the token.</span></span> |
| <span data-ttu-id="b626d-196">expires_in</span><span class="sxs-lookup"><span data-stu-id="b626d-196">expires_in</span></span> |<span data-ttu-id="b626d-197">The length of time the access token is valid (in seconds).</span><span class="sxs-lookup"><span data-stu-id="b626d-197">The length of time the access token is valid (in seconds).</span></span> |
| <span data-ttu-id="b626d-198">access_token</span><span class="sxs-lookup"><span data-stu-id="b626d-198">access_token</span></span> |<span data-ttu-id="b626d-199">The requested access token.</span><span class="sxs-lookup"><span data-stu-id="b626d-199">The requested access token.</span></span> <span data-ttu-id="b626d-200">The calling service can use this token to authenticate to the receiving service.</span><span class="sxs-lookup"><span data-stu-id="b626d-200">The calling service can use this token to authenticate to the receiving service.</span></span> |
| <span data-ttu-id="b626d-201">refresh_token</span><span class="sxs-lookup"><span data-stu-id="b626d-201">refresh_token</span></span> |<span data-ttu-id="b626d-202">The refresh token for the requested access token.</span><span class="sxs-lookup"><span data-stu-id="b626d-202">The refresh token for the requested access token.</span></span> <span data-ttu-id="b626d-203">The calling service can use this token to request another access token after the current access token expires.</span><span class="sxs-lookup"><span data-stu-id="b626d-203">The calling service can use this token to request another access token after the current access token expires.</span></span> <span data-ttu-id="b626d-204">The refresh token is only provided if the `offline_access` scope was requested.</span><span class="sxs-lookup"><span data-stu-id="b626d-204">The refresh token is only provided if the `offline_access` scope was requested.</span></span>|

### <a name="success-response-example"></a><span data-ttu-id="b626d-205">Success response example</span><span class="sxs-lookup"><span data-stu-id="b626d-205">Success response example</span></span>
<span data-ttu-id="b626d-206">The following example shows a success response to a request for an access token for the https://graph.microsoft.com web API.</span><span class="sxs-lookup"><span data-stu-id="b626d-206">The following example shows a success response to a request for an access token for the https://graph.microsoft.com web API.</span></span>

```
{
  "token_type": "Bearer",
  "scope": "https://graph.microsoft.com/user.read",
  "expires_in": 3269,
  "ext_expires_in": 0,
  "access_token": "eyJ0eXAiOiJKV1QiLCJub25jZSI6IkFRQUJBQUFBQUFCbmZpRy1tQTZOVGFlN0NkV1c3UWZkQ0NDYy0tY0hGa18wZE50MVEtc2loVzRMd2RwQVZISGpnTVdQZ0tQeVJIaGlDbUN2NkdyMEpmYmRfY1RmMUFxU21TcFJkVXVydVJqX3Nqd0JoN211eHlBQSIsImFsZyI6IlJTMjU2IiwieDV0IjoiejAzOXpkc0Z1aXpwQmZCVksxVG4yNVFIWU8wIiwia2lkIjoiejAzOXpkc0Z1aXpwQmZCVksxVG4yNVFIWU8wIn0.eyJhdWQiOiJodHRwczovL2dyYXBoLm1pY3Jvc29mdC5jb20iLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC83MmY5ODhiZi04NmYxLTQxYWYtOTFhYi0yZDdjZDAxMWRiNDcvIiwiaWF0IjoxNDkzOTMwMzA1LCJuYmYiOjE0OTM5MzAzMDUsImV4cCI6MTQ5MzkzMzg3NSwiYWNyIjoiMCIsImFpbyI6IkFTUUEyLzhEQUFBQU9KYnFFWlRNTnEyZFcxYXpKN1RZMDlYeDdOT29EMkJEUlRWMXJ3b2ZRc1k9IiwiYW1yIjpbInB3ZCJdLCJhcHBfZGlzcGxheW5hbWUiOiJUb2RvRG90bmV0T2JvIiwiYXBwaWQiOiIyODQ2ZjcxYi1hN2E0LTQ5ODctYmFiMy03NjAwMzViMmYzODkiLCJhcHBpZGFjciI6IjEiLCJmYW1pbHlfbmFtZSI6IkNhbnVtYWxsYSIsImdpdmVuX25hbWUiOiJOYXZ5YSIsImlwYWRkciI6IjE2Ny4yMjAuMC4xOTkiLCJuYW1lIjoiTmF2eWEgQ2FudW1hbGxhIiwib2lkIjoiZDVlOTc5YzctM2QyZC00MmFmLThmMzAtNzI3ZGQ0YzJkMzgzIiwib25wcmVtX3NpZCI6IlMtMS01LTIxLTIxMjc1MjExODQtMTYwNDAxMjkyMC0xODg3OTI3NTI3LTI2MTE4NDg0IiwicGxhdGYiOiIxNCIsInB1aWQiOiIxMDAzM0ZGRkEwNkQxN0M5Iiwic2NwIjoiVXNlci5SZWFkIiwic3ViIjoibWtMMHBiLXlpMXQ1ckRGd2JTZ1JvTWxrZE52b3UzSjNWNm84UFE3alVCRSIsInRpZCI6IjcyZjk4OGJmLTg2ZjEtNDFhZi05MWFiLTJkN2NkMDExZGI0NyIsInVuaXF1ZV9uYW1lIjoibmFjYW51bWFAbWljcm9zb2Z0LmNvbSIsInVwbiI6Im5hY2FudW1hQG1pY3Jvc29mdC5jb20iLCJ1dGkiOiJWR1ItdmtEZlBFQ2M1dWFDaENRSkFBIiwidmVyIjoiMS4wIn0.cubh1L2VtruiiwF8ut1m9uNBmnUJeYx4x0G30F7CqSpzHj1Sv5DCgNZXyUz3pEiz77G8IfOF0_U5A_02k-xzwdYvtJUYGH3bFISzdqymiEGmdfCIRKl9KMeoo2llGv0ScCniIhr2U1yxTIkIpp092xcdaDt-2_2q_ql1Ha_HtjvTV1f9XR3t7_Id9bR5BqwVX5zPO7JMYDVhUZRx08eqZcC-F3wi0xd_5ND_mavMuxe2wrpF-EZviO3yg0QVRr59tE3AoWl8lSGpVc97vvRCnp4WVRk26jJhYXFPsdk4yWqOKZqzr3IFGyD08WizD_vPSrXcCPbZP3XWaoTUKZSNJg",
  "refresh_token": "OAQABAAAAAABnfiG-mA6NTae7CdWW7QfdAALzDWjw6qSn4GUDfxWzJDZ6lk9qRw4AnqPnvFqnzS3GiikHr5wBM1bV1YyjH3nUeIhKhqJWGwqJFRqs2sE_rqUfz7__3J92JDpi6gDdCZNNaXgreQsH89kLCVNYZeN6kGuFGZrjwxp1wS2JYc97E_3reXBxkHrA09K5aR-WsSKCEjf6WI23FhZMTLhk_ZKOe_nWvcvLj13FyvSrTMZV2cmzyCZDqEHtPVLJgSoASuQlD2NXrfmtcmgWfc3uJSrWLIDSn4FEmVDA63X6EikNp9cllH3Gp7Vzapjlnws1NQ1_Ff5QrmBHp_LKEIwfzVKnLLrQXN0EzP8f6AX6fdVTaeKzm7iw6nH0vkPRpUeLc3q_aNsPzqcTOnFfgng7t2CXUsMAGH5wclAyFCAwL_Cds7KnyDLL7kzOS5AVZ3Mqk2tsPlqopAiHijZaJumdTILDudwKYCFAMpUeUwEf9JmyFjl2eIWPmlbwU7cHKWNvuRCOYVqbsTTpJthwh4PvsL5ov5CawH_TaV8omG_tV6RkziHG9urk9yp2PH9gl7Cv9ATa3Vt3PJWUS8LszjRIAJmyw_EhgHBfYCvEZ8U9PYarvgqrtweLcnlO7BfnnXYEC18z_u5wemAzNBFUje2ttpGtRmRic4AzZ708tBHva2ePJWGX6pgQbiWF8esOrvWjfrrlfOvEn1h6YiBW291M022undMdXzum6t1Y1huwxHPHjCAA"
}
```

> [!NOTE]
> <span data-ttu-id="b626d-207">Notice that the above access token is a V1-formatted token.</span><span class="sxs-lookup"><span data-stu-id="b626d-207">Notice that the above access token is a V1-formatted token.</span></span> <span data-ttu-id="b626d-208">This is because the token is provided based on the resource being accessed.</span><span class="sxs-lookup"><span data-stu-id="b626d-208">This is because the token is provided based on the resource being accessed.</span></span> <span data-ttu-id="b626d-209">The Microsoft Graph requests V1 tokens, so Azure AD produces V1 access tokens when a client requests tokens for Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="b626d-209">The Microsoft Graph requests V1 tokens, so Azure AD produces V1 access tokens when a client requests tokens for Microsoft Graph.</span></span> <span data-ttu-id="b626d-210">Only applications should look at access tokens - clients should not need to inspect them.</span><span class="sxs-lookup"><span data-stu-id="b626d-210">Only applications should look at access tokens - clients should not need to inspect them.</span></span> 


### <a name="error-response-example"></a><span data-ttu-id="b626d-211">Error response example</span><span class="sxs-lookup"><span data-stu-id="b626d-211">Error response example</span></span>
<span data-ttu-id="b626d-212">An error response is returned by Azure AD token endpoint when trying to acquire an access token for the downstream API, if the downstream API has a conditional access policy such as multi-factor authentication set on it.</span><span class="sxs-lookup"><span data-stu-id="b626d-212">An error response is returned by Azure AD token endpoint when trying to acquire an access token for the downstream API, if the downstream API has a conditional access policy such as multi-factor authentication set on it.</span></span> <span data-ttu-id="b626d-213">The middle-tier service should surface this error to the client application so that the client application can provide the user interaction to satisfy the conditional access policy.</span><span class="sxs-lookup"><span data-stu-id="b626d-213">The middle-tier service should surface this error to the client application so that the client application can provide the user interaction to satisfy the conditional access policy.</span></span>

```
{
    "error":"interaction_required",
    "error_description":"AADSTS50079: Due to a configuration change made by your administrator, or because you moved to a new location, you must enroll in multi-factor authentication to access 'bf8d80f9-9098-4972-b203-500f535113b1'.\r\nTrace ID: b72a68c3-0926-4b8e-bc35-3150069c2800\r\nCorrelation ID: 73d656cf-54b1-4eb2-b429-26d8165a52d7\r\nTimestamp: 2017-05-01 22:43:20Z",
    "error_codes":[50079],
    "timestamp":"2017-05-01 22:43:20Z",
    "trace_id":"b72a68c3-0926-4b8e-bc35-3150069c2800",
    "correlation_id":"73d656cf-54b1-4eb2-b429-26d8165a52d7",
    "claims":"{\"access_token\":{\"polids\":{\"essential\":true,\"values\":[\"9ab03e19-ed42-4168-b6b7-7001fb3e933a\"]}}}"
}
```

## <a name="use-the-access-token-to-access-the-secured-resource"></a><span data-ttu-id="b626d-214">Use the access token to access the secured resource</span><span class="sxs-lookup"><span data-stu-id="b626d-214">Use the access token to access the secured resource</span></span>
<span data-ttu-id="b626d-215">Now the middle-tier service can use the token acquired above to make authenticated requests to the downstream web API, by setting the token in the `Authorization` header.</span><span class="sxs-lookup"><span data-stu-id="b626d-215">Now the middle-tier service can use the token acquired above to make authenticated requests to the downstream web API, by setting the token in the `Authorization` header.</span></span>

### <a name="example"></a><span data-ttu-id="b626d-216">Example</span><span class="sxs-lookup"><span data-stu-id="b626d-216">Example</span></span>
```
GET /v1.0/me HTTP/1.1
Host: graph.microsoft.com
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJub25jZSI6IkFRQUJBQUFBQUFCbmZpRy1tQTZOVGFlN0NkV1c3UWZkSzdNN0RyNXlvUUdLNmFEc19vdDF3cEQyZjNqRkxiNlVrcm9PcXA2cXBJclAxZVV0QktzMHEza29HN3RzXzJpSkYtQjY1UV8zVGgzSnktUHZsMjkxaFNBQSIsImFsZyI6IlJTMjU2IiwieDV0IjoiejAzOXpkc0Z1aXpwQmZCVksxVG4yNVFIWU8wIiwia2lkIjoiejAzOXpkc0Z1aXpwQmZCVksxVG4yNVFIWU8wIn0.eyJhdWQiOiJodHRwczovL2dyYXBoLm1pY3Jvc29mdC5jb20iLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC83MmY5ODhiZi04NmYxLTQxYWYtOTFhYi0yZDdjZDAxMWRiNDcvIiwiaWF0IjoxNDkzOTMwMDE2LCJuYmYiOjE0OTM5MzAwMTYsImV4cCI6MTQ5MzkzMzg3NSwiYWNyIjoiMCIsImFpbyI6IkFTUUEyLzhEQUFBQUlzQjN5ZUljNkZ1aEhkd1YxckoxS1dlbzJPckZOUUQwN2FENTVjUVRtems9IiwiYW1yIjpbInB3ZCJdLCJhcHBfZGlzcGxheW5hbWUiOiJUb2RvRG90bmV0T2JvIiwiYXBwaWQiOiIyODQ2ZjcxYi1hN2E0LTQ5ODctYmFiMy03NjAwMzViMmYzODkiLCJhcHBpZGFjciI6IjEiLCJmYW1pbHlfbmFtZSI6IkNhbnVtYWxsYSIsImdpdmVuX25hbWUiOiJOYXZ5YSIsImlwYWRkciI6IjE2Ny4yMjAuMC4xOTkiLCJuYW1lIjoiTmF2eWEgQ2FudW1hbGxhIiwib2lkIjoiZDVlOTc5YzctM2QyZC00MmFmLThmMzAtNzI3ZGQ0YzJkMzgzIiwib25wcmVtX3NpZCI6IlMtMS01LTIxLTIxMjc1MjExODQtMTYwNDAxMjkyMC0xODg3OTI3NTI3LTI2MTE4NDg0IiwicGxhdGYiOiIxNCIsInB1aWQiOiIxMDAzM0ZGRkEwNkQxN0M5Iiwic2NwIjoiVXNlci5SZWFkIiwic3ViIjoibWtMMHBiLXlpMXQ1ckRGd2JTZ1JvTWxrZE52b3UzSjNWNm84UFE3alVCRSIsInRpZCI6IjcyZjk4OGJmLTg2ZjEtNDFhZi05MWFiLTJkN2NkMDExZGI0NyIsInVuaXF1ZV9uYW1lIjoibmFjYW51bWFAbWljcm9zb2Z0LmNvbSIsInVwbiI6Im5hY2FudW1hQG1pY3Jvc29mdC5jb20iLCJ1dGkiOiJzUVlVekYxdUVVS0NQS0dRTVFVRkFBIiwidmVyIjoiMS4wIn0.Hrn__RGi-HMAzYRyCqX3kBGb6OS7z7y49XPVPpwK_7rJ6nik9E4s6PNY4XkIamJYn7tphpmsHdfM9lQ1gqeeFvFGhweIACsNBWhJ9Nx4dvQnGRkqZ17KnF_wf_QLcyOrOWpUxdSD_oPKcPS-Qr5AFkjw0t7GOKLY-Xw3QLJhzeKmYuuOkmMDJDAl0eNDbH0HiCh3g189a176BfyaR0MgK8wrXI_6MTnFSVfBePqklQeLhcr50YTBfWg3Svgl6MuK_g1hOuaO-XpjUxpdv5dZ0SvI47fAuVDdpCE48igCX5VMj4KUVytDIf6T78aIXMkYHGgW3-xAmuSyYH_Fr0yVAQ
```

## <a name="client-limitations"></a><span data-ttu-id="b626d-217">Client limitations</span><span class="sxs-lookup"><span data-stu-id="b626d-217">Client limitations</span></span>
<span data-ttu-id="b626d-218">If a client uses the implicit flow to get an id_token, and that client also has wildcards in a reply URL, the id_token cannot be used for an OBO flow.</span><span class="sxs-lookup"><span data-stu-id="b626d-218">If a client uses the implicit flow to get an id_token, and that client also has wildcards in a reply URL, the id_token cannot be used for an OBO flow.</span></span>  <span data-ttu-id="b626d-219">However, access tokens acquired via the implicit grant flow can still be redeemed by a confidential client even if the initiating client has a wildcard reply URL registered.</span><span class="sxs-lookup"><span data-stu-id="b626d-219">However, access tokens acquired via the implicit grant flow can still be redeemed by a confidential client even if the initiating client has a wildcard reply URL registered.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="b626d-220">Next steps</span><span class="sxs-lookup"><span data-stu-id="b626d-220">Next steps</span></span>
<span data-ttu-id="b626d-221">Learn more about the OAuth 2.0 protocol and another way to perform service to service auth using client credentials.</span><span class="sxs-lookup"><span data-stu-id="b626d-221">Learn more about the OAuth 2.0 protocol and another way to perform service to service auth using client credentials.</span></span>
* [<span data-ttu-id="b626d-222">OAuth 2.0 client credentials grant in Azure AD v2.0</span><span class="sxs-lookup"><span data-stu-id="b626d-222">OAuth 2.0 client credentials grant in Azure AD v2.0</span></span>](v2-oauth2-client-creds-grant-flow.md)
* [<span data-ttu-id="b626d-223">OAuth 2.0 in Azure AD v2.0</span><span class="sxs-lookup"><span data-stu-id="b626d-223">OAuth 2.0 in Azure AD v2.0</span></span>](v2-oauth2-auth-code-flow.md)
