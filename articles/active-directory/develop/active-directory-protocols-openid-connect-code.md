---
title: Understand the OpenID Connect authentication code flow in Azure AD | Microsoft Docs
description: This article describes how to use HTTP messages to authorize access to web applications and web APIs in your tenant using Azure Active Directory and OpenID Connect.
services: active-directory
documentationcenter: .net
author: priyamohanram
manager: mbaldwin
editor: ''
ms.assetid: 29142f7e-d862-4076-9a1a-ecae5bcd9d9b
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/08/2017
ms.author: priyamo
ms.openlocfilehash: 7ac5fbb8f62b90a3c1ff83cee851e69b71e52ea3
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44671726"
---
# <a name="authorize-access-to-web-applications-using-openid-connect-and-azure-active-directory"></a><span data-ttu-id="1b1ad-103">Authorize access to web applications using OpenID Connect and Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="1b1ad-103">Authorize access to web applications using OpenID Connect and Azure Active Directory</span></span>
<span data-ttu-id="1b1ad-104">[OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) is a simple identity layer built on top of the OAuth 2.0 protocol.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-104">[OpenID Connect](http://openid.net/specs/openid-connect-core-1_0.html) is a simple identity layer built on top of the OAuth 2.0 protocol.</span></span> <span data-ttu-id="1b1ad-105">OAuth 2.0 defines mechanisms to obtain and use **access tokens** to access protected resources, but they do not define standard methods to provide identity information.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-105">OAuth 2.0 defines mechanisms to obtain and use **access tokens** to access protected resources, but they do not define standard methods to provide identity information.</span></span> <span data-ttu-id="1b1ad-106">OpenID Connect implements authentication as an extension to the OAuth 2.0 authorization process.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-106">OpenID Connect implements authentication as an extension to the OAuth 2.0 authorization process.</span></span> <span data-ttu-id="1b1ad-107">It provides information about the end user in the form of an `id_token` that verifies the identity of the user and provides basic profile information about the user.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-107">It provides information about the end user in the form of an `id_token` that verifies the identity of the user and provides basic profile information about the user.</span></span>

<span data-ttu-id="1b1ad-108">OpenID Connect is our recommendation if you are building a web application that is hosted on a server and accessed via a browser.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-108">OpenID Connect is our recommendation if you are building a web application that is hosted on a server and accessed via a browser.</span></span>


[!INCLUDE [active-directory-protocols-getting-started](../../../includes/active-directory-protocols-getting-started.md)] 

## <a name="authentication-flow-using-openid-connect"></a><span data-ttu-id="1b1ad-109">Authentication flow using OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="1b1ad-109">Authentication flow using OpenID Connect</span></span>
<span data-ttu-id="1b1ad-110">The most basic sign-in flow contains the following steps - each of them is described in detail below.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-110">The most basic sign-in flow contains the following steps - each of them is described in detail below.</span></span>

![OpenId Connect Authentication Flow](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/develop/media/active-directory-protocols-openid-connect-code/active-directory-oauth-code-flow-web-app.png)

## <a name="openid-connect-metadata-document"></a><span data-ttu-id="1b1ad-112">OpenID Connect metadata document</span><span class="sxs-lookup"><span data-stu-id="1b1ad-112">OpenID Connect metadata document</span></span>

<span data-ttu-id="1b1ad-113">OpenID Connect describes a metadata document that contains most of the information required for an app to perform sign-in.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-113">OpenID Connect describes a metadata document that contains most of the information required for an app to perform sign-in.</span></span> <span data-ttu-id="1b1ad-114">This includes information such as the URLs to use and the location of the service's public signing keys.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-114">This includes information such as the URLs to use and the location of the service's public signing keys.</span></span> <span data-ttu-id="1b1ad-115">The OpenID Connect metadata document can be found at:</span><span class="sxs-lookup"><span data-stu-id="1b1ad-115">The OpenID Connect metadata document can be found at:</span></span>

```
https://login.microsoftonline.com/{tenant}/.well-known/openid-configuration
```
<span data-ttu-id="1b1ad-116">The metadata is a simple JavaScript Object Notation (JSON) document.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-116">The metadata is a simple JavaScript Object Notation (JSON) document.</span></span> <span data-ttu-id="1b1ad-117">See the following snippet for an example.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-117">See the following snippet for an example.</span></span> <span data-ttu-id="1b1ad-118">The snippet's contents are fully described in the [OpenID Connect specification](https://openid.net).</span><span class="sxs-lookup"><span data-stu-id="1b1ad-118">The snippet's contents are fully described in the [OpenID Connect specification](https://openid.net).</span></span>

```
{
    "authorization_endpoint": "https://login.microsoftonline.com/common/oauth2/authorize",
    "token_endpoint": "https://login.microsoftonline.com/common/oauth2/token",
    "token_endpoint_auth_methods_supported":
    [
        "client_secret_post",
        "private_key_jwt"
    ],
    "jwks_uri": "https://login.microsoftonline.com/common/discovery/keys"
    
    ...
}
```

## <a name="send-the-sign-in-request"></a><span data-ttu-id="1b1ad-119">Send the sign-in request</span><span class="sxs-lookup"><span data-stu-id="1b1ad-119">Send the sign-in request</span></span>
<span data-ttu-id="1b1ad-120">When your web application needs to authenticate the user, it must direct the user to the `/authorize` endpoint.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-120">When your web application needs to authenticate the user, it must direct the user to the `/authorize` endpoint.</span></span> <span data-ttu-id="1b1ad-121">This request is similar to the first leg of the [OAuth 2.0 Authorization Code Flow](active-directory-protocols-oauth-code.md), with a few important distinctions:</span><span class="sxs-lookup"><span data-stu-id="1b1ad-121">This request is similar to the first leg of the [OAuth 2.0 Authorization Code Flow](active-directory-protocols-oauth-code.md), with a few important distinctions:</span></span>

* <span data-ttu-id="1b1ad-122">The request must include the scope `openid` in the `scope` parameter.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-122">The request must include the scope `openid` in the `scope` parameter.</span></span>
* <span data-ttu-id="1b1ad-123">The `response_type` parameter must include `id_token`.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-123">The `response_type` parameter must include `id_token`.</span></span>
* <span data-ttu-id="1b1ad-124">The request must include the `nonce` parameter.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-124">The request must include the `nonce` parameter.</span></span>

<span data-ttu-id="1b1ad-125">So a sample request would look like this:</span><span class="sxs-lookup"><span data-stu-id="1b1ad-125">So a sample request would look like this:</span></span>

```
// Line breaks for legibility only

GET https://login.microsoftonline.com/{tenant}/oauth2/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=id_token
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=form_post
&scope=openid
&state=12345
&nonce=7362CAEA-9CA5-4B43-9BA3-34D7C303EBA7
```

| <span data-ttu-id="1b1ad-126">Parameter</span><span class="sxs-lookup"><span data-stu-id="1b1ad-126">Parameter</span></span> |  | <span data-ttu-id="1b1ad-127">Description</span><span class="sxs-lookup"><span data-stu-id="1b1ad-127">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="1b1ad-128">tenant</span><span class="sxs-lookup"><span data-stu-id="1b1ad-128">tenant</span></span> |<span data-ttu-id="1b1ad-129">required</span><span class="sxs-lookup"><span data-stu-id="1b1ad-129">required</span></span> |<span data-ttu-id="1b1ad-130">The `{tenant}` value in the path of the request can be used to control who can sign into the application.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-130">The `{tenant}` value in the path of the request can be used to control who can sign into the application.</span></span>  <span data-ttu-id="1b1ad-131">The allowed values are tenant identifiers, for example, `8eaef023-2b34-4da1-9baa-8bc8c9d6a490` or `contoso.onmicrosoft.com` or `common` for tenant-independent tokens</span><span class="sxs-lookup"><span data-stu-id="1b1ad-131">The allowed values are tenant identifiers, for example, `8eaef023-2b34-4da1-9baa-8bc8c9d6a490` or `contoso.onmicrosoft.com` or `common` for tenant-independent tokens</span></span> |
| <span data-ttu-id="1b1ad-132">client_id</span><span class="sxs-lookup"><span data-stu-id="1b1ad-132">client_id</span></span> |<span data-ttu-id="1b1ad-133">required</span><span class="sxs-lookup"><span data-stu-id="1b1ad-133">required</span></span> |<span data-ttu-id="1b1ad-134">The Application Id assigned to your app when you registered it with Azure AD.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-134">The Application Id assigned to your app when you registered it with Azure AD.</span></span> <span data-ttu-id="1b1ad-135">You can find this in the Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-135">You can find this in the Azure Portal.</span></span> <span data-ttu-id="1b1ad-136">Click **Azure Active Directory**, click **App Registrations**, choose the application and locate the Application Id on the application page.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-136">Click **Azure Active Directory**, click **App Registrations**, choose the application and locate the Application Id on the application page.</span></span> |
| <span data-ttu-id="1b1ad-137">response_type</span><span class="sxs-lookup"><span data-stu-id="1b1ad-137">response_type</span></span> |<span data-ttu-id="1b1ad-138">required</span><span class="sxs-lookup"><span data-stu-id="1b1ad-138">required</span></span> |<span data-ttu-id="1b1ad-139">Must include `id_token` for OpenID Connect sign-in.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-139">Must include `id_token` for OpenID Connect sign-in.</span></span>  <span data-ttu-id="1b1ad-140">It may also include other response_types, such as `code`.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-140">It may also include other response_types, such as `code`.</span></span> |
| <span data-ttu-id="1b1ad-141">scope</span><span class="sxs-lookup"><span data-stu-id="1b1ad-141">scope</span></span> |<span data-ttu-id="1b1ad-142">required</span><span class="sxs-lookup"><span data-stu-id="1b1ad-142">required</span></span> |<span data-ttu-id="1b1ad-143">A space-separated list of scopes.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-143">A space-separated list of scopes.</span></span>  <span data-ttu-id="1b1ad-144">For OpenID Connect, it must include the scope `openid`, which translates to the "Sign you in" permission in the consent UI.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-144">For OpenID Connect, it must include the scope `openid`, which translates to the "Sign you in" permission in the consent UI.</span></span>  <span data-ttu-id="1b1ad-145">You may also include other scopes in this request for requesting consent.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-145">You may also include other scopes in this request for requesting consent.</span></span> |
| <span data-ttu-id="1b1ad-146">nonce</span><span class="sxs-lookup"><span data-stu-id="1b1ad-146">nonce</span></span> |<span data-ttu-id="1b1ad-147">required</span><span class="sxs-lookup"><span data-stu-id="1b1ad-147">required</span></span> |<span data-ttu-id="1b1ad-148">A value included in the request, generated by the app, that is included in the resulting `id_token` as a claim.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-148">A value included in the request, generated by the app, that is included in the resulting `id_token` as a claim.</span></span>  <span data-ttu-id="1b1ad-149">The app can then verify this value to mitigate token replay attacks.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-149">The app can then verify this value to mitigate token replay attacks.</span></span>  <span data-ttu-id="1b1ad-150">The value is typically a randomized, unique string or GUID that can be used to identify the origin of the request.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-150">The value is typically a randomized, unique string or GUID that can be used to identify the origin of the request.</span></span> |
| <span data-ttu-id="1b1ad-151">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="1b1ad-151">redirect_uri</span></span> |<span data-ttu-id="1b1ad-152">recommended</span><span class="sxs-lookup"><span data-stu-id="1b1ad-152">recommended</span></span> |<span data-ttu-id="1b1ad-153">The redirect_uri of your app, where authentication responses can be sent and received by your app.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-153">The redirect_uri of your app, where authentication responses can be sent and received by your app.</span></span>  <span data-ttu-id="1b1ad-154">It must exactly match one of the redirect_uris you registered in the portal, except it must be url encoded.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-154">It must exactly match one of the redirect_uris you registered in the portal, except it must be url encoded.</span></span> |
| <span data-ttu-id="1b1ad-155">response_mode</span><span class="sxs-lookup"><span data-stu-id="1b1ad-155">response_mode</span></span> |<span data-ttu-id="1b1ad-156">recommended</span><span class="sxs-lookup"><span data-stu-id="1b1ad-156">recommended</span></span> |<span data-ttu-id="1b1ad-157">Specifies the method that should be used to send the resulting authorization_code back to your app.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-157">Specifies the method that should be used to send the resulting authorization_code back to your app.</span></span>  <span data-ttu-id="1b1ad-158">Supported values are `form_post` for *HTTP form post* or `fragment` for *URL fragment*.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-158">Supported values are `form_post` for *HTTP form post* or `fragment` for *URL fragment*.</span></span>  <span data-ttu-id="1b1ad-159">For web applications, we recommend using `response_mode=form_post` to ensure the most secure transfer of tokens to your application.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-159">For web applications, we recommend using `response_mode=form_post` to ensure the most secure transfer of tokens to your application.</span></span> |
| <span data-ttu-id="1b1ad-160">state</span><span class="sxs-lookup"><span data-stu-id="1b1ad-160">state</span></span> |<span data-ttu-id="1b1ad-161">recommended</span><span class="sxs-lookup"><span data-stu-id="1b1ad-161">recommended</span></span> |<span data-ttu-id="1b1ad-162">A value included in the request that is returned in the token response.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-162">A value included in the request that is returned in the token response.</span></span>  <span data-ttu-id="1b1ad-163">It can be a string of any content that you wish.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-163">It can be a string of any content that you wish.</span></span>  <span data-ttu-id="1b1ad-164">A randomly generated unique value is typically used for [preventing cross-site request forgery attacks](http://tools.ietf.org/html/rfc6749#section-10.12).</span><span class="sxs-lookup"><span data-stu-id="1b1ad-164">A randomly generated unique value is typically used for [preventing cross-site request forgery attacks](http://tools.ietf.org/html/rfc6749#section-10.12).</span></span>  <span data-ttu-id="1b1ad-165">The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-165">The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |
| <span data-ttu-id="1b1ad-166">prompt</span><span class="sxs-lookup"><span data-stu-id="1b1ad-166">prompt</span></span> |<span data-ttu-id="1b1ad-167">optional</span><span class="sxs-lookup"><span data-stu-id="1b1ad-167">optional</span></span> |<span data-ttu-id="1b1ad-168">Indicates the type of user interaction that is required.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-168">Indicates the type of user interaction that is required.</span></span>  <span data-ttu-id="1b1ad-169">Currently, the only valid values are 'login', 'none', and 'consent'.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-169">Currently, the only valid values are 'login', 'none', and 'consent'.</span></span>  <span data-ttu-id="1b1ad-170">`prompt=login` forces the user to enter their credentials on that request, negating single-sign on.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-170">`prompt=login` forces the user to enter their credentials on that request, negating single-sign on.</span></span>  <span data-ttu-id="1b1ad-171">`prompt=none` is the opposite - it ensures that the user is not presented with any interactive prompt whatsoever.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-171">`prompt=none` is the opposite - it ensures that the user is not presented with any interactive prompt whatsoever.</span></span>  <span data-ttu-id="1b1ad-172">If the request cannot be completed silently via single-sign on, the endpoint returns an error.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-172">If the request cannot be completed silently via single-sign on, the endpoint returns an error.</span></span>  <span data-ttu-id="1b1ad-173">`prompt=consent` triggers the OAuth consent dialog after the user signs in, asking the user to grant permissions to the app.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-173">`prompt=consent` triggers the OAuth consent dialog after the user signs in, asking the user to grant permissions to the app.</span></span> |
| <span data-ttu-id="1b1ad-174">login_hint</span><span class="sxs-lookup"><span data-stu-id="1b1ad-174">login_hint</span></span> |<span data-ttu-id="1b1ad-175">optional</span><span class="sxs-lookup"><span data-stu-id="1b1ad-175">optional</span></span> |<span data-ttu-id="1b1ad-176">Can be used to pre-fill the username/email address field of the sign-in page for the user, if you know their username ahead of time.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-176">Can be used to pre-fill the username/email address field of the sign-in page for the user, if you know their username ahead of time.</span></span>  <span data-ttu-id="1b1ad-177">Often apps use this parameter during reauthentication, having already extracted the username from a previous sign-in using the `preferred_username` claim.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-177">Often apps use this parameter during reauthentication, having already extracted the username from a previous sign-in using the `preferred_username` claim.</span></span> |

<span data-ttu-id="1b1ad-178">At this point, the user is asked to enter their credentials and complete the authentication.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-178">At this point, the user is asked to enter their credentials and complete the authentication.</span></span>

### <a name="sample-response"></a><span data-ttu-id="1b1ad-179">Sample response</span><span class="sxs-lookup"><span data-stu-id="1b1ad-179">Sample response</span></span>
<span data-ttu-id="1b1ad-180">A sample response, after the user has authenticated, could look like this:</span><span class="sxs-lookup"><span data-stu-id="1b1ad-180">A sample response, after the user has authenticated, could look like this:</span></span>

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNB...&state=12345
```

| <span data-ttu-id="1b1ad-181">Parameter</span><span class="sxs-lookup"><span data-stu-id="1b1ad-181">Parameter</span></span> | <span data-ttu-id="1b1ad-182">Description</span><span class="sxs-lookup"><span data-stu-id="1b1ad-182">Description</span></span> |
| --- | --- |
| <span data-ttu-id="1b1ad-183">id_token</span><span class="sxs-lookup"><span data-stu-id="1b1ad-183">id_token</span></span> |<span data-ttu-id="1b1ad-184">The `id_token` that the app requested.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-184">The `id_token` that the app requested.</span></span> <span data-ttu-id="1b1ad-185">You can use the `id_token` to verify the user's identity and begin a session with the user.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-185">You can use the `id_token` to verify the user's identity and begin a session with the user.</span></span> |
| <span data-ttu-id="1b1ad-186">state</span><span class="sxs-lookup"><span data-stu-id="1b1ad-186">state</span></span> |<span data-ttu-id="1b1ad-187">A value included in the request that is also returned in the token response.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-187">A value included in the request that is also returned in the token response.</span></span> <span data-ttu-id="1b1ad-188">A randomly generated unique value is typically used for [preventing cross-site request forgery attacks](http://tools.ietf.org/html/rfc6749#section-10.12).</span><span class="sxs-lookup"><span data-stu-id="1b1ad-188">A randomly generated unique value is typically used for [preventing cross-site request forgery attacks](http://tools.ietf.org/html/rfc6749#section-10.12).</span></span>  <span data-ttu-id="1b1ad-189">The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-189">The state is also used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |

### <a name="error-response"></a><span data-ttu-id="1b1ad-190">Error response</span><span class="sxs-lookup"><span data-stu-id="1b1ad-190">Error response</span></span>
<span data-ttu-id="1b1ad-191">Error responses may also be sent to the `redirect_uri` so the app can handle them appropriately:</span><span class="sxs-lookup"><span data-stu-id="1b1ad-191">Error responses may also be sent to the `redirect_uri` so the app can handle them appropriately:</span></span>

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

error=access_denied&error_description=the+user+canceled+the+authentication
```

| <span data-ttu-id="1b1ad-192">Parameter</span><span class="sxs-lookup"><span data-stu-id="1b1ad-192">Parameter</span></span> | <span data-ttu-id="1b1ad-193">Description</span><span class="sxs-lookup"><span data-stu-id="1b1ad-193">Description</span></span> |
| --- | --- |
| <span data-ttu-id="1b1ad-194">error</span><span class="sxs-lookup"><span data-stu-id="1b1ad-194">error</span></span> |<span data-ttu-id="1b1ad-195">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-195">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="1b1ad-196">error_description</span><span class="sxs-lookup"><span data-stu-id="1b1ad-196">error_description</span></span> |<span data-ttu-id="1b1ad-197">A specific error message that can help a developer identify the root cause of an authentication error.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-197">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |

#### <a name="error-codes-for-authorization-endpoint-errors"></a><span data-ttu-id="1b1ad-198">Error codes for authorization endpoint errors</span><span class="sxs-lookup"><span data-stu-id="1b1ad-198">Error codes for authorization endpoint errors</span></span>
<span data-ttu-id="1b1ad-199">The following table describes the various error codes that can be returned in the `error` parameter of the error response.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-199">The following table describes the various error codes that can be returned in the `error` parameter of the error response.</span></span>

| <span data-ttu-id="1b1ad-200">Error Code</span><span class="sxs-lookup"><span data-stu-id="1b1ad-200">Error Code</span></span> | <span data-ttu-id="1b1ad-201">Description</span><span class="sxs-lookup"><span data-stu-id="1b1ad-201">Description</span></span> | <span data-ttu-id="1b1ad-202">Client Action</span><span class="sxs-lookup"><span data-stu-id="1b1ad-202">Client Action</span></span> |
| --- | --- | --- |
| <span data-ttu-id="1b1ad-203">invalid_request</span><span class="sxs-lookup"><span data-stu-id="1b1ad-203">invalid_request</span></span> |<span data-ttu-id="1b1ad-204">Protocol error, such as a missing required parameter.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-204">Protocol error, such as a missing required parameter.</span></span> |<span data-ttu-id="1b1ad-205">Fix and resubmit the request.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-205">Fix and resubmit the request.</span></span> <span data-ttu-id="1b1ad-206">This is a development error, and is typically caught during initial testing.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-206">This is a development error, and is typically caught during initial testing.</span></span> |
| <span data-ttu-id="1b1ad-207">unauthorized_client</span><span class="sxs-lookup"><span data-stu-id="1b1ad-207">unauthorized_client</span></span> |<span data-ttu-id="1b1ad-208">The client application is not permitted to request an authorization code.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-208">The client application is not permitted to request an authorization code.</span></span> |<span data-ttu-id="1b1ad-209">This usually occurs when the client application is not registered in Azure AD or is not added to the user's Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-209">This usually occurs when the client application is not registered in Azure AD or is not added to the user's Azure AD tenant.</span></span> <span data-ttu-id="1b1ad-210">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-210">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span></span> |
| <span data-ttu-id="1b1ad-211">access_denied</span><span class="sxs-lookup"><span data-stu-id="1b1ad-211">access_denied</span></span> |<span data-ttu-id="1b1ad-212">Resource owner denied consent</span><span class="sxs-lookup"><span data-stu-id="1b1ad-212">Resource owner denied consent</span></span> |<span data-ttu-id="1b1ad-213">The client application can notify the user that it cannot proceed unless the user consents.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-213">The client application can notify the user that it cannot proceed unless the user consents.</span></span> |
| <span data-ttu-id="1b1ad-214">unsupported_response_type</span><span class="sxs-lookup"><span data-stu-id="1b1ad-214">unsupported_response_type</span></span> |<span data-ttu-id="1b1ad-215">The authorization server does not support the response type in the request.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-215">The authorization server does not support the response type in the request.</span></span> |<span data-ttu-id="1b1ad-216">Fix and resubmit the request.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-216">Fix and resubmit the request.</span></span> <span data-ttu-id="1b1ad-217">This is a development error, and is typically caught during initial testing.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-217">This is a development error, and is typically caught during initial testing.</span></span> |
| <span data-ttu-id="1b1ad-218">server_error</span><span class="sxs-lookup"><span data-stu-id="1b1ad-218">server_error</span></span> |<span data-ttu-id="1b1ad-219">The server encountered an unexpected error.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-219">The server encountered an unexpected error.</span></span> |<span data-ttu-id="1b1ad-220">Retry the request.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-220">Retry the request.</span></span> <span data-ttu-id="1b1ad-221">These errors can result from temporary conditions.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-221">These errors can result from temporary conditions.</span></span> <span data-ttu-id="1b1ad-222">The client application might explain to the user that its response is delayed due to a temporary error.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-222">The client application might explain to the user that its response is delayed due to a temporary error.</span></span> |
| <span data-ttu-id="1b1ad-223">temporarily_unavailable</span><span class="sxs-lookup"><span data-stu-id="1b1ad-223">temporarily_unavailable</span></span> |<span data-ttu-id="1b1ad-224">The server is temporarily too busy to handle the request.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-224">The server is temporarily too busy to handle the request.</span></span> |<span data-ttu-id="1b1ad-225">Retry the request.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-225">Retry the request.</span></span> <span data-ttu-id="1b1ad-226">The client application might explain to the user that its response is delayed due to a temporary condition.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-226">The client application might explain to the user that its response is delayed due to a temporary condition.</span></span> |
| <span data-ttu-id="1b1ad-227">invalid_resource</span><span class="sxs-lookup"><span data-stu-id="1b1ad-227">invalid_resource</span></span> |<span data-ttu-id="1b1ad-228">The target resource is invalid because it does not exist, Azure AD cannot find it, or it is not correctly configured.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-228">The target resource is invalid because it does not exist, Azure AD cannot find it, or it is not correctly configured.</span></span> |<span data-ttu-id="1b1ad-229">This indicates the resource, if it exists, has not been configured in the tenant.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-229">This indicates the resource, if it exists, has not been configured in the tenant.</span></span> <span data-ttu-id="1b1ad-230">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-230">The application can prompt the user with instruction for installing the application and adding it to Azure AD.</span></span> |

## <a name="validate-the-idtoken"></a><span data-ttu-id="1b1ad-231">Validate the id_token</span><span class="sxs-lookup"><span data-stu-id="1b1ad-231">Validate the id_token</span></span>
<span data-ttu-id="1b1ad-232">Just receiving an `id_token` is not sufficient to authenticate the user; you must validate the signature and verify the claims in the `id_token` per your app's requirements.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-232">Just receiving an `id_token` is not sufficient to authenticate the user; you must validate the signature and verify the claims in the `id_token` per your app's requirements.</span></span> <span data-ttu-id="1b1ad-233">The Azure AD endpoint uses JSON Web Tokens (JWTs) and public key cryptography to sign tokens and verify that they are valid.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-233">The Azure AD endpoint uses JSON Web Tokens (JWTs) and public key cryptography to sign tokens and verify that they are valid.</span></span>

<span data-ttu-id="1b1ad-234">You can choose to validate the `id_token` in client code, but a common practice is to send the `id_token` to a backend server and perform the validation there.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-234">You can choose to validate the `id_token` in client code, but a common practice is to send the `id_token` to a backend server and perform the validation there.</span></span> <span data-ttu-id="1b1ad-235">Once you've validated the signature of the `id_token`, there are a few claims you are required to verify.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-235">Once you've validated the signature of the `id_token`, there are a few claims you are required to verify.</span></span>

<span data-ttu-id="1b1ad-236">You may also wish to validate additional claims depending on your scenario.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-236">You may also wish to validate additional claims depending on your scenario.</span></span> <span data-ttu-id="1b1ad-237">Some common validations include:</span><span class="sxs-lookup"><span data-stu-id="1b1ad-237">Some common validations include:</span></span>

* <span data-ttu-id="1b1ad-238">Ensuring the user/organization has signed up for the app.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-238">Ensuring the user/organization has signed up for the app.</span></span>
* <span data-ttu-id="1b1ad-239">Ensuring the user has proper authorization/privileges</span><span class="sxs-lookup"><span data-stu-id="1b1ad-239">Ensuring the user has proper authorization/privileges</span></span>
* <span data-ttu-id="1b1ad-240">Ensuring a certain strength of authentication has occurred, such as multi-factor authentication.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-240">Ensuring a certain strength of authentication has occurred, such as multi-factor authentication.</span></span>

<span data-ttu-id="1b1ad-241">Once you have validated the `id_token`, you can begin a session with the user and use the claims in the `id_token` to obtain information about the user in your app.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-241">Once you have validated the `id_token`, you can begin a session with the user and use the claims in the `id_token` to obtain information about the user in your app.</span></span> <span data-ttu-id="1b1ad-242">This information can be used for display, records, authorizations, etc. For more information about the token types and claims, read [Supported Token and Claim Types](active-directory-token-and-claims.md).</span><span class="sxs-lookup"><span data-stu-id="1b1ad-242">This information can be used for display, records, authorizations, etc. For more information about the token types and claims, read [Supported Token and Claim Types](active-directory-token-and-claims.md).</span></span>

## <a name="send-a-sign-out-request"></a><span data-ttu-id="1b1ad-243">Send a sign-out request</span><span class="sxs-lookup"><span data-stu-id="1b1ad-243">Send a sign-out request</span></span>
<span data-ttu-id="1b1ad-244">When you wish to sign the user out of the app, it is not sufficient to clear your app's cookies or otherwise end the session with the user.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-244">When you wish to sign the user out of the app, it is not sufficient to clear your app's cookies or otherwise end the session with the user.</span></span>  <span data-ttu-id="1b1ad-245">You must also redirect the user to the `end_session_endpoint` for sign-out.  If you fail to do so, the user will be able to reauthenticate to your app without entering their credentials again, because they will have a valid single sign-on session with the Azure AD endpoint.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-245">You must also redirect the user to the `end_session_endpoint` for sign-out.  If you fail to do so, the user will be able to reauthenticate to your app without entering their credentials again, because they will have a valid single sign-on session with the Azure AD endpoint.</span></span>

<span data-ttu-id="1b1ad-246">You can simply redirect the user to the `end_session_endpoint` listed in the OpenID Connect metadata document:</span><span class="sxs-lookup"><span data-stu-id="1b1ad-246">You can simply redirect the user to the `end_session_endpoint` listed in the OpenID Connect metadata document:</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/logout?
post_logout_redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F

```

| <span data-ttu-id="1b1ad-247">Parameter</span><span class="sxs-lookup"><span data-stu-id="1b1ad-247">Parameter</span></span> |  | <span data-ttu-id="1b1ad-248">Description</span><span class="sxs-lookup"><span data-stu-id="1b1ad-248">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="1b1ad-249">post_logout_redirect_uri</span><span class="sxs-lookup"><span data-stu-id="1b1ad-249">post_logout_redirect_uri</span></span> |<span data-ttu-id="1b1ad-250">recommended</span><span class="sxs-lookup"><span data-stu-id="1b1ad-250">recommended</span></span> |<span data-ttu-id="1b1ad-251">The URL that the user should be redirected to after successful logout.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-251">The URL that the user should be redirected to after successful logout.</span></span>  <span data-ttu-id="1b1ad-252">If not included, the user is shown a generic message.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-252">If not included, the user is shown a generic message.</span></span> |

## <a name="single-sign-out"></a><span data-ttu-id="1b1ad-253">Single sign-out</span><span class="sxs-lookup"><span data-stu-id="1b1ad-253">Single sign-out</span></span>
<span data-ttu-id="1b1ad-254">When you redirect the user to the `end_session_endpoint`, Azure AD clears the user's session from the browser.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-254">When you redirect the user to the `end_session_endpoint`, Azure AD clears the user's session from the browser.</span></span> <span data-ttu-id="1b1ad-255">However, the user may still be signed in to other applications that use Azure AD for authentication.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-255">However, the user may still be signed in to other applications that use Azure AD for authentication.</span></span> <span data-ttu-id="1b1ad-256">To enable those applications to sign the user out simultaneously, Azure AD sends an HTTP GET request to the registered `LogoutUrl` of all the applications that the user is currently signed in to.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-256">To enable those applications to sign the user out simultaneously, Azure AD sends an HTTP GET request to the registered `LogoutUrl` of all the applications that the user is currently signed in to.</span></span> <span data-ttu-id="1b1ad-257">Applications must respond to this request by clearing any session that identifies the user and returning a `200` response.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-257">Applications must respond to this request by clearing any session that identifies the user and returning a `200` response.</span></span>  <span data-ttu-id="1b1ad-258">If you wish to support single sign out in your application, you must implement such a `LogoutUrl` in your application's code.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-258">If you wish to support single sign out in your application, you must implement such a `LogoutUrl` in your application's code.</span></span>  <span data-ttu-id="1b1ad-259">You can set the `LogoutUrl` from the Azure portal:</span><span class="sxs-lookup"><span data-stu-id="1b1ad-259">You can set the `LogoutUrl` from the Azure portal:</span></span>

1. <span data-ttu-id="1b1ad-260">Navigate to the [Azure Portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="1b1ad-260">Navigate to the [Azure Portal](https://portal.azure.com).</span></span>
2. <span data-ttu-id="1b1ad-261">Choose your Active Directory by clicking on your account in the top right corner of the page.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-261">Choose your Active Directory by clicking on your account in the top right corner of the page.</span></span>
3. <span data-ttu-id="1b1ad-262">From the left hand navigation panel, choose **Azure Active Directory**, then choose **App registrations** and select your application.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-262">From the left hand navigation panel, choose **Azure Active Directory**, then choose **App registrations** and select your application.</span></span>
4. <span data-ttu-id="1b1ad-263">Click on **Properties** and find the **Logout URL** text box.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-263">Click on **Properties** and find the **Logout URL** text box.</span></span> 

## <a name="token-acquisition"></a><span data-ttu-id="1b1ad-264">Token Acquisition</span><span class="sxs-lookup"><span data-stu-id="1b1ad-264">Token Acquisition</span></span>
<span data-ttu-id="1b1ad-265">Many web apps need to not only sign the user in, but also access a web service on behalf of that user using OAuth.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-265">Many web apps need to not only sign the user in, but also access a web service on behalf of that user using OAuth.</span></span> <span data-ttu-id="1b1ad-266">This scenario combines OpenID Connect for user authentication while simultaneously acquiring an `authorization_code` that can be used to get `access_tokens` using the OAuth Authorization Code Flow.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-266">This scenario combines OpenID Connect for user authentication while simultaneously acquiring an `authorization_code` that can be used to get `access_tokens` using the OAuth Authorization Code Flow.</span></span>

## <a name="get-access-tokens"></a><span data-ttu-id="1b1ad-267">Get Access Tokens</span><span class="sxs-lookup"><span data-stu-id="1b1ad-267">Get Access Tokens</span></span>
<span data-ttu-id="1b1ad-268">To acquire access tokens, you need to modify the sign-in request from above:</span><span class="sxs-lookup"><span data-stu-id="1b1ad-268">To acquire access tokens, you need to modify the sign-in request from above:</span></span>

```
// Line breaks for legibility only

GET https://login.microsoftonline.com/{tenant}/oauth2/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e        // Your registered Application Id
&response_type=id_token+code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F       // Your registered Redirect Uri, url encoded
&response_mode=form_post                              // form_post', or 'fragment'
&scope=openid
&resource=https%3A%2F%2Fservice.contoso.com%2F                                     
&state=12345                                          // Any value, provided by your app
&nonce=678910                                         // Any value, provided by your app
```

<span data-ttu-id="1b1ad-269">By including permission scopes in the request and using `response_type=code+id_token`, the `authorize` endpoint ensures that the user has consented to the permissions indicated in the `scope` query parameter, and return your app an authorization code to exchange for an access token.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-269">By including permission scopes in the request and using `response_type=code+id_token`, the `authorize` endpoint ensures that the user has consented to the permissions indicated in the `scope` query parameter, and return your app an authorization code to exchange for an access token.</span></span>

### <a name="successful-response"></a><span data-ttu-id="1b1ad-270">Successful Response</span><span class="sxs-lookup"><span data-stu-id="1b1ad-270">Successful Response</span></span>
<span data-ttu-id="1b1ad-271">A successful response using `response_mode=form_post` looks like:</span><span class="sxs-lookup"><span data-stu-id="1b1ad-271">A successful response using `response_mode=form_post` looks like:</span></span>

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNB...&code=AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq...&state=12345
```

| <span data-ttu-id="1b1ad-272">Parameter</span><span class="sxs-lookup"><span data-stu-id="1b1ad-272">Parameter</span></span> | <span data-ttu-id="1b1ad-273">Description</span><span class="sxs-lookup"><span data-stu-id="1b1ad-273">Description</span></span> |
| --- | --- |
| <span data-ttu-id="1b1ad-274">id_token</span><span class="sxs-lookup"><span data-stu-id="1b1ad-274">id_token</span></span> |<span data-ttu-id="1b1ad-275">The `id_token` that the app requested.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-275">The `id_token` that the app requested.</span></span> <span data-ttu-id="1b1ad-276">You can use the `id_token` to verify the user's identity and begin a session with the user.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-276">You can use the `id_token` to verify the user's identity and begin a session with the user.</span></span> |
| <span data-ttu-id="1b1ad-277">code</span><span class="sxs-lookup"><span data-stu-id="1b1ad-277">code</span></span> |<span data-ttu-id="1b1ad-278">The authorization_code that the app requested.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-278">The authorization_code that the app requested.</span></span> <span data-ttu-id="1b1ad-279">The app can use the authorization code to request an access token for the target resource.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-279">The app can use the authorization code to request an access token for the target resource.</span></span> <span data-ttu-id="1b1ad-280">Authorization_codes are short lived, and typically expire after about 10 minutes.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-280">Authorization_codes are short lived, and typically expire after about 10 minutes.</span></span> |
| <span data-ttu-id="1b1ad-281">state</span><span class="sxs-lookup"><span data-stu-id="1b1ad-281">state</span></span> |<span data-ttu-id="1b1ad-282">If a state parameter is included in the request, the same value should appear in the response.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-282">If a state parameter is included in the request, the same value should appear in the response.</span></span> <span data-ttu-id="1b1ad-283">The app should verify that the state values in the request and response are identical.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-283">The app should verify that the state values in the request and response are identical.</span></span> |

### <a name="error-response"></a><span data-ttu-id="1b1ad-284">Error response</span><span class="sxs-lookup"><span data-stu-id="1b1ad-284">Error response</span></span>
<span data-ttu-id="1b1ad-285">Error responses may also be sent to the `redirect_uri` so the app can handle them appropriately:</span><span class="sxs-lookup"><span data-stu-id="1b1ad-285">Error responses may also be sent to the `redirect_uri` so the app can handle them appropriately:</span></span>

```
POST /myapp/ HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded

error=access_denied&error_description=the+user+canceled+the+authentication
```

| <span data-ttu-id="1b1ad-286">Parameter</span><span class="sxs-lookup"><span data-stu-id="1b1ad-286">Parameter</span></span> | <span data-ttu-id="1b1ad-287">Description</span><span class="sxs-lookup"><span data-stu-id="1b1ad-287">Description</span></span> |
| --- | --- |
| <span data-ttu-id="1b1ad-288">error</span><span class="sxs-lookup"><span data-stu-id="1b1ad-288">error</span></span> |<span data-ttu-id="1b1ad-289">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-289">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="1b1ad-290">error_description</span><span class="sxs-lookup"><span data-stu-id="1b1ad-290">error_description</span></span> |<span data-ttu-id="1b1ad-291">A specific error message that can help a developer identify the root cause of an authentication error.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-291">A specific error message that can help a developer identify the root cause of an authentication error.</span></span> |

<span data-ttu-id="1b1ad-292">For a description of the possible error codes and their recommended client action, see [Error codes for authorization endpoint errors](#error-codes-for-authorization-endpoint-errors).</span><span class="sxs-lookup"><span data-stu-id="1b1ad-292">For a description of the possible error codes and their recommended client action, see [Error codes for authorization endpoint errors](#error-codes-for-authorization-endpoint-errors).</span></span>

<span data-ttu-id="1b1ad-293">Once you've gotten an authorization `code` and an `id_token`, you can sign the user in and get access tokens on their behalf.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-293">Once you've gotten an authorization `code` and an `id_token`, you can sign the user in and get access tokens on their behalf.</span></span>  <span data-ttu-id="1b1ad-294">To sign the user in, you must validate the `id_token` exactly as described above.</span><span class="sxs-lookup"><span data-stu-id="1b1ad-294">To sign the user in, you must validate the `id_token` exactly as described above.</span></span> <span data-ttu-id="1b1ad-295">To get access tokens, you can follow the steps described in the "Use the authorization code to request an access token" section of our [OAuth protocol documentation](active-directory-protocols-oauth-code.md).</span><span class="sxs-lookup"><span data-stu-id="1b1ad-295">To get access tokens, you can follow the steps described in the "Use the authorization code to request an access token" section of our [OAuth protocol documentation](active-directory-protocols-oauth-code.md).</span></span>

