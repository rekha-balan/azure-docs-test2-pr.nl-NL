---
title: Security considerations for accessing apps remotely by using Azure AD Application Proxy | Microsoft Docs
description: Covers security considerations for using Azure AD Application Proxy
services: active-directory
documentationcenter: ''
author: kgremban
manager: femila
ms.assetid: ''
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/12/2017
ms.author: kgremban
ms.openlocfilehash: fa8c5f8a886af65dbdcccab02c0449b7f37a430b
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44553723"
---
# <a name="security-considerations-for-accessing-apps-remotely-by-using-azure-ad-application-proxy"></a><span data-ttu-id="e6709-103">Security considerations for accessing apps remotely by using Azure AD Application Proxy</span><span class="sxs-lookup"><span data-stu-id="e6709-103">Security considerations for accessing apps remotely by using Azure AD Application Proxy</span></span>

>[!NOTE]
><span data-ttu-id="e6709-104">The Application Proxy feature is available only if you upgraded to the Premium or Basic edition of Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e6709-104">The Application Proxy feature is available only if you upgraded to the Premium or Basic edition of Azure Active Directory.</span></span> <span data-ttu-id="e6709-105">For more information, see [Azure Active Directory editions](active-directory-editions.md).</span><span class="sxs-lookup"><span data-stu-id="e6709-105">For more information, see [Azure Active Directory editions](active-directory-editions.md).</span></span>

<span data-ttu-id="e6709-106">This article explains how Azure Active Directory (Azure AD) Application Proxy provides a secure service for publishing and accessing your applications remotely.</span><span class="sxs-lookup"><span data-stu-id="e6709-106">This article explains how Azure Active Directory (Azure AD) Application Proxy provides a secure service for publishing and accessing your applications remotely.</span></span>

<span data-ttu-id="e6709-107">Azure AD Application Proxy offers the following security benefits:</span><span class="sxs-lookup"><span data-stu-id="e6709-107">Azure AD Application Proxy offers the following security benefits:</span></span>

<span data-ttu-id="e6709-108">**Authenticated access:** Only authenticated connections can access your network.</span><span class="sxs-lookup"><span data-stu-id="e6709-108">**Authenticated access:** Only authenticated connections can access your network.</span></span>

* <span data-ttu-id="e6709-109">Azure AD Application Proxy relies on the Azure AD security token service (STS) for all authentication.</span><span class="sxs-lookup"><span data-stu-id="e6709-109">Azure AD Application Proxy relies on the Azure AD security token service (STS) for all authentication.</span></span> <span data-ttu-id="e6709-110">For applications that are published with preauthentication, traffic cannot pass through the Application Proxy service to your environment without a valid STS token.</span><span class="sxs-lookup"><span data-stu-id="e6709-110">For applications that are published with preauthentication, traffic cannot pass through the Application Proxy service to your environment without a valid STS token.</span></span>
* <span data-ttu-id="e6709-111">Preauthentication, by its very nature, blocks a significant number of anonymous attacks, because only authenticated identities can access the back-end application.</span><span class="sxs-lookup"><span data-stu-id="e6709-111">Preauthentication, by its very nature, blocks a significant number of anonymous attacks, because only authenticated identities can access the back-end application.</span></span>

<span data-ttu-id="e6709-112">**Conditional access:** Apply richer policy controls before connections to your network are established.</span><span class="sxs-lookup"><span data-stu-id="e6709-112">**Conditional access:** Apply richer policy controls before connections to your network are established.</span></span>

* <span data-ttu-id="e6709-113">With conditional access, it is possible to further define restrictions on what traffic is allowed to access your back-end applications.</span><span class="sxs-lookup"><span data-stu-id="e6709-113">With conditional access, it is possible to further define restrictions on what traffic is allowed to access your back-end applications.</span></span> <span data-ttu-id="e6709-114">You can define restrictions based on location, strength of authentication, and user risk profile.</span><span class="sxs-lookup"><span data-stu-id="e6709-114">You can define restrictions based on location, strength of authentication, and user risk profile.</span></span>
* <span data-ttu-id="e6709-115">This feature enables additional barriers for attackers.</span><span class="sxs-lookup"><span data-stu-id="e6709-115">This feature enables additional barriers for attackers.</span></span> <span data-ttu-id="e6709-116">For more information about conditional access, see [Getting started with Azure AD conditional access](https://azure.microsoft.com/documentation/articles/active-directory-conditional-access-azuread-connected-apps).</span><span class="sxs-lookup"><span data-stu-id="e6709-116">For more information about conditional access, see [Getting started with Azure AD conditional access](https://azure.microsoft.com/documentation/articles/active-directory-conditional-access-azuread-connected-apps).</span></span>

<span data-ttu-id="e6709-117">**Traffic termination:** All traffic is terminated in the cloud.</span><span class="sxs-lookup"><span data-stu-id="e6709-117">**Traffic termination:** All traffic is terminated in the cloud.</span></span>

* <span data-ttu-id="e6709-118">Because Azure AD Application Proxy is a reverse-proxy, all traffic to back-end applications is terminated at the service.</span><span class="sxs-lookup"><span data-stu-id="e6709-118">Because Azure AD Application Proxy is a reverse-proxy, all traffic to back-end applications is terminated at the service.</span></span> <span data-ttu-id="e6709-119">The session can get reestablished only with the back-end server, which means that your back-end servers are not exposed to direct HTTP traffic.</span><span class="sxs-lookup"><span data-stu-id="e6709-119">The session can get reestablished only with the back-end server, which means that your back-end servers are not exposed to direct HTTP traffic.</span></span> <span data-ttu-id="e6709-120">For example, you can more easily mitigate targeted attacks.</span><span class="sxs-lookup"><span data-stu-id="e6709-120">For example, you can more easily mitigate targeted attacks.</span></span>

<span data-ttu-id="e6709-121">**All access is outbound:** You don't need to open inbound connections to the corporate network.</span><span class="sxs-lookup"><span data-stu-id="e6709-121">**All access is outbound:** You don't need to open inbound connections to the corporate network.</span></span>

* <span data-ttu-id="e6709-122">Azure AD connectors maintain outbound connections to the Azure AD Application Proxy service, which means that there is no need to open firewall ports for incoming connections.</span><span class="sxs-lookup"><span data-stu-id="e6709-122">Azure AD connectors maintain outbound connections to the Azure AD Application Proxy service, which means that there is no need to open firewall ports for incoming connections.</span></span>
* <span data-ttu-id="e6709-123">Traditional approaches required a perimeter network (also known as *DMZ*, *demilitarized zone*, and *screened subnet*) and opening access to unauthenticated connections at the network edge.</span><span class="sxs-lookup"><span data-stu-id="e6709-123">Traditional approaches required a perimeter network (also known as *DMZ*, *demilitarized zone*, and *screened subnet*) and opening access to unauthenticated connections at the network edge.</span></span> <span data-ttu-id="e6709-124">This scenario resulted in the need for many additional investment in web application firewall (WAF) products to analyze traffic and offer addition protections to the environment.</span><span class="sxs-lookup"><span data-stu-id="e6709-124">This scenario resulted in the need for many additional investment in web application firewall (WAF) products to analyze traffic and offer addition protections to the environment.</span></span> <span data-ttu-id="e6709-125">With Application Proxy, you can avoid this scenario.</span><span class="sxs-lookup"><span data-stu-id="e6709-125">With Application Proxy, you can avoid this scenario.</span></span> <span data-ttu-id="e6709-126">You can even consider going without the perimeter network, because all connections are outbound and take place over a secure channel.</span><span class="sxs-lookup"><span data-stu-id="e6709-126">You can even consider going without the perimeter network, because all connections are outbound and take place over a secure channel.</span></span>

<span data-ttu-id="e6709-127">**Security analytics and machine language-based intelligence:** Get cutting-edge security protection.</span><span class="sxs-lookup"><span data-stu-id="e6709-127">**Security analytics and machine language-based intelligence:** Get cutting-edge security protection.</span></span>

* <span data-ttu-id="e6709-128">Azure AD Identity Protection with machine learning-driven intelligence with data is fed from our Digital Crimes Unit and Microsoft Security Response Center.</span><span class="sxs-lookup"><span data-stu-id="e6709-128">Azure AD Identity Protection with machine learning-driven intelligence with data is fed from our Digital Crimes Unit and Microsoft Security Response Center.</span></span> <span data-ttu-id="e6709-129">Together we proactively identify compromised accounts and offer real-time protection from high-risk sign-ins. We take into account numerous factors, such as access from infected devices, through anonymizing networks, and from atypical and unlikely locations.</span><span class="sxs-lookup"><span data-stu-id="e6709-129">Together we proactively identify compromised accounts and offer real-time protection from high-risk sign-ins. We take into account numerous factors, such as access from infected devices, through anonymizing networks, and from atypical and unlikely locations.</span></span>
* <span data-ttu-id="e6709-130">Many of these reports and events are already available through an API for integration with your security information and event management (SIEM) systems.</span><span class="sxs-lookup"><span data-stu-id="e6709-130">Many of these reports and events are already available through an API for integration with your security information and event management (SIEM) systems.</span></span>
* <span data-ttu-id="e6709-131">For more information, see [Azure AD Identity Protection](https://azure.microsoft.com/documentation/articles/active-directory-identityprotection).</span><span class="sxs-lookup"><span data-stu-id="e6709-131">For more information, see [Azure AD Identity Protection](https://azure.microsoft.com/documentation/articles/active-directory-identityprotection).</span></span>

<span data-ttu-id="e6709-132">**Remote access as a service:** You don’t have to worry about maintaining and patching on-premises servers.</span><span class="sxs-lookup"><span data-stu-id="e6709-132">**Remote access as a service:** You don’t have to worry about maintaining and patching on-premises servers.</span></span>

* <span data-ttu-id="e6709-133">Azure AD Application Proxy is an Internet-scale service that Microsoft owns, so be assured that you always get the latest security patches and upgrades.</span><span class="sxs-lookup"><span data-stu-id="e6709-133">Azure AD Application Proxy is an Internet-scale service that Microsoft owns, so be assured that you always get the latest security patches and upgrades.</span></span>
* <span data-ttu-id="e6709-134">Unpatched software still accounts for a large number of attacks.</span><span class="sxs-lookup"><span data-stu-id="e6709-134">Unpatched software still accounts for a large number of attacks.</span></span> <span data-ttu-id="e6709-135">With our service model, you no longer have to carry the burden of managing edge servers.</span><span class="sxs-lookup"><span data-stu-id="e6709-135">With our service model, you no longer have to carry the burden of managing edge servers.</span></span>

<span data-ttu-id="e6709-136">The remote access services provided with Azure AD operate in accordance with the guidelines and standards outlined at the [Azure Trust Center](https://azure.microsoft.com/support/trust-center).</span><span class="sxs-lookup"><span data-stu-id="e6709-136">The remote access services provided with Azure AD operate in accordance with the guidelines and standards outlined at the [Azure Trust Center](https://azure.microsoft.com/support/trust-center).</span></span>

<span data-ttu-id="e6709-137">The following diagram shows how Azure AD enables secure remote access to your on-premises applications.</span><span class="sxs-lookup"><span data-stu-id="e6709-137">The following diagram shows how Azure AD enables secure remote access to your on-premises applications.</span></span>

 ![Diagram of secure remote access through Azure AD Application Proxy](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/media/application-proxy-security-considerations/secure-remote-access.png)

>[!NOTE]
><span data-ttu-id="e6709-139">To improve the security of applications published by Azure AD Application Proxy, we block web crawler robots from indexing and archiving your applications.</span><span class="sxs-lookup"><span data-stu-id="e6709-139">To improve the security of applications published by Azure AD Application Proxy, we block web crawler robots from indexing and archiving your applications.</span></span> <span data-ttu-id="e6709-140">Each time a web crawler robot tries to retrieve the robot's settings for a published app, Application Proxy replies with a robots.txt file that includes the following text:</span><span class="sxs-lookup"><span data-stu-id="e6709-140">Each time a web crawler robot tries to retrieve the robot's settings for a published app, Application Proxy replies with a robots.txt file that includes the following text:</span></span>
>
><span data-ttu-id="e6709-141">_User-agent: \*_</span><span class="sxs-lookup"><span data-stu-id="e6709-141">_User-agent: \*_</span></span>  
><span data-ttu-id="e6709-142">_Disallow: /_</span><span class="sxs-lookup"><span data-stu-id="e6709-142">_Disallow: /_</span></span>

## <a name="components-of-the-azure-ad-application-proxy-solution"></a><span data-ttu-id="e6709-143">Components of the Azure AD Application Proxy solution</span><span class="sxs-lookup"><span data-stu-id="e6709-143">Components of the Azure AD Application Proxy solution</span></span>

<span data-ttu-id="e6709-144">Azure AD Application Proxy consists of two parts:</span><span class="sxs-lookup"><span data-stu-id="e6709-144">Azure AD Application Proxy consists of two parts:</span></span>

* <span data-ttu-id="e6709-145">The cloud-based service: This service is where the external client/user connections are made.</span><span class="sxs-lookup"><span data-stu-id="e6709-145">The cloud-based service: This service is where the external client/user connections are made.</span></span>
* <span data-ttu-id="e6709-146">The Azure AD Application Proxy connector: An on-premises component, the connector listens for requests from the Azure AD Application Proxy service and handles connections to the internal applications.</span><span class="sxs-lookup"><span data-stu-id="e6709-146">The Azure AD Application Proxy connector: An on-premises component, the connector listens for requests from the Azure AD Application Proxy service and handles connections to the internal applications.</span></span> <span data-ttu-id="e6709-147">The service includes taking care of items such as the Kerberos Constrained Delegation (KCD) for SSO.</span><span class="sxs-lookup"><span data-stu-id="e6709-147">The service includes taking care of items such as the Kerberos Constrained Delegation (KCD) for SSO.</span></span>

<span data-ttu-id="e6709-148">A flow between the connector and the Application Proxy service is established when:</span><span class="sxs-lookup"><span data-stu-id="e6709-148">A flow between the connector and the Application Proxy service is established when:</span></span>

* <span data-ttu-id="e6709-149">The connector is first set up.</span><span class="sxs-lookup"><span data-stu-id="e6709-149">The connector is first set up.</span></span>
* <span data-ttu-id="e6709-150">The connector pulls configuration information from the Application Proxy service, including the connector group that each connector is a member of.</span><span class="sxs-lookup"><span data-stu-id="e6709-150">The connector pulls configuration information from the Application Proxy service, including the connector group that each connector is a member of.</span></span>
* <span data-ttu-id="e6709-151">A user accesses a published application.</span><span class="sxs-lookup"><span data-stu-id="e6709-151">A user accesses a published application.</span></span>

>[!NOTE]
><span data-ttu-id="e6709-152">All communications occur over SSL, and they always originate at the connector to the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="e6709-152">All communications occur over SSL, and they always originate at the connector to the Application Proxy service.</span></span> <span data-ttu-id="e6709-153">The service is outbound only.</span><span class="sxs-lookup"><span data-stu-id="e6709-153">The service is outbound only.</span></span>

<span data-ttu-id="e6709-154">The connector uses a client certificate to authenticate to the Application Proxy service for nearly all calls.</span><span class="sxs-lookup"><span data-stu-id="e6709-154">The connector uses a client certificate to authenticate to the Application Proxy service for nearly all calls.</span></span> <span data-ttu-id="e6709-155">The only exception to this process is the initial setup step, where the client certificate is established.</span><span class="sxs-lookup"><span data-stu-id="e6709-155">The only exception to this process is the initial setup step, where the client certificate is established.</span></span>

### <a name="installing-the-connector"></a><span data-ttu-id="e6709-156">Installing the connector</span><span class="sxs-lookup"><span data-stu-id="e6709-156">Installing the connector</span></span>

<span data-ttu-id="e6709-157">When the connector is first set up, the following flow events take place:</span><span class="sxs-lookup"><span data-stu-id="e6709-157">When the connector is first set up, the following flow events take place:</span></span>

1. <span data-ttu-id="e6709-158">The connector registration to the service happens as part of the installation of the connector.</span><span class="sxs-lookup"><span data-stu-id="e6709-158">The connector registration to the service happens as part of the installation of the connector.</span></span> <span data-ttu-id="e6709-159">Currently, users are prompted to enter their Azure AD admin credentials.</span><span class="sxs-lookup"><span data-stu-id="e6709-159">Currently, users are prompted to enter their Azure AD admin credentials.</span></span> <span data-ttu-id="e6709-160">The token acquired is then presented to the Azure AD Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="e6709-160">The token acquired is then presented to the Azure AD Application Proxy service.</span></span>
2. <span data-ttu-id="e6709-161">Application Proxy evaluates the token to ensure that the user is a member of the company admin role within the tenant that the token was issued for.</span><span class="sxs-lookup"><span data-stu-id="e6709-161">Application Proxy evaluates the token to ensure that the user is a member of the company admin role within the tenant that the token was issued for.</span></span> <span data-ttu-id="e6709-162">If the user is not a member of the admin role, the process is terminated.</span><span class="sxs-lookup"><span data-stu-id="e6709-162">If the user is not a member of the admin role, the process is terminated.</span></span>
3. <span data-ttu-id="e6709-163">The connector generates a client certificate request and passes it, with the token, to the Application Proxy service, which in turn verifies the token and signs the client certificate request.</span><span class="sxs-lookup"><span data-stu-id="e6709-163">The connector generates a client certificate request and passes it, with the token, to the Application Proxy service, which in turn verifies the token and signs the client certificate request.</span></span>
4. <span data-ttu-id="e6709-164">The connector uses the client certificate for future communication with the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="e6709-164">The connector uses the client certificate for future communication with the Application Proxy service.</span></span>
5. <span data-ttu-id="e6709-165">The connector performs an initial pull of the system configuration data from the service using its client certificate, and it is now ready to take requests.</span><span class="sxs-lookup"><span data-stu-id="e6709-165">The connector performs an initial pull of the system configuration data from the service using its client certificate, and it is now ready to take requests.</span></span>

### <a name="updating-the-configuration-settings"></a><span data-ttu-id="e6709-166">Updating the configuration settings</span><span class="sxs-lookup"><span data-stu-id="e6709-166">Updating the configuration settings</span></span>

<span data-ttu-id="e6709-167">Whenever the Application Proxy service updates the configuration settings, the following flow events take place:</span><span class="sxs-lookup"><span data-stu-id="e6709-167">Whenever the Application Proxy service updates the configuration settings, the following flow events take place:</span></span>

1. <span data-ttu-id="e6709-168">The connector connects to the configuration endpoint within the Application Proxy service by using its client certificate.</span><span class="sxs-lookup"><span data-stu-id="e6709-168">The connector connects to the configuration endpoint within the Application Proxy service by using its client certificate.</span></span>
2. <span data-ttu-id="e6709-169">After the client certificate has been validated, the Application Proxy service returns configuration data to the connector (for example, the connector group that the connector should be part of).</span><span class="sxs-lookup"><span data-stu-id="e6709-169">After the client certificate has been validated, the Application Proxy service returns configuration data to the connector (for example, the connector group that the connector should be part of).</span></span>
3. <span data-ttu-id="e6709-170">If the current certificate is more than 30 days old, the connector generates a new certificate request, which effectively updates the client certificate every 30 days.</span><span class="sxs-lookup"><span data-stu-id="e6709-170">If the current certificate is more than 30 days old, the connector generates a new certificate request, which effectively updates the client certificate every 30 days.</span></span>

### <a name="accessing-published-applications"></a><span data-ttu-id="e6709-171">Accessing published applications</span><span class="sxs-lookup"><span data-stu-id="e6709-171">Accessing published applications</span></span>

<span data-ttu-id="e6709-172">When users access a published application, the following flow events take place:</span><span class="sxs-lookup"><span data-stu-id="e6709-172">When users access a published application, the following flow events take place:</span></span>

1. <span data-ttu-id="e6709-173">The Application Proxy service checks the configuration settings for the app.</span><span class="sxs-lookup"><span data-stu-id="e6709-173">The Application Proxy service checks the configuration settings for the app.</span></span> <span data-ttu-id="e6709-174">If the app is configured to use preauthentication with Azure AD, users are redirected to the Azure AD STS to authenticate.</span><span class="sxs-lookup"><span data-stu-id="e6709-174">If the app is configured to use preauthentication with Azure AD, users are redirected to the Azure AD STS to authenticate.</span></span> <span data-ttu-id="e6709-175">If you publish the app by using pass-through, this step is skipped.</span><span class="sxs-lookup"><span data-stu-id="e6709-175">If you publish the app by using pass-through, this step is skipped.</span></span>

 <span data-ttu-id="e6709-176">a.</span><span class="sxs-lookup"><span data-stu-id="e6709-176">a.</span></span> <span data-ttu-id="e6709-177">During authentication with Azure AD, Application Proxy checks for any conditional access policy requirements for the specific application.</span><span class="sxs-lookup"><span data-stu-id="e6709-177">During authentication with Azure AD, Application Proxy checks for any conditional access policy requirements for the specific application.</span></span> <span data-ttu-id="e6709-178">This step is to ensure that the user has been assigned to the application.</span><span class="sxs-lookup"><span data-stu-id="e6709-178">This step is to ensure that the user has been assigned to the application.</span></span> <span data-ttu-id="e6709-179">If multi-factor authentication (MFA) is required, the authentication sequence prompts the user for a second-factor authentication.</span><span class="sxs-lookup"><span data-stu-id="e6709-179">If multi-factor authentication (MFA) is required, the authentication sequence prompts the user for a second-factor authentication.</span></span>

 <span data-ttu-id="e6709-180">b.</span><span class="sxs-lookup"><span data-stu-id="e6709-180">b.</span></span> <span data-ttu-id="e6709-181">After all checks have passed, the Azure AD STS issues a signed token for the application, and it redirects the user back to the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="e6709-181">After all checks have passed, the Azure AD STS issues a signed token for the application, and it redirects the user back to the Application Proxy service.</span></span>

 <span data-ttu-id="e6709-182">c.</span><span class="sxs-lookup"><span data-stu-id="e6709-182">c.</span></span> <span data-ttu-id="e6709-183">Application Proxy then validates the token to ensure that it was issued to the application that the user requested access to.</span><span class="sxs-lookup"><span data-stu-id="e6709-183">Application Proxy then validates the token to ensure that it was issued to the application that the user requested access to.</span></span> <span data-ttu-id="e6709-184">It performs other checks also, such as ensuring that the token was signed by Azure AD, and that it is still within the valid window.</span><span class="sxs-lookup"><span data-stu-id="e6709-184">It performs other checks also, such as ensuring that the token was signed by Azure AD, and that it is still within the valid window.</span></span>

 <span data-ttu-id="e6709-185">d.</span><span class="sxs-lookup"><span data-stu-id="e6709-185">d.</span></span> <span data-ttu-id="e6709-186">Application Proxy sets an encrypted authentication cookie (such as a non-persisted cookie) to indicate that authentication to the application has occurred.</span><span class="sxs-lookup"><span data-stu-id="e6709-186">Application Proxy sets an encrypted authentication cookie (such as a non-persisted cookie) to indicate that authentication to the application has occurred.</span></span> <span data-ttu-id="e6709-187">The cookie includes an expiration timestamp that's based on the token from Azure AD and other data, such as the user name that the authentication is based on.</span><span class="sxs-lookup"><span data-stu-id="e6709-187">The cookie includes an expiration timestamp that's based on the token from Azure AD and other data, such as the user name that the authentication is based on.</span></span> <span data-ttu-id="e6709-188">The cookie is encrypted with a private key known only to the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="e6709-188">The cookie is encrypted with a private key known only to the Application Proxy service.</span></span>

 <span data-ttu-id="e6709-189">e.</span><span class="sxs-lookup"><span data-stu-id="e6709-189">e.</span></span> <span data-ttu-id="e6709-190">Application Proxy redirects the user back to the originally requested URL.</span><span class="sxs-lookup"><span data-stu-id="e6709-190">Application Proxy redirects the user back to the originally requested URL.</span></span>

 >[!NOTE]
 ><span data-ttu-id="e6709-191">If any part of the preauthentication steps fails, the user’s request is denied, and the user is shown a message indicating the source of the problem.</span><span class="sxs-lookup"><span data-stu-id="e6709-191">If any part of the preauthentication steps fails, the user’s request is denied, and the user is shown a message indicating the source of the problem.</span></span>
 >

2. <span data-ttu-id="e6709-192">After it receives the request from the client, Application Proxy validates that the pre-authentication condition has been met and that the cookie is still valid (as required).</span><span class="sxs-lookup"><span data-stu-id="e6709-192">After it receives the request from the client, Application Proxy validates that the pre-authentication condition has been met and that the cookie is still valid (as required).</span></span> <span data-ttu-id="e6709-193">Application Proxy then places a request in the appropriate queue for an on-premises connector to handle.</span><span class="sxs-lookup"><span data-stu-id="e6709-193">Application Proxy then places a request in the appropriate queue for an on-premises connector to handle.</span></span> 

 >[!NOTE]
 ><span data-ttu-id="e6709-194">All requests from the connector are outbound to the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="e6709-194">All requests from the connector are outbound to the Application Proxy service.</span></span> <span data-ttu-id="e6709-195">Connectors keep an outbound connection open to Application Proxy.</span><span class="sxs-lookup"><span data-stu-id="e6709-195">Connectors keep an outbound connection open to Application Proxy.</span></span> <span data-ttu-id="e6709-196">When a request comes in, Application Proxy queues up the request on one of the open connections for the connector to pick up.</span><span class="sxs-lookup"><span data-stu-id="e6709-196">When a request comes in, Application Proxy queues up the request on one of the open connections for the connector to pick up.</span></span>

 * <span data-ttu-id="e6709-197">The request includes items from the application, such as the request headers, data from the encrypted cookie, the user making the request, and the request ID.</span><span class="sxs-lookup"><span data-stu-id="e6709-197">The request includes items from the application, such as the request headers, data from the encrypted cookie, the user making the request, and the request ID.</span></span> <span data-ttu-id="e6709-198">However, the encrypted authentication cookie is not sent to the connector.</span><span class="sxs-lookup"><span data-stu-id="e6709-198">However, the encrypted authentication cookie is not sent to the connector.</span></span>

3. <span data-ttu-id="e6709-199">The connector receives the request from the queue, based on a long-lived outbound connection.</span><span class="sxs-lookup"><span data-stu-id="e6709-199">The connector receives the request from the queue, based on a long-lived outbound connection.</span></span> <span data-ttu-id="e6709-200">Based on the request, Application Proxy performs one of the following actions:</span><span class="sxs-lookup"><span data-stu-id="e6709-200">Based on the request, Application Proxy performs one of the following actions:</span></span>

 * <span data-ttu-id="e6709-201">The connector confirms whether it can identify the application.</span><span class="sxs-lookup"><span data-stu-id="e6709-201">The connector confirms whether it can identify the application.</span></span> <span data-ttu-id="e6709-202">If it cannot identify the application, the connector establishes a connection to the Application Proxy service to gather details about the application, and it caches the application locally.</span><span class="sxs-lookup"><span data-stu-id="e6709-202">If it cannot identify the application, the connector establishes a connection to the Application Proxy service to gather details about the application, and it caches the application locally.</span></span>

 * <span data-ttu-id="e6709-203">If the request is a simple operation (for example, there is no data within the body as is with a RESTful *GET* request), the connector makes a connection to the target internal resource and then waits for a response.</span><span class="sxs-lookup"><span data-stu-id="e6709-203">If the request is a simple operation (for example, there is no data within the body as is with a RESTful *GET* request), the connector makes a connection to the target internal resource and then waits for a response.</span></span>

 * <span data-ttu-id="e6709-204">If the request has data associated with it in the body (for example, a RESTful *POST* operation), the connector makes an outbound connection by using the client certificate to the Application Proxy instance.</span><span class="sxs-lookup"><span data-stu-id="e6709-204">If the request has data associated with it in the body (for example, a RESTful *POST* operation), the connector makes an outbound connection by using the client certificate to the Application Proxy instance.</span></span> <span data-ttu-id="e6709-205">It makes this connection to request the data and open a connection to the internal resource.</span><span class="sxs-lookup"><span data-stu-id="e6709-205">It makes this connection to request the data and open a connection to the internal resource.</span></span> <span data-ttu-id="e6709-206">After it receives the request from the connector, the Application Proxy service begins accepting content from the user and forwards data to the connector.</span><span class="sxs-lookup"><span data-stu-id="e6709-206">After it receives the request from the connector, the Application Proxy service begins accepting content from the user and forwards data to the connector.</span></span> <span data-ttu-id="e6709-207">The connector, in turn, forwards the data to the internal resource.</span><span class="sxs-lookup"><span data-stu-id="e6709-207">The connector, in turn, forwards the data to the internal resource.</span></span>

4. <span data-ttu-id="e6709-208">After the request and transmission of all content to the back end is complete, the connector waits for a response.</span><span class="sxs-lookup"><span data-stu-id="e6709-208">After the request and transmission of all content to the back end is complete, the connector waits for a response.</span></span>

5. <span data-ttu-id="e6709-209">After it receives a response, the connector makes an outbound connection to the Application Proxy service, to return the header details and begin streaming the return data.</span><span class="sxs-lookup"><span data-stu-id="e6709-209">After it receives a response, the connector makes an outbound connection to the Application Proxy service, to return the header details and begin streaming the return data.</span></span>

6. <span data-ttu-id="e6709-210">Application Proxy "streams" the data to the user.</span><span class="sxs-lookup"><span data-stu-id="e6709-210">Application Proxy "streams" the data to the user.</span></span> <span data-ttu-id="e6709-211">Some processing of the headers may occur here, as needed and defined by the application.</span><span class="sxs-lookup"><span data-stu-id="e6709-211">Some processing of the headers may occur here, as needed and defined by the application.</span></span>

<span data-ttu-id="e6709-212">If you need assistance communicating from an Azure web application by way of a client browser to an on-premises, Windows-authenticated Simple Object Access Protocol (SOAP) endpoint, see the [Azure Field Notes Blog](http://www.azurefieldnotes.com/2016/12/02/claims-to-windows-identity-translation-solutions-and-its-flaws-when-using-azure-ad-application-proxy).</span><span class="sxs-lookup"><span data-stu-id="e6709-212">If you need assistance communicating from an Azure web application by way of a client browser to an on-premises, Windows-authenticated Simple Object Access Protocol (SOAP) endpoint, see the [Azure Field Notes Blog](http://www.azurefieldnotes.com/2016/12/02/claims-to-windows-identity-translation-solutions-and-its-flaws-when-using-azure-ad-application-proxy).</span></span>

## <a name="next-steps"></a><span data-ttu-id="e6709-213">Next steps</span><span class="sxs-lookup"><span data-stu-id="e6709-213">Next steps</span></span>

[<span data-ttu-id="e6709-214">Understand Azure AD Application Proxy connectors</span><span class="sxs-lookup"><span data-stu-id="e6709-214">Understand Azure AD Application Proxy connectors</span></span>](application-proxy-understand-connectors.md)

