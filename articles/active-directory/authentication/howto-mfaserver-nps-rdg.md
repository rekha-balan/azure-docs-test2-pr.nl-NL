---
title: RDG and Azure MFA Server using RADIUS | Microsoft Docs
description: This is the Azure Multi-factor authentication page that will assist in deploying Remote Desktop (RD) Gateway and Azure Multi-Factor Authentication Server using RADIUS.
services: multi-factor-authentication
ms.service: active-directory
ms.component: authentication
ms.topic: conceptual
ms.date: 07/11/2018
ms.author: joflore
author: MicrosoftGuyJFlo
manager: mtillman
ms.reviewer: michmcla
ms.openlocfilehash: 99ed74a9664fbeeb65d90e51d0afcd97dd0b0ca0
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44871638"
---
# <a name="remote-desktop-gateway-and-azure-multi-factor-authentication-server-using-radius"></a><span data-ttu-id="965b4-103">Remote Desktop Gateway and Azure Multi-Factor Authentication Server using RADIUS</span><span class="sxs-lookup"><span data-stu-id="965b4-103">Remote Desktop Gateway and Azure Multi-Factor Authentication Server using RADIUS</span></span>

<span data-ttu-id="965b4-104">Often, Remote Desktop (RD) Gateway uses the local [Network Policy Services (NPS)](https://docs.microsoft.com/windows-server/networking/core-network-guide/core-network-guide#BKMK_optionalfeatures) to authenticate users.</span><span class="sxs-lookup"><span data-stu-id="965b4-104">Often, Remote Desktop (RD) Gateway uses the local [Network Policy Services (NPS)](https://docs.microsoft.com/windows-server/networking/core-network-guide/core-network-guide#BKMK_optionalfeatures) to authenticate users.</span></span> <span data-ttu-id="965b4-105">This article describes how to route RADIUS requests out from the Remote Desktop Gateway (through the local NPS) to the Multi-Factor Authentication Server.</span><span class="sxs-lookup"><span data-stu-id="965b4-105">This article describes how to route RADIUS requests out from the Remote Desktop Gateway (through the local NPS) to the Multi-Factor Authentication Server.</span></span> <span data-ttu-id="965b4-106">The combination of Azure MFA and RD Gateway means that your users can access their work environments from anywhere while performing strong authentication.</span><span class="sxs-lookup"><span data-stu-id="965b4-106">The combination of Azure MFA and RD Gateway means that your users can access their work environments from anywhere while performing strong authentication.</span></span> 

<span data-ttu-id="965b4-107">Since Windows Authentication for terminal services is not supported for Server 2012 R2, use RD Gateway and RADIUS to integrate with MFA Server.</span><span class="sxs-lookup"><span data-stu-id="965b4-107">Since Windows Authentication for terminal services is not supported for Server 2012 R2, use RD Gateway and RADIUS to integrate with MFA Server.</span></span> 

<span data-ttu-id="965b4-108">Install the Azure Multi-Factor Authentication Server on a separate server, which proxies the RADIUS request back to the NPS on the Remote Desktop Gateway Server.</span><span class="sxs-lookup"><span data-stu-id="965b4-108">Install the Azure Multi-Factor Authentication Server on a separate server, which proxies the RADIUS request back to the NPS on the Remote Desktop Gateway Server.</span></span> <span data-ttu-id="965b4-109">After NPS validates the username and password, it returns a response to the Multi-Factor Authentication Server.</span><span class="sxs-lookup"><span data-stu-id="965b4-109">After NPS validates the username and password, it returns a response to the Multi-Factor Authentication Server.</span></span> <span data-ttu-id="965b4-110">Then, the MFA Server performs the second factor of authentication and returns a result to the gateway.</span><span class="sxs-lookup"><span data-stu-id="965b4-110">Then, the MFA Server performs the second factor of authentication and returns a result to the gateway.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="965b4-111">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="965b4-111">Prerequisites</span></span>

- <span data-ttu-id="965b4-112">A domain-joined Azure MFA Server.</span><span class="sxs-lookup"><span data-stu-id="965b4-112">A domain-joined Azure MFA Server.</span></span> <span data-ttu-id="965b4-113">If you don't have one installed already, follow the steps in [Getting started with the Azure Multi-Factor Authentication Server](howto-mfaserver-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="965b4-113">If you don't have one installed already, follow the steps in [Getting started with the Azure Multi-Factor Authentication Server](howto-mfaserver-deploy.md).</span></span>
- <span data-ttu-id="965b4-114">An existing configured NPS Server.</span><span class="sxs-lookup"><span data-stu-id="965b4-114">An existing configured NPS Server.</span></span>
- <span data-ttu-id="965b4-115">A Remote Desktop Gateway that authenticates with Network Policy Services.</span><span class="sxs-lookup"><span data-stu-id="965b4-115">A Remote Desktop Gateway that authenticates with Network Policy Services.</span></span>

## <a name="configure-the-remote-desktop-gateway"></a><span data-ttu-id="965b4-116">Configure the Remote Desktop Gateway</span><span class="sxs-lookup"><span data-stu-id="965b4-116">Configure the Remote Desktop Gateway</span></span>
<span data-ttu-id="965b4-117">Configure the RD Gateway to send RADIUS authentication to an Azure Multi-Factor Authentication Server.</span><span class="sxs-lookup"><span data-stu-id="965b4-117">Configure the RD Gateway to send RADIUS authentication to an Azure Multi-Factor Authentication Server.</span></span> 

1. <span data-ttu-id="965b4-118">In RD Gateway Manager, right-click the server name and select **Properties**.</span><span class="sxs-lookup"><span data-stu-id="965b4-118">In RD Gateway Manager, right-click the server name and select **Properties**.</span></span>
2. <span data-ttu-id="965b4-119">Go to the **RD CAP Store** tab and select **Central server running NPS**.</span><span class="sxs-lookup"><span data-stu-id="965b4-119">Go to the **RD CAP Store** tab and select **Central server running NPS**.</span></span> 
3. <span data-ttu-id="965b4-120">Add one or more Azure Multi-Factor Authentication Servers as RADIUS servers by entering the name or IP address of each server.</span><span class="sxs-lookup"><span data-stu-id="965b4-120">Add one or more Azure Multi-Factor Authentication Servers as RADIUS servers by entering the name or IP address of each server.</span></span> 
4. <span data-ttu-id="965b4-121">Create a shared secret for each server.</span><span class="sxs-lookup"><span data-stu-id="965b4-121">Create a shared secret for each server.</span></span>

## <a name="configure-nps"></a><span data-ttu-id="965b4-122">Configure NPS</span><span class="sxs-lookup"><span data-stu-id="965b4-122">Configure NPS</span></span>
<span data-ttu-id="965b4-123">The RD Gateway uses NPS to send the RADIUS request to Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="965b4-123">The RD Gateway uses NPS to send the RADIUS request to Azure Multi-Factor Authentication.</span></span> <span data-ttu-id="965b4-124">To configure NPS, first you change the timeout settings to prevent the RD Gateway from timing out before the two-step verification has completed.</span><span class="sxs-lookup"><span data-stu-id="965b4-124">To configure NPS, first you change the timeout settings to prevent the RD Gateway from timing out before the two-step verification has completed.</span></span> <span data-ttu-id="965b4-125">Then, you update NPS to receive RADIUS authentications from your MFA Server.</span><span class="sxs-lookup"><span data-stu-id="965b4-125">Then, you update NPS to receive RADIUS authentications from your MFA Server.</span></span> <span data-ttu-id="965b4-126">Use the following procedure to configure NPS:</span><span class="sxs-lookup"><span data-stu-id="965b4-126">Use the following procedure to configure NPS:</span></span>

### <a name="modify-the-timeout-policy"></a><span data-ttu-id="965b4-127">Modify the timeout policy</span><span class="sxs-lookup"><span data-stu-id="965b4-127">Modify the timeout policy</span></span>

1. <span data-ttu-id="965b4-128">In NPS, open the **RADIUS Clients and Server** menu in the left column and select **Remote RADIUS Server Groups**.</span><span class="sxs-lookup"><span data-stu-id="965b4-128">In NPS, open the **RADIUS Clients and Server** menu in the left column and select **Remote RADIUS Server Groups**.</span></span> 
2. <span data-ttu-id="965b4-129">Select the **TS GATEWAY SERVER GROUP**.</span><span class="sxs-lookup"><span data-stu-id="965b4-129">Select the **TS GATEWAY SERVER GROUP**.</span></span> 
3. <span data-ttu-id="965b4-130">Go to the **Load Balancing** tab.</span><span class="sxs-lookup"><span data-stu-id="965b4-130">Go to the **Load Balancing** tab.</span></span> 
4. <span data-ttu-id="965b4-131">Change both the **Number of seconds without response before request is considered dropped** and the **Number of seconds between requests when server is identified as unavailable** to between 30 and 60 seconds.</span><span class="sxs-lookup"><span data-stu-id="965b4-131">Change both the **Number of seconds without response before request is considered dropped** and the **Number of seconds between requests when server is identified as unavailable** to between 30 and 60 seconds.</span></span> <span data-ttu-id="965b4-132">(If you find that the server still times out during authentication, you can come back here and increase the number of seconds.)</span><span class="sxs-lookup"><span data-stu-id="965b4-132">(If you find that the server still times out during authentication, you can come back here and increase the number of seconds.)</span></span>
5. <span data-ttu-id="965b4-133">Go to the **Authentication/Account** tab and check that the RADIUS ports specified match the ports that the Multi-Factor Authentication Server is listening on.</span><span class="sxs-lookup"><span data-stu-id="965b4-133">Go to the **Authentication/Account** tab and check that the RADIUS ports specified match the ports that the Multi-Factor Authentication Server is listening on.</span></span>

### <a name="prepare-nps-to-receive-authentications-from-the-mfa-server"></a><span data-ttu-id="965b4-134">Prepare NPS to receive authentications from the MFA Server</span><span class="sxs-lookup"><span data-stu-id="965b4-134">Prepare NPS to receive authentications from the MFA Server</span></span>

1. <span data-ttu-id="965b4-135">Right-click **RADIUS Clients** under RADIUS Clients and Servers in the left column and select **New**.</span><span class="sxs-lookup"><span data-stu-id="965b4-135">Right-click **RADIUS Clients** under RADIUS Clients and Servers in the left column and select **New**.</span></span>
2. <span data-ttu-id="965b4-136">Add the Azure Multi-Factor Authentication Server as a RADIUS client.</span><span class="sxs-lookup"><span data-stu-id="965b4-136">Add the Azure Multi-Factor Authentication Server as a RADIUS client.</span></span> <span data-ttu-id="965b4-137">Choose a Friendly name and specify a shared secret.</span><span class="sxs-lookup"><span data-stu-id="965b4-137">Choose a Friendly name and specify a shared secret.</span></span>
3. <span data-ttu-id="965b4-138">Open the **Policies** menu in the left column and select **Connection Request Policies**.</span><span class="sxs-lookup"><span data-stu-id="965b4-138">Open the **Policies** menu in the left column and select **Connection Request Policies**.</span></span> <span data-ttu-id="965b4-139">You should see a policy called TS GATEWAY AUTHORIZATION POLICY that was created when RD Gateway was configured.</span><span class="sxs-lookup"><span data-stu-id="965b4-139">You should see a policy called TS GATEWAY AUTHORIZATION POLICY that was created when RD Gateway was configured.</span></span> <span data-ttu-id="965b4-140">This policy forwards RADIUS requests to the Multi-Factor Authentication Server.</span><span class="sxs-lookup"><span data-stu-id="965b4-140">This policy forwards RADIUS requests to the Multi-Factor Authentication Server.</span></span>
4. <span data-ttu-id="965b4-141">Right-click **TS GATEWAY AUTHORIZATION POLICY** and select **Duplicate Policy**.</span><span class="sxs-lookup"><span data-stu-id="965b4-141">Right-click **TS GATEWAY AUTHORIZATION POLICY** and select **Duplicate Policy**.</span></span> 
5. <span data-ttu-id="965b4-142">Open the new policy and go to the **Conditions** tab.</span><span class="sxs-lookup"><span data-stu-id="965b4-142">Open the new policy and go to the **Conditions** tab.</span></span>
6. <span data-ttu-id="965b4-143">Add a condition that matches the Client Friendly Name with the Friendly name set in step 2 for the Azure Multi-Factor Authentication Server RADIUS client.</span><span class="sxs-lookup"><span data-stu-id="965b4-143">Add a condition that matches the Client Friendly Name with the Friendly name set in step 2 for the Azure Multi-Factor Authentication Server RADIUS client.</span></span> 
7. <span data-ttu-id="965b4-144">Go to the **Settings** tab and select **Authentication**.</span><span class="sxs-lookup"><span data-stu-id="965b4-144">Go to the **Settings** tab and select **Authentication**.</span></span>
8. <span data-ttu-id="965b4-145">Change the Authentication Provider to **Authenticate requests on this server**.</span><span class="sxs-lookup"><span data-stu-id="965b4-145">Change the Authentication Provider to **Authenticate requests on this server**.</span></span> <span data-ttu-id="965b4-146">This policy ensures that when NPS receives a RADIUS request from the Azure MFA Server, the authentication occurs locally instead of sending a RADIUS request back to the Azure Multi-Factor Authentication Server, which would result in a loop condition.</span><span class="sxs-lookup"><span data-stu-id="965b4-146">This policy ensures that when NPS receives a RADIUS request from the Azure MFA Server, the authentication occurs locally instead of sending a RADIUS request back to the Azure Multi-Factor Authentication Server, which would result in a loop condition.</span></span> 
9. <span data-ttu-id="965b4-147">To prevent a loop condition, make sure that the new policy is ordered ABOVE the original policy in the **Connection Request Policies** pane.</span><span class="sxs-lookup"><span data-stu-id="965b4-147">To prevent a loop condition, make sure that the new policy is ordered ABOVE the original policy in the **Connection Request Policies** pane.</span></span>

## <a name="configure-azure-multi-factor-authentication"></a><span data-ttu-id="965b4-148">Configure Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="965b4-148">Configure Azure Multi-Factor Authentication</span></span>

<span data-ttu-id="965b4-149">The Azure Multi-Factor Authentication Server is configured as a RADIUS proxy between RD Gateway and NPS.</span><span class="sxs-lookup"><span data-stu-id="965b4-149">The Azure Multi-Factor Authentication Server is configured as a RADIUS proxy between RD Gateway and NPS.</span></span>  <span data-ttu-id="965b4-150">It should be installed on a domain-joined server that is separate from the RD Gateway server.</span><span class="sxs-lookup"><span data-stu-id="965b4-150">It should be installed on a domain-joined server that is separate from the RD Gateway server.</span></span> <span data-ttu-id="965b4-151">Use the following procedure to configure the Azure Multi-Factor Authentication Server.</span><span class="sxs-lookup"><span data-stu-id="965b4-151">Use the following procedure to configure the Azure Multi-Factor Authentication Server.</span></span>

1. <span data-ttu-id="965b4-152">Open the Azure Multi-Factor Authentication Server and select the RADIUS Authentication icon.</span><span class="sxs-lookup"><span data-stu-id="965b4-152">Open the Azure Multi-Factor Authentication Server and select the RADIUS Authentication icon.</span></span> 
2. <span data-ttu-id="965b4-153">Check the **Enable RADIUS authentication** checkbox.</span><span class="sxs-lookup"><span data-stu-id="965b4-153">Check the **Enable RADIUS authentication** checkbox.</span></span>
3. <span data-ttu-id="965b4-154">On the Clients tab, ensure the ports match what is configured in NPS then select **Add**.</span><span class="sxs-lookup"><span data-stu-id="965b4-154">On the Clients tab, ensure the ports match what is configured in NPS then select **Add**.</span></span>
4. <span data-ttu-id="965b4-155">Add the RD Gateway server IP address, application name (optional), and a shared secret.</span><span class="sxs-lookup"><span data-stu-id="965b4-155">Add the RD Gateway server IP address, application name (optional), and a shared secret.</span></span> <span data-ttu-id="965b4-156">The shared secret needs to be the same on both the Azure Multi-Factor Authentication Server and RD Gateway.</span><span class="sxs-lookup"><span data-stu-id="965b4-156">The shared secret needs to be the same on both the Azure Multi-Factor Authentication Server and RD Gateway.</span></span>
3. <span data-ttu-id="965b4-157">Go to the **Target** tab and select the **RADIUS server(s)** radio button.</span><span class="sxs-lookup"><span data-stu-id="965b4-157">Go to the **Target** tab and select the **RADIUS server(s)** radio button.</span></span>
4. <span data-ttu-id="965b4-158">Select **Add** and enter the IP address, shared secret, and ports of the NPS server.</span><span class="sxs-lookup"><span data-stu-id="965b4-158">Select **Add** and enter the IP address, shared secret, and ports of the NPS server.</span></span> <span data-ttu-id="965b4-159">Unless using a central NPS, the RADIUS client and RADIUS target are the same.</span><span class="sxs-lookup"><span data-stu-id="965b4-159">Unless using a central NPS, the RADIUS client and RADIUS target are the same.</span></span> <span data-ttu-id="965b4-160">The shared secret must match the one setup in the RADIUS client section of the NPS server.</span><span class="sxs-lookup"><span data-stu-id="965b4-160">The shared secret must match the one setup in the RADIUS client section of the NPS server.</span></span>

![Radius Authentication](./media/howto-mfaserver-nps-rdg/radius.png)

## <a name="next-steps"></a><span data-ttu-id="965b4-162">Next steps</span><span class="sxs-lookup"><span data-stu-id="965b4-162">Next steps</span></span>

- <span data-ttu-id="965b4-163">Integrate Azure MFA and [IIS web apps](howto-mfaserver-iis.md)</span><span class="sxs-lookup"><span data-stu-id="965b4-163">Integrate Azure MFA and [IIS web apps](howto-mfaserver-iis.md)</span></span>

- <span data-ttu-id="965b4-164">Get answers in the [Azure Multi-Factor Authentication FAQ](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="965b4-164">Get answers in the [Azure Multi-Factor Authentication FAQ](multi-factor-authentication-faq.md)</span></span>
