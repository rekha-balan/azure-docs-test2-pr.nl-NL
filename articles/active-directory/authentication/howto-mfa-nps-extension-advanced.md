---
title: Configure the Azure MFA NPS extension | Microsoft Docs
description: After you install the NPS extension, use these steps for advanced configuration like IP whitelisting and UPN replacement.
services: multi-factor-authentication
ms.service: active-directory
ms.component: authentication
ms.topic: conceptual
ms.date: 07/11/2018
ms.author: joflore
author: MicrosoftGuyJFlo
manager: mtillman
ms.reviewer: michmcla
ms.openlocfilehash: a857732bcbe70cec164cebb54d7c09a1f103a942
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44866224"
---
# <a name="advanced-configuration-options-for-the-nps-extension-for-multi-factor-authentication"></a><span data-ttu-id="2040a-103">Advanced configuration options for the NPS extension for Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="2040a-103">Advanced configuration options for the NPS extension for Multi-Factor Authentication</span></span>

<span data-ttu-id="2040a-104">The Network Policy Server (NPS) extension extends your cloud-based Azure Multi-Factor Authentication features into your on-premises infrastructure.</span><span class="sxs-lookup"><span data-stu-id="2040a-104">The Network Policy Server (NPS) extension extends your cloud-based Azure Multi-Factor Authentication features into your on-premises infrastructure.</span></span> <span data-ttu-id="2040a-105">This article assumes that you already have the extension installed, and now want to know how to customize the extension for you needs.</span><span class="sxs-lookup"><span data-stu-id="2040a-105">This article assumes that you already have the extension installed, and now want to know how to customize the extension for you needs.</span></span> 

## <a name="alternate-login-id"></a><span data-ttu-id="2040a-106">Alternate login ID</span><span class="sxs-lookup"><span data-stu-id="2040a-106">Alternate login ID</span></span>

<span data-ttu-id="2040a-107">Since the NPS extension connects to both your on-premises and cloud directories, you might encounter an issue where your on-premises user principal names (UPNs) don't match the names in the cloud.</span><span class="sxs-lookup"><span data-stu-id="2040a-107">Since the NPS extension connects to both your on-premises and cloud directories, you might encounter an issue where your on-premises user principal names (UPNs) don't match the names in the cloud.</span></span> <span data-ttu-id="2040a-108">To solve this problem, use alternate login IDs.</span><span class="sxs-lookup"><span data-stu-id="2040a-108">To solve this problem, use alternate login IDs.</span></span> 

<span data-ttu-id="2040a-109">Within the NPS extension, you can designate an Active Directory attribute to be used in place of the UPN for Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="2040a-109">Within the NPS extension, you can designate an Active Directory attribute to be used in place of the UPN for Azure Multi-Factor Authentication.</span></span> <span data-ttu-id="2040a-110">This enables you to protect your on-premises resources with two-step verification without modifying your on-premises UPNs.</span><span class="sxs-lookup"><span data-stu-id="2040a-110">This enables you to protect your on-premises resources with two-step verification without modifying your on-premises UPNs.</span></span> 

<span data-ttu-id="2040a-111">To configure alternate login IDs, go to `HKLM\SOFTWARE\Microsoft\AzureMfa` and edit the following registry values:</span><span class="sxs-lookup"><span data-stu-id="2040a-111">To configure alternate login IDs, go to `HKLM\SOFTWARE\Microsoft\AzureMfa` and edit the following registry values:</span></span>

| <span data-ttu-id="2040a-112">Name</span><span class="sxs-lookup"><span data-stu-id="2040a-112">Name</span></span> | <span data-ttu-id="2040a-113">Type</span><span class="sxs-lookup"><span data-stu-id="2040a-113">Type</span></span> | <span data-ttu-id="2040a-114">Default value</span><span class="sxs-lookup"><span data-stu-id="2040a-114">Default value</span></span> | <span data-ttu-id="2040a-115">Description</span><span class="sxs-lookup"><span data-stu-id="2040a-115">Description</span></span> |
| ---- | ---- | ------------- | ----------- |
| <span data-ttu-id="2040a-116">LDAP_ALTERNATE_LOGINID_ATTRIBUTE</span><span class="sxs-lookup"><span data-stu-id="2040a-116">LDAP_ALTERNATE_LOGINID_ATTRIBUTE</span></span> | <span data-ttu-id="2040a-117">string</span><span class="sxs-lookup"><span data-stu-id="2040a-117">string</span></span> | <span data-ttu-id="2040a-118">Empty</span><span class="sxs-lookup"><span data-stu-id="2040a-118">Empty</span></span> | <span data-ttu-id="2040a-119">Designate the name of Active Directory attribute that you want to use instead of the UPN.</span><span class="sxs-lookup"><span data-stu-id="2040a-119">Designate the name of Active Directory attribute that you want to use instead of the UPN.</span></span> <span data-ttu-id="2040a-120">This attribute is used as the AlternateLoginId attribute.</span><span class="sxs-lookup"><span data-stu-id="2040a-120">This attribute is used as the AlternateLoginId attribute.</span></span> <span data-ttu-id="2040a-121">If this registry value is set to a [valid Active Directory attribute](https://msdn.microsoft.com/library/ms675090.aspx) (for example, mail or displayName), then the attribute's value is used in place of the user's UPN for authentication.</span><span class="sxs-lookup"><span data-stu-id="2040a-121">If this registry value is set to a [valid Active Directory attribute](https://msdn.microsoft.com/library/ms675090.aspx) (for example, mail or displayName), then the attribute's value is used in place of the user's UPN for authentication.</span></span> <span data-ttu-id="2040a-122">If this registry value is empty or not configured, then AlternateLoginId is disabled and the user's UPN is used for authentication.</span><span class="sxs-lookup"><span data-stu-id="2040a-122">If this registry value is empty or not configured, then AlternateLoginId is disabled and the user's UPN is used for authentication.</span></span> |
| <span data-ttu-id="2040a-123">LDAP_FORCE_GLOBAL_CATALOG</span><span class="sxs-lookup"><span data-stu-id="2040a-123">LDAP_FORCE_GLOBAL_CATALOG</span></span> | <span data-ttu-id="2040a-124">boolean</span><span class="sxs-lookup"><span data-stu-id="2040a-124">boolean</span></span> | <span data-ttu-id="2040a-125">False</span><span class="sxs-lookup"><span data-stu-id="2040a-125">False</span></span> | <span data-ttu-id="2040a-126">Use this flag to force the use of Global Catalog for LDAP searches when looking up AlternateLoginId.</span><span class="sxs-lookup"><span data-stu-id="2040a-126">Use this flag to force the use of Global Catalog for LDAP searches when looking up AlternateLoginId.</span></span> <span data-ttu-id="2040a-127">Configure a domain controller as a Global Catalog, add the AlternateLoginId attribute to the Global Catalog, and then enable this flag.</span><span class="sxs-lookup"><span data-stu-id="2040a-127">Configure a domain controller as a Global Catalog, add the AlternateLoginId attribute to the Global Catalog, and then enable this flag.</span></span> <br><br> <span data-ttu-id="2040a-128">If LDAP_LOOKUP_FORESTS is configured (not empty), **this flag is enforced as true**, regardless of the value of the registry setting.</span><span class="sxs-lookup"><span data-stu-id="2040a-128">If LDAP_LOOKUP_FORESTS is configured (not empty), **this flag is enforced as true**, regardless of the value of the registry setting.</span></span> <span data-ttu-id="2040a-129">In this case, the NPS extension requires the Global Catalog to be configured with the AlternateLoginId attribute for each forest.</span><span class="sxs-lookup"><span data-stu-id="2040a-129">In this case, the NPS extension requires the Global Catalog to be configured with the AlternateLoginId attribute for each forest.</span></span> |
| <span data-ttu-id="2040a-130">LDAP_LOOKUP_FORESTS</span><span class="sxs-lookup"><span data-stu-id="2040a-130">LDAP_LOOKUP_FORESTS</span></span> | <span data-ttu-id="2040a-131">string</span><span class="sxs-lookup"><span data-stu-id="2040a-131">string</span></span> | <span data-ttu-id="2040a-132">Empty</span><span class="sxs-lookup"><span data-stu-id="2040a-132">Empty</span></span> | <span data-ttu-id="2040a-133">Provide a semi-colon separated list of forests to search.</span><span class="sxs-lookup"><span data-stu-id="2040a-133">Provide a semi-colon separated list of forests to search.</span></span> <span data-ttu-id="2040a-134">For example, *contoso.com;foobar.com*.</span><span class="sxs-lookup"><span data-stu-id="2040a-134">For example, *contoso.com;foobar.com*.</span></span> <span data-ttu-id="2040a-135">If this registry value is configured, the NPS extension iteratively searches all the forests in the order in which they were listed, and returns the first successful AlternateLoginId value.</span><span class="sxs-lookup"><span data-stu-id="2040a-135">If this registry value is configured, the NPS extension iteratively searches all the forests in the order in which they were listed, and returns the first successful AlternateLoginId value.</span></span> <span data-ttu-id="2040a-136">If this registry value is not configured, the AlternateLoginId lookup is confined to the current domain.</span><span class="sxs-lookup"><span data-stu-id="2040a-136">If this registry value is not configured, the AlternateLoginId lookup is confined to the current domain.</span></span>|

<span data-ttu-id="2040a-137">To troubleshoot problems with alternate login IDs, use the recommended steps for [Alternate login ID errors](howto-mfa-nps-extension-errors.md#alternate-login-id-errors).</span><span class="sxs-lookup"><span data-stu-id="2040a-137">To troubleshoot problems with alternate login IDs, use the recommended steps for [Alternate login ID errors](howto-mfa-nps-extension-errors.md#alternate-login-id-errors).</span></span>

## <a name="ip-exceptions"></a><span data-ttu-id="2040a-138">IP exceptions</span><span class="sxs-lookup"><span data-stu-id="2040a-138">IP exceptions</span></span>

<span data-ttu-id="2040a-139">If you need to monitor server availability, like if load balancers verify which servers are running before sending workloads, you don't want these checks to be blocked by verification requests.</span><span class="sxs-lookup"><span data-stu-id="2040a-139">If you need to monitor server availability, like if load balancers verify which servers are running before sending workloads, you don't want these checks to be blocked by verification requests.</span></span> <span data-ttu-id="2040a-140">Instead, create a list of IP addresses that you know are used by service accounts, and disable Multi-Factor Authentication requirements for that list.</span><span class="sxs-lookup"><span data-stu-id="2040a-140">Instead, create a list of IP addresses that you know are used by service accounts, and disable Multi-Factor Authentication requirements for that list.</span></span> 

<span data-ttu-id="2040a-141">To configure an IP whitelist, go to `HKLM\SOFTWARE\Microsoft\AzureMfa` and configure the following registry value:</span><span class="sxs-lookup"><span data-stu-id="2040a-141">To configure an IP whitelist, go to `HKLM\SOFTWARE\Microsoft\AzureMfa` and configure the following registry value:</span></span> 

| <span data-ttu-id="2040a-142">Name</span><span class="sxs-lookup"><span data-stu-id="2040a-142">Name</span></span> | <span data-ttu-id="2040a-143">Type</span><span class="sxs-lookup"><span data-stu-id="2040a-143">Type</span></span> | <span data-ttu-id="2040a-144">Default value</span><span class="sxs-lookup"><span data-stu-id="2040a-144">Default value</span></span> | <span data-ttu-id="2040a-145">Description</span><span class="sxs-lookup"><span data-stu-id="2040a-145">Description</span></span> |
| ---- | ---- | ------------- | ----------- |
| <span data-ttu-id="2040a-146">IP_WHITELIST</span><span class="sxs-lookup"><span data-stu-id="2040a-146">IP_WHITELIST</span></span> | <span data-ttu-id="2040a-147">string</span><span class="sxs-lookup"><span data-stu-id="2040a-147">string</span></span> | <span data-ttu-id="2040a-148">Empty</span><span class="sxs-lookup"><span data-stu-id="2040a-148">Empty</span></span> | <span data-ttu-id="2040a-149">Provide a semi-colon separated list of IP addresses.</span><span class="sxs-lookup"><span data-stu-id="2040a-149">Provide a semi-colon separated list of IP addresses.</span></span> <span data-ttu-id="2040a-150">Include the IP addresses of machines where service requests originate, like the NAS/VPN server.</span><span class="sxs-lookup"><span data-stu-id="2040a-150">Include the IP addresses of machines where service requests originate, like the NAS/VPN server.</span></span> <span data-ttu-id="2040a-151">IP ranges are subnets are not supported.</span><span class="sxs-lookup"><span data-stu-id="2040a-151">IP ranges are subnets are not supported.</span></span> <br><br> <span data-ttu-id="2040a-152">For example, *10.0.0.1;10.0.0.2;10.0.0.3*.</span><span class="sxs-lookup"><span data-stu-id="2040a-152">For example, *10.0.0.1;10.0.0.2;10.0.0.3*.</span></span>

<span data-ttu-id="2040a-153">When a request comes in from an IP address that exists in the whitelist, two-step verification is skipped.</span><span class="sxs-lookup"><span data-stu-id="2040a-153">When a request comes in from an IP address that exists in the whitelist, two-step verification is skipped.</span></span> <span data-ttu-id="2040a-154">The IP whitelist is compared to the IP address that is provided in the *ratNASIPAddress* attribute of the RADIUS request.</span><span class="sxs-lookup"><span data-stu-id="2040a-154">The IP whitelist is compared to the IP address that is provided in the *ratNASIPAddress* attribute of the RADIUS request.</span></span> <span data-ttu-id="2040a-155">If a RADIUS request comes in without the ratNASIPAddress attribute, the following warning is logged: "P_WHITE_LIST_WARNING::IP Whitelist is being ignored as source IP is missing in RADIUS request in NasIpAddress attribute."</span><span class="sxs-lookup"><span data-stu-id="2040a-155">If a RADIUS request comes in without the ratNASIPAddress attribute, the following warning is logged: "P_WHITE_LIST_WARNING::IP Whitelist is being ignored as source IP is missing in RADIUS request in NasIpAddress attribute."</span></span>

## <a name="next-steps"></a><span data-ttu-id="2040a-156">Next steps</span><span class="sxs-lookup"><span data-stu-id="2040a-156">Next steps</span></span>

[<span data-ttu-id="2040a-157">Resolve error messages from the NPS extension for Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="2040a-157">Resolve error messages from the NPS extension for Azure Multi-Factor Authentication</span></span>](howto-mfa-nps-extension-errors.md)