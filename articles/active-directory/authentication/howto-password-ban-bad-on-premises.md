---
title: Deploy Azure AD password protection preview
description: Deploy the Azure AD password protection preview to ban bad passwords on-premises
services: active-directory
ms.service: active-directory
ms.component: authentication
ms.topic: conceptual
ms.date: 07/25/2018
ms.author: joflore
author: MicrosoftGuyJFlo
manager: mtillman
ms.reviewer: jsimmons
ms.openlocfilehash: 5928896ab3c89972b7912f686be045afc988b1cd
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44871712"
---
# <a name="preview-deploy-azure-ad-password-protection"></a><span data-ttu-id="98291-103">Preview: Deploy Azure AD password protection</span><span class="sxs-lookup"><span data-stu-id="98291-103">Preview: Deploy Azure AD password protection</span></span>

|     |
| --- |
| <span data-ttu-id="98291-104">Azure AD password protection and the custom banned password list are public preview features of Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="98291-104">Azure AD password protection and the custom banned password list are public preview features of Azure Active Directory.</span></span> <span data-ttu-id="98291-105">For more information about previews, see  [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)</span><span class="sxs-lookup"><span data-stu-id="98291-105">For more information about previews, see  [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)</span></span>|
|     |

<span data-ttu-id="98291-106">Now that we have an understanding of [how to enforce Azure AD password protection for Windows Server Active Directory](concept-password-ban-bad-on-premises.md), the next step is to plan and execute the deployment.</span><span class="sxs-lookup"><span data-stu-id="98291-106">Now that we have an understanding of [how to enforce Azure AD password protection for Windows Server Active Directory](concept-password-ban-bad-on-premises.md), the next step is to plan and execute the deployment.</span></span>

## <a name="deployment-strategy"></a><span data-ttu-id="98291-107">Deployment strategy</span><span class="sxs-lookup"><span data-stu-id="98291-107">Deployment strategy</span></span>

<span data-ttu-id="98291-108">Microsoft suggests that any deployment start in audit mode.</span><span class="sxs-lookup"><span data-stu-id="98291-108">Microsoft suggests that any deployment start in audit mode.</span></span> <span data-ttu-id="98291-109">Audit mode is the default initial setting where passwords can continue to be set and any that would be blocked create entries in the event log.</span><span class="sxs-lookup"><span data-stu-id="98291-109">Audit mode is the default initial setting where passwords can continue to be set and any that would be blocked create entries in the event log.</span></span> <span data-ttu-id="98291-110">Once proxy server(s) and DC agents are fully deployed in audit mode, regular monitoring should be done in order to determine what impact password policy enforcement would have on users and the environment if the policy was enforced.</span><span class="sxs-lookup"><span data-stu-id="98291-110">Once proxy server(s) and DC agents are fully deployed in audit mode, regular monitoring should be done in order to determine what impact password policy enforcement would have on users and the environment if the policy was enforced.</span></span>

<span data-ttu-id="98291-111">During the audit stage, many organizations find:</span><span class="sxs-lookup"><span data-stu-id="98291-111">During the audit stage, many organizations find:</span></span>

* <span data-ttu-id="98291-112">They need to improve existing operational processes to use more secure passwords.</span><span class="sxs-lookup"><span data-stu-id="98291-112">They need to improve existing operational processes to use more secure passwords.</span></span>
* <span data-ttu-id="98291-113">Users are accustomed to regularly choosing unsecure passwords</span><span class="sxs-lookup"><span data-stu-id="98291-113">Users are accustomed to regularly choosing unsecure passwords</span></span>
* <span data-ttu-id="98291-114">They need to inform users about the upcoming change in security enforcement, the impact it may have on them, and help them better understand how they can choose more secure passwords.</span><span class="sxs-lookup"><span data-stu-id="98291-114">They need to inform users about the upcoming change in security enforcement, the impact it may have on them, and help them better understand how they can choose more secure passwords.</span></span>

<span data-ttu-id="98291-115">Once the feature has been running in audit mode for a reasonable time, the enforcement configuration can be flipped from **Audit** to **Enforce** thereby requiring more secure passwords.</span><span class="sxs-lookup"><span data-stu-id="98291-115">Once the feature has been running in audit mode for a reasonable time, the enforcement configuration can be flipped from **Audit** to **Enforce** thereby requiring more secure passwords.</span></span> <span data-ttu-id="98291-116">Focused monitoring during this time is a good idea.</span><span class="sxs-lookup"><span data-stu-id="98291-116">Focused monitoring during this time is a good idea.</span></span>

## <a name="known-limitation"></a><span data-ttu-id="98291-117">Known limitation</span><span class="sxs-lookup"><span data-stu-id="98291-117">Known limitation</span></span>

<span data-ttu-id="98291-118">There is a known limitation in the preview version of the Azure AD password protection proxy.</span><span class="sxs-lookup"><span data-stu-id="98291-118">There is a known limitation in the preview version of the Azure AD password protection proxy.</span></span> <span data-ttu-id="98291-119">Use of tenant administrator accounts that require MFA is unsupported.</span><span class="sxs-lookup"><span data-stu-id="98291-119">Use of tenant administrator accounts that require MFA is unsupported.</span></span> <span data-ttu-id="98291-120">A future update of the Azure AD password protection proxy will support proxy registration with administrator accounts that require MFA.</span><span class="sxs-lookup"><span data-stu-id="98291-120">A future update of the Azure AD password protection proxy will support proxy registration with administrator accounts that require MFA.</span></span>

## <a name="single-forest-deployment"></a><span data-ttu-id="98291-121">Single forest deployment</span><span class="sxs-lookup"><span data-stu-id="98291-121">Single forest deployment</span></span>

<span data-ttu-id="98291-122">The preview of Azure AD password protection is deployed with the proxy service on up to two servers, and the DC agent service can be incrementally deployed to all domain controllers in the Active Directory forest.</span><span class="sxs-lookup"><span data-stu-id="98291-122">The preview of Azure AD password protection is deployed with the proxy service on up to two servers, and the DC agent service can be incrementally deployed to all domain controllers in the Active Directory forest.</span></span>

![How Azure AD password protection components work together](./media/concept-password-ban-bad-on-premises/azure-ad-password-protection.png)

### <a name="download-the-software"></a><span data-ttu-id="98291-124">Download the software</span><span class="sxs-lookup"><span data-stu-id="98291-124">Download the software</span></span>

<span data-ttu-id="98291-125">There are two required installers for Azure AD password protection that can be downloaded from the [Microsoft download center](https://www.microsoft.com/download/details.aspx?id=57071)</span><span class="sxs-lookup"><span data-stu-id="98291-125">There are two required installers for Azure AD password protection that can be downloaded from the [Microsoft download center](https://www.microsoft.com/download/details.aspx?id=57071)</span></span>

### <a name="install-and-configure-the-azure-ad-password-protection-proxy-service"></a><span data-ttu-id="98291-126">Install and configure the Azure AD password protection proxy service</span><span class="sxs-lookup"><span data-stu-id="98291-126">Install and configure the Azure AD password protection proxy service</span></span>

1. <span data-ttu-id="98291-127">Choose one or more servers to host the Azure AD password protection proxy service.</span><span class="sxs-lookup"><span data-stu-id="98291-127">Choose one or more servers to host the Azure AD password protection proxy service.</span></span>
   * <span data-ttu-id="98291-128">Each such service can only provide password policies for a single forest, and the host machine must be domain-joined to a domain (root and child are both equally supported) in that forest.</span><span class="sxs-lookup"><span data-stu-id="98291-128">Each such service can only provide password policies for a single forest, and the host machine must be domain-joined to a domain (root and child are both equally supported) in that forest.</span></span> <span data-ttu-id="98291-129">For Azure AD password protection proxy service to fulfill its mission, there must exist network connectivity between at least one DC in each domain of the forest, and the Azure AD password protection Proxy host machine.</span><span class="sxs-lookup"><span data-stu-id="98291-129">For Azure AD password protection proxy service to fulfill its mission, there must exist network connectivity between at least one DC in each domain of the forest, and the Azure AD password protection Proxy host machine.</span></span>
   * <span data-ttu-id="98291-130">It is supported to install and run the Azure AD password protection proxy service on a domain controller for testing purposes but the domain controller then requires internet connectivity.</span><span class="sxs-lookup"><span data-stu-id="98291-130">It is supported to install and run the Azure AD password protection proxy service on a domain controller for testing purposes but the domain controller then requires internet connectivity.</span></span>

   > [!NOTE]
   > <span data-ttu-id="98291-131">The public preview supports a maximum of two (2) proxy servers per forest.</span><span class="sxs-lookup"><span data-stu-id="98291-131">The public preview supports a maximum of two (2) proxy servers per forest.</span></span>

2. <span data-ttu-id="98291-132">Install the Password Policy Proxy Service software using the AzureADPasswordProtectionProxy.msi MSI package.</span><span class="sxs-lookup"><span data-stu-id="98291-132">Install the Password Policy Proxy Service software using the AzureADPasswordProtectionProxy.msi MSI package.</span></span>
   * <span data-ttu-id="98291-133">The software installation does not require a reboot.</span><span class="sxs-lookup"><span data-stu-id="98291-133">The software installation does not require a reboot.</span></span> <span data-ttu-id="98291-134">The software installation may be automated using standard MSI procedures, for example: `msiexec.exe /i AzureADPasswordProtectionProxy.msi /quiet /qn`</span><span class="sxs-lookup"><span data-stu-id="98291-134">The software installation may be automated using standard MSI procedures, for example: `msiexec.exe /i AzureADPasswordProtectionProxy.msi /quiet /qn`</span></span>

3. <span data-ttu-id="98291-135">Open a PowerShell window as an Administrator.</span><span class="sxs-lookup"><span data-stu-id="98291-135">Open a PowerShell window as an Administrator.</span></span>
   * <span data-ttu-id="98291-136">The Azure AD password protection Proxy software includes a new PowerShell module named AzureADPasswordProtection.</span><span class="sxs-lookup"><span data-stu-id="98291-136">The Azure AD password protection Proxy software includes a new PowerShell module named AzureADPasswordProtection.</span></span> <span data-ttu-id="98291-137">The following steps are based on running various cmdlets from this PowerShell module, and assume that you have opened a new PowerShell window and have imported the new module as follows:</span><span class="sxs-lookup"><span data-stu-id="98291-137">The following steps are based on running various cmdlets from this PowerShell module, and assume that you have opened a new PowerShell window and have imported the new module as follows:</span></span>
      * `Import-Module AzureADPasswordProtection`

      > [!NOTE]
      > <span data-ttu-id="98291-138">The installation software modifies the host machine’s PSModulePath environment variable.</span><span class="sxs-lookup"><span data-stu-id="98291-138">The installation software modifies the host machine’s PSModulePath environment variable.</span></span> <span data-ttu-id="98291-139">In order for this change to take effect so that the AzureADPasswordProtection powershell module can be imported and used, you may need to open a brand new PowerShell console window.</span><span class="sxs-lookup"><span data-stu-id="98291-139">In order for this change to take effect so that the AzureADPasswordProtection powershell module can be imported and used, you may need to open a brand new PowerShell console window.</span></span>

   * <span data-ttu-id="98291-140">Check that the service is running using the following PowerShell command: `Get-Service AzureADPasswordProtectionProxy | fl`.</span><span class="sxs-lookup"><span data-stu-id="98291-140">Check that the service is running using the following PowerShell command: `Get-Service AzureADPasswordProtectionProxy | fl`.</span></span>
      * <span data-ttu-id="98291-141">The result should produce a result with the **Status** returning a "Running" result.</span><span class="sxs-lookup"><span data-stu-id="98291-141">The result should produce a result with the **Status** returning a "Running" result.</span></span>

4. <span data-ttu-id="98291-142">Register the proxy.</span><span class="sxs-lookup"><span data-stu-id="98291-142">Register the proxy.</span></span>
   * <span data-ttu-id="98291-143">Once step 3 has been completed the Azure AD password protection proxy service is running on the machine, but does not yet have the necessary credentials to communicate with Azure AD.</span><span class="sxs-lookup"><span data-stu-id="98291-143">Once step 3 has been completed the Azure AD password protection proxy service is running on the machine, but does not yet have the necessary credentials to communicate with Azure AD.</span></span> <span data-ttu-id="98291-144">Registration with Azure AD is required to enable that ability using the `Register-AzureADPasswordProtectionProxy` PowerShell cmdlet.</span><span class="sxs-lookup"><span data-stu-id="98291-144">Registration with Azure AD is required to enable that ability using the `Register-AzureADPasswordProtectionProxy` PowerShell cmdlet.</span></span> <span data-ttu-id="98291-145">The cmdlet requires global administrator credentials for your Azure tenant as well as on-premises Active Directory domain administrator privileges in the forest root domain.</span><span class="sxs-lookup"><span data-stu-id="98291-145">The cmdlet requires global administrator credentials for your Azure tenant as well as on-premises Active Directory domain administrator privileges in the forest root domain.</span></span> <span data-ttu-id="98291-146">Once it has succeeded for a given proxy service, additional invocations of `Register-AzureADPasswordProtectionProxy` continue to succeed but are unnecessary.</span><span class="sxs-lookup"><span data-stu-id="98291-146">Once it has succeeded for a given proxy service, additional invocations of `Register-AzureADPasswordProtectionProxy` continue to succeed but are unnecessary.</span></span>
      * <span data-ttu-id="98291-147">The cmdlet may be run as follows:</span><span class="sxs-lookup"><span data-stu-id="98291-147">The cmdlet may be run as follows:</span></span>

         ```
         $tenantAdminCreds = Get-Credential
         Register-AzureADPasswordProtectionProxy -AzureCredential $tenantAdminCreds
         ```

         <span data-ttu-id="98291-148">The example only works if the currently logged in user is also an Active Directory domain administrator for the root domain.</span><span class="sxs-lookup"><span data-stu-id="98291-148">The example only works if the currently logged in user is also an Active Directory domain administrator for the root domain.</span></span> <span data-ttu-id="98291-149">An alternative is to supply the necessary domain credentials via the `-ForestCredential` parameter.</span><span class="sxs-lookup"><span data-stu-id="98291-149">An alternative is to supply the necessary domain credentials via the `-ForestCredential` parameter.</span></span>

   > [!TIP]
   > <span data-ttu-id="98291-150">There may be a considerable delay (many seconds) the first time this cmdlet is run for a given Azure tenant before the cmdlet completes execution.</span><span class="sxs-lookup"><span data-stu-id="98291-150">There may be a considerable delay (many seconds) the first time this cmdlet is run for a given Azure tenant before the cmdlet completes execution.</span></span> <span data-ttu-id="98291-151">Unless a failure is reported this delay should not be considered alarming.</span><span class="sxs-lookup"><span data-stu-id="98291-151">Unless a failure is reported this delay should not be considered alarming.</span></span>

   > [!NOTE]
   > <span data-ttu-id="98291-152">Registration of the Azure AD password protection proxy service is expected to be a one-time step in the lifetime of the service.</span><span class="sxs-lookup"><span data-stu-id="98291-152">Registration of the Azure AD password protection proxy service is expected to be a one-time step in the lifetime of the service.</span></span> <span data-ttu-id="98291-153">The proxy service will automatically perform any other necessary maintainenance from this point onwards.</span><span class="sxs-lookup"><span data-stu-id="98291-153">The proxy service will automatically perform any other necessary maintainenance from this point onwards.</span></span> <span data-ttu-id="98291-154">Once it has succeeded for a given forest, additional invocations of 'Register-AzureADPasswordProtectionProxy' continue to succeed but are unnecessary.</span><span class="sxs-lookup"><span data-stu-id="98291-154">Once it has succeeded for a given forest, additional invocations of 'Register-AzureADPasswordProtectionProxy' continue to succeed but are unnecessary.</span></span>

5. <span data-ttu-id="98291-155">Register the forest.</span><span class="sxs-lookup"><span data-stu-id="98291-155">Register the forest.</span></span>
   * <span data-ttu-id="98291-156">The on-premises Active Directory forest must be initialized with the necessary credentials to communicate with Azure using the `Register-AzureADPasswordProtectionForest` Powershell cmdlet.</span><span class="sxs-lookup"><span data-stu-id="98291-156">The on-premises Active Directory forest must be initialized with the necessary credentials to communicate with Azure using the `Register-AzureADPasswordProtectionForest` Powershell cmdlet.</span></span> <span data-ttu-id="98291-157">The cmdlet requires global administrator credentials for your Azure tenant as well as on-premises Active Directory domain administrator privileges in the forest root domain.</span><span class="sxs-lookup"><span data-stu-id="98291-157">The cmdlet requires global administrator credentials for your Azure tenant as well as on-premises Active Directory domain administrator privileges in the forest root domain.</span></span> <span data-ttu-id="98291-158">This step is run once per forest.</span><span class="sxs-lookup"><span data-stu-id="98291-158">This step is run once per forest.</span></span>
      * <span data-ttu-id="98291-159">The cmdlet may be run as follows:</span><span class="sxs-lookup"><span data-stu-id="98291-159">The cmdlet may be run as follows:</span></span>

         ```
         $tenantAdminCreds = Get-Credential
         Register-AzureADPasswordProtectionForest -AzureCredential $tenantAdminCreds
         ```

         <span data-ttu-id="98291-160">The example only works if the currently logged in user is also an Active Directory domain administrator for the root domain.</span><span class="sxs-lookup"><span data-stu-id="98291-160">The example only works if the currently logged in user is also an Active Directory domain administrator for the root domain.</span></span> <span data-ttu-id="98291-161">An alternative is to supply the necessary domain credentials via the -ForestCredential parameter.</span><span class="sxs-lookup"><span data-stu-id="98291-161">An alternative is to supply the necessary domain credentials via the -ForestCredential parameter.</span></span>

         > [!NOTE]
         > <span data-ttu-id="98291-162">If multiple proxy servers are installed in your environment, it does not matter which proxy server is specified in the procedure above.</span><span class="sxs-lookup"><span data-stu-id="98291-162">If multiple proxy servers are installed in your environment, it does not matter which proxy server is specified in the procedure above.</span></span>

         > [!TIP]
         > <span data-ttu-id="98291-163">There may be a considerable delay (many seconds) the first time this cmdlet is run for a given Azure tenant before the cmdlet completes execution.</span><span class="sxs-lookup"><span data-stu-id="98291-163">There may be a considerable delay (many seconds) the first time this cmdlet is run for a given Azure tenant before the cmdlet completes execution.</span></span> <span data-ttu-id="98291-164">Unless a failure is reported this delay should not be considered alarming.</span><span class="sxs-lookup"><span data-stu-id="98291-164">Unless a failure is reported this delay should not be considered alarming.</span></span>

   > [!NOTE]
   > <span data-ttu-id="98291-165">Registration of the Active Directory forest is expected to be a one-time step in the lifetime of the forest.</span><span class="sxs-lookup"><span data-stu-id="98291-165">Registration of the Active Directory forest is expected to be a one-time step in the lifetime of the forest.</span></span> <span data-ttu-id="98291-166">The domain controller agents running in the forest will automatically perform any other necessary maintainenance from this point onwards.</span><span class="sxs-lookup"><span data-stu-id="98291-166">The domain controller agents running in the forest will automatically perform any other necessary maintainenance from this point onwards.</span></span> <span data-ttu-id="98291-167">Once it has succeeded for a given forest, additional invocations of `Register-AzureADPasswordProtectionForest` continue to succeed but are unnecessary.</span><span class="sxs-lookup"><span data-stu-id="98291-167">Once it has succeeded for a given forest, additional invocations of `Register-AzureADPasswordProtectionForest` continue to succeed but are unnecessary.</span></span>

   > [!NOTE]
   > <span data-ttu-id="98291-168">In order for `Register-AzureADPasswordProtectionForest` to succeed at least one Windows Server 2012 or later domain controller must be available in the proxy server's domain.</span><span class="sxs-lookup"><span data-stu-id="98291-168">In order for `Register-AzureADPasswordProtectionForest` to succeed at least one Windows Server 2012 or later domain controller must be available in the proxy server's domain.</span></span> <span data-ttu-id="98291-169">However there is no requirement that the DC agent software be installed on any domain controllers prior to this step.</span><span class="sxs-lookup"><span data-stu-id="98291-169">However there is no requirement that the DC agent software be installed on any domain controllers prior to this step.</span></span>

6. <span data-ttu-id="98291-170">Optional: Configure the Azure AD password protection proxy service to listen on a specific port.</span><span class="sxs-lookup"><span data-stu-id="98291-170">Optional: Configure the Azure AD password protection proxy service to listen on a specific port.</span></span>
   * <span data-ttu-id="98291-171">RPC over TCP is used by the Azure AD password protection DC Agent software on the domain controllers to communicate with the Azure AD password protection proxy service.</span><span class="sxs-lookup"><span data-stu-id="98291-171">RPC over TCP is used by the Azure AD password protection DC Agent software on the domain controllers to communicate with the Azure AD password protection proxy service.</span></span> <span data-ttu-id="98291-172">By default, the Azure AD password protection Password Policy Proxy service listens on any available dynamic RPC endpoint.</span><span class="sxs-lookup"><span data-stu-id="98291-172">By default, the Azure AD password protection Password Policy Proxy service listens on any available dynamic RPC endpoint.</span></span> <span data-ttu-id="98291-173">If necessary due to networking topology or firewall requirements, the service may instead be configured to listen on a specific TCP port.</span><span class="sxs-lookup"><span data-stu-id="98291-173">If necessary due to networking topology or firewall requirements, the service may instead be configured to listen on a specific TCP port.</span></span>
      * <span data-ttu-id="98291-174">To configure the service to run under a static port, use the `Set-AzureADPasswordProtectionProxyConfiguration` cmdlet.</span><span class="sxs-lookup"><span data-stu-id="98291-174">To configure the service to run under a static port, use the `Set-AzureADPasswordProtectionProxyConfiguration` cmdlet.</span></span>
         ```
         Set-AzureADPasswordProtectionProxyConfiguration –StaticPort <portnumber>
         ```

         > [!WARNING]
         > <span data-ttu-id="98291-175">You must stop and restart the service for these changes to take effect.</span><span class="sxs-lookup"><span data-stu-id="98291-175">You must stop and restart the service for these changes to take effect.</span></span>

      * <span data-ttu-id="98291-176">To configure the service to run under a dynamic port, use the same procedure but set StaticPort back to zero, like so:</span><span class="sxs-lookup"><span data-stu-id="98291-176">To configure the service to run under a dynamic port, use the same procedure but set StaticPort back to zero, like so:</span></span>
         ```
         Set-AzureADPasswordProtectionProxyConfiguration –StaticPort 0
         ```

         > [!WARNING]
         > <span data-ttu-id="98291-177">You must stop and restart the service for these changes to take effect.</span><span class="sxs-lookup"><span data-stu-id="98291-177">You must stop and restart the service for these changes to take effect.</span></span>

   > [!NOTE]
   > <span data-ttu-id="98291-178">The Azure AD password protection proxy service requires a manual restart after any change in port configuration.</span><span class="sxs-lookup"><span data-stu-id="98291-178">The Azure AD password protection proxy service requires a manual restart after any change in port configuration.</span></span> <span data-ttu-id="98291-179">It is not necessary to restart the DC agent service software running on domain controllers after making configuration changes of this nature.</span><span class="sxs-lookup"><span data-stu-id="98291-179">It is not necessary to restart the DC agent service software running on domain controllers after making configuration changes of this nature.</span></span>

   * <span data-ttu-id="98291-180">The current configuration of the service may be queried using the `Get-AzureADPasswordProtectionProxyConfiguration` cmdlet as the following example shows:</span><span class="sxs-lookup"><span data-stu-id="98291-180">The current configuration of the service may be queried using the `Get-AzureADPasswordProtectionProxyConfiguration` cmdlet as the following example shows:</span></span>

      ```
      Get-AzureADPasswordProtectionProxyConfiguration | fl

      ServiceName : AzureADPasswordProtectionProxy
      DisplayName : Azure AD password protection Proxy
      StaticPort  : 0 
      ```

### <a name="install-the-azure-ad-password-protection-dc-agent-service"></a><span data-ttu-id="98291-181">Install the Azure AD password protection DC agent service</span><span class="sxs-lookup"><span data-stu-id="98291-181">Install the Azure AD password protection DC agent service</span></span>

* <span data-ttu-id="98291-182">Install the Azure AD password protection DC agent service software using the `AzureADPasswordProtectionDCAgent.msi` MSI package:</span><span class="sxs-lookup"><span data-stu-id="98291-182">Install the Azure AD password protection DC agent service software using the `AzureADPasswordProtectionDCAgent.msi` MSI package:</span></span>
   * <span data-ttu-id="98291-183">The software installation does require a reboot on install and uninstall due to the operating system requirement that password filter dlls are only loaded or unloaded upon a reboot.</span><span class="sxs-lookup"><span data-stu-id="98291-183">The software installation does require a reboot on install and uninstall due to the operating system requirement that password filter dlls are only loaded or unloaded upon a reboot.</span></span>
   * <span data-ttu-id="98291-184">It is supported to install the DC agent service on a machine that is not yet a domain-controller.</span><span class="sxs-lookup"><span data-stu-id="98291-184">It is supported to install the DC agent service on a machine that is not yet a domain-controller.</span></span> <span data-ttu-id="98291-185">In this case, the service will start and run but will otherwise be inactive until after the machine is promoted to be a domain controller.</span><span class="sxs-lookup"><span data-stu-id="98291-185">In this case, the service will start and run but will otherwise be inactive until after the machine is promoted to be a domain controller.</span></span>

   <span data-ttu-id="98291-186">The software installation may be automated using standard MSI procedures, for example:  `msiexec.exe /i AzureADPasswordProtectionDCAgent.msi /quiet /qn`</span><span class="sxs-lookup"><span data-stu-id="98291-186">The software installation may be automated using standard MSI procedures, for example:  `msiexec.exe /i AzureADPasswordProtectionDCAgent.msi /quiet /qn`</span></span>

   > [!WARNING]
   > <span data-ttu-id="98291-187">The example msiexec command will result in an immediate reboot; this can be avoided by specifying the `/norestart` flag.</span><span class="sxs-lookup"><span data-stu-id="98291-187">The example msiexec command will result in an immediate reboot; this can be avoided by specifying the `/norestart` flag.</span></span>

<span data-ttu-id="98291-188">Once installed on a domain controller and rebooted, the Azure AD password protection DC Agent software installation is complete.</span><span class="sxs-lookup"><span data-stu-id="98291-188">Once installed on a domain controller and rebooted, the Azure AD password protection DC Agent software installation is complete.</span></span> <span data-ttu-id="98291-189">No other configuration is required or possible.</span><span class="sxs-lookup"><span data-stu-id="98291-189">No other configuration is required or possible.</span></span>

## <a name="multiple-forest-deployments"></a><span data-ttu-id="98291-190">Multiple forest deployments</span><span class="sxs-lookup"><span data-stu-id="98291-190">Multiple forest deployments</span></span>

<span data-ttu-id="98291-191">There are no additional requirements to deploy Azure AD password protection across multiple forests.</span><span class="sxs-lookup"><span data-stu-id="98291-191">There are no additional requirements to deploy Azure AD password protection across multiple forests.</span></span> <span data-ttu-id="98291-192">Each forest is independently configured as described in the single forest deployment section.</span><span class="sxs-lookup"><span data-stu-id="98291-192">Each forest is independently configured as described in the single forest deployment section.</span></span> <span data-ttu-id="98291-193">Each Azure AD password protection Proxy can only support domain controllers from the forest it is joined to.</span><span class="sxs-lookup"><span data-stu-id="98291-193">Each Azure AD password protection Proxy can only support domain controllers from the forest it is joined to.</span></span> <span data-ttu-id="98291-194">The Azure AD password protection software in a given forest is unaware of Azure AD password protection software deployed in another forest regardless of Active Directory trust configurations.</span><span class="sxs-lookup"><span data-stu-id="98291-194">The Azure AD password protection software in a given forest is unaware of Azure AD password protection software deployed in another forest regardless of Active Directory trust configurations.</span></span>

## <a name="read-only-domain-controllers"></a><span data-ttu-id="98291-195">Read-only domain controllers</span><span class="sxs-lookup"><span data-stu-id="98291-195">Read-only domain controllers</span></span>

<span data-ttu-id="98291-196">Password changes\sets are never processed and persisted on read-only domain controllers (RODCs); instead, these are forwarded to writable domain controllers.</span><span class="sxs-lookup"><span data-stu-id="98291-196">Password changes\sets are never processed and persisted on read-only domain controllers (RODCs); instead, these are forwarded to writable domain controllers.</span></span> <span data-ttu-id="98291-197">Therefore there is no need to install the DC agent software on RODCs.</span><span class="sxs-lookup"><span data-stu-id="98291-197">Therefore there is no need to install the DC agent software on RODCs.</span></span>

## <a name="high-availability"></a><span data-ttu-id="98291-198">High availability</span><span class="sxs-lookup"><span data-stu-id="98291-198">High availability</span></span>

<span data-ttu-id="98291-199">The main concern with ensuring high availability of Azure AD password protection is the availability of the proxy servers, when domain controllers in a forest are attempting to download new policies or other data from Azure.</span><span class="sxs-lookup"><span data-stu-id="98291-199">The main concern with ensuring high availability of Azure AD password protection is the availability of the proxy servers, when domain controllers in a forest are attempting to download new policies or other data from Azure.</span></span> <span data-ttu-id="98291-200">The public preview supports a maximum of two proxy servers per forest.</span><span class="sxs-lookup"><span data-stu-id="98291-200">The public preview supports a maximum of two proxy servers per forest.</span></span> <span data-ttu-id="98291-201">Each DC agent uses a simple round-robin style algorithm when deciding which proxy server to call, and skips over proxy servers that are not responding.</span><span class="sxs-lookup"><span data-stu-id="98291-201">Each DC agent uses a simple round-robin style algorithm when deciding which proxy server to call, and skips over proxy servers that are not responding.</span></span>
<span data-ttu-id="98291-202">The usual problems associated with high availability are mitigated by the design of the DC agent software.</span><span class="sxs-lookup"><span data-stu-id="98291-202">The usual problems associated with high availability are mitigated by the design of the DC agent software.</span></span> <span data-ttu-id="98291-203">The DC agent maintains a local cache of the most recently downloaded password policy.</span><span class="sxs-lookup"><span data-stu-id="98291-203">The DC agent maintains a local cache of the most recently downloaded password policy.</span></span> <span data-ttu-id="98291-204">Even if all registered proxy servers become unavailable for any reason, the DC agent(s) continue to enforce their cached password policy.</span><span class="sxs-lookup"><span data-stu-id="98291-204">Even if all registered proxy servers become unavailable for any reason, the DC agent(s) continue to enforce their cached password policy.</span></span> <span data-ttu-id="98291-205">A reasonable update frequency for password policies in a large deployment is usually on the order of days, not hours or less.</span><span class="sxs-lookup"><span data-stu-id="98291-205">A reasonable update frequency for password policies in a large deployment is usually on the order of days, not hours or less.</span></span>   <span data-ttu-id="98291-206">Therefore brief outages of the proxy servers do not cause significant impact to the operation of the Azure AD password protection feature or its security benefits.</span><span class="sxs-lookup"><span data-stu-id="98291-206">Therefore brief outages of the proxy servers do not cause significant impact to the operation of the Azure AD password protection feature or its security benefits.</span></span>

## <a name="next-steps"></a><span data-ttu-id="98291-207">Next steps</span><span class="sxs-lookup"><span data-stu-id="98291-207">Next steps</span></span>

<span data-ttu-id="98291-208">Now that you have installed the services required for Azure AD password protection on your on-premises servers complete the [post-install configuration and gather reporting information](howto-password-ban-bad-on-premises-operations.md) to complete your deployment.</span><span class="sxs-lookup"><span data-stu-id="98291-208">Now that you have installed the services required for Azure AD password protection on your on-premises servers complete the [post-install configuration and gather reporting information](howto-password-ban-bad-on-premises-operations.md) to complete your deployment.</span></span>

[<span data-ttu-id="98291-209">Conceptual overview of Azure AD password protection</span><span class="sxs-lookup"><span data-stu-id="98291-209">Conceptual overview of Azure AD password protection</span></span>](concept-password-ban-bad-on-premises.md)
