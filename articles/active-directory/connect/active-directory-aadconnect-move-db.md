---
title: Move Azure AD Connect database from SQL Server Express to SQL Server. | Microsoft Docs
description: This document describes how to move the Azure AD Connect database from the local SQL Server Express server to a remote SQL Server.
services: active-directory
author: billmath
manager: mtillman
ms.service: active-directory
ms.workload: identity
ms.topic: get-started-article
ms.date: 03/19/2018
ms.component: hybrid
ms.author: billmath
ms.openlocfilehash: 16b8cb843b7081c2489f1b8048d896858c5424c2
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44867838"
---
# <a name="move-azure-ad-connect-database-from-sql-server-express-to-sql-server"></a><span data-ttu-id="762e0-104">Move Azure AD Connect database from SQL Server Express to SQL Server</span><span class="sxs-lookup"><span data-stu-id="762e0-104">Move Azure AD Connect database from SQL Server Express to SQL Server</span></span> 

<span data-ttu-id="762e0-105">This document describes how to move the Azure AD Connect database from the local SQL Server Express server to a remote SQL Server.</span><span class="sxs-lookup"><span data-stu-id="762e0-105">This document describes how to move the Azure AD Connect database from the local SQL Server Express server to a remote SQL Server.</span></span>  <span data-ttu-id="762e0-106">You can use the following procedures below to accomplish this task.</span><span class="sxs-lookup"><span data-stu-id="762e0-106">You can use the following procedures below to accomplish this task.</span></span>

## <a name="about-this-scenario"></a><span data-ttu-id="762e0-107">About this scenario</span><span class="sxs-lookup"><span data-stu-id="762e0-107">About this scenario</span></span>
<span data-ttu-id="762e0-108">The following is some brief information about this scenario.</span><span class="sxs-lookup"><span data-stu-id="762e0-108">The following is some brief information about this scenario.</span></span>  <span data-ttu-id="762e0-109">In this scenario, Azure AD Connect version (1.1.819.0) is installed on a single Windows Server 2016 domain controller.</span><span class="sxs-lookup"><span data-stu-id="762e0-109">In this scenario, Azure AD Connect version (1.1.819.0) is installed on a single Windows Server 2016 domain controller.</span></span>  <span data-ttu-id="762e0-110">It is using the built-in SQL Server 2012 Express Edition for its database.</span><span class="sxs-lookup"><span data-stu-id="762e0-110">It is using the built-in SQL Server 2012 Express Edition for its database.</span></span>  <span data-ttu-id="762e0-111">The database will be moved to a SQL Server 2017 server.</span><span class="sxs-lookup"><span data-stu-id="762e0-111">The database will be moved to a SQL Server 2017 server.</span></span>

![](media/active-directory-aadconnect-move-db/move1.png)

## <a name="move-the-azure-ad-connect-database"></a><span data-ttu-id="762e0-112">Move the Azure AD Connect database</span><span class="sxs-lookup"><span data-stu-id="762e0-112">Move the Azure AD Connect database</span></span>
<span data-ttu-id="762e0-113">Use the following steps to move the Azure AD Connect database to a remote SQL Server.</span><span class="sxs-lookup"><span data-stu-id="762e0-113">Use the following steps to move the Azure AD Connect database to a remote SQL Server.</span></span>

1.  <span data-ttu-id="762e0-114">On the Azure AD Connect server, go to **Services** and stop the **Microsoft Azure AD Sync** service.</span><span class="sxs-lookup"><span data-stu-id="762e0-114">On the Azure AD Connect server, go to **Services** and stop the **Microsoft Azure AD Sync** service.</span></span>
2. <span data-ttu-id="762e0-115">Locate the **%Program Files%\Microsoft Azure AD Sync/Data/** folder and copy the **ADSync.mdf** and **ADSync_log.mdf** files to the remote SQL Server.</span><span class="sxs-lookup"><span data-stu-id="762e0-115">Locate the **%Program Files%\Microsoft Azure AD Sync/Data/** folder and copy the **ADSync.mdf** and **ADSync_log.mdf** files to the remote SQL Server.</span></span>
3. <span data-ttu-id="762e0-116">Restart the **Microsoft Azure AD Sync** service on the Azure AD Connect server.</span><span class="sxs-lookup"><span data-stu-id="762e0-116">Restart the **Microsoft Azure AD Sync** service on the Azure AD Connect server.</span></span>
4. <span data-ttu-id="762e0-117">Un-install Azure AD Connect by going to Control Panel - - Programs - Programs and Features.</span><span class="sxs-lookup"><span data-stu-id="762e0-117">Un-install Azure AD Connect by going to Control Panel - - Programs - Programs and Features.</span></span>  <span data-ttu-id="762e0-118">Select Microsoft Azure AD Connect and click uninstall at the top.</span><span class="sxs-lookup"><span data-stu-id="762e0-118">Select Microsoft Azure AD Connect and click uninstall at the top.</span></span>
5. <span data-ttu-id="762e0-119">On the remote SQL server, open SQL Server Management Studio.</span><span class="sxs-lookup"><span data-stu-id="762e0-119">On the remote SQL server, open SQL Server Management Studio.</span></span>
6. <span data-ttu-id="762e0-120">On Databases, right-click and select Attach.</span><span class="sxs-lookup"><span data-stu-id="762e0-120">On Databases, right-click and select Attach.</span></span>
7. <span data-ttu-id="762e0-121">On the **Attach Databases** screen, click **Add** and navigate to the ADSync.mdf file.</span><span class="sxs-lookup"><span data-stu-id="762e0-121">On the **Attach Databases** screen, click **Add** and navigate to the ADSync.mdf file.</span></span>  <span data-ttu-id="762e0-122">Click **OK**.</span><span class="sxs-lookup"><span data-stu-id="762e0-122">Click **OK**.</span></span>
![](media/active-directory-aadconnect-move-db/move2.png)

8. <span data-ttu-id="762e0-123">Once the database is attached, go back to the Azure AD Connect server and install Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="762e0-123">Once the database is attached, go back to the Azure AD Connect server and install Azure AD Connect.</span></span>
9. <span data-ttu-id="762e0-124">Once the MSI installation completes, the Azure AD Connect wizard starts with the Express mode setup.</span><span class="sxs-lookup"><span data-stu-id="762e0-124">Once the MSI installation completes, the Azure AD Connect wizard starts with the Express mode setup.</span></span> <span data-ttu-id="762e0-125">Close the screen by clicking the Exit icon.</span><span class="sxs-lookup"><span data-stu-id="762e0-125">Close the screen by clicking the Exit icon.</span></span>
<span data-ttu-id="762e0-126">![Welcome](media/active-directory-aadconnect-existing-database/db1.png)</span><span class="sxs-lookup"><span data-stu-id="762e0-126">![Welcome](media/active-directory-aadconnect-existing-database/db1.png)</span></span>
10. <span data-ttu-id="762e0-127">Start a new command prompt or PowerShell session.</span><span class="sxs-lookup"><span data-stu-id="762e0-127">Start a new command prompt or PowerShell session.</span></span> <span data-ttu-id="762e0-128">Navigate to folder <drive>\program files\Microsoft Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="762e0-128">Navigate to folder <drive>\program files\Microsoft Azure AD Connect.</span></span> <span data-ttu-id="762e0-129">Run command .\AzureADConnect.exe /useexistingdatabase to start the Azure AD Connect wizard in “Use existing database” setup mode.</span><span class="sxs-lookup"><span data-stu-id="762e0-129">Run command .\AzureADConnect.exe /useexistingdatabase to start the Azure AD Connect wizard in “Use existing database” setup mode.</span></span>
<span data-ttu-id="762e0-130">![PowerShell](media/active-directory-aadconnect-existing-database/db2.png)</span><span class="sxs-lookup"><span data-stu-id="762e0-130">![PowerShell](media/active-directory-aadconnect-existing-database/db2.png)</span></span>
11. <span data-ttu-id="762e0-131">You are greeted with the Welcome to Azure AD Connect screen.</span><span class="sxs-lookup"><span data-stu-id="762e0-131">You are greeted with the Welcome to Azure AD Connect screen.</span></span> <span data-ttu-id="762e0-132">Once you agree to the license terms and privacy notice, click **Continue**.</span><span class="sxs-lookup"><span data-stu-id="762e0-132">Once you agree to the license terms and privacy notice, click **Continue**.</span></span>
<span data-ttu-id="762e0-133">![Welcome](media/active-directory-aadconnect-existing-database/db3.png)</span><span class="sxs-lookup"><span data-stu-id="762e0-133">![Welcome](media/active-directory-aadconnect-existing-database/db3.png)</span></span>
12. <span data-ttu-id="762e0-134">On the **Install required components** screen, the **Use an existing SQL Server** option is enabled.</span><span class="sxs-lookup"><span data-stu-id="762e0-134">On the **Install required components** screen, the **Use an existing SQL Server** option is enabled.</span></span> <span data-ttu-id="762e0-135">Specify the name of the SQL server that is hosting the ADSync database.</span><span class="sxs-lookup"><span data-stu-id="762e0-135">Specify the name of the SQL server that is hosting the ADSync database.</span></span> <span data-ttu-id="762e0-136">If the SQL engine instance used to host the ADSync database is not the default instance on the SQL server, you must specify the SQL engine instance name.</span><span class="sxs-lookup"><span data-stu-id="762e0-136">If the SQL engine instance used to host the ADSync database is not the default instance on the SQL server, you must specify the SQL engine instance name.</span></span> <span data-ttu-id="762e0-137">Further, if SQL browsing is not enabled, you must also specify the SQL engine instance port number.</span><span class="sxs-lookup"><span data-stu-id="762e0-137">Further, if SQL browsing is not enabled, you must also specify the SQL engine instance port number.</span></span> <span data-ttu-id="762e0-138">For example:</span><span class="sxs-lookup"><span data-stu-id="762e0-138">For example:</span></span>         
<span data-ttu-id="762e0-139">![Welcome](media/active-directory-aadconnect-existing-database/db4.png)</span><span class="sxs-lookup"><span data-stu-id="762e0-139">![Welcome](media/active-directory-aadconnect-existing-database/db4.png)</span></span>           

13. <span data-ttu-id="762e0-140">On the **Connect to Azure AD** screen, you must provide the credentials of a global admin of your Azure AD directory.</span><span class="sxs-lookup"><span data-stu-id="762e0-140">On the **Connect to Azure AD** screen, you must provide the credentials of a global admin of your Azure AD directory.</span></span> <span data-ttu-id="762e0-141">The recommendation is to use an account in the default onmicrosoft.com domain.</span><span class="sxs-lookup"><span data-stu-id="762e0-141">The recommendation is to use an account in the default onmicrosoft.com domain.</span></span> <span data-ttu-id="762e0-142">This account is only used to create a service account in Azure AD and is not used after the wizard has completed.</span><span class="sxs-lookup"><span data-stu-id="762e0-142">This account is only used to create a service account in Azure AD and is not used after the wizard has completed.</span></span>
<span data-ttu-id="762e0-143">![Connect](media/active-directory-aadconnect-existing-database/db5.png)</span><span class="sxs-lookup"><span data-stu-id="762e0-143">![Connect](media/active-directory-aadconnect-existing-database/db5.png)</span></span>
 
14. <span data-ttu-id="762e0-144">On the **Connect your directories** screen, the existing AD forest configured for directory synchronization is listed with a red cross icon beside it.</span><span class="sxs-lookup"><span data-stu-id="762e0-144">On the **Connect your directories** screen, the existing AD forest configured for directory synchronization is listed with a red cross icon beside it.</span></span> <span data-ttu-id="762e0-145">To synchronize changes from an on-premises AD forest, an AD DS account is required.</span><span class="sxs-lookup"><span data-stu-id="762e0-145">To synchronize changes from an on-premises AD forest, an AD DS account is required.</span></span> <span data-ttu-id="762e0-146">The Azure AD Connect wizard is unable to retrieve the credentials of the AD DS account stored in the ADSync database because the credentials are encrypted and can only be decrypted by the previous Azure AD Connect server.</span><span class="sxs-lookup"><span data-stu-id="762e0-146">The Azure AD Connect wizard is unable to retrieve the credentials of the AD DS account stored in the ADSync database because the credentials are encrypted and can only be decrypted by the previous Azure AD Connect server.</span></span> <span data-ttu-id="762e0-147">Click **Change Credentials** to specify the AD DS account for the AD forest.</span><span class="sxs-lookup"><span data-stu-id="762e0-147">Click **Change Credentials** to specify the AD DS account for the AD forest.</span></span>
<span data-ttu-id="762e0-148">![Directories](media/active-directory-aadconnect-existing-database/db6.png)</span><span class="sxs-lookup"><span data-stu-id="762e0-148">![Directories](media/active-directory-aadconnect-existing-database/db6.png)</span></span>
 
 
15. <span data-ttu-id="762e0-149">In the pop-up dialog, you can either (i) provide an Enterprise Admin credential and let Azure AD Connect create the AD DS account for you, or (ii) create the AD DS account yourself and provide its credential to Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="762e0-149">In the pop-up dialog, you can either (i) provide an Enterprise Admin credential and let Azure AD Connect create the AD DS account for you, or (ii) create the AD DS account yourself and provide its credential to Azure AD Connect.</span></span> <span data-ttu-id="762e0-150">Once you have selected an option and provide the necessary credentials, click **OK** to close the pop-up dialog.</span><span class="sxs-lookup"><span data-stu-id="762e0-150">Once you have selected an option and provide the necessary credentials, click **OK** to close the pop-up dialog.</span></span>
<span data-ttu-id="762e0-151">![Welcome](media/active-directory-aadconnect-existing-database/db7.png)</span><span class="sxs-lookup"><span data-stu-id="762e0-151">![Welcome](media/active-directory-aadconnect-existing-database/db7.png)</span></span>
 
 
16. <span data-ttu-id="762e0-152">Once the credentials are provided, the red cross icon is replaced with a green tick icon.</span><span class="sxs-lookup"><span data-stu-id="762e0-152">Once the credentials are provided, the red cross icon is replaced with a green tick icon.</span></span> <span data-ttu-id="762e0-153">Click **Next**.</span><span class="sxs-lookup"><span data-stu-id="762e0-153">Click **Next**.</span></span>
<span data-ttu-id="762e0-154">![Welcome](media/active-directory-aadconnect-existing-database/db8.png)</span><span class="sxs-lookup"><span data-stu-id="762e0-154">![Welcome](media/active-directory-aadconnect-existing-database/db8.png)</span></span>
 
 
17. <span data-ttu-id="762e0-155">On the **Ready to configure** screen, click **Install**.</span><span class="sxs-lookup"><span data-stu-id="762e0-155">On the **Ready to configure** screen, click **Install**.</span></span>
<span data-ttu-id="762e0-156">![Welcome](media/active-directory-aadconnect-existing-database/db9.png)</span><span class="sxs-lookup"><span data-stu-id="762e0-156">![Welcome](media/active-directory-aadconnect-existing-database/db9.png)</span></span>
 
 
18. <span data-ttu-id="762e0-157">Once installation completes, the Azure AD Connect server is automatically enabled for Staging Mode.</span><span class="sxs-lookup"><span data-stu-id="762e0-157">Once installation completes, the Azure AD Connect server is automatically enabled for Staging Mode.</span></span> <span data-ttu-id="762e0-158">It is recommended that you review the server configuration and pending exports for unexpected changes before disabling Staging Mode.</span><span class="sxs-lookup"><span data-stu-id="762e0-158">It is recommended that you review the server configuration and pending exports for unexpected changes before disabling Staging Mode.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="762e0-159">Next steps</span><span class="sxs-lookup"><span data-stu-id="762e0-159">Next steps</span></span>

- <span data-ttu-id="762e0-160">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="762e0-160">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
- [<span data-ttu-id="762e0-161">Install Azure AD Connect using an existing ADSync database</span><span class="sxs-lookup"><span data-stu-id="762e0-161">Install Azure AD Connect using an existing ADSync database</span></span>](active-directory-aadconnect-existing-database.md)
- [<span data-ttu-id="762e0-162">Install Azure AD Connect using SQL delegated administrator permissions</span><span class="sxs-lookup"><span data-stu-id="762e0-162">Install Azure AD Connect using SQL delegated administrator permissions</span></span>](active-directory-aadconnect-sql-delegation.md)

