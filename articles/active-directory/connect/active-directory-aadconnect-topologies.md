---
title: 'Azure AD Connect: Supported topologies | Microsoft Docs'
description: This topic details supported and unsupported topologies for Azure AD Connect
services: active-directory
documentationcenter: ''
author: AndKjell
manager: femila
editor: ''
ms.assetid: 1034c000-59f2-4fc8-8137-2416fa5e4bfe
ms.service: active-directory
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: identity
ms.topic: article
ms.date: 02/08/2017
ms.author: billmath
ms.openlocfilehash: f647e38f4dea9c7956c22da4f76f391e08ed113b
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44553736"
---
# <a name="topologies-for-azure-ad-connect"></a><span data-ttu-id="181c7-103">Topologies for Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="181c7-103">Topologies for Azure AD Connect</span></span>
<span data-ttu-id="181c7-104">This article describes various on-premises and Azure Active Directory (Azure AD) topologies that use Azure AD Connect sync as the key integration solution.</span><span class="sxs-lookup"><span data-stu-id="181c7-104">This article describes various on-premises and Azure Active Directory (Azure AD) topologies that use Azure AD Connect sync as the key integration solution.</span></span> <span data-ttu-id="181c7-105">This article includes both supported and unsupported configurations.</span><span class="sxs-lookup"><span data-stu-id="181c7-105">This article includes both supported and unsupported configurations.</span></span>

<span data-ttu-id="181c7-106">Here's the legend for pictures in the article:</span><span class="sxs-lookup"><span data-stu-id="181c7-106">Here's the legend for pictures in the article:</span></span>

| <span data-ttu-id="181c7-107">Description</span><span class="sxs-lookup"><span data-stu-id="181c7-107">Description</span></span> | <span data-ttu-id="181c7-108">Symbol</span><span class="sxs-lookup"><span data-stu-id="181c7-108">Symbol</span></span> |
| --- | --- |
| <span data-ttu-id="181c7-109">On-premises Active Directory forest</span><span class="sxs-lookup"><span data-stu-id="181c7-109">On-premises Active Directory forest</span></span> |![On-premises Active Directory forest](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/LegendAD1.png) |
| <span data-ttu-id="181c7-111">On-premises Active Directory with filtered import</span><span class="sxs-lookup"><span data-stu-id="181c7-111">On-premises Active Directory with filtered import</span></span> |![Active Directory with filtered import](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/LegendAD2.png) |
| <span data-ttu-id="181c7-113">Azure AD Connect sync server</span><span class="sxs-lookup"><span data-stu-id="181c7-113">Azure AD Connect sync server</span></span> |![Azure AD Connect sync server](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/LegendSync1.png) |
| <span data-ttu-id="181c7-115">Azure AD Connect sync server “staging mode”</span><span class="sxs-lookup"><span data-stu-id="181c7-115">Azure AD Connect sync server “staging mode”</span></span> |![Azure AD Connect sync server “staging mode”](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/LegendSync2.png) |
| <span data-ttu-id="181c7-117">GALSync with Forefront Identity Manager (FIM) 2010 or Microsoft Identity Manager (MIM) 2016</span><span class="sxs-lookup"><span data-stu-id="181c7-117">GALSync with Forefront Identity Manager (FIM) 2010 or Microsoft Identity Manager (MIM) 2016</span></span> |![GALSync with FIM 2010 or MIM 2016](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/LegendSync3.png) |
| <span data-ttu-id="181c7-119">Azure AD Connect sync server, detailed</span><span class="sxs-lookup"><span data-stu-id="181c7-119">Azure AD Connect sync server, detailed</span></span> |![Azure AD Connect sync server, detailed](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/LegendSync4.png) |
| <span data-ttu-id="181c7-121">Azure AD</span><span class="sxs-lookup"><span data-stu-id="181c7-121">Azure AD</span></span> |![Azure Active Directory](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/LegendAAD.png) |
| <span data-ttu-id="181c7-123">Unsupported scenario</span><span class="sxs-lookup"><span data-stu-id="181c7-123">Unsupported scenario</span></span> |![Unsupported scenario](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/LegendUnsupported.png) |

## <a name="single-forest-single-azure-ad-tenant"></a><span data-ttu-id="181c7-125">Single forest, single Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="181c7-125">Single forest, single Azure AD tenant</span></span>
![Topology for a single forest and a single tenant](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/SingleForestSingleDirectory.png)

<span data-ttu-id="181c7-127">The most common topology is a single on-premises forest, with one or multiple domains, and a single Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="181c7-127">The most common topology is a single on-premises forest, with one or multiple domains, and a single Azure AD tenant.</span></span> <span data-ttu-id="181c7-128">For Azure AD authentication, password synchronization is used.</span><span class="sxs-lookup"><span data-stu-id="181c7-128">For Azure AD authentication, password synchronization is used.</span></span> <span data-ttu-id="181c7-129">The express installation of Azure AD Connect supports only this topology.</span><span class="sxs-lookup"><span data-stu-id="181c7-129">The express installation of Azure AD Connect supports only this topology.</span></span>

### <a name="single-forest-multiple-sync-servers-to-one-azure-ad-tenant"></a><span data-ttu-id="181c7-130">Single forest, multiple sync servers to one Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="181c7-130">Single forest, multiple sync servers to one Azure AD tenant</span></span>
![Unsupported, filtered topology for a single forest](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/SingleForestFilteredUnsupported.png)

<span data-ttu-id="181c7-132">Having multiple Azure AD Connect sync servers connected to the same Azure AD tenant is not supported, except for a [staging server](#staging-server).</span><span class="sxs-lookup"><span data-stu-id="181c7-132">Having multiple Azure AD Connect sync servers connected to the same Azure AD tenant is not supported, except for a [staging server](#staging-server).</span></span> <span data-ttu-id="181c7-133">It's unsupported even if these servers are configured to synchronize with a mutually exclusive set of objects.</span><span class="sxs-lookup"><span data-stu-id="181c7-133">It's unsupported even if these servers are configured to synchronize with a mutually exclusive set of objects.</span></span> <span data-ttu-id="181c7-134">You might have considered this topology if you can't reach all domains in the forest from a single server, or if you want to distribute load across several servers.</span><span class="sxs-lookup"><span data-stu-id="181c7-134">You might have considered this topology if you can't reach all domains in the forest from a single server, or if you want to distribute load across several servers.</span></span>

## <a name="multiple-forests-single-azure-ad-tenant"></a><span data-ttu-id="181c7-135">Multiple forests, single Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="181c7-135">Multiple forests, single Azure AD tenant</span></span>
![Topology for multiple forests and a single tenant](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestSingleDirectory.png)

<span data-ttu-id="181c7-137">Many organizations have environments with multiple on-premises Active Directory forests.</span><span class="sxs-lookup"><span data-stu-id="181c7-137">Many organizations have environments with multiple on-premises Active Directory forests.</span></span> <span data-ttu-id="181c7-138">There are various reasons for having more than one on-premises Active Directory forest.</span><span class="sxs-lookup"><span data-stu-id="181c7-138">There are various reasons for having more than one on-premises Active Directory forest.</span></span> <span data-ttu-id="181c7-139">Typical examples are designs with account-resource forests and the result of a merger or acquisition.</span><span class="sxs-lookup"><span data-stu-id="181c7-139">Typical examples are designs with account-resource forests and the result of a merger or acquisition.</span></span>

<span data-ttu-id="181c7-140">When you have multiple forests, all forests must be reachable by a single Azure AD Connect sync server.</span><span class="sxs-lookup"><span data-stu-id="181c7-140">When you have multiple forests, all forests must be reachable by a single Azure AD Connect sync server.</span></span> <span data-ttu-id="181c7-141">You don't have to join the server to a domain.</span><span class="sxs-lookup"><span data-stu-id="181c7-141">You don't have to join the server to a domain.</span></span> <span data-ttu-id="181c7-142">If necessary to reach all forests, you can place the server in a perimeter network (also known as DMZ, demilitarized zone, and screened subnet).</span><span class="sxs-lookup"><span data-stu-id="181c7-142">If necessary to reach all forests, you can place the server in a perimeter network (also known as DMZ, demilitarized zone, and screened subnet).</span></span>

<span data-ttu-id="181c7-143">The Azure AD Connect installation wizard offers several options to consolidate users who are represented in multiple forests.</span><span class="sxs-lookup"><span data-stu-id="181c7-143">The Azure AD Connect installation wizard offers several options to consolidate users who are represented in multiple forests.</span></span> <span data-ttu-id="181c7-144">The goal is that a user is represented only once in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="181c7-144">The goal is that a user is represented only once in Azure AD.</span></span> <span data-ttu-id="181c7-145">There are some common topologies that you can configure in the custom installation path in the installation wizard.</span><span class="sxs-lookup"><span data-stu-id="181c7-145">There are some common topologies that you can configure in the custom installation path in the installation wizard.</span></span> <span data-ttu-id="181c7-146">On the **Uniquely identifying your users** page, select the corresponding option that represents your topology.</span><span class="sxs-lookup"><span data-stu-id="181c7-146">On the **Uniquely identifying your users** page, select the corresponding option that represents your topology.</span></span> <span data-ttu-id="181c7-147">The consolidation is configured only for users.</span><span class="sxs-lookup"><span data-stu-id="181c7-147">The consolidation is configured only for users.</span></span> <span data-ttu-id="181c7-148">Duplicated groups are not consolidated with the default configuration.</span><span class="sxs-lookup"><span data-stu-id="181c7-148">Duplicated groups are not consolidated with the default configuration.</span></span>

<span data-ttu-id="181c7-149">Common topologies are discussed in the sections about [separate topologies](#multiple-forests-separate-topologies), [full mesh](#multiple-forests-full-mesh-with-optional-galsync), and [the account-resource topology](#multiple-forests-account-resource-forest).</span><span class="sxs-lookup"><span data-stu-id="181c7-149">Common topologies are discussed in the sections about [separate topologies](#multiple-forests-separate-topologies), [full mesh](#multiple-forests-full-mesh-with-optional-galsync), and [the account-resource topology](#multiple-forests-account-resource-forest).</span></span>

<span data-ttu-id="181c7-150">The default configuration in Azure AD Connect sync assumes:</span><span class="sxs-lookup"><span data-stu-id="181c7-150">The default configuration in Azure AD Connect sync assumes:</span></span>

* <span data-ttu-id="181c7-151">Each user has only one enabled account, and the forest where this account is located is used to authenticate the user.</span><span class="sxs-lookup"><span data-stu-id="181c7-151">Each user has only one enabled account, and the forest where this account is located is used to authenticate the user.</span></span> <span data-ttu-id="181c7-152">This assumption is for both password sync and federation.</span><span class="sxs-lookup"><span data-stu-id="181c7-152">This assumption is for both password sync and federation.</span></span> <span data-ttu-id="181c7-153">UserPrincipalName and sourceAnchor/immutableID come from this forest.</span><span class="sxs-lookup"><span data-stu-id="181c7-153">UserPrincipalName and sourceAnchor/immutableID come from this forest.</span></span>
* <span data-ttu-id="181c7-154">Each user has only one mailbox.</span><span class="sxs-lookup"><span data-stu-id="181c7-154">Each user has only one mailbox.</span></span>
* <span data-ttu-id="181c7-155">The forest that hosts the mailbox for a user has the best data quality for attributes visible in the Exchange Global Address List (GAL).</span><span class="sxs-lookup"><span data-stu-id="181c7-155">The forest that hosts the mailbox for a user has the best data quality for attributes visible in the Exchange Global Address List (GAL).</span></span> <span data-ttu-id="181c7-156">If there's no mailbox for the user, any forest can be used to contribute these attribute values.</span><span class="sxs-lookup"><span data-stu-id="181c7-156">If there's no mailbox for the user, any forest can be used to contribute these attribute values.</span></span>
* <span data-ttu-id="181c7-157">If you have a linked mailbox, there's also an account in a different forest used for sign-in.</span><span class="sxs-lookup"><span data-stu-id="181c7-157">If you have a linked mailbox, there's also an account in a different forest used for sign-in.</span></span>

<span data-ttu-id="181c7-158">If your environment does not match these assumptions, the following things happen:</span><span class="sxs-lookup"><span data-stu-id="181c7-158">If your environment does not match these assumptions, the following things happen:</span></span>

* <span data-ttu-id="181c7-159">If you have more than one active account or more than one mailbox, the sync engine picks one and ignores the other.</span><span class="sxs-lookup"><span data-stu-id="181c7-159">If you have more than one active account or more than one mailbox, the sync engine picks one and ignores the other.</span></span>
* <span data-ttu-id="181c7-160">A linked mailbox with no other active account is not exported to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="181c7-160">A linked mailbox with no other active account is not exported to Azure AD.</span></span> <span data-ttu-id="181c7-161">The user account is not represented as a member in any group.</span><span class="sxs-lookup"><span data-stu-id="181c7-161">The user account is not represented as a member in any group.</span></span> <span data-ttu-id="181c7-162">A linked mailbox in DirSync is always represented as a normal mailbox.</span><span class="sxs-lookup"><span data-stu-id="181c7-162">A linked mailbox in DirSync is always represented as a normal mailbox.</span></span> <span data-ttu-id="181c7-163">This change is intentionally a different behavior to better support multiple-forest scenarios.</span><span class="sxs-lookup"><span data-stu-id="181c7-163">This change is intentionally a different behavior to better support multiple-forest scenarios.</span></span>

<span data-ttu-id="181c7-164">You can find more details in [Understanding the default configuration](active-directory-aadconnectsync-understanding-default-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="181c7-164">You can find more details in [Understanding the default configuration](active-directory-aadconnectsync-understanding-default-configuration.md).</span></span>

### <a name="multiple-forests-multiple-sync-servers-to-one-azure-ad-tenant"></a><span data-ttu-id="181c7-165">Multiple forests, multiple sync servers to one Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="181c7-165">Multiple forests, multiple sync servers to one Azure AD tenant</span></span>
![Unsupported topology for multiple forests and multiple sync servers](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestMultiSyncUnsupported.png)

<span data-ttu-id="181c7-167">Having more than one Azure AD Connect sync server connected to a single Azure AD tenant is not supported.</span><span class="sxs-lookup"><span data-stu-id="181c7-167">Having more than one Azure AD Connect sync server connected to a single Azure AD tenant is not supported.</span></span> <span data-ttu-id="181c7-168">The exception is the use of a [staging server](#staging-server).</span><span class="sxs-lookup"><span data-stu-id="181c7-168">The exception is the use of a [staging server](#staging-server).</span></span>

### <a name="multiple-forests-separate-topologies"></a><span data-ttu-id="181c7-169">Multiple forests, separate topologies</span><span class="sxs-lookup"><span data-stu-id="181c7-169">Multiple forests, separate topologies</span></span>
![Option for representing users only once across all directories](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestUsersOnce.png)

![Depiction of multiple forests and separate topologies](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestSeperateTopologies.png)

<span data-ttu-id="181c7-172">In this environment, all on-premises forests are treated as separate entities.</span><span class="sxs-lookup"><span data-stu-id="181c7-172">In this environment, all on-premises forests are treated as separate entities.</span></span> <span data-ttu-id="181c7-173">No user is present in any other forest.</span><span class="sxs-lookup"><span data-stu-id="181c7-173">No user is present in any other forest.</span></span> <span data-ttu-id="181c7-174">Each forest has its own Exchange organization, and there's no GALSync between the forests.</span><span class="sxs-lookup"><span data-stu-id="181c7-174">Each forest has its own Exchange organization, and there's no GALSync between the forests.</span></span> <span data-ttu-id="181c7-175">This topology might be the situation after a merger/acquisition or in an organization where each business unit operates independently.</span><span class="sxs-lookup"><span data-stu-id="181c7-175">This topology might be the situation after a merger/acquisition or in an organization where each business unit operates independently.</span></span> <span data-ttu-id="181c7-176">These forests are in the same organization in Azure AD and appear with a unified GAL.</span><span class="sxs-lookup"><span data-stu-id="181c7-176">These forests are in the same organization in Azure AD and appear with a unified GAL.</span></span> <span data-ttu-id="181c7-177">In the preceding picture, each object in every forest is represented once in the metaverse and aggregated in the target Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="181c7-177">In the preceding picture, each object in every forest is represented once in the metaverse and aggregated in the target Azure AD tenant.</span></span>

### <a name="multiple-forests-match-users"></a><span data-ttu-id="181c7-178">Multiple forests: match users</span><span class="sxs-lookup"><span data-stu-id="181c7-178">Multiple forests: match users</span></span>
<span data-ttu-id="181c7-179">Common to all these scenarios is that distribution and security groups can contain a mix of users, contacts, and Foreign Security Principals (FSPs).</span><span class="sxs-lookup"><span data-stu-id="181c7-179">Common to all these scenarios is that distribution and security groups can contain a mix of users, contacts, and Foreign Security Principals (FSPs).</span></span> <span data-ttu-id="181c7-180">FSPs are used in Active Directory Domain Services (AD DS) to represent members from other forests in a security group.</span><span class="sxs-lookup"><span data-stu-id="181c7-180">FSPs are used in Active Directory Domain Services (AD DS) to represent members from other forests in a security group.</span></span> <span data-ttu-id="181c7-181">All FSPs are resolved to the real object in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="181c7-181">All FSPs are resolved to the real object in Azure AD.</span></span>

### <a name="multiple-forests-full-mesh-with-optional-galsync"></a><span data-ttu-id="181c7-182">Multiple forests: full mesh with optional GALSync</span><span class="sxs-lookup"><span data-stu-id="181c7-182">Multiple forests: full mesh with optional GALSync</span></span>
![Option for using the mail attribute for matching when user identities exist across multiple directories](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestUsersMail.png)

![Full mesh topology for multiple forests](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestFullMesh.png)

<span data-ttu-id="181c7-185">A full mesh topology allows users and resources to be located in any forest.</span><span class="sxs-lookup"><span data-stu-id="181c7-185">A full mesh topology allows users and resources to be located in any forest.</span></span> <span data-ttu-id="181c7-186">Commonly, there are two-way trusts between the forests.</span><span class="sxs-lookup"><span data-stu-id="181c7-186">Commonly, there are two-way trusts between the forests.</span></span>

<span data-ttu-id="181c7-187">If Exchange is present in more than one forest, there might be (optionally) an on-premises GALSync solution.</span><span class="sxs-lookup"><span data-stu-id="181c7-187">If Exchange is present in more than one forest, there might be (optionally) an on-premises GALSync solution.</span></span> <span data-ttu-id="181c7-188">Every user is then represented as a contact in all other forests.</span><span class="sxs-lookup"><span data-stu-id="181c7-188">Every user is then represented as a contact in all other forests.</span></span> <span data-ttu-id="181c7-189">GALSync is commonly implemented through FIM 2010 or MIM 2016.</span><span class="sxs-lookup"><span data-stu-id="181c7-189">GALSync is commonly implemented through FIM 2010 or MIM 2016.</span></span> <span data-ttu-id="181c7-190">Azure AD Connect cannot be used for on-premises GALSync.</span><span class="sxs-lookup"><span data-stu-id="181c7-190">Azure AD Connect cannot be used for on-premises GALSync.</span></span>

<span data-ttu-id="181c7-191">In this scenario, identity objects are joined via the mail attribute.</span><span class="sxs-lookup"><span data-stu-id="181c7-191">In this scenario, identity objects are joined via the mail attribute.</span></span> <span data-ttu-id="181c7-192">A user who has a mailbox in one forest is joined with the contacts in the other forests.</span><span class="sxs-lookup"><span data-stu-id="181c7-192">A user who has a mailbox in one forest is joined with the contacts in the other forests.</span></span>

### <a name="multiple-forests-account-resource-forest"></a><span data-ttu-id="181c7-193">Multiple forests: account-resource forest</span><span class="sxs-lookup"><span data-stu-id="181c7-193">Multiple forests: account-resource forest</span></span>
![Option for using the ObjectSID and msExchMasterAccountSID attributes for matching when identities exist across multiple directories](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestUsersObjectSID.png)

![Account-resource forest topology for multiple forests](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestAccountResource.png)

<span data-ttu-id="181c7-196">In an account-resource forest topology, you have one or more *account* forests with active user accounts.</span><span class="sxs-lookup"><span data-stu-id="181c7-196">In an account-resource forest topology, you have one or more *account* forests with active user accounts.</span></span> <span data-ttu-id="181c7-197">You also have one or more *resource* forests with disabled accounts.</span><span class="sxs-lookup"><span data-stu-id="181c7-197">You also have one or more *resource* forests with disabled accounts.</span></span>

<span data-ttu-id="181c7-198">In this scenario, one (or more) resource forest trusts all account forests.</span><span class="sxs-lookup"><span data-stu-id="181c7-198">In this scenario, one (or more) resource forest trusts all account forests.</span></span> <span data-ttu-id="181c7-199">The resource forest typically has an extended Active Directory schema with Exchange and Lync.</span><span class="sxs-lookup"><span data-stu-id="181c7-199">The resource forest typically has an extended Active Directory schema with Exchange and Lync.</span></span> <span data-ttu-id="181c7-200">All Exchange and Lync services, along with other shared services, are located in this forest.</span><span class="sxs-lookup"><span data-stu-id="181c7-200">All Exchange and Lync services, along with other shared services, are located in this forest.</span></span> <span data-ttu-id="181c7-201">Users have a disabled user account in this forest, and the mailbox is linked to the account forest.</span><span class="sxs-lookup"><span data-stu-id="181c7-201">Users have a disabled user account in this forest, and the mailbox is linked to the account forest.</span></span>

## <a name="office-365-and-topology-considerations"></a><span data-ttu-id="181c7-202">Office 365 and topology considerations</span><span class="sxs-lookup"><span data-stu-id="181c7-202">Office 365 and topology considerations</span></span>
<span data-ttu-id="181c7-203">Some Office 365 workloads have certain restrictions on supported topologies:</span><span class="sxs-lookup"><span data-stu-id="181c7-203">Some Office 365 workloads have certain restrictions on supported topologies:</span></span>

| <span data-ttu-id="181c7-204">Workload</span><span class="sxs-lookup"><span data-stu-id="181c7-204">Workload</span></span> | <span data-ttu-id="181c7-205">Restrictions</span><span class="sxs-lookup"><span data-stu-id="181c7-205">Restrictions</span></span> |
--------- | ---------
| <span data-ttu-id="181c7-206">Exchange Online</span><span class="sxs-lookup"><span data-stu-id="181c7-206">Exchange Online</span></span> | <span data-ttu-id="181c7-207">If there's more than one on-premises Exchange organization (that is, Exchange has been deployed to more than one forest), you must use Exchange 2013 SP1 or later.</span><span class="sxs-lookup"><span data-stu-id="181c7-207">If there's more than one on-premises Exchange organization (that is, Exchange has been deployed to more than one forest), you must use Exchange 2013 SP1 or later.</span></span> <span data-ttu-id="181c7-208">For more information, see [Hybrid deployments with multiple Active Directory forests](https://technet.microsoft.com/library/jj873754.aspx).</span><span class="sxs-lookup"><span data-stu-id="181c7-208">For more information, see [Hybrid deployments with multiple Active Directory forests](https://technet.microsoft.com/library/jj873754.aspx).</span></span> |
| <span data-ttu-id="181c7-209">Skype for Business</span><span class="sxs-lookup"><span data-stu-id="181c7-209">Skype for Business</span></span> | <span data-ttu-id="181c7-210">When you're using multiple on-premises forests, only the account-resource forest topology is supported.</span><span class="sxs-lookup"><span data-stu-id="181c7-210">When you're using multiple on-premises forests, only the account-resource forest topology is supported.</span></span> <span data-ttu-id="181c7-211">For more information, see [Environmental requirements for Skype for Business Server 2015](https://technet.microsoft.com/library/dn933910.aspx).</span><span class="sxs-lookup"><span data-stu-id="181c7-211">For more information, see [Environmental requirements for Skype for Business Server 2015](https://technet.microsoft.com/library/dn933910.aspx).</span></span> |


## <a name="staging-server"></a><span data-ttu-id="181c7-212">Staging server</span><span class="sxs-lookup"><span data-stu-id="181c7-212">Staging server</span></span>
![Staging server in a topology](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestStaging.png)

<span data-ttu-id="181c7-214">Azure AD Connect supports installing a second server in *staging mode*.</span><span class="sxs-lookup"><span data-stu-id="181c7-214">Azure AD Connect supports installing a second server in *staging mode*.</span></span> <span data-ttu-id="181c7-215">A server in this mode reads data from all connected directories but does not write anything to connected directories.</span><span class="sxs-lookup"><span data-stu-id="181c7-215">A server in this mode reads data from all connected directories but does not write anything to connected directories.</span></span> <span data-ttu-id="181c7-216">It uses the normal synchronization cycle and therefore has an updated copy of the identity data.</span><span class="sxs-lookup"><span data-stu-id="181c7-216">It uses the normal synchronization cycle and therefore has an updated copy of the identity data.</span></span>

<span data-ttu-id="181c7-217">In a disaster where the primary server fails, you can fail over to the staging server.</span><span class="sxs-lookup"><span data-stu-id="181c7-217">In a disaster where the primary server fails, you can fail over to the staging server.</span></span> <span data-ttu-id="181c7-218">You do this in the Azure AD Connect wizard.</span><span class="sxs-lookup"><span data-stu-id="181c7-218">You do this in the Azure AD Connect wizard.</span></span> <span data-ttu-id="181c7-219">This second server can be located in a different datacenter because no infrastructure is shared with the primary server.</span><span class="sxs-lookup"><span data-stu-id="181c7-219">This second server can be located in a different datacenter because no infrastructure is shared with the primary server.</span></span> <span data-ttu-id="181c7-220">You must manually copy any configuration change made on the primary server to the second server.</span><span class="sxs-lookup"><span data-stu-id="181c7-220">You must manually copy any configuration change made on the primary server to the second server.</span></span>

<span data-ttu-id="181c7-221">You can use a staging server to test a new custom configuration and the effect that it has on your data.</span><span class="sxs-lookup"><span data-stu-id="181c7-221">You can use a staging server to test a new custom configuration and the effect that it has on your data.</span></span> <span data-ttu-id="181c7-222">You can preview the changes and adjust the configuration.</span><span class="sxs-lookup"><span data-stu-id="181c7-222">You can preview the changes and adjust the configuration.</span></span> <span data-ttu-id="181c7-223">When you're happy with the new configuration, you can make the staging server the active server and set the old active server to staging mode.</span><span class="sxs-lookup"><span data-stu-id="181c7-223">When you're happy with the new configuration, you can make the staging server the active server and set the old active server to staging mode.</span></span>

<span data-ttu-id="181c7-224">You can also use this method to replace the active sync server.</span><span class="sxs-lookup"><span data-stu-id="181c7-224">You can also use this method to replace the active sync server.</span></span> <span data-ttu-id="181c7-225">Prepare the new server and set it to staging mode.</span><span class="sxs-lookup"><span data-stu-id="181c7-225">Prepare the new server and set it to staging mode.</span></span> <span data-ttu-id="181c7-226">Make sure it's in a good state, disable staging mode (making it active), and shut down the currently active server.</span><span class="sxs-lookup"><span data-stu-id="181c7-226">Make sure it's in a good state, disable staging mode (making it active), and shut down the currently active server.</span></span>

<span data-ttu-id="181c7-227">It's possible to have more than one staging server when you want to have multiple backups in different datacenters.</span><span class="sxs-lookup"><span data-stu-id="181c7-227">It's possible to have more than one staging server when you want to have multiple backups in different datacenters.</span></span>

## <a name="multiple-azure-ad-tenants"></a><span data-ttu-id="181c7-228">Multiple Azure AD tenants</span><span class="sxs-lookup"><span data-stu-id="181c7-228">Multiple Azure AD tenants</span></span>
<span data-ttu-id="181c7-229">We recommend having a single tenant in Azure AD for an organization.</span><span class="sxs-lookup"><span data-stu-id="181c7-229">We recommend having a single tenant in Azure AD for an organization.</span></span>
<span data-ttu-id="181c7-230">Before you plan to use multiple Azure AD tenants, see the article [Administrative units management in Azure AD](../active-directory-administrative-units-management.md).</span><span class="sxs-lookup"><span data-stu-id="181c7-230">Before you plan to use multiple Azure AD tenants, see the article [Administrative units management in Azure AD](../active-directory-administrative-units-management.md).</span></span> <span data-ttu-id="181c7-231">It covers common scenarios where you can use a single tenant.</span><span class="sxs-lookup"><span data-stu-id="181c7-231">It covers common scenarios where you can use a single tenant.</span></span>

![Topology for multiple forests and multiple tenants](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestMultiDirectory.png)

<span data-ttu-id="181c7-233">There's a 1:1 relationship between an Azure AD Connect sync server and an Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="181c7-233">There's a 1:1 relationship between an Azure AD Connect sync server and an Azure AD tenant.</span></span> <span data-ttu-id="181c7-234">For each Azure AD tenant, you need one Azure AD Connect sync server installation.</span><span class="sxs-lookup"><span data-stu-id="181c7-234">For each Azure AD tenant, you need one Azure AD Connect sync server installation.</span></span> <span data-ttu-id="181c7-235">The Azure AD tenant instances are isolated by design.</span><span class="sxs-lookup"><span data-stu-id="181c7-235">The Azure AD tenant instances are isolated by design.</span></span> <span data-ttu-id="181c7-236">That is, users in one tenant can't see users in the other tenant.</span><span class="sxs-lookup"><span data-stu-id="181c7-236">That is, users in one tenant can't see users in the other tenant.</span></span> <span data-ttu-id="181c7-237">If you want this separation, this is a supported configuration.</span><span class="sxs-lookup"><span data-stu-id="181c7-237">If you want this separation, this is a supported configuration.</span></span> <span data-ttu-id="181c7-238">Otherwise, you should use the single Azure AD tenant model.</span><span class="sxs-lookup"><span data-stu-id="181c7-238">Otherwise, you should use the single Azure AD tenant model.</span></span>

### <a name="each-object-only-once-in-an-azure-ad-tenant"></a><span data-ttu-id="181c7-239">Each object only once in an Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="181c7-239">Each object only once in an Azure AD tenant</span></span>
![Filtered topology for a single forest](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/SingleForestFiltered.png)

<span data-ttu-id="181c7-241">In this topology, one Azure AD Connect sync server is connected to each Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="181c7-241">In this topology, one Azure AD Connect sync server is connected to each Azure AD tenant.</span></span> <span data-ttu-id="181c7-242">The Azure AD Connect sync servers must be configured for filtering so that each has a mutually exclusive set of objects to operate on.</span><span class="sxs-lookup"><span data-stu-id="181c7-242">The Azure AD Connect sync servers must be configured for filtering so that each has a mutually exclusive set of objects to operate on.</span></span> <span data-ttu-id="181c7-243">You can, for example, scope each server to a particular domain or organizational unit.</span><span class="sxs-lookup"><span data-stu-id="181c7-243">You can, for example, scope each server to a particular domain or organizational unit.</span></span>

<span data-ttu-id="181c7-244">A DNS domain can be registered in only a single Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="181c7-244">A DNS domain can be registered in only a single Azure AD tenant.</span></span> <span data-ttu-id="181c7-245">The UPNs of the users in the on-premises Active Directory instance must also use separate namespaces.</span><span class="sxs-lookup"><span data-stu-id="181c7-245">The UPNs of the users in the on-premises Active Directory instance must also use separate namespaces.</span></span> <span data-ttu-id="181c7-246">For example, in the preceding picture, three separate UPN suffixes are registered in the on-premises Active Directory instance: contoso.com, fabrikam.com, and wingtiptoys.com.</span><span class="sxs-lookup"><span data-stu-id="181c7-246">For example, in the preceding picture, three separate UPN suffixes are registered in the on-premises Active Directory instance: contoso.com, fabrikam.com, and wingtiptoys.com.</span></span> <span data-ttu-id="181c7-247">The users in each on-premises Active Directory domain use a different namespace.</span><span class="sxs-lookup"><span data-stu-id="181c7-247">The users in each on-premises Active Directory domain use a different namespace.</span></span>

<span data-ttu-id="181c7-248">There is no GALSync between the Azure AD tenant instances.</span><span class="sxs-lookup"><span data-stu-id="181c7-248">There is no GALSync between the Azure AD tenant instances.</span></span> <span data-ttu-id="181c7-249">The address book in Exchange Online and Skype for Business shows only users in the same tenant.</span><span class="sxs-lookup"><span data-stu-id="181c7-249">The address book in Exchange Online and Skype for Business shows only users in the same tenant.</span></span>

<span data-ttu-id="181c7-250">This topology has the following restrictions on otherwise supported scenarios:</span><span class="sxs-lookup"><span data-stu-id="181c7-250">This topology has the following restrictions on otherwise supported scenarios:</span></span>

* <span data-ttu-id="181c7-251">Only one of the Azure AD tenants can enable an Exchange hybrid with the on-premises Active Directory instance.</span><span class="sxs-lookup"><span data-stu-id="181c7-251">Only one of the Azure AD tenants can enable an Exchange hybrid with the on-premises Active Directory instance.</span></span>
* <span data-ttu-id="181c7-252">Windows 10 devices can be associated with only one Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="181c7-252">Windows 10 devices can be associated with only one Azure AD tenant.</span></span>
* <span data-ttu-id="181c7-253">The single sign-on (SSO) option for password synchronization and pass-through authentication can be used with only one Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="181c7-253">The single sign-on (SSO) option for password synchronization and pass-through authentication can be used with only one Azure AD tenant.</span></span>

<span data-ttu-id="181c7-254">The requirement for a mutually exclusive set of objects also applies to writeback.</span><span class="sxs-lookup"><span data-stu-id="181c7-254">The requirement for a mutually exclusive set of objects also applies to writeback.</span></span> <span data-ttu-id="181c7-255">Some writeback features are not supported with this topology because they assume a single on-premises configuration.</span><span class="sxs-lookup"><span data-stu-id="181c7-255">Some writeback features are not supported with this topology because they assume a single on-premises configuration.</span></span> <span data-ttu-id="181c7-256">These features include:</span><span class="sxs-lookup"><span data-stu-id="181c7-256">These features include:</span></span>

* <span data-ttu-id="181c7-257">Group writeback with default configuration.</span><span class="sxs-lookup"><span data-stu-id="181c7-257">Group writeback with default configuration.</span></span>
* <span data-ttu-id="181c7-258">Device writeback.</span><span class="sxs-lookup"><span data-stu-id="181c7-258">Device writeback.</span></span>

### <a name="each-object-multiple-times-in-an-azure-ad-tenant"></a><span data-ttu-id="181c7-259">Each object multiple times in an Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="181c7-259">Each object multiple times in an Azure AD tenant</span></span>
![Unsupported topology for a single forest and multiple tenants](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/SingleForestMultiDirectoryUnsupported.png) ![Unsupported topology for a single forest and multiple connectors](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/SingleForestMultiConnectorsUnsupported.png)

<span data-ttu-id="181c7-262">These tasks are unsupported:</span><span class="sxs-lookup"><span data-stu-id="181c7-262">These tasks are unsupported:</span></span>

* <span data-ttu-id="181c7-263">Sync the same user to multiple Azure AD tenants.</span><span class="sxs-lookup"><span data-stu-id="181c7-263">Sync the same user to multiple Azure AD tenants.</span></span>
* <span data-ttu-id="181c7-264">Make a configuration change so that users in one Azure AD tenant appear as contacts in another Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="181c7-264">Make a configuration change so that users in one Azure AD tenant appear as contacts in another Azure AD tenant.</span></span>
* <span data-ttu-id="181c7-265">Modify Azure AD Connect sync to connect to multiple Azure AD tenants.</span><span class="sxs-lookup"><span data-stu-id="181c7-265">Modify Azure AD Connect sync to connect to multiple Azure AD tenants.</span></span>

### <a name="galsync-by-using-writeback"></a><span data-ttu-id="181c7-266">GALSync by using writeback</span><span class="sxs-lookup"><span data-stu-id="181c7-266">GALSync by using writeback</span></span>
![Unsupported topology for multiple forests and multiple directories, with GALSync focusing on Azure AD](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestMultiDirectoryGALSync1Unsupported.png) ![Unsupported topology for multiple forests and multiple directories, with GALSync focusing on on-premises Active Directory](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestMultiDirectoryGALSync2Unsupported.png)

<span data-ttu-id="181c7-269">Azure AD tenants are isolated by design.</span><span class="sxs-lookup"><span data-stu-id="181c7-269">Azure AD tenants are isolated by design.</span></span> <span data-ttu-id="181c7-270">These tasks are unsupported:</span><span class="sxs-lookup"><span data-stu-id="181c7-270">These tasks are unsupported:</span></span>

* <span data-ttu-id="181c7-271">Change the configuration of Azure AD Connect sync to read data from another Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="181c7-271">Change the configuration of Azure AD Connect sync to read data from another Azure AD tenant.</span></span>
* <span data-ttu-id="181c7-272">Export users as contacts to another on-premises Active Directory instance by using Azure AD Connect sync.</span><span class="sxs-lookup"><span data-stu-id="181c7-272">Export users as contacts to another on-premises Active Directory instance by using Azure AD Connect sync.</span></span>

### <a name="galsync-with-on-premises-sync-server"></a><span data-ttu-id="181c7-273">GALSync with on-premises sync server</span><span class="sxs-lookup"><span data-stu-id="181c7-273">GALSync with on-premises sync server</span></span>
![GALSync in a topology for multiple forests and multiple directories](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-topologies/MultiForestMultiDirectoryGALSync.png)

<span data-ttu-id="181c7-275">You can use FIM 2010 or MIM 2016 on-premises to sync users (via GALSync) between two Exchange organizations.</span><span class="sxs-lookup"><span data-stu-id="181c7-275">You can use FIM 2010 or MIM 2016 on-premises to sync users (via GALSync) between two Exchange organizations.</span></span> <span data-ttu-id="181c7-276">The users in one organization appear as foreign users/contacts in the other organization.</span><span class="sxs-lookup"><span data-stu-id="181c7-276">The users in one organization appear as foreign users/contacts in the other organization.</span></span> <span data-ttu-id="181c7-277">These different on-premises Active Directory instances can then be synchronized with their own Azure AD tenants.</span><span class="sxs-lookup"><span data-stu-id="181c7-277">These different on-premises Active Directory instances can then be synchronized with their own Azure AD tenants.</span></span>

## <a name="next-steps"></a><span data-ttu-id="181c7-278">Next steps</span><span class="sxs-lookup"><span data-stu-id="181c7-278">Next steps</span></span>
<span data-ttu-id="181c7-279">To learn how to install Azure AD Connect for these scenarios, see [Custom installation of Azure AD Connect](active-directory-aadconnect-get-started-custom.md).</span><span class="sxs-lookup"><span data-stu-id="181c7-279">To learn how to install Azure AD Connect for these scenarios, see [Custom installation of Azure AD Connect](active-directory-aadconnect-get-started-custom.md).</span></span>

<span data-ttu-id="181c7-280">Learn more about the [Azure AD Connect sync](active-directory-aadconnectsync-whatis.md) configuration.</span><span class="sxs-lookup"><span data-stu-id="181c7-280">Learn more about the [Azure AD Connect sync](active-directory-aadconnectsync-whatis.md) configuration.</span></span>

<span data-ttu-id="181c7-281">Learn more about [integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="181c7-281">Learn more about [integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>


























