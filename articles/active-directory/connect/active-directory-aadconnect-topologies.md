---
title: 'Azure AD Connect: Supported topologies | Microsoft Docs'
description: This topic details supported and unsupported topologies for Azure AD Connect
services: active-directory
documentationcenter: ''
author: billmath
manager: mtillman
editor: ''
ms.assetid: 1034c000-59f2-4fc8-8137-2416fa5e4bfe
ms.service: active-directory
ms.devlang: na
ms.tgt_pltfrm: na
ms.workload: identity
ms.topic: article
ms.date: 02/27/2018
ms.component: hybrid
ms.author: billmath
ms.openlocfilehash: 6a0f18a47bb50144d0a4d428617e0dc5c7509196
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44773220"
---
# <a name="topologies-for-azure-ad-connect"></a><span data-ttu-id="c954a-103">Topologies for Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="c954a-103">Topologies for Azure AD Connect</span></span>
<span data-ttu-id="c954a-104">This article describes various on-premises and Azure Active Directory (Azure AD) topologies that use Azure AD Connect sync as the key integration solution.</span><span class="sxs-lookup"><span data-stu-id="c954a-104">This article describes various on-premises and Azure Active Directory (Azure AD) topologies that use Azure AD Connect sync as the key integration solution.</span></span> <span data-ttu-id="c954a-105">This article includes both supported and unsupported configurations.</span><span class="sxs-lookup"><span data-stu-id="c954a-105">This article includes both supported and unsupported configurations.</span></span>

<span data-ttu-id="c954a-106">Here's the legend for pictures in the article:</span><span class="sxs-lookup"><span data-stu-id="c954a-106">Here's the legend for pictures in the article:</span></span>

| <span data-ttu-id="c954a-107">Description</span><span class="sxs-lookup"><span data-stu-id="c954a-107">Description</span></span> | <span data-ttu-id="c954a-108">Symbol</span><span class="sxs-lookup"><span data-stu-id="c954a-108">Symbol</span></span> |
| --- | --- |
| <span data-ttu-id="c954a-109">On-premises Active Directory forest</span><span class="sxs-lookup"><span data-stu-id="c954a-109">On-premises Active Directory forest</span></span> |![On-premises Active Directory forest](./media/active-directory-aadconnect-topologies/LegendAD1.png) |
| <span data-ttu-id="c954a-111">On-premises Active Directory with filtered import</span><span class="sxs-lookup"><span data-stu-id="c954a-111">On-premises Active Directory with filtered import</span></span> |![Active Directory with filtered import](./media/active-directory-aadconnect-topologies/LegendAD2.png) |
| <span data-ttu-id="c954a-113">Azure AD Connect sync server</span><span class="sxs-lookup"><span data-stu-id="c954a-113">Azure AD Connect sync server</span></span> |![Azure AD Connect sync server](./media/active-directory-aadconnect-topologies/LegendSync1.png) |
| <span data-ttu-id="c954a-115">Azure AD Connect sync server “staging mode”</span><span class="sxs-lookup"><span data-stu-id="c954a-115">Azure AD Connect sync server “staging mode”</span></span> |![Azure AD Connect sync server “staging mode”](./media/active-directory-aadconnect-topologies/LegendSync2.png) |
| <span data-ttu-id="c954a-117">GALSync with Forefront Identity Manager (FIM) 2010 or Microsoft Identity Manager (MIM) 2016</span><span class="sxs-lookup"><span data-stu-id="c954a-117">GALSync with Forefront Identity Manager (FIM) 2010 or Microsoft Identity Manager (MIM) 2016</span></span> |![GALSync with FIM 2010 or MIM 2016](./media/active-directory-aadconnect-topologies/LegendSync3.png) |
| <span data-ttu-id="c954a-119">Azure AD Connect sync server, detailed</span><span class="sxs-lookup"><span data-stu-id="c954a-119">Azure AD Connect sync server, detailed</span></span> |![Azure AD Connect sync server, detailed](./media/active-directory-aadconnect-topologies/LegendSync4.png) |
| <span data-ttu-id="c954a-121">Azure AD</span><span class="sxs-lookup"><span data-stu-id="c954a-121">Azure AD</span></span> |![Azure Active Directory](./media/active-directory-aadconnect-topologies/LegendAAD.png) |
| <span data-ttu-id="c954a-123">Unsupported scenario</span><span class="sxs-lookup"><span data-stu-id="c954a-123">Unsupported scenario</span></span> |![Unsupported scenario](./media/active-directory-aadconnect-topologies/LegendUnsupported.png) |


> [!IMPORTANT]
> <span data-ttu-id="c954a-125">Microsoft doesn't support modifying or operating Azure AD Connect sync outside of the configurations or actions that are formally documented.</span><span class="sxs-lookup"><span data-stu-id="c954a-125">Microsoft doesn't support modifying or operating Azure AD Connect sync outside of the configurations or actions that are formally documented.</span></span> <span data-ttu-id="c954a-126">Any of these configurations or actions might result in an inconsistent or unsupported state of Azure AD Connect sync. As a result, Microsoft can't provide technical support for such deployments.</span><span class="sxs-lookup"><span data-stu-id="c954a-126">Any of these configurations or actions might result in an inconsistent or unsupported state of Azure AD Connect sync. As a result, Microsoft can't provide technical support for such deployments.</span></span>


## <a name="single-forest-single-azure-ad-tenant"></a><span data-ttu-id="c954a-127">Single forest, single Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="c954a-127">Single forest, single Azure AD tenant</span></span>
![Topology for a single forest and a single tenant](./media/active-directory-aadconnect-topologies/SingleForestSingleDirectory.png)

<span data-ttu-id="c954a-129">The most common topology is a single on-premises forest, with one or multiple domains, and a single Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="c954a-129">The most common topology is a single on-premises forest, with one or multiple domains, and a single Azure AD tenant.</span></span> <span data-ttu-id="c954a-130">For Azure AD authentication, password hash synchronization is used.</span><span class="sxs-lookup"><span data-stu-id="c954a-130">For Azure AD authentication, password hash synchronization is used.</span></span> <span data-ttu-id="c954a-131">The express installation of Azure AD Connect supports only this topology.</span><span class="sxs-lookup"><span data-stu-id="c954a-131">The express installation of Azure AD Connect supports only this topology.</span></span>

### <a name="single-forest-multiple-sync-servers-to-one-azure-ad-tenant"></a><span data-ttu-id="c954a-132">Single forest, multiple sync servers to one Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="c954a-132">Single forest, multiple sync servers to one Azure AD tenant</span></span>
![Unsupported, filtered topology for a single forest](./media/active-directory-aadconnect-topologies/SingleForestFilteredUnsupported.png)

<span data-ttu-id="c954a-134">Having multiple Azure AD Connect sync servers connected to the same Azure AD tenant is not supported, except for a [staging server](#staging-server).</span><span class="sxs-lookup"><span data-stu-id="c954a-134">Having multiple Azure AD Connect sync servers connected to the same Azure AD tenant is not supported, except for a [staging server](#staging-server).</span></span> <span data-ttu-id="c954a-135">It's unsupported even if these servers are configured to synchronize with a mutually exclusive set of objects.</span><span class="sxs-lookup"><span data-stu-id="c954a-135">It's unsupported even if these servers are configured to synchronize with a mutually exclusive set of objects.</span></span> <span data-ttu-id="c954a-136">You might have considered this topology if you can't reach all domains in the forest from a single server, or if you want to distribute load across several servers.</span><span class="sxs-lookup"><span data-stu-id="c954a-136">You might have considered this topology if you can't reach all domains in the forest from a single server, or if you want to distribute load across several servers.</span></span>

## <a name="multiple-forests-single-azure-ad-tenant"></a><span data-ttu-id="c954a-137">Multiple forests, single Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="c954a-137">Multiple forests, single Azure AD tenant</span></span>
![Topology for multiple forests and a single tenant](./media/active-directory-aadconnect-topologies/MultiForestSingleDirectory.png)

<span data-ttu-id="c954a-139">Many organizations have environments with multiple on-premises Active Directory forests.</span><span class="sxs-lookup"><span data-stu-id="c954a-139">Many organizations have environments with multiple on-premises Active Directory forests.</span></span> <span data-ttu-id="c954a-140">There are various reasons for having more than one on-premises Active Directory forest.</span><span class="sxs-lookup"><span data-stu-id="c954a-140">There are various reasons for having more than one on-premises Active Directory forest.</span></span> <span data-ttu-id="c954a-141">Typical examples are designs with account-resource forests and the result of a merger or acquisition.</span><span class="sxs-lookup"><span data-stu-id="c954a-141">Typical examples are designs with account-resource forests and the result of a merger or acquisition.</span></span>

<span data-ttu-id="c954a-142">When you have multiple forests, all forests must be reachable by a single Azure AD Connect sync server.</span><span class="sxs-lookup"><span data-stu-id="c954a-142">When you have multiple forests, all forests must be reachable by a single Azure AD Connect sync server.</span></span> <span data-ttu-id="c954a-143">You don't have to join the server to a domain.</span><span class="sxs-lookup"><span data-stu-id="c954a-143">You don't have to join the server to a domain.</span></span> <span data-ttu-id="c954a-144">If necessary to reach all forests, you can place the server in a perimeter network (also known as DMZ, demilitarized zone, and screened subnet).</span><span class="sxs-lookup"><span data-stu-id="c954a-144">If necessary to reach all forests, you can place the server in a perimeter network (also known as DMZ, demilitarized zone, and screened subnet).</span></span>

<span data-ttu-id="c954a-145">The Azure AD Connect installation wizard offers several options to consolidate users who are represented in multiple forests.</span><span class="sxs-lookup"><span data-stu-id="c954a-145">The Azure AD Connect installation wizard offers several options to consolidate users who are represented in multiple forests.</span></span> <span data-ttu-id="c954a-146">The goal is that a user is represented only once in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c954a-146">The goal is that a user is represented only once in Azure AD.</span></span> <span data-ttu-id="c954a-147">There are some common topologies that you can configure in the custom installation path in the installation wizard.</span><span class="sxs-lookup"><span data-stu-id="c954a-147">There are some common topologies that you can configure in the custom installation path in the installation wizard.</span></span> <span data-ttu-id="c954a-148">On the **Uniquely identifying your users** page, select the corresponding option that represents your topology.</span><span class="sxs-lookup"><span data-stu-id="c954a-148">On the **Uniquely identifying your users** page, select the corresponding option that represents your topology.</span></span> <span data-ttu-id="c954a-149">The consolidation is configured only for users.</span><span class="sxs-lookup"><span data-stu-id="c954a-149">The consolidation is configured only for users.</span></span> <span data-ttu-id="c954a-150">Duplicated groups are not consolidated with the default configuration.</span><span class="sxs-lookup"><span data-stu-id="c954a-150">Duplicated groups are not consolidated with the default configuration.</span></span>

<span data-ttu-id="c954a-151">Common topologies are discussed in the sections about [separate topologies](#multiple-forests-separate-topologies), [full mesh](#multiple-forests-full-mesh-with-optional-galsync), and [the account-resource topology](#multiple-forests-account-resource-forest).</span><span class="sxs-lookup"><span data-stu-id="c954a-151">Common topologies are discussed in the sections about [separate topologies](#multiple-forests-separate-topologies), [full mesh](#multiple-forests-full-mesh-with-optional-galsync), and [the account-resource topology](#multiple-forests-account-resource-forest).</span></span>

<span data-ttu-id="c954a-152">The default configuration in Azure AD Connect sync assumes:</span><span class="sxs-lookup"><span data-stu-id="c954a-152">The default configuration in Azure AD Connect sync assumes:</span></span>

* <span data-ttu-id="c954a-153">Each user has only one enabled account, and the forest where this account is located is used to authenticate the user.</span><span class="sxs-lookup"><span data-stu-id="c954a-153">Each user has only one enabled account, and the forest where this account is located is used to authenticate the user.</span></span> <span data-ttu-id="c954a-154">This assumption is for password hash sync, pass-through authentication and federation.</span><span class="sxs-lookup"><span data-stu-id="c954a-154">This assumption is for password hash sync, pass-through authentication and federation.</span></span> <span data-ttu-id="c954a-155">UserPrincipalName and sourceAnchor/immutableID come from this forest.</span><span class="sxs-lookup"><span data-stu-id="c954a-155">UserPrincipalName and sourceAnchor/immutableID come from this forest.</span></span>
* <span data-ttu-id="c954a-156">Each user has only one mailbox.</span><span class="sxs-lookup"><span data-stu-id="c954a-156">Each user has only one mailbox.</span></span>
* <span data-ttu-id="c954a-157">The forest that hosts the mailbox for a user has the best data quality for attributes visible in the Exchange Global Address List (GAL).</span><span class="sxs-lookup"><span data-stu-id="c954a-157">The forest that hosts the mailbox for a user has the best data quality for attributes visible in the Exchange Global Address List (GAL).</span></span> <span data-ttu-id="c954a-158">If there's no mailbox for the user, any forest can be used to contribute these attribute values.</span><span class="sxs-lookup"><span data-stu-id="c954a-158">If there's no mailbox for the user, any forest can be used to contribute these attribute values.</span></span>
* <span data-ttu-id="c954a-159">If you have a linked mailbox, there's also an account in a different forest used for sign-in.</span><span class="sxs-lookup"><span data-stu-id="c954a-159">If you have a linked mailbox, there's also an account in a different forest used for sign-in.</span></span>

<span data-ttu-id="c954a-160">If your environment does not match these assumptions, the following things happen:</span><span class="sxs-lookup"><span data-stu-id="c954a-160">If your environment does not match these assumptions, the following things happen:</span></span>

* <span data-ttu-id="c954a-161">If you have more than one active account or more than one mailbox, the sync engine picks one and ignores the other.</span><span class="sxs-lookup"><span data-stu-id="c954a-161">If you have more than one active account or more than one mailbox, the sync engine picks one and ignores the other.</span></span>
* <span data-ttu-id="c954a-162">A linked mailbox with no other active account is not exported to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c954a-162">A linked mailbox with no other active account is not exported to Azure AD.</span></span> <span data-ttu-id="c954a-163">The user account is not represented as a member in any group.</span><span class="sxs-lookup"><span data-stu-id="c954a-163">The user account is not represented as a member in any group.</span></span> <span data-ttu-id="c954a-164">A linked mailbox in DirSync is always represented as a normal mailbox.</span><span class="sxs-lookup"><span data-stu-id="c954a-164">A linked mailbox in DirSync is always represented as a normal mailbox.</span></span> <span data-ttu-id="c954a-165">This change is intentionally a different behavior to better support multiple-forest scenarios.</span><span class="sxs-lookup"><span data-stu-id="c954a-165">This change is intentionally a different behavior to better support multiple-forest scenarios.</span></span>

<span data-ttu-id="c954a-166">You can find more details in [Understanding the default configuration](active-directory-aadconnectsync-understanding-default-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="c954a-166">You can find more details in [Understanding the default configuration](active-directory-aadconnectsync-understanding-default-configuration.md).</span></span>

### <a name="multiple-forests-multiple-sync-servers-to-one-azure-ad-tenant"></a><span data-ttu-id="c954a-167">Multiple forests, multiple sync servers to one Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="c954a-167">Multiple forests, multiple sync servers to one Azure AD tenant</span></span>
![Unsupported topology for multiple forests and multiple sync servers](./media/active-directory-aadconnect-topologies/MultiForestMultiSyncUnsupported.png)

<span data-ttu-id="c954a-169">Having more than one Azure AD Connect sync server connected to a single Azure AD tenant is not supported.</span><span class="sxs-lookup"><span data-stu-id="c954a-169">Having more than one Azure AD Connect sync server connected to a single Azure AD tenant is not supported.</span></span> <span data-ttu-id="c954a-170">The exception is the use of a [staging server](#staging-server).</span><span class="sxs-lookup"><span data-stu-id="c954a-170">The exception is the use of a [staging server](#staging-server).</span></span>

### <a name="multiple-forests-separate-topologies"></a><span data-ttu-id="c954a-171">Multiple forests, separate topologies</span><span class="sxs-lookup"><span data-stu-id="c954a-171">Multiple forests, separate topologies</span></span>
![Option for representing users only once across all directories](./media/active-directory-aadconnect-topologies/MultiForestUsersOnce.png)

![Depiction of multiple forests and separate topologies](./media/active-directory-aadconnect-topologies/MultiForestSeperateTopologies.png)

<span data-ttu-id="c954a-174">In this environment, all on-premises forests are treated as separate entities.</span><span class="sxs-lookup"><span data-stu-id="c954a-174">In this environment, all on-premises forests are treated as separate entities.</span></span> <span data-ttu-id="c954a-175">No user is present in any other forest.</span><span class="sxs-lookup"><span data-stu-id="c954a-175">No user is present in any other forest.</span></span> <span data-ttu-id="c954a-176">Each forest has its own Exchange organization, and there's no GALSync between the forests.</span><span class="sxs-lookup"><span data-stu-id="c954a-176">Each forest has its own Exchange organization, and there's no GALSync between the forests.</span></span> <span data-ttu-id="c954a-177">This topology might be the situation after a merger/acquisition or in an organization where each business unit operates independently.</span><span class="sxs-lookup"><span data-stu-id="c954a-177">This topology might be the situation after a merger/acquisition or in an organization where each business unit operates independently.</span></span> <span data-ttu-id="c954a-178">These forests are in the same organization in Azure AD and appear with a unified GAL.</span><span class="sxs-lookup"><span data-stu-id="c954a-178">These forests are in the same organization in Azure AD and appear with a unified GAL.</span></span> <span data-ttu-id="c954a-179">In the preceding picture, each object in every forest is represented once in the metaverse and aggregated in the target Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="c954a-179">In the preceding picture, each object in every forest is represented once in the metaverse and aggregated in the target Azure AD tenant.</span></span>

### <a name="multiple-forests-match-users"></a><span data-ttu-id="c954a-180">Multiple forests: match users</span><span class="sxs-lookup"><span data-stu-id="c954a-180">Multiple forests: match users</span></span>
<span data-ttu-id="c954a-181">Common to all these scenarios is that distribution and security groups can contain a mix of users, contacts, and Foreign Security Principals (FSPs).</span><span class="sxs-lookup"><span data-stu-id="c954a-181">Common to all these scenarios is that distribution and security groups can contain a mix of users, contacts, and Foreign Security Principals (FSPs).</span></span> <span data-ttu-id="c954a-182">FSPs are used in Active Directory Domain Services (AD DS) to represent members from other forests in a security group.</span><span class="sxs-lookup"><span data-stu-id="c954a-182">FSPs are used in Active Directory Domain Services (AD DS) to represent members from other forests in a security group.</span></span> <span data-ttu-id="c954a-183">All FSPs are resolved to the real object in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c954a-183">All FSPs are resolved to the real object in Azure AD.</span></span>

### <a name="multiple-forests-full-mesh-with-optional-galsync"></a><span data-ttu-id="c954a-184">Multiple forests: full mesh with optional GALSync</span><span class="sxs-lookup"><span data-stu-id="c954a-184">Multiple forests: full mesh with optional GALSync</span></span>
![Option for using the mail attribute for matching when user identities exist across multiple directories](./media/active-directory-aadconnect-topologies/MultiForestUsersMail.png)

![Full mesh topology for multiple forests](./media/active-directory-aadconnect-topologies/MultiForestFullMesh.png)

<span data-ttu-id="c954a-187">A full mesh topology allows users and resources to be located in any forest.</span><span class="sxs-lookup"><span data-stu-id="c954a-187">A full mesh topology allows users and resources to be located in any forest.</span></span> <span data-ttu-id="c954a-188">Commonly, there are two-way trusts between the forests.</span><span class="sxs-lookup"><span data-stu-id="c954a-188">Commonly, there are two-way trusts between the forests.</span></span>

<span data-ttu-id="c954a-189">If Exchange is present in more than one forest, there might be (optionally) an on-premises GALSync solution.</span><span class="sxs-lookup"><span data-stu-id="c954a-189">If Exchange is present in more than one forest, there might be (optionally) an on-premises GALSync solution.</span></span> <span data-ttu-id="c954a-190">Every user is then represented as a contact in all other forests.</span><span class="sxs-lookup"><span data-stu-id="c954a-190">Every user is then represented as a contact in all other forests.</span></span> <span data-ttu-id="c954a-191">GALSync is commonly implemented through FIM 2010 or MIM 2016.</span><span class="sxs-lookup"><span data-stu-id="c954a-191">GALSync is commonly implemented through FIM 2010 or MIM 2016.</span></span> <span data-ttu-id="c954a-192">Azure AD Connect cannot be used for on-premises GALSync.</span><span class="sxs-lookup"><span data-stu-id="c954a-192">Azure AD Connect cannot be used for on-premises GALSync.</span></span>

<span data-ttu-id="c954a-193">In this scenario, identity objects are joined via the mail attribute.</span><span class="sxs-lookup"><span data-stu-id="c954a-193">In this scenario, identity objects are joined via the mail attribute.</span></span> <span data-ttu-id="c954a-194">A user who has a mailbox in one forest is joined with the contacts in the other forests.</span><span class="sxs-lookup"><span data-stu-id="c954a-194">A user who has a mailbox in one forest is joined with the contacts in the other forests.</span></span>

### <a name="multiple-forests-account-resource-forest"></a><span data-ttu-id="c954a-195">Multiple forests: account-resource forest</span><span class="sxs-lookup"><span data-stu-id="c954a-195">Multiple forests: account-resource forest</span></span>
![Option for using the ObjectSID and msExchMasterAccountSID attributes for matching when identities exist across multiple directories](./media/active-directory-aadconnect-topologies/MultiForestUsersObjectSID.png)

![Account-resource forest topology for multiple forests](./media/active-directory-aadconnect-topologies/MultiForestAccountResource.png)

<span data-ttu-id="c954a-198">In an account-resource forest topology, you have one or more *account* forests with active user accounts.</span><span class="sxs-lookup"><span data-stu-id="c954a-198">In an account-resource forest topology, you have one or more *account* forests with active user accounts.</span></span> <span data-ttu-id="c954a-199">You also have one or more *resource* forests with disabled accounts.</span><span class="sxs-lookup"><span data-stu-id="c954a-199">You also have one or more *resource* forests with disabled accounts.</span></span>

<span data-ttu-id="c954a-200">In this scenario, one (or more) resource forest trusts all account forests.</span><span class="sxs-lookup"><span data-stu-id="c954a-200">In this scenario, one (or more) resource forest trusts all account forests.</span></span> <span data-ttu-id="c954a-201">The resource forest typically has an extended Active Directory schema with Exchange and Lync.</span><span class="sxs-lookup"><span data-stu-id="c954a-201">The resource forest typically has an extended Active Directory schema with Exchange and Lync.</span></span> <span data-ttu-id="c954a-202">All Exchange and Lync services, along with other shared services, are located in this forest.</span><span class="sxs-lookup"><span data-stu-id="c954a-202">All Exchange and Lync services, along with other shared services, are located in this forest.</span></span> <span data-ttu-id="c954a-203">Users have a disabled user account in this forest, and the mailbox is linked to the account forest.</span><span class="sxs-lookup"><span data-stu-id="c954a-203">Users have a disabled user account in this forest, and the mailbox is linked to the account forest.</span></span>

## <a name="office-365-and-topology-considerations"></a><span data-ttu-id="c954a-204">Office 365 and topology considerations</span><span class="sxs-lookup"><span data-stu-id="c954a-204">Office 365 and topology considerations</span></span>
<span data-ttu-id="c954a-205">Some Office 365 workloads have certain restrictions on supported topologies:</span><span class="sxs-lookup"><span data-stu-id="c954a-205">Some Office 365 workloads have certain restrictions on supported topologies:</span></span>

| <span data-ttu-id="c954a-206">Workload</span><span class="sxs-lookup"><span data-stu-id="c954a-206">Workload</span></span> | <span data-ttu-id="c954a-207">Restrictions</span><span class="sxs-lookup"><span data-stu-id="c954a-207">Restrictions</span></span> |
| --------- | --------- |
| <span data-ttu-id="c954a-208">Exchange Online</span><span class="sxs-lookup"><span data-stu-id="c954a-208">Exchange Online</span></span> | <span data-ttu-id="c954a-209">For more information about hybrid topologies supported by Exchange Online, see [Hybrid deployments with multiple Active Directory forests](https://technet.microsoft.com/library/jj873754.aspx).</span><span class="sxs-lookup"><span data-stu-id="c954a-209">For more information about hybrid topologies supported by Exchange Online, see [Hybrid deployments with multiple Active Directory forests](https://technet.microsoft.com/library/jj873754.aspx).</span></span> |
| <span data-ttu-id="c954a-210">Skype for Business</span><span class="sxs-lookup"><span data-stu-id="c954a-210">Skype for Business</span></span> | <span data-ttu-id="c954a-211">When you're using multiple on-premises forests, only the account-resource forest topology is supported.</span><span class="sxs-lookup"><span data-stu-id="c954a-211">When you're using multiple on-premises forests, only the account-resource forest topology is supported.</span></span> <span data-ttu-id="c954a-212">For more information, see [Environmental requirements for Skype for Business Server 2015](https://technet.microsoft.com/library/dn933910.aspx).</span><span class="sxs-lookup"><span data-stu-id="c954a-212">For more information, see [Environmental requirements for Skype for Business Server 2015](https://technet.microsoft.com/library/dn933910.aspx).</span></span> |

<span data-ttu-id="c954a-213">If you are a larger organization, then you should consider to use the [Office 365 PreferredDataLocation](active-directory-aadconnectsync-feature-preferreddatalocation.md) feature.</span><span class="sxs-lookup"><span data-stu-id="c954a-213">If you are a larger organization, then you should consider to use the [Office 365 PreferredDataLocation](active-directory-aadconnectsync-feature-preferreddatalocation.md) feature.</span></span> <span data-ttu-id="c954a-214">It allows you to define in which datacenter region the user's resources are located.</span><span class="sxs-lookup"><span data-stu-id="c954a-214">It allows you to define in which datacenter region the user's resources are located.</span></span>

## <a name="staging-server"></a><span data-ttu-id="c954a-215">Staging server</span><span class="sxs-lookup"><span data-stu-id="c954a-215">Staging server</span></span>
![Staging server in a topology](./media/active-directory-aadconnect-topologies/MultiForestStaging.png)

<span data-ttu-id="c954a-217">Azure AD Connect supports installing a second server in *staging mode*.</span><span class="sxs-lookup"><span data-stu-id="c954a-217">Azure AD Connect supports installing a second server in *staging mode*.</span></span> <span data-ttu-id="c954a-218">A server in this mode reads data from all connected directories but does not write anything to connected directories.</span><span class="sxs-lookup"><span data-stu-id="c954a-218">A server in this mode reads data from all connected directories but does not write anything to connected directories.</span></span> <span data-ttu-id="c954a-219">It uses the normal synchronization cycle and therefore has an updated copy of the identity data.</span><span class="sxs-lookup"><span data-stu-id="c954a-219">It uses the normal synchronization cycle and therefore has an updated copy of the identity data.</span></span>

<span data-ttu-id="c954a-220">In a disaster where the primary server fails, you can fail over to the staging server.</span><span class="sxs-lookup"><span data-stu-id="c954a-220">In a disaster where the primary server fails, you can fail over to the staging server.</span></span> <span data-ttu-id="c954a-221">You do this in the Azure AD Connect wizard.</span><span class="sxs-lookup"><span data-stu-id="c954a-221">You do this in the Azure AD Connect wizard.</span></span> <span data-ttu-id="c954a-222">This second server can be located in a different datacenter because no infrastructure is shared with the primary server.</span><span class="sxs-lookup"><span data-stu-id="c954a-222">This second server can be located in a different datacenter because no infrastructure is shared with the primary server.</span></span> <span data-ttu-id="c954a-223">You must manually copy any configuration change made on the primary server to the second server.</span><span class="sxs-lookup"><span data-stu-id="c954a-223">You must manually copy any configuration change made on the primary server to the second server.</span></span>

<span data-ttu-id="c954a-224">You can use a staging server to test a new custom configuration and the effect that it has on your data.</span><span class="sxs-lookup"><span data-stu-id="c954a-224">You can use a staging server to test a new custom configuration and the effect that it has on your data.</span></span> <span data-ttu-id="c954a-225">You can preview the changes and adjust the configuration.</span><span class="sxs-lookup"><span data-stu-id="c954a-225">You can preview the changes and adjust the configuration.</span></span> <span data-ttu-id="c954a-226">When you're happy with the new configuration, you can make the staging server the active server and set the old active server to staging mode.</span><span class="sxs-lookup"><span data-stu-id="c954a-226">When you're happy with the new configuration, you can make the staging server the active server and set the old active server to staging mode.</span></span>

<span data-ttu-id="c954a-227">You can also use this method to replace the active sync server.</span><span class="sxs-lookup"><span data-stu-id="c954a-227">You can also use this method to replace the active sync server.</span></span> <span data-ttu-id="c954a-228">Prepare the new server and set it to staging mode.</span><span class="sxs-lookup"><span data-stu-id="c954a-228">Prepare the new server and set it to staging mode.</span></span> <span data-ttu-id="c954a-229">Make sure it's in a good state, disable staging mode (making it active), and shut down the currently active server.</span><span class="sxs-lookup"><span data-stu-id="c954a-229">Make sure it's in a good state, disable staging mode (making it active), and shut down the currently active server.</span></span>

<span data-ttu-id="c954a-230">It's possible to have more than one staging server when you want to have multiple backups in different datacenters.</span><span class="sxs-lookup"><span data-stu-id="c954a-230">It's possible to have more than one staging server when you want to have multiple backups in different datacenters.</span></span>

## <a name="multiple-azure-ad-tenants"></a><span data-ttu-id="c954a-231">Multiple Azure AD tenants</span><span class="sxs-lookup"><span data-stu-id="c954a-231">Multiple Azure AD tenants</span></span>
<span data-ttu-id="c954a-232">We recommend having a single tenant in Azure AD for an organization.</span><span class="sxs-lookup"><span data-stu-id="c954a-232">We recommend having a single tenant in Azure AD for an organization.</span></span>
<span data-ttu-id="c954a-233">Before you plan to use multiple Azure AD tenants, see the article [Administrative units management in Azure AD](../users-groups-roles/directory-administrative-units.md).</span><span class="sxs-lookup"><span data-stu-id="c954a-233">Before you plan to use multiple Azure AD tenants, see the article [Administrative units management in Azure AD](../users-groups-roles/directory-administrative-units.md).</span></span> <span data-ttu-id="c954a-234">It covers common scenarios where you can use a single tenant.</span><span class="sxs-lookup"><span data-stu-id="c954a-234">It covers common scenarios where you can use a single tenant.</span></span>

![Topology for multiple forests and multiple tenants](./media/active-directory-aadconnect-topologies/MultiForestMultiDirectory.png)

<span data-ttu-id="c954a-236">There's a 1:1 relationship between an Azure AD Connect sync server and an Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="c954a-236">There's a 1:1 relationship between an Azure AD Connect sync server and an Azure AD tenant.</span></span> <span data-ttu-id="c954a-237">For each Azure AD tenant, you need one Azure AD Connect sync server installation.</span><span class="sxs-lookup"><span data-stu-id="c954a-237">For each Azure AD tenant, you need one Azure AD Connect sync server installation.</span></span> <span data-ttu-id="c954a-238">The Azure AD tenant instances are isolated by design.</span><span class="sxs-lookup"><span data-stu-id="c954a-238">The Azure AD tenant instances are isolated by design.</span></span> <span data-ttu-id="c954a-239">That is, users in one tenant can't see users in the other tenant.</span><span class="sxs-lookup"><span data-stu-id="c954a-239">That is, users in one tenant can't see users in the other tenant.</span></span> <span data-ttu-id="c954a-240">If you want this separation, this is a supported configuration.</span><span class="sxs-lookup"><span data-stu-id="c954a-240">If you want this separation, this is a supported configuration.</span></span> <span data-ttu-id="c954a-241">Otherwise, you should use the single Azure AD tenant model.</span><span class="sxs-lookup"><span data-stu-id="c954a-241">Otherwise, you should use the single Azure AD tenant model.</span></span>

### <a name="each-object-only-once-in-an-azure-ad-tenant"></a><span data-ttu-id="c954a-242">Each object only once in an Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="c954a-242">Each object only once in an Azure AD tenant</span></span>
![Filtered topology for a single forest](./media/active-directory-aadconnect-topologies/SingleForestFiltered.png)

<span data-ttu-id="c954a-244">In this topology, one Azure AD Connect sync server is connected to each Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="c954a-244">In this topology, one Azure AD Connect sync server is connected to each Azure AD tenant.</span></span> <span data-ttu-id="c954a-245">The Azure AD Connect sync servers must be configured for filtering so that each has a mutually exclusive set of objects to operate on.</span><span class="sxs-lookup"><span data-stu-id="c954a-245">The Azure AD Connect sync servers must be configured for filtering so that each has a mutually exclusive set of objects to operate on.</span></span> <span data-ttu-id="c954a-246">You can, for example, scope each server to a particular domain or organizational unit.</span><span class="sxs-lookup"><span data-stu-id="c954a-246">You can, for example, scope each server to a particular domain or organizational unit.</span></span>

<span data-ttu-id="c954a-247">A DNS domain can be registered in only a single Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="c954a-247">A DNS domain can be registered in only a single Azure AD tenant.</span></span> <span data-ttu-id="c954a-248">The UPNs of the users in the on-premises Active Directory instance must also use separate namespaces.</span><span class="sxs-lookup"><span data-stu-id="c954a-248">The UPNs of the users in the on-premises Active Directory instance must also use separate namespaces.</span></span> <span data-ttu-id="c954a-249">For example, in the preceding picture, three separate UPN suffixes are registered in the on-premises Active Directory instance: contoso.com, fabrikam.com, and wingtiptoys.com.</span><span class="sxs-lookup"><span data-stu-id="c954a-249">For example, in the preceding picture, three separate UPN suffixes are registered in the on-premises Active Directory instance: contoso.com, fabrikam.com, and wingtiptoys.com.</span></span> <span data-ttu-id="c954a-250">The users in each on-premises Active Directory domain use a different namespace.</span><span class="sxs-lookup"><span data-stu-id="c954a-250">The users in each on-premises Active Directory domain use a different namespace.</span></span>

>[!NOTE]
><span data-ttu-id="c954a-251">Global Address List Synchronization (GalSync) is not done automatically in this topology and requires an additional custom MIM implementation to ensure each tenant has a complete Global Address List (GAL) in Exchange Online and Skype for Business Online.</span><span class="sxs-lookup"><span data-stu-id="c954a-251">Global Address List Synchronization (GalSync) is not done automatically in this topology and requires an additional custom MIM implementation to ensure each tenant has a complete Global Address List (GAL) in Exchange Online and Skype for Business Online.</span></span>


<span data-ttu-id="c954a-252">This topology has the following restrictions on otherwise supported scenarios:</span><span class="sxs-lookup"><span data-stu-id="c954a-252">This topology has the following restrictions on otherwise supported scenarios:</span></span>

* <span data-ttu-id="c954a-253">Only one of the Azure AD tenants can enable an Exchange hybrid with the on-premises Active Directory instance.</span><span class="sxs-lookup"><span data-stu-id="c954a-253">Only one of the Azure AD tenants can enable an Exchange hybrid with the on-premises Active Directory instance.</span></span>
* <span data-ttu-id="c954a-254">Windows 10 devices can be associated with only one Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="c954a-254">Windows 10 devices can be associated with only one Azure AD tenant.</span></span>
* <span data-ttu-id="c954a-255">The single sign-on (SSO) option for password hash synchronization and pass-through authentication can be used with only one Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="c954a-255">The single sign-on (SSO) option for password hash synchronization and pass-through authentication can be used with only one Azure AD tenant.</span></span>

<span data-ttu-id="c954a-256">The requirement for a mutually exclusive set of objects also applies to writeback.</span><span class="sxs-lookup"><span data-stu-id="c954a-256">The requirement for a mutually exclusive set of objects also applies to writeback.</span></span> <span data-ttu-id="c954a-257">Some writeback features are not supported with this topology because they assume a single on-premises configuration.</span><span class="sxs-lookup"><span data-stu-id="c954a-257">Some writeback features are not supported with this topology because they assume a single on-premises configuration.</span></span> <span data-ttu-id="c954a-258">These features include:</span><span class="sxs-lookup"><span data-stu-id="c954a-258">These features include:</span></span>

* <span data-ttu-id="c954a-259">Group writeback with default configuration.</span><span class="sxs-lookup"><span data-stu-id="c954a-259">Group writeback with default configuration.</span></span>
* <span data-ttu-id="c954a-260">Device writeback.</span><span class="sxs-lookup"><span data-stu-id="c954a-260">Device writeback.</span></span>

### <a name="each-object-multiple-times-in-an-azure-ad-tenant"></a><span data-ttu-id="c954a-261">Each object multiple times in an Azure AD tenant</span><span class="sxs-lookup"><span data-stu-id="c954a-261">Each object multiple times in an Azure AD tenant</span></span>
![Unsupported topology for a single forest and multiple tenants](./media/active-directory-aadconnect-topologies/SingleForestMultiDirectoryUnsupported.png) ![Unsupported topology for a single forest and multiple connectors](./media/active-directory-aadconnect-topologies/SingleForestMultiConnectorsUnsupported.png)

<span data-ttu-id="c954a-264">These tasks are unsupported:</span><span class="sxs-lookup"><span data-stu-id="c954a-264">These tasks are unsupported:</span></span>

* <span data-ttu-id="c954a-265">Sync the same user to multiple Azure AD tenants.</span><span class="sxs-lookup"><span data-stu-id="c954a-265">Sync the same user to multiple Azure AD tenants.</span></span>
* <span data-ttu-id="c954a-266">Make a configuration change so that users in one Azure AD tenant appear as contacts in another Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="c954a-266">Make a configuration change so that users in one Azure AD tenant appear as contacts in another Azure AD tenant.</span></span>
* <span data-ttu-id="c954a-267">Modify Azure AD Connect sync to connect to multiple Azure AD tenants.</span><span class="sxs-lookup"><span data-stu-id="c954a-267">Modify Azure AD Connect sync to connect to multiple Azure AD tenants.</span></span>

### <a name="galsync-by-using-writeback"></a><span data-ttu-id="c954a-268">GALSync by using writeback</span><span class="sxs-lookup"><span data-stu-id="c954a-268">GALSync by using writeback</span></span>
![Unsupported topology for multiple forests and multiple directories, with GALSync focusing on Azure AD](./media/active-directory-aadconnect-topologies/MultiForestMultiDirectoryGALSync1Unsupported.png) ![Unsupported topology for multiple forests and multiple directories, with GALSync focusing on on-premises Active Directory](./media/active-directory-aadconnect-topologies/MultiForestMultiDirectoryGALSync2Unsupported.png)

<span data-ttu-id="c954a-271">Azure AD tenants are isolated by design.</span><span class="sxs-lookup"><span data-stu-id="c954a-271">Azure AD tenants are isolated by design.</span></span> <span data-ttu-id="c954a-272">These tasks are unsupported:</span><span class="sxs-lookup"><span data-stu-id="c954a-272">These tasks are unsupported:</span></span>

* <span data-ttu-id="c954a-273">Change the configuration of Azure AD Connect sync to read data from another Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="c954a-273">Change the configuration of Azure AD Connect sync to read data from another Azure AD tenant.</span></span>
* <span data-ttu-id="c954a-274">Export users as contacts to another on-premises Active Directory instance by using Azure AD Connect sync.</span><span class="sxs-lookup"><span data-stu-id="c954a-274">Export users as contacts to another on-premises Active Directory instance by using Azure AD Connect sync.</span></span>

### <a name="galsync-with-on-premises-sync-server"></a><span data-ttu-id="c954a-275">GALSync with on-premises sync server</span><span class="sxs-lookup"><span data-stu-id="c954a-275">GALSync with on-premises sync server</span></span>
![GALSync in a topology for multiple forests and multiple directories](./media/active-directory-aadconnect-topologies/MultiForestMultiDirectoryGALSync.png)

<span data-ttu-id="c954a-277">You can use FIM 2010 or MIM 2016 on-premises to sync users (via GALSync) between two Exchange organizations.</span><span class="sxs-lookup"><span data-stu-id="c954a-277">You can use FIM 2010 or MIM 2016 on-premises to sync users (via GALSync) between two Exchange organizations.</span></span> <span data-ttu-id="c954a-278">The users in one organization appear as foreign users/contacts in the other organization.</span><span class="sxs-lookup"><span data-stu-id="c954a-278">The users in one organization appear as foreign users/contacts in the other organization.</span></span> <span data-ttu-id="c954a-279">These different on-premises Active Directory instances can then be synchronized with their own Azure AD tenants.</span><span class="sxs-lookup"><span data-stu-id="c954a-279">These different on-premises Active Directory instances can then be synchronized with their own Azure AD tenants.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c954a-280">Next steps</span><span class="sxs-lookup"><span data-stu-id="c954a-280">Next steps</span></span>
<span data-ttu-id="c954a-281">To learn how to install Azure AD Connect for these scenarios, see [Custom installation of Azure AD Connect](active-directory-aadconnect-get-started-custom.md).</span><span class="sxs-lookup"><span data-stu-id="c954a-281">To learn how to install Azure AD Connect for these scenarios, see [Custom installation of Azure AD Connect](active-directory-aadconnect-get-started-custom.md).</span></span>

<span data-ttu-id="c954a-282">Learn more about the [Azure AD Connect sync](active-directory-aadconnectsync-whatis.md) configuration.</span><span class="sxs-lookup"><span data-stu-id="c954a-282">Learn more about the [Azure AD Connect sync](active-directory-aadconnectsync-whatis.md) configuration.</span></span>

<span data-ttu-id="c954a-283">Learn more about [integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="c954a-283">Learn more about [integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
