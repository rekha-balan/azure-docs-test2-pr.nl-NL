---
title: Active Directory Federation Services in Azure | Microsoft Docs
description: In this document you will learn how to deploy AD FS in Azure for high availablity.
keywords: deploy AD FS in azure, deploy azure adfs, azure adfs, azure ad fs,deploy adfs, deploy ad fs, adfs in azure, deploy adfs in azure, deploy AD FS in azure, adfs azure, introduction to AD FS, Azure, AD FS in Azure, iaas, ADFS, move adfs to azure
services: active-directory
documentationcenter: ''
author: anandyadavmsft
manager: femila
editor: ''
ms.assetid: 692a188c-badc-44aa-ba86-71c0e8074510
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 02/27/2017
ms.author: anandy; billmath
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: cdff8ed87b8d4d326f5a60c0e263b076bdc3ae54
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44669394"
---
# <a name="deploying-active-directory-federation-services-in-azure"></a><span data-ttu-id="8a28c-104">Deploying Active Directory Federation Services in Azure</span><span class="sxs-lookup"><span data-stu-id="8a28c-104">Deploying Active Directory Federation Services in Azure</span></span>
<span data-ttu-id="8a28c-105">AD FS provides simplified, secured identity federation and Web single sign-on (SSO) capabilities.</span><span class="sxs-lookup"><span data-stu-id="8a28c-105">AD FS provides simplified, secured identity federation and Web single sign-on (SSO) capabilities.</span></span> <span data-ttu-id="8a28c-106">Federation with Azure AD or O365 enables users to authenticate using on-premises credentials and access all resources in cloud.</span><span class="sxs-lookup"><span data-stu-id="8a28c-106">Federation with Azure AD or O365 enables users to authenticate using on-premises credentials and access all resources in cloud.</span></span> <span data-ttu-id="8a28c-107">As a result, it becomes important to have a highly available AD FS infrastructure to ensure access to resources both on-premises and in the cloud.</span><span class="sxs-lookup"><span data-stu-id="8a28c-107">As a result, it becomes important to have a highly available AD FS infrastructure to ensure access to resources both on-premises and in the cloud.</span></span> <span data-ttu-id="8a28c-108">Deploying AD FS in Azure can help achieve the high availability required with minimal efforts.</span><span class="sxs-lookup"><span data-stu-id="8a28c-108">Deploying AD FS in Azure can help achieve the high availability required with minimal efforts.</span></span>
<span data-ttu-id="8a28c-109">There are several advantages of deploying AD FS in Azure, a few of them are listed below:</span><span class="sxs-lookup"><span data-stu-id="8a28c-109">There are several advantages of deploying AD FS in Azure, a few of them are listed below:</span></span>

* <span data-ttu-id="8a28c-110">**High Availability** - With the power of Azure Availability Sets, you ensure a highly available infrastructure.</span><span class="sxs-lookup"><span data-stu-id="8a28c-110">**High Availability** - With the power of Azure Availability Sets, you ensure a highly available infrastructure.</span></span>
* <span data-ttu-id="8a28c-111">**Easy to Scale** – Need more performance?</span><span class="sxs-lookup"><span data-stu-id="8a28c-111">**Easy to Scale** – Need more performance?</span></span> <span data-ttu-id="8a28c-112">Easily migrate to more powerful machines by just a few clicks in Azure</span><span class="sxs-lookup"><span data-stu-id="8a28c-112">Easily migrate to more powerful machines by just a few clicks in Azure</span></span>
* <span data-ttu-id="8a28c-113">**Cross-Geo Redundancy** – With Azure Geo Redundancy you can be assured that your infrastructure is highly available across the globe</span><span class="sxs-lookup"><span data-stu-id="8a28c-113">**Cross-Geo Redundancy** – With Azure Geo Redundancy you can be assured that your infrastructure is highly available across the globe</span></span>
* <span data-ttu-id="8a28c-114">**Easy to Manage** – With highly simplified management options in Azure portal, managing your infrastructure is very easy and hassle-free</span><span class="sxs-lookup"><span data-stu-id="8a28c-114">**Easy to Manage** – With highly simplified management options in Azure portal, managing your infrastructure is very easy and hassle-free</span></span> 

## <a name="design-principles"></a><span data-ttu-id="8a28c-115">Design principles</span><span class="sxs-lookup"><span data-stu-id="8a28c-115">Design principles</span></span>
![Deployment design](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/deployment.png)

<span data-ttu-id="8a28c-117">The diagram above shows the recommended basic topology to start deploying your AD FS infrastructure in Azure.</span><span class="sxs-lookup"><span data-stu-id="8a28c-117">The diagram above shows the recommended basic topology to start deploying your AD FS infrastructure in Azure.</span></span> <span data-ttu-id="8a28c-118">The principles behind the various components of the topology are listed below:</span><span class="sxs-lookup"><span data-stu-id="8a28c-118">The principles behind the various components of the topology are listed below:</span></span>

* <span data-ttu-id="8a28c-119">**DC / ADFS Servers**: If you have fewer than 1,000 users you can simply install AD FS role on your domain controllers.</span><span class="sxs-lookup"><span data-stu-id="8a28c-119">**DC / ADFS Servers**: If you have fewer than 1,000 users you can simply install AD FS role on your domain controllers.</span></span> <span data-ttu-id="8a28c-120">If you do not want any performance impact on the domain controllers or if you have more than 1,000 users, then deploy AD FS on separate servers.</span><span class="sxs-lookup"><span data-stu-id="8a28c-120">If you do not want any performance impact on the domain controllers or if you have more than 1,000 users, then deploy AD FS on separate servers.</span></span>
* <span data-ttu-id="8a28c-121">**WAP Server** – it is necessary to deploy Web Application Proxy servers, so that users can reach the AD FS when they are not on the company network also.</span><span class="sxs-lookup"><span data-stu-id="8a28c-121">**WAP Server** – it is necessary to deploy Web Application Proxy servers, so that users can reach the AD FS when they are not on the company network also.</span></span>
* <span data-ttu-id="8a28c-122">**DMZ**: The Web Application Proxy servers will be placed in the DMZ and ONLY TCP/443 access is allowed between the DMZ and the internal subnet.</span><span class="sxs-lookup"><span data-stu-id="8a28c-122">**DMZ**: The Web Application Proxy servers will be placed in the DMZ and ONLY TCP/443 access is allowed between the DMZ and the internal subnet.</span></span>
* <span data-ttu-id="8a28c-123">**Load Balancers**: To ensure high availability of AD FS and Web Application Proxy servers, we recommend using an internal load balancer for AD FS servers and Azure Load Balancer for Web Application Proxy servers.</span><span class="sxs-lookup"><span data-stu-id="8a28c-123">**Load Balancers**: To ensure high availability of AD FS and Web Application Proxy servers, we recommend using an internal load balancer for AD FS servers and Azure Load Balancer for Web Application Proxy servers.</span></span>
* <span data-ttu-id="8a28c-124">**Availability Sets**: To provide redundancy to your AD FS deployment, it is recommended that you group two or more virtual machines in an Availability Set for similar workloads.</span><span class="sxs-lookup"><span data-stu-id="8a28c-124">**Availability Sets**: To provide redundancy to your AD FS deployment, it is recommended that you group two or more virtual machines in an Availability Set for similar workloads.</span></span> <span data-ttu-id="8a28c-125">This configuration ensures that during either a planned or unplanned maintenance event, at least one virtual machine will be available</span><span class="sxs-lookup"><span data-stu-id="8a28c-125">This configuration ensures that during either a planned or unplanned maintenance event, at least one virtual machine will be available</span></span>
* <span data-ttu-id="8a28c-126">**Storage Accounts**: It is recommended to have two storage accounts.</span><span class="sxs-lookup"><span data-stu-id="8a28c-126">**Storage Accounts**: It is recommended to have two storage accounts.</span></span> <span data-ttu-id="8a28c-127">Having a single storage account can lead to creation of a single point of failure and can cause the deployment to become unavailable in an unlikely scenario where the storage account goes down.</span><span class="sxs-lookup"><span data-stu-id="8a28c-127">Having a single storage account can lead to creation of a single point of failure and can cause the deployment to become unavailable in an unlikely scenario where the storage account goes down.</span></span> <span data-ttu-id="8a28c-128">Two storage accounts will help associate one storage account for each fault line.</span><span class="sxs-lookup"><span data-stu-id="8a28c-128">Two storage accounts will help associate one storage account for each fault line.</span></span>
* <span data-ttu-id="8a28c-129">**Network segregation**:  Web Application Proxy servers should be deployed in a separate DMZ network.</span><span class="sxs-lookup"><span data-stu-id="8a28c-129">**Network segregation**:  Web Application Proxy servers should be deployed in a separate DMZ network.</span></span> <span data-ttu-id="8a28c-130">You can divide one virtual network into two subnets and then deploy the Web Application Proxy server(s) in an isolated subnet.</span><span class="sxs-lookup"><span data-stu-id="8a28c-130">You can divide one virtual network into two subnets and then deploy the Web Application Proxy server(s) in an isolated subnet.</span></span> <span data-ttu-id="8a28c-131">You can simply configure the network security group settings for each subnet and allow only required communication between the two subnets.</span><span class="sxs-lookup"><span data-stu-id="8a28c-131">You can simply configure the network security group settings for each subnet and allow only required communication between the two subnets.</span></span> <span data-ttu-id="8a28c-132">More details are given per deployment scenario below</span><span class="sxs-lookup"><span data-stu-id="8a28c-132">More details are given per deployment scenario below</span></span>

## <a name="steps-to-deploy-ad-fs-in-azure"></a><span data-ttu-id="8a28c-133">Steps to deploy AD FS in Azure</span><span class="sxs-lookup"><span data-stu-id="8a28c-133">Steps to deploy AD FS in Azure</span></span>
<span data-ttu-id="8a28c-134">The steps mentioned in this section outline the guide to deploy the below depicted AD FS infrastructure in Azure.</span><span class="sxs-lookup"><span data-stu-id="8a28c-134">The steps mentioned in this section outline the guide to deploy the below depicted AD FS infrastructure in Azure.</span></span>

### <a name="1-deploying-the-network"></a><span data-ttu-id="8a28c-135">1. Deploying the network</span><span class="sxs-lookup"><span data-stu-id="8a28c-135">1. Deploying the network</span></span>
<span data-ttu-id="8a28c-136">As outlined above, you can either create two subnets in a single virtual network or else create two completely different virtual networks (VNet).</span><span class="sxs-lookup"><span data-stu-id="8a28c-136">As outlined above, you can either create two subnets in a single virtual network or else create two completely different virtual networks (VNet).</span></span> <span data-ttu-id="8a28c-137">This article will focus on deploying a single virtual network and divide it into two subnets.</span><span class="sxs-lookup"><span data-stu-id="8a28c-137">This article will focus on deploying a single virtual network and divide it into two subnets.</span></span> <span data-ttu-id="8a28c-138">This is currently an easier approach as two separate VNets would require a VNet to VNet gateway for communications.</span><span class="sxs-lookup"><span data-stu-id="8a28c-138">This is currently an easier approach as two separate VNets would require a VNet to VNet gateway for communications.</span></span>

<span data-ttu-id="8a28c-139">**1.1 Create virtual network**</span><span class="sxs-lookup"><span data-stu-id="8a28c-139">**1.1 Create virtual network**</span></span>

![Create virtual network](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/deploynetwork1.png)

<span data-ttu-id="8a28c-141">In the Azure portal, select virtual network and you can deploy the virtual network and one subnet immediately with just one click.</span><span class="sxs-lookup"><span data-stu-id="8a28c-141">In the Azure portal, select virtual network and you can deploy the virtual network and one subnet immediately with just one click.</span></span> <span data-ttu-id="8a28c-142">INT subnet is also defined and is ready now for VMs to be added.</span><span class="sxs-lookup"><span data-stu-id="8a28c-142">INT subnet is also defined and is ready now for VMs to be added.</span></span>
<span data-ttu-id="8a28c-143">The next step is to add another subnet to the network, i.e. the DMZ subnet.</span><span class="sxs-lookup"><span data-stu-id="8a28c-143">The next step is to add another subnet to the network, i.e. the DMZ subnet.</span></span> <span data-ttu-id="8a28c-144">To create the DMZ subnet, simply</span><span class="sxs-lookup"><span data-stu-id="8a28c-144">To create the DMZ subnet, simply</span></span>

* <span data-ttu-id="8a28c-145">Select the newly created network</span><span class="sxs-lookup"><span data-stu-id="8a28c-145">Select the newly created network</span></span>
* <span data-ttu-id="8a28c-146">In the properties select subnet</span><span class="sxs-lookup"><span data-stu-id="8a28c-146">In the properties select subnet</span></span>
* <span data-ttu-id="8a28c-147">In the subnet panel click on the add button</span><span class="sxs-lookup"><span data-stu-id="8a28c-147">In the subnet panel click on the add button</span></span>
* <span data-ttu-id="8a28c-148">Provide the subnet name and address space information to create the subnet</span><span class="sxs-lookup"><span data-stu-id="8a28c-148">Provide the subnet name and address space information to create the subnet</span></span>

![Subnet](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/deploynetwork2.png)

![Subnet DMZ](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/deploynetwork3.png)

<span data-ttu-id="8a28c-151">**1.2. Creating the network security groups**</span><span class="sxs-lookup"><span data-stu-id="8a28c-151">**1.2. Creating the network security groups**</span></span>

<span data-ttu-id="8a28c-152">A Network security group (NSG) contains a list of Access Control List (ACL) rules that allow or deny network traffic to your VM instances in a Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="8a28c-152">A Network security group (NSG) contains a list of Access Control List (ACL) rules that allow or deny network traffic to your VM instances in a Virtual Network.</span></span> <span data-ttu-id="8a28c-153">NSGs can be associated with either subnets or individual VM instances within that subnet.</span><span class="sxs-lookup"><span data-stu-id="8a28c-153">NSGs can be associated with either subnets or individual VM instances within that subnet.</span></span> <span data-ttu-id="8a28c-154">When an NSG is associated with a subnet, the ACL rules apply to all the VM instances in that subnet.</span><span class="sxs-lookup"><span data-stu-id="8a28c-154">When an NSG is associated with a subnet, the ACL rules apply to all the VM instances in that subnet.</span></span>
<span data-ttu-id="8a28c-155">For the purpose of this guidance, we will create two NSGs: one each for an internal network and a DMZ.</span><span class="sxs-lookup"><span data-stu-id="8a28c-155">For the purpose of this guidance, we will create two NSGs: one each for an internal network and a DMZ.</span></span> <span data-ttu-id="8a28c-156">They will be labeled NSG_INT and NSG_DMZ respectively.</span><span class="sxs-lookup"><span data-stu-id="8a28c-156">They will be labeled NSG_INT and NSG_DMZ respectively.</span></span>

![Create NSG](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/creatensg1.png)

<span data-ttu-id="8a28c-158">After the NSG is created, there will be 0 inbound and 0 outbound rules.</span><span class="sxs-lookup"><span data-stu-id="8a28c-158">After the NSG is created, there will be 0 inbound and 0 outbound rules.</span></span> <span data-ttu-id="8a28c-159">Once the roles on the respective servers are installed and functional, then the inbound and outbound rules can be made according to the desired level of security.</span><span class="sxs-lookup"><span data-stu-id="8a28c-159">Once the roles on the respective servers are installed and functional, then the inbound and outbound rules can be made according to the desired level of security.</span></span>

![Initialize NSG](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/nsgint1.png)

<span data-ttu-id="8a28c-161">After the NSGs are created, associate NSG_INT with subnet INT and NSG_DMZ with subnet DMZ.</span><span class="sxs-lookup"><span data-stu-id="8a28c-161">After the NSGs are created, associate NSG_INT with subnet INT and NSG_DMZ with subnet DMZ.</span></span> <span data-ttu-id="8a28c-162">An example screenshot is given below:</span><span class="sxs-lookup"><span data-stu-id="8a28c-162">An example screenshot is given below:</span></span>

![NSG configure](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/nsgconfigure1.png)

* <span data-ttu-id="8a28c-164">Click on Subnets to open the panel for subnets</span><span class="sxs-lookup"><span data-stu-id="8a28c-164">Click on Subnets to open the panel for subnets</span></span>
* <span data-ttu-id="8a28c-165">Select the subnet to associate with the NSG</span><span class="sxs-lookup"><span data-stu-id="8a28c-165">Select the subnet to associate with the NSG</span></span> 

<span data-ttu-id="8a28c-166">After configuration, the panel for Subnets should look like below:</span><span class="sxs-lookup"><span data-stu-id="8a28c-166">After configuration, the panel for Subnets should look like below:</span></span>

![Subnets after NSG](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/nsgconfigure2.png)

<span data-ttu-id="8a28c-168">**1.3. Create Connection to on-premises**</span><span class="sxs-lookup"><span data-stu-id="8a28c-168">**1.3. Create Connection to on-premises**</span></span>

<span data-ttu-id="8a28c-169">We will need a connection to on-premises in order to deploy the domain controller (DC) in azure.</span><span class="sxs-lookup"><span data-stu-id="8a28c-169">We will need a connection to on-premises in order to deploy the domain controller (DC) in azure.</span></span> <span data-ttu-id="8a28c-170">Azure offers various connectivity options to connect your on-premises infrastructure to your Azure infrastructure.</span><span class="sxs-lookup"><span data-stu-id="8a28c-170">Azure offers various connectivity options to connect your on-premises infrastructure to your Azure infrastructure.</span></span>

* <span data-ttu-id="8a28c-171">Point-to-site</span><span class="sxs-lookup"><span data-stu-id="8a28c-171">Point-to-site</span></span>
* <span data-ttu-id="8a28c-172">Virtual Network Site-to-site</span><span class="sxs-lookup"><span data-stu-id="8a28c-172">Virtual Network Site-to-site</span></span>
* <span data-ttu-id="8a28c-173">ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="8a28c-173">ExpressRoute</span></span>

<span data-ttu-id="8a28c-174">It is recommended to use ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="8a28c-174">It is recommended to use ExpressRoute.</span></span> <span data-ttu-id="8a28c-175">ExpressRoute lets you create private connections between Azure datacenters and infrastructure that’s on your premises or in a co-location environment.</span><span class="sxs-lookup"><span data-stu-id="8a28c-175">ExpressRoute lets you create private connections between Azure datacenters and infrastructure that’s on your premises or in a co-location environment.</span></span> <span data-ttu-id="8a28c-176">ExpressRoute connections do not go over the public Internet.</span><span class="sxs-lookup"><span data-stu-id="8a28c-176">ExpressRoute connections do not go over the public Internet.</span></span> <span data-ttu-id="8a28c-177">They offer more reliability, faster speeds, lower latencies and higher security than typical connections over the Internet.</span><span class="sxs-lookup"><span data-stu-id="8a28c-177">They offer more reliability, faster speeds, lower latencies and higher security than typical connections over the Internet.</span></span>
<span data-ttu-id="8a28c-178">While it is recommended to use ExpressRoute, you may choose any connection method best suited for your organization.</span><span class="sxs-lookup"><span data-stu-id="8a28c-178">While it is recommended to use ExpressRoute, you may choose any connection method best suited for your organization.</span></span> <span data-ttu-id="8a28c-179">To learn more about ExpressRoute and the various connectivity options using ExpressRoute, read [ExpressRoute technical overview](https://aka.ms/Azure/ExpressRoute).</span><span class="sxs-lookup"><span data-stu-id="8a28c-179">To learn more about ExpressRoute and the various connectivity options using ExpressRoute, read [ExpressRoute technical overview](https://aka.ms/Azure/ExpressRoute).</span></span>

### <a name="2-create-storage-accounts"></a><span data-ttu-id="8a28c-180">2. Create storage accounts</span><span class="sxs-lookup"><span data-stu-id="8a28c-180">2. Create storage accounts</span></span>
<span data-ttu-id="8a28c-181">In order to maintain high availability and avoid dependence on a single storage account, you can create two storage accounts.</span><span class="sxs-lookup"><span data-stu-id="8a28c-181">In order to maintain high availability and avoid dependence on a single storage account, you can create two storage accounts.</span></span> <span data-ttu-id="8a28c-182">Divide the machines in each availability set into two groups and then assign each group a separate storage account.</span><span class="sxs-lookup"><span data-stu-id="8a28c-182">Divide the machines in each availability set into two groups and then assign each group a separate storage account.</span></span>

![Create storage accounts](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/storageaccount1.png)

### <a name="3-create-availability-sets"></a><span data-ttu-id="8a28c-184">3. Create availability sets</span><span class="sxs-lookup"><span data-stu-id="8a28c-184">3. Create availability sets</span></span>
<span data-ttu-id="8a28c-185">For each role (DC/AD FS and WAP), create availability sets that will contain 2 machines each at the minimum.</span><span class="sxs-lookup"><span data-stu-id="8a28c-185">For each role (DC/AD FS and WAP), create availability sets that will contain 2 machines each at the minimum.</span></span> <span data-ttu-id="8a28c-186">This will help achieve higher availability for each role.</span><span class="sxs-lookup"><span data-stu-id="8a28c-186">This will help achieve higher availability for each role.</span></span> <span data-ttu-id="8a28c-187">While creating the availability sets, it is essential to decide on the following:</span><span class="sxs-lookup"><span data-stu-id="8a28c-187">While creating the availability sets, it is essential to decide on the following:</span></span>

* <span data-ttu-id="8a28c-188">**Fault Domains**: Virtual machines in the same fault domain share the same power source and physical network switch.</span><span class="sxs-lookup"><span data-stu-id="8a28c-188">**Fault Domains**: Virtual machines in the same fault domain share the same power source and physical network switch.</span></span> <span data-ttu-id="8a28c-189">A minimum of 2 fault domains are recommended.</span><span class="sxs-lookup"><span data-stu-id="8a28c-189">A minimum of 2 fault domains are recommended.</span></span> <span data-ttu-id="8a28c-190">The default value is 3 and you can leave it as is for the purpose of this deployment</span><span class="sxs-lookup"><span data-stu-id="8a28c-190">The default value is 3 and you can leave it as is for the purpose of this deployment</span></span>
* <span data-ttu-id="8a28c-191">**Update domains**: Machines belonging to the same update domain are restarted together during an update.</span><span class="sxs-lookup"><span data-stu-id="8a28c-191">**Update domains**: Machines belonging to the same update domain are restarted together during an update.</span></span> <span data-ttu-id="8a28c-192">You want to have minimum of 2 update domains.</span><span class="sxs-lookup"><span data-stu-id="8a28c-192">You want to have minimum of 2 update domains.</span></span> <span data-ttu-id="8a28c-193">The default value is 5 and you can leave it as is for the purpose of this deployment</span><span class="sxs-lookup"><span data-stu-id="8a28c-193">The default value is 5 and you can leave it as is for the purpose of this deployment</span></span>

![Availability sets](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/availabilityset1.png)

<span data-ttu-id="8a28c-195">Create the following availability sets</span><span class="sxs-lookup"><span data-stu-id="8a28c-195">Create the following availability sets</span></span>

| <span data-ttu-id="8a28c-196">Availability Set</span><span class="sxs-lookup"><span data-stu-id="8a28c-196">Availability Set</span></span> | <span data-ttu-id="8a28c-197">Role</span><span class="sxs-lookup"><span data-stu-id="8a28c-197">Role</span></span> | <span data-ttu-id="8a28c-198">Fault domains</span><span class="sxs-lookup"><span data-stu-id="8a28c-198">Fault domains</span></span> | <span data-ttu-id="8a28c-199">Update domains</span><span class="sxs-lookup"><span data-stu-id="8a28c-199">Update domains</span></span> |
|:---:|:---:|:---:|:--- |
| <span data-ttu-id="8a28c-200">contosodcset</span><span class="sxs-lookup"><span data-stu-id="8a28c-200">contosodcset</span></span> |<span data-ttu-id="8a28c-201">DC/ADFS</span><span class="sxs-lookup"><span data-stu-id="8a28c-201">DC/ADFS</span></span> |<span data-ttu-id="8a28c-202">3</span><span class="sxs-lookup"><span data-stu-id="8a28c-202">3</span></span> |<span data-ttu-id="8a28c-203">5</span><span class="sxs-lookup"><span data-stu-id="8a28c-203">5</span></span> |
| <span data-ttu-id="8a28c-204">contosowapset</span><span class="sxs-lookup"><span data-stu-id="8a28c-204">contosowapset</span></span> |<span data-ttu-id="8a28c-205">WAP</span><span class="sxs-lookup"><span data-stu-id="8a28c-205">WAP</span></span> |<span data-ttu-id="8a28c-206">3</span><span class="sxs-lookup"><span data-stu-id="8a28c-206">3</span></span> |<span data-ttu-id="8a28c-207">5</span><span class="sxs-lookup"><span data-stu-id="8a28c-207">5</span></span> |

### <a name="4-deploy-virtual-machines"></a><span data-ttu-id="8a28c-208">4. Deploy virtual machines</span><span class="sxs-lookup"><span data-stu-id="8a28c-208">4. Deploy virtual machines</span></span>
<span data-ttu-id="8a28c-209">The next step is to deploy virtual machines that will host the different roles in your infrastructure.</span><span class="sxs-lookup"><span data-stu-id="8a28c-209">The next step is to deploy virtual machines that will host the different roles in your infrastructure.</span></span> <span data-ttu-id="8a28c-210">A minimum of two machines are recommended in each availability set.</span><span class="sxs-lookup"><span data-stu-id="8a28c-210">A minimum of two machines are recommended in each availability set.</span></span> <span data-ttu-id="8a28c-211">Create four virtual machines for the basic deployment.</span><span class="sxs-lookup"><span data-stu-id="8a28c-211">Create four virtual machines for the basic deployment.</span></span>

| <span data-ttu-id="8a28c-212">Machine</span><span class="sxs-lookup"><span data-stu-id="8a28c-212">Machine</span></span> | <span data-ttu-id="8a28c-213">Role</span><span class="sxs-lookup"><span data-stu-id="8a28c-213">Role</span></span> | <span data-ttu-id="8a28c-214">Subnet</span><span class="sxs-lookup"><span data-stu-id="8a28c-214">Subnet</span></span> | <span data-ttu-id="8a28c-215">Availability set</span><span class="sxs-lookup"><span data-stu-id="8a28c-215">Availability set</span></span> | <span data-ttu-id="8a28c-216">Storage account</span><span class="sxs-lookup"><span data-stu-id="8a28c-216">Storage account</span></span> | <span data-ttu-id="8a28c-217">IP Address</span><span class="sxs-lookup"><span data-stu-id="8a28c-217">IP Address</span></span> |
|:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="8a28c-218">contosodc1</span><span class="sxs-lookup"><span data-stu-id="8a28c-218">contosodc1</span></span> |<span data-ttu-id="8a28c-219">DC/ADFS</span><span class="sxs-lookup"><span data-stu-id="8a28c-219">DC/ADFS</span></span> |<span data-ttu-id="8a28c-220">INT</span><span class="sxs-lookup"><span data-stu-id="8a28c-220">INT</span></span> |<span data-ttu-id="8a28c-221">contosodcset</span><span class="sxs-lookup"><span data-stu-id="8a28c-221">contosodcset</span></span> |<span data-ttu-id="8a28c-222">contososac1</span><span class="sxs-lookup"><span data-stu-id="8a28c-222">contososac1</span></span> |<span data-ttu-id="8a28c-223">Static</span><span class="sxs-lookup"><span data-stu-id="8a28c-223">Static</span></span> |
| <span data-ttu-id="8a28c-224">contosodc2</span><span class="sxs-lookup"><span data-stu-id="8a28c-224">contosodc2</span></span> |<span data-ttu-id="8a28c-225">DC/ADFS</span><span class="sxs-lookup"><span data-stu-id="8a28c-225">DC/ADFS</span></span> |<span data-ttu-id="8a28c-226">INT</span><span class="sxs-lookup"><span data-stu-id="8a28c-226">INT</span></span> |<span data-ttu-id="8a28c-227">contosodcset</span><span class="sxs-lookup"><span data-stu-id="8a28c-227">contosodcset</span></span> |<span data-ttu-id="8a28c-228">contososac2</span><span class="sxs-lookup"><span data-stu-id="8a28c-228">contososac2</span></span> |<span data-ttu-id="8a28c-229">Static</span><span class="sxs-lookup"><span data-stu-id="8a28c-229">Static</span></span> |
| <span data-ttu-id="8a28c-230">contosowap1</span><span class="sxs-lookup"><span data-stu-id="8a28c-230">contosowap1</span></span> |<span data-ttu-id="8a28c-231">WAP</span><span class="sxs-lookup"><span data-stu-id="8a28c-231">WAP</span></span> |<span data-ttu-id="8a28c-232">DMZ</span><span class="sxs-lookup"><span data-stu-id="8a28c-232">DMZ</span></span> |<span data-ttu-id="8a28c-233">contosowapset</span><span class="sxs-lookup"><span data-stu-id="8a28c-233">contosowapset</span></span> |<span data-ttu-id="8a28c-234">contososac1</span><span class="sxs-lookup"><span data-stu-id="8a28c-234">contososac1</span></span> |<span data-ttu-id="8a28c-235">Static</span><span class="sxs-lookup"><span data-stu-id="8a28c-235">Static</span></span> |
| <span data-ttu-id="8a28c-236">contosowap2</span><span class="sxs-lookup"><span data-stu-id="8a28c-236">contosowap2</span></span> |<span data-ttu-id="8a28c-237">WAP</span><span class="sxs-lookup"><span data-stu-id="8a28c-237">WAP</span></span> |<span data-ttu-id="8a28c-238">DMZ</span><span class="sxs-lookup"><span data-stu-id="8a28c-238">DMZ</span></span> |<span data-ttu-id="8a28c-239">contosowapset</span><span class="sxs-lookup"><span data-stu-id="8a28c-239">contosowapset</span></span> |<span data-ttu-id="8a28c-240">contososac2</span><span class="sxs-lookup"><span data-stu-id="8a28c-240">contososac2</span></span> |<span data-ttu-id="8a28c-241">Static</span><span class="sxs-lookup"><span data-stu-id="8a28c-241">Static</span></span> |

<span data-ttu-id="8a28c-242">As you might have noticed, no NSG has been specified.</span><span class="sxs-lookup"><span data-stu-id="8a28c-242">As you might have noticed, no NSG has been specified.</span></span> <span data-ttu-id="8a28c-243">This is because azure lets you use NSG at the subnet level.</span><span class="sxs-lookup"><span data-stu-id="8a28c-243">This is because azure lets you use NSG at the subnet level.</span></span> <span data-ttu-id="8a28c-244">Then, you can control machine network traffic by using the individual NSG associated with either the subnet or else the NIC object.</span><span class="sxs-lookup"><span data-stu-id="8a28c-244">Then, you can control machine network traffic by using the individual NSG associated with either the subnet or else the NIC object.</span></span> <span data-ttu-id="8a28c-245">Read more on [What is a Network Security Group (NSG)](https://aka.ms/Azure/NSG).</span><span class="sxs-lookup"><span data-stu-id="8a28c-245">Read more on [What is a Network Security Group (NSG)](https://aka.ms/Azure/NSG).</span></span>
<span data-ttu-id="8a28c-246">Static IP address is recommended if you are managing the DNS.</span><span class="sxs-lookup"><span data-stu-id="8a28c-246">Static IP address is recommended if you are managing the DNS.</span></span> <span data-ttu-id="8a28c-247">You can use Azure DNS and instead in the DNS records for your domain, refer to the new machines by their Azure FQDNs.</span><span class="sxs-lookup"><span data-stu-id="8a28c-247">You can use Azure DNS and instead in the DNS records for your domain, refer to the new machines by their Azure FQDNs.</span></span>
<span data-ttu-id="8a28c-248">Your virtual machine pane should look like below after the deployment is completed:</span><span class="sxs-lookup"><span data-stu-id="8a28c-248">Your virtual machine pane should look like below after the deployment is completed:</span></span>

![Virtual Machines deployed](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/virtualmachinesdeployed_noadfs.png)

### <a name="5-configuring-the-domain-controller--ad-fs-servers"></a><span data-ttu-id="8a28c-250">5. Configuring the domain controller / AD FS servers</span><span class="sxs-lookup"><span data-stu-id="8a28c-250">5. Configuring the domain controller / AD FS servers</span></span>
 <span data-ttu-id="8a28c-251">In order to authenticate any incoming request, AD FS will need to contact the domain controller.</span><span class="sxs-lookup"><span data-stu-id="8a28c-251">In order to authenticate any incoming request, AD FS will need to contact the domain controller.</span></span> <span data-ttu-id="8a28c-252">To save the costly trip from Azure to on-premises DC for authentication, it is recommended to deploy a replica of the domain controller in Azure.</span><span class="sxs-lookup"><span data-stu-id="8a28c-252">To save the costly trip from Azure to on-premises DC for authentication, it is recommended to deploy a replica of the domain controller in Azure.</span></span> <span data-ttu-id="8a28c-253">In order to attain high availability, it is recommended to create an availability set of at-least 2 domain controllers.</span><span class="sxs-lookup"><span data-stu-id="8a28c-253">In order to attain high availability, it is recommended to create an availability set of at-least 2 domain controllers.</span></span>

| <span data-ttu-id="8a28c-254">Domain controller</span><span class="sxs-lookup"><span data-stu-id="8a28c-254">Domain controller</span></span> | <span data-ttu-id="8a28c-255">Role</span><span class="sxs-lookup"><span data-stu-id="8a28c-255">Role</span></span> | <span data-ttu-id="8a28c-256">Storage account</span><span class="sxs-lookup"><span data-stu-id="8a28c-256">Storage account</span></span> |
|:---:|:---:|:---:|
| <span data-ttu-id="8a28c-257">contosodc1</span><span class="sxs-lookup"><span data-stu-id="8a28c-257">contosodc1</span></span> |<span data-ttu-id="8a28c-258">Replica</span><span class="sxs-lookup"><span data-stu-id="8a28c-258">Replica</span></span> |<span data-ttu-id="8a28c-259">contososac1</span><span class="sxs-lookup"><span data-stu-id="8a28c-259">contososac1</span></span> |
| <span data-ttu-id="8a28c-260">contosodc2</span><span class="sxs-lookup"><span data-stu-id="8a28c-260">contosodc2</span></span> |<span data-ttu-id="8a28c-261">Replica</span><span class="sxs-lookup"><span data-stu-id="8a28c-261">Replica</span></span> |<span data-ttu-id="8a28c-262">contososac2</span><span class="sxs-lookup"><span data-stu-id="8a28c-262">contososac2</span></span> |

* <span data-ttu-id="8a28c-263">Promote the two servers as replica domain controllers with DNS</span><span class="sxs-lookup"><span data-stu-id="8a28c-263">Promote the two servers as replica domain controllers with DNS</span></span>
* <span data-ttu-id="8a28c-264">Configure the AD FS servers by installing the AD FS role using the server manager.</span><span class="sxs-lookup"><span data-stu-id="8a28c-264">Configure the AD FS servers by installing the AD FS role using the server manager.</span></span>

### <a name="6-deploying-internal-load-balancer-ilb"></a><span data-ttu-id="8a28c-265">6. Deploying Internal Load Balancer (ILB)</span><span class="sxs-lookup"><span data-stu-id="8a28c-265">6. Deploying Internal Load Balancer (ILB)</span></span>
<span data-ttu-id="8a28c-266">**6.1. Create the ILB**</span><span class="sxs-lookup"><span data-stu-id="8a28c-266">**6.1. Create the ILB**</span></span>

<span data-ttu-id="8a28c-267">To deploy an ILB, select Load Balancers in the Azure portal and click on add (+).</span><span class="sxs-lookup"><span data-stu-id="8a28c-267">To deploy an ILB, select Load Balancers in the Azure portal and click on add (+).</span></span>

> [!NOTE]
> <span data-ttu-id="8a28c-268">if you do not see **Load Balancers** in your menu, click **Browse** in the lower left of the portal and scroll until you see **Load Balancers**.</span><span class="sxs-lookup"><span data-stu-id="8a28c-268">if you do not see **Load Balancers** in your menu, click **Browse** in the lower left of the portal and scroll until you see **Load Balancers**.</span></span>  <span data-ttu-id="8a28c-269">Then click the yellow star to add it to your menu.</span><span class="sxs-lookup"><span data-stu-id="8a28c-269">Then click the yellow star to add it to your menu.</span></span> <span data-ttu-id="8a28c-270">Now select the new load balancer icon to open the panel to begin configuration of the load balancer.</span><span class="sxs-lookup"><span data-stu-id="8a28c-270">Now select the new load balancer icon to open the panel to begin configuration of the load balancer.</span></span>
> 
> 

![Browse load balancer](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/browseloadbalancer.png)

* <span data-ttu-id="8a28c-272">**Name**: Give any suitable name to the load balancer</span><span class="sxs-lookup"><span data-stu-id="8a28c-272">**Name**: Give any suitable name to the load balancer</span></span>
* <span data-ttu-id="8a28c-273">**Scheme**: Since this load balancer will be placed in front of the AD FS servers and is meant for internal network connections ONLY, select “Internal”</span><span class="sxs-lookup"><span data-stu-id="8a28c-273">**Scheme**: Since this load balancer will be placed in front of the AD FS servers and is meant for internal network connections ONLY, select “Internal”</span></span>
* <span data-ttu-id="8a28c-274">**Virtual Network**: Choose the virtual network where you are deploying your AD FS</span><span class="sxs-lookup"><span data-stu-id="8a28c-274">**Virtual Network**: Choose the virtual network where you are deploying your AD FS</span></span>
* <span data-ttu-id="8a28c-275">**Subnet**: Choose the internal subnet here</span><span class="sxs-lookup"><span data-stu-id="8a28c-275">**Subnet**: Choose the internal subnet here</span></span>
* <span data-ttu-id="8a28c-276">**IP Address assignment**: Dynamic</span><span class="sxs-lookup"><span data-stu-id="8a28c-276">**IP Address assignment**: Dynamic</span></span>

![Internal load balancer](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/ilbdeployment1.png)

<span data-ttu-id="8a28c-278">After you click create and the ILB is deployed, you should see it in the list of load balancers:</span><span class="sxs-lookup"><span data-stu-id="8a28c-278">After you click create and the ILB is deployed, you should see it in the list of load balancers:</span></span>

![Load balancers after ILB](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/ilbdeployment2.png)

<span data-ttu-id="8a28c-280">Next step is to configure the backend pool and the backend probe.</span><span class="sxs-lookup"><span data-stu-id="8a28c-280">Next step is to configure the backend pool and the backend probe.</span></span>

<span data-ttu-id="8a28c-281">**6.2. Configure ILB backend pool**</span><span class="sxs-lookup"><span data-stu-id="8a28c-281">**6.2. Configure ILB backend pool**</span></span>

<span data-ttu-id="8a28c-282">Select the newly created ILB in the Load Balancers panel.</span><span class="sxs-lookup"><span data-stu-id="8a28c-282">Select the newly created ILB in the Load Balancers panel.</span></span> <span data-ttu-id="8a28c-283">It will open the settings panel.</span><span class="sxs-lookup"><span data-stu-id="8a28c-283">It will open the settings panel.</span></span> 

1. <span data-ttu-id="8a28c-284">Select backend pools from the settings panel</span><span class="sxs-lookup"><span data-stu-id="8a28c-284">Select backend pools from the settings panel</span></span>
2. <span data-ttu-id="8a28c-285">In the add backend pool panel, click on add virtual machine</span><span class="sxs-lookup"><span data-stu-id="8a28c-285">In the add backend pool panel, click on add virtual machine</span></span>
3. <span data-ttu-id="8a28c-286">You will be presented with a panel where you can choose availability set</span><span class="sxs-lookup"><span data-stu-id="8a28c-286">You will be presented with a panel where you can choose availability set</span></span>
4. <span data-ttu-id="8a28c-287">Choose the AD FS availability set</span><span class="sxs-lookup"><span data-stu-id="8a28c-287">Choose the AD FS availability set</span></span>

![Configure ILB backend pool](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/ilbdeployment3.png)

<span data-ttu-id="8a28c-289">**6.3. Configuring probe**</span><span class="sxs-lookup"><span data-stu-id="8a28c-289">**6.3. Configuring probe**</span></span>

<span data-ttu-id="8a28c-290">In the ILB settings panel, select Probes.</span><span class="sxs-lookup"><span data-stu-id="8a28c-290">In the ILB settings panel, select Probes.</span></span>

1. <span data-ttu-id="8a28c-291">Click on add</span><span class="sxs-lookup"><span data-stu-id="8a28c-291">Click on add</span></span>
2. <span data-ttu-id="8a28c-292">Provide details for probe a.</span><span class="sxs-lookup"><span data-stu-id="8a28c-292">Provide details for probe a.</span></span> <span data-ttu-id="8a28c-293">**Name**: Probe name b.</span><span class="sxs-lookup"><span data-stu-id="8a28c-293">**Name**: Probe name b.</span></span> <span data-ttu-id="8a28c-294">**Protocol**: TCP c.</span><span class="sxs-lookup"><span data-stu-id="8a28c-294">**Protocol**: TCP c.</span></span> <span data-ttu-id="8a28c-295">**Port**: 443 (HTTPS) d.</span><span class="sxs-lookup"><span data-stu-id="8a28c-295">**Port**: 443 (HTTPS) d.</span></span> <span data-ttu-id="8a28c-296">**Interval**: 5 (default value) – this is the interval at which ILB will probe the machines in the backend pool e.</span><span class="sxs-lookup"><span data-stu-id="8a28c-296">**Interval**: 5 (default value) – this is the interval at which ILB will probe the machines in the backend pool e.</span></span> <span data-ttu-id="8a28c-297">**Unhealthy threshold limit**: 2 (default val ue) – this is the threshold of consecutive probe failures after which ILB will declare a machine in the backend pool non-responsive and stop sending traffic to it.</span><span class="sxs-lookup"><span data-stu-id="8a28c-297">**Unhealthy threshold limit**: 2 (default val ue) – this is the threshold of consecutive probe failures after which ILB will declare a machine in the backend pool non-responsive and stop sending traffic to it.</span></span>

![Configure ILB probe](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/ilbdeployment4.png)

<span data-ttu-id="8a28c-299">**6.4. Create load balancing rules**</span><span class="sxs-lookup"><span data-stu-id="8a28c-299">**6.4. Create load balancing rules**</span></span>

<span data-ttu-id="8a28c-300">In order to effectively balance the traffic, the ILB should be configured with load balancing rules.</span><span class="sxs-lookup"><span data-stu-id="8a28c-300">In order to effectively balance the traffic, the ILB should be configured with load balancing rules.</span></span> <span data-ttu-id="8a28c-301">In order to create a load balancing rule,</span><span class="sxs-lookup"><span data-stu-id="8a28c-301">In order to create a load balancing rule,</span></span> 

1. <span data-ttu-id="8a28c-302">Select Load balancing rule from the settings panel of the ILB</span><span class="sxs-lookup"><span data-stu-id="8a28c-302">Select Load balancing rule from the settings panel of the ILB</span></span>
2. <span data-ttu-id="8a28c-303">Click on Add in the Load balancing rule panel</span><span class="sxs-lookup"><span data-stu-id="8a28c-303">Click on Add in the Load balancing rule panel</span></span>
3. <span data-ttu-id="8a28c-304">In the Add load balancing rule panel a.</span><span class="sxs-lookup"><span data-stu-id="8a28c-304">In the Add load balancing rule panel a.</span></span> <span data-ttu-id="8a28c-305">**Name**: Provide a name for the rule b.</span><span class="sxs-lookup"><span data-stu-id="8a28c-305">**Name**: Provide a name for the rule b.</span></span> <span data-ttu-id="8a28c-306">**Protocol**: Select TCP c.</span><span class="sxs-lookup"><span data-stu-id="8a28c-306">**Protocol**: Select TCP c.</span></span> <span data-ttu-id="8a28c-307">**Port**: 443 d.</span><span class="sxs-lookup"><span data-stu-id="8a28c-307">**Port**: 443 d.</span></span> <span data-ttu-id="8a28c-308">**Backend port**: 443 e.</span><span class="sxs-lookup"><span data-stu-id="8a28c-308">**Backend port**: 443 e.</span></span> <span data-ttu-id="8a28c-309">**Backend pool**: Select the pool you created for the AD FS cluster earlier f.</span><span class="sxs-lookup"><span data-stu-id="8a28c-309">**Backend pool**: Select the pool you created for the AD FS cluster earlier f.</span></span> <span data-ttu-id="8a28c-310">**Probe**: Select the probe created for AD FS servers earlier</span><span class="sxs-lookup"><span data-stu-id="8a28c-310">**Probe**: Select the probe created for AD FS servers earlier</span></span>

![Configure ILB balancing rules](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/ilbdeployment5.png)

<span data-ttu-id="8a28c-312">**6.5. Update DNS with ILB**</span><span class="sxs-lookup"><span data-stu-id="8a28c-312">**6.5. Update DNS with ILB**</span></span>

<span data-ttu-id="8a28c-313">Go to your DNS server and create a CNAME for the ILB.</span><span class="sxs-lookup"><span data-stu-id="8a28c-313">Go to your DNS server and create a CNAME for the ILB.</span></span> <span data-ttu-id="8a28c-314">The CNAME should be for the federation service with the IP address pointing to the IP address of the ILB.</span><span class="sxs-lookup"><span data-stu-id="8a28c-314">The CNAME should be for the federation service with the IP address pointing to the IP address of the ILB.</span></span> <span data-ttu-id="8a28c-315">For example if the ILB DIP address is 10.3.0.8, and the federation service installed is fs.contoso.com, then create a CNAME for fs.contoso.com pointing to 10.3.0.8.</span><span class="sxs-lookup"><span data-stu-id="8a28c-315">For example if the ILB DIP address is 10.3.0.8, and the federation service installed is fs.contoso.com, then create a CNAME for fs.contoso.com pointing to 10.3.0.8.</span></span>
<span data-ttu-id="8a28c-316">This will ensure that all communication regarding fs.contoso.com end up at the ILB and are appropriately routed.</span><span class="sxs-lookup"><span data-stu-id="8a28c-316">This will ensure that all communication regarding fs.contoso.com end up at the ILB and are appropriately routed.</span></span>

### <a name="7-configuring-the-web-application-proxy-server"></a><span data-ttu-id="8a28c-317">7. Configuring the Web Application Proxy server</span><span class="sxs-lookup"><span data-stu-id="8a28c-317">7. Configuring the Web Application Proxy server</span></span>
<span data-ttu-id="8a28c-318">**7.1. Configuring the Web Application Proxy servers to reach AD FS servers**</span><span class="sxs-lookup"><span data-stu-id="8a28c-318">**7.1. Configuring the Web Application Proxy servers to reach AD FS servers**</span></span>

<span data-ttu-id="8a28c-319">In order to ensure that Web Application Proxy servers are able to reach the AD FS servers behind the ILB, create a record in the %systemroot%\system32\drivers\etc\hosts for the ILB.</span><span class="sxs-lookup"><span data-stu-id="8a28c-319">In order to ensure that Web Application Proxy servers are able to reach the AD FS servers behind the ILB, create a record in the %systemroot%\system32\drivers\etc\hosts for the ILB.</span></span> <span data-ttu-id="8a28c-320">Note that the distinguished name (DN) should be the federation service name, for example fs.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="8a28c-320">Note that the distinguished name (DN) should be the federation service name, for example fs.contoso.com.</span></span> <span data-ttu-id="8a28c-321">And the IP entry should be that of the ILB’s IP address (10.3.0.8 as in the example).</span><span class="sxs-lookup"><span data-stu-id="8a28c-321">And the IP entry should be that of the ILB’s IP address (10.3.0.8 as in the example).</span></span>

<span data-ttu-id="8a28c-322">**7.2. Installing the Web Application Proxy role**</span><span class="sxs-lookup"><span data-stu-id="8a28c-322">**7.2. Installing the Web Application Proxy role**</span></span>

<span data-ttu-id="8a28c-323">After you ensure that Web Application Proxy servers are able to reach the AD FS servers behind ILB, you can next install the Web Application Proxy servers.</span><span class="sxs-lookup"><span data-stu-id="8a28c-323">After you ensure that Web Application Proxy servers are able to reach the AD FS servers behind ILB, you can next install the Web Application Proxy servers.</span></span> <span data-ttu-id="8a28c-324">Web Application Proxy servers do not be joined to the domain.</span><span class="sxs-lookup"><span data-stu-id="8a28c-324">Web Application Proxy servers do not be joined to the domain.</span></span> <span data-ttu-id="8a28c-325">Install the Web Application Proxy roles on the two Web Application Proxy servers by selecting the Remote Access role.</span><span class="sxs-lookup"><span data-stu-id="8a28c-325">Install the Web Application Proxy roles on the two Web Application Proxy servers by selecting the Remote Access role.</span></span> <span data-ttu-id="8a28c-326">The server manager will guide you to complete the WAP installation.</span><span class="sxs-lookup"><span data-stu-id="8a28c-326">The server manager will guide you to complete the WAP installation.</span></span>
<span data-ttu-id="8a28c-327">For more information on how to deploy WAP, read [Install and Configure the Web Application Proxy Server](https://technet.microsoft.com/library/dn383662.aspx).</span><span class="sxs-lookup"><span data-stu-id="8a28c-327">For more information on how to deploy WAP, read [Install and Configure the Web Application Proxy Server](https://technet.microsoft.com/library/dn383662.aspx).</span></span>

### <a name="8--deploying-the-internet-facing-public-load-balancer"></a><span data-ttu-id="8a28c-328">8.  Deploying the Internet Facing (Public) Load Balancer</span><span class="sxs-lookup"><span data-stu-id="8a28c-328">8.  Deploying the Internet Facing (Public) Load Balancer</span></span>
<span data-ttu-id="8a28c-329">**8.1.  Create Internet Facing (Public) Load Balancer**</span><span class="sxs-lookup"><span data-stu-id="8a28c-329">**8.1.  Create Internet Facing (Public) Load Balancer**</span></span>

<span data-ttu-id="8a28c-330">In the Azure portal, select Load balancers and then click on Add.</span><span class="sxs-lookup"><span data-stu-id="8a28c-330">In the Azure portal, select Load balancers and then click on Add.</span></span> <span data-ttu-id="8a28c-331">In the Create load balancer panel, enter the following information</span><span class="sxs-lookup"><span data-stu-id="8a28c-331">In the Create load balancer panel, enter the following information</span></span>

1. <span data-ttu-id="8a28c-332">**Name**: Name for the load balancer</span><span class="sxs-lookup"><span data-stu-id="8a28c-332">**Name**: Name for the load balancer</span></span>
2. <span data-ttu-id="8a28c-333">**Scheme**: Public – this option tells Azure that this load balancer will need a public address.</span><span class="sxs-lookup"><span data-stu-id="8a28c-333">**Scheme**: Public – this option tells Azure that this load balancer will need a public address.</span></span>
3. <span data-ttu-id="8a28c-334">**IP Address**: Create a new IP address (dynamic)</span><span class="sxs-lookup"><span data-stu-id="8a28c-334">**IP Address**: Create a new IP address (dynamic)</span></span>

![Internet facing load balancer](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/elbdeployment1.png)

<span data-ttu-id="8a28c-336">After deployment, the load balancer will appear in the Load balancers list.</span><span class="sxs-lookup"><span data-stu-id="8a28c-336">After deployment, the load balancer will appear in the Load balancers list.</span></span>

![Load balancer list](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/elbdeployment2.png)

<span data-ttu-id="8a28c-338">**8.2. Assign a DNS label to the public IP**</span><span class="sxs-lookup"><span data-stu-id="8a28c-338">**8.2. Assign a DNS label to the public IP**</span></span>

<span data-ttu-id="8a28c-339">Click on the newly created load balancer entry in the Load balancers panel to bring up the panel for configuration.</span><span class="sxs-lookup"><span data-stu-id="8a28c-339">Click on the newly created load balancer entry in the Load balancers panel to bring up the panel for configuration.</span></span> <span data-ttu-id="8a28c-340">Follow below steps to configure the DNS label for the public IP:</span><span class="sxs-lookup"><span data-stu-id="8a28c-340">Follow below steps to configure the DNS label for the public IP:</span></span>

1. <span data-ttu-id="8a28c-341">Click on the public IP address.</span><span class="sxs-lookup"><span data-stu-id="8a28c-341">Click on the public IP address.</span></span> <span data-ttu-id="8a28c-342">This will open the panel for the public IP and its settings</span><span class="sxs-lookup"><span data-stu-id="8a28c-342">This will open the panel for the public IP and its settings</span></span>
2. <span data-ttu-id="8a28c-343">Click on Configuration</span><span class="sxs-lookup"><span data-stu-id="8a28c-343">Click on Configuration</span></span>
3. <span data-ttu-id="8a28c-344">Provide a DNS label.</span><span class="sxs-lookup"><span data-stu-id="8a28c-344">Provide a DNS label.</span></span> <span data-ttu-id="8a28c-345">This will become the public DNS label that you can access from anywhere, for example contosofs.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="8a28c-345">This will become the public DNS label that you can access from anywhere, for example contosofs.westus.cloudapp.azure.com.</span></span> <span data-ttu-id="8a28c-346">You can add an entry in the external DNS for the federation service (like fs.contoso.com) that resolves to the DNS label of the external load balancer (contosofs.westus.cloudapp.azure.com).</span><span class="sxs-lookup"><span data-stu-id="8a28c-346">You can add an entry in the external DNS for the federation service (like fs.contoso.com) that resolves to the DNS label of the external load balancer (contosofs.westus.cloudapp.azure.com).</span></span>

![Configure internet facing load balancer](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/elbdeployment3.png) 

![Configure internet facing load balancer (DNS)](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/elbdeployment4.png)

<span data-ttu-id="8a28c-349">**8.3. Configure backend pool for Internet Facing (Public) Load Balancer**</span><span class="sxs-lookup"><span data-stu-id="8a28c-349">**8.3. Configure backend pool for Internet Facing (Public) Load Balancer**</span></span> 

<span data-ttu-id="8a28c-350">Follow the same steps as in creating the internal load balancer, to configure the backend pool for Internet Facing (Public) Load Balancer as the availability set for the WAP servers.</span><span class="sxs-lookup"><span data-stu-id="8a28c-350">Follow the same steps as in creating the internal load balancer, to configure the backend pool for Internet Facing (Public) Load Balancer as the availability set for the WAP servers.</span></span> <span data-ttu-id="8a28c-351">For example, contosowapset.</span><span class="sxs-lookup"><span data-stu-id="8a28c-351">For example, contosowapset.</span></span>

![Configure backend pool of Internet Facing Load Balancer](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/elbdeployment5.png)

<span data-ttu-id="8a28c-353">**8.4. Configure probe**</span><span class="sxs-lookup"><span data-stu-id="8a28c-353">**8.4. Configure probe**</span></span>

<span data-ttu-id="8a28c-354">Follow the same steps as in configuring the internal load balancer  to configure the probe for the backend pool of WAP servers.</span><span class="sxs-lookup"><span data-stu-id="8a28c-354">Follow the same steps as in configuring the internal load balancer  to configure the probe for the backend pool of WAP servers.</span></span>

![Configure probe of Internet Facing Load Balancer](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/elbdeployment6.png)

<span data-ttu-id="8a28c-356">**8.5. Create load balancing rule(s)**</span><span class="sxs-lookup"><span data-stu-id="8a28c-356">**8.5. Create load balancing rule(s)**</span></span>

<span data-ttu-id="8a28c-357">Follow the same steps as in ILB to configure the load balancing rule for TCP 443.</span><span class="sxs-lookup"><span data-stu-id="8a28c-357">Follow the same steps as in ILB to configure the load balancing rule for TCP 443.</span></span>

![Configure balancing rules of Internet Facing Load Balancer](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/elbdeployment7.png)

### <a name="9-securing-the-network"></a><span data-ttu-id="8a28c-359">9. Securing the network</span><span class="sxs-lookup"><span data-stu-id="8a28c-359">9. Securing the network</span></span>
<span data-ttu-id="8a28c-360">**9.1. Securing the internal subnet**</span><span class="sxs-lookup"><span data-stu-id="8a28c-360">**9.1. Securing the internal subnet**</span></span>

<span data-ttu-id="8a28c-361">Overall, you need the following rules to efficiently secure your internal subnet (in the order as listed below)</span><span class="sxs-lookup"><span data-stu-id="8a28c-361">Overall, you need the following rules to efficiently secure your internal subnet (in the order as listed below)</span></span>

| <span data-ttu-id="8a28c-362">Rule</span><span class="sxs-lookup"><span data-stu-id="8a28c-362">Rule</span></span> | <span data-ttu-id="8a28c-363">Description</span><span class="sxs-lookup"><span data-stu-id="8a28c-363">Description</span></span> | <span data-ttu-id="8a28c-364">Flow</span><span class="sxs-lookup"><span data-stu-id="8a28c-364">Flow</span></span> |
|:--- |:--- |:---:|
| <span data-ttu-id="8a28c-365">AllowHTTPSFromDMZ</span><span class="sxs-lookup"><span data-stu-id="8a28c-365">AllowHTTPSFromDMZ</span></span> |<span data-ttu-id="8a28c-366">Allow the HTTPS communication from DMZ</span><span class="sxs-lookup"><span data-stu-id="8a28c-366">Allow the HTTPS communication from DMZ</span></span> |<span data-ttu-id="8a28c-367">Inbound</span><span class="sxs-lookup"><span data-stu-id="8a28c-367">Inbound</span></span> |
| <span data-ttu-id="8a28c-368">DenyInternetOutbound</span><span class="sxs-lookup"><span data-stu-id="8a28c-368">DenyInternetOutbound</span></span> |<span data-ttu-id="8a28c-369">No access to internet</span><span class="sxs-lookup"><span data-stu-id="8a28c-369">No access to internet</span></span> |<span data-ttu-id="8a28c-370">Outbound</span><span class="sxs-lookup"><span data-stu-id="8a28c-370">Outbound</span></span> |

![INT access rules (inbound)](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/nsg_int.png)

[comment]: <> (![INT access rules (inbound)](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/nsgintinbound.png)) [comment]: <> (![INT access rules (outbound)](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/nsgintoutbound.png))

<span data-ttu-id="8a28c-373">**9.2. Securing the DMZ subnet**</span><span class="sxs-lookup"><span data-stu-id="8a28c-373">**9.2. Securing the DMZ subnet**</span></span>

| <span data-ttu-id="8a28c-374">Rule</span><span class="sxs-lookup"><span data-stu-id="8a28c-374">Rule</span></span> | <span data-ttu-id="8a28c-375">Description</span><span class="sxs-lookup"><span data-stu-id="8a28c-375">Description</span></span> | <span data-ttu-id="8a28c-376">Flow</span><span class="sxs-lookup"><span data-stu-id="8a28c-376">Flow</span></span> |
|:--- |:--- |:---:|
| <span data-ttu-id="8a28c-377">AllowHTTPSFromInternet</span><span class="sxs-lookup"><span data-stu-id="8a28c-377">AllowHTTPSFromInternet</span></span> |<span data-ttu-id="8a28c-378">Allow HTTPS from internet to the DMZ</span><span class="sxs-lookup"><span data-stu-id="8a28c-378">Allow HTTPS from internet to the DMZ</span></span> |<span data-ttu-id="8a28c-379">Inbound</span><span class="sxs-lookup"><span data-stu-id="8a28c-379">Inbound</span></span> |
| <span data-ttu-id="8a28c-380">DenyInternetOutbound</span><span class="sxs-lookup"><span data-stu-id="8a28c-380">DenyInternetOutbound</span></span> |<span data-ttu-id="8a28c-381">Anything except HTTPS to internet is blocked</span><span class="sxs-lookup"><span data-stu-id="8a28c-381">Anything except HTTPS to internet is blocked</span></span> |<span data-ttu-id="8a28c-382">Outbound</span><span class="sxs-lookup"><span data-stu-id="8a28c-382">Outbound</span></span> |

![EXT access rules (inbound)](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/nsg_dmz.png)

[comment]: <> (![EXT access rules (inbound)](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/nsgdmzinbound.png)) [comment]: <> (![EXT access rules (outbound)](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/nsgdmzoutbound.png))

> [!NOTE]
> <span data-ttu-id="8a28c-385">If client user certificate authentication (clientTLS authentication using X509 user certificates) is required, then AD FS requires TCP port 49443 be enabled for inbound access.</span><span class="sxs-lookup"><span data-stu-id="8a28c-385">If client user certificate authentication (clientTLS authentication using X509 user certificates) is required, then AD FS requires TCP port 49443 be enabled for inbound access.</span></span>
> 
> 

### <a name="10-test-the-ad-fs-sign-in"></a><span data-ttu-id="8a28c-386">10. Test the AD FS sign-in</span><span class="sxs-lookup"><span data-stu-id="8a28c-386">10. Test the AD FS sign-in</span></span>
<span data-ttu-id="8a28c-387">The easiest way is to test AD FS is by using the IdpInitiatedSignon.aspx page.</span><span class="sxs-lookup"><span data-stu-id="8a28c-387">The easiest way is to test AD FS is by using the IdpInitiatedSignon.aspx page.</span></span> <span data-ttu-id="8a28c-388">In order to be able to do that, it is required to enable the IdpInitiatedSignOn on the AD FS properties.</span><span class="sxs-lookup"><span data-stu-id="8a28c-388">In order to be able to do that, it is required to enable the IdpInitiatedSignOn on the AD FS properties.</span></span> <span data-ttu-id="8a28c-389">Follow the steps below to verify your AD FS setup</span><span class="sxs-lookup"><span data-stu-id="8a28c-389">Follow the steps below to verify your AD FS setup</span></span>

1. <span data-ttu-id="8a28c-390">Run the below cmdlet on the AD FS server, using PowerShell, to set it to enabled.</span><span class="sxs-lookup"><span data-stu-id="8a28c-390">Run the below cmdlet on the AD FS server, using PowerShell, to set it to enabled.</span></span>
   <span data-ttu-id="8a28c-391">Set-AdfsProperties -EnableIdPInitiatedSignonPage $true</span><span class="sxs-lookup"><span data-stu-id="8a28c-391">Set-AdfsProperties -EnableIdPInitiatedSignonPage $true</span></span> 
2. <span data-ttu-id="8a28c-392">From any external machine access https://adfs.thecloudadvocate.com/adfs/ls/IdpInitiatedSignon.aspx</span><span class="sxs-lookup"><span data-stu-id="8a28c-392">From any external machine access https://adfs.thecloudadvocate.com/adfs/ls/IdpInitiatedSignon.aspx</span></span>  
3. <span data-ttu-id="8a28c-393">You should see the AD FS page like below:</span><span class="sxs-lookup"><span data-stu-id="8a28c-393">You should see the AD FS page like below:</span></span>

![Test login page](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/test1.png)

<span data-ttu-id="8a28c-395">On successful sign-in, it will provide you with a success message as shown below:</span><span class="sxs-lookup"><span data-stu-id="8a28c-395">On successful sign-in, it will provide you with a success message as shown below:</span></span>

![Test success](https://docstestmedia1.blob.core.windows.net/azure-media/articles/active-directory/connect/media/active-directory-aadconnect-azure-adfs/test2.png)

## <a name="template-for-deploying-ad-fs-in-azure"></a><span data-ttu-id="8a28c-397">Template for deploying AD FS in Azure</span><span class="sxs-lookup"><span data-stu-id="8a28c-397">Template for deploying AD FS in Azure</span></span>
<span data-ttu-id="8a28c-398">The template deploys a 6 machine setup, 2 each for Domain Controllers, AD FS and WAP.</span><span class="sxs-lookup"><span data-stu-id="8a28c-398">The template deploys a 6 machine setup, 2 each for Domain Controllers, AD FS and WAP.</span></span>

[<span data-ttu-id="8a28c-399">AD FS in Azure Deployment Template</span><span class="sxs-lookup"><span data-stu-id="8a28c-399">AD FS in Azure Deployment Template</span></span>](https://github.com/paulomarquesc/adfs-6vms-regular-template-based)

<span data-ttu-id="8a28c-400">You can use an existing virtual network or create a new VNET while deploying this template.</span><span class="sxs-lookup"><span data-stu-id="8a28c-400">You can use an existing virtual network or create a new VNET while deploying this template.</span></span> <span data-ttu-id="8a28c-401">The various parameters available for customizing the deployment are listed below with the description of usage of the parameter in the deployment process.</span><span class="sxs-lookup"><span data-stu-id="8a28c-401">The various parameters available for customizing the deployment are listed below with the description of usage of the parameter in the deployment process.</span></span> 

| <span data-ttu-id="8a28c-402">Parameter</span><span class="sxs-lookup"><span data-stu-id="8a28c-402">Parameter</span></span> | <span data-ttu-id="8a28c-403">Description</span><span class="sxs-lookup"><span data-stu-id="8a28c-403">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="8a28c-404">Location</span><span class="sxs-lookup"><span data-stu-id="8a28c-404">Location</span></span> |<span data-ttu-id="8a28c-405">The region to deploy the resources into, e.g. East US.</span><span class="sxs-lookup"><span data-stu-id="8a28c-405">The region to deploy the resources into, e.g. East US.</span></span> |
| <span data-ttu-id="8a28c-406">StorageAccountType</span><span class="sxs-lookup"><span data-stu-id="8a28c-406">StorageAccountType</span></span> |<span data-ttu-id="8a28c-407">The type of the Storage Account created</span><span class="sxs-lookup"><span data-stu-id="8a28c-407">The type of the Storage Account created</span></span> |
| <span data-ttu-id="8a28c-408">VirtualNetworkUsage</span><span class="sxs-lookup"><span data-stu-id="8a28c-408">VirtualNetworkUsage</span></span> |<span data-ttu-id="8a28c-409">Indicates if a new virtual network will be created or use an existing one</span><span class="sxs-lookup"><span data-stu-id="8a28c-409">Indicates if a new virtual network will be created or use an existing one</span></span> |
| <span data-ttu-id="8a28c-410">VirtualNetworkName</span><span class="sxs-lookup"><span data-stu-id="8a28c-410">VirtualNetworkName</span></span> |<span data-ttu-id="8a28c-411">The name of the Virtual Network to Create, mandatory on both existing or new virtual network usage</span><span class="sxs-lookup"><span data-stu-id="8a28c-411">The name of the Virtual Network to Create, mandatory on both existing or new virtual network usage</span></span> |
| <span data-ttu-id="8a28c-412">VirtualNetworkResourceGroupName</span><span class="sxs-lookup"><span data-stu-id="8a28c-412">VirtualNetworkResourceGroupName</span></span> |<span data-ttu-id="8a28c-413">Specifies the name of the resource group where the existing virtual network resides.</span><span class="sxs-lookup"><span data-stu-id="8a28c-413">Specifies the name of the resource group where the existing virtual network resides.</span></span> <span data-ttu-id="8a28c-414">When using an existing virtual network, this becomes a mandatory parameter so the deployment can find the ID of the existing virtual network</span><span class="sxs-lookup"><span data-stu-id="8a28c-414">When using an existing virtual network, this becomes a mandatory parameter so the deployment can find the ID of the existing virtual network</span></span> |
| <span data-ttu-id="8a28c-415">VirtualNetworkAddressRange</span><span class="sxs-lookup"><span data-stu-id="8a28c-415">VirtualNetworkAddressRange</span></span> |<span data-ttu-id="8a28c-416">The address range of the new VNET, mandatory if creating a new virtual network</span><span class="sxs-lookup"><span data-stu-id="8a28c-416">The address range of the new VNET, mandatory if creating a new virtual network</span></span> |
| <span data-ttu-id="8a28c-417">InternalSubnetName</span><span class="sxs-lookup"><span data-stu-id="8a28c-417">InternalSubnetName</span></span> |<span data-ttu-id="8a28c-418">The name of the internal subnet, mandatory on both virtual network usage options (new or existing)</span><span class="sxs-lookup"><span data-stu-id="8a28c-418">The name of the internal subnet, mandatory on both virtual network usage options (new or existing)</span></span> |
| <span data-ttu-id="8a28c-419">InternalSubnetAddressRange</span><span class="sxs-lookup"><span data-stu-id="8a28c-419">InternalSubnetAddressRange</span></span> |<span data-ttu-id="8a28c-420">The address range of the internal subnet, which contains the Domain Controllers and ADFS servers, mandatory if creating a new virtual network.</span><span class="sxs-lookup"><span data-stu-id="8a28c-420">The address range of the internal subnet, which contains the Domain Controllers and ADFS servers, mandatory if creating a new virtual network.</span></span> |
| <span data-ttu-id="8a28c-421">DMZSubnetAddressRange</span><span class="sxs-lookup"><span data-stu-id="8a28c-421">DMZSubnetAddressRange</span></span> |<span data-ttu-id="8a28c-422">The address range of the dmz subnet, which contains the Windows application proxy servers, mandatory if creating a new virtual network.</span><span class="sxs-lookup"><span data-stu-id="8a28c-422">The address range of the dmz subnet, which contains the Windows application proxy servers, mandatory if creating a new virtual network.</span></span> |
| <span data-ttu-id="8a28c-423">DMZSubnetName</span><span class="sxs-lookup"><span data-stu-id="8a28c-423">DMZSubnetName</span></span> |<span data-ttu-id="8a28c-424">The name of the internal subnet, mandatory on both virtual network usage options (new or existing).</span><span class="sxs-lookup"><span data-stu-id="8a28c-424">The name of the internal subnet, mandatory on both virtual network usage options (new or existing).</span></span> |
| <span data-ttu-id="8a28c-425">ADDC01NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="8a28c-425">ADDC01NICIPAddress</span></span> |<span data-ttu-id="8a28c-426">The internal IP address of the first Domain Controller, this IP address will be statically assigned to the DC and must be a valid ip address within the Internal subnet</span><span class="sxs-lookup"><span data-stu-id="8a28c-426">The internal IP address of the first Domain Controller, this IP address will be statically assigned to the DC and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="8a28c-427">ADDC02NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="8a28c-427">ADDC02NICIPAddress</span></span> |<span data-ttu-id="8a28c-428">The internal IP address of the second Domain Controller, this IP address will be statically assigned to the DC and must be a valid ip address within the Internal subnet</span><span class="sxs-lookup"><span data-stu-id="8a28c-428">The internal IP address of the second Domain Controller, this IP address will be statically assigned to the DC and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="8a28c-429">ADFS01NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="8a28c-429">ADFS01NICIPAddress</span></span> |<span data-ttu-id="8a28c-430">The internal IP address of the first ADFS server, this IP address will be statically assigned to the ADFS server and must be a valid ip address within the Internal subnet</span><span class="sxs-lookup"><span data-stu-id="8a28c-430">The internal IP address of the first ADFS server, this IP address will be statically assigned to the ADFS server and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="8a28c-431">ADFS02NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="8a28c-431">ADFS02NICIPAddress</span></span> |<span data-ttu-id="8a28c-432">The internal IP address of the second ADFS server, this IP address will be statically assigned to the ADFS server and must be a valid ip address within the Internal subnet</span><span class="sxs-lookup"><span data-stu-id="8a28c-432">The internal IP address of the second ADFS server, this IP address will be statically assigned to the ADFS server and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="8a28c-433">WAP01NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="8a28c-433">WAP01NICIPAddress</span></span> |<span data-ttu-id="8a28c-434">The internal IP address of the first WAP server, this IP address will be statically assigned to the WAP server and must be a valid ip address within the DMZ subnet</span><span class="sxs-lookup"><span data-stu-id="8a28c-434">The internal IP address of the first WAP server, this IP address will be statically assigned to the WAP server and must be a valid ip address within the DMZ subnet</span></span> |
| <span data-ttu-id="8a28c-435">WAP02NICIPAddress</span><span class="sxs-lookup"><span data-stu-id="8a28c-435">WAP02NICIPAddress</span></span> |<span data-ttu-id="8a28c-436">The internal IP address of the second WAP server, this IP address will be statically assigned to the WAP server and must be a valid ip address within the DMZ subnet</span><span class="sxs-lookup"><span data-stu-id="8a28c-436">The internal IP address of the second WAP server, this IP address will be statically assigned to the WAP server and must be a valid ip address within the DMZ subnet</span></span> |
| <span data-ttu-id="8a28c-437">ADFSLoadBalancerPrivateIPAddress</span><span class="sxs-lookup"><span data-stu-id="8a28c-437">ADFSLoadBalancerPrivateIPAddress</span></span> |<span data-ttu-id="8a28c-438">The internal IP address of the ADFS load balancer, this IP address will be statically assigned to the load balancer and must be a valid ip address within the Internal subnet</span><span class="sxs-lookup"><span data-stu-id="8a28c-438">The internal IP address of the ADFS load balancer, this IP address will be statically assigned to the load balancer and must be a valid ip address within the Internal subnet</span></span> |
| <span data-ttu-id="8a28c-439">ADDCVMNamePrefix</span><span class="sxs-lookup"><span data-stu-id="8a28c-439">ADDCVMNamePrefix</span></span> |<span data-ttu-id="8a28c-440">Virtual Machine name prefix for Domain Controllers</span><span class="sxs-lookup"><span data-stu-id="8a28c-440">Virtual Machine name prefix for Domain Controllers</span></span> |
| <span data-ttu-id="8a28c-441">ADFSVMNamePrefix</span><span class="sxs-lookup"><span data-stu-id="8a28c-441">ADFSVMNamePrefix</span></span> |<span data-ttu-id="8a28c-442">Virtual Machine name prefix for ADFS servers</span><span class="sxs-lookup"><span data-stu-id="8a28c-442">Virtual Machine name prefix for ADFS servers</span></span> |
| <span data-ttu-id="8a28c-443">WAPVMNamePrefix</span><span class="sxs-lookup"><span data-stu-id="8a28c-443">WAPVMNamePrefix</span></span> |<span data-ttu-id="8a28c-444">Virtual Machine name prefix for WAP servers</span><span class="sxs-lookup"><span data-stu-id="8a28c-444">Virtual Machine name prefix for WAP servers</span></span> |
| <span data-ttu-id="8a28c-445">ADDCVMSize</span><span class="sxs-lookup"><span data-stu-id="8a28c-445">ADDCVMSize</span></span> |<span data-ttu-id="8a28c-446">The vm size of the Domain Controllers</span><span class="sxs-lookup"><span data-stu-id="8a28c-446">The vm size of the Domain Controllers</span></span> |
| <span data-ttu-id="8a28c-447">ADFSVMSize</span><span class="sxs-lookup"><span data-stu-id="8a28c-447">ADFSVMSize</span></span> |<span data-ttu-id="8a28c-448">The vm size of the ADFS servers</span><span class="sxs-lookup"><span data-stu-id="8a28c-448">The vm size of the ADFS servers</span></span> |
| <span data-ttu-id="8a28c-449">WAPVMSize</span><span class="sxs-lookup"><span data-stu-id="8a28c-449">WAPVMSize</span></span> |<span data-ttu-id="8a28c-450">The vm size of the WAP servers</span><span class="sxs-lookup"><span data-stu-id="8a28c-450">The vm size of the WAP servers</span></span> |
| <span data-ttu-id="8a28c-451">AdminUserName</span><span class="sxs-lookup"><span data-stu-id="8a28c-451">AdminUserName</span></span> |<span data-ttu-id="8a28c-452">The name of the local Administrator of the virtual machines</span><span class="sxs-lookup"><span data-stu-id="8a28c-452">The name of the local Administrator of the virtual machines</span></span> |
| <span data-ttu-id="8a28c-453">AdminPassword</span><span class="sxs-lookup"><span data-stu-id="8a28c-453">AdminPassword</span></span> |<span data-ttu-id="8a28c-454">The password for the local Administrator account of the virtual machines</span><span class="sxs-lookup"><span data-stu-id="8a28c-454">The password for the local Administrator account of the virtual machines</span></span> |

## <a name="additional-resources"></a><span data-ttu-id="8a28c-455">Additional resources</span><span class="sxs-lookup"><span data-stu-id="8a28c-455">Additional resources</span></span>
* [<span data-ttu-id="8a28c-456">Availability Sets</span><span class="sxs-lookup"><span data-stu-id="8a28c-456">Availability Sets</span></span>](https://aka.ms/Azure/Availability) 
* [<span data-ttu-id="8a28c-457">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="8a28c-457">Azure Load Balancer</span></span>](https://aka.ms/Azure/ILB)
* [<span data-ttu-id="8a28c-458">Internal Load Balancer</span><span class="sxs-lookup"><span data-stu-id="8a28c-458">Internal Load Balancer</span></span>](https://aka.ms/Azure/ILB/Internal)
* [<span data-ttu-id="8a28c-459">Internet Facing Load Balancer</span><span class="sxs-lookup"><span data-stu-id="8a28c-459">Internet Facing Load Balancer</span></span>](https://aka.ms/Azure/ILB/Internet)
* [<span data-ttu-id="8a28c-460">Storage Accounts</span><span class="sxs-lookup"><span data-stu-id="8a28c-460">Storage Accounts</span></span>](https://aka.ms/Azure/Storage)
* [<span data-ttu-id="8a28c-461">Azure Virtual Networks</span><span class="sxs-lookup"><span data-stu-id="8a28c-461">Azure Virtual Networks</span></span>](https://aka.ms/Azure/VNet)
* [<span data-ttu-id="8a28c-462">AD FS and Web Application Proxy Links</span><span class="sxs-lookup"><span data-stu-id="8a28c-462">AD FS and Web Application Proxy Links</span></span>](http://aka.ms/ADFSLinks) 

## <a name="next-steps"></a><span data-ttu-id="8a28c-463">Next steps</span><span class="sxs-lookup"><span data-stu-id="8a28c-463">Next steps</span></span>
* [<span data-ttu-id="8a28c-464">Integrating your on-premises identities with Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="8a28c-464">Integrating your on-premises identities with Azure Active Directory</span></span>](active-directory-aadconnect.md)
* [<span data-ttu-id="8a28c-465">Configuring and managing your AD FS using Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="8a28c-465">Configuring and managing your AD FS using Azure AD Connect</span></span>](active-directory-aadconnectfed-whatis.md)
* [<span data-ttu-id="8a28c-466">High availability cross-geographic AD FS deployment in Azure with Azure Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="8a28c-466">High availability cross-geographic AD FS deployment in Azure with Azure Traffic Manager</span></span>](../active-directory-adfs-in-azure-with-azure-traffic-manager.md)

































