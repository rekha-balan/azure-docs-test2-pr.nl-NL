---
title: Security considerations for Azure AD Application Proxy | Microsoft Docs
description: Covers security considerations for using Azure AD Application Proxy
services: active-directory
documentationcenter: ''
author: barbkess
manager: mtillman
ms.service: active-directory
ms.component: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 09/08/2017
ms.author: barbkess
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: 985ea1f16cff010041d61d808280cb47f2b77aa9
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44865591"
---
# <a name="security-considerations-for-accessing-apps-remotely-with-azure-ad-application-proxy"></a><span data-ttu-id="bb86f-103">Security considerations for accessing apps remotely with Azure AD Application Proxy</span><span class="sxs-lookup"><span data-stu-id="bb86f-103">Security considerations for accessing apps remotely with Azure AD Application Proxy</span></span>

<span data-ttu-id="bb86f-104">This article explains the components that work to keep your users and applications safe when you use Azure Active Directory Application Proxy.</span><span class="sxs-lookup"><span data-stu-id="bb86f-104">This article explains the components that work to keep your users and applications safe when you use Azure Active Directory Application Proxy.</span></span>

<span data-ttu-id="bb86f-105">The following diagram shows how Azure AD enables secure remote access to your on-premises applications.</span><span class="sxs-lookup"><span data-stu-id="bb86f-105">The following diagram shows how Azure AD enables secure remote access to your on-premises applications.</span></span>

 ![Diagram of secure remote access through Azure AD Application Proxy](./media/application-proxy-security/secure-remote-access.png)

## <a name="security-benefits"></a><span data-ttu-id="bb86f-107">Security benefits</span><span class="sxs-lookup"><span data-stu-id="bb86f-107">Security benefits</span></span>

<span data-ttu-id="bb86f-108">Azure AD Application Proxy offers the following security benefits:</span><span class="sxs-lookup"><span data-stu-id="bb86f-108">Azure AD Application Proxy offers the following security benefits:</span></span>

### <a name="authenticated-access"></a><span data-ttu-id="bb86f-109">Authenticated access</span><span class="sxs-lookup"><span data-stu-id="bb86f-109">Authenticated access</span></span> 

<span data-ttu-id="bb86f-110">If you choose to use Azure Active Directory preauthentication, then only authenticated connections can access your network.</span><span class="sxs-lookup"><span data-stu-id="bb86f-110">If you choose to use Azure Active Directory preauthentication, then only authenticated connections can access your network.</span></span>

<span data-ttu-id="bb86f-111">Azure AD Application Proxy relies on the Azure AD security token service (STS) for all authentication.</span><span class="sxs-lookup"><span data-stu-id="bb86f-111">Azure AD Application Proxy relies on the Azure AD security token service (STS) for all authentication.</span></span>  <span data-ttu-id="bb86f-112">Preauthentication, by its very nature, blocks a significant number of anonymous attacks, because only authenticated identities can access the back-end application.</span><span class="sxs-lookup"><span data-stu-id="bb86f-112">Preauthentication, by its very nature, blocks a significant number of anonymous attacks, because only authenticated identities can access the back-end application.</span></span>

<span data-ttu-id="bb86f-113">If you choose Passthrough as your preauthentication method, you don't get this benefit.</span><span class="sxs-lookup"><span data-stu-id="bb86f-113">If you choose Passthrough as your preauthentication method, you don't get this benefit.</span></span> 

### <a name="conditional-access"></a><span data-ttu-id="bb86f-114">Conditional access</span><span class="sxs-lookup"><span data-stu-id="bb86f-114">Conditional access</span></span>

<span data-ttu-id="bb86f-115">Apply richer policy controls before connections to your network are established.</span><span class="sxs-lookup"><span data-stu-id="bb86f-115">Apply richer policy controls before connections to your network are established.</span></span>

<span data-ttu-id="bb86f-116">With [conditional access](../conditional-access/overview.md), you can define restrictions on what traffic is allowed to access your back-end applications.</span><span class="sxs-lookup"><span data-stu-id="bb86f-116">With [conditional access](../conditional-access/overview.md), you can define restrictions on what traffic is allowed to access your back-end applications.</span></span> <span data-ttu-id="bb86f-117">You can create policies that restrict sign-ins based on location, strength of authentication, and user risk profile.</span><span class="sxs-lookup"><span data-stu-id="bb86f-117">You can create policies that restrict sign-ins based on location, strength of authentication, and user risk profile.</span></span>

<span data-ttu-id="bb86f-118">You can also use conditional access to configure Multi-Factor Authentication policies, adding another layer of security to your user authentications.</span><span class="sxs-lookup"><span data-stu-id="bb86f-118">You can also use conditional access to configure Multi-Factor Authentication policies, adding another layer of security to your user authentications.</span></span> 

### <a name="traffic-termination"></a><span data-ttu-id="bb86f-119">Traffic termination</span><span class="sxs-lookup"><span data-stu-id="bb86f-119">Traffic termination</span></span>

<span data-ttu-id="bb86f-120">All traffic is terminated in the cloud.</span><span class="sxs-lookup"><span data-stu-id="bb86f-120">All traffic is terminated in the cloud.</span></span>

<span data-ttu-id="bb86f-121">Because Azure AD Application Proxy is a reverse-proxy, all traffic to back-end applications is terminated at the service.</span><span class="sxs-lookup"><span data-stu-id="bb86f-121">Because Azure AD Application Proxy is a reverse-proxy, all traffic to back-end applications is terminated at the service.</span></span> <span data-ttu-id="bb86f-122">The session can get reestablished only with the back-end server, which means that your back-end servers are not exposed to direct HTTP traffic.</span><span class="sxs-lookup"><span data-stu-id="bb86f-122">The session can get reestablished only with the back-end server, which means that your back-end servers are not exposed to direct HTTP traffic.</span></span> <span data-ttu-id="bb86f-123">This configuration means that you are better protected from targeted attacks.</span><span class="sxs-lookup"><span data-stu-id="bb86f-123">This configuration means that you are better protected from targeted attacks.</span></span>

### <a name="all-access-is-outbound"></a><span data-ttu-id="bb86f-124">All access is outbound</span><span class="sxs-lookup"><span data-stu-id="bb86f-124">All access is outbound</span></span> 

<span data-ttu-id="bb86f-125">You don't need to open inbound connections to the corporate network.</span><span class="sxs-lookup"><span data-stu-id="bb86f-125">You don't need to open inbound connections to the corporate network.</span></span>

<span data-ttu-id="bb86f-126">Application Proxy connectors only use outbound connections to the Azure AD Application Proxy service, which means that there is no need to open firewall ports for incoming connections.</span><span class="sxs-lookup"><span data-stu-id="bb86f-126">Application Proxy connectors only use outbound connections to the Azure AD Application Proxy service, which means that there is no need to open firewall ports for incoming connections.</span></span> <span data-ttu-id="bb86f-127">Traditional proxies required a perimeter network (also known as *DMZ*, *demilitarized zone*, or *screened subnet*) and allowed access to unauthenticated connections at the network edge.</span><span class="sxs-lookup"><span data-stu-id="bb86f-127">Traditional proxies required a perimeter network (also known as *DMZ*, *demilitarized zone*, or *screened subnet*) and allowed access to unauthenticated connections at the network edge.</span></span> <span data-ttu-id="bb86f-128">This scenario required investments in web application firewall products to analyze traffic and protect the environment.</span><span class="sxs-lookup"><span data-stu-id="bb86f-128">This scenario required investments in web application firewall products to analyze traffic and protect the environment.</span></span> <span data-ttu-id="bb86f-129">With Application Proxy, you don't need a perimeter network because all connections are outbound and take place over a secure channel.</span><span class="sxs-lookup"><span data-stu-id="bb86f-129">With Application Proxy, you don't need a perimeter network because all connections are outbound and take place over a secure channel.</span></span>

<span data-ttu-id="bb86f-130">For more information about connectors, see [Understand Azure AD Application Proxy connectors](application-proxy-connectors.md).</span><span class="sxs-lookup"><span data-stu-id="bb86f-130">For more information about connectors, see [Understand Azure AD Application Proxy connectors](application-proxy-connectors.md).</span></span>

### <a name="cloud-scale-analytics-and-machine-learning"></a><span data-ttu-id="bb86f-131">Cloud-scale analytics and machine learning</span><span class="sxs-lookup"><span data-stu-id="bb86f-131">Cloud-scale analytics and machine learning</span></span> 

<span data-ttu-id="bb86f-132">Get cutting-edge security protection.</span><span class="sxs-lookup"><span data-stu-id="bb86f-132">Get cutting-edge security protection.</span></span>

<span data-ttu-id="bb86f-133">Because it's part of Azure Active Directory, Application Proxy can leverage [Azure AD Identity Protection](../active-directory-identityprotection.md), with data from the Microsoft Security Response Center and Digital Crimes Unit.</span><span class="sxs-lookup"><span data-stu-id="bb86f-133">Because it's part of Azure Active Directory, Application Proxy can leverage [Azure AD Identity Protection](../active-directory-identityprotection.md), with data from the Microsoft Security Response Center and Digital Crimes Unit.</span></span> <span data-ttu-id="bb86f-134">Together we proactively identify compromised accounts and offer protection from high-risk sign-ins. We take into account numerous factors to determine which sign-in attemps are high risk.</span><span class="sxs-lookup"><span data-stu-id="bb86f-134">Together we proactively identify compromised accounts and offer protection from high-risk sign-ins. We take into account numerous factors to determine which sign-in attemps are high risk.</span></span> <span data-ttu-id="bb86f-135">These factors include flagging infected devices, anonymizing networks, and atypical or unlikely locations.</span><span class="sxs-lookup"><span data-stu-id="bb86f-135">These factors include flagging infected devices, anonymizing networks, and atypical or unlikely locations.</span></span>

<span data-ttu-id="bb86f-136">Many of these reports and events are already available through an API for integration with your security information and event management (SIEM) systems.</span><span class="sxs-lookup"><span data-stu-id="bb86f-136">Many of these reports and events are already available through an API for integration with your security information and event management (SIEM) systems.</span></span>

### <a name="remote-access-as-a-service"></a><span data-ttu-id="bb86f-137">Remote access as a service</span><span class="sxs-lookup"><span data-stu-id="bb86f-137">Remote access as a service</span></span>

<span data-ttu-id="bb86f-138">You don’t have to worry about maintaining and patching on-premises servers.</span><span class="sxs-lookup"><span data-stu-id="bb86f-138">You don’t have to worry about maintaining and patching on-premises servers.</span></span>

<span data-ttu-id="bb86f-139">Unpatched software still accounts for a large number of attacks.</span><span class="sxs-lookup"><span data-stu-id="bb86f-139">Unpatched software still accounts for a large number of attacks.</span></span> <span data-ttu-id="bb86f-140">Azure AD Application Proxy is an Internet-scale service that Microsoft owns, so you always get the latest security patches and upgrades.</span><span class="sxs-lookup"><span data-stu-id="bb86f-140">Azure AD Application Proxy is an Internet-scale service that Microsoft owns, so you always get the latest security patches and upgrades.</span></span>

<span data-ttu-id="bb86f-141">To improve the security of applications published by Azure AD Application Proxy, we block web crawler robots from indexing and archiving your applications.</span><span class="sxs-lookup"><span data-stu-id="bb86f-141">To improve the security of applications published by Azure AD Application Proxy, we block web crawler robots from indexing and archiving your applications.</span></span> <span data-ttu-id="bb86f-142">Each time a web crawler robot tries to retrieve the robot's settings for a published app, Application Proxy replies with a robots.txt file that includes `User-agent: * Disallow: /`.</span><span class="sxs-lookup"><span data-stu-id="bb86f-142">Each time a web crawler robot tries to retrieve the robot's settings for a published app, Application Proxy replies with a robots.txt file that includes `User-agent: * Disallow: /`.</span></span>

### <a name="ddos-prevention"></a><span data-ttu-id="bb86f-143">DDOS prevention</span><span class="sxs-lookup"><span data-stu-id="bb86f-143">DDOS prevention</span></span>

<span data-ttu-id="bb86f-144">Applications published through Application Proxy are protected against Distributed Denial of Service (DDOS) attacks.</span><span class="sxs-lookup"><span data-stu-id="bb86f-144">Applications published through Application Proxy are protected against Distributed Denial of Service (DDOS) attacks.</span></span>

<span data-ttu-id="bb86f-145">The Application Proxy service monitors the amount of traffic attempting to reach your applications and network.</span><span class="sxs-lookup"><span data-stu-id="bb86f-145">The Application Proxy service monitors the amount of traffic attempting to reach your applications and network.</span></span> <span data-ttu-id="bb86f-146">If the number of devices requesting remote access to your applications spikes, Microsoft throttles access to your network.</span><span class="sxs-lookup"><span data-stu-id="bb86f-146">If the number of devices requesting remote access to your applications spikes, Microsoft throttles access to your network.</span></span> 

<span data-ttu-id="bb86f-147">Microsoft watches traffic patterns for individual applications and for your subscription as a whole.</span><span class="sxs-lookup"><span data-stu-id="bb86f-147">Microsoft watches traffic patterns for individual applications and for your subscription as a whole.</span></span> <span data-ttu-id="bb86f-148">If one application receives higher than normal requests, then requests to access that application are denied for a short period of time.</span><span class="sxs-lookup"><span data-stu-id="bb86f-148">If one application receives higher than normal requests, then requests to access that application are denied for a short period of time.</span></span> <span data-ttu-id="bb86f-149">If you receive higher than normal requests across your whole subscription, then requests to access any of your apps are denied.</span><span class="sxs-lookup"><span data-stu-id="bb86f-149">If you receive higher than normal requests across your whole subscription, then requests to access any of your apps are denied.</span></span> <span data-ttu-id="bb86f-150">This preventative measure keeps your application servers from being overloaded by remote access requests, so that your on-premises users can keep accessing their apps.</span><span class="sxs-lookup"><span data-stu-id="bb86f-150">This preventative measure keeps your application servers from being overloaded by remote access requests, so that your on-premises users can keep accessing their apps.</span></span> 

## <a name="under-the-hood"></a><span data-ttu-id="bb86f-151">Under the hood</span><span class="sxs-lookup"><span data-stu-id="bb86f-151">Under the hood</span></span>

<span data-ttu-id="bb86f-152">Azure AD Application Proxy consists of two parts:</span><span class="sxs-lookup"><span data-stu-id="bb86f-152">Azure AD Application Proxy consists of two parts:</span></span>

* <span data-ttu-id="bb86f-153">The cloud-based service: This service runs in Azure, and is where the external client/user connections are made.</span><span class="sxs-lookup"><span data-stu-id="bb86f-153">The cloud-based service: This service runs in Azure, and is where the external client/user connections are made.</span></span>
* <span data-ttu-id="bb86f-154">[The on-premises connector](application-proxy-connectors.md): An on-premises component, the connector listens for requests from the Azure AD Application Proxy service and handles connections to the internal applications.</span><span class="sxs-lookup"><span data-stu-id="bb86f-154">[The on-premises connector](application-proxy-connectors.md): An on-premises component, the connector listens for requests from the Azure AD Application Proxy service and handles connections to the internal applications.</span></span> 

<span data-ttu-id="bb86f-155">A flow between the connector and the Application Proxy service is established when:</span><span class="sxs-lookup"><span data-stu-id="bb86f-155">A flow between the connector and the Application Proxy service is established when:</span></span>

* <span data-ttu-id="bb86f-156">The connector is first set up.</span><span class="sxs-lookup"><span data-stu-id="bb86f-156">The connector is first set up.</span></span>
* <span data-ttu-id="bb86f-157">The connector pulls configuration information from the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="bb86f-157">The connector pulls configuration information from the Application Proxy service.</span></span>
* <span data-ttu-id="bb86f-158">A user accesses a published application.</span><span class="sxs-lookup"><span data-stu-id="bb86f-158">A user accesses a published application.</span></span>

>[!NOTE]
><span data-ttu-id="bb86f-159">All communications occur over SSL, and they always originate at the connector to the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="bb86f-159">All communications occur over SSL, and they always originate at the connector to the Application Proxy service.</span></span> <span data-ttu-id="bb86f-160">The service is outbound only.</span><span class="sxs-lookup"><span data-stu-id="bb86f-160">The service is outbound only.</span></span>

<span data-ttu-id="bb86f-161">The connector uses a client certificate to authenticate to the Application Proxy service for nearly all calls.</span><span class="sxs-lookup"><span data-stu-id="bb86f-161">The connector uses a client certificate to authenticate to the Application Proxy service for nearly all calls.</span></span> <span data-ttu-id="bb86f-162">The only exception to this process is the initial setup step, where the client certificate is established.</span><span class="sxs-lookup"><span data-stu-id="bb86f-162">The only exception to this process is the initial setup step, where the client certificate is established.</span></span>

### <a name="installing-the-connector"></a><span data-ttu-id="bb86f-163">Installing the connector</span><span class="sxs-lookup"><span data-stu-id="bb86f-163">Installing the connector</span></span>

<span data-ttu-id="bb86f-164">When the connector is first set up, the following flow events take place:</span><span class="sxs-lookup"><span data-stu-id="bb86f-164">When the connector is first set up, the following flow events take place:</span></span>

1. <span data-ttu-id="bb86f-165">The connector registration to the service happens as part of the installation of the connector.</span><span class="sxs-lookup"><span data-stu-id="bb86f-165">The connector registration to the service happens as part of the installation of the connector.</span></span> <span data-ttu-id="bb86f-166">Users are prompted to enter their Azure AD admin credentials.</span><span class="sxs-lookup"><span data-stu-id="bb86f-166">Users are prompted to enter their Azure AD admin credentials.</span></span> <span data-ttu-id="bb86f-167">The token acquired from this authentication is then presented to the Azure AD Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="bb86f-167">The token acquired from this authentication is then presented to the Azure AD Application Proxy service.</span></span>
2. <span data-ttu-id="bb86f-168">The Application Proxy service evaluates the token.</span><span class="sxs-lookup"><span data-stu-id="bb86f-168">The Application Proxy service evaluates the token.</span></span> <span data-ttu-id="bb86f-169">It checks whether the user is a company administrator in the tenant.</span><span class="sxs-lookup"><span data-stu-id="bb86f-169">It checks whether the user is a company administrator in the tenant.</span></span> <span data-ttu-id="bb86f-170">If the user is not an administrator, the process is terminated.</span><span class="sxs-lookup"><span data-stu-id="bb86f-170">If the user is not an administrator, the process is terminated.</span></span>
3. <span data-ttu-id="bb86f-171">The connector generates a client certificate request and passes it, along with the token, to the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="bb86f-171">The connector generates a client certificate request and passes it, along with the token, to the Application Proxy service.</span></span> <span data-ttu-id="bb86f-172">The service in turn verifies the token and signs the client certificate request.</span><span class="sxs-lookup"><span data-stu-id="bb86f-172">The service in turn verifies the token and signs the client certificate request.</span></span>
4. <span data-ttu-id="bb86f-173">The connector uses the client certificate for future communication with the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="bb86f-173">The connector uses the client certificate for future communication with the Application Proxy service.</span></span>
5. <span data-ttu-id="bb86f-174">The connector performs an initial pull of the system configuration data from the service using its client certificate, and it is now ready to take requests.</span><span class="sxs-lookup"><span data-stu-id="bb86f-174">The connector performs an initial pull of the system configuration data from the service using its client certificate, and it is now ready to take requests.</span></span>

### <a name="updating-the-configuration-settings"></a><span data-ttu-id="bb86f-175">Updating the configuration settings</span><span class="sxs-lookup"><span data-stu-id="bb86f-175">Updating the configuration settings</span></span>

<span data-ttu-id="bb86f-176">Whenever the Application Proxy service updates the configuration settings, the following flow events take place:</span><span class="sxs-lookup"><span data-stu-id="bb86f-176">Whenever the Application Proxy service updates the configuration settings, the following flow events take place:</span></span>

1. <span data-ttu-id="bb86f-177">The connector connects to the configuration endpoint within the Application Proxy service by using its client certificate.</span><span class="sxs-lookup"><span data-stu-id="bb86f-177">The connector connects to the configuration endpoint within the Application Proxy service by using its client certificate.</span></span>
2. <span data-ttu-id="bb86f-178">After the client certificate is validated, the Application Proxy service returns configuration data to the connector (for example, the connector group that the connector should be part of).</span><span class="sxs-lookup"><span data-stu-id="bb86f-178">After the client certificate is validated, the Application Proxy service returns configuration data to the connector (for example, the connector group that the connector should be part of).</span></span>
3. <span data-ttu-id="bb86f-179">If the current certificate is more than 180 days old, the connector generates a new certificate request, which effectively updates the client certificate every 180 days.</span><span class="sxs-lookup"><span data-stu-id="bb86f-179">If the current certificate is more than 180 days old, the connector generates a new certificate request, which effectively updates the client certificate every 180 days.</span></span>

### <a name="accessing-published-applications"></a><span data-ttu-id="bb86f-180">Accessing published applications</span><span class="sxs-lookup"><span data-stu-id="bb86f-180">Accessing published applications</span></span>

<span data-ttu-id="bb86f-181">When users access a published application, the following events take place between the Application Proxy service and the Application Proxy connector:</span><span class="sxs-lookup"><span data-stu-id="bb86f-181">When users access a published application, the following events take place between the Application Proxy service and the Application Proxy connector:</span></span>

1. [<span data-ttu-id="bb86f-182">The service authenticates the user for the app</span><span class="sxs-lookup"><span data-stu-id="bb86f-182">The service authenticates the user for the app</span></span>](#the-service-checks-the-configuration-settings-for-the-app)
2. [<span data-ttu-id="bb86f-183">The service places a request in the connector queue</span><span class="sxs-lookup"><span data-stu-id="bb86f-183">The service places a request in the connector queue</span></span>](#The-service-places-a-request-in-the-connector-queue)
3. [<span data-ttu-id="bb86f-184">A connector processes the request from the queue</span><span class="sxs-lookup"><span data-stu-id="bb86f-184">A connector processes the request from the queue</span></span>](#the-connector-receives-the-request-from-the-queue)
4. [<span data-ttu-id="bb86f-185">The connector waits for a response</span><span class="sxs-lookup"><span data-stu-id="bb86f-185">The connector waits for a response</span></span>](#the-connector-waits-for-a-response)
5. [<span data-ttu-id="bb86f-186">The service streams data to the user</span><span class="sxs-lookup"><span data-stu-id="bb86f-186">The service streams data to the user</span></span>](#the-service-streams-data-to-the-user)

<span data-ttu-id="bb86f-187">To learn more about what takes place in each of these steps, keep reading.</span><span class="sxs-lookup"><span data-stu-id="bb86f-187">To learn more about what takes place in each of these steps, keep reading.</span></span>


#### <a name="1-the-service-authenticates-the-user-for-the-app"></a><span data-ttu-id="bb86f-188">1. The service authenticates the user for the app</span><span class="sxs-lookup"><span data-stu-id="bb86f-188">1. The service authenticates the user for the app</span></span>

<span data-ttu-id="bb86f-189">If you configured the app to use Passthrough as its preauthentication method, the steps in this section are skipped.</span><span class="sxs-lookup"><span data-stu-id="bb86f-189">If you configured the app to use Passthrough as its preauthentication method, the steps in this section are skipped.</span></span>

<span data-ttu-id="bb86f-190">If you configured the app to preauthenticate with Azure AD, users are redirected to the Azure AD STS to authenticate, and the following steps take place:</span><span class="sxs-lookup"><span data-stu-id="bb86f-190">If you configured the app to preauthenticate with Azure AD, users are redirected to the Azure AD STS to authenticate, and the following steps take place:</span></span>

1. <span data-ttu-id="bb86f-191">Application Proxy checks for any conditional access policy requirements for the specific application.</span><span class="sxs-lookup"><span data-stu-id="bb86f-191">Application Proxy checks for any conditional access policy requirements for the specific application.</span></span> <span data-ttu-id="bb86f-192">This step ensures that the user has been assigned to the application.</span><span class="sxs-lookup"><span data-stu-id="bb86f-192">This step ensures that the user has been assigned to the application.</span></span> <span data-ttu-id="bb86f-193">If two-step verification is required, the authentication sequence prompts the user for a second authentication method.</span><span class="sxs-lookup"><span data-stu-id="bb86f-193">If two-step verification is required, the authentication sequence prompts the user for a second authentication method.</span></span>

2. <span data-ttu-id="bb86f-194">After all checks have passed, the Azure AD STS issues a signed token for the application and redirects the user back to the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="bb86f-194">After all checks have passed, the Azure AD STS issues a signed token for the application and redirects the user back to the Application Proxy service.</span></span>

3. <span data-ttu-id="bb86f-195">Application Proxy verifies that the token was issued to correct the application.</span><span class="sxs-lookup"><span data-stu-id="bb86f-195">Application Proxy verifies that the token was issued to correct the application.</span></span> <span data-ttu-id="bb86f-196">It performs other checks also, such as ensuring that the token was signed by Azure AD, and that it is still within the valid window.</span><span class="sxs-lookup"><span data-stu-id="bb86f-196">It performs other checks also, such as ensuring that the token was signed by Azure AD, and that it is still within the valid window.</span></span>

4. <span data-ttu-id="bb86f-197">Application Proxy sets an encrypted authentication cookie to indicate that authentication to the application has occurred.</span><span class="sxs-lookup"><span data-stu-id="bb86f-197">Application Proxy sets an encrypted authentication cookie to indicate that authentication to the application has occurred.</span></span> <span data-ttu-id="bb86f-198">The cookie includes an expiration timestamp that's based on the token from Azure AD and other data, such as the user name that the authentication is based on.</span><span class="sxs-lookup"><span data-stu-id="bb86f-198">The cookie includes an expiration timestamp that's based on the token from Azure AD and other data, such as the user name that the authentication is based on.</span></span> <span data-ttu-id="bb86f-199">The cookie is encrypted with a private key known only to the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="bb86f-199">The cookie is encrypted with a private key known only to the Application Proxy service.</span></span>

5. <span data-ttu-id="bb86f-200">Application Proxy redirects the user back to the originally requested URL.</span><span class="sxs-lookup"><span data-stu-id="bb86f-200">Application Proxy redirects the user back to the originally requested URL.</span></span>

<span data-ttu-id="bb86f-201">If any part of the preauthentication steps fails, the user’s request is denied, and the user is shown a message indicating the source of the problem.</span><span class="sxs-lookup"><span data-stu-id="bb86f-201">If any part of the preauthentication steps fails, the user’s request is denied, and the user is shown a message indicating the source of the problem.</span></span>


#### <a name="2-the-service-places-a-request-in-the-connector-queue"></a><span data-ttu-id="bb86f-202">2. The service places a request in the connector queue</span><span class="sxs-lookup"><span data-stu-id="bb86f-202">2. The service places a request in the connector queue</span></span>

<span data-ttu-id="bb86f-203">Connectors keep an outbound connection open to the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="bb86f-203">Connectors keep an outbound connection open to the Application Proxy service.</span></span> <span data-ttu-id="bb86f-204">When a request comes in, the service queues up the request on one of the open connections for the connector to pick up.</span><span class="sxs-lookup"><span data-stu-id="bb86f-204">When a request comes in, the service queues up the request on one of the open connections for the connector to pick up.</span></span>

<span data-ttu-id="bb86f-205">The request includes items from the application, such as the request headers, data from the encrypted cookie, the user making the request, and the request ID.</span><span class="sxs-lookup"><span data-stu-id="bb86f-205">The request includes items from the application, such as the request headers, data from the encrypted cookie, the user making the request, and the request ID.</span></span> <span data-ttu-id="bb86f-206">Although data from the encrypted cookie is sent with the request, the authentication cookie itself is not.</span><span class="sxs-lookup"><span data-stu-id="bb86f-206">Although data from the encrypted cookie is sent with the request, the authentication cookie itself is not.</span></span>

#### <a name="3-the-connector-processes-the-request-from-the-queue"></a><span data-ttu-id="bb86f-207">3. The connector processes the request from the queue.</span><span class="sxs-lookup"><span data-stu-id="bb86f-207">3. The connector processes the request from the queue.</span></span> 

<span data-ttu-id="bb86f-208">Based on the request, Application Proxy performs one of the following actions:</span><span class="sxs-lookup"><span data-stu-id="bb86f-208">Based on the request, Application Proxy performs one of the following actions:</span></span>

* <span data-ttu-id="bb86f-209">If the request is a simple operation (for example, there is no data within the body as is with a RESTful *GET* request), the connector makes a connection to the target internal resource and then waits for a response.</span><span class="sxs-lookup"><span data-stu-id="bb86f-209">If the request is a simple operation (for example, there is no data within the body as is with a RESTful *GET* request), the connector makes a connection to the target internal resource and then waits for a response.</span></span>

* <span data-ttu-id="bb86f-210">If the request has data associated with it in the body (for example, a RESTful *POST* operation), the connector makes an outbound connection by using the client certificate to the Application Proxy instance.</span><span class="sxs-lookup"><span data-stu-id="bb86f-210">If the request has data associated with it in the body (for example, a RESTful *POST* operation), the connector makes an outbound connection by using the client certificate to the Application Proxy instance.</span></span> <span data-ttu-id="bb86f-211">It makes this connection to request the data and open a connection to the internal resource.</span><span class="sxs-lookup"><span data-stu-id="bb86f-211">It makes this connection to request the data and open a connection to the internal resource.</span></span> <span data-ttu-id="bb86f-212">After it receives the request from the connector, the Application Proxy service begins accepting content from the user and forwards data to the connector.</span><span class="sxs-lookup"><span data-stu-id="bb86f-212">After it receives the request from the connector, the Application Proxy service begins accepting content from the user and forwards data to the connector.</span></span> <span data-ttu-id="bb86f-213">The connector, in turn, forwards the data to the internal resource.</span><span class="sxs-lookup"><span data-stu-id="bb86f-213">The connector, in turn, forwards the data to the internal resource.</span></span>

#### <a name="4-the-connector-waits-for-a-response"></a><span data-ttu-id="bb86f-214">4. The connector waits for a response.</span><span class="sxs-lookup"><span data-stu-id="bb86f-214">4. The connector waits for a response.</span></span>

<span data-ttu-id="bb86f-215">After the request and transmission of all content to the back end is complete, the connector waits for a response.</span><span class="sxs-lookup"><span data-stu-id="bb86f-215">After the request and transmission of all content to the back end is complete, the connector waits for a response.</span></span>

<span data-ttu-id="bb86f-216">After it receives a response, the connector makes an outbound connection to the Application Proxy service, to return the header details and begin streaming the return data.</span><span class="sxs-lookup"><span data-stu-id="bb86f-216">After it receives a response, the connector makes an outbound connection to the Application Proxy service, to return the header details and begin streaming the return data.</span></span>

#### <a name="5-the-service-streams-data-to-the-user"></a><span data-ttu-id="bb86f-217">5. The service streams data to the user.</span><span class="sxs-lookup"><span data-stu-id="bb86f-217">5. The service streams data to the user.</span></span> 

<span data-ttu-id="bb86f-218">Some processing of the application may occur here.</span><span class="sxs-lookup"><span data-stu-id="bb86f-218">Some processing of the application may occur here.</span></span> <span data-ttu-id="bb86f-219">If you configured Application Proxy to translate headers or URLs in your application, that processing happens as needed during this step.</span><span class="sxs-lookup"><span data-stu-id="bb86f-219">If you configured Application Proxy to translate headers or URLs in your application, that processing happens as needed during this step.</span></span>


## <a name="next-steps"></a><span data-ttu-id="bb86f-220">Next steps</span><span class="sxs-lookup"><span data-stu-id="bb86f-220">Next steps</span></span>

[<span data-ttu-id="bb86f-221">Network topology considerations when using Azure AD Application Proxy</span><span class="sxs-lookup"><span data-stu-id="bb86f-221">Network topology considerations when using Azure AD Application Proxy</span></span>](application-proxy-network-topology.md)

[<span data-ttu-id="bb86f-222">Understand Azure AD Application Proxy connectors</span><span class="sxs-lookup"><span data-stu-id="bb86f-222">Understand Azure AD Application Proxy connectors</span></span>](application-proxy-connectors.md)
