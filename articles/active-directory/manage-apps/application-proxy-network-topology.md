---
title: Network topology considerations when using Azure Active Directory Application Proxy | Microsoft Docs
description: Covers network topology considerations when using Azure AD Application Proxy.
services: active-directory
documentationcenter: ''
author: barbkess
manager: mtillman
ms.service: active-directory
ms.component: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 07/28/2017
ms.author: barbkess
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: 2321ccf115e3b517bdc593c0c428c61d5dd90968
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44865679"
---
# <a name="network-topology-considerations-when-using-azure-active-directory-application-proxy"></a><span data-ttu-id="78792-103">Network topology considerations when using Azure Active Directory Application Proxy</span><span class="sxs-lookup"><span data-stu-id="78792-103">Network topology considerations when using Azure Active Directory Application Proxy</span></span>

<span data-ttu-id="78792-104">This article explains network topology considerations when using Azure Active Directory (Azure AD) Application Proxy for publishing and accessing your applications remotely.</span><span class="sxs-lookup"><span data-stu-id="78792-104">This article explains network topology considerations when using Azure Active Directory (Azure AD) Application Proxy for publishing and accessing your applications remotely.</span></span>

## <a name="traffic-flow"></a><span data-ttu-id="78792-105">Traffic flow</span><span class="sxs-lookup"><span data-stu-id="78792-105">Traffic flow</span></span>

<span data-ttu-id="78792-106">When an application is published through Azure AD Application Proxy, traffic from the users to the applications flows through three connections:</span><span class="sxs-lookup"><span data-stu-id="78792-106">When an application is published through Azure AD Application Proxy, traffic from the users to the applications flows through three connections:</span></span>

1. <span data-ttu-id="78792-107">The user connects to the Azure AD Application Proxy service public endpoint on Azure</span><span class="sxs-lookup"><span data-stu-id="78792-107">The user connects to the Azure AD Application Proxy service public endpoint on Azure</span></span>
2. <span data-ttu-id="78792-108">The Application Proxy service connects to the Application Proxy connector</span><span class="sxs-lookup"><span data-stu-id="78792-108">The Application Proxy service connects to the Application Proxy connector</span></span>
3. <span data-ttu-id="78792-109">The Application Proxy connector connects to the target application</span><span class="sxs-lookup"><span data-stu-id="78792-109">The Application Proxy connector connects to the target application</span></span>

![Diagram showing traffic flow from user to target application](./media/application-proxy-network-topology/application-proxy-three-hops.png)

## <a name="tenant-location-and-application-proxy-service"></a><span data-ttu-id="78792-111">Tenant location and Application Proxy service</span><span class="sxs-lookup"><span data-stu-id="78792-111">Tenant location and Application Proxy service</span></span>

<span data-ttu-id="78792-112">When you sign up for an Azure AD tenant, the region of your tenant is determined by the country you specify.</span><span class="sxs-lookup"><span data-stu-id="78792-112">When you sign up for an Azure AD tenant, the region of your tenant is determined by the country you specify.</span></span> <span data-ttu-id="78792-113">When you enable Application Proxy, the Application Proxy service instances for your tenant are chosen or created in the same region as your Azure AD tenant, or the closest region to it.</span><span class="sxs-lookup"><span data-stu-id="78792-113">When you enable Application Proxy, the Application Proxy service instances for your tenant are chosen or created in the same region as your Azure AD tenant, or the closest region to it.</span></span>

<span data-ttu-id="78792-114">For example, if your Azure AD tenant’s region is the European Union (EU), all your Application Proxy connectors use service instances in Azure datacenters in the EU.</span><span class="sxs-lookup"><span data-stu-id="78792-114">For example, if your Azure AD tenant’s region is the European Union (EU), all your Application Proxy connectors use service instances in Azure datacenters in the EU.</span></span> <span data-ttu-id="78792-115">When your users access published applications, their traffic goes through the Application Proxy service instances in this location.</span><span class="sxs-lookup"><span data-stu-id="78792-115">When your users access published applications, their traffic goes through the Application Proxy service instances in this location.</span></span>

## <a name="considerations-for-reducing-latency"></a><span data-ttu-id="78792-116">Considerations for reducing latency</span><span class="sxs-lookup"><span data-stu-id="78792-116">Considerations for reducing latency</span></span>

<span data-ttu-id="78792-117">All proxy solutions introduce latency into your network connection.</span><span class="sxs-lookup"><span data-stu-id="78792-117">All proxy solutions introduce latency into your network connection.</span></span> <span data-ttu-id="78792-118">No matter which proxy or VPN solution you choose as your remote access solution, it always includes a set of servers enabling the connection to inside your corporate network.</span><span class="sxs-lookup"><span data-stu-id="78792-118">No matter which proxy or VPN solution you choose as your remote access solution, it always includes a set of servers enabling the connection to inside your corporate network.</span></span>

<span data-ttu-id="78792-119">Organizations typically include server endpoints in their perimeter network.</span><span class="sxs-lookup"><span data-stu-id="78792-119">Organizations typically include server endpoints in their perimeter network.</span></span> <span data-ttu-id="78792-120">With Azure AD Application Proxy, however, traffic flows through the proxy service in the cloud while the connectors reside on your corporate network.</span><span class="sxs-lookup"><span data-stu-id="78792-120">With Azure AD Application Proxy, however, traffic flows through the proxy service in the cloud while the connectors reside on your corporate network.</span></span> <span data-ttu-id="78792-121">No perimeter network is required.</span><span class="sxs-lookup"><span data-stu-id="78792-121">No perimeter network is required.</span></span>

<span data-ttu-id="78792-122">The next sections contain additional suggestions to help you reduce latency even further.</span><span class="sxs-lookup"><span data-stu-id="78792-122">The next sections contain additional suggestions to help you reduce latency even further.</span></span> 

### <a name="connector-placement"></a><span data-ttu-id="78792-123">Connector placement</span><span class="sxs-lookup"><span data-stu-id="78792-123">Connector placement</span></span>

<span data-ttu-id="78792-124">Application Proxy chooses the location of instances for you, based on your tenant location.</span><span class="sxs-lookup"><span data-stu-id="78792-124">Application Proxy chooses the location of instances for you, based on your tenant location.</span></span> <span data-ttu-id="78792-125">However, you get to decide where to install the connector, giving you the power to define the latency characteristics of your network traffic.</span><span class="sxs-lookup"><span data-stu-id="78792-125">However, you get to decide where to install the connector, giving you the power to define the latency characteristics of your network traffic.</span></span>

<span data-ttu-id="78792-126">When setting up the Application Proxy service, ask the following questions:</span><span class="sxs-lookup"><span data-stu-id="78792-126">When setting up the Application Proxy service, ask the following questions:</span></span>

* <span data-ttu-id="78792-127">Where is the app located?</span><span class="sxs-lookup"><span data-stu-id="78792-127">Where is the app located?</span></span>
* <span data-ttu-id="78792-128">Where are most users who access the app located?</span><span class="sxs-lookup"><span data-stu-id="78792-128">Where are most users who access the app located?</span></span>
* <span data-ttu-id="78792-129">Where is the Application Proxy instance located?</span><span class="sxs-lookup"><span data-stu-id="78792-129">Where is the Application Proxy instance located?</span></span>
* <span data-ttu-id="78792-130">Do you already have a dedicated network connection to Azure datacenters set up, like Azure ExpressRoute or a similar VPN?</span><span class="sxs-lookup"><span data-stu-id="78792-130">Do you already have a dedicated network connection to Azure datacenters set up, like Azure ExpressRoute or a similar VPN?</span></span>

<span data-ttu-id="78792-131">The connector has to communicate with both Azure and your applications (steps 2 and 3 in the Traffic flow diagram), so the placement of the connector affects the latency of those two connections.</span><span class="sxs-lookup"><span data-stu-id="78792-131">The connector has to communicate with both Azure and your applications (steps 2 and 3 in the Traffic flow diagram), so the placement of the connector affects the latency of those two connections.</span></span> <span data-ttu-id="78792-132">When evaluating the placement of the connector, keep in mind the following points:</span><span class="sxs-lookup"><span data-stu-id="78792-132">When evaluating the placement of the connector, keep in mind the following points:</span></span>

* <span data-ttu-id="78792-133">If you want to use Kerberos constrained delegation (KCD) for single sign-on, then the connector needs a line of sight to a datacenter.</span><span class="sxs-lookup"><span data-stu-id="78792-133">If you want to use Kerberos constrained delegation (KCD) for single sign-on, then the connector needs a line of sight to a datacenter.</span></span> <span data-ttu-id="78792-134">Additionally, the connector server needs to be domain joined.</span><span class="sxs-lookup"><span data-stu-id="78792-134">Additionally, the connector server needs to be domain joined.</span></span>  
* <span data-ttu-id="78792-135">When in doubt, install the connector closer to the application.</span><span class="sxs-lookup"><span data-stu-id="78792-135">When in doubt, install the connector closer to the application.</span></span>

### <a name="general-approach-to-minimize-latency"></a><span data-ttu-id="78792-136">General approach to minimize latency</span><span class="sxs-lookup"><span data-stu-id="78792-136">General approach to minimize latency</span></span>

<span data-ttu-id="78792-137">You can minimize the latency of the end-to-end traffic by optimizing each network connection.</span><span class="sxs-lookup"><span data-stu-id="78792-137">You can minimize the latency of the end-to-end traffic by optimizing each network connection.</span></span> <span data-ttu-id="78792-138">Each connection can be optimized by:</span><span class="sxs-lookup"><span data-stu-id="78792-138">Each connection can be optimized by:</span></span>

* <span data-ttu-id="78792-139">Reducing the distance between the two ends of the hop.</span><span class="sxs-lookup"><span data-stu-id="78792-139">Reducing the distance between the two ends of the hop.</span></span>
* <span data-ttu-id="78792-140">Choosing the right network to traverse.</span><span class="sxs-lookup"><span data-stu-id="78792-140">Choosing the right network to traverse.</span></span> <span data-ttu-id="78792-141">For example, traversing a private network rather than the public Internet may be faster, due to dedicated links.</span><span class="sxs-lookup"><span data-stu-id="78792-141">For example, traversing a private network rather than the public Internet may be faster, due to dedicated links.</span></span>

<span data-ttu-id="78792-142">If you have a dedicated VPN or ExpressRoute link between Azure and your corporate network, you may want to use that.</span><span class="sxs-lookup"><span data-stu-id="78792-142">If you have a dedicated VPN or ExpressRoute link between Azure and your corporate network, you may want to use that.</span></span>

## <a name="focus-your-optimization-strategy"></a><span data-ttu-id="78792-143">Focus your optimization strategy</span><span class="sxs-lookup"><span data-stu-id="78792-143">Focus your optimization strategy</span></span>

<span data-ttu-id="78792-144">There's little that you can do to control the connection between your users and the Application Proxy service.</span><span class="sxs-lookup"><span data-stu-id="78792-144">There's little that you can do to control the connection between your users and the Application Proxy service.</span></span> <span data-ttu-id="78792-145">Users may access your apps from a home network, a coffee shop, or a different country.</span><span class="sxs-lookup"><span data-stu-id="78792-145">Users may access your apps from a home network, a coffee shop, or a different country.</span></span> <span data-ttu-id="78792-146">Instead, you can optimize the connections from the Application Proxy service to the Application Proxy connectors to the apps.</span><span class="sxs-lookup"><span data-stu-id="78792-146">Instead, you can optimize the connections from the Application Proxy service to the Application Proxy connectors to the apps.</span></span> <span data-ttu-id="78792-147">Consider incorporating the following patterns in your environment.</span><span class="sxs-lookup"><span data-stu-id="78792-147">Consider incorporating the following patterns in your environment.</span></span>

### <a name="pattern-1-put-the-connector-close-to-the-application"></a><span data-ttu-id="78792-148">Pattern 1: Put the connector close to the application</span><span class="sxs-lookup"><span data-stu-id="78792-148">Pattern 1: Put the connector close to the application</span></span>

<span data-ttu-id="78792-149">Place the connector close to the target application in the customer network.</span><span class="sxs-lookup"><span data-stu-id="78792-149">Place the connector close to the target application in the customer network.</span></span> <span data-ttu-id="78792-150">This configuration minimizes step 3 in the topography diagram, because the connector and application are close.</span><span class="sxs-lookup"><span data-stu-id="78792-150">This configuration minimizes step 3 in the topography diagram, because the connector and application are close.</span></span> 

<span data-ttu-id="78792-151">If your connector needs a line of sight to the domain controller, then this pattern is advantageous.</span><span class="sxs-lookup"><span data-stu-id="78792-151">If your connector needs a line of sight to the domain controller, then this pattern is advantageous.</span></span> <span data-ttu-id="78792-152">Most of our customers use this pattern, because it works well for most scenarios.</span><span class="sxs-lookup"><span data-stu-id="78792-152">Most of our customers use this pattern, because it works well for most scenarios.</span></span> <span data-ttu-id="78792-153">This pattern can also be combined with pattern 2 to optimize traffic between the service and the connector.</span><span class="sxs-lookup"><span data-stu-id="78792-153">This pattern can also be combined with pattern 2 to optimize traffic between the service and the connector.</span></span>

### <a name="pattern-2-take-advantage-of-expressroute-with-public-peering"></a><span data-ttu-id="78792-154">Pattern 2: Take advantage of ExpressRoute with public peering</span><span class="sxs-lookup"><span data-stu-id="78792-154">Pattern 2: Take advantage of ExpressRoute with public peering</span></span>

<span data-ttu-id="78792-155">If you have ExpressRoute set up with public peering, you can use the faster ExpressRoute connection for traffic between Application Proxy and the connector.</span><span class="sxs-lookup"><span data-stu-id="78792-155">If you have ExpressRoute set up with public peering, you can use the faster ExpressRoute connection for traffic between Application Proxy and the connector.</span></span> <span data-ttu-id="78792-156">The connector is still on your network, close to the app.</span><span class="sxs-lookup"><span data-stu-id="78792-156">The connector is still on your network, close to the app.</span></span>

### <a name="pattern-3-take-advantage-of-expressroute-with-private-peering"></a><span data-ttu-id="78792-157">Pattern 3: Take advantage of ExpressRoute with private peering</span><span class="sxs-lookup"><span data-stu-id="78792-157">Pattern 3: Take advantage of ExpressRoute with private peering</span></span>

<span data-ttu-id="78792-158">If you have a dedicated VPN or ExpressRoute set up with private peering between Azure and your corporate network, you have another option.</span><span class="sxs-lookup"><span data-stu-id="78792-158">If you have a dedicated VPN or ExpressRoute set up with private peering between Azure and your corporate network, you have another option.</span></span> <span data-ttu-id="78792-159">In this configuration, the virtual network in Azure is typically considered as an extension of the corporate network.</span><span class="sxs-lookup"><span data-stu-id="78792-159">In this configuration, the virtual network in Azure is typically considered as an extension of the corporate network.</span></span> <span data-ttu-id="78792-160">So you can install the connector in the Azure datacenter, and still satisfy the low latency requirements of the connector-to-app connection.</span><span class="sxs-lookup"><span data-stu-id="78792-160">So you can install the connector in the Azure datacenter, and still satisfy the low latency requirements of the connector-to-app connection.</span></span>

<span data-ttu-id="78792-161">Latency is not compromised because traffic is flowing over a dedicated connection.</span><span class="sxs-lookup"><span data-stu-id="78792-161">Latency is not compromised because traffic is flowing over a dedicated connection.</span></span> <span data-ttu-id="78792-162">You also get improved Application Proxy service-to-connector latency because the connector is installed in an Azure datacenter close to your Azure AD tenant location.</span><span class="sxs-lookup"><span data-stu-id="78792-162">You also get improved Application Proxy service-to-connector latency because the connector is installed in an Azure datacenter close to your Azure AD tenant location.</span></span>

![Diagram showing connector installed within an Azure datacenter](./media/application-proxy-network-topology/application-proxy-expressroute-private.png)

### <a name="other-approaches"></a><span data-ttu-id="78792-164">Other approaches</span><span class="sxs-lookup"><span data-stu-id="78792-164">Other approaches</span></span>

<span data-ttu-id="78792-165">Although the focus of this article is connector placement, you can also change the placement of the application to get better latency characteristics.</span><span class="sxs-lookup"><span data-stu-id="78792-165">Although the focus of this article is connector placement, you can also change the placement of the application to get better latency characteristics.</span></span>

<span data-ttu-id="78792-166">Increasingly, organizations are moving their networks into hosted environments.</span><span class="sxs-lookup"><span data-stu-id="78792-166">Increasingly, organizations are moving their networks into hosted environments.</span></span> <span data-ttu-id="78792-167">This enables them to place their apps in a hosted environment that is also part of their corporate network, and still be within the domain.</span><span class="sxs-lookup"><span data-stu-id="78792-167">This enables them to place their apps in a hosted environment that is also part of their corporate network, and still be within the domain.</span></span> <span data-ttu-id="78792-168">In this case, the patterns discussed in the preceding sections can be applied to the new application location.</span><span class="sxs-lookup"><span data-stu-id="78792-168">In this case, the patterns discussed in the preceding sections can be applied to the new application location.</span></span> <span data-ttu-id="78792-169">If you're considering this option, see [Azure AD Domain Services](../../active-directory-domain-services/active-directory-ds-overview.md).</span><span class="sxs-lookup"><span data-stu-id="78792-169">If you're considering this option, see [Azure AD Domain Services](../../active-directory-domain-services/active-directory-ds-overview.md).</span></span>

<span data-ttu-id="78792-170">Additionally, consider organizing your connectors using [connector groups](application-proxy-connector-groups.md) to target apps that are in different locations and networks.</span><span class="sxs-lookup"><span data-stu-id="78792-170">Additionally, consider organizing your connectors using [connector groups](application-proxy-connector-groups.md) to target apps that are in different locations and networks.</span></span> 

## <a name="common-use-cases"></a><span data-ttu-id="78792-171">Common use cases</span><span class="sxs-lookup"><span data-stu-id="78792-171">Common use cases</span></span>

<span data-ttu-id="78792-172">In this section, we walk through a few common scenarios.</span><span class="sxs-lookup"><span data-stu-id="78792-172">In this section, we walk through a few common scenarios.</span></span> <span data-ttu-id="78792-173">Assume that the Azure AD tenant (and therefore proxy service endpoint) is located in the United States (US).</span><span class="sxs-lookup"><span data-stu-id="78792-173">Assume that the Azure AD tenant (and therefore proxy service endpoint) is located in the United States (US).</span></span> <span data-ttu-id="78792-174">The considerations discussed in these use cases also apply to other regions around the globe.</span><span class="sxs-lookup"><span data-stu-id="78792-174">The considerations discussed in these use cases also apply to other regions around the globe.</span></span>

<span data-ttu-id="78792-175">For these scenarios, we call each connection a "hop" and number them for easier discussion:</span><span class="sxs-lookup"><span data-stu-id="78792-175">For these scenarios, we call each connection a "hop" and number them for easier discussion:</span></span>

- <span data-ttu-id="78792-176">**Hop 1**: User to the Application Proxy service</span><span class="sxs-lookup"><span data-stu-id="78792-176">**Hop 1**: User to the Application Proxy service</span></span>
- <span data-ttu-id="78792-177">**Hop 2**: Application Proxy service to the Application Proxy connector</span><span class="sxs-lookup"><span data-stu-id="78792-177">**Hop 2**: Application Proxy service to the Application Proxy connector</span></span>
- <span data-ttu-id="78792-178">**Hop 3**: Application Proxy connector to the target application</span><span class="sxs-lookup"><span data-stu-id="78792-178">**Hop 3**: Application Proxy connector to the target application</span></span> 

### <a name="use-case-1"></a><span data-ttu-id="78792-179">Use case 1</span><span class="sxs-lookup"><span data-stu-id="78792-179">Use case 1</span></span>

<span data-ttu-id="78792-180">**Scenario:** The app is in an organization's network in the US, with users in the same region.</span><span class="sxs-lookup"><span data-stu-id="78792-180">**Scenario:** The app is in an organization's network in the US, with users in the same region.</span></span> <span data-ttu-id="78792-181">No ExpressRoute or VPN exists between the Azure datacenter and the corporate network.</span><span class="sxs-lookup"><span data-stu-id="78792-181">No ExpressRoute or VPN exists between the Azure datacenter and the corporate network.</span></span>

<span data-ttu-id="78792-182">**Recommendation:** Follow pattern 1, explained in the previous section.</span><span class="sxs-lookup"><span data-stu-id="78792-182">**Recommendation:** Follow pattern 1, explained in the previous section.</span></span> <span data-ttu-id="78792-183">For improved latency, consider using ExpressRoute, if needed.</span><span class="sxs-lookup"><span data-stu-id="78792-183">For improved latency, consider using ExpressRoute, if needed.</span></span>

<span data-ttu-id="78792-184">This is a simple pattern.</span><span class="sxs-lookup"><span data-stu-id="78792-184">This is a simple pattern.</span></span> <span data-ttu-id="78792-185">You optimize hop 3 by placing the connector near the app.</span><span class="sxs-lookup"><span data-stu-id="78792-185">You optimize hop 3 by placing the connector near the app.</span></span> <span data-ttu-id="78792-186">This is also a natural choice, because the connector typically is installed with line of sight to the app and to the datacenter to perform KCD operations.</span><span class="sxs-lookup"><span data-stu-id="78792-186">This is also a natural choice, because the connector typically is installed with line of sight to the app and to the datacenter to perform KCD operations.</span></span>

![Diagram showing that users, proxy, connector, and app are all in the US](./media/application-proxy-network-topology/application-proxy-pattern1.png)

### <a name="use-case-2"></a><span data-ttu-id="78792-188">Use case 2</span><span class="sxs-lookup"><span data-stu-id="78792-188">Use case 2</span></span>

<span data-ttu-id="78792-189">**Scenario:** The app is in an organization's network in the US, with users spread out globally.</span><span class="sxs-lookup"><span data-stu-id="78792-189">**Scenario:** The app is in an organization's network in the US, with users spread out globally.</span></span> <span data-ttu-id="78792-190">No ExpressRoute or VPN exists between the Azure datacenter and the corporate network.</span><span class="sxs-lookup"><span data-stu-id="78792-190">No ExpressRoute or VPN exists between the Azure datacenter and the corporate network.</span></span>

<span data-ttu-id="78792-191">**Recommendation:** Follow pattern 1, explained in the previous section.</span><span class="sxs-lookup"><span data-stu-id="78792-191">**Recommendation:** Follow pattern 1, explained in the previous section.</span></span> 

<span data-ttu-id="78792-192">Again, the common pattern is to optimize hop 3, where you place the connector near the app.</span><span class="sxs-lookup"><span data-stu-id="78792-192">Again, the common pattern is to optimize hop 3, where you place the connector near the app.</span></span> <span data-ttu-id="78792-193">Hop 3 is not typically expensive, if it is all within the same region.</span><span class="sxs-lookup"><span data-stu-id="78792-193">Hop 3 is not typically expensive, if it is all within the same region.</span></span> <span data-ttu-id="78792-194">However, hop 1 can be more expensive depending on where the user is, because users across the world must access the Application Proxy instance in the US.</span><span class="sxs-lookup"><span data-stu-id="78792-194">However, hop 1 can be more expensive depending on where the user is, because users across the world must access the Application Proxy instance in the US.</span></span> <span data-ttu-id="78792-195">It's worth noting that any proxy solution has similar characteristics regarding users being spread out globally.</span><span class="sxs-lookup"><span data-stu-id="78792-195">It's worth noting that any proxy solution has similar characteristics regarding users being spread out globally.</span></span>

![Diagram showing that users are spread globally, but the proxy, connector, and app are in the US](./media/application-proxy-network-topology/application-proxy-pattern2.png)

### <a name="use-case-3"></a><span data-ttu-id="78792-197">Use case 3</span><span class="sxs-lookup"><span data-stu-id="78792-197">Use case 3</span></span>

<span data-ttu-id="78792-198">**Scenario:** The app is in an organization's network in the US.</span><span class="sxs-lookup"><span data-stu-id="78792-198">**Scenario:** The app is in an organization's network in the US.</span></span> <span data-ttu-id="78792-199">ExpressRoute with public peering exists between Azure and the corporate network.</span><span class="sxs-lookup"><span data-stu-id="78792-199">ExpressRoute with public peering exists between Azure and the corporate network.</span></span>

<span data-ttu-id="78792-200">**Recommendation:** Follow patterns 1 and 2, explained in the previous section.</span><span class="sxs-lookup"><span data-stu-id="78792-200">**Recommendation:** Follow patterns 1 and 2, explained in the previous section.</span></span>

<span data-ttu-id="78792-201">First, place the connector as close as possible to the app.</span><span class="sxs-lookup"><span data-stu-id="78792-201">First, place the connector as close as possible to the app.</span></span> <span data-ttu-id="78792-202">Then, the system automatically uses ExpressRoute for hop 2.</span><span class="sxs-lookup"><span data-stu-id="78792-202">Then, the system automatically uses ExpressRoute for hop 2.</span></span> 

<span data-ttu-id="78792-203">If the ExpressRoute link is using public peering, the traffic between the proxy and the connector flows over that link.</span><span class="sxs-lookup"><span data-stu-id="78792-203">If the ExpressRoute link is using public peering, the traffic between the proxy and the connector flows over that link.</span></span> <span data-ttu-id="78792-204">Hop 2 has optimized latency.</span><span class="sxs-lookup"><span data-stu-id="78792-204">Hop 2 has optimized latency.</span></span>

![Diagram showing ExpressRoute between the proxy and connector](./media/application-proxy-network-topology/application-proxy-pattern3.png)

### <a name="use-case-4"></a><span data-ttu-id="78792-206">Use case 4</span><span class="sxs-lookup"><span data-stu-id="78792-206">Use case 4</span></span>

<span data-ttu-id="78792-207">**Scenario:** The app is in an organization's network in the US.</span><span class="sxs-lookup"><span data-stu-id="78792-207">**Scenario:** The app is in an organization's network in the US.</span></span> <span data-ttu-id="78792-208">ExpressRoute with private peering exists between Azure and the corporate network.</span><span class="sxs-lookup"><span data-stu-id="78792-208">ExpressRoute with private peering exists between Azure and the corporate network.</span></span>

<span data-ttu-id="78792-209">**Recommendation:** Follow pattern 3, explained in the previous section.</span><span class="sxs-lookup"><span data-stu-id="78792-209">**Recommendation:** Follow pattern 3, explained in the previous section.</span></span>

<span data-ttu-id="78792-210">Place the connector in the Azure datacenter that is connected to the corporate network through ExpressRoute private peering.</span><span class="sxs-lookup"><span data-stu-id="78792-210">Place the connector in the Azure datacenter that is connected to the corporate network through ExpressRoute private peering.</span></span> 

<span data-ttu-id="78792-211">The connector can be placed in the Azure datacenter.</span><span class="sxs-lookup"><span data-stu-id="78792-211">The connector can be placed in the Azure datacenter.</span></span> <span data-ttu-id="78792-212">Since the connector still has a line of sight to the application and the datacenter through the private network, hop 3 remains optimized.</span><span class="sxs-lookup"><span data-stu-id="78792-212">Since the connector still has a line of sight to the application and the datacenter through the private network, hop 3 remains optimized.</span></span> <span data-ttu-id="78792-213">In addition, hop 2 is optimized further.</span><span class="sxs-lookup"><span data-stu-id="78792-213">In addition, hop 2 is optimized further.</span></span>

![Diagram showing the connector in an Azure datacenter, and ExpressRoute between the connector and app](./media/application-proxy-network-topology/application-proxy-pattern4.png)

### <a name="use-case-5"></a><span data-ttu-id="78792-215">Use case 5</span><span class="sxs-lookup"><span data-stu-id="78792-215">Use case 5</span></span>

<span data-ttu-id="78792-216">**Scenario:** The app is in an organization's network in the EU, with the Application Proxy instance and most users in the US.</span><span class="sxs-lookup"><span data-stu-id="78792-216">**Scenario:** The app is in an organization's network in the EU, with the Application Proxy instance and most users in the US.</span></span>

<span data-ttu-id="78792-217">**Recommendation:** Place the connector near the app.</span><span class="sxs-lookup"><span data-stu-id="78792-217">**Recommendation:** Place the connector near the app.</span></span> <span data-ttu-id="78792-218">Because US users are accessing an Application Proxy instance that happens to be in the same region, hop 1 is not too expensive.</span><span class="sxs-lookup"><span data-stu-id="78792-218">Because US users are accessing an Application Proxy instance that happens to be in the same region, hop 1 is not too expensive.</span></span> <span data-ttu-id="78792-219">Hop 3 is optimized.</span><span class="sxs-lookup"><span data-stu-id="78792-219">Hop 3 is optimized.</span></span> <span data-ttu-id="78792-220">Consider using ExpressRoute to optimize hop 2.</span><span class="sxs-lookup"><span data-stu-id="78792-220">Consider using ExpressRoute to optimize hop 2.</span></span> 

![Diagram showing users and proxy in the US, with the connector and app in the EU](./media/application-proxy-network-topology/application-proxy-pattern5b.png)

<span data-ttu-id="78792-222">You can also consider using one other variant in this situation.</span><span class="sxs-lookup"><span data-stu-id="78792-222">You can also consider using one other variant in this situation.</span></span> <span data-ttu-id="78792-223">If most users in the organization are in the US, then chances are that your network extends to the US as well.</span><span class="sxs-lookup"><span data-stu-id="78792-223">If most users in the organization are in the US, then chances are that your network extends to the US as well.</span></span> <span data-ttu-id="78792-224">Place the connector in the US, and use the dedicated internal corporate network line to the application in the EU.</span><span class="sxs-lookup"><span data-stu-id="78792-224">Place the connector in the US, and use the dedicated internal corporate network line to the application in the EU.</span></span> <span data-ttu-id="78792-225">This way hops 2 and 3 are optimized.</span><span class="sxs-lookup"><span data-stu-id="78792-225">This way hops 2 and 3 are optimized.</span></span>

![Diagram showing users, proxy, and connector in the US, app in the EU](./media/application-proxy-network-topology/application-proxy-pattern5c.png)

## <a name="next-steps"></a><span data-ttu-id="78792-227">Next steps</span><span class="sxs-lookup"><span data-stu-id="78792-227">Next steps</span></span>

- [<span data-ttu-id="78792-228">Enable Application Proxy</span><span class="sxs-lookup"><span data-stu-id="78792-228">Enable Application Proxy</span></span>](application-proxy-enable.md)
- [<span data-ttu-id="78792-229">Enable single-sign on</span><span class="sxs-lookup"><span data-stu-id="78792-229">Enable single-sign on</span></span>](application-proxy-configure-single-sign-on-with-kcd.md)
- [<span data-ttu-id="78792-230">Enable conditional access</span><span class="sxs-lookup"><span data-stu-id="78792-230">Enable conditional access</span></span>](application-proxy-integrate-with-sharepoint-server.md)
- [<span data-ttu-id="78792-231">Troubleshoot issues you're having with Application Proxy</span><span class="sxs-lookup"><span data-stu-id="78792-231">Troubleshoot issues you're having with Application Proxy</span></span>](application-proxy-troubleshoot.md)
