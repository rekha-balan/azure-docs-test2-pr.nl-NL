---
title: Manage access to cloud apps by restricting tenants - Azure | Microsoft Docs
description: How to use Tenant Restrictions to manage which users can access apps based on their Azure AD tenant.
services: active-directory
documentationcenter: ''
author: barbkess
manager: mtillman
editor: yossib
ms.service: active-directory
ms.component: app-mgmt
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 05/15/2018
ms.author: barbkess
ms.reviewer: richagi
ms.openlocfilehash: 4a5cb7d15627ac3e48b72567ec3740377b2a0264
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44966017"
---
# <a name="use-tenant-restrictions-to-manage-access-to-saas-cloud-applications"></a><span data-ttu-id="f7b6b-103">Use Tenant Restrictions to manage access to SaaS cloud applications</span><span class="sxs-lookup"><span data-stu-id="f7b6b-103">Use Tenant Restrictions to manage access to SaaS cloud applications</span></span>

<span data-ttu-id="f7b6b-104">Large organizations that emphasize security want to move to cloud services like Office 365, but need to know that their users only can access approved resources.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-104">Large organizations that emphasize security want to move to cloud services like Office 365, but need to know that their users only can access approved resources.</span></span> <span data-ttu-id="f7b6b-105">Traditionally, companies restrict domain names or IP addresses when they want to manage access.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-105">Traditionally, companies restrict domain names or IP addresses when they want to manage access.</span></span> <span data-ttu-id="f7b6b-106">This approach fails in a world where SaaS apps are hosted in a public cloud, running on shared domain names like outlook.office.com and login.microsoftonline.com.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-106">This approach fails in a world where SaaS apps are hosted in a public cloud, running on shared domain names like outlook.office.com and login.microsoftonline.com.</span></span> <span data-ttu-id="f7b6b-107">Blocking these addresses would keep users from accessing Outlook on the web entirely, instead of merely restricting them to approved identities and resources.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-107">Blocking these addresses would keep users from accessing Outlook on the web entirely, instead of merely restricting them to approved identities and resources.</span></span>

<span data-ttu-id="f7b6b-108">Azure Active Directory's solution to this challenge is a feature called Tenant Restrictions.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-108">Azure Active Directory's solution to this challenge is a feature called Tenant Restrictions.</span></span> <span data-ttu-id="f7b6b-109">Tenant Restrictions enables organizations to control access to SaaS cloud applications, based on the Azure AD tenant the applications use for single sign-on.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-109">Tenant Restrictions enables organizations to control access to SaaS cloud applications, based on the Azure AD tenant the applications use for single sign-on.</span></span> <span data-ttu-id="f7b6b-110">For example, you may want to allow access to your organization’s Office 365 applications, while preventing access to other organizations’ instances of these same applications.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-110">For example, you may want to allow access to your organization’s Office 365 applications, while preventing access to other organizations’ instances of these same applications.</span></span>  

<span data-ttu-id="f7b6b-111">Tenant Restrictions gives organizations the ability to specify the list of tenants that their users are permitted to access.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-111">Tenant Restrictions gives organizations the ability to specify the list of tenants that their users are permitted to access.</span></span> <span data-ttu-id="f7b6b-112">Azure AD then only grants access to these permitted tenants.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-112">Azure AD then only grants access to these permitted tenants.</span></span>

<span data-ttu-id="f7b6b-113">This article focuses on Tenant Restrictions for Office 365, but the feature should work with any SaaS cloud app that uses modern authentication protocols with Azure AD for single sign-on.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-113">This article focuses on Tenant Restrictions for Office 365, but the feature should work with any SaaS cloud app that uses modern authentication protocols with Azure AD for single sign-on.</span></span> <span data-ttu-id="f7b6b-114">If you use SaaS apps with a different Azure AD tenant from the tenant used by Office 365, make sure that all required tenants are permitted.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-114">If you use SaaS apps with a different Azure AD tenant from the tenant used by Office 365, make sure that all required tenants are permitted.</span></span> <span data-ttu-id="f7b6b-115">For more information about SaaS cloud apps, see the [Active Directory Marketplace](https://azure.microsoft.com/marketplace/active-directory/).</span><span class="sxs-lookup"><span data-stu-id="f7b6b-115">For more information about SaaS cloud apps, see the [Active Directory Marketplace](https://azure.microsoft.com/marketplace/active-directory/).</span></span>

## <a name="how-it-works"></a><span data-ttu-id="f7b6b-116">How it works</span><span class="sxs-lookup"><span data-stu-id="f7b6b-116">How it works</span></span>

<span data-ttu-id="f7b6b-117">The overall solution comprises the following components:</span><span class="sxs-lookup"><span data-stu-id="f7b6b-117">The overall solution comprises the following components:</span></span> 

1. <span data-ttu-id="f7b6b-118">**Azure AD** – If the `Restrict-Access-To-Tenants: <permitted tenant list>` is present, Azure AD only issues security tokens for the permitted tenants.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-118">**Azure AD** – If the `Restrict-Access-To-Tenants: <permitted tenant list>` is present, Azure AD only issues security tokens for the permitted tenants.</span></span> 

2. <span data-ttu-id="f7b6b-119">**On-premises proxy server infrastructure** – a proxy device capable of SSL inspection, configured to insert the header containing the list of permitted tenants into traffic destined for Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-119">**On-premises proxy server infrastructure** – a proxy device capable of SSL inspection, configured to insert the header containing the list of permitted tenants into traffic destined for Azure AD.</span></span> 

3. <span data-ttu-id="f7b6b-120">**Client software** – to support Tenant Restrictions, client software must request tokens directly from Azure AD, so that traffic can be intercepted by the proxy infrastructure.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-120">**Client software** – to support Tenant Restrictions, client software must request tokens directly from Azure AD, so that traffic can be intercepted by the proxy infrastructure.</span></span> <span data-ttu-id="f7b6b-121">Tenant Restrictions is currently supported by browser-based Office 365 applications and by Office clients when modern authentication (like OAuth 2.0) is used.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-121">Tenant Restrictions is currently supported by browser-based Office 365 applications and by Office clients when modern authentication (like OAuth 2.0) is used.</span></span> 

4. <span data-ttu-id="f7b6b-122">**Modern Authentication** – cloud services must use modern authentication to use Tenant Restrictions and block access to all non-permitted tenants.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-122">**Modern Authentication** – cloud services must use modern authentication to use Tenant Restrictions and block access to all non-permitted tenants.</span></span> <span data-ttu-id="f7b6b-123">Office 365 cloud services must be configured to use modern authentication protocols by default.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-123">Office 365 cloud services must be configured to use modern authentication protocols by default.</span></span> <span data-ttu-id="f7b6b-124">For the latest information on Office 365 support for modern authentication, read [Updated Office 365 modern authentication](https://blogs.office.com/2015/11/19/updated-office-365-modern-authentication-public-preview/).</span><span class="sxs-lookup"><span data-stu-id="f7b6b-124">For the latest information on Office 365 support for modern authentication, read [Updated Office 365 modern authentication](https://blogs.office.com/2015/11/19/updated-office-365-modern-authentication-public-preview/).</span></span>

<span data-ttu-id="f7b6b-125">The following diagram illustrates the high-level traffic flow.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-125">The following diagram illustrates the high-level traffic flow.</span></span> <span data-ttu-id="f7b6b-126">SSL inspection is only required on traffic to Azure AD, not to the Office 365 cloud services.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-126">SSL inspection is only required on traffic to Azure AD, not to the Office 365 cloud services.</span></span> <span data-ttu-id="f7b6b-127">This distinction is important because the traffic volume for authentication to Azure AD is typically much lower than traffic volume to SaaS applications like Exchange Online and SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-127">This distinction is important because the traffic volume for authentication to Azure AD is typically much lower than traffic volume to SaaS applications like Exchange Online and SharePoint Online.</span></span>

![Tenant Restrictions traffic flow - diagram](./media/tenant-restrictions/traffic-flow.png)

## <a name="set-up-tenant-restrictions"></a><span data-ttu-id="f7b6b-129">Set up Tenant Restrictions</span><span class="sxs-lookup"><span data-stu-id="f7b6b-129">Set up Tenant Restrictions</span></span>

<span data-ttu-id="f7b6b-130">There are two steps to get started with Tenant Restrictions.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-130">There are two steps to get started with Tenant Restrictions.</span></span> <span data-ttu-id="f7b6b-131">The first step is to make sure that your clients can connect to the right addresses.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-131">The first step is to make sure that your clients can connect to the right addresses.</span></span> <span data-ttu-id="f7b6b-132">The second is to configure your proxy infrastructure.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-132">The second is to configure your proxy infrastructure.</span></span>

### <a name="urls-and-ip-addresses"></a><span data-ttu-id="f7b6b-133">URLs and IP addresses</span><span class="sxs-lookup"><span data-stu-id="f7b6b-133">URLs and IP addresses</span></span>

<span data-ttu-id="f7b6b-134">To use Tenant Restrictions, your clients must be able to connect to the following Azure AD URLs to authenticate: login.microsoftonline.com, login.microsoft.com, and login.windows.net.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-134">To use Tenant Restrictions, your clients must be able to connect to the following Azure AD URLs to authenticate: login.microsoftonline.com, login.microsoft.com, and login.windows.net.</span></span> <span data-ttu-id="f7b6b-135">Additionally, to access Office 365, your clients must also be able to connect to the FQDNs/URLs and IP addresses defined in [Office 365 URLs and IP address ranges](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2).</span><span class="sxs-lookup"><span data-stu-id="f7b6b-135">Additionally, to access Office 365, your clients must also be able to connect to the FQDNs/URLs and IP addresses defined in [Office 365 URLs and IP address ranges](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2).</span></span> 

### <a name="proxy-configuration-and-requirements"></a><span data-ttu-id="f7b6b-136">Proxy configuration and requirements</span><span class="sxs-lookup"><span data-stu-id="f7b6b-136">Proxy configuration and requirements</span></span>

<span data-ttu-id="f7b6b-137">The following configuration is required to enable Tenant Restrictions through your proxy infrastructure.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-137">The following configuration is required to enable Tenant Restrictions through your proxy infrastructure.</span></span> <span data-ttu-id="f7b6b-138">This guidance is generic, so you should refer to your proxy vendor’s documentation for specific implementation steps.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-138">This guidance is generic, so you should refer to your proxy vendor’s documentation for specific implementation steps.</span></span>

#### <a name="prerequisites"></a><span data-ttu-id="f7b6b-139">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="f7b6b-139">Prerequisites</span></span>

- <span data-ttu-id="f7b6b-140">The proxy must be able to perform SSL interception, HTTP header insertion, and filter destinations using FQDNs/URLs.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-140">The proxy must be able to perform SSL interception, HTTP header insertion, and filter destinations using FQDNs/URLs.</span></span> 

- <span data-ttu-id="f7b6b-141">Clients must trust the certificate chain presented by the proxy for SSL communications.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-141">Clients must trust the certificate chain presented by the proxy for SSL communications.</span></span> <span data-ttu-id="f7b6b-142">For example, if certificates from an internal PKI are used, the internal issuing root certificate authority certificate must be trusted.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-142">For example, if certificates from an internal PKI are used, the internal issuing root certificate authority certificate must be trusted.</span></span>

- <span data-ttu-id="f7b6b-143">This feature is included in Office 365 subscriptions, but if you want to use Tenant Restrictions to control access to other SaaS apps then Azure AD Premium 1 licenses are required.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-143">This feature is included in Office 365 subscriptions, but if you want to use Tenant Restrictions to control access to other SaaS apps then Azure AD Premium 1 licenses are required.</span></span>

#### <a name="configuration"></a><span data-ttu-id="f7b6b-144">Configuration</span><span class="sxs-lookup"><span data-stu-id="f7b6b-144">Configuration</span></span>

<span data-ttu-id="f7b6b-145">For each incoming request to login.microsoftonline.com, login.microsoft.com, and login.windows.net, insert two HTTP headers: *Restrict-Access-To-Tenants* and *Restrict-Access-Context*.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-145">For each incoming request to login.microsoftonline.com, login.microsoft.com, and login.windows.net, insert two HTTP headers: *Restrict-Access-To-Tenants* and *Restrict-Access-Context*.</span></span>

<span data-ttu-id="f7b6b-146">The headers should include the following elements:</span><span class="sxs-lookup"><span data-stu-id="f7b6b-146">The headers should include the following elements:</span></span> 
- <span data-ttu-id="f7b6b-147">For *Restrict-Access-To-Tenants*, a value of \<permitted tenant list\>, which is a comma-separated list of tenants you want to allow users to access.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-147">For *Restrict-Access-To-Tenants*, a value of \<permitted tenant list\>, which is a comma-separated list of tenants you want to allow users to access.</span></span> <span data-ttu-id="f7b6b-148">Any domain that is registered with a tenant can be used to identify the tenant in this list.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-148">Any domain that is registered with a tenant can be used to identify the tenant in this list.</span></span> <span data-ttu-id="f7b6b-149">For example, to permit access to both Contoso and Fabrikam tenants, the name/value pair looks like:  `Restrict-Access-To-Tenants: contoso.onmicrosoft.com,fabrikam.onmicrosoft.com`</span><span class="sxs-lookup"><span data-stu-id="f7b6b-149">For example, to permit access to both Contoso and Fabrikam tenants, the name/value pair looks like:  `Restrict-Access-To-Tenants: contoso.onmicrosoft.com,fabrikam.onmicrosoft.com`</span></span> 
- <span data-ttu-id="f7b6b-150">For *Restrict-Access-Context*, a value of a single directory ID, declaring which tenant is setting the Tenant Restrictions.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-150">For *Restrict-Access-Context*, a value of a single directory ID, declaring which tenant is setting the Tenant Restrictions.</span></span> <span data-ttu-id="f7b6b-151">For example, to declare Contoso as the tenant that set the Tenant Restrictions policy, the name/value pair looks like: `Restrict-Access-Context: 456ff232-35l2-5h23-b3b3-3236w0826f3d`</span><span class="sxs-lookup"><span data-stu-id="f7b6b-151">For example, to declare Contoso as the tenant that set the Tenant Restrictions policy, the name/value pair looks like: `Restrict-Access-Context: 456ff232-35l2-5h23-b3b3-3236w0826f3d`</span></span>  

> [!TIP]
> <span data-ttu-id="f7b6b-152">You can find your directory ID in the [Azure portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="f7b6b-152">You can find your directory ID in the [Azure portal](https://portal.azure.com).</span></span> <span data-ttu-id="f7b6b-153">Sign in as an administrator, select **Azure Active Directory**, then select **Properties**.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-153">Sign in as an administrator, select **Azure Active Directory**, then select **Properties**.</span></span>

<span data-ttu-id="f7b6b-154">To prevent users from inserting their own HTTP header with non-approved tenants, the proxy needs to replace the Restrict-Access-To-Tenants header if it is already present in the incoming request.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-154">To prevent users from inserting their own HTTP header with non-approved tenants, the proxy needs to replace the Restrict-Access-To-Tenants header if it is already present in the incoming request.</span></span> 

<span data-ttu-id="f7b6b-155">Clients must be forced to use the proxy for all requests to login.microsoftonline.com, login.microsoft.com, and login.windows.net.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-155">Clients must be forced to use the proxy for all requests to login.microsoftonline.com, login.microsoft.com, and login.windows.net.</span></span> <span data-ttu-id="f7b6b-156">For example, if PAC files are used to direct clients to use the proxy, end users should not be able to edit or disable the PAC files.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-156">For example, if PAC files are used to direct clients to use the proxy, end users should not be able to edit or disable the PAC files.</span></span>

## <a name="the-user-experience"></a><span data-ttu-id="f7b6b-157">The user experience</span><span class="sxs-lookup"><span data-stu-id="f7b6b-157">The user experience</span></span>

<span data-ttu-id="f7b6b-158">This section shows the experience for both end users and admins.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-158">This section shows the experience for both end users and admins.</span></span>

### <a name="end-user-experience"></a><span data-ttu-id="f7b6b-159">End-user experience</span><span class="sxs-lookup"><span data-stu-id="f7b6b-159">End-user experience</span></span>

<span data-ttu-id="f7b6b-160">An example user is on the Contoso network, but is trying to access the Fabrikam instance of a shared SaaS application like Outlook online.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-160">An example user is on the Contoso network, but is trying to access the Fabrikam instance of a shared SaaS application like Outlook online.</span></span> <span data-ttu-id="f7b6b-161">If Contoso is a non-permitted tenant for that instance, the user sees the following page:</span><span class="sxs-lookup"><span data-stu-id="f7b6b-161">If Contoso is a non-permitted tenant for that instance, the user sees the following page:</span></span>

![Access denied page for users in non-permitted tenants](./media/tenant-restrictions/end-user-denied.png)

### <a name="admin-experience"></a><span data-ttu-id="f7b6b-163">Admin experience</span><span class="sxs-lookup"><span data-stu-id="f7b6b-163">Admin experience</span></span>

<span data-ttu-id="f7b6b-164">While configuration of Tenant Restrictions is done on the corporate proxy infrastructure, admins can access the Tenant Restrictions reports in the Azure portal directly.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-164">While configuration of Tenant Restrictions is done on the corporate proxy infrastructure, admins can access the Tenant Restrictions reports in the Azure portal directly.</span></span> <span data-ttu-id="f7b6b-165">To view the reports, go to the Azure Active Directory Overview page, then look under ‘Other capabilities’.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-165">To view the reports, go to the Azure Active Directory Overview page, then look under ‘Other capabilities’.</span></span>

<span data-ttu-id="f7b6b-166">The admin for the tenant specified as the Restricted-Access-Context tenant can use this report to see sign-ins blocked because of the Tenant Restrictions policy, including the identity used and the target directory ID.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-166">The admin for the tenant specified as the Restricted-Access-Context tenant can use this report to see sign-ins blocked because of the Tenant Restrictions policy, including the identity used and the target directory ID.</span></span> <span data-ttu-id="f7b6b-167">Sign-ins are included if the tenant setting the restriction is either the user tenant or resource tenant for the sign-in.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-167">Sign-ins are included if the tenant setting the restriction is either the user tenant or resource tenant for the sign-in.</span></span>

![Use the Azure portal to view restricted sign-in attempts](./media/tenant-restrictions/portal-report.png)

<span data-ttu-id="f7b6b-169">Like other reports in the Azure portal, you can use filters to specify the scope of your report.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-169">Like other reports in the Azure portal, you can use filters to specify the scope of your report.</span></span> <span data-ttu-id="f7b6b-170">You can filter on a specific user, application, client, or time interval.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-170">You can filter on a specific user, application, client, or time interval.</span></span>

## <a name="office-365-support"></a><span data-ttu-id="f7b6b-171">Office 365 support</span><span class="sxs-lookup"><span data-stu-id="f7b6b-171">Office 365 support</span></span>

<span data-ttu-id="f7b6b-172">Office 365 applications must meet two criteria to fully support Tenant Restrictions:</span><span class="sxs-lookup"><span data-stu-id="f7b6b-172">Office 365 applications must meet two criteria to fully support Tenant Restrictions:</span></span>

1. <span data-ttu-id="f7b6b-173">The client used supports modern authentication</span><span class="sxs-lookup"><span data-stu-id="f7b6b-173">The client used supports modern authentication</span></span>
2. <span data-ttu-id="f7b6b-174">Modern authentication is enabled as the default authentication protocol for the cloud service.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-174">Modern authentication is enabled as the default authentication protocol for the cloud service.</span></span>

<span data-ttu-id="f7b6b-175">Refer to [Updated Office 365 modern authentication](https://blogs.office.com/2015/11/19/updated-office-365-modern-authentication-public-preview/) for the latest information on which Office clients currently support modern authentication.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-175">Refer to [Updated Office 365 modern authentication](https://blogs.office.com/2015/11/19/updated-office-365-modern-authentication-public-preview/) for the latest information on which Office clients currently support modern authentication.</span></span> <span data-ttu-id="f7b6b-176">That page also includes links to instructions for enabling modern authentication on specific Exchange Online and Skype for Business Online tenants.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-176">That page also includes links to instructions for enabling modern authentication on specific Exchange Online and Skype for Business Online tenants.</span></span> <span data-ttu-id="f7b6b-177">Modern authentication is already enabled by default in SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-177">Modern authentication is already enabled by default in SharePoint Online.</span></span>

<span data-ttu-id="f7b6b-178">Tenant Restrictions is currently supported by Office 365 browser-based applications (the Office Portal, Yammer, SharePoint sites, Outlook on the Web, etc.).</span><span class="sxs-lookup"><span data-stu-id="f7b6b-178">Tenant Restrictions is currently supported by Office 365 browser-based applications (the Office Portal, Yammer, SharePoint sites, Outlook on the Web, etc.).</span></span> <span data-ttu-id="f7b6b-179">For thick clients (Outlook, Skype for Business, Word, Excel, PowerPoint, etc.) Tenant Restrictions can only be enforced when modern authentication is used.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-179">For thick clients (Outlook, Skype for Business, Word, Excel, PowerPoint, etc.) Tenant Restrictions can only be enforced when modern authentication is used.</span></span>  

<span data-ttu-id="f7b6b-180">Outlook and Skype for Business clients that support modern authentication may still able to use legacy protocols against tenants where modern authentication is not enabled, effectively bypassing Tenant Restrictions.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-180">Outlook and Skype for Business clients that support modern authentication may still able to use legacy protocols against tenants where modern authentication is not enabled, effectively bypassing Tenant Restrictions.</span></span> <span data-ttu-id="f7b6b-181">Applications that use legacy protocols may be blocked by Tenant Restrictions if they contact login.microsoftonline.com, login.microsoft.com, or login.windows.net during authentication.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-181">Applications that use legacy protocols may be blocked by Tenant Restrictions if they contact login.microsoftonline.com, login.microsoft.com, or login.windows.net during authentication.</span></span>

<span data-ttu-id="f7b6b-182">For Outlook on Windows, customers may choose to implement restrictions preventing end users from adding non-approved mail accounts to their profiles.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-182">For Outlook on Windows, customers may choose to implement restrictions preventing end users from adding non-approved mail accounts to their profiles.</span></span> <span data-ttu-id="f7b6b-183">For example, see the [Prevent adding non-default Exchange accounts](http://gpsearch.azurewebsites.net/default.aspx?ref=1) group policy setting.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-183">For example, see the [Prevent adding non-default Exchange accounts](http://gpsearch.azurewebsites.net/default.aspx?ref=1) group policy setting.</span></span>

## <a name="testing"></a><span data-ttu-id="f7b6b-184">Testing</span><span class="sxs-lookup"><span data-stu-id="f7b6b-184">Testing</span></span>

<span data-ttu-id="f7b6b-185">If you want to try out Tenant Restrictions before implementing it for your whole organization, there are two options: a host-based approach using a tool like Fiddler, or a staged rollout of proxy settings.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-185">If you want to try out Tenant Restrictions before implementing it for your whole organization, there are two options: a host-based approach using a tool like Fiddler, or a staged rollout of proxy settings.</span></span>

### <a name="fiddler-for-a-host-based-approach"></a><span data-ttu-id="f7b6b-186">Fiddler for a host-based approach</span><span class="sxs-lookup"><span data-stu-id="f7b6b-186">Fiddler for a host-based approach</span></span>

<span data-ttu-id="f7b6b-187">Fiddler is a free web debugging proxy that can be used to capture and modify HTTP/HTTPS traffic, including inserting HTTP headers.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-187">Fiddler is a free web debugging proxy that can be used to capture and modify HTTP/HTTPS traffic, including inserting HTTP headers.</span></span> <span data-ttu-id="f7b6b-188">To configure Fiddler to test Tenant Restrictions, perform the following steps:</span><span class="sxs-lookup"><span data-stu-id="f7b6b-188">To configure Fiddler to test Tenant Restrictions, perform the following steps:</span></span>

1.  <span data-ttu-id="f7b6b-189">[Download and install Fiddler](http://www.telerik.com/fiddler).</span><span class="sxs-lookup"><span data-stu-id="f7b6b-189">[Download and install Fiddler](http://www.telerik.com/fiddler).</span></span>
2.  <span data-ttu-id="f7b6b-190">Configure Fiddler to decrypt HTTPS traffic, per [Fiddler’s help documentation](http://docs.telerik.com/fiddler/Configure-Fiddler/Tasks/DecryptHTTPS).</span><span class="sxs-lookup"><span data-stu-id="f7b6b-190">Configure Fiddler to decrypt HTTPS traffic, per [Fiddler’s help documentation](http://docs.telerik.com/fiddler/Configure-Fiddler/Tasks/DecryptHTTPS).</span></span>
3.  <span data-ttu-id="f7b6b-191">Configure Fiddler to insert the *Restrict-Access-To-Tenants* and *Restrict-Access-Context* headers using custom rules:</span><span class="sxs-lookup"><span data-stu-id="f7b6b-191">Configure Fiddler to insert the *Restrict-Access-To-Tenants* and *Restrict-Access-Context* headers using custom rules:</span></span>
  1. <span data-ttu-id="f7b6b-192">In the Fiddler Web Debugger tool, select the **Rules** menu and select **Customize Rules…**</span><span class="sxs-lookup"><span data-stu-id="f7b6b-192">In the Fiddler Web Debugger tool, select the **Rules** menu and select **Customize Rules…**</span></span> <span data-ttu-id="f7b6b-193">to open the CustomRules file.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-193">to open the CustomRules file.</span></span>
  2. <span data-ttu-id="f7b6b-194">Add the following lines at the beginning of the *OnBeforeRequest* function.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-194">Add the following lines at the beginning of the *OnBeforeRequest* function.</span></span> <span data-ttu-id="f7b6b-195">Replace \<tenant domain\> with a domain registered with your tenant, for example, contoso.onmicrosoft.com.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-195">Replace \<tenant domain\> with a domain registered with your tenant, for example, contoso.onmicrosoft.com.</span></span> <span data-ttu-id="f7b6b-196">Replace \<directory ID\> with your tenant's Azure AD GUID identifier.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-196">Replace \<directory ID\> with your tenant's Azure AD GUID identifier.</span></span>

  ```
  if (oSession.HostnameIs("login.microsoftonline.com") || oSession.HostnameIs("login.microsoft.com") || oSession.HostnameIs("login.windows.net")){      oSession.oRequest["Restrict-Access-To-Tenants"] = "<tenant domain>";      oSession.oRequest["Restrict-Access-Context"] = "<directory ID>";}
  ```

  <span data-ttu-id="f7b6b-197">If you need to allow multiple tenants, use a comma to separate the tenant names.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-197">If you need to allow multiple tenants, use a comma to separate the tenant names.</span></span> <span data-ttu-id="f7b6b-198">For example:</span><span class="sxs-lookup"><span data-stu-id="f7b6b-198">For example:</span></span>

  ```
  oSession.oRequest["Restrict-Access-To-Tenants"] = "contoso.onmicrosoft.com,fabrikam.onmicrosoft.com";
  ```

4. <span data-ttu-id="f7b6b-199">Save and close the CustomRules file.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-199">Save and close the CustomRules file.</span></span>

<span data-ttu-id="f7b6b-200">After you configure Fiddler, you can capture traffic by going to the **File** menu and selecting **Capture Traffic**.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-200">After you configure Fiddler, you can capture traffic by going to the **File** menu and selecting **Capture Traffic**.</span></span>

### <a name="staged-rollout-of-proxy-settings"></a><span data-ttu-id="f7b6b-201">Staged rollout of proxy settings</span><span class="sxs-lookup"><span data-stu-id="f7b6b-201">Staged rollout of proxy settings</span></span>

<span data-ttu-id="f7b6b-202">Depending on the capabilities of your proxy infrastructure, you may be able to stage the rollout of settings to your users.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-202">Depending on the capabilities of your proxy infrastructure, you may be able to stage the rollout of settings to your users.</span></span> <span data-ttu-id="f7b6b-203">Here are a couple high-level options for consideration:</span><span class="sxs-lookup"><span data-stu-id="f7b6b-203">Here are a couple high-level options for consideration:</span></span>

1.  <span data-ttu-id="f7b6b-204">Use PAC files to point test users to a test proxy infrastructure, while normal users continue to use the production proxy infrastructure.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-204">Use PAC files to point test users to a test proxy infrastructure, while normal users continue to use the production proxy infrastructure.</span></span>
2.  <span data-ttu-id="f7b6b-205">Some proxy servers may support different configurations using groups.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-205">Some proxy servers may support different configurations using groups.</span></span>

<span data-ttu-id="f7b6b-206">Refer to your proxy server documentation for specific details.</span><span class="sxs-lookup"><span data-stu-id="f7b6b-206">Refer to your proxy server documentation for specific details.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f7b6b-207">Next steps</span><span class="sxs-lookup"><span data-stu-id="f7b6b-207">Next steps</span></span>

- <span data-ttu-id="f7b6b-208">Read about [Updated Office 365 modern authentication](https://blogs.office.com/2015/11/19/updated-office-365-modern-authentication-public-preview/)</span><span class="sxs-lookup"><span data-stu-id="f7b6b-208">Read about [Updated Office 365 modern authentication](https://blogs.office.com/2015/11/19/updated-office-365-modern-authentication-public-preview/)</span></span>

- <span data-ttu-id="f7b6b-209">Review the [Office 365 URLs and IP address ranges](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2)</span><span class="sxs-lookup"><span data-stu-id="f7b6b-209">Review the [Office 365 URLs and IP address ranges](https://support.office.com/article/Office-365-URLs-and-IP-address-ranges-8548a211-3fe7-47cb-abb1-355ea5aa88a2)</span></span>
