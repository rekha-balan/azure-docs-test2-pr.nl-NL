---
title: Azure Automation Hybrid Runbook Workers | Microsoft Docs
description: This article provides information on installing and using Hybrid Runbook Worker which is a feature of Azure Automation that allows you to run runbooks on machines in your local data center.
services: automation
documentationcenter: ''
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: 06227cda-f3d1-47fe-b3f8-436d2b9d81ee
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/31/2017
ms.author: bwren
ms.openlocfilehash: b4046cebd96002174aec1f6648de1698a9f13a09
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44556173"
---
# <a name="automate-resources-in-your-data-center-with-hybrid-runbook-worker"></a><span data-ttu-id="ea15e-103">Automate resources in your data center with Hybrid Runbook Worker</span><span class="sxs-lookup"><span data-stu-id="ea15e-103">Automate resources in your data center with Hybrid Runbook Worker</span></span>
<span data-ttu-id="ea15e-104">Runbooks in Azure Automation cannot access resources in your local data center since they run in the Azure cloud.</span><span class="sxs-lookup"><span data-stu-id="ea15e-104">Runbooks in Azure Automation cannot access resources in your local data center since they run in the Azure cloud.</span></span>  <span data-ttu-id="ea15e-105">The Hybrid Runbook Worker feature of Azure Automation allows you to run runbooks on machines located in your data center to manage local resources.</span><span class="sxs-lookup"><span data-stu-id="ea15e-105">The Hybrid Runbook Worker feature of Azure Automation allows you to run runbooks on machines located in your data center to manage local resources.</span></span> <span data-ttu-id="ea15e-106">The runbooks are stored and managed in Azure Automation and then delivered to one or more on-premises machines.</span><span class="sxs-lookup"><span data-stu-id="ea15e-106">The runbooks are stored and managed in Azure Automation and then delivered to one or more on-premises machines.</span></span>  

<span data-ttu-id="ea15e-107">This functionality is illustrated in the following image:</span><span class="sxs-lookup"><span data-stu-id="ea15e-107">This functionality is illustrated in the following image:</span></span><br>  

![Hybrid Runbook Worker Overview](https://docstestmedia1.blob.core.windows.net/azure-media/articles/automation/media/automation-hybrid-runbook-worker/automation.png)

<span data-ttu-id="ea15e-109">You can designate one or more computers in your data center to act as a Hybrid Runbook Worker and run runbooks from Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="ea15e-109">You can designate one or more computers in your data center to act as a Hybrid Runbook Worker and run runbooks from Azure Automation.</span></span>  <span data-ttu-id="ea15e-110">Each worker requires the Microsoft Management Agent with a connection to Microsoft Operations Management Suite and the Azure Automation runbook environment.</span><span class="sxs-lookup"><span data-stu-id="ea15e-110">Each worker requires the Microsoft Management Agent with a connection to Microsoft Operations Management Suite and the Azure Automation runbook environment.</span></span>  <span data-ttu-id="ea15e-111">Operations Management Suite is only used to install and maintain the management agent and to monitor the functionality of the worker.</span><span class="sxs-lookup"><span data-stu-id="ea15e-111">Operations Management Suite is only used to install and maintain the management agent and to monitor the functionality of the worker.</span></span>  <span data-ttu-id="ea15e-112">The delivery of runbooks and the instruction to run them are performed by Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="ea15e-112">The delivery of runbooks and the instruction to run them are performed by Azure Automation.</span></span>

<span data-ttu-id="ea15e-113">There are no inbound firewall requirements to support Hybrid Runbook Workers.</span><span class="sxs-lookup"><span data-stu-id="ea15e-113">There are no inbound firewall requirements to support Hybrid Runbook Workers.</span></span> <span data-ttu-id="ea15e-114">The agent on the local computer initiates all communication with Azure Automation in the cloud.</span><span class="sxs-lookup"><span data-stu-id="ea15e-114">The agent on the local computer initiates all communication with Azure Automation in the cloud.</span></span> <span data-ttu-id="ea15e-115">When a runbook is started, Azure Automation creates an instruction that is retrieved by agent.</span><span class="sxs-lookup"><span data-stu-id="ea15e-115">When a runbook is started, Azure Automation creates an instruction that is retrieved by agent.</span></span> <span data-ttu-id="ea15e-116">The agent then pulls down the runbook and any parameters before running it.</span><span class="sxs-lookup"><span data-stu-id="ea15e-116">The agent then pulls down the runbook and any parameters before running it.</span></span>  <span data-ttu-id="ea15e-117">It also retrieves [assets](http://msdn.microsoft.com/library/dn939988.aspx) that are used by the runbook from Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="ea15e-117">It also retrieves [assets](http://msdn.microsoft.com/library/dn939988.aspx) that are used by the runbook from Azure Automation.</span></span>

> [!NOTE]
> <span data-ttu-id="ea15e-118">To manage the configuration of your servers supporting the Hybrid Runbook Worker role with Desired State Configuration (DSC), you need to add them as DSC nodes.</span><span class="sxs-lookup"><span data-stu-id="ea15e-118">To manage the configuration of your servers supporting the Hybrid Runbook Worker role with Desired State Configuration (DSC), you need to add them as DSC nodes.</span></span>  <span data-ttu-id="ea15e-119">For more information about onboarding them for management with DSC, see [Onboarding machines for management by Azure Automation DSC](automation-dsc-onboarding.md).</span><span class="sxs-lookup"><span data-stu-id="ea15e-119">For more information about onboarding them for management with DSC, see [Onboarding machines for management by Azure Automation DSC](automation-dsc-onboarding.md).</span></span>           
><br>
><span data-ttu-id="ea15e-120">If you enable the [Update Management solution](../operations-management-suite/oms-solution-update-management.md), any Windows computer connected to your OMS workspace is  automatically configured as a Hybrid Runbook Worker to support runbooks included in this solution.</span><span class="sxs-lookup"><span data-stu-id="ea15e-120">If you enable the [Update Management solution](../operations-management-suite/oms-solution-update-management.md), any Windows computer connected to your OMS workspace is  automatically configured as a Hybrid Runbook Worker to support runbooks included in this solution.</span></span>  <span data-ttu-id="ea15e-121">However, it is not registered with any Hybrid Worker groups already defined in your Automation account.</span><span class="sxs-lookup"><span data-stu-id="ea15e-121">However, it is not registered with any Hybrid Worker groups already defined in your Automation account.</span></span>  <span data-ttu-id="ea15e-122">The computer can be added to a Hybrid Runbook Worker group in your Automation account to support Automation runbooks as long as you are using the same account for both the solution and Hybrid Runbook Worker group membership.</span><span class="sxs-lookup"><span data-stu-id="ea15e-122">The computer can be added to a Hybrid Runbook Worker group in your Automation account to support Automation runbooks as long as you are using the same account for both the solution and Hybrid Runbook Worker group membership.</span></span>  <span data-ttu-id="ea15e-123">This functionality has been added to version 7.2.12024.0 of the Hybrid Runbook Worker.</span><span class="sxs-lookup"><span data-stu-id="ea15e-123">This functionality has been added to version 7.2.12024.0 of the Hybrid Runbook Worker.</span></span>  

## <a name="hybrid-runbook-worker-groups"></a><span data-ttu-id="ea15e-124">Hybrid Runbook Worker groups</span><span class="sxs-lookup"><span data-stu-id="ea15e-124">Hybrid Runbook Worker groups</span></span>
<span data-ttu-id="ea15e-125">Each Hybrid Runbook Worker is a member of a Hybrid Runbook Worker group that you specify when you install the agent.</span><span class="sxs-lookup"><span data-stu-id="ea15e-125">Each Hybrid Runbook Worker is a member of a Hybrid Runbook Worker group that you specify when you install the agent.</span></span>  <span data-ttu-id="ea15e-126">A group can include a single agent, but you can install multiple agents in a group for high availability.</span><span class="sxs-lookup"><span data-stu-id="ea15e-126">A group can include a single agent, but you can install multiple agents in a group for high availability.</span></span>

<span data-ttu-id="ea15e-127">When you start a runbook on a Hybrid Runbook Worker, you specify the group that it runs on.</span><span class="sxs-lookup"><span data-stu-id="ea15e-127">When you start a runbook on a Hybrid Runbook Worker, you specify the group that it runs on.</span></span>  <span data-ttu-id="ea15e-128">The members of the group determine which worker services the request.</span><span class="sxs-lookup"><span data-stu-id="ea15e-128">The members of the group determine which worker services the request.</span></span>  <span data-ttu-id="ea15e-129">You cannot specify a particular worker.</span><span class="sxs-lookup"><span data-stu-id="ea15e-129">You cannot specify a particular worker.</span></span>

## <a name="hybrid-runbook-worker-requirements"></a><span data-ttu-id="ea15e-130">Hybrid Runbook Worker requirements</span><span class="sxs-lookup"><span data-stu-id="ea15e-130">Hybrid Runbook Worker requirements</span></span>
<span data-ttu-id="ea15e-131">You designate at least one on-premises computer to run hybrid runbook jobs.</span><span class="sxs-lookup"><span data-stu-id="ea15e-131">You designate at least one on-premises computer to run hybrid runbook jobs.</span></span>  <span data-ttu-id="ea15e-132">This computer must have the following:</span><span class="sxs-lookup"><span data-stu-id="ea15e-132">This computer must have the following:</span></span>

* <span data-ttu-id="ea15e-133">Windows Server 2012 or later</span><span class="sxs-lookup"><span data-stu-id="ea15e-133">Windows Server 2012 or later</span></span>
* <span data-ttu-id="ea15e-134">Windows PowerShell 4.0 or later.</span><span class="sxs-lookup"><span data-stu-id="ea15e-134">Windows PowerShell 4.0 or later.</span></span>  <span data-ttu-id="ea15e-135">We recommend installing Windows PowerShell 5.0 on the computer for increased reliability.</span><span class="sxs-lookup"><span data-stu-id="ea15e-135">We recommend installing Windows PowerShell 5.0 on the computer for increased reliability.</span></span> <span data-ttu-id="ea15e-136">You can download the latest version from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=50395)</span><span class="sxs-lookup"><span data-stu-id="ea15e-136">You can download the latest version from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=50395)</span></span>
* <span data-ttu-id="ea15e-137">Minimum of 2 cores and 4 GB of RAM</span><span class="sxs-lookup"><span data-stu-id="ea15e-137">Minimum of 2 cores and 4 GB of RAM</span></span>

<span data-ttu-id="ea15e-138">Consider the following recommendations for hybrid workers:</span><span class="sxs-lookup"><span data-stu-id="ea15e-138">Consider the following recommendations for hybrid workers:</span></span>

* <span data-ttu-id="ea15e-139">Designate multiple hybrid workers in each group for high availability.</span><span class="sxs-lookup"><span data-stu-id="ea15e-139">Designate multiple hybrid workers in each group for high availability.</span></span>  
* <span data-ttu-id="ea15e-140">Hybrid workers can coexist with Service Management Automation or System Center Orchestrator runbook servers.</span><span class="sxs-lookup"><span data-stu-id="ea15e-140">Hybrid workers can coexist with Service Management Automation or System Center Orchestrator runbook servers.</span></span>
* <span data-ttu-id="ea15e-141">Consider using a computer physically located in or near the region of your Automation account since the job data is sent back to Azure Automation when a job completes.</span><span class="sxs-lookup"><span data-stu-id="ea15e-141">Consider using a computer physically located in or near the region of your Automation account since the job data is sent back to Azure Automation when a job completes.</span></span>

### <a name="configure-proxy-and-firewall-settings"></a><span data-ttu-id="ea15e-142">Configure proxy and firewall settings</span><span class="sxs-lookup"><span data-stu-id="ea15e-142">Configure proxy and firewall settings</span></span>
<span data-ttu-id="ea15e-143">For the on-premise Hybrid Runbook Worker to connect to and register with the Microsoft Operations Management Suite (OMS) service, it must have access to the port number and the URLs described below.</span><span class="sxs-lookup"><span data-stu-id="ea15e-143">For the on-premise Hybrid Runbook Worker to connect to and register with the Microsoft Operations Management Suite (OMS) service, it must have access to the port number and the URLs described below.</span></span>  <span data-ttu-id="ea15e-144">This is in addition to the [ports and URLs required for the Microsoft Monitoring Agent](../log-analytics/log-analytics-proxy-firewall.md#configure-settings-with-the-microsoft-monitoring-agent) to connect to OMS.</span><span class="sxs-lookup"><span data-stu-id="ea15e-144">This is in addition to the [ports and URLs required for the Microsoft Monitoring Agent](../log-analytics/log-analytics-proxy-firewall.md#configure-settings-with-the-microsoft-monitoring-agent) to connect to OMS.</span></span> <span data-ttu-id="ea15e-145">If you use a proxy server for communication between the agent and the OMS service, you need to ensure that the appropriate resources are accessible.</span><span class="sxs-lookup"><span data-stu-id="ea15e-145">If you use a proxy server for communication between the agent and the OMS service, you need to ensure that the appropriate resources are accessible.</span></span> <span data-ttu-id="ea15e-146">If you use a firewall to restrict access to the Internet, you need to configure your firewall to permit access.</span><span class="sxs-lookup"><span data-stu-id="ea15e-146">If you use a firewall to restrict access to the Internet, you need to configure your firewall to permit access.</span></span>

<span data-ttu-id="ea15e-147">The information below list the port and URLs that are required for the Hybrid Runbook Worker to communicate with Automation.</span><span class="sxs-lookup"><span data-stu-id="ea15e-147">The information below list the port and URLs that are required for the Hybrid Runbook Worker to communicate with Automation.</span></span>

* <span data-ttu-id="ea15e-148">Port:  Only TCP 443 is required for outbound Internet access</span><span class="sxs-lookup"><span data-stu-id="ea15e-148">Port:  Only TCP 443 is required for outbound Internet access</span></span>
* <span data-ttu-id="ea15e-149">Global URL:  \*.azure-automation.net</span><span class="sxs-lookup"><span data-stu-id="ea15e-149">Global URL:  \*.azure-automation.net</span></span>

<span data-ttu-id="ea15e-150">If you have an Automation account defined for a specific region and you want to restrict communication with that regional datacenter, the following table provides the DNS record for each region.</span><span class="sxs-lookup"><span data-stu-id="ea15e-150">If you have an Automation account defined for a specific region and you want to restrict communication with that regional datacenter, the following table provides the DNS record for each region.</span></span>

| <span data-ttu-id="ea15e-151">**Region**</span><span class="sxs-lookup"><span data-stu-id="ea15e-151">**Region**</span></span> | <span data-ttu-id="ea15e-152">**DNS Record**</span><span class="sxs-lookup"><span data-stu-id="ea15e-152">**DNS Record**</span></span> |
| --- | --- |
| <span data-ttu-id="ea15e-153">South Central US</span><span class="sxs-lookup"><span data-stu-id="ea15e-153">South Central US</span></span> |<span data-ttu-id="ea15e-154">scus-jobruntimedata-prod-su1.azure-automation.net</span><span class="sxs-lookup"><span data-stu-id="ea15e-154">scus-jobruntimedata-prod-su1.azure-automation.net</span></span> |
| <span data-ttu-id="ea15e-155">East US 2</span><span class="sxs-lookup"><span data-stu-id="ea15e-155">East US 2</span></span> |<span data-ttu-id="ea15e-156">eus2-jobruntimedata-prod-su1.azure-automation.net</span><span class="sxs-lookup"><span data-stu-id="ea15e-156">eus2-jobruntimedata-prod-su1.azure-automation.net</span></span> |
| <span data-ttu-id="ea15e-157">West Europe</span><span class="sxs-lookup"><span data-stu-id="ea15e-157">West Europe</span></span> |<span data-ttu-id="ea15e-158">we-jobruntimedata-prod-su1.azure-automation.net</span><span class="sxs-lookup"><span data-stu-id="ea15e-158">we-jobruntimedata-prod-su1.azure-automation.net</span></span> |
| <span data-ttu-id="ea15e-159">North Europe</span><span class="sxs-lookup"><span data-stu-id="ea15e-159">North Europe</span></span> |<span data-ttu-id="ea15e-160">ne-jobruntimedata-prod-su1.azure-automation.net</span><span class="sxs-lookup"><span data-stu-id="ea15e-160">ne-jobruntimedata-prod-su1.azure-automation.net</span></span> |
| <span data-ttu-id="ea15e-161">Canada Central</span><span class="sxs-lookup"><span data-stu-id="ea15e-161">Canada Central</span></span> |<span data-ttu-id="ea15e-162">cc-jobruntimedata-prod-su1.azure-automation.net</span><span class="sxs-lookup"><span data-stu-id="ea15e-162">cc-jobruntimedata-prod-su1.azure-automation.net</span></span> |
| <span data-ttu-id="ea15e-163">South East Asia</span><span class="sxs-lookup"><span data-stu-id="ea15e-163">South East Asia</span></span> |<span data-ttu-id="ea15e-164">sea-jobruntimedata-prod-su1.azure-automation.net</span><span class="sxs-lookup"><span data-stu-id="ea15e-164">sea-jobruntimedata-prod-su1.azure-automation.net</span></span> |
| <span data-ttu-id="ea15e-165">Central India</span><span class="sxs-lookup"><span data-stu-id="ea15e-165">Central India</span></span> |<span data-ttu-id="ea15e-166">cid-jobruntimedata-prod-su1.azure-automation.net</span><span class="sxs-lookup"><span data-stu-id="ea15e-166">cid-jobruntimedata-prod-su1.azure-automation.net</span></span> |
| <span data-ttu-id="ea15e-167">Japan East</span><span class="sxs-lookup"><span data-stu-id="ea15e-167">Japan East</span></span> |<span data-ttu-id="ea15e-168">jpe-jobruntimedata-prod-su1.azure-automation.net</span><span class="sxs-lookup"><span data-stu-id="ea15e-168">jpe-jobruntimedata-prod-su1.azure-automation.net</span></span> |
| <span data-ttu-id="ea15e-169">Australia South East</span><span class="sxs-lookup"><span data-stu-id="ea15e-169">Australia South East</span></span> |<span data-ttu-id="ea15e-170">ase-jobruntimedata-prod-su1.azure-automation.net</span><span class="sxs-lookup"><span data-stu-id="ea15e-170">ase-jobruntimedata-prod-su1.azure-automation.net</span></span> |

## <a name="installing-hybrid-runbook-worker"></a><span data-ttu-id="ea15e-171">Installing Hybrid Runbook Worker</span><span class="sxs-lookup"><span data-stu-id="ea15e-171">Installing Hybrid Runbook Worker</span></span>

<span data-ttu-id="ea15e-172">To install and configure a Hybrid Runbook Worker, there are two methods available.</span><span class="sxs-lookup"><span data-stu-id="ea15e-172">To install and configure a Hybrid Runbook Worker, there are two methods available.</span></span>  <span data-ttu-id="ea15e-173">The recommended method is using an Automation runbook to completely automate the process required to configure a Windows computer.</span><span class="sxs-lookup"><span data-stu-id="ea15e-173">The recommended method is using an Automation runbook to completely automate the process required to configure a Windows computer.</span></span>  <span data-ttu-id="ea15e-174">The second method is following a step-by-step procedure to manually install and configure the role.</span><span class="sxs-lookup"><span data-stu-id="ea15e-174">The second method is following a step-by-step procedure to manually install and configure the role.</span></span>  

### <a name="automated-deployment"></a><span data-ttu-id="ea15e-175">Automated deployment</span><span class="sxs-lookup"><span data-stu-id="ea15e-175">Automated deployment</span></span>

<span data-ttu-id="ea15e-176">Perform the following steps to automate the installation and configuration of the Hybrid Worker role.</span><span class="sxs-lookup"><span data-stu-id="ea15e-176">Perform the following steps to automate the installation and configuration of the Hybrid Worker role.</span></span>  

1. <span data-ttu-id="ea15e-177">Download the *New-OnPremiseHybridWorker.ps1* script from the [PowerShell Gallery](https://www.powershellgallery.com/packages/New-OnPremiseHybridWorker/1.0/DisplayScript) directly from the computer running the Hybrid Runbook Worker role or from another computer in your environment and copy it to the worker.</span><span class="sxs-lookup"><span data-stu-id="ea15e-177">Download the *New-OnPremiseHybridWorker.ps1* script from the [PowerShell Gallery](https://www.powershellgallery.com/packages/New-OnPremiseHybridWorker/1.0/DisplayScript) directly from the computer running the Hybrid Runbook Worker role or from another computer in your environment and copy it to the worker.</span></span>  

    <span data-ttu-id="ea15e-178">The *New-OnPremiseHybridWorker.ps1* script requires the following parameters during execution:</span><span class="sxs-lookup"><span data-stu-id="ea15e-178">The *New-OnPremiseHybridWorker.ps1* script requires the following parameters during execution:</span></span>

  * <span data-ttu-id="ea15e-179">*AutomationAccountName* (mandatory) - the name of your Automation account.</span><span class="sxs-lookup"><span data-stu-id="ea15e-179">*AutomationAccountName* (mandatory) - the name of your Automation account.</span></span>  
  * <span data-ttu-id="ea15e-180">*ResourceGroupName* (mandatory) - the name of the resource group associated with your Automation account.</span><span class="sxs-lookup"><span data-stu-id="ea15e-180">*ResourceGroupName* (mandatory) - the name of the resource group associated with your Automation account.</span></span>  
  * <span data-ttu-id="ea15e-181">*HybridGroupName* (mandatory) - the name of a Hybrid Runbook Worker group that you specify as a target for the runbooks supporting this scenario.</span><span class="sxs-lookup"><span data-stu-id="ea15e-181">*HybridGroupName* (mandatory) - the name of a Hybrid Runbook Worker group that you specify as a target for the runbooks supporting this scenario.</span></span> 
  *  <span data-ttu-id="ea15e-182">*SubscriptionID* (mandatory) - the Azure Subscription Id that your Automation account is in.</span><span class="sxs-lookup"><span data-stu-id="ea15e-182">*SubscriptionID* (mandatory) - the Azure Subscription Id that your Automation account is in.</span></span>
  *  <span data-ttu-id="ea15e-183">*WorkspaceName* (optional) - the OMS workspace name.</span><span class="sxs-lookup"><span data-stu-id="ea15e-183">*WorkspaceName* (optional) - the OMS workspace name.</span></span>  <span data-ttu-id="ea15e-184">If you do not have an OMS workspace, the script creates and configures one.</span><span class="sxs-lookup"><span data-stu-id="ea15e-184">If you do not have an OMS workspace, the script creates and configures one.</span></span>  

     > [!NOTE]
     > <span data-ttu-id="ea15e-185">Currently the only Automation regions supported for integration with OMS are - **Australia Southeast**, **East US 2**, **Southeast Asia**, and **West Europe**.</span><span class="sxs-lookup"><span data-stu-id="ea15e-185">Currently the only Automation regions supported for integration with OMS are - **Australia Southeast**, **East US 2**, **Southeast Asia**, and **West Europe**.</span></span>  <span data-ttu-id="ea15e-186">If your Automation account is not in one of those regions, the script creates an OMS workspace but it warns you that it cannot link them together.</span><span class="sxs-lookup"><span data-stu-id="ea15e-186">If your Automation account is not in one of those regions, the script creates an OMS workspace but it warns you that it cannot link them together.</span></span>
     > 
2. <span data-ttu-id="ea15e-187">On your computer, start **Windows PowerShell** from the **Start** screen in Administrator mode.</span><span class="sxs-lookup"><span data-stu-id="ea15e-187">On your computer, start **Windows PowerShell** from the **Start** screen in Administrator mode.</span></span>  
3. <span data-ttu-id="ea15e-188">From the PowerShell command-line shell, navigate to the folder, which contains the script you downloaded and execute it changing the values for parameters *-AutomationAccountName*, *-ResourceGroupName*, *-HybridGroupName*, *-SubscriptionId*, and *-WorkspaceName*.</span><span class="sxs-lookup"><span data-stu-id="ea15e-188">From the PowerShell command-line shell, navigate to the folder, which contains the script you downloaded and execute it changing the values for parameters *-AutomationAccountName*, *-ResourceGroupName*, *-HybridGroupName*, *-SubscriptionId*, and *-WorkspaceName*.</span></span>

     > [!NOTE] 
     > <span data-ttu-id="ea15e-189">You are prompted to authenticate with Azure after you execute the script.</span><span class="sxs-lookup"><span data-stu-id="ea15e-189">You are prompted to authenticate with Azure after you execute the script.</span></span>  <span data-ttu-id="ea15e-190">You **must** sign in with an account that is a member of the Subscription Admins role and co-administrator of the subscription.</span><span class="sxs-lookup"><span data-stu-id="ea15e-190">You **must** sign in with an account that is a member of the Subscription Admins role and co-administrator of the subscription.</span></span>  
     >  
    
        .\New-OnPremiseHybridWorker.ps1 -AutomationAccountName <NameofAutomationAccount> `
        -ResourceGroupName <NameofOResourceGroup> -HybridGroupName <NameofHRWGroup> `
        -SubscriptionId <AzureSubscriptionId> -WorkspaceName <NameOfOMSWorkspace>

4. <span data-ttu-id="ea15e-191">You are prompted to agree to install **NuGet** and you are prompted to authenticate with your Azure credentials.</span><span class="sxs-lookup"><span data-stu-id="ea15e-191">You are prompted to agree to install **NuGet** and you are prompted to authenticate with your Azure credentials.</span></span><br><br> <span data-ttu-id="ea15e-192">![Execution of New-OnPremiseHybridWorker script](https://docstestmedia1.blob.core.windows.net/azure-media/articles/automation/media/automation-hybrid-runbook-worker/new-onpremisehybridworker-scriptoutput.png)</span><span class="sxs-lookup"><span data-stu-id="ea15e-192">![Execution of New-OnPremiseHybridWorker script](https://docstestmedia1.blob.core.windows.net/azure-media/articles/automation/media/automation-hybrid-runbook-worker/new-onpremisehybridworker-scriptoutput.png)</span></span>

5. <span data-ttu-id="ea15e-193">After the script is complete, the Hybrid Worker Groups blade will show the new group and number of members or if an existing group, the number of members is incremented.</span><span class="sxs-lookup"><span data-stu-id="ea15e-193">After the script is complete, the Hybrid Worker Groups blade will show the new group and number of members or if an existing group, the number of members is incremented.</span></span>  <span data-ttu-id="ea15e-194">You can select the group from the list on the **Hybrid Worker Groups** blade and select the **Hybrid Workers** tile.</span><span class="sxs-lookup"><span data-stu-id="ea15e-194">You can select the group from the list on the **Hybrid Worker Groups** blade and select the **Hybrid Workers** tile.</span></span>  <span data-ttu-id="ea15e-195">On the **Hybrid Workers** blade, you see each member of the group listed.</span><span class="sxs-lookup"><span data-stu-id="ea15e-195">On the **Hybrid Workers** blade, you see each member of the group listed.</span></span>  

### <a name="manual-deployment"></a><span data-ttu-id="ea15e-196">Manual deployment</span><span class="sxs-lookup"><span data-stu-id="ea15e-196">Manual deployment</span></span> 
<span data-ttu-id="ea15e-197">Perform the first two steps once for your Automation environment and then repeat the remaining steps for each worker computer.</span><span class="sxs-lookup"><span data-stu-id="ea15e-197">Perform the first two steps once for your Automation environment and then repeat the remaining steps for each worker computer.</span></span>

#### <a name="1-create-operations-management-suite-workspace"></a><span data-ttu-id="ea15e-198">1. Create Operations Management Suite workspace</span><span class="sxs-lookup"><span data-stu-id="ea15e-198">1. Create Operations Management Suite workspace</span></span>
<span data-ttu-id="ea15e-199">If you do not already have an Operations Management Suite workspace, then create one using instructions at [Manage your workspace](../log-analytics/log-analytics-manage-access.md).</span><span class="sxs-lookup"><span data-stu-id="ea15e-199">If you do not already have an Operations Management Suite workspace, then create one using instructions at [Manage your workspace](../log-analytics/log-analytics-manage-access.md).</span></span> <span data-ttu-id="ea15e-200">You can use an existing workspace if you already have one.</span><span class="sxs-lookup"><span data-stu-id="ea15e-200">You can use an existing workspace if you already have one.</span></span>

#### <a name="2-add-automation-solution-to-operations-management-suite-workspace"></a><span data-ttu-id="ea15e-201">2. Add Automation solution to Operations Management Suite workspace</span><span class="sxs-lookup"><span data-stu-id="ea15e-201">2. Add Automation solution to Operations Management Suite workspace</span></span>
<span data-ttu-id="ea15e-202">Solutions add functionality to Operations Management Suite.</span><span class="sxs-lookup"><span data-stu-id="ea15e-202">Solutions add functionality to Operations Management Suite.</span></span>  <span data-ttu-id="ea15e-203">The Automation solution adds functionality for Azure Automation including support for Hybrid Runbook Worker.</span><span class="sxs-lookup"><span data-stu-id="ea15e-203">The Automation solution adds functionality for Azure Automation including support for Hybrid Runbook Worker.</span></span>  <span data-ttu-id="ea15e-204">When you add the solution to your workspace, it automatically pushes down worker components to the agent computer that you will install in the next step.</span><span class="sxs-lookup"><span data-stu-id="ea15e-204">When you add the solution to your workspace, it automatically pushes down worker components to the agent computer that you will install in the next step.</span></span>

<span data-ttu-id="ea15e-205">Follow the instructions at [To add a solution using the Solutions Gallery](../log-analytics/log-analytics-add-solutions.md) to add the **Automation** solution to your Operations Management Suite workspace.</span><span class="sxs-lookup"><span data-stu-id="ea15e-205">Follow the instructions at [To add a solution using the Solutions Gallery](../log-analytics/log-analytics-add-solutions.md) to add the **Automation** solution to your Operations Management Suite workspace.</span></span>

#### <a name="3-install-the-microsoft-monitoring-agent"></a><span data-ttu-id="ea15e-206">3. Install the Microsoft Monitoring Agent</span><span class="sxs-lookup"><span data-stu-id="ea15e-206">3. Install the Microsoft Monitoring Agent</span></span>
<span data-ttu-id="ea15e-207">The Microsoft Monitoring Agent connects computers to Operations Management Suite.</span><span class="sxs-lookup"><span data-stu-id="ea15e-207">The Microsoft Monitoring Agent connects computers to Operations Management Suite.</span></span>  <span data-ttu-id="ea15e-208">When you install the agent on your on-premises computer and connect it to your workspace, it will automatically download the components required for Hybrid Runbook Worker.</span><span class="sxs-lookup"><span data-stu-id="ea15e-208">When you install the agent on your on-premises computer and connect it to your workspace, it will automatically download the components required for Hybrid Runbook Worker.</span></span>

<span data-ttu-id="ea15e-209">Follow the instructions at [Connect Windows computers to Log Analytics](../log-analytics/log-analytics-windows-agents.md) to install the agent on the on-premises computer.</span><span class="sxs-lookup"><span data-stu-id="ea15e-209">Follow the instructions at [Connect Windows computers to Log Analytics](../log-analytics/log-analytics-windows-agents.md) to install the agent on the on-premises computer.</span></span>  <span data-ttu-id="ea15e-210">You can repeat this process for multiple computers to add multiple workers to your environment.</span><span class="sxs-lookup"><span data-stu-id="ea15e-210">You can repeat this process for multiple computers to add multiple workers to your environment.</span></span>

<span data-ttu-id="ea15e-211">When the agent has successfully connected to Operations Management Suite, it will be listed on the **Connected Sources** tab of the Operations Management Suite **Settings** pane.</span><span class="sxs-lookup"><span data-stu-id="ea15e-211">When the agent has successfully connected to Operations Management Suite, it will be listed on the **Connected Sources** tab of the Operations Management Suite **Settings** pane.</span></span>  <span data-ttu-id="ea15e-212">You can verify that the agent has correctly downloaded the Automation solution when it has a folder called **AzureAutomationFiles** in C:\Program Files\Microsoft Monitoring Agent\Agent.</span><span class="sxs-lookup"><span data-stu-id="ea15e-212">You can verify that the agent has correctly downloaded the Automation solution when it has a folder called **AzureAutomationFiles** in C:\Program Files\Microsoft Monitoring Agent\Agent.</span></span>  <span data-ttu-id="ea15e-213">To confirm the version of the Hybrid Runbook Worker, you can navigate to C:\Program Files\Microsoft Monitoring Agent\Agent\AzureAutomation\ and note the \\*version* subfolder.</span><span class="sxs-lookup"><span data-stu-id="ea15e-213">To confirm the version of the Hybrid Runbook Worker, you can navigate to C:\Program Files\Microsoft Monitoring Agent\Agent\AzureAutomation\ and note the \\*version* subfolder.</span></span>   

#### <a name="4-install-the-runbook-environment-and-connect-to-azure-automation"></a><span data-ttu-id="ea15e-214">4. Install the runbook environment and connect to Azure Automation</span><span class="sxs-lookup"><span data-stu-id="ea15e-214">4. Install the runbook environment and connect to Azure Automation</span></span>
<span data-ttu-id="ea15e-215">When you add an agent to Operations Management Suite, the Automation solution pushes down the **HybridRegistration** PowerShell module, which contains the **Add-HybridRunbookWorker** cmdlet.</span><span class="sxs-lookup"><span data-stu-id="ea15e-215">When you add an agent to Operations Management Suite, the Automation solution pushes down the **HybridRegistration** PowerShell module, which contains the **Add-HybridRunbookWorker** cmdlet.</span></span>  <span data-ttu-id="ea15e-216">You use this cmdlet to install the runbook environment on the computer and register it with Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="ea15e-216">You use this cmdlet to install the runbook environment on the computer and register it with Azure Automation.</span></span>

<span data-ttu-id="ea15e-217">Open a PowerShell session in Administrator mode and run the following commands to import the module.</span><span class="sxs-lookup"><span data-stu-id="ea15e-217">Open a PowerShell session in Administrator mode and run the following commands to import the module.</span></span>

    cd "C:\Program Files\Microsoft Monitoring Agent\Agent\AzureAutomation\<version>\HybridRegistration"
    Import-Module HybridRegistration.psd1

<span data-ttu-id="ea15e-218">Then run the **Add-HybridRunbookWorker** cmdlet using the following syntax:</span><span class="sxs-lookup"><span data-stu-id="ea15e-218">Then run the **Add-HybridRunbookWorker** cmdlet using the following syntax:</span></span>

    Add-HybridRunbookWorker –Name <String> -EndPoint <Url> -Token <String>

<span data-ttu-id="ea15e-219">You can get the information required for this cmdlet from the **Manage Keys** blade in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="ea15e-219">You can get the information required for this cmdlet from the **Manage Keys** blade in the Azure portal.</span></span>  <span data-ttu-id="ea15e-220">Open this blade by selecting the **Keys** option from the **Settings** blade in your Automation account.</span><span class="sxs-lookup"><span data-stu-id="ea15e-220">Open this blade by selecting the **Keys** option from the **Settings** blade in your Automation account.</span></span>

![Hybrid Runbook Worker Overview](https://docstestmedia1.blob.core.windows.net/azure-media/articles/automation/media/automation-hybrid-runbook-worker/elements-panel-keys.png)

* <span data-ttu-id="ea15e-222">**Name** is the name of the Hybrid Runbook Worker Group.</span><span class="sxs-lookup"><span data-stu-id="ea15e-222">**Name** is the name of the Hybrid Runbook Worker Group.</span></span> <span data-ttu-id="ea15e-223">If this group already exists in the automation account, then the current computer is added to it.</span><span class="sxs-lookup"><span data-stu-id="ea15e-223">If this group already exists in the automation account, then the current computer is added to it.</span></span>  <span data-ttu-id="ea15e-224">If it does not already exist, then it is added.</span><span class="sxs-lookup"><span data-stu-id="ea15e-224">If it does not already exist, then it is added.</span></span>
* <span data-ttu-id="ea15e-225">**EndPoint** is the **URL** field in the **Manage Keys** blade.</span><span class="sxs-lookup"><span data-stu-id="ea15e-225">**EndPoint** is the **URL** field in the **Manage Keys** blade.</span></span>
* <span data-ttu-id="ea15e-226">**Token** is the **Primary Access Key** in the **Manage Keys** blade.</span><span class="sxs-lookup"><span data-stu-id="ea15e-226">**Token** is the **Primary Access Key** in the **Manage Keys** blade.</span></span>  

<span data-ttu-id="ea15e-227">Use the **-Verbose** switch with **Add-HybridRunbookWorker** to receive detailed information about the installation.</span><span class="sxs-lookup"><span data-stu-id="ea15e-227">Use the **-Verbose** switch with **Add-HybridRunbookWorker** to receive detailed information about the installation.</span></span>

#### <a name="5-install-powershell-modules"></a><span data-ttu-id="ea15e-228">5. Install PowerShell modules</span><span class="sxs-lookup"><span data-stu-id="ea15e-228">5. Install PowerShell modules</span></span>
<span data-ttu-id="ea15e-229">Runbooks can use any of the activities and cmdlets defined in the modules installed in your Azure Automation environment.</span><span class="sxs-lookup"><span data-stu-id="ea15e-229">Runbooks can use any of the activities and cmdlets defined in the modules installed in your Azure Automation environment.</span></span>  <span data-ttu-id="ea15e-230">These modules are not automatically deployed to on-premises computers though, so you must install them manually.</span><span class="sxs-lookup"><span data-stu-id="ea15e-230">These modules are not automatically deployed to on-premises computers though, so you must install them manually.</span></span>  <span data-ttu-id="ea15e-231">The exception is the Azure module, which is installed by default providing access to cmdlets for all Azure services and activities for Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="ea15e-231">The exception is the Azure module, which is installed by default providing access to cmdlets for all Azure services and activities for Azure Automation.</span></span>

<span data-ttu-id="ea15e-232">Since the primary purpose of the Hybrid Runbook Worker feature is to manage local resources, you most likely need to install the modules that support these resources.</span><span class="sxs-lookup"><span data-stu-id="ea15e-232">Since the primary purpose of the Hybrid Runbook Worker feature is to manage local resources, you most likely need to install the modules that support these resources.</span></span>  <span data-ttu-id="ea15e-233">You can refer to [Installing Modules](http://msdn.microsoft.com/library/dd878350.aspx) for information on installing Windows PowerShell modules.</span><span class="sxs-lookup"><span data-stu-id="ea15e-233">You can refer to [Installing Modules](http://msdn.microsoft.com/library/dd878350.aspx) for information on installing Windows PowerShell modules.</span></span>  <span data-ttu-id="ea15e-234">Modules that are installed must be in a location referenced by PSModulePath environment variable so that they are automatically imported by the Hybrid worker.</span><span class="sxs-lookup"><span data-stu-id="ea15e-234">Modules that are installed must be in a location referenced by PSModulePath environment variable so that they are automatically imported by the Hybrid worker.</span></span>  <span data-ttu-id="ea15e-235">For further information, see [Modifying the PSModulePath Installation Path](https://msdn.microsoft.com/library/dd878326%28v=vs.85%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="ea15e-235">For further information, see [Modifying the PSModulePath Installation Path](https://msdn.microsoft.com/library/dd878326%28v=vs.85%29.aspx).</span></span> 

## <a name="removing-hybrid-runbook-worker"></a><span data-ttu-id="ea15e-236">Removing Hybrid Runbook Worker</span><span class="sxs-lookup"><span data-stu-id="ea15e-236">Removing Hybrid Runbook Worker</span></span> 
<span data-ttu-id="ea15e-237">You can remove one or more Hybrid Runbook Workers from a group or you can remove the group, depending on your requirements.</span><span class="sxs-lookup"><span data-stu-id="ea15e-237">You can remove one or more Hybrid Runbook Workers from a group or you can remove the group, depending on your requirements.</span></span>  <span data-ttu-id="ea15e-238">To remove a Hybrid Runbook Worker from an on-premises computer, perform the following steps.</span><span class="sxs-lookup"><span data-stu-id="ea15e-238">To remove a Hybrid Runbook Worker from an on-premises computer, perform the following steps.</span></span>

1. <span data-ttu-id="ea15e-239">In the Azure portal, navigate to your Automation account.</span><span class="sxs-lookup"><span data-stu-id="ea15e-239">In the Azure portal, navigate to your Automation account.</span></span>  
2. <span data-ttu-id="ea15e-240">From the **Settings** blade, select **Keys** and note the values for field **URL** and **Primary Access Key**.</span><span class="sxs-lookup"><span data-stu-id="ea15e-240">From the **Settings** blade, select **Keys** and note the values for field **URL** and **Primary Access Key**.</span></span>  <span data-ttu-id="ea15e-241">You need this information for the next step.</span><span class="sxs-lookup"><span data-stu-id="ea15e-241">You need this information for the next step.</span></span>
3. <span data-ttu-id="ea15e-242">Open a PowerShell session in Administrator mode and run the following command - `Remove-HybridRunbookWorker -url <URL> -key <PrimaryAccessKey>`.</span><span class="sxs-lookup"><span data-stu-id="ea15e-242">Open a PowerShell session in Administrator mode and run the following command - `Remove-HybridRunbookWorker -url <URL> -key <PrimaryAccessKey>`.</span></span>  <span data-ttu-id="ea15e-243">Use the **-Verbose** switch for a detailed log of the removal process.</span><span class="sxs-lookup"><span data-stu-id="ea15e-243">Use the **-Verbose** switch for a detailed log of the removal process.</span></span>

> [!NOTE]
> <span data-ttu-id="ea15e-244">This does not remove the Microsoft Monitoring Agent from the computer, only the functionality and configuration of the Hybrid Runbook Worker role.</span><span class="sxs-lookup"><span data-stu-id="ea15e-244">This does not remove the Microsoft Monitoring Agent from the computer, only the functionality and configuration of the Hybrid Runbook Worker role.</span></span>  

## <a name="remove-hybrid-worker-groups"></a><span data-ttu-id="ea15e-245">Remove Hybrid Worker groups</span><span class="sxs-lookup"><span data-stu-id="ea15e-245">Remove Hybrid Worker groups</span></span>
<span data-ttu-id="ea15e-246">To remove a group, you first need to remove the Hybrid Runbook Worker from every computer that is a member of the group using the procedure shown earlier, and then you perform the following steps to remove the group.</span><span class="sxs-lookup"><span data-stu-id="ea15e-246">To remove a group, you first need to remove the Hybrid Runbook Worker from every computer that is a member of the group using the procedure shown earlier, and then you perform the following steps to remove the group.</span></span>  

1. <span data-ttu-id="ea15e-247">Open the Automation account in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="ea15e-247">Open the Automation account in the Azure portal.</span></span>
2. <span data-ttu-id="ea15e-248">Select the **Hybrid Worker Groups** tile and in the **Hybrid Worker Groups** blade, select the group you wish to delete.</span><span class="sxs-lookup"><span data-stu-id="ea15e-248">Select the **Hybrid Worker Groups** tile and in the **Hybrid Worker Groups** blade, select the group you wish to delete.</span></span>  <span data-ttu-id="ea15e-249">After selecting the specific group, the **Hybrid worker group** properties blade is displayed.</span><span class="sxs-lookup"><span data-stu-id="ea15e-249">After selecting the specific group, the **Hybrid worker group** properties blade is displayed.</span></span><br> <span data-ttu-id="ea15e-250">![Hybrid Runbook Worker Group Blade](https://docstestmedia1.blob.core.windows.net/azure-media/articles/automation/media/automation-hybrid-runbook-worker/automation-hybrid-runbook-worker-group-properties.png)</span><span class="sxs-lookup"><span data-stu-id="ea15e-250">![Hybrid Runbook Worker Group Blade](https://docstestmedia1.blob.core.windows.net/azure-media/articles/automation/media/automation-hybrid-runbook-worker/automation-hybrid-runbook-worker-group-properties.png)</span></span>   
3. <span data-ttu-id="ea15e-251">On the properties blade for the selected group, click **Delete**.</span><span class="sxs-lookup"><span data-stu-id="ea15e-251">On the properties blade for the selected group, click **Delete**.</span></span>  <span data-ttu-id="ea15e-252">A message appears asking you to confirm this action, select **Yes** if you are sure you want to proceed.</span><span class="sxs-lookup"><span data-stu-id="ea15e-252">A message appears asking you to confirm this action, select **Yes** if you are sure you want to proceed.</span></span><br> <span data-ttu-id="ea15e-253">![Delete Group Confirmation Dialog](https://docstestmedia1.blob.core.windows.net/azure-media/articles/automation/media/automation-hybrid-runbook-worker/automation-hybrid-runbook-worker-confirm-delete.png)</span><span class="sxs-lookup"><span data-stu-id="ea15e-253">![Delete Group Confirmation Dialog](https://docstestmedia1.blob.core.windows.net/azure-media/articles/automation/media/automation-hybrid-runbook-worker/automation-hybrid-runbook-worker-confirm-delete.png)</span></span><br> <span data-ttu-id="ea15e-254">This process can take several seconds to complete and you can track its progress under **Notifications** from the menu.</span><span class="sxs-lookup"><span data-stu-id="ea15e-254">This process can take several seconds to complete and you can track its progress under **Notifications** from the menu.</span></span>  

## <a name="starting-runbooks-on-hybrid-runbook-worker"></a><span data-ttu-id="ea15e-255">Starting runbooks on Hybrid Runbook Worker</span><span class="sxs-lookup"><span data-stu-id="ea15e-255">Starting runbooks on Hybrid Runbook Worker</span></span>
<span data-ttu-id="ea15e-256">[Starting a Runbook in Azure Automation](automation-starting-a-runbook.md) describes different methods for starting a runbook.</span><span class="sxs-lookup"><span data-stu-id="ea15e-256">[Starting a Runbook in Azure Automation](automation-starting-a-runbook.md) describes different methods for starting a runbook.</span></span>  <span data-ttu-id="ea15e-257">Hybrid Runbook Worker adds a **RunOn** option where you can specify the name of a Hybrid Runbook Worker Group.</span><span class="sxs-lookup"><span data-stu-id="ea15e-257">Hybrid Runbook Worker adds a **RunOn** option where you can specify the name of a Hybrid Runbook Worker Group.</span></span>  <span data-ttu-id="ea15e-258">If a group is specified, then the runbook is retrieved and run by of the workers in that group.</span><span class="sxs-lookup"><span data-stu-id="ea15e-258">If a group is specified, then the runbook is retrieved and run by of the workers in that group.</span></span>  <span data-ttu-id="ea15e-259">If this option is not specified, then it is run in Azure Automation as normal.</span><span class="sxs-lookup"><span data-stu-id="ea15e-259">If this option is not specified, then it is run in Azure Automation as normal.</span></span>

<span data-ttu-id="ea15e-260">When you start a runbook in the Azure portal, you are presented with a **Run on** option where you can select **Azure** or **Hybrid Worker**.</span><span class="sxs-lookup"><span data-stu-id="ea15e-260">When you start a runbook in the Azure portal, you are presented with a **Run on** option where you can select **Azure** or **Hybrid Worker**.</span></span>  <span data-ttu-id="ea15e-261">If you select **Hybrid Worker**, then you can select the group from a dropdown.</span><span class="sxs-lookup"><span data-stu-id="ea15e-261">If you select **Hybrid Worker**, then you can select the group from a dropdown.</span></span>

<span data-ttu-id="ea15e-262">Use the **RunOn** parameter.</span><span class="sxs-lookup"><span data-stu-id="ea15e-262">Use the **RunOn** parameter.</span></span>  <span data-ttu-id="ea15e-263">You can use the following command to start a runbook named Test-Runbook on a Hybrid Runbook Worker Group named MyHybridGroup using Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ea15e-263">You can use the following command to start a runbook named Test-Runbook on a Hybrid Runbook Worker Group named MyHybridGroup using Windows PowerShell.</span></span>

    Start-AzureRmAutomationRunbook –AutomationAccountName "MyAutomationAccount" –Name "Test-Runbook" -RunOn "MyHybridGroup"

> [!NOTE]
> <span data-ttu-id="ea15e-264">The **RunOn** parameter was added to the **Start-AzureAutomationRunbook** cmdlet in version 0.9.1 of Microsoft Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ea15e-264">The **RunOn** parameter was added to the **Start-AzureAutomationRunbook** cmdlet in version 0.9.1 of Microsoft Azure PowerShell.</span></span>  <span data-ttu-id="ea15e-265">You should [download the latest version](https://azure.microsoft.com/downloads/) if you have an earlier one installed.</span><span class="sxs-lookup"><span data-stu-id="ea15e-265">You should [download the latest version](https://azure.microsoft.com/downloads/) if you have an earlier one installed.</span></span>  <span data-ttu-id="ea15e-266">You only need to install this version on a workstation where you are starting the runbook from Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="ea15e-266">You only need to install this version on a workstation where you are starting the runbook from Windows PowerShell.</span></span>  <span data-ttu-id="ea15e-267">You do not need to install it on the worker computer unless you intend to start runbooks from that computer.</span><span class="sxs-lookup"><span data-stu-id="ea15e-267">You do not need to install it on the worker computer unless you intend to start runbooks from that computer.</span></span>  <span data-ttu-id="ea15e-268">You cannot currently start a runbook on a Hybrid Runbook Worker from another runbook since this would require the latest version of Azure Powershell to be installed in your Automation account.</span><span class="sxs-lookup"><span data-stu-id="ea15e-268">You cannot currently start a runbook on a Hybrid Runbook Worker from another runbook since this would require the latest version of Azure Powershell to be installed in your Automation account.</span></span>  <span data-ttu-id="ea15e-269">The latest version is automatically updated in Azure Automation and automatically pushed down to the workers soon.</span><span class="sxs-lookup"><span data-stu-id="ea15e-269">The latest version is automatically updated in Azure Automation and automatically pushed down to the workers soon.</span></span>
>
>

## <a name="runbook-permissions"></a><span data-ttu-id="ea15e-270">Runbook permissions</span><span class="sxs-lookup"><span data-stu-id="ea15e-270">Runbook permissions</span></span>
<span data-ttu-id="ea15e-271">Runbooks running on a Hybrid Runbook Worker cannot use the same method that is typically used for runbooks authenticating to Azure resources, since they are accessing resources outside of Azure.</span><span class="sxs-lookup"><span data-stu-id="ea15e-271">Runbooks running on a Hybrid Runbook Worker cannot use the same method that is typically used for runbooks authenticating to Azure resources, since they are accessing resources outside of Azure.</span></span>  <span data-ttu-id="ea15e-272">The runbook can either provide its own authentication to local resources, or you can specify a RunAs account to provide a user context for all runbooks.</span><span class="sxs-lookup"><span data-stu-id="ea15e-272">The runbook can either provide its own authentication to local resources, or you can specify a RunAs account to provide a user context for all runbooks.</span></span>

### <a name="runbook-authentication"></a><span data-ttu-id="ea15e-273">Runbook authentication</span><span class="sxs-lookup"><span data-stu-id="ea15e-273">Runbook authentication</span></span>
<span data-ttu-id="ea15e-274">By default, runbooks will run in the context of the local System account on the on-premises computer, so they must provide their own authentication to resources that they will access.</span><span class="sxs-lookup"><span data-stu-id="ea15e-274">By default, runbooks will run in the context of the local System account on the on-premises computer, so they must provide their own authentication to resources that they will access.</span></span>  

<span data-ttu-id="ea15e-275">You can use [Credential](http://msdn.microsoft.com/library/dn940015.aspx) and [Certificate](http://msdn.microsoft.com/library/dn940013.aspx) assets in your runbook with cmdlets that allow you to specify credentials so you can authenticate to different resources.</span><span class="sxs-lookup"><span data-stu-id="ea15e-275">You can use [Credential](http://msdn.microsoft.com/library/dn940015.aspx) and [Certificate](http://msdn.microsoft.com/library/dn940013.aspx) assets in your runbook with cmdlets that allow you to specify credentials so you can authenticate to different resources.</span></span>  <span data-ttu-id="ea15e-276">The following example shows a portion of a runbook that restarts a computer.</span><span class="sxs-lookup"><span data-stu-id="ea15e-276">The following example shows a portion of a runbook that restarts a computer.</span></span>  <span data-ttu-id="ea15e-277">It retrieves credentials from a credential asset and the name of the computer from a variable asset and then uses these values with the Restart-Computer cmdlet.</span><span class="sxs-lookup"><span data-stu-id="ea15e-277">It retrieves credentials from a credential asset and the name of the computer from a variable asset and then uses these values with the Restart-Computer cmdlet.</span></span>

    $Cred = Get-AzureRmAutomationCredential -ResourceGroupName "ResourceGroup01" -Name "MyCredential"
    $Computer = Get-AzureRmAutomationVariable -ResourceGroupName "ResourceGroup01" -Name  "ComputerName"

    Restart-Computer -ComputerName $Computer -Credential $Cred

<span data-ttu-id="ea15e-278">You can also leverage [InlineScript](automation-powershell-workflow.md#inlinescript), which  allows you to run blocks of code on another computer with credentials specified by the [PSCredential common parameter](http://technet.microsoft.com/library/jj129719.aspx).</span><span class="sxs-lookup"><span data-stu-id="ea15e-278">You can also leverage [InlineScript](automation-powershell-workflow.md#inlinescript), which  allows you to run blocks of code on another computer with credentials specified by the [PSCredential common parameter](http://technet.microsoft.com/library/jj129719.aspx).</span></span>

### <a name="runas-account"></a><span data-ttu-id="ea15e-279">RunAs account</span><span class="sxs-lookup"><span data-stu-id="ea15e-279">RunAs account</span></span>
<span data-ttu-id="ea15e-280">Instead of having runbooks provide their own authentication to local resources, you can specify a **RunAs** account for a Hybrid worker group.</span><span class="sxs-lookup"><span data-stu-id="ea15e-280">Instead of having runbooks provide their own authentication to local resources, you can specify a **RunAs** account for a Hybrid worker group.</span></span>  <span data-ttu-id="ea15e-281">You specify a [credential asset](automation-credentials.md) that has access to local resources, and all runbooks run under these credentials when running on a Hybrid Runbook Worker in the group.</span><span class="sxs-lookup"><span data-stu-id="ea15e-281">You specify a [credential asset](automation-credentials.md) that has access to local resources, and all runbooks run under these credentials when running on a Hybrid Runbook Worker in the group.</span></span>  

<span data-ttu-id="ea15e-282">The user name for the credential must be in one of the following formats:</span><span class="sxs-lookup"><span data-stu-id="ea15e-282">The user name for the credential must be in one of the following formats:</span></span>

* <span data-ttu-id="ea15e-283">domain\username</span><span class="sxs-lookup"><span data-stu-id="ea15e-283">domain\username</span></span>
* username@domain
* <span data-ttu-id="ea15e-284">username (for accounts local to the on-premises computer)</span><span class="sxs-lookup"><span data-stu-id="ea15e-284">username (for accounts local to the on-premises computer)</span></span>

<span data-ttu-id="ea15e-285">Use the following procedure to specify a RunAs account for a Hybrid worker group:</span><span class="sxs-lookup"><span data-stu-id="ea15e-285">Use the following procedure to specify a RunAs account for a Hybrid worker group:</span></span>

1. <span data-ttu-id="ea15e-286">Create a [credential asset](automation-credentials.md) with access to local resources.</span><span class="sxs-lookup"><span data-stu-id="ea15e-286">Create a [credential asset](automation-credentials.md) with access to local resources.</span></span>
2. <span data-ttu-id="ea15e-287">Open the Automation account in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="ea15e-287">Open the Automation account in the Azure portal.</span></span>
3. <span data-ttu-id="ea15e-288">Select the **Hybrid Worker Groups** tile, and then select the group.</span><span class="sxs-lookup"><span data-stu-id="ea15e-288">Select the **Hybrid Worker Groups** tile, and then select the group.</span></span>
4. <span data-ttu-id="ea15e-289">Select **All settings** and then **Hybrid worker group settings**.</span><span class="sxs-lookup"><span data-stu-id="ea15e-289">Select **All settings** and then **Hybrid worker group settings**.</span></span>
5. <span data-ttu-id="ea15e-290">Change **Run As** from **Default** to **Custom**.</span><span class="sxs-lookup"><span data-stu-id="ea15e-290">Change **Run As** from **Default** to **Custom**.</span></span>
6. <span data-ttu-id="ea15e-291">Select the credential and click **Save**.</span><span class="sxs-lookup"><span data-stu-id="ea15e-291">Select the credential and click **Save**.</span></span>

### <a name="automation-run-as-account"></a><span data-ttu-id="ea15e-292">Automation Run As account</span><span class="sxs-lookup"><span data-stu-id="ea15e-292">Automation Run As account</span></span>
<span data-ttu-id="ea15e-293">As part of your automated build process for deploying resources in Azure, you may require interrogating on-premise systems to support a task or set of steps in your deployment sequence.</span><span class="sxs-lookup"><span data-stu-id="ea15e-293">As part of your automated build process for deploying resources in Azure, you may require interrogating on-premise systems to support a task or set of steps in your deployment sequence.</span></span>  <span data-ttu-id="ea15e-294">To support authentication against Azure using the Run As account, you need to install the Run As account certificate.</span><span class="sxs-lookup"><span data-stu-id="ea15e-294">To support authentication against Azure using the Run As account, you need to install the Run As account certificate.</span></span>  

<span data-ttu-id="ea15e-295">The following PowerShell runbook, *Export-RunAsCertificateToHybridWorker*, exports the Run As certificate from your Azure Automation account and downloads and imports it into the local machine certificate store on a Hybrid worker connected to the same account.</span><span class="sxs-lookup"><span data-stu-id="ea15e-295">The following PowerShell runbook, *Export-RunAsCertificateToHybridWorker*, exports the Run As certificate from your Azure Automation account and downloads and imports it into the local machine certificate store on a Hybrid worker connected to the same account.</span></span>  <span data-ttu-id="ea15e-296">Once that step is completed, it verifies the worker can successfully authenticate to Azure using the Run As account.</span><span class="sxs-lookup"><span data-stu-id="ea15e-296">Once that step is completed, it verifies the worker can successfully authenticate to Azure using the Run As account.</span></span>

    <#PSScriptInfo
    .VERSION 1.0
    .GUID 3a796b9a-623d-499d-86c8-c249f10a6986
    .AUTHOR Azure Automation Team
    .COMPANYNAME Microsoft
    .COPYRIGHT 
    .TAGS Azure Automation 
    .LICENSEURI 
    .PROJECTURI 
    .ICONURI 
    .EXTERNALMODULEDEPENDENCIES 
    .REQUIREDSCRIPTS 
    .EXTERNALSCRIPTDEPENDENCIES 
    .RELEASENOTES
    #>

    <#  
    .SYNOPSIS  
    Exports the Run As certificate from an Azure Automation account to a hybrid worker in that account. 
  
    .DESCRIPTION  
    This runbook exports the Run As certificate from an Azure Automation account to a hybrid worker in that account.
    Run this runbook in the hybrid worker where you want the certificate installed.
    This allows the use of the AzureRunAsConnection to authenticate to Azure and manage Azure resources from runbooks running in the hybrid worker.

    .EXAMPLE
    .\Export-RunAsCertificateToHybridWorker

    .NOTES
    AUTHOR: Azure Automation Team 
    LASTEDIT: 2016.10.13
    #>

    [OutputType([string])] 

    # Set the password used for this certificate
    $Password = "YourStrongPasswordForTheCert"

    # Stop on errors
    $ErrorActionPreference = 'stop'

    # Get the management certificate that will be used to make calls into Azure Service Management resources
    $RunAsCert = Get-AutomationCertificate -Name "AzureRunAsCertificate"
       
    # location to store temporary certificate in the Automation service host
    $CertPath = Join-Path $env:temp  "AzureRunAsCertificate.pfx"
   
    # Save the certificate
    $Cert = $RunAsCert.Export("pfx",$Password)
    Set-Content -Value $Cert -Path $CertPath -Force -Encoding Byte | Write-Verbose 

    Write-Output ("Importing certificate into local machine root store from " + $CertPath)
    $SecurePassword = ConvertTo-SecureString $Password -AsPlainText -Force
    Import-PfxCertificate -FilePath $CertPath -CertStoreLocation Cert:\LocalMachine\My -Password $SecurePassword -Exportable | Write-Verbose

    # Test that authentication to Azure Resource Manager is working
    $RunAsConnection = Get-AutomationConnection -Name "AzureRunAsConnection" 
    
    Add-AzureRmAccount `
      -ServicePrincipal `
      -TenantId $RunAsConnection.TenantId `
      -ApplicationId $RunAsConnection.ApplicationId `
      -CertificateThumbprint $RunAsConnection.CertificateThumbprint | Write-Verbose

    Select-AzureRmSubscription -SubscriptionId $RunAsConnection.SubscriptionID | Write-Verbose

    # List automation accounts to confirm Azure Resource Manager calls are working
    Get-AzureRmAutomationAccount | Select AutomationAccountName

<span data-ttu-id="ea15e-297">Save the *Export-RunAsCertificateToHybridWorker* runbook to your computer with a `.ps1` extension.</span><span class="sxs-lookup"><span data-stu-id="ea15e-297">Save the *Export-RunAsCertificateToHybridWorker* runbook to your computer with a `.ps1` extension.</span></span>  <span data-ttu-id="ea15e-298">Import it into your Automation account and edit the runbook, changing the value of the variable `$Password` with your own password.</span><span class="sxs-lookup"><span data-stu-id="ea15e-298">Import it into your Automation account and edit the runbook, changing the value of the variable `$Password` with your own password.</span></span>  <span data-ttu-id="ea15e-299">Publish and then run the runbook targeting the Hybrid Worker group that run and authenticate runbooks using the Run As account.</span><span class="sxs-lookup"><span data-stu-id="ea15e-299">Publish and then run the runbook targeting the Hybrid Worker group that run and authenticate runbooks using the Run As account.</span></span>  <span data-ttu-id="ea15e-300">The job stream reports the attempt to import the certificate into the local machine store, and follows with multiple lines depending on how many Automation accounts are defined in your subscription and if authentication is successful.</span><span class="sxs-lookup"><span data-stu-id="ea15e-300">The job stream reports the attempt to import the certificate into the local machine store, and follows with multiple lines depending on how many Automation accounts are defined in your subscription and if authentication is successful.</span></span>  

## <a name="creating-runbooks-for-hybrid-runbook-worker"></a><span data-ttu-id="ea15e-301">Creating runbooks for Hybrid Runbook Worker</span><span class="sxs-lookup"><span data-stu-id="ea15e-301">Creating runbooks for Hybrid Runbook Worker</span></span>
<span data-ttu-id="ea15e-302">There is no difference in the structure of runbooks that run in Azure Automation and those that run on a Hybrid Runbook Worker.</span><span class="sxs-lookup"><span data-stu-id="ea15e-302">There is no difference in the structure of runbooks that run in Azure Automation and those that run on a Hybrid Runbook Worker.</span></span> <span data-ttu-id="ea15e-303">Runbooks that you use with each most likely differ significantly though since runbooks for Hybrid Runbook Worker typically manage local resources in your data center, while runbooks in Azure Automation typically manage resources in the Azure cloud.</span><span class="sxs-lookup"><span data-stu-id="ea15e-303">Runbooks that you use with each most likely differ significantly though since runbooks for Hybrid Runbook Worker typically manage local resources in your data center, while runbooks in Azure Automation typically manage resources in the Azure cloud.</span></span>

<span data-ttu-id="ea15e-304">You can edit a runbook for Hybrid Runbook Worker in Azure Automation, but you may have difficulties if you try to test the runbook in the editor.</span><span class="sxs-lookup"><span data-stu-id="ea15e-304">You can edit a runbook for Hybrid Runbook Worker in Azure Automation, but you may have difficulties if you try to test the runbook in the editor.</span></span>  <span data-ttu-id="ea15e-305">The PowerShell modules that access the local resources may not be installed in your Azure Automation environment in which case, the test would fail.</span><span class="sxs-lookup"><span data-stu-id="ea15e-305">The PowerShell modules that access the local resources may not be installed in your Azure Automation environment in which case, the test would fail.</span></span>  <span data-ttu-id="ea15e-306">If you do install the required modules, then the runbook will run, but it will not be able to access local resources for a complete test.</span><span class="sxs-lookup"><span data-stu-id="ea15e-306">If you do install the required modules, then the runbook will run, but it will not be able to access local resources for a complete test.</span></span>

## <a name="troubleshooting-runbooks-on-hybrid-runbook-worker"></a><span data-ttu-id="ea15e-307">Troubleshooting runbooks on Hybrid Runbook Worker</span><span class="sxs-lookup"><span data-stu-id="ea15e-307">Troubleshooting runbooks on Hybrid Runbook Worker</span></span>
<span data-ttu-id="ea15e-308">[Runbook output and messages](automation-runbook-output-and-messages.md) are sent to Azure Automation from hybrid workers just like runbook jobs run in the cloud.</span><span class="sxs-lookup"><span data-stu-id="ea15e-308">[Runbook output and messages](automation-runbook-output-and-messages.md) are sent to Azure Automation from hybrid workers just like runbook jobs run in the cloud.</span></span>  <span data-ttu-id="ea15e-309">You can also enable the Verbose and Progress streams the same way you would for other runbooks.</span><span class="sxs-lookup"><span data-stu-id="ea15e-309">You can also enable the Verbose and Progress streams the same way you would for other runbooks.</span></span>  

<span data-ttu-id="ea15e-310">Logs are stored locally on each hybrid worker at C:\ProgramData\Microsoft\System Center\Orchestrator\7.2\SMA\Sandboxes.</span><span class="sxs-lookup"><span data-stu-id="ea15e-310">Logs are stored locally on each hybrid worker at C:\ProgramData\Microsoft\System Center\Orchestrator\7.2\SMA\Sandboxes.</span></span>

<span data-ttu-id="ea15e-311">If your runbooks are not completing successfully and the job summary shows a status of **Suspended**, please review the troubleshooting article [Hybrid Runbook Worker: A runbook job terminates with a status of Suspended](automation-troubleshooting-hrw-runbook-terminates-suspended.md).</span><span class="sxs-lookup"><span data-stu-id="ea15e-311">If your runbooks are not completing successfully and the job summary shows a status of **Suspended**, please review the troubleshooting article [Hybrid Runbook Worker: A runbook job terminates with a status of Suspended](automation-troubleshooting-hrw-runbook-terminates-suspended.md).</span></span>   

## <a name="relationship-to-service-management-automation"></a><span data-ttu-id="ea15e-312">Relationship to Service Management Automation</span><span class="sxs-lookup"><span data-stu-id="ea15e-312">Relationship to Service Management Automation</span></span>
<span data-ttu-id="ea15e-313">[Service Management Automation (SMA)](https://technet.microsoft.com/library/dn469260.aspx) allows you to run the same runbooks that are supported by Azure Automation in your local data center.</span><span class="sxs-lookup"><span data-stu-id="ea15e-313">[Service Management Automation (SMA)](https://technet.microsoft.com/library/dn469260.aspx) allows you to run the same runbooks that are supported by Azure Automation in your local data center.</span></span> <span data-ttu-id="ea15e-314">SMA is generally deployed together with Windows Azure Pack, as Windows Azure Pack contains a graphical interface for SMA management.</span><span class="sxs-lookup"><span data-stu-id="ea15e-314">SMA is generally deployed together with Windows Azure Pack, as Windows Azure Pack contains a graphical interface for SMA management.</span></span> <span data-ttu-id="ea15e-315">Unlike Azure Automation, SMA requires a local installation that includes web servers to host the API, a database to contain runbooks and SMA configuration, and Runbook Workers to execute runbook jobs.</span><span class="sxs-lookup"><span data-stu-id="ea15e-315">Unlike Azure Automation, SMA requires a local installation that includes web servers to host the API, a database to contain runbooks and SMA configuration, and Runbook Workers to execute runbook jobs.</span></span> <span data-ttu-id="ea15e-316">Azure Automation provides these services in the cloud and only requires you to maintain the Hybrid Runbook Workers in your local environment.</span><span class="sxs-lookup"><span data-stu-id="ea15e-316">Azure Automation provides these services in the cloud and only requires you to maintain the Hybrid Runbook Workers in your local environment.</span></span>

<span data-ttu-id="ea15e-317">If you are an existing SMA user, you can move your runbooks to Azure Automation to be used with Hybrid Runbook Worker with no changes, assuming that they perform their own authentication to resources as described in [Creating runbooks for Hybrid Runbook Worker](#creating-runbooks-for-hybrid-runbook-worker).</span><span class="sxs-lookup"><span data-stu-id="ea15e-317">If you are an existing SMA user, you can move your runbooks to Azure Automation to be used with Hybrid Runbook Worker with no changes, assuming that they perform their own authentication to resources as described in [Creating runbooks for Hybrid Runbook Worker](#creating-runbooks-for-hybrid-runbook-worker).</span></span>  <span data-ttu-id="ea15e-318">Runbooks in SMA run in the context of the service account on the worker server which may provide that authentication for the runbooks.</span><span class="sxs-lookup"><span data-stu-id="ea15e-318">Runbooks in SMA run in the context of the service account on the worker server which may provide that authentication for the runbooks.</span></span>

<span data-ttu-id="ea15e-319">You can use the following criteria to determine whether Azure Automation with Hybrid Runbook Worker or Service Management Automation is more appropriate for your requirements.</span><span class="sxs-lookup"><span data-stu-id="ea15e-319">You can use the following criteria to determine whether Azure Automation with Hybrid Runbook Worker or Service Management Automation is more appropriate for your requirements.</span></span>

* <span data-ttu-id="ea15e-320">SMA requires a local installation of its underlying components that are connected to Windows Azure Pack if a graphical management interface is required.</span><span class="sxs-lookup"><span data-stu-id="ea15e-320">SMA requires a local installation of its underlying components that are connected to Windows Azure Pack if a graphical management interface is required.</span></span> <span data-ttu-id="ea15e-321">More local resources are needed with higher maintenance costs than Azure Automation, which only needs an agent installed on local runbook workers.</span><span class="sxs-lookup"><span data-stu-id="ea15e-321">More local resources are needed with higher maintenance costs than Azure Automation, which only needs an agent installed on local runbook workers.</span></span> <span data-ttu-id="ea15e-322">The agents are managed by Operations Management Suite, further decreasing your maintenance costs.</span><span class="sxs-lookup"><span data-stu-id="ea15e-322">The agents are managed by Operations Management Suite, further decreasing your maintenance costs.</span></span>
* <span data-ttu-id="ea15e-323">Azure Automation stores its runbooks in the cloud and delivers them to on-premises Hybrid Runbook Workers.</span><span class="sxs-lookup"><span data-stu-id="ea15e-323">Azure Automation stores its runbooks in the cloud and delivers them to on-premises Hybrid Runbook Workers.</span></span> <span data-ttu-id="ea15e-324">If your security policy does not allow this behavior, then you should use SMA.</span><span class="sxs-lookup"><span data-stu-id="ea15e-324">If your security policy does not allow this behavior, then you should use SMA.</span></span>
* <span data-ttu-id="ea15e-325">SMA is included with System Center; and therefore, requires a System Center 2012 R2 license.</span><span class="sxs-lookup"><span data-stu-id="ea15e-325">SMA is included with System Center; and therefore, requires a System Center 2012 R2 license.</span></span> <span data-ttu-id="ea15e-326">Azure Automation is based on a tiered subscription model.</span><span class="sxs-lookup"><span data-stu-id="ea15e-326">Azure Automation is based on a tiered subscription model.</span></span>
* <span data-ttu-id="ea15e-327">Azure Automation has advanced features such as graphical runbooks that are not available in SMA.</span><span class="sxs-lookup"><span data-stu-id="ea15e-327">Azure Automation has advanced features such as graphical runbooks that are not available in SMA.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ea15e-328">Next steps</span><span class="sxs-lookup"><span data-stu-id="ea15e-328">Next steps</span></span>
* <span data-ttu-id="ea15e-329">To learn more about the different methods that can be used to start a runbook, see [Starting a Runbook in Azure Automation](automation-starting-a-runbook.md).</span><span class="sxs-lookup"><span data-stu-id="ea15e-329">To learn more about the different methods that can be used to start a runbook, see [Starting a Runbook in Azure Automation](automation-starting-a-runbook.md).</span></span>  
* <span data-ttu-id="ea15e-330">To understand the different procedures for working with PowerShell and PowerShell Workflow runbooks in Azure Automation using the textual editor, see [Editing a Runbook in Azure Automation](automation-edit-textual-runbook.md)</span><span class="sxs-lookup"><span data-stu-id="ea15e-330">To understand the different procedures for working with PowerShell and PowerShell Workflow runbooks in Azure Automation using the textual editor, see [Editing a Runbook in Azure Automation](automation-edit-textual-runbook.md)</span></span>





