---
title: Azure Automation State Configuration Continuous Deployment with Chocolatey
description: DevOps continuous deployment using Azure Automation State Configuration, DSC, and Chocolatey package manager.  Example with full JSON Resource Manager template and PowerShell source.
services: automation
ms.service: automation
ms.component: dsc
author: DCtheGeek
ms.author: dacoulte
ms.date: 08/08/2018
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 100b3fa0e43be054a85ca9e32d9bb1b11033afb8
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44803236"
---
# <a name="usage-example-continuous-deployment-to-virtual-machines-using-automation-state-configuration-and-chocolatey"></a><span data-ttu-id="9f610-104">Usage Example: Continuous deployment to Virtual Machines using Automation State Configuration and Chocolatey</span><span class="sxs-lookup"><span data-stu-id="9f610-104">Usage Example: Continuous deployment to Virtual Machines using Automation State Configuration and Chocolatey</span></span>

<span data-ttu-id="9f610-105">In a DevOps world there are many tools to assist with various points in the Continuous Integration pipeline.</span><span class="sxs-lookup"><span data-stu-id="9f610-105">In a DevOps world there are many tools to assist with various points in the Continuous Integration pipeline.</span></span> <span data-ttu-id="9f610-106">Azure Automation State Configuration is a welcome new addition to the options that DevOps teams can employ.</span><span class="sxs-lookup"><span data-stu-id="9f610-106">Azure Automation State Configuration is a welcome new addition to the options that DevOps teams can employ.</span></span> <span data-ttu-id="9f610-107">This article demonstrates setting up Continuous Deployment (CD) for a Windows computer.</span><span class="sxs-lookup"><span data-stu-id="9f610-107">This article demonstrates setting up Continuous Deployment (CD) for a Windows computer.</span></span> <span data-ttu-id="9f610-108">You can easily extend the technique to include as many Windows computers as necessary in the role (a web site, for example), and from there to additional roles as well.</span><span class="sxs-lookup"><span data-stu-id="9f610-108">You can easily extend the technique to include as many Windows computers as necessary in the role (a web site, for example), and from there to additional roles as well.</span></span>

![Continuous Deployment for IaaS VMs](./media/automation-dsc-cd-chocolatey/cdforiaasvm.png)

## <a name="at-a-high-level"></a><span data-ttu-id="9f610-110">At a high level</span><span class="sxs-lookup"><span data-stu-id="9f610-110">At a high level</span></span>

<span data-ttu-id="9f610-111">There is quite a bit going on here, but fortunately it can be broken into two main processes:</span><span class="sxs-lookup"><span data-stu-id="9f610-111">There is quite a bit going on here, but fortunately it can be broken into two main processes:</span></span>

- <span data-ttu-id="9f610-112">Writing code and testing it, then creating and publishing installation packages for major and minor versions of the system.</span><span class="sxs-lookup"><span data-stu-id="9f610-112">Writing code and testing it, then creating and publishing installation packages for major and minor versions of the system.</span></span>
- <span data-ttu-id="9f610-113">Creating and managing VMs that will install and execute the code in the packages.</span><span class="sxs-lookup"><span data-stu-id="9f610-113">Creating and managing VMs that will install and execute the code in the packages.</span></span>  

<span data-ttu-id="9f610-114">Once both of these core processes are in place, it's a short step to automatically update the package running on any particular VM as new versions are created and deployed.</span><span class="sxs-lookup"><span data-stu-id="9f610-114">Once both of these core processes are in place, it's a short step to automatically update the package running on any particular VM as new versions are created and deployed.</span></span>

## <a name="component-overview"></a><span data-ttu-id="9f610-115">Component overview</span><span class="sxs-lookup"><span data-stu-id="9f610-115">Component overview</span></span>

<span data-ttu-id="9f610-116">Package managers such as [apt-get](https://en.wikipedia.org/wiki/Advanced_Packaging_Tool) are pretty well known in the Linux world, but not so much in the Windows world.</span><span class="sxs-lookup"><span data-stu-id="9f610-116">Package managers such as [apt-get](https://en.wikipedia.org/wiki/Advanced_Packaging_Tool) are pretty well known in the Linux world, but not so much in the Windows world.</span></span>
<span data-ttu-id="9f610-117">[Chocolatey](https://chocolatey.org/) is such a thing, and Scott Hanselman's [blog](http://www.hanselman.com/blog/IsTheWindowsUserReadyForAptget.aspx) on the topic is a great intro.</span><span class="sxs-lookup"><span data-stu-id="9f610-117">[Chocolatey](https://chocolatey.org/) is such a thing, and Scott Hanselman's [blog](http://www.hanselman.com/blog/IsTheWindowsUserReadyForAptget.aspx) on the topic is a great intro.</span></span> <span data-ttu-id="9f610-118">In a nutshell, Chocolatey allows you to install packages from a central repository of packages into a Windows system using the command line.</span><span class="sxs-lookup"><span data-stu-id="9f610-118">In a nutshell, Chocolatey allows you to install packages from a central repository of packages into a Windows system using the command line.</span></span> <span data-ttu-id="9f610-119">You can create and manage your own repository, and Chocolatey can install packages from any number of repositories that you designate.</span><span class="sxs-lookup"><span data-stu-id="9f610-119">You can create and manage your own repository, and Chocolatey can install packages from any number of repositories that you designate.</span></span>

<span data-ttu-id="9f610-120">Desired State Configuration (DSC) ([overview](/powershell/dsc/overview)) is a PowerShell tool that allows you to declare the configuration that you want for a machine.</span><span class="sxs-lookup"><span data-stu-id="9f610-120">Desired State Configuration (DSC) ([overview](/powershell/dsc/overview)) is a PowerShell tool that allows you to declare the configuration that you want for a machine.</span></span> <span data-ttu-id="9f610-121">For example, you can say, "I want Chocolatey installed, I want IIS installed, I want port 80 opened, I want version 1.0.0 of my website installed."</span><span class="sxs-lookup"><span data-stu-id="9f610-121">For example, you can say, "I want Chocolatey installed, I want IIS installed, I want port 80 opened, I want version 1.0.0 of my website installed."</span></span> <span data-ttu-id="9f610-122">The DSC Local Configuration Manager (LCM) implements that configuration.</span><span class="sxs-lookup"><span data-stu-id="9f610-122">The DSC Local Configuration Manager (LCM) implements that configuration.</span></span> <span data-ttu-id="9f610-123">A DSC Pull Server holds a repository of configurations for your machines.</span><span class="sxs-lookup"><span data-stu-id="9f610-123">A DSC Pull Server holds a repository of configurations for your machines.</span></span> <span data-ttu-id="9f610-124">The LCM on each machine checks in periodically to see if its configuration matches the stored configuration.</span><span class="sxs-lookup"><span data-stu-id="9f610-124">The LCM on each machine checks in periodically to see if its configuration matches the stored configuration.</span></span> <span data-ttu-id="9f610-125">It can either report status or attempt to bring the machine back into alignment with the stored configuration.</span><span class="sxs-lookup"><span data-stu-id="9f610-125">It can either report status or attempt to bring the machine back into alignment with the stored configuration.</span></span> <span data-ttu-id="9f610-126">You can edit the stored configuration on the pull server to cause a machine or set of machines to come into alignment with the changed configuration.</span><span class="sxs-lookup"><span data-stu-id="9f610-126">You can edit the stored configuration on the pull server to cause a machine or set of machines to come into alignment with the changed configuration.</span></span>

<span data-ttu-id="9f610-127">Azure Automation is a managed service in Microsoft Azure that allows you to automate various tasks using runbooks, nodes, credentials, resources and assets such as schedules and global variables.</span><span class="sxs-lookup"><span data-stu-id="9f610-127">Azure Automation is a managed service in Microsoft Azure that allows you to automate various tasks using runbooks, nodes, credentials, resources and assets such as schedules and global variables.</span></span>
<span data-ttu-id="9f610-128">Azure Automation State Configuration extends this automation capability to include PowerShell DSC tools.</span><span class="sxs-lookup"><span data-stu-id="9f610-128">Azure Automation State Configuration extends this automation capability to include PowerShell DSC tools.</span></span> <span data-ttu-id="9f610-129">Here's a great [overview](automation-dsc-overview.md).</span><span class="sxs-lookup"><span data-stu-id="9f610-129">Here's a great [overview](automation-dsc-overview.md).</span></span>

<span data-ttu-id="9f610-130">A DSC Resource is a module of code that has specific capabilities, such as managing networking, Active Directory, or SQL Server.</span><span class="sxs-lookup"><span data-stu-id="9f610-130">A DSC Resource is a module of code that has specific capabilities, such as managing networking, Active Directory, or SQL Server.</span></span> <span data-ttu-id="9f610-131">The Chocolatey DSC Resource knows how to access a NuGet Server (among others), download packages, install packages, and so on.</span><span class="sxs-lookup"><span data-stu-id="9f610-131">The Chocolatey DSC Resource knows how to access a NuGet Server (among others), download packages, install packages, and so on.</span></span> <span data-ttu-id="9f610-132">There are many other DSC Resources in the [PowerShell Gallery](http://www.powershellgallery.com/packages?q=dsc+resources&prerelease=&sortOrder=package-title).</span><span class="sxs-lookup"><span data-stu-id="9f610-132">There are many other DSC Resources in the [PowerShell Gallery](http://www.powershellgallery.com/packages?q=dsc+resources&prerelease=&sortOrder=package-title).</span></span>
<span data-ttu-id="9f610-133">These modules are installed into your Azure Automation State Configuration Pull Server (by you) so they can be used by your configurations.</span><span class="sxs-lookup"><span data-stu-id="9f610-133">These modules are installed into your Azure Automation State Configuration Pull Server (by you) so they can be used by your configurations.</span></span>

<span data-ttu-id="9f610-134">Resource Manager templates provide a declarative way of generating your infrastructure - things like networks, subnets, network security and routing, load balancers, NICs, VMs, and so on.</span><span class="sxs-lookup"><span data-stu-id="9f610-134">Resource Manager templates provide a declarative way of generating your infrastructure - things like networks, subnets, network security and routing, load balancers, NICs, VMs, and so on.</span></span> <span data-ttu-id="9f610-135">Here's an [article](../azure-resource-manager/resource-manager-deployment-model.md) that compares the Resource Manager deployment model (declarative) with the Azure Service Management (ASM or classic) deployment model (imperative), and discusses the core resource providers, compute, storage and network.</span><span class="sxs-lookup"><span data-stu-id="9f610-135">Here's an [article](../azure-resource-manager/resource-manager-deployment-model.md) that compares the Resource Manager deployment model (declarative) with the Azure Service Management (ASM or classic) deployment model (imperative), and discusses the core resource providers, compute, storage and network.</span></span>

<span data-ttu-id="9f610-136">One key feature of an Resource Manager template is its ability to install a VM extension into the VM as it's provisioned.</span><span class="sxs-lookup"><span data-stu-id="9f610-136">One key feature of an Resource Manager template is its ability to install a VM extension into the VM as it's provisioned.</span></span> <span data-ttu-id="9f610-137">A VM extension has specific capabilities such as running a custom script, installing anti-virus software, or running a DSC configuration script.</span><span class="sxs-lookup"><span data-stu-id="9f610-137">A VM extension has specific capabilities such as running a custom script, installing anti-virus software, or running a DSC configuration script.</span></span> <span data-ttu-id="9f610-138">There are many other types of VM extensions.</span><span class="sxs-lookup"><span data-stu-id="9f610-138">There are many other types of VM extensions.</span></span>

## <a name="quick-trip-around-the-diagram"></a><span data-ttu-id="9f610-139">Quick trip around the diagram</span><span class="sxs-lookup"><span data-stu-id="9f610-139">Quick trip around the diagram</span></span>

<span data-ttu-id="9f610-140">Starting at the top, you write your code, build and test, then create an installation package.</span><span class="sxs-lookup"><span data-stu-id="9f610-140">Starting at the top, you write your code, build and test, then create an installation package.</span></span>
<span data-ttu-id="9f610-141">Chocolatey can handle various types of installation packages, such as MSI, MSU, ZIP.</span><span class="sxs-lookup"><span data-stu-id="9f610-141">Chocolatey can handle various types of installation packages, such as MSI, MSU, ZIP.</span></span> <span data-ttu-id="9f610-142">And you have the full power of PowerShell to do the actual installation if Chocolateys native capabilities aren't quite up to it.</span><span class="sxs-lookup"><span data-stu-id="9f610-142">And you have the full power of PowerShell to do the actual installation if Chocolateys native capabilities aren't quite up to it.</span></span> <span data-ttu-id="9f610-143">Put the package into someplace reachable – a package repository.</span><span class="sxs-lookup"><span data-stu-id="9f610-143">Put the package into someplace reachable – a package repository.</span></span> <span data-ttu-id="9f610-144">This usage example uses a public folder in an Azure blob storage account, but it can be anywhere.</span><span class="sxs-lookup"><span data-stu-id="9f610-144">This usage example uses a public folder in an Azure blob storage account, but it can be anywhere.</span></span> <span data-ttu-id="9f610-145">Chocolatey works natively with NuGet servers and a few others for management of package metadata.</span><span class="sxs-lookup"><span data-stu-id="9f610-145">Chocolatey works natively with NuGet servers and a few others for management of package metadata.</span></span> <span data-ttu-id="9f610-146">[This article](https://github.com/chocolatey/choco/wiki/How-To-Host-Feed) describes the options.</span><span class="sxs-lookup"><span data-stu-id="9f610-146">[This article](https://github.com/chocolatey/choco/wiki/How-To-Host-Feed) describes the options.</span></span> <span data-ttu-id="9f610-147">This usage example uses NuGet.</span><span class="sxs-lookup"><span data-stu-id="9f610-147">This usage example uses NuGet.</span></span> <span data-ttu-id="9f610-148">A Nuspec is metadata about your packages.</span><span class="sxs-lookup"><span data-stu-id="9f610-148">A Nuspec is metadata about your packages.</span></span> <span data-ttu-id="9f610-149">The Nuspec's are “compiled” into NuPkg's and stored in a NuGet server.</span><span class="sxs-lookup"><span data-stu-id="9f610-149">The Nuspec's are “compiled” into NuPkg's and stored in a NuGet server.</span></span> <span data-ttu-id="9f610-150">When your configuration requests a package by name, and references a NuGet server, the Chocolatey DSC Resource (now on the VM) grabs the package and installs it for you.</span><span class="sxs-lookup"><span data-stu-id="9f610-150">When your configuration requests a package by name, and references a NuGet server, the Chocolatey DSC Resource (now on the VM) grabs the package and installs it for you.</span></span> <span data-ttu-id="9f610-151">You can also request a specific version of a package.</span><span class="sxs-lookup"><span data-stu-id="9f610-151">You can also request a specific version of a package.</span></span>

<span data-ttu-id="9f610-152">In the bottom left portion of the picture, there is an Azure Resource Manager template.</span><span class="sxs-lookup"><span data-stu-id="9f610-152">In the bottom left portion of the picture, there is an Azure Resource Manager template.</span></span> <span data-ttu-id="9f610-153">In this usage example, the VM extension registers the VM with the Azure Automation State Configuration Pull Server (that is, a pull server) as a Node.</span><span class="sxs-lookup"><span data-stu-id="9f610-153">In this usage example, the VM extension registers the VM with the Azure Automation State Configuration Pull Server (that is, a pull server) as a Node.</span></span> <span data-ttu-id="9f610-154">The configuration is stored in the pull server.</span><span class="sxs-lookup"><span data-stu-id="9f610-154">The configuration is stored in the pull server.</span></span>
<span data-ttu-id="9f610-155">Actually, it's stored twice: once as plain text and once compiled as an MOF file (for those that know about such things.) In the portal, the MOF is a “node configuration” (as opposed to simply “configuration”).</span><span class="sxs-lookup"><span data-stu-id="9f610-155">Actually, it's stored twice: once as plain text and once compiled as an MOF file (for those that know about such things.) In the portal, the MOF is a “node configuration” (as opposed to simply “configuration”).</span></span> <span data-ttu-id="9f610-156">It's the artifact that's associated with a Node so the node will know its configuration.</span><span class="sxs-lookup"><span data-stu-id="9f610-156">It's the artifact that's associated with a Node so the node will know its configuration.</span></span> <span data-ttu-id="9f610-157">Details below show how to assign the node configuration to the node.</span><span class="sxs-lookup"><span data-stu-id="9f610-157">Details below show how to assign the node configuration to the node.</span></span>

<span data-ttu-id="9f610-158">Presumably you're already doing the bit at the top, or most of it.</span><span class="sxs-lookup"><span data-stu-id="9f610-158">Presumably you're already doing the bit at the top, or most of it.</span></span> <span data-ttu-id="9f610-159">Creating the nuspec, compiling and storing it in a NuGet server is a small thing.</span><span class="sxs-lookup"><span data-stu-id="9f610-159">Creating the nuspec, compiling and storing it in a NuGet server is a small thing.</span></span> <span data-ttu-id="9f610-160">And you're already managing VMs.</span><span class="sxs-lookup"><span data-stu-id="9f610-160">And you're already managing VMs.</span></span> <span data-ttu-id="9f610-161">Taking the next step to continuous deployment requires setting up the pull server (once), registering your nodes with it (once), and creating and storing the configuration there (initially).</span><span class="sxs-lookup"><span data-stu-id="9f610-161">Taking the next step to continuous deployment requires setting up the pull server (once), registering your nodes with it (once), and creating and storing the configuration there (initially).</span></span> <span data-ttu-id="9f610-162">Then as packages are upgraded and deployed to the repository, refresh the Configuration and Node Configuration in the pull server (repeat as needed).</span><span class="sxs-lookup"><span data-stu-id="9f610-162">Then as packages are upgraded and deployed to the repository, refresh the Configuration and Node Configuration in the pull server (repeat as needed).</span></span>

<span data-ttu-id="9f610-163">If you're not starting with an Resource Manager template, that's also OK.</span><span class="sxs-lookup"><span data-stu-id="9f610-163">If you're not starting with an Resource Manager template, that's also OK.</span></span> <span data-ttu-id="9f610-164">There are PowerShell cmdlets designed to help you register your VMs with the pull server and all of the rest.</span><span class="sxs-lookup"><span data-stu-id="9f610-164">There are PowerShell cmdlets designed to help you register your VMs with the pull server and all of the rest.</span></span> <span data-ttu-id="9f610-165">For more details, see this article: [Onboarding machines for management by Azure Automation State Configuration](automation-dsc-onboarding.md).</span><span class="sxs-lookup"><span data-stu-id="9f610-165">For more details, see this article: [Onboarding machines for management by Azure Automation State Configuration](automation-dsc-onboarding.md).</span></span>

## <a name="step-1-setting-up-the-pull-server-and-automation-account"></a><span data-ttu-id="9f610-166">Step 1: Setting up the pull server and automation account</span><span class="sxs-lookup"><span data-stu-id="9f610-166">Step 1: Setting up the pull server and automation account</span></span>

<span data-ttu-id="9f610-167">At an authenticated (`Connect-AzureRmAccount`) PowerShell command line: (can take a few minutes while the pull server is set up)</span><span class="sxs-lookup"><span data-stu-id="9f610-167">At an authenticated (`Connect-AzureRmAccount`) PowerShell command line: (can take a few minutes while the pull server is set up)</span></span>

    New-AzureRmResourceGroup –Name MY-AUTOMATION-RG –Location MY-RG-LOCATION-IN-QUOTES
    New-AzureRmAutomationAccount –ResourceGroupName MY-AUTOMATION-RG –Location MY-RG-LOCATION-IN-QUOTES –Name MY-AUTOMATION-ACCOUNT

<span data-ttu-id="9f610-168">You can put your automation account into any of the following regions (aka location): East US 2, South Central US, US Gov Virginia, West Europe, Southeast Asia, Japan East, Central India and Australia Southeast, Canada Central, North Europe.</span><span class="sxs-lookup"><span data-stu-id="9f610-168">You can put your automation account into any of the following regions (aka location): East US 2, South Central US, US Gov Virginia, West Europe, Southeast Asia, Japan East, Central India and Australia Southeast, Canada Central, North Europe.</span></span>

## <a name="step-2-vm-extension-tweaks-to-the-resource-manager-template"></a><span data-ttu-id="9f610-169">Step 2: VM extension tweaks to the Resource Manager template</span><span class="sxs-lookup"><span data-stu-id="9f610-169">Step 2: VM extension tweaks to the Resource Manager template</span></span>

<span data-ttu-id="9f610-170">Details for VM registration (using the PowerShell DSC VM extension) provided in this [Azure Quickstart Template](https://github.com/Azure/azure-quickstart-templates/tree/master/dsc-extension-azure-automation-pullserver).</span><span class="sxs-lookup"><span data-stu-id="9f610-170">Details for VM registration (using the PowerShell DSC VM extension) provided in this [Azure Quickstart Template](https://github.com/Azure/azure-quickstart-templates/tree/master/dsc-extension-azure-automation-pullserver).</span></span>
<span data-ttu-id="9f610-171">This step registers your new VM with the pull server in the list of State Configuration Nodes.</span><span class="sxs-lookup"><span data-stu-id="9f610-171">This step registers your new VM with the pull server in the list of State Configuration Nodes.</span></span> <span data-ttu-id="9f610-172">Part of this registration is specifying the node configuration to be applied to the node.</span><span class="sxs-lookup"><span data-stu-id="9f610-172">Part of this registration is specifying the node configuration to be applied to the node.</span></span> <span data-ttu-id="9f610-173">This node configuration doesn't have to exist yet in the pull server, so it's OK that Step 4 is where this is done for the first time.</span><span class="sxs-lookup"><span data-stu-id="9f610-173">This node configuration doesn't have to exist yet in the pull server, so it's OK that Step 4 is where this is done for the first time.</span></span> <span data-ttu-id="9f610-174">But here in Step 2 you do need to have decided the name of the node and the name of the configuration.</span><span class="sxs-lookup"><span data-stu-id="9f610-174">But here in Step 2 you do need to have decided the name of the node and the name of the configuration.</span></span> <span data-ttu-id="9f610-175">In this usage example, the node is 'isvbox' and the configuration is 'ISVBoxConfig'.</span><span class="sxs-lookup"><span data-stu-id="9f610-175">In this usage example, the node is 'isvbox' and the configuration is 'ISVBoxConfig'.</span></span> <span data-ttu-id="9f610-176">So the node configuration name (to be specified in DeploymentTemplate.json) is 'ISVBoxConfig.isvbox'.</span><span class="sxs-lookup"><span data-stu-id="9f610-176">So the node configuration name (to be specified in DeploymentTemplate.json) is 'ISVBoxConfig.isvbox'.</span></span>

## <a name="step-3-adding-required-dsc-resources-to-the-pull-server"></a><span data-ttu-id="9f610-177">Step 3: Adding required DSC resources to the pull server</span><span class="sxs-lookup"><span data-stu-id="9f610-177">Step 3: Adding required DSC resources to the pull server</span></span>

<span data-ttu-id="9f610-178">The PowerShell Gallery is instrumented to install DSC resources into your Azure Automation account.</span><span class="sxs-lookup"><span data-stu-id="9f610-178">The PowerShell Gallery is instrumented to install DSC resources into your Azure Automation account.</span></span>
<span data-ttu-id="9f610-179">Navigate to the resource you want and click the “Deploy to Azure Automation” button.</span><span class="sxs-lookup"><span data-stu-id="9f610-179">Navigate to the resource you want and click the “Deploy to Azure Automation” button.</span></span>

![PowerShell Gallery example](./media/automation-dsc-cd-chocolatey/xNetworking.PNG)

<span data-ttu-id="9f610-181">Another technique recently added to the Azure Portal allows you to pull in new modules or update existing modules.</span><span class="sxs-lookup"><span data-stu-id="9f610-181">Another technique recently added to the Azure Portal allows you to pull in new modules or update existing modules.</span></span> <span data-ttu-id="9f610-182">Click through the Automation Account resource, the Assets tile, and finally the Modules tile.</span><span class="sxs-lookup"><span data-stu-id="9f610-182">Click through the Automation Account resource, the Assets tile, and finally the Modules tile.</span></span> <span data-ttu-id="9f610-183">The Browse Gallery icon allows you to see the list of modules in the gallery, drill down into details and ultimately import into your Automation Account.</span><span class="sxs-lookup"><span data-stu-id="9f610-183">The Browse Gallery icon allows you to see the list of modules in the gallery, drill down into details and ultimately import into your Automation Account.</span></span> <span data-ttu-id="9f610-184">This is a great way to keep your modules up to date from time to time.</span><span class="sxs-lookup"><span data-stu-id="9f610-184">This is a great way to keep your modules up to date from time to time.</span></span> <span data-ttu-id="9f610-185">And, the import feature checks dependencies with other modules to ensure nothing gets out of sync.</span><span class="sxs-lookup"><span data-stu-id="9f610-185">And, the import feature checks dependencies with other modules to ensure nothing gets out of sync.</span></span>

<span data-ttu-id="9f610-186">Or, there's the manual approach.</span><span class="sxs-lookup"><span data-stu-id="9f610-186">Or, there's the manual approach.</span></span> <span data-ttu-id="9f610-187">The folder structure of a PowerShell Integration Module for a Windows computer is a little different from the folder structure expected by the Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="9f610-187">The folder structure of a PowerShell Integration Module for a Windows computer is a little different from the folder structure expected by the Azure Automation.</span></span>
<span data-ttu-id="9f610-188">This requires a little tweaking on your part.</span><span class="sxs-lookup"><span data-stu-id="9f610-188">This requires a little tweaking on your part.</span></span> <span data-ttu-id="9f610-189">But it's not hard, and it's done only once per resource (unless you want to upgrade it in future.) For more information on authoring PowerShell Integration Modules, see this article: [Authoring Integration Modules for Azure Automation](https://azure.microsoft.com/blog/authoring-integration-modules-for-azure-automation/)</span><span class="sxs-lookup"><span data-stu-id="9f610-189">But it's not hard, and it's done only once per resource (unless you want to upgrade it in future.) For more information on authoring PowerShell Integration Modules, see this article: [Authoring Integration Modules for Azure Automation](https://azure.microsoft.com/blog/authoring-integration-modules-for-azure-automation/)</span></span>

- <span data-ttu-id="9f610-190">Install the module that you need on your workstation, as follows:</span><span class="sxs-lookup"><span data-stu-id="9f610-190">Install the module that you need on your workstation, as follows:</span></span>
  - <span data-ttu-id="9f610-191">Install [Windows Management Framework, v5](http://aka.ms/wmf5latest) (not needed for Windows 10)</span><span class="sxs-lookup"><span data-stu-id="9f610-191">Install [Windows Management Framework, v5](http://aka.ms/wmf5latest) (not needed for Windows 10)</span></span>
  - <span data-ttu-id="9f610-192">`Install-Module –Name MODULE-NAME`    <—grabs the module from the PowerShell Gallery</span><span class="sxs-lookup"><span data-stu-id="9f610-192">`Install-Module –Name MODULE-NAME`    <—grabs the module from the PowerShell Gallery</span></span>
- <span data-ttu-id="9f610-193">Copy the module folder from `c:\Program Files\WindowsPowerShell\Modules\MODULE-NAME` to a temp folder</span><span class="sxs-lookup"><span data-stu-id="9f610-193">Copy the module folder from `c:\Program Files\WindowsPowerShell\Modules\MODULE-NAME` to a temp folder</span></span>
- <span data-ttu-id="9f610-194">Delete samples and documentation from the main folder</span><span class="sxs-lookup"><span data-stu-id="9f610-194">Delete samples and documentation from the main folder</span></span>
- <span data-ttu-id="9f610-195">Zip the main folder, naming the ZIP file exactly the same as the folder</span><span class="sxs-lookup"><span data-stu-id="9f610-195">Zip the main folder, naming the ZIP file exactly the same as the folder</span></span> 
- <span data-ttu-id="9f610-196">Put the ZIP file into a reachable HTTP location, such as blob storage in an Azure Storage Account.</span><span class="sxs-lookup"><span data-stu-id="9f610-196">Put the ZIP file into a reachable HTTP location, such as blob storage in an Azure Storage Account.</span></span>
- <span data-ttu-id="9f610-197">Run this PowerShell:</span><span class="sxs-lookup"><span data-stu-id="9f610-197">Run this PowerShell:</span></span>

  ```powershell
  New-AzureRmAutomationModule `
    -ResourceGroupName MY-AUTOMATION-RG -AutomationAccountName MY-AUTOMATION-ACCOUNT `
    -Name MODULE-NAME –ContentLink 'https://STORAGE-URI/CONTAINERNAME/MODULE-NAME.zip'
  ```

<span data-ttu-id="9f610-198">The included example performs these steps for cChoco and xNetworking.</span><span class="sxs-lookup"><span data-stu-id="9f610-198">The included example performs these steps for cChoco and xNetworking.</span></span> <span data-ttu-id="9f610-199">See the [Notes](#notes) for special handling for cChoco.</span><span class="sxs-lookup"><span data-stu-id="9f610-199">See the [Notes](#notes) for special handling for cChoco.</span></span>

## <a name="step-4-adding-the-node-configuration-to-the-pull-server"></a><span data-ttu-id="9f610-200">Step 4: Adding the node configuration to the pull server</span><span class="sxs-lookup"><span data-stu-id="9f610-200">Step 4: Adding the node configuration to the pull server</span></span>

<span data-ttu-id="9f610-201">There's nothing special about the first time you import your configuration into the pull server and compile.</span><span class="sxs-lookup"><span data-stu-id="9f610-201">There's nothing special about the first time you import your configuration into the pull server and compile.</span></span> <span data-ttu-id="9f610-202">All subsequent import/compiles of the same configuration look exactly the same.</span><span class="sxs-lookup"><span data-stu-id="9f610-202">All subsequent import/compiles of the same configuration look exactly the same.</span></span> <span data-ttu-id="9f610-203">Each time you update your package and need to push it out to production you do this step after ensuring the configuration file is correct – including the new version of your package.</span><span class="sxs-lookup"><span data-stu-id="9f610-203">Each time you update your package and need to push it out to production you do this step after ensuring the configuration file is correct – including the new version of your package.</span></span> <span data-ttu-id="9f610-204">Here's the configuration file and PowerShell:</span><span class="sxs-lookup"><span data-stu-id="9f610-204">Here's the configuration file and PowerShell:</span></span>

<span data-ttu-id="9f610-205">ISVBoxConfig.ps1:</span><span class="sxs-lookup"><span data-stu-id="9f610-205">ISVBoxConfig.ps1:</span></span>

```powershell
Configuration ISVBoxConfig
{
    Import-DscResource -ModuleName cChoco
    Import-DscResource -ModuleName xNetworking

    Node 'isvbox' {

        cChocoInstaller installChoco
        {
            InstallDir = 'C:\choco'
        }

        WindowsFeature installIIS
        {
            Ensure = 'Present'
            Name   = 'Web-Server'
        }

        xFirewall WebFirewallRule
        {
            Direction    = 'Inbound'
            Name         = 'Web-Server-TCP-In'
            DisplayName  = 'Web Server (TCP-In)'
            Description  = 'IIS allow incoming web site traffic.'
            DisplayGroup = 'IIS Incoming Traffic'
            State        = 'Enabled'
            Access       = 'Allow'
            Protocol     = 'TCP'
            LocalPort    = '80'
            Ensure       = 'Present'
        }

        cChocoPackageInstaller trivialWeb
        {
            Name      = 'trivialweb'
            Version   = '1.0.0'
            Source    = 'MY-NUGET-V2-SERVER-ADDRESS'
            DependsOn = '[cChocoInstaller]installChoco','[WindowsFeature]installIIS'
        }
    }
}
```

<span data-ttu-id="9f610-206">New-ConfigurationScript.ps1:</span><span class="sxs-lookup"><span data-stu-id="9f610-206">New-ConfigurationScript.ps1:</span></span>

```powershell
Import-AzureRmAutomationDscConfiguration `
    -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT `
    -SourcePath C:\temp\AzureAutomationDsc\ISVBoxConfig.ps1 `
    -Published –Force

$jobData = Start-AzureRmAutomationDscCompilationJob `
    -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT `
    -ConfigurationName ISVBoxConfig

$compilationJobId = $jobData.Id

Get-AzureRmAutomationDscCompilationJob `
    -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT `
    -Id $compilationJobId
```

<span data-ttu-id="9f610-207">These steps result in a new node configuration named “ISVBoxConfig.isvbox” being placed on the pull server.</span><span class="sxs-lookup"><span data-stu-id="9f610-207">These steps result in a new node configuration named “ISVBoxConfig.isvbox” being placed on the pull server.</span></span> <span data-ttu-id="9f610-208">The node configuration name is built as “configurationName.nodeName”.</span><span class="sxs-lookup"><span data-stu-id="9f610-208">The node configuration name is built as “configurationName.nodeName”.</span></span>

## <a name="step-5-creating-and-maintaining-package-metadata"></a><span data-ttu-id="9f610-209">Step 5: Creating and maintaining package metadata</span><span class="sxs-lookup"><span data-stu-id="9f610-209">Step 5: Creating and maintaining package metadata</span></span>

<span data-ttu-id="9f610-210">For each package that you put into the package repository, you need a nuspec that describes it.</span><span class="sxs-lookup"><span data-stu-id="9f610-210">For each package that you put into the package repository, you need a nuspec that describes it.</span></span>
<span data-ttu-id="9f610-211">That nuspec must be compiled and stored in your NuGet server.</span><span class="sxs-lookup"><span data-stu-id="9f610-211">That nuspec must be compiled and stored in your NuGet server.</span></span> <span data-ttu-id="9f610-212">This process is described [here](http://docs.nuget.org/create/creating-and-publishing-a-package).</span><span class="sxs-lookup"><span data-stu-id="9f610-212">This process is described [here](http://docs.nuget.org/create/creating-and-publishing-a-package).</span></span> <span data-ttu-id="9f610-213">You can use MyGet.org as a NuGet server.</span><span class="sxs-lookup"><span data-stu-id="9f610-213">You can use MyGet.org as a NuGet server.</span></span> <span data-ttu-id="9f610-214">They sell this service, but have a starter SKU that's free.</span><span class="sxs-lookup"><span data-stu-id="9f610-214">They sell this service, but have a starter SKU that's free.</span></span> <span data-ttu-id="9f610-215">At NuGet.org you'll find instructions on installing your own NuGet server for your private packages.</span><span class="sxs-lookup"><span data-stu-id="9f610-215">At NuGet.org you'll find instructions on installing your own NuGet server for your private packages.</span></span>

## <a name="step-6-tying-it-all-together"></a><span data-ttu-id="9f610-216">Step 6: Tying it all together</span><span class="sxs-lookup"><span data-stu-id="9f610-216">Step 6: Tying it all together</span></span>

<span data-ttu-id="9f610-217">Each time a version passes QA and is approved for deployment, the package is created, nuspec and nupkg updated and deployed to the NuGet server.</span><span class="sxs-lookup"><span data-stu-id="9f610-217">Each time a version passes QA and is approved for deployment, the package is created, nuspec and nupkg updated and deployed to the NuGet server.</span></span> <span data-ttu-id="9f610-218">In addition, the configuration (Step 4 above) must be updated to agree with the new version number.</span><span class="sxs-lookup"><span data-stu-id="9f610-218">In addition, the configuration (Step 4 above) must be updated to agree with the new version number.</span></span> <span data-ttu-id="9f610-219">It must be sent to the pull server and compiled.</span><span class="sxs-lookup"><span data-stu-id="9f610-219">It must be sent to the pull server and compiled.</span></span>
<span data-ttu-id="9f610-220">From that point on, it's up to the VMs that depend on that configuration to pull the update and install it.</span><span class="sxs-lookup"><span data-stu-id="9f610-220">From that point on, it's up to the VMs that depend on that configuration to pull the update and install it.</span></span> <span data-ttu-id="9f610-221">Each of these updates are simple - just a line or two of PowerShell.</span><span class="sxs-lookup"><span data-stu-id="9f610-221">Each of these updates are simple - just a line or two of PowerShell.</span></span> <span data-ttu-id="9f610-222">In the case of Azure DevOps, some of them are encapsulated in build tasks that can be chained together in a build.</span><span class="sxs-lookup"><span data-stu-id="9f610-222">In the case of Azure DevOps, some of them are encapsulated in build tasks that can be chained together in a build.</span></span> <span data-ttu-id="9f610-223">This [article](https://www.visualstudio.com/docs/alm-devops-feature-index#continuous-delivery) provides more details.</span><span class="sxs-lookup"><span data-stu-id="9f610-223">This [article](https://www.visualstudio.com/docs/alm-devops-feature-index#continuous-delivery) provides more details.</span></span> <span data-ttu-id="9f610-224">This [GitHub repo](https://github.com/Microsoft/vso-agent-tasks) details the various available build tasks.</span><span class="sxs-lookup"><span data-stu-id="9f610-224">This [GitHub repo](https://github.com/Microsoft/vso-agent-tasks) details the various available build tasks.</span></span>

## <a name="notes"></a><span data-ttu-id="9f610-225">Notes</span><span class="sxs-lookup"><span data-stu-id="9f610-225">Notes</span></span>

<span data-ttu-id="9f610-226">This usage example starts with a VM from a generic Windows Server 2012 R2 image from the Azure gallery.</span><span class="sxs-lookup"><span data-stu-id="9f610-226">This usage example starts with a VM from a generic Windows Server 2012 R2 image from the Azure gallery.</span></span> <span data-ttu-id="9f610-227">You can start from any stored image and then tweak from there with the DSC configuration.</span><span class="sxs-lookup"><span data-stu-id="9f610-227">You can start from any stored image and then tweak from there with the DSC configuration.</span></span>
<span data-ttu-id="9f610-228">However, changing configuration that is baked into an image is much harder than dynamically updating the configuration using DSC.</span><span class="sxs-lookup"><span data-stu-id="9f610-228">However, changing configuration that is baked into an image is much harder than dynamically updating the configuration using DSC.</span></span>

<span data-ttu-id="9f610-229">You don't have to use a Resource Manager template and the VM extension to use this technique with your VMs.</span><span class="sxs-lookup"><span data-stu-id="9f610-229">You don't have to use a Resource Manager template and the VM extension to use this technique with your VMs.</span></span> <span data-ttu-id="9f610-230">And your VMs don't have to be on Azure to be under CD management.</span><span class="sxs-lookup"><span data-stu-id="9f610-230">And your VMs don't have to be on Azure to be under CD management.</span></span> <span data-ttu-id="9f610-231">All that's necessary is that Chocolatey be installed and the LCM configured on the VM so it knows where the pull server is.</span><span class="sxs-lookup"><span data-stu-id="9f610-231">All that's necessary is that Chocolatey be installed and the LCM configured on the VM so it knows where the pull server is.</span></span>

<span data-ttu-id="9f610-232">Of course, when you update a package on a VM that's in production, you need to take that VM out of rotation while the update is installed.</span><span class="sxs-lookup"><span data-stu-id="9f610-232">Of course, when you update a package on a VM that's in production, you need to take that VM out of rotation while the update is installed.</span></span> <span data-ttu-id="9f610-233">How you do this varies widely.</span><span class="sxs-lookup"><span data-stu-id="9f610-233">How you do this varies widely.</span></span> <span data-ttu-id="9f610-234">For example, with a VM behind an Azure Load Balancer, you can add a Custom Probe.</span><span class="sxs-lookup"><span data-stu-id="9f610-234">For example, with a VM behind an Azure Load Balancer, you can add a Custom Probe.</span></span> <span data-ttu-id="9f610-235">While updating the VM, have the probe endpoint return a 400.</span><span class="sxs-lookup"><span data-stu-id="9f610-235">While updating the VM, have the probe endpoint return a 400.</span></span> <span data-ttu-id="9f610-236">The tweak necessary to cause this change can be inside your configuration, as can the tweak to switch it back to returning a 200 once the update is complete.</span><span class="sxs-lookup"><span data-stu-id="9f610-236">The tweak necessary to cause this change can be inside your configuration, as can the tweak to switch it back to returning a 200 once the update is complete.</span></span>

<span data-ttu-id="9f610-237">Full source for this usage example is in [this Visual Studio project](https://github.com/sebastus/ARM/tree/master/CDIaaSVM) on GitHub.</span><span class="sxs-lookup"><span data-stu-id="9f610-237">Full source for this usage example is in [this Visual Studio project](https://github.com/sebastus/ARM/tree/master/CDIaaSVM) on GitHub.</span></span>

## <a name="related-articles"></a><span data-ttu-id="9f610-238">Related Articles</span><span class="sxs-lookup"><span data-stu-id="9f610-238">Related Articles</span></span>
* [<span data-ttu-id="9f610-239">Azure Automation DSC Overview</span><span class="sxs-lookup"><span data-stu-id="9f610-239">Azure Automation DSC Overview</span></span>](automation-dsc-overview.md)
* [<span data-ttu-id="9f610-240">Azure Automation DSC cmdlets</span><span class="sxs-lookup"><span data-stu-id="9f610-240">Azure Automation DSC cmdlets</span></span>](https://docs.microsoft.com/powershell/module/azurerm.automation#automation)
* [<span data-ttu-id="9f610-241">Onboarding machines for management by Azure Automation DSC</span><span class="sxs-lookup"><span data-stu-id="9f610-241">Onboarding machines for management by Azure Automation DSC</span></span>](automation-dsc-onboarding.md)

## <a name="next-steps"></a><span data-ttu-id="9f610-242">Next steps</span><span class="sxs-lookup"><span data-stu-id="9f610-242">Next steps</span></span>

- <span data-ttu-id="9f610-243">For an overview, see [Azure Automation State Configuration](automation-dsc-overview.md)</span><span class="sxs-lookup"><span data-stu-id="9f610-243">For an overview, see [Azure Automation State Configuration](automation-dsc-overview.md)</span></span>
- <span data-ttu-id="9f610-244">To get started, see [Getting started with Azure Automation State Configuration](automation-dsc-getting-started.md)</span><span class="sxs-lookup"><span data-stu-id="9f610-244">To get started, see [Getting started with Azure Automation State Configuration](automation-dsc-getting-started.md)</span></span>
- <span data-ttu-id="9f610-245">To learn about compiling DSC configurations so that you can assign them to target nodes, see [Compiling configurations in Azure Automation State Configuration](automation-dsc-compile.md)</span><span class="sxs-lookup"><span data-stu-id="9f610-245">To learn about compiling DSC configurations so that you can assign them to target nodes, see [Compiling configurations in Azure Automation State Configuration](automation-dsc-compile.md)</span></span>
- <span data-ttu-id="9f610-246">For PowerShell cmdlet reference, see [Azure Automation State Configuration cmdlets](/powershell/module/azurerm.automation/#automation)</span><span class="sxs-lookup"><span data-stu-id="9f610-246">For PowerShell cmdlet reference, see [Azure Automation State Configuration cmdlets](/powershell/module/azurerm.automation/#automation)</span></span>
- <span data-ttu-id="9f610-247">For pricing information, see [Azure Automation State Configuration pricing](https://azure.microsoft.com/pricing/details/automation/)</span><span class="sxs-lookup"><span data-stu-id="9f610-247">For pricing information, see [Azure Automation State Configuration pricing](https://azure.microsoft.com/pricing/details/automation/)</span></span>
- <span data-ttu-id="9f610-248">To see an example of using Azure Automation State Configuration in a continuous deployment pipeline, see [Continuous Deployment Using Azure Automation State Configuration and Chocolatey](automation-dsc-cd-chocolatey.md)</span><span class="sxs-lookup"><span data-stu-id="9f610-248">To see an example of using Azure Automation State Configuration in a continuous deployment pipeline, see [Continuous Deployment Using Azure Automation State Configuration and Chocolatey](automation-dsc-cd-chocolatey.md)</span></span>