---
title: Automating deployment of a VM in Amazon Web Services
description: This article demonstrates how to use Azure Automation to automate creation of an Amazon Web Service VM
services: automation
ms.service: automation
ms.component: process-automation
author: georgewallace
ms.author: gwallace
ms.date: 03/16/2018
ms.topic: conceptual
manager: carmonm
ms.openlocfilehash: 4f49adf006e8d55337220fad9ee84de65209880b
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44826813"
---
# <a name="azure-automation-scenario---provision-an-aws-virtual-machine"></a><span data-ttu-id="1ed5e-103">Azure Automation scenario - provision an AWS virtual machine</span><span class="sxs-lookup"><span data-stu-id="1ed5e-103">Azure Automation scenario - provision an AWS virtual machine</span></span>
<span data-ttu-id="1ed5e-104">In this article, you learn how you can leverage Azure Automation to provision a virtual machine in your Amazon Web Service (AWS) subscription and give that VM a specific name – which AWS refers to as “tagging” the VM.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-104">In this article, you learn how you can leverage Azure Automation to provision a virtual machine in your Amazon Web Service (AWS) subscription and give that VM a specific name – which AWS refers to as “tagging” the VM.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="1ed5e-105">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="1ed5e-105">Prerequisites</span></span>
<span data-ttu-id="1ed5e-106">For the purposes of this article, you need to have an Azure Automation account and an AWS subscription.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-106">For the purposes of this article, you need to have an Azure Automation account and an AWS subscription.</span></span> <span data-ttu-id="1ed5e-107">For more information on setting up an Azure Automation account and configuring it with your AWS subscription credentials, review [Configure Authentication with Amazon Web Services](automation-config-aws-account.md).</span><span class="sxs-lookup"><span data-stu-id="1ed5e-107">For more information on setting up an Azure Automation account and configuring it with your AWS subscription credentials, review [Configure Authentication with Amazon Web Services](automation-config-aws-account.md).</span></span> <span data-ttu-id="1ed5e-108">This account should be created or updated with your AWS subscription credentials before proceeding, as you reference this account in the steps below.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-108">This account should be created or updated with your AWS subscription credentials before proceeding, as you reference this account in the steps below.</span></span>

## <a name="deploy-amazon-web-services-powershell-module"></a><span data-ttu-id="1ed5e-109">Deploy Amazon Web Services PowerShell Module</span><span class="sxs-lookup"><span data-stu-id="1ed5e-109">Deploy Amazon Web Services PowerShell Module</span></span>
<span data-ttu-id="1ed5e-110">Your VM provisioning runbook leverages the AWS PowerShell module to do its work.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-110">Your VM provisioning runbook leverages the AWS PowerShell module to do its work.</span></span> <span data-ttu-id="1ed5e-111">Perform the following steps to add the module to your Automation account that is configured with your AWS subscription credentials.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-111">Perform the following steps to add the module to your Automation account that is configured with your AWS subscription credentials.</span></span>  

1. <span data-ttu-id="1ed5e-112">Open your web browser and navigate to the [PowerShell Gallery](http://www.powershellgallery.com/packages/AWSPowerShell/) and click on the **Deploy to Azure Automation button**.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-112">Open your web browser and navigate to the [PowerShell Gallery](http://www.powershellgallery.com/packages/AWSPowerShell/) and click on the **Deploy to Azure Automation button**.</span></span><br><br> <span data-ttu-id="1ed5e-113">![AWS PS Module Import](./media/automation-scenario-aws-deployment/powershell-gallery-download-awsmodule.png)</span><span class="sxs-lookup"><span data-stu-id="1ed5e-113">![AWS PS Module Import](./media/automation-scenario-aws-deployment/powershell-gallery-download-awsmodule.png)</span></span>
2. <span data-ttu-id="1ed5e-114">You are taken to the Azure login page and after authenticating, you will be routed to the Azure portal and presented with the following page:</span><span class="sxs-lookup"><span data-stu-id="1ed5e-114">You are taken to the Azure login page and after authenticating, you will be routed to the Azure portal and presented with the following page:</span></span><br><br> ![Import Module page](./media/automation-scenario-aws-deployment/deploy-aws-powershell-module-parameters.png)
3. <span data-ttu-id="1ed5e-116">Select the Automation Account to use and click **OK** to start deployment.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-116">Select the Automation Account to use and click **OK** to start deployment.</span></span>

   > [!NOTE]
   > <span data-ttu-id="1ed5e-117">While importing a PowerShell module into Azure Automation, it is also extracting the cmdlets and these activities do not appear until the module has completely finished importing and extracting the cmdlets.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-117">While importing a PowerShell module into Azure Automation, it is also extracting the cmdlets and these activities do not appear until the module has completely finished importing and extracting the cmdlets.</span></span> <span data-ttu-id="1ed5e-118">This  process can take a few minutes.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-118">This  process can take a few minutes.</span></span>  
   > <br>

1. <span data-ttu-id="1ed5e-119">In the Azure portal, open your Automation account referenced in step 3.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-119">In the Azure portal, open your Automation account referenced in step 3.</span></span>
2. <span data-ttu-id="1ed5e-120">Click on the **Assets** tile and on the **Assets** pane, select the **Modules** tile.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-120">Click on the **Assets** tile and on the **Assets** pane, select the **Modules** tile.</span></span>
3. <span data-ttu-id="1ed5e-121">On the **Modules** page, you see the **AWSPowerShell** module in the list.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-121">On the **Modules** page, you see the **AWSPowerShell** module in the list.</span></span>

## <a name="create-aws-deploy-vm-runbook"></a><span data-ttu-id="1ed5e-122">Create AWS deploy VM runbook</span><span class="sxs-lookup"><span data-stu-id="1ed5e-122">Create AWS deploy VM runbook</span></span>
<span data-ttu-id="1ed5e-123">Once the AWS PowerShell Module has been deployed, you can now author a runbook to automate provisioning a virtual machine in AWS using a PowerShell script.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-123">Once the AWS PowerShell Module has been deployed, you can now author a runbook to automate provisioning a virtual machine in AWS using a PowerShell script.</span></span> <span data-ttu-id="1ed5e-124">The steps below demonstrate how to leverage native PowerShell script in Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-124">The steps below demonstrate how to leverage native PowerShell script in Azure Automation.</span></span>  

> [!NOTE]
> <span data-ttu-id="1ed5e-125">For further options and information regarding this script, please visit the [PowerShell Gallery](https://www.powershellgallery.com/packages/New-AwsVM/DisplayScript).</span><span class="sxs-lookup"><span data-stu-id="1ed5e-125">For further options and information regarding this script, please visit the [PowerShell Gallery](https://www.powershellgallery.com/packages/New-AwsVM/DisplayScript).</span></span>
> 

1. <span data-ttu-id="1ed5e-126">Download the PowerShell script New-AwsVM from the PowerShell Gallery by opening a PowerShell session and typing the following:</span><span class="sxs-lookup"><span data-stu-id="1ed5e-126">Download the PowerShell script New-AwsVM from the PowerShell Gallery by opening a PowerShell session and typing the following:</span></span><br>
   ```
   Save-Script -Name New-AwsVM -Path <path>
   ```
   <br>
2. <span data-ttu-id="1ed5e-127">From the Azure portal, open your Automation account and select **Runbooks** under the section **Process Automation** on the left.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-127">From the Azure portal, open your Automation account and select **Runbooks** under the section **Process Automation** on the left.</span></span>  
3. <span data-ttu-id="1ed5e-128">From the **Runbooks** page, select **Add a runbook**.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-128">From the **Runbooks** page, select **Add a runbook**.</span></span>
4. <span data-ttu-id="1ed5e-129">On the **Add a runbook** pane, select **Quick Create** (Create a new runbook).</span><span class="sxs-lookup"><span data-stu-id="1ed5e-129">On the **Add a runbook** pane, select **Quick Create** (Create a new runbook).</span></span>
5. <span data-ttu-id="1ed5e-130">On the **Runbook** properties pane, type a name in the Name box for your runbook and from the **Runbook type** drop-down list select **PowerShell**, and then click **Create**.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-130">On the **Runbook** properties pane, type a name in the Name box for your runbook and from the **Runbook type** drop-down list select **PowerShell**, and then click **Create**.</span></span><br><br> <span data-ttu-id="1ed5e-131">![Create runbook pane](./media/automation-scenario-aws-deployment/runbook-quickcreate-properties.png)</span><span class="sxs-lookup"><span data-stu-id="1ed5e-131">![Create runbook pane](./media/automation-scenario-aws-deployment/runbook-quickcreate-properties.png)</span></span>
6. <span data-ttu-id="1ed5e-132">When the Edit PowerShell Runbook page appears, copy and paste the PowerShell script into the runbook authoring canvas.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-132">When the Edit PowerShell Runbook page appears, copy and paste the PowerShell script into the runbook authoring canvas.</span></span><br><br> ![Runbook PowerShell Script](./media/automation-scenario-aws-deployment/runbook-powershell-script.png)<br>
   
    > [!NOTE]
    > <span data-ttu-id="1ed5e-134">Note the following when working with the example PowerShell script:</span><span class="sxs-lookup"><span data-stu-id="1ed5e-134">Note the following when working with the example PowerShell script:</span></span>
    > 
    > * <span data-ttu-id="1ed5e-135">The runbook contains a number of default parameter values.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-135">The runbook contains a number of default parameter values.</span></span> <span data-ttu-id="1ed5e-136">Evaluate all default values and update where necessary.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-136">Evaluate all default values and update where necessary.</span></span>
    > * <span data-ttu-id="1ed5e-137">If you have stored your AWS credentials as a credential asset named differently than **AWScred**, you need to update the script on line 57 to match accordingly.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-137">If you have stored your AWS credentials as a credential asset named differently than **AWScred**, you need to update the script on line 57 to match accordingly.</span></span>  
    > * <span data-ttu-id="1ed5e-138">When working with the AWS CLI commands in PowerShell, especially with this example runbook, you must specify the AWS region.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-138">When working with the AWS CLI commands in PowerShell, especially with this example runbook, you must specify the AWS region.</span></span> <span data-ttu-id="1ed5e-139">Otherwise, the cmdlets fail.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-139">Otherwise, the cmdlets fail.</span></span> <span data-ttu-id="1ed5e-140">View AWS topic [Specify AWS Region](http://docs.aws.amazon.com/powershell/latest/userguide/pstools-installing-specifying-region.html) in the AWS Tools for PowerShell document for further details.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-140">View AWS topic [Specify AWS Region](http://docs.aws.amazon.com/powershell/latest/userguide/pstools-installing-specifying-region.html) in the AWS Tools for PowerShell document for further details.</span></span>  
    >

7. <span data-ttu-id="1ed5e-141">To retrieve a list of image names from your AWS subscription, launch PowerShell ISE and import the AWS PowerShell Module.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-141">To retrieve a list of image names from your AWS subscription, launch PowerShell ISE and import the AWS PowerShell Module.</span></span> <span data-ttu-id="1ed5e-142">Authenticate against AWS by replacing **Get-AutomationPSCredential** in your ISE environment with **AWScred = Get-Credential**.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-142">Authenticate against AWS by replacing **Get-AutomationPSCredential** in your ISE environment with **AWScred = Get-Credential**.</span></span> <span data-ttu-id="1ed5e-143">This prompts you for your credentials and you can provide your **Access Key ID** for the username and **Secret Access Key** for the password.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-143">This prompts you for your credentials and you can provide your **Access Key ID** for the username and **Secret Access Key** for the password.</span></span> <span data-ttu-id="1ed5e-144">See the example below:</span><span class="sxs-lookup"><span data-stu-id="1ed5e-144">See the example below:</span></span>  

        #Sample to get the AWS VM available images
        #Please provide the path where you have downloaded the AWS PowerShell module
        Import-Module AWSPowerShell
        $AwsRegion = "us-west-2"
        $AwsCred = Get-Credential
        $AwsAccessKeyId = $AwsCred.UserName
        $AwsSecretKey = $AwsCred.GetNetworkCredential().Password
   
        # Set up the environment to access AWS
        Set-AwsCredentials -AccessKey $AwsAccessKeyId -SecretKey $AwsSecretKey -StoreAs AWSProfile
        Set-DefaultAWSRegion -Region $AwsRegion
   
        Get-EC2ImageByName -ProfileName AWSProfile

    <span data-ttu-id="1ed5e-145">The following output is returned:</span><span class="sxs-lookup"><span data-stu-id="1ed5e-145">The following output is returned:</span></span><br><br>
   <span data-ttu-id="1ed5e-146">![Get AWS images](./media/automation-scenario-aws-deployment/powershell-ise-output.png)</span><span class="sxs-lookup"><span data-stu-id="1ed5e-146">![Get AWS images](./media/automation-scenario-aws-deployment/powershell-ise-output.png)</span></span><br>  
8. <span data-ttu-id="1ed5e-147">Copy and paste the one of the image names in an Automation variable as referenced in the runbook as **$InstanceType**.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-147">Copy and paste the one of the image names in an Automation variable as referenced in the runbook as **$InstanceType**.</span></span> <span data-ttu-id="1ed5e-148">Since in this example you are using the free AWS tiered subscription, you use **t2.micro** for your runbook example.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-148">Since in this example you are using the free AWS tiered subscription, you use **t2.micro** for your runbook example.</span></span>  
9. <span data-ttu-id="1ed5e-149">Save the runbook, then click **Publish** to publish the runbook and then **Yes** when prompted.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-149">Save the runbook, then click **Publish** to publish the runbook and then **Yes** when prompted.</span></span>

### <a name="testing-the-aws-vm-runbook"></a><span data-ttu-id="1ed5e-150">Testing the AWS VM runbook</span><span class="sxs-lookup"><span data-stu-id="1ed5e-150">Testing the AWS VM runbook</span></span>
<span data-ttu-id="1ed5e-151">Before you proceed with testing the runbook, you need to verify a few things.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-151">Before you proceed with testing the runbook, you need to verify a few things.</span></span> <span data-ttu-id="1ed5e-152">Specifically:</span><span class="sxs-lookup"><span data-stu-id="1ed5e-152">Specifically:</span></span>  

* <span data-ttu-id="1ed5e-153">An asset for authenticating against AWS has been created called **AWScred** or the script has been updated to reference the name of your credential asset.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-153">An asset for authenticating against AWS has been created called **AWScred** or the script has been updated to reference the name of your credential asset.</span></span>    
* <span data-ttu-id="1ed5e-154">The AWS PowerShell module has been imported in Azure Automation</span><span class="sxs-lookup"><span data-stu-id="1ed5e-154">The AWS PowerShell module has been imported in Azure Automation</span></span>  
* <span data-ttu-id="1ed5e-155">A new runbook has been created and parameter values have been verified and updated where necessary</span><span class="sxs-lookup"><span data-stu-id="1ed5e-155">A new runbook has been created and parameter values have been verified and updated where necessary</span></span>  
* <span data-ttu-id="1ed5e-156">**Log verbose records** and optionally **Log progress records** under the runbook setting **Logging and tracing** have been set to **On**.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-156">**Log verbose records** and optionally **Log progress records** under the runbook setting **Logging and tracing** have been set to **On**.</span></span><br><br> <span data-ttu-id="1ed5e-157">![Runbook Logging and Tracing](./media/automation-scenario-aws-deployment/runbook-settings-logging-and-tracing.png)</span><span class="sxs-lookup"><span data-stu-id="1ed5e-157">![Runbook Logging and Tracing](./media/automation-scenario-aws-deployment/runbook-settings-logging-and-tracing.png)</span></span>  

1. <span data-ttu-id="1ed5e-158">You want to start the runbook, so click **Start** and then click **OK** when the Start Runbook pane opens.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-158">You want to start the runbook, so click **Start** and then click **OK** when the Start Runbook pane opens.</span></span>
2. <span data-ttu-id="1ed5e-159">On the Start Runbook pane, provide a **VMname**.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-159">On the Start Runbook pane, provide a **VMname**.</span></span> <span data-ttu-id="1ed5e-160">Accept the default values for the other parameters that you preconfigured in the script earlier.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-160">Accept the default values for the other parameters that you preconfigured in the script earlier.</span></span> <span data-ttu-id="1ed5e-161">Click **OK** to start the runbook job.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-161">Click **OK** to start the runbook job.</span></span><br><br> <span data-ttu-id="1ed5e-162">![Start New-AwsVM runbook](./media/automation-scenario-aws-deployment/runbook-start-job-parameters.png)</span><span class="sxs-lookup"><span data-stu-id="1ed5e-162">![Start New-AwsVM runbook](./media/automation-scenario-aws-deployment/runbook-start-job-parameters.png)</span></span>
3. <span data-ttu-id="1ed5e-163">A job pane is opened for the runbook job that you created.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-163">A job pane is opened for the runbook job that you created.</span></span> <span data-ttu-id="1ed5e-164">Close this pane.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-164">Close this pane.</span></span>
4. <span data-ttu-id="1ed5e-165">You can view progress of the job and view output **Streams** by selecting the **All Logs** tile from the runbook job page.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-165">You can view progress of the job and view output **Streams** by selecting the **All Logs** tile from the runbook job page.</span></span><br><br> <span data-ttu-id="1ed5e-166">![Stream output](./media/automation-scenario-aws-deployment/runbook-job-streams-output.png)</span><span class="sxs-lookup"><span data-stu-id="1ed5e-166">![Stream output](./media/automation-scenario-aws-deployment/runbook-job-streams-output.png)</span></span>
5. <span data-ttu-id="1ed5e-167">To confirm the VM is being provisioned, log into the AWS Management Console if you are not currently logged in.</span><span class="sxs-lookup"><span data-stu-id="1ed5e-167">To confirm the VM is being provisioned, log into the AWS Management Console if you are not currently logged in.</span></span><br><br> ![AWS console deployed VM](./media/automation-scenario-aws-deployment/aws-instances-status.png)

## <a name="next-steps"></a><span data-ttu-id="1ed5e-169">Next steps</span><span class="sxs-lookup"><span data-stu-id="1ed5e-169">Next steps</span></span>
* <span data-ttu-id="1ed5e-170">To get started with Graphical runbooks, see [My first graphical runbook](automation-first-runbook-graphical.md)</span><span class="sxs-lookup"><span data-stu-id="1ed5e-170">To get started with Graphical runbooks, see [My first graphical runbook](automation-first-runbook-graphical.md)</span></span>
* <span data-ttu-id="1ed5e-171">To get started with PowerShell workflow runbooks, see [My first PowerShell workflow runbook](automation-first-runbook-textual.md)</span><span class="sxs-lookup"><span data-stu-id="1ed5e-171">To get started with PowerShell workflow runbooks, see [My first PowerShell workflow runbook](automation-first-runbook-textual.md)</span></span>
* <span data-ttu-id="1ed5e-172">To know more about runbook types, their advantages and limitations, see [Azure Automation runbook types](automation-runbook-types.md)</span><span class="sxs-lookup"><span data-stu-id="1ed5e-172">To know more about runbook types, their advantages and limitations, see [Azure Automation runbook types](automation-runbook-types.md)</span></span>
* <span data-ttu-id="1ed5e-173">For more information on PowerShell script support feature, see [Native PowerShell script support in Azure Automation](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/)</span><span class="sxs-lookup"><span data-stu-id="1ed5e-173">For more information on PowerShell script support feature, see [Native PowerShell script support in Azure Automation](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/)</span></span>

