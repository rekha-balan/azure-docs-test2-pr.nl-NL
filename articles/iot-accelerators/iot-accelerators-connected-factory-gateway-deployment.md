---
title: Deploy your Connected Factory gateway - Azure | Microsoft Docs
description: How to deploy a gateway on either Windows or Linux to enable connectivity to the Connected Factory solution accelerator.
author: dominicbetts
manager: timlt
ms.service: iot-accelerators
services: iot-accelerators
ms.topic: conceptual
ms.date: 01/17/2018
ms.author: dobett
ms.openlocfilehash: c2805ddf7627ad520f6cc6585baedc7f5194aad6
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44871714"
---
# <a name="deploy-an-edge-gateway-for-the-connected-factory-solution-accelerator-on-windows-or-linux"></a><span data-ttu-id="dfc3f-103">Deploy an edge gateway for the Connected Factory solution accelerator on Windows or Linux</span><span class="sxs-lookup"><span data-stu-id="dfc3f-103">Deploy an edge gateway for the Connected Factory solution accelerator on Windows or Linux</span></span>

<span data-ttu-id="dfc3f-104">You need two software components to deploy an edge gateway for the *Connected Factory* solution accelerator:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-104">You need two software components to deploy an edge gateway for the *Connected Factory* solution accelerator:</span></span>

- <span data-ttu-id="dfc3f-105">The *OPC Proxy* establishes a connection to Connected Factory.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-105">The *OPC Proxy* establishes a connection to Connected Factory.</span></span> <span data-ttu-id="dfc3f-106">The OPC Proxy then waits for command and control messages from the integrated OPC Browser that runs in the Connected Factory solution portal.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-106">The OPC Proxy then waits for command and control messages from the integrated OPC Browser that runs in the Connected Factory solution portal.</span></span>

- <span data-ttu-id="dfc3f-107">The *OPC Publisher* connects to existing on-premises OPC UA servers and forwards telemetry messages from them to Connected Factory.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-107">The *OPC Publisher* connects to existing on-premises OPC UA servers and forwards telemetry messages from them to Connected Factory.</span></span> <span data-ttu-id="dfc3f-108">You can connect an OPC classic device using the [OPC classic adapter for OPC UA](https://github.com/OPCFoundation/UA-.NETStandard/blob/master/ComIOP/README.md).</span><span class="sxs-lookup"><span data-stu-id="dfc3f-108">You can connect an OPC classic device using the [OPC classic adapter for OPC UA](https://github.com/OPCFoundation/UA-.NETStandard/blob/master/ComIOP/README.md).</span></span>

<span data-ttu-id="dfc3f-109">Both components are open-source and are available as source on GitHub and as Docker containers on DockerHub:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-109">Both components are open-source and are available as source on GitHub and as Docker containers on DockerHub:</span></span>

| <span data-ttu-id="dfc3f-110">GitHub</span><span class="sxs-lookup"><span data-stu-id="dfc3f-110">GitHub</span></span> | <span data-ttu-id="dfc3f-111">DockerHub</span><span class="sxs-lookup"><span data-stu-id="dfc3f-111">DockerHub</span></span> |
| ------ | --------- |
| [<span data-ttu-id="dfc3f-112">OPC Publisher</span><span class="sxs-lookup"><span data-stu-id="dfc3f-112">OPC Publisher</span></span>](https://github.com/Azure/iot-edge-opc-publisher) | [<span data-ttu-id="dfc3f-113">OPC Publisher</span><span class="sxs-lookup"><span data-stu-id="dfc3f-113">OPC Publisher</span></span>](https://hub.docker.com/r/microsoft/iot-edge-opc-publisher/)   |
| [<span data-ttu-id="dfc3f-114">OPC Proxy</span><span class="sxs-lookup"><span data-stu-id="dfc3f-114">OPC Proxy</span></span>](https://github.com/Azure/iot-edge-opc-proxy)         | [<span data-ttu-id="dfc3f-115">OPC Proxy</span><span class="sxs-lookup"><span data-stu-id="dfc3f-115">OPC Proxy</span></span>](https://hub.docker.com/r/microsoft/iot-edge-opc-proxy/) |

<span data-ttu-id="dfc3f-116">You do not need a public-facing IP address or open inbound ports in the gateway firewall for either component.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-116">You do not need a public-facing IP address or open inbound ports in the gateway firewall for either component.</span></span> <span data-ttu-id="dfc3f-117">The OPC Proxy and OPC Publisher components only use outbound port 443.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-117">The OPC Proxy and OPC Publisher components only use outbound port 443.</span></span>

<span data-ttu-id="dfc3f-118">The steps in this article show you how to deploy an edge gateway using Docker on either Windows or Linux.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-118">The steps in this article show you how to deploy an edge gateway using Docker on either Windows or Linux.</span></span> <span data-ttu-id="dfc3f-119">The gateway enables connectivity to the Connected Factory solution accelerator.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-119">The gateway enables connectivity to the Connected Factory solution accelerator.</span></span> <span data-ttu-id="dfc3f-120">You can also use the components without Connected Factory.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-120">You can also use the components without Connected Factory.</span></span>

> [!NOTE]
> <span data-ttu-id="dfc3f-121">Both components can be used as modules in [Azure IoT Edge](https://github.com/Azure/iot-edge).</span><span class="sxs-lookup"><span data-stu-id="dfc3f-121">Both components can be used as modules in [Azure IoT Edge](https://github.com/Azure/iot-edge).</span></span>

## <a name="choose-a-gateway-device"></a><span data-ttu-id="dfc3f-122">Choose a gateway device</span><span class="sxs-lookup"><span data-stu-id="dfc3f-122">Choose a gateway device</span></span>

<span data-ttu-id="dfc3f-123">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of their partners.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-123">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of their partners.</span></span> <span data-ttu-id="dfc3f-124">For a list of gateway devices compatible with the Connected Factory solution, visit the [Azure IoT device catalog](https://catalog.azureiotsuite.com/?q=opc).</span><span class="sxs-lookup"><span data-stu-id="dfc3f-124">For a list of gateway devices compatible with the Connected Factory solution, visit the [Azure IoT device catalog](https://catalog.azureiotsuite.com/?q=opc).</span></span> <span data-ttu-id="dfc3f-125">Follow the instructions that come with the device to set up the gateway.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-125">Follow the instructions that come with the device to set up the gateway.</span></span>

<span data-ttu-id="dfc3f-126">Alternatively, use the following instructions to manually configure an existing gateway device.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-126">Alternatively, use the following instructions to manually configure an existing gateway device.</span></span>

## <a name="install-and-configure-docker"></a><span data-ttu-id="dfc3f-127">Install and configure Docker</span><span class="sxs-lookup"><span data-stu-id="dfc3f-127">Install and configure Docker</span></span>

<span data-ttu-id="dfc3f-128">Install [Docker for Windows](https://www.docker.com/docker-windows) on your Windows-based gateway device or use a package manager to install docker on your Linux-based gateway device.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-128">Install [Docker for Windows](https://www.docker.com/docker-windows) on your Windows-based gateway device or use a package manager to install docker on your Linux-based gateway device.</span></span>

<span data-ttu-id="dfc3f-129">During Docker for Windows setup, select a drive on your host machine to share with Docker.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-129">During Docker for Windows setup, select a drive on your host machine to share with Docker.</span></span> <span data-ttu-id="dfc3f-130">The following screenshot shows sharing the **D** drive on your Windows system to allow access to the host drive from inside a docker container:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-130">The following screenshot shows sharing the **D** drive on your Windows system to allow access to the host drive from inside a docker container:</span></span>

![Install Docker for Windows](./media/iot-accelerators-connected-factory-gateway-deployment/image1.png)

> [!NOTE]
> <span data-ttu-id="dfc3f-132">You can also perform this step after installing docker from the **Settings** dialog.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-132">You can also perform this step after installing docker from the **Settings** dialog.</span></span> <span data-ttu-id="dfc3f-133">Right-click on the **Docker** icon in the Windows system tray and choose **Settings**.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-133">Right-click on the **Docker** icon in the Windows system tray and choose **Settings**.</span></span> <span data-ttu-id="dfc3f-134">If major Windows updates have been deployed to the system, such as the Windows Fall Creators update, unshare the drives and share them again to refresh the access rights.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-134">If major Windows updates have been deployed to the system, such as the Windows Fall Creators update, unshare the drives and share them again to refresh the access rights.</span></span>

<span data-ttu-id="dfc3f-135">If you are using Linux, no additional configuration is required to enable access to the file system.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-135">If you are using Linux, no additional configuration is required to enable access to the file system.</span></span>

<span data-ttu-id="dfc3f-136">On Windows, create a folder on the drive you shared with Docker, on Linux create a folder under the root filesystem.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-136">On Windows, create a folder on the drive you shared with Docker, on Linux create a folder under the root filesystem.</span></span> <span data-ttu-id="dfc3f-137">This walkthrough refers to this folder as `<SharedFolder>`.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-137">This walkthrough refers to this folder as `<SharedFolder>`.</span></span>

<span data-ttu-id="dfc3f-138">When you refer to the `<SharedFolder>` in a Docker command, be sure to use the correct syntax for your operating system.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-138">When you refer to the `<SharedFolder>` in a Docker command, be sure to use the correct syntax for your operating system.</span></span> <span data-ttu-id="dfc3f-139">Here are two examples, one for Windows and one for Linux:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-139">Here are two examples, one for Windows and one for Linux:</span></span>

- <span data-ttu-id="dfc3f-140">If your are using the folder `D:\shared` on Windows as your `<SharedFolder>`, the Docker command syntax is `d:/shared`.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-140">If your are using the folder `D:\shared` on Windows as your `<SharedFolder>`, the Docker command syntax is `d:/shared`.</span></span>

- <span data-ttu-id="dfc3f-141">If your are using the folder `/shared` on Linux as your `<SharedFolder>`, the Docker command syntax is `/shared`.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-141">If your are using the folder `/shared` on Linux as your `<SharedFolder>`, the Docker command syntax is `/shared`.</span></span>

<span data-ttu-id="dfc3f-142">For more information see the [Use volumes](https://docs.docker.com/engine/admin/volumes/volumes/) docker engine reference.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-142">For more information see the [Use volumes](https://docs.docker.com/engine/admin/volumes/volumes/) docker engine reference.</span></span>

## <a name="configure-the-opc-components"></a><span data-ttu-id="dfc3f-143">Configure the OPC components</span><span class="sxs-lookup"><span data-stu-id="dfc3f-143">Configure the OPC components</span></span>

<span data-ttu-id="dfc3f-144">Before you install the OPC components, complete the following steps to prepare your environment:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-144">Before you install the OPC components, complete the following steps to prepare your environment:</span></span>

1. <span data-ttu-id="dfc3f-145">To complete the gateway deployment, you need the **iothubowner** connection string of the IoT Hub in your Connected Factory deployment.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-145">To complete the gateway deployment, you need the **iothubowner** connection string of the IoT Hub in your Connected Factory deployment.</span></span> <span data-ttu-id="dfc3f-146">In the [Azure portal](http://portal.azure.com/), navigate to your IoT Hub in the resource group created when you deployed the Connected Factory solution.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-146">In the [Azure portal](http://portal.azure.com/), navigate to your IoT Hub in the resource group created when you deployed the Connected Factory solution.</span></span> <span data-ttu-id="dfc3f-147">Click **Shared access policies** to access the **iothubowner** connection string:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-147">Click **Shared access policies** to access the **iothubowner** connection string:</span></span>

    ![Find the IoT Hub connection string](./media/iot-accelerators-connected-factory-gateway-deployment/image2.png)

    <span data-ttu-id="dfc3f-149">Copy the **Connection string-primary key** value.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-149">Copy the **Connection string-primary key** value.</span></span>

1. <span data-ttu-id="dfc3f-150">To allow communication between docker containers, you need a user-defined bridge network.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-150">To allow communication between docker containers, you need a user-defined bridge network.</span></span> <span data-ttu-id="dfc3f-151">To create a bridge network for your containers, run the following commands at a command prompt:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-151">To create a bridge network for your containers, run the following commands at a command prompt:</span></span>

    ```cmd/sh
    docker network create -d bridge iot_edge
    ```

    <span data-ttu-id="dfc3f-152">To verify the **iot_edge** bridge network was created, run the following command:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-152">To verify the **iot_edge** bridge network was created, run the following command:</span></span>

    ```cmd/sh
    docker network ls
    ```

    <span data-ttu-id="dfc3f-153">Your **iot_edge** bridge network is included in the list of networks.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-153">Your **iot_edge** bridge network is included in the list of networks.</span></span>

<span data-ttu-id="dfc3f-154">To run the OPC Publisher, run the following command at a command prompt:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-154">To run the OPC Publisher, run the following command at a command prompt:</span></span>

```cmd/sh
docker run --rm -it -v <SharedFolder>:/docker -v x509certstores:/root/.dotnet/corefx/cryptography/x509stores --network iot_edge --name publisher -h publisher -p 62222:62222 --add-host <OpcServerHostname>:<IpAddressOfOpcServerHostname> microsoft/iot-edge-opc-publisher:2.1.3 publisher "<IoTHubOwnerConnectionString>" --lf /docker/publisher.log.txt --as true --si 1 --ms 0 --tm true --vc true --di 30
```

- <span data-ttu-id="dfc3f-155">The [OPC Publisher GitHub](https://github.com/Azure/iot-edge-opc-publisher) and the [docker run reference](https://docs.docker.com/engine/reference/run/) provide more information about:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-155">The [OPC Publisher GitHub](https://github.com/Azure/iot-edge-opc-publisher) and the [docker run reference](https://docs.docker.com/engine/reference/run/) provide more information about:</span></span>

  - <span data-ttu-id="dfc3f-156">The docker command line options specified before the container name (`microsoft/iot-edge-opc-publisher:2.1.3`).</span><span class="sxs-lookup"><span data-stu-id="dfc3f-156">The docker command line options specified before the container name (`microsoft/iot-edge-opc-publisher:2.1.3`).</span></span>
  - <span data-ttu-id="dfc3f-157">The meaning of the OPC Publisher command line parameters specified after the container name (`microsoft/iot-edge-opc-publisher:2.1.3`).</span><span class="sxs-lookup"><span data-stu-id="dfc3f-157">The meaning of the OPC Publisher command line parameters specified after the container name (`microsoft/iot-edge-opc-publisher:2.1.3`).</span></span>

- <span data-ttu-id="dfc3f-158">The `<IoTHubOwnerConnectionString>` is the **iothubowner** shared access policy connection string from the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-158">The `<IoTHubOwnerConnectionString>` is the **iothubowner** shared access policy connection string from the Azure portal.</span></span> <span data-ttu-id="dfc3f-159">You copied this connection string in a previous step.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-159">You copied this connection string in a previous step.</span></span> <span data-ttu-id="dfc3f-160">You only need this connection string for the first run of OPC Publisher.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-160">You only need this connection string for the first run of OPC Publisher.</span></span> <span data-ttu-id="dfc3f-161">On subsequent runs you should omit it because it poses a security risk.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-161">On subsequent runs you should omit it because it poses a security risk.</span></span>

- <span data-ttu-id="dfc3f-162">The `<SharedFolder>` you use and its syntax is described in the section [Install and configure Docker](#install-and-configure-docker).</span><span class="sxs-lookup"><span data-stu-id="dfc3f-162">The `<SharedFolder>` you use and its syntax is described in the section [Install and configure Docker](#install-and-configure-docker).</span></span> <span data-ttu-id="dfc3f-163">OPC Publisher uses the `<SharedFolder>` to read and write to the OPC Publisher configuration file, write to the log file, and make both these files available outside of the container.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-163">OPC Publisher uses the `<SharedFolder>` to read and write to the OPC Publisher configuration file, write to the log file, and make both these files available outside of the container.</span></span>

- <span data-ttu-id="dfc3f-164">OPC Publisher reads its configuration from the **publishednodes.json** file, which is read from and written to the `<SharedFolder>/docker` folder.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-164">OPC Publisher reads its configuration from the **publishednodes.json** file, which is read from and written to the `<SharedFolder>/docker` folder.</span></span> <span data-ttu-id="dfc3f-165">This configuration file defines which OPC UA node data on a given OPC UA server the OPC Publisher should subscribe to.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-165">This configuration file defines which OPC UA node data on a given OPC UA server the OPC Publisher should subscribe to.</span></span> <span data-ttu-id="dfc3f-166">The full syntax of the **publishednodes.json** file is described on the [OPC Publisher](https://github.com/Azure/iot-edge-opc-publisher) page on GitHub.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-166">The full syntax of the **publishednodes.json** file is described on the [OPC Publisher](https://github.com/Azure/iot-edge-opc-publisher) page on GitHub.</span></span> <span data-ttu-id="dfc3f-167">When you add a gateway, put an empty **publishednodes.json** into the folder:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-167">When you add a gateway, put an empty **publishednodes.json** into the folder:</span></span>

    ```json
    [
    ]
    ```

- <span data-ttu-id="dfc3f-168">Whenever the OPC UA server notifies OPC Publisher of a data change, the new value is sent to IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-168">Whenever the OPC UA server notifies OPC Publisher of a data change, the new value is sent to IoT Hub.</span></span> <span data-ttu-id="dfc3f-169">Depending on the batching settings, the OPC Publisher may first accumulate the data before it sends the data to IoT Hub in a batch.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-169">Depending on the batching settings, the OPC Publisher may first accumulate the data before it sends the data to IoT Hub in a batch.</span></span>

- <span data-ttu-id="dfc3f-170">Docker does not support NetBIOS name resolution, only DNS name resolution.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-170">Docker does not support NetBIOS name resolution, only DNS name resolution.</span></span> <span data-ttu-id="dfc3f-171">If you don't have a DNS server on the network, you can use the workaround shown in the previous command line example.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-171">If you don't have a DNS server on the network, you can use the workaround shown in the previous command line example.</span></span> <span data-ttu-id="dfc3f-172">The previous command line example uses the `--add-host` parameter to add an entry into the containers hosts file.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-172">The previous command line example uses the `--add-host` parameter to add an entry into the containers hosts file.</span></span> <span data-ttu-id="dfc3f-173">This entry enables hostname lookup for the given `<OpcServerHostname>`, resolving to the given IP address `<IpAddressOfOpcServerHostname>`.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-173">This entry enables hostname lookup for the given `<OpcServerHostname>`, resolving to the given IP address `<IpAddressOfOpcServerHostname>`.</span></span>

- <span data-ttu-id="dfc3f-174">OPC UA uses X.509 certificates for authentication and encryption.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-174">OPC UA uses X.509 certificates for authentication and encryption.</span></span> <span data-ttu-id="dfc3f-175">You need to place the OPC Publisher certificate on the OPC UA server you are connecting to, to ensure it trusts OPC Publisher.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-175">You need to place the OPC Publisher certificate on the OPC UA server you are connecting to, to ensure it trusts OPC Publisher.</span></span> <span data-ttu-id="dfc3f-176">The OPC Publisher certificate store is located in the `<SharedFolder>/CertificateStores` folder.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-176">The OPC Publisher certificate store is located in the `<SharedFolder>/CertificateStores` folder.</span></span> <span data-ttu-id="dfc3f-177">You can find the OPC Publisher certificate in the `trusted/certs` folder in the `CertificateStores` folder.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-177">You can find the OPC Publisher certificate in the `trusted/certs` folder in the `CertificateStores` folder.</span></span>

  <span data-ttu-id="dfc3f-178">The steps to configure the OPC UA server depend on the device you are using.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-178">The steps to configure the OPC UA server depend on the device you are using.</span></span> <span data-ttu-id="dfc3f-179">these steps are typically documented in the OPC UA server's user manual.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-179">these steps are typically documented in the OPC UA server's user manual.</span></span>

<span data-ttu-id="dfc3f-180">To install the OPC Proxy, run the following command at a command prompt:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-180">To install the OPC Proxy, run the following command at a command prompt:</span></span>

```cmd/sh
docker run -it --rm -v <SharedFolder>:/mapped --network iot_edge --name proxy --add-host <OpcServerHostname>:<IpAddressOfOpcServerHostname> microsoft/iot-edge-opc-proxy:1.0.2 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db
```

<span data-ttu-id="dfc3f-181">You only need to run the installation once on a system.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-181">You only need to run the installation once on a system.</span></span>

<span data-ttu-id="dfc3f-182">Use the following command to run the OPC Proxy:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-182">Use the following command to run the OPC Proxy:</span></span>

```cmd/sh
docker run -it --rm -v <SharedFolder>:/mapped --network iot_edge --name proxy --add-host <OpcServerHostname>:<IpAddressOfOpcServerHostname> microsoft/iot-edge-opc-proxy:1.0.2 -D /mapped/cs.db
```

<span data-ttu-id="dfc3f-183">OPC Proxy saves the connection string during the installation.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-183">OPC Proxy saves the connection string during the installation.</span></span> <span data-ttu-id="dfc3f-184">On subsequent runs you should omit the connection string because it poses a security risk.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-184">On subsequent runs you should omit the connection string because it poses a security risk.</span></span>

## <a name="enable-your-gateway"></a><span data-ttu-id="dfc3f-185">Enable your gateway</span><span class="sxs-lookup"><span data-stu-id="dfc3f-185">Enable your gateway</span></span>

<span data-ttu-id="dfc3f-186">Complete the following steps to enable your gateway in the Connected Factory solution accelerator:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-186">Complete the following steps to enable your gateway in the Connected Factory solution accelerator:</span></span>

1. <span data-ttu-id="dfc3f-187">When both components are running, browse to the **Connect your own OPC UA Server** page in the Connected Factory solution portal.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-187">When both components are running, browse to the **Connect your own OPC UA Server** page in the Connected Factory solution portal.</span></span> <span data-ttu-id="dfc3f-188">This page is only available to Administrators in the solution.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-188">This page is only available to Administrators in the solution.</span></span> <span data-ttu-id="dfc3f-189">Enter the publisher endpoint URL (opc.tcp://publisher:62222) and click **Connect**.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-189">Enter the publisher endpoint URL (opc.tcp://publisher:62222) and click **Connect**.</span></span>

1. <span data-ttu-id="dfc3f-190">Establish a trust relationship between the Connected Factory portal and OPC Publisher.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-190">Establish a trust relationship between the Connected Factory portal and OPC Publisher.</span></span> <span data-ttu-id="dfc3f-191">When you see a certificate warning, click **Proceed**.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-191">When you see a certificate warning, click **Proceed**.</span></span> <span data-ttu-id="dfc3f-192">Next, you see an error that the OPC Publisher doesn’t trust the UA Web client.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-192">Next, you see an error that the OPC Publisher doesn’t trust the UA Web client.</span></span> <span data-ttu-id="dfc3f-193">To resolve this error, copy the **UA Web Client** certificate from the `<SharedFolder>/CertificateStores/rejected/certs` folder to the `<SharedFolder>/CertificateStores/trusted/certs` folder on the gateway.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-193">To resolve this error, copy the **UA Web Client** certificate from the `<SharedFolder>/CertificateStores/rejected/certs` folder to the `<SharedFolder>/CertificateStores/trusted/certs` folder on the gateway.</span></span> <span data-ttu-id="dfc3f-194">You do not need to restart the gateway.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-194">You do not need to restart the gateway.</span></span>

<span data-ttu-id="dfc3f-195">You can now connect to the gateway from the cloud, and you are ready to add OPC UA servers to the solution.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-195">You can now connect to the gateway from the cloud, and you are ready to add OPC UA servers to the solution.</span></span>

## <a name="add-your-own-opc-ua-servers"></a><span data-ttu-id="dfc3f-196">Add your own OPC UA servers</span><span class="sxs-lookup"><span data-stu-id="dfc3f-196">Add your own OPC UA servers</span></span>

<span data-ttu-id="dfc3f-197">To add your own OPC UA servers to the Connected Factory solution accelerator:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-197">To add your own OPC UA servers to the Connected Factory solution accelerator:</span></span>

1. <span data-ttu-id="dfc3f-198">Browse to the **Connect your own OPC UA server** page in the Connected Factory solution portal.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-198">Browse to the **Connect your own OPC UA server** page in the Connected Factory solution portal.</span></span>

    1. <span data-ttu-id="dfc3f-199">Start the OPC UA server you want to connect to.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-199">Start the OPC UA server you want to connect to.</span></span> <span data-ttu-id="dfc3f-200">Ensure that your OPC UA server can be reached from OPC Publisher and OPC Proxy running in the container (see the previous comments about name resolution).</span><span class="sxs-lookup"><span data-stu-id="dfc3f-200">Ensure that your OPC UA server can be reached from OPC Publisher and OPC Proxy running in the container (see the previous comments about name resolution).</span></span>
    1. <span data-ttu-id="dfc3f-201">Enter the endpoint URL of your OPC UA server (`opc.tcp://<host>:<port>`) and click **Connect**.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-201">Enter the endpoint URL of your OPC UA server (`opc.tcp://<host>:<port>`) and click **Connect**.</span></span>
    1. <span data-ttu-id="dfc3f-202">As part of the connection setup, a trust relationship between the Connected Factory portal (OPC UA client) and the OPC UA server you are trying to connect is established.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-202">As part of the connection setup, a trust relationship between the Connected Factory portal (OPC UA client) and the OPC UA server you are trying to connect is established.</span></span> <span data-ttu-id="dfc3f-203">In the Connected Factory dashboard you get a **Certificate of the server you want to connect cannot be verified** warning.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-203">In the Connected Factory dashboard you get a **Certificate of the server you want to connect cannot be verified** warning.</span></span> <span data-ttu-id="dfc3f-204">When you see a certificate warning, click **Proceed**.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-204">When you see a certificate warning, click **Proceed**.</span></span>
    1. <span data-ttu-id="dfc3f-205">More difficult to setup is the certificate configuration of the OPC UA server you are trying to connect to.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-205">More difficult to setup is the certificate configuration of the OPC UA server you are trying to connect to.</span></span> <span data-ttu-id="dfc3f-206">For PC based OPC UA servers, you may just get a warning dialog in the dashboard that you can acknowledge.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-206">For PC based OPC UA servers, you may just get a warning dialog in the dashboard that you can acknowledge.</span></span> <span data-ttu-id="dfc3f-207">For embedded OPC UA server systems, consult the documentation of your OPC UA server to look up how this task is done.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-207">For embedded OPC UA server systems, consult the documentation of your OPC UA server to look up how this task is done.</span></span> <span data-ttu-id="dfc3f-208">To complete this task, you may need the certificate of the Connected Factory portal's OPC UA client.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-208">To complete this task, you may need the certificate of the Connected Factory portal's OPC UA client.</span></span> <span data-ttu-id="dfc3f-209">An Administrator can download this certificate on the **Connect your own OPC UA server** page:</span><span class="sxs-lookup"><span data-stu-id="dfc3f-209">An Administrator can download this certificate on the **Connect your own OPC UA server** page:</span></span>

        ![Solution portal](./media/iot-accelerators-connected-factory-gateway-deployment/image4.png)

1. <span data-ttu-id="dfc3f-211">Browse the OPC UA nodes tree of your OPC UA server, right-click the OPC nodes you want to send values to Connected Factory, and select **publish**.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-211">Browse the OPC UA nodes tree of your OPC UA server, right-click the OPC nodes you want to send values to Connected Factory, and select **publish**.</span></span>

1. <span data-ttu-id="dfc3f-212">Telemetry now flows from the gateway device.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-212">Telemetry now flows from the gateway device.</span></span> <span data-ttu-id="dfc3f-213">You can view the telemetry in the **Factory Locations** view of the Connected Factory portal under **New Factory**.</span><span class="sxs-lookup"><span data-stu-id="dfc3f-213">You can view the telemetry in the **Factory Locations** view of the Connected Factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="dfc3f-214">Next steps</span><span class="sxs-lookup"><span data-stu-id="dfc3f-214">Next steps</span></span>

<span data-ttu-id="dfc3f-215">To learn more about the architecture of the Connected Factory solution accelerator, see [Connected Factory solution accelerator walkthrough](iot-accelerators-connected-factory-sample-walkthrough.md).</span><span class="sxs-lookup"><span data-stu-id="dfc3f-215">To learn more about the architecture of the Connected Factory solution accelerator, see [Connected Factory solution accelerator walkthrough](iot-accelerators-connected-factory-sample-walkthrough.md).</span></span>

<span data-ttu-id="dfc3f-216">Learn about the [OPC Publisher reference implementation](https://docs.microsoft.com/azure/iot-suite/iot-suite-connected-factory-publisher).</span><span class="sxs-lookup"><span data-stu-id="dfc3f-216">Learn about the [OPC Publisher reference implementation](https://docs.microsoft.com/azure/iot-suite/iot-suite-connected-factory-publisher).</span></span>