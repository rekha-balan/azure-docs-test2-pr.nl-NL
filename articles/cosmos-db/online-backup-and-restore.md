---
title: Online backup and restore with Azure Cosmos DB | Microsoft Docs
description: Learn how to perform automatic backup and restore on an Azure Cosmos DB database.
keywords: backup and restore, online backup
services: cosmos-db
author: kanshiG
manager: kfile
ms.service: cosmos-db
ms.devlang: na
ms.topic: conceptual
ms.date: 11/15/2017
ms.author: govindk
ms.openlocfilehash: a2c52844e09daf42418b4e548f7185e31dcf4ae9
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44969283"
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="4373d-104">Automatic online backup and restore with Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="4373d-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="4373d-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span><span class="sxs-lookup"><span data-stu-id="4373d-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="4373d-106">The automatic backups are taken without affecting the performance or availability of your database operations.</span><span class="sxs-lookup"><span data-stu-id="4373d-106">The automatic backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="4373d-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span><span class="sxs-lookup"><span data-stu-id="4373d-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="4373d-108">The automatic backups are intended for scenarios when you accidentally delete your Cosmos DB container and later require data recovery or a disaster recovery solution.</span><span class="sxs-lookup"><span data-stu-id="4373d-108">The automatic backups are intended for scenarios when you accidentally delete your Cosmos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="4373d-109">This article starts with a quick recap of the data redundancy and availability in Cosmos DB, and then discusses backups.</span><span class="sxs-lookup"><span data-stu-id="4373d-109">This article starts with a quick recap of the data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="4373d-110">High availability with Cosmos DB - a recap</span><span class="sxs-lookup"><span data-stu-id="4373d-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="4373d-111">Cosmos DB is designed to be [globally distributed](distribute-data-globally.md) – it allows you to scale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span><span class="sxs-lookup"><span data-stu-id="4373d-111">Cosmos DB is designed to be [globally distributed](distribute-data-globally.md) – it allows you to scale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="4373d-112">Azure Cosmos DB offers [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db) for all single region accounts and all multi-region accounts with relaxed consistency, and 99.999% read availability on all multi-region database accounts.</span><span class="sxs-lookup"><span data-stu-id="4373d-112">Azure Cosmos DB offers [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db) for all single region accounts and all multi-region accounts with relaxed consistency, and 99.999% read availability on all multi-region database accounts.</span></span> <span data-ttu-id="4373d-113">All the writes in Azure Cosmos DB are durably committed to local disks by a quorum of replicas within a local data center before acknowledging to the client.</span><span class="sxs-lookup"><span data-stu-id="4373d-113">All the writes in Azure Cosmos DB are durably committed to local disks by a quorum of replicas within a local data center before acknowledging to the client.</span></span> <span data-ttu-id="4373d-114">The high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span><span class="sxs-lookup"><span data-stu-id="4373d-114">The high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="4373d-115">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span><span class="sxs-lookup"><span data-stu-id="4373d-115">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="4373d-116">To scale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span><span class="sxs-lookup"><span data-stu-id="4373d-116">To scale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="4373d-117">In each read region, the (replicated) data is durably persisted across a replica set.</span><span class="sxs-lookup"><span data-stu-id="4373d-117">In each read region, the (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="4373d-118">As illustrated in the following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="4373d-118">As illustrated in the following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="4373d-119">A "partition" is denoted by a circle in the following diagram, and each partition is made highly available via a replica set.</span><span class="sxs-lookup"><span data-stu-id="4373d-119">A "partition" is denoted by a circle in the following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="4373d-120">This is the local distribution within a single Azure region (denoted by the X axis).</span><span class="sxs-lookup"><span data-stu-id="4373d-120">This is the local distribution within a single Azure region (denoted by the X axis).</span></span> <span data-ttu-id="4373d-121">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration the three regions – East US, West US and Central India).</span><span class="sxs-lookup"><span data-stu-id="4373d-121">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration the three regions – East US, West US and Central India).</span></span> <span data-ttu-id="4373d-122">The "partition set" is a globally distributed entity comprising of multiple copies of your data in each region (denoted by the Y axis).</span><span class="sxs-lookup"><span data-stu-id="4373d-122">The "partition set" is a globally distributed entity comprising of multiple copies of your data in each region (denoted by the Y axis).</span></span> <span data-ttu-id="4373d-123">You can assign priority to the regions associated with your database account and Cosmos DB will transparently fail over to the next region in case of disaster.</span><span class="sxs-lookup"><span data-stu-id="4373d-123">You can assign priority to the regions associated with your database account and Cosmos DB will transparently fail over to the next region in case of disaster.</span></span> <span data-ttu-id="4373d-124">You can also manually simulate failover to test the end-to-end availability of your application.</span><span class="sxs-lookup"><span data-stu-id="4373d-124">You can also manually simulate failover to test the end-to-end availability of your application.</span></span>  

<span data-ttu-id="4373d-125">The following image illustrates the high degree of redundancy with Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4373d-125">The following image illustrates the high degree of redundancy with Cosmos DB.</span></span>

![High degree of redundancy with Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![High degree of redundancy with Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="4373d-128">Full, automatic, online backups</span><span class="sxs-lookup"><span data-stu-id="4373d-128">Full, automatic, online backups</span></span>
<span data-ttu-id="4373d-129">Oops, I deleted my container or database!</span><span class="sxs-lookup"><span data-stu-id="4373d-129">Oops, I deleted my container or database!</span></span> <span data-ttu-id="4373d-130">With Cosmos DB, not only your data, but the backups of your data are also made highly redundant and resilient to regional disasters.</span><span class="sxs-lookup"><span data-stu-id="4373d-130">With Cosmos DB, not only your data, but the backups of your data are also made highly redundant and resilient to regional disasters.</span></span> <span data-ttu-id="4373d-131">These automated backups are currently taken approximately every four hours and latest two backups are stored at all times.</span><span class="sxs-lookup"><span data-stu-id="4373d-131">These automated backups are currently taken approximately every four hours and latest two backups are stored at all times.</span></span> <span data-ttu-id="4373d-132">If the data is accidentally dropped or corrupted, contact [Azure support](https://azure.microsoft.com/support/options/) within eight hours.</span><span class="sxs-lookup"><span data-stu-id="4373d-132">If the data is accidentally dropped or corrupted, contact [Azure support](https://azure.microsoft.com/support/options/) within eight hours.</span></span> 

<span data-ttu-id="4373d-133">The backups are taken without affecting the performance or availability of your database operations.</span><span class="sxs-lookup"><span data-stu-id="4373d-133">The backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="4373d-134">Cosmos DB takes the backup in the background without consuming your provisioned RUs or affecting the performance and without affecting the availability of your database.</span><span class="sxs-lookup"><span data-stu-id="4373d-134">Cosmos DB takes the backup in the background without consuming your provisioned RUs or affecting the performance and without affecting the availability of your database.</span></span> 

<span data-ttu-id="4373d-135">Unlike your data that is stored inside Cosmos DB, the automatic backups are stored in Azure Blob Storage service.</span><span class="sxs-lookup"><span data-stu-id="4373d-135">Unlike your data that is stored inside Cosmos DB, the automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="4373d-136">To guarantee the low latency/efficient upload, the snapshot of your backup is uploaded to an instance of Azure Blob storage in the same region as the current write region of your Cosmos DB database account.</span><span class="sxs-lookup"><span data-stu-id="4373d-136">To guarantee the low latency/efficient upload, the snapshot of your backup is uploaded to an instance of Azure Blob storage in the same region as the current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="4373d-137">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) to another region.</span><span class="sxs-lookup"><span data-stu-id="4373d-137">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) to another region.</span></span> <span data-ttu-id="4373d-138">The following diagram shows that the entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated to East US.</span><span class="sxs-lookup"><span data-stu-id="4373d-138">The following diagram shows that the entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated to East US.</span></span> 

<span data-ttu-id="4373d-139">The following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="4373d-139">The following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![Periodic full backups of all Cosmos DB entities in GRS Azure Storage](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="4373d-141">Backup retention period</span><span class="sxs-lookup"><span data-stu-id="4373d-141">Backup retention period</span></span>
<span data-ttu-id="4373d-142">As described above, Azure Cosmos DB takes snapshots of your data every four hours at the partition level.</span><span class="sxs-lookup"><span data-stu-id="4373d-142">As described above, Azure Cosmos DB takes snapshots of your data every four hours at the partition level.</span></span> <span data-ttu-id="4373d-143">At any given time, only the last two snapshots are retained.</span><span class="sxs-lookup"><span data-stu-id="4373d-143">At any given time, only the last two snapshots are retained.</span></span> <span data-ttu-id="4373d-144">However, if the container/database is deleted, Azure Cosmos DB retains the existing snapshots for all of the deleted partitions within the given container/database for 30 days.</span><span class="sxs-lookup"><span data-stu-id="4373d-144">However, if the container/database is deleted, Azure Cosmos DB retains the existing snapshots for all of the deleted partitions within the given container/database for 30 days.</span></span>

<span data-ttu-id="4373d-145">For SQL API, If you want to maintain your own snapshots, you can use the export to JSON option in the Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) to schedule additional backups.</span><span class="sxs-lookup"><span data-stu-id="4373d-145">For SQL API, If you want to maintain your own snapshots, you can use the export to JSON option in the Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) to schedule additional backups.</span></span>

> [!NOTE]
> <span data-ttu-id="4373d-146">If you "Provision throughput for a set of containers at Database level" – Please remember the restore happens at full Database account level.</span><span class="sxs-lookup"><span data-stu-id="4373d-146">If you "Provision throughput for a set of containers at Database level" – Please remember the restore happens at full Database account level.</span></span> <span data-ttu-id="4373d-147">You also need to ensure to reach out within 8 hours to the support team if you accidently deleted your container.</span><span class="sxs-lookup"><span data-stu-id="4373d-147">You also need to ensure to reach out within 8 hours to the support team if you accidently deleted your container.</span></span> <span data-ttu-id="4373d-148">Data can't be restored if you don't contact the support team within 8 hours.</span><span class="sxs-lookup"><span data-stu-id="4373d-148">Data can't be restored if you don't contact the support team within 8 hours.</span></span> 


## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="4373d-149">Restoring a database from an online backup</span><span class="sxs-lookup"><span data-stu-id="4373d-149">Restoring a database from an online backup</span></span>

<span data-ttu-id="4373d-150">If you accidentally delete your database or container, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) to restore the data from the last automatic backup.</span><span class="sxs-lookup"><span data-stu-id="4373d-150">If you accidentally delete your database or container, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) to restore the data from the last automatic backup.</span></span> <span data-ttu-id="4373d-151">Azure support is available for selected plans only such as Standard, Developer, support isn't available with Basic plan.</span><span class="sxs-lookup"><span data-stu-id="4373d-151">Azure support is available for selected plans only such as Standard, Developer, support isn't available with Basic plan.</span></span> <span data-ttu-id="4373d-152">To learn about different support plans, see [Azure support plans](https://azure.microsoft.com/support/plans/) page.</span><span class="sxs-lookup"><span data-stu-id="4373d-152">To learn about different support plans, see [Azure support plans](https://azure.microsoft.com/support/plans/) page.</span></span> 

<span data-ttu-id="4373d-153">If you need to restore your database because of data corruption issue (includes cases where documents within a container are deleted), see [Handling data corruption](#handling-data-corruption) as you need to take additional steps to prevent the corrupted data from overwriting the existing backups.</span><span class="sxs-lookup"><span data-stu-id="4373d-153">If you need to restore your database because of data corruption issue (includes cases where documents within a container are deleted), see [Handling data corruption](#handling-data-corruption) as you need to take additional steps to prevent the corrupted data from overwriting the existing backups.</span></span> <span data-ttu-id="4373d-154">For a specific snapshot of your backup to be restored, Cosmos DB requires that the data was available for the duration of the backup cycle for that snapshot.</span><span class="sxs-lookup"><span data-stu-id="4373d-154">For a specific snapshot of your backup to be restored, Cosmos DB requires that the data was available for the duration of the backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="4373d-155">Handling data corruption</span><span class="sxs-lookup"><span data-stu-id="4373d-155">Handling data corruption</span></span>

<span data-ttu-id="4373d-156">Azure Cosmos DB retains the last two backups of every partition in the database account.</span><span class="sxs-lookup"><span data-stu-id="4373d-156">Azure Cosmos DB retains the last two backups of every partition in the database account.</span></span> <span data-ttu-id="4373d-157">This model works well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of the last versions can be restored.</span><span class="sxs-lookup"><span data-stu-id="4373d-157">This model works well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of the last versions can be restored.</span></span> <span data-ttu-id="4373d-158">However, in the case when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of the data corruption, and it is possible that the corruption may have overwritten the existing backups.</span><span class="sxs-lookup"><span data-stu-id="4373d-158">However, in the case when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of the data corruption, and it is possible that the corruption may have overwritten the existing backups.</span></span> 

<span data-ttu-id="4373d-159">As soon as corruption is detected, reach out to customer support with database account and container information with approximate time of corruption.</span><span class="sxs-lookup"><span data-stu-id="4373d-159">As soon as corruption is detected, reach out to customer support with database account and container information with approximate time of corruption.</span></span> <span data-ttu-id="4373d-160">Another action the user can do in case of corrupted(data deletion/updation) the user should delete the corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span><span class="sxs-lookup"><span data-stu-id="4373d-160">Another action the user can do in case of corrupted(data deletion/updation) the user should delete the corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span>  

<span data-ttu-id="4373d-161">The following image illustrates the support request creation for container(collection/graph/table) restore via Azure portal for accidental deletion or updating of data within a container</span><span class="sxs-lookup"><span data-stu-id="4373d-161">The following image illustrates the support request creation for container(collection/graph/table) restore via Azure portal for accidental deletion or updating of data within a container</span></span>

![Restore a container for mistaken update or delete of data in Cosmos DB](./media/online-backup-and-restore/backup-restore-support.png)

<span data-ttu-id="4373d-163">When restore is done for this kind of scenarios - data is restored to another account(with suffix of "-restored") and container.</span><span class="sxs-lookup"><span data-stu-id="4373d-163">When restore is done for this kind of scenarios - data is restored to another account(with suffix of "-restored") and container.</span></span> <span data-ttu-id="4373d-164">This restore is not done in place to provide a chance to customer to do validation of data and move the data as required.</span><span class="sxs-lookup"><span data-stu-id="4373d-164">This restore is not done in place to provide a chance to customer to do validation of data and move the data as required.</span></span> <span data-ttu-id="4373d-165">The restored container is in same region with same RUs and indexing policies.</span><span class="sxs-lookup"><span data-stu-id="4373d-165">The restored container is in same region with same RUs and indexing policies.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="4373d-166">Next steps</span><span class="sxs-lookup"><span data-stu-id="4373d-166">Next steps</span></span>

<span data-ttu-id="4373d-167">To replicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="4373d-167">To replicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="4373d-168">To file contact Azure Support, [file a ticket from the Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span><span class="sxs-lookup"><span data-stu-id="4373d-168">To file contact Azure Support, [file a ticket from the Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>

