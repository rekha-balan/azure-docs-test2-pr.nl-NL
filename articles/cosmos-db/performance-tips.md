---
title: Azure Cosmos DB performance tips for .NET | Microsoft Docs
description: Learn client configuration options to improve Azure Cosmos DB database performance
keywords: how to improve database performance
services: cosmos-db
author: SnehaGunda
manager: kfile
ms.service: cosmos-db
ms.devlang: na
ms.topic: conceptual
ms.date: 01/24/2018
ms.author: sngun
ms.openlocfilehash: 47896b681c2ba43d4ca41682ec51e0dfd167c9d5
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44967912"
---
# <a name="performance-tips-for-azure-cosmos-db-and-net"></a><span data-ttu-id="899bb-104">Performance tips for Azure Cosmos DB and .NET</span><span class="sxs-lookup"><span data-stu-id="899bb-104">Performance tips for Azure Cosmos DB and .NET</span></span>

> [!div class="op_single_selector"]
> * [Async Java](performance-tips-async-java.md)
> * [Java](performance-tips-java.md)
> * [.NET](performance-tips.md)
> 

<span data-ttu-id="899bb-108">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span><span class="sxs-lookup"><span data-stu-id="899bb-108">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="899bb-109">You do not have to make major architecture changes or write complex code to scale your database with Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="899bb-109">You do not have to make major architecture changes or write complex code to scale your database with Azure Cosmos DB.</span></span> <span data-ttu-id="899bb-110">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span><span class="sxs-lookup"><span data-stu-id="899bb-110">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="899bb-111">However, because Azure Cosmos DB is accessed via network calls there are client-side optimizations you can make to achieve peak performance when using the [SQL .NET SDK](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="899bb-111">However, because Azure Cosmos DB is accessed via network calls there are client-side optimizations you can make to achieve peak performance when using the [SQL .NET SDK](documentdb-sdk-dotnet.md).</span></span>

<span data-ttu-id="899bb-112">So if you're asking "How can I improve my database performance?"</span><span class="sxs-lookup"><span data-stu-id="899bb-112">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="899bb-113">consider the following options:</span><span class="sxs-lookup"><span data-stu-id="899bb-113">consider the following options:</span></span>

## <a name="networking"></a><span data-ttu-id="899bb-114">Networking</span><span class="sxs-lookup"><span data-stu-id="899bb-114">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="899bb-115">**Connection policy: Use direct connection mode**</span><span class="sxs-lookup"><span data-stu-id="899bb-115">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="899bb-116">How a client connects to Azure Cosmos DB has important implications on performance, especially in terms of observed client-side latency.</span><span class="sxs-lookup"><span data-stu-id="899bb-116">How a client connects to Azure Cosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="899bb-117">There are two key configuration settings available for configuring client Connection Policy – the connection *mode* and the [connection *protocol*](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="899bb-117">There are two key configuration settings available for configuring client Connection Policy – the connection *mode* and the [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="899bb-118">The two available modes are:</span><span class="sxs-lookup"><span data-stu-id="899bb-118">The two available modes are:</span></span>

   * <span data-ttu-id="899bb-119">Gateway Mode (default)</span><span class="sxs-lookup"><span data-stu-id="899bb-119">Gateway Mode (default)</span></span>
      
     <span data-ttu-id="899bb-120">Gateway Mode is supported on all SDK platforms and is the configured default.</span><span class="sxs-lookup"><span data-stu-id="899bb-120">Gateway Mode is supported on all SDK platforms and is the configured default.</span></span> <span data-ttu-id="899bb-121">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is the best choice since it uses the standard HTTPS port and a single endpoint.</span><span class="sxs-lookup"><span data-stu-id="899bb-121">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is the best choice since it uses the standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="899bb-122">The performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written to Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="899bb-122">The performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written to Azure Cosmos DB.</span></span> <span data-ttu-id="899bb-123">Because of this, Direct Mode offers better performance due to fewer network hops.</span><span class="sxs-lookup"><span data-stu-id="899bb-123">Because of this, Direct Mode offers better performance due to fewer network hops.</span></span> <span data-ttu-id="899bb-124">Gateway connection mode is also recommended when you run applications in environments with limited number of socket connections, for example when using Azure Functions or if you are on a consumption plan.</span><span class="sxs-lookup"><span data-stu-id="899bb-124">Gateway connection mode is also recommended when you run applications in environments with limited number of socket connections, for example when using Azure Functions or if you are on a consumption plan.</span></span> 

   * <span data-ttu-id="899bb-125">Direct Mode</span><span class="sxs-lookup"><span data-stu-id="899bb-125">Direct Mode</span></span>

     <span data-ttu-id="899bb-126">Direct mode supports connectivity through TCP and HTTPS protocols.</span><span class="sxs-lookup"><span data-stu-id="899bb-126">Direct mode supports connectivity through TCP and HTTPS protocols.</span></span> <span data-ttu-id="899bb-127">Currently, direct is supported in .NET Standard 2.0 for Windows platform only.</span><span class="sxs-lookup"><span data-stu-id="899bb-127">Currently, direct is supported in .NET Standard 2.0 for Windows platform only.</span></span> <span data-ttu-id="899bb-128">When using Direct Mode, there are two protocol options available:</span><span class="sxs-lookup"><span data-stu-id="899bb-128">When using Direct Mode, there are two protocol options available:</span></span>

    * <span data-ttu-id="899bb-129">TCP</span><span class="sxs-lookup"><span data-stu-id="899bb-129">TCP</span></span>
    * <span data-ttu-id="899bb-130">HTTPS</span><span class="sxs-lookup"><span data-stu-id="899bb-130">HTTPS</span></span>

    <span data-ttu-id="899bb-131">When using Gateway mode, Azure Cosmos DB uses port 443 and MongoDB API uses 10250, 10255 and 10256 ports.</span><span class="sxs-lookup"><span data-stu-id="899bb-131">When using Gateway mode, Azure Cosmos DB uses port 443 and MongoDB API uses 10250, 10255 and 10256 ports.</span></span> <span data-ttu-id="899bb-132">The 10250 port maps to a default Mongodb instance without  geo-replication and 10255/10256 ports map to the Mongodb instance with geo-replication functionality.</span><span class="sxs-lookup"><span data-stu-id="899bb-132">The 10250 port maps to a default Mongodb instance without  geo-replication and 10255/10256 ports map to the Mongodb instance with geo-replication functionality.</span></span> <span data-ttu-id="899bb-133">When using TCP in Direct Mode, in addition to the Gateway ports, you need to ensure the port range between 10000 and 20000 is open because Azure Cosmos DB uses dynamic TCP ports.</span><span class="sxs-lookup"><span data-stu-id="899bb-133">When using TCP in Direct Mode, in addition to the Gateway ports, you need to ensure the port range between 10000 and 20000 is open because Azure Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="899bb-134">If these ports are not open and you attempt to use TCP, you receive a 503 Service Unavailable error.</span><span class="sxs-lookup"><span data-stu-id="899bb-134">If these ports are not open and you attempt to use TCP, you receive a 503 Service Unavailable error.</span></span> <span data-ttu-id="899bb-135">The following table shows connectivity modes available for different APIs and the service ports user for each API:</span><span class="sxs-lookup"><span data-stu-id="899bb-135">The following table shows connectivity modes available for different APIs and the service ports user for each API:</span></span>

    |<span data-ttu-id="899bb-136">Connection mode</span><span class="sxs-lookup"><span data-stu-id="899bb-136">Connection mode</span></span>  |<span data-ttu-id="899bb-137">Supported protocol</span><span class="sxs-lookup"><span data-stu-id="899bb-137">Supported protocol</span></span>  |<span data-ttu-id="899bb-138">Supported SDKs</span><span class="sxs-lookup"><span data-stu-id="899bb-138">Supported SDKs</span></span>  |<span data-ttu-id="899bb-139">API/Service port</span><span class="sxs-lookup"><span data-stu-id="899bb-139">API/Service port</span></span>  |
    |---------|---------|---------|---------|
    |<span data-ttu-id="899bb-140">Gateway</span><span class="sxs-lookup"><span data-stu-id="899bb-140">Gateway</span></span>  |   <span data-ttu-id="899bb-141">HTTPS</span><span class="sxs-lookup"><span data-stu-id="899bb-141">HTTPS</span></span>    |  <span data-ttu-id="899bb-142">All SDKS</span><span class="sxs-lookup"><span data-stu-id="899bb-142">All SDKS</span></span>    |   <span data-ttu-id="899bb-143">SQL(443), Mongo(10250, 10255, 10256), Table(443), Cassandra(443), Graph(443)</span><span class="sxs-lookup"><span data-stu-id="899bb-143">SQL(443), Mongo(10250, 10255, 10256), Table(443), Cassandra(443), Graph(443)</span></span>    |
    |<span data-ttu-id="899bb-144">Direct</span><span class="sxs-lookup"><span data-stu-id="899bb-144">Direct</span></span>    |    <span data-ttu-id="899bb-145">HTTPS</span><span class="sxs-lookup"><span data-stu-id="899bb-145">HTTPS</span></span>     |  <span data-ttu-id="899bb-146">.Net and Java SDK</span><span class="sxs-lookup"><span data-stu-id="899bb-146">.Net and Java SDK</span></span>    |    <span data-ttu-id="899bb-147">SQL(443)</span><span class="sxs-lookup"><span data-stu-id="899bb-147">SQL(443)</span></span>   |
    |<span data-ttu-id="899bb-148">Direct</span><span class="sxs-lookup"><span data-stu-id="899bb-148">Direct</span></span>    |     <span data-ttu-id="899bb-149">TCP</span><span class="sxs-lookup"><span data-stu-id="899bb-149">TCP</span></span>    |  <span data-ttu-id="899bb-150">.Net SDK</span><span class="sxs-lookup"><span data-stu-id="899bb-150">.Net SDK</span></span>    | <span data-ttu-id="899bb-151">Ports within 10,000-20,000 range</span><span class="sxs-lookup"><span data-stu-id="899bb-151">Ports within 10,000-20,000 range</span></span> |

    <span data-ttu-id="899bb-152">Azure Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span><span class="sxs-lookup"><span data-stu-id="899bb-152">Azure Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="899bb-153">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through the .NET client SDK.</span><span class="sxs-lookup"><span data-stu-id="899bb-153">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through the .NET client SDK.</span></span> <span data-ttu-id="899bb-154">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span><span class="sxs-lookup"><span data-stu-id="899bb-154">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="899bb-155">For best performance, use the TCP protocol when possible.</span><span class="sxs-lookup"><span data-stu-id="899bb-155">For best performance, use the TCP protocol when possible.</span></span>

    <span data-ttu-id="899bb-156">The Connectivity Mode is configured during the construction of the DocumentClient instance with the ConnectionPolicy parameter.</span><span class="sxs-lookup"><span data-stu-id="899bb-156">The Connectivity Mode is configured during the construction of the DocumentClient instance with the ConnectionPolicy parameter.</span></span> <span data-ttu-id="899bb-157">If Direct Mode is used, the Protocol can also be set within the ConnectionPolicy parameter.</span><span class="sxs-lookup"><span data-stu-id="899bb-157">If Direct Mode is used, the Protocol can also be set within the ConnectionPolicy parameter.</span></span>

    ```csharp
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from the Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="899bb-158">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then the HTTPS protocol is always used to communicate with the Gateway and the Protocol value in the ConnectionPolicy is ignored.</span><span class="sxs-lookup"><span data-stu-id="899bb-158">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then the HTTPS protocol is always used to communicate with the Gateway and the Protocol value in the ConnectionPolicy is ignored.</span></span>

    ![Illustration of the Azure Cosmos DB connection policy](./media/performance-tips/connection-policy.png)

2. <span data-ttu-id="899bb-160">**Call OpenAsync to avoid startup latency on first request**</span><span class="sxs-lookup"><span data-stu-id="899bb-160">**Call OpenAsync to avoid startup latency on first request**</span></span>

    <span data-ttu-id="899bb-161">By default, the first request has a higher latency because it has to fetch the address routing table.</span><span class="sxs-lookup"><span data-stu-id="899bb-161">By default, the first request has a higher latency because it has to fetch the address routing table.</span></span> <span data-ttu-id="899bb-162">To avoid this startup latency on the first request, you should call OpenAsync() once during initialization as follows.</span><span class="sxs-lookup"><span data-stu-id="899bb-162">To avoid this startup latency on the first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
3. <span data-ttu-id="899bb-163">**Collocate clients in same Azure region for performance**</span><span class="sxs-lookup"><span data-stu-id="899bb-163">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="899bb-164">When possible, place any applications calling Azure Cosmos DB in the same region as the Azure Cosmos DB database.</span><span class="sxs-lookup"><span data-stu-id="899bb-164">When possible, place any applications calling Azure Cosmos DB in the same region as the Azure Cosmos DB database.</span></span> <span data-ttu-id="899bb-165">For an approximate comparison, calls to Azure Cosmos DB within the same region complete within 1-2 ms, but the latency between the West and East coast of the US is >50 ms.</span><span class="sxs-lookup"><span data-stu-id="899bb-165">For an approximate comparison, calls to Azure Cosmos DB within the same region complete within 1-2 ms, but the latency between the West and East coast of the US is >50 ms.</span></span> <span data-ttu-id="899bb-166">This latency can likely vary from request to request depending on the route taken by the request as it passes from the client to the Azure datacenter boundary.</span><span class="sxs-lookup"><span data-stu-id="899bb-166">This latency can likely vary from request to request depending on the route taken by the request as it passes from the client to the Azure datacenter boundary.</span></span> <span data-ttu-id="899bb-167">The lowest possible latency is achieved by ensuring the calling application is located within the same Azure region as the provisioned Azure Cosmos DB endpoint.</span><span class="sxs-lookup"><span data-stu-id="899bb-167">The lowest possible latency is achieved by ensuring the calling application is located within the same Azure region as the provisioned Azure Cosmos DB endpoint.</span></span> <span data-ttu-id="899bb-168">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="899bb-168">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="899bb-169">![Illustration of the Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="899bb-169">![Illustration of the Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
4. <span data-ttu-id="899bb-170">**Increase number of threads/tasks**</span><span class="sxs-lookup"><span data-stu-id="899bb-170">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="899bb-171">Since calls to Azure Cosmos DB are made over the network, you may need to vary the degree of parallelism of your requests so that the client application spends very little time waiting between requests.</span><span class="sxs-lookup"><span data-stu-id="899bb-171">Since calls to Azure Cosmos DB are made over the network, you may need to vary the degree of parallelism of your requests so that the client application spends very little time waiting between requests.</span></span> <span data-ttu-id="899bb-172">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in the order of 100s of Tasks reading or writing to Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="899bb-172">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in the order of 100s of Tasks reading or writing to Azure Cosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="899bb-173">SDK Usage</span><span class="sxs-lookup"><span data-stu-id="899bb-173">SDK Usage</span></span>
1. <span data-ttu-id="899bb-174">**Install the most recent SDK**</span><span class="sxs-lookup"><span data-stu-id="899bb-174">**Install the most recent SDK**</span></span>

    <span data-ttu-id="899bb-175">The Azure Cosmos DB SDKs are constantly being improved to provide the best performance.</span><span class="sxs-lookup"><span data-stu-id="899bb-175">The Azure Cosmos DB SDKs are constantly being improved to provide the best performance.</span></span> <span data-ttu-id="899bb-176">See the [Azure Cosmos DB SDK](documentdb-sdk-dotnet.md) pages to determine the most recent SDK and review improvements.</span><span class="sxs-lookup"><span data-stu-id="899bb-176">See the [Azure Cosmos DB SDK](documentdb-sdk-dotnet.md) pages to determine the most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="899bb-177">**Use a singleton Azure Cosmos DB client for the lifetime of your application**</span><span class="sxs-lookup"><span data-stu-id="899bb-177">**Use a singleton Azure Cosmos DB client for the lifetime of your application**</span></span>

    <span data-ttu-id="899bb-178">Each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span><span class="sxs-lookup"><span data-stu-id="899bb-178">Each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="899bb-179">To allow efficient connection management and better performance by DocumentClient, it is recommended to use a single instance of DocumentClient per AppDomain for the lifetime of the application.</span><span class="sxs-lookup"><span data-stu-id="899bb-179">To allow efficient connection management and better performance by DocumentClient, it is recommended to use a single instance of DocumentClient per AppDomain for the lifetime of the application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="899bb-180">**Increase System.Net MaxConnections per host when using Gateway mode**</span><span class="sxs-lookup"><span data-stu-id="899bb-180">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="899bb-181">Azure Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected to the default connection limit per hostname or IP address.</span><span class="sxs-lookup"><span data-stu-id="899bb-181">Azure Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected to the default connection limit per hostname or IP address.</span></span> <span data-ttu-id="899bb-182">You may need to set the MaxConnections to a higher value (100-1000) so that the client library can utilize multiple simultaneous connections to Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="899bb-182">You may need to set the MaxConnections to a higher value (100-1000) so that the client library can utilize multiple simultaneous connections to Azure Cosmos DB.</span></span> <span data-ttu-id="899bb-183">In the .NET SDK 1.8.0 and above, the default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and to change the value, you can set the [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) to a higher value.</span><span class="sxs-lookup"><span data-stu-id="899bb-183">In the .NET SDK 1.8.0 and above, the default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and to change the value, you can set the [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) to a higher value.</span></span>   
4. <span data-ttu-id="899bb-184">**Tuning parallel queries for partitioned collections**</span><span class="sxs-lookup"><span data-stu-id="899bb-184">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="899bb-185">SQL .NET SDK version 1.9.0 and above support parallel queries, which enable you to query a partitioned collection in parallel (see [Working with the SDKs](sql-api-partition-data.md#working-with-the-azure-cosmos-db-sdks) and the related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span><span class="sxs-lookup"><span data-stu-id="899bb-185">SQL .NET SDK version 1.9.0 and above support parallel queries, which enable you to query a partitioned collection in parallel (see [Working with the SDKs](sql-api-partition-data.md#working-with-the-azure-cosmos-db-sdks) and the related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="899bb-186">Parallel queries are designed to improve query latency and throughput over their serial counterpart.</span><span class="sxs-lookup"><span data-stu-id="899bb-186">Parallel queries are designed to improve query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="899bb-187">Parallel queries provide two parameters that users can tune to custom-fit their requirements, (a) MaxDegreeOfParallelism: to control the maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: to control the number of pre-fetched results.</span><span class="sxs-lookup"><span data-stu-id="899bb-187">Parallel queries provide two parameters that users can tune to custom-fit their requirements, (a) MaxDegreeOfParallelism: to control the maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: to control the number of pre-fetched results.</span></span>

    <span data-ttu-id="899bb-188">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span><span class="sxs-lookup"><span data-stu-id="899bb-188">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="899bb-189">However, data from an individual partitioned collect is fetched serially with respect to the query.</span><span class="sxs-lookup"><span data-stu-id="899bb-189">However, data from an individual partitioned collect is fetched serially with respect to the query.</span></span> <span data-ttu-id="899bb-190">So, setting the MaxDegreeOfParallelism to the number of partitions has the maximum chance of achieving the most performant query, provided all other system conditions remain the same.</span><span class="sxs-lookup"><span data-stu-id="899bb-190">So, setting the MaxDegreeOfParallelism to the number of partitions has the maximum chance of achieving the most performant query, provided all other system conditions remain the same.</span></span> <span data-ttu-id="899bb-191">If you don't know the number of partitions, you can set the MaxDegreeOfParallelism to a high number, and the system chooses the minimum (number of partitions, user provided input) as the MaxDegreeOfParallelism.</span><span class="sxs-lookup"><span data-stu-id="899bb-191">If you don't know the number of partitions, you can set the MaxDegreeOfParallelism to a high number, and the system chooses the minimum (number of partitions, user provided input) as the MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="899bb-192">It is important to note that parallel queries produce the best benefits if the data is evenly distributed across all partitions with respect to the query.</span><span class="sxs-lookup"><span data-stu-id="899bb-192">It is important to note that parallel queries produce the best benefits if the data is evenly distributed across all partitions with respect to the query.</span></span> <span data-ttu-id="899bb-193">If the partitioned collection is partitioned such a way that all or a majority of the data returned by a query is concentrated in a few partitions (one partition in worst case), then the performance of the query would be bottlenecked by those partitions.</span><span class="sxs-lookup"><span data-stu-id="899bb-193">If the partitioned collection is partitioned such a way that all or a majority of the data returned by a query is concentrated in a few partitions (one partition in worst case), then the performance of the query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="899bb-194">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed to pre-fetch results while the current batch of results is being processed by the client.</span><span class="sxs-lookup"><span data-stu-id="899bb-194">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed to pre-fetch results while the current batch of results is being processed by the client.</span></span> <span data-ttu-id="899bb-195">The pre-fetching helps in overall latency improvement of a query.</span><span class="sxs-lookup"><span data-stu-id="899bb-195">The pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="899bb-196">MaxBufferedItemCount is the parameter to limit the number of pre-fetched results.</span><span class="sxs-lookup"><span data-stu-id="899bb-196">MaxBufferedItemCount is the parameter to limit the number of pre-fetched results.</span></span> <span data-ttu-id="899bb-197">Setting MaxBufferedItemCount to the expected number of results returned (or a higher number) allows the query to receive maximum benefit from pre-fetching.</span><span class="sxs-lookup"><span data-stu-id="899bb-197">Setting MaxBufferedItemCount to the expected number of results returned (or a higher number) allows the query to receive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="899bb-198">Pre-fetching works the same way irrespective of the MaxDegreeOfParallelism, and there is a single buffer for the data from all partitions.</span><span class="sxs-lookup"><span data-stu-id="899bb-198">Pre-fetching works the same way irrespective of the MaxDegreeOfParallelism, and there is a single buffer for the data from all partitions.</span></span>  
5. <span data-ttu-id="899bb-199">**Turn on server-side GC**</span><span class="sxs-lookup"><span data-stu-id="899bb-199">**Turn on server-side GC**</span></span>

    <span data-ttu-id="899bb-200">Reducing the frequency of garbage collection may help in some cases.</span><span class="sxs-lookup"><span data-stu-id="899bb-200">Reducing the frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="899bb-201">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) to true.</span><span class="sxs-lookup"><span data-stu-id="899bb-201">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) to true.</span></span>
6. <span data-ttu-id="899bb-202">**Implement backoff at RetryAfter intervals**</span><span class="sxs-lookup"><span data-stu-id="899bb-202">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="899bb-203">During performance testing, you should increase load until a small rate of requests get throttled.</span><span class="sxs-lookup"><span data-stu-id="899bb-203">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="899bb-204">If throttled, the client application should backoff on throttle for the server-specified retry interval.</span><span class="sxs-lookup"><span data-stu-id="899bb-204">If throttled, the client application should backoff on throttle for the server-specified retry interval.</span></span> <span data-ttu-id="899bb-205">Respecting the backoff ensures that you spend minimal amount of time waiting between retries.</span><span class="sxs-lookup"><span data-stu-id="899bb-205">Respecting the backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="899bb-206">Retry policy support is included in Version 1.8.0 and above of the SQL [.NET](sql-api-sdk-dotnet.md) and [Java](sql-api-sdk-java.md), version 1.9.0 and above of the [Node.js](sql-api-sdk-node.md) and [Python](sql-api-sdk-python.md), and all supported versions of the [.NET Core](sql-api-sdk-dotnet-core.md) SDKs.</span><span class="sxs-lookup"><span data-stu-id="899bb-206">Retry policy support is included in Version 1.8.0 and above of the SQL [.NET](sql-api-sdk-dotnet.md) and [Java](sql-api-sdk-java.md), version 1.9.0 and above of the [Node.js](sql-api-sdk-node.md) and [Python](sql-api-sdk-python.md), and all supported versions of the [.NET Core](sql-api-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="899bb-207">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="899bb-207">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
    
    <span data-ttu-id="899bb-208">With version 1.19 and later of the .NET SDK, there is a mechanism to log additional diagnostic information and troubleshoot latency issues as shown in the following sample.</span><span class="sxs-lookup"><span data-stu-id="899bb-208">With version 1.19 and later of the .NET SDK, there is a mechanism to log additional diagnostic information and troubleshoot latency issues as shown in the following sample.</span></span> <span data-ttu-id="899bb-209">You can log the diagnostic string for requests that have a higher read latency.</span><span class="sxs-lookup"><span data-stu-id="899bb-209">You can log the diagnostic string for requests that have a higher read latency.</span></span> <span data-ttu-id="899bb-210">The captured diagnostic string will help you understand the number of times you observed 429s for a given request.</span><span class="sxs-lookup"><span data-stu-id="899bb-210">The captured diagnostic string will help you understand the number of times you observed 429s for a given request.</span></span>
    ```csharp
    ResourceResponse<Document> readDocument = await this.readClient.ReadDocumentAsync(oldDocuments[i].SelfLink);
    readDocument.RequestDiagnosticsString 
    ```
    
7. <span data-ttu-id="899bb-211">**Scale out your client-workload**</span><span class="sxs-lookup"><span data-stu-id="899bb-211">**Scale out your client-workload**</span></span>

    <span data-ttu-id="899bb-212">If you are testing at high throughput levels (>50,000 RU/s), the client application may become the bottleneck due to the machine capping out on CPU or Network utilization.</span><span class="sxs-lookup"><span data-stu-id="899bb-212">If you are testing at high throughput levels (>50,000 RU/s), the client application may become the bottleneck due to the machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="899bb-213">If you reach this point, you can continue to push the Azure Cosmos DB account further by scaling out your client applications across multiple servers.</span><span class="sxs-lookup"><span data-stu-id="899bb-213">If you reach this point, you can continue to push the Azure Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="899bb-214">**Cache document URIs for lower read latency**</span><span class="sxs-lookup"><span data-stu-id="899bb-214">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="899bb-215">Cache document URIs whenever possible for the best read performance.</span><span class="sxs-lookup"><span data-stu-id="899bb-215">Cache document URIs whenever possible for the best read performance.</span></span> <span data-ttu-id="899bb-216">You have to define logic to cache the resourceid when you create the resource.</span><span class="sxs-lookup"><span data-stu-id="899bb-216">You have to define logic to cache the resourceid when you create the resource.</span></span> <span data-ttu-id="899bb-217">Resourceid based lookups are faster than name based lookups, so caching these values improves the performance.</span><span class="sxs-lookup"><span data-stu-id="899bb-217">Resourceid based lookups are faster than name based lookups, so caching these values improves the performance.</span></span> 

   <a id="tune-page-size"></a>
1. <span data-ttu-id="899bb-218">**Tune the page size for queries/read feeds for better performance**</span><span class="sxs-lookup"><span data-stu-id="899bb-218">**Tune the page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="899bb-219">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a SQL query, the results are returned in a segmented fashion if the result set is too large.</span><span class="sxs-lookup"><span data-stu-id="899bb-219">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a SQL query, the results are returned in a segmented fashion if the result set is too large.</span></span> <span data-ttu-id="899bb-220">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span><span class="sxs-lookup"><span data-stu-id="899bb-220">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="899bb-221">To reduce the number of network round trips required to retrieve all applicable results, you can increase the page size using [x-ms-max-item-count](https://docs.microsoft.com/rest/api/cosmos-db/common-cosmosdb-rest-request-headers) request header to up to 1000.</span><span class="sxs-lookup"><span data-stu-id="899bb-221">To reduce the number of network round trips required to retrieve all applicable results, you can increase the page size using [x-ms-max-item-count](https://docs.microsoft.com/rest/api/cosmos-db/common-cosmosdb-rest-request-headers) request header to up to 1000.</span></span> <span data-ttu-id="899bb-222">In cases where you need to display only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease the page size to 10 to reduce the throughput consumed for reads and queries.</span><span class="sxs-lookup"><span data-stu-id="899bb-222">In cases where you need to display only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease the page size to 10 to reduce the throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="899bb-223">You may also set the page size using the available Azure Cosmos DB SDKs.</span><span class="sxs-lookup"><span data-stu-id="899bb-223">You may also set the page size using the available Azure Cosmos DB SDKs.</span></span>  <span data-ttu-id="899bb-224">For example:</span><span class="sxs-lookup"><span data-stu-id="899bb-224">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="899bb-225">**Increase number of threads/tasks**</span><span class="sxs-lookup"><span data-stu-id="899bb-225">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="899bb-226">See [Increase number of threads/tasks](#increase-threads) in the Networking section.</span><span class="sxs-lookup"><span data-stu-id="899bb-226">See [Increase number of threads/tasks](#increase-threads) in the Networking section.</span></span>

11. <span data-ttu-id="899bb-227">**Use 64-bit host processing**</span><span class="sxs-lookup"><span data-stu-id="899bb-227">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="899bb-228">The SQL SDK works in a 32-bit host process when you are using SQL .NET SDK version 1.11.4 and above.</span><span class="sxs-lookup"><span data-stu-id="899bb-228">The SQL SDK works in a 32-bit host process when you are using SQL .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="899bb-229">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span><span class="sxs-lookup"><span data-stu-id="899bb-229">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="899bb-230">The following types of applications have 32-bit host process as the default, so in order to change that to 64-bit, follow these steps based on the type of your application:</span><span class="sxs-lookup"><span data-stu-id="899bb-230">The following types of applications have 32-bit host process as the default, so in order to change that to 64-bit, follow these steps based on the type of your application:</span></span>

    - <span data-ttu-id="899bb-231">For Executable applications, this can be done by unchecking the **Prefer 32-bit** option in the **Project Properties** window, on the **Build** tab.</span><span class="sxs-lookup"><span data-stu-id="899bb-231">For Executable applications, this can be done by unchecking the **Prefer 32-bit** option in the **Project Properties** window, on the **Build** tab.</span></span>

    - <span data-ttu-id="899bb-232">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from the **Visual Studio Test** menu option.</span><span class="sxs-lookup"><span data-stu-id="899bb-232">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from the **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="899bb-233">For locally deployed ASP.NET Web applications, this can be done by checking the **Use the 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span><span class="sxs-lookup"><span data-stu-id="899bb-233">For locally deployed ASP.NET Web applications, this can be done by checking the **Use the 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="899bb-234">For ASP.NET Web applications deployed on Azure, this can be done by choosing the **Platform as 64-bit** in the **Application Settings** on the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="899bb-234">For ASP.NET Web applications deployed on Azure, this can be done by choosing the **Platform as 64-bit** in the **Application Settings** on the Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="899bb-235">Indexing Policy</span><span class="sxs-lookup"><span data-stu-id="899bb-235">Indexing Policy</span></span>
 
1. <span data-ttu-id="899bb-236">**Exclude unused paths from indexing for faster writes**</span><span class="sxs-lookup"><span data-stu-id="899bb-236">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="899bb-237">Cosmos DB’s indexing policy also allows you to specify which document paths to include or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span><span class="sxs-lookup"><span data-stu-id="899bb-237">Cosmos DB’s indexing policy also allows you to specify which document paths to include or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="899bb-238">The use of indexing paths can offer improved write performance and lower index storage for scenarios in which the query patterns are known beforehand, as indexing costs are directly correlated to the number of unique paths indexed.</span><span class="sxs-lookup"><span data-stu-id="899bb-238">The use of indexing paths can offer improved write performance and lower index storage for scenarios in which the query patterns are known beforehand, as indexing costs are directly correlated to the number of unique paths indexed.</span></span>  <span data-ttu-id="899bb-239">For example, the following code shows how to exclude an entire section of the documents (a.k.a.</span><span class="sxs-lookup"><span data-stu-id="899bb-239">For example, the following code shows how to exclude an entire section of the documents (a.k.a.</span></span> <span data-ttu-id="899bb-240">a subtree) from indexing using the "\*" wildcard.</span><span class="sxs-lookup"><span data-stu-id="899bb-240">a subtree) from indexing using the "\*" wildcard.</span></span>

    ```csharp
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="899bb-241">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="899bb-241">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="899bb-242">Throughput</span><span class="sxs-lookup"><span data-stu-id="899bb-242">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="899bb-243">**Measure and tune for lower request units/second usage**</span><span class="sxs-lookup"><span data-stu-id="899bb-243">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="899bb-244">Azure Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on the documents within a database collection.</span><span class="sxs-lookup"><span data-stu-id="899bb-244">Azure Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on the documents within a database collection.</span></span> <span data-ttu-id="899bb-245">The cost associated with each of these operations varies based on the CPU, IO, and memory required to complete the operation.</span><span class="sxs-lookup"><span data-stu-id="899bb-245">The cost associated with each of these operations varies based on the CPU, IO, and memory required to complete the operation.</span></span> <span data-ttu-id="899bb-246">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for the resources required to perform various database operations and service an application request.</span><span class="sxs-lookup"><span data-stu-id="899bb-246">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for the resources required to perform various database operations and service an application request.</span></span>

    <span data-ttu-id="899bb-247">Throughput is provisioned based on the number of [request units](request-units.md) set for each container.</span><span class="sxs-lookup"><span data-stu-id="899bb-247">Throughput is provisioned based on the number of [request units](request-units.md) set for each container.</span></span> <span data-ttu-id="899bb-248">Request unit consumption is evaluated as a rate per second.</span><span class="sxs-lookup"><span data-stu-id="899bb-248">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="899bb-249">Applications that exceed the provisioned request unit rate for their container are limited until the rate drops below the provisioned level for the container.</span><span class="sxs-lookup"><span data-stu-id="899bb-249">Applications that exceed the provisioned request unit rate for their container are limited until the rate drops below the provisioned level for the container.</span></span> <span data-ttu-id="899bb-250">If your application requires a higher level of throughput, you can increase your throughput by provisioning additional request units.</span><span class="sxs-lookup"><span data-stu-id="899bb-250">If your application requires a higher level of throughput, you can increase your throughput by provisioning additional request units.</span></span> 

    <span data-ttu-id="899bb-251">The complexity of a query impacts how many Request Units are consumed for an operation.</span><span class="sxs-lookup"><span data-stu-id="899bb-251">The complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="899bb-252">The number of predicates, nature of the predicates, number of UDFs, and the size of the source data set all influence the cost of query operations.</span><span class="sxs-lookup"><span data-stu-id="899bb-252">The number of predicates, nature of the predicates, number of UDFs, and the size of the source data set all influence the cost of query operations.</span></span>

    <span data-ttu-id="899bb-253">To measure the overhead of any operation (create, update, or delete), inspect the [x-ms-request-charge](https://docs.microsoft.com/rest/api/cosmos-db/common-cosmosdb-rest-response-headers) header (or the equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in the .NET SDK) to measure the number of request units consumed by these operations.</span><span class="sxs-lookup"><span data-stu-id="899bb-253">To measure the overhead of any operation (create, update, or delete), inspect the [x-ms-request-charge](https://docs.microsoft.com/rest/api/cosmos-db/common-cosmosdb-rest-response-headers) header (or the equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in the .NET SDK) to measure the number of request units consumed by these operations.</span></span>

    ```csharp
    // Measure the performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure the performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="899bb-254">The request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span><span class="sxs-lookup"><span data-stu-id="899bb-254">The request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="899bb-255">For example, if the preceding query returns 1000 1KB-documents, the cost of the operation is 1000.</span><span class="sxs-lookup"><span data-stu-id="899bb-255">For example, if the preceding query returns 1000 1KB-documents, the cost of the operation is 1000.</span></span> <span data-ttu-id="899bb-256">As such, within one second, the server honors only two such requests before rate limiting subsequent requests.</span><span class="sxs-lookup"><span data-stu-id="899bb-256">As such, within one second, the server honors only two such requests before rate limiting subsequent requests.</span></span> <span data-ttu-id="899bb-257">For more information, see [Request units](request-units.md) and the [request unit calculator](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="899bb-257">For more information, see [Request units](request-units.md) and the [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="899bb-258">**Handle rate limiting/request rate too large**</span><span class="sxs-lookup"><span data-stu-id="899bb-258">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="899bb-259">When a client attempts to exceed the reserved throughput for an account, there is no performance degradation at the server and no use of throughput capacity beyond the reserved level.</span><span class="sxs-lookup"><span data-stu-id="899bb-259">When a client attempts to exceed the reserved throughput for an account, there is no performance degradation at the server and no use of throughput capacity beyond the reserved level.</span></span> <span data-ttu-id="899bb-260">The server will preemptively end the request with RequestRateTooLarge (HTTP status code 429) and return the [x-ms-retry-after-ms](https://docs.microsoft.com/rest/api/cosmos-db/common-cosmosdb-rest-response-headers) header indicating the amount of time, in milliseconds, that the user must wait before reattempting the request.</span><span class="sxs-lookup"><span data-stu-id="899bb-260">The server will preemptively end the request with RequestRateTooLarge (HTTP status code 429) and return the [x-ms-retry-after-ms](https://docs.microsoft.com/rest/api/cosmos-db/common-cosmosdb-rest-response-headers) header indicating the amount of time, in milliseconds, that the user must wait before reattempting the request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="899bb-261">The SDKs all implicitly catch this response, respect the server-specified retry-after header, and retry the request.</span><span class="sxs-lookup"><span data-stu-id="899bb-261">The SDKs all implicitly catch this response, respect the server-specified retry-after header, and retry the request.</span></span> <span data-ttu-id="899bb-262">Unless your account is being accessed concurrently by multiple clients, the next retry will succeed.</span><span class="sxs-lookup"><span data-stu-id="899bb-262">Unless your account is being accessed concurrently by multiple clients, the next retry will succeed.</span></span>

    <span data-ttu-id="899bb-263">If you have more than one client cumulatively operating consistently above the request rate, the default retry count currently set to 9 internally by the client may not suffice; in this case, the client throws a DocumentClientException with status code 429 to the application.</span><span class="sxs-lookup"><span data-stu-id="899bb-263">If you have more than one client cumulatively operating consistently above the request rate, the default retry count currently set to 9 internally by the client may not suffice; in this case, the client throws a DocumentClientException with status code 429 to the application.</span></span> <span data-ttu-id="899bb-264">The default retry count can be changed by setting the RetryOptions on the ConnectionPolicy instance.</span><span class="sxs-lookup"><span data-stu-id="899bb-264">The default retry count can be changed by setting the RetryOptions on the ConnectionPolicy instance.</span></span> <span data-ttu-id="899bb-265">By default, the DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if the request continues to operate above the request rate.</span><span class="sxs-lookup"><span data-stu-id="899bb-265">By default, the DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if the request continues to operate above the request rate.</span></span> <span data-ttu-id="899bb-266">This occurs even when the current retry count is less than the max retry count, be it the default of 9 or a user-defined value.</span><span class="sxs-lookup"><span data-stu-id="899bb-266">This occurs even when the current retry count is less than the max retry count, be it the default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="899bb-267">While the automated retry behavior helps to improve resiliency and usability for the most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span><span class="sxs-lookup"><span data-stu-id="899bb-267">While the automated retry behavior helps to improve resiliency and usability for the most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="899bb-268">The client-observed latency will spike if the experiment hits the server throttle and causes the client SDK to silently retry.</span><span class="sxs-lookup"><span data-stu-id="899bb-268">The client-observed latency will spike if the experiment hits the server throttle and causes the client SDK to silently retry.</span></span> <span data-ttu-id="899bb-269">To avoid latency spikes during performance experiments, measure the charge returned by each operation and ensure that requests are operating below the reserved request rate.</span><span class="sxs-lookup"><span data-stu-id="899bb-269">To avoid latency spikes during performance experiments, measure the charge returned by each operation and ensure that requests are operating below the reserved request rate.</span></span> <span data-ttu-id="899bb-270">For more information, see [Request units](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="899bb-270">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="899bb-271">**Design for smaller documents for higher throughput**</span><span class="sxs-lookup"><span data-stu-id="899bb-271">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="899bb-272">The request charge (i.e. request processing cost) of a given operation is directly correlated to the size of the document.</span><span class="sxs-lookup"><span data-stu-id="899bb-272">The request charge (i.e. request processing cost) of a given operation is directly correlated to the size of the document.</span></span> <span data-ttu-id="899bb-273">Operations on large documents cost more than operations for small documents.</span><span class="sxs-lookup"><span data-stu-id="899bb-273">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="899bb-274">Next steps</span><span class="sxs-lookup"><span data-stu-id="899bb-274">Next steps</span></span>
<span data-ttu-id="899bb-275">For a sample application used to evaluate Azure Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Azure Cosmos DB](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="899bb-275">For a sample application used to evaluate Azure Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Azure Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="899bb-276">Also, to learn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="899bb-276">Also, to learn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>
