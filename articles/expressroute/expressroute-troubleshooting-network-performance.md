---
title: Troubleshooting Azure Virtual Network Performance | Microsoft Docs
description: This page provides a standardized method of testing Azure network link performance.
services: expressroute
documentationcenter: na
author: tracsman
manager: rossort
editor: ''
ms.assetid: ''
ms.service: expressroute
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/20/2017
ms.author: jonor
ms.openlocfilehash: 56f011632a2aa3ef0632efd5ace472c0fc79a329
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44870740"
---
# <a name="troubleshooting-network-performance"></a><span data-ttu-id="24e06-103">Troubleshooting network performance</span><span class="sxs-lookup"><span data-stu-id="24e06-103">Troubleshooting network performance</span></span>
## <a name="overview"></a><span data-ttu-id="24e06-104">Overview</span><span class="sxs-lookup"><span data-stu-id="24e06-104">Overview</span></span>
<span data-ttu-id="24e06-105">Azure provides stable and fast ways to connect from your on-premises network to Azure.</span><span class="sxs-lookup"><span data-stu-id="24e06-105">Azure provides stable and fast ways to connect from your on-premises network to Azure.</span></span> <span data-ttu-id="24e06-106">Methods like Site-to-Site VPN and ExpressRoute are successfully used by customers large and small to run their businesses in Azure.</span><span class="sxs-lookup"><span data-stu-id="24e06-106">Methods like Site-to-Site VPN and ExpressRoute are successfully used by customers large and small to run their businesses in Azure.</span></span> <span data-ttu-id="24e06-107">But what happens when performance doesn't meet your expectation or previous experience?</span><span class="sxs-lookup"><span data-stu-id="24e06-107">But what happens when performance doesn't meet your expectation or previous experience?</span></span> <span data-ttu-id="24e06-108">This document can help standardize the way you test and baseline your specific environment.</span><span class="sxs-lookup"><span data-stu-id="24e06-108">This document can help standardize the way you test and baseline your specific environment.</span></span>

<span data-ttu-id="24e06-109">This document shows how you can easily and consistently test network latency and bandwidth between two hosts.</span><span class="sxs-lookup"><span data-stu-id="24e06-109">This document shows how you can easily and consistently test network latency and bandwidth between two hosts.</span></span> <span data-ttu-id="24e06-110">This document also provides some advice on ways to look at the Azure network and help to isolate problem points.</span><span class="sxs-lookup"><span data-stu-id="24e06-110">This document also provides some advice on ways to look at the Azure network and help to isolate problem points.</span></span> <span data-ttu-id="24e06-111">The PowerShell script and tools discussed require two hosts on the network (at either end of the link being tested).</span><span class="sxs-lookup"><span data-stu-id="24e06-111">The PowerShell script and tools discussed require two hosts on the network (at either end of the link being tested).</span></span> <span data-ttu-id="24e06-112">One host must be a Windows Server or Desktop, the other can be either Windows or Linux.</span><span class="sxs-lookup"><span data-stu-id="24e06-112">One host must be a Windows Server or Desktop, the other can be either Windows or Linux.</span></span> 

>[!NOTE]
><span data-ttu-id="24e06-113">The approach to troubleshooting, the tools, and methods used are personal preferences.</span><span class="sxs-lookup"><span data-stu-id="24e06-113">The approach to troubleshooting, the tools, and methods used are personal preferences.</span></span> <span data-ttu-id="24e06-114">This document describes the approach and tools I often take.</span><span class="sxs-lookup"><span data-stu-id="24e06-114">This document describes the approach and tools I often take.</span></span> <span data-ttu-id="24e06-115">Your approach will probably differ, there's nothing wrong with different approaches to problem solving.</span><span class="sxs-lookup"><span data-stu-id="24e06-115">Your approach will probably differ, there's nothing wrong with different approaches to problem solving.</span></span> <span data-ttu-id="24e06-116">However, if you don't have an established approach, this document can get you started on the path to building your own methods, tools, and preferences to troubleshooting network issues.</span><span class="sxs-lookup"><span data-stu-id="24e06-116">However, if you don't have an established approach, this document can get you started on the path to building your own methods, tools, and preferences to troubleshooting network issues.</span></span>
>
>

## <a name="network-components"></a><span data-ttu-id="24e06-117">Network components</span><span class="sxs-lookup"><span data-stu-id="24e06-117">Network components</span></span>
<span data-ttu-id="24e06-118">Before digging into troubleshooting, let's discuss some common terms and components.</span><span class="sxs-lookup"><span data-stu-id="24e06-118">Before digging into troubleshooting, let's discuss some common terms and components.</span></span> <span data-ttu-id="24e06-119">This discussion ensures we're thinking about each component in the end-to-end chain that enables connectivity in Azure.</span><span class="sxs-lookup"><span data-stu-id="24e06-119">This discussion ensures we're thinking about each component in the end-to-end chain that enables connectivity in Azure.</span></span>
<span data-ttu-id="24e06-120">[![1]][1]</span><span class="sxs-lookup"><span data-stu-id="24e06-120">[![1]][1]</span></span>

<span data-ttu-id="24e06-121">At the highest level, I describe three major network routing domains;</span><span class="sxs-lookup"><span data-stu-id="24e06-121">At the highest level, I describe three major network routing domains;</span></span>

- <span data-ttu-id="24e06-122">the Azure network (blue cloud on the right)</span><span class="sxs-lookup"><span data-stu-id="24e06-122">the Azure network (blue cloud on the right)</span></span>
- <span data-ttu-id="24e06-123">the Internet or WAN (green cloud in the center)</span><span class="sxs-lookup"><span data-stu-id="24e06-123">the Internet or WAN (green cloud in the center)</span></span>
- <span data-ttu-id="24e06-124">the Corporate Network (peach cloud on the left)</span><span class="sxs-lookup"><span data-stu-id="24e06-124">the Corporate Network (peach cloud on the left)</span></span>

<span data-ttu-id="24e06-125">Looking at the diagram from right to left, let's discuss briefly each component:</span><span class="sxs-lookup"><span data-stu-id="24e06-125">Looking at the diagram from right to left, let's discuss briefly each component:</span></span>
 - <span data-ttu-id="24e06-126">**Virtual Machine** - The server may have multiple NICs, ensure any static routes, default routes, and Operating System settings are sending and receiving traffic the way you think it is.</span><span class="sxs-lookup"><span data-stu-id="24e06-126">**Virtual Machine** - The server may have multiple NICs, ensure any static routes, default routes, and Operating System settings are sending and receiving traffic the way you think it is.</span></span> <span data-ttu-id="24e06-127">Also, each VM SKU has a bandwidth restriction.</span><span class="sxs-lookup"><span data-stu-id="24e06-127">Also, each VM SKU has a bandwidth restriction.</span></span> <span data-ttu-id="24e06-128">If you're using a smaller VM SKU, your traffic is limited by the bandwidth available to the NIC.</span><span class="sxs-lookup"><span data-stu-id="24e06-128">If you're using a smaller VM SKU, your traffic is limited by the bandwidth available to the NIC.</span></span> <span data-ttu-id="24e06-129">I usually use a DS5v2 for testing (and then delete once done with testing to save money) to ensure adequate bandwidth at the VM.</span><span class="sxs-lookup"><span data-stu-id="24e06-129">I usually use a DS5v2 for testing (and then delete once done with testing to save money) to ensure adequate bandwidth at the VM.</span></span>
 - <span data-ttu-id="24e06-130">**NIC** - Ensure you know the private IP that is assigned to the NIC in question.</span><span class="sxs-lookup"><span data-stu-id="24e06-130">**NIC** - Ensure you know the private IP that is assigned to the NIC in question.</span></span>
 - <span data-ttu-id="24e06-131">**NIC NSG** - There may be specific NSGs applied at the NIC level, ensure the NSG rule-set is appropriate for the traffic you're trying to pass.</span><span class="sxs-lookup"><span data-stu-id="24e06-131">**NIC NSG** - There may be specific NSGs applied at the NIC level, ensure the NSG rule-set is appropriate for the traffic you're trying to pass.</span></span> <span data-ttu-id="24e06-132">For example, ensure ports 5201 for iPerf, 3389 for RDP, or 22 for SSH are open to allow test traffic to pass.</span><span class="sxs-lookup"><span data-stu-id="24e06-132">For example, ensure ports 5201 for iPerf, 3389 for RDP, or 22 for SSH are open to allow test traffic to pass.</span></span>
 - <span data-ttu-id="24e06-133">**VNet Subnet** - The NIC is assigned to a specific subnet, ensure you know which one and the rules associated with that subnet.</span><span class="sxs-lookup"><span data-stu-id="24e06-133">**VNet Subnet** - The NIC is assigned to a specific subnet, ensure you know which one and the rules associated with that subnet.</span></span>
 - <span data-ttu-id="24e06-134">**Subnet NSG** - Just like the NIC, NSGs can be applied at the subnet as well.</span><span class="sxs-lookup"><span data-stu-id="24e06-134">**Subnet NSG** - Just like the NIC, NSGs can be applied at the subnet as well.</span></span> <span data-ttu-id="24e06-135">Ensure the NSG rule-set is appropriate for the traffic you're trying to pass.</span><span class="sxs-lookup"><span data-stu-id="24e06-135">Ensure the NSG rule-set is appropriate for the traffic you're trying to pass.</span></span> <span data-ttu-id="24e06-136">(for traffic inbound to the NIC the subnet NSG applies first, then the NIC NSG, conversely for traffic outbound from the VM the NIC NSG applies first then the Subnet NSG comes into play).</span><span class="sxs-lookup"><span data-stu-id="24e06-136">(for traffic inbound to the NIC the subnet NSG applies first, then the NIC NSG, conversely for traffic outbound from the VM the NIC NSG applies first then the Subnet NSG comes into play).</span></span>
 - <span data-ttu-id="24e06-137">**Subnet UDR** - User Defined Routes can direct traffic to an intermediate hop (like a firewall or load-balancer).</span><span class="sxs-lookup"><span data-stu-id="24e06-137">**Subnet UDR** - User Defined Routes can direct traffic to an intermediate hop (like a firewall or load-balancer).</span></span> <span data-ttu-id="24e06-138">Ensure you know if there is a UDR in place for your traffic and if so where it goes and what that next hop will do to your traffic.</span><span class="sxs-lookup"><span data-stu-id="24e06-138">Ensure you know if there is a UDR in place for your traffic and if so where it goes and what that next hop will do to your traffic.</span></span> <span data-ttu-id="24e06-139">(for example, a firewall could pass some traffic and deny other traffic between the same two hosts).</span><span class="sxs-lookup"><span data-stu-id="24e06-139">(for example, a firewall could pass some traffic and deny other traffic between the same two hosts).</span></span>
 - <span data-ttu-id="24e06-140">**Gateway subnet / NSG / UDR** - Just like the VM subnet, the gateway subnet can have NSGs and UDRs.</span><span class="sxs-lookup"><span data-stu-id="24e06-140">**Gateway subnet / NSG / UDR** - Just like the VM subnet, the gateway subnet can have NSGs and UDRs.</span></span> <span data-ttu-id="24e06-141">Make sure you know if they are there and what effects they have on your traffic.</span><span class="sxs-lookup"><span data-stu-id="24e06-141">Make sure you know if they are there and what effects they have on your traffic.</span></span>
 - <span data-ttu-id="24e06-142">**VNet Gateway (ExpressRoute)** - Once peering (ExpressRoute) or VPN is enabled, there aren't many settings that can affect how or if traffic routes.</span><span class="sxs-lookup"><span data-stu-id="24e06-142">**VNet Gateway (ExpressRoute)** - Once peering (ExpressRoute) or VPN is enabled, there aren't many settings that can affect how or if traffic routes.</span></span> <span data-ttu-id="24e06-143">If you have multiple ExpressRoute circuits or VPN tunnels connected to the same VNet Gateway, you should be aware of the connection weight settings as this setting affects connection preference and affects the path your traffic takes.</span><span class="sxs-lookup"><span data-stu-id="24e06-143">If you have multiple ExpressRoute circuits or VPN tunnels connected to the same VNet Gateway, you should be aware of the connection weight settings as this setting affects connection preference and affects the path your traffic takes.</span></span>
 - <span data-ttu-id="24e06-144">**Route Filter** (Not shown) - A route filter only applies to Microsoft Peering on ExpressRoute, but is critical to check if you're not seeing the routes you expect on Microsoft Peering.</span><span class="sxs-lookup"><span data-stu-id="24e06-144">**Route Filter** (Not shown) - A route filter only applies to Microsoft Peering on ExpressRoute, but is critical to check if you're not seeing the routes you expect on Microsoft Peering.</span></span> 

<span data-ttu-id="24e06-145">At this point, you're on the WAN portion of the link.</span><span class="sxs-lookup"><span data-stu-id="24e06-145">At this point, you're on the WAN portion of the link.</span></span> <span data-ttu-id="24e06-146">This routing domain can be your service provider, your corporate WAN, or the Internet.</span><span class="sxs-lookup"><span data-stu-id="24e06-146">This routing domain can be your service provider, your corporate WAN, or the Internet.</span></span> <span data-ttu-id="24e06-147">Many hops, technologies, and companies involved with these links can make it somewhat difficult to troubleshoot.</span><span class="sxs-lookup"><span data-stu-id="24e06-147">Many hops, technologies, and companies involved with these links can make it somewhat difficult to troubleshoot.</span></span> <span data-ttu-id="24e06-148">Often, you work to rule out both Azure and your Corporate Networks first before jumping into this collection of companies and hops.</span><span class="sxs-lookup"><span data-stu-id="24e06-148">Often, you work to rule out both Azure and your Corporate Networks first before jumping into this collection of companies and hops.</span></span>

<span data-ttu-id="24e06-149">In the preceding diagram, on the far left is your corporate network.</span><span class="sxs-lookup"><span data-stu-id="24e06-149">In the preceding diagram, on the far left is your corporate network.</span></span> <span data-ttu-id="24e06-150">Depending on the size of your company, this routing domain can be a few network devices between you and the WAN or multiple layers of devices in a campus/enterprise network.</span><span class="sxs-lookup"><span data-stu-id="24e06-150">Depending on the size of your company, this routing domain can be a few network devices between you and the WAN or multiple layers of devices in a campus/enterprise network.</span></span>

<span data-ttu-id="24e06-151">Given the complexities of these three different high-level network environments, it's often optimal to start at the edges and try to show where performance is good, and where it degrades.</span><span class="sxs-lookup"><span data-stu-id="24e06-151">Given the complexities of these three different high-level network environments, it's often optimal to start at the edges and try to show where performance is good, and where it degrades.</span></span> <span data-ttu-id="24e06-152">This approach can help identify the problem routing domain of the three and then focus your troubleshooting on that specific environment.</span><span class="sxs-lookup"><span data-stu-id="24e06-152">This approach can help identify the problem routing domain of the three and then focus your troubleshooting on that specific environment.</span></span>

## <a name="tools"></a><span data-ttu-id="24e06-153">Tools</span><span class="sxs-lookup"><span data-stu-id="24e06-153">Tools</span></span>
<span data-ttu-id="24e06-154">Most network issues can be analyzed and isolated using basic tools like ping and traceroute.</span><span class="sxs-lookup"><span data-stu-id="24e06-154">Most network issues can be analyzed and isolated using basic tools like ping and traceroute.</span></span> <span data-ttu-id="24e06-155">It's rare that you need to go as deep as a packet analysis like Wireshark.</span><span class="sxs-lookup"><span data-stu-id="24e06-155">It's rare that you need to go as deep as a packet analysis like Wireshark.</span></span> <span data-ttu-id="24e06-156">To help with troubleshooting, the Azure Connectivity Toolkit (AzureCT) was developed to put some of these tools in an easy package.</span><span class="sxs-lookup"><span data-stu-id="24e06-156">To help with troubleshooting, the Azure Connectivity Toolkit (AzureCT) was developed to put some of these tools in an easy package.</span></span> <span data-ttu-id="24e06-157">For performance testing, I like to use iPerf and PSPing.</span><span class="sxs-lookup"><span data-stu-id="24e06-157">For performance testing, I like to use iPerf and PSPing.</span></span> <span data-ttu-id="24e06-158">iPerf is a commonly used tool and runs on most operating systems.</span><span class="sxs-lookup"><span data-stu-id="24e06-158">iPerf is a commonly used tool and runs on most operating systems.</span></span> <span data-ttu-id="24e06-159">iPerf is good for basic performances tests and is fairly easy to use.</span><span class="sxs-lookup"><span data-stu-id="24e06-159">iPerf is good for basic performances tests and is fairly easy to use.</span></span> <span data-ttu-id="24e06-160">PSPing is a ping tool developed by SysInternals.</span><span class="sxs-lookup"><span data-stu-id="24e06-160">PSPing is a ping tool developed by SysInternals.</span></span> <span data-ttu-id="24e06-161">PSPing is an easy way to perform ICMP and TCP pings in one also easy to use command.</span><span class="sxs-lookup"><span data-stu-id="24e06-161">PSPing is an easy way to perform ICMP and TCP pings in one also easy to use command.</span></span> <span data-ttu-id="24e06-162">Both of these tools are lightweight and are "installed" simply by coping the files to a directory on the host.</span><span class="sxs-lookup"><span data-stu-id="24e06-162">Both of these tools are lightweight and are "installed" simply by coping the files to a directory on the host.</span></span>

<span data-ttu-id="24e06-163">I've wrapped all of these tools and methods into a PowerShell module (AzureCT) that you can install and use.</span><span class="sxs-lookup"><span data-stu-id="24e06-163">I've wrapped all of these tools and methods into a PowerShell module (AzureCT) that you can install and use.</span></span>

### <a name="azurect---the-azure-connectivity-toolkit"></a><span data-ttu-id="24e06-164">AzureCT - the Azure Connectivity Toolkit</span><span class="sxs-lookup"><span data-stu-id="24e06-164">AzureCT - the Azure Connectivity Toolkit</span></span>
<span data-ttu-id="24e06-165">The AzureCT PowerShell module has two components [Availability Testing][Availability Doc] and [Performance Testing][Performance Doc].</span><span class="sxs-lookup"><span data-stu-id="24e06-165">The AzureCT PowerShell module has two components [Availability Testing][Availability Doc] and [Performance Testing][Performance Doc].</span></span> <span data-ttu-id="24e06-166">This document is only concerned with Performance testing, so lets focus on the two Link Performance commands in this PowerShell module.</span><span class="sxs-lookup"><span data-stu-id="24e06-166">This document is only concerned with Performance testing, so lets focus on the two Link Performance commands in this PowerShell module.</span></span>

<span data-ttu-id="24e06-167">There are three basic steps to use this toolkit for Performance testing.</span><span class="sxs-lookup"><span data-stu-id="24e06-167">There are three basic steps to use this toolkit for Performance testing.</span></span> <span data-ttu-id="24e06-168">1) Install the PowerShell module, 2) Install the supporting applications iPerf and PSPing 3) Run the performance test.</span><span class="sxs-lookup"><span data-stu-id="24e06-168">1) Install the PowerShell module, 2) Install the supporting applications iPerf and PSPing 3) Run the performance test.</span></span>

1. <span data-ttu-id="24e06-169">Installing the PowerShell Module</span><span class="sxs-lookup"><span data-stu-id="24e06-169">Installing the PowerShell Module</span></span>

    ```powershell
    (new-object Net.WebClient).DownloadString("https://aka.ms/AzureCT") | Invoke-Expression
    
    ```

    <span data-ttu-id="24e06-170">This command downloads the PowerShell module and installs it locally.</span><span class="sxs-lookup"><span data-stu-id="24e06-170">This command downloads the PowerShell module and installs it locally.</span></span>

2. <span data-ttu-id="24e06-171">Install the supporting applications</span><span class="sxs-lookup"><span data-stu-id="24e06-171">Install the supporting applications</span></span>
    ```powershell
    Install-LinkPerformance
    ```
    <span data-ttu-id="24e06-172">This AzureCT command installs iPerf and PSPing in a new directory "C:\ACTTools", it also opens the Windows Firewall ports to allow ICMP and port 5201 (iPerf) traffic.</span><span class="sxs-lookup"><span data-stu-id="24e06-172">This AzureCT command installs iPerf and PSPing in a new directory "C:\ACTTools", it also opens the Windows Firewall ports to allow ICMP and port 5201 (iPerf) traffic.</span></span>

3. <span data-ttu-id="24e06-173">Run the performance test</span><span class="sxs-lookup"><span data-stu-id="24e06-173">Run the performance test</span></span>

    <span data-ttu-id="24e06-174">First, on the remote host you must install and run iPerf in server mode.</span><span class="sxs-lookup"><span data-stu-id="24e06-174">First, on the remote host you must install and run iPerf in server mode.</span></span> <span data-ttu-id="24e06-175">Also ensure the remote host is listening on either 3389 (RDP for Windows) or 22 (SSH for Linux) and allowing traffic on port 5201 for iPerf.</span><span class="sxs-lookup"><span data-stu-id="24e06-175">Also ensure the remote host is listening on either 3389 (RDP for Windows) or 22 (SSH for Linux) and allowing traffic on port 5201 for iPerf.</span></span> <span data-ttu-id="24e06-176">If the remote host is windows, install the AzureCT and run the Install-LinkPerformance command to set up iPerf and the firewall rules needed to start iPerf in server mode successfully.</span><span class="sxs-lookup"><span data-stu-id="24e06-176">If the remote host is windows, install the AzureCT and run the Install-LinkPerformance command to set up iPerf and the firewall rules needed to start iPerf in server mode successfully.</span></span> 
    
    <span data-ttu-id="24e06-177">Once the remote machine is ready, open PowerShell on the local machine and start the test:</span><span class="sxs-lookup"><span data-stu-id="24e06-177">Once the remote machine is ready, open PowerShell on the local machine and start the test:</span></span>
    ```powershell
    Get-LinkPerformance -RemoteHost 10.0.0.1 -TestSeconds 10
    ```

    <span data-ttu-id="24e06-178">This command runs a series of concurrent load and latency tests to help estimate the bandwidth capacity and latency of your network link.</span><span class="sxs-lookup"><span data-stu-id="24e06-178">This command runs a series of concurrent load and latency tests to help estimate the bandwidth capacity and latency of your network link.</span></span>

4. <span data-ttu-id="24e06-179">Review the output of the tests</span><span class="sxs-lookup"><span data-stu-id="24e06-179">Review the output of the tests</span></span>

    <span data-ttu-id="24e06-180">The PowerShell output format looks similar to:</span><span class="sxs-lookup"><span data-stu-id="24e06-180">The PowerShell output format looks similar to:</span></span>

    <span data-ttu-id="24e06-181">[![4]][4]</span><span class="sxs-lookup"><span data-stu-id="24e06-181">[![4]][4]</span></span>

    <span data-ttu-id="24e06-182">The detailed results of all the iPerf and PSPing tests are in individual text files in the AzureCT tools directory at "C:\ACTTools."</span><span class="sxs-lookup"><span data-stu-id="24e06-182">The detailed results of all the iPerf and PSPing tests are in individual text files in the AzureCT tools directory at "C:\ACTTools."</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="24e06-183">Troubleshooting</span><span class="sxs-lookup"><span data-stu-id="24e06-183">Troubleshooting</span></span>
<span data-ttu-id="24e06-184">If the performance test is not giving you expected results, figuring out why should be a progressive step-by-step process.</span><span class="sxs-lookup"><span data-stu-id="24e06-184">If the performance test is not giving you expected results, figuring out why should be a progressive step-by-step process.</span></span> <span data-ttu-id="24e06-185">Given the number of components in the path, a systematic approach generally provides a faster path to resolution than jumping around and potentially needlessly doing the same testing multiple times.</span><span class="sxs-lookup"><span data-stu-id="24e06-185">Given the number of components in the path, a systematic approach generally provides a faster path to resolution than jumping around and potentially needlessly doing the same testing multiple times.</span></span>

>[!NOTE]
><span data-ttu-id="24e06-186">The scenario here is a performance issue, not a connectivity issue.</span><span class="sxs-lookup"><span data-stu-id="24e06-186">The scenario here is a performance issue, not a connectivity issue.</span></span> <span data-ttu-id="24e06-187">The steps would be different if traffic wasn't passing at all.</span><span class="sxs-lookup"><span data-stu-id="24e06-187">The steps would be different if traffic wasn't passing at all.</span></span>
>
>

<span data-ttu-id="24e06-188">First, challenge your assumptions.</span><span class="sxs-lookup"><span data-stu-id="24e06-188">First, challenge your assumptions.</span></span> <span data-ttu-id="24e06-189">Is your expectation reasonable?</span><span class="sxs-lookup"><span data-stu-id="24e06-189">Is your expectation reasonable?</span></span> <span data-ttu-id="24e06-190">For instance, if you have a 1-Gbps ExpressRoute circuit and 100 ms of latency it's unreasonable to expect the full 1 Gbps of traffic given the performance characteristics of TCP over high latency links.</span><span class="sxs-lookup"><span data-stu-id="24e06-190">For instance, if you have a 1-Gbps ExpressRoute circuit and 100 ms of latency it's unreasonable to expect the full 1 Gbps of traffic given the performance characteristics of TCP over high latency links.</span></span> <span data-ttu-id="24e06-191">See the [References section](#references) for more on performance assumptions.</span><span class="sxs-lookup"><span data-stu-id="24e06-191">See the [References section](#references) for more on performance assumptions.</span></span>

<span data-ttu-id="24e06-192">Next, I recommend starting at the edges between routing domains and try to isolate the problem to a single major routing domain; the Corporate Network, the WAN, or the Azure Network.</span><span class="sxs-lookup"><span data-stu-id="24e06-192">Next, I recommend starting at the edges between routing domains and try to isolate the problem to a single major routing domain; the Corporate Network, the WAN, or the Azure Network.</span></span> <span data-ttu-id="24e06-193">People often blame the "black box" in the path, while blaming the black box is easy to do, it may significantly delay resolution especially if the problem is actually in an area that you have the ability to make changes.</span><span class="sxs-lookup"><span data-stu-id="24e06-193">People often blame the "black box" in the path, while blaming the black box is easy to do, it may significantly delay resolution especially if the problem is actually in an area that you have the ability to make changes.</span></span> <span data-ttu-id="24e06-194">Make sure you do your due diligence before handing off to your service provider or ISP.</span><span class="sxs-lookup"><span data-stu-id="24e06-194">Make sure you do your due diligence before handing off to your service provider or ISP.</span></span>

<span data-ttu-id="24e06-195">Once you've identified the major routing domain that appears to contain the problem, you should create a diagram of the area in question.</span><span class="sxs-lookup"><span data-stu-id="24e06-195">Once you've identified the major routing domain that appears to contain the problem, you should create a diagram of the area in question.</span></span> <span data-ttu-id="24e06-196">Either on a whiteboard, notepad, or Visio as a diagram provides a concrete "battle map" to allow a methodical approach to further isolate the problem.</span><span class="sxs-lookup"><span data-stu-id="24e06-196">Either on a whiteboard, notepad, or Visio as a diagram provides a concrete "battle map" to allow a methodical approach to further isolate the problem.</span></span> <span data-ttu-id="24e06-197">You can plan testing points, and update the map as you clear areas or dig deeper as the testing progresses.</span><span class="sxs-lookup"><span data-stu-id="24e06-197">You can plan testing points, and update the map as you clear areas or dig deeper as the testing progresses.</span></span>

<span data-ttu-id="24e06-198">Now that you have a diagram, start to divide the network into segments and narrow the problem down.</span><span class="sxs-lookup"><span data-stu-id="24e06-198">Now that you have a diagram, start to divide the network into segments and narrow the problem down.</span></span> <span data-ttu-id="24e06-199">Find out where it works and where it doesn't.</span><span class="sxs-lookup"><span data-stu-id="24e06-199">Find out where it works and where it doesn't.</span></span> <span data-ttu-id="24e06-200">Keep moving your testing points to isolate down to the offending component.</span><span class="sxs-lookup"><span data-stu-id="24e06-200">Keep moving your testing points to isolate down to the offending component.</span></span>

<span data-ttu-id="24e06-201">Also, don't forget to look at other layers of the OSI model.</span><span class="sxs-lookup"><span data-stu-id="24e06-201">Also, don't forget to look at other layers of the OSI model.</span></span> <span data-ttu-id="24e06-202">It's easy to focus on the network and layers 1 - 3 (Physical, Data, and Network layers) but the problems can also be up at Layer 7 in the application layer.</span><span class="sxs-lookup"><span data-stu-id="24e06-202">It's easy to focus on the network and layers 1 - 3 (Physical, Data, and Network layers) but the problems can also be up at Layer 7 in the application layer.</span></span> <span data-ttu-id="24e06-203">Keep an open mind and verify assumptions.</span><span class="sxs-lookup"><span data-stu-id="24e06-203">Keep an open mind and verify assumptions.</span></span>

## <a name="advanced-expressroute-troubleshooting"></a><span data-ttu-id="24e06-204">Advanced ExpressRoute troubleshooting</span><span class="sxs-lookup"><span data-stu-id="24e06-204">Advanced ExpressRoute troubleshooting</span></span>
<span data-ttu-id="24e06-205">If you're not sure where the edge of the cloud actually is, isolating the Azure components can be a challenge.</span><span class="sxs-lookup"><span data-stu-id="24e06-205">If you're not sure where the edge of the cloud actually is, isolating the Azure components can be a challenge.</span></span> <span data-ttu-id="24e06-206">When ExpressRoute is used, the edge is a network component called the Microsoft Enterprise Edge (MSEE).</span><span class="sxs-lookup"><span data-stu-id="24e06-206">When ExpressRoute is used, the edge is a network component called the Microsoft Enterprise Edge (MSEE).</span></span> <span data-ttu-id="24e06-207">**When using ExpressRoute**, the MSEE is the first point of contact into Microsoft's network, and the last hop leaving the Microsoft network.</span><span class="sxs-lookup"><span data-stu-id="24e06-207">**When using ExpressRoute**, the MSEE is the first point of contact into Microsoft's network, and the last hop leaving the Microsoft network.</span></span> <span data-ttu-id="24e06-208">When you create a connection object between your VNet gateway and the ExpressRoute circuit, you're actually making a connection to the MSEE.</span><span class="sxs-lookup"><span data-stu-id="24e06-208">When you create a connection object between your VNet gateway and the ExpressRoute circuit, you're actually making a connection to the MSEE.</span></span> <span data-ttu-id="24e06-209">Recognizing the MSEE as the first or last hop (depending on which direction you're going) is crucial to isolating Azure Network problems to either prove the issue is in Azure or further downstream in the WAN or the Corporate Network.</span><span class="sxs-lookup"><span data-stu-id="24e06-209">Recognizing the MSEE as the first or last hop (depending on which direction you're going) is crucial to isolating Azure Network problems to either prove the issue is in Azure or further downstream in the WAN or the Corporate Network.</span></span> 

<span data-ttu-id="24e06-210">[![2]][2]</span><span class="sxs-lookup"><span data-stu-id="24e06-210">[![2]][2]</span></span>

>[!NOTE]
> <span data-ttu-id="24e06-211">Notice that the MSEE isn't in the Azure cloud.</span><span class="sxs-lookup"><span data-stu-id="24e06-211">Notice that the MSEE isn't in the Azure cloud.</span></span> <span data-ttu-id="24e06-212">ExpressRoute is actually at the edge of the Microsoft network not actually in Azure.</span><span class="sxs-lookup"><span data-stu-id="24e06-212">ExpressRoute is actually at the edge of the Microsoft network not actually in Azure.</span></span> <span data-ttu-id="24e06-213">Once you're connected with ExpressRoute to an MSEE, you're connected to Microsoft's network, from there you can then go to any of the cloud services, like Office 365 (with Microsoft Peering) or Azure (with Private and/or Microsoft Peering).</span><span class="sxs-lookup"><span data-stu-id="24e06-213">Once you're connected with ExpressRoute to an MSEE, you're connected to Microsoft's network, from there you can then go to any of the cloud services, like Office 365 (with Microsoft Peering) or Azure (with Private and/or Microsoft Peering).</span></span>
>
>

<span data-ttu-id="24e06-214">If two VNets (VNets A and B in the diagram) are connected to the **same** ExpressRoute circuit, you can perform a series of tests to isolate the problem in Azure (or prove it's not in Azure)</span><span class="sxs-lookup"><span data-stu-id="24e06-214">If two VNets (VNets A and B in the diagram) are connected to the **same** ExpressRoute circuit, you can perform a series of tests to isolate the problem in Azure (or prove it's not in Azure)</span></span>
 
### <a name="test-plan"></a><span data-ttu-id="24e06-215">Test plan</span><span class="sxs-lookup"><span data-stu-id="24e06-215">Test plan</span></span>
1. <span data-ttu-id="24e06-216">Run the Get-LinkPerformance test between VM1 and VM2.</span><span class="sxs-lookup"><span data-stu-id="24e06-216">Run the Get-LinkPerformance test between VM1 and VM2.</span></span> <span data-ttu-id="24e06-217">This test provides insight to if the problem is local or not.</span><span class="sxs-lookup"><span data-stu-id="24e06-217">This test provides insight to if the problem is local or not.</span></span> <span data-ttu-id="24e06-218">If this test produces acceptable latency and bandwidth results, you can mark the local VNet network as good.</span><span class="sxs-lookup"><span data-stu-id="24e06-218">If this test produces acceptable latency and bandwidth results, you can mark the local VNet network as good.</span></span>
2. <span data-ttu-id="24e06-219">Assuming the local VNet traffic is good, run the Get-LinkPerformance test between VM1 and VM3.</span><span class="sxs-lookup"><span data-stu-id="24e06-219">Assuming the local VNet traffic is good, run the Get-LinkPerformance test between VM1 and VM3.</span></span> <span data-ttu-id="24e06-220">This test exercises the connection through the Microsoft network down to the MSEE and back into Azure.</span><span class="sxs-lookup"><span data-stu-id="24e06-220">This test exercises the connection through the Microsoft network down to the MSEE and back into Azure.</span></span> <span data-ttu-id="24e06-221">If this test produces acceptable latency and bandwidth results, you can mark the Azure network as good.</span><span class="sxs-lookup"><span data-stu-id="24e06-221">If this test produces acceptable latency and bandwidth results, you can mark the Azure network as good.</span></span>
3. <span data-ttu-id="24e06-222">If Azure is ruled out, you can perform a similar sequence of tests on your Corporate Network.</span><span class="sxs-lookup"><span data-stu-id="24e06-222">If Azure is ruled out, you can perform a similar sequence of tests on your Corporate Network.</span></span> <span data-ttu-id="24e06-223">If that also tests well, it's time to work with your service provider or ISP to diagnose your WAN connection.</span><span class="sxs-lookup"><span data-stu-id="24e06-223">If that also tests well, it's time to work with your service provider or ISP to diagnose your WAN connection.</span></span> <span data-ttu-id="24e06-224">Example: Run this test between two branch offices, or between your desk and a data center server.</span><span class="sxs-lookup"><span data-stu-id="24e06-224">Example: Run this test between two branch offices, or between your desk and a data center server.</span></span> <span data-ttu-id="24e06-225">Depending on what you're testing, find endpoints (servers, PCs, etc.) that can exercise that path.</span><span class="sxs-lookup"><span data-stu-id="24e06-225">Depending on what you're testing, find endpoints (servers, PCs, etc.) that can exercise that path.</span></span>

>[!IMPORTANT]
> <span data-ttu-id="24e06-226">It's critical that for each test you mark the time of day you run the test and record the results in a common location (I like OneNote or Excel).</span><span class="sxs-lookup"><span data-stu-id="24e06-226">It's critical that for each test you mark the time of day you run the test and record the results in a common location (I like OneNote or Excel).</span></span> <span data-ttu-id="24e06-227">Each test run should have identical output so you can compare the resultant data across test runs and not have "holes" in the data.</span><span class="sxs-lookup"><span data-stu-id="24e06-227">Each test run should have identical output so you can compare the resultant data across test runs and not have "holes" in the data.</span></span> <span data-ttu-id="24e06-228">Consistency across multiple tests is the primary reason I use the AzureCT for troubleshooting.</span><span class="sxs-lookup"><span data-stu-id="24e06-228">Consistency across multiple tests is the primary reason I use the AzureCT for troubleshooting.</span></span> <span data-ttu-id="24e06-229">The magic isn't in the exact load scenarios I run, but instead the *magic* is the fact that I get a *consistent test and data output* from each and every test.</span><span class="sxs-lookup"><span data-stu-id="24e06-229">The magic isn't in the exact load scenarios I run, but instead the *magic* is the fact that I get a *consistent test and data output* from each and every test.</span></span> <span data-ttu-id="24e06-230">Recording the time and having consistent data every single time is especially helpful if you later find that the issue is sporadic.</span><span class="sxs-lookup"><span data-stu-id="24e06-230">Recording the time and having consistent data every single time is especially helpful if you later find that the issue is sporadic.</span></span> <span data-ttu-id="24e06-231">Be diligent with your data collection up front and you'll avoid hours of retesting the same scenarios (I learned this hard way many years ago).</span><span class="sxs-lookup"><span data-stu-id="24e06-231">Be diligent with your data collection up front and you'll avoid hours of retesting the same scenarios (I learned this hard way many years ago).</span></span>
>
>

## <a name="the-problem-is-isolated-now-what"></a><span data-ttu-id="24e06-232">The problem is isolated, now what?</span><span class="sxs-lookup"><span data-stu-id="24e06-232">The problem is isolated, now what?</span></span>
<span data-ttu-id="24e06-233">The more you can isolate the problem the easier it is to fix, however often you reach the point where you can't go deeper or further with your troubleshooting.</span><span class="sxs-lookup"><span data-stu-id="24e06-233">The more you can isolate the problem the easier it is to fix, however often you reach the point where you can't go deeper or further with your troubleshooting.</span></span> <span data-ttu-id="24e06-234">Example: you see the link across your service provider taking hops through Europe, but your expected path is all in Asia.</span><span class="sxs-lookup"><span data-stu-id="24e06-234">Example: you see the link across your service provider taking hops through Europe, but your expected path is all in Asia.</span></span> <span data-ttu-id="24e06-235">This point is when you should reach out for help.</span><span class="sxs-lookup"><span data-stu-id="24e06-235">This point is when you should reach out for help.</span></span> <span data-ttu-id="24e06-236">Who you ask is dependent on the routing domain you isolated the issue to, or even better if you are able to narrow it down to a specific component.</span><span class="sxs-lookup"><span data-stu-id="24e06-236">Who you ask is dependent on the routing domain you isolated the issue to, or even better if you are able to narrow it down to a specific component.</span></span>

<span data-ttu-id="24e06-237">For corporate network issues, your internal IT department or service provider supporting your network (which may be the hardware manufacturer) may be able to help with device configuration or hardware repair.</span><span class="sxs-lookup"><span data-stu-id="24e06-237">For corporate network issues, your internal IT department or service provider supporting your network (which may be the hardware manufacturer) may be able to help with device configuration or hardware repair.</span></span>

<span data-ttu-id="24e06-238">For the WAN, sharing your testing results with your Service Provider or ISP may help get them started and avoid covering some of the same ground you've tested already.</span><span class="sxs-lookup"><span data-stu-id="24e06-238">For the WAN, sharing your testing results with your Service Provider or ISP may help get them started and avoid covering some of the same ground you've tested already.</span></span> <span data-ttu-id="24e06-239">However, don't be offended if they want to verify your results themselves.</span><span class="sxs-lookup"><span data-stu-id="24e06-239">However, don't be offended if they want to verify your results themselves.</span></span> <span data-ttu-id="24e06-240">"Trust but verify" is a good motto when troubleshooting based on other people's reported results.</span><span class="sxs-lookup"><span data-stu-id="24e06-240">"Trust but verify" is a good motto when troubleshooting based on other people's reported results.</span></span>

<span data-ttu-id="24e06-241">With Azure, once you isolate the issue in as much detail as you're able, it's time to review the [Azure Network Documentation][Network Docs] and then if still needed [open a support ticket][Ticket Link].</span><span class="sxs-lookup"><span data-stu-id="24e06-241">With Azure, once you isolate the issue in as much detail as you're able, it's time to review the [Azure Network Documentation][Network Docs] and then if still needed [open a support ticket][Ticket Link].</span></span>

## <a name="references"></a><span data-ttu-id="24e06-242">References</span><span class="sxs-lookup"><span data-stu-id="24e06-242">References</span></span>
### <a name="latencybandwidth-expectations"></a><span data-ttu-id="24e06-243">Latency/bandwidth expectations</span><span class="sxs-lookup"><span data-stu-id="24e06-243">Latency/bandwidth expectations</span></span>
>[!TIP]
> <span data-ttu-id="24e06-244">Geographic latency (miles or kilometers) between the end points you're testing is by far the largest component of latency.</span><span class="sxs-lookup"><span data-stu-id="24e06-244">Geographic latency (miles or kilometers) between the end points you're testing is by far the largest component of latency.</span></span> <span data-ttu-id="24e06-245">While there is equipment latency (physical and virtual components, number of hops, etc.) involved, geography has proven to be the largest component of overall latency when dealing with WAN connections.</span><span class="sxs-lookup"><span data-stu-id="24e06-245">While there is equipment latency (physical and virtual components, number of hops, etc.) involved, geography has proven to be the largest component of overall latency when dealing with WAN connections.</span></span> <span data-ttu-id="24e06-246">It's also important to note that the distance is the distance of the fiber run not the straight-line or road map distance.</span><span class="sxs-lookup"><span data-stu-id="24e06-246">It's also important to note that the distance is the distance of the fiber run not the straight-line or road map distance.</span></span> <span data-ttu-id="24e06-247">This distance is incredibly hard to get with any accuracy.</span><span class="sxs-lookup"><span data-stu-id="24e06-247">This distance is incredibly hard to get with any accuracy.</span></span> <span data-ttu-id="24e06-248">As a result, I generally use a city distance calculator on the internet and know that this method is a grossly inaccurate measure, but is enough to set a general expectation.</span><span class="sxs-lookup"><span data-stu-id="24e06-248">As a result, I generally use a city distance calculator on the internet and know that this method is a grossly inaccurate measure, but is enough to set a general expectation.</span></span>
>
>

<span data-ttu-id="24e06-249">I've got an ExpressRoute setup in Seattle, Washington in the USA.</span><span class="sxs-lookup"><span data-stu-id="24e06-249">I've got an ExpressRoute setup in Seattle, Washington in the USA.</span></span> <span data-ttu-id="24e06-250">The following table shows the latency and bandwidth I saw testing to various Azure locations.</span><span class="sxs-lookup"><span data-stu-id="24e06-250">The following table shows the latency and bandwidth I saw testing to various Azure locations.</span></span> <span data-ttu-id="24e06-251">I've estimated the geographic distance between each end of the test.</span><span class="sxs-lookup"><span data-stu-id="24e06-251">I've estimated the geographic distance between each end of the test.</span></span>

<span data-ttu-id="24e06-252">Test setup:</span><span class="sxs-lookup"><span data-stu-id="24e06-252">Test setup:</span></span>
 - <span data-ttu-id="24e06-253">A physical server running Windows Server 2016 with a 10 Gbps NIC, connected to an ExpressRoute circuit.</span><span class="sxs-lookup"><span data-stu-id="24e06-253">A physical server running Windows Server 2016 with a 10 Gbps NIC, connected to an ExpressRoute circuit.</span></span>
 - <span data-ttu-id="24e06-254">A 10Gbps Premium ExpressRoute circuit in the location identified with Private Peering enabled.</span><span class="sxs-lookup"><span data-stu-id="24e06-254">A 10Gbps Premium ExpressRoute circuit in the location identified with Private Peering enabled.</span></span>
 - <span data-ttu-id="24e06-255">An Azure VNet with an UltraPerformance gateway in the specified region.</span><span class="sxs-lookup"><span data-stu-id="24e06-255">An Azure VNet with an UltraPerformance gateway in the specified region.</span></span>
 - <span data-ttu-id="24e06-256">A DS5v2 VM running Windows Server 2016 on the VNet.</span><span class="sxs-lookup"><span data-stu-id="24e06-256">A DS5v2 VM running Windows Server 2016 on the VNet.</span></span> <span data-ttu-id="24e06-257">The VM was non-domain joined, built from the default Azure image (no optimization or customization) with AzureCT installed.</span><span class="sxs-lookup"><span data-stu-id="24e06-257">The VM was non-domain joined, built from the default Azure image (no optimization or customization) with AzureCT installed.</span></span>
 - <span data-ttu-id="24e06-258">All testing was using the AzureCT Get-LinkPerformance command with a 5-minute load test for each of the six test runs.</span><span class="sxs-lookup"><span data-stu-id="24e06-258">All testing was using the AzureCT Get-LinkPerformance command with a 5-minute load test for each of the six test runs.</span></span> <span data-ttu-id="24e06-259">For example:</span><span class="sxs-lookup"><span data-stu-id="24e06-259">For example:</span></span>

    ```powershell
    Get-LinkPerformance -RemoteHost 10.0.0.1 -TestSeconds 300
    ```
 - <span data-ttu-id="24e06-260">The data flow for each test had the load flowing from the on-premises physical server (iPerf client in Seattle) up to the Azure VM (iPerf server in the listed Azure region).</span><span class="sxs-lookup"><span data-stu-id="24e06-260">The data flow for each test had the load flowing from the on-premises physical server (iPerf client in Seattle) up to the Azure VM (iPerf server in the listed Azure region).</span></span>
 - <span data-ttu-id="24e06-261">The "Latency" column data is from the No Load test (a TCP latency test without iPerf running).</span><span class="sxs-lookup"><span data-stu-id="24e06-261">The "Latency" column data is from the No Load test (a TCP latency test without iPerf running).</span></span>
 - <span data-ttu-id="24e06-262">The "Max Bandwidth" column data is from the 16 TCP flow load test with a 1-Mb window size.</span><span class="sxs-lookup"><span data-stu-id="24e06-262">The "Max Bandwidth" column data is from the 16 TCP flow load test with a 1-Mb window size.</span></span>

<span data-ttu-id="24e06-263">[![3]][3]</span><span class="sxs-lookup"><span data-stu-id="24e06-263">[![3]][3]</span></span>

### <a name="latencybandwidth-results"></a><span data-ttu-id="24e06-264">Latency/bandwidth results</span><span class="sxs-lookup"><span data-stu-id="24e06-264">Latency/bandwidth results</span></span>
>[!IMPORTANT]
> <span data-ttu-id="24e06-265">These numbers are for general reference only.</span><span class="sxs-lookup"><span data-stu-id="24e06-265">These numbers are for general reference only.</span></span> <span data-ttu-id="24e06-266">Many factors affect latency, and while these values are generally consistent over time, conditions within Azure or the Service Providers network can send traffic via different paths at any time, thus latency and bandwidth can be affected.</span><span class="sxs-lookup"><span data-stu-id="24e06-266">Many factors affect latency, and while these values are generally consistent over time, conditions within Azure or the Service Providers network can send traffic via different paths at any time, thus latency and bandwidth can be affected.</span></span> <span data-ttu-id="24e06-267">Generally, the effects of these changes don't result in significant differences.</span><span class="sxs-lookup"><span data-stu-id="24e06-267">Generally, the effects of these changes don't result in significant differences.</span></span>
>
>

| | | | | | |
|-|-|-|-|-|-|
|<span data-ttu-id="24e06-268">ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="24e06-268">ExpressRoute</span></span><br/><span data-ttu-id="24e06-269">Location</span><span class="sxs-lookup"><span data-stu-id="24e06-269">Location</span></span>|<span data-ttu-id="24e06-270">Azure</span><span class="sxs-lookup"><span data-stu-id="24e06-270">Azure</span></span><br/><span data-ttu-id="24e06-271">Region</span><span class="sxs-lookup"><span data-stu-id="24e06-271">Region</span></span>|<span data-ttu-id="24e06-272">Estimated</span><span class="sxs-lookup"><span data-stu-id="24e06-272">Estimated</span></span><br/><span data-ttu-id="24e06-273">Distance (km)</span><span class="sxs-lookup"><span data-stu-id="24e06-273">Distance (km)</span></span>|<span data-ttu-id="24e06-274">Latency</span><span class="sxs-lookup"><span data-stu-id="24e06-274">Latency</span></span>|<span data-ttu-id="24e06-275">1 Session</span><span class="sxs-lookup"><span data-stu-id="24e06-275">1 Session</span></span><br/><span data-ttu-id="24e06-276">Bandwidth</span><span class="sxs-lookup"><span data-stu-id="24e06-276">Bandwidth</span></span>|<span data-ttu-id="24e06-277">Maximum</span><span class="sxs-lookup"><span data-stu-id="24e06-277">Maximum</span></span><br/><span data-ttu-id="24e06-278">Bandwidth</span><span class="sxs-lookup"><span data-stu-id="24e06-278">Bandwidth</span></span>|
| <span data-ttu-id="24e06-279">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-279">Seattle</span></span> | <span data-ttu-id="24e06-280">West US 2</span><span class="sxs-lookup"><span data-stu-id="24e06-280">West US 2</span></span>        |    <span data-ttu-id="24e06-281">191 km</span><span class="sxs-lookup"><span data-stu-id="24e06-281">191 km</span></span> |   <span data-ttu-id="24e06-282">5 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-282">5 ms</span></span> | <span data-ttu-id="24e06-283">262.0 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-283">262.0 Mbits/sec</span></span> |  <span data-ttu-id="24e06-284">3.74 Gbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-284">3.74 Gbits/sec</span></span> | <span data-ttu-id="24e06-285">21</span><span class="sxs-lookup"><span data-stu-id="24e06-285">21</span></span>
| <span data-ttu-id="24e06-286">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-286">Seattle</span></span> | <span data-ttu-id="24e06-287">West US</span><span class="sxs-lookup"><span data-stu-id="24e06-287">West US</span></span>          |  <span data-ttu-id="24e06-288">1,094 km</span><span class="sxs-lookup"><span data-stu-id="24e06-288">1,094 km</span></span> |  <span data-ttu-id="24e06-289">18 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-289">18 ms</span></span> |  <span data-ttu-id="24e06-290">82.3 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-290">82.3 Mbits/sec</span></span> |  <span data-ttu-id="24e06-291">3.70 Gbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-291">3.70 Gbits/sec</span></span> | <span data-ttu-id="24e06-292">20</span><span class="sxs-lookup"><span data-stu-id="24e06-292">20</span></span>
| <span data-ttu-id="24e06-293">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-293">Seattle</span></span> | <span data-ttu-id="24e06-294">Central US</span><span class="sxs-lookup"><span data-stu-id="24e06-294">Central US</span></span>       |  <span data-ttu-id="24e06-295">2,357 km</span><span class="sxs-lookup"><span data-stu-id="24e06-295">2,357 km</span></span> |  <span data-ttu-id="24e06-296">40 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-296">40 ms</span></span> |  <span data-ttu-id="24e06-297">38.8 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-297">38.8 Mbits/sec</span></span> |  <span data-ttu-id="24e06-298">2.55 Gbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-298">2.55 Gbits/sec</span></span> | <span data-ttu-id="24e06-299">17</span><span class="sxs-lookup"><span data-stu-id="24e06-299">17</span></span>
| <span data-ttu-id="24e06-300">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-300">Seattle</span></span> | <span data-ttu-id="24e06-301">South Central US</span><span class="sxs-lookup"><span data-stu-id="24e06-301">South Central US</span></span> |  <span data-ttu-id="24e06-302">2,877 km</span><span class="sxs-lookup"><span data-stu-id="24e06-302">2,877 km</span></span> |  <span data-ttu-id="24e06-303">51 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-303">51 ms</span></span> |  <span data-ttu-id="24e06-304">30.6 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-304">30.6 Mbits/sec</span></span> |  <span data-ttu-id="24e06-305">2.49 Gbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-305">2.49 Gbits/sec</span></span> | <span data-ttu-id="24e06-306">19</span><span class="sxs-lookup"><span data-stu-id="24e06-306">19</span></span>
| <span data-ttu-id="24e06-307">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-307">Seattle</span></span> | <span data-ttu-id="24e06-308">North Central US</span><span class="sxs-lookup"><span data-stu-id="24e06-308">North Central US</span></span> |  <span data-ttu-id="24e06-309">2,792 km</span><span class="sxs-lookup"><span data-stu-id="24e06-309">2,792 km</span></span> |  <span data-ttu-id="24e06-310">55 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-310">55 ms</span></span> |  <span data-ttu-id="24e06-311">27.7 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-311">27.7 Mbits/sec</span></span> |  <span data-ttu-id="24e06-312">2.19 Gbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-312">2.19 Gbits/sec</span></span> | <span data-ttu-id="24e06-313">18</span><span class="sxs-lookup"><span data-stu-id="24e06-313">18</span></span>
| <span data-ttu-id="24e06-314">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-314">Seattle</span></span> | <span data-ttu-id="24e06-315">East US 2</span><span class="sxs-lookup"><span data-stu-id="24e06-315">East US 2</span></span>        |  <span data-ttu-id="24e06-316">3,769 km</span><span class="sxs-lookup"><span data-stu-id="24e06-316">3,769 km</span></span> |  <span data-ttu-id="24e06-317">73 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-317">73 ms</span></span> |  <span data-ttu-id="24e06-318">21.3 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-318">21.3 Mbits/sec</span></span> |  <span data-ttu-id="24e06-319">1.79 Gbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-319">1.79 Gbits/sec</span></span> | <span data-ttu-id="24e06-320">16</span><span class="sxs-lookup"><span data-stu-id="24e06-320">16</span></span>
| <span data-ttu-id="24e06-321">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-321">Seattle</span></span> | <span data-ttu-id="24e06-322">East US</span><span class="sxs-lookup"><span data-stu-id="24e06-322">East US</span></span>          |  <span data-ttu-id="24e06-323">3,699 km</span><span class="sxs-lookup"><span data-stu-id="24e06-323">3,699 km</span></span> |  <span data-ttu-id="24e06-324">74 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-324">74 ms</span></span> |  <span data-ttu-id="24e06-325">21.1 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-325">21.1 Mbits/sec</span></span> |  <span data-ttu-id="24e06-326">1.78 Gbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-326">1.78 Gbits/sec</span></span> | <span data-ttu-id="24e06-327">15</span><span class="sxs-lookup"><span data-stu-id="24e06-327">15</span></span>
| <span data-ttu-id="24e06-328">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-328">Seattle</span></span> | <span data-ttu-id="24e06-329">Japan East</span><span class="sxs-lookup"><span data-stu-id="24e06-329">Japan East</span></span>       |  <span data-ttu-id="24e06-330">7,705 km</span><span class="sxs-lookup"><span data-stu-id="24e06-330">7,705 km</span></span> | <span data-ttu-id="24e06-331">106 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-331">106 ms</span></span> |  <span data-ttu-id="24e06-332">14.6 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-332">14.6 Mbits/sec</span></span> |  <span data-ttu-id="24e06-333">1.22 Gbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-333">1.22 Gbits/sec</span></span> | <span data-ttu-id="24e06-334">28</span><span class="sxs-lookup"><span data-stu-id="24e06-334">28</span></span>
| <span data-ttu-id="24e06-335">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-335">Seattle</span></span> | <span data-ttu-id="24e06-336">UK South</span><span class="sxs-lookup"><span data-stu-id="24e06-336">UK South</span></span>         |  <span data-ttu-id="24e06-337">7,708 km</span><span class="sxs-lookup"><span data-stu-id="24e06-337">7,708 km</span></span> | <span data-ttu-id="24e06-338">146 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-338">146 ms</span></span> |  <span data-ttu-id="24e06-339">10.6 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-339">10.6 Mbits/sec</span></span> |   <span data-ttu-id="24e06-340">896 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-340">896 Mbits/sec</span></span> | <span data-ttu-id="24e06-341">24</span><span class="sxs-lookup"><span data-stu-id="24e06-341">24</span></span>
| <span data-ttu-id="24e06-342">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-342">Seattle</span></span> | <span data-ttu-id="24e06-343">West Europe</span><span class="sxs-lookup"><span data-stu-id="24e06-343">West Europe</span></span>      |  <span data-ttu-id="24e06-344">7,834 km</span><span class="sxs-lookup"><span data-stu-id="24e06-344">7,834 km</span></span> | <span data-ttu-id="24e06-345">153 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-345">153 ms</span></span> |  <span data-ttu-id="24e06-346">10.2 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-346">10.2 Mbits/sec</span></span> |   <span data-ttu-id="24e06-347">761 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-347">761 Mbits/sec</span></span> | <span data-ttu-id="24e06-348">23</span><span class="sxs-lookup"><span data-stu-id="24e06-348">23</span></span>
| <span data-ttu-id="24e06-349">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-349">Seattle</span></span> | <span data-ttu-id="24e06-350">Australia East</span><span class="sxs-lookup"><span data-stu-id="24e06-350">Australia East</span></span>   | <span data-ttu-id="24e06-351">12,484 km</span><span class="sxs-lookup"><span data-stu-id="24e06-351">12,484 km</span></span> | <span data-ttu-id="24e06-352">165 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-352">165 ms</span></span> |   <span data-ttu-id="24e06-353">9.4 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-353">9.4 Mbits/sec</span></span> |   <span data-ttu-id="24e06-354">794 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-354">794 Mbits/sec</span></span> | <span data-ttu-id="24e06-355">26</span><span class="sxs-lookup"><span data-stu-id="24e06-355">26</span></span>
| <span data-ttu-id="24e06-356">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-356">Seattle</span></span> | <span data-ttu-id="24e06-357">Southeast Asia</span><span class="sxs-lookup"><span data-stu-id="24e06-357">Southeast Asia</span></span>   | <span data-ttu-id="24e06-358">12,989 km</span><span class="sxs-lookup"><span data-stu-id="24e06-358">12,989 km</span></span> | <span data-ttu-id="24e06-359">170 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-359">170 ms</span></span> |   <span data-ttu-id="24e06-360">9.2 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-360">9.2 Mbits/sec</span></span> |   <span data-ttu-id="24e06-361">756 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-361">756 Mbits/sec</span></span> | <span data-ttu-id="24e06-362">25</span><span class="sxs-lookup"><span data-stu-id="24e06-362">25</span></span>
| <span data-ttu-id="24e06-363">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-363">Seattle</span></span> | <span data-ttu-id="24e06-364">Brazil South \*</span><span class="sxs-lookup"><span data-stu-id="24e06-364">Brazil South \*</span></span>   | <span data-ttu-id="24e06-365">10,930 km</span><span class="sxs-lookup"><span data-stu-id="24e06-365">10,930 km</span></span> | <span data-ttu-id="24e06-366">189 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-366">189 ms</span></span> |   <span data-ttu-id="24e06-367">8.2 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-367">8.2 Mbits/sec</span></span> |   <span data-ttu-id="24e06-368">699 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-368">699 Mbits/sec</span></span> | <span data-ttu-id="24e06-369">22</span><span class="sxs-lookup"><span data-stu-id="24e06-369">22</span></span>
| <span data-ttu-id="24e06-370">Seattle</span><span class="sxs-lookup"><span data-stu-id="24e06-370">Seattle</span></span> | <span data-ttu-id="24e06-371">South India</span><span class="sxs-lookup"><span data-stu-id="24e06-371">South India</span></span>      | <span data-ttu-id="24e06-372">12,918 km</span><span class="sxs-lookup"><span data-stu-id="24e06-372">12,918 km</span></span> | <span data-ttu-id="24e06-373">202 ms</span><span class="sxs-lookup"><span data-stu-id="24e06-373">202 ms</span></span> |   <span data-ttu-id="24e06-374">7.7 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-374">7.7 Mbits/sec</span></span> |   <span data-ttu-id="24e06-375">634 Mbits/sec</span><span class="sxs-lookup"><span data-stu-id="24e06-375">634 Mbits/sec</span></span> | <span data-ttu-id="24e06-376">27</span><span class="sxs-lookup"><span data-stu-id="24e06-376">27</span></span>

<span data-ttu-id="24e06-377">\* The latency to Brazil is a good example where the straight-line distance significantly differs from the fiber run distance.</span><span class="sxs-lookup"><span data-stu-id="24e06-377">\* The latency to Brazil is a good example where the straight-line distance significantly differs from the fiber run distance.</span></span> <span data-ttu-id="24e06-378">I would expect that the latency would be in the neighborhood of 160 ms, but is actually 189 ms.</span><span class="sxs-lookup"><span data-stu-id="24e06-378">I would expect that the latency would be in the neighborhood of 160 ms, but is actually 189 ms.</span></span> <span data-ttu-id="24e06-379">This difference against my expectation could indicate a network issue somewhere, but most likely that the fiber run does not go to Brazil in a straight line and has an extra 1,000 km or so of travel to get to Brazil from Seattle.</span><span class="sxs-lookup"><span data-stu-id="24e06-379">This difference against my expectation could indicate a network issue somewhere, but most likely that the fiber run does not go to Brazil in a straight line and has an extra 1,000 km or so of travel to get to Brazil from Seattle.</span></span>

## <a name="next-steps"></a><span data-ttu-id="24e06-380">Next steps</span><span class="sxs-lookup"><span data-stu-id="24e06-380">Next steps</span></span>
1. <span data-ttu-id="24e06-381">Download the Azure Connectivity Toolkit from GitHub at [http://aka.ms/AzCT][ACT]</span><span class="sxs-lookup"><span data-stu-id="24e06-381">Download the Azure Connectivity Toolkit from GitHub at [http://aka.ms/AzCT][ACT]</span></span>
2. <span data-ttu-id="24e06-382">Follow the instructions for [link performance testing][Performance Doc]</span><span class="sxs-lookup"><span data-stu-id="24e06-382">Follow the instructions for [link performance testing][Performance Doc]</span></span>

<!--Image References-->
[1]: ./media/expressroute-troubleshooting-network-performance/network-components.png "Azure Network Components"
[2]: ./media/expressroute-troubleshooting-network-performance/expressroute-troubleshooting.png "ExpressRoute Troubleshooting"
[3]: ./media/expressroute-troubleshooting-network-performance/test-diagram.png "Perf Test Environment"
[4]: ./media/expressroute-troubleshooting-network-performance/powershell-output.png "PowerShell Output"

<!--Link References-->
[Performance Doc]: https://github.com/Azure/NetworkMonitoring/blob/master/AzureCT/PerformanceTesting.md
[Availability Doc]: https://github.com/Azure/NetworkMonitoring/blob/master/AzureCT/AvailabilityTesting.md
[Network Docs]: https://docs.microsoft.com/azure/index#pivot=services&panel=network
[Ticket Link]: https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/overview
[ACT]: http://aka.ms/AzCT











