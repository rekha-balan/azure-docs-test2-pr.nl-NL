---
title: NAT requirements for ExpressRoute circuits | Microsoft Docs
description: This page provides detailed requirements for configuring and managing NAT for ExpressRoute circuits.
documentationcenter: na
services: expressroute
author: cherylmc
manager: carmonm
editor: ''
ms.assetid: 867bf936-c851-485f-84c8-d8d6e33fee9f
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/10/2016
ms.author: cherylmc
ms.openlocfilehash: d3fc2a4d9518b49c0f7bb1ac9b3a479677227aca
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44662818"
---
# <a name="expressroute-nat-requirements"></a><span data-ttu-id="0f661-103">ExpressRoute NAT requirements</span><span class="sxs-lookup"><span data-stu-id="0f661-103">ExpressRoute NAT requirements</span></span>
<span data-ttu-id="0f661-104">To connect to Microsoft cloud services using ExpressRoute, you’ll need to set up and manage NATs.</span><span class="sxs-lookup"><span data-stu-id="0f661-104">To connect to Microsoft cloud services using ExpressRoute, you’ll need to set up and manage NATs.</span></span> <span data-ttu-id="0f661-105">Some connectivity providers offer setting up and managing NAT as a managed service.</span><span class="sxs-lookup"><span data-stu-id="0f661-105">Some connectivity providers offer setting up and managing NAT as a managed service.</span></span> <span data-ttu-id="0f661-106">Check with your connectivity provider to see if they offer such a service.</span><span class="sxs-lookup"><span data-stu-id="0f661-106">Check with your connectivity provider to see if they offer such a service.</span></span> <span data-ttu-id="0f661-107">If not, you must adhere to the requirements described below.</span><span class="sxs-lookup"><span data-stu-id="0f661-107">If not, you must adhere to the requirements described below.</span></span> 

<span data-ttu-id="0f661-108">Review the [ExpressRoute circuits and routing domains](expressroute-circuit-peerings.md) page to get an overview of the various routing domains.</span><span class="sxs-lookup"><span data-stu-id="0f661-108">Review the [ExpressRoute circuits and routing domains](expressroute-circuit-peerings.md) page to get an overview of the various routing domains.</span></span> <span data-ttu-id="0f661-109">To meet the public IP address requirements for Azure public and Microsoft peering, we recommend that you set up NAT between your network and Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0f661-109">To meet the public IP address requirements for Azure public and Microsoft peering, we recommend that you set up NAT between your network and Microsoft.</span></span> <span data-ttu-id="0f661-110">This section provides a detailed description of the NAT infrastructure you need to set up.</span><span class="sxs-lookup"><span data-stu-id="0f661-110">This section provides a detailed description of the NAT infrastructure you need to set up.</span></span>

## <a name="nat-requirements-for-azure-public-peering"></a><span data-ttu-id="0f661-111">NAT requirements for Azure public peering</span><span class="sxs-lookup"><span data-stu-id="0f661-111">NAT requirements for Azure public peering</span></span>
<span data-ttu-id="0f661-112">The Azure public peering path enables you to connect to all services hosted in Azure over their public IP addresses.</span><span class="sxs-lookup"><span data-stu-id="0f661-112">The Azure public peering path enables you to connect to all services hosted in Azure over their public IP addresses.</span></span> <span data-ttu-id="0f661-113">These include services listed in the [ExpessRoute FAQ](expressroute-faqs.md) and any services hosted by ISVs on Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="0f661-113">These include services listed in the [ExpessRoute FAQ](expressroute-faqs.md) and any services hosted by ISVs on Microsoft Azure.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="0f661-114">Connectivity to Microsoft Azure services on public peering is always initiated from your network into the Microsoft network.</span><span class="sxs-lookup"><span data-stu-id="0f661-114">Connectivity to Microsoft Azure services on public peering is always initiated from your network into the Microsoft network.</span></span> <span data-ttu-id="0f661-115">Therefore, sessions cannot be initiated from Microsoft Azure services to your network over ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="0f661-115">Therefore, sessions cannot be initiated from Microsoft Azure services to your network over ExpressRoute.</span></span> <span data-ttu-id="0f661-116">If attempted, packets sent to these advertised IPs will use the internet instead of ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="0f661-116">If attempted, packets sent to these advertised IPs will use the internet instead of ExpressRoute.</span></span>
> 

<span data-ttu-id="0f661-117">Traffic destined to Microsoft Azure on public peering must be SNATed to valid public IPv4 addresses before they enter the Microsoft network.</span><span class="sxs-lookup"><span data-stu-id="0f661-117">Traffic destined to Microsoft Azure on public peering must be SNATed to valid public IPv4 addresses before they enter the Microsoft network.</span></span> <span data-ttu-id="0f661-118">The figure below provides a high-level picture of how the NAT could be set up to meet the above requirement.</span><span class="sxs-lookup"><span data-stu-id="0f661-118">The figure below provides a high-level picture of how the NAT could be set up to meet the above requirement.</span></span>

![](https://docstestmedia1.blob.core.windows.net/azure-media/articles/expressroute/media/expressroute-nat/expressroute-nat-azure-public.png) 

### <a name="nat-ip-pool-and-route-advertisements"></a><span data-ttu-id="0f661-119">NAT IP pool and route advertisements</span><span class="sxs-lookup"><span data-stu-id="0f661-119">NAT IP pool and route advertisements</span></span>
<span data-ttu-id="0f661-120">You must ensure that traffic is entering the Azure public peering path with valid public IPv4 address.</span><span class="sxs-lookup"><span data-stu-id="0f661-120">You must ensure that traffic is entering the Azure public peering path with valid public IPv4 address.</span></span> <span data-ttu-id="0f661-121">Microsoft must be able to validate the ownership of the IPv4 NAT address pool against a regional routing Internet registry (RIR) or an Internet routing registry (IRR).</span><span class="sxs-lookup"><span data-stu-id="0f661-121">Microsoft must be able to validate the ownership of the IPv4 NAT address pool against a regional routing Internet registry (RIR) or an Internet routing registry (IRR).</span></span> <span data-ttu-id="0f661-122">A check will be performed based on the AS number being peered with and the IP addresses used for the NAT.</span><span class="sxs-lookup"><span data-stu-id="0f661-122">A check will be performed based on the AS number being peered with and the IP addresses used for the NAT.</span></span> <span data-ttu-id="0f661-123">Refer to the [ExpressRoute routing requirements](expressroute-routing.md) page for information on routing registries.</span><span class="sxs-lookup"><span data-stu-id="0f661-123">Refer to the [ExpressRoute routing requirements](expressroute-routing.md) page for information on routing registries.</span></span>

<span data-ttu-id="0f661-124">There are no restrictions on the length of the NAT IP prefix advertised through this peering.</span><span class="sxs-lookup"><span data-stu-id="0f661-124">There are no restrictions on the length of the NAT IP prefix advertised through this peering.</span></span> <span data-ttu-id="0f661-125">You must monitor the NAT pool and ensure that you are not starved of NAT sessions.</span><span class="sxs-lookup"><span data-stu-id="0f661-125">You must monitor the NAT pool and ensure that you are not starved of NAT sessions.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0f661-126">The NAT IP pool advertised to Microsoft must not be advertised to the Internet.</span><span class="sxs-lookup"><span data-stu-id="0f661-126">The NAT IP pool advertised to Microsoft must not be advertised to the Internet.</span></span> <span data-ttu-id="0f661-127">This will break connectivity to other Microsoft services.</span><span class="sxs-lookup"><span data-stu-id="0f661-127">This will break connectivity to other Microsoft services.</span></span>
> 
> 

## <a name="nat-requirements-for-microsoft-peering"></a><span data-ttu-id="0f661-128">NAT requirements for Microsoft peering</span><span class="sxs-lookup"><span data-stu-id="0f661-128">NAT requirements for Microsoft peering</span></span>
<span data-ttu-id="0f661-129">The Microsoft peering path lets you connect to Microsoft cloud services that are not supported through the Azure public peering path.</span><span class="sxs-lookup"><span data-stu-id="0f661-129">The Microsoft peering path lets you connect to Microsoft cloud services that are not supported through the Azure public peering path.</span></span> <span data-ttu-id="0f661-130">The list of services includes Office 365 services, such as Exchange Online, SharePoint Online, Skype for Business, and CRM Online.</span><span class="sxs-lookup"><span data-stu-id="0f661-130">The list of services includes Office 365 services, such as Exchange Online, SharePoint Online, Skype for Business, and CRM Online.</span></span> <span data-ttu-id="0f661-131">Microsoft expects to support bi-directional connectivity on the Microsoft peering.</span><span class="sxs-lookup"><span data-stu-id="0f661-131">Microsoft expects to support bi-directional connectivity on the Microsoft peering.</span></span> <span data-ttu-id="0f661-132">Traffic destined to Microsoft cloud services must be SNATed to valid public IPv4 addresses before they enter the Microsoft network.</span><span class="sxs-lookup"><span data-stu-id="0f661-132">Traffic destined to Microsoft cloud services must be SNATed to valid public IPv4 addresses before they enter the Microsoft network.</span></span> <span data-ttu-id="0f661-133">Traffic destined to your network from Microsoft cloud services must be SNATed before they enter your network.</span><span class="sxs-lookup"><span data-stu-id="0f661-133">Traffic destined to your network from Microsoft cloud services must be SNATed before they enter your network.</span></span> <span data-ttu-id="0f661-134">The figure below provides a high-level picture of how the NAT should be setup for Microsoft peering.</span><span class="sxs-lookup"><span data-stu-id="0f661-134">The figure below provides a high-level picture of how the NAT should be setup for Microsoft peering.</span></span>

![](https://docstestmedia1.blob.core.windows.net/azure-media/articles/expressroute/media/expressroute-nat/expressroute-nat-microsoft.png) 

### <a name="traffic-originating-from-your-network-destined-to-microsoft"></a><span data-ttu-id="0f661-135">Traffic originating from your network destined to Microsoft</span><span class="sxs-lookup"><span data-stu-id="0f661-135">Traffic originating from your network destined to Microsoft</span></span>
* <span data-ttu-id="0f661-136">You must ensure that traffic is entering the Microsoft peering path with a valid public IPv4 address.</span><span class="sxs-lookup"><span data-stu-id="0f661-136">You must ensure that traffic is entering the Microsoft peering path with a valid public IPv4 address.</span></span> <span data-ttu-id="0f661-137">Microsoft must be able to validate the owner of the IPv4 NAT address pool against the regional routing internet registry (RIR) or an internet routing registry (IRR).</span><span class="sxs-lookup"><span data-stu-id="0f661-137">Microsoft must be able to validate the owner of the IPv4 NAT address pool against the regional routing internet registry (RIR) or an internet routing registry (IRR).</span></span> <span data-ttu-id="0f661-138">A check will be performed based on the AS number being peered with and the IP addresses used for the NAT.</span><span class="sxs-lookup"><span data-stu-id="0f661-138">A check will be performed based on the AS number being peered with and the IP addresses used for the NAT.</span></span> <span data-ttu-id="0f661-139">Refer to the [ExpressRoute routing requirements](expressroute-routing.md) page for information on routing registries.</span><span class="sxs-lookup"><span data-stu-id="0f661-139">Refer to the [ExpressRoute routing requirements](expressroute-routing.md) page for information on routing registries.</span></span>
* <span data-ttu-id="0f661-140">IP addresses used for the Azure public peering setup and other ExpressRoute circuits must not be advertised to Microsoft through the BGP session.</span><span class="sxs-lookup"><span data-stu-id="0f661-140">IP addresses used for the Azure public peering setup and other ExpressRoute circuits must not be advertised to Microsoft through the BGP session.</span></span> <span data-ttu-id="0f661-141">There is no restriction on the length of the NAT IP prefix advertised through this peering.</span><span class="sxs-lookup"><span data-stu-id="0f661-141">There is no restriction on the length of the NAT IP prefix advertised through this peering.</span></span>
  
  > [!IMPORTANT]
  > <span data-ttu-id="0f661-142">The NAT IP pool advertised to Microsoft must not be advertised to the Internet.</span><span class="sxs-lookup"><span data-stu-id="0f661-142">The NAT IP pool advertised to Microsoft must not be advertised to the Internet.</span></span> <span data-ttu-id="0f661-143">This will break connectivity to other Microsoft services.</span><span class="sxs-lookup"><span data-stu-id="0f661-143">This will break connectivity to other Microsoft services.</span></span>
  > 
  > 

### <a name="traffic-originating-from-microsoft-destined-to-your-network"></a><span data-ttu-id="0f661-144">Traffic originating from Microsoft destined to your network</span><span class="sxs-lookup"><span data-stu-id="0f661-144">Traffic originating from Microsoft destined to your network</span></span>
* <span data-ttu-id="0f661-145">Certain scenarios require Microsoft to initiate connectivity to service endpoints hosted within your network.</span><span class="sxs-lookup"><span data-stu-id="0f661-145">Certain scenarios require Microsoft to initiate connectivity to service endpoints hosted within your network.</span></span> <span data-ttu-id="0f661-146">A typical example of the scenario would be connectivity to ADFS servers hosted in your network from Office 365.</span><span class="sxs-lookup"><span data-stu-id="0f661-146">A typical example of the scenario would be connectivity to ADFS servers hosted in your network from Office 365.</span></span> <span data-ttu-id="0f661-147">In such cases, you must leak appropriate prefixes from your network into the Microsoft peering.</span><span class="sxs-lookup"><span data-stu-id="0f661-147">In such cases, you must leak appropriate prefixes from your network into the Microsoft peering.</span></span> 
* <span data-ttu-id="0f661-148">You must SNAT traffic destined to IP addresses within your network from Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0f661-148">You must SNAT traffic destined to IP addresses within your network from Microsoft.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="0f661-149">Next steps</span><span class="sxs-lookup"><span data-stu-id="0f661-149">Next steps</span></span>
* <span data-ttu-id="0f661-150">Refer to the requirements for [Routing](expressroute-routing.md) and [QoS](expressroute-qos.md).</span><span class="sxs-lookup"><span data-stu-id="0f661-150">Refer to the requirements for [Routing](expressroute-routing.md) and [QoS](expressroute-qos.md).</span></span>
* <span data-ttu-id="0f661-151">For workflow information, see [ExpressRoute circuit provisioning workflows and circuit states](expressroute-workflows.md).</span><span class="sxs-lookup"><span data-stu-id="0f661-151">For workflow information, see [ExpressRoute circuit provisioning workflows and circuit states](expressroute-workflows.md).</span></span>
* <span data-ttu-id="0f661-152">Configure your ExpressRoute connection.</span><span class="sxs-lookup"><span data-stu-id="0f661-152">Configure your ExpressRoute connection.</span></span>
  
  * [<span data-ttu-id="0f661-153">Create an ExpressRoute circuit</span><span class="sxs-lookup"><span data-stu-id="0f661-153">Create an ExpressRoute circuit</span></span>](expressroute-howto-circuit-classic.md)
  * [<span data-ttu-id="0f661-154">Configure routing</span><span class="sxs-lookup"><span data-stu-id="0f661-154">Configure routing</span></span>](expressroute-howto-routing-classic.md)
  * [<span data-ttu-id="0f661-155">Link a VNet to an ExpressRoute circuit</span><span class="sxs-lookup"><span data-stu-id="0f661-155">Link a VNet to an ExpressRoute circuit</span></span>](expressroute-howto-linkvnet-classic.md)



