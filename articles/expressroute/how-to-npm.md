---
title: Configure Network Performance Monitor for Azure ExpressRoute circuits | Microsoft Docs
description: Configure cloud-based network monitoring (NPM) for Azure ExpressRoute circuits. This covers monitoring over ExpressRoute private peering and Microsoft peering.
documentationcenter: na
services: expressroute
author: cherylmc
editor: ''
tags: azure-resource-manager
ms.assetid: ''
ms.service: expressroute
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/28/2018
ms.author: cherylmc
ms.openlocfilehash: 47f219b7319e4d2bbadf03954f7bd7f6f39da3b4
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44868216"
---
# <a name="configure-network-performance-monitor-for-expressroute"></a><span data-ttu-id="aa1fd-104">Configure Network Performance Monitor for ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="aa1fd-104">Configure Network Performance Monitor for ExpressRoute</span></span>

<span data-ttu-id="aa1fd-105">Network Performance Monitor (NPM) is a cloud-based network monitoring solution that monitors connectivity between Azure cloud deployments and on-premises locations (Branch offices, etc.).</span><span class="sxs-lookup"><span data-stu-id="aa1fd-105">Network Performance Monitor (NPM) is a cloud-based network monitoring solution that monitors connectivity between Azure cloud deployments and on-premises locations (Branch offices, etc.).</span></span> <span data-ttu-id="aa1fd-106">NPM is part of Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-106">NPM is part of Log Analytics.</span></span> <span data-ttu-id="aa1fd-107">NPM offers an extension for ExpressRoute that lets you monitor network performance over ExpressRoute circuits that are configured to use private peering or Microsoft peering.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-107">NPM offers an extension for ExpressRoute that lets you monitor network performance over ExpressRoute circuits that are configured to use private peering or Microsoft peering.</span></span> <span data-ttu-id="aa1fd-108">When you configure NPM for ExpressRoute, you can detect network issues to identify and eliminate.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-108">When you configure NPM for ExpressRoute, you can detect network issues to identify and eliminate.</span></span> <span data-ttu-id="aa1fd-109">This service is also available for Azure Government Cloud.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-109">This service is also available for Azure Government Cloud.</span></span>

<span data-ttu-id="aa1fd-110">You can:</span><span class="sxs-lookup"><span data-stu-id="aa1fd-110">You can:</span></span>

* <span data-ttu-id="aa1fd-111">Monitor loss and latency across various VNets and set alerts</span><span class="sxs-lookup"><span data-stu-id="aa1fd-111">Monitor loss and latency across various VNets and set alerts</span></span>

* <span data-ttu-id="aa1fd-112">Monitor all paths (including redundant paths) on the network</span><span class="sxs-lookup"><span data-stu-id="aa1fd-112">Monitor all paths (including redundant paths) on the network</span></span>

* <span data-ttu-id="aa1fd-113">Troubleshoot transient and point-in-time network issues that are difficult to replicate</span><span class="sxs-lookup"><span data-stu-id="aa1fd-113">Troubleshoot transient and point-in-time network issues that are difficult to replicate</span></span>

* <span data-ttu-id="aa1fd-114">Help determine a specific segment on the network that is responsible for degraded performance</span><span class="sxs-lookup"><span data-stu-id="aa1fd-114">Help determine a specific segment on the network that is responsible for degraded performance</span></span>

* <span data-ttu-id="aa1fd-115">Get throughput per virtual network (If you have agents installed in each VNet)</span><span class="sxs-lookup"><span data-stu-id="aa1fd-115">Get throughput per virtual network (If you have agents installed in each VNet)</span></span>

* <span data-ttu-id="aa1fd-116">See the ExpressRoute system state from a previous point in time</span><span class="sxs-lookup"><span data-stu-id="aa1fd-116">See the ExpressRoute system state from a previous point in time</span></span>

## <a name="workflow"></a><span data-ttu-id="aa1fd-117">Workflow</span><span class="sxs-lookup"><span data-stu-id="aa1fd-117">Workflow</span></span>

<span data-ttu-id="aa1fd-118">Monitoring agents are installed on multiple servers, both on-premises and in Azure.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-118">Monitoring agents are installed on multiple servers, both on-premises and in Azure.</span></span> <span data-ttu-id="aa1fd-119">The agents communicate with each other, but do not send data, they send TCP handshake packets.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-119">The agents communicate with each other, but do not send data, they send TCP handshake packets.</span></span> <span data-ttu-id="aa1fd-120">The communication between the agents allows Azure to map the network topology and path the traffic could take.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-120">The communication between the agents allows Azure to map the network topology and path the traffic could take.</span></span>

1. <span data-ttu-id="aa1fd-121">Create an NPM Workspace.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-121">Create an NPM Workspace.</span></span> <span data-ttu-id="aa1fd-122">This is the same as an OMS Workspace.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-122">This is the same as an OMS Workspace.</span></span>
2. <span data-ttu-id="aa1fd-123">Install and configure software agents:</span><span class="sxs-lookup"><span data-stu-id="aa1fd-123">Install and configure software agents:</span></span> 
    * <span data-ttu-id="aa1fd-124">Install monitoring agents on the on-premises servers and the Azure VMs (for private peering).</span><span class="sxs-lookup"><span data-stu-id="aa1fd-124">Install monitoring agents on the on-premises servers and the Azure VMs (for private peering).</span></span>
    * <span data-ttu-id="aa1fd-125">Configure settings on the monitoring agent servers to allow the monitoring agents to communicate.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-125">Configure settings on the monitoring agent servers to allow the monitoring agents to communicate.</span></span> <span data-ttu-id="aa1fd-126">(Open firewall ports, etc.)</span><span class="sxs-lookup"><span data-stu-id="aa1fd-126">(Open firewall ports, etc.)</span></span>
3. <span data-ttu-id="aa1fd-127">Configure network security group (NSG) rules to allow the monitoring agent installed on Azure VMs to communicate with on-premises monitoring agents.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-127">Configure network security group (NSG) rules to allow the monitoring agent installed on Azure VMs to communicate with on-premises monitoring agents.</span></span>
4. <span data-ttu-id="aa1fd-128">Set up monitoring: Auto-Discover and manage which networks are visible in NPM.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-128">Set up monitoring: Auto-Discover and manage which networks are visible in NPM.</span></span>

<span data-ttu-id="aa1fd-129">If you are already using Network Performance Monitor to monitor other objects or services, and you already have Workspace in one of the supported regions, you can skip Step 1 and Step 2, and begin your configuration with Step 3.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-129">If you are already using Network Performance Monitor to monitor other objects or services, and you already have Workspace in one of the supported regions, you can skip Step 1 and Step 2, and begin your configuration with Step 3.</span></span>

## <a name="configure"></a><span data-ttu-id="aa1fd-130">Step 1: Create a Workspace</span><span class="sxs-lookup"><span data-stu-id="aa1fd-130">Step 1: Create a Workspace</span></span>

<span data-ttu-id="aa1fd-131">Create a workspace in the subscription that has the VNets link to the ExpressRoute circuit(s).</span><span class="sxs-lookup"><span data-stu-id="aa1fd-131">Create a workspace in the subscription that has the VNets link to the ExpressRoute circuit(s).</span></span>

1. <span data-ttu-id="aa1fd-132">In the [Azure portal](https://portal.azure.com), select the Subscription that has the VNETs peered to your ExpressRoute circuit.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-132">In the [Azure portal](https://portal.azure.com), select the Subscription that has the VNETs peered to your ExpressRoute circuit.</span></span> <span data-ttu-id="aa1fd-133">Then, search the list of services in the **Marketplace** for 'Network Performance Monitor'.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-133">Then, search the list of services in the **Marketplace** for 'Network Performance Monitor'.</span></span> <span data-ttu-id="aa1fd-134">In the return, click to open the **Network Performance Monitor** page.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-134">In the return, click to open the **Network Performance Monitor** page.</span></span>

   >[!NOTE]
   ><span data-ttu-id="aa1fd-135">You can create a new workspace, or use an existing workspace.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-135">You can create a new workspace, or use an existing workspace.</span></span> <span data-ttu-id="aa1fd-136">If you want to use an existing workspace, you must make sure that the workspace has been migrated to the new query language.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-136">If you want to use an existing workspace, you must make sure that the workspace has been migrated to the new query language.</span></span> [<span data-ttu-id="aa1fd-137">More information...</span><span class="sxs-lookup"><span data-stu-id="aa1fd-137">More information...</span></span>](https://docs.microsoft.com/azure/log-analytics/log-analytics-log-search-upgrade)
   >

   ![portal](.\media\how-to-npm\3.png)<br><br>
2. <span data-ttu-id="aa1fd-139">At the bottom of the main **Network Performance Monitor** page, click **Create** to open **Network Performance Monitor - Create new solution** page.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-139">At the bottom of the main **Network Performance Monitor** page, click **Create** to open **Network Performance Monitor - Create new solution** page.</span></span> <span data-ttu-id="aa1fd-140">Click **OMS Workspace - select a workspace** to open the Workspaces page.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-140">Click **OMS Workspace - select a workspace** to open the Workspaces page.</span></span> <span data-ttu-id="aa1fd-141">Click **+ Create New Workspace** to open the Workspace page.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-141">Click **+ Create New Workspace** to open the Workspace page.</span></span>
3. <span data-ttu-id="aa1fd-142">On the **OMS Workspace** page, select **Create New**, then configure the following settings:</span><span class="sxs-lookup"><span data-stu-id="aa1fd-142">On the **OMS Workspace** page, select **Create New**, then configure the following settings:</span></span>

  * <span data-ttu-id="aa1fd-143">OMS Workspace - Type a name for your Workspace.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-143">OMS Workspace - Type a name for your Workspace.</span></span>
  * <span data-ttu-id="aa1fd-144">Subscription - If you have multiple subscriptions, choose the one you want to associate with the new Workspace.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-144">Subscription - If you have multiple subscriptions, choose the one you want to associate with the new Workspace.</span></span>
  * <span data-ttu-id="aa1fd-145">Resource group - Create a resource group, or use an existing one.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-145">Resource group - Create a resource group, or use an existing one.</span></span>
  * <span data-ttu-id="aa1fd-146">Location - This location is used to specify the location of the storage account that is used for the agent connection logs.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-146">Location - This location is used to specify the location of the storage account that is used for the agent connection logs.</span></span>
  * <span data-ttu-id="aa1fd-147">Pricing tier - Select the pricing tier.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-147">Pricing tier - Select the pricing tier.</span></span>
  
    >[!NOTE]
    ><span data-ttu-id="aa1fd-148">The ExpressRoute circuit can be anywhere in the world.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-148">The ExpressRoute circuit can be anywhere in the world.</span></span> <span data-ttu-id="aa1fd-149">It doesn't have to be in the same region as the Workspace.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-149">It doesn't have to be in the same region as the Workspace.</span></span>
    >
  
    ![workspace](.\media\how-to-npm\4.png)<br><br>
4. <span data-ttu-id="aa1fd-151">Click **OK** to save and deploy the settings template.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-151">Click **OK** to save and deploy the settings template.</span></span> <span data-ttu-id="aa1fd-152">Once the template validates, click **Create** to deploy the Workspace.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-152">Once the template validates, click **Create** to deploy the Workspace.</span></span>
5. <span data-ttu-id="aa1fd-153">After the Workspace has been deployed, navigate to the **NetworkMonitoring(name)** resource that you created.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-153">After the Workspace has been deployed, navigate to the **NetworkMonitoring(name)** resource that you created.</span></span> <span data-ttu-id="aa1fd-154">Validate the settings, then click **Solution requires additional configuration**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-154">Validate the settings, then click **Solution requires additional configuration**.</span></span>

   ![additional configuration](.\media\how-to-npm\5.png)

## <a name="agents"></a><span data-ttu-id="aa1fd-156">Step 2: Install and configure agents</span><span class="sxs-lookup"><span data-stu-id="aa1fd-156">Step 2: Install and configure agents</span></span>

### <a name="download"></a><span data-ttu-id="aa1fd-157">2.1: Download the agent setup file</span><span class="sxs-lookup"><span data-stu-id="aa1fd-157">2.1: Download the agent setup file</span></span>

1. <span data-ttu-id="aa1fd-158">Go to the **Common Settings** tab of the **Network Performance Monitor Configuration** page for your resource.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-158">Go to the **Common Settings** tab of the **Network Performance Monitor Configuration** page for your resource.</span></span> <span data-ttu-id="aa1fd-159">Click the agent that corresponds to your server's processor from the **Install OMS Agents** section, and download the setup file.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-159">Click the agent that corresponds to your server's processor from the **Install OMS Agents** section, and download the setup file.</span></span>
2. <span data-ttu-id="aa1fd-160">Next, copy the **Workspace ID** and **Primary Key** to Notepad.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-160">Next, copy the **Workspace ID** and **Primary Key** to Notepad.</span></span>
3. <span data-ttu-id="aa1fd-161">From the **Configure OMS Agents for monitoring using TCP protocol** section, download the Powershell Script.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-161">From the **Configure OMS Agents for monitoring using TCP protocol** section, download the Powershell Script.</span></span> <span data-ttu-id="aa1fd-162">The PowerShell script helps you open the relevant firewall port for the TCP transactions.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-162">The PowerShell script helps you open the relevant firewall port for the TCP transactions.</span></span>

  ![PowerShell script](.\media\how-to-npm\7.png)

### <a name="installagent"></a><span data-ttu-id="aa1fd-164">2.2: Install a monitoring agent on each monitoring server (on each VNET that you want to monitor)</span><span class="sxs-lookup"><span data-stu-id="aa1fd-164">2.2: Install a monitoring agent on each monitoring server (on each VNET that you want to monitor)</span></span>

<span data-ttu-id="aa1fd-165">We recommend that you install at least two agents on each side of the ExpressRoute connection for redundancy (for example, on-premises, Azure VNETs).</span><span class="sxs-lookup"><span data-stu-id="aa1fd-165">We recommend that you install at least two agents on each side of the ExpressRoute connection for redundancy (for example, on-premises, Azure VNETs).</span></span> <span data-ttu-id="aa1fd-166">The agent must be installed on a Windows Server (2008 SP1 or later).</span><span class="sxs-lookup"><span data-stu-id="aa1fd-166">The agent must be installed on a Windows Server (2008 SP1 or later).</span></span> <span data-ttu-id="aa1fd-167">Monitoring ExpressRoute circuits using Windows Desktop OS and Linux OS is not supported.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-167">Monitoring ExpressRoute circuits using Windows Desktop OS and Linux OS is not supported.</span></span> <span data-ttu-id="aa1fd-168">Use the following steps to install agents:</span><span class="sxs-lookup"><span data-stu-id="aa1fd-168">Use the following steps to install agents:</span></span>
   
  >[!NOTE]
  ><span data-ttu-id="aa1fd-169">Agents pushed by SCOM (includes [MMA](https://technet.microsoft.com/library/dn465154(v=sc.12).aspx)) may not be able to consistently detect their location if they are hosted in Azure.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-169">Agents pushed by SCOM (includes [MMA](https://technet.microsoft.com/library/dn465154(v=sc.12).aspx)) may not be able to consistently detect their location if they are hosted in Azure.</span></span> <span data-ttu-id="aa1fd-170">We recommend that you do not use these agents in Azure VNETs to monitor ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-170">We recommend that you do not use these agents in Azure VNETs to monitor ExpressRoute.</span></span>
  >

1. <span data-ttu-id="aa1fd-171">Run **Setup** to install the agent on each server that you want to use for monitoring ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-171">Run **Setup** to install the agent on each server that you want to use for monitoring ExpressRoute.</span></span> <span data-ttu-id="aa1fd-172">The server you use for monitoring can either be a VM, or on-premises, and must have Internet access.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-172">The server you use for monitoring can either be a VM, or on-premises, and must have Internet access.</span></span> <span data-ttu-id="aa1fd-173">You need to install at least one agent on-premises, and one agent on each network segment that you want to monitor in Azure.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-173">You need to install at least one agent on-premises, and one agent on each network segment that you want to monitor in Azure.</span></span>
2. <span data-ttu-id="aa1fd-174">On the **Welcome** page, click **Next**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-174">On the **Welcome** page, click **Next**.</span></span>
3. <span data-ttu-id="aa1fd-175">On the **License Terms** page, read the license, and then click **I Agree**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-175">On the **License Terms** page, read the license, and then click **I Agree**.</span></span>
4. <span data-ttu-id="aa1fd-176">On the **Destination Folder** page, change or keep the default installation folder, and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-176">On the **Destination Folder** page, change or keep the default installation folder, and then click **Next**.</span></span>
5. <span data-ttu-id="aa1fd-177">On the **Agent Setup Options** page, you can choose to connect the agent to Azure Log Analytics or Operations Manager.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-177">On the **Agent Setup Options** page, you can choose to connect the agent to Azure Log Analytics or Operations Manager.</span></span> <span data-ttu-id="aa1fd-178">Or, you can leave the choices blank if you want to configure the agent later.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-178">Or, you can leave the choices blank if you want to configure the agent later.</span></span> <span data-ttu-id="aa1fd-179">After making your selection(s), click **Next**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-179">After making your selection(s), click **Next**.</span></span>

  * <span data-ttu-id="aa1fd-180">If you chose to connect to **Azure Log Analytics**, paste the **Workspace ID** and **Workspace Key** (Primary Key) that you copied into Notepad in the previous section.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-180">If you chose to connect to **Azure Log Analytics**, paste the **Workspace ID** and **Workspace Key** (Primary Key) that you copied into Notepad in the previous section.</span></span> <span data-ttu-id="aa1fd-181">Then, click **Next**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-181">Then, click **Next**.</span></span>

    ![ID and Key](.\media\how-to-npm\8.png)
  * <span data-ttu-id="aa1fd-183">If you chose to connect to **Operations Manager**, on the **Management Group Configuration** page, type the **Management Group Name**, **Management Server**, and the **Management Server Port**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-183">If you chose to connect to **Operations Manager**, on the **Management Group Configuration** page, type the **Management Group Name**, **Management Server**, and the **Management Server Port**.</span></span> <span data-ttu-id="aa1fd-184">Then, click **Next**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-184">Then, click **Next**.</span></span>

    ![Operations Manager](.\media\how-to-npm\9.png)
  * <span data-ttu-id="aa1fd-186">On the **Agent Action Account** page, choose either the **Local System** account, or  **Domain or Local Computer Account**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-186">On the **Agent Action Account** page, choose either the **Local System** account, or  **Domain or Local Computer Account**.</span></span> <span data-ttu-id="aa1fd-187">Then, click **Next**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-187">Then, click **Next**.</span></span>

    ![Account](.\media\how-to-npm\10.png)
6. <span data-ttu-id="aa1fd-189">On the **Ready to Install** page, review your choices, and then click **Install**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-189">On the **Ready to Install** page, review your choices, and then click **Install**.</span></span>
7. <span data-ttu-id="aa1fd-190">On the **Configuration completed successfully** page, click **Finish**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-190">On the **Configuration completed successfully** page, click **Finish**.</span></span>
8. <span data-ttu-id="aa1fd-191">When complete, the Microsoft Monitoring Agent appears in the Control Panel.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-191">When complete, the Microsoft Monitoring Agent appears in the Control Panel.</span></span> <span data-ttu-id="aa1fd-192">You can review your configuration there, and verify that the agent is connected to Azure Log Analytics (OMS).</span><span class="sxs-lookup"><span data-stu-id="aa1fd-192">You can review your configuration there, and verify that the agent is connected to Azure Log Analytics (OMS).</span></span> <span data-ttu-id="aa1fd-193">When connected, the agent displays a message stating: **The Microsoft Monitoring Agent has successfully connected to the Microsoft Operations Management Suite service**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-193">When connected, the agent displays a message stating: **The Microsoft Monitoring Agent has successfully connected to the Microsoft Operations Management Suite service**.</span></span>

9. <span data-ttu-id="aa1fd-194">Repeat this procedure for each VNET that you need to be monitored.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-194">Repeat this procedure for each VNET that you need to be monitored.</span></span>

### <a name="proxy"></a><span data-ttu-id="aa1fd-195">2.3: Configure proxy settings (optional)</span><span class="sxs-lookup"><span data-stu-id="aa1fd-195">2.3: Configure proxy settings (optional)</span></span>

<span data-ttu-id="aa1fd-196">If you are using a web proxy to access the Internet, use the following steps to configure proxy settings for the Microsoft Monitoring Agent.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-196">If you are using a web proxy to access the Internet, use the following steps to configure proxy settings for the Microsoft Monitoring Agent.</span></span> <span data-ttu-id="aa1fd-197">Perform these steps for each server.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-197">Perform these steps for each server.</span></span> <span data-ttu-id="aa1fd-198">If you have many servers that you need to configure, you might find it easier to use a script to automate this process.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-198">If you have many servers that you need to configure, you might find it easier to use a script to automate this process.</span></span> <span data-ttu-id="aa1fd-199">If so, see [To configure proxy settings for the Microsoft Monitoring Agent using a script](../log-analytics/log-analytics-windows-agent.md).</span><span class="sxs-lookup"><span data-stu-id="aa1fd-199">If so, see [To configure proxy settings for the Microsoft Monitoring Agent using a script](../log-analytics/log-analytics-windows-agent.md).</span></span>

<span data-ttu-id="aa1fd-200">To configure proxy settings for the Microsoft Monitoring Agent using the Control Panel:</span><span class="sxs-lookup"><span data-stu-id="aa1fd-200">To configure proxy settings for the Microsoft Monitoring Agent using the Control Panel:</span></span>

1. <span data-ttu-id="aa1fd-201">Open the **Control Panel**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-201">Open the **Control Panel**.</span></span>
2. <span data-ttu-id="aa1fd-202">Open **Microsoft Monitoring Agent**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-202">Open **Microsoft Monitoring Agent**.</span></span>
3. <span data-ttu-id="aa1fd-203">Click the **Proxy Settings** tab.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-203">Click the **Proxy Settings** tab.</span></span>
4. <span data-ttu-id="aa1fd-204">Select **Use a proxy server** and type the URL and port number, if one is needed.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-204">Select **Use a proxy server** and type the URL and port number, if one is needed.</span></span> <span data-ttu-id="aa1fd-205">If your proxy server requires authentication, type the username and password to access the proxy server.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-205">If your proxy server requires authentication, type the username and password to access the proxy server.</span></span>

  ![proxy](.\media\how-to-npm\11.png)

### <a name="verifyagent"></a><span data-ttu-id="aa1fd-207">2.4: Verify agent connectivity</span><span class="sxs-lookup"><span data-stu-id="aa1fd-207">2.4: Verify agent connectivity</span></span>

<span data-ttu-id="aa1fd-208">You can easily verify whether your agents are communicating.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-208">You can easily verify whether your agents are communicating.</span></span>

1. <span data-ttu-id="aa1fd-209">On a server with the monitoring agent, open the **Control Panel**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-209">On a server with the monitoring agent, open the **Control Panel**.</span></span>
2. <span data-ttu-id="aa1fd-210">Open the **Microsoft Monitoring Agent**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-210">Open the **Microsoft Monitoring Agent**.</span></span>
3. <span data-ttu-id="aa1fd-211">Click the **Azure Log Analytics** tab.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-211">Click the **Azure Log Analytics** tab.</span></span>
4. <span data-ttu-id="aa1fd-212">In the **Status** column, you should see that the agent connected successfully to Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-212">In the **Status** column, you should see that the agent connected successfully to Log Analytics.</span></span>

  ![status](.\media\how-to-npm\12.png)

### <a name="firewall"></a><span data-ttu-id="aa1fd-214">2.5: Open the firewall ports on the monitoring agent servers</span><span class="sxs-lookup"><span data-stu-id="aa1fd-214">2.5: Open the firewall ports on the monitoring agent servers</span></span>

<span data-ttu-id="aa1fd-215">To use the TCP protocol, you must open firewall ports to ensure that the monitoring agents can communicate.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-215">To use the TCP protocol, you must open firewall ports to ensure that the monitoring agents can communicate.</span></span>

<span data-ttu-id="aa1fd-216">You can run a PowerShell script to create the registry keys that are required by the Network Performance Monitor.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-216">You can run a PowerShell script to create the registry keys that are required by the Network Performance Monitor.</span></span> <span data-ttu-id="aa1fd-217">This script also creates the Windows Firewall rules to allow monitoring agents to create TCP connections with each other.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-217">This script also creates the Windows Firewall rules to allow monitoring agents to create TCP connections with each other.</span></span> <span data-ttu-id="aa1fd-218">The registry keys created by the script specify whether to log the debug logs, and the path for the logs file.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-218">The registry keys created by the script specify whether to log the debug logs, and the path for the logs file.</span></span> <span data-ttu-id="aa1fd-219">It also defines the agent TCP port used for communication.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-219">It also defines the agent TCP port used for communication.</span></span> <span data-ttu-id="aa1fd-220">The values for these keys are automatically set by the script.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-220">The values for these keys are automatically set by the script.</span></span> <span data-ttu-id="aa1fd-221">You should not manually change these keys.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-221">You should not manually change these keys.</span></span>

<span data-ttu-id="aa1fd-222">Port 8084 is opened by default.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-222">Port 8084 is opened by default.</span></span> <span data-ttu-id="aa1fd-223">You can use a custom port by providing the parameter 'portNumber' to the script.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-223">You can use a custom port by providing the parameter 'portNumber' to the script.</span></span> <span data-ttu-id="aa1fd-224">However, if you do so, you must specify the same port for all the servers on which you run the script.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-224">However, if you do so, you must specify the same port for all the servers on which you run the script.</span></span>

>[!NOTE]
><span data-ttu-id="aa1fd-225">The 'EnableRules' PowerShell script configures Windows Firewall rules only on the server where the script is run.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-225">The 'EnableRules' PowerShell script configures Windows Firewall rules only on the server where the script is run.</span></span> <span data-ttu-id="aa1fd-226">If you have a network firewall, you should make sure that it allows traffic destined for the TCP port being used by Network Performance Monitor.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-226">If you have a network firewall, you should make sure that it allows traffic destined for the TCP port being used by Network Performance Monitor.</span></span>
>
>

<span data-ttu-id="aa1fd-227">On the agent servers, open a PowerShell window with administrative privileges.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-227">On the agent servers, open a PowerShell window with administrative privileges.</span></span> <span data-ttu-id="aa1fd-228">Run the [EnableRules](https://aka.ms/npmpowershellscript) PowerShell script (which you downloaded earlier).</span><span class="sxs-lookup"><span data-stu-id="aa1fd-228">Run the [EnableRules](https://aka.ms/npmpowershellscript) PowerShell script (which you downloaded earlier).</span></span> <span data-ttu-id="aa1fd-229">Don't use any parameters.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-229">Don't use any parameters.</span></span>

![PowerShell_Script](.\media\how-to-npm\script.png)

## <a name="opennsg"></a><span data-ttu-id="aa1fd-231">Step 3: Configure network security group rules</span><span class="sxs-lookup"><span data-stu-id="aa1fd-231">Step 3: Configure network security group rules</span></span>

<span data-ttu-id="aa1fd-232">To monitor agent servers that are in Azure, you must configure network security group (NSG) rules to allow TCP traffic on a port used by NPM for synthetic transactions.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-232">To monitor agent servers that are in Azure, you must configure network security group (NSG) rules to allow TCP traffic on a port used by NPM for synthetic transactions.</span></span> <span data-ttu-id="aa1fd-233">The default port is 8084.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-233">The default port is 8084.</span></span> <span data-ttu-id="aa1fd-234">This allows a monitoring agent installed on an Azure VM to communicate with an on-premises monitoring agent.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-234">This allows a monitoring agent installed on an Azure VM to communicate with an on-premises monitoring agent.</span></span>

<span data-ttu-id="aa1fd-235">For more information about NSG, see [Network Security Groups](../virtual-network/virtual-networks-create-nsg-arm-portal.md).</span><span class="sxs-lookup"><span data-stu-id="aa1fd-235">For more information about NSG, see [Network Security Groups](../virtual-network/virtual-networks-create-nsg-arm-portal.md).</span></span>

>[!NOTE]
><span data-ttu-id="aa1fd-236">Make sure that you have installed the agents (both the on-premises server agent and the Azure server agent), and have run the PowerShell script before proceeding with this step.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-236">Make sure that you have installed the agents (both the on-premises server agent and the Azure server agent), and have run the PowerShell script before proceeding with this step.</span></span>
>

## <a name="setupmonitor"></a><span data-ttu-id="aa1fd-237">Step 4: Discover peering connections</span><span class="sxs-lookup"><span data-stu-id="aa1fd-237">Step 4: Discover peering connections</span></span>

1. <span data-ttu-id="aa1fd-238">Navigate to the Network Performance Monitor overview tile by going to the **All Resources** page, then click on the whitelisted NPM Workspace.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-238">Navigate to the Network Performance Monitor overview tile by going to the **All Resources** page, then click on the whitelisted NPM Workspace.</span></span>

  ![npm workspace](.\media\how-to-npm\npm.png)
2. <span data-ttu-id="aa1fd-240">Click the **Network Performance Monitor** overview tile to bring up the dashboard.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-240">Click the **Network Performance Monitor** overview tile to bring up the dashboard.</span></span> <span data-ttu-id="aa1fd-241">The dashboard contains an ExpressRoute page, which shows that ExpressRoute is in an 'unconfigured state'.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-241">The dashboard contains an ExpressRoute page, which shows that ExpressRoute is in an 'unconfigured state'.</span></span> <span data-ttu-id="aa1fd-242">Click **Feature Setup** to open the Network Performance Monitor configuration page.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-242">Click **Feature Setup** to open the Network Performance Monitor configuration page.</span></span>

  ![feature setup](.\media\how-to-npm\npm2.png)
3. <span data-ttu-id="aa1fd-244">On the configuration page, navigate to the 'ExpressRoute Peerings' tab, located on the left side panel.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-244">On the configuration page, navigate to the 'ExpressRoute Peerings' tab, located on the left side panel.</span></span> <span data-ttu-id="aa1fd-245">Next, click **Discover Now**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-245">Next, click **Discover Now**.</span></span>

  ![discover](.\media\how-to-npm\13.png)
4. <span data-ttu-id="aa1fd-247">When discovery completes, you will see a list containing the following items:</span><span class="sxs-lookup"><span data-stu-id="aa1fd-247">When discovery completes, you will see a list containing the following items:</span></span>
  * <span data-ttu-id="aa1fd-248">All of the Microsoft peering connections in the ExpressRoute circuit(s) that are associated with this subscription.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-248">All of the Microsoft peering connections in the ExpressRoute circuit(s) that are associated with this subscription.</span></span>
  * <span data-ttu-id="aa1fd-249">All of the private peering connections that connect to the VNets associated with this subscription.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-249">All of the private peering connections that connect to the VNets associated with this subscription.</span></span>
            
## <a name="configmonitor"></a><span data-ttu-id="aa1fd-250">Step 5: Configure monitors</span><span class="sxs-lookup"><span data-stu-id="aa1fd-250">Step 5: Configure monitors</span></span>

<span data-ttu-id="aa1fd-251">In this section, you configure the monitors.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-251">In this section, you configure the monitors.</span></span> <span data-ttu-id="aa1fd-252">Follow the steps for the type of peering that you want to monitor: **private peering**, or **Microsoft peering**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-252">Follow the steps for the type of peering that you want to monitor: **private peering**, or **Microsoft peering**.</span></span>

### <a name="private-peering"></a><span data-ttu-id="aa1fd-253">Private peering</span><span class="sxs-lookup"><span data-stu-id="aa1fd-253">Private peering</span></span>

<span data-ttu-id="aa1fd-254">For private peering, when discovery completes, you see will rules for unique **Circuit Name** and **VNet Name**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-254">For private peering, when discovery completes, you see will rules for unique **Circuit Name** and **VNet Name**.</span></span> <span data-ttu-id="aa1fd-255">Initially, these rules are disabled.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-255">Initially, these rules are disabled.</span></span>

![rules](.\media\how-to-npm\14.png)

1. <span data-ttu-id="aa1fd-257">Check the **Monitor this peering** checkbox.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-257">Check the **Monitor this peering** checkbox.</span></span>
2. <span data-ttu-id="aa1fd-258">Select the checkbox **Enable Health Monitoring for this peering**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-258">Select the checkbox **Enable Health Monitoring for this peering**.</span></span>
3. <span data-ttu-id="aa1fd-259">Choose the monitoring conditions.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-259">Choose the monitoring conditions.</span></span> <span data-ttu-id="aa1fd-260">You can set custom thresholds to generate health events by typing threshold values.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-260">You can set custom thresholds to generate health events by typing threshold values.</span></span> <span data-ttu-id="aa1fd-261">Whenever the value of the condition goes above its selected threshold for the selected network/subnetwork pair, a health event is generated.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-261">Whenever the value of the condition goes above its selected threshold for the selected network/subnetwork pair, a health event is generated.</span></span>
4. <span data-ttu-id="aa1fd-262">Click the ON-PREM AGENTS **Add Agents** button to add the on-premises servers from which you want to monitor the private peering connection.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-262">Click the ON-PREM AGENTS **Add Agents** button to add the on-premises servers from which you want to monitor the private peering connection.</span></span> <span data-ttu-id="aa1fd-263">Make sure that you only choose agents that have connectivity to the Microsoft service endpoint that you specified in the section for Step 2.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-263">Make sure that you only choose agents that have connectivity to the Microsoft service endpoint that you specified in the section for Step 2.</span></span> <span data-ttu-id="aa1fd-264">The on-premises agents must be able to reach the endpoint using the ExpressRoute connection.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-264">The on-premises agents must be able to reach the endpoint using the ExpressRoute connection.</span></span>
5. <span data-ttu-id="aa1fd-265">Save the settings.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-265">Save the settings.</span></span>
6. <span data-ttu-id="aa1fd-266">After enabling the rules and selecting the values and agents you want to monitor, there is a wait of approximately 30-60 minutes for the values to begin populating and the **ExpressRoute Monitoring** tiles to become available.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-266">After enabling the rules and selecting the values and agents you want to monitor, there is a wait of approximately 30-60 minutes for the values to begin populating and the **ExpressRoute Monitoring** tiles to become available.</span></span>

### <a name="microsoft-peering"></a><span data-ttu-id="aa1fd-267">Microsoft peering</span><span class="sxs-lookup"><span data-stu-id="aa1fd-267">Microsoft peering</span></span>

<span data-ttu-id="aa1fd-268">For Microsoft peering, click the Microsoft peering connection(s) that you want to monitor, and configure the settings.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-268">For Microsoft peering, click the Microsoft peering connection(s) that you want to monitor, and configure the settings.</span></span>

1. <span data-ttu-id="aa1fd-269">Check the **Monitor this peering** checkbox.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-269">Check the **Monitor this peering** checkbox.</span></span> 
2. <span data-ttu-id="aa1fd-270">(Optional) You can change the target Microsoft service endpoint.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-270">(Optional) You can change the target Microsoft service endpoint.</span></span> <span data-ttu-id="aa1fd-271">By default, NPM chooses a Microsoft service endpoint as the target.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-271">By default, NPM chooses a Microsoft service endpoint as the target.</span></span> <span data-ttu-id="aa1fd-272">NPM monitors connectivity from your on-premises servers to this target endpoint through ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-272">NPM monitors connectivity from your on-premises servers to this target endpoint through ExpressRoute.</span></span> 
    * <span data-ttu-id="aa1fd-273">To change this target endpoint, click the **(edit)** link under **Target:**, and select another Microsoft service target endpoint from the list of URLs.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-273">To change this target endpoint, click the **(edit)** link under **Target:**, and select another Microsoft service target endpoint from the list of URLs.</span></span>
      <span data-ttu-id="aa1fd-274">![edit target](.\media\how-to-npm\edit_target.png)</span><span class="sxs-lookup"><span data-stu-id="aa1fd-274">![edit target](.\media\how-to-npm\edit_target.png)</span></span><br>

    * <span data-ttu-id="aa1fd-275">You can use a custom URL or IP Address.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-275">You can use a custom URL or IP Address.</span></span> <span data-ttu-id="aa1fd-276">This option is particularly relevant if you are using Microsoft peering to establish a connection to Azure PaaS services, such as Azure Storage, SQL databases, and Websites that are offered on public IP addresses.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-276">This option is particularly relevant if you are using Microsoft peering to establish a connection to Azure PaaS services, such as Azure Storage, SQL databases, and Websites that are offered on public IP addresses.</span></span> <span data-ttu-id="aa1fd-277">To do this, click the link **(Use custom URL or IP Address instead)** at the bottom of the URL list, then enter the public endpoint of your Azure PaaS service that is connected through the ExpressRoute Microsoft peering.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-277">To do this, click the link **(Use custom URL or IP Address instead)** at the bottom of the URL list, then enter the public endpoint of your Azure PaaS service that is connected through the ExpressRoute Microsoft peering.</span></span>
    <span data-ttu-id="aa1fd-278">![custom URL](.\media\how-to-npm\custom_url.png)</span><span class="sxs-lookup"><span data-stu-id="aa1fd-278">![custom URL](.\media\how-to-npm\custom_url.png)</span></span><br>

    * <span data-ttu-id="aa1fd-279">If you are using these optional settings, make sure that only the Microsoft service endpoint is selected here.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-279">If you are using these optional settings, make sure that only the Microsoft service endpoint is selected here.</span></span> <span data-ttu-id="aa1fd-280">The endpoint must be connected to ExpressRoute and reachable by the on-premises agents.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-280">The endpoint must be connected to ExpressRoute and reachable by the on-premises agents.</span></span>
3. <span data-ttu-id="aa1fd-281">Select the checkbox **Enable Health Monitoring for this peering**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-281">Select the checkbox **Enable Health Monitoring for this peering**.</span></span>
4. <span data-ttu-id="aa1fd-282">Choose the monitoring conditions.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-282">Choose the monitoring conditions.</span></span> <span data-ttu-id="aa1fd-283">You can set custom thresholds to generate health events by typing threshold values.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-283">You can set custom thresholds to generate health events by typing threshold values.</span></span> <span data-ttu-id="aa1fd-284">Whenever the value of the condition goes above its selected threshold for the selected network/subnetwork pair, a health event is generated.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-284">Whenever the value of the condition goes above its selected threshold for the selected network/subnetwork pair, a health event is generated.</span></span>
5. <span data-ttu-id="aa1fd-285">Click the ON-PREM AGENTS **Add Agents** button to add the on-premises servers from which you want to monitor the Microsoft peering connection.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-285">Click the ON-PREM AGENTS **Add Agents** button to add the on-premises servers from which you want to monitor the Microsoft peering connection.</span></span> <span data-ttu-id="aa1fd-286">Make sure that you only choose agents that have connectivity to the Microsoft service endpoints that you specified in the section for Step 2.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-286">Make sure that you only choose agents that have connectivity to the Microsoft service endpoints that you specified in the section for Step 2.</span></span> <span data-ttu-id="aa1fd-287">The on-premises agents must be able to reach the endpoint using the ExpressRoute connection.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-287">The on-premises agents must be able to reach the endpoint using the ExpressRoute connection.</span></span>
6. <span data-ttu-id="aa1fd-288">Save the settings.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-288">Save the settings.</span></span>
7. <span data-ttu-id="aa1fd-289">After enabling the rules and selecting the values and agents you want to monitor, there is a wait of approximately 30-60 minutes for the values to begin populating and the **ExpressRoute Monitoring** tiles to become available.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-289">After enabling the rules and selecting the values and agents you want to monitor, there is a wait of approximately 30-60 minutes for the values to begin populating and the **ExpressRoute Monitoring** tiles to become available.</span></span>

## <a name="explore"></a><span data-ttu-id="aa1fd-290">Step 6: View monitoring tiles</span><span class="sxs-lookup"><span data-stu-id="aa1fd-290">Step 6: View monitoring tiles</span></span>

<span data-ttu-id="aa1fd-291">Once you see the monitoring tiles, your ExpressRoute circuits and connection resources are being monitored by NPM.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-291">Once you see the monitoring tiles, your ExpressRoute circuits and connection resources are being monitored by NPM.</span></span> <span data-ttu-id="aa1fd-292">You can click on Microsoft Peering tile to drill down on the health of Microsoft Peering connections.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-292">You can click on Microsoft Peering tile to drill down on the health of Microsoft Peering connections.</span></span>

![monitoring tiles](.\media\how-to-npm\15.png)

### <a name="dashboard"></a><span data-ttu-id="aa1fd-294">Network Performance Monitor page</span><span class="sxs-lookup"><span data-stu-id="aa1fd-294">Network Performance Monitor page</span></span>

<span data-ttu-id="aa1fd-295">The NPM page contains a page for ExpressRoute that shows an overview of the health of ExpressRoute circuits and peerings.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-295">The NPM page contains a page for ExpressRoute that shows an overview of the health of ExpressRoute circuits and peerings.</span></span>

![Dashboard](.\media\how-to-npm\dashboard.png)

### <a name="circuits"></a><span data-ttu-id="aa1fd-297">List of circuits</span><span class="sxs-lookup"><span data-stu-id="aa1fd-297">List of circuits</span></span>

<span data-ttu-id="aa1fd-298">To view a list of all monitored ExpressRoute circuits, click the **ExpressRoute circuits** tile.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-298">To view a list of all monitored ExpressRoute circuits, click the **ExpressRoute circuits** tile.</span></span> <span data-ttu-id="aa1fd-299">You can select a circuit and view its health state, trend charts for packet loss, bandwidth utilization, and latency.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-299">You can select a circuit and view its health state, trend charts for packet loss, bandwidth utilization, and latency.</span></span> <span data-ttu-id="aa1fd-300">The charts are interactive.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-300">The charts are interactive.</span></span> <span data-ttu-id="aa1fd-301">You can select a custom time window for plotting the charts.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-301">You can select a custom time window for plotting the charts.</span></span> <span data-ttu-id="aa1fd-302">You can drag the mouse over an area on the chart to zoom in and see fine-grained data points.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-302">You can drag the mouse over an area on the chart to zoom in and see fine-grained data points.</span></span>

![circuit_list](.\media\how-to-npm\circuits.png)

#### <a name="trend"></a><span data-ttu-id="aa1fd-304">Trend of Loss, Latency, and Throughput</span><span class="sxs-lookup"><span data-stu-id="aa1fd-304">Trend of Loss, Latency, and Throughput</span></span>

<span data-ttu-id="aa1fd-305">The bandwidth, latency, and loss charts are interactive.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-305">The bandwidth, latency, and loss charts are interactive.</span></span> <span data-ttu-id="aa1fd-306">You can zoom into any section of these charts, using mouse controls.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-306">You can zoom into any section of these charts, using mouse controls.</span></span> <span data-ttu-id="aa1fd-307">You can also see the bandwidth, latency, and loss data for other intervals by clicking **Date/Time**, located below the Actions button on the upper left.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-307">You can also see the bandwidth, latency, and loss data for other intervals by clicking **Date/Time**, located below the Actions button on the upper left.</span></span>

![trend](.\media\how-to-npm\16.png)

### <a name="peerings"></a><span data-ttu-id="aa1fd-309">Peerings list</span><span class="sxs-lookup"><span data-stu-id="aa1fd-309">Peerings list</span></span>

<span data-ttu-id="aa1fd-310">To view list of all connections to virtual networks over private peering, click the **Private Peerings** tile on the dashboard.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-310">To view list of all connections to virtual networks over private peering, click the **Private Peerings** tile on the dashboard.</span></span> <span data-ttu-id="aa1fd-311">Here, you can select a virtual network connection and view its health state, trend charts for packet loss, bandwidth utilization, and latency.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-311">Here, you can select a virtual network connection and view its health state, trend charts for packet loss, bandwidth utilization, and latency.</span></span>

![circuit list](.\media\how-to-npm\peerings.png)

### <a name="nodes"></a><span data-ttu-id="aa1fd-313">Nodes view</span><span class="sxs-lookup"><span data-stu-id="aa1fd-313">Nodes view</span></span>

<span data-ttu-id="aa1fd-314">To view list of all the links between the on-premises nodes and Azure VMs/Microsoft service endpoints for the chosen ExpressRoute peering connection, click **View node links**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-314">To view list of all the links between the on-premises nodes and Azure VMs/Microsoft service endpoints for the chosen ExpressRoute peering connection, click **View node links**.</span></span> <span data-ttu-id="aa1fd-315">You can view the health status of each link, as well as the trend of loss and latency associated with them.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-315">You can view the health status of each link, as well as the trend of loss and latency associated with them.</span></span>

![nodes view](.\media\how-to-npm\nodes.png)

### <a name="topology"></a><span data-ttu-id="aa1fd-317">Circuit topology</span><span class="sxs-lookup"><span data-stu-id="aa1fd-317">Circuit topology</span></span>

<span data-ttu-id="aa1fd-318">To view circuit topology, click the **Topology** tile.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-318">To view circuit topology, click the **Topology** tile.</span></span> <span data-ttu-id="aa1fd-319">This takes you to the topology view of the selected circuit or peering.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-319">This takes you to the topology view of the selected circuit or peering.</span></span> <span data-ttu-id="aa1fd-320">The topology diagram provides the latency for each segment on the network.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-320">The topology diagram provides the latency for each segment on the network.</span></span> <span data-ttu-id="aa1fd-321">Each layer 3 hop is represented by a node of the diagram.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-321">Each layer 3 hop is represented by a node of the diagram.</span></span> <span data-ttu-id="aa1fd-322">Clicking on a hop reveals more details about the hop.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-322">Clicking on a hop reveals more details about the hop.</span></span>

<span data-ttu-id="aa1fd-323">You can increase the level of visibility to include on-premises hops by moving the slider bar below **Filters**.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-323">You can increase the level of visibility to include on-premises hops by moving the slider bar below **Filters**.</span></span> <span data-ttu-id="aa1fd-324">Moving the slider bar to the left or right, increases/decreases the number of hops in the topology graph.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-324">Moving the slider bar to the left or right, increases/decreases the number of hops in the topology graph.</span></span> <span data-ttu-id="aa1fd-325">The latency across each segment is visible, which allows for faster isolation of high latency segments on your network.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-325">The latency across each segment is visible, which allows for faster isolation of high latency segments on your network.</span></span>

![filters](.\media\how-to-npm\topology.png)

#### <a name="detailed-topology-view-of-a-circuit"></a><span data-ttu-id="aa1fd-327">Detailed Topology view of a circuit</span><span class="sxs-lookup"><span data-stu-id="aa1fd-327">Detailed Topology view of a circuit</span></span>

<span data-ttu-id="aa1fd-328">This view shows VNet connections.</span><span class="sxs-lookup"><span data-stu-id="aa1fd-328">This view shows VNet connections.</span></span>
<span data-ttu-id="aa1fd-329">![detailed topology](.\media\how-to-npm\17.png)</span><span class="sxs-lookup"><span data-stu-id="aa1fd-329">![detailed topology](.\media\how-to-npm\17.png)</span></span>