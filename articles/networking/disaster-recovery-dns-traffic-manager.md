---
title: Disaster recovery using Azure DNS and Traffic Manager | Microsoft Docs
description: Overview of the disaster recovery solutions using Azure DNS and Traffic Manager.
services: dns
documentationcenter: na
author: KumudD
manager: jeconnoc
editor: ''
tags: azure-resource-manager
ms.assetid: ''
ms.service: dns
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/08/2018
ms.author: kumud
ms.openlocfilehash: ce3e8f31c7fee6afdeabf931485a49934e98f81b
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44869842"
---
# <a name="disaster-recovery-using-azure-dns-and-traffic-manager"></a><span data-ttu-id="52bd9-103">Disaster recovery using Azure DNS and Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="52bd9-103">Disaster recovery using Azure DNS and Traffic Manager</span></span>

<span data-ttu-id="52bd9-104">Disaster recovery focuses on recovering from a severe loss of application functionality.</span><span class="sxs-lookup"><span data-stu-id="52bd9-104">Disaster recovery focuses on recovering from a severe loss of application functionality.</span></span> <span data-ttu-id="52bd9-105">In order to choose a disaster recovery solution, business and technology owners must first determine the level of functionality that is required during a disaster, such as - unavailable, partially available via reduced functionality, or delayed availability, or fully available.</span><span class="sxs-lookup"><span data-stu-id="52bd9-105">In order to choose a disaster recovery solution, business and technology owners must first determine the level of functionality that is required during a disaster, such as - unavailable, partially available via reduced functionality, or delayed availability, or fully available.</span></span>
<span data-ttu-id="52bd9-106">Most enterprise customers are choosing a multi-region architecture for resiliency against an application or infrastructure level failover.</span><span class="sxs-lookup"><span data-stu-id="52bd9-106">Most enterprise customers are choosing a multi-region architecture for resiliency against an application or infrastructure level failover.</span></span> <span data-ttu-id="52bd9-107">Customers can choose several approaches in the quest to achieve failover and high availability via redundant architecture.</span><span class="sxs-lookup"><span data-stu-id="52bd9-107">Customers can choose several approaches in the quest to achieve failover and high availability via redundant architecture.</span></span> <span data-ttu-id="52bd9-108">Here are some of the popular approaches:</span><span class="sxs-lookup"><span data-stu-id="52bd9-108">Here are some of the popular approaches:</span></span>

- <span data-ttu-id="52bd9-109">**Active-passive with cold standby**: In this failover solution, the VMs and other appliances that are running in the standby region are not active until there is a need for failover.</span><span class="sxs-lookup"><span data-stu-id="52bd9-109">**Active-passive with cold standby**: In this failover solution, the VMs and other appliances that are running in the standby region are not active until there is a need for failover.</span></span> <span data-ttu-id="52bd9-110">However, the production environment is replicated in the form of backups, VM images, or Resource Manager templates, to a different region.</span><span class="sxs-lookup"><span data-stu-id="52bd9-110">However, the production environment is replicated in the form of backups, VM images, or Resource Manager templates, to a different region.</span></span> <span data-ttu-id="52bd9-111">This failover mechanism is cost-effective but takes a longer time to undertake a complete failover.</span><span class="sxs-lookup"><span data-stu-id="52bd9-111">This failover mechanism is cost-effective but takes a longer time to undertake a complete failover.</span></span>
 
    ![Active/Passive with cold standby](./media/disaster-recovery-dns-traffic-manager/active-passive-with-cold-standby.png)
    
    <span data-ttu-id="52bd9-113">*Figure - Active/Passive with cold standby disaster recovery configuration*</span><span class="sxs-lookup"><span data-stu-id="52bd9-113">*Figure - Active/Passive with cold standby disaster recovery configuration*</span></span>

- <span data-ttu-id="52bd9-114">**Active/Passive with pilot light**: In this failover solution, the standby environment is set up with a minimal configuration.</span><span class="sxs-lookup"><span data-stu-id="52bd9-114">**Active/Passive with pilot light**: In this failover solution, the standby environment is set up with a minimal configuration.</span></span> <span data-ttu-id="52bd9-115">The setup has only the necessary services running to support only a minimal and critical set of applications.</span><span class="sxs-lookup"><span data-stu-id="52bd9-115">The setup has only the necessary services running to support only a minimal and critical set of applications.</span></span> <span data-ttu-id="52bd9-116">In its native form, this scenario can only execute minimal functionality but can scale up and spawn additional services to take bulk of the production load if a failover occurs.</span><span class="sxs-lookup"><span data-stu-id="52bd9-116">In its native form, this scenario can only execute minimal functionality but can scale up and spawn additional services to take bulk of the production load if a failover occurs.</span></span>
    
    ![Active/Passive with pilot light](./media/disaster-recovery-dns-traffic-manager/active-passive-with-pilot-light.png)
    
    <span data-ttu-id="52bd9-118">*Figure: Active/Passive with pilot light disaster recovery configuration*</span><span class="sxs-lookup"><span data-stu-id="52bd9-118">*Figure: Active/Passive with pilot light disaster recovery configuration*</span></span>

- <span data-ttu-id="52bd9-119">**Active/Passive with warm standby**: In this failover solution, the standby region is pre-warmed and is ready to take the base load, auto scaling is turned on, and all the instances are up and running.</span><span class="sxs-lookup"><span data-stu-id="52bd9-119">**Active/Passive with warm standby**: In this failover solution, the standby region is pre-warmed and is ready to take the base load, auto scaling is turned on, and all the instances are up and running.</span></span> <span data-ttu-id="52bd9-120">This solution is not scaled to take the full production load but is functional, and all services are up and running.</span><span class="sxs-lookup"><span data-stu-id="52bd9-120">This solution is not scaled to take the full production load but is functional, and all services are up and running.</span></span> <span data-ttu-id="52bd9-121">This solution is an augmented version of the pilot light approach.</span><span class="sxs-lookup"><span data-stu-id="52bd9-121">This solution is an augmented version of the pilot light approach.</span></span>
    
    ![Active/Passive with warm standby](./media/disaster-recovery-dns-traffic-manager/active-passive-with-warm-standby.png)
    
    <span data-ttu-id="52bd9-123">*Figure: Active/Passive with warm standby disaster recovery configuration*</span><span class="sxs-lookup"><span data-stu-id="52bd9-123">*Figure: Active/Passive with warm standby disaster recovery configuration*</span></span>
    
<span data-ttu-id="52bd9-124">To learn more about failover and high availability, see [Disaster Recovery for Azure Applications](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span><span class="sxs-lookup"><span data-stu-id="52bd9-124">To learn more about failover and high availability, see [Disaster Recovery for Azure Applications](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span></span>


## <a name="planning-your-disaster-recovery-architecture"></a><span data-ttu-id="52bd9-125">Planning your disaster recovery architecture</span><span class="sxs-lookup"><span data-stu-id="52bd9-125">Planning your disaster recovery architecture</span></span>

<span data-ttu-id="52bd9-126">There are two technical aspects towards setting up your disaster recovery architecture:</span><span class="sxs-lookup"><span data-stu-id="52bd9-126">There are two technical aspects towards setting up your disaster recovery architecture:</span></span>
-  <span data-ttu-id="52bd9-127">Using a deployment mechanism to replicate instances, data, and configurations between primary and standby environments.</span><span class="sxs-lookup"><span data-stu-id="52bd9-127">Using a deployment mechanism to replicate instances, data, and configurations between primary and standby environments.</span></span> <span data-ttu-id="52bd9-128">This type of disaster recovery can be done natively via Azure Site-Recovery via Microsoft Azure partner appliances/services like Veritas or NetApp.</span><span class="sxs-lookup"><span data-stu-id="52bd9-128">This type of disaster recovery can be done natively via Azure Site-Recovery via Microsoft Azure partner appliances/services like Veritas or NetApp.</span></span> 
- <span data-ttu-id="52bd9-129">Developing a solution to divert network/web traffic from the primary site to the standby site.</span><span class="sxs-lookup"><span data-stu-id="52bd9-129">Developing a solution to divert network/web traffic from the primary site to the standby site.</span></span> <span data-ttu-id="52bd9-130">This type of disaster recovery can be achieved via Azure DNS, Azure Traffic Manager(DNS), or third-party global load balancers.</span><span class="sxs-lookup"><span data-stu-id="52bd9-130">This type of disaster recovery can be achieved via Azure DNS, Azure Traffic Manager(DNS), or third-party global load balancers.</span></span>

<span data-ttu-id="52bd9-131">This article is limited to approaches via Network and Web traffic redirection.</span><span class="sxs-lookup"><span data-stu-id="52bd9-131">This article is limited to approaches via Network and Web traffic redirection.</span></span> <span data-ttu-id="52bd9-132">For instructions to set up Azure Site Recovery, see [Azure Site Recovery Documentation](https://docs.microsoft.com/azure/site-recovery/).</span><span class="sxs-lookup"><span data-stu-id="52bd9-132">For instructions to set up Azure Site Recovery, see [Azure Site Recovery Documentation](https://docs.microsoft.com/azure/site-recovery/).</span></span>
<span data-ttu-id="52bd9-133">DNS is one of the most efficient mechanisms to divert network traffic because DNS is often global and external to the data center and is insulated from any regional or availability zone (AZ) level failures.</span><span class="sxs-lookup"><span data-stu-id="52bd9-133">DNS is one of the most efficient mechanisms to divert network traffic because DNS is often global and external to the data center and is insulated from any regional or availability zone (AZ) level failures.</span></span> <span data-ttu-id="52bd9-134">One can use a DNS-based failover mechanism and in Azure, two DNS services can accomplish the same in some fashion - Azure DNS (authoritative DNS) and Azure Traffic Manager (DNS-based smart traffic routing).</span><span class="sxs-lookup"><span data-stu-id="52bd9-134">One can use a DNS-based failover mechanism and in Azure, two DNS services can accomplish the same in some fashion - Azure DNS (authoritative DNS) and Azure Traffic Manager (DNS-based smart traffic routing).</span></span> 

<span data-ttu-id="52bd9-135">It is important to understand few concepts in DNS that are extensively used to discuss the solutions provided in this article:</span><span class="sxs-lookup"><span data-stu-id="52bd9-135">It is important to understand few concepts in DNS that are extensively used to discuss the solutions provided in this article:</span></span>
- <span data-ttu-id="52bd9-136">**DNS A Record** – A Records are pointers that point a domain to a IPv4 address.</span><span class="sxs-lookup"><span data-stu-id="52bd9-136">**DNS A Record** – A Records are pointers that point a domain to a IPv4 address.</span></span> 
- <span data-ttu-id="52bd9-137">**CNAME or Canonical name** - This record type is used to point to another DNS record.</span><span class="sxs-lookup"><span data-stu-id="52bd9-137">**CNAME or Canonical name** - This record type is used to point to another DNS record.</span></span> <span data-ttu-id="52bd9-138">CNAME doesn’t respond with an IP address but rather the pointer to the record that contains the IP address.</span><span class="sxs-lookup"><span data-stu-id="52bd9-138">CNAME doesn’t respond with an IP address but rather the pointer to the record that contains the IP address.</span></span> 
- <span data-ttu-id="52bd9-139">**Weighted Routing** – one can choose to associate a weight to service endpoints and then distribute the traffic based on the assigned weights.</span><span class="sxs-lookup"><span data-stu-id="52bd9-139">**Weighted Routing** – one can choose to associate a weight to service endpoints and then distribute the traffic based on the assigned weights.</span></span> <span data-ttu-id="52bd9-140">This routing method is one of the four traffic routing mechanisms available within Traffic Manager.</span><span class="sxs-lookup"><span data-stu-id="52bd9-140">This routing method is one of the four traffic routing mechanisms available within Traffic Manager.</span></span> <span data-ttu-id="52bd9-141">For more information, see [Weighted routing method](../traffic-manager/traffic-manager-routing-methods.md#weighted).</span><span class="sxs-lookup"><span data-stu-id="52bd9-141">For more information, see [Weighted routing method](../traffic-manager/traffic-manager-routing-methods.md#weighted).</span></span>
- <span data-ttu-id="52bd9-142">**Priority Routing** – Priority routing is based on health checks of endpoints.</span><span class="sxs-lookup"><span data-stu-id="52bd9-142">**Priority Routing** – Priority routing is based on health checks of endpoints.</span></span> <span data-ttu-id="52bd9-143">By default, Azure Traffic manager sends all traffic to the highest priority endpoint, and upon a failure or disaster, Traffic Manager routes the traffic to the secondary endpoint.</span><span class="sxs-lookup"><span data-stu-id="52bd9-143">By default, Azure Traffic manager sends all traffic to the highest priority endpoint, and upon a failure or disaster, Traffic Manager routes the traffic to the secondary endpoint.</span></span> <span data-ttu-id="52bd9-144">For more information, see [Priority routing method](../traffic-manager/traffic-manager-routing-methods.md#priority).</span><span class="sxs-lookup"><span data-stu-id="52bd9-144">For more information, see [Priority routing method](../traffic-manager/traffic-manager-routing-methods.md#priority).</span></span>

## <a name="manual-failover-using-azure-dns"></a><span data-ttu-id="52bd9-145">Manual failover using Azure DNS</span><span class="sxs-lookup"><span data-stu-id="52bd9-145">Manual failover using Azure DNS</span></span>
<span data-ttu-id="52bd9-146">The Azure DNS manual failover solution for disaster recovery uses the standard DNS mechanism to failover to the backup site.</span><span class="sxs-lookup"><span data-stu-id="52bd9-146">The Azure DNS manual failover solution for disaster recovery uses the standard DNS mechanism to failover to the backup site.</span></span> <span data-ttu-id="52bd9-147">The manual option via Azure DNS works best when used in conjunction with the cold standby or the pilot light approach.</span><span class="sxs-lookup"><span data-stu-id="52bd9-147">The manual option via Azure DNS works best when used in conjunction with the cold standby or the pilot light approach.</span></span> 

![Manual failover using Azure DNS](./media/disaster-recovery-dns-traffic-manager/manual-failover-using-dns.png)

<span data-ttu-id="52bd9-149">*Figure - Manual failover using Azure DNS*</span><span class="sxs-lookup"><span data-stu-id="52bd9-149">*Figure - Manual failover using Azure DNS*</span></span>

<span data-ttu-id="52bd9-150">The assumptions made for the solution are:</span><span class="sxs-lookup"><span data-stu-id="52bd9-150">The assumptions made for the solution are:</span></span>
-   <span data-ttu-id="52bd9-151">Both primary and secondary endpoints have static IPs that don’t change often.</span><span class="sxs-lookup"><span data-stu-id="52bd9-151">Both primary and secondary endpoints have static IPs that don’t change often.</span></span> <span data-ttu-id="52bd9-152">Say for the primary site the IP is 100.168.124.44 and the IP for the secondary site is 100.168.124.43.</span><span class="sxs-lookup"><span data-stu-id="52bd9-152">Say for the primary site the IP is 100.168.124.44 and the IP for the secondary site is 100.168.124.43.</span></span>
-   <span data-ttu-id="52bd9-153">An Azure DNS zone exists for both the primary and secondary site.</span><span class="sxs-lookup"><span data-stu-id="52bd9-153">An Azure DNS zone exists for both the primary and secondary site.</span></span> <span data-ttu-id="52bd9-154">Say for the primary site the endpoint is prod.contoso.com and for the backup site is dr.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="52bd9-154">Say for the primary site the endpoint is prod.contoso.com and for the backup site is dr.contoso.com.</span></span> <span data-ttu-id="52bd9-155">A DNS record for the main application known as www.contoso.com also exists.</span><span class="sxs-lookup"><span data-stu-id="52bd9-155">A DNS record for the main application known as www.contoso.com also exists.</span></span>   
-   <span data-ttu-id="52bd9-156">The TTL is at or below the RTO SLA set in the organization.</span><span class="sxs-lookup"><span data-stu-id="52bd9-156">The TTL is at or below the RTO SLA set in the organization.</span></span> <span data-ttu-id="52bd9-157">For example, if an enterprise sets the RTO of the application disaster response to be 60 mins, then the TTL should be less than 60 mins, preferably the lower the better.</span><span class="sxs-lookup"><span data-stu-id="52bd9-157">For example, if an enterprise sets the RTO of the application disaster response to be 60 mins, then the TTL should be less than 60 mins, preferably the lower the better.</span></span> <span data-ttu-id="52bd9-158">You can set up Azure DNS for manual failover as follows:</span><span class="sxs-lookup"><span data-stu-id="52bd9-158">You can set up Azure DNS for manual failover as follows:</span></span>
1. <span data-ttu-id="52bd9-159">Create a DNS zone</span><span class="sxs-lookup"><span data-stu-id="52bd9-159">Create a DNS zone</span></span>
2. <span data-ttu-id="52bd9-160">Create DNS zone records</span><span class="sxs-lookup"><span data-stu-id="52bd9-160">Create DNS zone records</span></span>
3. <span data-ttu-id="52bd9-161">Update CNAME record</span><span class="sxs-lookup"><span data-stu-id="52bd9-161">Update CNAME record</span></span>

### <a name="step-1-create-a-dns"></a><span data-ttu-id="52bd9-162">Step 1: Create a DNS</span><span class="sxs-lookup"><span data-stu-id="52bd9-162">Step 1: Create a DNS</span></span>
<span data-ttu-id="52bd9-163">Create a DNS zone (for example, www.contoso.com) as shown below:</span><span class="sxs-lookup"><span data-stu-id="52bd9-163">Create a DNS zone (for example, www.contoso.com) as shown below:</span></span>

![Create a DNS zone in Azure](./media/disaster-recovery-dns-traffic-manager/create-dns-zone.png)

<span data-ttu-id="52bd9-165">*Figure - Create a DNS zone in Azure*</span><span class="sxs-lookup"><span data-stu-id="52bd9-165">*Figure - Create a DNS zone in Azure*</span></span>

### <a name="step-2-create-dns-zone-records"></a><span data-ttu-id="52bd9-166">Step 2: Create DNS zone records</span><span class="sxs-lookup"><span data-stu-id="52bd9-166">Step 2: Create DNS zone records</span></span>

<span data-ttu-id="52bd9-167">Within this zone create three records (for example - www.contoso.com, prod.contoso.com and dr.consoto.com) as show below.</span><span class="sxs-lookup"><span data-stu-id="52bd9-167">Within this zone create three records (for example - www.contoso.com, prod.contoso.com and dr.consoto.com) as show below.</span></span>

![Create DNS zone records](./media/disaster-recovery-dns-traffic-manager/create-dns-zone-records.png)

<span data-ttu-id="52bd9-169">*Figure - Create DNS zone records in Azure*</span><span class="sxs-lookup"><span data-stu-id="52bd9-169">*Figure - Create DNS zone records in Azure*</span></span>

<span data-ttu-id="52bd9-170">In this scenario, site, www.contoso.com has a TTL of 30 mins, which is well below the stated RTO, and is pointing to the production site prod.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="52bd9-170">In this scenario, site, www.contoso.com has a TTL of 30 mins, which is well below the stated RTO, and is pointing to the production site prod.contoso.com.</span></span> <span data-ttu-id="52bd9-171">This configuration is during normal business operations.</span><span class="sxs-lookup"><span data-stu-id="52bd9-171">This configuration is during normal business operations.</span></span> <span data-ttu-id="52bd9-172">The TTL of prod.contoso.com and dr.contoso.com has been set to 300 seconds or 5 mins.</span><span class="sxs-lookup"><span data-stu-id="52bd9-172">The TTL of prod.contoso.com and dr.contoso.com has been set to 300 seconds or 5 mins.</span></span> <span data-ttu-id="52bd9-173">You can use an Azure monitoring service such as Azure Monitor or Azure App Insights, or, any partner monitoring solutions such as Dynatrace, You can even use home grown solutions that can monitor or detect application or virtual infrastructure level failures.</span><span class="sxs-lookup"><span data-stu-id="52bd9-173">You can use an Azure monitoring service such as Azure Monitor or Azure App Insights, or, any partner monitoring solutions such as Dynatrace, You can even use home grown solutions that can monitor or detect application or virtual infrastructure level failures.</span></span>

### <a name="step-3-update-the-cname-record"></a><span data-ttu-id="52bd9-174">Step 3: Update the CNAME record</span><span class="sxs-lookup"><span data-stu-id="52bd9-174">Step 3: Update the CNAME record</span></span>

<span data-ttu-id="52bd9-175">Once failure is detected, change the record value to point to dr.contoso.com as shown below:</span><span class="sxs-lookup"><span data-stu-id="52bd9-175">Once failure is detected, change the record value to point to dr.contoso.com as shown below:</span></span>
       
![Update CNAME record](./media/disaster-recovery-dns-traffic-manager/update-cname-record.png)

<span data-ttu-id="52bd9-177">*Figure - Update the CNAME record in Azure*</span><span class="sxs-lookup"><span data-stu-id="52bd9-177">*Figure - Update the CNAME record in Azure*</span></span>

<span data-ttu-id="52bd9-178">Within 30 minutes, during which most resolvers will refresh the cached zone file, any query to www.contoso.com will be redirected to dr.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="52bd9-178">Within 30 minutes, during which most resolvers will refresh the cached zone file, any query to www.contoso.com will be redirected to dr.contoso.com.</span></span>
<span data-ttu-id="52bd9-179">You can also run the following Azure CLI command to change the CNAME value:</span><span class="sxs-lookup"><span data-stu-id="52bd9-179">You can also run the following Azure CLI command to change the CNAME value:</span></span>
 ```azurecli
   az network dns record-set cname set-record \
   --resource-group 123 \
   --zone-name contoso.com \
   --record-set-name www \
   --cname dr.contoso.com
```
<span data-ttu-id="52bd9-180">This step can be executed manually or via automation.</span><span class="sxs-lookup"><span data-stu-id="52bd9-180">This step can be executed manually or via automation.</span></span> <span data-ttu-id="52bd9-181">It can be done manually via the console or by the Azure CLI.</span><span class="sxs-lookup"><span data-stu-id="52bd9-181">It can be done manually via the console or by the Azure CLI.</span></span> <span data-ttu-id="52bd9-182">The Azure SDK and API can be used to automate the CNAME update so that no manual intervention is required.</span><span class="sxs-lookup"><span data-stu-id="52bd9-182">The Azure SDK and API can be used to automate the CNAME update so that no manual intervention is required.</span></span> <span data-ttu-id="52bd9-183">Automation can be built via Azure functions or within a third-party monitoring application or even from on- premises.</span><span class="sxs-lookup"><span data-stu-id="52bd9-183">Automation can be built via Azure functions or within a third-party monitoring application or even from on- premises.</span></span>

### <a name="how-manual-failover-works-using-azure-dns"></a><span data-ttu-id="52bd9-184">How manual failover works using Azure DNS</span><span class="sxs-lookup"><span data-stu-id="52bd9-184">How manual failover works using Azure DNS</span></span>
<span data-ttu-id="52bd9-185">Since the DNS server is outside the failover or disaster zone, it is insulated against any downtime.</span><span class="sxs-lookup"><span data-stu-id="52bd9-185">Since the DNS server is outside the failover or disaster zone, it is insulated against any downtime.</span></span> <span data-ttu-id="52bd9-186">This enables user to architect a simple failover scenario that is cost effective and will work all the time assuming that the operator has network connectivity during disaster and can make the flip.</span><span class="sxs-lookup"><span data-stu-id="52bd9-186">This enables user to architect a simple failover scenario that is cost effective and will work all the time assuming that the operator has network connectivity during disaster and can make the flip.</span></span> <span data-ttu-id="52bd9-187">If the solution is scripted, then one must ensure that the server or service running the script should be insulated against the problem affecting the production environment.</span><span class="sxs-lookup"><span data-stu-id="52bd9-187">If the solution is scripted, then one must ensure that the server or service running the script should be insulated against the problem affecting the production environment.</span></span> <span data-ttu-id="52bd9-188">Also, keep in mind the low TTL that was set against the zone so that no resolver around the world keeps the endpoint cached for long and customers can access the site within the RTO.</span><span class="sxs-lookup"><span data-stu-id="52bd9-188">Also, keep in mind the low TTL that was set against the zone so that no resolver around the world keeps the endpoint cached for long and customers can access the site within the RTO.</span></span> <span data-ttu-id="52bd9-189">For a cold standby and pilot light, since some prewarming and other administrative activity may be required – one should also give enough time before making the flip.</span><span class="sxs-lookup"><span data-stu-id="52bd9-189">For a cold standby and pilot light, since some prewarming and other administrative activity may be required – one should also give enough time before making the flip.</span></span>

## <a name="automatic-failover-using-azure-traffic-manager"></a><span data-ttu-id="52bd9-190">Automatic failover using Azure Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="52bd9-190">Automatic failover using Azure Traffic Manager</span></span>
<span data-ttu-id="52bd9-191">When you have complex architectures and multiple sets of resources capable of performing the same function, you can configure Azure Traffic Manager (based on DNS) to check the health of your resources and route the traffic from the non-healthy resource to the healthy resource.</span><span class="sxs-lookup"><span data-stu-id="52bd9-191">When you have complex architectures and multiple sets of resources capable of performing the same function, you can configure Azure Traffic Manager (based on DNS) to check the health of your resources and route the traffic from the non-healthy resource to the healthy resource.</span></span> <span data-ttu-id="52bd9-192">In the following example, both the primary region and the secondary region have a full deployment.</span><span class="sxs-lookup"><span data-stu-id="52bd9-192">In the following example, both the primary region and the secondary region have a full deployment.</span></span> <span data-ttu-id="52bd9-193">This deployment includes the cloud services and a synchronized database.</span><span class="sxs-lookup"><span data-stu-id="52bd9-193">This deployment includes the cloud services and a synchronized database.</span></span> 

![Automatic failover using Azure Traffic Manager](./media/disaster-recovery-dns-traffic-manager/automatic-failover-using-traffic-manager.png)

<span data-ttu-id="52bd9-195">*Figure - Automatic failover using Azure Traffic Manager*</span><span class="sxs-lookup"><span data-stu-id="52bd9-195">*Figure - Automatic failover using Azure Traffic Manager*</span></span>

<span data-ttu-id="52bd9-196">However, only the primary region is actively handling network requests from the users.</span><span class="sxs-lookup"><span data-stu-id="52bd9-196">However, only the primary region is actively handling network requests from the users.</span></span> <span data-ttu-id="52bd9-197">The secondary region becomes active only when the primary region experiences a service disruption.</span><span class="sxs-lookup"><span data-stu-id="52bd9-197">The secondary region becomes active only when the primary region experiences a service disruption.</span></span> <span data-ttu-id="52bd9-198">In that case, all new network requests route to the secondary region.</span><span class="sxs-lookup"><span data-stu-id="52bd9-198">In that case, all new network requests route to the secondary region.</span></span> <span data-ttu-id="52bd9-199">Since the backup of the database is near instantaneous, both the load balancers have IPs that can be health checked, and the instances are always up and running, this topology provides an option for going in for a low RTO and failover without any manual intervention.</span><span class="sxs-lookup"><span data-stu-id="52bd9-199">Since the backup of the database is near instantaneous, both the load balancers have IPs that can be health checked, and the instances are always up and running, this topology provides an option for going in for a low RTO and failover without any manual intervention.</span></span> <span data-ttu-id="52bd9-200">The secondary failover region must be ready to go-live immediately after failure of the primary region.</span><span class="sxs-lookup"><span data-stu-id="52bd9-200">The secondary failover region must be ready to go-live immediately after failure of the primary region.</span></span>
<span data-ttu-id="52bd9-201">This scenario is ideal for the use of Azure Traffic Manager that has inbuilt probes for various types of health checks including http / https and TCP.</span><span class="sxs-lookup"><span data-stu-id="52bd9-201">This scenario is ideal for the use of Azure Traffic Manager that has inbuilt probes for various types of health checks including http / https and TCP.</span></span> <span data-ttu-id="52bd9-202">Azure Traffic manager also has a rule engine that can be configured to failover when a failure occurs as described below.</span><span class="sxs-lookup"><span data-stu-id="52bd9-202">Azure Traffic manager also has a rule engine that can be configured to failover when a failure occurs as described below.</span></span> <span data-ttu-id="52bd9-203">Let’s consider the following solution using Traffic Manager:</span><span class="sxs-lookup"><span data-stu-id="52bd9-203">Let’s consider the following solution using Traffic Manager:</span></span>
- <span data-ttu-id="52bd9-204">Customer has the Region #1 endpoint known as prod.contoso.com with a static IP as 100.168.124.44 and a Region #2 endpoint known as dr.contoso.com with a static IP as 100.168.124.43.</span><span class="sxs-lookup"><span data-stu-id="52bd9-204">Customer has the Region #1 endpoint known as prod.contoso.com with a static IP as 100.168.124.44 and a Region #2 endpoint known as dr.contoso.com with a static IP as 100.168.124.43.</span></span> 
-   <span data-ttu-id="52bd9-205">Each of these environments is fronted via a public facing property like a load balancer.</span><span class="sxs-lookup"><span data-stu-id="52bd9-205">Each of these environments is fronted via a public facing property like a load balancer.</span></span> <span data-ttu-id="52bd9-206">The load balancer can be configured to have a DNS-based endpoint or a fully qualified domain name (FQDN) as shown above.</span><span class="sxs-lookup"><span data-stu-id="52bd9-206">The load balancer can be configured to have a DNS-based endpoint or a fully qualified domain name (FQDN) as shown above.</span></span>
-   <span data-ttu-id="52bd9-207">All the instances in Region 2 are in near real-time replication with Region 1.</span><span class="sxs-lookup"><span data-stu-id="52bd9-207">All the instances in Region 2 are in near real-time replication with Region 1.</span></span> <span data-ttu-id="52bd9-208">Furthermore, the machine images are up-to-date, and all software/configuration data is patched and are in line with Region 1.</span><span class="sxs-lookup"><span data-stu-id="52bd9-208">Furthermore, the machine images are up-to-date, and all software/configuration data is patched and are in line with Region 1.</span></span>  
-   <span data-ttu-id="52bd9-209">Autoscaling is preconfigured in advance.</span><span class="sxs-lookup"><span data-stu-id="52bd9-209">Autoscaling is preconfigured in advance.</span></span> 

<span data-ttu-id="52bd9-210">The steps taken to configure the failover with Azure Traffic Manager are as follows:</span><span class="sxs-lookup"><span data-stu-id="52bd9-210">The steps taken to configure the failover with Azure Traffic Manager are as follows:</span></span>
1. <span data-ttu-id="52bd9-211">Create a new Azure Traffic Manager profile</span><span class="sxs-lookup"><span data-stu-id="52bd9-211">Create a new Azure Traffic Manager profile</span></span>
2. <span data-ttu-id="52bd9-212">Create endpoints within the Traffic Manager profile</span><span class="sxs-lookup"><span data-stu-id="52bd9-212">Create endpoints within the Traffic Manager profile</span></span>
3. <span data-ttu-id="52bd9-213">Set up health check and failover configuration</span><span class="sxs-lookup"><span data-stu-id="52bd9-213">Set up health check and failover configuration</span></span>

### <a name="step-1-create-a-new-azure-traffic-manager-profile"></a><span data-ttu-id="52bd9-214">Step 1: Create a new Azure Traffic Manager profile</span><span class="sxs-lookup"><span data-stu-id="52bd9-214">Step 1: Create a new Azure Traffic Manager profile</span></span>
<span data-ttu-id="52bd9-215">Create a new Azure Traffic manager profile with the name contoso123 and select the Routing method as Priority.</span><span class="sxs-lookup"><span data-stu-id="52bd9-215">Create a new Azure Traffic manager profile with the name contoso123 and select the Routing method as Priority.</span></span> <span data-ttu-id="52bd9-216">If you have a pre-existing resource group that you want to associate with, then you can select an existing resource group, otherwise, create a new resource group.</span><span class="sxs-lookup"><span data-stu-id="52bd9-216">If you have a pre-existing resource group that you want to associate with, then you can select an existing resource group, otherwise, create a new resource group.</span></span>

<span data-ttu-id="52bd9-217">![Create Traffic Manager profile](./media/disaster-recovery-dns-traffic-manager/create-traffic-manager-profile.png)
*Figure - Create a Traffic Manager profile*</span><span class="sxs-lookup"><span data-stu-id="52bd9-217">![Create Traffic Manager profile](./media/disaster-recovery-dns-traffic-manager/create-traffic-manager-profile.png)
*Figure - Create a Traffic Manager profile*</span></span>

### <a name="step-2-create-endpoints-within-the-traffic-manager-profile"></a><span data-ttu-id="52bd9-218">Step 2: Create endpoints within the Traffic Manager profile</span><span class="sxs-lookup"><span data-stu-id="52bd9-218">Step 2: Create endpoints within the Traffic Manager profile</span></span>

<span data-ttu-id="52bd9-219">In this step, you create endpoints that point to the production and disaster recovery sites.</span><span class="sxs-lookup"><span data-stu-id="52bd9-219">In this step, you create endpoints that point to the production and disaster recovery sites.</span></span> <span data-ttu-id="52bd9-220">Here, choose the **Type** as an external endpoint, but if the resource is hosted in Azure, then you can choose **Azure endpoint** as well.</span><span class="sxs-lookup"><span data-stu-id="52bd9-220">Here, choose the **Type** as an external endpoint, but if the resource is hosted in Azure, then you can choose **Azure endpoint** as well.</span></span> <span data-ttu-id="52bd9-221">If you choose **Azure endpoint**, then select a **Target resource** that is either an **App Service** or a **Public IP** that is allocated by Azure.</span><span class="sxs-lookup"><span data-stu-id="52bd9-221">If you choose **Azure endpoint**, then select a **Target resource** that is either an **App Service** or a **Public IP** that is allocated by Azure.</span></span> <span data-ttu-id="52bd9-222">The priority is set as **1** since it is the primary service for Region 1.</span><span class="sxs-lookup"><span data-stu-id="52bd9-222">The priority is set as **1** since it is the primary service for Region 1.</span></span>
<span data-ttu-id="52bd9-223">Similarly, create the disaster recovery endpoint within Traffic Manager as well.</span><span class="sxs-lookup"><span data-stu-id="52bd9-223">Similarly, create the disaster recovery endpoint within Traffic Manager as well.</span></span>

![Create disaster recovery endpoints](./media/disaster-recovery-dns-traffic-manager/create-disaster-recovery-endpoint.png)

<span data-ttu-id="52bd9-225">*Figure - Create disaster recovery endpoints*</span><span class="sxs-lookup"><span data-stu-id="52bd9-225">*Figure - Create disaster recovery endpoints*</span></span>

### <a name="step-3-set-up-health-check-and-failover-configuration"></a><span data-ttu-id="52bd9-226">Step 3: Set up health check and failover configuration</span><span class="sxs-lookup"><span data-stu-id="52bd9-226">Step 3: Set up health check and failover configuration</span></span>

<span data-ttu-id="52bd9-227">In this step, you set the DNS TTL to 10 seconds, which is honored by most internet-facing recursive resolvers.</span><span class="sxs-lookup"><span data-stu-id="52bd9-227">In this step, you set the DNS TTL to 10 seconds, which is honored by most internet-facing recursive resolvers.</span></span> <span data-ttu-id="52bd9-228">This configuration means that no DNS resolver will cache the information for more than 10 seconds.</span><span class="sxs-lookup"><span data-stu-id="52bd9-228">This configuration means that no DNS resolver will cache the information for more than 10 seconds.</span></span> <span data-ttu-id="52bd9-229">For the endpoint monitor settings, the path is current set at / or root, but you can customize the endpoint settings to evaluate a path, for example, prod.contoso.com/index.</span><span class="sxs-lookup"><span data-stu-id="52bd9-229">For the endpoint monitor settings, the path is current set at / or root, but you can customize the endpoint settings to evaluate a path, for example, prod.contoso.com/index.</span></span> <span data-ttu-id="52bd9-230">The example below shows the **https** as the probing protocol.</span><span class="sxs-lookup"><span data-stu-id="52bd9-230">The example below shows the **https** as the probing protocol.</span></span> <span data-ttu-id="52bd9-231">However, you can choose **http** or **tcp** as well.</span><span class="sxs-lookup"><span data-stu-id="52bd9-231">However, you can choose **http** or **tcp** as well.</span></span> <span data-ttu-id="52bd9-232">The choice of protocol depends upon the end application.</span><span class="sxs-lookup"><span data-stu-id="52bd9-232">The choice of protocol depends upon the end application.</span></span> <span data-ttu-id="52bd9-233">The probing interval is set to 10 seconds, which enables fast probing, and the retry is set to 3.</span><span class="sxs-lookup"><span data-stu-id="52bd9-233">The probing interval is set to 10 seconds, which enables fast probing, and the retry is set to 3.</span></span> <span data-ttu-id="52bd9-234">As a result, Traffic Manager will failover to the second endpoint if three consecutive intervals register a failure.</span><span class="sxs-lookup"><span data-stu-id="52bd9-234">As a result, Traffic Manager will failover to the second endpoint if three consecutive intervals register a failure.</span></span> <span data-ttu-id="52bd9-235">The following formula defines the total time for an automated failover: Time for failover = TTL + Retry \* Probing interval And in this case, the value is 10 + 3 \* 10 = 40 seconds (Max).</span><span class="sxs-lookup"><span data-stu-id="52bd9-235">The following formula defines the total time for an automated failover: Time for failover = TTL + Retry \* Probing interval And in this case, the value is 10 + 3 \* 10 = 40 seconds (Max).</span></span>
<span data-ttu-id="52bd9-236">If the Retry is set to 1 and TTL is set to 10 secs, then the time for failover 10 + 1 \* 10 = 20 seconds.</span><span class="sxs-lookup"><span data-stu-id="52bd9-236">If the Retry is set to 1 and TTL is set to 10 secs, then the time for failover 10 + 1 \* 10 = 20 seconds.</span></span> <span data-ttu-id="52bd9-237">Set the Retry to a value greater than **1** to eliminate chances of failovers due to false positives or any minor network blips.</span><span class="sxs-lookup"><span data-stu-id="52bd9-237">Set the Retry to a value greater than **1** to eliminate chances of failovers due to false positives or any minor network blips.</span></span> 


![Set up health check](./media/disaster-recovery-dns-traffic-manager/set-up-health-check.png)

<span data-ttu-id="52bd9-239">*Figure - Set up health check and failover configuration*</span><span class="sxs-lookup"><span data-stu-id="52bd9-239">*Figure - Set up health check and failover configuration*</span></span>

### <a name="how-automatic-failover-works-using-traffic-manager"></a><span data-ttu-id="52bd9-240">How automatic failover works using Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="52bd9-240">How automatic failover works using Traffic Manager</span></span>

<span data-ttu-id="52bd9-241">During a disaster, the primary endpoint gets probed and the status changes to **degraded** and the disaster recovery site remains **Online**.</span><span class="sxs-lookup"><span data-stu-id="52bd9-241">During a disaster, the primary endpoint gets probed and the status changes to **degraded** and the disaster recovery site remains **Online**.</span></span> <span data-ttu-id="52bd9-242">By default, Traffic Manager sends all traffic to the primary (highest-priority) endpoint.</span><span class="sxs-lookup"><span data-stu-id="52bd9-242">By default, Traffic Manager sends all traffic to the primary (highest-priority) endpoint.</span></span> <span data-ttu-id="52bd9-243">If the primary endpoint appears degraded, Traffic Manager routes the traffic to the second endpoint as long as it remains healthy.</span><span class="sxs-lookup"><span data-stu-id="52bd9-243">If the primary endpoint appears degraded, Traffic Manager routes the traffic to the second endpoint as long as it remains healthy.</span></span> <span data-ttu-id="52bd9-244">One has the option to configure more endpoints within Traffic Manager that can serve as additional failover endpoints, or, as load balancers sharing the load between endpoints.</span><span class="sxs-lookup"><span data-stu-id="52bd9-244">One has the option to configure more endpoints within Traffic Manager that can serve as additional failover endpoints, or, as load balancers sharing the load between endpoints.</span></span>

## <a name="next-steps"></a><span data-ttu-id="52bd9-245">Next steps</span><span class="sxs-lookup"><span data-stu-id="52bd9-245">Next steps</span></span>
- <span data-ttu-id="52bd9-246">Learn more about [Azure Traffic Manager](../traffic-manager/traffic-manager-overview.md).</span><span class="sxs-lookup"><span data-stu-id="52bd9-246">Learn more about [Azure Traffic Manager](../traffic-manager/traffic-manager-overview.md).</span></span>
- <span data-ttu-id="52bd9-247">Learn more about [Azure DNS](../dns/dns-overview.md).</span><span class="sxs-lookup"><span data-stu-id="52bd9-247">Learn more about [Azure DNS](../dns/dns-overview.md).</span></span>









