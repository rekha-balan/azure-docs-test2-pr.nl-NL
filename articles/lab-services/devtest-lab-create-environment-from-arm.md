---
title: Create multi-VM environments and PaaS resources with Azure Resource Manager templates | Microsoft Docs
description: Learn how to create multi-VM environments and PaaS resources in Azure DevTest Labs from an Azure Resource Manager template
services: devtest-lab,virtual-machines,lab-services
documentationcenter: na
author: spelluru
manager: femila
editor: ''
ms.assetid: ''
ms.service: lab-services
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/05/2018
ms.author: spelluru
ms.openlocfilehash: e53e3e551041ed5bb04ae8e692a3fe3baf2521f8
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44869999"
---
# <a name="create-multi-vm-environments-and-paas-resources-with-azure-resource-manager-templates"></a><span data-ttu-id="b7333-103">Create multi-VM environments and PaaS resources with Azure Resource Manager templates</span><span class="sxs-lookup"><span data-stu-id="b7333-103">Create multi-VM environments and PaaS resources with Azure Resource Manager templates</span></span>

<span data-ttu-id="b7333-104">The [Azure portal](http://go.microsoft.com/fwlink/p/?LinkID=525040) enables you to easily [add one VM at a time to a lab](https://docs.microsoft.com/azure/devtest-lab/devtest-lab-add-vm).</span><span class="sxs-lookup"><span data-stu-id="b7333-104">The [Azure portal](http://go.microsoft.com/fwlink/p/?LinkID=525040) enables you to easily [add one VM at a time to a lab](https://docs.microsoft.com/azure/devtest-lab/devtest-lab-add-vm).</span></span> <span data-ttu-id="b7333-105">However, if the environment contains multiple VMs, each VM must be individually created.</span><span class="sxs-lookup"><span data-stu-id="b7333-105">However, if the environment contains multiple VMs, each VM must be individually created.</span></span> <span data-ttu-id="b7333-106">For scenarios such as a multi-tier Web app or a SharePoint farm, a mechanism is needed to allow for the creation of multiple VMs in a single step.</span><span class="sxs-lookup"><span data-stu-id="b7333-106">For scenarios such as a multi-tier Web app or a SharePoint farm, a mechanism is needed to allow for the creation of multiple VMs in a single step.</span></span> <span data-ttu-id="b7333-107">By using Azure Resource Manager templates, you can now define the infrastructure and configuration of your Azure solution and repeatedly deploy multiple VMs in a consistent state.</span><span class="sxs-lookup"><span data-stu-id="b7333-107">By using Azure Resource Manager templates, you can now define the infrastructure and configuration of your Azure solution and repeatedly deploy multiple VMs in a consistent state.</span></span> <span data-ttu-id="b7333-108">This feature provides the following benefits:</span><span class="sxs-lookup"><span data-stu-id="b7333-108">This feature provides the following benefits:</span></span>

- <span data-ttu-id="b7333-109">Azure Resource Manager templates are loaded directly from your source control repository (GitHub or Azure DevOps Services Git).</span><span class="sxs-lookup"><span data-stu-id="b7333-109">Azure Resource Manager templates are loaded directly from your source control repository (GitHub or Azure DevOps Services Git).</span></span>
- <span data-ttu-id="b7333-110">Once configured, your users can create an environment by picking an Azure Resource Manager template from the Azure portal, just as they do with other types of [VM bases](./devtest-lab-comparing-vm-base-image-types.md).</span><span class="sxs-lookup"><span data-stu-id="b7333-110">Once configured, your users can create an environment by picking an Azure Resource Manager template from the Azure portal, just as they do with other types of [VM bases](./devtest-lab-comparing-vm-base-image-types.md).</span></span>
- <span data-ttu-id="b7333-111">Azure PaaS resources can be provisioned in an environment from an Azure Resource Manager template in addition to IaaS VMs.</span><span class="sxs-lookup"><span data-stu-id="b7333-111">Azure PaaS resources can be provisioned in an environment from an Azure Resource Manager template in addition to IaaS VMs.</span></span>
- <span data-ttu-id="b7333-112">The cost of environments can be tracked in the lab in addition to individual VMs created by other types of bases.</span><span class="sxs-lookup"><span data-stu-id="b7333-112">The cost of environments can be tracked in the lab in addition to individual VMs created by other types of bases.</span></span>
- <span data-ttu-id="b7333-113">PaaS resources are created and will appear in cost tracking; however, VM auto shutdown does not apply to PaaS resources.</span><span class="sxs-lookup"><span data-stu-id="b7333-113">PaaS resources are created and will appear in cost tracking; however, VM auto shutdown does not apply to PaaS resources.</span></span>
- <span data-ttu-id="b7333-114">Users have the same VM policy control for environments as they have for single-lab VMs.</span><span class="sxs-lookup"><span data-stu-id="b7333-114">Users have the same VM policy control for environments as they have for single-lab VMs.</span></span>

<span data-ttu-id="b7333-115">Learn more about the many [benefits of using Resource Manager templates](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-overview#the-benefits-of-using-resource-manager) to deploy, update, or delete all of your lab resources in a single operation.</span><span class="sxs-lookup"><span data-stu-id="b7333-115">Learn more about the many [benefits of using Resource Manager templates](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-overview#the-benefits-of-using-resource-manager) to deploy, update, or delete all of your lab resources in a single operation.</span></span>

> [!NOTE]
> <span data-ttu-id="b7333-116">When you use a Resource Manager template as a basis to create more lab VMs, there are some differences to keep in mind whether you are creating Multi-VMs or single-VMs.</span><span class="sxs-lookup"><span data-stu-id="b7333-116">When you use a Resource Manager template as a basis to create more lab VMs, there are some differences to keep in mind whether you are creating Multi-VMs or single-VMs.</span></span> <span data-ttu-id="b7333-117">[Use a virtual machine's Azure Resource Manager template](devtest-lab-use-resource-manager-template.md) explains these differences in greater detail.</span><span class="sxs-lookup"><span data-stu-id="b7333-117">[Use a virtual machine's Azure Resource Manager template](devtest-lab-use-resource-manager-template.md) explains these differences in greater detail.</span></span>
>

## <a name="devtest-labs-public-environments"></a><span data-ttu-id="b7333-118">DevTest Labs public environments</span><span class="sxs-lookup"><span data-stu-id="b7333-118">DevTest Labs public environments</span></span>
<span data-ttu-id="b7333-119">Azure DevTest Labs has a [public repository of Azure Resource Manager templates](https://github.com/Azure/azure-devtestlab/tree/master/Environments) that you can use to create environments without having to connect to an external GitHub source by yourself.</span><span class="sxs-lookup"><span data-stu-id="b7333-119">Azure DevTest Labs has a [public repository of Azure Resource Manager templates](https://github.com/Azure/azure-devtestlab/tree/master/Environments) that you can use to create environments without having to connect to an external GitHub source by yourself.</span></span> <span data-ttu-id="b7333-120">This repository includes frequently used templates such as Azure Web Apps, Service Fabric Cluster, and development SharePoint Farm environment.</span><span class="sxs-lookup"><span data-stu-id="b7333-120">This repository includes frequently used templates such as Azure Web Apps, Service Fabric Cluster, and development SharePoint Farm environment.</span></span> <span data-ttu-id="b7333-121">This feature is similar to the public repository of artifacts that is included for every lab that you create.</span><span class="sxs-lookup"><span data-stu-id="b7333-121">This feature is similar to the public repository of artifacts that is included for every lab that you create.</span></span> <span data-ttu-id="b7333-122">The environment repository allows you to quickly get started with pre-authored environment templates with minimum input parameters to provide you with a smooth getting started experience for PaaS resources within labs.</span><span class="sxs-lookup"><span data-stu-id="b7333-122">The environment repository allows you to quickly get started with pre-authored environment templates with minimum input parameters to provide you with a smooth getting started experience for PaaS resources within labs.</span></span> <span data-ttu-id="b7333-123">For more information, see [Configure and use public environments in DevTest Labs](devtest-lab-configure-use-public-environments.md).</span><span class="sxs-lookup"><span data-stu-id="b7333-123">For more information, see [Configure and use public environments in DevTest Labs](devtest-lab-configure-use-public-environments.md).</span></span>

## <a name="configure-your-own-template-repositories"></a><span data-ttu-id="b7333-124">Configure your own template repositories</span><span class="sxs-lookup"><span data-stu-id="b7333-124">Configure your own template repositories</span></span>
<span data-ttu-id="b7333-125">As one of the best practices with infrastructure-as-code and configuration-as-code, environment templates should be managed in source control.</span><span class="sxs-lookup"><span data-stu-id="b7333-125">As one of the best practices with infrastructure-as-code and configuration-as-code, environment templates should be managed in source control.</span></span> <span data-ttu-id="b7333-126">Azure DevTest Labs follows this practice and loads all Azure Resource Manager templates directly from your GitHub or Azure DevOps Services Git repositories.</span><span class="sxs-lookup"><span data-stu-id="b7333-126">Azure DevTest Labs follows this practice and loads all Azure Resource Manager templates directly from your GitHub or Azure DevOps Services Git repositories.</span></span> <span data-ttu-id="b7333-127">As a result, Resource Manager templates can be used across the entire release cycle, from the test environment to the production environment.</span><span class="sxs-lookup"><span data-stu-id="b7333-127">As a result, Resource Manager templates can be used across the entire release cycle, from the test environment to the production environment.</span></span>

<span data-ttu-id="b7333-128">Check out the templates created by the DevTest Labs team in the [public GitHub repository](https://github.com/Azure/azure-devtestlab/tree/master/Environments).</span><span class="sxs-lookup"><span data-stu-id="b7333-128">Check out the templates created by the DevTest Labs team in the [public GitHub repository](https://github.com/Azure/azure-devtestlab/tree/master/Environments).</span></span> <span data-ttu-id="b7333-129">In this public repository, you can view templates shared by others that you can use directly or customize them to suit your needs.</span><span class="sxs-lookup"><span data-stu-id="b7333-129">In this public repository, you can view templates shared by others that you can use directly or customize them to suit your needs.</span></span> <span data-ttu-id="b7333-130">After you create your template, store it in this repository to share it with others.</span><span class="sxs-lookup"><span data-stu-id="b7333-130">After you create your template, store it in this repository to share it with others.</span></span> <span data-ttu-id="b7333-131">You can also set up your own Git repository with templates that can be used to set up environments in the cloud.</span><span class="sxs-lookup"><span data-stu-id="b7333-131">You can also set up your own Git repository with templates that can be used to set up environments in the cloud.</span></span> 

<span data-ttu-id="b7333-132">There are a couple of rules to follow to organize your Azure Resource Manager templates in a repository:</span><span class="sxs-lookup"><span data-stu-id="b7333-132">There are a couple of rules to follow to organize your Azure Resource Manager templates in a repository:</span></span>

- <span data-ttu-id="b7333-133">The master template file must be named `azuredeploy.json`.</span><span class="sxs-lookup"><span data-stu-id="b7333-133">The master template file must be named `azuredeploy.json`.</span></span> 

    ![Key Azure Resource Manager template files](./media/devtest-lab-create-environment-from-arm/master-template.png)

- <span data-ttu-id="b7333-135">If you want to use parameter values defined in a parameter file, the parameter file must be named `azuredeploy.parameters.json`.</span><span class="sxs-lookup"><span data-stu-id="b7333-135">If you want to use parameter values defined in a parameter file, the parameter file must be named `azuredeploy.parameters.json`.</span></span>
- <span data-ttu-id="b7333-136">You can use the parameters `_artifactsLocation` and `_artifactsLocationSasToken` to construct the parametersLink URI value, allowing DevTest Labs to automatically manage nested templates.</span><span class="sxs-lookup"><span data-stu-id="b7333-136">You can use the parameters `_artifactsLocation` and `_artifactsLocationSasToken` to construct the parametersLink URI value, allowing DevTest Labs to automatically manage nested templates.</span></span> <span data-ttu-id="b7333-137">For more information, see [How Azure DevTest Labs makes nested Resource Manager template deployments easier for testing environments](https://blogs.msdn.microsoft.com/devtestlab/2017/05/23/how-azure-devtest-labs-makes-nested-arm-template-deployments-easier-for-testing-environments/).</span><span class="sxs-lookup"><span data-stu-id="b7333-137">For more information, see [How Azure DevTest Labs makes nested Resource Manager template deployments easier for testing environments](https://blogs.msdn.microsoft.com/devtestlab/2017/05/23/how-azure-devtest-labs-makes-nested-arm-template-deployments-easier-for-testing-environments/).</span></span>
- <span data-ttu-id="b7333-138">Metadata can be defined to specify the template display name and description.</span><span class="sxs-lookup"><span data-stu-id="b7333-138">Metadata can be defined to specify the template display name and description.</span></span> <span data-ttu-id="b7333-139">This metadata must be in a file named `metadata.json`.</span><span class="sxs-lookup"><span data-stu-id="b7333-139">This metadata must be in a file named `metadata.json`.</span></span> <span data-ttu-id="b7333-140">The following example metadata file illustrates how to specify the display name and description:</span><span class="sxs-lookup"><span data-stu-id="b7333-140">The following example metadata file illustrates how to specify the display name and description:</span></span> 

    ```json
    { 
        "itemDisplayName": "<your template name>", 
        "description": "<description of the template>" 
    }
    ```

<span data-ttu-id="b7333-141">The following steps guide you through adding a repository to your lab using the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="b7333-141">The following steps guide you through adding a repository to your lab using the Azure portal.</span></span> 

1. <span data-ttu-id="b7333-142">Sign in to the [Azure portal](http://go.microsoft.com/fwlink/p/?LinkID=525040).</span><span class="sxs-lookup"><span data-stu-id="b7333-142">Sign in to the [Azure portal](http://go.microsoft.com/fwlink/p/?LinkID=525040).</span></span>
1. <span data-ttu-id="b7333-143">Select **All Services**, and then select **DevTest Labs** from the list.</span><span class="sxs-lookup"><span data-stu-id="b7333-143">Select **All Services**, and then select **DevTest Labs** from the list.</span></span>
1. <span data-ttu-id="b7333-144">From the list of labs, select the desired lab.</span><span class="sxs-lookup"><span data-stu-id="b7333-144">From the list of labs, select the desired lab.</span></span>   
1. <span data-ttu-id="b7333-145">On the lab's **Overview** pane, select **Configuration and Policies**.</span><span class="sxs-lookup"><span data-stu-id="b7333-145">On the lab's **Overview** pane, select **Configuration and Policies**.</span></span>

    ![Configuration and policies](./media/devtest-lab-create-environment-from-arm/configuration-and-policies-menu.png)

1. <span data-ttu-id="b7333-147">From the **Configuration and Policies** settings list, select **Repositories**.</span><span class="sxs-lookup"><span data-stu-id="b7333-147">From the **Configuration and Policies** settings list, select **Repositories**.</span></span> <span data-ttu-id="b7333-148">The **Repositories** pane lists the repositories that have been added to the lab.</span><span class="sxs-lookup"><span data-stu-id="b7333-148">The **Repositories** pane lists the repositories that have been added to the lab.</span></span> <span data-ttu-id="b7333-149">A repository named `Public Repo` is automatically generated for all labs, and connects to the [DevTest Labs GitHub repo](https://github.com/Azure/azure-devtestlab) that contains several VM artifacts for your use.</span><span class="sxs-lookup"><span data-stu-id="b7333-149">A repository named `Public Repo` is automatically generated for all labs, and connects to the [DevTest Labs GitHub repo](https://github.com/Azure/azure-devtestlab) that contains several VM artifacts for your use.</span></span>

    ![Public repo](./media/devtest-lab-create-environment-from-arm/public-repo.png)

1. <span data-ttu-id="b7333-151">Select **Add+** to add your Azure Resource Manager template repository.</span><span class="sxs-lookup"><span data-stu-id="b7333-151">Select **Add+** to add your Azure Resource Manager template repository.</span></span>
1. <span data-ttu-id="b7333-152">When the second **Repositories** pane opens, enter the necessary information as follows:</span><span class="sxs-lookup"><span data-stu-id="b7333-152">When the second **Repositories** pane opens, enter the necessary information as follows:</span></span>
    - <span data-ttu-id="b7333-153">**Name** - Enter the repository name that is used in the lab.</span><span class="sxs-lookup"><span data-stu-id="b7333-153">**Name** - Enter the repository name that is used in the lab.</span></span>
    - <span data-ttu-id="b7333-154">**Git clone URL** - Enter the GIT HTTPS clone URL from GitHub or Azure DevOps Services.</span><span class="sxs-lookup"><span data-stu-id="b7333-154">**Git clone URL** - Enter the GIT HTTPS clone URL from GitHub or Azure DevOps Services.</span></span>  
    - <span data-ttu-id="b7333-155">**Branch** - Enter the branch name to access your Azure Resource Manager template definitions.</span><span class="sxs-lookup"><span data-stu-id="b7333-155">**Branch** - Enter the branch name to access your Azure Resource Manager template definitions.</span></span> 
    - <span data-ttu-id="b7333-156">**Personal access token** - The personal access token is used to securely access your repository.</span><span class="sxs-lookup"><span data-stu-id="b7333-156">**Personal access token** - The personal access token is used to securely access your repository.</span></span> <span data-ttu-id="b7333-157">To get your token from Azure DevOps Services, select **&lt;YourName> > My profile > Security > Public access token**.</span><span class="sxs-lookup"><span data-stu-id="b7333-157">To get your token from Azure DevOps Services, select **&lt;YourName> > My profile > Security > Public access token**.</span></span> <span data-ttu-id="b7333-158">To get your token from GitHub, select your avatar followed by selecting **Settings > Public access token**.</span><span class="sxs-lookup"><span data-stu-id="b7333-158">To get your token from GitHub, select your avatar followed by selecting **Settings > Public access token**.</span></span> 
    - <span data-ttu-id="b7333-159">**Folder paths** - Using one of the two input fields, enter the folder path that starts with a forward slash - / - and is relative to your Git clone URI to either your artifact definitions (first input field) or your Azure Resource Manager template definitions.</span><span class="sxs-lookup"><span data-stu-id="b7333-159">**Folder paths** - Using one of the two input fields, enter the folder path that starts with a forward slash - / - and is relative to your Git clone URI to either your artifact definitions (first input field) or your Azure Resource Manager template definitions.</span></span>   
    
        ![Public repo](./media/devtest-lab-create-environment-from-arm/repo-values.png)


1. <span data-ttu-id="b7333-161">Once all the required fields are entered and pass the validation, select **Save**.</span><span class="sxs-lookup"><span data-stu-id="b7333-161">Once all the required fields are entered and pass the validation, select **Save**.</span></span>

<span data-ttu-id="b7333-162">The next section will walk you through creating environments from an Azure Resource Manager template.</span><span class="sxs-lookup"><span data-stu-id="b7333-162">The next section will walk you through creating environments from an Azure Resource Manager template.</span></span>

## <a name="create-an-environment-from-a-resource-manager-template-using-the-azure-portal"></a><span data-ttu-id="b7333-163">Create an environment from a Resource Manager template using the Azure portal</span><span class="sxs-lookup"><span data-stu-id="b7333-163">Create an environment from a Resource Manager template using the Azure portal</span></span>

<span data-ttu-id="b7333-164">Once an Azure Resource Manager template repository has been configured in the lab, your lab users can create an environment using Azure portal with the following steps:</span><span class="sxs-lookup"><span data-stu-id="b7333-164">Once an Azure Resource Manager template repository has been configured in the lab, your lab users can create an environment using Azure portal with the following steps:</span></span>

1. <span data-ttu-id="b7333-165">Sign in to the [Azure portal](http://go.microsoft.com/fwlink/p/?LinkID=525040).</span><span class="sxs-lookup"><span data-stu-id="b7333-165">Sign in to the [Azure portal](http://go.microsoft.com/fwlink/p/?LinkID=525040).</span></span>
1. <span data-ttu-id="b7333-166">Select **All Services**, and then select **DevTest Labs** from the list.</span><span class="sxs-lookup"><span data-stu-id="b7333-166">Select **All Services**, and then select **DevTest Labs** from the list.</span></span>
1. <span data-ttu-id="b7333-167">From the list of labs, select the desired lab.</span><span class="sxs-lookup"><span data-stu-id="b7333-167">From the list of labs, select the desired lab.</span></span>   
1. <span data-ttu-id="b7333-168">On the lab's pane, select **Add+**.</span><span class="sxs-lookup"><span data-stu-id="b7333-168">On the lab's pane, select **Add+**.</span></span>
1. <span data-ttu-id="b7333-169">The **Choose a base** pane displays the base images you can use with the Azure Resource Manager templates listed first.</span><span class="sxs-lookup"><span data-stu-id="b7333-169">The **Choose a base** pane displays the base images you can use with the Azure Resource Manager templates listed first.</span></span> <span data-ttu-id="b7333-170">Select the desired Azure Resource Manager template.</span><span class="sxs-lookup"><span data-stu-id="b7333-170">Select the desired Azure Resource Manager template.</span></span>

    ![Choose a base](./media/devtest-lab-create-environment-from-arm/choose-a-base.png)
  
1. <span data-ttu-id="b7333-172">On the **Add** pane, enter the **Environment name** value.</span><span class="sxs-lookup"><span data-stu-id="b7333-172">On the **Add** pane, enter the **Environment name** value.</span></span> <span data-ttu-id="b7333-173">The environment name is what is displayed to your users in the lab.</span><span class="sxs-lookup"><span data-stu-id="b7333-173">The environment name is what is displayed to your users in the lab.</span></span> <span data-ttu-id="b7333-174">The remaining input fields are defined in the Azure Resource Manager template.</span><span class="sxs-lookup"><span data-stu-id="b7333-174">The remaining input fields are defined in the Azure Resource Manager template.</span></span> <span data-ttu-id="b7333-175">If default values are defined in the template or the `azuredeploy.parameter.json` file is present, default values are displayed in those input fields.</span><span class="sxs-lookup"><span data-stu-id="b7333-175">If default values are defined in the template or the `azuredeploy.parameter.json` file is present, default values are displayed in those input fields.</span></span> <span data-ttu-id="b7333-176">For parameters of type *secure string*, you can use the secrets stored in your Azure key vault.</span><span class="sxs-lookup"><span data-stu-id="b7333-176">For parameters of type *secure string*, you can use the secrets stored in your Azure key vault.</span></span> <span data-ttu-id="b7333-177">To learn about saving secrets in a key vault and using them when creating lab resources, see [Store secrets in Azure Key Vault](devtest-lab-store-secrets-in-key-vault.md).</span><span class="sxs-lookup"><span data-stu-id="b7333-177">To learn about saving secrets in a key vault and using them when creating lab resources, see [Store secrets in Azure Key Vault](devtest-lab-store-secrets-in-key-vault.md).</span></span>  

    ![Add pane](./media/devtest-lab-create-environment-from-arm/add.png)

    > [!NOTE]
    > <span data-ttu-id="b7333-179">There are several parameter values that - even if specified - are displayed as empty values.</span><span class="sxs-lookup"><span data-stu-id="b7333-179">There are several parameter values that - even if specified - are displayed as empty values.</span></span> <span data-ttu-id="b7333-180">Therefore, if users assign those values to parameters in an Azure Resource Manager template, DevTest Labs does not display the values.</span><span class="sxs-lookup"><span data-stu-id="b7333-180">Therefore, if users assign those values to parameters in an Azure Resource Manager template, DevTest Labs does not display the values.</span></span> <span data-ttu-id="b7333-181">Instead, blank input fields are shown where lab users must enter a value when creating the environment.</span><span class="sxs-lookup"><span data-stu-id="b7333-181">Instead, blank input fields are shown where lab users must enter a value when creating the environment.</span></span>
    > 
    > - <span data-ttu-id="b7333-182">GEN-UNIQUE</span><span class="sxs-lookup"><span data-stu-id="b7333-182">GEN-UNIQUE</span></span>
    > - <span data-ttu-id="b7333-183">GEN-UNIQUE-[N]</span><span class="sxs-lookup"><span data-stu-id="b7333-183">GEN-UNIQUE-[N]</span></span>
    > - <span data-ttu-id="b7333-184">GEN-SSH-PUB-KEY</span><span class="sxs-lookup"><span data-stu-id="b7333-184">GEN-SSH-PUB-KEY</span></span>
    > - <span data-ttu-id="b7333-185">GEN-PASSWORD</span><span class="sxs-lookup"><span data-stu-id="b7333-185">GEN-PASSWORD</span></span> 
 
1. <span data-ttu-id="b7333-186">Select **Add** to create the environment.</span><span class="sxs-lookup"><span data-stu-id="b7333-186">Select **Add** to create the environment.</span></span> <span data-ttu-id="b7333-187">The environment starts provisioning immediately with the status displaying in the **My virtual machines** list.</span><span class="sxs-lookup"><span data-stu-id="b7333-187">The environment starts provisioning immediately with the status displaying in the **My virtual machines** list.</span></span> <span data-ttu-id="b7333-188">A new resource group is automatically created by the lab to provision all the resources defined in the Azure Resource Manager template.</span><span class="sxs-lookup"><span data-stu-id="b7333-188">A new resource group is automatically created by the lab to provision all the resources defined in the Azure Resource Manager template.</span></span>
1. <span data-ttu-id="b7333-189">Once the environment is created, select the environment in the **My virtual machines** list to open the resource group pane and browse all of the resources provisioned in the environment.</span><span class="sxs-lookup"><span data-stu-id="b7333-189">Once the environment is created, select the environment in the **My virtual machines** list to open the resource group pane and browse all of the resources provisioned in the environment.</span></span>
    
    ![My virtual machines list](./media/devtest-lab-create-environment-from-arm/all-environment-resources.png)
   
   <span data-ttu-id="b7333-191">You can also expand the environment to view just the list of VMs that are provisioned in the environment.</span><span class="sxs-lookup"><span data-stu-id="b7333-191">You can also expand the environment to view just the list of VMs that are provisioned in the environment.</span></span>
    
    ![My virtual machines list](./media/devtest-lab-create-environment-from-arm/my-vm-list.png)

1. <span data-ttu-id="b7333-193">Click any of the environments to view the available actions - such as applying artifacts, attaching data disks, changing auto-shutdown time, and more.</span><span class="sxs-lookup"><span data-stu-id="b7333-193">Click any of the environments to view the available actions - such as applying artifacts, attaching data disks, changing auto-shutdown time, and more.</span></span>

    ![Environment actions](./media/devtest-lab-create-environment-from-arm/environment-actions.png)

## <a name="deploy-a-resource-manager-template-to-create-a-vm"></a><span data-ttu-id="b7333-195">Deploy a Resource Manager template to create a VM</span><span class="sxs-lookup"><span data-stu-id="b7333-195">Deploy a Resource Manager template to create a VM</span></span>
<span data-ttu-id="b7333-196">After you have saved a Resource Manager template and customized it for your needs, you can use it to automate VM creation.</span><span class="sxs-lookup"><span data-stu-id="b7333-196">After you have saved a Resource Manager template and customized it for your needs, you can use it to automate VM creation.</span></span> 
- <span data-ttu-id="b7333-197">[Deploy resources with Resource Manager templates and Azure PowerShell](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-template-deploy) describes how to use Azure PowerShell with Resource Manager templates to deploy your resources to Azure.</span><span class="sxs-lookup"><span data-stu-id="b7333-197">[Deploy resources with Resource Manager templates and Azure PowerShell](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-template-deploy) describes how to use Azure PowerShell with Resource Manager templates to deploy your resources to Azure.</span></span> 
- <span data-ttu-id="b7333-198">[Deploy resources with Resource Manager templates and Azure CLI](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-template-deploy-cli) describes how to use Azure CLI with Resource Manager templates to deploy your resources to Azure.</span><span class="sxs-lookup"><span data-stu-id="b7333-198">[Deploy resources with Resource Manager templates and Azure CLI](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-template-deploy-cli) describes how to use Azure CLI with Resource Manager templates to deploy your resources to Azure.</span></span>

> [!NOTE]
> <span data-ttu-id="b7333-199">Only a user with lab owner permissions can create VMs from a Resource Manager template by using Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b7333-199">Only a user with lab owner permissions can create VMs from a Resource Manager template by using Azure PowerShell.</span></span> <span data-ttu-id="b7333-200">If you want to automate VM creation using a Resource Manager template and you only have user permissions, you can use the [**az lab vm create** command in the CLI](https://docs.microsoft.com/cli/azure/lab/vm#az-lab-vm-create).</span><span class="sxs-lookup"><span data-stu-id="b7333-200">If you want to automate VM creation using a Resource Manager template and you only have user permissions, you can use the [**az lab vm create** command in the CLI](https://docs.microsoft.com/cli/azure/lab/vm#az-lab-vm-create).</span></span>

### <a name="general-limitations"></a><span data-ttu-id="b7333-201">General limitations</span><span class="sxs-lookup"><span data-stu-id="b7333-201">General limitations</span></span> 

<span data-ttu-id="b7333-202">Consider these limitations when using a Resource Manager template in DevTest Labs:</span><span class="sxs-lookup"><span data-stu-id="b7333-202">Consider these limitations when using a Resource Manager template in DevTest Labs:</span></span>

- <span data-ttu-id="b7333-203">Any Resource Manager template you create cannot refer to existing resources; it can only refer to new resources.</span><span class="sxs-lookup"><span data-stu-id="b7333-203">Any Resource Manager template you create cannot refer to existing resources; it can only refer to new resources.</span></span> <span data-ttu-id="b7333-204">In addition, if you have an existing Resource Manager template that you typically deploy outside of DevTest Labs and it contains references to existing resources, it can't be used in the lab.</span><span class="sxs-lookup"><span data-stu-id="b7333-204">In addition, if you have an existing Resource Manager template that you typically deploy outside of DevTest Labs and it contains references to existing resources, it can't be used in the lab.</span></span>

   <span data-ttu-id="b7333-205">The only exception to this is that you **can** reference an existing virtual network.</span><span class="sxs-lookup"><span data-stu-id="b7333-205">The only exception to this is that you **can** reference an existing virtual network.</span></span> 

- <span data-ttu-id="b7333-206">Formulas can't be created from lab VMs that were created from a Resource Manager template.</span><span class="sxs-lookup"><span data-stu-id="b7333-206">Formulas can't be created from lab VMs that were created from a Resource Manager template.</span></span> 

- <span data-ttu-id="b7333-207">Custom images can't be created from lab VMs that were created from a Resource Manager template.</span><span class="sxs-lookup"><span data-stu-id="b7333-207">Custom images can't be created from lab VMs that were created from a Resource Manager template.</span></span> 

- <span data-ttu-id="b7333-208">Most policies are not evaluated when you deploy Resource Manager templates.</span><span class="sxs-lookup"><span data-stu-id="b7333-208">Most policies are not evaluated when you deploy Resource Manager templates.</span></span>

   <span data-ttu-id="b7333-209">For example, you might have a lab policy specifying that a user can only create five VMs.</span><span class="sxs-lookup"><span data-stu-id="b7333-209">For example, you might have a lab policy specifying that a user can only create five VMs.</span></span> <span data-ttu-id="b7333-210">However, a user can deploy a Resource Manager template that creates dozens of VMs.</span><span class="sxs-lookup"><span data-stu-id="b7333-210">However, a user can deploy a Resource Manager template that creates dozens of VMs.</span></span> <span data-ttu-id="b7333-211">Policies that are not evaluated include:</span><span class="sxs-lookup"><span data-stu-id="b7333-211">Policies that are not evaluated include:</span></span>

   - <span data-ttu-id="b7333-212">Number of VMs per user</span><span class="sxs-lookup"><span data-stu-id="b7333-212">Number of VMs per user</span></span>
   - <span data-ttu-id="b7333-213">Number of premium VMs per lab user</span><span class="sxs-lookup"><span data-stu-id="b7333-213">Number of premium VMs per lab user</span></span>
   - <span data-ttu-id="b7333-214">Number of premium disks per lab user</span><span class="sxs-lookup"><span data-stu-id="b7333-214">Number of premium disks per lab user</span></span>


### <a name="configure-environment-resource-group-access-rights-for-lab-users"></a><span data-ttu-id="b7333-215">Configure environment resource group access rights for lab users</span><span class="sxs-lookup"><span data-stu-id="b7333-215">Configure environment resource group access rights for lab users</span></span>

<span data-ttu-id="b7333-216">Lab users can deploy a Resource Manager template.</span><span class="sxs-lookup"><span data-stu-id="b7333-216">Lab users can deploy a Resource Manager template.</span></span> <span data-ttu-id="b7333-217">But by default, they have Reader access rights, which means they can’t change the resources in an environment resource group.</span><span class="sxs-lookup"><span data-stu-id="b7333-217">But by default, they have Reader access rights, which means they can’t change the resources in an environment resource group.</span></span> <span data-ttu-id="b7333-218">For example, they cannot stop or start their resources.</span><span class="sxs-lookup"><span data-stu-id="b7333-218">For example, they cannot stop or start their resources.</span></span>

<span data-ttu-id="b7333-219">Follow these steps to give your lab users Contributor access rights.</span><span class="sxs-lookup"><span data-stu-id="b7333-219">Follow these steps to give your lab users Contributor access rights.</span></span> <span data-ttu-id="b7333-220">Then, when they deploy a Resource Manager template, they will be able to edit the resources in that environment.</span><span class="sxs-lookup"><span data-stu-id="b7333-220">Then, when they deploy a Resource Manager template, they will be able to edit the resources in that environment.</span></span> 


1. <span data-ttu-id="b7333-221">On your lab's **Overview** pane, select **Configuration and policies**.</span><span class="sxs-lookup"><span data-stu-id="b7333-221">On your lab's **Overview** pane, select **Configuration and policies**.</span></span>
1. <span data-ttu-id="b7333-222">Select **Lab settings**.</span><span class="sxs-lookup"><span data-stu-id="b7333-222">Select **Lab settings**.</span></span>
1. <span data-ttu-id="b7333-223">In the Lab Settings pane, select **Contributor** to grant write permissions to lab users.</span><span class="sxs-lookup"><span data-stu-id="b7333-223">In the Lab Settings pane, select **Contributor** to grant write permissions to lab users.</span></span>

    ![Configure lab user access rights](./media/devtest-lab-create-environment-from-arm/configure-access-rights.png)

1. <span data-ttu-id="b7333-225">Select **Save**.</span><span class="sxs-lookup"><span data-stu-id="b7333-225">Select **Save**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b7333-226">Next steps</span><span class="sxs-lookup"><span data-stu-id="b7333-226">Next steps</span></span>
* <span data-ttu-id="b7333-227">Once a VM has been created, you can connect to the VM by selecting **Connect** on the VM's management pane.</span><span class="sxs-lookup"><span data-stu-id="b7333-227">Once a VM has been created, you can connect to the VM by selecting **Connect** on the VM's management pane.</span></span>
* <span data-ttu-id="b7333-228">View and manage resources in an environment by selecting the environment in the **My virtual machines** list in your lab.</span><span class="sxs-lookup"><span data-stu-id="b7333-228">View and manage resources in an environment by selecting the environment in the **My virtual machines** list in your lab.</span></span> 
* <span data-ttu-id="b7333-229">Explore the [Azure Resource Manager templates from Azure Quickstart template gallery](https://github.com/Azure/azure-quickstart-templates).</span><span class="sxs-lookup"><span data-stu-id="b7333-229">Explore the [Azure Resource Manager templates from Azure Quickstart template gallery](https://github.com/Azure/azure-quickstart-templates).</span></span>
