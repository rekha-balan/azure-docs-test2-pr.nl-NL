---
title: Failback in Azure Site Recovery for Hyper-v virtual machines | Microsoft Docs
description: Azure Site Recovery coordinates the replication, failover and recovery of virtual machines and physical servers. Learn about failback from Azure to on-premises datacenter.
services: site-recovery
documentationcenter: ''
author: ruturaj
manager: gauravd
editor: ''
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 3/31/2017
ms.author: ruturajd
ms.openlocfilehash: 8746abc957816f103abe6c33308af2a584e35485
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44550382"
---
# <a name="failback-in-site-recovery-for-hyper-v-virtual-machines"></a><span data-ttu-id="38175-104">Failback in Site Recovery for Hyper-V virtual machines</span><span class="sxs-lookup"><span data-stu-id="38175-104">Failback in Site Recovery for Hyper-V virtual machines</span></span>

> [!div class="op_single_selector"]
> * [VMware/physical machines from Azure](site-recovery-failback-azure-to-vmware.md)
> * [Hyper-V VMs from Azure](site-recovery-failback-from-azure-to-hyper-v.md)

<span data-ttu-id="38175-107">This article describes how to failback virtual machines protected by Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="38175-107">This article describes how to failback virtual machines protected by Site Recovery.</span></span> 

## <a name="prerequisites"></a><span data-ttu-id="38175-108">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="38175-108">Prerequisites</span></span>
1. <span data-ttu-id="38175-109">Ensure that the primary site VMM server/Hyper-V server is connected.</span><span class="sxs-lookup"><span data-stu-id="38175-109">Ensure that the primary site VMM server/Hyper-V server is connected.</span></span>
2. <span data-ttu-id="38175-110">You should have performed **Commit** on the virtual machine.</span><span class="sxs-lookup"><span data-stu-id="38175-110">You should have performed **Commit** on the virtual machine.</span></span>

## <a name="why-is-there-no-button-called-failback"></a><span data-ttu-id="38175-111">Why is there no button called failback?</span><span class="sxs-lookup"><span data-stu-id="38175-111">Why is there no button called failback?</span></span>
<span data-ttu-id="38175-112">On the portal, there is no explicit gesture called failback.</span><span class="sxs-lookup"><span data-stu-id="38175-112">On the portal, there is no explicit gesture called failback.</span></span> <span data-ttu-id="38175-113">Failback is a step where you come back to the primary site.</span><span class="sxs-lookup"><span data-stu-id="38175-113">Failback is a step where you come back to the primary site.</span></span> <span data-ttu-id="38175-114">By definition, failover is when you failover the virtual machines from primary(on-premises) site to recovery (Azure), and failback is when you failover the virtual machines from recovery back to primary.</span><span class="sxs-lookup"><span data-stu-id="38175-114">By definition, failover is when you failover the virtual machines from primary(on-premises) site to recovery (Azure), and failback is when you failover the virtual machines from recovery back to primary.</span></span>

<span data-ttu-id="38175-115">When you initiate a failover, the blade informs you about the direction of the job.</span><span class="sxs-lookup"><span data-stu-id="38175-115">When you initiate a failover, the blade informs you about the direction of the job.</span></span> <span data-ttu-id="38175-116">If the direction is from Azure to On-premises, it is a failback.</span><span class="sxs-lookup"><span data-stu-id="38175-116">If the direction is from Azure to On-premises, it is a failback.</span></span>

## <a name="why-is-there-only-a-planned-failover-gesture-to-failback"></a><span data-ttu-id="38175-117">Why is there only a planned failover gesture to failback?</span><span class="sxs-lookup"><span data-stu-id="38175-117">Why is there only a planned failover gesture to failback?</span></span>
<span data-ttu-id="38175-118">Azure is a highly available environment and your virtual machines will be always available.</span><span class="sxs-lookup"><span data-stu-id="38175-118">Azure is a highly available environment and your virtual machines will be always available.</span></span> <span data-ttu-id="38175-119">Failback is a planned activity where you decide to take a small downtime so that the workloads can start running on-premises again.</span><span class="sxs-lookup"><span data-stu-id="38175-119">Failback is a planned activity where you decide to take a small downtime so that the workloads can start running on-premises again.</span></span> <span data-ttu-id="38175-120">This expects no data loss.</span><span class="sxs-lookup"><span data-stu-id="38175-120">This expects no data loss.</span></span> <span data-ttu-id="38175-121">Hence only a planned failover gesture is available, that will turn off the VMs in Azure, download the latest changes and ensure there is no data loss.</span><span class="sxs-lookup"><span data-stu-id="38175-121">Hence only a planned failover gesture is available, that will turn off the VMs in Azure, download the latest changes and ensure there is no data loss.</span></span>

## <a name="initiate-failback"></a><span data-ttu-id="38175-122">Initiate failback</span><span class="sxs-lookup"><span data-stu-id="38175-122">Initiate failback</span></span>
<span data-ttu-id="38175-123">After failover from the primary to secondary location, replicated virtual machines aren't protected by Site Recovery, and the secondary location is now acting as the active location.</span><span class="sxs-lookup"><span data-stu-id="38175-123">After failover from the primary to secondary location, replicated virtual machines aren't protected by Site Recovery, and the secondary location is now acting as the active location.</span></span> <span data-ttu-id="38175-124">Follow these procedures to fail back to the original primary site.</span><span class="sxs-lookup"><span data-stu-id="38175-124">Follow these procedures to fail back to the original primary site.</span></span> <span data-ttu-id="38175-125">This procedure describes how to run a planned failover for a recovery plan.</span><span class="sxs-lookup"><span data-stu-id="38175-125">This procedure describes how to run a planned failover for a recovery plan.</span></span> <span data-ttu-id="38175-126">Alternatively you can run the failover for a single virtual machine on the **Virtual Machines** tab.</span><span class="sxs-lookup"><span data-stu-id="38175-126">Alternatively you can run the failover for a single virtual machine on the **Virtual Machines** tab.</span></span>

1. <span data-ttu-id="38175-127">Select **Recovery Plans** > *recoveryplan_name*.</span><span class="sxs-lookup"><span data-stu-id="38175-127">Select **Recovery Plans** > *recoveryplan_name*.</span></span> <span data-ttu-id="38175-128">Click **Failover** > **Planned Failover**.</span><span class="sxs-lookup"><span data-stu-id="38175-128">Click **Failover** > **Planned Failover**.</span></span>
2. <span data-ttu-id="38175-129">On the \*\*Confirm Planned Failover \*\*page, choose the source and target locations.</span><span class="sxs-lookup"><span data-stu-id="38175-129">On the \*\*Confirm Planned Failover \*\*page, choose the source and target locations.</span></span> <span data-ttu-id="38175-130">Note the failover direction.</span><span class="sxs-lookup"><span data-stu-id="38175-130">Note the failover direction.</span></span> <span data-ttu-id="38175-131">If the failover from primary worked as expect and all virtual machines are in the secondary location this is for information only.</span><span class="sxs-lookup"><span data-stu-id="38175-131">If the failover from primary worked as expect and all virtual machines are in the secondary location this is for information only.</span></span>
3. <span data-ttu-id="38175-132">If you're failing back from Azure select settings in **Data Synchronization**:</span><span class="sxs-lookup"><span data-stu-id="38175-132">If you're failing back from Azure select settings in **Data Synchronization**:</span></span>

   * <span data-ttu-id="38175-133">**Synchronize data before failover(Synchronize delta changes only)**—This option minimizes downtime for virtual machines as it synchronizes without shutting them down.</span><span class="sxs-lookup"><span data-stu-id="38175-133">**Synchronize data before failover(Synchronize delta changes only)**—This option minimizes downtime for virtual machines as it synchronizes without shutting them down.</span></span> <span data-ttu-id="38175-134">It does the following:</span><span class="sxs-lookup"><span data-stu-id="38175-134">It does the following:</span></span>
     * <span data-ttu-id="38175-135">Phase 1: Takes snapshot of the virtual machine in Azure and copies it to the on-premises Hyper-V host.</span><span class="sxs-lookup"><span data-stu-id="38175-135">Phase 1: Takes snapshot of the virtual machine in Azure and copies it to the on-premises Hyper-V host.</span></span> <span data-ttu-id="38175-136">The machine continues running in Azure.</span><span class="sxs-lookup"><span data-stu-id="38175-136">The machine continues running in Azure.</span></span>
     * <span data-ttu-id="38175-137">Phase 2: Shuts down the virtual machine in Azure so that no new changes occur there.</span><span class="sxs-lookup"><span data-stu-id="38175-137">Phase 2: Shuts down the virtual machine in Azure so that no new changes occur there.</span></span> <span data-ttu-id="38175-138">The final set of delta changes are transferred to the on-premises server and the on-premises virtual machine is started up.</span><span class="sxs-lookup"><span data-stu-id="38175-138">The final set of delta changes are transferred to the on-premises server and the on-premises virtual machine is started up.</span></span>

    - <span data-ttu-id="38175-139">**Synchronize data during failover only(full download)**—Use this option if you've been running on Azure for a long time.</span><span class="sxs-lookup"><span data-stu-id="38175-139">**Synchronize data during failover only(full download)**—Use this option if you've been running on Azure for a long time.</span></span> <span data-ttu-id="38175-140">This option is faster because we expect that most of the disk has changed and we don't want to spend time in checksum calculation.</span><span class="sxs-lookup"><span data-stu-id="38175-140">This option is faster because we expect that most of the disk has changed and we don't want to spend time in checksum calculation.</span></span> <span data-ttu-id="38175-141">It performs a download of the disk.</span><span class="sxs-lookup"><span data-stu-id="38175-141">It performs a download of the disk.</span></span> <span data-ttu-id="38175-142">It is also useful when the on-prem virtual machine has been deleted.</span><span class="sxs-lookup"><span data-stu-id="38175-142">It is also useful when the on-prem virtual machine has been deleted.</span></span>

    >[!NOTE] 
    >We recommend you use this option if you've been running Azure for a while (a month or more) or the on-prem virtual machine has been deleted.This option doesn't perform any checksum calculations.
    >
    >




4. <span data-ttu-id="38175-144">If data encryption is enabled for the cloud, in **Encryption Key** select the certificate that was issued when you enabled data encryption during Provider installation on the VMM server.</span><span class="sxs-lookup"><span data-stu-id="38175-144">If data encryption is enabled for the cloud, in **Encryption Key** select the certificate that was issued when you enabled data encryption during Provider installation on the VMM server.</span></span>
5. <span data-ttu-id="38175-145">Initiate the failover.</span><span class="sxs-lookup"><span data-stu-id="38175-145">Initiate the failover.</span></span> <span data-ttu-id="38175-146">You can follow the failover progress on the **Jobs** tab.</span><span class="sxs-lookup"><span data-stu-id="38175-146">You can follow the failover progress on the **Jobs** tab.</span></span>
6. <span data-ttu-id="38175-147">If you selected the option to synchronize the data before the failover, once the initial data synchronization is complete and you're ready to shut down the virtual machines in Azure, click **Jobs** planned failover job name **Complete Failover**.</span><span class="sxs-lookup"><span data-stu-id="38175-147">If you selected the option to synchronize the data before the failover, once the initial data synchronization is complete and you're ready to shut down the virtual machines in Azure, click **Jobs** planned failover job name **Complete Failover**.</span></span> <span data-ttu-id="38175-148">This shuts down the Azure machine, transfers the latest changes to the on-premises virtual machine, and starts the VM on-premises.</span><span class="sxs-lookup"><span data-stu-id="38175-148">This shuts down the Azure machine, transfers the latest changes to the on-premises virtual machine, and starts the VM on-premises.</span></span>
7. <span data-ttu-id="38175-149">You can now log onto the virtual machine to validate it's available as expected.</span><span class="sxs-lookup"><span data-stu-id="38175-149">You can now log onto the virtual machine to validate it's available as expected.</span></span>
8. <span data-ttu-id="38175-150">The virtual machine is in a commit pending state.</span><span class="sxs-lookup"><span data-stu-id="38175-150">The virtual machine is in a commit pending state.</span></span> <span data-ttu-id="38175-151">Click **Commit** to commit the failover.</span><span class="sxs-lookup"><span data-stu-id="38175-151">Click **Commit** to commit the failover.</span></span>
9. <span data-ttu-id="38175-152">Now in order to complete the failback click **Reverse Replicate** to start protecting the virtual machine in the primary site.</span><span class="sxs-lookup"><span data-stu-id="38175-152">Now in order to complete the failback click **Reverse Replicate** to start protecting the virtual machine in the primary site.</span></span>

## <a name="failback-to-an-alternate-location"></a><span data-ttu-id="38175-153">Failback to an alternate location</span><span class="sxs-lookup"><span data-stu-id="38175-153">Failback to an alternate location</span></span>
<span data-ttu-id="38175-154">If you've deployed protection between a [Hyper-V site and Azure](site-recovery-hyper-v-site-to-azure.md) you have to ability to failback from Azure to an alternate on-premises location.</span><span class="sxs-lookup"><span data-stu-id="38175-154">If you've deployed protection between a [Hyper-V site and Azure](site-recovery-hyper-v-site-to-azure.md) you have to ability to failback from Azure to an alternate on-premises location.</span></span> <span data-ttu-id="38175-155">This is useful if you need to set up new on-premises hardware.</span><span class="sxs-lookup"><span data-stu-id="38175-155">This is useful if you need to set up new on-premises hardware.</span></span> <span data-ttu-id="38175-156">Here's how you do it.</span><span class="sxs-lookup"><span data-stu-id="38175-156">Here's how you do it.</span></span>

1. <span data-ttu-id="38175-157">If you're setting up new hardware install Windows Server 2012 R2 and the Hyper-V role on the server.</span><span class="sxs-lookup"><span data-stu-id="38175-157">If you're setting up new hardware install Windows Server 2012 R2 and the Hyper-V role on the server.</span></span>
2. <span data-ttu-id="38175-158">Create a virtual network switch with the same name that you had on the original server.</span><span class="sxs-lookup"><span data-stu-id="38175-158">Create a virtual network switch with the same name that you had on the original server.</span></span>
3. <span data-ttu-id="38175-159">Select **Protected Items** -> **Protection Group** -> <ProtectionGroupName> -> <VirtualMachineName> you want to fail back, and select **Planned Failover**.</span><span class="sxs-lookup"><span data-stu-id="38175-159">Select **Protected Items** -> **Protection Group** -> <ProtectionGroupName> -> <VirtualMachineName> you want to fail back, and select **Planned Failover**.</span></span>
4. <span data-ttu-id="38175-160">In **Confirm Planned Failover** select **Create on-premises virtual machine if it does not exist**.</span><span class="sxs-lookup"><span data-stu-id="38175-160">In **Confirm Planned Failover** select **Create on-premises virtual machine if it does not exist**.</span></span>
5. <span data-ttu-id="38175-161">In **Host Name** select the new Hyper-V host server on which you want to place the virtual machine.</span><span class="sxs-lookup"><span data-stu-id="38175-161">In **Host Name** select the new Hyper-V host server on which you want to place the virtual machine.</span></span>
6. <span data-ttu-id="38175-162">In Data Synchronization we recommend you select  the option **Synchronize the data before the failover**.</span><span class="sxs-lookup"><span data-stu-id="38175-162">In Data Synchronization we recommend you select  the option **Synchronize the data before the failover**.</span></span> <span data-ttu-id="38175-163">This minimizes downtime for virtual machines as it synchronizes without shutting them down.</span><span class="sxs-lookup"><span data-stu-id="38175-163">This minimizes downtime for virtual machines as it synchronizes without shutting them down.</span></span> <span data-ttu-id="38175-164">It does the following:</span><span class="sxs-lookup"><span data-stu-id="38175-164">It does the following:</span></span>

   * <span data-ttu-id="38175-165">Phase 1: Takes snapshot of the virtual machine in Azure and copies it to the on-premises Hyper-V host.</span><span class="sxs-lookup"><span data-stu-id="38175-165">Phase 1: Takes snapshot of the virtual machine in Azure and copies it to the on-premises Hyper-V host.</span></span> <span data-ttu-id="38175-166">The machine continues running in Azure.</span><span class="sxs-lookup"><span data-stu-id="38175-166">The machine continues running in Azure.</span></span>
   * <span data-ttu-id="38175-167">Phase 2: Shuts down the virtual machine in Azure so that no new changes occur there.</span><span class="sxs-lookup"><span data-stu-id="38175-167">Phase 2: Shuts down the virtual machine in Azure so that no new changes occur there.</span></span> <span data-ttu-id="38175-168">The final set of changes are transferred to the on-premises server and the on-premises virtual machine is started up.</span><span class="sxs-lookup"><span data-stu-id="38175-168">The final set of changes are transferred to the on-premises server and the on-premises virtual machine is started up.</span></span>
7. <span data-ttu-id="38175-169">Click the checkmark to begin the failover (failback).</span><span class="sxs-lookup"><span data-stu-id="38175-169">Click the checkmark to begin the failover (failback).</span></span>
8. <span data-ttu-id="38175-170">After the initial synchronization finishes and you're ready to shut down the virtual machine in Azure, click **Jobs** > <planned failover job> > **Complete Failover**.</span><span class="sxs-lookup"><span data-stu-id="38175-170">After the initial synchronization finishes and you're ready to shut down the virtual machine in Azure, click **Jobs** > <planned failover job> > **Complete Failover**.</span></span> <span data-ttu-id="38175-171">This shuts down the Azure machine, transfers the latest changes to the on-premises virtual machine and starts it.</span><span class="sxs-lookup"><span data-stu-id="38175-171">This shuts down the Azure machine, transfers the latest changes to the on-premises virtual machine and starts it.</span></span>
9. <span data-ttu-id="38175-172">You can log onto the on-premises virtual machine to verify everything is working as expected.</span><span class="sxs-lookup"><span data-stu-id="38175-172">You can log onto the on-premises virtual machine to verify everything is working as expected.</span></span> <span data-ttu-id="38175-173">Then click **Commit** to finish the failover.</span><span class="sxs-lookup"><span data-stu-id="38175-173">Then click **Commit** to finish the failover.</span></span>
10. <span data-ttu-id="38175-174">Click **Reverse Replicate** to start protecting the on-premises virtual machine.</span><span class="sxs-lookup"><span data-stu-id="38175-174">Click **Reverse Replicate** to start protecting the on-premises virtual machine.</span></span>

    > [!NOTE]
    > If you cancel the failback job while it is in Data Synchronization step, the on-premises VM will be in a corrupted state. This is because Data Synchronization copies the latest data from Azure VM disks to the on-prem data disks, and until the synchronization completes, the disk data may not be in a consistent state. If the On-prem VM is booted after Data Synchronization is canceled, it may not boot. Re-trigger failover to complete the Data Synchronization.
    >
    >



## <a name="next-steps"></a><span data-ttu-id="38175-179">Next Steps</span><span class="sxs-lookup"><span data-stu-id="38175-179">Next Steps</span></span>

<span data-ttu-id="38175-180">Once you have completed the failback job, **Commit** the virtual machine.</span><span class="sxs-lookup"><span data-stu-id="38175-180">Once you have completed the failback job, **Commit** the virtual machine.</span></span> <span data-ttu-id="38175-181">Commit deletes the Azure virtual machine and its disks and prepares the VM to be protected again.</span><span class="sxs-lookup"><span data-stu-id="38175-181">Commit deletes the Azure virtual machine and its disks and prepares the VM to be protected again.</span></span>

<span data-ttu-id="38175-182">After **Commit**, you can initiate the *Reverse Replicate*.</span><span class="sxs-lookup"><span data-stu-id="38175-182">After **Commit**, you can initiate the *Reverse Replicate*.</span></span> <span data-ttu-id="38175-183">This will start protecting the virtual machine from on-premises back to Azure.</span><span class="sxs-lookup"><span data-stu-id="38175-183">This will start protecting the virtual machine from on-premises back to Azure.</span></span> <span data-ttu-id="38175-184">Note that this will only replicate the changes since the VM has been turned off in Azure and hence sends differential changes only.</span><span class="sxs-lookup"><span data-stu-id="38175-184">Note that this will only replicate the changes since the VM has been turned off in Azure and hence sends differential changes only.</span></span>


