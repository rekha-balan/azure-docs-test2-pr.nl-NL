---
title: Replicate applications with SQL Server and Azure Site Recovery | Microsoft Docs
description: This article describes how to replicate SQL Server using Azure Site Recovery for SQL Server disaster capabilities.
services: site-recovery
author: rayne-wiselman
ms.service: site-recovery
ms.topic: conceptual
ms.date: 07/22/2018
ms.author: raynew
ms.openlocfilehash: a734999f0fa473b5f1ee8ed55c4b73950566490d
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44808657"
---
# <a name="protect-sql-server-using-sql-server-disaster-recovery-and-azure-site-recovery"></a><span data-ttu-id="0b153-103">Protect SQL Server using SQL Server disaster recovery and Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="0b153-103">Protect SQL Server using SQL Server disaster recovery and Azure Site Recovery</span></span>

<span data-ttu-id="0b153-104">This article describes how to protect the SQL Server back end of an application using a combination of SQL Server business continuity and disaster recovery (BCDR) technologies, and [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="0b153-104">This article describes how to protect the SQL Server back end of an application using a combination of SQL Server business continuity and disaster recovery (BCDR) technologies, and [Azure Site Recovery](site-recovery-overview.md).</span></span>

<span data-ttu-id="0b153-105">Before you start, make sure you understand SQL Server disaster recovery capabilities, including failover clustering, Always On availability groups, database mirroring, and log shipping.</span><span class="sxs-lookup"><span data-stu-id="0b153-105">Before you start, make sure you understand SQL Server disaster recovery capabilities, including failover clustering, Always On availability groups, database mirroring, and log shipping.</span></span>


## <a name="sql-server-deployments"></a><span data-ttu-id="0b153-106">SQL Server deployments</span><span class="sxs-lookup"><span data-stu-id="0b153-106">SQL Server deployments</span></span>

<span data-ttu-id="0b153-107">Many workloads use SQL Server as a foundation, and it can be integrated with apps such as SharePoint, Dynamics, and SAP, to implement data services.</span><span class="sxs-lookup"><span data-stu-id="0b153-107">Many workloads use SQL Server as a foundation, and it can be integrated with apps such as SharePoint, Dynamics, and SAP, to implement data services.</span></span>  <span data-ttu-id="0b153-108">SQL Server can be deployed in a number of ways:</span><span class="sxs-lookup"><span data-stu-id="0b153-108">SQL Server can be deployed in a number of ways:</span></span>

* <span data-ttu-id="0b153-109">**Standalone SQL Server**: SQL Server and all databases are hosted on a single machine (physical or a virtual).</span><span class="sxs-lookup"><span data-stu-id="0b153-109">**Standalone SQL Server**: SQL Server and all databases are hosted on a single machine (physical or a virtual).</span></span> <span data-ttu-id="0b153-110">When virtualized, host clustering is used for local high availability.</span><span class="sxs-lookup"><span data-stu-id="0b153-110">When virtualized, host clustering is used for local high availability.</span></span> <span data-ttu-id="0b153-111">Guest-level high availability isn't implemented.</span><span class="sxs-lookup"><span data-stu-id="0b153-111">Guest-level high availability isn't implemented.</span></span>
* <span data-ttu-id="0b153-112">**SQL Server Failover Clustering Instances (Always On FCI)**: Two or more nodes running SQL Server instanced with shared disks are configured in a Windows Failover cluster.</span><span class="sxs-lookup"><span data-stu-id="0b153-112">**SQL Server Failover Clustering Instances (Always On FCI)**: Two or more nodes running SQL Server instanced with shared disks are configured in a Windows Failover cluster.</span></span> <span data-ttu-id="0b153-113">If a node is down, the cluster can fail SQL Server over to another instance.</span><span class="sxs-lookup"><span data-stu-id="0b153-113">If a node is down, the cluster can fail SQL Server over to another instance.</span></span> <span data-ttu-id="0b153-114">This setup is typically used to implement high availability at a primary site.</span><span class="sxs-lookup"><span data-stu-id="0b153-114">This setup is typically used to implement high availability at a primary site.</span></span> <span data-ttu-id="0b153-115">This deployment doesn't protect against failure or outage in the shared storage layer.</span><span class="sxs-lookup"><span data-stu-id="0b153-115">This deployment doesn't protect against failure or outage in the shared storage layer.</span></span> <span data-ttu-id="0b153-116">A shared disk can be implemented using iSCSI, fiber channel or shared vhdx.</span><span class="sxs-lookup"><span data-stu-id="0b153-116">A shared disk can be implemented using iSCSI, fiber channel or shared vhdx.</span></span>
* <span data-ttu-id="0b153-117">**SQL Always On Availability Groups**: Two or more nodes are set up in a shared nothing cluster, with SQL Server databases configured in an availability group, with synchronous replication and automatic failover.</span><span class="sxs-lookup"><span data-stu-id="0b153-117">**SQL Always On Availability Groups**: Two or more nodes are set up in a shared nothing cluster, with SQL Server databases configured in an availability group, with synchronous replication and automatic failover.</span></span>

 <span data-ttu-id="0b153-118">This article leverages the following native SQL disaster recovery technologies for recovering databases to a remote site:</span><span class="sxs-lookup"><span data-stu-id="0b153-118">This article leverages the following native SQL disaster recovery technologies for recovering databases to a remote site:</span></span>

* <span data-ttu-id="0b153-119">SQL Always On Availability Groups, to provide for disaster recovery for SQL Server 2012 or 2014 Enterprise editions.</span><span class="sxs-lookup"><span data-stu-id="0b153-119">SQL Always On Availability Groups, to provide for disaster recovery for SQL Server 2012 or 2014 Enterprise editions.</span></span>
* <span data-ttu-id="0b153-120">SQL database mirroring in high safety mode, for SQL Server Standard edition (any version), or for SQL Server 2008 R2.</span><span class="sxs-lookup"><span data-stu-id="0b153-120">SQL database mirroring in high safety mode, for SQL Server Standard edition (any version), or for SQL Server 2008 R2.</span></span>

## <a name="site-recovery-support"></a><span data-ttu-id="0b153-121">Site Recovery support</span><span class="sxs-lookup"><span data-stu-id="0b153-121">Site Recovery support</span></span>

### <a name="supported-scenarios"></a><span data-ttu-id="0b153-122">Supported scenarios</span><span class="sxs-lookup"><span data-stu-id="0b153-122">Supported scenarios</span></span>
<span data-ttu-id="0b153-123">Site Recovery can protect SQL Server as summarized in the table.</span><span class="sxs-lookup"><span data-stu-id="0b153-123">Site Recovery can protect SQL Server as summarized in the table.</span></span>

<span data-ttu-id="0b153-124">**Scenario**</span><span class="sxs-lookup"><span data-stu-id="0b153-124">**Scenario**</span></span> | <span data-ttu-id="0b153-125">**To a secondary site**</span><span class="sxs-lookup"><span data-stu-id="0b153-125">**To a secondary site**</span></span> | <span data-ttu-id="0b153-126">**To Azure**</span><span class="sxs-lookup"><span data-stu-id="0b153-126">**To Azure**</span></span>
--- | --- | ---
<span data-ttu-id="0b153-127">**Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="0b153-127">**Hyper-V**</span></span> | <span data-ttu-id="0b153-128">Yes</span><span class="sxs-lookup"><span data-stu-id="0b153-128">Yes</span></span> | <span data-ttu-id="0b153-129">Yes</span><span class="sxs-lookup"><span data-stu-id="0b153-129">Yes</span></span>
<span data-ttu-id="0b153-130">**VMware**</span><span class="sxs-lookup"><span data-stu-id="0b153-130">**VMware**</span></span> | <span data-ttu-id="0b153-131">Yes</span><span class="sxs-lookup"><span data-stu-id="0b153-131">Yes</span></span> | <span data-ttu-id="0b153-132">Yes</span><span class="sxs-lookup"><span data-stu-id="0b153-132">Yes</span></span>
<span data-ttu-id="0b153-133">**Physical server**</span><span class="sxs-lookup"><span data-stu-id="0b153-133">**Physical server**</span></span> | <span data-ttu-id="0b153-134">Yes</span><span class="sxs-lookup"><span data-stu-id="0b153-134">Yes</span></span> | <span data-ttu-id="0b153-135">Yes</span><span class="sxs-lookup"><span data-stu-id="0b153-135">Yes</span></span>
<span data-ttu-id="0b153-136">**Azure**</span><span class="sxs-lookup"><span data-stu-id="0b153-136">**Azure**</span></span>|<span data-ttu-id="0b153-137">NA</span><span class="sxs-lookup"><span data-stu-id="0b153-137">NA</span></span>| <span data-ttu-id="0b153-138">Yes</span><span class="sxs-lookup"><span data-stu-id="0b153-138">Yes</span></span>

### <a name="supported-sql-server-versions"></a><span data-ttu-id="0b153-139">Supported SQL Server versions</span><span class="sxs-lookup"><span data-stu-id="0b153-139">Supported SQL Server versions</span></span>
<span data-ttu-id="0b153-140">These SQL Server versions are supported, for the supported scenarios:</span><span class="sxs-lookup"><span data-stu-id="0b153-140">These SQL Server versions are supported, for the supported scenarios:</span></span>

* <span data-ttu-id="0b153-141">SQL Server 2016 Enterprise and Standard</span><span class="sxs-lookup"><span data-stu-id="0b153-141">SQL Server 2016 Enterprise and Standard</span></span>
* <span data-ttu-id="0b153-142">SQL Server 2014 Enterprise and Standard</span><span class="sxs-lookup"><span data-stu-id="0b153-142">SQL Server 2014 Enterprise and Standard</span></span>
* <span data-ttu-id="0b153-143">SQL Server 2012 Enterprise and Standard</span><span class="sxs-lookup"><span data-stu-id="0b153-143">SQL Server 2012 Enterprise and Standard</span></span>
* <span data-ttu-id="0b153-144">SQL Server 2008 R2 Enterprise and Standard</span><span class="sxs-lookup"><span data-stu-id="0b153-144">SQL Server 2008 R2 Enterprise and Standard</span></span>

### <a name="supported-sql-server-integration"></a><span data-ttu-id="0b153-145">Supported SQL Server integration</span><span class="sxs-lookup"><span data-stu-id="0b153-145">Supported SQL Server integration</span></span>

<span data-ttu-id="0b153-146">Site Recovery can be integrated with native SQL Server BCDR technologies summarized in the table, to provide a disaster recovery solution.</span><span class="sxs-lookup"><span data-stu-id="0b153-146">Site Recovery can be integrated with native SQL Server BCDR technologies summarized in the table, to provide a disaster recovery solution.</span></span>

<span data-ttu-id="0b153-147">**Feature**</span><span class="sxs-lookup"><span data-stu-id="0b153-147">**Feature**</span></span> | <span data-ttu-id="0b153-148">**Details**</span><span class="sxs-lookup"><span data-stu-id="0b153-148">**Details**</span></span> | <span data-ttu-id="0b153-149">**SQL Server**</span><span class="sxs-lookup"><span data-stu-id="0b153-149">**SQL Server**</span></span> |
--- | --- | ---
<span data-ttu-id="0b153-150">**Always On availability group**</span><span class="sxs-lookup"><span data-stu-id="0b153-150">**Always On availability group**</span></span> | <span data-ttu-id="0b153-151">Multiple standalone instances of SQL Server each run in a failover cluster that has multiple nodes.</span><span class="sxs-lookup"><span data-stu-id="0b153-151">Multiple standalone instances of SQL Server each run in a failover cluster that has multiple nodes.</span></span><br/><br/><span data-ttu-id="0b153-152">Databases can be grouped into failover groups that can be copied (mirrored) on SQL Server instances so that no shared storage is needed.</span><span class="sxs-lookup"><span data-stu-id="0b153-152">Databases can be grouped into failover groups that can be copied (mirrored) on SQL Server instances so that no shared storage is needed.</span></span><br/><br/><span data-ttu-id="0b153-153">Provides disaster recovery between a primary site and one or more secondary sites.</span><span class="sxs-lookup"><span data-stu-id="0b153-153">Provides disaster recovery between a primary site and one or more secondary sites.</span></span> <span data-ttu-id="0b153-154">Two nodes can be set up in a shared nothing cluster with SQL Server databases configured in an availability group with synchronous replication and automatic failover.</span><span class="sxs-lookup"><span data-stu-id="0b153-154">Two nodes can be set up in a shared nothing cluster with SQL Server databases configured in an availability group with synchronous replication and automatic failover.</span></span> | <span data-ttu-id="0b153-155">SQL Server 2016, SQL Server 2014 & SQL Server 2012 Enterprise edition</span><span class="sxs-lookup"><span data-stu-id="0b153-155">SQL Server 2016, SQL Server 2014 & SQL Server 2012 Enterprise edition</span></span>
<span data-ttu-id="0b153-156">**Failover clustering (Always On FCI)**</span><span class="sxs-lookup"><span data-stu-id="0b153-156">**Failover clustering (Always On FCI)**</span></span> | <span data-ttu-id="0b153-157">SQL Server leverages Windows failover clustering for high availability of on-premises SQL Server workloads.</span><span class="sxs-lookup"><span data-stu-id="0b153-157">SQL Server leverages Windows failover clustering for high availability of on-premises SQL Server workloads.</span></span><br/><br/><span data-ttu-id="0b153-158">Nodes running instances of SQL Server with shared disks are configured in a failover cluster.</span><span class="sxs-lookup"><span data-stu-id="0b153-158">Nodes running instances of SQL Server with shared disks are configured in a failover cluster.</span></span> <span data-ttu-id="0b153-159">If an instance is down the cluster fails over to different one.</span><span class="sxs-lookup"><span data-stu-id="0b153-159">If an instance is down the cluster fails over to different one.</span></span><br/><br/><span data-ttu-id="0b153-160">The cluster doesn't protect against failure or outages in shared storage.</span><span class="sxs-lookup"><span data-stu-id="0b153-160">The cluster doesn't protect against failure or outages in shared storage.</span></span> <span data-ttu-id="0b153-161">The shared disk can be implemented with iSCSI, fiber channel, or shared VHDXs.</span><span class="sxs-lookup"><span data-stu-id="0b153-161">The shared disk can be implemented with iSCSI, fiber channel, or shared VHDXs.</span></span> | <span data-ttu-id="0b153-162">SQL Server Enterprise editions</span><span class="sxs-lookup"><span data-stu-id="0b153-162">SQL Server Enterprise editions</span></span><br/><br/><span data-ttu-id="0b153-163">SQL Server Standard edition (limited to two nodes only)</span><span class="sxs-lookup"><span data-stu-id="0b153-163">SQL Server Standard edition (limited to two nodes only)</span></span>
<span data-ttu-id="0b153-164">**Database mirroring (high safety mode)**</span><span class="sxs-lookup"><span data-stu-id="0b153-164">**Database mirroring (high safety mode)**</span></span> | <span data-ttu-id="0b153-165">Protects a single database to a single secondary copy.</span><span class="sxs-lookup"><span data-stu-id="0b153-165">Protects a single database to a single secondary copy.</span></span> <span data-ttu-id="0b153-166">Available in both high safety (synchronous) and high performance (asynchronous) replication modes.</span><span class="sxs-lookup"><span data-stu-id="0b153-166">Available in both high safety (synchronous) and high performance (asynchronous) replication modes.</span></span> <span data-ttu-id="0b153-167">Doesn’t require a failover cluster.</span><span class="sxs-lookup"><span data-stu-id="0b153-167">Doesn’t require a failover cluster.</span></span> | <span data-ttu-id="0b153-168">SQL Server 2008 R2</span><span class="sxs-lookup"><span data-stu-id="0b153-168">SQL Server 2008 R2</span></span><br/><br/><span data-ttu-id="0b153-169">SQL Server Enterprise all editions</span><span class="sxs-lookup"><span data-stu-id="0b153-169">SQL Server Enterprise all editions</span></span>
<span data-ttu-id="0b153-170">**Standalone SQL Server**</span><span class="sxs-lookup"><span data-stu-id="0b153-170">**Standalone SQL Server**</span></span> | <span data-ttu-id="0b153-171">The SQL Server and database are hosted on a single server (physical or virtual).</span><span class="sxs-lookup"><span data-stu-id="0b153-171">The SQL Server and database are hosted on a single server (physical or virtual).</span></span> <span data-ttu-id="0b153-172">Host clustering is used for high availability if the server is virtual.</span><span class="sxs-lookup"><span data-stu-id="0b153-172">Host clustering is used for high availability if the server is virtual.</span></span> <span data-ttu-id="0b153-173">No guest-level high availability.</span><span class="sxs-lookup"><span data-stu-id="0b153-173">No guest-level high availability.</span></span> | <span data-ttu-id="0b153-174">Enterprise or Standard edition</span><span class="sxs-lookup"><span data-stu-id="0b153-174">Enterprise or Standard edition</span></span>

## <a name="deployment-recommendations"></a><span data-ttu-id="0b153-175">Deployment recommendations</span><span class="sxs-lookup"><span data-stu-id="0b153-175">Deployment recommendations</span></span>

<span data-ttu-id="0b153-176">This table summarizes our recommendations for integrating SQL Server BCDR technologies with Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="0b153-176">This table summarizes our recommendations for integrating SQL Server BCDR technologies with Site Recovery.</span></span>

| <span data-ttu-id="0b153-177">**Version**</span><span class="sxs-lookup"><span data-stu-id="0b153-177">**Version**</span></span> | <span data-ttu-id="0b153-178">**Edition**</span><span class="sxs-lookup"><span data-stu-id="0b153-178">**Edition**</span></span> | <span data-ttu-id="0b153-179">**Deployment**</span><span class="sxs-lookup"><span data-stu-id="0b153-179">**Deployment**</span></span> | <span data-ttu-id="0b153-180">**On-prem to on-prem**</span><span class="sxs-lookup"><span data-stu-id="0b153-180">**On-prem to on-prem**</span></span> | <span data-ttu-id="0b153-181">**On-prem to Azure**</span><span class="sxs-lookup"><span data-stu-id="0b153-181">**On-prem to Azure**</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="0b153-182">SQL Server 2016, 2014 or 2012</span><span class="sxs-lookup"><span data-stu-id="0b153-182">SQL Server 2016, 2014 or 2012</span></span> |<span data-ttu-id="0b153-183">Enterprise</span><span class="sxs-lookup"><span data-stu-id="0b153-183">Enterprise</span></span> |<span data-ttu-id="0b153-184">Failover cluster instance</span><span class="sxs-lookup"><span data-stu-id="0b153-184">Failover cluster instance</span></span> |<span data-ttu-id="0b153-185">Always On availability groups</span><span class="sxs-lookup"><span data-stu-id="0b153-185">Always On availability groups</span></span> |<span data-ttu-id="0b153-186">Always On availability groups</span><span class="sxs-lookup"><span data-stu-id="0b153-186">Always On availability groups</span></span> |
|| <span data-ttu-id="0b153-187">Enterprise</span><span class="sxs-lookup"><span data-stu-id="0b153-187">Enterprise</span></span> |<span data-ttu-id="0b153-188">Always On availability groups for high availability</span><span class="sxs-lookup"><span data-stu-id="0b153-188">Always On availability groups for high availability</span></span> |<span data-ttu-id="0b153-189">Always On availability groups</span><span class="sxs-lookup"><span data-stu-id="0b153-189">Always On availability groups</span></span> |<span data-ttu-id="0b153-190">Always On availability groups</span><span class="sxs-lookup"><span data-stu-id="0b153-190">Always On availability groups</span></span> | |
|| <span data-ttu-id="0b153-191">Standard</span><span class="sxs-lookup"><span data-stu-id="0b153-191">Standard</span></span> |<span data-ttu-id="0b153-192">Failover cluster instance (FCI)</span><span class="sxs-lookup"><span data-stu-id="0b153-192">Failover cluster instance (FCI)</span></span> |<span data-ttu-id="0b153-193">Site Recovery replication with local mirror</span><span class="sxs-lookup"><span data-stu-id="0b153-193">Site Recovery replication with local mirror</span></span> |<span data-ttu-id="0b153-194">Site Recovery replication with local mirror</span><span class="sxs-lookup"><span data-stu-id="0b153-194">Site Recovery replication with local mirror</span></span> | |
|| <span data-ttu-id="0b153-195">Enterprise or Standard</span><span class="sxs-lookup"><span data-stu-id="0b153-195">Enterprise or Standard</span></span> |<span data-ttu-id="0b153-196">Standalone</span><span class="sxs-lookup"><span data-stu-id="0b153-196">Standalone</span></span> |<span data-ttu-id="0b153-197">Site Recovery replication</span><span class="sxs-lookup"><span data-stu-id="0b153-197">Site Recovery replication</span></span> |<span data-ttu-id="0b153-198">Site Recovery replication</span><span class="sxs-lookup"><span data-stu-id="0b153-198">Site Recovery replication</span></span> | |
| <span data-ttu-id="0b153-199">SQL Server 2008 R2 or 2008</span><span class="sxs-lookup"><span data-stu-id="0b153-199">SQL Server 2008 R2 or 2008</span></span> |<span data-ttu-id="0b153-200">Enterprise or Standard</span><span class="sxs-lookup"><span data-stu-id="0b153-200">Enterprise or Standard</span></span> |<span data-ttu-id="0b153-201">Failover cluster instance (FCI)</span><span class="sxs-lookup"><span data-stu-id="0b153-201">Failover cluster instance (FCI)</span></span> |<span data-ttu-id="0b153-202">Site Recovery replication with local mirror</span><span class="sxs-lookup"><span data-stu-id="0b153-202">Site Recovery replication with local mirror</span></span> |<span data-ttu-id="0b153-203">Site Recovery replication with local mirror</span><span class="sxs-lookup"><span data-stu-id="0b153-203">Site Recovery replication with local mirror</span></span> |
|| <span data-ttu-id="0b153-204">Enterprise or Standard</span><span class="sxs-lookup"><span data-stu-id="0b153-204">Enterprise or Standard</span></span> |<span data-ttu-id="0b153-205">Standalone</span><span class="sxs-lookup"><span data-stu-id="0b153-205">Standalone</span></span> |<span data-ttu-id="0b153-206">Site Recovery replication</span><span class="sxs-lookup"><span data-stu-id="0b153-206">Site Recovery replication</span></span> |<span data-ttu-id="0b153-207">Site Recovery replication</span><span class="sxs-lookup"><span data-stu-id="0b153-207">Site Recovery replication</span></span> | |
| <span data-ttu-id="0b153-208">SQL Server (Any version)</span><span class="sxs-lookup"><span data-stu-id="0b153-208">SQL Server (Any version)</span></span> |<span data-ttu-id="0b153-209">Enterprise or Standard</span><span class="sxs-lookup"><span data-stu-id="0b153-209">Enterprise or Standard</span></span> |<span data-ttu-id="0b153-210">Failover cluster instance - DTC application</span><span class="sxs-lookup"><span data-stu-id="0b153-210">Failover cluster instance - DTC application</span></span> |<span data-ttu-id="0b153-211">Site Recovery replication</span><span class="sxs-lookup"><span data-stu-id="0b153-211">Site Recovery replication</span></span> |<span data-ttu-id="0b153-212">Not Supported</span><span class="sxs-lookup"><span data-stu-id="0b153-212">Not Supported</span></span> |

## <a name="deployment-prerequisites"></a><span data-ttu-id="0b153-213">Deployment prerequisites</span><span class="sxs-lookup"><span data-stu-id="0b153-213">Deployment prerequisites</span></span>

* <span data-ttu-id="0b153-214">An on-premises SQL Server deployment, running a supported SQL Server version.</span><span class="sxs-lookup"><span data-stu-id="0b153-214">An on-premises SQL Server deployment, running a supported SQL Server version.</span></span> <span data-ttu-id="0b153-215">Typically, you also need Active Directory for your SQL server.</span><span class="sxs-lookup"><span data-stu-id="0b153-215">Typically, you also need Active Directory for your SQL server.</span></span>
* <span data-ttu-id="0b153-216">The requirements for the scenario you want to deploy.</span><span class="sxs-lookup"><span data-stu-id="0b153-216">The requirements for the scenario you want to deploy.</span></span> <span data-ttu-id="0b153-217">Learn more about support requirements for [replication to Azure](site-recovery-support-matrix-to-azure.md) and [on-premises](site-recovery-support-matrix.md), and [deployment prerequisites](site-recovery-prereq.md).</span><span class="sxs-lookup"><span data-stu-id="0b153-217">Learn more about support requirements for [replication to Azure](site-recovery-support-matrix-to-azure.md) and [on-premises](site-recovery-support-matrix.md), and [deployment prerequisites](site-recovery-prereq.md).</span></span>

## <a name="set-up-active-directory"></a><span data-ttu-id="0b153-218">Set up Active Directory</span><span class="sxs-lookup"><span data-stu-id="0b153-218">Set up Active Directory</span></span>

<span data-ttu-id="0b153-219">Set up Active Directory, in the secondary recovery site, for SQL Server to run properly.</span><span class="sxs-lookup"><span data-stu-id="0b153-219">Set up Active Directory, in the secondary recovery site, for SQL Server to run properly.</span></span>

* <span data-ttu-id="0b153-220">**Small enterprise**—With a small number of applications, and single domain controller for the on-premises site, if you want to fail over the entire site, we recommend you use Site Recovery replication to replicate the domain controller to the secondary datacenter, or to Azure.</span><span class="sxs-lookup"><span data-stu-id="0b153-220">**Small enterprise**—With a small number of applications, and single domain controller for the on-premises site, if you want to fail over the entire site, we recommend you use Site Recovery replication to replicate the domain controller to the secondary datacenter, or to Azure.</span></span>
* <span data-ttu-id="0b153-221">**Medium to large enterprise**—If you have a large number of applications, an Active Directory forest, and you want to fail over by application or workload, we recommend you set up an additional domain controller in the secondary datacenter, or in Azure.</span><span class="sxs-lookup"><span data-stu-id="0b153-221">**Medium to large enterprise**—If you have a large number of applications, an Active Directory forest, and you want to fail over by application or workload, we recommend you set up an additional domain controller in the secondary datacenter, or in Azure.</span></span> <span data-ttu-id="0b153-222">If you're using Always On availability groups to recover to a remote site, we recommend you set up another additional domain controller on the secondary site or in Azure, to use for the recovered SQL Server instance.</span><span class="sxs-lookup"><span data-stu-id="0b153-222">If you're using Always On availability groups to recover to a remote site, we recommend you set up another additional domain controller on the secondary site or in Azure, to use for the recovered SQL Server instance.</span></span>

<span data-ttu-id="0b153-223">The instructions in this article presume that a domain controller is available in the secondary location.</span><span class="sxs-lookup"><span data-stu-id="0b153-223">The instructions in this article presume that a domain controller is available in the secondary location.</span></span> <span data-ttu-id="0b153-224">[Read more](site-recovery-active-directory.md) about protecting Active Directory with Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="0b153-224">[Read more](site-recovery-active-directory.md) about protecting Active Directory with Site Recovery.</span></span>


## <a name="integrate-with-sql-server-always-on-for-replication-to-azure"></a><span data-ttu-id="0b153-225">Integrate with SQL Server Always On for replication to Azure</span><span class="sxs-lookup"><span data-stu-id="0b153-225">Integrate with SQL Server Always On for replication to Azure</span></span>

<span data-ttu-id="0b153-226">Here's what you need to do:</span><span class="sxs-lookup"><span data-stu-id="0b153-226">Here's what you need to do:</span></span>

1. <span data-ttu-id="0b153-227">Import scripts into your Azure Automation account.</span><span class="sxs-lookup"><span data-stu-id="0b153-227">Import scripts into your Azure Automation account.</span></span> <span data-ttu-id="0b153-228">This contains the scripts to failover SQL Availability Group in a [Resource Manager virtual machine](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/asr-automation-recovery/scripts/ASR-SQL-FailoverAG.ps1) and a [Classic virtual machine](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/asr-automation-recovery/scripts/ASR-SQL-FailoverAGClassic.ps1).</span><span class="sxs-lookup"><span data-stu-id="0b153-228">This contains the scripts to failover SQL Availability Group in a [Resource Manager virtual machine](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/asr-automation-recovery/scripts/ASR-SQL-FailoverAG.ps1) and a [Classic virtual machine](https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/asr-automation-recovery/scripts/ASR-SQL-FailoverAGClassic.ps1).</span></span>

    <span data-ttu-id="0b153-229">[![Deploy to Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span><span class="sxs-lookup"><span data-stu-id="0b153-229">[![Deploy to Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span></span>


1. <span data-ttu-id="0b153-230">Add ASR-SQL-FailoverAG as a pre action of the first group of the recovery plan.</span><span class="sxs-lookup"><span data-stu-id="0b153-230">Add ASR-SQL-FailoverAG as a pre action of the first group of the recovery plan.</span></span>

1. <span data-ttu-id="0b153-231">Follow the instructions available in the script to create an automation variable to provide the name of the availability groups.</span><span class="sxs-lookup"><span data-stu-id="0b153-231">Follow the instructions available in the script to create an automation variable to provide the name of the availability groups.</span></span>

### <a name="steps-to-do-a-test-failover"></a><span data-ttu-id="0b153-232">Steps to do a test failover</span><span class="sxs-lookup"><span data-stu-id="0b153-232">Steps to do a test failover</span></span>

<span data-ttu-id="0b153-233">SQL Always On doesn’t natively support test failover.</span><span class="sxs-lookup"><span data-stu-id="0b153-233">SQL Always On doesn’t natively support test failover.</span></span> <span data-ttu-id="0b153-234">Therefore, we recommend the following:</span><span class="sxs-lookup"><span data-stu-id="0b153-234">Therefore, we recommend the following:</span></span>

1. <span data-ttu-id="0b153-235">Set up [Azure Backup](../backup/backup-azure-arm-vms.md) on the virtual machine that hosts the availability group replica in Azure.</span><span class="sxs-lookup"><span data-stu-id="0b153-235">Set up [Azure Backup](../backup/backup-azure-arm-vms.md) on the virtual machine that hosts the availability group replica in Azure.</span></span>

1. <span data-ttu-id="0b153-236">Before triggering test failover of the recovery plan, recover the virtual machine from the backup taken in the previous step.</span><span class="sxs-lookup"><span data-stu-id="0b153-236">Before triggering test failover of the recovery plan, recover the virtual machine from the backup taken in the previous step.</span></span>

    ![<span data-ttu-id="0b153-237">Restore from Azure Backup</span><span class="sxs-lookup"><span data-stu-id="0b153-237">Restore from Azure Backup</span></span> ](./media/site-recovery-sql/restore-from-backup.png)

1. <span data-ttu-id="0b153-238">[Force a quorum](https://docs.microsoft.com/sql/sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum#PowerShellProcedure) in the virtual machine restored from backup.</span><span class="sxs-lookup"><span data-stu-id="0b153-238">[Force a quorum](https://docs.microsoft.com/sql/sql-server/failover-clusters/windows/force-a-wsfc-cluster-to-start-without-a-quorum#PowerShellProcedure) in the virtual machine restored from backup.</span></span>

1. <span data-ttu-id="0b153-239">Update IP of the listener to an IP available in the test failover network.</span><span class="sxs-lookup"><span data-stu-id="0b153-239">Update IP of the listener to an IP available in the test failover network.</span></span>

    ![Update Listener IP](./media/site-recovery-sql/update-listener-ip.png)

1. <span data-ttu-id="0b153-241">Bring listener online.</span><span class="sxs-lookup"><span data-stu-id="0b153-241">Bring listener online.</span></span>

    ![Bring Listener Online](./media/site-recovery-sql/bring-listener-online.png)

1. <span data-ttu-id="0b153-243">Create a load balancer with one IP created under frontend IP pool corresponding to each availability group listener and with the SQL virtual machine added in the backend pool.</span><span class="sxs-lookup"><span data-stu-id="0b153-243">Create a load balancer with one IP created under frontend IP pool corresponding to each availability group listener and with the SQL virtual machine added in the backend pool.</span></span>

     ![<span data-ttu-id="0b153-244">Create Load Balancer - Frontend IP pool</span><span class="sxs-lookup"><span data-stu-id="0b153-244">Create Load Balancer - Frontend IP pool</span></span> ](./media/site-recovery-sql/create-load-balancer1.png)

    ![<span data-ttu-id="0b153-245">Create Load Balancer - Backend pool</span><span class="sxs-lookup"><span data-stu-id="0b153-245">Create Load Balancer - Backend pool</span></span> ](./media/site-recovery-sql/create-load-balancer2.png)

1. <span data-ttu-id="0b153-246">Do a test failover of the recovery plan.</span><span class="sxs-lookup"><span data-stu-id="0b153-246">Do a test failover of the recovery plan.</span></span>

### <a name="steps-to-do-a-failover"></a><span data-ttu-id="0b153-247">Steps to do a failover</span><span class="sxs-lookup"><span data-stu-id="0b153-247">Steps to do a failover</span></span>

<span data-ttu-id="0b153-248">Once you have added the script in the recovery plan and validated the recovery plan by doing a test failover, you can do failover of the recovery plan.</span><span class="sxs-lookup"><span data-stu-id="0b153-248">Once you have added the script in the recovery plan and validated the recovery plan by doing a test failover, you can do failover of the recovery plan.</span></span>


## <a name="integrate-with-sql-server-always-on-for-replication-to-a-secondary-on-premises-site"></a><span data-ttu-id="0b153-249">Integrate with SQL Server Always On for replication to a secondary on-premises site</span><span class="sxs-lookup"><span data-stu-id="0b153-249">Integrate with SQL Server Always On for replication to a secondary on-premises site</span></span>

<span data-ttu-id="0b153-250">If the SQL Server is using availability groups for high availability (or an FCI), we recommend using availability groups on the recovery site as well.</span><span class="sxs-lookup"><span data-stu-id="0b153-250">If the SQL Server is using availability groups for high availability (or an FCI), we recommend using availability groups on the recovery site as well.</span></span> <span data-ttu-id="0b153-251">Note that this applies to apps that don't use distributed transactions.</span><span class="sxs-lookup"><span data-stu-id="0b153-251">Note that this applies to apps that don't use distributed transactions.</span></span>

1. <span data-ttu-id="0b153-252">[Configure databases](https://msdn.microsoft.com/library/hh213078.aspx) into availability groups.</span><span class="sxs-lookup"><span data-stu-id="0b153-252">[Configure databases](https://msdn.microsoft.com/library/hh213078.aspx) into availability groups.</span></span>
1. <span data-ttu-id="0b153-253">Create a virtual network on the secondary site.</span><span class="sxs-lookup"><span data-stu-id="0b153-253">Create a virtual network on the secondary site.</span></span>
1. <span data-ttu-id="0b153-254">Set up a site-to-site VPN connection between the virtual network, and the primary site.</span><span class="sxs-lookup"><span data-stu-id="0b153-254">Set up a site-to-site VPN connection between the virtual network, and the primary site.</span></span>
1. <span data-ttu-id="0b153-255">Create a virtual machine on the recovery site, and install SQL Server on it.</span><span class="sxs-lookup"><span data-stu-id="0b153-255">Create a virtual machine on the recovery site, and install SQL Server on it.</span></span>
1. <span data-ttu-id="0b153-256">Extend the existing Always On availability groups to the new SQL Server VM.</span><span class="sxs-lookup"><span data-stu-id="0b153-256">Extend the existing Always On availability groups to the new SQL Server VM.</span></span> <span data-ttu-id="0b153-257">Configure this SQL Server instance as an asynchronous replica copy.</span><span class="sxs-lookup"><span data-stu-id="0b153-257">Configure this SQL Server instance as an asynchronous replica copy.</span></span>
1. <span data-ttu-id="0b153-258">Create an availability group listener, or update the existing listener to include the asynchronous replica virtual machine.</span><span class="sxs-lookup"><span data-stu-id="0b153-258">Create an availability group listener, or update the existing listener to include the asynchronous replica virtual machine.</span></span>
1. <span data-ttu-id="0b153-259">Make sure that the application farm is set up using the listener.</span><span class="sxs-lookup"><span data-stu-id="0b153-259">Make sure that the application farm is set up using the listener.</span></span> <span data-ttu-id="0b153-260">If it's setup up using the database server name, update it to use the listener, so you don't need to reconfigure it after the failover.</span><span class="sxs-lookup"><span data-stu-id="0b153-260">If it's setup up using the database server name, update it to use the listener, so you don't need to reconfigure it after the failover.</span></span>

<span data-ttu-id="0b153-261">For applications that use distributed transactions, we recommend you deploy Site Recovery with [VMware/physical server site-to-site replication](site-recovery-vmware-to-vmware.md).</span><span class="sxs-lookup"><span data-stu-id="0b153-261">For applications that use distributed transactions, we recommend you deploy Site Recovery with [VMware/physical server site-to-site replication](site-recovery-vmware-to-vmware.md).</span></span>

### <a name="recovery-plan-considerations"></a><span data-ttu-id="0b153-262">Recovery plan considerations</span><span class="sxs-lookup"><span data-stu-id="0b153-262">Recovery plan considerations</span></span>
1. <span data-ttu-id="0b153-263">Add this sample script to the VMM library, on the primary and secondary sites.</span><span class="sxs-lookup"><span data-stu-id="0b153-263">Add this sample script to the VMM library, on the primary and secondary sites.</span></span>

        Param(
        [string]$SQLAvailabilityGroupPath
        )
        import-module sqlps
        Switch-SqlAvailabilityGroup -Path $SQLAvailabilityGroupPath -AllowDataLoss -force

1. <span data-ttu-id="0b153-264">When you create a recovery plan for the application, add a pre action to Group-1 scripted step, that invokes the script to fail over availability groups.</span><span class="sxs-lookup"><span data-stu-id="0b153-264">When you create a recovery plan for the application, add a pre action to Group-1 scripted step, that invokes the script to fail over availability groups.</span></span>

## <a name="protect-a-standalone-sql-server"></a><span data-ttu-id="0b153-265">Protect a standalone SQL Server</span><span class="sxs-lookup"><span data-stu-id="0b153-265">Protect a standalone SQL Server</span></span>

<span data-ttu-id="0b153-266">In this scenario, we recommend that you use Site Recovery replication to protect the SQL Server machine.</span><span class="sxs-lookup"><span data-stu-id="0b153-266">In this scenario, we recommend that you use Site Recovery replication to protect the SQL Server machine.</span></span> <span data-ttu-id="0b153-267">The exact steps will depend whether SQL Server is a VM or a physical server, and whether you want to replicate to Azure or a secondary on-premises site.</span><span class="sxs-lookup"><span data-stu-id="0b153-267">The exact steps will depend whether SQL Server is a VM or a physical server, and whether you want to replicate to Azure or a secondary on-premises site.</span></span> <span data-ttu-id="0b153-268">Learn about [Site Recovery scenarios](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="0b153-268">Learn about [Site Recovery scenarios](site-recovery-overview.md).</span></span>

## <a name="protect-a-sql-server-cluster-standard-editionwindows-server-2008-r2"></a><span data-ttu-id="0b153-269">Protect a SQL Server cluster (standard edition/Windows Server 2008 R2)</span><span class="sxs-lookup"><span data-stu-id="0b153-269">Protect a SQL Server cluster (standard edition/Windows Server 2008 R2)</span></span>

<span data-ttu-id="0b153-270">For a cluster running SQL Server Standard edition, or SQL Server 2008 R2, we recommend you use Site Recovery replication to protect SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0b153-270">For a cluster running SQL Server Standard edition, or SQL Server 2008 R2, we recommend you use Site Recovery replication to protect SQL Server.</span></span>

### <a name="on-premises-to-on-premises"></a><span data-ttu-id="0b153-271">On-premises to on-premises</span><span class="sxs-lookup"><span data-stu-id="0b153-271">On-premises to on-premises</span></span>

* <span data-ttu-id="0b153-272">If the app uses distributed transactions we recommend you deploy [Site Recovery with SAN replication](site-recovery-vmm-san.md) for a Hyper-V environment, or [VMware/physical server to VMware](site-recovery-vmware-to-vmware.md) for a VMware environment.</span><span class="sxs-lookup"><span data-stu-id="0b153-272">If the app uses distributed transactions we recommend you deploy [Site Recovery with SAN replication](site-recovery-vmm-san.md) for a Hyper-V environment, or [VMware/physical server to VMware](site-recovery-vmware-to-vmware.md) for a VMware environment.</span></span>
* <span data-ttu-id="0b153-273">For non-DTC applications, use the above approach to recover the cluster as a standalone server, by leveraging a local high safety DB mirror.</span><span class="sxs-lookup"><span data-stu-id="0b153-273">For non-DTC applications, use the above approach to recover the cluster as a standalone server, by leveraging a local high safety DB mirror.</span></span>

### <a name="on-premises-to-azure"></a><span data-ttu-id="0b153-274">On-premises to Azure</span><span class="sxs-lookup"><span data-stu-id="0b153-274">On-premises to Azure</span></span>

<span data-ttu-id="0b153-275">Site Recovery doesn't provide guest cluster support when replicating to Azure.</span><span class="sxs-lookup"><span data-stu-id="0b153-275">Site Recovery doesn't provide guest cluster support when replicating to Azure.</span></span> <span data-ttu-id="0b153-276">SQL Server also doesn't provide a low-cost disaster recovery solution for Standard edition.</span><span class="sxs-lookup"><span data-stu-id="0b153-276">SQL Server also doesn't provide a low-cost disaster recovery solution for Standard edition.</span></span> <span data-ttu-id="0b153-277">In this scenario, we recommend you protect the on-premises SQL Server cluster to a standalone SQL Server, and recover it in Azure.</span><span class="sxs-lookup"><span data-stu-id="0b153-277">In this scenario, we recommend you protect the on-premises SQL Server cluster to a standalone SQL Server, and recover it in Azure.</span></span>

1. <span data-ttu-id="0b153-278">Configure an additional standalone SQL Server instance on the on-premises site.</span><span class="sxs-lookup"><span data-stu-id="0b153-278">Configure an additional standalone SQL Server instance on the on-premises site.</span></span>
1. <span data-ttu-id="0b153-279">Configure the instance to serve as a mirror for the databases you want to protect.</span><span class="sxs-lookup"><span data-stu-id="0b153-279">Configure the instance to serve as a mirror for the databases you want to protect.</span></span> <span data-ttu-id="0b153-280">Configure mirroring in high safety mode.</span><span class="sxs-lookup"><span data-stu-id="0b153-280">Configure mirroring in high safety mode.</span></span>
1. <span data-ttu-id="0b153-281">Configure Site Recovery on the on-premises site, for ([Hyper-V](site-recovery-hyper-v-site-to-azure.md) or [VMware VMs/physical servers)](site-recovery-vmware-to-azure-classic.md).</span><span class="sxs-lookup"><span data-stu-id="0b153-281">Configure Site Recovery on the on-premises site, for ([Hyper-V](site-recovery-hyper-v-site-to-azure.md) or [VMware VMs/physical servers)](site-recovery-vmware-to-azure-classic.md).</span></span>
1. <span data-ttu-id="0b153-282">Use Site Recovery replication to replicate the new SQL Server instance to Azure.</span><span class="sxs-lookup"><span data-stu-id="0b153-282">Use Site Recovery replication to replicate the new SQL Server instance to Azure.</span></span> <span data-ttu-id="0b153-283">Since it's a high safety mirror copy, it will be synchronized with the primary cluster, but it will be replicated to Azure using Site Recovery replication.</span><span class="sxs-lookup"><span data-stu-id="0b153-283">Since it's a high safety mirror copy, it will be synchronized with the primary cluster, but it will be replicated to Azure using Site Recovery replication.</span></span>


![Standard cluster](./media/site-recovery-sql/standalone-cluster-local.png)

### <a name="failback-considerations"></a><span data-ttu-id="0b153-285">Failback considerations</span><span class="sxs-lookup"><span data-stu-id="0b153-285">Failback considerations</span></span>

<span data-ttu-id="0b153-286">For SQL Server Standard clusters, failback after an unplanned failover requires a SQL server backup and restore, from the mirror instance to the original cluster, with reestablishment of the mirror.</span><span class="sxs-lookup"><span data-stu-id="0b153-286">For SQL Server Standard clusters, failback after an unplanned failover requires a SQL server backup and restore, from the mirror instance to the original cluster, with reestablishment of the mirror.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0b153-287">Next steps</span><span class="sxs-lookup"><span data-stu-id="0b153-287">Next steps</span></span>
<span data-ttu-id="0b153-288">[Learn more](site-recovery-components.md) about Site Recovery architecture.</span><span class="sxs-lookup"><span data-stu-id="0b153-288">[Learn more](site-recovery-components.md) about Site Recovery architecture.</span></span>
