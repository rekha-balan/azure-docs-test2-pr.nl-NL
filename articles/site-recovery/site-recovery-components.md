---
title: How does Site Recovery work? | Microsoft Docs
description: This article provides an overview of Site Recovery architecture
services: site-recovery
documentationcenter: ''
author: rayne-wiselman
manager: jwhit
editor: ''
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/14/2017
ms.author: raynew
ms.openlocfilehash: e42a440cdcc318df318188f55de19eaf626507df
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44556283"
---
# <a name="how-does-azure-site-recovery-work"></a><span data-ttu-id="8d1b1-104">How does Azure Site Recovery work?</span><span class="sxs-lookup"><span data-stu-id="8d1b1-104">How does Azure Site Recovery work?</span></span>

<span data-ttu-id="8d1b1-105">This article describes underlying architecture of the [Azure Site Recovery](site-recovery-overview.md) service, and the components that make it work.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-105">This article describes underlying architecture of the [Azure Site Recovery](site-recovery-overview.md) service, and the components that make it work.</span></span>

<span data-ttu-id="8d1b1-106">Post any comments at the bottom of this article, or in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-106">Post any comments at the bottom of this article, or in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="replicate-to-azure"></a><span data-ttu-id="8d1b1-107">Replicate to Azure</span><span class="sxs-lookup"><span data-stu-id="8d1b1-107">Replicate to Azure</span></span>

<span data-ttu-id="8d1b1-108">You can replicate the following to Azure:</span><span class="sxs-lookup"><span data-stu-id="8d1b1-108">You can replicate the following to Azure:</span></span>

- <span data-ttu-id="8d1b1-109">**VMware**: On-premises VMware VMs running on a [supported host](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-109">**VMware**: On-premises VMware VMs running on a [supported host](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span></span> <span data-ttu-id="8d1b1-110">You can replicate VMware VMs running [supported operating systems](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions)</span><span class="sxs-lookup"><span data-stu-id="8d1b1-110">You can replicate VMware VMs running [supported operating systems](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions)</span></span>
- <span data-ttu-id="8d1b1-111">**Hyper-V**: On-premises Hyper-V VMs running on [supported hosts](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-111">**Hyper-V**: On-premises Hyper-V VMs running on [supported hosts](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span></span>
- <span data-ttu-id="8d1b1-112">**Physical machines**: On-premises physical servers running Windows or Linux on [supported operating systems](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-112">**Physical machines**: On-premises physical servers running Windows or Linux on [supported operating systems](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span></span> <span data-ttu-id="8d1b1-113">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-113">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>

## <a name="vmware-to-azure"></a><span data-ttu-id="8d1b1-114">VMware to Azure</span><span class="sxs-lookup"><span data-stu-id="8d1b1-114">VMware to Azure</span></span>

<span data-ttu-id="8d1b1-115">Here's what you need for replicating VMware VMs to Azure.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-115">Here's what you need for replicating VMware VMs to Azure.</span></span>

<span data-ttu-id="8d1b1-116">Area</span><span class="sxs-lookup"><span data-stu-id="8d1b1-116">Area</span></span> | <span data-ttu-id="8d1b1-117">Component</span><span class="sxs-lookup"><span data-stu-id="8d1b1-117">Component</span></span> | <span data-ttu-id="8d1b1-118">Details</span><span class="sxs-lookup"><span data-stu-id="8d1b1-118">Details</span></span>
--- | --- | ---
<span data-ttu-id="8d1b1-119">**Azure**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-119">**Azure**</span></span> | <span data-ttu-id="8d1b1-120">In Azure you need an Azure account, an Azure storage account, and an Azure network.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-120">In Azure you need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="8d1b1-121">Storage and network can be Resource Manager accounts, or classic accounts.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-121">Storage and network can be Resource Manager accounts, or classic accounts.</span></span><br/><br/>  <span data-ttu-id="8d1b1-122">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-122">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="8d1b1-123">The Azure VMs connect to the Azure virtual network when they're created.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-123">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="8d1b1-124">**Configuration server**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-124">**Configuration server**</span></span> | <span data-ttu-id="8d1b1-125">A single management server (VMWare VM) runs all on-premises components - configuration server, process server, master target server</span><span class="sxs-lookup"><span data-stu-id="8d1b1-125">A single management server (VMWare VM) runs all on-premises components - configuration server, process server, master target server</span></span> | <span data-ttu-id="8d1b1-126">The configuration server coordinates communications between on-premises and Azure, and manages data replication.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-126">The configuration server coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="8d1b1-127">**Process server**:</span><span class="sxs-lookup"><span data-stu-id="8d1b1-127">**Process server**:</span></span>  | <span data-ttu-id="8d1b1-128">Installed by default on the configuration server.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-128">Installed by default on the configuration server.</span></span> | <span data-ttu-id="8d1b1-129">Acts as a replication gateway.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-129">Acts as a replication gateway.</span></span> <span data-ttu-id="8d1b1-130">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-130">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="8d1b1-131">The process server also handles push installation of the Mobility service to protected machines, and performs automatic discovery of VMware VMs.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-131">The process server also handles push installation of the Mobility service to protected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="8d1b1-132">As your deployment grows you can add additional separate dedicated process servers to handle increasing volumes of replication traffic.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-132">As your deployment grows you can add additional separate dedicated process servers to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="8d1b1-133">**Master target server**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-133">**Master target server**</span></span> | <span data-ttu-id="8d1b1-134">Installed by default on the on-premises configuration server.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-134">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="8d1b1-135">Handles replication data during failback from Azure.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-135">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="8d1b1-136">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-136">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="8d1b1-137">**VMware servers**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-137">**VMware servers**</span></span> | <span data-ttu-id="8d1b1-138">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server to manage the hosts.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-138">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server to manage the hosts.</span></span> | <span data-ttu-id="8d1b1-139">You add VMware servers to your Recovery Services vault.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-139">You add VMware servers to your Recovery Services vault.</span></span><br/><br/> <span data-ttu-id="8d1b1-140">I</span><span class="sxs-lookup"><span data-stu-id="8d1b1-140">I</span></span>
<span data-ttu-id="8d1b1-141">**Replicated machines**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-141">**Replicated machines**</span></span> | <span data-ttu-id="8d1b1-142">The Mobility service will be installed on each VMware VM you want to replicate.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-142">The Mobility service will be installed on each VMware VM you want to replicate.</span></span> <span data-ttu-id="8d1b1-143">It can be installed manually on each machine, or with a push installation from the process server.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-143">It can be installed manually on each machine, or with a push installation from the process server.</span></span>

<span data-ttu-id="8d1b1-144">**Figure 1: VMware to Azure components**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-144">**Figure 1: VMware to Azure components**</span></span>

![Components](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-components/arch-enhanced.png)

### <a name="replication-process"></a><span data-ttu-id="8d1b1-146">Replication process</span><span class="sxs-lookup"><span data-stu-id="8d1b1-146">Replication process</span></span>

1. <span data-ttu-id="8d1b1-147">You set up the deployment, including Azure components, and a Recovery Services vault.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-147">You set up the deployment, including Azure components, and a Recovery Services vault.</span></span> <span data-ttu-id="8d1b1-148">In the vault you specify the replication source and target, set up the configuration server, add VMware servers, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-148">In the vault you specify the replication source and target, set up the configuration server, add VMware servers, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="8d1b1-149">Machines start replicating in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-149">Machines start replicating in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
4. <span data-ttu-id="8d1b1-150">Replication of delta changes to Azure begins after the initial replication finishes.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-150">Replication of delta changes to Azure begins after the initial replication finishes.</span></span> <span data-ttu-id="8d1b1-151">Tracked changes for a machine are held in a .hrl file.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-151">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="8d1b1-152">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-152">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="8d1b1-153">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be configured).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-153">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be configured).</span></span>
    - <span data-ttu-id="8d1b1-154">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-154">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="8d1b1-155">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-155">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="8d1b1-156">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-156">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="8d1b1-157">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-157">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="8d1b1-158">This is useful if machines are running the same workload and need to be consistent.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-158">This is useful if machines are running the same workload and need to be consistent.</span></span>
5. <span data-ttu-id="8d1b1-159">Traffic is replicated to Azure storage public endpoints, over the internet.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-159">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="8d1b1-160">Alternately, you can use Azure ExpressRoute [public peering](https://docs.microsoft.com/en-us/azure/expressroute/expressroute-circuit-peerings#public-peering).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-160">Alternately, you can use Azure ExpressRoute [public peering](https://docs.microsoft.com/en-us/azure/expressroute/expressroute-circuit-peerings#public-peering).</span></span> <span data-ttu-id="8d1b1-161">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-161">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>

<span data-ttu-id="8d1b1-162">**Figure 2: VMware to Azure replication**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-162">**Figure 2: VMware to Azure replication**</span></span>

![Enhanced](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-components/v2a-architecture-henry.png)

### <a name="failover-and-failback"></a><span data-ttu-id="8d1b1-164">Failover and failback</span><span class="sxs-lookup"><span data-stu-id="8d1b1-164">Failover and failback</span></span>

1. <span data-ttu-id="8d1b1-165">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-165">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="8d1b1-166">Planned failover isn't supported.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-166">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="8d1b1-167">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple VMs.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-167">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple VMs.</span></span>
3. <span data-ttu-id="8d1b1-168">When you run a failover, replica VMs are created in Azure.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-168">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="8d1b1-169">You commit a failover to start accessing the workload from the replica Azure VM.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-169">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
4. <span data-ttu-id="8d1b1-170">When your primary on-premises site is available again, you can fail back.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-170">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="8d1b1-171">You set up a failback infrastructure, start replicating the machine from the secondary site to the primary, and run an unplanned failover from the secondary site.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-171">You set up a failback infrastructure, start replicating the machine from the secondary site to the primary, and run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="8d1b1-172">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-172">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span> [<span data-ttu-id="8d1b1-173">Learn more</span><span class="sxs-lookup"><span data-stu-id="8d1b1-173">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="8d1b1-174">There are a few failback requirements:</span><span class="sxs-lookup"><span data-stu-id="8d1b1-174">There are a few failback requirements:</span></span>


- <span data-ttu-id="8d1b1-175">**Temporary process server in Azure**: If you want to fail back from Azure after failover you'll need to set up an Azure VM configured as a process server, to handle replication from Azure.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-175">**Temporary process server in Azure**: If you want to fail back from Azure after failover you'll need to set up an Azure VM configured as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="8d1b1-176">You can delete this VM after failback finishes.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-176">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="8d1b1-177">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from the Azure network to the on-premises site.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-177">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="8d1b1-178">**Separate on-premises master target server**: The on-premises master target server handles failback.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-178">**Separate on-premises master target server**: The on-premises master target server handles failback.</span></span> <span data-ttu-id="8d1b1-179">The master target server is installed by default on the management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-179">The master target server is installed by default on the management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="8d1b1-180">**Failback policy**: To replicate back to your on-premises site, you need a failback policy.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-180">**Failback policy**: To replicate back to your on-premises site, you need a failback policy.</span></span> <span data-ttu-id="8d1b1-181">This is automatically created when you created your replication policy.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-181">This is automatically created when you created your replication policy.</span></span>

<span data-ttu-id="8d1b1-182">**Figure 3: VMware/physical failback**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-182">**Figure 3: VMware/physical failback**</span></span>

![Failback](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-components/enhanced-failback.png)

## <a name="physical-to-azure"></a><span data-ttu-id="8d1b1-184">Physical to Azure</span><span class="sxs-lookup"><span data-stu-id="8d1b1-184">Physical to Azure</span></span>

<span data-ttu-id="8d1b1-185">When you replicate physical on-premises servers to Azure, replication uses also the same components and processes as [VMware to Azure](#vmware-replication-to-azure), but note these differences:</span><span class="sxs-lookup"><span data-stu-id="8d1b1-185">When you replicate physical on-premises servers to Azure, replication uses also the same components and processes as [VMware to Azure](#vmware-replication-to-azure), but note these differences:</span></span>

- <span data-ttu-id="8d1b1-186">You can use a physical server for the configuration server, instead of a VMware VM</span><span class="sxs-lookup"><span data-stu-id="8d1b1-186">You can use a physical server for the configuration server, instead of a VMware VM</span></span>
- <span data-ttu-id="8d1b1-187">You will need an on-premises VMware infrastructure for failback.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-187">You will need an on-premises VMware infrastructure for failback.</span></span> <span data-ttu-id="8d1b1-188">You can't fail back to a physical machine.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-188">You can't fail back to a physical machine.</span></span>

## <a name="hyper-v-to-azure"></a><span data-ttu-id="8d1b1-189">Hyper-V to Azure</span><span class="sxs-lookup"><span data-stu-id="8d1b1-189">Hyper-V to Azure</span></span>

<span data-ttu-id="8d1b1-190">Here's what you need for replicating Hyper-V VMs to Azure.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-190">Here's what you need for replicating Hyper-V VMs to Azure.</span></span>

<span data-ttu-id="8d1b1-191">**Area**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-191">**Area**</span></span> | <span data-ttu-id="8d1b1-192">**Component**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-192">**Component**</span></span> | <span data-ttu-id="8d1b1-193">**Details**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-193">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="8d1b1-194">**Azure**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-194">**Azure**</span></span> | <span data-ttu-id="8d1b1-195">In Azure you need a Microsoft Azure account, an Azure storage account, and a Azure network.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-195">In Azure you need a Microsoft Azure account, an Azure storage account, and a Azure network.</span></span> | <span data-ttu-id="8d1b1-196">Storage and network can be Resource Manager-based, or classic accounts.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-196">Storage and network can be Resource Manager-based, or classic accounts.</span></span><br/><br/> <span data-ttu-id="8d1b1-197">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-197">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span><br/><br/> <span data-ttu-id="8d1b1-198">The Azure VMs connect to the Azure virtual network when they're created.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-198">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="8d1b1-199">**VMM server**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-199">**VMM server**</span></span> | <span data-ttu-id="8d1b1-200">Hyper-V hosts located in VMM clouds</span><span class="sxs-lookup"><span data-stu-id="8d1b1-200">Hyper-V hosts located in VMM clouds</span></span> | <span data-ttu-id="8d1b1-201">If Hyper-V hosts are managed in VMM clouds, you register the VMM server in the Recovery Services vault.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-201">If Hyper-V hosts are managed in VMM clouds, you register the VMM server in the Recovery Services vault.</span></span><br/><br/> <span data-ttu-id="8d1b1-202">On the VMM server you install the Site Recovery Provider to orchestrate replication with Azure.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-202">On the VMM server you install the Site Recovery Provider to orchestrate replication with Azure.</span></span><br/><br/> <span data-ttu-id="8d1b1-203">You need logical and VM networks set up to configure network mapping.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-203">You need logical and VM networks set up to configure network mapping.</span></span> <span data-ttu-id="8d1b1-204">A VM network should be linked to a logical network that's associated with the cloud.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-204">A VM network should be linked to a logical network that's associated with the cloud.</span></span>
<span data-ttu-id="8d1b1-205">**Hyper-V host**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-205">**Hyper-V host**</span></span> | <span data-ttu-id="8d1b1-206">Hyper-V servers can be deployed with or without VMM server.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-206">Hyper-V servers can be deployed with or without VMM server.</span></span> | <span data-ttu-id="8d1b1-207">If there's no VMM server, the Site Recovery Provider is installed on the host to orchestrate replication with Site Recovery over the internet.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-207">If there's no VMM server, the Site Recovery Provider is installed on the host to orchestrate replication with Site Recovery over the internet.</span></span> <span data-ttu-id="8d1b1-208">If there's a VMM server, the Provider is installed on it, and not on the host.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-208">If there's a VMM server, the Provider is installed on it, and not on the host.</span></span><br/><br/> <span data-ttu-id="8d1b1-209">The Recovery Services agent is installed on the host to handle data replication.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-209">The Recovery Services agent is installed on the host to handle data replication.</span></span><br/><br/> <span data-ttu-id="8d1b1-210">Communications from both the Provider and the agent are secure and encrypted.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-210">Communications from both the Provider and the agent are secure and encrypted.</span></span> <span data-ttu-id="8d1b1-211">Replicated data in Azure storage is also encrypted.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-211">Replicated data in Azure storage is also encrypted.</span></span>
<span data-ttu-id="8d1b1-212">**Hyper-V VMs**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-212">**Hyper-V VMs**</span></span> | <span data-ttu-id="8d1b1-213">You need one or more VMs on the Hyper-V host server.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-213">You need one or more VMs on the Hyper-V host server.</span></span> | <span data-ttu-id="8d1b1-214">Nothing needs to explicitly installed on VMs</span><span class="sxs-lookup"><span data-stu-id="8d1b1-214">Nothing needs to explicitly installed on VMs</span></span>


### <a name="replication-process"></a><span data-ttu-id="8d1b1-215">Replication process</span><span class="sxs-lookup"><span data-stu-id="8d1b1-215">Replication process</span></span>

1. <span data-ttu-id="8d1b1-216">You set up the Azure components.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-216">You set up the Azure components.</span></span> <span data-ttu-id="8d1b1-217">We recommend you set up storage and network accounts before you begin Site Recovery deployment.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-217">We recommend you set up storage and network accounts before you begin Site Recovery deployment.</span></span>
2. <span data-ttu-id="8d1b1-218">You create a Replication Services vault for Site Recovery, and configure vault settings, including:</span><span class="sxs-lookup"><span data-stu-id="8d1b1-218">You create a Replication Services vault for Site Recovery, and configure vault settings, including:</span></span>
    - <span data-ttu-id="8d1b1-219">Source and target settings.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-219">Source and target settings.</span></span> <span data-ttu-id="8d1b1-220">If you're not managing Hyper-V hosts in a VMM cloud, for the target you create a Hyper-V site container, and add Hyper-V hosts to it.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-220">If you're not managing Hyper-V hosts in a VMM cloud, for the target you create a Hyper-V site container, and add Hyper-V hosts to it.</span></span> <span data-ttu-id="8d1b1-221">If Hyper-V hosts are managed in VMM, the source is the VMM cloud.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-221">If Hyper-V hosts are managed in VMM, the source is the VMM cloud.</span></span> <span data-ttu-id="8d1b1-222">The target is Azure.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-222">The target is Azure.</span></span>
    - <span data-ttu-id="8d1b1-223">Installation of the Azure Site Recovery Provider and the Microsoft Azure Recovery Services agent.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-223">Installation of the Azure Site Recovery Provider and the Microsoft Azure Recovery Services agent.</span></span> <span data-ttu-id="8d1b1-224">If you have VMM the Provider will be installed on it, and the agent on each Hyper-V host.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-224">If you have VMM the Provider will be installed on it, and the agent on each Hyper-V host.</span></span> <span data-ttu-id="8d1b1-225">If you don't have VMM, both the Provider and agent are installed on each host.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-225">If you don't have VMM, both the Provider and agent are installed on each host.</span></span>
    - <span data-ttu-id="8d1b1-226">You create a replication policy for the Hyper-V site or VMM cloud.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-226">You create a replication policy for the Hyper-V site or VMM cloud.</span></span> <span data-ttu-id="8d1b1-227">The policy is applied to all VMs located on hosts in the site or cloud.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-227">The policy is applied to all VMs located on hosts in the site or cloud.</span></span>
    - <span data-ttu-id="8d1b1-228">You enable replication for Hyper-V VMs.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-228">You enable replication for Hyper-V VMs.</span></span> <span data-ttu-id="8d1b1-229">Initial replication occurs in accordance with the replication policy settings.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-229">Initial replication occurs in accordance with the replication policy settings.</span></span>
4. <span data-ttu-id="8d1b1-230">Data changes are tracked, and replication of delta changes to Azure begins after the initial replication finishes.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-230">Data changes are tracked, and replication of delta changes to Azure begins after the initial replication finishes.</span></span> <span data-ttu-id="8d1b1-231">Tracked changes for an item are held in a .hrl file.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-231">Tracked changes for an item are held in a .hrl file.</span></span>
5. <span data-ttu-id="8d1b1-232">You run a test failover to make sure everything's working.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-232">You run a test failover to make sure everything's working.</span></span>

### <a name="failover-and-failback-process"></a><span data-ttu-id="8d1b1-233">Failover and failback process</span><span class="sxs-lookup"><span data-stu-id="8d1b1-233">Failover and failback process</span></span>

1. <span data-ttu-id="8d1b1-234">You can run a planned or unplanned [failover](site-recovery-failover.md) from on-premises Hyper-V VMs to Azure.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-234">You can run a planned or unplanned [failover](site-recovery-failover.md) from on-premises Hyper-V VMs to Azure.</span></span> <span data-ttu-id="8d1b1-235">If you run a planned failover, then source VMs are shut down to ensure no data loss.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-235">If you run a planned failover, then source VMs are shut down to ensure no data loss.</span></span>
2. <span data-ttu-id="8d1b1-236">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md) to orchestrate failover of multiple machines.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-236">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md) to orchestrate failover of multiple machines.</span></span>
4. <span data-ttu-id="8d1b1-237">After you run the failover, you should be able to see the created replica VMs in Azure.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-237">After you run the failover, you should be able to see the created replica VMs in Azure.</span></span> <span data-ttu-id="8d1b1-238">You can assign a public IP address to the VM if required.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-238">You can assign a public IP address to the VM if required.</span></span>
5. <span data-ttu-id="8d1b1-239">You then commit the failover to start accessing the workload from the replica Azure VM.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-239">You then commit the failover to start accessing the workload from the replica Azure VM.</span></span>
6. <span data-ttu-id="8d1b1-240">When your primary on-premises site is available again, you can [fail back](site-recovery-failback-from-azure-to-hyper-v.md).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-240">When your primary on-premises site is available again, you can [fail back](site-recovery-failback-from-azure-to-hyper-v.md).</span></span> <span data-ttu-id="8d1b1-241">You kick off a planned failover from Azure to the primary site.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-241">You kick off a planned failover from Azure to the primary site.</span></span> <span data-ttu-id="8d1b1-242">For a planned failover you can select to failback to the same VM or to an alternate location, and synchronize changes between Azure and on-premises, to ensure no data loss.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-242">For a planned failover you can select to failback to the same VM or to an alternate location, and synchronize changes between Azure and on-premises, to ensure no data loss.</span></span> <span data-ttu-id="8d1b1-243">When VMs are created on-premises, you commit the failover.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-243">When VMs are created on-premises, you commit the failover.</span></span>

<span data-ttu-id="8d1b1-244">**Figure 4: Hyper-V site to Azure replication**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-244">**Figure 4: Hyper-V site to Azure replication**</span></span>

![Components](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-components/arch-onprem-azure-hypervsite.png)

<span data-ttu-id="8d1b1-246">**Figure 5: Hyper-V in VMM clouds to Azure replication**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-246">**Figure 5: Hyper-V in VMM clouds to Azure replication**</span></span>

![Components](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-components/arch-onprem-onprem-azure-vmm.png)


## <a name="replicate-to-a-secondary-site"></a><span data-ttu-id="8d1b1-248">Replicate to a secondary site</span><span class="sxs-lookup"><span data-stu-id="8d1b1-248">Replicate to a secondary site</span></span>

<span data-ttu-id="8d1b1-249">You can replicate the following to your secondary site:</span><span class="sxs-lookup"><span data-stu-id="8d1b1-249">You can replicate the following to your secondary site:</span></span>

- <span data-ttu-id="8d1b1-250">**VMware**: On-premises VMware VMs running on a [supported host](site-recovery-support-matrix-to-sec-site.md#on-premises-servers).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-250">**VMware**: On-premises VMware VMs running on a [supported host](site-recovery-support-matrix-to-sec-site.md#on-premises-servers).</span></span> <span data-ttu-id="8d1b1-251">You can replicate VMware VMs running [supported operating systems](site-recovery-support-matrix-to-sec-site.md#support-for-replicated-machine-os-versions)</span><span class="sxs-lookup"><span data-stu-id="8d1b1-251">You can replicate VMware VMs running [supported operating systems](site-recovery-support-matrix-to-sec-site.md#support-for-replicated-machine-os-versions)</span></span>
- <span data-ttu-id="8d1b1-252">**Physical machines**: On-premises physical servers running Windows or Linux on [supported operating systems](site-recovery-support-matrix-to-sec-site.md#support-for-replicated-machine-os-versions).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-252">**Physical machines**: On-premises physical servers running Windows or Linux on [supported operating systems](site-recovery-support-matrix-to-sec-site.md#support-for-replicated-machine-os-versions).</span></span>
- <span data-ttu-id="8d1b1-253">**Hyper-V**: On-premises Hyper-V VMs running on [supported Hyper-V hosts](site-recovery-support-matrix-to-sec-site.md#on-premises-servers) managed in VMM clouds.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-253">**Hyper-V**: On-premises Hyper-V VMs running on [supported Hyper-V hosts](site-recovery-support-matrix-to-sec-site.md#on-premises-servers) managed in VMM clouds.</span></span> <span data-ttu-id="8d1b1-254">[supported hosts](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-254">[supported hosts](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span></span> <span data-ttu-id="8d1b1-255">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-255">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>


## <a name="vmwarephysical-to-a-secondary-site"></a><span data-ttu-id="8d1b1-256">VMware/physical to a secondary site</span><span class="sxs-lookup"><span data-stu-id="8d1b1-256">VMware/physical to a secondary site</span></span>

<span data-ttu-id="8d1b1-257">You replicate VMware VMs or physical servers to a secondary site using InMage Scout.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-257">You replicate VMware VMs or physical servers to a secondary site using InMage Scout.</span></span>

### <a name="components"></a><span data-ttu-id="8d1b1-258">Components</span><span class="sxs-lookup"><span data-stu-id="8d1b1-258">Components</span></span>

<span data-ttu-id="8d1b1-259">**Area**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-259">**Area**</span></span> | <span data-ttu-id="8d1b1-260">**Component**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-260">**Component**</span></span> | <span data-ttu-id="8d1b1-261">**Details**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-261">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="8d1b1-262">**Azure**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-262">**Azure**</span></span> | <span data-ttu-id="8d1b1-263">InMage Scout.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-263">InMage Scout.</span></span> | <span data-ttu-id="8d1b1-264">To obtain InMage Scout you need an Azure subscription.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-264">To obtain InMage Scout you need an Azure subscription.</span></span><br/><br/> <span data-ttu-id="8d1b1-265">After you create a Recovery Services vault, you download InMage Scout and install the latest updates to set up the deployment.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-265">After you create a Recovery Services vault, you download InMage Scout and install the latest updates to set up the deployment.</span></span>
<span data-ttu-id="8d1b1-266">**Process server**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-266">**Process server**</span></span> | <span data-ttu-id="8d1b1-267">Located in primary site</span><span class="sxs-lookup"><span data-stu-id="8d1b1-267">Located in primary site</span></span> | <span data-ttu-id="8d1b1-268">You deploy the process server to handle caching, compression, and data optimization.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-268">You deploy the process server to handle caching, compression, and data optimization.</span></span><br/><br/> <span data-ttu-id="8d1b1-269">It also handles push installation of the Unified Agent to machines you want to protect.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-269">It also handles push installation of the Unified Agent to machines you want to protect.</span></span>
<span data-ttu-id="8d1b1-270">**Configuration server**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-270">**Configuration server**</span></span> | <span data-ttu-id="8d1b1-271">Located in secondary site</span><span class="sxs-lookup"><span data-stu-id="8d1b1-271">Located in secondary site</span></span> | <span data-ttu-id="8d1b1-272">The configuration server manages, configure, and monitor your deployment, either using the management website or the vContinuum console.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-272">The configuration server manages, configure, and monitor your deployment, either using the management website or the vContinuum console.</span></span>
<span data-ttu-id="8d1b1-273">**vContinuum server**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-273">**vContinuum server**</span></span> | <span data-ttu-id="8d1b1-274">Optional.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-274">Optional.</span></span> <span data-ttu-id="8d1b1-275">Installed in the same location as the configuration server.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-275">Installed in the same location as the configuration server.</span></span> | <span data-ttu-id="8d1b1-276">It provides a console for managing and monitoring your protected environment.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-276">It provides a console for managing and monitoring your protected environment.</span></span>
<span data-ttu-id="8d1b1-277">**Master target server**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-277">**Master target server**</span></span> | <span data-ttu-id="8d1b1-278">Located in the secondary site</span><span class="sxs-lookup"><span data-stu-id="8d1b1-278">Located in the secondary site</span></span> | <span data-ttu-id="8d1b1-279">The master target server holds replicated data.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-279">The master target server holds replicated data.</span></span> <span data-ttu-id="8d1b1-280">It receives data from the process server, creates a replica machine in the secondary site, and holds the data retention points.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-280">It receives data from the process server, creates a replica machine in the secondary site, and holds the data retention points.</span></span><br/><br/> <span data-ttu-id="8d1b1-281">The number of master target servers you need depends on the number of machines you're protecting.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-281">The number of master target servers you need depends on the number of machines you're protecting.</span></span><br/><br/> <span data-ttu-id="8d1b1-282">If you want to fail back to the primary site, you need a master target server there too.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-282">If you want to fail back to the primary site, you need a master target server there too.</span></span> <span data-ttu-id="8d1b1-283">The Unified Agent is installed on this server.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-283">The Unified Agent is installed on this server.</span></span>
<span data-ttu-id="8d1b1-284">**VMware ESX/ESXi and vCenter server**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-284">**VMware ESX/ESXi and vCenter server**</span></span> |  <span data-ttu-id="8d1b1-285">VMs are hosted on ESX/ESXi hosts.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-285">VMs are hosted on ESX/ESXi hosts.</span></span> <span data-ttu-id="8d1b1-286">Hosts are managed with a vCenter server</span><span class="sxs-lookup"><span data-stu-id="8d1b1-286">Hosts are managed with a vCenter server</span></span> | <span data-ttu-id="8d1b1-287">You need a VMware infrastructure to replicate VMware VMs.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-287">You need a VMware infrastructure to replicate VMware VMs.</span></span>
<span data-ttu-id="8d1b1-288">**VMs/physical servers**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-288">**VMs/physical servers**</span></span> |  <span data-ttu-id="8d1b1-289">Unified Agent installed on VMware VMs and physical servers you want to replicate.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-289">Unified Agent installed on VMware VMs and physical servers you want to replicate.</span></span> | <span data-ttu-id="8d1b1-290">The agent acts as a communication provider between all of the components.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-290">The agent acts as a communication provider between all of the components.</span></span>


### <a name="replication-process"></a><span data-ttu-id="8d1b1-291">Replication process</span><span class="sxs-lookup"><span data-stu-id="8d1b1-291">Replication process</span></span>

1. <span data-ttu-id="8d1b1-292">You set up the component servers in each site (configuration, process, master target), and install the Unified Agent on machines that you want to replicate.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-292">You set up the component servers in each site (configuration, process, master target), and install the Unified Agent on machines that you want to replicate.</span></span>
2. <span data-ttu-id="8d1b1-293">After initial replication, the agent on each machine sends delta replication changes to the process server.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-293">After initial replication, the agent on each machine sends delta replication changes to the process server.</span></span>
3. <span data-ttu-id="8d1b1-294">The process server optimizes the data, and transfers it to the master target server on the secondary site.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-294">The process server optimizes the data, and transfers it to the master target server on the secondary site.</span></span> <span data-ttu-id="8d1b1-295">The configuration server manages the replication process.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-295">The configuration server manages the replication process.</span></span>

<span data-ttu-id="8d1b1-296">**Figure 6: VMware to VMware replication**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-296">**Figure 6: VMware to VMware replication**</span></span>

![VMware to VMware](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-components/vmware-to-vmware.png)



## <a name="hyper-v-to-a-secondary-site"></a><span data-ttu-id="8d1b1-298">Hyper-V to a secondary site</span><span class="sxs-lookup"><span data-stu-id="8d1b1-298">Hyper-V to a secondary site</span></span>

<span data-ttu-id="8d1b1-299">Here's what you need for replicating Hyper-V VMs to a secondary site.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-299">Here's what you need for replicating Hyper-V VMs to a secondary site.</span></span>


<span data-ttu-id="8d1b1-300">**Area**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-300">**Area**</span></span> | <span data-ttu-id="8d1b1-301">**Component**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-301">**Component**</span></span> | <span data-ttu-id="8d1b1-302">**Details**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-302">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="8d1b1-303">**Azure**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-303">**Azure**</span></span> | <span data-ttu-id="8d1b1-304">You need a Microsoft Azure account.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-304">You need a Microsoft Azure account.</span></span> |
<span data-ttu-id="8d1b1-305">**VMM server**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-305">**VMM server**</span></span> | <span data-ttu-id="8d1b1-306">We recommend a VMM server in the primary site, and one in the secondary site</span><span class="sxs-lookup"><span data-stu-id="8d1b1-306">We recommend a VMM server in the primary site, and one in the secondary site</span></span> | <span data-ttu-id="8d1b1-307">Each VMM server should be connected to the internet.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-307">Each VMM server should be connected to the internet.</span></span><br/><br/> <span data-ttu-id="8d1b1-308">Each server should have at least one VMM private cloud, with the Hyper-V capability profile set.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-308">Each server should have at least one VMM private cloud, with the Hyper-V capability profile set.</span></span><br/><br/> <span data-ttu-id="8d1b1-309">You install the Azure Site Recovery Provider on the VMM server.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-309">You install the Azure Site Recovery Provider on the VMM server.</span></span> <span data-ttu-id="8d1b1-310">The Provider coordinates and orchestrates replication with the Site Recovery service over the internet.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-310">The Provider coordinates and orchestrates replication with the Site Recovery service over the internet.</span></span> <span data-ttu-id="8d1b1-311">Communications between the Provider and Azure are secure and encrypted.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-311">Communications between the Provider and Azure are secure and encrypted.</span></span>
<span data-ttu-id="8d1b1-312">**Hyper-V server**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-312">**Hyper-V server**</span></span> |  <span data-ttu-id="8d1b1-313">One or more Hyper-V host servers in the primary and secondary VMM clouds.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-313">One or more Hyper-V host servers in the primary and secondary VMM clouds.</span></span><br/><br/> <span data-ttu-id="8d1b1-314">Servers should be connected to the internet.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-314">Servers should be connected to the internet.</span></span><br/><br/> <span data-ttu-id="8d1b1-315">Data is replicated between the primary and secondary Hyper-V host servers over the LAN or VPN, using Kerberos or certificate authentication.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-315">Data is replicated between the primary and secondary Hyper-V host servers over the LAN or VPN, using Kerberos or certificate authentication.</span></span>  
<span data-ttu-id="8d1b1-316">**Hyper-V VMs**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-316">**Hyper-V VMs**</span></span> | <span data-ttu-id="8d1b1-317">Located on the source Hyper-V host server.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-317">Located on the source Hyper-V host server.</span></span> | <span data-ttu-id="8d1b1-318">The source host server should have at least one VM that you want to replicate.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-318">The source host server should have at least one VM that you want to replicate.</span></span>

### <a name="replication-process"></a><span data-ttu-id="8d1b1-319">Replication process</span><span class="sxs-lookup"><span data-stu-id="8d1b1-319">Replication process</span></span>

1. <span data-ttu-id="8d1b1-320">You set up the Azure account.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-320">You set up the Azure account.</span></span>
2. <span data-ttu-id="8d1b1-321">You create a Replication Services vault for Site Recovery, and configure vault settings, including:</span><span class="sxs-lookup"><span data-stu-id="8d1b1-321">You create a Replication Services vault for Site Recovery, and configure vault settings, including:</span></span>

    - <span data-ttu-id="8d1b1-322">The replication source and target (primary and secondary sites).</span><span class="sxs-lookup"><span data-stu-id="8d1b1-322">The replication source and target (primary and secondary sites).</span></span>
    - <span data-ttu-id="8d1b1-323">Installation of the Azure Site Recovery Provider and the Microsoft Azure Recovery Services agent.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-323">Installation of the Azure Site Recovery Provider and the Microsoft Azure Recovery Services agent.</span></span> <span data-ttu-id="8d1b1-324">The Provider is installed on VMM servers, and the agent on each Hyper-V host.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-324">The Provider is installed on VMM servers, and the agent on each Hyper-V host.</span></span>
    - <span data-ttu-id="8d1b1-325">You create a replication policy for source VMM cloud.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-325">You create a replication policy for source VMM cloud.</span></span> <span data-ttu-id="8d1b1-326">The policy is applied to all VMs located on hosts in the cloud.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-326">The policy is applied to all VMs located on hosts in the cloud.</span></span>
    - <span data-ttu-id="8d1b1-327">You enable replication for Hyper-V VMs.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-327">You enable replication for Hyper-V VMs.</span></span> <span data-ttu-id="8d1b1-328">Initial replication occurs in accordance with the replication policy settings.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-328">Initial replication occurs in accordance with the replication policy settings.</span></span>
4. <span data-ttu-id="8d1b1-329">Data changes are tracked, and replication of delta changes to begins after the initial replication finishes.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-329">Data changes are tracked, and replication of delta changes to begins after the initial replication finishes.</span></span> <span data-ttu-id="8d1b1-330">Tracked changes for an item are held in a .hrl file.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-330">Tracked changes for an item are held in a .hrl file.</span></span>
5. <span data-ttu-id="8d1b1-331">You run a test failover to make sure everything's working.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-331">You run a test failover to make sure everything's working.</span></span>

<span data-ttu-id="8d1b1-332">**Figure 7: VMM to VMM replication**</span><span class="sxs-lookup"><span data-stu-id="8d1b1-332">**Figure 7: VMM to VMM replication**</span></span>

![On-premises to on-premises](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-components/arch-onprem-onprem.png)

### <a name="failover-and-failback"></a><span data-ttu-id="8d1b1-334">Failover and failback</span><span class="sxs-lookup"><span data-stu-id="8d1b1-334">Failover and failback</span></span>

1. <span data-ttu-id="8d1b1-335">You can run a planned or unplanned [failover](site-recovery-failover.md) between on-premises sites.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-335">You can run a planned or unplanned [failover](site-recovery-failover.md) between on-premises sites.</span></span> <span data-ttu-id="8d1b1-336">If you run a planned failover, then source VMs are shut down to ensure no data loss.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-336">If you run a planned failover, then source VMs are shut down to ensure no data loss.</span></span>
2. <span data-ttu-id="8d1b1-337">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md) to orchestrate failover of multiple machines.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-337">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md) to orchestrate failover of multiple machines.</span></span>
4. <span data-ttu-id="8d1b1-338">If you perform an unplanned failover to a secondary site, after the failover machines in the secondary location aren't enabled for protection or replication.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-338">If you perform an unplanned failover to a secondary site, after the failover machines in the secondary location aren't enabled for protection or replication.</span></span> <span data-ttu-id="8d1b1-339">If you ran a planned failover, after the failover, machines in the secondary location are protected.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-339">If you ran a planned failover, after the failover, machines in the secondary location are protected.</span></span>
5. <span data-ttu-id="8d1b1-340">Then, you commit the failover to start accessing the workload from the replica VM.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-340">Then, you commit the failover to start accessing the workload from the replica VM.</span></span>
6. <span data-ttu-id="8d1b1-341">When your primary site is available again, you initiate reverse replication to replicate from the secondary site to the primary.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-341">When your primary site is available again, you initiate reverse replication to replicate from the secondary site to the primary.</span></span> <span data-ttu-id="8d1b1-342">Reverse replication brings the virtual machines into a protected state, but the secondary datacenter is still the active location.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-342">Reverse replication brings the virtual machines into a protected state, but the secondary datacenter is still the active location.</span></span>
7. <span data-ttu-id="8d1b1-343">To make the primary site into the active location again, you initiate a planned failover from secondary to primary, followed by another reverse replication.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-343">To make the primary site into the active location again, you initiate a planned failover from secondary to primary, followed by another reverse replication.</span></span>


## <a name="next-steps"></a><span data-ttu-id="8d1b1-344">Next steps</span><span class="sxs-lookup"><span data-stu-id="8d1b1-344">Next steps</span></span>

- <span data-ttu-id="8d1b1-345">[Learn more](site-recovery-hyper-v-azure-architecture.md) about the Hyper-V replication workflow.</span><span class="sxs-lookup"><span data-stu-id="8d1b1-345">[Learn more](site-recovery-hyper-v-azure-architecture.md) about the Hyper-V replication workflow.</span></span>
- [<span data-ttu-id="8d1b1-346">Check prerequisites</span><span class="sxs-lookup"><span data-stu-id="8d1b1-346">Check prerequisites</span></span>](site-recovery-prereq.md)







