---
title: Multi-tenant support for VMware VM replication to Azure (CSP program) | Microsoft Docs
description: Describes how to deploy Azure Site Recovery in a multi-tenant environment to orchestrate replication, failover and recovery of on-premises VMware virtual machines to Azure through the CSP Program using the Azure portal
services: site-recovery
documentationcenter: ''
author: mayanknayar
manager: jwhit
editor: ''
ms.assetid: ''
ms.service: site-recovery
ms.workload: backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/21/2017
ms.author: manayar
ms.openlocfilehash: c10f51e012c3af7ceafd54dd420690e296cf4a72
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44549940"
---
# <a name="multi-tenant-support-in-azure-site-recovery-for-replicating-vmware-virtual-machines-to-azure-through-the-csp-program"></a><span data-ttu-id="4346f-103">Multi-tenant support in Azure Site Recovery for replicating VMware virtual machines to Azure through the CSP Program</span><span class="sxs-lookup"><span data-stu-id="4346f-103">Multi-tenant support in Azure Site Recovery for replicating VMware virtual machines to Azure through the CSP Program</span></span>

<span data-ttu-id="4346f-104">Azure Site Recovery supports multi-tenant environments for tenant subscriptions.</span><span class="sxs-lookup"><span data-stu-id="4346f-104">Azure Site Recovery supports multi-tenant environments for tenant subscriptions.</span></span> <span data-ttu-id="4346f-105">Multi-tenancy is also supported for tenant subscriptions created and managed through the CSP program.</span><span class="sxs-lookup"><span data-stu-id="4346f-105">Multi-tenancy is also supported for tenant subscriptions created and managed through the CSP program.</span></span> <span data-ttu-id="4346f-106">This article details the guidance for implementing and managing multi-tenant VMware-to-Azure scenarios.</span><span class="sxs-lookup"><span data-stu-id="4346f-106">This article details the guidance for implementing and managing multi-tenant VMware-to-Azure scenarios.</span></span> <span data-ttu-id="4346f-107">Creating and managing tenant subscriptions through CSP is also detailed.</span><span class="sxs-lookup"><span data-stu-id="4346f-107">Creating and managing tenant subscriptions through CSP is also detailed.</span></span>

<span data-ttu-id="4346f-108">Note that this guidance draws heavily from the existing documentation for replicating VMware virtual machines to Azure.</span><span class="sxs-lookup"><span data-stu-id="4346f-108">Note that this guidance draws heavily from the existing documentation for replicating VMware virtual machines to Azure.</span></span> <span data-ttu-id="4346f-109">This guidance should be used in conjunction with that [documentation](site-recovery-vmware-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="4346f-109">This guidance should be used in conjunction with that [documentation](site-recovery-vmware-to-azure.md).</span></span>

## <a name="multi-tenant-environments"></a><span data-ttu-id="4346f-110">Multi-tenant environments</span><span class="sxs-lookup"><span data-stu-id="4346f-110">Multi-tenant environments</span></span>
<span data-ttu-id="4346f-111">There are three major multi-tenant models:</span><span class="sxs-lookup"><span data-stu-id="4346f-111">There are three major multi-tenant models:</span></span>

1.  <span data-ttu-id="4346f-112">**Shared Hosting Services Provider (HSP)** – Here the partner owns the physical infrastructure and uses shared resources (vCenter, datacenters, physical storage, etc.) to host multiple tenants’ VMs on the same infrastructure.</span><span class="sxs-lookup"><span data-stu-id="4346f-112">**Shared Hosting Services Provider (HSP)** – Here the partner owns the physical infrastructure and uses shared resources (vCenter, datacenters, physical storage, etc.) to host multiple tenants’ VMs on the same infrastructure.</span></span> <span data-ttu-id="4346f-113">DR management can be provided by partner as a managed service or be owned by the tenant as a self-service DR solution.</span><span class="sxs-lookup"><span data-stu-id="4346f-113">DR management can be provided by partner as a managed service or be owned by the tenant as a self-service DR solution.</span></span>
2.  <span data-ttu-id="4346f-114">**Dedicated Hosting Services Provider** – Here the partner owns the physical infrastructure but uses dedicated resources (multiple vCenters, physical datastores, etc) to host each tenant’s VMs on separate infrastructure.</span><span class="sxs-lookup"><span data-stu-id="4346f-114">**Dedicated Hosting Services Provider** – Here the partner owns the physical infrastructure but uses dedicated resources (multiple vCenters, physical datastores, etc) to host each tenant’s VMs on separate infrastructure.</span></span> <span data-ttu-id="4346f-115">DR management can again be managed by partner or self-service by the tenant.</span><span class="sxs-lookup"><span data-stu-id="4346f-115">DR management can again be managed by partner or self-service by the tenant.</span></span>
3.  <span data-ttu-id="4346f-116">**Managed Services Provider (MSP)** – Here the customer owns the physical infrastructure that hosts the VMs and the partners provides DR enablement and management.</span><span class="sxs-lookup"><span data-stu-id="4346f-116">**Managed Services Provider (MSP)** – Here the customer owns the physical infrastructure that hosts the VMs and the partners provides DR enablement and management.</span></span>

## <a name="shared-hosting-multi-tenant-guidance"></a><span data-ttu-id="4346f-117">Shared hosting multi-tenant guidance</span><span class="sxs-lookup"><span data-stu-id="4346f-117">Shared hosting multi-tenant guidance</span></span>
<span data-ttu-id="4346f-118">This guidance covers the shared hosting scenario in detail.</span><span class="sxs-lookup"><span data-stu-id="4346f-118">This guidance covers the shared hosting scenario in detail.</span></span> <span data-ttu-id="4346f-119">The other two scenarios are subsets of the shared hosting scenario and use the same principles.</span><span class="sxs-lookup"><span data-stu-id="4346f-119">The other two scenarios are subsets of the shared hosting scenario and use the same principles.</span></span> <span data-ttu-id="4346f-120">The differences are described at the end of the shared hosting guidance.</span><span class="sxs-lookup"><span data-stu-id="4346f-120">The differences are described at the end of the shared hosting guidance.</span></span>

<span data-ttu-id="4346f-121">The basic requirement in a multi-tenant scenario is isolating the different tenants that is, one tenant should not be able to observe what another tenant has hosted.</span><span class="sxs-lookup"><span data-stu-id="4346f-121">The basic requirement in a multi-tenant scenario is isolating the different tenants that is, one tenant should not be able to observe what another tenant has hosted.</span></span> <span data-ttu-id="4346f-122">In a completely partner-managed environment, this requirement is not as important as it for a self-service environment, where it can be critical.</span><span class="sxs-lookup"><span data-stu-id="4346f-122">In a completely partner-managed environment, this requirement is not as important as it for a self-service environment, where it can be critical.</span></span> <span data-ttu-id="4346f-123">This guidance assumes that tenant isolation is required.</span><span class="sxs-lookup"><span data-stu-id="4346f-123">This guidance assumes that tenant isolation is required.</span></span>

<span data-ttu-id="4346f-124">The architecture looks as follows:</span><span class="sxs-lookup"><span data-stu-id="4346f-124">The architecture looks as follows:</span></span>

![architecture-shared-hsp](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/shared-hosting-scenario.png)

<span data-ttu-id="4346f-126">**Figure 1: Shared hosting scenario with one vCenter**</span><span class="sxs-lookup"><span data-stu-id="4346f-126">**Figure 1: Shared hosting scenario with one vCenter**</span></span>

<span data-ttu-id="4346f-127">As seen from the above representation, each customer will have a separate Management Server.</span><span class="sxs-lookup"><span data-stu-id="4346f-127">As seen from the above representation, each customer will have a separate Management Server.</span></span> <span data-ttu-id="4346f-128">This is done to limit tenant access to tenant-specific VMs to enable tenant isolation.</span><span class="sxs-lookup"><span data-stu-id="4346f-128">This is done to limit tenant access to tenant-specific VMs to enable tenant isolation.</span></span> <span data-ttu-id="4346f-129">VMware virtual machine replication scenario uses the configuration server to manage accounts to discover VMs and install agents.</span><span class="sxs-lookup"><span data-stu-id="4346f-129">VMware virtual machine replication scenario uses the configuration server to manage accounts to discover VMs and install agents.</span></span> <span data-ttu-id="4346f-130">We follow the same principles for multi-tenant environments, with the addition of restricting VM discovery through vCenter access control.</span><span class="sxs-lookup"><span data-stu-id="4346f-130">We follow the same principles for multi-tenant environments, with the addition of restricting VM discovery through vCenter access control.</span></span>

<span data-ttu-id="4346f-131">The data isolation requirement necessitates that all sensitive infrastructure information (such as access credentials) remains disclosed from tenants.</span><span class="sxs-lookup"><span data-stu-id="4346f-131">The data isolation requirement necessitates that all sensitive infrastructure information (such as access credentials) remains disclosed from tenants.</span></span> <span data-ttu-id="4346f-132">For this reason, we recommend that all the components of the management server (Configuration Server (CS), Process Server (PS) and Master Target Server (MT)) remain under the exclusive control of the partner.</span><span class="sxs-lookup"><span data-stu-id="4346f-132">For this reason, we recommend that all the components of the management server (Configuration Server (CS), Process Server (PS) and Master Target Server (MT)) remain under the exclusive control of the partner.</span></span> <span data-ttu-id="4346f-133">This includes scale-out PS.</span><span class="sxs-lookup"><span data-stu-id="4346f-133">This includes scale-out PS.</span></span>

### <a name="every-cs-under-the-multi-tenant-scenario-uses-two-accounts"></a><span data-ttu-id="4346f-134">Every CS under the multi-tenant scenario uses two accounts:</span><span class="sxs-lookup"><span data-stu-id="4346f-134">Every CS under the multi-tenant scenario uses two accounts:</span></span>

- <span data-ttu-id="4346f-135">**vCenter access account**: This account is used to discover tenant VMs and is the account has the vCenter access permissions assigned to it (described in the next section).</span><span class="sxs-lookup"><span data-stu-id="4346f-135">**vCenter access account**: This account is used to discover tenant VMs and is the account has the vCenter access permissions assigned to it (described in the next section).</span></span> <span data-ttu-id="4346f-136">It is recommended that the partner enters these credentials him/herself on the config tool to avoid accidental access leaks.</span><span class="sxs-lookup"><span data-stu-id="4346f-136">It is recommended that the partner enters these credentials him/herself on the config tool to avoid accidental access leaks.</span></span>
- <span data-ttu-id="4346f-137">**Virtual machine access account**: This account is used to install the mobility agent on the tenant VMs through automatic push.</span><span class="sxs-lookup"><span data-stu-id="4346f-137">**Virtual machine access account**: This account is used to install the mobility agent on the tenant VMs through automatic push.</span></span> <span data-ttu-id="4346f-138">This is usually a domain account that a tenant might provide to partner or can alternatively be managed by partner directly.</span><span class="sxs-lookup"><span data-stu-id="4346f-138">This is usually a domain account that a tenant might provide to partner or can alternatively be managed by partner directly.</span></span> <span data-ttu-id="4346f-139">In case the tenant doesn’t wish to share the details to partner directly, the tenant can be allowed to enter the credentials through a limited-time access to CS, or alternatively the tenant can install mobility agents manually with the partner’s assistance.</span><span class="sxs-lookup"><span data-stu-id="4346f-139">In case the tenant doesn’t wish to share the details to partner directly, the tenant can be allowed to enter the credentials through a limited-time access to CS, or alternatively the tenant can install mobility agents manually with the partner’s assistance.</span></span>

### <a name="requirements-for-vcenter-access-account"></a><span data-ttu-id="4346f-140">Requirements for vCenter access account</span><span class="sxs-lookup"><span data-stu-id="4346f-140">Requirements for vCenter access account</span></span>

<span data-ttu-id="4346f-141">As detailed in the earlier section, the CS requires to be configured with an account that has a special role assigned to it.</span><span class="sxs-lookup"><span data-stu-id="4346f-141">As detailed in the earlier section, the CS requires to be configured with an account that has a special role assigned to it.</span></span> <span data-ttu-id="4346f-142">It is important to note that this role assignment needs to be done to the vCenter access account for each vCenter object and not propagated to the child objects.</span><span class="sxs-lookup"><span data-stu-id="4346f-142">It is important to note that this role assignment needs to be done to the vCenter access account for each vCenter object and not propagated to the child objects.</span></span> <span data-ttu-id="4346f-143">This is done to ensure tenant isolation since access propagation can result in accidental access to other objects also</span><span class="sxs-lookup"><span data-stu-id="4346f-143">This is done to ensure tenant isolation since access propagation can result in accidental access to other objects also</span></span>

![permissions-without-propagation](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/assign-permissions-without-propagation.png)

<span data-ttu-id="4346f-145">The alternative is to assign the user account and role at the Datacenter object and propagate to child objects; following which that account has to be given a ‘No access’ role for every object (such as other tenants’ VMs) that should not be accessible to a particular tenant.</span><span class="sxs-lookup"><span data-stu-id="4346f-145">The alternative is to assign the user account and role at the Datacenter object and propagate to child objects; following which that account has to be given a ‘No access’ role for every object (such as other tenants’ VMs) that should not be accessible to a particular tenant.</span></span> <span data-ttu-id="4346f-146">This is both cumbersome and exposes accidental access controls, as every new child object created is also automatically granted access inherited from parent.</span><span class="sxs-lookup"><span data-stu-id="4346f-146">This is both cumbersome and exposes accidental access controls, as every new child object created is also automatically granted access inherited from parent.</span></span> <span data-ttu-id="4346f-147">It is hence suggested to go with the first approach.</span><span class="sxs-lookup"><span data-stu-id="4346f-147">It is hence suggested to go with the first approach.</span></span>

<span data-ttu-id="4346f-148">The vCenter account access procedure is as follows:</span><span class="sxs-lookup"><span data-stu-id="4346f-148">The vCenter account access procedure is as follows:</span></span>

1.  <span data-ttu-id="4346f-149">Create a new role by cloning the pre-defined ‘Read-only’ role and give it a convenient name (such as Azure_Site_Recovery used in this example).</span><span class="sxs-lookup"><span data-stu-id="4346f-149">Create a new role by cloning the pre-defined ‘Read-only’ role and give it a convenient name (such as Azure_Site_Recovery used in this example).</span></span>
2.  <span data-ttu-id="4346f-150">Assign the following permissions to this role:</span><span class="sxs-lookup"><span data-stu-id="4346f-150">Assign the following permissions to this role:</span></span>
 *  <span data-ttu-id="4346f-151">Datastore -> Allocate space, browse datastore, low-level file operations, remove file, update virtual machine files</span><span class="sxs-lookup"><span data-stu-id="4346f-151">Datastore -> Allocate space, browse datastore, low-level file operations, remove file, update virtual machine files</span></span>
 *  <span data-ttu-id="4346f-152">Network -> Network assign</span><span class="sxs-lookup"><span data-stu-id="4346f-152">Network -> Network assign</span></span>
 *  <span data-ttu-id="4346f-153">Resource -> Assign VM to resource pool, migrate powered off VM, migrate powered on VM</span><span class="sxs-lookup"><span data-stu-id="4346f-153">Resource -> Assign VM to resource pool, migrate powered off VM, migrate powered on VM</span></span>
 *  <span data-ttu-id="4346f-154">Tasks -> Create task, update task</span><span class="sxs-lookup"><span data-stu-id="4346f-154">Tasks -> Create task, update task</span></span>
 *  <span data-ttu-id="4346f-155">Virtual machine -> Configuration</span><span class="sxs-lookup"><span data-stu-id="4346f-155">Virtual machine -> Configuration</span></span>
 *  <span data-ttu-id="4346f-156">Virtual machine -> Interact -> Answer question, device connection, configure CD media, configure floppy media, power off, power on, VMware tools install</span><span class="sxs-lookup"><span data-stu-id="4346f-156">Virtual machine -> Interact -> Answer question, device connection, configure CD media, configure floppy media, power off, power on, VMware tools install</span></span>
 *  <span data-ttu-id="4346f-157">Virtual machine -> Inventory -> Create, register, unregister</span><span class="sxs-lookup"><span data-stu-id="4346f-157">Virtual machine -> Inventory -> Create, register, unregister</span></span>
 *  <span data-ttu-id="4346f-158">Virtual machine -> Provisioning -> Allow virtual machine download, allow virtual machine files upload</span><span class="sxs-lookup"><span data-stu-id="4346f-158">Virtual machine -> Provisioning -> Allow virtual machine download, allow virtual machine files upload</span></span>
 *  <span data-ttu-id="4346f-159">Virtual machine -> Snapshots -> Remove snapshots.</span><span class="sxs-lookup"><span data-stu-id="4346f-159">Virtual machine -> Snapshots -> Remove snapshots.</span></span>

    ![role-permissions](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/edit-role-permissions.png)

3.  <span data-ttu-id="4346f-161">Assign access level to the vCenter account (used in the tenant CS) for different objects as follows:</span><span class="sxs-lookup"><span data-stu-id="4346f-161">Assign access level to the vCenter account (used in the tenant CS) for different objects as follows:</span></span>

| <span data-ttu-id="4346f-162">**Object**</span><span class="sxs-lookup"><span data-stu-id="4346f-162">**Object**</span></span> | <span data-ttu-id="4346f-163">**Role**</span><span class="sxs-lookup"><span data-stu-id="4346f-163">**Role**</span></span> | <span data-ttu-id="4346f-164">**Remarks**</span><span class="sxs-lookup"><span data-stu-id="4346f-164">**Remarks**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4346f-165">vCenter</span><span class="sxs-lookup"><span data-stu-id="4346f-165">vCenter</span></span> | <span data-ttu-id="4346f-166">Read-Only</span><span class="sxs-lookup"><span data-stu-id="4346f-166">Read-Only</span></span> | <span data-ttu-id="4346f-167">This is needed only to allow vCenter access for managing different objects.</span><span class="sxs-lookup"><span data-stu-id="4346f-167">This is needed only to allow vCenter access for managing different objects.</span></span> <span data-ttu-id="4346f-168">This permission can be removed if the account is never going to be provided to a tenant or used for any management operations on the vCenter.</span><span class="sxs-lookup"><span data-stu-id="4346f-168">This permission can be removed if the account is never going to be provided to a tenant or used for any management operations on the vCenter.</span></span> |
| <span data-ttu-id="4346f-169">Datacenter</span><span class="sxs-lookup"><span data-stu-id="4346f-169">Datacenter</span></span> | <span data-ttu-id="4346f-170">Azure_Site_Recovery</span><span class="sxs-lookup"><span data-stu-id="4346f-170">Azure_Site_Recovery</span></span> |  |
| <span data-ttu-id="4346f-171">Host and Host Cluster</span><span class="sxs-lookup"><span data-stu-id="4346f-171">Host and Host Cluster</span></span> | <span data-ttu-id="4346f-172">Azure_Site_Recovery</span><span class="sxs-lookup"><span data-stu-id="4346f-172">Azure_Site_Recovery</span></span> | <span data-ttu-id="4346f-173">Ensure again that access is at object level so only those hosts are accessible that will have tenant VMs before failover and after failback.</span><span class="sxs-lookup"><span data-stu-id="4346f-173">Ensure again that access is at object level so only those hosts are accessible that will have tenant VMs before failover and after failback.</span></span> |
| <span data-ttu-id="4346f-174">Datastore and Datastore Cluster</span><span class="sxs-lookup"><span data-stu-id="4346f-174">Datastore and Datastore Cluster</span></span> | <span data-ttu-id="4346f-175">Azure_Site_Recovery</span><span class="sxs-lookup"><span data-stu-id="4346f-175">Azure_Site_Recovery</span></span> | <span data-ttu-id="4346f-176">Same as above</span><span class="sxs-lookup"><span data-stu-id="4346f-176">Same as above</span></span> |
| <span data-ttu-id="4346f-177">Network</span><span class="sxs-lookup"><span data-stu-id="4346f-177">Network</span></span> | <span data-ttu-id="4346f-178">Azure_Site_Recovery</span><span class="sxs-lookup"><span data-stu-id="4346f-178">Azure_Site_Recovery</span></span> |  |
| <span data-ttu-id="4346f-179">Management Server</span><span class="sxs-lookup"><span data-stu-id="4346f-179">Management Server</span></span> | <span data-ttu-id="4346f-180">Azure_Site_Recovery</span><span class="sxs-lookup"><span data-stu-id="4346f-180">Azure_Site_Recovery</span></span> | <span data-ttu-id="4346f-181">This includes access to all components – CS, PS, and MT – if any are outside the CS machine.</span><span class="sxs-lookup"><span data-stu-id="4346f-181">This includes access to all components – CS, PS, and MT – if any are outside the CS machine.</span></span> |
| <span data-ttu-id="4346f-182">Tenant VMs</span><span class="sxs-lookup"><span data-stu-id="4346f-182">Tenant VMs</span></span> | <span data-ttu-id="4346f-183">Azure_Site_Recovery</span><span class="sxs-lookup"><span data-stu-id="4346f-183">Azure_Site_Recovery</span></span> | <span data-ttu-id="4346f-184">Ensure that any new tenant VMs of a particular tenant also get this access else they will not be discoverable through the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="4346f-184">Ensure that any new tenant VMs of a particular tenant also get this access else they will not be discoverable through the Azure portal.</span></span> |

<span data-ttu-id="4346f-185">The vCenter account access is now complete.</span><span class="sxs-lookup"><span data-stu-id="4346f-185">The vCenter account access is now complete.</span></span> <span data-ttu-id="4346f-186">This fulfills the minimum permissions requirement to complete failback operations.</span><span class="sxs-lookup"><span data-stu-id="4346f-186">This fulfills the minimum permissions requirement to complete failback operations.</span></span> <span data-ttu-id="4346f-187">Note that these access permissions can also be used with your existing policies.</span><span class="sxs-lookup"><span data-stu-id="4346f-187">Note that these access permissions can also be used with your existing policies.</span></span> <span data-ttu-id="4346f-188">Just modify your existing permissions set to include role permissions from point 2 detailed above.</span><span class="sxs-lookup"><span data-stu-id="4346f-188">Just modify your existing permissions set to include role permissions from point 2 detailed above.</span></span>

<span data-ttu-id="4346f-189">To restrict DR operations till the failover state that is, without failback capabilities, follow the above procedure but instead of assigning 'Azure_Site_Recovery' role to the vCenter access account, assign just a 'Read-Only' role to that account.</span><span class="sxs-lookup"><span data-stu-id="4346f-189">To restrict DR operations till the failover state that is, without failback capabilities, follow the above procedure but instead of assigning 'Azure_Site_Recovery' role to the vCenter access account, assign just a 'Read-Only' role to that account.</span></span> <span data-ttu-id="4346f-190">This permission-set allows VM replication and failover and does not allow failback.</span><span class="sxs-lookup"><span data-stu-id="4346f-190">This permission-set allows VM replication and failover and does not allow failback.</span></span> <span data-ttu-id="4346f-191">Note that everything else in the above process remains as-is.</span><span class="sxs-lookup"><span data-stu-id="4346f-191">Note that everything else in the above process remains as-is.</span></span> <span data-ttu-id="4346f-192">Every permission is still assigned at the object level only and not propagated to child objects, to ensure tenant-isolation and restrict VM discovery.</span><span class="sxs-lookup"><span data-stu-id="4346f-192">Every permission is still assigned at the object level only and not propagated to child objects, to ensure tenant-isolation and restrict VM discovery.</span></span>

## <a name="other-multi-tenant-environments"></a><span data-ttu-id="4346f-193">Other multi-tenant environments</span><span class="sxs-lookup"><span data-stu-id="4346f-193">Other multi-tenant environments</span></span>

<span data-ttu-id="4346f-194">The above guidance described in detail how to set up a multi-tenant environment for a shared hosting solution.</span><span class="sxs-lookup"><span data-stu-id="4346f-194">The above guidance described in detail how to set up a multi-tenant environment for a shared hosting solution.</span></span> <span data-ttu-id="4346f-195">The other two major solutions are dedicated hosting and managed service.</span><span class="sxs-lookup"><span data-stu-id="4346f-195">The other two major solutions are dedicated hosting and managed service.</span></span> <span data-ttu-id="4346f-196">The architecture for these is as below:</span><span class="sxs-lookup"><span data-stu-id="4346f-196">The architecture for these is as below:</span></span>

### <a name="dedicated-hosting-solution"></a><span data-ttu-id="4346f-197">Dedicated hosting solution</span><span class="sxs-lookup"><span data-stu-id="4346f-197">Dedicated hosting solution</span></span>

![architecture-shared-hsp](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/dedicated-hosting-scenario.png)

<span data-ttu-id="4346f-199">**Figure 2: Dedicated hosting scenario with multiple vCenters**</span><span class="sxs-lookup"><span data-stu-id="4346f-199">**Figure 2: Dedicated hosting scenario with multiple vCenters**</span></span>

<span data-ttu-id="4346f-200">The architectural difference here is that each tenant’s infrastructure is provisioned for that tenant only.</span><span class="sxs-lookup"><span data-stu-id="4346f-200">The architectural difference here is that each tenant’s infrastructure is provisioned for that tenant only.</span></span> <span data-ttu-id="4346f-201">The hosting provider still needs to follow the CSP steps detailed for shared hosting but does not need to worry about tenant isolation since tenants are isolated through separate vCenters.</span><span class="sxs-lookup"><span data-stu-id="4346f-201">The hosting provider still needs to follow the CSP steps detailed for shared hosting but does not need to worry about tenant isolation since tenants are isolated through separate vCenters.</span></span> <span data-ttu-id="4346f-202">CSP provisioning remains unchanged.</span><span class="sxs-lookup"><span data-stu-id="4346f-202">CSP provisioning remains unchanged.</span></span>

### <a name="managed-service-solution"></a><span data-ttu-id="4346f-203">Managed service solution</span><span class="sxs-lookup"><span data-stu-id="4346f-203">Managed service solution</span></span>

![architecture-shared-hsp](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/managed-service-scenario.png)

<span data-ttu-id="4346f-205">**Figure 3: Managed service scenario with multiple vCenters**</span><span class="sxs-lookup"><span data-stu-id="4346f-205">**Figure 3: Managed service scenario with multiple vCenters**</span></span>

<span data-ttu-id="4346f-206">The architectural difference here is that each tenant’s infrastructure is also physically separate from other tenants.</span><span class="sxs-lookup"><span data-stu-id="4346f-206">The architectural difference here is that each tenant’s infrastructure is also physically separate from other tenants.</span></span> <span data-ttu-id="4346f-207">This scenario usually exists when the tenant owns the infrastructure and just wants a solution provider to manage DR.</span><span class="sxs-lookup"><span data-stu-id="4346f-207">This scenario usually exists when the tenant owns the infrastructure and just wants a solution provider to manage DR.</span></span> <span data-ttu-id="4346f-208">The partner again needs to follow the CSP steps detailed for shared hosting but does not need to worry about tenant isolation since tenants are physically isolated through different infrastructures.</span><span class="sxs-lookup"><span data-stu-id="4346f-208">The partner again needs to follow the CSP steps detailed for shared hosting but does not need to worry about tenant isolation since tenants are physically isolated through different infrastructures.</span></span> <span data-ttu-id="4346f-209">CSP provisioning remains unchanged.</span><span class="sxs-lookup"><span data-stu-id="4346f-209">CSP provisioning remains unchanged.</span></span>


## <a name="csp-program-overview"></a><span data-ttu-id="4346f-210">CSP program overview</span><span class="sxs-lookup"><span data-stu-id="4346f-210">CSP program overview</span></span>
<span data-ttu-id="4346f-211">Microsoft’s Cloud Solution Provider (CSP) [program](https://partner.microsoft.com/en-US/cloud-solution-provider) fosters better-together stories with partners for offering all Microsoft cloud services including O365, EMS, and Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="4346f-211">Microsoft’s Cloud Solution Provider (CSP) [program](https://partner.microsoft.com/en-US/cloud-solution-provider) fosters better-together stories with partners for offering all Microsoft cloud services including O365, EMS, and Microsoft Azure.</span></span> <span data-ttu-id="4346f-212">It enables our partners to own the end-to-end relationship with customers and become the primary relationship contact point.</span><span class="sxs-lookup"><span data-stu-id="4346f-212">It enables our partners to own the end-to-end relationship with customers and become the primary relationship contact point.</span></span> <span data-ttu-id="4346f-213">Through CSP, a partner can deploy Azure subscriptions for customers, and combine these subscriptions with their own value-added customized offerings.</span><span class="sxs-lookup"><span data-stu-id="4346f-213">Through CSP, a partner can deploy Azure subscriptions for customers, and combine these subscriptions with their own value-added customized offerings.</span></span>

<span data-ttu-id="4346f-214">In the case of Azure Site Recovery, partners can manage the complete Disaster Recovery solution for customers directly through CSP or use CSP to set up the Azure Site Recovery environments and let customers manage their own DR needs in a self-service manner.</span><span class="sxs-lookup"><span data-stu-id="4346f-214">In the case of Azure Site Recovery, partners can manage the complete Disaster Recovery solution for customers directly through CSP or use CSP to set up the Azure Site Recovery environments and let customers manage their own DR needs in a self-service manner.</span></span> <span data-ttu-id="4346f-215">In both scenarios, the partner is the liaison between Azure Site Recovery and final customers, and the partner services the customer relationship and bills customers for Azure Site Recovery usage.</span><span class="sxs-lookup"><span data-stu-id="4346f-215">In both scenarios, the partner is the liaison between Azure Site Recovery and final customers, and the partner services the customer relationship and bills customers for Azure Site Recovery usage.</span></span>

## <a name="creating-and-managing-tenant-accounts"></a><span data-ttu-id="4346f-216">Creating and managing tenant accounts</span><span class="sxs-lookup"><span data-stu-id="4346f-216">Creating and managing tenant accounts</span></span>

### <a name="step-0-prerequisite-check"></a><span data-ttu-id="4346f-217">Step 0: Prerequisite check</span><span class="sxs-lookup"><span data-stu-id="4346f-217">Step 0: Prerequisite check</span></span>

<span data-ttu-id="4346f-218">The VM prerequisites are the same as described in the Azure Site Recovery [documentation](site-recovery-vmware-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="4346f-218">The VM prerequisites are the same as described in the Azure Site Recovery [documentation](site-recovery-vmware-to-azure.md).</span></span> <span data-ttu-id="4346f-219">In addition to those prerequisites, the above access controls should be in place before proceeding with tenant management through CSP.</span><span class="sxs-lookup"><span data-stu-id="4346f-219">In addition to those prerequisites, the above access controls should be in place before proceeding with tenant management through CSP.</span></span> <span data-ttu-id="4346f-220">Create a separate Management Server for each tenant that can communicate with the tenant VMs and partner’s vCenter.</span><span class="sxs-lookup"><span data-stu-id="4346f-220">Create a separate Management Server for each tenant that can communicate with the tenant VMs and partner’s vCenter.</span></span> <span data-ttu-id="4346f-221">Only the partner has access rights to this server.</span><span class="sxs-lookup"><span data-stu-id="4346f-221">Only the partner has access rights to this server.</span></span>

### <a name="step-1-create-tenant-account"></a><span data-ttu-id="4346f-222">Step 1: Create tenant account</span><span class="sxs-lookup"><span data-stu-id="4346f-222">Step 1: Create tenant account</span></span>

1.  <span data-ttu-id="4346f-223">Through [partner center](https://partnercenter.microsoft.com/) login to your CSP account.</span><span class="sxs-lookup"><span data-stu-id="4346f-223">Through [partner center](https://partnercenter.microsoft.com/) login to your CSP account.</span></span> <span data-ttu-id="4346f-224">From the Dashboard menu on the left, select the ‘Customers’ option.</span><span class="sxs-lookup"><span data-stu-id="4346f-224">From the Dashboard menu on the left, select the ‘Customers’ option.</span></span>

    ![csp-dashboard](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/csp-dashboard-display.png)

2.  <span data-ttu-id="4346f-226">On the page that opens click on the ‘Add customer’ button.</span><span class="sxs-lookup"><span data-stu-id="4346f-226">On the page that opens click on the ‘Add customer’ button.</span></span>

    ![add-customer](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/add-new-customer.png)

3.  <span data-ttu-id="4346f-228">On the New Customer page, fill in all the account information details for the tenant and click on ‘Next:Subscriptions’.</span><span class="sxs-lookup"><span data-stu-id="4346f-228">On the New Customer page, fill in all the account information details for the tenant and click on ‘Next:Subscriptions’.</span></span>

    ![fill-details](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/customer-add-filled.png)

4.  <span data-ttu-id="4346f-230">On the subscriptions selection page, scroll down to add the ‘Microsoft Azure’ subscription.</span><span class="sxs-lookup"><span data-stu-id="4346f-230">On the subscriptions selection page, scroll down to add the ‘Microsoft Azure’ subscription.</span></span> <span data-ttu-id="4346f-231">Other subscriptions can be added now or at any other time in the future.</span><span class="sxs-lookup"><span data-stu-id="4346f-231">Other subscriptions can be added now or at any other time in the future.</span></span>

    ![add-subscription](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/azure-subscription-selection.png)

5.  <span data-ttu-id="4346f-233">Continue forward and on the next page review all the details entered for the tenant and click on the Submit button.</span><span class="sxs-lookup"><span data-stu-id="4346f-233">Continue forward and on the next page review all the details entered for the tenant and click on the Submit button.</span></span>

    ![customer-summary](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/customer-summary-page.png)

6.  <span data-ttu-id="4346f-235">After the customer is created you get a confirmation page with the details of the default account and password for that subscription.</span><span class="sxs-lookup"><span data-stu-id="4346f-235">After the customer is created you get a confirmation page with the details of the default account and password for that subscription.</span></span> <span data-ttu-id="4346f-236">Save the information and change the password later as necessary through the Azure portal login.</span><span class="sxs-lookup"><span data-stu-id="4346f-236">Save the information and change the password later as necessary through the Azure portal login.</span></span> <span data-ttu-id="4346f-237">This information can be shared as-is with the tenant or a separate account can be also created and shared if required.</span><span class="sxs-lookup"><span data-stu-id="4346f-237">This information can be shared as-is with the tenant or a separate account can be also created and shared if required.</span></span>

### <a name="step-2-access-tenant-account"></a><span data-ttu-id="4346f-238">Step 2: Access tenant account</span><span class="sxs-lookup"><span data-stu-id="4346f-238">Step 2: Access tenant account</span></span>

1.  <span data-ttu-id="4346f-239">You can access the tenant’s subscription from the ‘Customers’ page through your Dashboard as described in step 1.</span><span class="sxs-lookup"><span data-stu-id="4346f-239">You can access the tenant’s subscription from the ‘Customers’ page through your Dashboard as described in step 1.</span></span> <span data-ttu-id="4346f-240">Navigate here and click on the name of the tenant account just created.</span><span class="sxs-lookup"><span data-stu-id="4346f-240">Navigate here and click on the name of the tenant account just created.</span></span>
2.  <span data-ttu-id="4346f-241">This opens the Subscriptions section of the tenant account and from here you can monitor the existing subscriptions for the account and add more subscriptions as required.</span><span class="sxs-lookup"><span data-stu-id="4346f-241">This opens the Subscriptions section of the tenant account and from here you can monitor the existing subscriptions for the account and add more subscriptions as required.</span></span> <span data-ttu-id="4346f-242">To manage the tenant’s DR operations, select the ‘All resources (Azure portal) option on the right side of the page.</span><span class="sxs-lookup"><span data-stu-id="4346f-242">To manage the tenant’s DR operations, select the ‘All resources (Azure portal) option on the right side of the page.</span></span>

    ![all-resources](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/all-resources-select.png)

3.  <span data-ttu-id="4346f-244">Clicking the ‘All resources’ button grants you access to the tenant’s Azure subscriptions and you can verify the same by checking the AAD displayed on the top right corner of the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="4346f-244">Clicking the ‘All resources’ button grants you access to the tenant’s Azure subscriptions and you can verify the same by checking the AAD displayed on the top right corner of the Azure portal.</span></span>

    ![aad-admin](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/aad-admin-display.png)

<span data-ttu-id="4346f-246">You can now perform all Site Recovery operations for the tenant through the Azure portal and manage the DR operations.</span><span class="sxs-lookup"><span data-stu-id="4346f-246">You can now perform all Site Recovery operations for the tenant through the Azure portal and manage the DR operations.</span></span> <span data-ttu-id="4346f-247">The process detailed above must be followed every time to access the tenant subscription through CSP for managed DR.</span><span class="sxs-lookup"><span data-stu-id="4346f-247">The process detailed above must be followed every time to access the tenant subscription through CSP for managed DR.</span></span>

### <a name="step-3-deploy-resources-to-tenant-subscription"></a><span data-ttu-id="4346f-248">Step 3: Deploy resources to tenant subscription</span><span class="sxs-lookup"><span data-stu-id="4346f-248">Step 3: Deploy resources to tenant subscription</span></span>
1.  <span data-ttu-id="4346f-249">On the Azure portal, create a Resource Group and deploy a Recovery Services vault per the usual process.</span><span class="sxs-lookup"><span data-stu-id="4346f-249">On the Azure portal, create a Resource Group and deploy a Recovery Services vault per the usual process.</span></span> <span data-ttu-id="4346f-250">Download the vault registration key.</span><span class="sxs-lookup"><span data-stu-id="4346f-250">Download the vault registration key.</span></span>
2.  <span data-ttu-id="4346f-251">Register the CS for the tenant using the vault registration key.</span><span class="sxs-lookup"><span data-stu-id="4346f-251">Register the CS for the tenant using the vault registration key.</span></span>
3.  <span data-ttu-id="4346f-252">Enter the credentials for the two access accounts – vCenter access account and VM access account.</span><span class="sxs-lookup"><span data-stu-id="4346f-252">Enter the credentials for the two access accounts – vCenter access account and VM access account.</span></span>

    ![config-accounts](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/config-server-account-display.png)

### <a name="step-4-register-site-recovery-infrastructure-to-recovery-services-vault"></a><span data-ttu-id="4346f-254">Step 4: Register site recovery infrastructure to Recovery Services vault</span><span class="sxs-lookup"><span data-stu-id="4346f-254">Step 4: Register site recovery infrastructure to Recovery Services vault</span></span>
1.  <span data-ttu-id="4346f-255">Open the Azure portal and on the vault created earlier register the vCenter server to CS registered in the previous step.</span><span class="sxs-lookup"><span data-stu-id="4346f-255">Open the Azure portal and on the vault created earlier register the vCenter server to CS registered in the previous step.</span></span> <span data-ttu-id="4346f-256">Use the vCenter access account for this purpose.</span><span class="sxs-lookup"><span data-stu-id="4346f-256">Use the vCenter access account for this purpose.</span></span>
2.  <span data-ttu-id="4346f-257">Finish the ‘Prepare infrastructure’ process for Site Recovery per the usual process.</span><span class="sxs-lookup"><span data-stu-id="4346f-257">Finish the ‘Prepare infrastructure’ process for Site Recovery per the usual process.</span></span>
3.  <span data-ttu-id="4346f-258">The VMs are now ready to be replicated.</span><span class="sxs-lookup"><span data-stu-id="4346f-258">The VMs are now ready to be replicated.</span></span> <span data-ttu-id="4346f-259">Verify that only the tenant’s VMs are visible on the VM selection blade under the Replicate option.</span><span class="sxs-lookup"><span data-stu-id="4346f-259">Verify that only the tenant’s VMs are visible on the VM selection blade under the Replicate option.</span></span>

    ![tenant-vms](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/tenant-vm-display.png)

### <a name="step-5-assign-tenant-access-to-subscription"></a><span data-ttu-id="4346f-261">Step 5: Assign tenant access to subscription</span><span class="sxs-lookup"><span data-stu-id="4346f-261">Step 5: Assign tenant access to subscription</span></span>

<span data-ttu-id="4346f-262">For the case of self-service DR the account details as mentioned in item 6 of Step 1 must be provided to the tenant.</span><span class="sxs-lookup"><span data-stu-id="4346f-262">For the case of self-service DR the account details as mentioned in item 6 of Step 1 must be provided to the tenant.</span></span> <span data-ttu-id="4346f-263">This should be done after the partner sets up the DR infrastructure.</span><span class="sxs-lookup"><span data-stu-id="4346f-263">This should be done after the partner sets up the DR infrastructure.</span></span> <span data-ttu-id="4346f-264">Irrespective of DR type (managed or self-service) the partner is required to access tenant subscriptions through CSP portal only and setup the vault and register infrastructure owned by the partner to the tenant subscriptions.</span><span class="sxs-lookup"><span data-stu-id="4346f-264">Irrespective of DR type (managed or self-service) the partner is required to access tenant subscriptions through CSP portal only and setup the vault and register infrastructure owned by the partner to the tenant subscriptions.</span></span>

<span data-ttu-id="4346f-265">A partner can also add a new user to the tenant subscription through the CSP portal as follows:</span><span class="sxs-lookup"><span data-stu-id="4346f-265">A partner can also add a new user to the tenant subscription through the CSP portal as follows:</span></span>

1.  <span data-ttu-id="4346f-266">Go to the particular tenant’s CSP subscription page and select the ‘Users and licenses’ option.</span><span class="sxs-lookup"><span data-stu-id="4346f-266">Go to the particular tenant’s CSP subscription page and select the ‘Users and licenses’ option.</span></span>

    ![user-licenses](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/users-and-licences.png)

    <span data-ttu-id="4346f-268">You can now create a new user by entering the relevant details and selecting permissions, or alternatively uploading the list of users though a CSV file.</span><span class="sxs-lookup"><span data-stu-id="4346f-268">You can now create a new user by entering the relevant details and selecting permissions, or alternatively uploading the list of users though a CSV file.</span></span>
2.  <span data-ttu-id="4346f-269">Once the users are created, go back to the Azure portal and under the Subscription blade select the relevant subscription.</span><span class="sxs-lookup"><span data-stu-id="4346f-269">Once the users are created, go back to the Azure portal and under the Subscription blade select the relevant subscription.</span></span>
3.  <span data-ttu-id="4346f-270">On the new blade that opens select Access Control (IAM) and click on +Add to add a user with the relevant access level.</span><span class="sxs-lookup"><span data-stu-id="4346f-270">On the new blade that opens select Access Control (IAM) and click on +Add to add a user with the relevant access level.</span></span> <span data-ttu-id="4346f-271">The users created through CSP portal will automatically be displayed on the blade that opens after clicking an access level.</span><span class="sxs-lookup"><span data-stu-id="4346f-271">The users created through CSP portal will automatically be displayed on the blade that opens after clicking an access level.</span></span>

    ![user-subscription](https://docstestmedia1.blob.core.windows.net/azure-media/articles/site-recovery/media/site-recovery-multi-tenant-support-vmware-using-csp/add-user-subscription.png)

    <span data-ttu-id="4346f-273">For most management operations, the Contributor role is sufficient.</span><span class="sxs-lookup"><span data-stu-id="4346f-273">For most management operations, the Contributor role is sufficient.</span></span> <span data-ttu-id="4346f-274">A user with this access level can do everything on a subscription except change access levels (for which an Owner level access is required).</span><span class="sxs-lookup"><span data-stu-id="4346f-274">A user with this access level can do everything on a subscription except change access levels (for which an Owner level access is required).</span></span> <span data-ttu-id="4346f-275">You can also fine-tune the access levels as required.</span><span class="sxs-lookup"><span data-stu-id="4346f-275">You can also fine-tune the access levels as required.</span></span>
















