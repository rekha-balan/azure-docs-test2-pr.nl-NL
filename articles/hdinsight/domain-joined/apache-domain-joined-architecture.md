---
title: Domain-joined Azure HDInsight architecture
description: Learn how to plan domain-joined HDInsight.
services: hdinsight
ms.service: hdinsight
author: omidm1
ms.author: omidm
ms.reviewer: jasonh
ms.custom: hdinsightactive
ms.topic: conceptual
ms.date: 05/30/2018
ms.openlocfilehash: d5132cf2414045ca1343354215b2a4564f696190
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44969443"
---
# <a name="plan-azure-domain-joined-hadoop-clusters-in-hdinsight"></a><span data-ttu-id="79aad-103">Plan Azure domain-joined Hadoop clusters in HDInsight</span><span class="sxs-lookup"><span data-stu-id="79aad-103">Plan Azure domain-joined Hadoop clusters in HDInsight</span></span>

<span data-ttu-id="79aad-104">The standard Azure HDInsight cluster is a single-user cluster.</span><span class="sxs-lookup"><span data-stu-id="79aad-104">The standard Azure HDInsight cluster is a single-user cluster.</span></span> <span data-ttu-id="79aad-105">It's suitable for most companies that have smaller application teams building large data workloads.</span><span class="sxs-lookup"><span data-stu-id="79aad-105">It's suitable for most companies that have smaller application teams building large data workloads.</span></span> <span data-ttu-id="79aad-106">Each user can create a dedicated cluster on demand and destroy it when it's not needed anymore.</span><span class="sxs-lookup"><span data-stu-id="79aad-106">Each user can create a dedicated cluster on demand and destroy it when it's not needed anymore.</span></span> 

<span data-ttu-id="79aad-107">Many enterprises have moved toward a model in which clusters are managed by IT teams, and multiple application teams share clusters.</span><span class="sxs-lookup"><span data-stu-id="79aad-107">Many enterprises have moved toward a model in which clusters are managed by IT teams, and multiple application teams share clusters.</span></span> <span data-ttu-id="79aad-108">These larger enterprises need multiuser access to each cluster in Azure HDInsight.</span><span class="sxs-lookup"><span data-stu-id="79aad-108">These larger enterprises need multiuser access to each cluster in Azure HDInsight.</span></span>

<span data-ttu-id="79aad-109">HDInsight relies on a popular identity provider--Active Directory--in a managed way.</span><span class="sxs-lookup"><span data-stu-id="79aad-109">HDInsight relies on a popular identity provider--Active Directory--in a managed way.</span></span> <span data-ttu-id="79aad-110">By integrating HDInsight with [Azure Active Directory Domain Services (Azure AD DS)](../../active-directory-domain-services/active-directory-ds-overview.md), you can access the clusters by using your domain credentials.</span><span class="sxs-lookup"><span data-stu-id="79aad-110">By integrating HDInsight with [Azure Active Directory Domain Services (Azure AD DS)](../../active-directory-domain-services/active-directory-ds-overview.md), you can access the clusters by using your domain credentials.</span></span> 

<span data-ttu-id="79aad-111">The virtual machines (VMs) in HDInsight are domain joined to your provided domain.</span><span class="sxs-lookup"><span data-stu-id="79aad-111">The virtual machines (VMs) in HDInsight are domain joined to your provided domain.</span></span> <span data-ttu-id="79aad-112">So, all the services running on HDInsight (Ambari, Hive server, Ranger, Spark thrift server, and others) work seamlessly for the authenticated user.</span><span class="sxs-lookup"><span data-stu-id="79aad-112">So, all the services running on HDInsight (Ambari, Hive server, Ranger, Spark thrift server, and others) work seamlessly for the authenticated user.</span></span> <span data-ttu-id="79aad-113">Administrators can then create strong authorization policies by using Apache Ranger to provide role-based access control for resources in the cluster.</span><span class="sxs-lookup"><span data-stu-id="79aad-113">Administrators can then create strong authorization policies by using Apache Ranger to provide role-based access control for resources in the cluster.</span></span>


## <a name="integrate-hdinsight-with-active-directory"></a><span data-ttu-id="79aad-114">Integrate HDInsight with Active Directory</span><span class="sxs-lookup"><span data-stu-id="79aad-114">Integrate HDInsight with Active Directory</span></span>

<span data-ttu-id="79aad-115">Open-source Hadoop relies on Kerberos for authentication and security.</span><span class="sxs-lookup"><span data-stu-id="79aad-115">Open-source Hadoop relies on Kerberos for authentication and security.</span></span> <span data-ttu-id="79aad-116">Therefore, HDInsight cluster nodes are domain-joined to a domain that's managed by Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="79aad-116">Therefore, HDInsight cluster nodes are domain-joined to a domain that's managed by Azure AD DS.</span></span> <span data-ttu-id="79aad-117">Kerberos security is configured for the Hadoop components on the cluster.</span><span class="sxs-lookup"><span data-stu-id="79aad-117">Kerberos security is configured for the Hadoop components on the cluster.</span></span> 

<span data-ttu-id="79aad-118">For each Hadoop component, a service principal is created automatically.</span><span class="sxs-lookup"><span data-stu-id="79aad-118">For each Hadoop component, a service principal is created automatically.</span></span> <span data-ttu-id="79aad-119">A corresponding machine principal is also created for each machine that's joined to the domain.</span><span class="sxs-lookup"><span data-stu-id="79aad-119">A corresponding machine principal is also created for each machine that's joined to the domain.</span></span> <span data-ttu-id="79aad-120">To store these service and machine principals, you must provide an organizational unit (OU) within the domain controller (Azure AD DS), where these principals are placed.</span><span class="sxs-lookup"><span data-stu-id="79aad-120">To store these service and machine principals, you must provide an organizational unit (OU) within the domain controller (Azure AD DS), where these principals are placed.</span></span> 

<span data-ttu-id="79aad-121">To summarize, you need to set up an environment with:</span><span class="sxs-lookup"><span data-stu-id="79aad-121">To summarize, you need to set up an environment with:</span></span>

- <span data-ttu-id="79aad-122">An Active Directory domain (managed by Azure AD DS).</span><span class="sxs-lookup"><span data-stu-id="79aad-122">An Active Directory domain (managed by Azure AD DS).</span></span>
- <span data-ttu-id="79aad-123">Secure LDAP (LDAPS) enabled in Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="79aad-123">Secure LDAP (LDAPS) enabled in Azure AD DS.</span></span>
- <span data-ttu-id="79aad-124">Proper networking connectivity from the HDInsight virtual network to the Azure AD DS virtual network, if you choose separate virtual networks for them.</span><span class="sxs-lookup"><span data-stu-id="79aad-124">Proper networking connectivity from the HDInsight virtual network to the Azure AD DS virtual network, if you choose separate virtual networks for them.</span></span> <span data-ttu-id="79aad-125">A VM inside the HDInsight virtual network should have a line of sight to Azure AD DS through virtual network peering.</span><span class="sxs-lookup"><span data-stu-id="79aad-125">A VM inside the HDInsight virtual network should have a line of sight to Azure AD DS through virtual network peering.</span></span> <span data-ttu-id="79aad-126">If HDInsight and Azure AD DS are deployed in the same virtual network, the connectivity is automatically provided and no further action is needed.</span><span class="sxs-lookup"><span data-stu-id="79aad-126">If HDInsight and Azure AD DS are deployed in the same virtual network, the connectivity is automatically provided and no further action is needed.</span></span>
- <span data-ttu-id="79aad-127">An OU [created on Azure AD DS](../../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md).</span><span class="sxs-lookup"><span data-stu-id="79aad-127">An OU [created on Azure AD DS](../../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md).</span></span>
- <span data-ttu-id="79aad-128">A service account that has permissions to:</span><span class="sxs-lookup"><span data-stu-id="79aad-128">A service account that has permissions to:</span></span>
    - <span data-ttu-id="79aad-129">Create service principals in the OU.</span><span class="sxs-lookup"><span data-stu-id="79aad-129">Create service principals in the OU.</span></span>
    - <span data-ttu-id="79aad-130">Join machines to the domain and create machine principals in the OU.</span><span class="sxs-lookup"><span data-stu-id="79aad-130">Join machines to the domain and create machine principals in the OU.</span></span>

<span data-ttu-id="79aad-131">The following screenshot shows an OU created in contoso.com.</span><span class="sxs-lookup"><span data-stu-id="79aad-131">The following screenshot shows an OU created in contoso.com.</span></span> <span data-ttu-id="79aad-132">It also shows some of the service principals and machine principals.</span><span class="sxs-lookup"><span data-stu-id="79aad-132">It also shows some of the service principals and machine principals.</span></span>

![Organization unit for domain-joined HDInsight clusters](./media/apache-domain-joined-architecture/hdinsight-domain-joined-ou.png)<span data-ttu-id="79aad-134">.</span><span class="sxs-lookup"><span data-stu-id="79aad-134">.</span></span>

## <a name="set-up-different-domain-controllers"></a><span data-ttu-id="79aad-135">Set up different domain controllers</span><span class="sxs-lookup"><span data-stu-id="79aad-135">Set up different domain controllers</span></span>
<span data-ttu-id="79aad-136">HDInsight currently supports only Azure AD DS as the main domain controller that the cluster uses for Kerberos communication.</span><span class="sxs-lookup"><span data-stu-id="79aad-136">HDInsight currently supports only Azure AD DS as the main domain controller that the cluster uses for Kerberos communication.</span></span> <span data-ttu-id="79aad-137">But other complex Active Directory setups are possible, as long as such a setup leads to enabling Azure AD DS for HDInsight access.</span><span class="sxs-lookup"><span data-stu-id="79aad-137">But other complex Active Directory setups are possible, as long as such a setup leads to enabling Azure AD DS for HDInsight access.</span></span>

### <a name="azure-active-directory-domain-services"></a><span data-ttu-id="79aad-138">Azure Active Directory Domain Services</span><span class="sxs-lookup"><span data-stu-id="79aad-138">Azure Active Directory Domain Services</span></span>
<span data-ttu-id="79aad-139">[Azure AD DS](../../active-directory-domain-services/active-directory-ds-overview.md) provides a managed domain that's fully compatible with Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="79aad-139">[Azure AD DS](../../active-directory-domain-services/active-directory-ds-overview.md) provides a managed domain that's fully compatible with Windows Server Active Directory.</span></span> <span data-ttu-id="79aad-140">Microsoft takes care of managing, patching, and monitoring the domain in a highly available (HA) setup.</span><span class="sxs-lookup"><span data-stu-id="79aad-140">Microsoft takes care of managing, patching, and monitoring the domain in a highly available (HA) setup.</span></span> <span data-ttu-id="79aad-141">You can deploy your cluster without worrying about maintaining domain controllers.</span><span class="sxs-lookup"><span data-stu-id="79aad-141">You can deploy your cluster without worrying about maintaining domain controllers.</span></span> 

<span data-ttu-id="79aad-142">Users, groups, and passwords are synchronized from Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="79aad-142">Users, groups, and passwords are synchronized from Azure Active Directory (Azure AD).</span></span> <span data-ttu-id="79aad-143">The one-way sync from your Azure AD instance to Azure AD DS enables users to sign in to the cluster by using the same corporate credentials.</span><span class="sxs-lookup"><span data-stu-id="79aad-143">The one-way sync from your Azure AD instance to Azure AD DS enables users to sign in to the cluster by using the same corporate credentials.</span></span> 

<span data-ttu-id="79aad-144">For more information, see [Configure domain-joined HDInsight clusters using Azure AD DS](./apache-domain-joined-configure-using-azure-adds.md).</span><span class="sxs-lookup"><span data-stu-id="79aad-144">For more information, see [Configure domain-joined HDInsight clusters using Azure AD DS](./apache-domain-joined-configure-using-azure-adds.md).</span></span>

### <a name="on-premises-active-directory-or-active-directory-on-iaas-vms"></a><span data-ttu-id="79aad-145">On-premises Active Directory or Active Directory on IaaS VMs</span><span class="sxs-lookup"><span data-stu-id="79aad-145">On-premises Active Directory or Active Directory on IaaS VMs</span></span>

<span data-ttu-id="79aad-146">If you have an on-premises Active Directory instance or more complex Active Directory setups for your domain, you can sync those identities to Azure AD by using Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="79aad-146">If you have an on-premises Active Directory instance or more complex Active Directory setups for your domain, you can sync those identities to Azure AD by using Azure AD Connect.</span></span> <span data-ttu-id="79aad-147">You can then enable Azure AD DS on that Active Directory tenant.</span><span class="sxs-lookup"><span data-stu-id="79aad-147">You can then enable Azure AD DS on that Active Directory tenant.</span></span> 

<span data-ttu-id="79aad-148">Because Kerberos relies on password hashes, you'll need to [enable password hash sync on Azure AD DS](../../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md).</span><span class="sxs-lookup"><span data-stu-id="79aad-148">Because Kerberos relies on password hashes, you'll need to [enable password hash sync on Azure AD DS](../../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md).</span></span> <span data-ttu-id="79aad-149">If you're using federation with Active Directory Federation Services (AD FS), you can optionally set up password hash sync as a backup in case your AD FS infrastructure fails.</span><span class="sxs-lookup"><span data-stu-id="79aad-149">If you're using federation with Active Directory Federation Services (AD FS), you can optionally set up password hash sync as a backup in case your AD FS infrastructure fails.</span></span> <span data-ttu-id="79aad-150">For more information, see [Enable password hash sync with Azure AD Connect sync](../../active-directory/connect/active-directory-aadconnectsync-implement-password-hash-synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="79aad-150">For more information, see [Enable password hash sync with Azure AD Connect sync](../../active-directory/connect/active-directory-aadconnectsync-implement-password-hash-synchronization.md).</span></span> 

<span data-ttu-id="79aad-151">Using on-premises Active Directory or Active Directory on IaaS VMs alone, without Azure AD and Azure AD DS, is not a supported configuration for domain-joined HDInsight clusters.</span><span class="sxs-lookup"><span data-stu-id="79aad-151">Using on-premises Active Directory or Active Directory on IaaS VMs alone, without Azure AD and Azure AD DS, is not a supported configuration for domain-joined HDInsight clusters.</span></span>

## <a name="next-steps"></a><span data-ttu-id="79aad-152">Next steps</span><span class="sxs-lookup"><span data-stu-id="79aad-152">Next steps</span></span>
* [<span data-ttu-id="79aad-153">Configure domain-joined HDInsight clusters</span><span class="sxs-lookup"><span data-stu-id="79aad-153">Configure domain-joined HDInsight clusters</span></span>](apache-domain-joined-configure-using-azure-adds.md)
* [<span data-ttu-id="79aad-154">Configure Hive policies for domain-joined HDInsight clusters</span><span class="sxs-lookup"><span data-stu-id="79aad-154">Configure Hive policies for domain-joined HDInsight clusters</span></span>](apache-domain-joined-run-hive.md)
* [<span data-ttu-id="79aad-155">Manage domain-joined HDInsight clusters</span><span class="sxs-lookup"><span data-stu-id="79aad-155">Manage domain-joined HDInsight clusters</span></span>](apache-domain-joined-manage.md) 
