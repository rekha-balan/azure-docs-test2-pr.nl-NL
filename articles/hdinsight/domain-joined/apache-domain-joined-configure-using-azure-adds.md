---
title: Configure a domain-joined HDInsight cluster by using Azure AD DS
description: Learn how to set up and configure a domain-joined HDInsight cluster by using Azure Active Directory Domain Services
services: hdinsight
ms.service: hdinsight
author: omidm1
ms.author: omidm
ms.reviewer: jasonh
ms.topic: conceptual
ms.date: 07/17/2018
ms.openlocfilehash: 17924b0a00f4605d41492768b0124c583664aca6
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44869756"
---
# <a name="configure-a-domain-joined-hdinsight-cluster-by-using-azure-active-directory-domain-services"></a><span data-ttu-id="c3022-103">Configure a domain-joined HDInsight cluster by using Azure Active Directory Domain Services</span><span class="sxs-lookup"><span data-stu-id="c3022-103">Configure a domain-joined HDInsight cluster by using Azure Active Directory Domain Services</span></span>

<span data-ttu-id="c3022-104">Domain-joined clusters provide multiuser access on Azure HDInsight clusters.</span><span class="sxs-lookup"><span data-stu-id="c3022-104">Domain-joined clusters provide multiuser access on Azure HDInsight clusters.</span></span> <span data-ttu-id="c3022-105">Domain-joined HDInsight clusters are connected to a domain so that domain users can use their domain credentials to authenticate with the clusters and run big data jobs.</span><span class="sxs-lookup"><span data-stu-id="c3022-105">Domain-joined HDInsight clusters are connected to a domain so that domain users can use their domain credentials to authenticate with the clusters and run big data jobs.</span></span> 

<span data-ttu-id="c3022-106">In this article, you learn how to configure a domain-joined HDInsight cluster by using Azure Active Directory Domain Services (Azure AD DS).</span><span class="sxs-lookup"><span data-stu-id="c3022-106">In this article, you learn how to configure a domain-joined HDInsight cluster by using Azure Active Directory Domain Services (Azure AD DS).</span></span>

## <a name="enable-azure-ad-ds"></a><span data-ttu-id="c3022-107">Enable Azure AD DS</span><span class="sxs-lookup"><span data-stu-id="c3022-107">Enable Azure AD DS</span></span>

<span data-ttu-id="c3022-108">Enabling Azure AD DS is a prerequisite before you can create a domain-joined HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="c3022-108">Enabling Azure AD DS is a prerequisite before you can create a domain-joined HDInsight cluster.</span></span> <span data-ttu-id="c3022-109">For more information, see [Enable Azure Active Directory Domain Services using the Azure portal](../../active-directory-domain-services/active-directory-ds-getting-started.md).</span><span class="sxs-lookup"><span data-stu-id="c3022-109">For more information, see [Enable Azure Active Directory Domain Services using the Azure portal](../../active-directory-domain-services/active-directory-ds-getting-started.md).</span></span> 

> [!NOTE]
> <span data-ttu-id="c3022-110">Only tenant administrators have the privileges to create an Azure AD DS instance.</span><span class="sxs-lookup"><span data-stu-id="c3022-110">Only tenant administrators have the privileges to create an Azure AD DS instance.</span></span> <span data-ttu-id="c3022-111">If you use Azure Data Lake Storage Gen1 as the default storage for HDInsight, make sure that the default Azure AD tenant for Data Lake Storage Gen1 is same as the domain for the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="c3022-111">If you use Azure Data Lake Storage Gen1 as the default storage for HDInsight, make sure that the default Azure AD tenant for Data Lake Storage Gen1 is same as the domain for the HDInsight cluster.</span></span> <span data-ttu-id="c3022-112">Because Hadoop relies on Kerberos and basic authentication, multi-factor authentication needs to be disabled for users who will access the cluster.</span><span class="sxs-lookup"><span data-stu-id="c3022-112">Because Hadoop relies on Kerberos and basic authentication, multi-factor authentication needs to be disabled for users who will access the cluster.</span></span>

<span data-ttu-id="c3022-113">After you provision the Azure AD DS instance, create a service account in Azure Active Directory (Azure AD) with the right permissions.</span><span class="sxs-lookup"><span data-stu-id="c3022-113">After you provision the Azure AD DS instance, create a service account in Azure Active Directory (Azure AD) with the right permissions.</span></span> <span data-ttu-id="c3022-114">If this service account already exists, reset its password and wait until it syncs to Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="c3022-114">If this service account already exists, reset its password and wait until it syncs to Azure AD DS.</span></span> <span data-ttu-id="c3022-115">This reset will result in the creation of the Kerberos password hash, and it might take up to 30 minutes to sync to Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="c3022-115">This reset will result in the creation of the Kerberos password hash, and it might take up to 30 minutes to sync to Azure AD DS.</span></span> 

<span data-ttu-id="c3022-116">The service account needs the following privileges:</span><span class="sxs-lookup"><span data-stu-id="c3022-116">The service account needs the following privileges:</span></span>

- <span data-ttu-id="c3022-117">Join machines to the domain and place machine principals within the OU that you specify during cluster creation.</span><span class="sxs-lookup"><span data-stu-id="c3022-117">Join machines to the domain and place machine principals within the OU that you specify during cluster creation.</span></span>
- <span data-ttu-id="c3022-118">Create service principals within the OU that you specify during cluster creation.</span><span class="sxs-lookup"><span data-stu-id="c3022-118">Create service principals within the OU that you specify during cluster creation.</span></span>

> [!NOTE]
> <span data-ttu-id="c3022-119">Because Apache Zeppelin uses the domain name to authenticate the administrative service account, the service account *must* have the same domain name as its UPN suffix for Apache Zeppelin to function properly.</span><span class="sxs-lookup"><span data-stu-id="c3022-119">Because Apache Zeppelin uses the domain name to authenticate the administrative service account, the service account *must* have the same domain name as its UPN suffix for Apache Zeppelin to function properly.</span></span>

<span data-ttu-id="c3022-120">To learn more about OUs and how to manage them, see [Create an OU on an Azure AD DS managed domain](../../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md).</span><span class="sxs-lookup"><span data-stu-id="c3022-120">To learn more about OUs and how to manage them, see [Create an OU on an Azure AD DS managed domain](../../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md).</span></span> 

<span data-ttu-id="c3022-121">Secure LDAP is for an Azure AD DS managed domain.</span><span class="sxs-lookup"><span data-stu-id="c3022-121">Secure LDAP is for an Azure AD DS managed domain.</span></span> <span data-ttu-id="c3022-122">For more information, see [Configure secure LDAP for an Azure AD DS managed domain](../../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md).</span><span class="sxs-lookup"><span data-stu-id="c3022-122">For more information, see [Configure secure LDAP for an Azure AD DS managed domain](../../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md).</span></span>

## <a name="create-a-domain-joined-hdinsight-cluster"></a><span data-ttu-id="c3022-123">Create a domain-joined HDInsight cluster</span><span class="sxs-lookup"><span data-stu-id="c3022-123">Create a domain-joined HDInsight cluster</span></span>

<span data-ttu-id="c3022-124">The next step is to create the HDInsight cluster by using Azure AD DS and the service account that you created in the previous section.</span><span class="sxs-lookup"><span data-stu-id="c3022-124">The next step is to create the HDInsight cluster by using Azure AD DS and the service account that you created in the previous section.</span></span>

<span data-ttu-id="c3022-125">It's easier to place both the Azure AD DS instance and the HDInsight cluster in the same Azure virtual network.</span><span class="sxs-lookup"><span data-stu-id="c3022-125">It's easier to place both the Azure AD DS instance and the HDInsight cluster in the same Azure virtual network.</span></span> <span data-ttu-id="c3022-126">If you choose to put them in different virtual networks, you must peer those virtual networks so that HDInsight VMs have a line of sight to the domain controller for joining the VMs.</span><span class="sxs-lookup"><span data-stu-id="c3022-126">If you choose to put them in different virtual networks, you must peer those virtual networks so that HDInsight VMs have a line of sight to the domain controller for joining the VMs.</span></span> <span data-ttu-id="c3022-127">For more information, see [Virtual network peering](../../virtual-network/virtual-network-peering-overview.md).</span><span class="sxs-lookup"><span data-stu-id="c3022-127">For more information, see [Virtual network peering](../../virtual-network/virtual-network-peering-overview.md).</span></span>

<span data-ttu-id="c3022-128">When you create a domain-joined HDInsight cluster, you must supply the following parameters:</span><span class="sxs-lookup"><span data-stu-id="c3022-128">When you create a domain-joined HDInsight cluster, you must supply the following parameters:</span></span>

- <span data-ttu-id="c3022-129">**Domain name**: The domain name that's associated with Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="c3022-129">**Domain name**: The domain name that's associated with Azure AD DS.</span></span> <span data-ttu-id="c3022-130">An example is contoso.onmicrosoft.com.</span><span class="sxs-lookup"><span data-stu-id="c3022-130">An example is contoso.onmicrosoft.com.</span></span>

- <span data-ttu-id="c3022-131">**Domain user name**: The service account in the Azure ADDS DC managed domain that you created in the previous section.</span><span class="sxs-lookup"><span data-stu-id="c3022-131">**Domain user name**: The service account in the Azure ADDS DC managed domain that you created in the previous section.</span></span> <span data-ttu-id="c3022-132">An example is hdiadmin@contoso.onmicrosoft.com.</span><span class="sxs-lookup"><span data-stu-id="c3022-132">An example is hdiadmin@contoso.onmicrosoft.com.</span></span> <span data-ttu-id="c3022-133">This domain user will be the administrator of this HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="c3022-133">This domain user will be the administrator of this HDInsight cluster.</span></span>

- <span data-ttu-id="c3022-134">**Domain password**: The password of the service account.</span><span class="sxs-lookup"><span data-stu-id="c3022-134">**Domain password**: The password of the service account.</span></span>

- <span data-ttu-id="c3022-135">**Organizational unit**: The distinguished name of the OU that you want to use with the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="c3022-135">**Organizational unit**: The distinguished name of the OU that you want to use with the HDInsight cluster.</span></span> <span data-ttu-id="c3022-136">An example is OU=HDInsightOU,DC=contoso,DC=onmicrosoft,DC=com.</span><span class="sxs-lookup"><span data-stu-id="c3022-136">An example is OU=HDInsightOU,DC=contoso,DC=onmicrosoft,DC=com.</span></span> <span data-ttu-id="c3022-137">If this OU does not exist, the HDInsight cluster tries to create the OU by using the privileges that the service account has.</span><span class="sxs-lookup"><span data-stu-id="c3022-137">If this OU does not exist, the HDInsight cluster tries to create the OU by using the privileges that the service account has.</span></span> <span data-ttu-id="c3022-138">For example, if the service account is in the Azure AD DS Administrators group, it has the right permissions to create an OU.</span><span class="sxs-lookup"><span data-stu-id="c3022-138">For example, if the service account is in the Azure AD DS Administrators group, it has the right permissions to create an OU.</span></span> <span data-ttu-id="c3022-139">Otherwise, you need to create the OU first and give the service account full control over that OU.</span><span class="sxs-lookup"><span data-stu-id="c3022-139">Otherwise, you need to create the OU first and give the service account full control over that OU.</span></span> <span data-ttu-id="c3022-140">For more information, see [Create an OU on an Azure AD DS managed domain](../../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md).</span><span class="sxs-lookup"><span data-stu-id="c3022-140">For more information, see [Create an OU on an Azure AD DS managed domain](../../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md).</span></span>

    > [!IMPORTANT]
    > <span data-ttu-id="c3022-141">Include all of the DCs, separated by commas, after the OU (for example, OU=HDInsightOU,DC=contoso,DC=onmicrosoft,DC=com).</span><span class="sxs-lookup"><span data-stu-id="c3022-141">Include all of the DCs, separated by commas, after the OU (for example, OU=HDInsightOU,DC=contoso,DC=onmicrosoft,DC=com).</span></span>

- <span data-ttu-id="c3022-142">**LDAPS URL**: An example is ldaps://contoso.onmicrosoft.com:636.</span><span class="sxs-lookup"><span data-stu-id="c3022-142">**LDAPS URL**: An example is ldaps://contoso.onmicrosoft.com:636.</span></span>

    > [!IMPORTANT]
    > <span data-ttu-id="c3022-143">Enter the complete URL, including "ldaps://" and the port number (:636).</span><span class="sxs-lookup"><span data-stu-id="c3022-143">Enter the complete URL, including "ldaps://" and the port number (:636).</span></span>

- <span data-ttu-id="c3022-144">**Access user group**: The security groups whose users you want to sync to the cluster.</span><span class="sxs-lookup"><span data-stu-id="c3022-144">**Access user group**: The security groups whose users you want to sync to the cluster.</span></span> <span data-ttu-id="c3022-145">For example, HiveUsers.</span><span class="sxs-lookup"><span data-stu-id="c3022-145">For example, HiveUsers.</span></span> <span data-ttu-id="c3022-146">If you want to specify multiple user groups, separate them by semicolon ‘;’.</span><span class="sxs-lookup"><span data-stu-id="c3022-146">If you want to specify multiple user groups, separate them by semicolon ‘;’.</span></span> <span data-ttu-id="c3022-147">The group(s) must exist in the directory prior to provisioning.</span><span class="sxs-lookup"><span data-stu-id="c3022-147">The group(s) must exist in the directory prior to provisioning.</span></span> <span data-ttu-id="c3022-148">For more information, see [Create a group and add members in Azure Active Directory](../../active-directory/fundamentals/active-directory-groups-create-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="c3022-148">For more information, see [Create a group and add members in Azure Active Directory](../../active-directory/fundamentals/active-directory-groups-create-azure-portal.md).</span></span> <span data-ttu-id="c3022-149">If the group does not exist, an error occurs: "Group HiveUsers not found in the Active Directory."</span><span class="sxs-lookup"><span data-stu-id="c3022-149">If the group does not exist, an error occurs: "Group HiveUsers not found in the Active Directory."</span></span>

<span data-ttu-id="c3022-150">The following screenshot shows the configurations in the Azure portal:</span><span class="sxs-lookup"><span data-stu-id="c3022-150">The following screenshot shows the configurations in the Azure portal:</span></span>

   ![Azure HDInsight domain-joined Active Directory Domain Services configuration](./media/apache-domain-joined-configure-using-azure-adds/hdinsight-domain-joined-configuration-azure-aads-portal.png)<span data-ttu-id="c3022-152">.</span><span class="sxs-lookup"><span data-stu-id="c3022-152">.</span></span>


## <a name="next-steps"></a><span data-ttu-id="c3022-153">Next steps</span><span class="sxs-lookup"><span data-stu-id="c3022-153">Next steps</span></span>
* <span data-ttu-id="c3022-154">For configuring Hive policies and running Hive queries, see [Configure Hive policies for domain-joined HDInsight clusters](apache-domain-joined-run-hive.md).</span><span class="sxs-lookup"><span data-stu-id="c3022-154">For configuring Hive policies and running Hive queries, see [Configure Hive policies for domain-joined HDInsight clusters](apache-domain-joined-run-hive.md).</span></span>
* <span data-ttu-id="c3022-155">For using SSH to connect to domain-joined HDInsight clusters, see [Use SSH with Linux-based Hadoop on HDInsight from Linux, Unix, or OS X](../hdinsight-hadoop-linux-use-ssh-unix.md#domainjoined).</span><span class="sxs-lookup"><span data-stu-id="c3022-155">For using SSH to connect to domain-joined HDInsight clusters, see [Use SSH with Linux-based Hadoop on HDInsight from Linux, Unix, or OS X](../hdinsight-hadoop-linux-use-ssh-unix.md#domainjoined).</span></span>

