---
title: Domain-joined Azure HDInsight architecture| Microsoft Docs
description: Learn how to plan domain-joined HDInsight.
services: hdinsight
documentationcenter: ''
author: saurinsh
manager: jhubbard
editor: cgronlun
tags: azure-portal
ms.assetid: 7dc6847d-10d4-4b5c-9c83-cc513cf91965
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 02/03/2017
ms.author: saurinsh
ms.openlocfilehash: 95f9f568b4233428ed2fa75bcbad45f12adae2f2
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44669682"
---
# <a name="plan-azure-domain-joined-hadoop-clusters-in-hdinsight"></a><span data-ttu-id="17f04-103">Plan Azure domain-joined Hadoop clusters in HDInsight</span><span class="sxs-lookup"><span data-stu-id="17f04-103">Plan Azure domain-joined Hadoop clusters in HDInsight</span></span>

<span data-ttu-id="17f04-104">The traditional Hadoop is a single-user cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-104">The traditional Hadoop is a single-user cluster.</span></span> <span data-ttu-id="17f04-105">It is suitable for most companies that have smaller application teams building large data workloads.</span><span class="sxs-lookup"><span data-stu-id="17f04-105">It is suitable for most companies that have smaller application teams building large data workloads.</span></span> <span data-ttu-id="17f04-106">As Hadoop gains popularity, many enterprises are moving toward a model in which clusters are managed by IT teams and multiple application teams share clusters.</span><span class="sxs-lookup"><span data-stu-id="17f04-106">As Hadoop gains popularity, many enterprises are moving toward a model in which clusters are managed by IT teams and multiple application teams share clusters.</span></span> <span data-ttu-id="17f04-107">Thus, functionalities involving multiuser clusters are among the most requested functionalities in Azure HDInsight.</span><span class="sxs-lookup"><span data-stu-id="17f04-107">Thus, functionalities involving multiuser clusters are among the most requested functionalities in Azure HDInsight.</span></span>

<span data-ttu-id="17f04-108">Instead of building its own multiuser authentication and authorization, HDInsight relies on the most popular identity provider--Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="17f04-108">Instead of building its own multiuser authentication and authorization, HDInsight relies on the most popular identity provider--Azure Active Directory (Azure AD).</span></span> <span data-ttu-id="17f04-109">The powerful security functionality in Azure AD can be used to manage multiuser authorization in HDInsight.</span><span class="sxs-lookup"><span data-stu-id="17f04-109">The powerful security functionality in Azure AD can be used to manage multiuser authorization in HDInsight.</span></span> <span data-ttu-id="17f04-110">By integrating HDInsight with Azure AD, you can communicate with the clusters by using your Azure AD credentials.</span><span class="sxs-lookup"><span data-stu-id="17f04-110">By integrating HDInsight with Azure AD, you can communicate with the clusters by using your Azure AD credentials.</span></span> <span data-ttu-id="17f04-111">HDInsight maps an Azure AD user to a local Hadoop user, so all the services running on HDInsight (Ambari, Hive server, Ranger, Spark thrift server, and others) work seamlessly for the authenticated user.</span><span class="sxs-lookup"><span data-stu-id="17f04-111">HDInsight maps an Azure AD user to a local Hadoop user, so all the services running on HDInsight (Ambari, Hive server, Ranger, Spark thrift server, and others) work seamlessly for the authenticated user.</span></span>

## <a name="integrate-hdinsight-with-azure-ad"></a><span data-ttu-id="17f04-112">Integrate HDInsight with Azure AD</span><span class="sxs-lookup"><span data-stu-id="17f04-112">Integrate HDInsight with Azure AD</span></span>

<span data-ttu-id="17f04-113">By integrating HDInsight with Azure AD, the HDInsight cluster nodes are domain-joined to the Azure AD domain.</span><span class="sxs-lookup"><span data-stu-id="17f04-113">By integrating HDInsight with Azure AD, the HDInsight cluster nodes are domain-joined to the Azure AD domain.</span></span> <span data-ttu-id="17f04-114">HDInsight creates service principals for the Hadoop services running on the cluster and places them within a specified organizational unit (OU) in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17f04-114">HDInsight creates service principals for the Hadoop services running on the cluster and places them within a specified organizational unit (OU) in Azure AD.</span></span> <span data-ttu-id="17f04-115">HDInsight also creates reverse DNS mappings in the Azure AD domain for the IP addresses of the nodes that are joined to the domain.</span><span class="sxs-lookup"><span data-stu-id="17f04-115">HDInsight also creates reverse DNS mappings in the Azure AD domain for the IP addresses of the nodes that are joined to the domain.</span></span>

<span data-ttu-id="17f04-116">You can achieve this setup by using multiple architectures.</span><span class="sxs-lookup"><span data-stu-id="17f04-116">You can achieve this setup by using multiple architectures.</span></span> <span data-ttu-id="17f04-117">You can choose from the following architectures.</span><span class="sxs-lookup"><span data-stu-id="17f04-117">You can choose from the following architectures.</span></span>

<span data-ttu-id="17f04-118">**HDInsight integrated with Azure AD running on Azure IaaS**</span><span class="sxs-lookup"><span data-stu-id="17f04-118">**HDInsight integrated with Azure AD running on Azure IaaS**</span></span>

<span data-ttu-id="17f04-119">This is the simplest architecture for integrating HDInsight with Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17f04-119">This is the simplest architecture for integrating HDInsight with Azure AD.</span></span> <span data-ttu-id="17f04-120">The Azure AD domain controller runs on one (or multiple) virtual machines (VMs) in Azure.</span><span class="sxs-lookup"><span data-stu-id="17f04-120">The Azure AD domain controller runs on one (or multiple) virtual machines (VMs) in Azure.</span></span> <span data-ttu-id="17f04-121">These VMs are usually in a virtual network.</span><span class="sxs-lookup"><span data-stu-id="17f04-121">These VMs are usually in a virtual network.</span></span> <span data-ttu-id="17f04-122">You set up another virtual network for the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-122">You set up another virtual network for the HDInsight cluster.</span></span> <span data-ttu-id="17f04-123">For HDInsight to have a line of sight to Azure AD, you need to peer these virtual networks by using [VNet-to-VNet peering](../virtual-network/virtual-networks-create-vnetpeering-arm-portal.md).</span><span class="sxs-lookup"><span data-stu-id="17f04-123">For HDInsight to have a line of sight to Azure AD, you need to peer these virtual networks by using [VNet-to-VNet peering](../virtual-network/virtual-networks-create-vnetpeering-arm-portal.md).</span></span>

![Domain-join HDInsight cluster topology](https://docstestmedia1.blob.core.windows.net/azure-media/articles/hdinsight/media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_1.png)

> [!NOTE]
> <span data-ttu-id="17f04-125">In this architecture, you cannot use Azure Data Lake Store with the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-125">In this architecture, you cannot use Azure Data Lake Store with the HDInsight cluster.</span></span>


<span data-ttu-id="17f04-126">Prerequisites for Azure AD:</span><span class="sxs-lookup"><span data-stu-id="17f04-126">Prerequisites for Azure AD:</span></span>

* <span data-ttu-id="17f04-127">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created, within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-127">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created, within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span></span>
* <span data-ttu-id="17f04-128">[Lightweight Directory Access Protocols](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) (LDAPs) must be set up for communicating with Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17f04-128">[Lightweight Directory Access Protocols](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) (LDAPs) must be set up for communicating with Azure AD.</span></span> <span data-ttu-id="17f04-129">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span><span class="sxs-lookup"><span data-stu-id="17f04-129">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="17f04-130">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span><span class="sxs-lookup"><span data-stu-id="17f04-130">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span></span>
* <span data-ttu-id="17f04-131">A service account or a user account is needed.</span><span class="sxs-lookup"><span data-stu-id="17f04-131">A service account or a user account is needed.</span></span> <span data-ttu-id="17f04-132">Use this account to create the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-132">Use this account to create the HDInsight cluster.</span></span> <span data-ttu-id="17f04-133">This account must have the following permissions:</span><span class="sxs-lookup"><span data-stu-id="17f04-133">This account must have the following permissions:</span></span>

    - <span data-ttu-id="17f04-134">Permissions to create service principal objects and machine objects within the organizational unit</span><span class="sxs-lookup"><span data-stu-id="17f04-134">Permissions to create service principal objects and machine objects within the organizational unit</span></span>
    - <span data-ttu-id="17f04-135">Permissions to create reverse DNS proxy rules</span><span class="sxs-lookup"><span data-stu-id="17f04-135">Permissions to create reverse DNS proxy rules</span></span>
    - <span data-ttu-id="17f04-136">Permissions to join machines to the Active Directory domain</span><span class="sxs-lookup"><span data-stu-id="17f04-136">Permissions to join machines to the Active Directory domain</span></span>

<span data-ttu-id="17f04-137">**HDInsight integrated with cloud-only Azure AD**</span><span class="sxs-lookup"><span data-stu-id="17f04-137">**HDInsight integrated with cloud-only Azure AD**</span></span>

<span data-ttu-id="17f04-138">For cloud-only Azure AD, configure a domain controller so that HDInsight can be integrated with Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17f04-138">For cloud-only Azure AD, configure a domain controller so that HDInsight can be integrated with Azure AD.</span></span> <span data-ttu-id="17f04-139">This is achieved by using [Azure Active Directory Domain Dervices](../active-directory-domain-services/active-directory-ds-overview.md) (Azure AD DS).</span><span class="sxs-lookup"><span data-stu-id="17f04-139">This is achieved by using [Azure Active Directory Domain Dervices](../active-directory-domain-services/active-directory-ds-overview.md) (Azure AD DS).</span></span> <span data-ttu-id="17f04-140">Azure AD DS creates domain controller machines on the cloud and provides IP addresses for them.</span><span class="sxs-lookup"><span data-stu-id="17f04-140">Azure AD DS creates domain controller machines on the cloud and provides IP addresses for them.</span></span> <span data-ttu-id="17f04-141">It creates two domain controllers for high availability.</span><span class="sxs-lookup"><span data-stu-id="17f04-141">It creates two domain controllers for high availability.</span></span>

<span data-ttu-id="17f04-142">Currently, Azure AD DS exists only in classic virtual networks.</span><span class="sxs-lookup"><span data-stu-id="17f04-142">Currently, Azure AD DS exists only in classic virtual networks.</span></span> <span data-ttu-id="17f04-143">It is only accessible by using the Azure classic portal.</span><span class="sxs-lookup"><span data-stu-id="17f04-143">It is only accessible by using the Azure classic portal.</span></span> <span data-ttu-id="17f04-144">The HDInsight virtual network exists in the Azure portal, which needs to be peered with the classic virtual network by using VNet-to-VNet peering.</span><span class="sxs-lookup"><span data-stu-id="17f04-144">The HDInsight virtual network exists in the Azure portal, which needs to be peered with the classic virtual network by using VNet-to-VNet peering.</span></span>

> [!NOTE]
> <span data-ttu-id="17f04-145">Peering between a classic virtual network and an Azure Resource Manager virtual network requires that both virtual networks are in the same region and under the same Azure subscription.</span><span class="sxs-lookup"><span data-stu-id="17f04-145">Peering between a classic virtual network and an Azure Resource Manager virtual network requires that both virtual networks are in the same region and under the same Azure subscription.</span></span>

![Domain-join HDInsight cluster topology](https://docstestmedia1.blob.core.windows.net/azure-media/articles/hdinsight/media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_2.png)

<span data-ttu-id="17f04-147">Prerequisites for Azure AD:</span><span class="sxs-lookup"><span data-stu-id="17f04-147">Prerequisites for Azure AD:</span></span>

* <span data-ttu-id="17f04-148">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-148">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span></span>
* <span data-ttu-id="17f04-149">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up when you configure Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="17f04-149">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up when you configure Azure AD DS.</span></span> <span data-ttu-id="17f04-150">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span><span class="sxs-lookup"><span data-stu-id="17f04-150">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="17f04-151">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span><span class="sxs-lookup"><span data-stu-id="17f04-151">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span></span>
* <span data-ttu-id="17f04-152">[Password hashes](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) must be synced from Azure AD to Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="17f04-152">[Password hashes](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) must be synced from Azure AD to Azure AD DS.</span></span>
* <span data-ttu-id="17f04-153">A service account or a user account is needed.</span><span class="sxs-lookup"><span data-stu-id="17f04-153">A service account or a user account is needed.</span></span> <span data-ttu-id="17f04-154">Use this account to create the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-154">Use this account to create the HDInsight cluster.</span></span> <span data-ttu-id="17f04-155">This account must have the following permissions:</span><span class="sxs-lookup"><span data-stu-id="17f04-155">This account must have the following permissions:</span></span>

    - <span data-ttu-id="17f04-156">Permissions to create service principal objects and machine objects within the organizational unit</span><span class="sxs-lookup"><span data-stu-id="17f04-156">Permissions to create service principal objects and machine objects within the organizational unit</span></span>
    - <span data-ttu-id="17f04-157">Permissions to create reverse DNS proxy rules</span><span class="sxs-lookup"><span data-stu-id="17f04-157">Permissions to create reverse DNS proxy rules</span></span>
    - <span data-ttu-id="17f04-158">Permissions to join machines to the Azure AD domain</span><span class="sxs-lookup"><span data-stu-id="17f04-158">Permissions to join machines to the Azure AD domain</span></span>

<span data-ttu-id="17f04-159">**HDInsight integrated with an on-premises Active Directory via VPN**</span><span class="sxs-lookup"><span data-stu-id="17f04-159">**HDInsight integrated with an on-premises Active Directory via VPN**</span></span>

<span data-ttu-id="17f04-160">This architecture is similar to HDInsight integrated with Azure AD running on Azure IaaS.</span><span class="sxs-lookup"><span data-stu-id="17f04-160">This architecture is similar to HDInsight integrated with Azure AD running on Azure IaaS.</span></span> <span data-ttu-id="17f04-161">The only difference is that Azure AD is on-premises and the line of sight for HDInsight to Azure AD is via a [VPN connection from Azure to an on-premises network](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="17f04-161">The only difference is that Azure AD is on-premises and the line of sight for HDInsight to Azure AD is via a [VPN connection from Azure to an on-premises network](../expressroute/expressroute-introduction.md).</span></span>

![Domain-join HDInsight cluster topology](https://docstestmedia1.blob.core.windows.net/azure-media/articles/hdinsight/media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_3.png)

> [!NOTE]
> <span data-ttu-id="17f04-163">In this architecture, you cannot use Azure Data Lake Store with the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-163">In this architecture, you cannot use Azure Data Lake Store with the HDInsight cluster.</span></span>

<span data-ttu-id="17f04-164">Prerequisites for Azure AD:</span><span class="sxs-lookup"><span data-stu-id="17f04-164">Prerequisites for Azure AD:</span></span>

* <span data-ttu-id="17f04-165">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created, within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-165">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created, within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span></span>
* <span data-ttu-id="17f04-166">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up for communicating with Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17f04-166">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up for communicating with Azure AD.</span></span> <span data-ttu-id="17f04-167">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span><span class="sxs-lookup"><span data-stu-id="17f04-167">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="17f04-168">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span><span class="sxs-lookup"><span data-stu-id="17f04-168">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span></span>
* <span data-ttu-id="17f04-169">A service account or a user account is needed.</span><span class="sxs-lookup"><span data-stu-id="17f04-169">A service account or a user account is needed.</span></span> <span data-ttu-id="17f04-170">Use this account to create the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-170">Use this account to create the HDInsight cluster.</span></span> <span data-ttu-id="17f04-171">This account must have the following permissions:</span><span class="sxs-lookup"><span data-stu-id="17f04-171">This account must have the following permissions:</span></span>

    - <span data-ttu-id="17f04-172">Permissions to create service principal objects and machine objects within the organizational unit</span><span class="sxs-lookup"><span data-stu-id="17f04-172">Permissions to create service principal objects and machine objects within the organizational unit</span></span>
    - <span data-ttu-id="17f04-173">Permissions to create reverse DNS proxy rules</span><span class="sxs-lookup"><span data-stu-id="17f04-173">Permissions to create reverse DNS proxy rules</span></span>
    - <span data-ttu-id="17f04-174">Permissions to join machines to the Azure AD domain</span><span class="sxs-lookup"><span data-stu-id="17f04-174">Permissions to join machines to the Azure AD domain</span></span>

<span data-ttu-id="17f04-175">**HDInsight integrated with an on-premises Active Directory synced to Azure AD**</span><span class="sxs-lookup"><span data-stu-id="17f04-175">**HDInsight integrated with an on-premises Active Directory synced to Azure AD**</span></span>

<span data-ttu-id="17f04-176">This architecture is similar to HDInsight integrated with cloud-only Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17f04-176">This architecture is similar to HDInsight integrated with cloud-only Azure AD.</span></span> <span data-ttu-id="17f04-177">The only difference is that the on-premises Active Directory is synced to the Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17f04-177">The only difference is that the on-premises Active Directory is synced to the Azure AD.</span></span> <span data-ttu-id="17f04-178">Configure a domain controller in the cloud so that HDInsight can be integrated with Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17f04-178">Configure a domain controller in the cloud so that HDInsight can be integrated with Azure AD.</span></span> <span data-ttu-id="17f04-179">This is achieved by using [Azure Active Directory Domain Services](../active-directory-domain-services/active-directory-ds-overview.md).</span><span class="sxs-lookup"><span data-stu-id="17f04-179">This is achieved by using [Azure Active Directory Domain Services](../active-directory-domain-services/active-directory-ds-overview.md).</span></span> <span data-ttu-id="17f04-180">Azure AD DS creates domain controller machines in the cloud and provides IP addresses for them.</span><span class="sxs-lookup"><span data-stu-id="17f04-180">Azure AD DS creates domain controller machines in the cloud and provides IP addresses for them.</span></span> <span data-ttu-id="17f04-181">It creates two domain controllers for high availability.</span><span class="sxs-lookup"><span data-stu-id="17f04-181">It creates two domain controllers for high availability.</span></span>

<span data-ttu-id="17f04-182">Currently, Azure AD DS exists only in classic virtual networks.</span><span class="sxs-lookup"><span data-stu-id="17f04-182">Currently, Azure AD DS exists only in classic virtual networks.</span></span> <span data-ttu-id="17f04-183">It is only accessible by using the Azure classic portal.</span><span class="sxs-lookup"><span data-stu-id="17f04-183">It is only accessible by using the Azure classic portal.</span></span> <span data-ttu-id="17f04-184">The HDInsight virtual network exists in the Azure portal, which needs to be peered with the classic virtual network by using VNet-to-VNet peering.</span><span class="sxs-lookup"><span data-stu-id="17f04-184">The HDInsight virtual network exists in the Azure portal, which needs to be peered with the classic virtual network by using VNet-to-VNet peering.</span></span>

> [!NOTE]
> <span data-ttu-id="17f04-185">Peering between a classic virtual network and an Azure Resource Manager virtual network requires that both virtual networks are in the same region and are under the same Azure subscription.</span><span class="sxs-lookup"><span data-stu-id="17f04-185">Peering between a classic virtual network and an Azure Resource Manager virtual network requires that both virtual networks are in the same region and are under the same Azure subscription.</span></span>

![Domain-join HDInsight cluster topology](https://docstestmedia1.blob.core.windows.net/azure-media/articles/hdinsight/media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_2.png)

<span data-ttu-id="17f04-187">Prerequisites for Azure AD:</span><span class="sxs-lookup"><span data-stu-id="17f04-187">Prerequisites for Azure AD:</span></span>

* <span data-ttu-id="17f04-188">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-188">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span></span>
* <span data-ttu-id="17f04-189">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up when you configure Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="17f04-189">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up when you configure Azure AD DS.</span></span> <span data-ttu-id="17f04-190">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span><span class="sxs-lookup"><span data-stu-id="17f04-190">The certificate used to set up LDAPS must be a real certificate (not a self-signed certificate).</span></span>
* <span data-ttu-id="17f04-191">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span><span class="sxs-lookup"><span data-stu-id="17f04-191">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span></span>
* <span data-ttu-id="17f04-192">[Password hashes](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) must be synced from Azure AD to Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="17f04-192">[Password hashes](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) must be synced from Azure AD to Azure AD DS.</span></span>
* <span data-ttu-id="17f04-193">A service account or a user account is needed.</span><span class="sxs-lookup"><span data-stu-id="17f04-193">A service account or a user account is needed.</span></span> <span data-ttu-id="17f04-194">Use this account to create the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-194">Use this account to create the HDInsight cluster.</span></span> <span data-ttu-id="17f04-195">This account must have the following permissions:</span><span class="sxs-lookup"><span data-stu-id="17f04-195">This account must have the following permissions:</span></span>

    - <span data-ttu-id="17f04-196">Permissions to create service principal objects and machine objects within the organizational unit</span><span class="sxs-lookup"><span data-stu-id="17f04-196">Permissions to create service principal objects and machine objects within the organizational unit</span></span>
    - <span data-ttu-id="17f04-197">Permissions to create reverse DNS proxy rules</span><span class="sxs-lookup"><span data-stu-id="17f04-197">Permissions to create reverse DNS proxy rules</span></span>
    - <span data-ttu-id="17f04-198">Permissions to join machines to the Active Directory domain</span><span class="sxs-lookup"><span data-stu-id="17f04-198">Permissions to join machines to the Active Directory domain</span></span>

<span data-ttu-id="17f04-199">**HDInsight integrated with a non-default Azure AD (recommended only for testing and development)**</span><span class="sxs-lookup"><span data-stu-id="17f04-199">**HDInsight integrated with a non-default Azure AD (recommended only for testing and development)**</span></span>

<span data-ttu-id="17f04-200">This architecture is similar to HDInsight integrated with cloud-only Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17f04-200">This architecture is similar to HDInsight integrated with cloud-only Azure AD.</span></span> <span data-ttu-id="17f04-201">For most companies, the admin access to Azure AD is restricted to certain individuals.</span><span class="sxs-lookup"><span data-stu-id="17f04-201">For most companies, the admin access to Azure AD is restricted to certain individuals.</span></span> <span data-ttu-id="17f04-202">Thus, when you want to do a proof-of-concept or try out creating a domain-joined cluster, it may be beneficial to create an Azure AD instance in the subscription instead of waiting for an admin to configure prerequisites on Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17f04-202">Thus, when you want to do a proof-of-concept or try out creating a domain-joined cluster, it may be beneficial to create an Azure AD instance in the subscription instead of waiting for an admin to configure prerequisites on Azure AD.</span></span> <span data-ttu-id="17f04-203">Because this is an Azure AD instance that you created, you have full permissions to Azure AD to configure Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="17f04-203">Because this is an Azure AD instance that you created, you have full permissions to Azure AD to configure Azure AD DS.</span></span>

<span data-ttu-id="17f04-204">Azure AD DS creates domain controller machines on the cloud and provides IP addresses for them.</span><span class="sxs-lookup"><span data-stu-id="17f04-204">Azure AD DS creates domain controller machines on the cloud and provides IP addresses for them.</span></span> <span data-ttu-id="17f04-205">It creates two domain controllers for high availability.</span><span class="sxs-lookup"><span data-stu-id="17f04-205">It creates two domain controllers for high availability.</span></span>

<span data-ttu-id="17f04-206">Azure AD DS exists only in classic virtual networks, so you need access to the Azure classic portal, and you must create a classic virtual network for configuring Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="17f04-206">Azure AD DS exists only in classic virtual networks, so you need access to the Azure classic portal, and you must create a classic virtual network for configuring Azure AD DS.</span></span> <span data-ttu-id="17f04-207">The HDInsight virtual network exists in the Azure portal, which needs to be peered with the classic virtual network by using VNet-to-VNet peering.</span><span class="sxs-lookup"><span data-stu-id="17f04-207">The HDInsight virtual network exists in the Azure portal, which needs to be peered with the classic virtual network by using VNet-to-VNet peering.</span></span>

> [!NOTE]
> <span data-ttu-id="17f04-208">Peering between the classic and Azure Resource Manager virtual networks requires that both virtual networks are in the same region and are under the same Azure subscription.</span><span class="sxs-lookup"><span data-stu-id="17f04-208">Peering between the classic and Azure Resource Manager virtual networks requires that both virtual networks are in the same region and are under the same Azure subscription.</span></span>

![Domain-join HDInsight cluster topology](https://docstestmedia1.blob.core.windows.net/azure-media/articles/hdinsight/media/hdinsight-domain-joined-architecture/hdinsight-domain-joined-architecture_2.png)

<span data-ttu-id="17f04-210">Prerequisites for Azure AD:</span><span class="sxs-lookup"><span data-stu-id="17f04-210">Prerequisites for Azure AD:</span></span>

* <span data-ttu-id="17f04-211">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created, within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-211">An [organizational unit](../active-directory-domain-services/active-directory-ds-admin-guide-create-ou.md) must be created, within which you place the HDInsight cluster VMs and the service principals used by the cluster.</span></span>
* <span data-ttu-id="17f04-212">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up when you configure Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="17f04-212">[LDAPS](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) must be set up when you configure Azure AD DS.</span></span> <span data-ttu-id="17f04-213">You can create a [self-signed certificate](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) to configure LDAPS.</span><span class="sxs-lookup"><span data-stu-id="17f04-213">You can create a [self-signed certificate](../active-directory-domain-services/active-directory-ds-admin-guide-configure-secure-ldap.md) to configure LDAPS.</span></span> <span data-ttu-id="17f04-214">However, to use a self-signed certificate, you must request an exception from <a href="mailto:hdipreview@microsoft.com">hdipreview@microsoft.com</a>.</span><span class="sxs-lookup"><span data-stu-id="17f04-214">However, to use a self-signed certificate, you must request an exception from <a href="mailto:hdipreview@microsoft.com">hdipreview@microsoft.com</a>.</span></span>
* <span data-ttu-id="17f04-215">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span><span class="sxs-lookup"><span data-stu-id="17f04-215">Reverse DNS zones must be created on the domain for the IP address range of the HDInsight subnet (for example, 10.2.0.0/24 in the previous picture).</span></span>
* <span data-ttu-id="17f04-216">[Password hashes](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) must be synced from Azure AD to Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="17f04-216">[Password hashes](../active-directory-domain-services/active-directory-ds-getting-started-password-sync.md) must be synced from Azure AD to Azure AD DS.</span></span>
* <span data-ttu-id="17f04-217">A service account or a user account is needed.</span><span class="sxs-lookup"><span data-stu-id="17f04-217">A service account or a user account is needed.</span></span> <span data-ttu-id="17f04-218">Use this account to create the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="17f04-218">Use this account to create the HDInsight cluster.</span></span> <span data-ttu-id="17f04-219">This account must have the following permissions:</span><span class="sxs-lookup"><span data-stu-id="17f04-219">This account must have the following permissions:</span></span>

    - <span data-ttu-id="17f04-220">Permissions to create service principal objects and machine objects within the organizational unit</span><span class="sxs-lookup"><span data-stu-id="17f04-220">Permissions to create service principal objects and machine objects within the organizational unit</span></span>
    - <span data-ttu-id="17f04-221">Permissions to create reverse DNS proxy rules</span><span class="sxs-lookup"><span data-stu-id="17f04-221">Permissions to create reverse DNS proxy rules</span></span>
    - <span data-ttu-id="17f04-222">Permissions to join machines to the Azure Active Directory domain</span><span class="sxs-lookup"><span data-stu-id="17f04-222">Permissions to join machines to the Azure Active Directory domain</span></span>

## <a name="next-steps"></a><span data-ttu-id="17f04-223">Next steps</span><span class="sxs-lookup"><span data-stu-id="17f04-223">Next steps</span></span>
* <span data-ttu-id="17f04-224">To configure a domain-joined HDInsight cluster, see [Configure domain-joined HDInsight clusters](hdinsight-domain-joined-configure.md).</span><span class="sxs-lookup"><span data-stu-id="17f04-224">To configure a domain-joined HDInsight cluster, see [Configure domain-joined HDInsight clusters](hdinsight-domain-joined-configure.md).</span></span>
* <span data-ttu-id="17f04-225">To manage domain-joined HDInsight clusters, see [Manage domain-joined HDInsight clusters](hdinsight-domain-joined-manage.md).</span><span class="sxs-lookup"><span data-stu-id="17f04-225">To manage domain-joined HDInsight clusters, see [Manage domain-joined HDInsight clusters](hdinsight-domain-joined-manage.md).</span></span>
* <span data-ttu-id="17f04-226">To configure Hive policies and run Hive queries, see [Configure Hive policies for domain-joined HDInsight clusters](hdinsight-domain-joined-run-hive.md).</span><span class="sxs-lookup"><span data-stu-id="17f04-226">To configure Hive policies and run Hive queries, see [Configure Hive policies for domain-joined HDInsight clusters](hdinsight-domain-joined-run-hive.md).</span></span>
* <span data-ttu-id="17f04-227">To run Hive queries by using SSH on domain-joined HDInsight clusters, see [Use SSH with HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md).</span><span class="sxs-lookup"><span data-stu-id="17f04-227">To run Hive queries by using SSH on domain-joined HDInsight clusters, see [Use SSH with HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md).</span></span>





