---
title: Configure Domain-joined HDInsight clusters using Azure PowerShell| Microsoft Docs
description: Learn how to set up and configure Domain-joined HDInsight clusters using Azure PowerShell
services: hdinsight
documentationcenter: ''
author: saurinsh
manager: jhubbard
editor: cgronlun
tags: ''
ms.assetid: a13b2f7a-612d-4800-bc92-7fc0524f3e89
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 11/02/2016
ms.author: saurinsh
ms.openlocfilehash: e86dbb095f68ca2ac2ef45c03ab21780e387a91c
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44552899"
---
# <a name="configure-domain-joined-hdinsight-clusters-preview-using-azure-powershell"></a><span data-ttu-id="95733-103">Configure Domain-joined HDInsight clusters (Preview) using Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="95733-103">Configure Domain-joined HDInsight clusters (Preview) using Azure PowerShell</span></span>
<span data-ttu-id="95733-104">Learn how to set up an Azure HDInsight cluster with Azure Active Directory (Azure AD) and [Apache Ranger](http://hortonworks.com/apache/ranger/) using Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="95733-104">Learn how to set up an Azure HDInsight cluster with Azure Active Directory (Azure AD) and [Apache Ranger](http://hortonworks.com/apache/ranger/) using Azure PowerShell.</span></span> <span data-ttu-id="95733-105">An Azure PowerShell script is provided to make the configuration faster and less error prone.</span><span class="sxs-lookup"><span data-stu-id="95733-105">An Azure PowerShell script is provided to make the configuration faster and less error prone.</span></span> <span data-ttu-id="95733-106">Domain-joined HDInsight can only be configured on Linux-based clusters.</span><span class="sxs-lookup"><span data-stu-id="95733-106">Domain-joined HDInsight can only be configured on Linux-based clusters.</span></span> <span data-ttu-id="95733-107">For more information, see [Introduce Domain-joined HDInsight clusters](hdinsight-domain-joined-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="95733-107">For more information, see [Introduce Domain-joined HDInsight clusters](hdinsight-domain-joined-introduction.md).</span></span>

<span data-ttu-id="95733-108">A typical Domain-joined HDInsight cluster configuration involves the following steps:</span><span class="sxs-lookup"><span data-stu-id="95733-108">A typical Domain-joined HDInsight cluster configuration involves the following steps:</span></span>

1. <span data-ttu-id="95733-109">Create an Azure classic VNet for your Azure AD.</span><span class="sxs-lookup"><span data-stu-id="95733-109">Create an Azure classic VNet for your Azure AD.</span></span>  
2. <span data-ttu-id="95733-110">Create and configure Azure AD and Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="95733-110">Create and configure Azure AD and Azure AD DS.</span></span>
3. <span data-ttu-id="95733-111">Add a VM to the classic VNet for creating organizational unit.</span><span class="sxs-lookup"><span data-stu-id="95733-111">Add a VM to the classic VNet for creating organizational unit.</span></span> 
4. <span data-ttu-id="95733-112">Create an organizational unit for Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="95733-112">Create an organizational unit for Azure AD DS.</span></span>
5. <span data-ttu-id="95733-113">Create an HDInsight VNet in the Azure resource management mode.</span><span class="sxs-lookup"><span data-stu-id="95733-113">Create an HDInsight VNet in the Azure resource management mode.</span></span>
6. <span data-ttu-id="95733-114">Setup Reverse DNS zones for the Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="95733-114">Setup Reverse DNS zones for the Azure AD DS.</span></span>
7. <span data-ttu-id="95733-115">Peer the two VNets.</span><span class="sxs-lookup"><span data-stu-id="95733-115">Peer the two VNets.</span></span>
8. <span data-ttu-id="95733-116">Create an HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-116">Create an HDInsight cluster.</span></span>

<span data-ttu-id="95733-117">The PowerShell script provided performs steps 3 through 7.</span><span class="sxs-lookup"><span data-stu-id="95733-117">The PowerShell script provided performs steps 3 through 7.</span></span> <span data-ttu-id="95733-118">You must go through step 1 and 2 manually.</span><span class="sxs-lookup"><span data-stu-id="95733-118">You must go through step 1 and 2 manually.</span></span>  <span data-ttu-id="95733-119">If you prefer not to use Azure PowerShell, see [Configure Domain-joined HDInsight clusters](hdinsight-domain-joined-configure.md).</span><span class="sxs-lookup"><span data-stu-id="95733-119">If you prefer not to use Azure PowerShell, see [Configure Domain-joined HDInsight clusters](hdinsight-domain-joined-configure.md).</span></span> 

<span data-ttu-id="95733-120">An example of the final topology looks as follows:</span><span class="sxs-lookup"><span data-stu-id="95733-120">An example of the final topology looks as follows:</span></span>

![Domain-joined HDInsight topology](https://docstestmedia1.blob.core.windows.net/azure-media/articles/hdinsight/media/hdinsight-domain-joined-configure/hdinsight-domain-joined-topology.png)

<span data-ttu-id="95733-122">Because Azure AD currently only supports classic virtual networks (VNets) and Linux-based HDInsight clusters only support Azure Resource Manager based VNets, HDInsight Azure AD integration requires two VNets and a peering between them.</span><span class="sxs-lookup"><span data-stu-id="95733-122">Because Azure AD currently only supports classic virtual networks (VNets) and Linux-based HDInsight clusters only support Azure Resource Manager based VNets, HDInsight Azure AD integration requires two VNets and a peering between them.</span></span> <span data-ttu-id="95733-123">For the comparison information between the two deployment models, see [Azure Resource Manager vs. classic deployment: Understand deployment models and the state of your resources](../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="95733-123">For the comparison information between the two deployment models, see [Azure Resource Manager vs. classic deployment: Understand deployment models and the state of your resources](../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="95733-124">The two VNets must be in the same region as the Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="95733-124">The two VNets must be in the same region as the Azure AD DS.</span></span>

> [!NOTE]
> <span data-ttu-id="95733-125">This tutorial assumes that you do not have an Azure AD.</span><span class="sxs-lookup"><span data-stu-id="95733-125">This tutorial assumes that you do not have an Azure AD.</span></span> <span data-ttu-id="95733-126">If you have one, you can skip the portion in step 2.</span><span class="sxs-lookup"><span data-stu-id="95733-126">If you have one, you can skip the portion in step 2.</span></span>
> 
> 

## <a name="prerequisites"></a><span data-ttu-id="95733-127">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="95733-127">Prerequisites</span></span>
<span data-ttu-id="95733-128">You must have the following items to go through this tutorial:</span><span class="sxs-lookup"><span data-stu-id="95733-128">You must have the following items to go through this tutorial:</span></span>

* <span data-ttu-id="95733-129">Familiarize yourself with [Azure AD Domain Services](https://azure.microsoft.com/services/active-directory-ds/) its [pricing](https://azure.microsoft.com/pricing/details/active-directory-ds/) structure.</span><span class="sxs-lookup"><span data-stu-id="95733-129">Familiarize yourself with [Azure AD Domain Services](https://azure.microsoft.com/services/active-directory-ds/) its [pricing](https://azure.microsoft.com/pricing/details/active-directory-ds/) structure.</span></span>
* <span data-ttu-id="95733-130">Ensure that your subscription is whitelisted for this public preview.</span><span class="sxs-lookup"><span data-stu-id="95733-130">Ensure that your subscription is whitelisted for this public preview.</span></span> <span data-ttu-id="95733-131">You can do so by sending an email to hdipreview@microsoft.com with your subscription ID.</span><span class="sxs-lookup"><span data-stu-id="95733-131">You can do so by sending an email to hdipreview@microsoft.com with your subscription ID.</span></span>
* <span data-ttu-id="95733-132">An SSL certificate that is signed by a signing authority for your domain.</span><span class="sxs-lookup"><span data-stu-id="95733-132">An SSL certificate that is signed by a signing authority for your domain.</span></span> <span data-ttu-id="95733-133">The certificate is required by configuring secure LDAP.</span><span class="sxs-lookup"><span data-stu-id="95733-133">The certificate is required by configuring secure LDAP.</span></span> <span data-ttu-id="95733-134">Self-signed certificates cannot be used.</span><span class="sxs-lookup"><span data-stu-id="95733-134">Self-signed certificates cannot be used.</span></span>
* <span data-ttu-id="95733-135">Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="95733-135">Azure PowerShell.</span></span>  <span data-ttu-id="95733-136">See [Install and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="95733-136">See [Install and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

## <a name="create-an-azure-classic-vnet-for-your-azure-ad"></a><span data-ttu-id="95733-137">Create an Azure classic VNet for your Azure AD.</span><span class="sxs-lookup"><span data-stu-id="95733-137">Create an Azure classic VNet for your Azure AD.</span></span>
<span data-ttu-id="95733-138">For the instructions, see [here](hdinsight-domain-joined-configure.md#create-an-azure-classic-vnet).</span><span class="sxs-lookup"><span data-stu-id="95733-138">For the instructions, see [here](hdinsight-domain-joined-configure.md#create-an-azure-classic-vnet).</span></span>

## <a name="create-and-configure-azure-ad-and-azure-ad-ds"></a><span data-ttu-id="95733-139">Create and configure Azure AD and Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="95733-139">Create and configure Azure AD and Azure AD DS.</span></span>
<span data-ttu-id="95733-140">For the instructions, see [here](hdinsight-domain-joined-configure.md#create-and-configure-azure-ad-ds-for-your-azure-ad).</span><span class="sxs-lookup"><span data-stu-id="95733-140">For the instructions, see [here](hdinsight-domain-joined-configure.md#create-and-configure-azure-ad-ds-for-your-azure-ad).</span></span>

## <a name="run-the-powershell-script"></a><span data-ttu-id="95733-141">Run the PowerShell script</span><span class="sxs-lookup"><span data-stu-id="95733-141">Run the PowerShell script</span></span>
<span data-ttu-id="95733-142">The PowerShell script can be downloaded from [GitHub](https://github.com/hdinsight/DomainJoinedHDInsight).</span><span class="sxs-lookup"><span data-stu-id="95733-142">The PowerShell script can be downloaded from [GitHub](https://github.com/hdinsight/DomainJoinedHDInsight).</span></span> <span data-ttu-id="95733-143">Extract the zip file and save the files locally.</span><span class="sxs-lookup"><span data-stu-id="95733-143">Extract the zip file and save the files locally.</span></span>

<span data-ttu-id="95733-144">**To edit the PowerShell script**</span><span class="sxs-lookup"><span data-stu-id="95733-144">**To edit the PowerShell script**</span></span>

1. <span data-ttu-id="95733-145">Open run.ps1 using Windows PowerShell ISE or any text editor.</span><span class="sxs-lookup"><span data-stu-id="95733-145">Open run.ps1 using Windows PowerShell ISE or any text editor.</span></span>
2. <span data-ttu-id="95733-146">Fill the values for the following variables:</span><span class="sxs-lookup"><span data-stu-id="95733-146">Fill the values for the following variables:</span></span>
   
   * <span data-ttu-id="95733-147">**$SubscriptionName** – The name of the Azure subscription where you want to create your HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-147">**$SubscriptionName** – The name of the Azure subscription where you want to create your HDInsight cluster.</span></span> <span data-ttu-id="95733-148">You have already created a Classic virtual network in this subscription, and will be creating an Azure Resource Manager virtual network for the HDInsight cluster under subscription.</span><span class="sxs-lookup"><span data-stu-id="95733-148">You have already created a Classic virtual network in this subscription, and will be creating an Azure Resource Manager virtual network for the HDInsight cluster under subscription.</span></span>
   * <span data-ttu-id="95733-149">**$ClassicVNetName** - The classic virtual network which contains the Azure AD DS.</span><span class="sxs-lookup"><span data-stu-id="95733-149">**$ClassicVNetName** - The classic virtual network which contains the Azure AD DS.</span></span> <span data-ttu-id="95733-150">This virtual network must be in the same subscription which is provided above.</span><span class="sxs-lookup"><span data-stu-id="95733-150">This virtual network must be in the same subscription which is provided above.</span></span> <span data-ttu-id="95733-151">This virtual network must be created using the Azure portal, and not using classic portal.</span><span class="sxs-lookup"><span data-stu-id="95733-151">This virtual network must be created using the Azure portal, and not using classic portal.</span></span> <span data-ttu-id="95733-152">If you follow the instruction in [Configure Domain-joined HDInsight clusters (Preview)](hdinsight-domain-joined-configure.md#create-an-azure-classic-vnet), the default name is contosoaadvnet.</span><span class="sxs-lookup"><span data-stu-id="95733-152">If you follow the instruction in [Configure Domain-joined HDInsight clusters (Preview)](hdinsight-domain-joined-configure.md#create-an-azure-classic-vnet), the default name is contosoaadvnet.</span></span>
   * <span data-ttu-id="95733-153">**$ClassicResourceGroupName** – The Resource Manager group name for the classic virtual network that is mentioned above.</span><span class="sxs-lookup"><span data-stu-id="95733-153">**$ClassicResourceGroupName** – The Resource Manager group name for the classic virtual network that is mentioned above.</span></span> <span data-ttu-id="95733-154">For example contosoaadrg.</span><span class="sxs-lookup"><span data-stu-id="95733-154">For example contosoaadrg.</span></span> 
   * <span data-ttu-id="95733-155">**$ArmResourceGroupName** – The resource group name within which, you want to create the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-155">**$ArmResourceGroupName** – The resource group name within which, you want to create the HDInsight cluster.</span></span> <span data-ttu-id="95733-156">You can use the same resource group as $ArmResourceGroupName.</span><span class="sxs-lookup"><span data-stu-id="95733-156">You can use the same resource group as $ArmResourceGroupName.</span></span>  <span data-ttu-id="95733-157">If the resource group does not exist, the script creates the resource group.</span><span class="sxs-lookup"><span data-stu-id="95733-157">If the resource group does not exist, the script creates the resource group.</span></span>
   * <span data-ttu-id="95733-158">**$ArmVNetName** - The Resource Manager virtual network name within which you want to create the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-158">**$ArmVNetName** - The Resource Manager virtual network name within which you want to create the HDInsight cluster.</span></span> <span data-ttu-id="95733-159">This virtual network will be placed into $ArmResourceGroupName.</span><span class="sxs-lookup"><span data-stu-id="95733-159">This virtual network will be placed into $ArmResourceGroupName.</span></span>  <span data-ttu-id="95733-160">If the VNet does not exist, the PowerShell script will create it.</span><span class="sxs-lookup"><span data-stu-id="95733-160">If the VNet does not exist, the PowerShell script will create it.</span></span> <span data-ttu-id="95733-161">If it does exist, it should be part of the resource group that you provide above.</span><span class="sxs-lookup"><span data-stu-id="95733-161">If it does exist, it should be part of the resource group that you provide above.</span></span>
   * <span data-ttu-id="95733-162">**$AddressVnetAddressSpace** – The network address space for the Resource Manager virtual network.</span><span class="sxs-lookup"><span data-stu-id="95733-162">**$AddressVnetAddressSpace** – The network address space for the Resource Manager virtual network.</span></span> <span data-ttu-id="95733-163">Ensure that this address space is available.</span><span class="sxs-lookup"><span data-stu-id="95733-163">Ensure that this address space is available.</span></span> <span data-ttu-id="95733-164">This address space cannot overlap the classic virtual network’s address space.</span><span class="sxs-lookup"><span data-stu-id="95733-164">This address space cannot overlap the classic virtual network’s address space.</span></span> <span data-ttu-id="95733-165">For example, “10.1.0.0/16”</span><span class="sxs-lookup"><span data-stu-id="95733-165">For example, “10.1.0.0/16”</span></span>
   * <span data-ttu-id="95733-166">**$ArmVnetSubnetName** - The Resource Manager virtual network subnet name within which you want to place the HDInsight cluster VMs.</span><span class="sxs-lookup"><span data-stu-id="95733-166">**$ArmVnetSubnetName** - The Resource Manager virtual network subnet name within which you want to place the HDInsight cluster VMs.</span></span> <span data-ttu-id="95733-167">If the subnet does not exist, the PowerShell script will create it.</span><span class="sxs-lookup"><span data-stu-id="95733-167">If the subnet does not exist, the PowerShell script will create it.</span></span> <span data-ttu-id="95733-168">If it does exist, it should be part of the virtual network that you provide above.</span><span class="sxs-lookup"><span data-stu-id="95733-168">If it does exist, it should be part of the virtual network that you provide above.</span></span>
   * <span data-ttu-id="95733-169">**$AddressSubnetAddressSpace** – The network address range for the Resource Manager virtual network subnet.</span><span class="sxs-lookup"><span data-stu-id="95733-169">**$AddressSubnetAddressSpace** – The network address range for the Resource Manager virtual network subnet.</span></span> <span data-ttu-id="95733-170">The HDInsight cluster VM IP addresses will be from this subnet address range.</span><span class="sxs-lookup"><span data-stu-id="95733-170">The HDInsight cluster VM IP addresses will be from this subnet address range.</span></span> <span data-ttu-id="95733-171">For example, “10.1.0.0/24”.</span><span class="sxs-lookup"><span data-stu-id="95733-171">For example, “10.1.0.0/24”.</span></span>
   * <span data-ttu-id="95733-172">**$ActiveDirectoryDomainName** – The Azure AD domain name that you want to join the HDInsight cluster VMs to.</span><span class="sxs-lookup"><span data-stu-id="95733-172">**$ActiveDirectoryDomainName** – The Azure AD domain name that you want to join the HDInsight cluster VMs to.</span></span> <span data-ttu-id="95733-173">For example, “contoso.onmicrosoft.com”</span><span class="sxs-lookup"><span data-stu-id="95733-173">For example, “contoso.onmicrosoft.com”</span></span>
   * <span data-ttu-id="95733-174">**$ClusterUsersGroups** – The common name of the security groups from your AD that you want to sync to the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-174">**$ClusterUsersGroups** – The common name of the security groups from your AD that you want to sync to the HDInsight cluster.</span></span> <span data-ttu-id="95733-175">The users within this security group will be able to log on to the cluster dashboard using their active directory domain credentials.</span><span class="sxs-lookup"><span data-stu-id="95733-175">The users within this security group will be able to log on to the cluster dashboard using their active directory domain credentials.</span></span> <span data-ttu-id="95733-176">These security groups must exist in the active directory.</span><span class="sxs-lookup"><span data-stu-id="95733-176">These security groups must exist in the active directory.</span></span> <span data-ttu-id="95733-177">For example, “hiveusers” or “clusteroperatorusers”.</span><span class="sxs-lookup"><span data-stu-id="95733-177">For example, “hiveusers” or “clusteroperatorusers”.</span></span>
   * <span data-ttu-id="95733-178">**$OrganizationalUnitName** - The organizational unit in the domain, within which you want to place the HDInsight cluster VMs and the service principals used by the cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-178">**$OrganizationalUnitName** - The organizational unit in the domain, within which you want to place the HDInsight cluster VMs and the service principals used by the cluster.</span></span> <span data-ttu-id="95733-179">The PowerShell script will create this OU if it does not exist.</span><span class="sxs-lookup"><span data-stu-id="95733-179">The PowerShell script will create this OU if it does not exist.</span></span> <span data-ttu-id="95733-180">For example, “HDInsightOU”.</span><span class="sxs-lookup"><span data-stu-id="95733-180">For example, “HDInsightOU”.</span></span>
3. <span data-ttu-id="95733-181">Save the changes.</span><span class="sxs-lookup"><span data-stu-id="95733-181">Save the changes.</span></span>

<span data-ttu-id="95733-182">**To run the script**</span><span class="sxs-lookup"><span data-stu-id="95733-182">**To run the script**</span></span>

1. <span data-ttu-id="95733-183">Run **Windows PowerShell** as administrator.</span><span class="sxs-lookup"><span data-stu-id="95733-183">Run **Windows PowerShell** as administrator.</span></span>
2. <span data-ttu-id="95733-184">Browse to the folder of run.ps1.</span><span class="sxs-lookup"><span data-stu-id="95733-184">Browse to the folder of run.ps1.</span></span> 
3. <span data-ttu-id="95733-185">Run the script by typing the file name, and hit **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="95733-185">Run the script by typing the file name, and hit **ENTER**.</span></span>  <span data-ttu-id="95733-186">It pops up 3 sign-in dialogs:</span><span class="sxs-lookup"><span data-stu-id="95733-186">It pops up 3 sign-in dialogs:</span></span>
   
   1. <span data-ttu-id="95733-187">**Sign in to Azure classic portal** – Enter your credentials which you use to sign in to Azure classic portal.</span><span class="sxs-lookup"><span data-stu-id="95733-187">**Sign in to Azure classic portal** – Enter your credentials which you use to sign in to Azure classic portal.</span></span> <span data-ttu-id="95733-188">You must have created the Azure AD and Azure AD DS using these credentials.</span><span class="sxs-lookup"><span data-stu-id="95733-188">You must have created the Azure AD and Azure AD DS using these credentials.</span></span>
   2. <span data-ttu-id="95733-189">**Sign in to Azure Resource Manager portal** – Enter your credentials which you use to sign in to Azure Resource Manager portal.</span><span class="sxs-lookup"><span data-stu-id="95733-189">**Sign in to Azure Resource Manager portal** – Enter your credentials which you use to sign in to Azure Resource Manager portal.</span></span>
   3. <span data-ttu-id="95733-190">**Domain user name** – Enter the credentials of the Domain user name that you want to be an admin on the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-190">**Domain user name** – Enter the credentials of the Domain user name that you want to be an admin on the HDInsight cluster.</span></span> <span data-ttu-id="95733-191">If you created an Azure AD from scratch, you must have created this user using this documentation.</span><span class="sxs-lookup"><span data-stu-id="95733-191">If you created an Azure AD from scratch, you must have created this user using this documentation.</span></span> 
      
      > [!IMPORTANT]
      > <span data-ttu-id="95733-192">Enter the username in this format:</span><span class="sxs-lookup"><span data-stu-id="95733-192">Enter the username in this format:</span></span> 
      > 
      > <span data-ttu-id="95733-193">Domainname\username (for example contoso.onmicrosoft.com\clusteradmin)</span><span class="sxs-lookup"><span data-stu-id="95733-193">Domainname\username (for example contoso.onmicrosoft.com\clusteradmin)</span></span>
      > 
      > 
      
      <span data-ttu-id="95733-194">This user must have 3 privileges: To join machines to the provided Active Directory domain; to create service principals and machine objects within the provided Organizational Unit; and to add reverse DNS proxy rules.</span><span class="sxs-lookup"><span data-stu-id="95733-194">This user must have 3 privileges: To join machines to the provided Active Directory domain; to create service principals and machine objects within the provided Organizational Unit; and to add reverse DNS proxy rules.</span></span>

<span data-ttu-id="95733-195">While creating reverse DNS zones, the script will prompt you to enter a network ID.</span><span class="sxs-lookup"><span data-stu-id="95733-195">While creating reverse DNS zones, the script will prompt you to enter a network ID.</span></span> <span data-ttu-id="95733-196">This network ID must be the Resource Manager virtual network’s address prefix.</span><span class="sxs-lookup"><span data-stu-id="95733-196">This network ID must be the Resource Manager virtual network’s address prefix.</span></span> <span data-ttu-id="95733-197">For example, if your Resource Manager virtual network subnet address space is 10.2.0.0/24, enter 10.2.0.0/24 when the tool prompts you for the network ID.</span><span class="sxs-lookup"><span data-stu-id="95733-197">For example, if your Resource Manager virtual network subnet address space is 10.2.0.0/24, enter 10.2.0.0/24 when the tool prompts you for the network ID.</span></span> 

## <a name="create-hdinsight-cluster"></a><span data-ttu-id="95733-198">Create HDInsight cluster</span><span class="sxs-lookup"><span data-stu-id="95733-198">Create HDInsight cluster</span></span>
<span data-ttu-id="95733-199">In this section, you create a Linux-based Hadoop cluster in HDInsight using either the Azure portal or [Azure Resource Manager template](../azure-resource-manager/resource-group-template-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="95733-199">In this section, you create a Linux-based Hadoop cluster in HDInsight using either the Azure portal or [Azure Resource Manager template](../azure-resource-manager/resource-group-template-deploy.md).</span></span> <span data-ttu-id="95733-200">For other cluster creation methods and understanding the settings, see [Create HDInsight clusters](hdinsight-hadoop-provision-linux-clusters.md).</span><span class="sxs-lookup"><span data-stu-id="95733-200">For other cluster creation methods and understanding the settings, see [Create HDInsight clusters](hdinsight-hadoop-provision-linux-clusters.md).</span></span> <span data-ttu-id="95733-201">For more information about using Resource Manager template to create Hadoop clusters in HDInsight, see [Create Hadoop clusters in HDInsight using Resource Manager templates](hdinsight-hadoop-create-windows-clusters-arm-templates.md)</span><span class="sxs-lookup"><span data-stu-id="95733-201">For more information about using Resource Manager template to create Hadoop clusters in HDInsight, see [Create Hadoop clusters in HDInsight using Resource Manager templates](hdinsight-hadoop-create-windows-clusters-arm-templates.md)</span></span>

<span data-ttu-id="95733-202">**To create a Domain-joined HDInsight cluster using the Azure portal**</span><span class="sxs-lookup"><span data-stu-id="95733-202">**To create a Domain-joined HDInsight cluster using the Azure portal**</span></span>

1. <span data-ttu-id="95733-203">Sign on to the [Azure portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="95733-203">Sign on to the [Azure portal](https://portal.azure.com).</span></span>
2. <span data-ttu-id="95733-204">Click **New**, **Intelligence + analytics**, and then **HDInsight**.</span><span class="sxs-lookup"><span data-stu-id="95733-204">Click **New**, **Intelligence + analytics**, and then **HDInsight**.</span></span>
3. <span data-ttu-id="95733-205">From the **New HDInsight cluster** blade, enter or select the following values:</span><span class="sxs-lookup"><span data-stu-id="95733-205">From the **New HDInsight cluster** blade, enter or select the following values:</span></span>
   
   * <span data-ttu-id="95733-206">**Cluster name**: Enter a new cluster name for the Domain-joined HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-206">**Cluster name**: Enter a new cluster name for the Domain-joined HDInsight cluster.</span></span>
   * <span data-ttu-id="95733-207">**Subscription**: Select an Azure subscription used for creating this cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-207">**Subscription**: Select an Azure subscription used for creating this cluster.</span></span>
   * <span data-ttu-id="95733-208">**Cluster configuration**:</span><span class="sxs-lookup"><span data-stu-id="95733-208">**Cluster configuration**:</span></span>
     
     * <span data-ttu-id="95733-209">**Cluster Type**: Hadoop.</span><span class="sxs-lookup"><span data-stu-id="95733-209">**Cluster Type**: Hadoop.</span></span> <span data-ttu-id="95733-210">Domain-joined HDInsight is currently only supported on Hadoop clusters.</span><span class="sxs-lookup"><span data-stu-id="95733-210">Domain-joined HDInsight is currently only supported on Hadoop clusters.</span></span>
     * <span data-ttu-id="95733-211">**Operating System**: Linux.</span><span class="sxs-lookup"><span data-stu-id="95733-211">**Operating System**: Linux.</span></span>  <span data-ttu-id="95733-212">Domain-joined HDInsight is only supported on Linux-based HDInsight clusters.</span><span class="sxs-lookup"><span data-stu-id="95733-212">Domain-joined HDInsight is only supported on Linux-based HDInsight clusters.</span></span>
     * <span data-ttu-id="95733-213">**Version**: Hadoop 2.7.3 (HDI 3.5).</span><span class="sxs-lookup"><span data-stu-id="95733-213">**Version**: Hadoop 2.7.3 (HDI 3.5).</span></span> <span data-ttu-id="95733-214">Domain-joined HDInsight is only supported on HDInsight cluster version 3.5.</span><span class="sxs-lookup"><span data-stu-id="95733-214">Domain-joined HDInsight is only supported on HDInsight cluster version 3.5.</span></span>
     * <span data-ttu-id="95733-215">**Cluster Type**: PREMIUM</span><span class="sxs-lookup"><span data-stu-id="95733-215">**Cluster Type**: PREMIUM</span></span>
       
       <span data-ttu-id="95733-216">Click **Select** to save the changes.</span><span class="sxs-lookup"><span data-stu-id="95733-216">Click **Select** to save the changes.</span></span>
   * <span data-ttu-id="95733-217">**Credentials**: Configure the credentials for both the cluster user and the SSH user.</span><span class="sxs-lookup"><span data-stu-id="95733-217">**Credentials**: Configure the credentials for both the cluster user and the SSH user.</span></span>
   * <span data-ttu-id="95733-218">**Data Source**: Create a new Storage account or use an existing Storage account as the default Storage account for the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-218">**Data Source**: Create a new Storage account or use an existing Storage account as the default Storage account for the HDInsight cluster.</span></span> <span data-ttu-id="95733-219">The location must be the same as the two VNets.</span><span class="sxs-lookup"><span data-stu-id="95733-219">The location must be the same as the two VNets.</span></span>  <span data-ttu-id="95733-220">The location is also the location of the HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-220">The location is also the location of the HDInsight cluster.</span></span>
   * <span data-ttu-id="95733-221">**Pricing**: Select the number of worker nodes of your cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-221">**Pricing**: Select the number of worker nodes of your cluster.</span></span>
   * <span data-ttu-id="95733-222">**Advanced configurations**:</span><span class="sxs-lookup"><span data-stu-id="95733-222">**Advanced configurations**:</span></span> 
     
     * <span data-ttu-id="95733-223">**Domain-joining & Vnet/Subnet**:</span><span class="sxs-lookup"><span data-stu-id="95733-223">**Domain-joining & Vnet/Subnet**:</span></span> 
       
       * <span data-ttu-id="95733-224">**Domain settings**:</span><span class="sxs-lookup"><span data-stu-id="95733-224">**Domain settings**:</span></span> 
         
         * <span data-ttu-id="95733-225">**Domain name**: contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="95733-225">**Domain name**: contoso.onmicrosoft.com</span></span>
         * <span data-ttu-id="95733-226">**Domain user name**: Enter a domain user name.</span><span class="sxs-lookup"><span data-stu-id="95733-226">**Domain user name**: Enter a domain user name.</span></span> <span data-ttu-id="95733-227">This domain must have the following privileges: Join machines to the domain and place them in the organization unit you configured earlier; Create service principals within the organization unit you configured earlier; Create reverse DNS entries.</span><span class="sxs-lookup"><span data-stu-id="95733-227">This domain must have the following privileges: Join machines to the domain and place them in the organization unit you configured earlier; Create service principals within the organization unit you configured earlier; Create reverse DNS entries.</span></span> <span data-ttu-id="95733-228">This domain user will become the administrator of this domain-joined HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-228">This domain user will become the administrator of this domain-joined HDInsight cluster.</span></span>
         * <span data-ttu-id="95733-229">**Domain password**: Enter the domain user password.</span><span class="sxs-lookup"><span data-stu-id="95733-229">**Domain password**: Enter the domain user password.</span></span>
         * <span data-ttu-id="95733-230">**Organization Unit**: Enter the distinguished name of the OU that you configured earlier.</span><span class="sxs-lookup"><span data-stu-id="95733-230">**Organization Unit**: Enter the distinguished name of the OU that you configured earlier.</span></span> <span data-ttu-id="95733-231">For example: OU=HDInsightOU,DC=contoso,DC=onmicrosoft,DC=com</span><span class="sxs-lookup"><span data-stu-id="95733-231">For example: OU=HDInsightOU,DC=contoso,DC=onmicrosoft,DC=com</span></span>
         * <span data-ttu-id="95733-232">**LDAPS URL**: ldaps://contoso.onmicrosoft.com:636</span><span class="sxs-lookup"><span data-stu-id="95733-232">**LDAPS URL**: ldaps://contoso.onmicrosoft.com:636</span></span>
         * <span data-ttu-id="95733-233">**Access user group**: Specify the security group whose users you wan to sync to the cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-233">**Access user group**: Specify the security group whose users you wan to sync to the cluster.</span></span> <span data-ttu-id="95733-234">For example, HiveUsers.</span><span class="sxs-lookup"><span data-stu-id="95733-234">For example, HiveUsers.</span></span>
           
           <span data-ttu-id="95733-235">Click **Select** to save the changes.</span><span class="sxs-lookup"><span data-stu-id="95733-235">Click **Select** to save the changes.</span></span>
           
           ![Domain-joined HDInsight portal configure domain setting](https://docstestmedia1.blob.core.windows.net/azure-media/articles/hdinsight/media/hdinsight-domain-joined-configure/hdinsight-domain-joined-portal-domain-setting.png)
       * <span data-ttu-id="95733-237">**Virtual Network**: contosohdivnet</span><span class="sxs-lookup"><span data-stu-id="95733-237">**Virtual Network**: contosohdivnet</span></span>
       * <span data-ttu-id="95733-238">**Subnet**: Subnet1</span><span class="sxs-lookup"><span data-stu-id="95733-238">**Subnet**: Subnet1</span></span>
         
         <span data-ttu-id="95733-239">Click **Select** to save the changes.</span><span class="sxs-lookup"><span data-stu-id="95733-239">Click **Select** to save the changes.</span></span>        
         <span data-ttu-id="95733-240">Click **Select** to save the changes.</span><span class="sxs-lookup"><span data-stu-id="95733-240">Click **Select** to save the changes.</span></span>
   * <span data-ttu-id="95733-241">**Resource Group**: Select the resource group used for the HDInsight VNet (contosohdirg).</span><span class="sxs-lookup"><span data-stu-id="95733-241">**Resource Group**: Select the resource group used for the HDInsight VNet (contosohdirg).</span></span>
4. <span data-ttu-id="95733-242">Click **Create**.</span><span class="sxs-lookup"><span data-stu-id="95733-242">Click **Create**.</span></span>  

<span data-ttu-id="95733-243">Another option for creating Domain-joined HDInsight cluster is to use Azure Resource Management template.</span><span class="sxs-lookup"><span data-stu-id="95733-243">Another option for creating Domain-joined HDInsight cluster is to use Azure Resource Management template.</span></span> <span data-ttu-id="95733-244">The following procedure shows you how:</span><span class="sxs-lookup"><span data-stu-id="95733-244">The following procedure shows you how:</span></span>

<span data-ttu-id="95733-245">**To create a Domain-joined HDInsight cluster using a Resource Management template**</span><span class="sxs-lookup"><span data-stu-id="95733-245">**To create a Domain-joined HDInsight cluster using a Resource Management template**</span></span>

1. <span data-ttu-id="95733-246">Click the following image to open a Resource Manager template in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="95733-246">Click the following image to open a Resource Manager template in the Azure portal.</span></span> <span data-ttu-id="95733-247">The Resource Manager template is located in a public blob container.</span><span class="sxs-lookup"><span data-stu-id="95733-247">The Resource Manager template is located in a public blob container.</span></span> 
   
    <a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fhditutorialdata.blob.core.windows.net%2Farmtemplates%2Fcreate-domain-joined-hdinsight-cluster.json" target="_blank"><img src="https://docstestmedia1.blob.core.windows.net/azure-media/articles/hdinsight/media/hdinsight-domain-joined-configure-use-powershell/deploy-to-azure.png" alt="Deploy to Azure"></a>
2. <span data-ttu-id="95733-248">From the **Parameters** blade, enter the following values:</span><span class="sxs-lookup"><span data-stu-id="95733-248">From the **Parameters** blade, enter the following values:</span></span>
   
   * <span data-ttu-id="95733-249">**Subscription**: (Select your Azure subscription).</span><span class="sxs-lookup"><span data-stu-id="95733-249">**Subscription**: (Select your Azure subscription).</span></span>
   * <span data-ttu-id="95733-250">**Resource group**: Click **Use existing**, and specify the same resource group you have been using.</span><span class="sxs-lookup"><span data-stu-id="95733-250">**Resource group**: Click **Use existing**, and specify the same resource group you have been using.</span></span>  <span data-ttu-id="95733-251">For example contosohdirg.</span><span class="sxs-lookup"><span data-stu-id="95733-251">For example contosohdirg.</span></span> 
   * <span data-ttu-id="95733-252">**Location**: Specify a resource group location.</span><span class="sxs-lookup"><span data-stu-id="95733-252">**Location**: Specify a resource group location.</span></span>
   * <span data-ttu-id="95733-253">**Cluster Name**: Enter a name for the Hadoop cluster that you will create.</span><span class="sxs-lookup"><span data-stu-id="95733-253">**Cluster Name**: Enter a name for the Hadoop cluster that you will create.</span></span> <span data-ttu-id="95733-254">For example contosohdicluster.</span><span class="sxs-lookup"><span data-stu-id="95733-254">For example contosohdicluster.</span></span>
   * <span data-ttu-id="95733-255">**Cluster Type**: Select a cluster type.</span><span class="sxs-lookup"><span data-stu-id="95733-255">**Cluster Type**: Select a cluster type.</span></span>  <span data-ttu-id="95733-256">The default value is **hadoop**.</span><span class="sxs-lookup"><span data-stu-id="95733-256">The default value is **hadoop**.</span></span>
   * <span data-ttu-id="95733-257">**Location**: Select a location for the cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-257">**Location**: Select a location for the cluster.</span></span>  <span data-ttu-id="95733-258">The default storage account uses the same location.</span><span class="sxs-lookup"><span data-stu-id="95733-258">The default storage account uses the same location.</span></span>
   * <span data-ttu-id="95733-259">**Cluster Worker Node count**: Select the number of worker nodes.</span><span class="sxs-lookup"><span data-stu-id="95733-259">**Cluster Worker Node count**: Select the number of worker nodes.</span></span>
   * <span data-ttu-id="95733-260">**Cluster login name and password**: The default login name is **admin**.</span><span class="sxs-lookup"><span data-stu-id="95733-260">**Cluster login name and password**: The default login name is **admin**.</span></span>
   * <span data-ttu-id="95733-261">**SSH username and password**: The default username is **sshuser**.</span><span class="sxs-lookup"><span data-stu-id="95733-261">**SSH username and password**: The default username is **sshuser**.</span></span>  <span data-ttu-id="95733-262">You can rename it.</span><span class="sxs-lookup"><span data-stu-id="95733-262">You can rename it.</span></span> 
   * <span data-ttu-id="95733-263">**Virtual Network Id**: /subscriptions/&lt;SubscriptionID>/resourceGroups/&lt;ResourceGroupName>/providers/Microsoft.Network/virtualNetworks/&lt;VNetName></span><span class="sxs-lookup"><span data-stu-id="95733-263">**Virtual Network Id**: /subscriptions/&lt;SubscriptionID>/resourceGroups/&lt;ResourceGroupName>/providers/Microsoft.Network/virtualNetworks/&lt;VNetName></span></span>
   * <span data-ttu-id="95733-264">**Virtual Network Subnet**: /subscriptions/&lt;SubscriptionID>/resourceGroups/&lt;ResourceGroupName>/providers/Microsoft.Network/virtualNetworks/&lt;VNetName>/subnets/Subnet1</span><span class="sxs-lookup"><span data-stu-id="95733-264">**Virtual Network Subnet**: /subscriptions/&lt;SubscriptionID>/resourceGroups/&lt;ResourceGroupName>/providers/Microsoft.Network/virtualNetworks/&lt;VNetName>/subnets/Subnet1</span></span>
   * <span data-ttu-id="95733-265">**Domain Name**: contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="95733-265">**Domain Name**: contoso.onmicrosoft.com</span></span>
   * <span data-ttu-id="95733-266">**Organization Unit DN**: OU=HDInsightOU,DC=contoso,DC=onmicrosoft,DC=com</span><span class="sxs-lookup"><span data-stu-id="95733-266">**Organization Unit DN**: OU=HDInsightOU,DC=contoso,DC=onmicrosoft,DC=com</span></span>
   * <span data-ttu-id="95733-267">**Cluster Users Group D Ns**: "\"CN=HiveUsers,OU=AADDC Users,DC=<DomainName>,DC=onmicrosoft,DC=com\""</span><span class="sxs-lookup"><span data-stu-id="95733-267">**Cluster Users Group D Ns**: "\"CN=HiveUsers,OU=AADDC Users,DC=<DomainName>,DC=onmicrosoft,DC=com\""</span></span>
   * <span data-ttu-id="95733-268">**LDAPUrls**: ["ldaps://contoso.onmicrosoft.com:636"]</span><span class="sxs-lookup"><span data-stu-id="95733-268">**LDAPUrls**: ["ldaps://contoso.onmicrosoft.com:636"]</span></span>
   * <span data-ttu-id="95733-269">**DomainAdminUserName**: (Enter the domain admin user name)</span><span class="sxs-lookup"><span data-stu-id="95733-269">**DomainAdminUserName**: (Enter the domain admin user name)</span></span>
   * <span data-ttu-id="95733-270">**DomainAdminPassword**: (enter the domain admin user password)</span><span class="sxs-lookup"><span data-stu-id="95733-270">**DomainAdminPassword**: (enter the domain admin user password)</span></span>
   * <span data-ttu-id="95733-271">**I agree to the terms and conditions stated above**: (Check)</span><span class="sxs-lookup"><span data-stu-id="95733-271">**I agree to the terms and conditions stated above**: (Check)</span></span>
   * <span data-ttu-id="95733-272">**Pin to dashboard**: (Check)</span><span class="sxs-lookup"><span data-stu-id="95733-272">**Pin to dashboard**: (Check)</span></span>
3. <span data-ttu-id="95733-273">Click **Purchase**.</span><span class="sxs-lookup"><span data-stu-id="95733-273">Click **Purchase**.</span></span> <span data-ttu-id="95733-274">You will see a new tile titled **Deploying Template deployment**.</span><span class="sxs-lookup"><span data-stu-id="95733-274">You will see a new tile titled **Deploying Template deployment**.</span></span> <span data-ttu-id="95733-275">It takes about around 20 minutes to create a cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-275">It takes about around 20 minutes to create a cluster.</span></span> <span data-ttu-id="95733-276">Once the cluster is created, you can click the cluster blade in the portal to open it.</span><span class="sxs-lookup"><span data-stu-id="95733-276">Once the cluster is created, you can click the cluster blade in the portal to open it.</span></span>

<span data-ttu-id="95733-277">After you complete the tutorial, you might want to delete the cluster.</span><span class="sxs-lookup"><span data-stu-id="95733-277">After you complete the tutorial, you might want to delete the cluster.</span></span> <span data-ttu-id="95733-278">With HDInsight, your data is stored in Azure Storage, so you can safely delete a cluster when it is not in use.</span><span class="sxs-lookup"><span data-stu-id="95733-278">With HDInsight, your data is stored in Azure Storage, so you can safely delete a cluster when it is not in use.</span></span> <span data-ttu-id="95733-279">You are also charged for an HDInsight cluster, even when it is not in use.</span><span class="sxs-lookup"><span data-stu-id="95733-279">You are also charged for an HDInsight cluster, even when it is not in use.</span></span> <span data-ttu-id="95733-280">Since the charges for the cluster are many times more than the charges for storage, it makes economic sense to delete clusters when they are not in use.</span><span class="sxs-lookup"><span data-stu-id="95733-280">Since the charges for the cluster are many times more than the charges for storage, it makes economic sense to delete clusters when they are not in use.</span></span> <span data-ttu-id="95733-281">For the instructions of deleting a cluster, see [Manage Hadoop clusters in HDInsight by using the Azure portal](hdinsight-administer-use-management-portal.md#delete-clusters).</span><span class="sxs-lookup"><span data-stu-id="95733-281">For the instructions of deleting a cluster, see [Manage Hadoop clusters in HDInsight by using the Azure portal](hdinsight-administer-use-management-portal.md#delete-clusters).</span></span>

## <a name="next-steps"></a><span data-ttu-id="95733-282">Next steps</span><span class="sxs-lookup"><span data-stu-id="95733-282">Next steps</span></span>

* <span data-ttu-id="95733-283">For configuring Hive policies and run Hive queries, see [Configure Hive policies for Domain-joined HDInsight clusters](hdinsight-domain-joined-run-hive.md).</span><span class="sxs-lookup"><span data-stu-id="95733-283">For configuring Hive policies and run Hive queries, see [Configure Hive policies for Domain-joined HDInsight clusters](hdinsight-domain-joined-run-hive.md).</span></span>
* <span data-ttu-id="95733-284">For using SSH to connect to Domain-joined HDInsight clusters, see [Use SSH with HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md#domainjoined).</span><span class="sxs-lookup"><span data-stu-id="95733-284">For using SSH to connect to Domain-joined HDInsight clusters, see [Use SSH with HDInsight](hdinsight-hadoop-linux-use-ssh-unix.md#domainjoined).</span></span>




