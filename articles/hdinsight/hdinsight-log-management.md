---
title: Manage logs for an HDInsight cluster - Azure HDInsight
description: Determine the types, sizes, and retention policies for HDInsight activity log files.
services: hdinsight
author: ashishthaps
ms.reviewer: jasonh
ms.service: hdinsight
ms.custom: hdinsightactive
ms.topic: conceptual
ms.date: 01/11/2018
ms.author: ashishth
ms.openlocfilehash: aab5be7f98f5fdf6e7304485c3d1fc5ddb7afdba
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44870710"
---
# <a name="manage-logs-for-an-hdinsight-cluster"></a><span data-ttu-id="e97ba-103">Manage logs for an HDInsight cluster</span><span class="sxs-lookup"><span data-stu-id="e97ba-103">Manage logs for an HDInsight cluster</span></span>

<span data-ttu-id="e97ba-104">An HDInsight cluster produces a variety of log files.</span><span class="sxs-lookup"><span data-stu-id="e97ba-104">An HDInsight cluster produces a variety of log files.</span></span> <span data-ttu-id="e97ba-105">For example, Apache Hadoop and related services, such as Apache Spark, produce detailed job execution logs.</span><span class="sxs-lookup"><span data-stu-id="e97ba-105">For example, Apache Hadoop and related services, such as Apache Spark, produce detailed job execution logs.</span></span> <span data-ttu-id="e97ba-106">Log file management is part of maintaining a healthy HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="e97ba-106">Log file management is part of maintaining a healthy HDInsight cluster.</span></span> <span data-ttu-id="e97ba-107">There can also be regulatory requirements for log archiving.</span><span class="sxs-lookup"><span data-stu-id="e97ba-107">There can also be regulatory requirements for log archiving.</span></span>  <span data-ttu-id="e97ba-108">Due to the number and size of log files, optimizing log storage and archiving helps with service cost management.</span><span class="sxs-lookup"><span data-stu-id="e97ba-108">Due to the number and size of log files, optimizing log storage and archiving helps with service cost management.</span></span>

<span data-ttu-id="e97ba-109">Managing HDInsight cluster logs includes retaining information about all aspects of the cluster environment.</span><span class="sxs-lookup"><span data-stu-id="e97ba-109">Managing HDInsight cluster logs includes retaining information about all aspects of the cluster environment.</span></span> <span data-ttu-id="e97ba-110">This information includes all associated Azure Service logs, cluster configuration, job execution information, any error states, and other data as needed.</span><span class="sxs-lookup"><span data-stu-id="e97ba-110">This information includes all associated Azure Service logs, cluster configuration, job execution information, any error states, and other data as needed.</span></span>

<span data-ttu-id="e97ba-111">Typical steps in HDInsight log management are:</span><span class="sxs-lookup"><span data-stu-id="e97ba-111">Typical steps in HDInsight log management are:</span></span>

* <span data-ttu-id="e97ba-112">Step 1: Determine log retention policies</span><span class="sxs-lookup"><span data-stu-id="e97ba-112">Step 1: Determine log retention policies</span></span>
* <span data-ttu-id="e97ba-113">Step 2: Manage cluster service versions configuration logs</span><span class="sxs-lookup"><span data-stu-id="e97ba-113">Step 2: Manage cluster service versions configuration logs</span></span>
* <span data-ttu-id="e97ba-114">Step 3: Manage cluster job execution log files</span><span class="sxs-lookup"><span data-stu-id="e97ba-114">Step 3: Manage cluster job execution log files</span></span>
* <span data-ttu-id="e97ba-115">Step 4: Forecast log volume storage sizes and costs</span><span class="sxs-lookup"><span data-stu-id="e97ba-115">Step 4: Forecast log volume storage sizes and costs</span></span>
* <span data-ttu-id="e97ba-116">Step 5: Determine log archive policies and processes</span><span class="sxs-lookup"><span data-stu-id="e97ba-116">Step 5: Determine log archive policies and processes</span></span>

## <a name="step-1-determine-log-retention-policies"></a><span data-ttu-id="e97ba-117">Step 1: Determine log retention policies</span><span class="sxs-lookup"><span data-stu-id="e97ba-117">Step 1: Determine log retention policies</span></span>

<span data-ttu-id="e97ba-118">The first step in creating a HDInsight cluster log management strategy is to gather information about business scenarios and job execution history storage requirements.</span><span class="sxs-lookup"><span data-stu-id="e97ba-118">The first step in creating a HDInsight cluster log management strategy is to gather information about business scenarios and job execution history storage requirements.</span></span>

### <a name="cluster-details"></a><span data-ttu-id="e97ba-119">Cluster details</span><span class="sxs-lookup"><span data-stu-id="e97ba-119">Cluster details</span></span>

<span data-ttu-id="e97ba-120">The following cluster details are useful in helping to gather information in your log management strategy.</span><span class="sxs-lookup"><span data-stu-id="e97ba-120">The following cluster details are useful in helping to gather information in your log management strategy.</span></span> <span data-ttu-id="e97ba-121">Gather this information from all HDInsight clusters you have created in a particular Azure account.</span><span class="sxs-lookup"><span data-stu-id="e97ba-121">Gather this information from all HDInsight clusters you have created in a particular Azure account.</span></span>

* <span data-ttu-id="e97ba-122">Cluster name</span><span class="sxs-lookup"><span data-stu-id="e97ba-122">Cluster name</span></span>
* <span data-ttu-id="e97ba-123">Cluster region and Azure availability zone</span><span class="sxs-lookup"><span data-stu-id="e97ba-123">Cluster region and Azure availability zone</span></span>
* <span data-ttu-id="e97ba-124">Cluster state, including details of the last state change</span><span class="sxs-lookup"><span data-stu-id="e97ba-124">Cluster state, including details of the last state change</span></span>
* <span data-ttu-id="e97ba-125">Type and number of HDInsight instances specified for the master, core, and task nodes</span><span class="sxs-lookup"><span data-stu-id="e97ba-125">Type and number of HDInsight instances specified for the master, core, and task nodes</span></span>

<span data-ttu-id="e97ba-126">You can get most of this top-level information using the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="e97ba-126">You can get most of this top-level information using the Azure portal.</span></span>  <span data-ttu-id="e97ba-127">Alternatively, you can use the Azure CLI to get information about your HDInsight cluster(s):</span><span class="sxs-lookup"><span data-stu-id="e97ba-127">Alternatively, you can use the Azure CLI to get information about your HDInsight cluster(s):</span></span>

```
    azure hdinsight cluster list
    azure hdinsight cluster show <ClusterName>
```

<span data-ttu-id="e97ba-128">You can also use PowerShell to view this information.</span><span class="sxs-lookup"><span data-stu-id="e97ba-128">You can also use PowerShell to view this information.</span></span>  <span data-ttu-id="e97ba-129">For more information, see [Manage Hadoop clusters in HDInsight by using Azure PowerShell](hdinsight-administer-use-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="e97ba-129">For more information, see [Manage Hadoop clusters in HDInsight by using Azure PowerShell](hdinsight-administer-use-powershell.md).</span></span>

### <a name="understand-the-workloads-running-on-your-clusters"></a><span data-ttu-id="e97ba-130">Understand the workloads running on your clusters</span><span class="sxs-lookup"><span data-stu-id="e97ba-130">Understand the workloads running on your clusters</span></span>

<span data-ttu-id="e97ba-131">It's important to understand the workload types running on your HDInsight cluster(s) to design appropriate logging strategies for each type.</span><span class="sxs-lookup"><span data-stu-id="e97ba-131">It's important to understand the workload types running on your HDInsight cluster(s) to design appropriate logging strategies for each type.</span></span>

* <span data-ttu-id="e97ba-132">Are the workloads experimental (such as development or test) or production-quality?</span><span class="sxs-lookup"><span data-stu-id="e97ba-132">Are the workloads experimental (such as development or test) or production-quality?</span></span>
* <span data-ttu-id="e97ba-133">How often do the production-quality workloads normally run?</span><span class="sxs-lookup"><span data-stu-id="e97ba-133">How often do the production-quality workloads normally run?</span></span>
* <span data-ttu-id="e97ba-134">Are any of the workloads resource-intensive and/or long-running?</span><span class="sxs-lookup"><span data-stu-id="e97ba-134">Are any of the workloads resource-intensive and/or long-running?</span></span>
* <span data-ttu-id="e97ba-135">Do any of the workloads use a complex set of Hadoop services for which multiple types of logs are produced?</span><span class="sxs-lookup"><span data-stu-id="e97ba-135">Do any of the workloads use a complex set of Hadoop services for which multiple types of logs are produced?</span></span>
* <span data-ttu-id="e97ba-136">Do any of the workloads have associated regulatory execution lineage requirements?</span><span class="sxs-lookup"><span data-stu-id="e97ba-136">Do any of the workloads have associated regulatory execution lineage requirements?</span></span>

### <a name="example-log-retention-patterns-and-practices"></a><span data-ttu-id="e97ba-137">Example log retention patterns and practices</span><span class="sxs-lookup"><span data-stu-id="e97ba-137">Example log retention patterns and practices</span></span>

* <span data-ttu-id="e97ba-138">Consider maintaining data lineage tracking by adding an identifier to each log entry, or through other techniques.</span><span class="sxs-lookup"><span data-stu-id="e97ba-138">Consider maintaining data lineage tracking by adding an identifier to each log entry, or through other techniques.</span></span> <span data-ttu-id="e97ba-139">This allows you to trace back the original source of the data and the operation, and follow the data through each stage to understand its consistency and validity.</span><span class="sxs-lookup"><span data-stu-id="e97ba-139">This allows you to trace back the original source of the data and the operation, and follow the data through each stage to understand its consistency and validity.</span></span>

* <span data-ttu-id="e97ba-140">Consider how you can collect logs from the cluster, or from more than one cluster, and collate them for purposes such as auditing, monitoring, planning, and alerting.</span><span class="sxs-lookup"><span data-stu-id="e97ba-140">Consider how you can collect logs from the cluster, or from more than one cluster, and collate them for purposes such as auditing, monitoring, planning, and alerting.</span></span> <span data-ttu-id="e97ba-141">You might use a custom solution to access and download the log files on a regular basis, and combine and analyze them to provide a dashboard display.</span><span class="sxs-lookup"><span data-stu-id="e97ba-141">You might use a custom solution to access and download the log files on a regular basis, and combine and analyze them to provide a dashboard display.</span></span> <span data-ttu-id="e97ba-142">You can also add additional capabilities for alerting for security or failure detection.</span><span class="sxs-lookup"><span data-stu-id="e97ba-142">You can also add additional capabilities for alerting for security or failure detection.</span></span> <span data-ttu-id="e97ba-143">You can build these utilities using PowerShell, the HDInsight SDKs, or code that accesses the Azure classic deployment model.</span><span class="sxs-lookup"><span data-stu-id="e97ba-143">You can build these utilities using PowerShell, the HDInsight SDKs, or code that accesses the Azure classic deployment model.</span></span>

* <span data-ttu-id="e97ba-144">Consider whether a monitoring solution or service would be a useful benefit.</span><span class="sxs-lookup"><span data-stu-id="e97ba-144">Consider whether a monitoring solution or service would be a useful benefit.</span></span> <span data-ttu-id="e97ba-145">The Microsoft System Center provides an [HDInsight management pack](https://www.microsoft.com/download/details.aspx?id=42521).</span><span class="sxs-lookup"><span data-stu-id="e97ba-145">The Microsoft System Center provides an [HDInsight management pack](https://www.microsoft.com/download/details.aspx?id=42521).</span></span> <span data-ttu-id="e97ba-146">You can also use third-party tools such as Chukwa and Ganglia to collect and centralize logs.</span><span class="sxs-lookup"><span data-stu-id="e97ba-146">You can also use third-party tools such as Chukwa and Ganglia to collect and centralize logs.</span></span> <span data-ttu-id="e97ba-147">Many companies offer services to monitor Hadoop-based big data solutions, for example Centerity, Compuware APM, Sematext SPM, and Zettaset Orchestrator.</span><span class="sxs-lookup"><span data-stu-id="e97ba-147">Many companies offer services to monitor Hadoop-based big data solutions, for example Centerity, Compuware APM, Sematext SPM, and Zettaset Orchestrator.</span></span>

## <a name="step-2-manage-cluster-service-versions-and-view-script-action-logs"></a><span data-ttu-id="e97ba-148">Step 2: Manage cluster service versions and view Script Action logs</span><span class="sxs-lookup"><span data-stu-id="e97ba-148">Step 2: Manage cluster service versions and view Script Action logs</span></span>

<span data-ttu-id="e97ba-149">A typical HDInsight cluster uses several services and open-source software packages (such as Apache HBase, Apache Spark, and so forth).</span><span class="sxs-lookup"><span data-stu-id="e97ba-149">A typical HDInsight cluster uses several services and open-source software packages (such as Apache HBase, Apache Spark, and so forth).</span></span> <span data-ttu-id="e97ba-150">For some workloads, such as bioinformatics, you may be required to retain service configuration log history in addition to job execution logs.</span><span class="sxs-lookup"><span data-stu-id="e97ba-150">For some workloads, such as bioinformatics, you may be required to retain service configuration log history in addition to job execution logs.</span></span>

### <a name="view-cluster-configuration-settings-with-the-ambari-ui"></a><span data-ttu-id="e97ba-151">View cluster configuration settings with the Ambari UI</span><span class="sxs-lookup"><span data-stu-id="e97ba-151">View cluster configuration settings with the Ambari UI</span></span>

<span data-ttu-id="e97ba-152">Apache Ambari simplifies the management, configuration, and monitoring of a HDInsight cluster by providing a web UI and a REST API.</span><span class="sxs-lookup"><span data-stu-id="e97ba-152">Apache Ambari simplifies the management, configuration, and monitoring of a HDInsight cluster by providing a web UI and a REST API.</span></span> <span data-ttu-id="e97ba-153">Ambari is included on Linux-based HDInsight clusters.</span><span class="sxs-lookup"><span data-stu-id="e97ba-153">Ambari is included on Linux-based HDInsight clusters.</span></span> <span data-ttu-id="e97ba-154">Select the **Cluster Dashboard** pane on the Azure portal HDInsight page to open the **'Cluster Dashboards** link page.</span><span class="sxs-lookup"><span data-stu-id="e97ba-154">Select the **Cluster Dashboard** pane on the Azure portal HDInsight page to open the **'Cluster Dashboards** link page.</span></span>  <span data-ttu-id="e97ba-155">Next, select the **HDInsight cluster dashboard** pane to open the Ambari UI.</span><span class="sxs-lookup"><span data-stu-id="e97ba-155">Next, select the **HDInsight cluster dashboard** pane to open the Ambari UI.</span></span>  <span data-ttu-id="e97ba-156">You are prompted for your cluster login credentials.</span><span class="sxs-lookup"><span data-stu-id="e97ba-156">You are prompted for your cluster login credentials.</span></span>

<span data-ttu-id="e97ba-157">To open a list of service views, select the **Ambari Views** pane on the Azure portal page for HDInsight.</span><span class="sxs-lookup"><span data-stu-id="e97ba-157">To open a list of service views, select the **Ambari Views** pane on the Azure portal page for HDInsight.</span></span>  <span data-ttu-id="e97ba-158">This list varies, depending on which libraries you've installed.</span><span class="sxs-lookup"><span data-stu-id="e97ba-158">This list varies, depending on which libraries you've installed.</span></span>  <span data-ttu-id="e97ba-159">For example, you may see YARN Queue Manager, Hive View, and Tez View.</span><span class="sxs-lookup"><span data-stu-id="e97ba-159">For example, you may see YARN Queue Manager, Hive View, and Tez View.</span></span>  <span data-ttu-id="e97ba-160">Select any service link to see configuration and service information.</span><span class="sxs-lookup"><span data-stu-id="e97ba-160">Select any service link to see configuration and service information.</span></span>  <span data-ttu-id="e97ba-161">The Ambari UI **Stack and Version** page provides information about the cluster services' configuration and service version history.</span><span class="sxs-lookup"><span data-stu-id="e97ba-161">The Ambari UI **Stack and Version** page provides information about the cluster services' configuration and service version history.</span></span> <span data-ttu-id="e97ba-162">To navigate to this section of the Ambari UI, select the **Admin** menu and then **Stacks and Versions**.</span><span class="sxs-lookup"><span data-stu-id="e97ba-162">To navigate to this section of the Ambari UI, select the **Admin** menu and then **Stacks and Versions**.</span></span>  <span data-ttu-id="e97ba-163">Select the **Versions** tab to see service version information.</span><span class="sxs-lookup"><span data-stu-id="e97ba-163">Select the **Versions** tab to see service version information.</span></span>

![Stack and Versions](./media/hdinsight-log-management/stack-versions.png)

<span data-ttu-id="e97ba-165">Using the Ambari UI, you can download the configuration for any (or all) services running on a particular host (or node) in the cluster.</span><span class="sxs-lookup"><span data-stu-id="e97ba-165">Using the Ambari UI, you can download the configuration for any (or all) services running on a particular host (or node) in the cluster.</span></span>  <span data-ttu-id="e97ba-166">Select the **Hosts** menu, then the link for the host of interest.</span><span class="sxs-lookup"><span data-stu-id="e97ba-166">Select the **Hosts** menu, then the link for the host of interest.</span></span> <span data-ttu-id="e97ba-167">On that host's page, select the **Host Actions** button and then **Download Client Configs**.</span><span class="sxs-lookup"><span data-stu-id="e97ba-167">On that host's page, select the **Host Actions** button and then **Download Client Configs**.</span></span> 

![Host client configs](./media/hdinsight-log-management/client-configs.png)

### <a name="view-the-script-action-logs"></a><span data-ttu-id="e97ba-169">View the script action logs</span><span class="sxs-lookup"><span data-stu-id="e97ba-169">View the script action logs</span></span>

<span data-ttu-id="e97ba-170">HDInsight [script actions](hdinsight-hadoop-customize-cluster-linux.md) run scripts on a cluster, either manually or when specified.</span><span class="sxs-lookup"><span data-stu-id="e97ba-170">HDInsight [script actions](hdinsight-hadoop-customize-cluster-linux.md) run scripts on a cluster, either manually or when specified.</span></span> <span data-ttu-id="e97ba-171">For example, script actions can be used to install additional software on the cluster or to alter configuration settings from the default values.</span><span class="sxs-lookup"><span data-stu-id="e97ba-171">For example, script actions can be used to install additional software on the cluster or to alter configuration settings from the default values.</span></span> <span data-ttu-id="e97ba-172">Script action logs can provide insight into errors that occurred during setup of the cluster, and also configuration settings' changes that could affect cluster performance and availability.</span><span class="sxs-lookup"><span data-stu-id="e97ba-172">Script action logs can provide insight into errors that occurred during setup of the cluster, and also configuration settings' changes that could affect cluster performance and availability.</span></span>  <span data-ttu-id="e97ba-173">To see the status of a script action, select the **ops** button on your Ambari UI, or access the status logs in the default storage account.</span><span class="sxs-lookup"><span data-stu-id="e97ba-173">To see the status of a script action, select the **ops** button on your Ambari UI, or access the status logs in the default storage account.</span></span> <span data-ttu-id="e97ba-174">The storage logs are available at `/STORAGE_ACCOUNT_NAME/DEFAULT_CONTAINER_NAME/custom-scriptaction-logs/CLUSTER_NAME/DATE`.</span><span class="sxs-lookup"><span data-stu-id="e97ba-174">The storage logs are available at `/STORAGE_ACCOUNT_NAME/DEFAULT_CONTAINER_NAME/custom-scriptaction-logs/CLUSTER_NAME/DATE`.</span></span>

## <a name="step-3-manage-the-cluster-job-execution-log-files"></a><span data-ttu-id="e97ba-175">Step 3: Manage the cluster job execution log files</span><span class="sxs-lookup"><span data-stu-id="e97ba-175">Step 3: Manage the cluster job execution log files</span></span>

<span data-ttu-id="e97ba-176">The next step is reviewing the job execution log files for the various services.</span><span class="sxs-lookup"><span data-stu-id="e97ba-176">The next step is reviewing the job execution log files for the various services.</span></span>  <span data-ttu-id="e97ba-177">Services could include Apache HBase, Apache Spark, and many others.</span><span class="sxs-lookup"><span data-stu-id="e97ba-177">Services could include Apache HBase, Apache Spark, and many others.</span></span> <span data-ttu-id="e97ba-178">A Hadoop cluster produces a large number of verbose logs, so determining which logs are useful (and which are not) can be time-consuming.</span><span class="sxs-lookup"><span data-stu-id="e97ba-178">A Hadoop cluster produces a large number of verbose logs, so determining which logs are useful (and which are not) can be time-consuming.</span></span>  <span data-ttu-id="e97ba-179">Understanding the logging system is important for targeted management of log files.</span><span class="sxs-lookup"><span data-stu-id="e97ba-179">Understanding the logging system is important for targeted management of log files.</span></span>  <span data-ttu-id="e97ba-180">The following is an example log file.</span><span class="sxs-lookup"><span data-stu-id="e97ba-180">The following is an example log file.</span></span>

![HDInsight log file example](./media/hdinsight-troubleshoot-failed-cluster/logs.png)

### <a name="access-the-hadoop-log-files"></a><span data-ttu-id="e97ba-182">Access the Hadoop log files</span><span class="sxs-lookup"><span data-stu-id="e97ba-182">Access the Hadoop log files</span></span>

<span data-ttu-id="e97ba-183">HDInsight stores its log files both in the cluster file system and in Azure storage.</span><span class="sxs-lookup"><span data-stu-id="e97ba-183">HDInsight stores its log files both in the cluster file system and in Azure storage.</span></span> <span data-ttu-id="e97ba-184">You can examine log files in the cluster by opening an SSH connection to the cluster and browsing the file system, or by using the Hadoop YARN Status portal on the remote head node server.</span><span class="sxs-lookup"><span data-stu-id="e97ba-184">You can examine log files in the cluster by opening an SSH connection to the cluster and browsing the file system, or by using the Hadoop YARN Status portal on the remote head node server.</span></span> <span data-ttu-id="e97ba-185">You can examine the log files in Azure storage using any of the tools that can access and download data from Azure storage.</span><span class="sxs-lookup"><span data-stu-id="e97ba-185">You can examine the log files in Azure storage using any of the tools that can access and download data from Azure storage.</span></span> <span data-ttu-id="e97ba-186">Examples are AZCopy, CloudXplorer, and the Visual Studio Server Explorer.</span><span class="sxs-lookup"><span data-stu-id="e97ba-186">Examples are AZCopy, CloudXplorer, and the Visual Studio Server Explorer.</span></span> <span data-ttu-id="e97ba-187">You can also use PowerShell and the Azure Storage Client libraries, or the Azure .NET SDKs, to access data in Azure blob storage.</span><span class="sxs-lookup"><span data-stu-id="e97ba-187">You can also use PowerShell and the Azure Storage Client libraries, or the Azure .NET SDKs, to access data in Azure blob storage.</span></span>

<span data-ttu-id="e97ba-188">Hadoop runs the work of the jobs as *task attempts* on various nodes in the cluster.</span><span class="sxs-lookup"><span data-stu-id="e97ba-188">Hadoop runs the work of the jobs as *task attempts* on various nodes in the cluster.</span></span> <span data-ttu-id="e97ba-189">HDInsight can initiate speculative task attempts, terminating any other task attempts that do not complete first.</span><span class="sxs-lookup"><span data-stu-id="e97ba-189">HDInsight can initiate speculative task attempts, terminating any other task attempts that do not complete first.</span></span> <span data-ttu-id="e97ba-190">This generates significant activity that is logged to the controller, stderr, and syslog log files on-the-fly.</span><span class="sxs-lookup"><span data-stu-id="e97ba-190">This generates significant activity that is logged to the controller, stderr, and syslog log files on-the-fly.</span></span> <span data-ttu-id="e97ba-191">In addition, multiple task attempts are running simultaneously, but a log file can only display results linearly.</span><span class="sxs-lookup"><span data-stu-id="e97ba-191">In addition, multiple task attempts are running simultaneously, but a log file can only display results linearly.</span></span>

#### <a name="hdinsight-logs-written-to-azure-blob-storage"></a><span data-ttu-id="e97ba-192">HDInsight logs written to Azure Blob storage</span><span class="sxs-lookup"><span data-stu-id="e97ba-192">HDInsight logs written to Azure Blob storage</span></span>

<span data-ttu-id="e97ba-193">HDInsight clusters are configured to write task logs to an Azure Blob storage account for any job that is submitted using the Azure PowerShell cmdlets or the .NET job submission APIs.</span><span class="sxs-lookup"><span data-stu-id="e97ba-193">HDInsight clusters are configured to write task logs to an Azure Blob storage account for any job that is submitted using the Azure PowerShell cmdlets or the .NET job submission APIs.</span></span>  <span data-ttu-id="e97ba-194">If you submit jobs through SSH to the cluster, then the execution logging information is stored in the Azure Tables as discussed in the previous section.</span><span class="sxs-lookup"><span data-stu-id="e97ba-194">If you submit jobs through SSH to the cluster, then the execution logging information is stored in the Azure Tables as discussed in the previous section.</span></span>

<span data-ttu-id="e97ba-195">In addition to the core log files generated by HDInsight, installed services such as YARN also generate job execution log files.</span><span class="sxs-lookup"><span data-stu-id="e97ba-195">In addition to the core log files generated by HDInsight, installed services such as YARN also generate job execution log files.</span></span>  <span data-ttu-id="e97ba-196">The number and type of log files depends on the services installed.</span><span class="sxs-lookup"><span data-stu-id="e97ba-196">The number and type of log files depends on the services installed.</span></span>  <span data-ttu-id="e97ba-197">Common services are Apache HBase, Apache Spark, and so on.</span><span class="sxs-lookup"><span data-stu-id="e97ba-197">Common services are Apache HBase, Apache Spark, and so on.</span></span>  <span data-ttu-id="e97ba-198">Investigate the job log execution files for each service to understand the overall logging files available on your cluster.</span><span class="sxs-lookup"><span data-stu-id="e97ba-198">Investigate the job log execution files for each service to understand the overall logging files available on your cluster.</span></span>  <span data-ttu-id="e97ba-199">Each service has its own unique methods of logging and locations for storing log files.</span><span class="sxs-lookup"><span data-stu-id="e97ba-199">Each service has its own unique methods of logging and locations for storing log files.</span></span>  <span data-ttu-id="e97ba-200">As an example, details for accessing the most common service log files (from YARN) are discussed in the following section.</span><span class="sxs-lookup"><span data-stu-id="e97ba-200">As an example, details for accessing the most common service log files (from YARN) are discussed in the following section.</span></span>

### <a name="hdinsight-logs-generated-by-yarn"></a><span data-ttu-id="e97ba-201">HDInsight logs generated by YARN</span><span class="sxs-lookup"><span data-stu-id="e97ba-201">HDInsight logs generated by YARN</span></span>

<span data-ttu-id="e97ba-202">YARN aggregates logs across all containers on a worker node and stores those logs as one aggregated log file per worker node.</span><span class="sxs-lookup"><span data-stu-id="e97ba-202">YARN aggregates logs across all containers on a worker node and stores those logs as one aggregated log file per worker node.</span></span> <span data-ttu-id="e97ba-203">That log is stored on the default file system after an application finishes.</span><span class="sxs-lookup"><span data-stu-id="e97ba-203">That log is stored on the default file system after an application finishes.</span></span> <span data-ttu-id="e97ba-204">Your application may use hundreds or thousands of containers, but logs for all containers that are run on a single worker node are always aggregated to a single file.</span><span class="sxs-lookup"><span data-stu-id="e97ba-204">Your application may use hundreds or thousands of containers, but logs for all containers that are run on a single worker node are always aggregated to a single file.</span></span> <span data-ttu-id="e97ba-205">There is only one log per worker node used by your application.</span><span class="sxs-lookup"><span data-stu-id="e97ba-205">There is only one log per worker node used by your application.</span></span> <span data-ttu-id="e97ba-206">Log aggregation is enabled by default on HDInsight clusters version 3.0 and above.</span><span class="sxs-lookup"><span data-stu-id="e97ba-206">Log aggregation is enabled by default on HDInsight clusters version 3.0 and above.</span></span> <span data-ttu-id="e97ba-207">Aggregated logs are located in default storage for the cluster.</span><span class="sxs-lookup"><span data-stu-id="e97ba-207">Aggregated logs are located in default storage for the cluster.</span></span>

```
    /app-logs/<user>/logs/<applicationId>
```

<span data-ttu-id="e97ba-208">The aggregated logs are not directly readable, as they are written in a TFile binary format indexed by container.</span><span class="sxs-lookup"><span data-stu-id="e97ba-208">The aggregated logs are not directly readable, as they are written in a TFile binary format indexed by container.</span></span> <span data-ttu-id="e97ba-209">Use the YARN ResourceManager logs or CLI tools to view these logs as plain text for applications or containers of interest.</span><span class="sxs-lookup"><span data-stu-id="e97ba-209">Use the YARN ResourceManager logs or CLI tools to view these logs as plain text for applications or containers of interest.</span></span>

#### <a name="yarn-cli-tools"></a><span data-ttu-id="e97ba-210">YARN CLI tools</span><span class="sxs-lookup"><span data-stu-id="e97ba-210">YARN CLI tools</span></span>

<span data-ttu-id="e97ba-211">To use the YARN CLI tools, you must first connect to the HDInsight cluster using SSH.</span><span class="sxs-lookup"><span data-stu-id="e97ba-211">To use the YARN CLI tools, you must first connect to the HDInsight cluster using SSH.</span></span> <span data-ttu-id="e97ba-212">Specify the `<applicationId>`, `<user-who-started-the-application>`, `<containerId>`, and `<worker-node-address>` information when running these commands.</span><span class="sxs-lookup"><span data-stu-id="e97ba-212">Specify the `<applicationId>`, `<user-who-started-the-application>`, `<containerId>`, and `<worker-node-address>` information when running these commands.</span></span> <span data-ttu-id="e97ba-213">You can view the logs as plain text with one of the following commands:</span><span class="sxs-lookup"><span data-stu-id="e97ba-213">You can view the logs as plain text with one of the following commands:</span></span>

```bash
    yarn logs -applicationId <applicationId> -appOwner <user-who-started-the-application>
    yarn logs -applicationId <applicationId> -appOwner <user-who-started-the-application> -containerId <containerId> -nodeAddress <worker-node-address>
```

#### <a name="yarn-resourcemanager-ui"></a><span data-ttu-id="e97ba-214">YARN ResourceManager UI</span><span class="sxs-lookup"><span data-stu-id="e97ba-214">YARN ResourceManager UI</span></span>

<span data-ttu-id="e97ba-215">The YARN ResourceManager UI runs on the cluster head node, and is accessed through the Ambari web UI.</span><span class="sxs-lookup"><span data-stu-id="e97ba-215">The YARN ResourceManager UI runs on the cluster head node, and is accessed through the Ambari web UI.</span></span> <span data-ttu-id="e97ba-216">Use the following steps to view the YARN logs:</span><span class="sxs-lookup"><span data-stu-id="e97ba-216">Use the following steps to view the YARN logs:</span></span>

1. <span data-ttu-id="e97ba-217">In a web browser, navigate to `https://CLUSTERNAME.azurehdinsight.net`.</span><span class="sxs-lookup"><span data-stu-id="e97ba-217">In a web browser, navigate to `https://CLUSTERNAME.azurehdinsight.net`.</span></span> <span data-ttu-id="e97ba-218">Replace CLUSTERNAME with the name of your HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="e97ba-218">Replace CLUSTERNAME with the name of your HDInsight cluster.</span></span>
2. <span data-ttu-id="e97ba-219">From the list of services on the left, select YARN.</span><span class="sxs-lookup"><span data-stu-id="e97ba-219">From the list of services on the left, select YARN.</span></span>
3. <span data-ttu-id="e97ba-220">From the Quick Links dropdown, select one of the cluster head nodes and then select **ResourceManager logs**.</span><span class="sxs-lookup"><span data-stu-id="e97ba-220">From the Quick Links dropdown, select one of the cluster head nodes and then select **ResourceManager logs**.</span></span> <span data-ttu-id="e97ba-221">You are presented with a list of links to YARN logs.</span><span class="sxs-lookup"><span data-stu-id="e97ba-221">You are presented with a list of links to YARN logs.</span></span>

## <a name="step-4-forecast-log-volume-storage-sizes-and-costs"></a><span data-ttu-id="e97ba-222">Step 4: Forecast log volume storage sizes and costs</span><span class="sxs-lookup"><span data-stu-id="e97ba-222">Step 4: Forecast log volume storage sizes and costs</span></span>

<span data-ttu-id="e97ba-223">After completing the previous steps, you have an understanding of the types and volumes of log files that your HDInsight cluster(s) are producing.</span><span class="sxs-lookup"><span data-stu-id="e97ba-223">After completing the previous steps, you have an understanding of the types and volumes of log files that your HDInsight cluster(s) are producing.</span></span>

<span data-ttu-id="e97ba-224">Next, analyze the volume of log data in key log storage locations over a period of time.</span><span class="sxs-lookup"><span data-stu-id="e97ba-224">Next, analyze the volume of log data in key log storage locations over a period of time.</span></span> <span data-ttu-id="e97ba-225">For example, you can analyze volume and growth over 30-60-90 day periods.</span><span class="sxs-lookup"><span data-stu-id="e97ba-225">For example, you can analyze volume and growth over 30-60-90 day periods.</span></span>  <span data-ttu-id="e97ba-226">Record this information in a spreadsheet or use other tools such as Visual Studio, the Azure Storage Explorer, or Power Query for Excel.</span><span class="sxs-lookup"><span data-stu-id="e97ba-226">Record this information in a spreadsheet or use other tools such as Visual Studio, the Azure Storage Explorer, or Power Query for Excel.</span></span> <span data-ttu-id="e97ba-227">For more information, see [Analyze HDInsight logs](hdinsight-debug-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="e97ba-227">For more information, see [Analyze HDInsight logs](hdinsight-debug-jobs.md).</span></span>  

<span data-ttu-id="e97ba-228">You now have enough information to create a log management strategy for the key logs.</span><span class="sxs-lookup"><span data-stu-id="e97ba-228">You now have enough information to create a log management strategy for the key logs.</span></span>  <span data-ttu-id="e97ba-229">Use your spreadsheet (or tool of choice) to forecast both log size growth and log storage Azure service costs going forward.</span><span class="sxs-lookup"><span data-stu-id="e97ba-229">Use your spreadsheet (or tool of choice) to forecast both log size growth and log storage Azure service costs going forward.</span></span>  <span data-ttu-id="e97ba-230">Consider also any log retention requirements for the set of logs that you are examining.</span><span class="sxs-lookup"><span data-stu-id="e97ba-230">Consider also any log retention requirements for the set of logs that you are examining.</span></span>  <span data-ttu-id="e97ba-231">Now you can reforecast future log storage costs, after determining which log files can be deleted (if any) and which logs should be retained and archived to less expensive Azure storage.</span><span class="sxs-lookup"><span data-stu-id="e97ba-231">Now you can reforecast future log storage costs, after determining which log files can be deleted (if any) and which logs should be retained and archived to less expensive Azure storage.</span></span>

## <a name="step-5-determine-log-archive-policies-and-processes"></a><span data-ttu-id="e97ba-232">Step 5: Determine log archive policies and processes</span><span class="sxs-lookup"><span data-stu-id="e97ba-232">Step 5: Determine log archive policies and processes</span></span>

<span data-ttu-id="e97ba-233">After you determine which log files can be deleted, you can adjust logging parameters on many Hadoop services to automatically delete log files after a specified time period.</span><span class="sxs-lookup"><span data-stu-id="e97ba-233">After you determine which log files can be deleted, you can adjust logging parameters on many Hadoop services to automatically delete log files after a specified time period.</span></span>

<span data-ttu-id="e97ba-234">For certain log files, you can use a lower-priced log file archiving approach.</span><span class="sxs-lookup"><span data-stu-id="e97ba-234">For certain log files, you can use a lower-priced log file archiving approach.</span></span> <span data-ttu-id="e97ba-235">For Azure Resource Manager  activity logs, you can explore this approach using the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="e97ba-235">For Azure Resource Manager  activity logs, you can explore this approach using the Azure portal.</span></span>  <span data-ttu-id="e97ba-236">Set up archiving of the ARM logs by selecting the **Activity Log**' link in the Azure portal for your HDInsight instance.</span><span class="sxs-lookup"><span data-stu-id="e97ba-236">Set up archiving of the ARM logs by selecting the **Activity Log**' link in the Azure portal for your HDInsight instance.</span></span>  <span data-ttu-id="e97ba-237">On the top of the Activity Log search page, select the **Export** menu item to open the **Export activity log** pane.</span><span class="sxs-lookup"><span data-stu-id="e97ba-237">On the top of the Activity Log search page, select the **Export** menu item to open the **Export activity log** pane.</span></span>  <span data-ttu-id="e97ba-238">Fill in the subscription, region, whether to export to a storage account, and how many days to retain the logs.</span><span class="sxs-lookup"><span data-stu-id="e97ba-238">Fill in the subscription, region, whether to export to a storage account, and how many days to retain the logs.</span></span> <span data-ttu-id="e97ba-239">On this same pane, you can also indicate whether to export to an event hub.</span><span class="sxs-lookup"><span data-stu-id="e97ba-239">On this same pane, you can also indicate whether to export to an event hub.</span></span> 

![Export Log Files](./media/hdinsight-log-management/archive.png)

<span data-ttu-id="e97ba-241">Alternatively, you can script log archiving with PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e97ba-241">Alternatively, you can script log archiving with PowerShell.</span></span>  <span data-ttu-id="e97ba-242">For an example PowerShell script, see [Archive Azure Automation logs to Azure Blob Storage](https://gallery.technet.microsoft.com/scriptcenter/Archive-Azure-Automation-898a1aa8).</span><span class="sxs-lookup"><span data-stu-id="e97ba-242">For an example PowerShell script, see [Archive Azure Automation logs to Azure Blob Storage](https://gallery.technet.microsoft.com/scriptcenter/Archive-Azure-Automation-898a1aa8).</span></span>

### <a name="accessing-azure-storage-metrics"></a><span data-ttu-id="e97ba-243">Accessing Azure storage metrics</span><span class="sxs-lookup"><span data-stu-id="e97ba-243">Accessing Azure storage metrics</span></span>

<span data-ttu-id="e97ba-244">Azure storage can be configured to log storage operations and access.</span><span class="sxs-lookup"><span data-stu-id="e97ba-244">Azure storage can be configured to log storage operations and access.</span></span> <span data-ttu-id="e97ba-245">You can use these very detailed logs for capacity monitoring and planning, and for auditing requests to storage.</span><span class="sxs-lookup"><span data-stu-id="e97ba-245">You can use these very detailed logs for capacity monitoring and planning, and for auditing requests to storage.</span></span> <span data-ttu-id="e97ba-246">The logged information includes latency details, enabling you to monitor and fine-tune the performance of your solutions.</span><span class="sxs-lookup"><span data-stu-id="e97ba-246">The logged information includes latency details, enabling you to monitor and fine-tune the performance of your solutions.</span></span>
<span data-ttu-id="e97ba-247">You can use the .NET SDK for Hadoop to examine the log files generated for the Azure storage that holds the data for an HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="e97ba-247">You can use the .NET SDK for Hadoop to examine the log files generated for the Azure storage that holds the data for an HDInsight cluster.</span></span>

### <a name="control-the-size-and-number-of-backup-indexes-for-old-log-files"></a><span data-ttu-id="e97ba-248">Control the size and number of backup indexes for old log files</span><span class="sxs-lookup"><span data-stu-id="e97ba-248">Control the size and number of backup indexes for old log files</span></span>

<span data-ttu-id="e97ba-249">To control the size and number of log files retained, set the following properties of the `RollingFileAppender`:</span><span class="sxs-lookup"><span data-stu-id="e97ba-249">To control the size and number of log files retained, set the following properties of the `RollingFileAppender`:</span></span>

* <span data-ttu-id="e97ba-250">`maxFileSize` is the critical size of the file, above which the file is rolled.</span><span class="sxs-lookup"><span data-stu-id="e97ba-250">`maxFileSize` is the critical size of the file, above which the file is rolled.</span></span> <span data-ttu-id="e97ba-251">The default value is 10 MB.</span><span class="sxs-lookup"><span data-stu-id="e97ba-251">The default value is 10 MB.</span></span>
* <span data-ttu-id="e97ba-252">`maxBackupIndex` specifies the number of backup files to be created, default 1.</span><span class="sxs-lookup"><span data-stu-id="e97ba-252">`maxBackupIndex` specifies the number of backup files to be created, default 1.</span></span>

### <a name="other-log-management-techniques"></a><span data-ttu-id="e97ba-253">Other log management techniques</span><span class="sxs-lookup"><span data-stu-id="e97ba-253">Other log management techniques</span></span>

<span data-ttu-id="e97ba-254">To avoid running out of disk space, you can use some OS tools such as `logrotate` to manage handling of log files.</span><span class="sxs-lookup"><span data-stu-id="e97ba-254">To avoid running out of disk space, you can use some OS tools such as `logrotate` to manage handling of log files.</span></span> <span data-ttu-id="e97ba-255">You can configure `logrotate` to run on a daily basis, compressing log files and removing old ones.</span><span class="sxs-lookup"><span data-stu-id="e97ba-255">You can configure `logrotate` to run on a daily basis, compressing log files and removing old ones.</span></span> <span data-ttu-id="e97ba-256">Your approach  depends on your requirements, such as how long to keep the logfiles on local nodes.</span><span class="sxs-lookup"><span data-stu-id="e97ba-256">Your approach  depends on your requirements, such as how long to keep the logfiles on local nodes.</span></span> 

<span data-ttu-id="e97ba-257">You can also check whether DEBUG logging is enabled for one or more services, which greatly increases the output log size.</span><span class="sxs-lookup"><span data-stu-id="e97ba-257">You can also check whether DEBUG logging is enabled for one or more services, which greatly increases the output log size.</span></span> 

<span data-ttu-id="e97ba-258">To collect the logs from all the nodes to one central location, you can create a data flow, such as ingesting all log entries into Solr.</span><span class="sxs-lookup"><span data-stu-id="e97ba-258">To collect the logs from all the nodes to one central location, you can create a data flow, such as ingesting all log entries into Solr.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e97ba-259">Next steps</span><span class="sxs-lookup"><span data-stu-id="e97ba-259">Next steps</span></span>

* [<span data-ttu-id="e97ba-260">Monitoring and Logging Practice for HDInsight</span><span class="sxs-lookup"><span data-stu-id="e97ba-260">Monitoring and Logging Practice for HDInsight</span></span>](https://msdn.microsoft.com/library/dn749790.aspx)
* [<span data-ttu-id="e97ba-261">Access YARN application log on Linux-based HDInsight</span><span class="sxs-lookup"><span data-stu-id="e97ba-261">Access YARN application log on Linux-based HDInsight</span></span>](hdinsight-hadoop-access-yarn-app-logs-linux.md)
* [<span data-ttu-id="e97ba-262">How to control size of log files for various Hadoop components</span><span class="sxs-lookup"><span data-stu-id="e97ba-262">How to control size of log files for various Hadoop components</span></span>](https://community.hortonworks.com/articles/8882/how-to-control-size-of-log-files-for-various-hdp-c.html)
