---
title: Troubleshoot a slow or failing HDInsight cluster - Azure HDInsight
description: Diagnose and troubleshoot a slow or failing HDInsight cluster.
services: hdinsight
author: ashishthaps
ms.author: ashishth
ms.reviewer: jasonh
ms.service: hdinsight
ms.custom: hdinsightactive
ms.topic: conceptual
ms.date: 01/11/2018
ms.openlocfilehash: f18e667e86c310e4d2950ba195911307aec5426d
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44866029"
---
# <a name="troubleshoot-a-slow-or-failing-hdinsight-cluster"></a><span data-ttu-id="949d5-103">Troubleshoot a slow or failing HDInsight cluster</span><span class="sxs-lookup"><span data-stu-id="949d5-103">Troubleshoot a slow or failing HDInsight cluster</span></span>

<span data-ttu-id="949d5-104">If an HDInsight cluster  is either running slowly or failing with an  error code, you have several troubleshooting options.</span><span class="sxs-lookup"><span data-stu-id="949d5-104">If an HDInsight cluster  is either running slowly or failing with an  error code, you have several troubleshooting options.</span></span> <span data-ttu-id="949d5-105">If your jobs are taking longer to run than expected, or you are seeing slow response times in general, there may be failures upstream from your cluster, such as the services on which the cluster runs.</span><span class="sxs-lookup"><span data-stu-id="949d5-105">If your jobs are taking longer to run than expected, or you are seeing slow response times in general, there may be failures upstream from your cluster, such as the services on which the cluster runs.</span></span> <span data-ttu-id="949d5-106">However, the most common cause of these slowdowns is insufficient scaling.</span><span class="sxs-lookup"><span data-stu-id="949d5-106">However, the most common cause of these slowdowns is insufficient scaling.</span></span> <span data-ttu-id="949d5-107">When you create a new HDInsight cluster, select the appropriate [virtual machine sizes](hdinsight-component-versioning.md#default-node-configuration-and-virtual-machine-sizes-for-clusters)</span><span class="sxs-lookup"><span data-stu-id="949d5-107">When you create a new HDInsight cluster, select the appropriate [virtual machine sizes](hdinsight-component-versioning.md#default-node-configuration-and-virtual-machine-sizes-for-clusters)</span></span>

<span data-ttu-id="949d5-108">To diagnose a slow or failing cluster, gather information about all aspects of the environment, such as  associated Azure Services, cluster configuration, and job execution information.</span><span class="sxs-lookup"><span data-stu-id="949d5-108">To diagnose a slow or failing cluster, gather information about all aspects of the environment, such as  associated Azure Services, cluster configuration, and job execution information.</span></span> <span data-ttu-id="949d5-109">A helpful diagnostic is to try to reproduce the  error state on another cluster.</span><span class="sxs-lookup"><span data-stu-id="949d5-109">A helpful diagnostic is to try to reproduce the  error state on another cluster.</span></span>

* <span data-ttu-id="949d5-110">Step 1: Gather data about the issue</span><span class="sxs-lookup"><span data-stu-id="949d5-110">Step 1: Gather data about the issue</span></span>
* <span data-ttu-id="949d5-111">Step 2: Validate the HDInsight cluster environment</span><span class="sxs-lookup"><span data-stu-id="949d5-111">Step 2: Validate the HDInsight cluster environment</span></span> 
* <span data-ttu-id="949d5-112">Step 3: View your cluster's health</span><span class="sxs-lookup"><span data-stu-id="949d5-112">Step 3: View your cluster's health</span></span>
* <span data-ttu-id="949d5-113">Step 4: Review the environment stack and versions</span><span class="sxs-lookup"><span data-stu-id="949d5-113">Step 4: Review the environment stack and versions</span></span>
* <span data-ttu-id="949d5-114">Step 5: Examine the cluster log files</span><span class="sxs-lookup"><span data-stu-id="949d5-114">Step 5: Examine the cluster log files</span></span>
* <span data-ttu-id="949d5-115">Step 6: Check configuration settings</span><span class="sxs-lookup"><span data-stu-id="949d5-115">Step 6: Check configuration settings</span></span>
* <span data-ttu-id="949d5-116">Step 7: Reproduce the failure on a different cluster</span><span class="sxs-lookup"><span data-stu-id="949d5-116">Step 7: Reproduce the failure on a different cluster</span></span> 

## <a name="step-1-gather-data-about-the-issue"></a><span data-ttu-id="949d5-117">Step 1: Gather data about the issue</span><span class="sxs-lookup"><span data-stu-id="949d5-117">Step 1: Gather data about the issue</span></span>

<span data-ttu-id="949d5-118">HDInsight provides many tools that you can use to identify and troubleshoot issues with clusters.</span><span class="sxs-lookup"><span data-stu-id="949d5-118">HDInsight provides many tools that you can use to identify and troubleshoot issues with clusters.</span></span> <span data-ttu-id="949d5-119">The following steps guide you through these tools and provide  suggestions for pinpointing the issue.</span><span class="sxs-lookup"><span data-stu-id="949d5-119">The following steps guide you through these tools and provide  suggestions for pinpointing the issue.</span></span>

### <a name="identify-the-problem"></a><span data-ttu-id="949d5-120">Identify the problem</span><span class="sxs-lookup"><span data-stu-id="949d5-120">Identify the problem</span></span>

<span data-ttu-id="949d5-121">To help identify  the problem, consider the following questions:</span><span class="sxs-lookup"><span data-stu-id="949d5-121">To help identify  the problem, consider the following questions:</span></span>

* <span data-ttu-id="949d5-122">What did I expect to happen?</span><span class="sxs-lookup"><span data-stu-id="949d5-122">What did I expect to happen?</span></span> <span data-ttu-id="949d5-123">What happened instead?</span><span class="sxs-lookup"><span data-stu-id="949d5-123">What happened instead?</span></span>
* <span data-ttu-id="949d5-124">How long did the process take to run?</span><span class="sxs-lookup"><span data-stu-id="949d5-124">How long did the process take to run?</span></span> <span data-ttu-id="949d5-125">How long should it have run?</span><span class="sxs-lookup"><span data-stu-id="949d5-125">How long should it have run?</span></span>
* <span data-ttu-id="949d5-126">Have my tasks always run slowly on this cluster?</span><span class="sxs-lookup"><span data-stu-id="949d5-126">Have my tasks always run slowly on this cluster?</span></span> <span data-ttu-id="949d5-127">Did they run faster on a different cluster?</span><span class="sxs-lookup"><span data-stu-id="949d5-127">Did they run faster on a different cluster?</span></span>
* <span data-ttu-id="949d5-128">When did this problem first occur?</span><span class="sxs-lookup"><span data-stu-id="949d5-128">When did this problem first occur?</span></span> <span data-ttu-id="949d5-129">How often has it happened since?</span><span class="sxs-lookup"><span data-stu-id="949d5-129">How often has it happened since?</span></span>
* <span data-ttu-id="949d5-130">Has anything changed in my cluster configuration?</span><span class="sxs-lookup"><span data-stu-id="949d5-130">Has anything changed in my cluster configuration?</span></span>

### <a name="cluster-details"></a><span data-ttu-id="949d5-131">Cluster details</span><span class="sxs-lookup"><span data-stu-id="949d5-131">Cluster details</span></span>

<span data-ttu-id="949d5-132">Important cluster information includes:</span><span class="sxs-lookup"><span data-stu-id="949d5-132">Important cluster information includes:</span></span>

* <span data-ttu-id="949d5-133">Cluster name.</span><span class="sxs-lookup"><span data-stu-id="949d5-133">Cluster name.</span></span>
* <span data-ttu-id="949d5-134">Cluster region -  check for [region outages](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="949d5-134">Cluster region -  check for [region outages](https://azure.microsoft.com/status/).</span></span>
* <span data-ttu-id="949d5-135">HDInsight cluster type and version.</span><span class="sxs-lookup"><span data-stu-id="949d5-135">HDInsight cluster type and version.</span></span>
* <span data-ttu-id="949d5-136">Type and number of HDInsight instances specified for the head and worker nodes.</span><span class="sxs-lookup"><span data-stu-id="949d5-136">Type and number of HDInsight instances specified for the head and worker nodes.</span></span>

<span data-ttu-id="949d5-137">The Azure portal can provide this information:</span><span class="sxs-lookup"><span data-stu-id="949d5-137">The Azure portal can provide this information:</span></span>

![HDInsight Azure portal Information](./media/hdinsight-troubleshoot-failed-cluster/portal.png)

<span data-ttu-id="949d5-139">You can also use the Azure CLI:</span><span class="sxs-lookup"><span data-stu-id="949d5-139">You can also use the Azure CLI:</span></span>

```
    azure hdinsight cluster list
    azure hdinsight cluster show <ClusterName>
```

<span data-ttu-id="949d5-140">Another option is using  PowerShell.</span><span class="sxs-lookup"><span data-stu-id="949d5-140">Another option is using  PowerShell.</span></span> <span data-ttu-id="949d5-141">For more information, see  [Manage Hadoop clusters in HDInsight with Azure PowerShell](hdinsight-administer-use-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="949d5-141">For more information, see  [Manage Hadoop clusters in HDInsight with Azure PowerShell](hdinsight-administer-use-powershell.md).</span></span>

## <a name="step-2-validate-the-hdinsight-cluster-environment"></a><span data-ttu-id="949d5-142">Step 2: Validate the HDInsight cluster environment</span><span class="sxs-lookup"><span data-stu-id="949d5-142">Step 2: Validate the HDInsight cluster environment</span></span>

<span data-ttu-id="949d5-143">Each HDInsight cluster relies on various Azure services, and on open-source software such as Apache HBase and Apache Spark.</span><span class="sxs-lookup"><span data-stu-id="949d5-143">Each HDInsight cluster relies on various Azure services, and on open-source software such as Apache HBase and Apache Spark.</span></span> <span data-ttu-id="949d5-144">HDInsight clusters can also call on other Azure services, such as Azure Virtual Networks.</span><span class="sxs-lookup"><span data-stu-id="949d5-144">HDInsight clusters can also call on other Azure services, such as Azure Virtual Networks.</span></span>  <span data-ttu-id="949d5-145">A cluster failure can be caused by any of the running services on your cluster, or by an external service.</span><span class="sxs-lookup"><span data-stu-id="949d5-145">A cluster failure can be caused by any of the running services on your cluster, or by an external service.</span></span>  <span data-ttu-id="949d5-146">A  cluster service configuration change can also cause the cluster to fail.</span><span class="sxs-lookup"><span data-stu-id="949d5-146">A  cluster service configuration change can also cause the cluster to fail.</span></span>

### <a name="service-details"></a><span data-ttu-id="949d5-147">Service details</span><span class="sxs-lookup"><span data-stu-id="949d5-147">Service details</span></span>

* <span data-ttu-id="949d5-148">Check the open-source library release versions</span><span class="sxs-lookup"><span data-stu-id="949d5-148">Check the open-source library release versions</span></span>
* <span data-ttu-id="949d5-149">Check for [Azure Service Outages](https://azure.microsoft.com/status/)</span><span class="sxs-lookup"><span data-stu-id="949d5-149">Check for [Azure Service Outages](https://azure.microsoft.com/status/)</span></span> 
* <span data-ttu-id="949d5-150">Check for Azure Service usage limits</span><span class="sxs-lookup"><span data-stu-id="949d5-150">Check for Azure Service usage limits</span></span> 
* <span data-ttu-id="949d5-151">Check the Azure Virtual Network subnet configuration</span><span class="sxs-lookup"><span data-stu-id="949d5-151">Check the Azure Virtual Network subnet configuration</span></span> 

### <a name="view-cluster-configuration-settings-with-the-ambari-ui"></a><span data-ttu-id="949d5-152">View cluster configuration settings with the Ambari UI</span><span class="sxs-lookup"><span data-stu-id="949d5-152">View cluster configuration settings with the Ambari UI</span></span>

<span data-ttu-id="949d5-153">Apache Ambari provides management and monitoring of a HDInsight cluster with a web UI and a REST API.</span><span class="sxs-lookup"><span data-stu-id="949d5-153">Apache Ambari provides management and monitoring of a HDInsight cluster with a web UI and a REST API.</span></span> <span data-ttu-id="949d5-154">Ambari is included on Linux-based HDInsight clusters.</span><span class="sxs-lookup"><span data-stu-id="949d5-154">Ambari is included on Linux-based HDInsight clusters.</span></span> <span data-ttu-id="949d5-155">Select the **Cluster Dashboard** pane on the Azure portal HDInsight page.</span><span class="sxs-lookup"><span data-stu-id="949d5-155">Select the **Cluster Dashboard** pane on the Azure portal HDInsight page.</span></span>  <span data-ttu-id="949d5-156">Select the **HDInsight cluster dashboard** pane to open the Ambari UI, and enter the  cluster login credentials.</span><span class="sxs-lookup"><span data-stu-id="949d5-156">Select the **HDInsight cluster dashboard** pane to open the Ambari UI, and enter the  cluster login credentials.</span></span>  

![Ambari UI](./media/hdinsight-troubleshoot-failed-cluster/ambari-ui.png)

<span data-ttu-id="949d5-158">To open a list of service views, select **Ambari Views** on the Azure portal page.</span><span class="sxs-lookup"><span data-stu-id="949d5-158">To open a list of service views, select **Ambari Views** on the Azure portal page.</span></span>  <span data-ttu-id="949d5-159">This list depends on which libraries are installed.</span><span class="sxs-lookup"><span data-stu-id="949d5-159">This list depends on which libraries are installed.</span></span> <span data-ttu-id="949d5-160">For example, you may see YARN Queue Manager, Hive View, and Tez View.</span><span class="sxs-lookup"><span data-stu-id="949d5-160">For example, you may see YARN Queue Manager, Hive View, and Tez View.</span></span>  <span data-ttu-id="949d5-161">Select a  service link to see configuration and service information.</span><span class="sxs-lookup"><span data-stu-id="949d5-161">Select a  service link to see configuration and service information.</span></span>

#### <a name="check-for-azure-service-outages"></a><span data-ttu-id="949d5-162">Check for Azure service outages</span><span class="sxs-lookup"><span data-stu-id="949d5-162">Check for Azure service outages</span></span>

<span data-ttu-id="949d5-163">HDInsight relies on several Azure services.</span><span class="sxs-lookup"><span data-stu-id="949d5-163">HDInsight relies on several Azure services.</span></span> <span data-ttu-id="949d5-164">It runs virtual servers on Azure HDInsight, stores data and scripts on Azure Blob storage or Azure DataLake Store, and indexes log files in Azure Table storage.</span><span class="sxs-lookup"><span data-stu-id="949d5-164">It runs virtual servers on Azure HDInsight, stores data and scripts on Azure Blob storage or Azure DataLake Store, and indexes log files in Azure Table storage.</span></span> <span data-ttu-id="949d5-165">Disruptions to these services, although rare, can cause issues in HDInsight.</span><span class="sxs-lookup"><span data-stu-id="949d5-165">Disruptions to these services, although rare, can cause issues in HDInsight.</span></span> <span data-ttu-id="949d5-166">If you have unexpected slowdowns or failures in your cluster,  check the [Azure Status Dashboard](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="949d5-166">If you have unexpected slowdowns or failures in your cluster,  check the [Azure Status Dashboard](https://azure.microsoft.com/status/).</span></span> <span data-ttu-id="949d5-167">The status of each service is listed by region.</span><span class="sxs-lookup"><span data-stu-id="949d5-167">The status of each service is listed by region.</span></span> <span data-ttu-id="949d5-168">Check your cluster's region and also regions for any related services.</span><span class="sxs-lookup"><span data-stu-id="949d5-168">Check your cluster's region and also regions for any related services.</span></span>

#### <a name="check-azure-service-usage-limits"></a><span data-ttu-id="949d5-169">Check Azure service usage limits</span><span class="sxs-lookup"><span data-stu-id="949d5-169">Check Azure service usage limits</span></span>

<span data-ttu-id="949d5-170">If you are launching a large cluster, or have launched many clusters simultaneously, a cluster can fail if  you have exceeded an Azure service limit.</span><span class="sxs-lookup"><span data-stu-id="949d5-170">If you are launching a large cluster, or have launched many clusters simultaneously, a cluster can fail if  you have exceeded an Azure service limit.</span></span> <span data-ttu-id="949d5-171">Service limits vary, depending on your Azure subscription.</span><span class="sxs-lookup"><span data-stu-id="949d5-171">Service limits vary, depending on your Azure subscription.</span></span> <span data-ttu-id="949d5-172">For more information, see [Azure subscription and service limits, quotas, and constraints](https://docs.microsoft.com/azure/azure-subscription-service-limits).</span><span class="sxs-lookup"><span data-stu-id="949d5-172">For more information, see [Azure subscription and service limits, quotas, and constraints](https://docs.microsoft.com/azure/azure-subscription-service-limits).</span></span>
<span data-ttu-id="949d5-173">You can request that Microsoft increase the number of HDInsight resources available (such as VM cores and VM instances) with a [Resource Manager core quota increase request](https://docs.microsoft.com/azure/azure-supportability/resource-manager-core-quotas-request).</span><span class="sxs-lookup"><span data-stu-id="949d5-173">You can request that Microsoft increase the number of HDInsight resources available (such as VM cores and VM instances) with a [Resource Manager core quota increase request](https://docs.microsoft.com/azure/azure-supportability/resource-manager-core-quotas-request).</span></span>

#### <a name="check-the-release-version"></a><span data-ttu-id="949d5-174">Check the release version</span><span class="sxs-lookup"><span data-stu-id="949d5-174">Check the release version</span></span>

<span data-ttu-id="949d5-175">Compare the cluster version with the latest HDInsight release.</span><span class="sxs-lookup"><span data-stu-id="949d5-175">Compare the cluster version with the latest HDInsight release.</span></span> <span data-ttu-id="949d5-176">Each   HDInsight release includes improvements such as new applications, features, patches, and bug fixes.</span><span class="sxs-lookup"><span data-stu-id="949d5-176">Each   HDInsight release includes improvements such as new applications, features, patches, and bug fixes.</span></span> <span data-ttu-id="949d5-177">The issue that is affecting your cluster may have been fixed in the latest release version.</span><span class="sxs-lookup"><span data-stu-id="949d5-177">The issue that is affecting your cluster may have been fixed in the latest release version.</span></span> <span data-ttu-id="949d5-178">If possible, re-run your cluster using the latest version of HDInsight and associated libraries such as Apache HBase, Apache Spark, and others.</span><span class="sxs-lookup"><span data-stu-id="949d5-178">If possible, re-run your cluster using the latest version of HDInsight and associated libraries such as Apache HBase, Apache Spark, and others.</span></span>

#### <a name="restart-your-cluster-services"></a><span data-ttu-id="949d5-179">Restart your cluster services</span><span class="sxs-lookup"><span data-stu-id="949d5-179">Restart your cluster services</span></span>

<span data-ttu-id="949d5-180">If you are experiencing slowdowns in your cluster, consider restarting your services through the Ambari UI or the Azure CLI.</span><span class="sxs-lookup"><span data-stu-id="949d5-180">If you are experiencing slowdowns in your cluster, consider restarting your services through the Ambari UI or the Azure CLI.</span></span> <span data-ttu-id="949d5-181">The cluster may be experiencing transient errors, and restarting is the quickest way to stabilize your environment and possibly improve performance.</span><span class="sxs-lookup"><span data-stu-id="949d5-181">The cluster may be experiencing transient errors, and restarting is the quickest way to stabilize your environment and possibly improve performance.</span></span>

## <a name="step-3-view-your-clusters-health"></a><span data-ttu-id="949d5-182">Step 3: View your cluster's health</span><span class="sxs-lookup"><span data-stu-id="949d5-182">Step 3: View your cluster's health</span></span>

<span data-ttu-id="949d5-183">HDInsight clusters are composed of different types of nodes running on virtual machine instances.</span><span class="sxs-lookup"><span data-stu-id="949d5-183">HDInsight clusters are composed of different types of nodes running on virtual machine instances.</span></span> <span data-ttu-id="949d5-184">Each node can be monitored for resource starvation, network connectivity issues, and other problems that can slow down the cluster.</span><span class="sxs-lookup"><span data-stu-id="949d5-184">Each node can be monitored for resource starvation, network connectivity issues, and other problems that can slow down the cluster.</span></span> <span data-ttu-id="949d5-185">Every cluster contains two head nodes, and most cluster types contain a combination of worker and edge nodes.</span><span class="sxs-lookup"><span data-stu-id="949d5-185">Every cluster contains two head nodes, and most cluster types contain a combination of worker and edge nodes.</span></span> 

<span data-ttu-id="949d5-186">For a description of the various nodes each cluster type uses, see [Set up clusters in HDInsight with Hadoop, Spark, Kafka, and more](hdinsight-hadoop-provision-linux-clusters.md).</span><span class="sxs-lookup"><span data-stu-id="949d5-186">For a description of the various nodes each cluster type uses, see [Set up clusters in HDInsight with Hadoop, Spark, Kafka, and more](hdinsight-hadoop-provision-linux-clusters.md).</span></span>

<span data-ttu-id="949d5-187">The following sections describe how to  check the health of each node and of the overall cluster.</span><span class="sxs-lookup"><span data-stu-id="949d5-187">The following sections describe how to  check the health of each node and of the overall cluster.</span></span>

### <a name="get-a-snapshot-of-the-cluster-health-using-the-ambari-ui-dashboard"></a><span data-ttu-id="949d5-188">Get a snapshot of the cluster health using the Ambari UI dashboard</span><span class="sxs-lookup"><span data-stu-id="949d5-188">Get a snapshot of the cluster health using the Ambari UI dashboard</span></span>

<span data-ttu-id="949d5-189">The [Ambari UI dashboard](#view-cluster-configuration-settings-with-the-ambari-ui) (`https://<clustername>.azurehdinsight.net`) provides an overview of cluster health, such as uptime, memory, network and CPU usage, HDFS disk usage, and so forth.</span><span class="sxs-lookup"><span data-stu-id="949d5-189">The [Ambari UI dashboard](#view-cluster-configuration-settings-with-the-ambari-ui) (`https://<clustername>.azurehdinsight.net`) provides an overview of cluster health, such as uptime, memory, network and CPU usage, HDFS disk usage, and so forth.</span></span> <span data-ttu-id="949d5-190">Use the Hosts section of Ambari to view resources at a host level.</span><span class="sxs-lookup"><span data-stu-id="949d5-190">Use the Hosts section of Ambari to view resources at a host level.</span></span> <span data-ttu-id="949d5-191">You can also stop and restart services.</span><span class="sxs-lookup"><span data-stu-id="949d5-191">You can also stop and restart services.</span></span>

### <a name="check-your-webhcat-service"></a><span data-ttu-id="949d5-192">Check your WebHCat service</span><span class="sxs-lookup"><span data-stu-id="949d5-192">Check your WebHCat service</span></span>

<span data-ttu-id="949d5-193">One common scenario for Hive, Pig, or Sqoop jobs failing is a failure with the [WebHCat](hdinsight-hadoop-templeton-webhcat-debug-errors.md) (or *Templeton*) service.</span><span class="sxs-lookup"><span data-stu-id="949d5-193">One common scenario for Hive, Pig, or Sqoop jobs failing is a failure with the [WebHCat](hdinsight-hadoop-templeton-webhcat-debug-errors.md) (or *Templeton*) service.</span></span> <span data-ttu-id="949d5-194">WebHCat is a REST interface for remote job execution, such as Hive, Pig, Scoop, and MapReduce.</span><span class="sxs-lookup"><span data-stu-id="949d5-194">WebHCat is a REST interface for remote job execution, such as Hive, Pig, Scoop, and MapReduce.</span></span> <span data-ttu-id="949d5-195">WebHCat translates the job submission requests into YARN applications, and returns a status derived from the YARN application status.</span><span class="sxs-lookup"><span data-stu-id="949d5-195">WebHCat translates the job submission requests into YARN applications, and returns a status derived from the YARN application status.</span></span>  <span data-ttu-id="949d5-196">The following sections describe common WebHCat  HTTP status codes.</span><span class="sxs-lookup"><span data-stu-id="949d5-196">The following sections describe common WebHCat  HTTP status codes.</span></span>

#### <a name="badgateway-502-status-code"></a><span data-ttu-id="949d5-197">BadGateway (502 status code)</span><span class="sxs-lookup"><span data-stu-id="949d5-197">BadGateway (502 status code)</span></span>

<span data-ttu-id="949d5-198">This is a generic message from gateway nodes, and is the most common failure status code.</span><span class="sxs-lookup"><span data-stu-id="949d5-198">This is a generic message from gateway nodes, and is the most common failure status code.</span></span> <span data-ttu-id="949d5-199">One possible cause for this is  the WebHCat service being down on the active head node.</span><span class="sxs-lookup"><span data-stu-id="949d5-199">One possible cause for this is  the WebHCat service being down on the active head node.</span></span> <span data-ttu-id="949d5-200">To check for this possibility, use the following CURL command:</span><span class="sxs-lookup"><span data-stu-id="949d5-200">To check for this possibility, use the following CURL command:</span></span>

```bash
$ curl -u admin:{HTTP PASSWD} https://{CLUSTERNAME}.azurehdinsight.net/templeton/v1/status?user.name=admin
```

<span data-ttu-id="949d5-201">Ambari  displays an alert showing the hosts on which the WebHCat service is down.</span><span class="sxs-lookup"><span data-stu-id="949d5-201">Ambari  displays an alert showing the hosts on which the WebHCat service is down.</span></span> <span data-ttu-id="949d5-202">You can try to bring the WebHCat service back up by restarting the service on its host.</span><span class="sxs-lookup"><span data-stu-id="949d5-202">You can try to bring the WebHCat service back up by restarting the service on its host.</span></span>

![Restart WebHCat Server](./media/hdinsight-troubleshoot-failed-cluster/restart-webhcat.png)

<span data-ttu-id="949d5-204">If a WebHCat server still does not come up, then check the  operations log  for failure messages.</span><span class="sxs-lookup"><span data-stu-id="949d5-204">If a WebHCat server still does not come up, then check the  operations log  for failure messages.</span></span> <span data-ttu-id="949d5-205">For more detailed information, check the `stderr` and `stdout` files referenced on the node.</span><span class="sxs-lookup"><span data-stu-id="949d5-205">For more detailed information, check the `stderr` and `stdout` files referenced on the node.</span></span>

#### <a name="webhcat-times-out"></a><span data-ttu-id="949d5-206">WebHCat times out</span><span class="sxs-lookup"><span data-stu-id="949d5-206">WebHCat times out</span></span>

<span data-ttu-id="949d5-207">An HDInsight Gateway times out responses that take longer than two minutes, returning `502 BadGateway`.</span><span class="sxs-lookup"><span data-stu-id="949d5-207">An HDInsight Gateway times out responses that take longer than two minutes, returning `502 BadGateway`.</span></span> <span data-ttu-id="949d5-208">WebHCat queries YARN services for job statuses, and if YARN takes longer than two minutes to respond, that request can time out.</span><span class="sxs-lookup"><span data-stu-id="949d5-208">WebHCat queries YARN services for job statuses, and if YARN takes longer than two minutes to respond, that request can time out.</span></span>

<span data-ttu-id="949d5-209">In this case, review the following logs in the `/var/log/webhcat` directory:</span><span class="sxs-lookup"><span data-stu-id="949d5-209">In this case, review the following logs in the `/var/log/webhcat` directory:</span></span>

* <span data-ttu-id="949d5-210">**webhcat.log** is the log4j log to which server writes logs</span><span class="sxs-lookup"><span data-stu-id="949d5-210">**webhcat.log** is the log4j log to which server writes logs</span></span>
* <span data-ttu-id="949d5-211">**webhcat-console.log** is the stdout of the server when started</span><span class="sxs-lookup"><span data-stu-id="949d5-211">**webhcat-console.log** is the stdout of the server when started</span></span>
* <span data-ttu-id="949d5-212">**webhcat-console-error.log** is the stderr of the server process</span><span class="sxs-lookup"><span data-stu-id="949d5-212">**webhcat-console-error.log** is the stderr of the server process</span></span>

> [!NOTE]
> <span data-ttu-id="949d5-213">Each `webhcat.log` is rolled over  daily, generating files named `webhcat.log.YYYY-MM-DD`.</span><span class="sxs-lookup"><span data-stu-id="949d5-213">Each `webhcat.log` is rolled over  daily, generating files named `webhcat.log.YYYY-MM-DD`.</span></span> <span data-ttu-id="949d5-214">Select the appropriate file for the time range you are investigating.</span><span class="sxs-lookup"><span data-stu-id="949d5-214">Select the appropriate file for the time range you are investigating.</span></span>

<span data-ttu-id="949d5-215">The following sections describe some possible causes for WebHCat timeouts.</span><span class="sxs-lookup"><span data-stu-id="949d5-215">The following sections describe some possible causes for WebHCat timeouts.</span></span>

##### <a name="webhcat-level-timeout"></a><span data-ttu-id="949d5-216">WebHCat level timeout</span><span class="sxs-lookup"><span data-stu-id="949d5-216">WebHCat level timeout</span></span>

<span data-ttu-id="949d5-217">When WebHCat is under load, with more than 10 open sockets, it takes longer to establish new socket connections, which can result in a timeout.</span><span class="sxs-lookup"><span data-stu-id="949d5-217">When WebHCat is under load, with more than 10 open sockets, it takes longer to establish new socket connections, which can result in a timeout.</span></span> <span data-ttu-id="949d5-218">To list the  network connections to and from WebHCat, use `netstat`  on the current active headnode:</span><span class="sxs-lookup"><span data-stu-id="949d5-218">To list the  network connections to and from WebHCat, use `netstat`  on the current active headnode:</span></span>

```bash
$ netstat | grep 30111
```

<span data-ttu-id="949d5-219">30111 is the port WebHCat listens on.</span><span class="sxs-lookup"><span data-stu-id="949d5-219">30111 is the port WebHCat listens on.</span></span> <span data-ttu-id="949d5-220">The number of open sockets should be less than 10.</span><span class="sxs-lookup"><span data-stu-id="949d5-220">The number of open sockets should be less than 10.</span></span>

<span data-ttu-id="949d5-221">If there are no open sockets, the previous command does not produce a result.</span><span class="sxs-lookup"><span data-stu-id="949d5-221">If there are no open sockets, the previous command does not produce a result.</span></span> <span data-ttu-id="949d5-222">To check if Templeton is up and listening on port 30111, use:</span><span class="sxs-lookup"><span data-stu-id="949d5-222">To check if Templeton is up and listening on port 30111, use:</span></span>

```bash
$ netstat -l | grep 30111
```

##### <a name="yarn-level-timeout"></a><span data-ttu-id="949d5-223">YARN level timeout</span><span class="sxs-lookup"><span data-stu-id="949d5-223">YARN level timeout</span></span>

<span data-ttu-id="949d5-224">Templeton calls YARN to run jobs, and the communication between Templeton and YARN can cause a timeout.</span><span class="sxs-lookup"><span data-stu-id="949d5-224">Templeton calls YARN to run jobs, and the communication between Templeton and YARN can cause a timeout.</span></span>

<span data-ttu-id="949d5-225">At the YARN level, there are two types of timeouts:</span><span class="sxs-lookup"><span data-stu-id="949d5-225">At the YARN level, there are two types of timeouts:</span></span>

1. <span data-ttu-id="949d5-226">Submitting a YARN job can take long enough to cause a timeout.</span><span class="sxs-lookup"><span data-stu-id="949d5-226">Submitting a YARN job can take long enough to cause a timeout.</span></span>

    <span data-ttu-id="949d5-227">If you open the `/var/log/webhcat/webhcat.log` log file and search for "queued job", you may see multiple entries where the execution time is excessively long (>2000 ms), with entries showing increasing wait times.</span><span class="sxs-lookup"><span data-stu-id="949d5-227">If you open the `/var/log/webhcat/webhcat.log` log file and search for "queued job", you may see multiple entries where the execution time is excessively long (>2000 ms), with entries showing increasing wait times.</span></span>

    <span data-ttu-id="949d5-228">The time for the queued jobs continues to increase because the rate at which new jobs get submitted is  higher than the rate at which the old jobs are completed.</span><span class="sxs-lookup"><span data-stu-id="949d5-228">The time for the queued jobs continues to increase because the rate at which new jobs get submitted is  higher than the rate at which the old jobs are completed.</span></span> <span data-ttu-id="949d5-229">Once the YARN memory is 100% used,  the *joblauncher queue* can no longer borrow capacity from the *default queue*.</span><span class="sxs-lookup"><span data-stu-id="949d5-229">Once the YARN memory is 100% used,  the *joblauncher queue* can no longer borrow capacity from the *default queue*.</span></span> <span data-ttu-id="949d5-230">Therefore, no more new jobs can be accepted into the joblauncher queue.</span><span class="sxs-lookup"><span data-stu-id="949d5-230">Therefore, no more new jobs can be accepted into the joblauncher queue.</span></span> <span data-ttu-id="949d5-231">This behavior can  cause the waiting time to become longer and longer, causing a timeout error that is usually followed by many others.</span><span class="sxs-lookup"><span data-stu-id="949d5-231">This behavior can  cause the waiting time to become longer and longer, causing a timeout error that is usually followed by many others.</span></span>

    <span data-ttu-id="949d5-232">The  following  image shows the joblauncher queue at 714.4% overused.</span><span class="sxs-lookup"><span data-stu-id="949d5-232">The  following  image shows the joblauncher queue at 714.4% overused.</span></span> <span data-ttu-id="949d5-233">This is acceptable so long as there is still free capacity in the default queue to borrow from.</span><span class="sxs-lookup"><span data-stu-id="949d5-233">This is acceptable so long as there is still free capacity in the default queue to borrow from.</span></span> <span data-ttu-id="949d5-234">However, when the cluster is fully utilized and the YARN memory is at 100% capacity, new jobs must wait, which eventually causes timeouts.</span><span class="sxs-lookup"><span data-stu-id="949d5-234">However, when the cluster is fully utilized and the YARN memory is at 100% capacity, new jobs must wait, which eventually causes timeouts.</span></span>

    ![Joblauncher queue](./media/hdinsight-troubleshoot-failed-cluster/joblauncher-queue.png)

    <span data-ttu-id="949d5-236">There are two ways to resolve this issue: either reduce the speed of new jobs being submitted, or increase the consumption speed of old jobs by scaling up the cluster.</span><span class="sxs-lookup"><span data-stu-id="949d5-236">There are two ways to resolve this issue: either reduce the speed of new jobs being submitted, or increase the consumption speed of old jobs by scaling up the cluster.</span></span>

2. <span data-ttu-id="949d5-237">YARN processing can take a long time, which can cause timeouts.</span><span class="sxs-lookup"><span data-stu-id="949d5-237">YARN processing can take a long time, which can cause timeouts.</span></span>

    * <span data-ttu-id="949d5-238">List all jobs: This is a time-consuming call.</span><span class="sxs-lookup"><span data-stu-id="949d5-238">List all jobs: This is a time-consuming call.</span></span> <span data-ttu-id="949d5-239">This call enumerates the applications from the YARN ResourceManager, and for each completed application, gets the status from the YARN JobHistoryServer.</span><span class="sxs-lookup"><span data-stu-id="949d5-239">This call enumerates the applications from the YARN ResourceManager, and for each completed application, gets the status from the YARN JobHistoryServer.</span></span> <span data-ttu-id="949d5-240">With  higher numbers of jobs, this call can time out.</span><span class="sxs-lookup"><span data-stu-id="949d5-240">With  higher numbers of jobs, this call can time out.</span></span>

    * <span data-ttu-id="949d5-241">List jobs older than seven days: The HDInsight YARN JobHistoryServer is configured to retain completed job information for seven days (`mapreduce.jobhistory.max-age-ms` value).</span><span class="sxs-lookup"><span data-stu-id="949d5-241">List jobs older than seven days: The HDInsight YARN JobHistoryServer is configured to retain completed job information for seven days (`mapreduce.jobhistory.max-age-ms` value).</span></span> <span data-ttu-id="949d5-242">Trying to enumerate purged jobs results in a timeout.</span><span class="sxs-lookup"><span data-stu-id="949d5-242">Trying to enumerate purged jobs results in a timeout.</span></span>

<span data-ttu-id="949d5-243">To diagnose these issues:</span><span class="sxs-lookup"><span data-stu-id="949d5-243">To diagnose these issues:</span></span>

    1. <span data-ttu-id="949d5-244">Determine the UTC time range to troubleshoot</span><span class="sxs-lookup"><span data-stu-id="949d5-244">Determine the UTC time range to troubleshoot</span></span>
    2. <span data-ttu-id="949d5-245">Select the appropriate `webhcat.log` file(s)</span><span class="sxs-lookup"><span data-stu-id="949d5-245">Select the appropriate `webhcat.log` file(s)</span></span>
    3. <span data-ttu-id="949d5-246">Look for WARN and ERROR messages during that time</span><span class="sxs-lookup"><span data-stu-id="949d5-246">Look for WARN and ERROR messages during that time</span></span>

#### <a name="other-webhcat-failures"></a><span data-ttu-id="949d5-247">Other WebHCat failures</span><span class="sxs-lookup"><span data-stu-id="949d5-247">Other WebHCat failures</span></span>

1. <span data-ttu-id="949d5-248">HTTP status code 500</span><span class="sxs-lookup"><span data-stu-id="949d5-248">HTTP status code 500</span></span>

    <span data-ttu-id="949d5-249">In most cases where WebHCat returns 500, the error message contains details on the failure.</span><span class="sxs-lookup"><span data-stu-id="949d5-249">In most cases where WebHCat returns 500, the error message contains details on the failure.</span></span> <span data-ttu-id="949d5-250">Otherwise, look through `webhcat.log` for WARN and ERROR messages.</span><span class="sxs-lookup"><span data-stu-id="949d5-250">Otherwise, look through `webhcat.log` for WARN and ERROR messages.</span></span>

2. <span data-ttu-id="949d5-251">Job failures</span><span class="sxs-lookup"><span data-stu-id="949d5-251">Job failures</span></span>

    <span data-ttu-id="949d5-252">There may be cases where interactions with WebHCat are successful, but the jobs are failing.</span><span class="sxs-lookup"><span data-stu-id="949d5-252">There may be cases where interactions with WebHCat are successful, but the jobs are failing.</span></span>

    <span data-ttu-id="949d5-253">Templeton collects the job console output as `stderr` in `statusdir`, which is often useful for troubleshooting.</span><span class="sxs-lookup"><span data-stu-id="949d5-253">Templeton collects the job console output as `stderr` in `statusdir`, which is often useful for troubleshooting.</span></span> <span data-ttu-id="949d5-254">`stderr` contains the YARN application identifier of the actual query.</span><span class="sxs-lookup"><span data-stu-id="949d5-254">`stderr` contains the YARN application identifier of the actual query.</span></span>

## <a name="step-4-review-the-environment-stack-and-versions"></a><span data-ttu-id="949d5-255">Step 4: Review the environment stack and versions</span><span class="sxs-lookup"><span data-stu-id="949d5-255">Step 4: Review the environment stack and versions</span></span>

<span data-ttu-id="949d5-256">The Ambari UI **Stack and Version** page provides information about cluster services configuration and service version history.</span><span class="sxs-lookup"><span data-stu-id="949d5-256">The Ambari UI **Stack and Version** page provides information about cluster services configuration and service version history.</span></span>  <span data-ttu-id="949d5-257">Incorrect Hadoop service library versions can be a cause of cluster failure.</span><span class="sxs-lookup"><span data-stu-id="949d5-257">Incorrect Hadoop service library versions can be a cause of cluster failure.</span></span>  <span data-ttu-id="949d5-258">In the Ambari UI, select the **Admin** menu and then  **Stacks and Versions**.</span><span class="sxs-lookup"><span data-stu-id="949d5-258">In the Ambari UI, select the **Admin** menu and then  **Stacks and Versions**.</span></span>  <span data-ttu-id="949d5-259">Select the **Versions** tab on the page to see service version information:</span><span class="sxs-lookup"><span data-stu-id="949d5-259">Select the **Versions** tab on the page to see service version information:</span></span>

![Stack and Versions](./media/hdinsight-troubleshoot-failed-cluster/stack-versions.png)

## <a name="step-5-examine-the-log-files"></a><span data-ttu-id="949d5-261">Step 5: Examine the log files</span><span class="sxs-lookup"><span data-stu-id="949d5-261">Step 5: Examine the log files</span></span>

<span data-ttu-id="949d5-262">There are many types of logs that are generated from the many services and components that comprise an HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="949d5-262">There are many types of logs that are generated from the many services and components that comprise an HDInsight cluster.</span></span> <span data-ttu-id="949d5-263">[WebHCat log files](#check-your-webhcat-service) are described previously.</span><span class="sxs-lookup"><span data-stu-id="949d5-263">[WebHCat log files](#check-your-webhcat-service) are described previously.</span></span> <span data-ttu-id="949d5-264">There are several other useful log files you can investigate to narrow down issues with your cluster, as described in the following sections.</span><span class="sxs-lookup"><span data-stu-id="949d5-264">There are several other useful log files you can investigate to narrow down issues with your cluster, as described in the following sections.</span></span>

![HDInsight log file example](./media/hdinsight-troubleshoot-failed-cluster/logs.png)

* <span data-ttu-id="949d5-266">HDInsight clusters consist of several nodes, most of which are tasked to run submitted jobs.</span><span class="sxs-lookup"><span data-stu-id="949d5-266">HDInsight clusters consist of several nodes, most of which are tasked to run submitted jobs.</span></span> <span data-ttu-id="949d5-267">Jobs run concurrently, but log files can only display results linearly.</span><span class="sxs-lookup"><span data-stu-id="949d5-267">Jobs run concurrently, but log files can only display results linearly.</span></span> <span data-ttu-id="949d5-268">HDInsight executes new tasks, terminating others that fail to complete first.</span><span class="sxs-lookup"><span data-stu-id="949d5-268">HDInsight executes new tasks, terminating others that fail to complete first.</span></span> <span data-ttu-id="949d5-269">All this activity is logged to the `stderr` and `syslog` files.</span><span class="sxs-lookup"><span data-stu-id="949d5-269">All this activity is logged to the `stderr` and `syslog` files.</span></span>

* <span data-ttu-id="949d5-270">The script action log files show errors or unexpected configuration changes during your cluster's creation process.</span><span class="sxs-lookup"><span data-stu-id="949d5-270">The script action log files show errors or unexpected configuration changes during your cluster's creation process.</span></span>

* <span data-ttu-id="949d5-271">The Hadoop step logs identify Hadoop jobs launched as part of a step containing errors.</span><span class="sxs-lookup"><span data-stu-id="949d5-271">The Hadoop step logs identify Hadoop jobs launched as part of a step containing errors.</span></span>

### <a name="check-the-script-action-logs"></a><span data-ttu-id="949d5-272">Check the script action logs</span><span class="sxs-lookup"><span data-stu-id="949d5-272">Check the script action logs</span></span>

<span data-ttu-id="949d5-273">HDInsight [script actions](hdinsight-hadoop-customize-cluster-linux.md) run scripts on the cluster manually or when specified.</span><span class="sxs-lookup"><span data-stu-id="949d5-273">HDInsight [script actions](hdinsight-hadoop-customize-cluster-linux.md) run scripts on the cluster manually or when specified.</span></span> <span data-ttu-id="949d5-274">For example, script actions can be used to install additional software on the cluster or to alter configuration settings from the default values.</span><span class="sxs-lookup"><span data-stu-id="949d5-274">For example, script actions can be used to install additional software on the cluster or to alter configuration settings from the default values.</span></span> <span data-ttu-id="949d5-275">Checking the script action logs can provide insight into errors that occurred during cluster setup and  configuration.</span><span class="sxs-lookup"><span data-stu-id="949d5-275">Checking the script action logs can provide insight into errors that occurred during cluster setup and  configuration.</span></span>  <span data-ttu-id="949d5-276">You can view the status of a script action by selecting the **ops** button in the Ambari UI, or by accessing the logs from the default storage account.</span><span class="sxs-lookup"><span data-stu-id="949d5-276">You can view the status of a script action by selecting the **ops** button in the Ambari UI, or by accessing the logs from the default storage account.</span></span>

<span data-ttu-id="949d5-277">The script action logs reside in the `\STORAGE_ACCOUNT_NAME\DEFAULT_CONTAINER_NAME\custom-scriptaction-logs\CLUSTER_NAME\DATE` directory.</span><span class="sxs-lookup"><span data-stu-id="949d5-277">The script action logs reside in the `\STORAGE_ACCOUNT_NAME\DEFAULT_CONTAINER_NAME\custom-scriptaction-logs\CLUSTER_NAME\DATE` directory.</span></span>

### <a name="view-hdinsight-logs-using-ambari-quick-links"></a><span data-ttu-id="949d5-278">View HDInsight logs using Ambari Quick Links</span><span class="sxs-lookup"><span data-stu-id="949d5-278">View HDInsight logs using Ambari Quick Links</span></span>

<span data-ttu-id="949d5-279">The HDInsight Ambari UI includes a number of **Quick Links** sections.</span><span class="sxs-lookup"><span data-stu-id="949d5-279">The HDInsight Ambari UI includes a number of **Quick Links** sections.</span></span>  <span data-ttu-id="949d5-280">To access the log links for a particular service in your HDInsight cluster, open the Ambari UI for your cluster, then select the service link from the list at left.</span><span class="sxs-lookup"><span data-stu-id="949d5-280">To access the log links for a particular service in your HDInsight cluster, open the Ambari UI for your cluster, then select the service link from the list at left.</span></span> <span data-ttu-id="949d5-281">Select  the **Quick Links** dropdown,  then the HDInsight node of interest, and then select the link for its associated log.</span><span class="sxs-lookup"><span data-stu-id="949d5-281">Select  the **Quick Links** dropdown,  then the HDInsight node of interest, and then select the link for its associated log.</span></span>

<span data-ttu-id="949d5-282">For example, for HDFS logs:</span><span class="sxs-lookup"><span data-stu-id="949d5-282">For example, for HDFS logs:</span></span>

![Ambari Quick Links to Log Files](./media/hdinsight-troubleshoot-failed-cluster/quick-links.png)

### <a name="view-hadoop-generated-log-files"></a><span data-ttu-id="949d5-284">View Hadoop-generated log files</span><span class="sxs-lookup"><span data-stu-id="949d5-284">View Hadoop-generated log files</span></span>

<span data-ttu-id="949d5-285">An HDInsight cluster generates logs that are written to Azure tables and Azure Blob storage.</span><span class="sxs-lookup"><span data-stu-id="949d5-285">An HDInsight cluster generates logs that are written to Azure tables and Azure Blob storage.</span></span> <span data-ttu-id="949d5-286">YARN creates its own execution logs.</span><span class="sxs-lookup"><span data-stu-id="949d5-286">YARN creates its own execution logs.</span></span> <span data-ttu-id="949d5-287">For more information, see [Manage logs for an HDInsight cluster](hdinsight-log-management.md#access-the-hadoop-log-files).</span><span class="sxs-lookup"><span data-stu-id="949d5-287">For more information, see [Manage logs for an HDInsight cluster](hdinsight-log-management.md#access-the-hadoop-log-files).</span></span>

### <a name="review-heap-dumps"></a><span data-ttu-id="949d5-288">Review heap dumps</span><span class="sxs-lookup"><span data-stu-id="949d5-288">Review heap dumps</span></span>

<span data-ttu-id="949d5-289">Heap dumps contain a snapshot of the application's memory, including the values of variables at that time, which are useful for diagnosing problems that occur at runtime.</span><span class="sxs-lookup"><span data-stu-id="949d5-289">Heap dumps contain a snapshot of the application's memory, including the values of variables at that time, which are useful for diagnosing problems that occur at runtime.</span></span> <span data-ttu-id="949d5-290">For more information, see [Enable heap dumps for Hadoop services on Linux-based HDInsight](hdinsight-hadoop-collect-debug-heap-dump-linux.md).</span><span class="sxs-lookup"><span data-stu-id="949d5-290">For more information, see [Enable heap dumps for Hadoop services on Linux-based HDInsight](hdinsight-hadoop-collect-debug-heap-dump-linux.md).</span></span>

## <a name="step-6-check-configuration-settings"></a><span data-ttu-id="949d5-291">Step 6: Check configuration settings</span><span class="sxs-lookup"><span data-stu-id="949d5-291">Step 6: Check configuration settings</span></span>

<span data-ttu-id="949d5-292">HDInsight clusters are pre-configured with default settings for related services, such as Hadoop, Hive, HBase, and so on.</span><span class="sxs-lookup"><span data-stu-id="949d5-292">HDInsight clusters are pre-configured with default settings for related services, such as Hadoop, Hive, HBase, and so on.</span></span> <span data-ttu-id="949d5-293">Depending on the type of cluster, its hardware configuration, its number of nodes, the types of jobs you are running, and the data you are working with (and how that data is being processed), you may need to optimize your configuration.</span><span class="sxs-lookup"><span data-stu-id="949d5-293">Depending on the type of cluster, its hardware configuration, its number of nodes, the types of jobs you are running, and the data you are working with (and how that data is being processed), you may need to optimize your configuration.</span></span>

<span data-ttu-id="949d5-294">For detailed instructions on optimizing performance configurations for most scenarios, see [Optimize cluster configurations with Ambari](hdinsight-changing-configs-via-ambari.md).</span><span class="sxs-lookup"><span data-stu-id="949d5-294">For detailed instructions on optimizing performance configurations for most scenarios, see [Optimize cluster configurations with Ambari](hdinsight-changing-configs-via-ambari.md).</span></span> <span data-ttu-id="949d5-295">When using Spark, see [Optimize Spark jobs for performance](spark/apache-spark-perf.md).</span><span class="sxs-lookup"><span data-stu-id="949d5-295">When using Spark, see [Optimize Spark jobs for performance](spark/apache-spark-perf.md).</span></span> 

## <a name="step-7-reproduce-the-failure-on-a-different-cluster"></a><span data-ttu-id="949d5-296">Step 7: Reproduce the failure on a different cluster</span><span class="sxs-lookup"><span data-stu-id="949d5-296">Step 7: Reproduce the failure on a different cluster</span></span>

<span data-ttu-id="949d5-297">To help diagnose the source of a cluster error, start a new cluster with the same configuration and then resubmit the failed job's steps one by one.</span><span class="sxs-lookup"><span data-stu-id="949d5-297">To help diagnose the source of a cluster error, start a new cluster with the same configuration and then resubmit the failed job's steps one by one.</span></span> <span data-ttu-id="949d5-298">Check the results of each step before processing the next one.</span><span class="sxs-lookup"><span data-stu-id="949d5-298">Check the results of each step before processing the next one.</span></span> <span data-ttu-id="949d5-299">This method gives you the opportunity to correct and re-run a single failed step.</span><span class="sxs-lookup"><span data-stu-id="949d5-299">This method gives you the opportunity to correct and re-run a single failed step.</span></span> <span data-ttu-id="949d5-300">This method also has the advantage of  only loading your input data once.</span><span class="sxs-lookup"><span data-stu-id="949d5-300">This method also has the advantage of  only loading your input data once.</span></span>

1. <span data-ttu-id="949d5-301">Create a new test cluster with the same configuration as the failed cluster.</span><span class="sxs-lookup"><span data-stu-id="949d5-301">Create a new test cluster with the same configuration as the failed cluster.</span></span>
2. <span data-ttu-id="949d5-302">Submit the first job step to the test cluster.</span><span class="sxs-lookup"><span data-stu-id="949d5-302">Submit the first job step to the test cluster.</span></span>
3. <span data-ttu-id="949d5-303">When the step completes processing, check for errors in the step log files.</span><span class="sxs-lookup"><span data-stu-id="949d5-303">When the step completes processing, check for errors in the step log files.</span></span> <span data-ttu-id="949d5-304">Connect to the test cluster's master node and view the log files there.</span><span class="sxs-lookup"><span data-stu-id="949d5-304">Connect to the test cluster's master node and view the log files there.</span></span> <span data-ttu-id="949d5-305">The step log files only  appear after the step runs for some time, finishes, or fails.</span><span class="sxs-lookup"><span data-stu-id="949d5-305">The step log files only  appear after the step runs for some time, finishes, or fails.</span></span>
4. <span data-ttu-id="949d5-306">If the first step succeeded, run the next step.</span><span class="sxs-lookup"><span data-stu-id="949d5-306">If the first step succeeded, run the next step.</span></span> <span data-ttu-id="949d5-307">If there were errors, investigate the error in the log files.</span><span class="sxs-lookup"><span data-stu-id="949d5-307">If there were errors, investigate the error in the log files.</span></span> <span data-ttu-id="949d5-308">If it was an error in your code, make the correction and re-run the step.</span><span class="sxs-lookup"><span data-stu-id="949d5-308">If it was an error in your code, make the correction and re-run the step.</span></span> 
5. <span data-ttu-id="949d5-309">Continue until all steps run without error.</span><span class="sxs-lookup"><span data-stu-id="949d5-309">Continue until all steps run without error.</span></span>
6. <span data-ttu-id="949d5-310">When you are done debugging the test cluster, delete it.</span><span class="sxs-lookup"><span data-stu-id="949d5-310">When you are done debugging the test cluster, delete it.</span></span>

## <a name="next-steps"></a><span data-ttu-id="949d5-311">Next steps</span><span class="sxs-lookup"><span data-stu-id="949d5-311">Next steps</span></span>

* [<span data-ttu-id="949d5-312">Manage HDInsight clusters by using the Ambari Web UI</span><span class="sxs-lookup"><span data-stu-id="949d5-312">Manage HDInsight clusters by using the Ambari Web UI</span></span>](hdinsight-hadoop-manage-ambari.md)
* [<span data-ttu-id="949d5-313">Analyze HDInsight Logs</span><span class="sxs-lookup"><span data-stu-id="949d5-313">Analyze HDInsight Logs</span></span>](hdinsight-debug-jobs.md)
* [<span data-ttu-id="949d5-314">Access YARN application log on Linux-based HDInsight</span><span class="sxs-lookup"><span data-stu-id="949d5-314">Access YARN application log on Linux-based HDInsight</span></span>](hdinsight-hadoop-access-yarn-app-logs-linux.md)
* [<span data-ttu-id="949d5-315">Enable heap dumps for Hadoop services on Linux-based HDInsight</span><span class="sxs-lookup"><span data-stu-id="949d5-315">Enable heap dumps for Hadoop services on Linux-based HDInsight</span></span>](hdinsight-hadoop-collect-debug-heap-dump-linux.md)
* [<span data-ttu-id="949d5-316">Known Issues for Apache Spark cluster on HDInsight</span><span class="sxs-lookup"><span data-stu-id="949d5-316">Known Issues for Apache Spark cluster on HDInsight</span></span>](hdinsight-apache-spark-known-issues.md)
