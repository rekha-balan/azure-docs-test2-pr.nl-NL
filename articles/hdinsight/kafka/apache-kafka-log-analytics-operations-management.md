---
title: Log Analytics for Apache Kafka - Azure HDInsight
description: Learn how to use Log Analytics to analyze logs from Apache Kafka cluster on Azure HDInsight.
services: hdinsight
ms.service: hdinsight
author: jasonwhowell
ms.author: jasonh
ms.reviewer: jasonh
ms.custom: hdinsightactive
ms.topic: conceptual
ms.date: 06/15/2018
ms.openlocfilehash: d07c37803c94d7fa39d398a97796fecbad373af4
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44870100"
---
# <a name="analyze-logs-for-apache-kafka-on-hdinsight"></a><span data-ttu-id="0bcb1-103">Analyze logs for Apache Kafka on HDInsight</span><span class="sxs-lookup"><span data-stu-id="0bcb1-103">Analyze logs for Apache Kafka on HDInsight</span></span>

<span data-ttu-id="0bcb1-104">Learn how to use Log Analytics to analyze logs generated by Apache Kafka on HDInsight.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-104">Learn how to use Log Analytics to analyze logs generated by Apache Kafka on HDInsight.</span></span>

## <a name="enable-log-analytics-for-kafka"></a><span data-ttu-id="0bcb1-105">Enable Log Analytics for Kafka</span><span class="sxs-lookup"><span data-stu-id="0bcb1-105">Enable Log Analytics for Kafka</span></span>

<span data-ttu-id="0bcb1-106">The steps to enable Log Analytics for HDInsight are the same for all HDInsight clusters.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-106">The steps to enable Log Analytics for HDInsight are the same for all HDInsight clusters.</span></span> <span data-ttu-id="0bcb1-107">Use the following links to understand how to create and configure the required services:</span><span class="sxs-lookup"><span data-stu-id="0bcb1-107">Use the following links to understand how to create and configure the required services:</span></span>

1. <span data-ttu-id="0bcb1-108">Create a Log Analytics workspace.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-108">Create a Log Analytics workspace.</span></span> <span data-ttu-id="0bcb1-109">For more information, see the [Get started with a Log Analytics workspace](https://docs.microsoft.com/azure/log-analytics) document.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-109">For more information, see the [Get started with a Log Analytics workspace](https://docs.microsoft.com/azure/log-analytics) document.</span></span>

2. <span data-ttu-id="0bcb1-110">Create a Kafka on HDInsight cluster.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-110">Create a Kafka on HDInsight cluster.</span></span> <span data-ttu-id="0bcb1-111">For more information, see the [Start with Apache Kafka on HDInsight](apache-kafka-get-started.md) document.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-111">For more information, see the [Start with Apache Kafka on HDInsight](apache-kafka-get-started.md) document.</span></span>

3. <span data-ttu-id="0bcb1-112">Configure the Kafka cluster to use Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-112">Configure the Kafka cluster to use Log Analytics.</span></span> <span data-ttu-id="0bcb1-113">For more information, see the [Use Log Analytics to monitor HDInsight](../hdinsight-hadoop-oms-log-analytics-tutorial.md) document.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-113">For more information, see the [Use Log Analytics to monitor HDInsight](../hdinsight-hadoop-oms-log-analytics-tutorial.md) document.</span></span>

    > [!NOTE]
    > <span data-ttu-id="0bcb1-114">You can also configure the cluster to use Log Analytics by using the `Enable-AzureRmHDInsightOperationsManagementSuite` cmdlet.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-114">You can also configure the cluster to use Log Analytics by using the `Enable-AzureRmHDInsightOperationsManagementSuite` cmdlet.</span></span> <span data-ttu-id="0bcb1-115">This cmdlet requires the following information:</span><span class="sxs-lookup"><span data-stu-id="0bcb1-115">This cmdlet requires the following information:</span></span>
    >
    > * <span data-ttu-id="0bcb1-116">The HDInsight cluster name.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-116">The HDInsight cluster name.</span></span>
    > * <span data-ttu-id="0bcb1-117">The workspace ID for Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-117">The workspace ID for Log Analytics.</span></span> <span data-ttu-id="0bcb1-118">You can find the workspace ID in your Log Analytics workspace.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-118">You can find the workspace ID in your Log Analytics workspace.</span></span>
    > * <span data-ttu-id="0bcb1-119">The primary key for the Log Analytics connection.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-119">The primary key for the Log Analytics connection.</span></span> <span data-ttu-id="0bcb1-120">To find the primary key, open the workspace in the Azure portal, select __Advanced settings__ from the left menu.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-120">To find the primary key, open the workspace in the Azure portal, select __Advanced settings__ from the left menu.</span></span> <span data-ttu-id="0bcb1-121">From Advanced settings, select  __Connected Sources__>__Linux Servers__.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-121">From Advanced settings, select  __Connected Sources__>__Linux Servers__.</span></span>


> [!IMPORTANT]
> <span data-ttu-id="0bcb1-122">It may take around 20 minutes before data is available for Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-122">It may take around 20 minutes before data is available for Log Analytics.</span></span>

## <a name="query-logs"></a><span data-ttu-id="0bcb1-123">Query logs</span><span class="sxs-lookup"><span data-stu-id="0bcb1-123">Query logs</span></span>

1. <span data-ttu-id="0bcb1-124">From the [Azure portal](https://portal.azure.com), select your Log Analytics workspace.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-124">From the [Azure portal](https://portal.azure.com), select your Log Analytics workspace.</span></span>

2. <span data-ttu-id="0bcb1-125">Select __Log Search__.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-125">Select __Log Search__.</span></span> <span data-ttu-id="0bcb1-126">From here, you can search the data collected from Kafka.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-126">From here, you can search the data collected from Kafka.</span></span> <span data-ttu-id="0bcb1-127">The following are some example searches:</span><span class="sxs-lookup"><span data-stu-id="0bcb1-127">The following are some example searches:</span></span>

    * <span data-ttu-id="0bcb1-128">Disk usage: `Perf | where ObjectName == "Logical Disk" and CounterName == "Free Megabytes" and InstanceName == "_Total" and ((Computer startswith_cs "hn" and Computer contains_cs "-") or (Computer startswith_cs "wn" and Computer contains_cs "-")) | summarize AggregatedValue = avg(CounterValue) by Computer, bin(TimeGenerated, 1h)`</span><span class="sxs-lookup"><span data-stu-id="0bcb1-128">Disk usage: `Perf | where ObjectName == "Logical Disk" and CounterName == "Free Megabytes" and InstanceName == "_Total" and ((Computer startswith_cs "hn" and Computer contains_cs "-") or (Computer startswith_cs "wn" and Computer contains_cs "-")) | summarize AggregatedValue = avg(CounterValue) by Computer, bin(TimeGenerated, 1h)`</span></span>

    * <span data-ttu-id="0bcb1-129">CPU usage: `Perf | where CounterName == "% Processor Time" and InstanceName == "_Total" and ((Computer startswith_cs "hn" and Computer contains_cs "-") or (Computer startswith_cs "wn" and Computer contains_cs "-")) | summarize AggregatedValue = avg(CounterValue) by Computer, bin(TimeGenerated, 1h)`</span><span class="sxs-lookup"><span data-stu-id="0bcb1-129">CPU usage: `Perf | where CounterName == "% Processor Time" and InstanceName == "_Total" and ((Computer startswith_cs "hn" and Computer contains_cs "-") or (Computer startswith_cs "wn" and Computer contains_cs "-")) | summarize AggregatedValue = avg(CounterValue) by Computer, bin(TimeGenerated, 1h)`</span></span>

    * <span data-ttu-id="0bcb1-130">Incoming messages per second: `metrics_kafka_CL | where ClusterName_s == "your_kafka_cluster_name" and InstanceName_s == "kafka-BrokerTopicMetrics-MessagesInPerSec-Count" | summarize AggregatedValue = avg(kafka_BrokerTopicMetrics_MessagesInPerSec_Count_value_d) by HostName_s, bin(TimeGenerated, 1h)`</span><span class="sxs-lookup"><span data-stu-id="0bcb1-130">Incoming messages per second: `metrics_kafka_CL | where ClusterName_s == "your_kafka_cluster_name" and InstanceName_s == "kafka-BrokerTopicMetrics-MessagesInPerSec-Count" | summarize AggregatedValue = avg(kafka_BrokerTopicMetrics_MessagesInPerSec_Count_value_d) by HostName_s, bin(TimeGenerated, 1h)`</span></span>

    * <span data-ttu-id="0bcb1-131">Incoming bytes per second: `metrics_kafka_CL | where HostName_s == "wn0-kafka" and InstanceName_s == "kafka-BrokerTopicMetrics-BytesInPerSec-Count" | summarize AggregatedValue = avg(kafka_BrokerTopicMetrics_BytesInPerSec_Count_value_d) by bin(TimeGenerated, 1h)`</span><span class="sxs-lookup"><span data-stu-id="0bcb1-131">Incoming bytes per second: `metrics_kafka_CL | where HostName_s == "wn0-kafka" and InstanceName_s == "kafka-BrokerTopicMetrics-BytesInPerSec-Count" | summarize AggregatedValue = avg(kafka_BrokerTopicMetrics_BytesInPerSec_Count_value_d) by bin(TimeGenerated, 1h)`</span></span>

    * <span data-ttu-id="0bcb1-132">Outgoing bytes per second: `metrics_kafka_CL | where ClusterName_s == "your_kafka_cluster_name" and InstanceName_s == "kafka-BrokerTopicMetrics-BytesOutPerSec-Count" | summarize AggregatedValue = avg(kafka_BrokerTopicMetrics_BytesOutPerSec_Count_value_d) by bin(TimeGenerated, 1h)`</span><span class="sxs-lookup"><span data-stu-id="0bcb1-132">Outgoing bytes per second: `metrics_kafka_CL | where ClusterName_s == "your_kafka_cluster_name" and InstanceName_s == "kafka-BrokerTopicMetrics-BytesOutPerSec-Count" | summarize AggregatedValue = avg(kafka_BrokerTopicMetrics_BytesOutPerSec_Count_value_d) by bin(TimeGenerated, 1h)`</span></span>

    > [!IMPORTANT]
    > <span data-ttu-id="0bcb1-133">Replace the query values with your cluster specific information.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-133">Replace the query values with your cluster specific information.</span></span> <span data-ttu-id="0bcb1-134">For example, `ClusterName_s` must be set to the name of your cluster.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-134">For example, `ClusterName_s` must be set to the name of your cluster.</span></span> <span data-ttu-id="0bcb1-135">`HostName_s` must be set to the domain name of a worker node in the cluster.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-135">`HostName_s` must be set to the domain name of a worker node in the cluster.</span></span>

    <span data-ttu-id="0bcb1-136">You can also enter `*` to search all types logged.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-136">You can also enter `*` to search all types logged.</span></span> <span data-ttu-id="0bcb1-137">Currently the following logs are available for queries:</span><span class="sxs-lookup"><span data-stu-id="0bcb1-137">Currently the following logs are available for queries:</span></span>

    | <span data-ttu-id="0bcb1-138">Log type</span><span class="sxs-lookup"><span data-stu-id="0bcb1-138">Log type</span></span> | <span data-ttu-id="0bcb1-139">Description</span><span class="sxs-lookup"><span data-stu-id="0bcb1-139">Description</span></span> |
    | ---- | ---- |
    | <span data-ttu-id="0bcb1-140">log\_kafkaserver\_CL</span><span class="sxs-lookup"><span data-stu-id="0bcb1-140">log\_kafkaserver\_CL</span></span> | <span data-ttu-id="0bcb1-141">Kafka broker server.log</span><span class="sxs-lookup"><span data-stu-id="0bcb1-141">Kafka broker server.log</span></span> |
    | <span data-ttu-id="0bcb1-142">log\_kafkacontroller\_CL</span><span class="sxs-lookup"><span data-stu-id="0bcb1-142">log\_kafkacontroller\_CL</span></span> | <span data-ttu-id="0bcb1-143">Kafka broker controller.log</span><span class="sxs-lookup"><span data-stu-id="0bcb1-143">Kafka broker controller.log</span></span> |
    | <span data-ttu-id="0bcb1-144">metrics\_kafka\_CL</span><span class="sxs-lookup"><span data-stu-id="0bcb1-144">metrics\_kafka\_CL</span></span> | <span data-ttu-id="0bcb1-145">Kafka JMX metrics</span><span class="sxs-lookup"><span data-stu-id="0bcb1-145">Kafka JMX metrics</span></span> |

    ![Image of the CPU usage search](./media/apache-kafka-log-analytics-operations-management/kafka-cpu-usage.png)
 
 ## <a name="next-steps"></a><span data-ttu-id="0bcb1-147">Next steps</span><span class="sxs-lookup"><span data-stu-id="0bcb1-147">Next steps</span></span>

<span data-ttu-id="0bcb1-148">For more information on Log Analytics, see the [Get started with a Log Analytics workspace](../../log-analytics/log-analytics-get-started.md) document.</span><span class="sxs-lookup"><span data-stu-id="0bcb1-148">For more information on Log Analytics, see the [Get started with a Log Analytics workspace](../../log-analytics/log-analytics-get-started.md) document.</span></span>

<span data-ttu-id="0bcb1-149">For more information on working with Kafka, see the following documents:</span><span class="sxs-lookup"><span data-stu-id="0bcb1-149">For more information on working with Kafka, see the following documents:</span></span>

 * [<span data-ttu-id="0bcb1-150">Mirror Kafka between HDInsight clusters</span><span class="sxs-lookup"><span data-stu-id="0bcb1-150">Mirror Kafka between HDInsight clusters</span></span>](apache-kafka-mirroring.md)
 * [<span data-ttu-id="0bcb1-151">Increase the scalability of Kafka on HDInsight</span><span class="sxs-lookup"><span data-stu-id="0bcb1-151">Increase the scalability of Kafka on HDInsight</span></span>](apache-kafka-scalability.md)
 * [<span data-ttu-id="0bcb1-152">Use Spark streaming (DStreams) with Kafka</span><span class="sxs-lookup"><span data-stu-id="0bcb1-152">Use Spark streaming (DStreams) with Kafka</span></span>](../hdinsight-apache-spark-with-kafka.md)
 * [<span data-ttu-id="0bcb1-153">Use Spark structured streaming with Kafka</span><span class="sxs-lookup"><span data-stu-id="0bcb1-153">Use Spark structured streaming with Kafka</span></span>](../hdinsight-apache-kafka-spark-structured-streaming.md)
