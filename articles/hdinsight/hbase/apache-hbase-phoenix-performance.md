---
title: Phoenix performance in Azure HDInsight
description: Best practices to optimize Phoenix performance.
services: hdinsight
author: ashishthaps
ms.reviewer: jasonh
ms.service: hdinsight
ms.custom: hdinsightactive
ms.topic: conceptual
ms.date: 01/22/2018
ms.author: ashishth
ms.openlocfilehash: ff194ef7f5ae609eba5334eb5c66db02d660ab08
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44866019"
---
# <a name="phoenix-performance-best-practices"></a><span data-ttu-id="0ed7b-103">Phoenix performance best practices</span><span class="sxs-lookup"><span data-stu-id="0ed7b-103">Phoenix performance best practices</span></span>

<span data-ttu-id="0ed7b-104">The most important aspect of Phoenix performance is to optimize the underlying HBase.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-104">The most important aspect of Phoenix performance is to optimize the underlying HBase.</span></span> <span data-ttu-id="0ed7b-105">Phoenix creates a relational data model atop HBase that converts SQL queries into HBase operations, such as scans.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-105">Phoenix creates a relational data model atop HBase that converts SQL queries into HBase operations, such as scans.</span></span> <span data-ttu-id="0ed7b-106">The design of your table schema, the selection and ordering of the fields in your primary key, and your use of indexes all affect Phoenix performance.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-106">The design of your table schema, the selection and ordering of the fields in your primary key, and your use of indexes all affect Phoenix performance.</span></span>

## <a name="table-schema-design"></a><span data-ttu-id="0ed7b-107">Table schema design</span><span class="sxs-lookup"><span data-stu-id="0ed7b-107">Table schema design</span></span>

<span data-ttu-id="0ed7b-108">When you create a table in Phoenix, that table is stored in an HBase table.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-108">When you create a table in Phoenix, that table is stored in an HBase table.</span></span> <span data-ttu-id="0ed7b-109">The HBase table contains groups of columns (column families) that are accessed together.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-109">The HBase table contains groups of columns (column families) that are accessed together.</span></span> <span data-ttu-id="0ed7b-110">A row in the Phoenix table is a row in the HBase table, where each row consists of versioned cells associated with one or more columns.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-110">A row in the Phoenix table is a row in the HBase table, where each row consists of versioned cells associated with one or more columns.</span></span> <span data-ttu-id="0ed7b-111">Logically, a single HBase row is a collection of key-value pairs, each having the same rowkey value.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-111">Logically, a single HBase row is a collection of key-value pairs, each having the same rowkey value.</span></span> <span data-ttu-id="0ed7b-112">That is, each key-value pair has a rowkey attribute, and the value of that rowkey attribute is the same for a particular row.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-112">That is, each key-value pair has a rowkey attribute, and the value of that rowkey attribute is the same for a particular row.</span></span>

<span data-ttu-id="0ed7b-113">The schema design of a Phoenix table includes the primary key design, column family design, individual column design, and how the data is partitioned.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-113">The schema design of a Phoenix table includes the primary key design, column family design, individual column design, and how the data is partitioned.</span></span>

### <a name="primary-key-design"></a><span data-ttu-id="0ed7b-114">Primary key design</span><span class="sxs-lookup"><span data-stu-id="0ed7b-114">Primary key design</span></span>

<span data-ttu-id="0ed7b-115">The primary key defined on a table in Phoenix determines how data is stored within the rowkey of the underlying HBase table.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-115">The primary key defined on a table in Phoenix determines how data is stored within the rowkey of the underlying HBase table.</span></span> <span data-ttu-id="0ed7b-116">In HBase, the only way to access a particular row is with the rowkey.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-116">In HBase, the only way to access a particular row is with the rowkey.</span></span> <span data-ttu-id="0ed7b-117">In addition, data stored in an HBase table is sorted by the rowkey.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-117">In addition, data stored in an HBase table is sorted by the rowkey.</span></span> <span data-ttu-id="0ed7b-118">Phoenix builds the rowkey value by concatenating the values of each of the columns in the row, in the order they are defined in the primary key.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-118">Phoenix builds the rowkey value by concatenating the values of each of the columns in the row, in the order they are defined in the primary key.</span></span>

<span data-ttu-id="0ed7b-119">For example, a table for contacts has the first name, last name, phone number, and address, all in the same column family.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-119">For example, a table for contacts has the first name, last name, phone number, and address, all in the same column family.</span></span> <span data-ttu-id="0ed7b-120">You could define a primary key based on an increasing sequence number:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-120">You could define a primary key based on an increasing sequence number:</span></span>

|<span data-ttu-id="0ed7b-121">rowkey</span><span class="sxs-lookup"><span data-stu-id="0ed7b-121">rowkey</span></span>|       <span data-ttu-id="0ed7b-122">address</span><span class="sxs-lookup"><span data-stu-id="0ed7b-122">address</span></span>|   <span data-ttu-id="0ed7b-123">phone</span><span class="sxs-lookup"><span data-stu-id="0ed7b-123">phone</span></span>| <span data-ttu-id="0ed7b-124">firstName</span><span class="sxs-lookup"><span data-stu-id="0ed7b-124">firstName</span></span>| <span data-ttu-id="0ed7b-125">lastName</span><span class="sxs-lookup"><span data-stu-id="0ed7b-125">lastName</span></span>|
|------|--------------------|--------------|-------------|--------------|
|  <span data-ttu-id="0ed7b-126">1000</span><span class="sxs-lookup"><span data-stu-id="0ed7b-126">1000</span></span>|<span data-ttu-id="0ed7b-127">1111 San Gabriel Dr.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-127">1111 San Gabriel Dr.</span></span>|<span data-ttu-id="0ed7b-128">1-425-000-0002</span><span class="sxs-lookup"><span data-stu-id="0ed7b-128">1-425-000-0002</span></span>|    <span data-ttu-id="0ed7b-129">John</span><span class="sxs-lookup"><span data-stu-id="0ed7b-129">John</span></span>|<span data-ttu-id="0ed7b-130">Dole</span><span class="sxs-lookup"><span data-stu-id="0ed7b-130">Dole</span></span>|
|  <span data-ttu-id="0ed7b-131">8396</span><span class="sxs-lookup"><span data-stu-id="0ed7b-131">8396</span></span>|<span data-ttu-id="0ed7b-132">5415 San Gabriel Dr.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-132">5415 San Gabriel Dr.</span></span>|<span data-ttu-id="0ed7b-133">1-230-555-0191</span><span class="sxs-lookup"><span data-stu-id="0ed7b-133">1-230-555-0191</span></span>|  <span data-ttu-id="0ed7b-134">Calvin</span><span class="sxs-lookup"><span data-stu-id="0ed7b-134">Calvin</span></span>|<span data-ttu-id="0ed7b-135">Raji</span><span class="sxs-lookup"><span data-stu-id="0ed7b-135">Raji</span></span>|

<span data-ttu-id="0ed7b-136">However, if you frequently query by lastName this primary key may not perform well, because each query requires a full table scan to read the value of every lastName.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-136">However, if you frequently query by lastName this primary key may not perform well, because each query requires a full table scan to read the value of every lastName.</span></span> <span data-ttu-id="0ed7b-137">Instead, you can define a primary key on the lastName, firstName, and social security number columns.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-137">Instead, you can define a primary key on the lastName, firstName, and social security number columns.</span></span> <span data-ttu-id="0ed7b-138">This last column is to disambiguate two residents at the same address with the same name, such as a father and son.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-138">This last column is to disambiguate two residents at the same address with the same name, such as a father and son.</span></span>

|<span data-ttu-id="0ed7b-139">rowkey</span><span class="sxs-lookup"><span data-stu-id="0ed7b-139">rowkey</span></span>|       <span data-ttu-id="0ed7b-140">address</span><span class="sxs-lookup"><span data-stu-id="0ed7b-140">address</span></span>|   <span data-ttu-id="0ed7b-141">phone</span><span class="sxs-lookup"><span data-stu-id="0ed7b-141">phone</span></span>| <span data-ttu-id="0ed7b-142">firstName</span><span class="sxs-lookup"><span data-stu-id="0ed7b-142">firstName</span></span>| <span data-ttu-id="0ed7b-143">lastName</span><span class="sxs-lookup"><span data-stu-id="0ed7b-143">lastName</span></span>| <span data-ttu-id="0ed7b-144">socialSecurityNum</span><span class="sxs-lookup"><span data-stu-id="0ed7b-144">socialSecurityNum</span></span> |
|------|--------------------|--------------|-------------|--------------| ---|
|  <span data-ttu-id="0ed7b-145">1000</span><span class="sxs-lookup"><span data-stu-id="0ed7b-145">1000</span></span>|<span data-ttu-id="0ed7b-146">1111 San Gabriel Dr.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-146">1111 San Gabriel Dr.</span></span>|<span data-ttu-id="0ed7b-147">1-425-000-0002</span><span class="sxs-lookup"><span data-stu-id="0ed7b-147">1-425-000-0002</span></span>|    <span data-ttu-id="0ed7b-148">John</span><span class="sxs-lookup"><span data-stu-id="0ed7b-148">John</span></span>|<span data-ttu-id="0ed7b-149">Dole</span><span class="sxs-lookup"><span data-stu-id="0ed7b-149">Dole</span></span>| <span data-ttu-id="0ed7b-150">111</span><span class="sxs-lookup"><span data-stu-id="0ed7b-150">111</span></span> |
|  <span data-ttu-id="0ed7b-151">8396</span><span class="sxs-lookup"><span data-stu-id="0ed7b-151">8396</span></span>|<span data-ttu-id="0ed7b-152">5415 San Gabriel Dr.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-152">5415 San Gabriel Dr.</span></span>|<span data-ttu-id="0ed7b-153">1-230-555-0191</span><span class="sxs-lookup"><span data-stu-id="0ed7b-153">1-230-555-0191</span></span>|  <span data-ttu-id="0ed7b-154">Calvin</span><span class="sxs-lookup"><span data-stu-id="0ed7b-154">Calvin</span></span>|<span data-ttu-id="0ed7b-155">Raji</span><span class="sxs-lookup"><span data-stu-id="0ed7b-155">Raji</span></span>| <span data-ttu-id="0ed7b-156">222</span><span class="sxs-lookup"><span data-stu-id="0ed7b-156">222</span></span> |

<span data-ttu-id="0ed7b-157">With this new primary key the row keys generated by Phoenix would be:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-157">With this new primary key the row keys generated by Phoenix would be:</span></span>

|<span data-ttu-id="0ed7b-158">rowkey</span><span class="sxs-lookup"><span data-stu-id="0ed7b-158">rowkey</span></span>|       <span data-ttu-id="0ed7b-159">address</span><span class="sxs-lookup"><span data-stu-id="0ed7b-159">address</span></span>|   <span data-ttu-id="0ed7b-160">phone</span><span class="sxs-lookup"><span data-stu-id="0ed7b-160">phone</span></span>| <span data-ttu-id="0ed7b-161">firstName</span><span class="sxs-lookup"><span data-stu-id="0ed7b-161">firstName</span></span>| <span data-ttu-id="0ed7b-162">lastName</span><span class="sxs-lookup"><span data-stu-id="0ed7b-162">lastName</span></span>| <span data-ttu-id="0ed7b-163">socialSecurityNum</span><span class="sxs-lookup"><span data-stu-id="0ed7b-163">socialSecurityNum</span></span> |
|------|--------------------|--------------|-------------|--------------| ---|
|  <span data-ttu-id="0ed7b-164">Dole-John-111</span><span class="sxs-lookup"><span data-stu-id="0ed7b-164">Dole-John-111</span></span>|<span data-ttu-id="0ed7b-165">1111 San Gabriel Dr.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-165">1111 San Gabriel Dr.</span></span>|<span data-ttu-id="0ed7b-166">1-425-000-0002</span><span class="sxs-lookup"><span data-stu-id="0ed7b-166">1-425-000-0002</span></span>|    <span data-ttu-id="0ed7b-167">John</span><span class="sxs-lookup"><span data-stu-id="0ed7b-167">John</span></span>|<span data-ttu-id="0ed7b-168">Dole</span><span class="sxs-lookup"><span data-stu-id="0ed7b-168">Dole</span></span>| <span data-ttu-id="0ed7b-169">111</span><span class="sxs-lookup"><span data-stu-id="0ed7b-169">111</span></span> |
|  <span data-ttu-id="0ed7b-170">Raji-Calvin-222</span><span class="sxs-lookup"><span data-stu-id="0ed7b-170">Raji-Calvin-222</span></span>|<span data-ttu-id="0ed7b-171">5415 San Gabriel Dr.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-171">5415 San Gabriel Dr.</span></span>|<span data-ttu-id="0ed7b-172">1-230-555-0191</span><span class="sxs-lookup"><span data-stu-id="0ed7b-172">1-230-555-0191</span></span>|  <span data-ttu-id="0ed7b-173">Calvin</span><span class="sxs-lookup"><span data-stu-id="0ed7b-173">Calvin</span></span>|<span data-ttu-id="0ed7b-174">Raji</span><span class="sxs-lookup"><span data-stu-id="0ed7b-174">Raji</span></span>| <span data-ttu-id="0ed7b-175">222</span><span class="sxs-lookup"><span data-stu-id="0ed7b-175">222</span></span> |

<span data-ttu-id="0ed7b-176">In the first row above, the data for the rowkey is represented as shown:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-176">In the first row above, the data for the rowkey is represented as shown:</span></span>

|<span data-ttu-id="0ed7b-177">rowkey</span><span class="sxs-lookup"><span data-stu-id="0ed7b-177">rowkey</span></span>|       <span data-ttu-id="0ed7b-178">key</span><span class="sxs-lookup"><span data-stu-id="0ed7b-178">key</span></span>|   <span data-ttu-id="0ed7b-179">value</span><span class="sxs-lookup"><span data-stu-id="0ed7b-179">value</span></span>| 
|------|--------------------|---|
|  <span data-ttu-id="0ed7b-180">Dole-John-111</span><span class="sxs-lookup"><span data-stu-id="0ed7b-180">Dole-John-111</span></span>|<span data-ttu-id="0ed7b-181">address</span><span class="sxs-lookup"><span data-stu-id="0ed7b-181">address</span></span> |<span data-ttu-id="0ed7b-182">1111 San Gabriel Dr.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-182">1111 San Gabriel Dr.</span></span>|  
|  <span data-ttu-id="0ed7b-183">Dole-John-111</span><span class="sxs-lookup"><span data-stu-id="0ed7b-183">Dole-John-111</span></span>|<span data-ttu-id="0ed7b-184">phone</span><span class="sxs-lookup"><span data-stu-id="0ed7b-184">phone</span></span> |<span data-ttu-id="0ed7b-185">1-425-000-0002</span><span class="sxs-lookup"><span data-stu-id="0ed7b-185">1-425-000-0002</span></span>|  
|  <span data-ttu-id="0ed7b-186">Dole-John-111</span><span class="sxs-lookup"><span data-stu-id="0ed7b-186">Dole-John-111</span></span>|<span data-ttu-id="0ed7b-187">firstName</span><span class="sxs-lookup"><span data-stu-id="0ed7b-187">firstName</span></span> |<span data-ttu-id="0ed7b-188">John</span><span class="sxs-lookup"><span data-stu-id="0ed7b-188">John</span></span>|  
|  <span data-ttu-id="0ed7b-189">Dole-John-111</span><span class="sxs-lookup"><span data-stu-id="0ed7b-189">Dole-John-111</span></span>|<span data-ttu-id="0ed7b-190">lastName</span><span class="sxs-lookup"><span data-stu-id="0ed7b-190">lastName</span></span> |<span data-ttu-id="0ed7b-191">Dole</span><span class="sxs-lookup"><span data-stu-id="0ed7b-191">Dole</span></span>|  
|  <span data-ttu-id="0ed7b-192">Dole-John-111</span><span class="sxs-lookup"><span data-stu-id="0ed7b-192">Dole-John-111</span></span>|<span data-ttu-id="0ed7b-193">socialSecurityNum</span><span class="sxs-lookup"><span data-stu-id="0ed7b-193">socialSecurityNum</span></span> |<span data-ttu-id="0ed7b-194">111</span><span class="sxs-lookup"><span data-stu-id="0ed7b-194">111</span></span>| 

<span data-ttu-id="0ed7b-195">This rowkey now stores a duplicate copy of the data.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-195">This rowkey now stores a duplicate copy of the data.</span></span> <span data-ttu-id="0ed7b-196">Consider the size and number of columns you include in your primary key, because this value is included with every cell in the underlying HBase table.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-196">Consider the size and number of columns you include in your primary key, because this value is included with every cell in the underlying HBase table.</span></span>

<span data-ttu-id="0ed7b-197">Also, if the primary key has values that are monotonically increasing, you should create the table with *salt buckets* to help avoid creating write hotspots - see [Partition data](#partition-data).</span><span class="sxs-lookup"><span data-stu-id="0ed7b-197">Also, if the primary key has values that are monotonically increasing, you should create the table with *salt buckets* to help avoid creating write hotspots - see [Partition data](#partition-data).</span></span>

### <a name="column-family-design"></a><span data-ttu-id="0ed7b-198">Column family design</span><span class="sxs-lookup"><span data-stu-id="0ed7b-198">Column family design</span></span>

<span data-ttu-id="0ed7b-199">If some columns are accessed more frequently than others, you should create multiple column families to separate the frequently accessed columns from rarely accessed columns.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-199">If some columns are accessed more frequently than others, you should create multiple column families to separate the frequently accessed columns from rarely accessed columns.</span></span>

<span data-ttu-id="0ed7b-200">Also, if certain columns tend to be accessed together, put those columns in the same column family.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-200">Also, if certain columns tend to be accessed together, put those columns in the same column family.</span></span>

### <a name="column-design"></a><span data-ttu-id="0ed7b-201">Column design</span><span class="sxs-lookup"><span data-stu-id="0ed7b-201">Column design</span></span>

* <span data-ttu-id="0ed7b-202">Keep VARCHAR columns under about 1 MB due to the I/O costs of large columns.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-202">Keep VARCHAR columns under about 1 MB due to the I/O costs of large columns.</span></span> <span data-ttu-id="0ed7b-203">When processing queries, HBase materializes cells in full before sending them over to the client, and the client receives them in full before handing them off to the application code.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-203">When processing queries, HBase materializes cells in full before sending them over to the client, and the client receives them in full before handing them off to the application code.</span></span>
* <span data-ttu-id="0ed7b-204">Store column values using a compact format such as protobuf, Avro, msgpack, or BSON.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-204">Store column values using a compact format such as protobuf, Avro, msgpack, or BSON.</span></span> <span data-ttu-id="0ed7b-205">JSON is not recommended, as it is larger.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-205">JSON is not recommended, as it is larger.</span></span>
* <span data-ttu-id="0ed7b-206">Consider compressing data before storage to cut latency and I/O costs.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-206">Consider compressing data before storage to cut latency and I/O costs.</span></span>

### <a name="partition-data"></a><span data-ttu-id="0ed7b-207">Partition data</span><span class="sxs-lookup"><span data-stu-id="0ed7b-207">Partition data</span></span>

<span data-ttu-id="0ed7b-208">Phoenix enables you to control the number of regions where your data is distributed, which can significantly increase read/write performance.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-208">Phoenix enables you to control the number of regions where your data is distributed, which can significantly increase read/write performance.</span></span> <span data-ttu-id="0ed7b-209">When creating a Phoenix table, you can either salt or pre-split your data.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-209">When creating a Phoenix table, you can either salt or pre-split your data.</span></span>

<span data-ttu-id="0ed7b-210">To salt a table during creation, specify the number of salt buckets:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-210">To salt a table during creation, specify the number of salt buckets:</span></span>

    CREATE TABLE CONTACTS (...) SALT_BUCKETS = 16

<span data-ttu-id="0ed7b-211">This salting splits the table along the values of primary keys, choosing the values automatically.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-211">This salting splits the table along the values of primary keys, choosing the values automatically.</span></span> 

<span data-ttu-id="0ed7b-212">To control where the table splits occur, you can pre-split the table by providing the range values along which the splitting occurs.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-212">To control where the table splits occur, you can pre-split the table by providing the range values along which the splitting occurs.</span></span> <span data-ttu-id="0ed7b-213">For example, to create a table split along three regions:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-213">For example, to create a table split along three regions:</span></span>

    CREATE TABLE CONTACTS (...) SPLIT ON ('CS','EU','NA')

## <a name="index-design"></a><span data-ttu-id="0ed7b-214">Index design</span><span class="sxs-lookup"><span data-stu-id="0ed7b-214">Index design</span></span>

<span data-ttu-id="0ed7b-215">A Phoenix index is an HBase table that stores a copy of some or all of the data from the indexed table.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-215">A Phoenix index is an HBase table that stores a copy of some or all of the data from the indexed table.</span></span> <span data-ttu-id="0ed7b-216">An index improves performance for specific types of queries.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-216">An index improves performance for specific types of queries.</span></span>

<span data-ttu-id="0ed7b-217">When you have multiple indexes defined and then query a table, Phoenix automatically selects the best index for the query.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-217">When you have multiple indexes defined and then query a table, Phoenix automatically selects the best index for the query.</span></span> <span data-ttu-id="0ed7b-218">The primary index is created automatically based on the primary keys you select.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-218">The primary index is created automatically based on the primary keys you select.</span></span>

<span data-ttu-id="0ed7b-219">For anticipated queries, you can also create secondary indexes by specifying their columns.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-219">For anticipated queries, you can also create secondary indexes by specifying their columns.</span></span>

<span data-ttu-id="0ed7b-220">When designing your indexes:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-220">When designing your indexes:</span></span>

* <span data-ttu-id="0ed7b-221">Only create the indexes you need.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-221">Only create the indexes you need.</span></span>
* <span data-ttu-id="0ed7b-222">Limit the number of indexes on frequently updated tables.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-222">Limit the number of indexes on frequently updated tables.</span></span> <span data-ttu-id="0ed7b-223">Updates to a table translate into writes to both the main table and the index tables.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-223">Updates to a table translate into writes to both the main table and the index tables.</span></span>

## <a name="create-secondary-indexes"></a><span data-ttu-id="0ed7b-224">Create secondary indexes</span><span class="sxs-lookup"><span data-stu-id="0ed7b-224">Create secondary indexes</span></span>

<span data-ttu-id="0ed7b-225">Secondary indexes can improve read performance by turning what would be a full table scan into a point lookup, at the cost of storage space and write speed.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-225">Secondary indexes can improve read performance by turning what would be a full table scan into a point lookup, at the cost of storage space and write speed.</span></span> <span data-ttu-id="0ed7b-226">Secondary indexes can be added or removed after table creation and don’t require changes to existing queries – queries just run faster.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-226">Secondary indexes can be added or removed after table creation and don’t require changes to existing queries – queries just run faster.</span></span> <span data-ttu-id="0ed7b-227">Depending on your needs, consider creating covered indexes, functional indexes, or both.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-227">Depending on your needs, consider creating covered indexes, functional indexes, or both.</span></span>

### <a name="use-covered-indexes"></a><span data-ttu-id="0ed7b-228">Use covered indexes</span><span class="sxs-lookup"><span data-stu-id="0ed7b-228">Use covered indexes</span></span>

<span data-ttu-id="0ed7b-229">Covered indexes are indexes that include data from the row in addition to the values that are indexed.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-229">Covered indexes are indexes that include data from the row in addition to the values that are indexed.</span></span> <span data-ttu-id="0ed7b-230">After finding the desired index entry, there is no need to access the primary table.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-230">After finding the desired index entry, there is no need to access the primary table.</span></span>

<span data-ttu-id="0ed7b-231">For example, in the example contact table you could create a secondary index on just the socialSecurityNum column.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-231">For example, in the example contact table you could create a secondary index on just the socialSecurityNum column.</span></span> <span data-ttu-id="0ed7b-232">This secondary index would speed up queries that filter by socialSecurityNum values, but retrieving other field values will require another read against the main table.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-232">This secondary index would speed up queries that filter by socialSecurityNum values, but retrieving other field values will require another read against the main table.</span></span>

|<span data-ttu-id="0ed7b-233">rowkey</span><span class="sxs-lookup"><span data-stu-id="0ed7b-233">rowkey</span></span>|       <span data-ttu-id="0ed7b-234">address</span><span class="sxs-lookup"><span data-stu-id="0ed7b-234">address</span></span>|   <span data-ttu-id="0ed7b-235">phone</span><span class="sxs-lookup"><span data-stu-id="0ed7b-235">phone</span></span>| <span data-ttu-id="0ed7b-236">firstName</span><span class="sxs-lookup"><span data-stu-id="0ed7b-236">firstName</span></span>| <span data-ttu-id="0ed7b-237">lastName</span><span class="sxs-lookup"><span data-stu-id="0ed7b-237">lastName</span></span>| <span data-ttu-id="0ed7b-238">socialSecurityNum</span><span class="sxs-lookup"><span data-stu-id="0ed7b-238">socialSecurityNum</span></span> |
|------|--------------------|--------------|-------------|--------------| ---|
|  <span data-ttu-id="0ed7b-239">Dole-John-111</span><span class="sxs-lookup"><span data-stu-id="0ed7b-239">Dole-John-111</span></span>|<span data-ttu-id="0ed7b-240">1111 San Gabriel Dr.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-240">1111 San Gabriel Dr.</span></span>|<span data-ttu-id="0ed7b-241">1-425-000-0002</span><span class="sxs-lookup"><span data-stu-id="0ed7b-241">1-425-000-0002</span></span>|    <span data-ttu-id="0ed7b-242">John</span><span class="sxs-lookup"><span data-stu-id="0ed7b-242">John</span></span>|<span data-ttu-id="0ed7b-243">Dole</span><span class="sxs-lookup"><span data-stu-id="0ed7b-243">Dole</span></span>| <span data-ttu-id="0ed7b-244">111</span><span class="sxs-lookup"><span data-stu-id="0ed7b-244">111</span></span> |
|  <span data-ttu-id="0ed7b-245">Raji-Calvin-222</span><span class="sxs-lookup"><span data-stu-id="0ed7b-245">Raji-Calvin-222</span></span>|<span data-ttu-id="0ed7b-246">5415 San Gabriel Dr.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-246">5415 San Gabriel Dr.</span></span>|<span data-ttu-id="0ed7b-247">1-230-555-0191</span><span class="sxs-lookup"><span data-stu-id="0ed7b-247">1-230-555-0191</span></span>|  <span data-ttu-id="0ed7b-248">Calvin</span><span class="sxs-lookup"><span data-stu-id="0ed7b-248">Calvin</span></span>|<span data-ttu-id="0ed7b-249">Raji</span><span class="sxs-lookup"><span data-stu-id="0ed7b-249">Raji</span></span>| <span data-ttu-id="0ed7b-250">222</span><span class="sxs-lookup"><span data-stu-id="0ed7b-250">222</span></span> |

<span data-ttu-id="0ed7b-251">However, if you typically want to look up the firstName and lastName given the socialSecurityNum, you could create a covered index that includes the firstName and lastName as actual data in the index table:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-251">However, if you typically want to look up the firstName and lastName given the socialSecurityNum, you could create a covered index that includes the firstName and lastName as actual data in the index table:</span></span>

    CREATE INDEX ssn_idx ON CONTACTS (socialSecurityNum) INCLUDE(firstName, lastName);

<span data-ttu-id="0ed7b-252">This covered index enables the following query to acquire all data just by reading from the table containing the secondary index:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-252">This covered index enables the following query to acquire all data just by reading from the table containing the secondary index:</span></span>

    SELECT socialSecurityNum, firstName, lastName FROM CONTACTS WHERE socialSecurityNum > 100;

### <a name="use-functional-indexes"></a><span data-ttu-id="0ed7b-253">Use functional indexes</span><span class="sxs-lookup"><span data-stu-id="0ed7b-253">Use functional indexes</span></span>

<span data-ttu-id="0ed7b-254">Functional indexes allow you to create an index on an arbitrary expression that you expect to be used in queries.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-254">Functional indexes allow you to create an index on an arbitrary expression that you expect to be used in queries.</span></span> <span data-ttu-id="0ed7b-255">Once you have a functional index in place and a query uses that expression, the index may be used to retrieve the results rather than the data table.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-255">Once you have a functional index in place and a query uses that expression, the index may be used to retrieve the results rather than the data table.</span></span>

<span data-ttu-id="0ed7b-256">For example, you could create an index to allow you to do case-insensitive searches on the combined first name and last name of a person:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-256">For example, you could create an index to allow you to do case-insensitive searches on the combined first name and last name of a person:</span></span>

     CREATE INDEX FULLNAME_UPPER_IDX ON "Contacts" (UPPER("firstName"||' '||"lastName"));

## <a name="query-design"></a><span data-ttu-id="0ed7b-257">Query design</span><span class="sxs-lookup"><span data-stu-id="0ed7b-257">Query design</span></span>

<span data-ttu-id="0ed7b-258">The main considerations in query design are:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-258">The main considerations in query design are:</span></span>

* <span data-ttu-id="0ed7b-259">Understand the query plan and verify its expected behavior.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-259">Understand the query plan and verify its expected behavior.</span></span>
* <span data-ttu-id="0ed7b-260">Join efficiently.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-260">Join efficiently.</span></span>

### <a name="understand-the-query-plan"></a><span data-ttu-id="0ed7b-261">Understand the query plan</span><span class="sxs-lookup"><span data-stu-id="0ed7b-261">Understand the query plan</span></span>

<span data-ttu-id="0ed7b-262">In [SQLLine](http://sqlline.sourceforge.net/), use EXPLAIN followed by your SQL query to view the plan of operations that Phoenix will perform.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-262">In [SQLLine](http://sqlline.sourceforge.net/), use EXPLAIN followed by your SQL query to view the plan of operations that Phoenix will perform.</span></span> <span data-ttu-id="0ed7b-263">Check that the plan:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-263">Check that the plan:</span></span>

* <span data-ttu-id="0ed7b-264">Uses your primary key when appropriate.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-264">Uses your primary key when appropriate.</span></span>
* <span data-ttu-id="0ed7b-265">Uses appropriate secondary indexes, rather than the data table.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-265">Uses appropriate secondary indexes, rather than the data table.</span></span>
* <span data-ttu-id="0ed7b-266">Uses RANGE SCAN or SKIP SCAN whenever possible, rather than TABLE SCAN.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-266">Uses RANGE SCAN or SKIP SCAN whenever possible, rather than TABLE SCAN.</span></span>

#### <a name="plan-examples"></a><span data-ttu-id="0ed7b-267">Plan examples</span><span class="sxs-lookup"><span data-stu-id="0ed7b-267">Plan examples</span></span>

<span data-ttu-id="0ed7b-268">As an example, say you have a table called FLIGHTS that stores flight delay information.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-268">As an example, say you have a table called FLIGHTS that stores flight delay information.</span></span>

<span data-ttu-id="0ed7b-269">To select all the flights with an airlineid of `19805`, where airlineid is a field that is not in the primary key or in any index:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-269">To select all the flights with an airlineid of `19805`, where airlineid is a field that is not in the primary key or in any index:</span></span>

    select * from "FLIGHTS" where airlineid = '19805';

<span data-ttu-id="0ed7b-270">Run the explain command as follows:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-270">Run the explain command as follows:</span></span>

    explain select * from "FLIGHTS" where airlineid = '19805';

<span data-ttu-id="0ed7b-271">The query plan looks like this:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-271">The query plan looks like this:</span></span>

    CLIENT 1-CHUNK PARALLEL 1-WAY ROUND ROBIN FULL SCAN OVER FLIGHTS
        SERVER FILTER BY AIRLINEID = '19805'

<span data-ttu-id="0ed7b-272">In this plan, note the phrase FULL SCAN OVER FLIGHTS.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-272">In this plan, note the phrase FULL SCAN OVER FLIGHTS.</span></span> <span data-ttu-id="0ed7b-273">This phrase indicates the execution does a TABLE SCAN over all rows in the table, rather than using the more efficient RANGE SCAN or SKIP SCAN option.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-273">This phrase indicates the execution does a TABLE SCAN over all rows in the table, rather than using the more efficient RANGE SCAN or SKIP SCAN option.</span></span>

<span data-ttu-id="0ed7b-274">Now, say you want to query for flights on January 2, 2014 for the carrier `AA` where its flightnum was greater than 1.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-274">Now, say you want to query for flights on January 2, 2014 for the carrier `AA` where its flightnum was greater than 1.</span></span> <span data-ttu-id="0ed7b-275">Let's assume that the columns year, month, dayofmonth, carrier, and flightnum exist in the example table, and are all part of the composite primary key.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-275">Let's assume that the columns year, month, dayofmonth, carrier, and flightnum exist in the example table, and are all part of the composite primary key.</span></span> <span data-ttu-id="0ed7b-276">The query would look as follows:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-276">The query would look as follows:</span></span>

    select * from "FLIGHTS" where year = 2014 and month = 1 and dayofmonth = 2 and carrier = 'AA' and flightnum > 1;

<span data-ttu-id="0ed7b-277">Let's examine the plan for this query with:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-277">Let's examine the plan for this query with:</span></span>

    explain select * from "FLIGHTS" where year = 2014 and month = 1 and dayofmonth = 2 and carrier = 'AA' and flightnum > 1;

<span data-ttu-id="0ed7b-278">The resulting plan is:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-278">The resulting plan is:</span></span>

    CLIENT 1-CHUNK PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER FLIGHTS [2014,1,2,'AA',2] - [2014,1,2,'AA',*]

<span data-ttu-id="0ed7b-279">The values in square brackets are the range of values for the primary keys.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-279">The values in square brackets are the range of values for the primary keys.</span></span> <span data-ttu-id="0ed7b-280">In this case, the range values are fixed with year 2014, month 1, and dayofmonth 2, but allow values for flightnum starting with 2 and on up (`*`).</span><span class="sxs-lookup"><span data-stu-id="0ed7b-280">In this case, the range values are fixed with year 2014, month 1, and dayofmonth 2, but allow values for flightnum starting with 2 and on up (`*`).</span></span> <span data-ttu-id="0ed7b-281">This query plan confirms that the primary key is being used as expected.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-281">This query plan confirms that the primary key is being used as expected.</span></span>

<span data-ttu-id="0ed7b-282">Next, create an index on the FLIGHTS table named `carrier2_idx` that is on the carrier field only.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-282">Next, create an index on the FLIGHTS table named `carrier2_idx` that is on the carrier field only.</span></span> <span data-ttu-id="0ed7b-283">This index also includes flightdate, tailnum, origin, and flightnum as covered columns whose data is also stored in the index.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-283">This index also includes flightdate, tailnum, origin, and flightnum as covered columns whose data is also stored in the index.</span></span>

    CREATE INDEX carrier2_idx ON FLIGHTS (carrier) INCLUDE(FLIGHTDATE,TAILNUM,ORIGIN,FLIGHTNUM);

<span data-ttu-id="0ed7b-284">Say you want to get the carrier along with the flightdate and tailnum, as in the following query:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-284">Say you want to get the carrier along with the flightdate and tailnum, as in the following query:</span></span>

    explain select carrier,flightdate,tailnum from "FLIGHTS" where carrier = 'AA';

<span data-ttu-id="0ed7b-285">You should see this index being used:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-285">You should see this index being used:</span></span>

    CLIENT 1-CHUNK PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER CARRIER2_IDX ['AA']

<span data-ttu-id="0ed7b-286">For a complete listing of the items that can appear in explain plan results, see the Explain Plans section in the [Apache Phoenix Tuning Guide](https://phoenix.apache.org/tuning_guide.html).</span><span class="sxs-lookup"><span data-stu-id="0ed7b-286">For a complete listing of the items that can appear in explain plan results, see the Explain Plans section in the [Apache Phoenix Tuning Guide](https://phoenix.apache.org/tuning_guide.html).</span></span>

### <a name="join-efficiently"></a><span data-ttu-id="0ed7b-287">Join efficiently</span><span class="sxs-lookup"><span data-stu-id="0ed7b-287">Join efficiently</span></span>

<span data-ttu-id="0ed7b-288">Generally, you want to avoid joins unless one side is small, especially on frequent queries.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-288">Generally, you want to avoid joins unless one side is small, especially on frequent queries.</span></span>

<span data-ttu-id="0ed7b-289">If necessary, you can do large joins with the `/*+ USE_SORT_MERGE_JOIN */` hint, but a large join is an expensive operation over huge numbers of rows.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-289">If necessary, you can do large joins with the `/*+ USE_SORT_MERGE_JOIN */` hint, but a large join is an expensive operation over huge numbers of rows.</span></span> <span data-ttu-id="0ed7b-290">If the overall size of all right-hand-side tables would exceed the available memory, use the `/*+ NO_STAR_JOIN */` hint.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-290">If the overall size of all right-hand-side tables would exceed the available memory, use the `/*+ NO_STAR_JOIN */` hint.</span></span>

## <a name="scenarios"></a><span data-ttu-id="0ed7b-291">Scenarios</span><span class="sxs-lookup"><span data-stu-id="0ed7b-291">Scenarios</span></span>

<span data-ttu-id="0ed7b-292">The following guidelines describe some common patterns.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-292">The following guidelines describe some common patterns.</span></span>

### <a name="read-heavy-workloads"></a><span data-ttu-id="0ed7b-293">Read-heavy workloads</span><span class="sxs-lookup"><span data-stu-id="0ed7b-293">Read-heavy workloads</span></span>

<span data-ttu-id="0ed7b-294">For read-heavy use cases, make sure you are using indexes.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-294">For read-heavy use cases, make sure you are using indexes.</span></span> <span data-ttu-id="0ed7b-295">Additionally, to save read-time overhead, consider creating covered indexes.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-295">Additionally, to save read-time overhead, consider creating covered indexes.</span></span>

### <a name="write-heavy-workloads"></a><span data-ttu-id="0ed7b-296">Write-heavy workloads</span><span class="sxs-lookup"><span data-stu-id="0ed7b-296">Write-heavy workloads</span></span>

<span data-ttu-id="0ed7b-297">For write-heavy workloads where the primary key is monotonically increasing, create salt buckets to help avoid write hotspots, at the expense of overall read throughput due to the additional scans needed.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-297">For write-heavy workloads where the primary key is monotonically increasing, create salt buckets to help avoid write hotspots, at the expense of overall read throughput due to the additional scans needed.</span></span> <span data-ttu-id="0ed7b-298">Also, when using UPSERT to write a large number of records, turn off autoCommit and batch up the records.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-298">Also, when using UPSERT to write a large number of records, turn off autoCommit and batch up the records.</span></span>

### <a name="bulk-deletes"></a><span data-ttu-id="0ed7b-299">Bulk deletes</span><span class="sxs-lookup"><span data-stu-id="0ed7b-299">Bulk deletes</span></span>

<span data-ttu-id="0ed7b-300">When deleting a large data set, turn on autoCommit before issuing the DELETE query, so that the client does not need to remember the row keys for all deleted rows.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-300">When deleting a large data set, turn on autoCommit before issuing the DELETE query, so that the client does not need to remember the row keys for all deleted rows.</span></span> <span data-ttu-id="0ed7b-301">AutoCommit prevents the client from buffering the rows affected by the DELETE, so that Phoenix can delete them directly on the region servers without the expense of returning them to the client.</span><span class="sxs-lookup"><span data-stu-id="0ed7b-301">AutoCommit prevents the client from buffering the rows affected by the DELETE, so that Phoenix can delete them directly on the region servers without the expense of returning them to the client.</span></span>

### <a name="immutable-and-append-only"></a><span data-ttu-id="0ed7b-302">Immutable and Append-only</span><span class="sxs-lookup"><span data-stu-id="0ed7b-302">Immutable and Append-only</span></span>

<span data-ttu-id="0ed7b-303">If your scenario favors write speed over data integrity, consider disabling the write-ahead log when creating your tables:</span><span class="sxs-lookup"><span data-stu-id="0ed7b-303">If your scenario favors write speed over data integrity, consider disabling the write-ahead log when creating your tables:</span></span>

    CREATE TABLE CONTACTS (...) DISABLE_WAL=true;

<span data-ttu-id="0ed7b-304">For details on this and other options, see [Phoenix Grammar](http://phoenix.apache.org/language/index.html#options).</span><span class="sxs-lookup"><span data-stu-id="0ed7b-304">For details on this and other options, see [Phoenix Grammar](http://phoenix.apache.org/language/index.html#options).</span></span>

## <a name="next-steps"></a><span data-ttu-id="0ed7b-305">Next steps</span><span class="sxs-lookup"><span data-stu-id="0ed7b-305">Next steps</span></span>

* [<span data-ttu-id="0ed7b-306">Phoenix Tuning Guide</span><span class="sxs-lookup"><span data-stu-id="0ed7b-306">Phoenix Tuning Guide</span></span>](https://phoenix.apache.org/tuning_guide.html)
* [<span data-ttu-id="0ed7b-307">Secondary Indexes</span><span class="sxs-lookup"><span data-stu-id="0ed7b-307">Secondary Indexes</span></span>](http://phoenix.apache.org/secondary_indexing.html)
