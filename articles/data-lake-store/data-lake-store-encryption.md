---
title: Encryption in Azure Data Lake Store | Microsoft Docs
description: Encryption in Azure Data Lake Store helps you protect your data, implement enterprise security policies, and meet regulatory compliance requirements. This article provides an overview of the design, and discusses some of the technical aspects of implementation.
services: data-lake-store
documentationcenter: ''
author: esung22
ms.service: data-lake-store
ms.topic: conceptual
ms.date: 03/26/2018
ms.author: yagupta
ms.openlocfilehash: c3f79348cb5d80639d76ad1a8ba82fcfa56ebed1
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44868196"
---
# <a name="encryption-of-data-in-azure-data-lake-store"></a><span data-ttu-id="c5f6d-104">Encryption of data in Azure Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="c5f6d-104">Encryption of data in Azure Data Lake Store</span></span>

<span data-ttu-id="c5f6d-105">Encryption in Azure Data Lake Store helps you protect your data, implement enterprise security policies, and meet regulatory compliance requirements.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-105">Encryption in Azure Data Lake Store helps you protect your data, implement enterprise security policies, and meet regulatory compliance requirements.</span></span> <span data-ttu-id="c5f6d-106">This article provides an overview of the design, and discusses some of the technical aspects of implementation.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-106">This article provides an overview of the design, and discusses some of the technical aspects of implementation.</span></span>

<span data-ttu-id="c5f6d-107">Data Lake Store supports encryption of data both at rest and in transit.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-107">Data Lake Store supports encryption of data both at rest and in transit.</span></span> <span data-ttu-id="c5f6d-108">For data at rest, Data Lake Store supports "on by default," transparent encryption.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-108">For data at rest, Data Lake Store supports "on by default," transparent encryption.</span></span> <span data-ttu-id="c5f6d-109">Here is what these terms mean in a bit more detail:</span><span class="sxs-lookup"><span data-stu-id="c5f6d-109">Here is what these terms mean in a bit more detail:</span></span>

* <span data-ttu-id="c5f6d-110">**On by default**: When you create a new Data Lake Store account, the default setting enables encryption.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-110">**On by default**: When you create a new Data Lake Store account, the default setting enables encryption.</span></span> <span data-ttu-id="c5f6d-111">Thereafter, data that is stored in Data Lake Store is always encrypted prior to storing on persistent media.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-111">Thereafter, data that is stored in Data Lake Store is always encrypted prior to storing on persistent media.</span></span> <span data-ttu-id="c5f6d-112">This is the behavior for all data, and it cannot be changed after an account is created.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-112">This is the behavior for all data, and it cannot be changed after an account is created.</span></span>
* <span data-ttu-id="c5f6d-113">**Transparent**: Data Lake Store automatically encrypts data prior to persisting, and decrypts data prior to retrieval.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-113">**Transparent**: Data Lake Store automatically encrypts data prior to persisting, and decrypts data prior to retrieval.</span></span> <span data-ttu-id="c5f6d-114">The encryption is configured and managed at the Data Lake Store level by an administrator.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-114">The encryption is configured and managed at the Data Lake Store level by an administrator.</span></span> <span data-ttu-id="c5f6d-115">No changes are made to the data access APIs.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-115">No changes are made to the data access APIs.</span></span> <span data-ttu-id="c5f6d-116">Thus, no changes are required in applications and services that interact with Data Lake Store because of encryption.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-116">Thus, no changes are required in applications and services that interact with Data Lake Store because of encryption.</span></span>

<span data-ttu-id="c5f6d-117">Data in transit (also known as data in motion) is also always encrypted in Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-117">Data in transit (also known as data in motion) is also always encrypted in Data Lake Store.</span></span> <span data-ttu-id="c5f6d-118">In addition to encrypting data prior to storing to persistent media, the data is also always secured in transit by using HTTPS.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-118">In addition to encrypting data prior to storing to persistent media, the data is also always secured in transit by using HTTPS.</span></span> <span data-ttu-id="c5f6d-119">HTTPS is the only protocol that is supported for the Data Lake Store REST interfaces.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-119">HTTPS is the only protocol that is supported for the Data Lake Store REST interfaces.</span></span> <span data-ttu-id="c5f6d-120">The following diagram shows how data becomes encrypted in Data Lake Store:</span><span class="sxs-lookup"><span data-stu-id="c5f6d-120">The following diagram shows how data becomes encrypted in Data Lake Store:</span></span>

![Diagram of data encryption in Data Lake Store](./media/data-lake-store-encryption/fig1.png)


## <a name="set-up-encryption-with-data-lake-store"></a><span data-ttu-id="c5f6d-122">Set up encryption with Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="c5f6d-122">Set up encryption with Data Lake Store</span></span>

<span data-ttu-id="c5f6d-123">Encryption for Data Lake Store is set up during account creation, and it is always enabled by default.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-123">Encryption for Data Lake Store is set up during account creation, and it is always enabled by default.</span></span> <span data-ttu-id="c5f6d-124">You can either manage the keys yourself, or allow Data Lake Store to manage them for you (this is the default).</span><span class="sxs-lookup"><span data-stu-id="c5f6d-124">You can either manage the keys yourself, or allow Data Lake Store to manage them for you (this is the default).</span></span>

<span data-ttu-id="c5f6d-125">For more information, see [Getting started](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span><span class="sxs-lookup"><span data-stu-id="c5f6d-125">For more information, see [Getting started](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span></span>

## <a name="how-encryption-works-in-data-lake-store"></a><span data-ttu-id="c5f6d-126">How encryption works in Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="c5f6d-126">How encryption works in Data Lake Store</span></span>

<span data-ttu-id="c5f6d-127">The following information covers how to manage master encryption keys, and it explains the three different types of keys you can use in data encryption for Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-127">The following information covers how to manage master encryption keys, and it explains the three different types of keys you can use in data encryption for Data Lake Store.</span></span>

### <a name="master-encryption-keys"></a><span data-ttu-id="c5f6d-128">Master encryption keys</span><span class="sxs-lookup"><span data-stu-id="c5f6d-128">Master encryption keys</span></span>

<span data-ttu-id="c5f6d-129">Data Lake Store provides two modes for management of master encryption keys (MEKs).</span><span class="sxs-lookup"><span data-stu-id="c5f6d-129">Data Lake Store provides two modes for management of master encryption keys (MEKs).</span></span> <span data-ttu-id="c5f6d-130">For now, assume that the master encryption key is the top-level key.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-130">For now, assume that the master encryption key is the top-level key.</span></span> <span data-ttu-id="c5f6d-131">Access to the master encryption key is required to decrypt any data stored in Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-131">Access to the master encryption key is required to decrypt any data stored in Data Lake Store.</span></span>

<span data-ttu-id="c5f6d-132">The two modes for managing the master encryption key are as follows:</span><span class="sxs-lookup"><span data-stu-id="c5f6d-132">The two modes for managing the master encryption key are as follows:</span></span>

*   <span data-ttu-id="c5f6d-133">Service managed keys</span><span class="sxs-lookup"><span data-stu-id="c5f6d-133">Service managed keys</span></span>
*   <span data-ttu-id="c5f6d-134">Customer managed keys</span><span class="sxs-lookup"><span data-stu-id="c5f6d-134">Customer managed keys</span></span>

<span data-ttu-id="c5f6d-135">In both modes, the master encryption key is secured by storing it in Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-135">In both modes, the master encryption key is secured by storing it in Azure Key Vault.</span></span> <span data-ttu-id="c5f6d-136">Key Vault is a fully managed, highly secure service on Azure that can be used to safeguard cryptographic keys.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-136">Key Vault is a fully managed, highly secure service on Azure that can be used to safeguard cryptographic keys.</span></span> <span data-ttu-id="c5f6d-137">For more information, see [Key Vault](https://azure.microsoft.com/services/key-vault).</span><span class="sxs-lookup"><span data-stu-id="c5f6d-137">For more information, see [Key Vault](https://azure.microsoft.com/services/key-vault).</span></span>

<span data-ttu-id="c5f6d-138">Here is a brief comparison of capabilities provided by the two modes of managing the MEKs.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-138">Here is a brief comparison of capabilities provided by the two modes of managing the MEKs.</span></span>

|  | <span data-ttu-id="c5f6d-139">Service managed keys</span><span class="sxs-lookup"><span data-stu-id="c5f6d-139">Service managed keys</span></span> | <span data-ttu-id="c5f6d-140">Customer managed keys</span><span class="sxs-lookup"><span data-stu-id="c5f6d-140">Customer managed keys</span></span> |
| --- | --- | --- |
|<span data-ttu-id="c5f6d-141">How is data stored?</span><span class="sxs-lookup"><span data-stu-id="c5f6d-141">How is data stored?</span></span>|<span data-ttu-id="c5f6d-142">Always encrypted prior to being stored.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-142">Always encrypted prior to being stored.</span></span>|<span data-ttu-id="c5f6d-143">Always encrypted prior to being stored.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-143">Always encrypted prior to being stored.</span></span>|
|<span data-ttu-id="c5f6d-144">Where is the Master Encryption Key stored?</span><span class="sxs-lookup"><span data-stu-id="c5f6d-144">Where is the Master Encryption Key stored?</span></span>|<span data-ttu-id="c5f6d-145">Key Vault</span><span class="sxs-lookup"><span data-stu-id="c5f6d-145">Key Vault</span></span>|<span data-ttu-id="c5f6d-146">Key Vault</span><span class="sxs-lookup"><span data-stu-id="c5f6d-146">Key Vault</span></span>|
|<span data-ttu-id="c5f6d-147">Are any encryption keys stored in the clear outside of Key Vault?</span><span class="sxs-lookup"><span data-stu-id="c5f6d-147">Are any encryption keys stored in the clear outside of Key Vault?</span></span> |<span data-ttu-id="c5f6d-148">No</span><span class="sxs-lookup"><span data-stu-id="c5f6d-148">No</span></span>|<span data-ttu-id="c5f6d-149">No</span><span class="sxs-lookup"><span data-stu-id="c5f6d-149">No</span></span>|
|<span data-ttu-id="c5f6d-150">Can the MEK be retrieved by Key Vault?</span><span class="sxs-lookup"><span data-stu-id="c5f6d-150">Can the MEK be retrieved by Key Vault?</span></span>|<span data-ttu-id="c5f6d-151">No.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-151">No.</span></span> <span data-ttu-id="c5f6d-152">After the MEK is stored in Key Vault, it can only be used for encryption and decryption.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-152">After the MEK is stored in Key Vault, it can only be used for encryption and decryption.</span></span>|<span data-ttu-id="c5f6d-153">No.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-153">No.</span></span> <span data-ttu-id="c5f6d-154">After the MEK is stored in Key Vault, it can only be used for encryption and decryption.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-154">After the MEK is stored in Key Vault, it can only be used for encryption and decryption.</span></span>|
|<span data-ttu-id="c5f6d-155">Who owns the Key Vault instance and the MEK?</span><span class="sxs-lookup"><span data-stu-id="c5f6d-155">Who owns the Key Vault instance and the MEK?</span></span>|<span data-ttu-id="c5f6d-156">The Data Lake Store service</span><span class="sxs-lookup"><span data-stu-id="c5f6d-156">The Data Lake Store service</span></span>|<span data-ttu-id="c5f6d-157">You own the Key Vault instance, which belongs in your own Azure subscription.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-157">You own the Key Vault instance, which belongs in your own Azure subscription.</span></span> <span data-ttu-id="c5f6d-158">The MEK in Key Vault can be managed by software or hardware.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-158">The MEK in Key Vault can be managed by software or hardware.</span></span>|
|<span data-ttu-id="c5f6d-159">Can you revoke access to the MEK for the Data Lake Store service?</span><span class="sxs-lookup"><span data-stu-id="c5f6d-159">Can you revoke access to the MEK for the Data Lake Store service?</span></span>|<span data-ttu-id="c5f6d-160">No</span><span class="sxs-lookup"><span data-stu-id="c5f6d-160">No</span></span>|<span data-ttu-id="c5f6d-161">Yes.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-161">Yes.</span></span> <span data-ttu-id="c5f6d-162">You can manage access control lists in Key Vault, and remove access control entries to the service identity for the Data Lake Store service.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-162">You can manage access control lists in Key Vault, and remove access control entries to the service identity for the Data Lake Store service.</span></span>|
|<span data-ttu-id="c5f6d-163">Can you permanently delete the MEK?</span><span class="sxs-lookup"><span data-stu-id="c5f6d-163">Can you permanently delete the MEK?</span></span>|<span data-ttu-id="c5f6d-164">No</span><span class="sxs-lookup"><span data-stu-id="c5f6d-164">No</span></span>|<span data-ttu-id="c5f6d-165">Yes.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-165">Yes.</span></span> <span data-ttu-id="c5f6d-166">If you delete the MEK from Key Vault, the data in the Data Lake Store account cannot be decrypted by anyone, including the Data Lake Store service.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-166">If you delete the MEK from Key Vault, the data in the Data Lake Store account cannot be decrypted by anyone, including the Data Lake Store service.</span></span> <br><br> <span data-ttu-id="c5f6d-167">If you have explicitly backed up the MEK prior to deleting it from Key Vault, the MEK can be restored, and the data can then be recovered.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-167">If you have explicitly backed up the MEK prior to deleting it from Key Vault, the MEK can be restored, and the data can then be recovered.</span></span> <span data-ttu-id="c5f6d-168">However, if you have not backed up the MEK prior to deleting it from Key Vault, the data in the Data Lake Store account can never be decrypted thereafter.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-168">However, if you have not backed up the MEK prior to deleting it from Key Vault, the data in the Data Lake Store account can never be decrypted thereafter.</span></span>|


<span data-ttu-id="c5f6d-169">Aside from this difference of who manages the MEK and the Key Vault instance in which it resides, the rest of the design is the same for both modes.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-169">Aside from this difference of who manages the MEK and the Key Vault instance in which it resides, the rest of the design is the same for both modes.</span></span>

<span data-ttu-id="c5f6d-170">It's important to remember the following when you choose the mode for the master encryption keys:</span><span class="sxs-lookup"><span data-stu-id="c5f6d-170">It's important to remember the following when you choose the mode for the master encryption keys:</span></span>

*   <span data-ttu-id="c5f6d-171">You can choose whether to use customer managed keys or service managed keys when you provision a Data Lake Store account.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-171">You can choose whether to use customer managed keys or service managed keys when you provision a Data Lake Store account.</span></span>
*   <span data-ttu-id="c5f6d-172">After a Data Lake Store account is provisioned, the mode cannot be changed.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-172">After a Data Lake Store account is provisioned, the mode cannot be changed.</span></span>

### <a name="encryption-and-decryption-of-data"></a><span data-ttu-id="c5f6d-173">Encryption and decryption of data</span><span class="sxs-lookup"><span data-stu-id="c5f6d-173">Encryption and decryption of data</span></span>

<span data-ttu-id="c5f6d-174">There are three types of keys that are used in the design of data encryption.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-174">There are three types of keys that are used in the design of data encryption.</span></span> <span data-ttu-id="c5f6d-175">The following table provides a summary:</span><span class="sxs-lookup"><span data-stu-id="c5f6d-175">The following table provides a summary:</span></span>

| <span data-ttu-id="c5f6d-176">Key</span><span class="sxs-lookup"><span data-stu-id="c5f6d-176">Key</span></span>                   | <span data-ttu-id="c5f6d-177">Abbreviation</span><span class="sxs-lookup"><span data-stu-id="c5f6d-177">Abbreviation</span></span> | <span data-ttu-id="c5f6d-178">Associated with</span><span class="sxs-lookup"><span data-stu-id="c5f6d-178">Associated with</span></span> | <span data-ttu-id="c5f6d-179">Storage location</span><span class="sxs-lookup"><span data-stu-id="c5f6d-179">Storage location</span></span>                             | <span data-ttu-id="c5f6d-180">Type</span><span class="sxs-lookup"><span data-stu-id="c5f6d-180">Type</span></span>       | <span data-ttu-id="c5f6d-181">Notes</span><span class="sxs-lookup"><span data-stu-id="c5f6d-181">Notes</span></span>                                                                                                   |
|-----------------------|--------------|-----------------|----------------------------------------------|------------|---------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="c5f6d-182">Master Encryption Key</span><span class="sxs-lookup"><span data-stu-id="c5f6d-182">Master Encryption Key</span></span> | <span data-ttu-id="c5f6d-183">MEK</span><span class="sxs-lookup"><span data-stu-id="c5f6d-183">MEK</span></span>          | <span data-ttu-id="c5f6d-184">A Data Lake Store account</span><span class="sxs-lookup"><span data-stu-id="c5f6d-184">A Data Lake Store account</span></span> | <span data-ttu-id="c5f6d-185">Key Vault</span><span class="sxs-lookup"><span data-stu-id="c5f6d-185">Key Vault</span></span>                              | <span data-ttu-id="c5f6d-186">Asymmetric</span><span class="sxs-lookup"><span data-stu-id="c5f6d-186">Asymmetric</span></span> | <span data-ttu-id="c5f6d-187">It can be managed by Data Lake Store or you.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-187">It can be managed by Data Lake Store or you.</span></span>                                                              |
| <span data-ttu-id="c5f6d-188">Data Encryption Key</span><span class="sxs-lookup"><span data-stu-id="c5f6d-188">Data Encryption Key</span></span>   | <span data-ttu-id="c5f6d-189">DEK</span><span class="sxs-lookup"><span data-stu-id="c5f6d-189">DEK</span></span>          | <span data-ttu-id="c5f6d-190">A Data Lake Store account</span><span class="sxs-lookup"><span data-stu-id="c5f6d-190">A Data Lake Store account</span></span> | <span data-ttu-id="c5f6d-191">Persistent storage, managed by Data Lake Store service</span><span class="sxs-lookup"><span data-stu-id="c5f6d-191">Persistent storage, managed by Data Lake Store service</span></span> | <span data-ttu-id="c5f6d-192">Symmetric</span><span class="sxs-lookup"><span data-stu-id="c5f6d-192">Symmetric</span></span>  | <span data-ttu-id="c5f6d-193">The DEK is encrypted by the MEK.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-193">The DEK is encrypted by the MEK.</span></span> <span data-ttu-id="c5f6d-194">The encrypted DEK is what is stored on persistent media.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-194">The encrypted DEK is what is stored on persistent media.</span></span> |
| <span data-ttu-id="c5f6d-195">Block Encryption Key</span><span class="sxs-lookup"><span data-stu-id="c5f6d-195">Block Encryption Key</span></span>  | <span data-ttu-id="c5f6d-196">BEK</span><span class="sxs-lookup"><span data-stu-id="c5f6d-196">BEK</span></span>          | <span data-ttu-id="c5f6d-197">A block of data</span><span class="sxs-lookup"><span data-stu-id="c5f6d-197">A block of data</span></span> | <span data-ttu-id="c5f6d-198">None</span><span class="sxs-lookup"><span data-stu-id="c5f6d-198">None</span></span>                                         | <span data-ttu-id="c5f6d-199">Symmetric</span><span class="sxs-lookup"><span data-stu-id="c5f6d-199">Symmetric</span></span>  | <span data-ttu-id="c5f6d-200">The BEK is derived from the DEK and the data block.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-200">The BEK is derived from the DEK and the data block.</span></span>                                                      |

<span data-ttu-id="c5f6d-201">The following diagram illustrates these concepts:</span><span class="sxs-lookup"><span data-stu-id="c5f6d-201">The following diagram illustrates these concepts:</span></span>

![Keys in data encryption](./media/data-lake-store-encryption/fig2.png)

#### <a name="pseudo-algorithm-when-a-file-is-to-be-decrypted"></a><span data-ttu-id="c5f6d-203">Pseudo algorithm when a file is to be decrypted:</span><span class="sxs-lookup"><span data-stu-id="c5f6d-203">Pseudo algorithm when a file is to be decrypted:</span></span>
1.  <span data-ttu-id="c5f6d-204">Check if the DEK for the Data Lake Store account is cached and ready for use.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-204">Check if the DEK for the Data Lake Store account is cached and ready for use.</span></span>
    - <span data-ttu-id="c5f6d-205">If not, then read the encrypted DEK from persistent storage, and send it to Key Vault to be decrypted.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-205">If not, then read the encrypted DEK from persistent storage, and send it to Key Vault to be decrypted.</span></span> <span data-ttu-id="c5f6d-206">Cache the decrypted DEK in memory.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-206">Cache the decrypted DEK in memory.</span></span> <span data-ttu-id="c5f6d-207">It is now ready to use.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-207">It is now ready to use.</span></span>
2.  <span data-ttu-id="c5f6d-208">For every block of data in the file:</span><span class="sxs-lookup"><span data-stu-id="c5f6d-208">For every block of data in the file:</span></span>
    - <span data-ttu-id="c5f6d-209">Read the encrypted block of data from persistent storage.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-209">Read the encrypted block of data from persistent storage.</span></span>
    - <span data-ttu-id="c5f6d-210">Generate the BEK from the DEK and the encrypted block of data.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-210">Generate the BEK from the DEK and the encrypted block of data.</span></span>
    - <span data-ttu-id="c5f6d-211">Use the BEK to decrypt data.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-211">Use the BEK to decrypt data.</span></span>


#### <a name="pseudo-algorithm-when-a-block-of-data-is-to-be-encrypted"></a><span data-ttu-id="c5f6d-212">Pseudo algorithm when a block of data is to be encrypted:</span><span class="sxs-lookup"><span data-stu-id="c5f6d-212">Pseudo algorithm when a block of data is to be encrypted:</span></span>
1.  <span data-ttu-id="c5f6d-213">Check if the DEK for the Data Lake Store account is cached and ready for use.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-213">Check if the DEK for the Data Lake Store account is cached and ready for use.</span></span>
    - <span data-ttu-id="c5f6d-214">If not, then read the encrypted DEK from persistent storage, and send it to Key Vault to be decrypted.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-214">If not, then read the encrypted DEK from persistent storage, and send it to Key Vault to be decrypted.</span></span> <span data-ttu-id="c5f6d-215">Cache the decrypted DEK in memory.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-215">Cache the decrypted DEK in memory.</span></span> <span data-ttu-id="c5f6d-216">It is now ready to use.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-216">It is now ready to use.</span></span>
2.  <span data-ttu-id="c5f6d-217">Generate a unique BEK for the block of data from the DEK.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-217">Generate a unique BEK for the block of data from the DEK.</span></span>
3.  <span data-ttu-id="c5f6d-218">Encrypt the data block with the BEK, by using AES-256 encryption.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-218">Encrypt the data block with the BEK, by using AES-256 encryption.</span></span>
4.  <span data-ttu-id="c5f6d-219">Store the encrypted data block of data on persistent storage.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-219">Store the encrypted data block of data on persistent storage.</span></span>

> [!NOTE] 
> <span data-ttu-id="c5f6d-220">The DEK is always stored encrypted by the MEK, whether on persistent media or cached in memory.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-220">The DEK is always stored encrypted by the MEK, whether on persistent media or cached in memory.</span></span>

## <a name="key-rotation"></a><span data-ttu-id="c5f6d-221">Key rotation</span><span class="sxs-lookup"><span data-stu-id="c5f6d-221">Key rotation</span></span>

<span data-ttu-id="c5f6d-222">When you are using customer-managed keys, you can rotate the MEK.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-222">When you are using customer-managed keys, you can rotate the MEK.</span></span> <span data-ttu-id="c5f6d-223">To learn how to set up a Data Lake Store account with customer-managed keys, see [Getting started](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span><span class="sxs-lookup"><span data-stu-id="c5f6d-223">To learn how to set up a Data Lake Store account with customer-managed keys, see [Getting started](https://docs.microsoft.com/azure/data-lake-store/data-lake-store-get-started-portal).</span></span>

### <a name="prerequisites"></a><span data-ttu-id="c5f6d-224">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="c5f6d-224">Prerequisites</span></span>

<span data-ttu-id="c5f6d-225">When you set up the Data Lake Store account, you have chosen to use your own keys.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-225">When you set up the Data Lake Store account, you have chosen to use your own keys.</span></span> <span data-ttu-id="c5f6d-226">This option cannot be changed after the account has been created.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-226">This option cannot be changed after the account has been created.</span></span> <span data-ttu-id="c5f6d-227">The following steps assume that you are using customer-managed keys (that is, you have chosen your own keys from Key Vault).</span><span class="sxs-lookup"><span data-stu-id="c5f6d-227">The following steps assume that you are using customer-managed keys (that is, you have chosen your own keys from Key Vault).</span></span>

<span data-ttu-id="c5f6d-228">Note that if you use the default options for encryption, your data is always encrypted by using keys managed by Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-228">Note that if you use the default options for encryption, your data is always encrypted by using keys managed by Data Lake Store.</span></span> <span data-ttu-id="c5f6d-229">In this option, you don't have the ability to rotate keys, as they are managed by Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-229">In this option, you don't have the ability to rotate keys, as they are managed by Data Lake Store.</span></span>

### <a name="how-to-rotate-the-mek-in-data-lake-store"></a><span data-ttu-id="c5f6d-230">How to rotate the MEK in Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="c5f6d-230">How to rotate the MEK in Data Lake Store</span></span>

1. <span data-ttu-id="c5f6d-231">Sign in to the [Azure portal](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="c5f6d-231">Sign in to the [Azure portal](https://portal.azure.com/).</span></span>
2. <span data-ttu-id="c5f6d-232">Browse to the Key Vault instance that stores your keys associated with your Data Lake Store account.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-232">Browse to the Key Vault instance that stores your keys associated with your Data Lake Store account.</span></span> <span data-ttu-id="c5f6d-233">Select **Keys**.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-233">Select **Keys**.</span></span>

    ![Screenshot of Key Vault](./media/data-lake-store-encryption/keyvault.png)

3.  <span data-ttu-id="c5f6d-235">Select the key associated with your Data Lake Store account, and create a new version of this key.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-235">Select the key associated with your Data Lake Store account, and create a new version of this key.</span></span> <span data-ttu-id="c5f6d-236">Note that Data Lake Store currently only supports key rotation to a new version of a key.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-236">Note that Data Lake Store currently only supports key rotation to a new version of a key.</span></span> <span data-ttu-id="c5f6d-237">It doesn't support rotating to a different key.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-237">It doesn't support rotating to a different key.</span></span>

   ![Screenshot of Keys window, with New Version highlighted](./media/data-lake-store-encryption/keynewversion.png)

4.  <span data-ttu-id="c5f6d-239">Browse to the Data Lake Store storage account, and select **Encryption**.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-239">Browse to the Data Lake Store storage account, and select **Encryption**.</span></span>

    ![Screenshot of Data Lake Store storage account window, with Encryption highlighted](./media/data-lake-store-encryption/select-encryption.png)

5.  <span data-ttu-id="c5f6d-241">A message notifies you that a new key version of the key is available.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-241">A message notifies you that a new key version of the key is available.</span></span> <span data-ttu-id="c5f6d-242">Click **Rotate Key** to update the key to the new version.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-242">Click **Rotate Key** to update the key to the new version.</span></span>

    ![Screenshot of Data Lake Store window with message and Rotate Key highlighted](./media/data-lake-store-encryption/rotatekey.png)

<span data-ttu-id="c5f6d-244">This operation should take less than two minutes, and there is no expected downtime due to key rotation.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-244">This operation should take less than two minutes, and there is no expected downtime due to key rotation.</span></span> <span data-ttu-id="c5f6d-245">After the operation is complete, the new version of the key is in use.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-245">After the operation is complete, the new version of the key is in use.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c5f6d-246">After the key rotation operation is complete, the old version of the key is no longer actively used for encrypting your data.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-246">After the key rotation operation is complete, the old version of the key is no longer actively used for encrypting your data.</span></span>  <span data-ttu-id="c5f6d-247">However, in rare instances of unexpected failure where even redundant copies of your data are impacted, data may be restored from a backup that is still using the old key.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-247">However, in rare instances of unexpected failure where even redundant copies of your data are impacted, data may be restored from a backup that is still using the old key.</span></span> <span data-ttu-id="c5f6d-248">To ensure your data is accessible in these rare circumstances, keep a copy of the previous version of your encryption key.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-248">To ensure your data is accessible in these rare circumstances, keep a copy of the previous version of your encryption key.</span></span> <span data-ttu-id="c5f6d-249">See [Disaster recovery guidance for data in Data Lake Store](data-lake-store-disaster-recovery-guidance.md) for best practices for your disaster recovery planning.</span><span class="sxs-lookup"><span data-stu-id="c5f6d-249">See [Disaster recovery guidance for data in Data Lake Store](data-lake-store-disaster-recovery-guidance.md) for best practices for your disaster recovery planning.</span></span> 