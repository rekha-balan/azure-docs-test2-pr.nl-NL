---
title: Profiling live web apps on Azure with Application Insights | Microsoft Docs
description: Identify the hot path in your web server code with a low-footprint profiler.
services: application-insights
documentationcenter: ''
author: alancameronwills
manager: carmonm
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 04/03/2017
ms.author: awills
ms.openlocfilehash: 598dc1134ad7a82be7e0cbfef9da6431cc06278d
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44551328"
---
# <a name="profiling-live-azure-web-apps-with-application-insights-preview"></a><span data-ttu-id="3fb95-103">Profiling live Azure web apps with Application Insights (preview)</span><span class="sxs-lookup"><span data-stu-id="3fb95-103">Profiling live Azure web apps with Application Insights (preview)</span></span>

<span data-ttu-id="3fb95-104">*This feature of Application Insights is in preview.*</span><span class="sxs-lookup"><span data-stu-id="3fb95-104">*This feature of Application Insights is in preview.*</span></span>

<span data-ttu-id="3fb95-105">Find out how much time is spent in each method in your live web application by using the profiling tool of [Azure Application Insights](app-insights-overview.md).</span><span class="sxs-lookup"><span data-stu-id="3fb95-105">Find out how much time is spent in each method in your live web application by using the profiling tool of [Azure Application Insights](app-insights-overview.md).</span></span> <span data-ttu-id="3fb95-106">It shows you detailed profiles of live requests that were served by your app, and highlights the 'hot path' that is using the most time.</span><span class="sxs-lookup"><span data-stu-id="3fb95-106">It shows you detailed profiles of live requests that were served by your app, and highlights the 'hot path' that is using the most time.</span></span> <span data-ttu-id="3fb95-107">It automatically selects examples that have different response times.</span><span class="sxs-lookup"><span data-stu-id="3fb95-107">It automatically selects examples that have different response times.</span></span> <span data-ttu-id="3fb95-108">The profiler uses various techniques to minimize overhead.</span><span class="sxs-lookup"><span data-stu-id="3fb95-108">The profiler uses various techniques to minimize overhead.</span></span> 

<span data-ttu-id="3fb95-109">The profiler currently works for ASP.NET web apps running on Azure App Services, in at least the Basic pricing tier.</span><span class="sxs-lookup"><span data-stu-id="3fb95-109">The profiler currently works for ASP.NET web apps running on Azure App Services, in at least the Basic pricing tier.</span></span> <span data-ttu-id="3fb95-110">(If you're using ASP.NET Core, the target framework must be `.NetCoreApp`.)</span><span class="sxs-lookup"><span data-stu-id="3fb95-110">(If you're using ASP.NET Core, the target framework must be `.NetCoreApp`.)</span></span>

<a id="installation"></a>
## <a name="enable-the-profiler"></a><span data-ttu-id="3fb95-111">Enable the profiler</span><span class="sxs-lookup"><span data-stu-id="3fb95-111">Enable the profiler</span></span>

<span data-ttu-id="3fb95-112">[Install Application Insights](app-insights-asp-net.md) in your code.</span><span class="sxs-lookup"><span data-stu-id="3fb95-112">[Install Application Insights](app-insights-asp-net.md) in your code.</span></span> <span data-ttu-id="3fb95-113">If it's already installed, make sure you have the latest version.</span><span class="sxs-lookup"><span data-stu-id="3fb95-113">If it's already installed, make sure you have the latest version.</span></span> <span data-ttu-id="3fb95-114">(To do this, right-click your project in Solution Explorer, and choose Manage NuGet packages.</span><span class="sxs-lookup"><span data-stu-id="3fb95-114">(To do this, right-click your project in Solution Explorer, and choose Manage NuGet packages.</span></span> <span data-ttu-id="3fb95-115">Select Updates and update all packages.) Re-deploy your app.</span><span class="sxs-lookup"><span data-stu-id="3fb95-115">Select Updates and update all packages.) Re-deploy your app.</span></span>

<span data-ttu-id="3fb95-116">*Using ASP.NET Core? [Check here](#aspnetcore).*</span><span class="sxs-lookup"><span data-stu-id="3fb95-116">*Using ASP.NET Core? [Check here](#aspnetcore).*</span></span>

<span data-ttu-id="3fb95-117">In [https://portal.azure.com](https://portal.azure.com), open the Application Insights resource for your web app.</span><span class="sxs-lookup"><span data-stu-id="3fb95-117">In [https://portal.azure.com](https://portal.azure.com), open the Application Insights resource for your web app.</span></span> <span data-ttu-id="3fb95-118">Open **Performance** and click **Configure**.</span><span class="sxs-lookup"><span data-stu-id="3fb95-118">Open **Performance** and click **Configure**.</span></span> <span data-ttu-id="3fb95-119">Select your app and follow the wizard.</span><span class="sxs-lookup"><span data-stu-id="3fb95-119">Select your app and follow the wizard.</span></span>

![In the Performance blade, click Configure][performance-blade]

* <span data-ttu-id="3fb95-121">*No Configure button? Use the [manual procedure](#manual-installation).*</span><span class="sxs-lookup"><span data-stu-id="3fb95-121">*No Configure button? Use the [manual procedure](#manual-installation).*</span></span>

<span data-ttu-id="3fb95-122">If you need to stop or restart the profiler, you'll find it **in the App Service resource**, in **Web Jobs**.</span><span class="sxs-lookup"><span data-stu-id="3fb95-122">If you need to stop or restart the profiler, you'll find it **in the App Service resource**, in **Web Jobs**.</span></span> <span data-ttu-id="3fb95-123">To delete it, look under **Extensions**.</span><span class="sxs-lookup"><span data-stu-id="3fb95-123">To delete it, look under **Extensions**.</span></span>

<span data-ttu-id="3fb95-124">If you use WebDeploy to deploy changes to your web application, ensure that you exclude the **App_Data** folder from being deleted during deployment.</span><span class="sxs-lookup"><span data-stu-id="3fb95-124">If you use WebDeploy to deploy changes to your web application, ensure that you exclude the **App_Data** folder from being deleted during deployment.</span></span> <span data-ttu-id="3fb95-125">Otherwise, the profiler extension's files will be deleted when you next deploy the web application to Azure.</span><span class="sxs-lookup"><span data-stu-id="3fb95-125">Otherwise, the profiler extension's files will be deleted when you next deploy the web application to Azure.</span></span>

## <a name="viewing-profiler-data"></a><span data-ttu-id="3fb95-126">Viewing profiler data</span><span class="sxs-lookup"><span data-stu-id="3fb95-126">Viewing profiler data</span></span>

<span data-ttu-id="3fb95-127">Open the Performance blade and scroll down to the operation list.</span><span class="sxs-lookup"><span data-stu-id="3fb95-127">Open the Performance blade and scroll down to the operation list.</span></span>




![Application Insights Performance blade Examples Column][performance-blade-examples]

<span data-ttu-id="3fb95-129">The columns in the table are:</span><span class="sxs-lookup"><span data-stu-id="3fb95-129">The columns in the table are:</span></span>

* <span data-ttu-id="3fb95-130">**Count** - The number of these requests in the time range of the blade.</span><span class="sxs-lookup"><span data-stu-id="3fb95-130">**Count** - The number of these requests in the time range of the blade.</span></span>
* <span data-ttu-id="3fb95-131">**Median** - The typical time your app takes to respond to a request.</span><span class="sxs-lookup"><span data-stu-id="3fb95-131">**Median** - The typical time your app takes to respond to a request.</span></span> <span data-ttu-id="3fb95-132">Half of all responses were faster than this.</span><span class="sxs-lookup"><span data-stu-id="3fb95-132">Half of all responses were faster than this.</span></span>
* <span data-ttu-id="3fb95-133">**95th percentile** 95% of responses were faster than this.</span><span class="sxs-lookup"><span data-stu-id="3fb95-133">**95th percentile** 95% of responses were faster than this.</span></span> <span data-ttu-id="3fb95-134">If this figure is very different from the median, there might be an intermittent problem with your app.</span><span class="sxs-lookup"><span data-stu-id="3fb95-134">If this figure is very different from the median, there might be an intermittent problem with your app.</span></span> <span data-ttu-id="3fb95-135">(Or it might be explained by a design feature such as caching.)</span><span class="sxs-lookup"><span data-stu-id="3fb95-135">(Or it might be explained by a design feature such as caching.)</span></span>
* <span data-ttu-id="3fb95-136">**Examples** - an icon indicates that the profiler has captured stack traces for this operation.</span><span class="sxs-lookup"><span data-stu-id="3fb95-136">**Examples** - an icon indicates that the profiler has captured stack traces for this operation.</span></span>

<span data-ttu-id="3fb95-137">Click the Examples icon to open the trace explorer.</span><span class="sxs-lookup"><span data-stu-id="3fb95-137">Click the Examples icon to open the trace explorer.</span></span> <span data-ttu-id="3fb95-138">The explorer shows several samples that the profiler has captured, classified by response time.</span><span class="sxs-lookup"><span data-stu-id="3fb95-138">The explorer shows several samples that the profiler has captured, classified by response time.</span></span>

<span data-ttu-id="3fb95-139">Select a sample to show a code-level breakdown of time spent executing the request.</span><span class="sxs-lookup"><span data-stu-id="3fb95-139">Select a sample to show a code-level breakdown of time spent executing the request.</span></span>

![Application Insights Trace Explorer][trace-explorer]

<span data-ttu-id="3fb95-141">**Show hot path** opens the biggest leaf node, or at least something close.</span><span class="sxs-lookup"><span data-stu-id="3fb95-141">**Show hot path** opens the biggest leaf node, or at least something close.</span></span> <span data-ttu-id="3fb95-142">In most cases this node will be adjacent to a performance bottleneck.</span><span class="sxs-lookup"><span data-stu-id="3fb95-142">In most cases this node will be adjacent to a performance bottleneck.</span></span>



* <span data-ttu-id="3fb95-143">**Label**: The name of the function or event.</span><span class="sxs-lookup"><span data-stu-id="3fb95-143">**Label**: The name of the function or event.</span></span> <span data-ttu-id="3fb95-144">The tree shows a mix of code and events that occurred (such as SQL and http events).</span><span class="sxs-lookup"><span data-stu-id="3fb95-144">The tree shows a mix of code and events that occurred (such as SQL and http events).</span></span> <span data-ttu-id="3fb95-145">The top event represents the overall request duration.</span><span class="sxs-lookup"><span data-stu-id="3fb95-145">The top event represents the overall request duration.</span></span>
* <span data-ttu-id="3fb95-146">**Metric**: The elapsed time.</span><span class="sxs-lookup"><span data-stu-id="3fb95-146">**Metric**: The elapsed time.</span></span>
* <span data-ttu-id="3fb95-147">**When**: Shows when the function/event was running in relation to other functions.</span><span class="sxs-lookup"><span data-stu-id="3fb95-147">**When**: Shows when the function/event was running in relation to other functions.</span></span> 

## <a name="how-to-read-performance-data"></a><span data-ttu-id="3fb95-148">How to read performance data</span><span class="sxs-lookup"><span data-stu-id="3fb95-148">How to read performance data</span></span>

<span data-ttu-id="3fb95-149">Microsoft service profiler uses a combination of sampling method and instrumentation to analyze the performance of your application.</span><span class="sxs-lookup"><span data-stu-id="3fb95-149">Microsoft service profiler uses a combination of sampling method and instrumentation to analyze the performance of your application.</span></span> <span data-ttu-id="3fb95-150">When detailed collection is in progress, service profiler samples the instruction pointer of each of the machine's CPU in every millisecond.</span><span class="sxs-lookup"><span data-stu-id="3fb95-150">When detailed collection is in progress, service profiler samples the instruction pointer of each of the machine's CPU in every millisecond.</span></span> <span data-ttu-id="3fb95-151">Each sample captures the complete call stack of the thread currently executing, giving detailed and useful information about what that thread was doing at both high and low levels of abstraction.</span><span class="sxs-lookup"><span data-stu-id="3fb95-151">Each sample captures the complete call stack of the thread currently executing, giving detailed and useful information about what that thread was doing at both high and low levels of abstraction.</span></span> <span data-ttu-id="3fb95-152">Service profiler also collects other events such as context switching events, TPL events, and thread-pool events to track activity correlation and causality.</span><span class="sxs-lookup"><span data-stu-id="3fb95-152">Service profiler also collects other events such as context switching events, TPL events, and thread-pool events to track activity correlation and causality.</span></span> 

<span data-ttu-id="3fb95-153">The call stack shown in the timeline view is the result of the above sampling and instrumentation.</span><span class="sxs-lookup"><span data-stu-id="3fb95-153">The call stack shown in the timeline view is the result of the above sampling and instrumentation.</span></span> <span data-ttu-id="3fb95-154">Because each sample captures the complete call stack of the thread, it includes code from the .NET framework, as well as other frameworks you reference.</span><span class="sxs-lookup"><span data-stu-id="3fb95-154">Because each sample captures the complete call stack of the thread, it includes code from the .NET framework, as well as other frameworks you reference.</span></span>

### <a id="jitnewobj"></a><span data-ttu-id="3fb95-155">Object Allocation (`clr!JIT\_New or clr!JIT\_Newarr1`)</span><span class="sxs-lookup"><span data-stu-id="3fb95-155">Object Allocation (`clr!JIT\_New or clr!JIT\_Newarr1`)</span></span>
<span data-ttu-id="3fb95-156">`clr!JIT\_New and clr!JIT\_Newarr1` are helper functions inside .NET framework that allocates memory from managed heap.</span><span class="sxs-lookup"><span data-stu-id="3fb95-156">`clr!JIT\_New and clr!JIT\_Newarr1` are helper functions inside .NET framework that allocates memory from managed heap.</span></span> <span data-ttu-id="3fb95-157">`clr!JIT\_New` is invoked when an object is allocated.</span><span class="sxs-lookup"><span data-stu-id="3fb95-157">`clr!JIT\_New` is invoked when an object is allocated.</span></span> <span data-ttu-id="3fb95-158">`clr!JIT\_Newarr1` is invoked when an object array is allocated.</span><span class="sxs-lookup"><span data-stu-id="3fb95-158">`clr!JIT\_Newarr1` is invoked when an object array is allocated.</span></span> <span data-ttu-id="3fb95-159">These two functions are typically very fast and should take relatively small amount of time.</span><span class="sxs-lookup"><span data-stu-id="3fb95-159">These two functions are typically very fast and should take relatively small amount of time.</span></span> <span data-ttu-id="3fb95-160">If you see `clr!JIT\_New` or `clr!JIT\_Newarr1` take a substantial amount of time in your timeline, it's an indication that the code may be allocating many objects and consuming significant amount of memory.</span><span class="sxs-lookup"><span data-stu-id="3fb95-160">If you see `clr!JIT\_New` or `clr!JIT\_Newarr1` take a substantial amount of time in your timeline, it's an indication that the code may be allocating many objects and consuming significant amount of memory.</span></span> 

### <a id="theprestub"></a><span data-ttu-id="3fb95-161">Loading Code (`clr!ThePreStub`)</span><span class="sxs-lookup"><span data-stu-id="3fb95-161">Loading Code (`clr!ThePreStub`)</span></span>
<span data-ttu-id="3fb95-162">`clr!ThePreStub` is a helper function inside .NET framework that prepares the code to execute for the first time.</span><span class="sxs-lookup"><span data-stu-id="3fb95-162">`clr!ThePreStub` is a helper function inside .NET framework that prepares the code to execute for the first time.</span></span> <span data-ttu-id="3fb95-163">This typically includes, but not limited to, JIT (Just In Time) compilation.</span><span class="sxs-lookup"><span data-stu-id="3fb95-163">This typically includes, but not limited to, JIT (Just In Time) compilation.</span></span> <span data-ttu-id="3fb95-164">For each C# method, `clr!ThePreStub` should be invoked at most once during the lifetime of a process.</span><span class="sxs-lookup"><span data-stu-id="3fb95-164">For each C# method, `clr!ThePreStub` should be invoked at most once during the lifetime of a process.</span></span>

<span data-ttu-id="3fb95-165">If you see `clr!ThePreStub` takes significant amount of time for a request, it indicates that request is the first one that executes that method, and the time for .NET framework runtime to load that method is significant.</span><span class="sxs-lookup"><span data-stu-id="3fb95-165">If you see `clr!ThePreStub` takes significant amount of time for a request, it indicates that request is the first one that executes that method, and the time for .NET framework runtime to load that method is significant.</span></span> <span data-ttu-id="3fb95-166">You can consider a warm-up process that executes that portion of the code before your users access it, or consider running NGen on your assemblies.</span><span class="sxs-lookup"><span data-stu-id="3fb95-166">You can consider a warm-up process that executes that portion of the code before your users access it, or consider running NGen on your assemblies.</span></span> 

### <a id="lockcontention"></a><span data-ttu-id="3fb95-167">Lock Contention (`clr!JITutil\_MonContention` or `clr!JITutil\_MonEnterWorker`)</span><span class="sxs-lookup"><span data-stu-id="3fb95-167">Lock Contention (`clr!JITutil\_MonContention` or `clr!JITutil\_MonEnterWorker`)</span></span>
<span data-ttu-id="3fb95-168">`clr!JITutil\_MonContention` or `clr!JITutil\_MonEnterWorker` indicate the current thread is waiting for a lock to be released.</span><span class="sxs-lookup"><span data-stu-id="3fb95-168">`clr!JITutil\_MonContention` or `clr!JITutil\_MonEnterWorker` indicate the current thread is waiting for a lock to be released.</span></span> <span data-ttu-id="3fb95-169">This typically shows up when executing a C# lock statement, invoking Monitor.Enter method, or invoking a method with MethodImplOptions.Synchronized attribute.</span><span class="sxs-lookup"><span data-stu-id="3fb95-169">This typically shows up when executing a C# lock statement, invoking Monitor.Enter method, or invoking a method with MethodImplOptions.Synchronized attribute.</span></span> <span data-ttu-id="3fb95-170">Lock contention typically happens when thread A acquires a lock, and thread B tries to acquire the same lock before thread A releases it.</span><span class="sxs-lookup"><span data-stu-id="3fb95-170">Lock contention typically happens when thread A acquires a lock, and thread B tries to acquire the same lock before thread A releases it.</span></span> 

### <a id="ngencold"></a><span data-ttu-id="3fb95-171">Loading code (`[COLD]`)</span><span class="sxs-lookup"><span data-stu-id="3fb95-171">Loading code (`[COLD]`)</span></span>
<span data-ttu-id="3fb95-172">If the method name contains `[COLD]`, such as `mscorlib.ni![COLD]System.Reflection.CustomAttribute.IsDefined`, it means that the .NET framework runtime is executing code that is not optimized by <a href="https://msdn.microsoft.com/library/e7k32f4k.aspx">profile-guided optimization</a> for the first time.</span><span class="sxs-lookup"><span data-stu-id="3fb95-172">If the method name contains `[COLD]`, such as `mscorlib.ni![COLD]System.Reflection.CustomAttribute.IsDefined`, it means that the .NET framework runtime is executing code that is not optimized by <a href="https://msdn.microsoft.com/library/e7k32f4k.aspx">profile-guided optimization</a> for the first time.</span></span> <span data-ttu-id="3fb95-173">For each method, it should show up at most once during the lifetime of the process.</span><span class="sxs-lookup"><span data-stu-id="3fb95-173">For each method, it should show up at most once during the lifetime of the process.</span></span> 

<span data-ttu-id="3fb95-174">If loading code takes significant amount of time for a request, it indicates that request is the first one to execute the unoptimized portion of the method.</span><span class="sxs-lookup"><span data-stu-id="3fb95-174">If loading code takes significant amount of time for a request, it indicates that request is the first one to execute the unoptimized portion of the method.</span></span> <span data-ttu-id="3fb95-175">You can consider a warm up process that executes that portion of the code before your users access it.</span><span class="sxs-lookup"><span data-stu-id="3fb95-175">You can consider a warm up process that executes that portion of the code before your users access it.</span></span> 

### <a id="httpclientsend"></a><span data-ttu-id="3fb95-176">Send HTTP Request</span><span class="sxs-lookup"><span data-stu-id="3fb95-176">Send HTTP Request</span></span>
<span data-ttu-id="3fb95-177">Methods such as `HttpClient.Send` indicate the code is waiting for a HTTP request to complete.</span><span class="sxs-lookup"><span data-stu-id="3fb95-177">Methods such as `HttpClient.Send` indicate the code is waiting for a HTTP request to complete.</span></span>

### <a id="sqlcommand"></a><span data-ttu-id="3fb95-178">Database Operation</span><span class="sxs-lookup"><span data-stu-id="3fb95-178">Database Operation</span></span>
<span data-ttu-id="3fb95-179">Method such as SqlCommand.Execute indicates the code is waiting for a database operation to complete.</span><span class="sxs-lookup"><span data-stu-id="3fb95-179">Method such as SqlCommand.Execute indicates the code is waiting for a database operation to complete.</span></span>

### <a id="await"></a><span data-ttu-id="3fb95-180">Waiting (`AWAIT\_TIME`)</span><span class="sxs-lookup"><span data-stu-id="3fb95-180">Waiting (`AWAIT\_TIME`)</span></span>
<span data-ttu-id="3fb95-181">`AWAIT\_TIME` indicates the code is waiting for another task to complete.</span><span class="sxs-lookup"><span data-stu-id="3fb95-181">`AWAIT\_TIME` indicates the code is waiting for another task to complete.</span></span> <span data-ttu-id="3fb95-182">This typically happens with C# 'await' statement.</span><span class="sxs-lookup"><span data-stu-id="3fb95-182">This typically happens with C# 'await' statement.</span></span> <span data-ttu-id="3fb95-183">When the code does a C# 'await', the thread unwinds and returns control to the thread-pool, and there is no thread that is blocked waiting for the 'await' to finish.</span><span class="sxs-lookup"><span data-stu-id="3fb95-183">When the code does a C# 'await', the thread unwinds and returns control to the thread-pool, and there is no thread that is blocked waiting for the 'await' to finish.</span></span> <span data-ttu-id="3fb95-184">However, logically the thread that did the await is 'blocked' waiting for the operation to complete.</span><span class="sxs-lookup"><span data-stu-id="3fb95-184">However, logically the thread that did the await is 'blocked' waiting for the operation to complete.</span></span> <span data-ttu-id="3fb95-185">The `AWAIT\_TIME` indicates the blocked time waiting for the task to complete.</span><span class="sxs-lookup"><span data-stu-id="3fb95-185">The `AWAIT\_TIME` indicates the blocked time waiting for the task to complete.</span></span>

### <a id="block"></a><span data-ttu-id="3fb95-186">Blocked Time</span><span class="sxs-lookup"><span data-stu-id="3fb95-186">Blocked Time</span></span>
<span data-ttu-id="3fb95-187">`BLOCKED_TIME` indicates the code is waiting for another resource to be available, such as waiting for a synchronization object, waiting for a thread to be available, or waiting for a request to finish.</span><span class="sxs-lookup"><span data-stu-id="3fb95-187">`BLOCKED_TIME` indicates the code is waiting for another resource to be available, such as waiting for a synchronization object, waiting for a thread to be available, or waiting for a request to finish.</span></span> 

### <a id="cpu"></a><span data-ttu-id="3fb95-188">CPU Time</span><span class="sxs-lookup"><span data-stu-id="3fb95-188">CPU Time</span></span>
<span data-ttu-id="3fb95-189">The CPU is busy executing the instructions.</span><span class="sxs-lookup"><span data-stu-id="3fb95-189">The CPU is busy executing the instructions.</span></span>

### <a id="disk"></a><span data-ttu-id="3fb95-190">Disk Time</span><span class="sxs-lookup"><span data-stu-id="3fb95-190">Disk Time</span></span>
<span data-ttu-id="3fb95-191">The application is performing disk operations.</span><span class="sxs-lookup"><span data-stu-id="3fb95-191">The application is performing disk operations.</span></span>

### <a id="network"></a><span data-ttu-id="3fb95-192">Network Time</span><span class="sxs-lookup"><span data-stu-id="3fb95-192">Network Time</span></span>
<span data-ttu-id="3fb95-193">The application is performing network operations.</span><span class="sxs-lookup"><span data-stu-id="3fb95-193">The application is performing network operations.</span></span>

### <a id="when"></a><span data-ttu-id="3fb95-194">When column</span><span class="sxs-lookup"><span data-stu-id="3fb95-194">When column</span></span>
<span data-ttu-id="3fb95-195">This is a visualization of how the INCLUSIVE samples collected for a node vary over time.</span><span class="sxs-lookup"><span data-stu-id="3fb95-195">This is a visualization of how the INCLUSIVE samples collected for a node vary over time.</span></span> <span data-ttu-id="3fb95-196">The total range of the request is divided into 32 time buckets and the inclusive samples for that node are accumulated into those 32 buckets.</span><span class="sxs-lookup"><span data-stu-id="3fb95-196">The total range of the request is divided into 32 time buckets and the inclusive samples for that node are accumulated into those 32 buckets.</span></span> <span data-ttu-id="3fb95-197">Each bucket is then represented as a bar whose height represents a scaled value.</span><span class="sxs-lookup"><span data-stu-id="3fb95-197">Each bucket is then represented as a bar whose height represents a scaled value.</span></span> <span data-ttu-id="3fb95-198">For nodes marked `CPU_TIME` or `BLOCKED_TIME`, or where there is an obvious relationship of consuming a resource (cpu, disk, thread), the bar represents consuming one of those resources for the period of time of that bucket.</span><span class="sxs-lookup"><span data-stu-id="3fb95-198">For nodes marked `CPU_TIME` or `BLOCKED_TIME`, or where there is an obvious relationship of consuming a resource (cpu, disk, thread), the bar represents consuming one of those resources for the period of time of that bucket.</span></span> <span data-ttu-id="3fb95-199">For these metrics you can get greater than 100% by consuming multiple resources.</span><span class="sxs-lookup"><span data-stu-id="3fb95-199">For these metrics you can get greater than 100% by consuming multiple resources.</span></span> <span data-ttu-id="3fb95-200">For example, if on average you use two CPUs over an interval then you get 200%.</span><span class="sxs-lookup"><span data-stu-id="3fb95-200">For example, if on average you use two CPUs over an interval then you get 200%.</span></span>


## <a id="troubleshooting"></a><span data-ttu-id="3fb95-201">Troubleshooting</span><span class="sxs-lookup"><span data-stu-id="3fb95-201">Troubleshooting</span></span>

### <a name="how-can-i-know-whether-application-insights-profiler-is-running"></a><span data-ttu-id="3fb95-202">How can I know whether Application Insights profiler is running?</span><span class="sxs-lookup"><span data-stu-id="3fb95-202">How can I know whether Application Insights profiler is running?</span></span>

<span data-ttu-id="3fb95-203">The profiler runs as a continuous web job in Web App.</span><span class="sxs-lookup"><span data-stu-id="3fb95-203">The profiler runs as a continuous web job in Web App.</span></span> <span data-ttu-id="3fb95-204">You can open the Web App resource in https://portal.azure.com and check "ApplicationInsightsProfiler" status in the WebJobs blade.</span><span class="sxs-lookup"><span data-stu-id="3fb95-204">You can open the Web App resource in https://portal.azure.com and check "ApplicationInsightsProfiler" status in the WebJobs blade.</span></span> <span data-ttu-id="3fb95-205">If it isn't running, open **Logs** to find out more.</span><span class="sxs-lookup"><span data-stu-id="3fb95-205">If it isn't running, open **Logs** to find out more.</span></span> 

### <a name="why-cant-i-find-any-stack-examples-even-though-the-profiler-is-running"></a><span data-ttu-id="3fb95-206">Why can't I find any stack examples even though the profiler is running?</span><span class="sxs-lookup"><span data-stu-id="3fb95-206">Why can't I find any stack examples even though the profiler is running?</span></span>

<span data-ttu-id="3fb95-207">Here are a few things you can check.</span><span class="sxs-lookup"><span data-stu-id="3fb95-207">Here are a few things you can check.</span></span>

1. <span data-ttu-id="3fb95-208">Make sure your Web App Service Plan is Basic tier and above.</span><span class="sxs-lookup"><span data-stu-id="3fb95-208">Make sure your Web App Service Plan is Basic tier and above.</span></span>
2. <span data-ttu-id="3fb95-209">Make sure your Web App has Application Insights SDK 2.2 Beta and above enabled.</span><span class="sxs-lookup"><span data-stu-id="3fb95-209">Make sure your Web App has Application Insights SDK 2.2 Beta and above enabled.</span></span>
3. <span data-ttu-id="3fb95-210">Make sure your Web App has the APPINSIGHTS_INSTRUMENTATIONKEY setting with the same instrumentation key used by Application Insights SDK.</span><span class="sxs-lookup"><span data-stu-id="3fb95-210">Make sure your Web App has the APPINSIGHTS_INSTRUMENTATIONKEY setting with the same instrumentation key used by Application Insights SDK.</span></span>
4. <span data-ttu-id="3fb95-211">Make sure your Web App is running on .Net Framework 4.6.</span><span class="sxs-lookup"><span data-stu-id="3fb95-211">Make sure your Web App is running on .Net Framework 4.6.</span></span>
5. <span data-ttu-id="3fb95-212">If it's an ASP.NET Core application, please also check [the required dependencies](#aspnetcore).</span><span class="sxs-lookup"><span data-stu-id="3fb95-212">If it's an ASP.NET Core application, please also check [the required dependencies](#aspnetcore).</span></span>

<span data-ttu-id="3fb95-213">After the profiler is started, there is a short warm-up period when the profiler actively collects several performance traces.</span><span class="sxs-lookup"><span data-stu-id="3fb95-213">After the profiler is started, there is a short warm-up period when the profiler actively collects several performance traces.</span></span> <span data-ttu-id="3fb95-214">After that, the profiler collects performance traces for two minutes in every hour.</span><span class="sxs-lookup"><span data-stu-id="3fb95-214">After that, the profiler collects performance traces for two minutes in every hour.</span></span>  

### <a name="i-was-using-azure-service-profiler-what-happened-to-it"></a><span data-ttu-id="3fb95-215">I was using Azure Service Profiler.</span><span class="sxs-lookup"><span data-stu-id="3fb95-215">I was using Azure Service Profiler.</span></span> <span data-ttu-id="3fb95-216">What happened to it?</span><span class="sxs-lookup"><span data-stu-id="3fb95-216">What happened to it?</span></span>  

<span data-ttu-id="3fb95-217">When you enable Application Insights Profiler, Azure Service Profiler agent is disabled.</span><span class="sxs-lookup"><span data-stu-id="3fb95-217">When you enable Application Insights Profiler, Azure Service Profiler agent is disabled.</span></span>

### <a id="double-counting"></a><span data-ttu-id="3fb95-218">Double counting in parallel threads</span><span class="sxs-lookup"><span data-stu-id="3fb95-218">Double counting in parallel threads</span></span>

<span data-ttu-id="3fb95-219">In some cases the total time metric in the stack viewer is more than the actual duration of the request.</span><span class="sxs-lookup"><span data-stu-id="3fb95-219">In some cases the total time metric in the stack viewer is more than the actual duration of the request.</span></span> 

<span data-ttu-id="3fb95-220">This can happen when there are two or more threads associated with a request, operating in parallel.</span><span class="sxs-lookup"><span data-stu-id="3fb95-220">This can happen when there are two or more threads associated with a request, operating in parallel.</span></span> <span data-ttu-id="3fb95-221">The total thread time is then more than the elapsed time.</span><span class="sxs-lookup"><span data-stu-id="3fb95-221">The total thread time is then more than the elapsed time.</span></span> <span data-ttu-id="3fb95-222">In many cases one thread may be waiting on the other to complete.</span><span class="sxs-lookup"><span data-stu-id="3fb95-222">In many cases one thread may be waiting on the other to complete.</span></span> <span data-ttu-id="3fb95-223">The viewer tries to detect this and omit the uninteresting wait, but errs on the side of showing too much rather than omitting what may be critical information.</span><span class="sxs-lookup"><span data-stu-id="3fb95-223">The viewer tries to detect this and omit the uninteresting wait, but errs on the side of showing too much rather than omitting what may be critical information.</span></span>  

<span data-ttu-id="3fb95-224">When you see parallel threads in your traces, you need to determine which threads are waiting so you can determine the critical path for the request.</span><span class="sxs-lookup"><span data-stu-id="3fb95-224">When you see parallel threads in your traces, you need to determine which threads are waiting so you can determine the critical path for the request.</span></span> <span data-ttu-id="3fb95-225">In most cases, the thread that quickly goes into a wait state is simply waiting on the other threads.</span><span class="sxs-lookup"><span data-stu-id="3fb95-225">In most cases, the thread that quickly goes into a wait state is simply waiting on the other threads.</span></span> <span data-ttu-id="3fb95-226">Concentrate on the others and ignore the time in the waiting threads.</span><span class="sxs-lookup"><span data-stu-id="3fb95-226">Concentrate on the others and ignore the time in the waiting threads.</span></span>

### <a id="issue-loading-trace-in-viewer"></a><span data-ttu-id="3fb95-227">No profiling data</span><span class="sxs-lookup"><span data-stu-id="3fb95-227">No profiling data</span></span>

1. <span data-ttu-id="3fb95-228">If the data you are trying to view is older than a couple of weeks, try limiting your time filter and try again.</span><span class="sxs-lookup"><span data-stu-id="3fb95-228">If the data you are trying to view is older than a couple of weeks, try limiting your time filter and try again.</span></span>

2. <span data-ttu-id="3fb95-229">Check that proxies or a firewall have not blocked access to https://gateway.azureserviceprofiler.net.</span><span class="sxs-lookup"><span data-stu-id="3fb95-229">Check that proxies or a firewall have not blocked access to https://gateway.azureserviceprofiler.net.</span></span> 

3. <span data-ttu-id="3fb95-230">Check that the Application Insights instrumentation key you are using in your app is the same as the Application Insights resource you've enabled profiling with.</span><span class="sxs-lookup"><span data-stu-id="3fb95-230">Check that the Application Insights instrumentation key you are using in your app is the same as the Application Insights resource you've enabled profiling with.</span></span> <span data-ttu-id="3fb95-231">The key is usually in ApplicationInsights.config but can also be found in web.config or app.config.</span><span class="sxs-lookup"><span data-stu-id="3fb95-231">The key is usually in ApplicationInsights.config but can also be found in web.config or app.config.</span></span>

### <a name="error-report-in-the-profiling-viewer"></a><span data-ttu-id="3fb95-232">Error report in the profiling viewer</span><span class="sxs-lookup"><span data-stu-id="3fb95-232">Error report in the profiling viewer</span></span>

<span data-ttu-id="3fb95-233">File a support ticket from the portal.</span><span class="sxs-lookup"><span data-stu-id="3fb95-233">File a support ticket from the portal.</span></span> <span data-ttu-id="3fb95-234">Please include the correlation ID from the error message.</span><span class="sxs-lookup"><span data-stu-id="3fb95-234">Please include the correlation ID from the error message.</span></span>


## <a name="manual-installation"></a><span data-ttu-id="3fb95-235">Manual installation</span><span class="sxs-lookup"><span data-stu-id="3fb95-235">Manual installation</span></span>

<span data-ttu-id="3fb95-236">When you configure the profiler, the following updates are made to the Web App's settings.</span><span class="sxs-lookup"><span data-stu-id="3fb95-236">When you configure the profiler, the following updates are made to the Web App's settings.</span></span> <span data-ttu-id="3fb95-237">You can do them yourself manually:</span><span class="sxs-lookup"><span data-stu-id="3fb95-237">You can do them yourself manually:</span></span>

1. <span data-ttu-id="3fb95-238">In the Web app control blade, open Settings.</span><span class="sxs-lookup"><span data-stu-id="3fb95-238">In the Web app control blade, open Settings.</span></span>
2. <span data-ttu-id="3fb95-239">Set ".Net Framework version" to v4.6.</span><span class="sxs-lookup"><span data-stu-id="3fb95-239">Set ".Net Framework version" to v4.6.</span></span>
3. <span data-ttu-id="3fb95-240">Set "Always On" to On.</span><span class="sxs-lookup"><span data-stu-id="3fb95-240">Set "Always On" to On.</span></span>
4. <span data-ttu-id="3fb95-241">Add app setting "__APPINSIGHTS_INSTRUMENTATIONKEY__" and set the value to the same instrumentation key used by the SDK.</span><span class="sxs-lookup"><span data-stu-id="3fb95-241">Add app setting "__APPINSIGHTS_INSTRUMENTATIONKEY__" and set the value to the same instrumentation key used by the SDK.</span></span>
5. <span data-ttu-id="3fb95-242">In **Extensions**, Add "Application Insights Profiler."</span><span class="sxs-lookup"><span data-stu-id="3fb95-242">In **Extensions**, Add "Application Insights Profiler."</span></span> <span data-ttu-id="3fb95-243">It will take 2 or 3 minutes to install.</span><span class="sxs-lookup"><span data-stu-id="3fb95-243">It will take 2 or 3 minutes to install.</span></span>

## <a id="aspnetcore"></a><span data-ttu-id="3fb95-244">ASP.NET Core Support</span><span class="sxs-lookup"><span data-stu-id="3fb95-244">ASP.NET Core Support</span></span>

<span data-ttu-id="3fb95-245">ASP.NET Core application is currently supported on .NET Core runtime.</span><span class="sxs-lookup"><span data-stu-id="3fb95-245">ASP.NET Core application is currently supported on .NET Core runtime.</span></span>

<span data-ttu-id="3fb95-246">The application also needs to include the following components to enable profiling.</span><span class="sxs-lookup"><span data-stu-id="3fb95-246">The application also needs to include the following components to enable profiling.</span></span>

1. [<span data-ttu-id="3fb95-247">Application Insights for ASP.NET Core 2.0</span><span class="sxs-lookup"><span data-stu-id="3fb95-247">Application Insights for ASP.NET Core 2.0</span></span>](https://github.com/Microsoft/ApplicationInsights-aspnetcore/releases/tag/v2.0.0)
2. [<span data-ttu-id="3fb95-248">System.Diagnostics.DiagnosticSource 4.4.0-beta-25022-02</span><span class="sxs-lookup"><span data-stu-id="3fb95-248">System.Diagnostics.DiagnosticSource 4.4.0-beta-25022-02</span></span>](https://dotnet.myget.org/feed/dotnet-core/package/nuget/System.Diagnostics.DiagnosticSource/4.4.0-beta-25022-02)
    * <span data-ttu-id="3fb95-249">In Visual Studio, select menu "Tools -> NuGet Package Manager -> Package Manager Settings".</span><span class="sxs-lookup"><span data-stu-id="3fb95-249">In Visual Studio, select menu "Tools -> NuGet Package Manager -> Package Manager Settings".</span></span>
    * <span data-ttu-id="3fb95-250">In Options dialog, select "NuGet Package Manager -> Package Sources".</span><span class="sxs-lookup"><span data-stu-id="3fb95-250">In Options dialog, select "NuGet Package Manager -> Package Sources".</span></span>
    * <span data-ttu-id="3fb95-251">Click "+" button to add a new package source with Name "DotNet-Core-MyGet" and Value "https://dotnet.myget.org/F/dotnet-core/api/v3/index.json".</span><span class="sxs-lookup"><span data-stu-id="3fb95-251">Click "+" button to add a new package source with Name "DotNet-Core-MyGet" and Value "https://dotnet.myget.org/F/dotnet-core/api/v3/index.json".</span></span>
    * <span data-ttu-id="3fb95-252">Click "Update" button and close Options dialog.</span><span class="sxs-lookup"><span data-stu-id="3fb95-252">Click "Update" button and close Options dialog.</span></span>
    * <span data-ttu-id="3fb95-253">Open Solution Explorer, right-click the ASP.NET Core project and select "Manage NuGet Packages...".</span><span class="sxs-lookup"><span data-stu-id="3fb95-253">Open Solution Explorer, right-click the ASP.NET Core project and select "Manage NuGet Packages...".</span></span>
    * <span data-ttu-id="3fb95-254">Click "Browse" tab, select "Package source: DotNet-Core-MyGet" and check "Include prerelease".</span><span class="sxs-lookup"><span data-stu-id="3fb95-254">Click "Browse" tab, select "Package source: DotNet-Core-MyGet" and check "Include prerelease".</span></span>
    * <span data-ttu-id="3fb95-255">Search "System.Diagnostics.DiagnosticSource" and choose "__4.4.0-beta-25022-02__" to install.</span><span class="sxs-lookup"><span data-stu-id="3fb95-255">Search "System.Diagnostics.DiagnosticSource" and choose "__4.4.0-beta-25022-02__" to install.</span></span>


## <a name="next-steps"></a><span data-ttu-id="3fb95-256">Next steps</span><span class="sxs-lookup"><span data-stu-id="3fb95-256">Next steps</span></span>

* [<span data-ttu-id="3fb95-257">Working with Application Insights in Visual Studio</span><span class="sxs-lookup"><span data-stu-id="3fb95-257">Working with Application Insights in Visual Studio</span></span>](https://docs.microsoft.com/azure/application-insights/app-insights-visual-studio)

[performance-blade]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/application-insights/media/app-insights-profiler/performance-blade.png
[performance-blade-examples]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/application-insights/media/app-insights-profiler/performance-blade-examples.png
[trace-explorer]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/application-insights/media/app-insights-profiler/trace-explorer.png
[trace-explorer-toolbar]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/application-insights/media/app-insights-profiler/trace-explorer-toolbar.png
[trace-explorer-hint-tip]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/application-insights/media/app-insights-profiler/trace-explorer-hint-tip.png
[trace-explorer-hot-path]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/application-insights/media/app-insights-profiler/trace-explorer-hot-path.png






