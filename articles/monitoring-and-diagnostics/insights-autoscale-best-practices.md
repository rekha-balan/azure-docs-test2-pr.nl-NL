---
title: Best practices for autoscale
description: Autoscale patterns in Azure for Web Apps, Virtual Machine Scale sets, and Cloud Services
author: anirudhcavale
services: azure-monitor
ms.service: azure-monitor
ms.topic: conceptual
ms.date: 07/07/2017
ms.author: ancav
ms.component: autoscale
ms.openlocfilehash: e9fc5a4c5d2e23750493cc320dffa380724347fb
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44785127"
---
# <a name="best-practices-for-autoscale"></a><span data-ttu-id="0bc51-103">Best practices for Autoscale</span><span class="sxs-lookup"><span data-stu-id="0bc51-103">Best practices for Autoscale</span></span>
<span data-ttu-id="0bc51-104">This article teaches best practices to autoscale in Azure.</span><span class="sxs-lookup"><span data-stu-id="0bc51-104">This article teaches best practices to autoscale in Azure.</span></span> <span data-ttu-id="0bc51-105">Azure Monitor autoscale applies only to [Virtual Machine Scale Sets](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/), and [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/).</span><span class="sxs-lookup"><span data-stu-id="0bc51-105">Azure Monitor autoscale applies only to [Virtual Machine Scale Sets](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/), and [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/).</span></span> <span data-ttu-id="0bc51-106">Other Azure services use different scaling methods.</span><span class="sxs-lookup"><span data-stu-id="0bc51-106">Other Azure services use different scaling methods.</span></span>

## <a name="autoscale-concepts"></a><span data-ttu-id="0bc51-107">Autoscale concepts</span><span class="sxs-lookup"><span data-stu-id="0bc51-107">Autoscale concepts</span></span>
* <span data-ttu-id="0bc51-108">A resource can have only *one* autoscale setting</span><span class="sxs-lookup"><span data-stu-id="0bc51-108">A resource can have only *one* autoscale setting</span></span>
* <span data-ttu-id="0bc51-109">An autoscale setting can have one or more profiles and each profile can have one or more autoscale rules.</span><span class="sxs-lookup"><span data-stu-id="0bc51-109">An autoscale setting can have one or more profiles and each profile can have one or more autoscale rules.</span></span>
* <span data-ttu-id="0bc51-110">An autoscale setting scales instances horizontally, which is *out* by increasing the instances and *in* by decreasing the number of instances.</span><span class="sxs-lookup"><span data-stu-id="0bc51-110">An autoscale setting scales instances horizontally, which is *out* by increasing the instances and *in* by decreasing the number of instances.</span></span>
  <span data-ttu-id="0bc51-111">An autoscale setting has a maximum, minimum, and default value of instances.</span><span class="sxs-lookup"><span data-stu-id="0bc51-111">An autoscale setting has a maximum, minimum, and default value of instances.</span></span>
* <span data-ttu-id="0bc51-112">An autoscale job always reads the associated metric to scale by, checking if it has crossed the configured threshold for scale-out or scale-in.</span><span class="sxs-lookup"><span data-stu-id="0bc51-112">An autoscale job always reads the associated metric to scale by, checking if it has crossed the configured threshold for scale-out or scale-in.</span></span> <span data-ttu-id="0bc51-113">You can view a list of metrics that autoscale can scale by at [Azure Monitor autoscaling common metrics](insights-autoscale-common-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="0bc51-113">You can view a list of metrics that autoscale can scale by at [Azure Monitor autoscaling common metrics](insights-autoscale-common-metrics.md).</span></span>
* <span data-ttu-id="0bc51-114">All thresholds are calculated at an instance level.</span><span class="sxs-lookup"><span data-stu-id="0bc51-114">All thresholds are calculated at an instance level.</span></span> <span data-ttu-id="0bc51-115">For example, "scale out by 1 instance when average CPU > 80% when instance count is 2", means scale-out when the average CPU across all instances is greater than 80%.</span><span class="sxs-lookup"><span data-stu-id="0bc51-115">For example, "scale out by 1 instance when average CPU > 80% when instance count is 2", means scale-out when the average CPU across all instances is greater than 80%.</span></span>
* <span data-ttu-id="0bc51-116">All autoscale failures are logged to the Activity Log.</span><span class="sxs-lookup"><span data-stu-id="0bc51-116">All autoscale failures are logged to the Activity Log.</span></span> <span data-ttu-id="0bc51-117">You can then configure an [activity log alert](./monitoring-activity-log-alerts.md) so that you can be notified via email, SMS, webhook, etc. whenever there is an autoscale failure.</span><span class="sxs-lookup"><span data-stu-id="0bc51-117">You can then configure an [activity log alert](./monitoring-activity-log-alerts.md) so that you can be notified via email, SMS, webhook, etc. whenever there is an autoscale failure.</span></span>
* <span data-ttu-id="0bc51-118">Similarly, all successful scale actions are posted to the Activity Log.</span><span class="sxs-lookup"><span data-stu-id="0bc51-118">Similarly, all successful scale actions are posted to the Activity Log.</span></span> <span data-ttu-id="0bc51-119">You can then configure an activity log alert so that you can be notified via email, SMS, webhooks, etc. whenever there is a successful autoscale action.</span><span class="sxs-lookup"><span data-stu-id="0bc51-119">You can then configure an activity log alert so that you can be notified via email, SMS, webhooks, etc. whenever there is a successful autoscale action.</span></span> <span data-ttu-id="0bc51-120">You can also configure email or webhook notifications to get notified for successful scale actions via the notifications tab on the autoscale setting.</span><span class="sxs-lookup"><span data-stu-id="0bc51-120">You can also configure email or webhook notifications to get notified for successful scale actions via the notifications tab on the autoscale setting.</span></span>

## <a name="autoscale-best-practices"></a><span data-ttu-id="0bc51-121">Autoscale best practices</span><span class="sxs-lookup"><span data-stu-id="0bc51-121">Autoscale best practices</span></span>
<span data-ttu-id="0bc51-122">Use the following best practices as you use autoscale.</span><span class="sxs-lookup"><span data-stu-id="0bc51-122">Use the following best practices as you use autoscale.</span></span>

### <a name="ensure-the-maximum-and-minimum-values-are-different-and-have-an-adequate-margin-between-them"></a><span data-ttu-id="0bc51-123">Ensure the maximum and minimum values are different and have an adequate margin between them</span><span class="sxs-lookup"><span data-stu-id="0bc51-123">Ensure the maximum and minimum values are different and have an adequate margin between them</span></span>
<span data-ttu-id="0bc51-124">If you have a setting that has minimum=2, maximum=2 and the current instance count is 2, no scale action can occur.</span><span class="sxs-lookup"><span data-stu-id="0bc51-124">If you have a setting that has minimum=2, maximum=2 and the current instance count is 2, no scale action can occur.</span></span> <span data-ttu-id="0bc51-125">Keep an adequate margin between the maximum and minimum instance counts, which are inclusive.</span><span class="sxs-lookup"><span data-stu-id="0bc51-125">Keep an adequate margin between the maximum and minimum instance counts, which are inclusive.</span></span> <span data-ttu-id="0bc51-126">Autoscale always scales between these limits.</span><span class="sxs-lookup"><span data-stu-id="0bc51-126">Autoscale always scales between these limits.</span></span>

### <a name="manual-scaling-is-reset-by-autoscale-min-and-max"></a><span data-ttu-id="0bc51-127">Manual scaling is reset by autoscale min and max</span><span class="sxs-lookup"><span data-stu-id="0bc51-127">Manual scaling is reset by autoscale min and max</span></span>
<span data-ttu-id="0bc51-128">If you manually update the instance count to a value above or below the maximum, the autoscale engine automatically scales back to the minimum (if below) or the maximum (if above).</span><span class="sxs-lookup"><span data-stu-id="0bc51-128">If you manually update the instance count to a value above or below the maximum, the autoscale engine automatically scales back to the minimum (if below) or the maximum (if above).</span></span> <span data-ttu-id="0bc51-129">For example, you set the range between 3 and 6.</span><span class="sxs-lookup"><span data-stu-id="0bc51-129">For example, you set the range between 3 and 6.</span></span> <span data-ttu-id="0bc51-130">If you have one running instance, the autoscale engine scales to 3 instances on its next run.</span><span class="sxs-lookup"><span data-stu-id="0bc51-130">If you have one running instance, the autoscale engine scales to 3 instances on its next run.</span></span> <span data-ttu-id="0bc51-131">Likewise, if you manually set the scale to 8 instances, on the next run autoscale will scale it back to 6 instances on its next run.</span><span class="sxs-lookup"><span data-stu-id="0bc51-131">Likewise, if you manually set the scale to 8 instances, on the next run autoscale will scale it back to 6 instances on its next run.</span></span>  <span data-ttu-id="0bc51-132">Manual scaling is very temporary unless you reset the autoscale rules as well.</span><span class="sxs-lookup"><span data-stu-id="0bc51-132">Manual scaling is very temporary unless you reset the autoscale rules as well.</span></span>

### <a name="always-use-a-scale-out-and-scale-in-rule-combination-that-performs-an-increase-and-decrease"></a><span data-ttu-id="0bc51-133">Always use a scale-out and scale-in rule combination that performs an increase and decrease</span><span class="sxs-lookup"><span data-stu-id="0bc51-133">Always use a scale-out and scale-in rule combination that performs an increase and decrease</span></span>
<span data-ttu-id="0bc51-134">If you use only one part of the combination, autoscale scale-in that single out, or in, until the maximum, or minimum, is reached.</span><span class="sxs-lookup"><span data-stu-id="0bc51-134">If you use only one part of the combination, autoscale scale-in that single out, or in, until the maximum, or minimum, is reached.</span></span>

### <a name="choose-the-appropriate-statistic-for-your-diagnostics-metric"></a><span data-ttu-id="0bc51-135">Choose the appropriate statistic for your diagnostics metric</span><span class="sxs-lookup"><span data-stu-id="0bc51-135">Choose the appropriate statistic for your diagnostics metric</span></span>
<span data-ttu-id="0bc51-136">For diagnostics metrics, you can choose among *Average*, *Minimum*, *Maximum* and *Total* as a metric to scale by.</span><span class="sxs-lookup"><span data-stu-id="0bc51-136">For diagnostics metrics, you can choose among *Average*, *Minimum*, *Maximum* and *Total* as a metric to scale by.</span></span> <span data-ttu-id="0bc51-137">The most common statistic is *Average*.</span><span class="sxs-lookup"><span data-stu-id="0bc51-137">The most common statistic is *Average*.</span></span>

### <a name="choose-the-thresholds-carefully-for-all-metric-types"></a><span data-ttu-id="0bc51-138">Choose the thresholds carefully for all metric types</span><span class="sxs-lookup"><span data-stu-id="0bc51-138">Choose the thresholds carefully for all metric types</span></span>
<span data-ttu-id="0bc51-139">We recommend carefully choosing different thresholds for scale-out and scale-in based on practical situations.</span><span class="sxs-lookup"><span data-stu-id="0bc51-139">We recommend carefully choosing different thresholds for scale-out and scale-in based on practical situations.</span></span>

<span data-ttu-id="0bc51-140">We *do not recommend* autoscale settings like the examples below with the same or very similar threshold values for out and in conditions:</span><span class="sxs-lookup"><span data-stu-id="0bc51-140">We *do not recommend* autoscale settings like the examples below with the same or very similar threshold values for out and in conditions:</span></span>

* <span data-ttu-id="0bc51-141">Increase instances by 1 count when Thread Count <= 600</span><span class="sxs-lookup"><span data-stu-id="0bc51-141">Increase instances by 1 count when Thread Count <= 600</span></span>
* <span data-ttu-id="0bc51-142">Decrease instances by 1 count when Thread Count >= 600</span><span class="sxs-lookup"><span data-stu-id="0bc51-142">Decrease instances by 1 count when Thread Count >= 600</span></span>

<span data-ttu-id="0bc51-143">Let's look at an example of what can lead to a behavior that may seem confusing.</span><span class="sxs-lookup"><span data-stu-id="0bc51-143">Let's look at an example of what can lead to a behavior that may seem confusing.</span></span> <span data-ttu-id="0bc51-144">Consider the following sequence.</span><span class="sxs-lookup"><span data-stu-id="0bc51-144">Consider the following sequence.</span></span>

1. <span data-ttu-id="0bc51-145">Assume there are 2 instances to begin with and then the average number of threads per instance grows to 625.</span><span class="sxs-lookup"><span data-stu-id="0bc51-145">Assume there are 2 instances to begin with and then the average number of threads per instance grows to 625.</span></span>
2. <span data-ttu-id="0bc51-146">Autoscale scales out adding a 3rd instance.</span><span class="sxs-lookup"><span data-stu-id="0bc51-146">Autoscale scales out adding a 3rd instance.</span></span>
3. <span data-ttu-id="0bc51-147">Next, assume that the average thread count across instance falls to 575.</span><span class="sxs-lookup"><span data-stu-id="0bc51-147">Next, assume that the average thread count across instance falls to 575.</span></span>
4. <span data-ttu-id="0bc51-148">Before scaling down, autoscale tries to estimate what the final state will be if it scaled in.</span><span class="sxs-lookup"><span data-stu-id="0bc51-148">Before scaling down, autoscale tries to estimate what the final state will be if it scaled in.</span></span> <span data-ttu-id="0bc51-149">For example, 575 x  3 (current instance count) = 1,725 / 2 (final number of instances when scaled down) = 862.5 threads.</span><span class="sxs-lookup"><span data-stu-id="0bc51-149">For example, 575 x  3 (current instance count) = 1,725 / 2 (final number of instances when scaled down) = 862.5 threads.</span></span> <span data-ttu-id="0bc51-150">This means autoscale would have to immediately scale-out again even after it scaled in, if the average thread count remains the same or even falls only a small amount.</span><span class="sxs-lookup"><span data-stu-id="0bc51-150">This means autoscale would have to immediately scale-out again even after it scaled in, if the average thread count remains the same or even falls only a small amount.</span></span> <span data-ttu-id="0bc51-151">However, if it scaled up again, the whole process would repeat, leading to an infinite loop.</span><span class="sxs-lookup"><span data-stu-id="0bc51-151">However, if it scaled up again, the whole process would repeat, leading to an infinite loop.</span></span>
5. <span data-ttu-id="0bc51-152">To avoid this situation (termed "flapping"), autoscale does not scale down at all.</span><span class="sxs-lookup"><span data-stu-id="0bc51-152">To avoid this situation (termed "flapping"), autoscale does not scale down at all.</span></span> <span data-ttu-id="0bc51-153">Instead, it skips and reevaluates the condition again the next time the service's job executes.</span><span class="sxs-lookup"><span data-stu-id="0bc51-153">Instead, it skips and reevaluates the condition again the next time the service's job executes.</span></span> <span data-ttu-id="0bc51-154">This could confuse many people because autoscale wouldn't appear to work when the average thread count was 575.</span><span class="sxs-lookup"><span data-stu-id="0bc51-154">This could confuse many people because autoscale wouldn't appear to work when the average thread count was 575.</span></span>

<span data-ttu-id="0bc51-155">Estimation during a scale-in is intended to avoid "flapping" situations, where scale-in and scale-out actions continually go back and forth.</span><span class="sxs-lookup"><span data-stu-id="0bc51-155">Estimation during a scale-in is intended to avoid "flapping" situations, where scale-in and scale-out actions continually go back and forth.</span></span> <span data-ttu-id="0bc51-156">Keep this behavior in mind when you choose the same thresholds for scale-out and in.</span><span class="sxs-lookup"><span data-stu-id="0bc51-156">Keep this behavior in mind when you choose the same thresholds for scale-out and in.</span></span>

<span data-ttu-id="0bc51-157">We recommend choosing an adequate margin between the scale-out and in thresholds.</span><span class="sxs-lookup"><span data-stu-id="0bc51-157">We recommend choosing an adequate margin between the scale-out and in thresholds.</span></span> <span data-ttu-id="0bc51-158">As an example, consider the following better rule combination.</span><span class="sxs-lookup"><span data-stu-id="0bc51-158">As an example, consider the following better rule combination.</span></span>

* <span data-ttu-id="0bc51-159">Increase instances by 1 count when CPU%  >= 80</span><span class="sxs-lookup"><span data-stu-id="0bc51-159">Increase instances by 1 count when CPU%  >= 80</span></span>
* <span data-ttu-id="0bc51-160">Decrease instances by 1 count when CPU% <= 60</span><span class="sxs-lookup"><span data-stu-id="0bc51-160">Decrease instances by 1 count when CPU% <= 60</span></span>

<span data-ttu-id="0bc51-161">In this case</span><span class="sxs-lookup"><span data-stu-id="0bc51-161">In this case</span></span>  

1. <span data-ttu-id="0bc51-162">Assume there are 2 instances to start with.</span><span class="sxs-lookup"><span data-stu-id="0bc51-162">Assume there are 2 instances to start with.</span></span>
2. <span data-ttu-id="0bc51-163">If the average CPU% across instances goes to 80, autoscale scales out adding a third instance.</span><span class="sxs-lookup"><span data-stu-id="0bc51-163">If the average CPU% across instances goes to 80, autoscale scales out adding a third instance.</span></span>
3. <span data-ttu-id="0bc51-164">Now assume that over time the CPU% falls to 60.</span><span class="sxs-lookup"><span data-stu-id="0bc51-164">Now assume that over time the CPU% falls to 60.</span></span>
4. <span data-ttu-id="0bc51-165">Autoscale's scale-in rule estimates the final state if it were to scale-in.</span><span class="sxs-lookup"><span data-stu-id="0bc51-165">Autoscale's scale-in rule estimates the final state if it were to scale-in.</span></span> <span data-ttu-id="0bc51-166">For example, 60 x 3 (current instance count) = 180 / 2 (final number of instances when scaled down) = 90.</span><span class="sxs-lookup"><span data-stu-id="0bc51-166">For example, 60 x 3 (current instance count) = 180 / 2 (final number of instances when scaled down) = 90.</span></span> <span data-ttu-id="0bc51-167">So autoscale does not scale-in because it would have to scale-out again immediately.</span><span class="sxs-lookup"><span data-stu-id="0bc51-167">So autoscale does not scale-in because it would have to scale-out again immediately.</span></span> <span data-ttu-id="0bc51-168">Instead, it skips scaling down.</span><span class="sxs-lookup"><span data-stu-id="0bc51-168">Instead, it skips scaling down.</span></span>
5. <span data-ttu-id="0bc51-169">The next time autoscale checks, the CPU continues to fall to 50.</span><span class="sxs-lookup"><span data-stu-id="0bc51-169">The next time autoscale checks, the CPU continues to fall to 50.</span></span> <span data-ttu-id="0bc51-170">It estimates again -  50 x 3 instance = 150 / 2 instances = 75, which is below the scale-out threshold of 80, so it scales in successfully to 2 instances.</span><span class="sxs-lookup"><span data-stu-id="0bc51-170">It estimates again -  50 x 3 instance = 150 / 2 instances = 75, which is below the scale-out threshold of 80, so it scales in successfully to 2 instances.</span></span>

### <a name="considerations-for-scaling-threshold-values-for-special-metrics"></a><span data-ttu-id="0bc51-171">Considerations for scaling threshold values for special metrics</span><span class="sxs-lookup"><span data-stu-id="0bc51-171">Considerations for scaling threshold values for special metrics</span></span>
 <span data-ttu-id="0bc51-172">For special metrics such as Storage or Service Bus Queue length metric, the threshold is the average number of messages available per current number of instances.</span><span class="sxs-lookup"><span data-stu-id="0bc51-172">For special metrics such as Storage or Service Bus Queue length metric, the threshold is the average number of messages available per current number of instances.</span></span> <span data-ttu-id="0bc51-173">Carefully choose the threshold value for this metric.</span><span class="sxs-lookup"><span data-stu-id="0bc51-173">Carefully choose the threshold value for this metric.</span></span>

<span data-ttu-id="0bc51-174">Let's illustrate it with an example to ensure you understand the behavior better.</span><span class="sxs-lookup"><span data-stu-id="0bc51-174">Let's illustrate it with an example to ensure you understand the behavior better.</span></span>

* <span data-ttu-id="0bc51-175">Increase instances by 1 count when Storage Queue message count >= 50</span><span class="sxs-lookup"><span data-stu-id="0bc51-175">Increase instances by 1 count when Storage Queue message count >= 50</span></span>
* <span data-ttu-id="0bc51-176">Decrease instances by 1 count when Storage Queue message count <= 10</span><span class="sxs-lookup"><span data-stu-id="0bc51-176">Decrease instances by 1 count when Storage Queue message count <= 10</span></span>

<span data-ttu-id="0bc51-177">Consider the following sequence:</span><span class="sxs-lookup"><span data-stu-id="0bc51-177">Consider the following sequence:</span></span>

1. <span data-ttu-id="0bc51-178">There are 2 storage queue instances.</span><span class="sxs-lookup"><span data-stu-id="0bc51-178">There are 2 storage queue instances.</span></span>
2. <span data-ttu-id="0bc51-179">Messages keep coming and when you review the storage queue, the total count reads 50.</span><span class="sxs-lookup"><span data-stu-id="0bc51-179">Messages keep coming and when you review the storage queue, the total count reads 50.</span></span> <span data-ttu-id="0bc51-180">You might assume that autoscale should start a scale-out action.</span><span class="sxs-lookup"><span data-stu-id="0bc51-180">You might assume that autoscale should start a scale-out action.</span></span> <span data-ttu-id="0bc51-181">However, note that it is still 50/2 = 25 messages per instance.</span><span class="sxs-lookup"><span data-stu-id="0bc51-181">However, note that it is still 50/2 = 25 messages per instance.</span></span> <span data-ttu-id="0bc51-182">So, scale-out does not occur.</span><span class="sxs-lookup"><span data-stu-id="0bc51-182">So, scale-out does not occur.</span></span> <span data-ttu-id="0bc51-183">For the first scale-out to happen, the total message count in the storage queue should be 100.</span><span class="sxs-lookup"><span data-stu-id="0bc51-183">For the first scale-out to happen, the total message count in the storage queue should be 100.</span></span>
3. <span data-ttu-id="0bc51-184">Next, assume that the total message count reaches 100.</span><span class="sxs-lookup"><span data-stu-id="0bc51-184">Next, assume that the total message count reaches 100.</span></span>
4. <span data-ttu-id="0bc51-185">A 3rd storage queue instance is added due to a scale-out action.</span><span class="sxs-lookup"><span data-stu-id="0bc51-185">A 3rd storage queue instance is added due to a scale-out action.</span></span>  <span data-ttu-id="0bc51-186">The next scale-out action will not happen until the total message count in the queue reaches 150 because 150/3 = 50.</span><span class="sxs-lookup"><span data-stu-id="0bc51-186">The next scale-out action will not happen until the total message count in the queue reaches 150 because 150/3 = 50.</span></span>
5. <span data-ttu-id="0bc51-187">Now the number of messages in the queue gets smaller.</span><span class="sxs-lookup"><span data-stu-id="0bc51-187">Now the number of messages in the queue gets smaller.</span></span> <span data-ttu-id="0bc51-188">With 3 instances, the first scale-in action happens when the total messages in all queues add up to 30 because 30/3 = 10 messages per instance, which is the scale-in threshold.</span><span class="sxs-lookup"><span data-stu-id="0bc51-188">With 3 instances, the first scale-in action happens when the total messages in all queues add up to 30 because 30/3 = 10 messages per instance, which is the scale-in threshold.</span></span>

### <a name="considerations-for-scaling-when-multiple-profiles-are-configured-in-an-autoscale-setting"></a><span data-ttu-id="0bc51-189">Considerations for scaling when multiple profiles are configured in an autoscale setting</span><span class="sxs-lookup"><span data-stu-id="0bc51-189">Considerations for scaling when multiple profiles are configured in an autoscale setting</span></span>
<span data-ttu-id="0bc51-190">In an autoscale setting, you can choose a default profile, which is always applied without any dependency on schedule or time, or you can choose a recurring profile or a profile for a fixed period with a date and time range.</span><span class="sxs-lookup"><span data-stu-id="0bc51-190">In an autoscale setting, you can choose a default profile, which is always applied without any dependency on schedule or time, or you can choose a recurring profile or a profile for a fixed period with a date and time range.</span></span>

<span data-ttu-id="0bc51-191">When autoscale service processes them, it always checks in the following order:</span><span class="sxs-lookup"><span data-stu-id="0bc51-191">When autoscale service processes them, it always checks in the following order:</span></span>

1. <span data-ttu-id="0bc51-192">Fixed Date profile</span><span class="sxs-lookup"><span data-stu-id="0bc51-192">Fixed Date profile</span></span>
2. <span data-ttu-id="0bc51-193">Recurring profile</span><span class="sxs-lookup"><span data-stu-id="0bc51-193">Recurring profile</span></span>
3. <span data-ttu-id="0bc51-194">Default ("Always") profile</span><span class="sxs-lookup"><span data-stu-id="0bc51-194">Default ("Always") profile</span></span>

<span data-ttu-id="0bc51-195">If a profile condition is met, autoscale does not check the next profile condition below it.</span><span class="sxs-lookup"><span data-stu-id="0bc51-195">If a profile condition is met, autoscale does not check the next profile condition below it.</span></span> <span data-ttu-id="0bc51-196">Autoscale only processes one profile at a time.</span><span class="sxs-lookup"><span data-stu-id="0bc51-196">Autoscale only processes one profile at a time.</span></span> <span data-ttu-id="0bc51-197">This means if you want to also include a processing condition from a lower-tier profile, you must include those rules as well in the current profile.</span><span class="sxs-lookup"><span data-stu-id="0bc51-197">This means if you want to also include a processing condition from a lower-tier profile, you must include those rules as well in the current profile.</span></span>

<span data-ttu-id="0bc51-198">Let's review this using an example:</span><span class="sxs-lookup"><span data-stu-id="0bc51-198">Let's review this using an example:</span></span>

<span data-ttu-id="0bc51-199">The image below shows an autoscale setting with a default profile of minimum instances = 2 and maximum instances = 10.</span><span class="sxs-lookup"><span data-stu-id="0bc51-199">The image below shows an autoscale setting with a default profile of minimum instances = 2 and maximum instances = 10.</span></span> <span data-ttu-id="0bc51-200">In this example, rules are configured to scale-out when the message count in the queue is greater than 10 and scale-in when the message count in the queue is less than 3.</span><span class="sxs-lookup"><span data-stu-id="0bc51-200">In this example, rules are configured to scale-out when the message count in the queue is greater than 10 and scale-in when the message count in the queue is less than 3.</span></span> <span data-ttu-id="0bc51-201">So now the resource can scale between 2 and 10 instances.</span><span class="sxs-lookup"><span data-stu-id="0bc51-201">So now the resource can scale between 2 and 10 instances.</span></span>

<span data-ttu-id="0bc51-202">In addition, there is a recurring profile set for Monday.</span><span class="sxs-lookup"><span data-stu-id="0bc51-202">In addition, there is a recurring profile set for Monday.</span></span> <span data-ttu-id="0bc51-203">It is set for minimum instances = 3 and maximum instances = 10.</span><span class="sxs-lookup"><span data-stu-id="0bc51-203">It is set for minimum instances = 3 and maximum instances = 10.</span></span> <span data-ttu-id="0bc51-204">This means on Monday, the first time autoscale checks for this condition, if the instance count is 2, it scales to the new minimum of 3.</span><span class="sxs-lookup"><span data-stu-id="0bc51-204">This means on Monday, the first time autoscale checks for this condition, if the instance count is 2, it scales to the new minimum of 3.</span></span> <span data-ttu-id="0bc51-205">As long as autoscale continues to find this profile condition matched (Monday), it only processes the CPU-based scale-out/in rules configured for this profile.</span><span class="sxs-lookup"><span data-stu-id="0bc51-205">As long as autoscale continues to find this profile condition matched (Monday), it only processes the CPU-based scale-out/in rules configured for this profile.</span></span> <span data-ttu-id="0bc51-206">At this time, it does not check for the queue length.</span><span class="sxs-lookup"><span data-stu-id="0bc51-206">At this time, it does not check for the queue length.</span></span> <span data-ttu-id="0bc51-207">However, if you also want the queue length condition to be checked, you should include those rules from the default profile as well in your Monday profile.</span><span class="sxs-lookup"><span data-stu-id="0bc51-207">However, if you also want the queue length condition to be checked, you should include those rules from the default profile as well in your Monday profile.</span></span>

<span data-ttu-id="0bc51-208">Similarly, when autoscale switches back to the default profile, it first checks if the minimum and maximum conditions are met.</span><span class="sxs-lookup"><span data-stu-id="0bc51-208">Similarly, when autoscale switches back to the default profile, it first checks if the minimum and maximum conditions are met.</span></span> <span data-ttu-id="0bc51-209">If the number of instances at the time is 12, it scales in to 10, the maximum allowed for the default profile.</span><span class="sxs-lookup"><span data-stu-id="0bc51-209">If the number of instances at the time is 12, it scales in to 10, the maximum allowed for the default profile.</span></span>

![autoscale settings](./media/insights-autoscale-best-practices/insights-autoscale-best-practices-2.png)

### <a name="considerations-for-scaling-when-multiple-rules-are-configured-in-a-profile"></a><span data-ttu-id="0bc51-211">Considerations for scaling when multiple rules are configured in a profile</span><span class="sxs-lookup"><span data-stu-id="0bc51-211">Considerations for scaling when multiple rules are configured in a profile</span></span>
<span data-ttu-id="0bc51-212">There are cases where you may have to set multiple rules in a profile.</span><span class="sxs-lookup"><span data-stu-id="0bc51-212">There are cases where you may have to set multiple rules in a profile.</span></span> <span data-ttu-id="0bc51-213">The following set of autoscale rules are used by services use when multiple rules are set.</span><span class="sxs-lookup"><span data-stu-id="0bc51-213">The following set of autoscale rules are used by services use when multiple rules are set.</span></span>

<span data-ttu-id="0bc51-214">On *scale out*, autoscale runs if any rule is met.</span><span class="sxs-lookup"><span data-stu-id="0bc51-214">On *scale out*, autoscale runs if any rule is met.</span></span>
<span data-ttu-id="0bc51-215">On *scale-in*, autoscale require all rules to be met.</span><span class="sxs-lookup"><span data-stu-id="0bc51-215">On *scale-in*, autoscale require all rules to be met.</span></span>

<span data-ttu-id="0bc51-216">To illustrate, assume that you have the following 4 autoscale rules:</span><span class="sxs-lookup"><span data-stu-id="0bc51-216">To illustrate, assume that you have the following 4 autoscale rules:</span></span>

* <span data-ttu-id="0bc51-217">If CPU < 30 %, scale-in by 1</span><span class="sxs-lookup"><span data-stu-id="0bc51-217">If CPU < 30 %, scale-in by 1</span></span>
* <span data-ttu-id="0bc51-218">If Memory < 50%, scale-in by 1</span><span class="sxs-lookup"><span data-stu-id="0bc51-218">If Memory < 50%, scale-in by 1</span></span>
* <span data-ttu-id="0bc51-219">If CPU > 75%, scale-out by 1</span><span class="sxs-lookup"><span data-stu-id="0bc51-219">If CPU > 75%, scale-out by 1</span></span>
* <span data-ttu-id="0bc51-220">If Memory > 75%, scale-out by 1</span><span class="sxs-lookup"><span data-stu-id="0bc51-220">If Memory > 75%, scale-out by 1</span></span>

<span data-ttu-id="0bc51-221">Then the follow occurs:</span><span class="sxs-lookup"><span data-stu-id="0bc51-221">Then the follow occurs:</span></span>

* <span data-ttu-id="0bc51-222">If CPU is 76% and Memory is 50%, we scale-out.</span><span class="sxs-lookup"><span data-stu-id="0bc51-222">If CPU is 76% and Memory is 50%, we scale-out.</span></span>
* <span data-ttu-id="0bc51-223">If CPU is 50% and Memory is 76% we scale-out.</span><span class="sxs-lookup"><span data-stu-id="0bc51-223">If CPU is 50% and Memory is 76% we scale-out.</span></span>

<span data-ttu-id="0bc51-224">On the other hand, if CPU is 25% and memory is 51% autoscale does **not** scale-in.</span><span class="sxs-lookup"><span data-stu-id="0bc51-224">On the other hand, if CPU is 25% and memory is 51% autoscale does **not** scale-in.</span></span> <span data-ttu-id="0bc51-225">In order to scale-in, CPU must be 29% and Memory 49%.</span><span class="sxs-lookup"><span data-stu-id="0bc51-225">In order to scale-in, CPU must be 29% and Memory 49%.</span></span>

### <a name="always-select-a-safe-default-instance-count"></a><span data-ttu-id="0bc51-226">Always select a safe default instance count</span><span class="sxs-lookup"><span data-stu-id="0bc51-226">Always select a safe default instance count</span></span>
<span data-ttu-id="0bc51-227">The default instance count is important autoscale scales your service to that count when metrics are not available.</span><span class="sxs-lookup"><span data-stu-id="0bc51-227">The default instance count is important autoscale scales your service to that count when metrics are not available.</span></span> <span data-ttu-id="0bc51-228">Therefore, select a default instance count that's safe for your workloads.</span><span class="sxs-lookup"><span data-stu-id="0bc51-228">Therefore, select a default instance count that's safe for your workloads.</span></span>

### <a name="configure-autoscale-notifications"></a><span data-ttu-id="0bc51-229">Configure autoscale notifications</span><span class="sxs-lookup"><span data-stu-id="0bc51-229">Configure autoscale notifications</span></span>
<span data-ttu-id="0bc51-230">Autoscale will post to the Activity Log if any of the following conditions occur:</span><span class="sxs-lookup"><span data-stu-id="0bc51-230">Autoscale will post to the Activity Log if any of the following conditions occur:</span></span>

* <span data-ttu-id="0bc51-231">Autoscale issues a scale operation</span><span class="sxs-lookup"><span data-stu-id="0bc51-231">Autoscale issues a scale operation</span></span>
* <span data-ttu-id="0bc51-232">Autoscale service successfully completes a scale action</span><span class="sxs-lookup"><span data-stu-id="0bc51-232">Autoscale service successfully completes a scale action</span></span>
* <span data-ttu-id="0bc51-233">Autoscale service fails to take a scale action.</span><span class="sxs-lookup"><span data-stu-id="0bc51-233">Autoscale service fails to take a scale action.</span></span>
* <span data-ttu-id="0bc51-234">Metrics are not available for autoscale service to make a scale decision.</span><span class="sxs-lookup"><span data-stu-id="0bc51-234">Metrics are not available for autoscale service to make a scale decision.</span></span>
* <span data-ttu-id="0bc51-235">Metrics are available (recovery) again to make a scale decision.</span><span class="sxs-lookup"><span data-stu-id="0bc51-235">Metrics are available (recovery) again to make a scale decision.</span></span>

<span data-ttu-id="0bc51-236">You can also use an Activity Log alert to monitor the health of the autoscale engine.</span><span class="sxs-lookup"><span data-stu-id="0bc51-236">You can also use an Activity Log alert to monitor the health of the autoscale engine.</span></span> <span data-ttu-id="0bc51-237">Here are examples to [create an Activity Log Alert to monitor all autoscale engine operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) or to [create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span><span class="sxs-lookup"><span data-stu-id="0bc51-237">Here are examples to [create an Activity Log Alert to monitor all autoscale engine operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) or to [create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span></span>

<span data-ttu-id="0bc51-238">In addition to using activity log alerts, you can also configure email or webhook notifications to get notified for successful scale actions via the notifications tab on the autoscale setting.</span><span class="sxs-lookup"><span data-stu-id="0bc51-238">In addition to using activity log alerts, you can also configure email or webhook notifications to get notified for successful scale actions via the notifications tab on the autoscale setting.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0bc51-239">Next Steps</span><span class="sxs-lookup"><span data-stu-id="0bc51-239">Next Steps</span></span>
- [<span data-ttu-id="0bc51-240">Create an Activity Log Alert to monitor all autoscale engine operations on your subscription.</span><span class="sxs-lookup"><span data-stu-id="0bc51-240">Create an Activity Log Alert to monitor all autoscale engine operations on your subscription.</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert)
- [<span data-ttu-id="0bc51-241">Create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription</span><span class="sxs-lookup"><span data-stu-id="0bc51-241">Create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert)
