---
title: Device configuration best practices for Azure IoT Hub | Microsoft Docs
description: Learn about best practices for configuring IoT devices at scale
author: chrisgre
ms.author: chrisgre
ms.date: 06/24/2018
ms.topic: conceptual
ms.service: iot-hub
services: iot-hub
ms.openlocfilehash: 571aa5a080ae4622a23fdb20d712327d4ec6fbf9
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44867146"
---
# <a name="best-practices-for-device-configuration-within-an-iot-solution"></a><span data-ttu-id="c004c-103">Best practices for device configuration within an IoT solution</span><span class="sxs-lookup"><span data-stu-id="c004c-103">Best practices for device configuration within an IoT solution</span></span>

<span data-ttu-id="c004c-104">Automatic device management in Azure IoT Hub automates many repetitive and complex tasks of managing large device fleets over the entirety of their lifecycles.</span><span class="sxs-lookup"><span data-stu-id="c004c-104">Automatic device management in Azure IoT Hub automates many repetitive and complex tasks of managing large device fleets over the entirety of their lifecycles.</span></span> <span data-ttu-id="c004c-105">This article defines many of the best practices for the various roles involved in developing and operating an IoT solution.</span><span class="sxs-lookup"><span data-stu-id="c004c-105">This article defines many of the best practices for the various roles involved in developing and operating an IoT solution.</span></span>

* <span data-ttu-id="c004c-106">**IoT hardware manufacturer/integrator:** Manufacturers of IoT hardware, integrators assembling hardware from various manufacturers, or suppliers providing hardware for an IoT deployment manufactured or integrated by other suppliers.</span><span class="sxs-lookup"><span data-stu-id="c004c-106">**IoT hardware manufacturer/integrator:** Manufacturers of IoT hardware, integrators assembling hardware from various manufacturers, or suppliers providing hardware for an IoT deployment manufactured or integrated by other suppliers.</span></span> <span data-ttu-id="c004c-107">Involved in development and integration of firmware, embedded operating systems, and embedded software.</span><span class="sxs-lookup"><span data-stu-id="c004c-107">Involved in development and integration of firmware, embedded operating systems, and embedded software.</span></span>

* <span data-ttu-id="c004c-108">**IoT solution developer:** The development of an IoT solution is typically done by a solution developer.</span><span class="sxs-lookup"><span data-stu-id="c004c-108">**IoT solution developer:** The development of an IoT solution is typically done by a solution developer.</span></span> <span data-ttu-id="c004c-109">This developer may be part of an in-house team or a system integrator specializing in this activity.</span><span class="sxs-lookup"><span data-stu-id="c004c-109">This developer may be part of an in-house team or a system integrator specializing in this activity.</span></span> <span data-ttu-id="c004c-110">The IoT solution developer can develop various components of the IoT solution from scratch, integrate various standard or open-source components, or customize an [IoT solution accelerator](/azure/iot-accelerators/).</span><span class="sxs-lookup"><span data-stu-id="c004c-110">The IoT solution developer can develop various components of the IoT solution from scratch, integrate various standard or open-source components, or customize an [IoT solution accelerator](/azure/iot-accelerators/).</span></span>

* <span data-ttu-id="c004c-111">**IoT solution operator:** After the IoT solution is deployed, it requires long-term operations, monitoring, upgrades, and maintenance.</span><span class="sxs-lookup"><span data-stu-id="c004c-111">**IoT solution operator:** After the IoT solution is deployed, it requires long-term operations, monitoring, upgrades, and maintenance.</span></span> <span data-ttu-id="c004c-112">These tasks can be done by an in-house team that consists of information technology specialists, hardware operations and maintenance teams, and domain specialists who monitor the correct behavior of the overall IoT infrastructure.</span><span class="sxs-lookup"><span data-stu-id="c004c-112">These tasks can be done by an in-house team that consists of information technology specialists, hardware operations and maintenance teams, and domain specialists who monitor the correct behavior of the overall IoT infrastructure.</span></span>

## <a name="understand-automatic-device-management-for-configuring-iot-devices-at-scale"></a><span data-ttu-id="c004c-113">Understand automatic device management for configuring IoT devices at scale</span><span class="sxs-lookup"><span data-stu-id="c004c-113">Understand automatic device management for configuring IoT devices at scale</span></span>

<span data-ttu-id="c004c-114">Automatic device management includes the many benefits of [device twins](iot-hub-devguide-device-twins.md) and [module twins](iot-hub-devguide-module-twins.md) to synchronize desired and reported states between the cloud and devices.</span><span class="sxs-lookup"><span data-stu-id="c004c-114">Automatic device management includes the many benefits of [device twins](iot-hub-devguide-device-twins.md) and [module twins](iot-hub-devguide-module-twins.md) to synchronize desired and reported states between the cloud and devices.</span></span> <span data-ttu-id="c004c-115">[Automatic device configurations][lnk-auto-device-config] automatically update large sets of twins and summerize progress and compliance.</span><span class="sxs-lookup"><span data-stu-id="c004c-115">[Automatic device configurations][lnk-auto-device-config] automatically update large sets of twins and summerize progress and compliance.</span></span> <span data-ttu-id="c004c-116">The following high-level steps describe how automatic device management is developed and used:</span><span class="sxs-lookup"><span data-stu-id="c004c-116">The following high-level steps describe how automatic device management is developed and used:</span></span>

* <span data-ttu-id="c004c-117">The **IoT hardware manufacturer/integrator** implements device management features within an embedded application using [device twins](iot-hub-devguide-device-twins.md).</span><span class="sxs-lookup"><span data-stu-id="c004c-117">The **IoT hardware manufacturer/integrator** implements device management features within an embedded application using [device twins](iot-hub-devguide-device-twins.md).</span></span> <span data-ttu-id="c004c-118">These features could include firmware updates, software installation and update, and settings management.</span><span class="sxs-lookup"><span data-stu-id="c004c-118">These features could include firmware updates, software installation and update, and settings management.</span></span>

* <span data-ttu-id="c004c-119">The **IoT solution developer** implements the management layer of device management operations using [device twins](iot-hub-devguide-device-twins.md) and [automatic device configurations](iot-hub-auto-device-config.md).</span><span class="sxs-lookup"><span data-stu-id="c004c-119">The **IoT solution developer** implements the management layer of device management operations using [device twins](iot-hub-devguide-device-twins.md) and [automatic device configurations](iot-hub-auto-device-config.md).</span></span> <span data-ttu-id="c004c-120">The solution should include defining an operator interface to perform device management tasks.</span><span class="sxs-lookup"><span data-stu-id="c004c-120">The solution should include defining an operator interface to perform device management tasks.</span></span>

* <span data-ttu-id="c004c-121">The **IoT solution operator** uses the IoT solution to perform device management tasks, particularly to group devices together, initiate configuration changes like firmware updates, monitor progress, and troubleshoot issues that arise.</span><span class="sxs-lookup"><span data-stu-id="c004c-121">The **IoT solution operator** uses the IoT solution to perform device management tasks, particularly to group devices together, initiate configuration changes like firmware updates, monitor progress, and troubleshoot issues that arise.</span></span>

## <a name="iot-hardware-manufacturerintegrator"></a><span data-ttu-id="c004c-122">IoT hardware manufacturer/integrator</span><span class="sxs-lookup"><span data-stu-id="c004c-122">IoT hardware manufacturer/integrator</span></span>

<span data-ttu-id="c004c-123">The following are best practices for hardware manufacturers and integrators dealing with embedded software development:</span><span class="sxs-lookup"><span data-stu-id="c004c-123">The following are best practices for hardware manufacturers and integrators dealing with embedded software development:</span></span>

* <span data-ttu-id="c004c-124">**Implement [device twins](iot-hub-devguide-device-twins.md):** Device twins enable synchronizing desired configuration from the cloud and for reporting current configuration and device properties.</span><span class="sxs-lookup"><span data-stu-id="c004c-124">**Implement [device twins](iot-hub-devguide-device-twins.md):** Device twins enable synchronizing desired configuration from the cloud and for reporting current configuration and device properties.</span></span> <span data-ttu-id="c004c-125">The best way to implement device twins within embedded applications is through the [Azure IoT SDKs](https://github.com/Azure/azure-iot-sdks).</span><span class="sxs-lookup"><span data-stu-id="c004c-125">The best way to implement device twins within embedded applications is through the [Azure IoT SDKs](https://github.com/Azure/azure-iot-sdks).</span></span> <span data-ttu-id="c004c-126">Device twins are best suited for configuration because they:</span><span class="sxs-lookup"><span data-stu-id="c004c-126">Device twins are best suited for configuration because they:</span></span>

    * <span data-ttu-id="c004c-127">Support bi-directional communication.</span><span class="sxs-lookup"><span data-stu-id="c004c-127">Support bi-directional communication.</span></span>
    * <span data-ttu-id="c004c-128">Allow for both connected and disconnected device states.</span><span class="sxs-lookup"><span data-stu-id="c004c-128">Allow for both connected and disconnected device states.</span></span>
    * <span data-ttu-id="c004c-129">Follow the principle of eventual consistency.</span><span class="sxs-lookup"><span data-stu-id="c004c-129">Follow the principle of eventual consistency.</span></span>
    * <span data-ttu-id="c004c-130">Are fully queriable in the cloud.</span><span class="sxs-lookup"><span data-stu-id="c004c-130">Are fully queriable in the cloud.</span></span>

* <span data-ttu-id="c004c-131">**Structure the device twin for device management:** The device twin should be structured such that device management properties are logically grouped together into sections.</span><span class="sxs-lookup"><span data-stu-id="c004c-131">**Structure the device twin for device management:** The device twin should be structured such that device management properties are logically grouped together into sections.</span></span> <span data-ttu-id="c004c-132">Doing so will enable configuration changes to be isolated without impacting other sections of the twin.</span><span class="sxs-lookup"><span data-stu-id="c004c-132">Doing so will enable configuration changes to be isolated without impacting other sections of the twin.</span></span> <span data-ttu-id="c004c-133">For example, create a section within desired properties for firmware, another section for software, and a third section for network settings.</span><span class="sxs-lookup"><span data-stu-id="c004c-133">For example, create a section within desired properties for firmware, another section for software, and a third section for network settings.</span></span> 

* <span data-ttu-id="c004c-134">**Report device attributes that are useful for device management:** Attributes like physical device make and model, firmware, operating system, serial number, and other identifiers are useful for reporting and as parameters for targeting configuration changes.</span><span class="sxs-lookup"><span data-stu-id="c004c-134">**Report device attributes that are useful for device management:** Attributes like physical device make and model, firmware, operating system, serial number, and other identifiers are useful for reporting and as parameters for targeting configuration changes.</span></span>

* <span data-ttu-id="c004c-135">**Define the main states for reporting status and progress:** Top-level states should be enumerated so that they can be reported to the operator.</span><span class="sxs-lookup"><span data-stu-id="c004c-135">**Define the main states for reporting status and progress:** Top-level states should be enumerated so that they can be reported to the operator.</span></span> <span data-ttu-id="c004c-136">For example, a firmware update would report status as Current, Downloading, Applying, In Progress, and Error.</span><span class="sxs-lookup"><span data-stu-id="c004c-136">For example, a firmware update would report status as Current, Downloading, Applying, In Progress, and Error.</span></span> <span data-ttu-id="c004c-137">Define additional fields for more information on each state.</span><span class="sxs-lookup"><span data-stu-id="c004c-137">Define additional fields for more information on each state.</span></span>

## <a name="iot-solution-developer"></a><span data-ttu-id="c004c-138">IoT solution developer</span><span class="sxs-lookup"><span data-stu-id="c004c-138">IoT solution developer</span></span>

<span data-ttu-id="c004c-139">The following are best practices for IoT solution developers who are building systems based in Azure:</span><span class="sxs-lookup"><span data-stu-id="c004c-139">The following are best practices for IoT solution developers who are building systems based in Azure:</span></span>

* <span data-ttu-id="c004c-140">**Implement [device twins](iot-hub-devguide-device-twins.md):** Device twins enable synchronizing desired configuration from the cloud and for reporting current configuration and device properties.</span><span class="sxs-lookup"><span data-stu-id="c004c-140">**Implement [device twins](iot-hub-devguide-device-twins.md):** Device twins enable synchronizing desired configuration from the cloud and for reporting current configuration and device properties.</span></span> <span data-ttu-id="c004c-141">The best way to implement device twins within cloud solutions applications is through the [Azure IoT SDKs](https://github.com/Azure/azure-iot-sdks.) Device twins are best suited for configuration because they:</span><span class="sxs-lookup"><span data-stu-id="c004c-141">The best way to implement device twins within cloud solutions applications is through the [Azure IoT SDKs](https://github.com/Azure/azure-iot-sdks.) Device twins are best suited for configuration because they:</span></span>

    * <span data-ttu-id="c004c-142">Support bi-directional communication.</span><span class="sxs-lookup"><span data-stu-id="c004c-142">Support bi-directional communication.</span></span>
    * <span data-ttu-id="c004c-143">Allow for both connected and disconnected device states.</span><span class="sxs-lookup"><span data-stu-id="c004c-143">Allow for both connected and disconnected device states.</span></span> 
    * <span data-ttu-id="c004c-144">Follow the principle of eventual consistency.</span><span class="sxs-lookup"><span data-stu-id="c004c-144">Follow the principle of eventual consistency.</span></span>
    * <span data-ttu-id="c004c-145">Are fully queriable in the cloud.</span><span class="sxs-lookup"><span data-stu-id="c004c-145">Are fully queriable in the cloud.</span></span>

* <span data-ttu-id="c004c-146">**Organize devices using device twin tags:** The solution should allow the operator to define quality rings or other sets of devices based on various deployment strategies such as canary.</span><span class="sxs-lookup"><span data-stu-id="c004c-146">**Organize devices using device twin tags:** The solution should allow the operator to define quality rings or other sets of devices based on various deployment strategies such as canary.</span></span> <span data-ttu-id="c004c-147">Device organization can be implemented within your solution using device twin tags and [queries](iot-hub-devguide-query-language.md).</span><span class="sxs-lookup"><span data-stu-id="c004c-147">Device organization can be implemented within your solution using device twin tags and [queries](iot-hub-devguide-query-language.md).</span></span> <span data-ttu-id="c004c-148">Device organization is necessary to allow for configuration roll outs safely and accurately.</span><span class="sxs-lookup"><span data-stu-id="c004c-148">Device organization is necessary to allow for configuration roll outs safely and accurately.</span></span>

* <span data-ttu-id="c004c-149">**Implement [automatic device configurations](iot-hub-auto-device-config.md):** Automatic device configurations deploy and monitor configuration changes to large sets of IoT devices via device twins.</span><span class="sxs-lookup"><span data-stu-id="c004c-149">**Implement [automatic device configurations](iot-hub-auto-device-config.md):** Automatic device configurations deploy and monitor configuration changes to large sets of IoT devices via device twins.</span></span> <span data-ttu-id="c004c-150">Automatic device configurations target sets of device twins via the **target condition,** which is a query on device twin tags or reported properties.</span><span class="sxs-lookup"><span data-stu-id="c004c-150">Automatic device configurations target sets of device twins via the **target condition,** which is a query on device twin tags or reported properties.</span></span> <span data-ttu-id="c004c-151">The **target content** is the set of desired properties that will be set within the targeted device twins.</span><span class="sxs-lookup"><span data-stu-id="c004c-151">The **target content** is the set of desired properties that will be set within the targeted device twins.</span></span> <span data-ttu-id="c004c-152">The target content should align with the device twin structure defined by the IoT hardware manufacturer/integrator.</span><span class="sxs-lookup"><span data-stu-id="c004c-152">The target content should align with the device twin structure defined by the IoT hardware manufacturer/integrator.</span></span> 

   <span data-ttu-id="c004c-153">The **metrics** are queries on device twin reported properties, and should also align with the device twin structure defined by the IoT hardware manufacturer/integrator.</span><span class="sxs-lookup"><span data-stu-id="c004c-153">The **metrics** are queries on device twin reported properties, and should also align with the device twin structure defined by the IoT hardware manufacturer/integrator.</span></span> <span data-ttu-id="c004c-154">Automatic device configurations also have the benefit of IoT Hub performing device twin operations at a rate that will never exceed the [throttling limits](iot-hub-devguide-quotas-throttling.md) for device twin reads and updates.</span><span class="sxs-lookup"><span data-stu-id="c004c-154">Automatic device configurations also have the benefit of IoT Hub performing device twin operations at a rate that will never exceed the [throttling limits](iot-hub-devguide-quotas-throttling.md) for device twin reads and updates.</span></span>

* <span data-ttu-id="c004c-155">**Use the [Device Provisioning Service](../iot-dps/how-to-manage-enrollments.md):** Solution developers should use the Device Provisioning Service to assign device twin tags to new devices, such that they will be automatically configured by **automatic device configurations** that are targeted at twins with that tag.</span><span class="sxs-lookup"><span data-stu-id="c004c-155">**Use the [Device Provisioning Service](../iot-dps/how-to-manage-enrollments.md):** Solution developers should use the Device Provisioning Service to assign device twin tags to new devices, such that they will be automatically configured by **automatic device configurations** that are targeted at twins with that tag.</span></span> 

## <a name="iot-solution-operator"></a><span data-ttu-id="c004c-156">IoT solution operator</span><span class="sxs-lookup"><span data-stu-id="c004c-156">IoT solution operator</span></span>

<span data-ttu-id="c004c-157">The following are best practices for IoT solution operators who using an IoT solution built on Azure:</span><span class="sxs-lookup"><span data-stu-id="c004c-157">The following are best practices for IoT solution operators who using an IoT solution built on Azure:</span></span>

* <span data-ttu-id="c004c-158">**Organize devices for management:** The IoT solution should define or allow for the creation of quality rings or other sets of devices based on various deployment strategies such as canary.</span><span class="sxs-lookup"><span data-stu-id="c004c-158">**Organize devices for management:** The IoT solution should define or allow for the creation of quality rings or other sets of devices based on various deployment strategies such as canary.</span></span> <span data-ttu-id="c004c-159">The sets of devices will be used to roll out configuration changes and to perform other at-scale device management operations.</span><span class="sxs-lookup"><span data-stu-id="c004c-159">The sets of devices will be used to roll out configuration changes and to perform other at-scale device management operations.</span></span>

* <span data-ttu-id="c004c-160">**Perform configuration changes using a phased roll out:**  A phased roll out is an overall process whereby an operator deploys changes to a broadening set of IoT devices.</span><span class="sxs-lookup"><span data-stu-id="c004c-160">**Perform configuration changes using a phased roll out:**  A phased roll out is an overall process whereby an operator deploys changes to a broadening set of IoT devices.</span></span> <span data-ttu-id="c004c-161">The goal is to make changes gradually to reduce the risk of making wide scale breaking changes.</span><span class="sxs-lookup"><span data-stu-id="c004c-161">The goal is to make changes gradually to reduce the risk of making wide scale breaking changes.</span></span>  <span data-ttu-id="c004c-162">The operator should use the solution's interface to create an [automatic device configuration](iot-hub-auto-device-config.md) and the targeting condition should target an initial set of devices (such as a canary group).</span><span class="sxs-lookup"><span data-stu-id="c004c-162">The operator should use the solution's interface to create an [automatic device configuration](iot-hub-auto-device-config.md) and the targeting condition should target an initial set of devices (such as a canary group).</span></span> <span data-ttu-id="c004c-163">The operator should then validate the configuration change in the initial set of devices.</span><span class="sxs-lookup"><span data-stu-id="c004c-163">The operator should then validate the configuration change in the initial set of devices.</span></span> 

   <span data-ttu-id="c004c-164">Once validation is complete, the operator will update the automatic device configuration to include a larger set of devices.</span><span class="sxs-lookup"><span data-stu-id="c004c-164">Once validation is complete, the operator will update the automatic device configuration to include a larger set of devices.</span></span> <span data-ttu-id="c004c-165">The operator should also set the priority for the configuration to be higher than other configurations currently targeted to those devices.</span><span class="sxs-lookup"><span data-stu-id="c004c-165">The operator should also set the priority for the configuration to be higher than other configurations currently targeted to those devices.</span></span> <span data-ttu-id="c004c-166">The roll out can be monitored using the metrics reported by the automatic device configuration.</span><span class="sxs-lookup"><span data-stu-id="c004c-166">The roll out can be monitored using the metrics reported by the automatic device configuration.</span></span> 

* <span data-ttu-id="c004c-167">**Perform rollbacks in case of errors or misconfigurations:**  An automatic device configuration that causes errors or misconfigurations can be rolled back by changing the **targeting condition** so that the devices no longer meet the targeting condition.</span><span class="sxs-lookup"><span data-stu-id="c004c-167">**Perform rollbacks in case of errors or misconfigurations:**  An automatic device configuration that causes errors or misconfigurations can be rolled back by changing the **targeting condition** so that the devices no longer meet the targeting condition.</span></span> <span data-ttu-id="c004c-168">Ensure that another automatic device configuration of lower priority is still targeted for those devices.</span><span class="sxs-lookup"><span data-stu-id="c004c-168">Ensure that another automatic device configuration of lower priority is still targeted for those devices.</span></span> <span data-ttu-id="c004c-169">Verify that the rollback succeeded by viewing the metrics: The rolled-back configuration should no longer show status for untargeted devices, and the second configuration's metrics should now include counts for the devices that are still targeted.</span><span class="sxs-lookup"><span data-stu-id="c004c-169">Verify that the rollback succeeded by viewing the metrics: The rolled-back configuration should no longer show status for untargeted devices, and the second configuration's metrics should now include counts for the devices that are still targeted.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c004c-170">Next steps</span><span class="sxs-lookup"><span data-stu-id="c004c-170">Next steps</span></span>

* <span data-ttu-id="c004c-171">Learn about implementing device twins in [Understand and use device twins in IoT Hub](iot-hub-devguide-device-twins.md).</span><span class="sxs-lookup"><span data-stu-id="c004c-171">Learn about implementing device twins in [Understand and use device twins in IoT Hub](iot-hub-devguide-device-twins.md).</span></span>

* <span data-ttu-id="c004c-172">Walk through the steps to create, update, or delete an automatic device configuration in [Configure and monitor IoT devices at scale](iot-hub-auto-device-config.md).</span><span class="sxs-lookup"><span data-stu-id="c004c-172">Walk through the steps to create, update, or delete an automatic device configuration in [Configure and monitor IoT devices at scale](iot-hub-auto-device-config.md).</span></span>

* <span data-ttu-id="c004c-173">Implement a firmware update pattern using device twins and automatic device configurations in [Tutorial: Implement a device firmware update process](tutorial-firmware-update.md).</span><span class="sxs-lookup"><span data-stu-id="c004c-173">Implement a firmware update pattern using device twins and automatic device configurations in [Tutorial: Implement a device firmware update process](tutorial-firmware-update.md).</span></span> 
