---
title: Overview of Azure IoT Hub X.509 CA security | Microsoft Docs
description: Overview - how to authenticate devices to IoT Hub using X.509 Certificate Authorities.
author: eustacea
manager: arjmands
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 09/18/2017
ms.author: eustacea
ms.openlocfilehash: 6a9b4fc5479dda58dd024cdf93cbdf4853f9c965
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44867142"
---
# <a name="device-authentication-using-x509-ca-certificates"></a><span data-ttu-id="f7c49-103">Device Authentication using X.509 CA Certificates</span><span class="sxs-lookup"><span data-stu-id="f7c49-103">Device Authentication using X.509 CA Certificates</span></span>

<span data-ttu-id="f7c49-104">This article describes how to use X.509 Certificate Authority (CA) certificates to authenticate devices connecting IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="f7c49-104">This article describes how to use X.509 Certificate Authority (CA) certificates to authenticate devices connecting IoT Hub.</span></span>  <span data-ttu-id="f7c49-105">In this article you will learn:</span><span class="sxs-lookup"><span data-stu-id="f7c49-105">In this article you will learn:</span></span>

* <span data-ttu-id="f7c49-106">How to get an X.509 CA certificate</span><span class="sxs-lookup"><span data-stu-id="f7c49-106">How to get an X.509 CA certificate</span></span>
* <span data-ttu-id="f7c49-107">How to register the X.509 CA certificate to IoT Hub</span><span class="sxs-lookup"><span data-stu-id="f7c49-107">How to register the X.509 CA certificate to IoT Hub</span></span>
* <span data-ttu-id="f7c49-108">How to sign devices using X.509 CA certificates</span><span class="sxs-lookup"><span data-stu-id="f7c49-108">How to sign devices using X.509 CA certificates</span></span>
* <span data-ttu-id="f7c49-109">How devices signed with X.509 CA are authenticated</span><span class="sxs-lookup"><span data-stu-id="f7c49-109">How devices signed with X.509 CA are authenticated</span></span>

## <a name="overview"></a><span data-ttu-id="f7c49-110">Overview</span><span class="sxs-lookup"><span data-stu-id="f7c49-110">Overview</span></span>

<span data-ttu-id="f7c49-111">The X.509 CA feature enables device authentication to IoT Hub using a Certificate Authority (CA).</span><span class="sxs-lookup"><span data-stu-id="f7c49-111">The X.509 CA feature enables device authentication to IoT Hub using a Certificate Authority (CA).</span></span> <span data-ttu-id="f7c49-112">It greatly simplifies initial device enrollment process, and supply chain logistics during device manufacturing.</span><span class="sxs-lookup"><span data-stu-id="f7c49-112">It greatly simplifies initial device enrollment process, and supply chain logistics during device manufacturing.</span></span> <span data-ttu-id="f7c49-113">[Learn more in this scenario article about the value of using X.509 CA certificates](iot-hub-x509ca-concept.md) for device authentication.</span><span class="sxs-lookup"><span data-stu-id="f7c49-113">[Learn more in this scenario article about the value of using X.509 CA certificates](iot-hub-x509ca-concept.md) for device authentication.</span></span>  <span data-ttu-id="f7c49-114">We encourage you to read this scenario article before proceeding as it explains why the steps that follow exist.</span><span class="sxs-lookup"><span data-stu-id="f7c49-114">We encourage you to read this scenario article before proceeding as it explains why the steps that follow exist.</span></span>

## <a name="prerequisite"></a><span data-ttu-id="f7c49-115">Prerequisite</span><span class="sxs-lookup"><span data-stu-id="f7c49-115">Prerequisite</span></span>

<span data-ttu-id="f7c49-116">Using the X.509 CA feature requires that you have an IoT Hub account.</span><span class="sxs-lookup"><span data-stu-id="f7c49-116">Using the X.509 CA feature requires that you have an IoT Hub account.</span></span>  <span data-ttu-id="f7c49-117">[Learn how to create an IoT Hub instance](quickstart-send-telemetry-dotnet.md) if you don't already have one.</span><span class="sxs-lookup"><span data-stu-id="f7c49-117">[Learn how to create an IoT Hub instance](quickstart-send-telemetry-dotnet.md) if you don't already have one.</span></span>

## <a name="how-to-get-an-x509-ca-certificate"></a><span data-ttu-id="f7c49-118">How to get an X.509 CA certificate</span><span class="sxs-lookup"><span data-stu-id="f7c49-118">How to get an X.509 CA certificate</span></span>

<span data-ttu-id="f7c49-119">The X.509 CA certificate is at the top of the chain of certificates for each of your devices.</span><span class="sxs-lookup"><span data-stu-id="f7c49-119">The X.509 CA certificate is at the top of the chain of certificates for each of your devices.</span></span>  <span data-ttu-id="f7c49-120">You may purchase or create one depending on how you intend to use it.</span><span class="sxs-lookup"><span data-stu-id="f7c49-120">You may purchase or create one depending on how you intend to use it.</span></span>

<span data-ttu-id="f7c49-121">For production environment, we recommend that you purchase an X.509 CA certificate from a public root certificate authority.</span><span class="sxs-lookup"><span data-stu-id="f7c49-121">For production environment, we recommend that you purchase an X.509 CA certificate from a public root certificate authority.</span></span> <span data-ttu-id="f7c49-122">Purchasing a CA certificate has the benefit of the root CA acting as a trusted third party to vouch for the legitimacy of your devices.</span><span class="sxs-lookup"><span data-stu-id="f7c49-122">Purchasing a CA certificate has the benefit of the root CA acting as a trusted third party to vouch for the legitimacy of your devices.</span></span> <span data-ttu-id="f7c49-123">Consider this option if you intend your devices to be part of an open IoT network where they are expected to interact with third-party products or services.</span><span class="sxs-lookup"><span data-stu-id="f7c49-123">Consider this option if you intend your devices to be part of an open IoT network where they are expected to interact with third-party products or services.</span></span>

<span data-ttu-id="f7c49-124">You may also create a self-signed X.509 CA for experimentation or for use in closed IoT networks.</span><span class="sxs-lookup"><span data-stu-id="f7c49-124">You may also create a self-signed X.509 CA for experimentation or for use in closed IoT networks.</span></span>

<span data-ttu-id="f7c49-125">Regardless of how you obtain your X.509 CA certificate, make sure to keep it's corresponding private key secret and protected at all times.</span><span class="sxs-lookup"><span data-stu-id="f7c49-125">Regardless of how you obtain your X.509 CA certificate, make sure to keep it's corresponding private key secret and protected at all times.</span></span>  <span data-ttu-id="f7c49-126">This is necessary for trust building trust in the X.509 CA authentication.</span><span class="sxs-lookup"><span data-stu-id="f7c49-126">This is necessary for trust building trust in the X.509 CA authentication.</span></span> 

<span data-ttu-id="f7c49-127">Learn how to [create a self-signed CA certificate](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md), which you can use for experimentation throughout this feature description.</span><span class="sxs-lookup"><span data-stu-id="f7c49-127">Learn how to [create a self-signed CA certificate](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md), which you can use for experimentation throughout this feature description.</span></span>

## <a name="sign-devices-into-the-certificate-chain-of-trust"></a><span data-ttu-id="f7c49-128">Sign devices into the certificate chain of trust</span><span class="sxs-lookup"><span data-stu-id="f7c49-128">Sign devices into the certificate chain of trust</span></span>

<span data-ttu-id="f7c49-129">The owner of an X.509 CA certificate can cryptographically sign an intermediate CA who can in turn sign another intermediate CA, and so on, until the last intermediate CA terminates this process by signing a device.</span><span class="sxs-lookup"><span data-stu-id="f7c49-129">The owner of an X.509 CA certificate can cryptographically sign an intermediate CA who can in turn sign another intermediate CA, and so on, until the last intermediate CA terminates this process by signing a device.</span></span> <span data-ttu-id="f7c49-130">The result is a cascaded chain of certificates known as a certificate chain of trust.</span><span class="sxs-lookup"><span data-stu-id="f7c49-130">The result is a cascaded chain of certificates known as a certificate chain of trust.</span></span> <span data-ttu-id="f7c49-131">In real life this plays out as delegation of trust towards signing devices.</span><span class="sxs-lookup"><span data-stu-id="f7c49-131">In real life this plays out as delegation of trust towards signing devices.</span></span> <span data-ttu-id="f7c49-132">This delegation is important because it establishes a cryptographically variable chain of custody and avoids sharing of signing keys.</span><span class="sxs-lookup"><span data-stu-id="f7c49-132">This delegation is important because it establishes a cryptographically variable chain of custody and avoids sharing of signing keys.</span></span>

![img-generic-cert-chain-of-trust](./media/generic-cert-chain-of-trust.png)

<span data-ttu-id="f7c49-134">Learn here how to [create a certificate chain](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md) as done when signing devices.</span><span class="sxs-lookup"><span data-stu-id="f7c49-134">Learn here how to [create a certificate chain](https://github.com/Azure/azure-iot-sdk-c/blob/master/tools/CACertificates/CACertificateOverview.md) as done when signing devices.</span></span>

## <a name="how-to-register-the-x509-ca-certificate-to-iot-hub"></a><span data-ttu-id="f7c49-135">How to register the X.509 CA certificate to IoT Hub</span><span class="sxs-lookup"><span data-stu-id="f7c49-135">How to register the X.509 CA certificate to IoT Hub</span></span>

<span data-ttu-id="f7c49-136">Register your X.509 CA certificate to IoT Hub where it will be used to authenticate your devices during registration and connection.</span><span class="sxs-lookup"><span data-stu-id="f7c49-136">Register your X.509 CA certificate to IoT Hub where it will be used to authenticate your devices during registration and connection.</span></span>  <span data-ttu-id="f7c49-137">Registering the X.509 CA certificate is a two-step process that comprises certificate file upload and proof of possession.</span><span class="sxs-lookup"><span data-stu-id="f7c49-137">Registering the X.509 CA certificate is a two-step process that comprises certificate file upload and proof of possession.</span></span>

<span data-ttu-id="f7c49-138">The upload process entails uploading a file that contains your certificate.</span><span class="sxs-lookup"><span data-stu-id="f7c49-138">The upload process entails uploading a file that contains your certificate.</span></span>  <span data-ttu-id="f7c49-139">This file should never contain any private keys.</span><span class="sxs-lookup"><span data-stu-id="f7c49-139">This file should never contain any private keys.</span></span>

<span data-ttu-id="f7c49-140">The proof of possession step involves a cryptographic challenge and response process between you and IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="f7c49-140">The proof of possession step involves a cryptographic challenge and response process between you and IoT Hub.</span></span>  <span data-ttu-id="f7c49-141">Given that digital certificate contents are public and therefore susceptible to eavesdropping, IoT Hub would like to ascertain that you really own the CA certificate.</span><span class="sxs-lookup"><span data-stu-id="f7c49-141">Given that digital certificate contents are public and therefore susceptible to eavesdropping, IoT Hub would like to ascertain that you really own the CA certificate.</span></span>  <span data-ttu-id="f7c49-142">It shall do so by generating a random challenge that you must sign with the CA certificate's corresponding private key.</span><span class="sxs-lookup"><span data-stu-id="f7c49-142">It shall do so by generating a random challenge that you must sign with the CA certificate's corresponding private key.</span></span>  <span data-ttu-id="f7c49-143">If you kept the private key secret and protected as earlier advised, then only you will possess the knowledge to complete this step.</span><span class="sxs-lookup"><span data-stu-id="f7c49-143">If you kept the private key secret and protected as earlier advised, then only you will possess the knowledge to complete this step.</span></span> <span data-ttu-id="f7c49-144">Secrecy of private keys is the source of trust in this method.</span><span class="sxs-lookup"><span data-stu-id="f7c49-144">Secrecy of private keys is the source of trust in this method.</span></span>  <span data-ttu-id="f7c49-145">After signing the challenge, complete this step by uploading a file containing the results.</span><span class="sxs-lookup"><span data-stu-id="f7c49-145">After signing the challenge, complete this step by uploading a file containing the results.</span></span>

<span data-ttu-id="f7c49-146">Learn here how to [register your CA certificate](iot-hub-security-x509-get-started.md#registercerts).</span><span class="sxs-lookup"><span data-stu-id="f7c49-146">Learn here how to [register your CA certificate](iot-hub-security-x509-get-started.md#registercerts).</span></span>

## <a name="how-to-create-a-device-on-iot-hub"></a><span data-ttu-id="f7c49-147">How to create a device on IoT Hub</span><span class="sxs-lookup"><span data-stu-id="f7c49-147">How to create a device on IoT Hub</span></span>

<span data-ttu-id="f7c49-148">To preclude device impersonation, IoT Hub requires you to let it know what devices to expect.</span><span class="sxs-lookup"><span data-stu-id="f7c49-148">To preclude device impersonation, IoT Hub requires you to let it know what devices to expect.</span></span>  <span data-ttu-id="f7c49-149">You do this by creating a device entry in the IoT Hub's device registry.</span><span class="sxs-lookup"><span data-stu-id="f7c49-149">You do this by creating a device entry in the IoT Hub's device registry.</span></span>  <span data-ttu-id="f7c49-150">This process is automated when using IoT Hub [Device Provisioning Service](https://azure.microsoft.com/blog/azure-iot-hub-device-provisioning-service-preview-automates-device-connection-configuration/).</span><span class="sxs-lookup"><span data-stu-id="f7c49-150">This process is automated when using IoT Hub [Device Provisioning Service](https://azure.microsoft.com/blog/azure-iot-hub-device-provisioning-service-preview-automates-device-connection-configuration/).</span></span> 

<span data-ttu-id="f7c49-151">Learn here how to [manually create a device in IoT Hub](iot-hub-security-x509-get-started.md#createdevice).</span><span class="sxs-lookup"><span data-stu-id="f7c49-151">Learn here how to [manually create a device in IoT Hub](iot-hub-security-x509-get-started.md#createdevice).</span></span>

## <a name="authenticating-devices-signed-with-x509-ca-certificates"></a><span data-ttu-id="f7c49-152">Authenticating devices signed with X.509 CA certificates</span><span class="sxs-lookup"><span data-stu-id="f7c49-152">Authenticating devices signed with X.509 CA certificates</span></span>

<span data-ttu-id="f7c49-153">With X.509 CA certificate registered and devices signed into a certificate chain of trust, what remains is device authentication when the device connects, even for the first time.</span><span class="sxs-lookup"><span data-stu-id="f7c49-153">With X.509 CA certificate registered and devices signed into a certificate chain of trust, what remains is device authentication when the device connects, even for the first time.</span></span>  <span data-ttu-id="f7c49-154">When an X.509 CA signed device connects, it uploads its certificate chain for validation.</span><span class="sxs-lookup"><span data-stu-id="f7c49-154">When an X.509 CA signed device connects, it uploads its certificate chain for validation.</span></span> <span data-ttu-id="f7c49-155">The chain includes all intermediate CA and device certificates.</span><span class="sxs-lookup"><span data-stu-id="f7c49-155">The chain includes all intermediate CA and device certificates.</span></span>  <span data-ttu-id="f7c49-156">With this information, IoT Hub authenticates the device in a two-step process.</span><span class="sxs-lookup"><span data-stu-id="f7c49-156">With this information, IoT Hub authenticates the device in a two-step process.</span></span>  <span data-ttu-id="f7c49-157">IoT Hub cryptographically validates the certificate chain for internal consistency, and then issues a proof-of-possession challenge to the device.</span><span class="sxs-lookup"><span data-stu-id="f7c49-157">IoT Hub cryptographically validates the certificate chain for internal consistency, and then issues a proof-of-possession challenge to the device.</span></span>  <span data-ttu-id="f7c49-158">IoT Hub declares the device authentic on a successful proof-of-possession response from the device.</span><span class="sxs-lookup"><span data-stu-id="f7c49-158">IoT Hub declares the device authentic on a successful proof-of-possession response from the device.</span></span>  <span data-ttu-id="f7c49-159">This declaration assumes that the device's private key is protected and that only the device can successfully respond to this challenge.</span><span class="sxs-lookup"><span data-stu-id="f7c49-159">This declaration assumes that the device's private key is protected and that only the device can successfully respond to this challenge.</span></span>  <span data-ttu-id="f7c49-160">We recommend use of secure chips like Hardware Secure Modules (HSM) in devices to protect private keys.</span><span class="sxs-lookup"><span data-stu-id="f7c49-160">We recommend use of secure chips like Hardware Secure Modules (HSM) in devices to protect private keys.</span></span>

<span data-ttu-id="f7c49-161">A successful device connection to IoT Hub completes the authentication process and is also indicative of a proper setup.</span><span class="sxs-lookup"><span data-stu-id="f7c49-161">A successful device connection to IoT Hub completes the authentication process and is also indicative of a proper setup.</span></span>

<span data-ttu-id="f7c49-162">Learn here how to [complete this device connection step](iot-hub-security-x509-get-started.md#authenticatedevice).</span><span class="sxs-lookup"><span data-stu-id="f7c49-162">Learn here how to [complete this device connection step](iot-hub-security-x509-get-started.md#authenticatedevice).</span></span>

## <a name="next-steps"></a><span data-ttu-id="f7c49-163">Next Steps</span><span class="sxs-lookup"><span data-stu-id="f7c49-163">Next Steps</span></span>

<span data-ttu-id="f7c49-164">Learn about [the value of X.509 CA authentication](iot-hub-x509ca-concept.md) in IoT.</span><span class="sxs-lookup"><span data-stu-id="f7c49-164">Learn about [the value of X.509 CA authentication](iot-hub-x509ca-concept.md) in IoT.</span></span>

<span data-ttu-id="f7c49-165">Get started with IoT Hub [Device Provisioning Service](https://docs.microsoft.com/azure/iot-dps/).</span><span class="sxs-lookup"><span data-stu-id="f7c49-165">Get started with IoT Hub [Device Provisioning Service](https://docs.microsoft.com/azure/iot-dps/).</span></span>
