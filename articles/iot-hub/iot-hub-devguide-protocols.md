---
title: Azure IoT Hub communication protocols and ports | Microsoft Docs
description: Developer guide - describes the supported communication protocols for device-to-cloud and cloud-to-device communications and the port numbers that must be open.
author: dominicbetts
manager: timlt
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 01/29/2018
ms.author: dobett
ms.openlocfilehash: 0fe3dd719877dac23410ff1ca00d559636a5ed60
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44871521"
---
# <a name="reference---choose-a-communication-protocol"></a><span data-ttu-id="84e12-103">Reference - choose a communication protocol</span><span class="sxs-lookup"><span data-stu-id="84e12-103">Reference - choose a communication protocol</span></span>

<span data-ttu-id="84e12-104">IoT Hub allows devices to use the following protocols for device-side communications:</span><span class="sxs-lookup"><span data-stu-id="84e12-104">IoT Hub allows devices to use the following protocols for device-side communications:</span></span>

* <span data-ttu-id="84e12-105">[MQTT][lnk-mqtt]</span><span class="sxs-lookup"><span data-stu-id="84e12-105">[MQTT][lnk-mqtt]</span></span>
* <span data-ttu-id="84e12-106">MQTT over WebSockets</span><span class="sxs-lookup"><span data-stu-id="84e12-106">MQTT over WebSockets</span></span>
* <span data-ttu-id="84e12-107">[AMQP][lnk-amqp]</span><span class="sxs-lookup"><span data-stu-id="84e12-107">[AMQP][lnk-amqp]</span></span>
* <span data-ttu-id="84e12-108">AMQP over WebSockets</span><span class="sxs-lookup"><span data-stu-id="84e12-108">AMQP over WebSockets</span></span>
* <span data-ttu-id="84e12-109">HTTPS</span><span class="sxs-lookup"><span data-stu-id="84e12-109">HTTPS</span></span>

<span data-ttu-id="84e12-110">For information about how these protocols support specific IoT Hub features, see [Device-to-cloud communications guidance][lnk-d2c-guidance] and [Cloud-to-device communications guidance][lnk-c2d-guidance].</span><span class="sxs-lookup"><span data-stu-id="84e12-110">For information about how these protocols support specific IoT Hub features, see [Device-to-cloud communications guidance][lnk-d2c-guidance] and [Cloud-to-device communications guidance][lnk-c2d-guidance].</span></span>

<span data-ttu-id="84e12-111">The following table provides the high-level recommendations for your choice of protocol:</span><span class="sxs-lookup"><span data-stu-id="84e12-111">The following table provides the high-level recommendations for your choice of protocol:</span></span>

| <span data-ttu-id="84e12-112">Protocol</span><span class="sxs-lookup"><span data-stu-id="84e12-112">Protocol</span></span> | <span data-ttu-id="84e12-113">When you should choose this protocol</span><span class="sxs-lookup"><span data-stu-id="84e12-113">When you should choose this protocol</span></span> |
| --- | --- |
| <span data-ttu-id="84e12-114">MQTT</span><span class="sxs-lookup"><span data-stu-id="84e12-114">MQTT</span></span> <br> <span data-ttu-id="84e12-115">MQTT over WebSocket</span><span class="sxs-lookup"><span data-stu-id="84e12-115">MQTT over WebSocket</span></span> |<span data-ttu-id="84e12-116">Use on all devices that do not require to connect multiple devices (each with its own per-device credentials) over the same TLS connection.</span><span class="sxs-lookup"><span data-stu-id="84e12-116">Use on all devices that do not require to connect multiple devices (each with its own per-device credentials) over the same TLS connection.</span></span> |
| <span data-ttu-id="84e12-117">AMQP</span><span class="sxs-lookup"><span data-stu-id="84e12-117">AMQP</span></span> <br> <span data-ttu-id="84e12-118">AMQP over WebSocket</span><span class="sxs-lookup"><span data-stu-id="84e12-118">AMQP over WebSocket</span></span> |<span data-ttu-id="84e12-119">Use on field and cloud gateways to take advantage of connection multiplexing across devices.</span><span class="sxs-lookup"><span data-stu-id="84e12-119">Use on field and cloud gateways to take advantage of connection multiplexing across devices.</span></span> |
| <span data-ttu-id="84e12-120">HTTPS</span><span class="sxs-lookup"><span data-stu-id="84e12-120">HTTPS</span></span> |<span data-ttu-id="84e12-121">Use for devices that cannot support other protocols.</span><span class="sxs-lookup"><span data-stu-id="84e12-121">Use for devices that cannot support other protocols.</span></span> |

<span data-ttu-id="84e12-122">Consider the following points when you choose your protocol for device-side communications:</span><span class="sxs-lookup"><span data-stu-id="84e12-122">Consider the following points when you choose your protocol for device-side communications:</span></span>

* <span data-ttu-id="84e12-123">**Cloud-to-device pattern**.</span><span class="sxs-lookup"><span data-stu-id="84e12-123">**Cloud-to-device pattern**.</span></span> <span data-ttu-id="84e12-124">HTTPS does not have an efficient way to implement server push.</span><span class="sxs-lookup"><span data-stu-id="84e12-124">HTTPS does not have an efficient way to implement server push.</span></span> <span data-ttu-id="84e12-125">As such, when you are using HTTPS, devices poll IoT Hub for cloud-to-device messages.</span><span class="sxs-lookup"><span data-stu-id="84e12-125">As such, when you are using HTTPS, devices poll IoT Hub for cloud-to-device messages.</span></span> <span data-ttu-id="84e12-126">This approach is inefficient for both the device and IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="84e12-126">This approach is inefficient for both the device and IoT Hub.</span></span> <span data-ttu-id="84e12-127">Under current HTTPS guidelines, each device should poll for messages every 25 minutes or more.</span><span class="sxs-lookup"><span data-stu-id="84e12-127">Under current HTTPS guidelines, each device should poll for messages every 25 minutes or more.</span></span> <span data-ttu-id="84e12-128">MQTT and AMQP support server push when receiving cloud-to-device messages.</span><span class="sxs-lookup"><span data-stu-id="84e12-128">MQTT and AMQP support server push when receiving cloud-to-device messages.</span></span> <span data-ttu-id="84e12-129">They enable immediate pushes of messages from IoT Hub to the device.</span><span class="sxs-lookup"><span data-stu-id="84e12-129">They enable immediate pushes of messages from IoT Hub to the device.</span></span> <span data-ttu-id="84e12-130">If delivery latency is a concern, MQTT or AMQP are the best protocols to use.</span><span class="sxs-lookup"><span data-stu-id="84e12-130">If delivery latency is a concern, MQTT or AMQP are the best protocols to use.</span></span> <span data-ttu-id="84e12-131">For rarely connected devices, HTTPS works as well.</span><span class="sxs-lookup"><span data-stu-id="84e12-131">For rarely connected devices, HTTPS works as well.</span></span>
* <span data-ttu-id="84e12-132">**Field gateways**.</span><span class="sxs-lookup"><span data-stu-id="84e12-132">**Field gateways**.</span></span> <span data-ttu-id="84e12-133">When using MQTT and HTTPS, you cannot connect multiple devices (each with its own per-device credentials) using the same TLS connection.</span><span class="sxs-lookup"><span data-stu-id="84e12-133">When using MQTT and HTTPS, you cannot connect multiple devices (each with its own per-device credentials) using the same TLS connection.</span></span> <span data-ttu-id="84e12-134">For [Field gateway scenarios][lnk-azure-gateway-guidance] that require one TLS connection between the field gateway and IoT Hub for each connected device, these protocols are suboptimal.</span><span class="sxs-lookup"><span data-stu-id="84e12-134">For [Field gateway scenarios][lnk-azure-gateway-guidance] that require one TLS connection between the field gateway and IoT Hub for each connected device, these protocols are suboptimal.</span></span>
* <span data-ttu-id="84e12-135">**Low resource devices**.</span><span class="sxs-lookup"><span data-stu-id="84e12-135">**Low resource devices**.</span></span> <span data-ttu-id="84e12-136">The MQTT and HTTPS libraries have a smaller footprint than the AMQP libraries.</span><span class="sxs-lookup"><span data-stu-id="84e12-136">The MQTT and HTTPS libraries have a smaller footprint than the AMQP libraries.</span></span> <span data-ttu-id="84e12-137">As such, if the device has limited resources (for example, less than 1-MB RAM), these protocols might be the only protocol implementation available.</span><span class="sxs-lookup"><span data-stu-id="84e12-137">As such, if the device has limited resources (for example, less than 1-MB RAM), these protocols might be the only protocol implementation available.</span></span>
* <span data-ttu-id="84e12-138">**Network traversal**.</span><span class="sxs-lookup"><span data-stu-id="84e12-138">**Network traversal**.</span></span> <span data-ttu-id="84e12-139">The standard AMQP protocol uses port 5671, and MQTT listens on port 8883.</span><span class="sxs-lookup"><span data-stu-id="84e12-139">The standard AMQP protocol uses port 5671, and MQTT listens on port 8883.</span></span> <span data-ttu-id="84e12-140">USe of these ports could cause problems in networks that are closed to non-HTTPS protocols.</span><span class="sxs-lookup"><span data-stu-id="84e12-140">USe of these ports could cause problems in networks that are closed to non-HTTPS protocols.</span></span> <span data-ttu-id="84e12-141">Use MQTT over WebSockets, AMQP over WebSockets, or HTTPS in this scenario.</span><span class="sxs-lookup"><span data-stu-id="84e12-141">Use MQTT over WebSockets, AMQP over WebSockets, or HTTPS in this scenario.</span></span>
* <span data-ttu-id="84e12-142">**Payload size**.</span><span class="sxs-lookup"><span data-stu-id="84e12-142">**Payload size**.</span></span> <span data-ttu-id="84e12-143">MQTT and AMQP are binary protocols, which result in more compact payloads than HTTPS.</span><span class="sxs-lookup"><span data-stu-id="84e12-143">MQTT and AMQP are binary protocols, which result in more compact payloads than HTTPS.</span></span>

> [!WARNING]
> <span data-ttu-id="84e12-144">When using HTTPS, each device should poll for cloud-to-device messages every 25 minutes or more.</span><span class="sxs-lookup"><span data-stu-id="84e12-144">When using HTTPS, each device should poll for cloud-to-device messages every 25 minutes or more.</span></span> <span data-ttu-id="84e12-145">However, during development, it is acceptable to poll more frequently than every 25 minutes.</span><span class="sxs-lookup"><span data-stu-id="84e12-145">However, during development, it is acceptable to poll more frequently than every 25 minutes.</span></span>

## <a name="port-numbers"></a><span data-ttu-id="84e12-146">Port numbers</span><span class="sxs-lookup"><span data-stu-id="84e12-146">Port numbers</span></span>

<span data-ttu-id="84e12-147">Devices can communicate with IoT Hub in Azure using various protocols.</span><span class="sxs-lookup"><span data-stu-id="84e12-147">Devices can communicate with IoT Hub in Azure using various protocols.</span></span> <span data-ttu-id="84e12-148">Typically, the choice of protocol is driven by the specific requirements of the solution.</span><span class="sxs-lookup"><span data-stu-id="84e12-148">Typically, the choice of protocol is driven by the specific requirements of the solution.</span></span> <span data-ttu-id="84e12-149">The following table lists the outbound ports that must be open for a device to be able to use a specific protocol:</span><span class="sxs-lookup"><span data-stu-id="84e12-149">The following table lists the outbound ports that must be open for a device to be able to use a specific protocol:</span></span>

| <span data-ttu-id="84e12-150">Protocol</span><span class="sxs-lookup"><span data-stu-id="84e12-150">Protocol</span></span> | <span data-ttu-id="84e12-151">Port</span><span class="sxs-lookup"><span data-stu-id="84e12-151">Port</span></span> |
| --- | --- |
| <span data-ttu-id="84e12-152">MQTT</span><span class="sxs-lookup"><span data-stu-id="84e12-152">MQTT</span></span> |<span data-ttu-id="84e12-153">8883</span><span class="sxs-lookup"><span data-stu-id="84e12-153">8883</span></span> |
| <span data-ttu-id="84e12-154">MQTT over WebSockets</span><span class="sxs-lookup"><span data-stu-id="84e12-154">MQTT over WebSockets</span></span> |<span data-ttu-id="84e12-155">443</span><span class="sxs-lookup"><span data-stu-id="84e12-155">443</span></span> |
| <span data-ttu-id="84e12-156">AMQP</span><span class="sxs-lookup"><span data-stu-id="84e12-156">AMQP</span></span> |<span data-ttu-id="84e12-157">5671</span><span class="sxs-lookup"><span data-stu-id="84e12-157">5671</span></span> |
| <span data-ttu-id="84e12-158">AMQP over WebSockets</span><span class="sxs-lookup"><span data-stu-id="84e12-158">AMQP over WebSockets</span></span> |<span data-ttu-id="84e12-159">443</span><span class="sxs-lookup"><span data-stu-id="84e12-159">443</span></span> |
| <span data-ttu-id="84e12-160">HTTPS</span><span class="sxs-lookup"><span data-stu-id="84e12-160">HTTPS</span></span> |<span data-ttu-id="84e12-161">443</span><span class="sxs-lookup"><span data-stu-id="84e12-161">443</span></span> |

<span data-ttu-id="84e12-162">Once you have created an IoT hub in an Azure region, the IoT hub keeps the same IP address for the lifetime of that IoT hub.</span><span class="sxs-lookup"><span data-stu-id="84e12-162">Once you have created an IoT hub in an Azure region, the IoT hub keeps the same IP address for the lifetime of that IoT hub.</span></span> <span data-ttu-id="84e12-163">However, if Microsoft moves the IoT hub to a different scale unit to maintain quality of service,  then it is assigned a new IP address.</span><span class="sxs-lookup"><span data-stu-id="84e12-163">However, if Microsoft moves the IoT hub to a different scale unit to maintain quality of service,  then it is assigned a new IP address.</span></span>


## <a name="next-steps"></a><span data-ttu-id="84e12-164">Next steps</span><span class="sxs-lookup"><span data-stu-id="84e12-164">Next steps</span></span>

<span data-ttu-id="84e12-165">To learn more about how IoT Hub implements the MQTT protocol, see [Communicate with your IoT hub using the MQTT protocol][lnk-mqtt-support].</span><span class="sxs-lookup"><span data-stu-id="84e12-165">To learn more about how IoT Hub implements the MQTT protocol, see [Communicate with your IoT hub using the MQTT protocol][lnk-mqtt-support].</span></span>

[lnk-d2c-guidance]: iot-hub-devguide-d2c-guidance.md
[lnk-c2d-guidance]: iot-hub-devguide-c2d-guidance.md
[lnk-mqtt-support]: iot-hub-mqtt-support.md
[lnk-amqp]: http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-complete-v1.0-os.pdf
[lnk-mqtt]: http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.pdf
[lnk-azure-gateway-guidance]: iot-hub-devguide-endpoints.md#field-gateways
