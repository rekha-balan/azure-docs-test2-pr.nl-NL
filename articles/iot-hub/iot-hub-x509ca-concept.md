---
title: Concepts of Azure IoT Hub X.509 security | Microsoft Docs
description: Concept - understanding the value X.509 certificate authority certificates in IoT device manufacturing, and authentication .
author: eustacea
manager: arjmands
ms.service: iot-hub
services: iot-hub
ms.topic: conceptual
ms.date: 09/18/2017
ms.author: eustacea
ms.openlocfilehash: 1f7a02f66a8d87f33d7bac9068628dbd29e5bd7c
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44870420"
---
# <a name="conceptual-understanding-of-x509-ca-certificates-in-the-iot-industry"></a><span data-ttu-id="1c846-103">Conceptual understanding of X.509 CA certificates in the IoT industry</span><span class="sxs-lookup"><span data-stu-id="1c846-103">Conceptual understanding of X.509 CA certificates in the IoT industry</span></span>

<span data-ttu-id="1c846-104">This article describes the value of using X.509 certificate authority (CA) certificates in IoT device manufacturing and authentication to IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="1c846-104">This article describes the value of using X.509 certificate authority (CA) certificates in IoT device manufacturing and authentication to IoT Hub.</span></span>  <span data-ttu-id="1c846-105">It includes information about supply chain setup and highlight advantages.</span><span class="sxs-lookup"><span data-stu-id="1c846-105">It includes information about supply chain setup and highlight advantages.</span></span>

<span data-ttu-id="1c846-106">This article describes:</span><span class="sxs-lookup"><span data-stu-id="1c846-106">This article describes:</span></span>

* <span data-ttu-id="1c846-107">What X.509 CA certificates are and how to get them</span><span class="sxs-lookup"><span data-stu-id="1c846-107">What X.509 CA certificates are and how to get them</span></span>
* <span data-ttu-id="1c846-108">How to register your X.509 CA certificate to IoT Hub</span><span class="sxs-lookup"><span data-stu-id="1c846-108">How to register your X.509 CA certificate to IoT Hub</span></span>
* <span data-ttu-id="1c846-109">How to set up a manufacturing supply chain for X.509 CA-based authentication</span><span class="sxs-lookup"><span data-stu-id="1c846-109">How to set up a manufacturing supply chain for X.509 CA-based authentication</span></span>
* <span data-ttu-id="1c846-110">How devices signed with X.509 CA connect to IoT Hub</span><span class="sxs-lookup"><span data-stu-id="1c846-110">How devices signed with X.509 CA connect to IoT Hub</span></span>

## <a name="overview"></a><span data-ttu-id="1c846-111">Overview</span><span class="sxs-lookup"><span data-stu-id="1c846-111">Overview</span></span>

<span data-ttu-id="1c846-112">X.509 Certificate Authority (CA) authentication is an approach for authenticating devices to IoT Hub using a method that dramatically simplifies device identity creation and life-cycle management in the supply chain.</span><span class="sxs-lookup"><span data-stu-id="1c846-112">X.509 Certificate Authority (CA) authentication is an approach for authenticating devices to IoT Hub using a method that dramatically simplifies device identity creation and life-cycle management in the supply chain.</span></span>

<span data-ttu-id="1c846-113">A distinguishing attribute of the X.509 CA authentication is a one-to-many relationship a CA certificate has with its downstream devices.</span><span class="sxs-lookup"><span data-stu-id="1c846-113">A distinguishing attribute of the X.509 CA authentication is a one-to-many relationship a CA certificate has with its downstream devices.</span></span>  <span data-ttu-id="1c846-114">This relationship enables registration of any number of devices into IoT Hub by registering an X.509 CA certificate once, otherwise device unique certificates must be pre-registered for every device before a device can connect.</span><span class="sxs-lookup"><span data-stu-id="1c846-114">This relationship enables registration of any number of devices into IoT Hub by registering an X.509 CA certificate once, otherwise device unique certificates must be pre-registered for every device before a device can connect.</span></span> <span data-ttu-id="1c846-115">This one-to-many relationship also simplifies device certificates life-cycle management operations.</span><span class="sxs-lookup"><span data-stu-id="1c846-115">This one-to-many relationship also simplifies device certificates life-cycle management operations.</span></span>

<span data-ttu-id="1c846-116">Another important attribute of the X.509 CA authentication is simplification of supply chain logistics.</span><span class="sxs-lookup"><span data-stu-id="1c846-116">Another important attribute of the X.509 CA authentication is simplification of supply chain logistics.</span></span>  <span data-ttu-id="1c846-117">Secure authentication of devices requires that each device holds a unique secret like a key as basis for trust.</span><span class="sxs-lookup"><span data-stu-id="1c846-117">Secure authentication of devices requires that each device holds a unique secret like a key as basis for trust.</span></span> <span data-ttu-id="1c846-118">In certificates-based authentication, this secret is a private key.</span><span class="sxs-lookup"><span data-stu-id="1c846-118">In certificates-based authentication, this secret is a private key.</span></span> <span data-ttu-id="1c846-119">A typical device manufacturing flow involves multiple steps and custodians.</span><span class="sxs-lookup"><span data-stu-id="1c846-119">A typical device manufacturing flow involves multiple steps and custodians.</span></span>  <span data-ttu-id="1c846-120">Securely managing device private keys across multiple custodians and maintaining trust is difficult and expensive.</span><span class="sxs-lookup"><span data-stu-id="1c846-120">Securely managing device private keys across multiple custodians and maintaining trust is difficult and expensive.</span></span>  <span data-ttu-id="1c846-121">Using certificate authorities solves this problem by signing each custodian into a cryptographic chain of trust rather than entrusting them with device private keys.</span><span class="sxs-lookup"><span data-stu-id="1c846-121">Using certificate authorities solves this problem by signing each custodian into a cryptographic chain of trust rather than entrusting them with device private keys.</span></span>  <span data-ttu-id="1c846-122">Each custodian in turn signs devices at their respective process step of the manufacturing flow.</span><span class="sxs-lookup"><span data-stu-id="1c846-122">Each custodian in turn signs devices at their respective process step of the manufacturing flow.</span></span>  <span data-ttu-id="1c846-123">The overall result is an optimal supply chain with built-in accountability through use of the cryptographic chain of trust.</span><span class="sxs-lookup"><span data-stu-id="1c846-123">The overall result is an optimal supply chain with built-in accountability through use of the cryptographic chain of trust.</span></span>  <span data-ttu-id="1c846-124">It is worth noting that this process yields the most security when devices protect their unique private keys.</span><span class="sxs-lookup"><span data-stu-id="1c846-124">It is worth noting that this process yields the most security when devices protect their unique private keys.</span></span>  <span data-ttu-id="1c846-125">To this end, we urge the use of Hardware Secure Modules (HSM) capable of internally generating private keys that will never see the light of day.</span><span class="sxs-lookup"><span data-stu-id="1c846-125">To this end, we urge the use of Hardware Secure Modules (HSM) capable of internally generating private keys that will never see the light of day.</span></span>

<span data-ttu-id="1c846-126">This article offers an end-to-end view of using the X.509 CA authentication, from supply chain setup to device connection, while making use of a real world example to solidify understanding.</span><span class="sxs-lookup"><span data-stu-id="1c846-126">This article offers an end-to-end view of using the X.509 CA authentication, from supply chain setup to device connection, while making use of a real world example to solidify understanding.</span></span>

## <a name="introduction"></a><span data-ttu-id="1c846-127">Introduction</span><span class="sxs-lookup"><span data-stu-id="1c846-127">Introduction</span></span>

<span data-ttu-id="1c846-128">The X.509 CA certificate is a digital certificate whose holder can sign other certificates.</span><span class="sxs-lookup"><span data-stu-id="1c846-128">The X.509 CA certificate is a digital certificate whose holder can sign other certificates.</span></span>  <span data-ttu-id="1c846-129">This digital certificate is X.509 because it conforms to a certificate formatting standard prescribed by IETF's RFC 5280 standard, and is a certificate authority (CA) because its holder can sign other certificates.</span><span class="sxs-lookup"><span data-stu-id="1c846-129">This digital certificate is X.509 because it conforms to a certificate formatting standard prescribed by IETF's RFC 5280 standard, and is a certificate authority (CA) because its holder can sign other certificates.</span></span>

<span data-ttu-id="1c846-130">The use of X.509 CA is best understood in relation to a concrete example.</span><span class="sxs-lookup"><span data-stu-id="1c846-130">The use of X.509 CA is best understood in relation to a concrete example.</span></span>  <span data-ttu-id="1c846-131">Consider Company-X, a maker of Smart-X-Widgets designed for professional installation.</span><span class="sxs-lookup"><span data-stu-id="1c846-131">Consider Company-X, a maker of Smart-X-Widgets designed for professional installation.</span></span> <span data-ttu-id="1c846-132">Company-X outsources both manufacturing and installation.</span><span class="sxs-lookup"><span data-stu-id="1c846-132">Company-X outsources both manufacturing and installation.</span></span>  <span data-ttu-id="1c846-133">It contracts manufacturer Factory-Y to manufacture the Smart-X-Widgets, and service provider Technician-Z to install.</span><span class="sxs-lookup"><span data-stu-id="1c846-133">It contracts manufacturer Factory-Y to manufacture the Smart-X-Widgets, and service provider Technician-Z to install.</span></span> <span data-ttu-id="1c846-134">Company-X desires that Smart-X-Widget directly ships from Factory-Y to Technician-Z for installation and that it connects directly to Company-X's instance of IoT Hub after installation without further intervention from Company-X.</span><span class="sxs-lookup"><span data-stu-id="1c846-134">Company-X desires that Smart-X-Widget directly ships from Factory-Y to Technician-Z for installation and that it connects directly to Company-X's instance of IoT Hub after installation without further intervention from Company-X.</span></span> <span data-ttu-id="1c846-135">To make this happen, Company-X need to complete a few one-time setup operations to prime Smart-X-Widget for automatic connection.</span><span class="sxs-lookup"><span data-stu-id="1c846-135">To make this happen, Company-X need to complete a few one-time setup operations to prime Smart-X-Widget for automatic connection.</span></span>  <span data-ttu-id="1c846-136">With the end-to-end scenario in mind, the rest of this article is structured as follows:</span><span class="sxs-lookup"><span data-stu-id="1c846-136">With the end-to-end scenario in mind, the rest of this article is structured as follows:</span></span>

* <span data-ttu-id="1c846-137">Acquire the X.509 CA certificate</span><span class="sxs-lookup"><span data-stu-id="1c846-137">Acquire the X.509 CA certificate</span></span>

* <span data-ttu-id="1c846-138">Register X.509 CA certificate to IoT Hub</span><span class="sxs-lookup"><span data-stu-id="1c846-138">Register X.509 CA certificate to IoT Hub</span></span>

* <span data-ttu-id="1c846-139">Sign devices into a certificate chain of trust</span><span class="sxs-lookup"><span data-stu-id="1c846-139">Sign devices into a certificate chain of trust</span></span>

* <span data-ttu-id="1c846-140">Device connection</span><span class="sxs-lookup"><span data-stu-id="1c846-140">Device connection</span></span>

## <a name="acquire-the-x509-ca-certificate"></a><span data-ttu-id="1c846-141">Acquire the X.509 CA certificate</span><span class="sxs-lookup"><span data-stu-id="1c846-141">Acquire the X.509 CA certificate</span></span>

<span data-ttu-id="1c846-142">Company-X has the option of purchasing an X.509 CA certificate from a public root certificate authority or creating one through a self-signed process.</span><span class="sxs-lookup"><span data-stu-id="1c846-142">Company-X has the option of purchasing an X.509 CA certificate from a public root certificate authority or creating one through a self-signed process.</span></span>  <span data-ttu-id="1c846-143">One option would be optimal over the other depending on the application scenario.</span><span class="sxs-lookup"><span data-stu-id="1c846-143">One option would be optimal over the other depending on the application scenario.</span></span>  <span data-ttu-id="1c846-144">Regardless of the option, the process entails two fundamental steps, generating a public/private key pair and signing the public key into a certificate.</span><span class="sxs-lookup"><span data-stu-id="1c846-144">Regardless of the option, the process entails two fundamental steps, generating a public/private key pair and signing the public key into a certificate.</span></span>

![img-csr-flow](./media/csr-flow.png)

<span data-ttu-id="1c846-146">Details on how to accomplish these steps differ with various service providers.</span><span class="sxs-lookup"><span data-stu-id="1c846-146">Details on how to accomplish these steps differ with various service providers.</span></span>

### <a name="purchasing-an-x509-ca-certificate"></a><span data-ttu-id="1c846-147">Purchasing an X.509 CA certificate</span><span class="sxs-lookup"><span data-stu-id="1c846-147">Purchasing an X.509 CA certificate</span></span>

<span data-ttu-id="1c846-148">Purchasing a CA certificate has the benefit of having a well-known root CA act as a trusted third party to vouch for the legitimacy of IoT devices when the devices connect.</span><span class="sxs-lookup"><span data-stu-id="1c846-148">Purchasing a CA certificate has the benefit of having a well-known root CA act as a trusted third party to vouch for the legitimacy of IoT devices when the devices connect.</span></span> <span data-ttu-id="1c846-149">Company-X would choose this option if they intend Smart-X-Widget to interact with third party products or services after initial connection to IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="1c846-149">Company-X would choose this option if they intend Smart-X-Widget to interact with third party products or services after initial connection to IoT Hub.</span></span>

<span data-ttu-id="1c846-150">To purchase an X.509 CA certificate, Company-X would choose a root certificates services provider.</span><span class="sxs-lookup"><span data-stu-id="1c846-150">To purchase an X.509 CA certificate, Company-X would choose a root certificates services provider.</span></span> <span data-ttu-id="1c846-151">An internet search for the phrase 'Root CA' will yield good leads.</span><span class="sxs-lookup"><span data-stu-id="1c846-151">An internet search for the phrase 'Root CA' will yield good leads.</span></span>  <span data-ttu-id="1c846-152">The root CA will guide Company-X on how to create the public/private key pair and how to generate a Certificate Signing Request (CSR) for their services.</span><span class="sxs-lookup"><span data-stu-id="1c846-152">The root CA will guide Company-X on how to create the public/private key pair and how to generate a Certificate Signing Request (CSR) for their services.</span></span>  <span data-ttu-id="1c846-153">A CSR is the formal process of applying for a certificate from a certificate authority.</span><span class="sxs-lookup"><span data-stu-id="1c846-153">A CSR is the formal process of applying for a certificate from a certificate authority.</span></span>  <span data-ttu-id="1c846-154">The outcome of this purchase is a certificate for use as an authority certificate.</span><span class="sxs-lookup"><span data-stu-id="1c846-154">The outcome of this purchase is a certificate for use as an authority certificate.</span></span>  <span data-ttu-id="1c846-155">Given the ubiquity of X.509 certificates, the certificate is likely to have been properly formatted to IETF's RFC 5280 standard.</span><span class="sxs-lookup"><span data-stu-id="1c846-155">Given the ubiquity of X.509 certificates, the certificate is likely to have been properly formatted to IETF's RFC 5280 standard.</span></span>

### <a name="creating-a-self-signed-x509-ca-certificate"></a><span data-ttu-id="1c846-156">Creating a Self-Signed X.509 CA certificate</span><span class="sxs-lookup"><span data-stu-id="1c846-156">Creating a Self-Signed X.509 CA certificate</span></span>

<span data-ttu-id="1c846-157">The process to create a Self-Signed X.509 CA certificate is similar to purchasing with the exception of involving a third party signer like the root certificate authority.</span><span class="sxs-lookup"><span data-stu-id="1c846-157">The process to create a Self-Signed X.509 CA certificate is similar to purchasing with the exception of involving a third party signer like the root certificate authority.</span></span> <span data-ttu-id="1c846-158">In our example, Company-X will sign its authority certificate instead of a root certificate authority.</span><span class="sxs-lookup"><span data-stu-id="1c846-158">In our example, Company-X will sign its authority certificate instead of a root certificate authority.</span></span>  <span data-ttu-id="1c846-159">Company-X may choose this option for testing until they're ready to purchase an authority certificate.</span><span class="sxs-lookup"><span data-stu-id="1c846-159">Company-X may choose this option for testing until they're ready to purchase an authority certificate.</span></span> <span data-ttu-id="1c846-160">Company-X may also use a self-signed X.509 CA certificate in production, if Smart-X-Widget is not intended to connect to any third party services outside of the IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="1c846-160">Company-X may also use a self-signed X.509 CA certificate in production, if Smart-X-Widget is not intended to connect to any third party services outside of the IoT Hub.</span></span>

## <a name="register-the-x509-certificate-to-iot-hub"></a><span data-ttu-id="1c846-161">Register the X.509 certificate to IoT Hub</span><span class="sxs-lookup"><span data-stu-id="1c846-161">Register the X.509 certificate to IoT Hub</span></span>

<span data-ttu-id="1c846-162">Company-X needs to register the X.509 CA to IoT Hub where it will serve to authenticate Smart-X-Widgets as they connect.</span><span class="sxs-lookup"><span data-stu-id="1c846-162">Company-X needs to register the X.509 CA to IoT Hub where it will serve to authenticate Smart-X-Widgets as they connect.</span></span>  <span data-ttu-id="1c846-163">This is a one-time process that enables the ability to authenticate and manage any number of Smart-X-Widget devices.</span><span class="sxs-lookup"><span data-stu-id="1c846-163">This is a one-time process that enables the ability to authenticate and manage any number of Smart-X-Widget devices.</span></span>  <span data-ttu-id="1c846-164">This process is one-time because of a one-to-many relationship between authority certificate and devices and also constitutes one of the main advantages of using the X.509 CA authentication method.</span><span class="sxs-lookup"><span data-stu-id="1c846-164">This process is one-time because of a one-to-many relationship between authority certificate and devices and also constitutes one of the main advantages of using the X.509 CA authentication method.</span></span>  <span data-ttu-id="1c846-165">The alternative is to upload individual certificate thumbprints for each and every Smart-X-Widget device thereby adding to operational costs.</span><span class="sxs-lookup"><span data-stu-id="1c846-165">The alternative is to upload individual certificate thumbprints for each and every Smart-X-Widget device thereby adding to operational costs.</span></span>

<span data-ttu-id="1c846-166">Registering the X.509 CA certificate is a two-step process, the certificate upload and certificate proof-of-possession.</span><span class="sxs-lookup"><span data-stu-id="1c846-166">Registering the X.509 CA certificate is a two-step process, the certificate upload and certificate proof-of-possession.</span></span>

![img-pop-flow](./media/pop-flow.png)

### <a name="x509-ca-certificate-upload"></a><span data-ttu-id="1c846-168">X.509 CA Certificate Upload</span><span class="sxs-lookup"><span data-stu-id="1c846-168">X.509 CA Certificate Upload</span></span>

<span data-ttu-id="1c846-169">The X.509 CA certificate upload process is just that, upload the CA certificate to IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="1c846-169">The X.509 CA certificate upload process is just that, upload the CA certificate to IoT Hub.</span></span>  <span data-ttu-id="1c846-170">IoT Hub expects the certificate in a file.</span><span class="sxs-lookup"><span data-stu-id="1c846-170">IoT Hub expects the certificate in a file.</span></span> <span data-ttu-id="1c846-171">Company-X simply uploads the certificate file.</span><span class="sxs-lookup"><span data-stu-id="1c846-171">Company-X simply uploads the certificate file.</span></span> <span data-ttu-id="1c846-172">The certificate file MUST NOT under any circumstances contain any private keys.</span><span class="sxs-lookup"><span data-stu-id="1c846-172">The certificate file MUST NOT under any circumstances contain any private keys.</span></span>  <span data-ttu-id="1c846-173">Best practices from standards governing Public Key Infrastructure (PKI) mandates that knowledge of Company-X's private in this case resides exclusively within Company-X.</span><span class="sxs-lookup"><span data-stu-id="1c846-173">Best practices from standards governing Public Key Infrastructure (PKI) mandates that knowledge of Company-X's private in this case resides exclusively within Company-X.</span></span>

### <a name="proof-of-possession-of-the-certificate"></a><span data-ttu-id="1c846-174">Proof-of-Possession of the Certificate</span><span class="sxs-lookup"><span data-stu-id="1c846-174">Proof-of-Possession of the Certificate</span></span>

<span data-ttu-id="1c846-175">The X.509 CA certificate, just like any digital certificate, is public information that is susceptible to eavesdropping.</span><span class="sxs-lookup"><span data-stu-id="1c846-175">The X.509 CA certificate, just like any digital certificate, is public information that is susceptible to eavesdropping.</span></span>  <span data-ttu-id="1c846-176">As such, an eavesdropper may intercept a certificate and try to upload it as their own.</span><span class="sxs-lookup"><span data-stu-id="1c846-176">As such, an eavesdropper may intercept a certificate and try to upload it as their own.</span></span>  <span data-ttu-id="1c846-177">In our example, IoT Hub would like to make sure that the CA certificate Company-X is uploading really belongs to Company-X.</span><span class="sxs-lookup"><span data-stu-id="1c846-177">In our example, IoT Hub would like to make sure that the CA certificate Company-X is uploading really belongs to Company-X.</span></span> <span data-ttu-id="1c846-178">It does so by challenging Company-X to proof that they in fact possess the certificate through a [proof-of-possession (PoP) flow](https://tools.ietf.org/html/rfc5280#section-3.1).</span><span class="sxs-lookup"><span data-stu-id="1c846-178">It does so by challenging Company-X to proof that they in fact possess the certificate through a [proof-of-possession (PoP) flow](https://tools.ietf.org/html/rfc5280#section-3.1).</span></span> <span data-ttu-id="1c846-179">The proof-of-possession flow entails IoT Hub generating a random number to be signed by Company-X using its private key.</span><span class="sxs-lookup"><span data-stu-id="1c846-179">The proof-of-possession flow entails IoT Hub generating a random number to be signed by Company-X using its private key.</span></span>  <span data-ttu-id="1c846-180">If Company-X followed PKI best practices and protected their private key then only they would be in position to correctly respond to the proof-of-possession challenge.</span><span class="sxs-lookup"><span data-stu-id="1c846-180">If Company-X followed PKI best practices and protected their private key then only they would be in position to correctly respond to the proof-of-possession challenge.</span></span>  <span data-ttu-id="1c846-181">IoT Hub proceeds to register the X.509 CA certificate upon a successful response of the proof-of-possession challenge.</span><span class="sxs-lookup"><span data-stu-id="1c846-181">IoT Hub proceeds to register the X.509 CA certificate upon a successful response of the proof-of-possession challenge.</span></span>

<span data-ttu-id="1c846-182">A successful response to the proof-of-possession challenge from IoT Hub completes the X.509 CA registration.</span><span class="sxs-lookup"><span data-stu-id="1c846-182">A successful response to the proof-of-possession challenge from IoT Hub completes the X.509 CA registration.</span></span>

## <a name="sign-devices-into-a-certificate-chain-of-trust"></a><span data-ttu-id="1c846-183">Sign Devices into a Certificate Chain of Trust</span><span class="sxs-lookup"><span data-stu-id="1c846-183">Sign Devices into a Certificate Chain of Trust</span></span>

<span data-ttu-id="1c846-184">IoT requires every device to possess a unique identity.</span><span class="sxs-lookup"><span data-stu-id="1c846-184">IoT requires every device to possess a unique identity.</span></span>  <span data-ttu-id="1c846-185">These identities are in the form certificates for certificate-based authentication schemes.</span><span class="sxs-lookup"><span data-stu-id="1c846-185">These identities are in the form certificates for certificate-based authentication schemes.</span></span>  <span data-ttu-id="1c846-186">In our example, this means every Smart-X-Widget must possess a unique device certificate.</span><span class="sxs-lookup"><span data-stu-id="1c846-186">In our example, this means every Smart-X-Widget must possess a unique device certificate.</span></span>  <span data-ttu-id="1c846-187">How does Company-X setup for this in its supply chain?</span><span class="sxs-lookup"><span data-stu-id="1c846-187">How does Company-X setup for this in its supply chain?</span></span>

<span data-ttu-id="1c846-188">One way to go about this is to pre-generate certificates for Smart-X-Widgets and entrusting knowledge of corresponding unique device private keys with supply chain partners.</span><span class="sxs-lookup"><span data-stu-id="1c846-188">One way to go about this is to pre-generate certificates for Smart-X-Widgets and entrusting knowledge of corresponding unique device private keys with supply chain partners.</span></span>  <span data-ttu-id="1c846-189">For Company-X, this means entrusting Factory-Y and Technician-Z.</span><span class="sxs-lookup"><span data-stu-id="1c846-189">For Company-X, this means entrusting Factory-Y and Technician-Z.</span></span>  <span data-ttu-id="1c846-190">While this is a valid method, it comes with challenges that must be overcome to ensure trust as follows:</span><span class="sxs-lookup"><span data-stu-id="1c846-190">While this is a valid method, it comes with challenges that must be overcome to ensure trust as follows:</span></span>

1. <span data-ttu-id="1c846-191">Having to share device private keys with supply chain partners, besides ignoring PKI best practices of never sharing private keys, makes building trust in the supply chain expensive.</span><span class="sxs-lookup"><span data-stu-id="1c846-191">Having to share device private keys with supply chain partners, besides ignoring PKI best practices of never sharing private keys, makes building trust in the supply chain expensive.</span></span>  <span data-ttu-id="1c846-192">It means capital systems like secure rooms to house device private keys, and processes like periodic security audits need to be installed.</span><span class="sxs-lookup"><span data-stu-id="1c846-192">It means capital systems like secure rooms to house device private keys, and processes like periodic security audits need to be installed.</span></span>  <span data-ttu-id="1c846-193">Both add cost to the supply chain.</span><span class="sxs-lookup"><span data-stu-id="1c846-193">Both add cost to the supply chain.</span></span>

2. <span data-ttu-id="1c846-194">Securely accounting for devices in the supply chain and later managing them in deployment becomes a one-to-one task for every key-to-device pair from the point of device unique certificate (hence private key) generation to device retirement.</span><span class="sxs-lookup"><span data-stu-id="1c846-194">Securely accounting for devices in the supply chain and later managing them in deployment becomes a one-to-one task for every key-to-device pair from the point of device unique certificate (hence private key) generation to device retirement.</span></span> <span data-ttu-id="1c846-195">This precludes group management of devices unless the concept of groups is explicitly built into the process somehow.</span><span class="sxs-lookup"><span data-stu-id="1c846-195">This precludes group management of devices unless the concept of groups is explicitly built into the process somehow.</span></span> <span data-ttu-id="1c846-196">Secure accounting and device life-cycle management, therefore, becomes a heavy operations burden.</span><span class="sxs-lookup"><span data-stu-id="1c846-196">Secure accounting and device life-cycle management, therefore, becomes a heavy operations burden.</span></span>  <span data-ttu-id="1c846-197">In our example, Company-X would bear this burden.</span><span class="sxs-lookup"><span data-stu-id="1c846-197">In our example, Company-X would bear this burden.</span></span>

<span data-ttu-id="1c846-198">X.509 CA certificate authentication offers elegant solutions to afore listed challenges through the use of certificate chains.</span><span class="sxs-lookup"><span data-stu-id="1c846-198">X.509 CA certificate authentication offers elegant solutions to afore listed challenges through the use of certificate chains.</span></span>  <span data-ttu-id="1c846-199">A certificate chain results from a CA signing an intermediate CA that in turn signs another intermediate CA and so goes on until a final intermediate CA signs a device.</span><span class="sxs-lookup"><span data-stu-id="1c846-199">A certificate chain results from a CA signing an intermediate CA that in turn signs another intermediate CA and so goes on until a final intermediate CA signs a device.</span></span>  <span data-ttu-id="1c846-200">In our example, Company-X signs Factory-Y, which in turn signs Technician-Z that finally signs Smart-X-Widget.</span><span class="sxs-lookup"><span data-stu-id="1c846-200">In our example, Company-X signs Factory-Y, which in turn signs Technician-Z that finally signs Smart-X-Widget.</span></span>

![img-cert-chain-hierarchy](./media/cert-chain-hierarchy.png)

<span data-ttu-id="1c846-202">Above cascade of certificates in the chain presents the logical hand-off of authority.</span><span class="sxs-lookup"><span data-stu-id="1c846-202">Above cascade of certificates in the chain presents the logical hand-off of authority.</span></span>  <span data-ttu-id="1c846-203">Many supply chains follow this logical hand-off whereby each intermediate CA gets signed into the chain while receiving all upstream CA certificates, and the last intermediate CA finally signs each device and inject all the authority certificates from the chain into the device.</span><span class="sxs-lookup"><span data-stu-id="1c846-203">Many supply chains follow this logical hand-off whereby each intermediate CA gets signed into the chain while receiving all upstream CA certificates, and the last intermediate CA finally signs each device and inject all the authority certificates from the chain into the device.</span></span> <span data-ttu-id="1c846-204">This is common when the contract manufacturing company with a hierarchy of factories commissions a particular factory to do the manufacturing.</span><span class="sxs-lookup"><span data-stu-id="1c846-204">This is common when the contract manufacturing company with a hierarchy of factories commissions a particular factory to do the manufacturing.</span></span>  <span data-ttu-id="1c846-205">While the hierarchy may be several levels deep (for example, by geography/product type/manufacturing line), only the factory at the end gets to interact with the device but the chain is maintained from the top of the hierarchy.</span><span class="sxs-lookup"><span data-stu-id="1c846-205">While the hierarchy may be several levels deep (for example, by geography/product type/manufacturing line), only the factory at the end gets to interact with the device but the chain is maintained from the top of the hierarchy.</span></span>

<span data-ttu-id="1c846-206">Alternate chains may have different intermediate CA interact with the device in which case the CA interacting with the device injects certificate chain content at that point.</span><span class="sxs-lookup"><span data-stu-id="1c846-206">Alternate chains may have different intermediate CA interact with the device in which case the CA interacting with the device injects certificate chain content at that point.</span></span>  <span data-ttu-id="1c846-207">Hybrid models are also possible where only some of the CA has physical interaction with the device.</span><span class="sxs-lookup"><span data-stu-id="1c846-207">Hybrid models are also possible where only some of the CA has physical interaction with the device.</span></span>

<span data-ttu-id="1c846-208">In our example, both Factory-Y and Technician-Z interact with the Smart-X-Widget.</span><span class="sxs-lookup"><span data-stu-id="1c846-208">In our example, both Factory-Y and Technician-Z interact with the Smart-X-Widget.</span></span>  <span data-ttu-id="1c846-209">While Company-X owns Smart-X-Widget, it actually does not physically interact with it in the entire supply chain.</span><span class="sxs-lookup"><span data-stu-id="1c846-209">While Company-X owns Smart-X-Widget, it actually does not physically interact with it in the entire supply chain.</span></span>  <span data-ttu-id="1c846-210">The certificate chain of trust for Smart-X-Widget therefore comprise Company-X signing Factory-Y which in turn signs Technician-Z that will then provide final signature to Smart-X-Widget.</span><span class="sxs-lookup"><span data-stu-id="1c846-210">The certificate chain of trust for Smart-X-Widget therefore comprise Company-X signing Factory-Y which in turn signs Technician-Z that will then provide final signature to Smart-X-Widget.</span></span> <span data-ttu-id="1c846-211">The manufacture and installation of Smart-X-Widget comprise Factory-Y and Technician-Z using their respective intermediate CA certificates to sign each and every Smart-X-Widgets.</span><span class="sxs-lookup"><span data-stu-id="1c846-211">The manufacture and installation of Smart-X-Widget comprise Factory-Y and Technician-Z using their respective intermediate CA certificates to sign each and every Smart-X-Widgets.</span></span> <span data-ttu-id="1c846-212">The end result of this entire process is Smart-X-Widgets with unique device certificates and certificate chain of trust going up to Company-X CA certificate.</span><span class="sxs-lookup"><span data-stu-id="1c846-212">The end result of this entire process is Smart-X-Widgets with unique device certificates and certificate chain of trust going up to Company-X CA certificate.</span></span>

![img-cert-mfr-chain](./media/cert-mfr-chain.png)

<span data-ttu-id="1c846-214">This is a good point to review the value of the X.509 CA method.</span><span class="sxs-lookup"><span data-stu-id="1c846-214">This is a good point to review the value of the X.509 CA method.</span></span>  <span data-ttu-id="1c846-215">Instead of pre-generating and handing off certificates for every Smart-X-Widget into the supply chain, Company-X only hand to sign Factory-Y once.</span><span class="sxs-lookup"><span data-stu-id="1c846-215">Instead of pre-generating and handing off certificates for every Smart-X-Widget into the supply chain, Company-X only hand to sign Factory-Y once.</span></span>  <span data-ttu-id="1c846-216">Instead of having to track every device throughout the devices life-cycle, Company-X may not track and manage devices through groups that naturally emerge from the supply chain process, for example,  devices installed by Technician-Z after July of some year.</span><span class="sxs-lookup"><span data-stu-id="1c846-216">Instead of having to track every device throughout the devices life-cycle, Company-X may not track and manage devices through groups that naturally emerge from the supply chain process, for example,  devices installed by Technician-Z after July of some year.</span></span>

<span data-ttu-id="1c846-217">Last but not least, the CA method of authentication infuses secure accountability into the device manufacturing supply chain.</span><span class="sxs-lookup"><span data-stu-id="1c846-217">Last but not least, the CA method of authentication infuses secure accountability into the device manufacturing supply chain.</span></span> <span data-ttu-id="1c846-218">Because of the certificate chain process, the actions of every member in the chain is cryptographically recorded and verifiable.</span><span class="sxs-lookup"><span data-stu-id="1c846-218">Because of the certificate chain process, the actions of every member in the chain is cryptographically recorded and verifiable.</span></span>

<span data-ttu-id="1c846-219">This process relies on certain assumptions that must be surfaced for completeness.</span><span class="sxs-lookup"><span data-stu-id="1c846-219">This process relies on certain assumptions that must be surfaced for completeness.</span></span>  <span data-ttu-id="1c846-220">It requires independent creation of device unique public/private key pair and that the private key be protected within the device.</span><span class="sxs-lookup"><span data-stu-id="1c846-220">It requires independent creation of device unique public/private key pair and that the private key be protected within the device.</span></span>  <span data-ttu-id="1c846-221">Fortunately, secure silicon chips in the form of Hardware Secure Modules (HSM) capable of internally generating keys and protecting private keys exist.</span><span class="sxs-lookup"><span data-stu-id="1c846-221">Fortunately, secure silicon chips in the form of Hardware Secure Modules (HSM) capable of internally generating keys and protecting private keys exist.</span></span>  <span data-ttu-id="1c846-222">Company-X only need to add one of such chips into Smart-X-Widget's component bill of materials.</span><span class="sxs-lookup"><span data-stu-id="1c846-222">Company-X only need to add one of such chips into Smart-X-Widget's component bill of materials.</span></span>

## <a name="device-connection"></a><span data-ttu-id="1c846-223">Device Connection</span><span class="sxs-lookup"><span data-stu-id="1c846-223">Device Connection</span></span>

<span data-ttu-id="1c846-224">Previous sections above have been building up to device connection.</span><span class="sxs-lookup"><span data-stu-id="1c846-224">Previous sections above have been building up to device connection.</span></span>  <span data-ttu-id="1c846-225">By simply registering an X.509 CA certificate to IoT Hub one time, how do potentially millions of devices connect and get authenticated from the first time?</span><span class="sxs-lookup"><span data-stu-id="1c846-225">By simply registering an X.509 CA certificate to IoT Hub one time, how do potentially millions of devices connect and get authenticated from the first time?</span></span>  <span data-ttu-id="1c846-226">Simple; through the same certificate upload and proof-of-possession flow we earlier encountered with registering the X.509 CA certificate.</span><span class="sxs-lookup"><span data-stu-id="1c846-226">Simple; through the same certificate upload and proof-of-possession flow we earlier encountered with registering the X.509 CA certificate.</span></span>

<span data-ttu-id="1c846-227">Devices manufactured for X.509 CA authentication are equipped with device unique certificates and a certificate chain from their respective manufacturing supply chain.</span><span class="sxs-lookup"><span data-stu-id="1c846-227">Devices manufactured for X.509 CA authentication are equipped with device unique certificates and a certificate chain from their respective manufacturing supply chain.</span></span>  <span data-ttu-id="1c846-228">Device connection, even for the very first time, happens in a two-step process: certificate chain upload and proof-of-possession.</span><span class="sxs-lookup"><span data-stu-id="1c846-228">Device connection, even for the very first time, happens in a two-step process: certificate chain upload and proof-of-possession.</span></span>

<span data-ttu-id="1c846-229">During the certificate chain upload, the device uploads its device unique certificate together with the certificate chain installed within it to IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="1c846-229">During the certificate chain upload, the device uploads its device unique certificate together with the certificate chain installed within it to IoT Hub.</span></span>  <span data-ttu-id="1c846-230">Using the pre-registered X.509 CA certificate, IoT Hub can cryptographically validate a couple of things, that the uploaded certificate chain is internally consistent, and that the chain was originated by the valid owner of the X.509 CA certificate.</span><span class="sxs-lookup"><span data-stu-id="1c846-230">Using the pre-registered X.509 CA certificate, IoT Hub can cryptographically validate a couple of things, that the uploaded certificate chain is internally consistent, and that the chain was originated by the valid owner of the X.509 CA certificate.</span></span>  <span data-ttu-id="1c846-231">Just was with the X.509 CA registration process, IoT Hub would initiate a proof-of-possession challenge-response process to ascertain that the chain and hence device certificate actually belongs to the device uploading it.</span><span class="sxs-lookup"><span data-stu-id="1c846-231">Just was with the X.509 CA registration process, IoT Hub would initiate a proof-of-possession challenge-response process to ascertain that the chain and hence device certificate actually belongs to the device uploading it.</span></span>  <span data-ttu-id="1c846-232">It does so by generating a random challenge to be signed by the device using its private key for validation by IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="1c846-232">It does so by generating a random challenge to be signed by the device using its private key for validation by IoT Hub.</span></span>   <span data-ttu-id="1c846-233">A successful response triggers IoT Hub to accept the device as authentic and grant it connection.</span><span class="sxs-lookup"><span data-stu-id="1c846-233">A successful response triggers IoT Hub to accept the device as authentic and grant it connection.</span></span>

<span data-ttu-id="1c846-234">In our example, each Smart-X-Widget would upload its device unique certificate together with Factory-Y and Technician-Z X.509 CA certificates and then respond to the proof-of-possession challenge from IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="1c846-234">In our example, each Smart-X-Widget would upload its device unique certificate together with Factory-Y and Technician-Z X.509 CA certificates and then respond to the proof-of-possession challenge from IoT Hub.</span></span>

![img-device-pop-flow](./media/device-pop-flow.png)

<span data-ttu-id="1c846-236">Notice that the foundation of trust rests in protecting private keys including device private keys.</span><span class="sxs-lookup"><span data-stu-id="1c846-236">Notice that the foundation of trust rests in protecting private keys including device private keys.</span></span>  <span data-ttu-id="1c846-237">We therefore cannot stress enough the importance of secure silicon chips in the form of Hardware Secure Modules (HSM) for protecting device private keys, and the overall best practice of never sharing any private keys, like one factory entrusting another with its private key.</span><span class="sxs-lookup"><span data-stu-id="1c846-237">We therefore cannot stress enough the importance of secure silicon chips in the form of Hardware Secure Modules (HSM) for protecting device private keys, and the overall best practice of never sharing any private keys, like one factory entrusting another with its private key.</span></span>

