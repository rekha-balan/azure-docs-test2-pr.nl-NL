---
title: Checkpoints and replay in Durable Functions - Azure
description: Learn how checkpointing and reply works in the Durable Functions extension for Azure Functions.
services: functions
author: cgillum
manager: jeconnoc
keywords: ''
ms.service: azure-functions
ms.devlang: multiple
ms.topic: conceptual
ms.date: 09/29/2017
ms.author: azfuncdf
ms.openlocfilehash: 90860759e8a20bca03d3eb74e4859d0b26d14da1
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44869916"
---
# <a name="checkpoints-and-replay-in-durable-functions-azure-functions"></a><span data-ttu-id="f2721-103">Checkpoints and replay in Durable Functions (Azure Functions)</span><span class="sxs-lookup"><span data-stu-id="f2721-103">Checkpoints and replay in Durable Functions (Azure Functions)</span></span>

<span data-ttu-id="f2721-104">One of the key attributes of Durable Functions is **reliable execution**.</span><span class="sxs-lookup"><span data-stu-id="f2721-104">One of the key attributes of Durable Functions is **reliable execution**.</span></span> <span data-ttu-id="f2721-105">Orchestrator functions and activity functions may be running on different VMs within a data center, and those VMs or the underlying networking infrastructure is not 100% reliable.</span><span class="sxs-lookup"><span data-stu-id="f2721-105">Orchestrator functions and activity functions may be running on different VMs within a data center, and those VMs or the underlying networking infrastructure is not 100% reliable.</span></span>

<span data-ttu-id="f2721-106">In spite of this, Durable Functions ensures reliable execution of orchestrations.</span><span class="sxs-lookup"><span data-stu-id="f2721-106">In spite of this, Durable Functions ensures reliable execution of orchestrations.</span></span> <span data-ttu-id="f2721-107">It does so by using storage queues to drive function invocation and by periodically checkpointing execution history into storage tables (using a cloud design pattern known as [Event Sourcing](https://docs.microsoft.com/azure/architecture/patterns/event-sourcing)).</span><span class="sxs-lookup"><span data-stu-id="f2721-107">It does so by using storage queues to drive function invocation and by periodically checkpointing execution history into storage tables (using a cloud design pattern known as [Event Sourcing](https://docs.microsoft.com/azure/architecture/patterns/event-sourcing)).</span></span> <span data-ttu-id="f2721-108">That history can then be replayed to automatically rebuild the in-memory state of an orchestrator function.</span><span class="sxs-lookup"><span data-stu-id="f2721-108">That history can then be replayed to automatically rebuild the in-memory state of an orchestrator function.</span></span>

## <a name="orchestration-history"></a><span data-ttu-id="f2721-109">Orchestration history</span><span class="sxs-lookup"><span data-stu-id="f2721-109">Orchestration history</span></span>

<span data-ttu-id="f2721-110">Suppose you have the following orchestrator function:</span><span class="sxs-lookup"><span data-stu-id="f2721-110">Suppose you have the following orchestrator function:</span></span>

#### <a name="c"></a><span data-ttu-id="f2721-111">C#</span><span class="sxs-lookup"><span data-stu-id="f2721-111">C#</span></span>

```csharp
[FunctionName("E1_HelloSequence")]
public static async Task<List<string>> Run(
    [OrchestrationTrigger] DurableOrchestrationContext context)
{
    var outputs = new List<string>();

    outputs.Add(await context.CallActivityAsync<string>("E1_SayHello", "Tokyo"));
    outputs.Add(await context.CallActivityAsync<string>("E1_SayHello", "Seattle"));
    outputs.Add(await context.CallActivityAsync<string>("E1_SayHello", "London"));

    // returns ["Hello Tokyo!", "Hello Seattle!", "Hello London!"]
    return outputs;
}
```

#### <a name="javascript-functions-v2-only"></a><span data-ttu-id="f2721-112">JavaScript (Functions v2 only)</span><span class="sxs-lookup"><span data-stu-id="f2721-112">JavaScript (Functions v2 only)</span></span>

```javascript
const df = require("durable-functions");

module.exports = df(function*(context) {
    const output = [];
    output.push(yield context.df.callActivityAsync("E1_SayHello", "Tokyo"));
    output.push(yield context.df.callActivityAsync("E1_SayHello", "Seattle"));
    output.push(yield context.df.callActivityAsync("E1_SayHello", "London"));

    return output;
});
```

<span data-ttu-id="f2721-113">At each `await` (C#) or `yield` (JavaScript) statement, the Durable Task Framework checkpoints the execution state of the function into table storage.</span><span class="sxs-lookup"><span data-stu-id="f2721-113">At each `await` (C#) or `yield` (JavaScript) statement, the Durable Task Framework checkpoints the execution state of the function into table storage.</span></span> <span data-ttu-id="f2721-114">This state is what is referred to as the *orchestration history*.</span><span class="sxs-lookup"><span data-stu-id="f2721-114">This state is what is referred to as the *orchestration history*.</span></span>

## <a name="history-table"></a><span data-ttu-id="f2721-115">History table</span><span class="sxs-lookup"><span data-stu-id="f2721-115">History table</span></span>

<span data-ttu-id="f2721-116">Generally speaking, the Durable Task Framework does the following at each checkpoint:</span><span class="sxs-lookup"><span data-stu-id="f2721-116">Generally speaking, the Durable Task Framework does the following at each checkpoint:</span></span>

1. <span data-ttu-id="f2721-117">Saves execution history into Azure Storage tables.</span><span class="sxs-lookup"><span data-stu-id="f2721-117">Saves execution history into Azure Storage tables.</span></span>
2. <span data-ttu-id="f2721-118">Enqueues messages for functions the orchestrator wants to invoke.</span><span class="sxs-lookup"><span data-stu-id="f2721-118">Enqueues messages for functions the orchestrator wants to invoke.</span></span>
3. <span data-ttu-id="f2721-119">Enqueues messages for the orchestrator itself &mdash; for example, durable timer messages.</span><span class="sxs-lookup"><span data-stu-id="f2721-119">Enqueues messages for the orchestrator itself &mdash; for example, durable timer messages.</span></span>

<span data-ttu-id="f2721-120">Once the checkpoint is complete, the orchestrator function is free to be removed from memory until there is more work for it to do.</span><span class="sxs-lookup"><span data-stu-id="f2721-120">Once the checkpoint is complete, the orchestrator function is free to be removed from memory until there is more work for it to do.</span></span>

> [!NOTE]
> <span data-ttu-id="f2721-121">Azure Storage does not provide any transactional guarantees between saving data into table storage and queues.</span><span class="sxs-lookup"><span data-stu-id="f2721-121">Azure Storage does not provide any transactional guarantees between saving data into table storage and queues.</span></span> <span data-ttu-id="f2721-122">To handle failures, the Durable Functions storage provider uses *eventual consistency* patterns.</span><span class="sxs-lookup"><span data-stu-id="f2721-122">To handle failures, the Durable Functions storage provider uses *eventual consistency* patterns.</span></span> <span data-ttu-id="f2721-123">These patterns ensure that no data is lost if there is a crash or loss of connectivity in the middle of a checkpoint.</span><span class="sxs-lookup"><span data-stu-id="f2721-123">These patterns ensure that no data is lost if there is a crash or loss of connectivity in the middle of a checkpoint.</span></span>

<span data-ttu-id="f2721-124">Upon completion, the history of the function shown earlier looks something like the following in Azure Table Storage (abbreviated for illustration purposes):</span><span class="sxs-lookup"><span data-stu-id="f2721-124">Upon completion, the history of the function shown earlier looks something like the following in Azure Table Storage (abbreviated for illustration purposes):</span></span>

| <span data-ttu-id="f2721-125">PartitionKey (InstanceId)</span><span class="sxs-lookup"><span data-stu-id="f2721-125">PartitionKey (InstanceId)</span></span>                     | <span data-ttu-id="f2721-126">EventType</span><span class="sxs-lookup"><span data-stu-id="f2721-126">EventType</span></span>             | <span data-ttu-id="f2721-127">Timestamp</span><span class="sxs-lookup"><span data-stu-id="f2721-127">Timestamp</span></span>               | <span data-ttu-id="f2721-128">Input</span><span class="sxs-lookup"><span data-stu-id="f2721-128">Input</span></span> | <span data-ttu-id="f2721-129">Name</span><span class="sxs-lookup"><span data-stu-id="f2721-129">Name</span></span>             | <span data-ttu-id="f2721-130">Result</span><span class="sxs-lookup"><span data-stu-id="f2721-130">Result</span></span>                                                    | <span data-ttu-id="f2721-131">Status</span><span class="sxs-lookup"><span data-stu-id="f2721-131">Status</span></span> | 
|----------------------------------|-----------------------|----------|--------------------------|-------|------------------|-----------------------------------------------------------|---------------------| 
| <span data-ttu-id="f2721-132">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-132">eaee885b</span></span> | <span data-ttu-id="f2721-133">OrchestratorStarted</span><span class="sxs-lookup"><span data-stu-id="f2721-133">OrchestratorStarted</span></span>   | <span data-ttu-id="f2721-134">2017-05-05T18:45:32.362Z</span><span class="sxs-lookup"><span data-stu-id="f2721-134">2017-05-05T18:45:32.362Z</span></span> |       |                  |                                                           |                     | 
| <span data-ttu-id="f2721-135">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-135">eaee885b</span></span> | <span data-ttu-id="f2721-136">ExecutionStarted</span><span class="sxs-lookup"><span data-stu-id="f2721-136">ExecutionStarted</span></span>      | <span data-ttu-id="f2721-137">2017-05-05T18:45:28.852Z</span><span class="sxs-lookup"><span data-stu-id="f2721-137">2017-05-05T18:45:28.852Z</span></span> | <span data-ttu-id="f2721-138">null</span><span class="sxs-lookup"><span data-stu-id="f2721-138">null</span></span>  | <span data-ttu-id="f2721-139">E1_HelloSequence</span><span class="sxs-lookup"><span data-stu-id="f2721-139">E1_HelloSequence</span></span> |                                                           |                     | 
| <span data-ttu-id="f2721-140">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-140">eaee885b</span></span> | <span data-ttu-id="f2721-141">TaskScheduled</span><span class="sxs-lookup"><span data-stu-id="f2721-141">TaskScheduled</span></span>         | <span data-ttu-id="f2721-142">2017-05-05T18:45:32.670Z</span><span class="sxs-lookup"><span data-stu-id="f2721-142">2017-05-05T18:45:32.670Z</span></span> |       | <span data-ttu-id="f2721-143">E1_SayHello</span><span class="sxs-lookup"><span data-stu-id="f2721-143">E1_SayHello</span></span>      |                                                           |                     | 
| <span data-ttu-id="f2721-144">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-144">eaee885b</span></span> | <span data-ttu-id="f2721-145">OrchestratorCompleted</span><span class="sxs-lookup"><span data-stu-id="f2721-145">OrchestratorCompleted</span></span> | <span data-ttu-id="f2721-146">2017-05-05T18:45:32.670Z</span><span class="sxs-lookup"><span data-stu-id="f2721-146">2017-05-05T18:45:32.670Z</span></span> |       |                  |                                                           |                     | 
| <span data-ttu-id="f2721-147">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-147">eaee885b</span></span> | <span data-ttu-id="f2721-148">OrchestratorStarted</span><span class="sxs-lookup"><span data-stu-id="f2721-148">OrchestratorStarted</span></span>   | <span data-ttu-id="f2721-149">2017-05-05T18:45:34.232Z</span><span class="sxs-lookup"><span data-stu-id="f2721-149">2017-05-05T18:45:34.232Z</span></span> |       |                  |                                                           |                     | 
| <span data-ttu-id="f2721-150">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-150">eaee885b</span></span> | <span data-ttu-id="f2721-151">TaskCompleted</span><span class="sxs-lookup"><span data-stu-id="f2721-151">TaskCompleted</span></span>         | <span data-ttu-id="f2721-152">2017-05-05T18:45:34.201Z</span><span class="sxs-lookup"><span data-stu-id="f2721-152">2017-05-05T18:45:34.201Z</span></span> |       |                  | <span data-ttu-id="f2721-153">"""Hello Tokyo!"""</span><span class="sxs-lookup"><span data-stu-id="f2721-153">"""Hello Tokyo!"""</span></span>                                        |                     | 
| <span data-ttu-id="f2721-154">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-154">eaee885b</span></span> | <span data-ttu-id="f2721-155">TaskScheduled</span><span class="sxs-lookup"><span data-stu-id="f2721-155">TaskScheduled</span></span>         | <span data-ttu-id="f2721-156">2017-05-05T18:45:34.435Z</span><span class="sxs-lookup"><span data-stu-id="f2721-156">2017-05-05T18:45:34.435Z</span></span> |       | <span data-ttu-id="f2721-157">E1_SayHello</span><span class="sxs-lookup"><span data-stu-id="f2721-157">E1_SayHello</span></span>      |                                                           |                     | 
| <span data-ttu-id="f2721-158">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-158">eaee885b</span></span> | <span data-ttu-id="f2721-159">OrchestratorCompleted</span><span class="sxs-lookup"><span data-stu-id="f2721-159">OrchestratorCompleted</span></span> | <span data-ttu-id="f2721-160">2017-05-05T18:45:34.435Z</span><span class="sxs-lookup"><span data-stu-id="f2721-160">2017-05-05T18:45:34.435Z</span></span> |       |                  |                                                           |                     | 
| <span data-ttu-id="f2721-161">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-161">eaee885b</span></span> | <span data-ttu-id="f2721-162">OrchestratorStarted</span><span class="sxs-lookup"><span data-stu-id="f2721-162">OrchestratorStarted</span></span>   | <span data-ttu-id="f2721-163">2017-05-05T18:45:34.857Z</span><span class="sxs-lookup"><span data-stu-id="f2721-163">2017-05-05T18:45:34.857Z</span></span> |       |                  |                                                           |                     | 
| <span data-ttu-id="f2721-164">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-164">eaee885b</span></span> | <span data-ttu-id="f2721-165">TaskCompleted</span><span class="sxs-lookup"><span data-stu-id="f2721-165">TaskCompleted</span></span>         | <span data-ttu-id="f2721-166">2017-05-05T18:45:34.763Z</span><span class="sxs-lookup"><span data-stu-id="f2721-166">2017-05-05T18:45:34.763Z</span></span> |       |                  | <span data-ttu-id="f2721-167">"""Hello Seattle!"""</span><span class="sxs-lookup"><span data-stu-id="f2721-167">"""Hello Seattle!"""</span></span>                                      |                     | 
| <span data-ttu-id="f2721-168">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-168">eaee885b</span></span> | <span data-ttu-id="f2721-169">TaskScheduled</span><span class="sxs-lookup"><span data-stu-id="f2721-169">TaskScheduled</span></span>         | <span data-ttu-id="f2721-170">2017-05-05T18:45:34.857Z</span><span class="sxs-lookup"><span data-stu-id="f2721-170">2017-05-05T18:45:34.857Z</span></span> |       | <span data-ttu-id="f2721-171">E1_SayHello</span><span class="sxs-lookup"><span data-stu-id="f2721-171">E1_SayHello</span></span>      |                                                           |                     | 
| <span data-ttu-id="f2721-172">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-172">eaee885b</span></span> | <span data-ttu-id="f2721-173">OrchestratorCompleted</span><span class="sxs-lookup"><span data-stu-id="f2721-173">OrchestratorCompleted</span></span> | <span data-ttu-id="f2721-174">2017-05-05T18:45:34.857Z</span><span class="sxs-lookup"><span data-stu-id="f2721-174">2017-05-05T18:45:34.857Z</span></span> |       |                  |                                                           |                     | 
| <span data-ttu-id="f2721-175">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-175">eaee885b</span></span> | <span data-ttu-id="f2721-176">OrchestratorStarted</span><span class="sxs-lookup"><span data-stu-id="f2721-176">OrchestratorStarted</span></span>   | <span data-ttu-id="f2721-177">2017-05-05T18:45:35.032Z</span><span class="sxs-lookup"><span data-stu-id="f2721-177">2017-05-05T18:45:35.032Z</span></span> |       |                  |                                                           |                     | 
| <span data-ttu-id="f2721-178">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-178">eaee885b</span></span> | <span data-ttu-id="f2721-179">TaskCompleted</span><span class="sxs-lookup"><span data-stu-id="f2721-179">TaskCompleted</span></span>         | <span data-ttu-id="f2721-180">2017-05-05T18:45:34.919Z</span><span class="sxs-lookup"><span data-stu-id="f2721-180">2017-05-05T18:45:34.919Z</span></span> |       |                  | <span data-ttu-id="f2721-181">"""Hello London!"""</span><span class="sxs-lookup"><span data-stu-id="f2721-181">"""Hello London!"""</span></span>                                       |                     | 
| <span data-ttu-id="f2721-182">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-182">eaee885b</span></span> | <span data-ttu-id="f2721-183">ExecutionCompleted</span><span class="sxs-lookup"><span data-stu-id="f2721-183">ExecutionCompleted</span></span>    | <span data-ttu-id="f2721-184">2017-05-05T18:45:35.044Z</span><span class="sxs-lookup"><span data-stu-id="f2721-184">2017-05-05T18:45:35.044Z</span></span> |       |                  | <span data-ttu-id="f2721-185">"[""Hello Tokyo!"",""Hello Seattle!"",""Hello London!""]"</span><span class="sxs-lookup"><span data-stu-id="f2721-185">"[""Hello Tokyo!"",""Hello Seattle!"",""Hello London!""]"</span></span> | <span data-ttu-id="f2721-186">Completed</span><span class="sxs-lookup"><span data-stu-id="f2721-186">Completed</span></span>           | 
| <span data-ttu-id="f2721-187">eaee885b</span><span class="sxs-lookup"><span data-stu-id="f2721-187">eaee885b</span></span> | <span data-ttu-id="f2721-188">OrchestratorCompleted</span><span class="sxs-lookup"><span data-stu-id="f2721-188">OrchestratorCompleted</span></span> | <span data-ttu-id="f2721-189">2017-05-05T18:45:35.044Z</span><span class="sxs-lookup"><span data-stu-id="f2721-189">2017-05-05T18:45:35.044Z</span></span> |       |                  |                                                           |                     | 

<span data-ttu-id="f2721-190">A few notes on the column values:</span><span class="sxs-lookup"><span data-stu-id="f2721-190">A few notes on the column values:</span></span>
* <span data-ttu-id="f2721-191">**PartitionKey**: Contains the instance ID of the orchestration.</span><span class="sxs-lookup"><span data-stu-id="f2721-191">**PartitionKey**: Contains the instance ID of the orchestration.</span></span>
* <span data-ttu-id="f2721-192">**EventType**: Represents the type of the event.</span><span class="sxs-lookup"><span data-stu-id="f2721-192">**EventType**: Represents the type of the event.</span></span> <span data-ttu-id="f2721-193">May be one of the following types:</span><span class="sxs-lookup"><span data-stu-id="f2721-193">May be one of the following types:</span></span>
    * <span data-ttu-id="f2721-194">**OrchestrationStarted**: The orchestrator function resumed from an await or is running for the first time.</span><span class="sxs-lookup"><span data-stu-id="f2721-194">**OrchestrationStarted**: The orchestrator function resumed from an await or is running for the first time.</span></span> <span data-ttu-id="f2721-195">The `Timestamp` column is used to populate the deterministic value for the [CurrentUtcDateTime](https://azure.github.io/azure-functions-durable-extension/api/Microsoft.Azure.WebJobs.DurableOrchestrationContext.html#Microsoft_Azure_WebJobs_DurableOrchestrationContext_CurrentUtcDateTime) API.</span><span class="sxs-lookup"><span data-stu-id="f2721-195">The `Timestamp` column is used to populate the deterministic value for the [CurrentUtcDateTime](https://azure.github.io/azure-functions-durable-extension/api/Microsoft.Azure.WebJobs.DurableOrchestrationContext.html#Microsoft_Azure_WebJobs_DurableOrchestrationContext_CurrentUtcDateTime) API.</span></span>
    * <span data-ttu-id="f2721-196">**ExecutionStarted**: The orchestrator function started executing for the first time.</span><span class="sxs-lookup"><span data-stu-id="f2721-196">**ExecutionStarted**: The orchestrator function started executing for the first time.</span></span> <span data-ttu-id="f2721-197">This event also contains the function input in the `Input` column.</span><span class="sxs-lookup"><span data-stu-id="f2721-197">This event also contains the function input in the `Input` column.</span></span>
    * <span data-ttu-id="f2721-198">**TaskScheduled**: An activity function was scheduled.</span><span class="sxs-lookup"><span data-stu-id="f2721-198">**TaskScheduled**: An activity function was scheduled.</span></span> <span data-ttu-id="f2721-199">The name of the activity function is captured in the `Name` column.</span><span class="sxs-lookup"><span data-stu-id="f2721-199">The name of the activity function is captured in the `Name` column.</span></span>
    * <span data-ttu-id="f2721-200">**TaskCompleted**: An activity function completed.</span><span class="sxs-lookup"><span data-stu-id="f2721-200">**TaskCompleted**: An activity function completed.</span></span> <span data-ttu-id="f2721-201">The result of the function is in the `Result` column.</span><span class="sxs-lookup"><span data-stu-id="f2721-201">The result of the function is in the `Result` column.</span></span>
    * <span data-ttu-id="f2721-202">**TimerCreated**: A durable timer was created.</span><span class="sxs-lookup"><span data-stu-id="f2721-202">**TimerCreated**: A durable timer was created.</span></span> <span data-ttu-id="f2721-203">The `FireAt` column contains the scheduled UTC time at which the timer expires.</span><span class="sxs-lookup"><span data-stu-id="f2721-203">The `FireAt` column contains the scheduled UTC time at which the timer expires.</span></span>
    * <span data-ttu-id="f2721-204">**TimerFired**: A durable timer fired.</span><span class="sxs-lookup"><span data-stu-id="f2721-204">**TimerFired**: A durable timer fired.</span></span>
    * <span data-ttu-id="f2721-205">**EventRaised**: An external event was sent to the orchestration instance.</span><span class="sxs-lookup"><span data-stu-id="f2721-205">**EventRaised**: An external event was sent to the orchestration instance.</span></span> <span data-ttu-id="f2721-206">The `Name` column captures the name of the event and the `Input` column captures the payload of the event.</span><span class="sxs-lookup"><span data-stu-id="f2721-206">The `Name` column captures the name of the event and the `Input` column captures the payload of the event.</span></span>
    * <span data-ttu-id="f2721-207">**OrchestratorCompleted**: The orchestrator function awaited.</span><span class="sxs-lookup"><span data-stu-id="f2721-207">**OrchestratorCompleted**: The orchestrator function awaited.</span></span>
    * <span data-ttu-id="f2721-208">**ContinueAsNew**: The orchestrator function completed and restarted itself with new state.</span><span class="sxs-lookup"><span data-stu-id="f2721-208">**ContinueAsNew**: The orchestrator function completed and restarted itself with new state.</span></span> <span data-ttu-id="f2721-209">The `Result` column contains the value, which is used as the input in the restarted instance.</span><span class="sxs-lookup"><span data-stu-id="f2721-209">The `Result` column contains the value, which is used as the input in the restarted instance.</span></span>
    * <span data-ttu-id="f2721-210">**ExecutionCompleted**: The orchestrator function ran to completion (or failed).</span><span class="sxs-lookup"><span data-stu-id="f2721-210">**ExecutionCompleted**: The orchestrator function ran to completion (or failed).</span></span> <span data-ttu-id="f2721-211">The outputs of the function or the error details are stored in the `Result` column.</span><span class="sxs-lookup"><span data-stu-id="f2721-211">The outputs of the function or the error details are stored in the `Result` column.</span></span>
* <span data-ttu-id="f2721-212">**Timestamp**: The UTC timestamp of the history event.</span><span class="sxs-lookup"><span data-stu-id="f2721-212">**Timestamp**: The UTC timestamp of the history event.</span></span>
* <span data-ttu-id="f2721-213">**Name**: The name of the function that was invoked.</span><span class="sxs-lookup"><span data-stu-id="f2721-213">**Name**: The name of the function that was invoked.</span></span>
* <span data-ttu-id="f2721-214">**Input**: The JSON-formatted input of the function.</span><span class="sxs-lookup"><span data-stu-id="f2721-214">**Input**: The JSON-formatted input of the function.</span></span>
* <span data-ttu-id="f2721-215">**Result**: The output of the function; that is, its return value.</span><span class="sxs-lookup"><span data-stu-id="f2721-215">**Result**: The output of the function; that is, its return value.</span></span>

> [!WARNING]
> <span data-ttu-id="f2721-216">While it's useful as a debugging tool, don't take any dependency on this table.</span><span class="sxs-lookup"><span data-stu-id="f2721-216">While it's useful as a debugging tool, don't take any dependency on this table.</span></span> <span data-ttu-id="f2721-217">It may change as the Durable Functions extension evolves.</span><span class="sxs-lookup"><span data-stu-id="f2721-217">It may change as the Durable Functions extension evolves.</span></span>

<span data-ttu-id="f2721-218">Every time the function resumes from an `await`, the Durable Task Framework reruns the orchestrator function from scratch.</span><span class="sxs-lookup"><span data-stu-id="f2721-218">Every time the function resumes from an `await`, the Durable Task Framework reruns the orchestrator function from scratch.</span></span> <span data-ttu-id="f2721-219">On each rerun it consults the execution history to determine whether the current async operation has taken place.</span><span class="sxs-lookup"><span data-stu-id="f2721-219">On each rerun it consults the execution history to determine whether the current async operation has taken place.</span></span>  <span data-ttu-id="f2721-220">If the operation took place, the framework replays the output of that operation immediately and moves on to the next `await`.</span><span class="sxs-lookup"><span data-stu-id="f2721-220">If the operation took place, the framework replays the output of that operation immediately and moves on to the next `await`.</span></span> <span data-ttu-id="f2721-221">This process continues until the entire history has been replayed, at which point all the local variables in the orchestrator function are restored to their previous values.</span><span class="sxs-lookup"><span data-stu-id="f2721-221">This process continues until the entire history has been replayed, at which point all the local variables in the orchestrator function are restored to their previous values.</span></span>

## <a name="orchestrator-code-constraints"></a><span data-ttu-id="f2721-222">Orchestrator code constraints</span><span class="sxs-lookup"><span data-stu-id="f2721-222">Orchestrator code constraints</span></span>

<span data-ttu-id="f2721-223">The replay behavior creates constraints on the type of code that can be written in an orchestrator function:</span><span class="sxs-lookup"><span data-stu-id="f2721-223">The replay behavior creates constraints on the type of code that can be written in an orchestrator function:</span></span>

* <span data-ttu-id="f2721-224">Orchestrator code must be **deterministic**.</span><span class="sxs-lookup"><span data-stu-id="f2721-224">Orchestrator code must be **deterministic**.</span></span> <span data-ttu-id="f2721-225">It will be replayed multiple times and must produce the same result each time.</span><span class="sxs-lookup"><span data-stu-id="f2721-225">It will be replayed multiple times and must produce the same result each time.</span></span> <span data-ttu-id="f2721-226">For example, no direct calls to get the current date/time, get random numbers, generate random GUIDs, or call into remote endpoints.</span><span class="sxs-lookup"><span data-stu-id="f2721-226">For example, no direct calls to get the current date/time, get random numbers, generate random GUIDs, or call into remote endpoints.</span></span>

  <span data-ttu-id="f2721-227">If orchestrator code needs to get the current date/time, it should use the [CurrentUtcDateTime](https://azure.github.io/azure-functions-durable-extension/api/Microsoft.Azure.WebJobs.DurableOrchestrationContext.html#Microsoft_Azure_WebJobs_DurableOrchestrationContext_CurrentUtcDateTime) API, which is safe for replay.</span><span class="sxs-lookup"><span data-stu-id="f2721-227">If orchestrator code needs to get the current date/time, it should use the [CurrentUtcDateTime](https://azure.github.io/azure-functions-durable-extension/api/Microsoft.Azure.WebJobs.DurableOrchestrationContext.html#Microsoft_Azure_WebJobs_DurableOrchestrationContext_CurrentUtcDateTime) API, which is safe for replay.</span></span>

  <span data-ttu-id="f2721-228">Non-deterministic operations must be done in activity functions.</span><span class="sxs-lookup"><span data-stu-id="f2721-228">Non-deterministic operations must be done in activity functions.</span></span> <span data-ttu-id="f2721-229">This includes any interaction with other input or output bindings.</span><span class="sxs-lookup"><span data-stu-id="f2721-229">This includes any interaction with other input or output bindings.</span></span> <span data-ttu-id="f2721-230">This ensures that any non-deterministic values will be generated once on the first execution and saved into the execution history.</span><span class="sxs-lookup"><span data-stu-id="f2721-230">This ensures that any non-deterministic values will be generated once on the first execution and saved into the execution history.</span></span> <span data-ttu-id="f2721-231">Subsequent executions will then use the saved value automatically.</span><span class="sxs-lookup"><span data-stu-id="f2721-231">Subsequent executions will then use the saved value automatically.</span></span>

* <span data-ttu-id="f2721-232">Orchestrator code should be **non-blocking**.</span><span class="sxs-lookup"><span data-stu-id="f2721-232">Orchestrator code should be **non-blocking**.</span></span> <span data-ttu-id="f2721-233">For example, that means no I/O and no calls to `Thread.Sleep` or equivalent APIs.</span><span class="sxs-lookup"><span data-stu-id="f2721-233">For example, that means no I/O and no calls to `Thread.Sleep` or equivalent APIs.</span></span>

  <span data-ttu-id="f2721-234">If an orchestrator needs to delay, it can use the [CreateTimer](https://azure.github.io/azure-functions-durable-extension/api/Microsoft.Azure.WebJobs.DurableOrchestrationContext.html#Microsoft_Azure_WebJobs_DurableOrchestrationContext_CreateTimer_) API.</span><span class="sxs-lookup"><span data-stu-id="f2721-234">If an orchestrator needs to delay, it can use the [CreateTimer](https://azure.github.io/azure-functions-durable-extension/api/Microsoft.Azure.WebJobs.DurableOrchestrationContext.html#Microsoft_Azure_WebJobs_DurableOrchestrationContext_CreateTimer_) API.</span></span>

* <span data-ttu-id="f2721-235">Orchestrator code must **never initiate any async operation** except by using the [DurableOrchestrationContext](https://azure.github.io/azure-functions-durable-extension/api/Microsoft.Azure.WebJobs.DurableOrchestrationContext.html) API.</span><span class="sxs-lookup"><span data-stu-id="f2721-235">Orchestrator code must **never initiate any async operation** except by using the [DurableOrchestrationContext](https://azure.github.io/azure-functions-durable-extension/api/Microsoft.Azure.WebJobs.DurableOrchestrationContext.html) API.</span></span> <span data-ttu-id="f2721-236">For example, no `Task.Run`, `Task.Delay` or `HttpClient.SendAsync`.</span><span class="sxs-lookup"><span data-stu-id="f2721-236">For example, no `Task.Run`, `Task.Delay` or `HttpClient.SendAsync`.</span></span> <span data-ttu-id="f2721-237">The Durable Task Framework executes orchestrator code on a single thread and cannot interact with any other threads that could be scheduled by other async APIs.</span><span class="sxs-lookup"><span data-stu-id="f2721-237">The Durable Task Framework executes orchestrator code on a single thread and cannot interact with any other threads that could be scheduled by other async APIs.</span></span>

* <span data-ttu-id="f2721-238">**Infinite loops should be avoided** in orchestrator code.</span><span class="sxs-lookup"><span data-stu-id="f2721-238">**Infinite loops should be avoided** in orchestrator code.</span></span> <span data-ttu-id="f2721-239">Because the Durable Task Framework saves execution history as the orchestration function progresses, an infinite loop could cause an orchestrator instance to run out of memory.</span><span class="sxs-lookup"><span data-stu-id="f2721-239">Because the Durable Task Framework saves execution history as the orchestration function progresses, an infinite loop could cause an orchestrator instance to run out of memory.</span></span> <span data-ttu-id="f2721-240">For infinite loop scenarios, use APIs such as [ContinueAsNew](https://azure.github.io/azure-functions-durable-extension/api/Microsoft.Azure.WebJobs.DurableOrchestrationContext.html#Microsoft_Azure_WebJobs_DurableOrchestrationContext_ContinueAsNew_) to restart the function execution and discard previous execution history.</span><span class="sxs-lookup"><span data-stu-id="f2721-240">For infinite loop scenarios, use APIs such as [ContinueAsNew](https://azure.github.io/azure-functions-durable-extension/api/Microsoft.Azure.WebJobs.DurableOrchestrationContext.html#Microsoft_Azure_WebJobs_DurableOrchestrationContext_ContinueAsNew_) to restart the function execution and discard previous execution history.</span></span>

<span data-ttu-id="f2721-241">While these constraints may seem daunting at first, in practice they aren't hard to follow.</span><span class="sxs-lookup"><span data-stu-id="f2721-241">While these constraints may seem daunting at first, in practice they aren't hard to follow.</span></span> <span data-ttu-id="f2721-242">The Durable Task Framework attempts to detect violations of the above rules and throws a `NonDeterministicOrchestrationException`.</span><span class="sxs-lookup"><span data-stu-id="f2721-242">The Durable Task Framework attempts to detect violations of the above rules and throws a `NonDeterministicOrchestrationException`.</span></span> <span data-ttu-id="f2721-243">However, this detection behavior is best-effort, and you shouldn't depend on it.</span><span class="sxs-lookup"><span data-stu-id="f2721-243">However, this detection behavior is best-effort, and you shouldn't depend on it.</span></span>

> [!NOTE]
> <span data-ttu-id="f2721-244">All of these rules apply only to functions triggered by the `orchestrationTrigger` binding.</span><span class="sxs-lookup"><span data-stu-id="f2721-244">All of these rules apply only to functions triggered by the `orchestrationTrigger` binding.</span></span> <span data-ttu-id="f2721-245">Activity functions triggered by the `activityTrigger` binding, and functions that use the `orchestrationClient` binding, have no such limitations.</span><span class="sxs-lookup"><span data-stu-id="f2721-245">Activity functions triggered by the `activityTrigger` binding, and functions that use the `orchestrationClient` binding, have no such limitations.</span></span>

## <a name="durable-tasks"></a><span data-ttu-id="f2721-246">Durable tasks</span><span class="sxs-lookup"><span data-stu-id="f2721-246">Durable tasks</span></span>

> [!NOTE]
> <span data-ttu-id="f2721-247">This section describes internal implementation details of the Durable Task Framework.</span><span class="sxs-lookup"><span data-stu-id="f2721-247">This section describes internal implementation details of the Durable Task Framework.</span></span> <span data-ttu-id="f2721-248">You can use Durable Functions without knowing this information.</span><span class="sxs-lookup"><span data-stu-id="f2721-248">You can use Durable Functions without knowing this information.</span></span> <span data-ttu-id="f2721-249">It is intended only to help you understand the replay behavior.</span><span class="sxs-lookup"><span data-stu-id="f2721-249">It is intended only to help you understand the replay behavior.</span></span>

<span data-ttu-id="f2721-250">Tasks that can be safely awaited in orchestrator functions are occasionally referred to as *durable tasks*.</span><span class="sxs-lookup"><span data-stu-id="f2721-250">Tasks that can be safely awaited in orchestrator functions are occasionally referred to as *durable tasks*.</span></span> <span data-ttu-id="f2721-251">These are tasks that are created and managed by the Durable Task Framework.</span><span class="sxs-lookup"><span data-stu-id="f2721-251">These are tasks that are created and managed by the Durable Task Framework.</span></span> <span data-ttu-id="f2721-252">Examples are the tasks returned by `CallActivityAsync`, `WaitForExternalEvent`, and `CreateTimer`.</span><span class="sxs-lookup"><span data-stu-id="f2721-252">Examples are the tasks returned by `CallActivityAsync`, `WaitForExternalEvent`, and `CreateTimer`.</span></span>

<span data-ttu-id="f2721-253">These *durable tasks* are internally managed by using a list of `TaskCompletionSource` objects.</span><span class="sxs-lookup"><span data-stu-id="f2721-253">These *durable tasks* are internally managed by using a list of `TaskCompletionSource` objects.</span></span> <span data-ttu-id="f2721-254">During replay, these tasks get created as part of orchestrator code execution and are completed as the dispatcher enumerates the corresponding history events.</span><span class="sxs-lookup"><span data-stu-id="f2721-254">During replay, these tasks get created as part of orchestrator code execution and are completed as the dispatcher enumerates the corresponding history events.</span></span> <span data-ttu-id="f2721-255">This is all done synchronously using a single thread until all the history has been replayed.</span><span class="sxs-lookup"><span data-stu-id="f2721-255">This is all done synchronously using a single thread until all the history has been replayed.</span></span> <span data-ttu-id="f2721-256">Any durable tasks, which are not completed by the end of history replay has appropriate actions carried out. For example, a message may be enqueued to call an activity function.</span><span class="sxs-lookup"><span data-stu-id="f2721-256">Any durable tasks, which are not completed by the end of history replay has appropriate actions carried out. For example, a message may be enqueued to call an activity function.</span></span>

<span data-ttu-id="f2721-257">The execution behavior described here should help you understand why orchestrator function code must never `await` a non-durable task: the dispatcher thread cannot wait for it to complete and any callback by that task could potentially corrupt the tracking state of the orchestrator function.</span><span class="sxs-lookup"><span data-stu-id="f2721-257">The execution behavior described here should help you understand why orchestrator function code must never `await` a non-durable task: the dispatcher thread cannot wait for it to complete and any callback by that task could potentially corrupt the tracking state of the orchestrator function.</span></span> <span data-ttu-id="f2721-258">Some runtime checks are in place to try to prevent this.</span><span class="sxs-lookup"><span data-stu-id="f2721-258">Some runtime checks are in place to try to prevent this.</span></span>

<span data-ttu-id="f2721-259">If you'd like more information about how the Durable Task Framework executes orchestrator functions, the best thing to do is to consult the [Durable Task source code on GitHub](https://github.com/Azure/durabletask).</span><span class="sxs-lookup"><span data-stu-id="f2721-259">If you'd like more information about how the Durable Task Framework executes orchestrator functions, the best thing to do is to consult the [Durable Task source code on GitHub](https://github.com/Azure/durabletask).</span></span> <span data-ttu-id="f2721-260">In particular, see [TaskOrchestrationExecutor.cs](https://github.com/Azure/durabletask/blob/master/src/DurableTask.Core/TaskOrchestrationExecutor.cs) and [TaskOrchestrationContext.cs](https://github.com/Azure/durabletask/blob/master/src/DurableTask.Core/TaskOrchestrationContext.cs)</span><span class="sxs-lookup"><span data-stu-id="f2721-260">In particular, see [TaskOrchestrationExecutor.cs](https://github.com/Azure/durabletask/blob/master/src/DurableTask.Core/TaskOrchestrationExecutor.cs) and [TaskOrchestrationContext.cs](https://github.com/Azure/durabletask/blob/master/src/DurableTask.Core/TaskOrchestrationContext.cs)</span></span>

## <a name="next-steps"></a><span data-ttu-id="f2721-261">Next steps</span><span class="sxs-lookup"><span data-stu-id="f2721-261">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="f2721-262">Learn about instance management</span><span class="sxs-lookup"><span data-stu-id="f2721-262">Learn about instance management</span></span>](durable-functions-instance-management.md)
