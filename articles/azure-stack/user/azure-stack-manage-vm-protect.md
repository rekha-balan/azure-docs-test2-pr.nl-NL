---
title: Protect VMs deployed on Azure Stack | Microsoft Docs
description: Guidelines on how to protect virtual machines deployed on Azure Stack.
services: azure-stack
documentationcenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.assetid: 4e5833cf-4790-4146-82d6-737975fb06ba
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 05/14/2018
ms.author: jeffgilb
ms.reviewer: hector.linares
ms.openlocfilehash: 734ee0e6ffb0dab660a2b63b431780208e0e0484
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44871341"
---
# <a name="protect-virtual-machines-deployed-on-azure-stack"></a><span data-ttu-id="11710-103">Protect virtual machines deployed on Azure Stack</span><span class="sxs-lookup"><span data-stu-id="11710-103">Protect virtual machines deployed on Azure Stack</span></span>

<span data-ttu-id="11710-104">Use this article as a guide to developing a plan for protecting virtual machines (VMs) that your users deploy on Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="11710-104">Use this article as a guide to developing a plan for protecting virtual machines (VMs) that your users deploy on Azure Stack.</span></span>

<span data-ttu-id="11710-105">To protect against data loss and unplanned downtime, you need to implement a backup-recovery or disaster-recovery plan for user applications and their data.</span><span class="sxs-lookup"><span data-stu-id="11710-105">To protect against data loss and unplanned downtime, you need to implement a backup-recovery or disaster-recovery plan for user applications and their data.</span></span> <span data-ttu-id="11710-106">This plan might be unique for each application but follows a framework established by your organization's comprehensive business continuity and disaster recovery (BC/DR) strategy.</span><span class="sxs-lookup"><span data-stu-id="11710-106">This plan might be unique for each application but follows a framework established by your organization's comprehensive business continuity and disaster recovery (BC/DR) strategy.</span></span> <span data-ttu-id="11710-107">A good starting point is [Designing resilient applications for Azure](https://docs.microsoft.com/azure/architecture/resiliency), which provides general patterns and practices for application availability and resiliency.</span><span class="sxs-lookup"><span data-stu-id="11710-107">A good starting point is [Designing resilient applications for Azure](https://docs.microsoft.com/azure/architecture/resiliency), which provides general patterns and practices for application availability and resiliency.</span></span>

>[!IMPORTANT]
> <span data-ttu-id="11710-108">Test your backup-recovery and disaster-recovery plans on an ongoing basis.</span><span class="sxs-lookup"><span data-stu-id="11710-108">Test your backup-recovery and disaster-recovery plans on an ongoing basis.</span></span> <span data-ttu-id="11710-109">You must to this to ensure that:</span><span class="sxs-lookup"><span data-stu-id="11710-109">You must to this to ensure that:</span></span>
> * <span data-ttu-id="11710-110">The plans work</span><span class="sxs-lookup"><span data-stu-id="11710-110">The plans work</span></span>
> * <span data-ttu-id="11710-111">The plans still meet the needs they were designed for.</span><span class="sxs-lookup"><span data-stu-id="11710-111">The plans still meet the needs they were designed for.</span></span>

## <a name="azure-stack-infrastructure-recovery"></a><span data-ttu-id="11710-112">Azure Stack infrastructure recovery</span><span class="sxs-lookup"><span data-stu-id="11710-112">Azure Stack infrastructure recovery</span></span>

<span data-ttu-id="11710-113">Users are responsible for protecting their VMs separately from Azure Stack's infrastructure services.</span><span class="sxs-lookup"><span data-stu-id="11710-113">Users are responsible for protecting their VMs separately from Azure Stack's infrastructure services.</span></span>

<span data-ttu-id="11710-114">The recovery plan for Azure Stack infrastructure services **does not** include recovery of user VMs, storage accounts, or databases.</span><span class="sxs-lookup"><span data-stu-id="11710-114">The recovery plan for Azure Stack infrastructure services **does not** include recovery of user VMs, storage accounts, or databases.</span></span> <span data-ttu-id="11710-115">As the application owner, you are responsible for implementing a recovery plan for your applications and data.</span><span class="sxs-lookup"><span data-stu-id="11710-115">As the application owner, you are responsible for implementing a recovery plan for your applications and data.</span></span>

<span data-ttu-id="11710-116">If the Azure Stack cloud is offline for an extended time or permanently unrecoverable, you need to have a recovery plan in place that:</span><span class="sxs-lookup"><span data-stu-id="11710-116">If the Azure Stack cloud is offline for an extended time or permanently unrecoverable, you need to have a recovery plan in place that:</span></span>

* <span data-ttu-id="11710-117">Ensures minimal downtime</span><span class="sxs-lookup"><span data-stu-id="11710-117">Ensures minimal downtime</span></span>
* <span data-ttu-id="11710-118">Keeps critical VMs, such as database servers, running</span><span class="sxs-lookup"><span data-stu-id="11710-118">Keeps critical VMs, such as database servers, running</span></span>
* <span data-ttu-id="11710-119">Enables applications to keep servicing user requests</span><span class="sxs-lookup"><span data-stu-id="11710-119">Enables applications to keep servicing user requests</span></span>

<span data-ttu-id="11710-120">The operator of the Azure Stack cloud is responsible for creating a recovery plan for the underlying Azure Stack infrastructure and services.</span><span class="sxs-lookup"><span data-stu-id="11710-120">The operator of the Azure Stack cloud is responsible for creating a recovery plan for the underlying Azure Stack infrastructure and services.</span></span> <span data-ttu-id="11710-121">To learn more, read the article [Recover from catastrophic data loss](https://docs.microsoft.com/azure/azure-stack/azure-stack-backup-recover-data).</span><span class="sxs-lookup"><span data-stu-id="11710-121">To learn more, read the article [Recover from catastrophic data loss](https://docs.microsoft.com/azure/azure-stack/azure-stack-backup-recover-data).</span></span>

## <a name="sourcetarget-combinations"></a><span data-ttu-id="11710-122">Source/target combinations</span><span class="sxs-lookup"><span data-stu-id="11710-122">Source/target combinations</span></span>

<span data-ttu-id="11710-123">Each Azure Stack cloud is deployed to one datacenter.</span><span class="sxs-lookup"><span data-stu-id="11710-123">Each Azure Stack cloud is deployed to one datacenter.</span></span> <span data-ttu-id="11710-124">A separate environment is required so you can recover your applications.</span><span class="sxs-lookup"><span data-stu-id="11710-124">A separate environment is required so you can recover your applications.</span></span> <span data-ttu-id="11710-125">The recovery environment can be another Azure Stack cloud in a different datacenter or the Azure public cloud.</span><span class="sxs-lookup"><span data-stu-id="11710-125">The recovery environment can be another Azure Stack cloud in a different datacenter or the Azure public cloud.</span></span> <span data-ttu-id="11710-126">Your data sovereignty and data privacy requirements will determine the recovery environment for your application.</span><span class="sxs-lookup"><span data-stu-id="11710-126">Your data sovereignty and data privacy requirements will determine the recovery environment for your application.</span></span> <span data-ttu-id="11710-127">As you enable protection for each application, you have the flexibility to choose a specific recovery option for each one.</span><span class="sxs-lookup"><span data-stu-id="11710-127">As you enable protection for each application, you have the flexibility to choose a specific recovery option for each one.</span></span> <span data-ttu-id="11710-128">You can have applications in one subscription backing up data to another datacenter.</span><span class="sxs-lookup"><span data-stu-id="11710-128">You can have applications in one subscription backing up data to another datacenter.</span></span> <span data-ttu-id="11710-129">In another subscription, you can replicate data to the Azure public cloud.</span><span class="sxs-lookup"><span data-stu-id="11710-129">In another subscription, you can replicate data to the Azure public cloud.</span></span>

<span data-ttu-id="11710-130">Plan your backup-recovery and disaster-recovery strategy for each application to determine the target for each application.</span><span class="sxs-lookup"><span data-stu-id="11710-130">Plan your backup-recovery and disaster-recovery strategy for each application to determine the target for each application.</span></span> <span data-ttu-id="11710-131">A recovery plan will help your organization properly size the storage capacity required on-premises and project consumption in the public cloud.</span><span class="sxs-lookup"><span data-stu-id="11710-131">A recovery plan will help your organization properly size the storage capacity required on-premises and project consumption in the public cloud.</span></span>

|  | <span data-ttu-id="11710-132">Global Azure</span><span class="sxs-lookup"><span data-stu-id="11710-132">Global Azure</span></span> | <span data-ttu-id="11710-133">Azure Stack deployed into CSP datacenter and operated by CSP</span><span class="sxs-lookup"><span data-stu-id="11710-133">Azure Stack deployed into CSP datacenter and operated by CSP</span></span> | <span data-ttu-id="11710-134">Azure Stack deployed into customer datacenter and operated by customer</span><span class="sxs-lookup"><span data-stu-id="11710-134">Azure Stack deployed into customer datacenter and operated by customer</span></span> |
|------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="11710-135">**Azure Stack deployed into CSP datacenter and operated by CSP**</span><span class="sxs-lookup"><span data-stu-id="11710-135">**Azure Stack deployed into CSP datacenter and operated by CSP**</span></span> | <span data-ttu-id="11710-136">User VMs are deployed to the CSP operated Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="11710-136">User VMs are deployed to the CSP operated Azure Stack.</span></span> <span data-ttu-id="11710-137">User VMs are restored from backup or failed over directly to Azure.</span><span class="sxs-lookup"><span data-stu-id="11710-137">User VMs are restored from backup or failed over directly to Azure.</span></span> | <span data-ttu-id="11710-138">CSP operates the primary and secondary instances of Azure Stack in their own datacenters.</span><span class="sxs-lookup"><span data-stu-id="11710-138">CSP operates the primary and secondary instances of Azure Stack in their own datacenters.</span></span> <span data-ttu-id="11710-139">User VMs are restored or failed over between the two Azure Stack instances.</span><span class="sxs-lookup"><span data-stu-id="11710-139">User VMs are restored or failed over between the two Azure Stack instances.</span></span> | <span data-ttu-id="11710-140">CSP operates Azure Stack in the primary site.</span><span class="sxs-lookup"><span data-stu-id="11710-140">CSP operates Azure Stack in the primary site.</span></span> <span data-ttu-id="11710-141">Customer’s datacenter is the restore or failover target.</span><span class="sxs-lookup"><span data-stu-id="11710-141">Customer’s datacenter is the restore or failover target.</span></span> |
| <span data-ttu-id="11710-142">**Azure Stack deployed into customer datacenter and operated by customer**</span><span class="sxs-lookup"><span data-stu-id="11710-142">**Azure Stack deployed into customer datacenter and operated by customer**</span></span> | <span data-ttu-id="11710-143">User VMs are deployed to the customer operated Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="11710-143">User VMs are deployed to the customer operated Azure Stack.</span></span> <span data-ttu-id="11710-144">User VMs are restored from backup or failed over directly to Azure.</span><span class="sxs-lookup"><span data-stu-id="11710-144">User VMs are restored from backup or failed over directly to Azure.</span></span> | <span data-ttu-id="11710-145">Customer operates the primary and secondary instances of Azure Stack in their own datacenters.</span><span class="sxs-lookup"><span data-stu-id="11710-145">Customer operates the primary and secondary instances of Azure Stack in their own datacenters.</span></span> <span data-ttu-id="11710-146">User VMs are restored or failed over between the two Azure Stack instances.</span><span class="sxs-lookup"><span data-stu-id="11710-146">User VMs are restored or failed over between the two Azure Stack instances.</span></span> | <span data-ttu-id="11710-147">Customer operates Azure Stack in the primary site.</span><span class="sxs-lookup"><span data-stu-id="11710-147">Customer operates Azure Stack in the primary site.</span></span> <span data-ttu-id="11710-148">CSP’s datacenter is the restore or failover target.</span><span class="sxs-lookup"><span data-stu-id="11710-148">CSP’s datacenter is the restore or failover target.</span></span> |

![Source-target combinations](media\azure-stack-manage-vm-backup\vm_backupdataflow_01.png)

## <a name="application-recovery-objectives"></a><span data-ttu-id="11710-150">Application recovery objectives</span><span class="sxs-lookup"><span data-stu-id="11710-150">Application recovery objectives</span></span>

<span data-ttu-id="11710-151">You will need to determine the amount of downtime and data loss your organization can tolerate for each application.</span><span class="sxs-lookup"><span data-stu-id="11710-151">You will need to determine the amount of downtime and data loss your organization can tolerate for each application.</span></span> <span data-ttu-id="11710-152">By quantifying downtime and data loss you can create a recovery plan that minimizes the impact of a disaster on your organization.</span><span class="sxs-lookup"><span data-stu-id="11710-152">By quantifying downtime and data loss you can create a recovery plan that minimizes the impact of a disaster on your organization.</span></span> <span data-ttu-id="11710-153">For each application, consider:</span><span class="sxs-lookup"><span data-stu-id="11710-153">For each application, consider:</span></span>

 - <span data-ttu-id="11710-154">**Recovery time objective (RTO)**</span><span class="sxs-lookup"><span data-stu-id="11710-154">**Recovery time objective (RTO)**</span></span>  
<span data-ttu-id="11710-155">RTO is the maximum acceptable time that an application can be unavailable after an incident.</span><span class="sxs-lookup"><span data-stu-id="11710-155">RTO is the maximum acceptable time that an application can be unavailable after an incident.</span></span> <span data-ttu-id="11710-156">For example, an RTO of 90 minutes means that you must be able to restore the application to a running state within 90 minutes from the start of a disaster.</span><span class="sxs-lookup"><span data-stu-id="11710-156">For example, an RTO of 90 minutes means that you must be able to restore the application to a running state within 90 minutes from the start of a disaster.</span></span> <span data-ttu-id="11710-157">If you have a low RTO, you might keep a second deployment continually running on standby to protect against a regional outage.</span><span class="sxs-lookup"><span data-stu-id="11710-157">If you have a low RTO, you might keep a second deployment continually running on standby to protect against a regional outage.</span></span>
 - <span data-ttu-id="11710-158">**Recovery point objective (RPO)**</span><span class="sxs-lookup"><span data-stu-id="11710-158">**Recovery point objective (RPO)**</span></span>  
<span data-ttu-id="11710-159">RPO is the maximum duration of data loss that is acceptable during a disaster.</span><span class="sxs-lookup"><span data-stu-id="11710-159">RPO is the maximum duration of data loss that is acceptable during a disaster.</span></span> <span data-ttu-id="11710-160">For example, if you store data in a single database, with no replication to other databases, and perform hourly backups, you could lose up to an hour of data.</span><span class="sxs-lookup"><span data-stu-id="11710-160">For example, if you store data in a single database, with no replication to other databases, and perform hourly backups, you could lose up to an hour of data.</span></span>

<span data-ttu-id="11710-161">RTO and RPO are business requirements.</span><span class="sxs-lookup"><span data-stu-id="11710-161">RTO and RPO are business requirements.</span></span> <span data-ttu-id="11710-162">Conduct a risk assessment to  define the application's RTO and RPO.</span><span class="sxs-lookup"><span data-stu-id="11710-162">Conduct a risk assessment to  define the application's RTO and RPO.</span></span>

<span data-ttu-id="11710-163">Another metric is **Mean Time to Recover** (MTTR), which is the average time that it takes to restore the application after a failure.</span><span class="sxs-lookup"><span data-stu-id="11710-163">Another metric is **Mean Time to Recover** (MTTR), which is the average time that it takes to restore the application after a failure.</span></span> <span data-ttu-id="11710-164">MTTR is an empirical value for a system.</span><span class="sxs-lookup"><span data-stu-id="11710-164">MTTR is an empirical value for a system.</span></span> <span data-ttu-id="11710-165">If MTTR exceeds the RTO, then a failure in the system will cause an unacceptable business disruption, because it won't be possible to restore the system within the defined RTO.</span><span class="sxs-lookup"><span data-stu-id="11710-165">If MTTR exceeds the RTO, then a failure in the system will cause an unacceptable business disruption, because it won't be possible to restore the system within the defined RTO.</span></span>

### <a name="backup-restore"></a><span data-ttu-id="11710-166">Backup-restore</span><span class="sxs-lookup"><span data-stu-id="11710-166">Backup-restore</span></span>

<span data-ttu-id="11710-167">The most common protection scheme for VM-based applications is to use backup software.</span><span class="sxs-lookup"><span data-stu-id="11710-167">The most common protection scheme for VM-based applications is to use backup software.</span></span> <span data-ttu-id="11710-168">Backing up a VM typically includes the operating system, operating system configuration, application binaries, and application data.</span><span class="sxs-lookup"><span data-stu-id="11710-168">Backing up a VM typically includes the operating system, operating system configuration, application binaries, and application data.</span></span> <span data-ttu-id="11710-169">The backups are created by taking a snapshot of the volumes, disks, or the entire VM.</span><span class="sxs-lookup"><span data-stu-id="11710-169">The backups are created by taking a snapshot of the volumes, disks, or the entire VM.</span></span> <span data-ttu-id="11710-170">With Azure Stack, you have the flexibility of backing up from within the context of the guest OS or from the Azure Stack storage and compute APIs.</span><span class="sxs-lookup"><span data-stu-id="11710-170">With Azure Stack, you have the flexibility of backing up from within the context of the guest OS or from the Azure Stack storage and compute APIs.</span></span> <span data-ttu-id="11710-171">Azure Stack does not support taking backups at the hypervisor level.</span><span class="sxs-lookup"><span data-stu-id="11710-171">Azure Stack does not support taking backups at the hypervisor level.</span></span>
 
![Backup-restor](media\azure-stack-manage-vm-backup\vm_backupdataflow_03.png)

<span data-ttu-id="11710-173">Recovering the application requires restoring one or more VMs to the same cloud or to a new cloud.</span><span class="sxs-lookup"><span data-stu-id="11710-173">Recovering the application requires restoring one or more VMs to the same cloud or to a new cloud.</span></span> <span data-ttu-id="11710-174">You can target a cloud in your datacenter or the public cloud.</span><span class="sxs-lookup"><span data-stu-id="11710-174">You can target a cloud in your datacenter or the public cloud.</span></span> <span data-ttu-id="11710-175">The cloud you choose is completely within your control and is based on your data privacy and sovereignty requirements.</span><span class="sxs-lookup"><span data-stu-id="11710-175">The cloud you choose is completely within your control and is based on your data privacy and sovereignty requirements.</span></span>
 
 - <span data-ttu-id="11710-176">RTO: Downtime measured in hours</span><span class="sxs-lookup"><span data-stu-id="11710-176">RTO: Downtime measured in hours</span></span>
 - <span data-ttu-id="11710-177">RPO: Variable data loss (depending on backup frequency)</span><span class="sxs-lookup"><span data-stu-id="11710-177">RPO: Variable data loss (depending on backup frequency)</span></span>
 - <span data-ttu-id="11710-178">Deployment topology: Active/passive</span><span class="sxs-lookup"><span data-stu-id="11710-178">Deployment topology: Active/passive</span></span>

#### <a name="planning-your-backup-strategy"></a><span data-ttu-id="11710-179">Planning your backup strategy</span><span class="sxs-lookup"><span data-stu-id="11710-179">Planning your backup strategy</span></span>

<span data-ttu-id="11710-180">Planning your backup strategy and defining scale requirements starts with quantifying the number of VM instances that need to be protected.</span><span class="sxs-lookup"><span data-stu-id="11710-180">Planning your backup strategy and defining scale requirements starts with quantifying the number of VM instances that need to be protected.</span></span> <span data-ttu-id="11710-181">Backing up all VMs across all servers in an environment is a common strategy.</span><span class="sxs-lookup"><span data-stu-id="11710-181">Backing up all VMs across all servers in an environment is a common strategy.</span></span> <span data-ttu-id="11710-182">However, with Azure Stack, there are some VMs that do need to be backed up.</span><span class="sxs-lookup"><span data-stu-id="11710-182">However, with Azure Stack, there are some VMs that do need to be backed up.</span></span> <span data-ttu-id="11710-183">For example, VMs in a scale-set are considered ephemeral resources that can come and go, sometimes without notice.</span><span class="sxs-lookup"><span data-stu-id="11710-183">For example, VMs in a scale-set are considered ephemeral resources that can come and go, sometimes without notice.</span></span> <span data-ttu-id="11710-184">Any durable data that needs to be protected is stored in a separate repository such as a database or object store.</span><span class="sxs-lookup"><span data-stu-id="11710-184">Any durable data that needs to be protected is stored in a separate repository such as a database or object store.</span></span>

<span data-ttu-id="11710-185">Important considerations for backing up VMs on Azure Stack:</span><span class="sxs-lookup"><span data-stu-id="11710-185">Important considerations for backing up VMs on Azure Stack:</span></span>

 - <span data-ttu-id="11710-186">**Categorization**</span><span class="sxs-lookup"><span data-stu-id="11710-186">**Categorization**</span></span>
    - <span data-ttu-id="11710-187">Consider a model where users opt in to VM backup.</span><span class="sxs-lookup"><span data-stu-id="11710-187">Consider a model where users opt in to VM backup.</span></span>
    - <span data-ttu-id="11710-188">Define a recovery service level agreement (SLA) based on the priority of the applications or the impact to the business.</span><span class="sxs-lookup"><span data-stu-id="11710-188">Define a recovery service level agreement (SLA) based on the priority of the applications or the impact to the business.</span></span>
 - <span data-ttu-id="11710-189">**Scale**</span><span class="sxs-lookup"><span data-stu-id="11710-189">**Scale**</span></span>
    - <span data-ttu-id="11710-190">Consider staggered backups when on-boarding a large number of new VMs (if backup is required).</span><span class="sxs-lookup"><span data-stu-id="11710-190">Consider staggered backups when on-boarding a large number of new VMs (if backup is required).</span></span>
    - <span data-ttu-id="11710-191">Evaluate backup products that can efficiently capture and transmit backup data to minimize resource content on the solution.</span><span class="sxs-lookup"><span data-stu-id="11710-191">Evaluate backup products that can efficiently capture and transmit backup data to minimize resource content on the solution.</span></span>
    - <span data-ttu-id="11710-192">Evaluate backup products that efficiently store backup data using incremental or differential backups to minimize the need for full backups across all VMs in the environment.</span><span class="sxs-lookup"><span data-stu-id="11710-192">Evaluate backup products that efficiently store backup data using incremental or differential backups to minimize the need for full backups across all VMs in the environment.</span></span>
 - <span data-ttu-id="11710-193">**Restore**</span><span class="sxs-lookup"><span data-stu-id="11710-193">**Restore**</span></span>
    - <span data-ttu-id="11710-194">Backup products can restore virtual disks, application data within an existing VM, or the entire VM resource and associated virtual disks.</span><span class="sxs-lookup"><span data-stu-id="11710-194">Backup products can restore virtual disks, application data within an existing VM, or the entire VM resource and associated virtual disks.</span></span> <span data-ttu-id="11710-195">The restore scheme you need depends on how you plan to restore the application and it will impact your application time to recovery.</span><span class="sxs-lookup"><span data-stu-id="11710-195">The restore scheme you need depends on how you plan to restore the application and it will impact your application time to recovery.</span></span> <span data-ttu-id="11710-196">For example, it may be easier to redeploy SQL server from a template and then restore the databases instead of restoring the entire VM or set of VMs.</span><span class="sxs-lookup"><span data-stu-id="11710-196">For example, it may be easier to redeploy SQL server from a template and then restore the databases instead of restoring the entire VM or set of VMs.</span></span>

### <a name="replicationmanual-failover"></a><span data-ttu-id="11710-197">Replication/manual failover</span><span class="sxs-lookup"><span data-stu-id="11710-197">Replication/manual failover</span></span>

<span data-ttu-id="11710-198">An alternate approach to supporting high availability is to replicate your application VMs to another cloud and rely on a manual failover.</span><span class="sxs-lookup"><span data-stu-id="11710-198">An alternate approach to supporting high availability is to replicate your application VMs to another cloud and rely on a manual failover.</span></span> <span data-ttu-id="11710-199">The replication of the operating system, application binaries, and application data can be performed at the VM level or guest OS level.</span><span class="sxs-lookup"><span data-stu-id="11710-199">The replication of the operating system, application binaries, and application data can be performed at the VM level or guest OS level.</span></span> <span data-ttu-id="11710-200">The failover is managed using additional software that is not part of the application.</span><span class="sxs-lookup"><span data-stu-id="11710-200">The failover is managed using additional software that is not part of the application.</span></span>

<span data-ttu-id="11710-201">With this approach, the application is deployed in one cloud and its VM is replicated to the other cloud.</span><span class="sxs-lookup"><span data-stu-id="11710-201">With this approach, the application is deployed in one cloud and its VM is replicated to the other cloud.</span></span> <span data-ttu-id="11710-202">If a failover is triggered, the secondary VMs need to be powered on in the second cloud.</span><span class="sxs-lookup"><span data-stu-id="11710-202">If a failover is triggered, the secondary VMs need to be powered on in the second cloud.</span></span> <span data-ttu-id="11710-203">In some scenarios, the failover creates the VMs and attaches disks to them.</span><span class="sxs-lookup"><span data-stu-id="11710-203">In some scenarios, the failover creates the VMs and attaches disks to them.</span></span> <span data-ttu-id="11710-204">This process can take a long time to complete, especially with a multi-tiered application that requires a specific start-up sequence.</span><span class="sxs-lookup"><span data-stu-id="11710-204">This process can take a long time to complete, especially with a multi-tiered application that requires a specific start-up sequence.</span></span> <span data-ttu-id="11710-205">There may also be steps that must be run before the application is ready to start servicing requests.</span><span class="sxs-lookup"><span data-stu-id="11710-205">There may also be steps that must be run before the application is ready to start servicing requests.</span></span>

![Replication-manual failover](media\azure-stack-manage-vm-backup\vm_backupdataflow_02.png)

 - <span data-ttu-id="11710-207">RTO: Downtime measured in minutes</span><span class="sxs-lookup"><span data-stu-id="11710-207">RTO: Downtime measured in minutes</span></span>
 - <span data-ttu-id="11710-208">RPO: Variable data loss (depending on replication frequency)</span><span class="sxs-lookup"><span data-stu-id="11710-208">RPO: Variable data loss (depending on replication frequency)</span></span>
 - <span data-ttu-id="11710-209">Deployment topology: Active/Passive stand-by</span><span class="sxs-lookup"><span data-stu-id="11710-209">Deployment topology: Active/Passive stand-by</span></span>
 
### <a name="high-availabilityautomatic-failover"></a><span data-ttu-id="11710-210">High availability/automatic failover</span><span class="sxs-lookup"><span data-stu-id="11710-210">High availability/automatic failover</span></span>

<span data-ttu-id="11710-211">For applications where your business can tolerate a few seconds or minutes of downtime and minimal data loss, you will need to consider a high-availability configuration.</span><span class="sxs-lookup"><span data-stu-id="11710-211">For applications where your business can tolerate a few seconds or minutes of downtime and minimal data loss, you will need to consider a high-availability configuration.</span></span> <span data-ttu-id="11710-212">High-availability applications are designed to quickly and automatically recover from faults.</span><span class="sxs-lookup"><span data-stu-id="11710-212">High-availability applications are designed to quickly and automatically recover from faults.</span></span> <span data-ttu-id="11710-213">For local hardware faults, Azure Stack infrastructure implements high availability in the physical network using two top of rack switches.</span><span class="sxs-lookup"><span data-stu-id="11710-213">For local hardware faults, Azure Stack infrastructure implements high availability in the physical network using two top of rack switches.</span></span> <span data-ttu-id="11710-214">For compute level faults, Azure Stack uses multiple nodes in a scale unit.</span><span class="sxs-lookup"><span data-stu-id="11710-214">For compute level faults, Azure Stack uses multiple nodes in a scale unit.</span></span> <span data-ttu-id="11710-215">At the VM level, you can use scale sets in combination with fault domains to ensure node failures do not take down your application.</span><span class="sxs-lookup"><span data-stu-id="11710-215">At the VM level, you can use scale sets in combination with fault domains to ensure node failures do not take down your application.</span></span>

<span data-ttu-id="11710-216">In combination with scale sets, your application will need to support high availability natively or support the use of clustering software.</span><span class="sxs-lookup"><span data-stu-id="11710-216">In combination with scale sets, your application will need to support high availability natively or support the use of clustering software.</span></span> <span data-ttu-id="11710-217">For example, Microsoft SQL Server supports high availability natively for databases using synchronous-commit mode.</span><span class="sxs-lookup"><span data-stu-id="11710-217">For example, Microsoft SQL Server supports high availability natively for databases using synchronous-commit mode.</span></span> <span data-ttu-id="11710-218">However, if you can only support asynchronous replication, then there will be some data loss.</span><span class="sxs-lookup"><span data-stu-id="11710-218">However, if you can only support asynchronous replication, then there will be some data loss.</span></span> <span data-ttu-id="11710-219">Applications can also be deployed into a failover cluster where the clustering software handles the automatic failover of the application.</span><span class="sxs-lookup"><span data-stu-id="11710-219">Applications can also be deployed into a failover cluster where the clustering software handles the automatic failover of the application.</span></span>

<span data-ttu-id="11710-220">Using this approach, the application is only active in one cloud, but the software is deployed to multiple clouds.</span><span class="sxs-lookup"><span data-stu-id="11710-220">Using this approach, the application is only active in one cloud, but the software is deployed to multiple clouds.</span></span> <span data-ttu-id="11710-221">The other clouds are in stand-by mode ready to start the application when the failover is triggered.</span><span class="sxs-lookup"><span data-stu-id="11710-221">The other clouds are in stand-by mode ready to start the application when the failover is triggered.</span></span>

 - <span data-ttu-id="11710-222">RTO: Downtime measured in seconds</span><span class="sxs-lookup"><span data-stu-id="11710-222">RTO: Downtime measured in seconds</span></span>
 - <span data-ttu-id="11710-223">RPO: Minimal data loss</span><span class="sxs-lookup"><span data-stu-id="11710-223">RPO: Minimal data loss</span></span>
 - <span data-ttu-id="11710-224">Deployment topology: Active/Active stand-by</span><span class="sxs-lookup"><span data-stu-id="11710-224">Deployment topology: Active/Active stand-by</span></span>

### <a name="fault-tolerance"></a><span data-ttu-id="11710-225">Fault tolerance</span><span class="sxs-lookup"><span data-stu-id="11710-225">Fault tolerance</span></span>

<span data-ttu-id="11710-226">Azure Stack physical redundancy and infrastructure service availability only protect against hardware level faults/failures such  a disk, power supply, network port, or node.</span><span class="sxs-lookup"><span data-stu-id="11710-226">Azure Stack physical redundancy and infrastructure service availability only protect against hardware level faults/failures such  a disk, power supply, network port, or node.</span></span> <span data-ttu-id="11710-227">However, if your application must always be available and can never lose any data, you will need to implement fault tolerance natively in your application or use additional software to enable fault tolerance.</span><span class="sxs-lookup"><span data-stu-id="11710-227">However, if your application must always be available and can never lose any data, you will need to implement fault tolerance natively in your application or use additional software to enable fault tolerance.</span></span>

<span data-ttu-id="11710-228">First, you need to ensure the application VMs are deployed using scale sets to protect against node-level failures.</span><span class="sxs-lookup"><span data-stu-id="11710-228">First, you need to ensure the application VMs are deployed using scale sets to protect against node-level failures.</span></span> <span data-ttu-id="11710-229">To protect against the cloud going offline, the same application must already be deployed to a different cloud, so it can continue servicing requests without interruption.</span><span class="sxs-lookup"><span data-stu-id="11710-229">To protect against the cloud going offline, the same application must already be deployed to a different cloud, so it can continue servicing requests without interruption.</span></span> <span data-ttu-id="11710-230">This model is typically referred to an active-active deployment.</span><span class="sxs-lookup"><span data-stu-id="11710-230">This model is typically referred to an active-active deployment.</span></span>

<span data-ttu-id="11710-231">Keep in mind that each Azure Stack cloud is independent of each other, so the clouds are always considered active from an infrastructure perspective.</span><span class="sxs-lookup"><span data-stu-id="11710-231">Keep in mind that each Azure Stack cloud is independent of each other, so the clouds are always considered active from an infrastructure perspective.</span></span> <span data-ttu-id="11710-232">In this case, multiple active instances of the application are deployed to one or more active clouds.</span><span class="sxs-lookup"><span data-stu-id="11710-232">In this case, multiple active instances of the application are deployed to one or more active clouds.</span></span>

 - <span data-ttu-id="11710-233">RTO: No downtime</span><span class="sxs-lookup"><span data-stu-id="11710-233">RTO: No downtime</span></span>
 - <span data-ttu-id="11710-234">RPO: No data loss</span><span class="sxs-lookup"><span data-stu-id="11710-234">RPO: No data loss</span></span>
 - <span data-ttu-id="11710-235">Deployment topology: Active/Active</span><span class="sxs-lookup"><span data-stu-id="11710-235">Deployment topology: Active/Active</span></span>

### <a name="no-recovery"></a><span data-ttu-id="11710-236">No recovery</span><span class="sxs-lookup"><span data-stu-id="11710-236">No recovery</span></span>

<span data-ttu-id="11710-237">Some applications in your environment may not need protection against unplanned downtime or data loss.</span><span class="sxs-lookup"><span data-stu-id="11710-237">Some applications in your environment may not need protection against unplanned downtime or data loss.</span></span> <span data-ttu-id="11710-238">For example, VMs used for development and testing typically do not need to be recovered.</span><span class="sxs-lookup"><span data-stu-id="11710-238">For example, VMs used for development and testing typically do not need to be recovered.</span></span> <span data-ttu-id="11710-239">It is your decision to do without protection for an application or a specific VM.</span><span class="sxs-lookup"><span data-stu-id="11710-239">It is your decision to do without protection for an application or a specific VM.</span></span> <span data-ttu-id="11710-240">Azure Stack does not offer backup or replication of VMs from the underlying infrastructure.</span><span class="sxs-lookup"><span data-stu-id="11710-240">Azure Stack does not offer backup or replication of VMs from the underlying infrastructure.</span></span> <span data-ttu-id="11710-241">Similar to Azure, you will need to opt-in to protection for each VM in each of your subscriptions.</span><span class="sxs-lookup"><span data-stu-id="11710-241">Similar to Azure, you will need to opt-in to protection for each VM in each of your subscriptions.</span></span>

 - <span data-ttu-id="11710-242">RTO: Unrecoverable</span><span class="sxs-lookup"><span data-stu-id="11710-242">RTO: Unrecoverable</span></span>
 - <span data-ttu-id="11710-243">RPO: Complete data loss</span><span class="sxs-lookup"><span data-stu-id="11710-243">RPO: Complete data loss</span></span>

## <a name="recommended-topologies"></a><span data-ttu-id="11710-244">Recommended topologies</span><span class="sxs-lookup"><span data-stu-id="11710-244">Recommended topologies</span></span>

<span data-ttu-id="11710-245">Important considerations for your Azure Stack deployment:</span><span class="sxs-lookup"><span data-stu-id="11710-245">Important considerations for your Azure Stack deployment:</span></span>

|     | <span data-ttu-id="11710-246">Recommendation</span><span class="sxs-lookup"><span data-stu-id="11710-246">Recommendation</span></span> | <span data-ttu-id="11710-247">Comments</span><span class="sxs-lookup"><span data-stu-id="11710-247">Comments</span></span> |
|-------------------------------------------------------------------------------------------------|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="11710-248">Backup/restore VMs to an external backup target already deployed in your datacenter</span><span class="sxs-lookup"><span data-stu-id="11710-248">Backup/restore VMs to an external backup target already deployed in your datacenter</span></span> | <span data-ttu-id="11710-249">Recommended</span><span class="sxs-lookup"><span data-stu-id="11710-249">Recommended</span></span> | <span data-ttu-id="11710-250">Take advantage of existing backup infrastructure and operational skills.</span><span class="sxs-lookup"><span data-stu-id="11710-250">Take advantage of existing backup infrastructure and operational skills.</span></span> <span data-ttu-id="11710-251">Make sure to size the backup infrastructure so it is ready to protect the additional VM instances.</span><span class="sxs-lookup"><span data-stu-id="11710-251">Make sure to size the backup infrastructure so it is ready to protect the additional VM instances.</span></span> <span data-ttu-id="11710-252">Make sure backup infrastructure is not in close proximity to your source.</span><span class="sxs-lookup"><span data-stu-id="11710-252">Make sure backup infrastructure is not in close proximity to your source.</span></span> <span data-ttu-id="11710-253">You can restore VMs to the source Azure Stack, to a secondary Azure Stack instance, or Azure.</span><span class="sxs-lookup"><span data-stu-id="11710-253">You can restore VMs to the source Azure Stack, to a secondary Azure Stack instance, or Azure.</span></span> |
| <span data-ttu-id="11710-254">Backup/restore VMs to an external backup target dedicated to Azure Stack</span><span class="sxs-lookup"><span data-stu-id="11710-254">Backup/restore VMs to an external backup target dedicated to Azure Stack</span></span> | <span data-ttu-id="11710-255">Recommended</span><span class="sxs-lookup"><span data-stu-id="11710-255">Recommended</span></span> | <span data-ttu-id="11710-256">You can purchase new backup infrastructure or provision dedicated backup infrastructure for Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="11710-256">You can purchase new backup infrastructure or provision dedicated backup infrastructure for Azure Stack.</span></span> <span data-ttu-id="11710-257">Make sure backup infrastructure is not in close proximity to your source.</span><span class="sxs-lookup"><span data-stu-id="11710-257">Make sure backup infrastructure is not in close proximity to your source.</span></span> <span data-ttu-id="11710-258">You can restore VMs to the source Azure Stack, to a secondary Azure Stack instance, or Azure.</span><span class="sxs-lookup"><span data-stu-id="11710-258">You can restore VMs to the source Azure Stack, to a secondary Azure Stack instance, or Azure.</span></span> |
| <span data-ttu-id="11710-259">Backup/restore VMs directly to global Azure or a trusted service provider</span><span class="sxs-lookup"><span data-stu-id="11710-259">Backup/restore VMs directly to global Azure or a trusted service provider</span></span> | <span data-ttu-id="11710-260">Recommended</span><span class="sxs-lookup"><span data-stu-id="11710-260">Recommended</span></span> | <span data-ttu-id="11710-261">As long as you can meet your data privacy and regulatory requirements, you can store your backups in global Azure or a trusted service provider.</span><span class="sxs-lookup"><span data-stu-id="11710-261">As long as you can meet your data privacy and regulatory requirements, you can store your backups in global Azure or a trusted service provider.</span></span> <span data-ttu-id="11710-262">Ideally the service provider is also running Azure Stack so you get consistency in operational experience when you restore.</span><span class="sxs-lookup"><span data-stu-id="11710-262">Ideally the service provider is also running Azure Stack so you get consistency in operational experience when you restore.</span></span> |
| <span data-ttu-id="11710-263">Replicate/failover VMs to a separate Azure Stack instance</span><span class="sxs-lookup"><span data-stu-id="11710-263">Replicate/failover VMs to a separate Azure Stack instance</span></span> | <span data-ttu-id="11710-264">Recommended</span><span class="sxs-lookup"><span data-stu-id="11710-264">Recommended</span></span> | <span data-ttu-id="11710-265">In the failover case, you will need to have a second Azure Stack cloud fully operational so you can avoid extended application downtime.</span><span class="sxs-lookup"><span data-stu-id="11710-265">In the failover case, you will need to have a second Azure Stack cloud fully operational so you can avoid extended application downtime.</span></span> |
| <span data-ttu-id="11710-266">Replicate/failover VMs directly to Azure or a trusted service provider</span><span class="sxs-lookup"><span data-stu-id="11710-266">Replicate/failover VMs directly to Azure or a trusted service provider</span></span> | <span data-ttu-id="11710-267">Recommended</span><span class="sxs-lookup"><span data-stu-id="11710-267">Recommended</span></span> | <span data-ttu-id="11710-268">As long as you can meet your data privacy and regulatory requirements, you can replicate your data to global Azure or a trusted service provider.</span><span class="sxs-lookup"><span data-stu-id="11710-268">As long as you can meet your data privacy and regulatory requirements, you can replicate your data to global Azure or a trusted service provider.</span></span> <span data-ttu-id="11710-269">Ideally the service provider is also running Azure Stack so you get consistency in operational experience after failover.</span><span class="sxs-lookup"><span data-stu-id="11710-269">Ideally the service provider is also running Azure Stack so you get consistency in operational experience after failover.</span></span> |
| <span data-ttu-id="11710-270">Deploy backup target on the same Azure Stack cloud with your application data</span><span class="sxs-lookup"><span data-stu-id="11710-270">Deploy backup target on the same Azure Stack cloud with your application data</span></span> | <span data-ttu-id="11710-271">Not recommended</span><span class="sxs-lookup"><span data-stu-id="11710-271">Not recommended</span></span> | <span data-ttu-id="11710-272">Avoid storing backups within the same Azure Stack cloud.</span><span class="sxs-lookup"><span data-stu-id="11710-272">Avoid storing backups within the same Azure Stack cloud.</span></span> <span data-ttu-id="11710-273">Unplanned downtime of the cloud can keep you from your primary data and backup data.</span><span class="sxs-lookup"><span data-stu-id="11710-273">Unplanned downtime of the cloud can keep you from your primary data and backup data.</span></span> <span data-ttu-id="11710-274">If you choose to deploy a backup target as a virtual appliance (for the purposes of optimization for backup and restore), you must ensure all data is continuously copied to an external backup location.</span><span class="sxs-lookup"><span data-stu-id="11710-274">If you choose to deploy a backup target as a virtual appliance (for the purposes of optimization for backup and restore), you must ensure all data is continuously copied to an external backup location.</span></span> |
| <span data-ttu-id="11710-275">Deploy physical backup appliance into the same rack where the Azure Stack solution is installed</span><span class="sxs-lookup"><span data-stu-id="11710-275">Deploy physical backup appliance into the same rack where the Azure Stack solution is installed</span></span> | <span data-ttu-id="11710-276">Not supported</span><span class="sxs-lookup"><span data-stu-id="11710-276">Not supported</span></span> | <span data-ttu-id="11710-277">At this point in time, you cannot connect any other devices to the top of rack switches that are not part of the original solution.</span><span class="sxs-lookup"><span data-stu-id="11710-277">At this point in time, you cannot connect any other devices to the top of rack switches that are not part of the original solution.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="11710-278">Next steps</span><span class="sxs-lookup"><span data-stu-id="11710-278">Next steps</span></span>

<span data-ttu-id="11710-279">This article provided general guidelines for protecting user VMs deployed on Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="11710-279">This article provided general guidelines for protecting user VMs deployed on Azure Stack.</span></span> <span data-ttu-id="11710-280">For information about using Azure services to protect user VMs, refer to:</span><span class="sxs-lookup"><span data-stu-id="11710-280">For information about using Azure services to protect user VMs, refer to:</span></span>

 - [<span data-ttu-id="11710-281">Use Azure Backup to back up files and applications on Azure Stack</span><span class="sxs-lookup"><span data-stu-id="11710-281">Use Azure Backup to back up files and applications on Azure Stack</span></span>](https://docs.microsoft.com/azure/backup/backup-mabs-files-applications-azure-stack)
 - [<span data-ttu-id="11710-282">Azure Backup Server support for Azure Stack</span><span class="sxs-lookup"><span data-stu-id="11710-282">Azure Backup Server support for Azure Stack</span></span>](https://docs.microsoft.com/azure/backup/ ) 
 - [<span data-ttu-id="11710-283">Azure Site Recovery support for Azure Stack</span><span class="sxs-lookup"><span data-stu-id="11710-283">Azure Site Recovery support for Azure Stack</span></span>](https://docs.microsoft.com/azure/site-recovery/)  

<span data-ttu-id="11710-284">To learn more about the partner products that offer VM protection on Azure Stack, refer to "[Protecting applications and data on Azure Stack](https://azure.microsoft.com/blog/protecting-applications-and-data-on-azure-stack/)."</span><span class="sxs-lookup"><span data-stu-id="11710-284">To learn more about the partner products that offer VM protection on Azure Stack, refer to "[Protecting applications and data on Azure Stack](https://azure.microsoft.com/blog/protecting-applications-and-data-on-azure-stack/)."</span></span>
