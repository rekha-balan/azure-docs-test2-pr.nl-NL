---
title: Manage Windows Azure Pack virtual machines from Azure Stack | Microsoft Docs
description: Learn how to manage Windows Azure Pack (WAP) VMs from the user portal in Azure Stack.
services: azure-stack
documentationcenter: ''
author: walterov
manager: byronr
editor: ''
ms.assetid: 213c2792-d404-4b44-8340-235adf3f8f0b
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/06/2017
ms.author: walterov
ms.openlocfilehash: cf0922f221c7da9e5a6e14ca453f25d0c1103a9c
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44671405"
---
# <a name="manage-windows-azure-pack-virtual-machines-from-azure-stack"></a><span data-ttu-id="f218c-103">Manage Windows Azure Pack virtual machines from Azure Stack</span><span class="sxs-lookup"><span data-stu-id="f218c-103">Manage Windows Azure Pack virtual machines from Azure Stack</span></span>
<span data-ttu-id="f218c-104">In the Azure Stack Technical Preview 3 (TP3) release, you can enable access from the Azure Stack user portal to tenant virtual machines running on Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="f218c-104">In the Azure Stack Technical Preview 3 (TP3) release, you can enable access from the Azure Stack user portal to tenant virtual machines running on Windows Azure Pack.</span></span> <span data-ttu-id="f218c-105">Tenants can use the Azure Stack portal to manage their existing IaaS virtual machines and virtual networks.</span><span class="sxs-lookup"><span data-stu-id="f218c-105">Tenants can use the Azure Stack portal to manage their existing IaaS virtual machines and virtual networks.</span></span> <span data-ttu-id="f218c-106">These resources are made available on Windows Azure Pack through the underlying Service Provider Foundation (SPF) and Virtual Machine Manager (VMM) components.</span><span class="sxs-lookup"><span data-stu-id="f218c-106">These resources are made available on Windows Azure Pack through the underlying Service Provider Foundation (SPF) and Virtual Machine Manager (VMM) components.</span></span> <span data-ttu-id="f218c-107">Specifically, tenants can:</span><span class="sxs-lookup"><span data-stu-id="f218c-107">Specifically, tenants can:</span></span>

* <span data-ttu-id="f218c-108">Browse resources</span><span class="sxs-lookup"><span data-stu-id="f218c-108">Browse resources</span></span>
* <span data-ttu-id="f218c-109">Examine configuration values</span><span class="sxs-lookup"><span data-stu-id="f218c-109">Examine configuration values</span></span>
* <span data-ttu-id="f218c-110">Stop or start a virtual machine</span><span class="sxs-lookup"><span data-stu-id="f218c-110">Stop or start a virtual machine</span></span>
* <span data-ttu-id="f218c-111">Connect to a virtual machine through Remote Desktop Protocol (RDP)</span><span class="sxs-lookup"><span data-stu-id="f218c-111">Connect to a virtual machine through Remote Desktop Protocol (RDP)</span></span>
* <span data-ttu-id="f218c-112">Create and manage checkpoints</span><span class="sxs-lookup"><span data-stu-id="f218c-112">Create and manage checkpoints</span></span>
* <span data-ttu-id="f218c-113">Delete virtual machines and virtual networks</span><span class="sxs-lookup"><span data-stu-id="f218c-113">Delete virtual machines and virtual networks</span></span>

<span data-ttu-id="f218c-114">This functionality is provided by the Windows Azure Pack Connector for Azure Stack (Preview).</span><span class="sxs-lookup"><span data-stu-id="f218c-114">This functionality is provided by the Windows Azure Pack Connector for Azure Stack (Preview).</span></span> <span data-ttu-id="f218c-115">This article shows how to configure the connector for a single-node Azure Stack environment.</span><span class="sxs-lookup"><span data-stu-id="f218c-115">This article shows how to configure the connector for a single-node Azure Stack environment.</span></span>

<span data-ttu-id="f218c-116">For this preview release, be aware of the following:</span><span class="sxs-lookup"><span data-stu-id="f218c-116">For this preview release, be aware of the following:</span></span>
* <span data-ttu-id="f218c-117">Use the Windows Azure Pack Connector only in test environments (for both Azure Stack and Windows Azure Pack), and not in production deployments.</span><span class="sxs-lookup"><span data-stu-id="f218c-117">Use the Windows Azure Pack Connector only in test environments (for both Azure Stack and Windows Azure Pack), and not in production deployments.</span></span>
* <span data-ttu-id="f218c-118">You must have Windows Azure Pack Update Rollup (UR) 9.1 or later and System Center SPF and VMM UR 9 or later.</span><span class="sxs-lookup"><span data-stu-id="f218c-118">You must have Windows Azure Pack Update Rollup (UR) 9.1 or later and System Center SPF and VMM UR 9 or later.</span></span>
* <span data-ttu-id="f218c-119">The VMM and SPF components can be either System Center 2012 R2 or System Center 2016.</span><span class="sxs-lookup"><span data-stu-id="f218c-119">The VMM and SPF components can be either System Center 2012 R2 or System Center 2016.</span></span>
* <span data-ttu-id="f218c-120">You must perform configuration steps on both Azure Stack and on Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="f218c-120">You must perform configuration steps on both Azure Stack and on Windows Azure Pack.</span></span>
* <span data-ttu-id="f218c-121">The instructions apply to non-Cloud Platform System (CPS) environments.</span><span class="sxs-lookup"><span data-stu-id="f218c-121">The instructions apply to non-Cloud Platform System (CPS) environments.</span></span>
* <span data-ttu-id="f218c-122">To review the known issues, see [Microsoft Azure Stack troubleshooting](azure-stack-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="f218c-122">To review the known issues, see [Microsoft Azure Stack troubleshooting](azure-stack-troubleshooting.md).</span></span>


## <a name="architecture"></a><span data-ttu-id="f218c-123">Architecture</span><span class="sxs-lookup"><span data-stu-id="f218c-123">Architecture</span></span>
<span data-ttu-id="f218c-124">The following diagram shows the main components of the Windows Azure Pack Connector.</span><span class="sxs-lookup"><span data-stu-id="f218c-124">The following diagram shows the main components of the Windows Azure Pack Connector.</span></span>

![The Windows Azure Pack Connector components](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-stack/media/azure-stack-manage-wap/image1.PNG)

<span data-ttu-id="f218c-126">Notice the following details:</span><span class="sxs-lookup"><span data-stu-id="f218c-126">Notice the following details:</span></span>
* <span data-ttu-id="f218c-127">The Azure Stack user portal accesses the resource information from both clouds (Azure Stack and Windows Azure Pack).</span><span class="sxs-lookup"><span data-stu-id="f218c-127">The Azure Stack user portal accesses the resource information from both clouds (Azure Stack and Windows Azure Pack).</span></span>
* <span data-ttu-id="f218c-128">The user must have an account that is valid in both environments.</span><span class="sxs-lookup"><span data-stu-id="f218c-128">The user must have an account that is valid in both environments.</span></span>
* <span data-ttu-id="f218c-129">The Azure Stack user portal must have network access to the components running on Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="f218c-129">The Azure Stack user portal must have network access to the components running on Windows Azure Pack.</span></span>
* <span data-ttu-id="f218c-130">In the **WAP** section of the diagram, you can see the new Windows Azure Pack Connector modules (WAP Extension and Connector) and the existing Windows Azure Pack Tenant API with SPF and VMM components.</span><span class="sxs-lookup"><span data-stu-id="f218c-130">In the **WAP** section of the diagram, you can see the new Windows Azure Pack Connector modules (WAP Extension and Connector) and the existing Windows Azure Pack Tenant API with SPF and VMM components.</span></span>


## <a name="identity-management"></a><span data-ttu-id="f218c-131">Identity management</span><span class="sxs-lookup"><span data-stu-id="f218c-131">Identity management</span></span>
<span data-ttu-id="f218c-132">The Windows Azure Pack Tenant API must trust the Azure Stack security token service (STS).</span><span class="sxs-lookup"><span data-stu-id="f218c-132">The Windows Azure Pack Tenant API must trust the Azure Stack security token service (STS).</span></span>

<span data-ttu-id="f218c-133">When a user performs an action through the Azure Stack portal that targets Windows Azure Pack resources, the portal uses the Windows Azure Pack Tenant API.</span><span class="sxs-lookup"><span data-stu-id="f218c-133">When a user performs an action through the Azure Stack portal that targets Windows Azure Pack resources, the portal uses the Windows Azure Pack Tenant API.</span></span> <span data-ttu-id="f218c-134">Therefore, the provided user authentication token must come from a trusted STS.</span><span class="sxs-lookup"><span data-stu-id="f218c-134">Therefore, the provided user authentication token must come from a trusted STS.</span></span> <span data-ttu-id="f218c-135">See the following diagram:</span><span class="sxs-lookup"><span data-stu-id="f218c-135">See the following diagram:</span></span>

![Diagram of Windows Azure Pack Connector authentication](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-stack/media/azure-stack-manage-wap/image2.PNG)

<span data-ttu-id="f218c-137">In the single-node Azure Stack environment, Windows Azure Pack and Azure Stack have independent identity providers.</span><span class="sxs-lookup"><span data-stu-id="f218c-137">In the single-node Azure Stack environment, Windows Azure Pack and Azure Stack have independent identity providers.</span></span> <span data-ttu-id="f218c-138">Users who access both environments from the Azure Stack portal must have the same user principal name (UPN) name in both identity providers.</span><span class="sxs-lookup"><span data-stu-id="f218c-138">Users who access both environments from the Azure Stack portal must have the same user principal name (UPN) name in both identity providers.</span></span> <span data-ttu-id="f218c-139">For example, the account *azurestackadmin@azurestack.local* should also exist in the STS for Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="f218c-139">For example, the account *azurestackadmin@azurestack.local* should also exist in the STS for Windows Azure Pack.</span></span> <span data-ttu-id="f218c-140">For the single-node environment, where AD FS is not set up to support outbound trust relationships, you will establish trust from the Windows Azure Pack components (Tenant API) to the Azure Stack instance of AD FS.</span><span class="sxs-lookup"><span data-stu-id="f218c-140">For the single-node environment, where AD FS is not set up to support outbound trust relationships, you will establish trust from the Windows Azure Pack components (Tenant API) to the Azure Stack instance of AD FS.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="f218c-141">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="f218c-141">Prerequisites</span></span>

### <a name="download-the-windows-azure-pack-connector"></a><span data-ttu-id="f218c-142">Download the Windows Azure Pack Connector</span><span class="sxs-lookup"><span data-stu-id="f218c-142">Download the Windows Azure Pack Connector</span></span>
<span data-ttu-id="f218c-143">On the [Microsoft Download Center](https://aka.ms/wapconnectorazurestackdlc), download the .exe file and extract it to your local computer.</span><span class="sxs-lookup"><span data-stu-id="f218c-143">On the [Microsoft Download Center](https://aka.ms/wapconnectorazurestackdlc), download the .exe file and extract it to your local computer.</span></span> <span data-ttu-id="f218c-144">Later, you copy the contents to a computer that can access your Windows Azure Pack environment.</span><span class="sxs-lookup"><span data-stu-id="f218c-144">Later, you copy the contents to a computer that can access your Windows Azure Pack environment.</span></span>

### <a name="deployment-option-requirement"></a><span data-ttu-id="f218c-145">Deployment option requirement</span><span class="sxs-lookup"><span data-stu-id="f218c-145">Deployment option requirement</span></span>
<span data-ttu-id="f218c-146">To integrate with Windows Azure Pack, you can deploy Azure Stack by using the AD FS option or the Azure Active Directory option.</span><span class="sxs-lookup"><span data-stu-id="f218c-146">To integrate with Windows Azure Pack, you can deploy Azure Stack by using the AD FS option or the Azure Active Directory option.</span></span>

### <a name="connectivity-requirements"></a><span data-ttu-id="f218c-147">Connectivity requirements</span><span class="sxs-lookup"><span data-stu-id="f218c-147">Connectivity requirements</span></span>
1. <span data-ttu-id="f218c-148">From the computer on which you access the Azure Stack user portal, make sure that you can access the Windows Azure Pack tenant portal through the web browser.</span><span class="sxs-lookup"><span data-stu-id="f218c-148">From the computer on which you access the Azure Stack user portal, make sure that you can access the Windows Azure Pack tenant portal through the web browser.</span></span>
2. <span data-ttu-id="f218c-149">The MAS-WASP01 virtual machine on Azure Stack must be able to connect to the Windows Azure Pack tenant portal computer.</span><span class="sxs-lookup"><span data-stu-id="f218c-149">The MAS-WASP01 virtual machine on Azure Stack must be able to connect to the Windows Azure Pack tenant portal computer.</span></span> <span data-ttu-id="f218c-150">Use Ping.exe to verify network connectivity.</span><span class="sxs-lookup"><span data-stu-id="f218c-150">Use Ping.exe to verify network connectivity.</span></span> 
3.  <span data-ttu-id="f218c-151">You must have valid certificates for the new Connector services.</span><span class="sxs-lookup"><span data-stu-id="f218c-151">You must have valid certificates for the new Connector services.</span></span> <span data-ttu-id="f218c-152">These SSL certificates must be issued by a trusted certification authority (CA).</span><span class="sxs-lookup"><span data-stu-id="f218c-152">These SSL certificates must be issued by a trusted certification authority (CA).</span></span> <span data-ttu-id="f218c-153">You can't use self-signed certificates.</span><span class="sxs-lookup"><span data-stu-id="f218c-153">You can't use self-signed certificates.</span></span> <span data-ttu-id="f218c-154">The SSL certificates must be trusted by Azure Stack (specifically the MAS-WASP01 VM) and any other computer that the tenant may use to access the Azure Stack user portal.</span><span class="sxs-lookup"><span data-stu-id="f218c-154">The SSL certificates must be trusted by Azure Stack (specifically the MAS-WASP01 VM) and any other computer that the tenant may use to access the Azure Stack user portal.</span></span>
 
    >[!NOTE]
    <span data-ttu-id="f218c-155">Because MAS-WASP01 runs Windows Server with the Server Core installation option, you can use a command-line tool such as Certutil.ext to import the certificate.</span><span class="sxs-lookup"><span data-stu-id="f218c-155">Because MAS-WASP01 runs Windows Server with the Server Core installation option, you can use a command-line tool such as Certutil.ext to import the certificate.</span></span> <span data-ttu-id="f218c-156">For example, you could copy the .cer file to c:\temp on MAS-WASP01, and then run the command **certutil -addstore "CA" "c:\temp\certname.cer"**.</span><span class="sxs-lookup"><span data-stu-id="f218c-156">For example, you could copy the .cer file to c:\temp on MAS-WASP01, and then run the command **certutil -addstore "CA" "c:\temp\certname.cer"**.</span></span>

4.  <span data-ttu-id="f218c-157">To establish RDP connectivity to Windows Azure Pack tenant virtual machines through the Azure Stack portal, the Windows Azure Pack environment must allow Remote Desktop traffic to the tenant VMs.</span><span class="sxs-lookup"><span data-stu-id="f218c-157">To establish RDP connectivity to Windows Azure Pack tenant virtual machines through the Azure Stack portal, the Windows Azure Pack environment must allow Remote Desktop traffic to the tenant VMs.</span></span>
5.  <span data-ttu-id="f218c-158">For connectivity between Azure Stack tenant virtual machines and Windows Azure Pack tenant virtual machines, their external IP addresses must be routable across the two environments.</span><span class="sxs-lookup"><span data-stu-id="f218c-158">For connectivity between Azure Stack tenant virtual machines and Windows Azure Pack tenant virtual machines, their external IP addresses must be routable across the two environments.</span></span> <span data-ttu-id="f218c-159">This connectivity could also include associating a DNS server to resolve virtual machine names between the environments.</span><span class="sxs-lookup"><span data-stu-id="f218c-159">This connectivity could also include associating a DNS server to resolve virtual machine names between the environments.</span></span>

### <a name="iis-requirements"></a><span data-ttu-id="f218c-160">IIS requirements</span><span class="sxs-lookup"><span data-stu-id="f218c-160">IIS requirements</span></span>
<span data-ttu-id="f218c-161">The computer that hosts the Windows Azure Pack tenant portal (which may be a physical host, a virtual machine, or multiple virtual machines) must have the URL Rewrite IIS extension installed.</span><span class="sxs-lookup"><span data-stu-id="f218c-161">The computer that hosts the Windows Azure Pack tenant portal (which may be a physical host, a virtual machine, or multiple virtual machines) must have the URL Rewrite IIS extension installed.</span></span> <span data-ttu-id="f218c-162">If it is not already installed, you can download it from [here](https://www.iis.net/downloads/microsoft/url-rewrite).</span><span class="sxs-lookup"><span data-stu-id="f218c-162">If it is not already installed, you can download it from [here](https://www.iis.net/downloads/microsoft/url-rewrite).</span></span> <span data-ttu-id="f218c-163">If multiple virtual machines host the tenant portal, install the extension on each virtual machine.</span><span class="sxs-lookup"><span data-stu-id="f218c-163">If multiple virtual machines host the tenant portal, install the extension on each virtual machine.</span></span>

## <a name="configure-azure-stack"></a><span data-ttu-id="f218c-164">Configure Azure Stack</span><span class="sxs-lookup"><span data-stu-id="f218c-164">Configure Azure Stack</span></span>
<span data-ttu-id="f218c-165">Before you configure the Windows Azure Pack Connector, you must enable multi-cloud mode in the Azure Stack user portal.</span><span class="sxs-lookup"><span data-stu-id="f218c-165">Before you configure the Windows Azure Pack Connector, you must enable multi-cloud mode in the Azure Stack user portal.</span></span> <span data-ttu-id="f218c-166">This mode enables users to select from which cloud to access resources.</span><span class="sxs-lookup"><span data-stu-id="f218c-166">This mode enables users to select from which cloud to access resources.</span></span>

<span data-ttu-id="f218c-167">To enable multi-cloud mode, you must run the ConfigureAzurePackConnector.ps1 script after Azure Stack deployment.</span><span class="sxs-lookup"><span data-stu-id="f218c-167">To enable multi-cloud mode, you must run the ConfigureAzurePackConnector.ps1 script after Azure Stack deployment.</span></span> <span data-ttu-id="f218c-168">The following table describes the script parameters.</span><span class="sxs-lookup"><span data-stu-id="f218c-168">The following table describes the script parameters.</span></span>


|  <span data-ttu-id="f218c-169">Parameter</span><span class="sxs-lookup"><span data-stu-id="f218c-169">Parameter</span></span> | <span data-ttu-id="f218c-170">Description</span><span class="sxs-lookup"><span data-stu-id="f218c-170">Description</span></span> | <span data-ttu-id="f218c-171">Example</span><span class="sxs-lookup"><span data-stu-id="f218c-171">Example</span></span> |   
| -------- | ------------- | ------- |  
| <span data-ttu-id="f218c-172">AzurePackConnectorEndpoint</span><span class="sxs-lookup"><span data-stu-id="f218c-172">AzurePackConnectorEndpoint</span></span> | <span data-ttu-id="f218c-173">URI of the Windows Azure Pack Connector.</span><span class="sxs-lookup"><span data-stu-id="f218c-173">URI of the Windows Azure Pack Connector.</span></span> <span data-ttu-id="f218c-174">This URI should correspond to the Windows Azure Pack tenant portal.</span><span class="sxs-lookup"><span data-stu-id="f218c-174">This URI should correspond to the Windows Azure Pack tenant portal.</span></span> | <span data-ttu-id="f218c-175">https://waptenantportal:40005 (By default, the port value is 40005.)</span><span class="sxs-lookup"><span data-stu-id="f218c-175">https://waptenantportal:40005 (By default, the port value is 40005.)</span></span> |  
| <span data-ttu-id="f218c-176">AzurePackCloudName</span><span class="sxs-lookup"><span data-stu-id="f218c-176">AzurePackCloudName</span></span> | <span data-ttu-id="f218c-177">The display name of the Windows Azure Pack cloud that appears in the cloud selector list in the Azure Stack user portal.</span><span class="sxs-lookup"><span data-stu-id="f218c-177">The display name of the Windows Azure Pack cloud that appears in the cloud selector list in the Azure Stack user portal.</span></span> <span data-ttu-id="f218c-178">In this preview release, you can't use spaces in the display name.</span><span class="sxs-lookup"><span data-stu-id="f218c-178">In this preview release, you can't use spaces in the display name.</span></span> | <span data-ttu-id="f218c-179">"Azure_Pack"</span><span class="sxs-lookup"><span data-stu-id="f218c-179">"Azure_Pack"</span></span>  |
| <span data-ttu-id="f218c-180">AzureStackCloudName</span><span class="sxs-lookup"><span data-stu-id="f218c-180">AzureStackCloudName</span></span> | <span data-ttu-id="f218c-181">The display name of the Azure Stack cloud that appears in the cloud selector list in the Azure Stack user portal.</span><span class="sxs-lookup"><span data-stu-id="f218c-181">The display name of the Azure Stack cloud that appears in the cloud selector list in the Azure Stack user portal.</span></span> <span data-ttu-id="f218c-182">In this preview release, you can't use spaces in the display name.</span><span class="sxs-lookup"><span data-stu-id="f218c-182">In this preview release, you can't use spaces in the display name.</span></span> | <span data-ttu-id="f218c-183">"Azure_Stack"</span><span class="sxs-lookup"><span data-stu-id="f218c-183">"Azure_Stack"</span></span> |
| <span data-ttu-id="f218c-184">EnableMultiCloud</span><span class="sxs-lookup"><span data-stu-id="f218c-184">EnableMultiCloud</span></span> | <span data-ttu-id="f218c-185">A Boolean where true enables multi-cloud mode and false disables it.</span><span class="sxs-lookup"><span data-stu-id="f218c-185">A Boolean where true enables multi-cloud mode and false disables it.</span></span>| <span data-ttu-id="f218c-186">$true</span><span class="sxs-lookup"><span data-stu-id="f218c-186">$true</span></span> |
| | |

<span data-ttu-id="f218c-187">You can run the ConfigureAzurePackConnector.ps1 script immediately after deployment, or later.</span><span class="sxs-lookup"><span data-stu-id="f218c-187">You can run the ConfigureAzurePackConnector.ps1 script immediately after deployment, or later.</span></span> <span data-ttu-id="f218c-188">To run the script immediately after deployment, use the same Windows PowerShell session where Azure Stack deployment completed.</span><span class="sxs-lookup"><span data-stu-id="f218c-188">To run the script immediately after deployment, use the same Windows PowerShell session where Azure Stack deployment completed.</span></span> <span data-ttu-id="f218c-189">Otherwise, you can open a new Windows PowerShell session as an administrator (signed in as the azurestackadmin account).</span><span class="sxs-lookup"><span data-stu-id="f218c-189">Otherwise, you can open a new Windows PowerShell session as an administrator (signed in as the azurestackadmin account).</span></span>

1. <span data-ttu-id="f218c-190">Run the ConfigureAzurePackConnector.ps1 script by using the following command (with values specific to your environment):</span><span class="sxs-lookup"><span data-stu-id="f218c-190">Run the ConfigureAzurePackConnector.ps1 script by using the following command (with values specific to your environment):</span></span>
 
 ```powershell
    C:\CloudDeployment\Setup\Activation\AzurePackConnector\ConfigureAzurePackConnector.ps1 `
    -AzurePackConnectorEndpoint "https://waptenantportal:40005" `
    -AzurePackCloudName "Azure_Pack" `
    -AzureStackCloudName "Azure_Stack" -EnableMultiCloud $true
 ```
    
2. <span data-ttu-id="f218c-191">Make note of the output file that is produced by this script, "$env:TEMP\AzurePackConnectorOutput.txt."</span><span class="sxs-lookup"><span data-stu-id="f218c-191">Make note of the output file that is produced by this script, "$env:TEMP\AzurePackConnectorOutput.txt."</span></span> <span data-ttu-id="f218c-192">This file contains the information that is required to configure the target Windows Azure Pack environment.</span><span class="sxs-lookup"><span data-stu-id="f218c-192">This file contains the information that is required to configure the target Windows Azure Pack environment.</span></span> <span data-ttu-id="f218c-193">You pass this file as a parameter to a script later in these instructions.</span><span class="sxs-lookup"><span data-stu-id="f218c-193">You pass this file as a parameter to a script later in these instructions.</span></span> <span data-ttu-id="f218c-194">This file contains the following information:</span><span class="sxs-lookup"><span data-stu-id="f218c-194">This file contains the following information:</span></span>

    * <span data-ttu-id="f218c-195">**AzurePackConnectorEndpoint**: Contains the endpoint to the Windows Azure Pack Connector service.</span><span class="sxs-lookup"><span data-stu-id="f218c-195">**AzurePackConnectorEndpoint**: Contains the endpoint to the Windows Azure Pack Connector service.</span></span>
    * <span data-ttu-id="f218c-196">**AuthenticationIdentityProviderPartner**: Contains the following value pair:</span><span class="sxs-lookup"><span data-stu-id="f218c-196">**AuthenticationIdentityProviderPartner**: Contains the following value pair:</span></span>
        * <span data-ttu-id="f218c-197">Authentication Token signing certificate that the Windows Azure Pack Tenant API needs to trust to accept calls from the Azure Stack portal extension.</span><span class="sxs-lookup"><span data-stu-id="f218c-197">Authentication Token signing certificate that the Windows Azure Pack Tenant API needs to trust to accept calls from the Azure Stack portal extension.</span></span>

        * <span data-ttu-id="f218c-198">The "Realm" associated with the signing certificate.</span><span class="sxs-lookup"><span data-stu-id="f218c-198">The "Realm" associated with the signing certificate.</span></span> <span data-ttu-id="f218c-199">For example: https://adfs.local.azurestack.global.external/adfs/c1d72562-534e-4aa5-92aa-d65df289a107/.</span><span class="sxs-lookup"><span data-stu-id="f218c-199">For example: https://adfs.local.azurestack.global.external/adfs/c1d72562-534e-4aa5-92aa-d65df289a107/.</span></span>

3.  <span data-ttu-id="f218c-200">Browse to the temp folder that contains the **AzurePackConnectorOutput.txt** file, and copy the file to your local computer.</span><span class="sxs-lookup"><span data-stu-id="f218c-200">Browse to the temp folder that contains the **AzurePackConnectorOutput.txt** file, and copy the file to your local computer.</span></span> <span data-ttu-id="f218c-201">(To determine the temp folder, type **cd $env:temp** in the PowerShell session.)</span><span class="sxs-lookup"><span data-stu-id="f218c-201">(To determine the temp folder, type **cd $env:temp** in the PowerShell session.)</span></span>

4.  <span data-ttu-id="f218c-202">Test the configuration.</span><span class="sxs-lookup"><span data-stu-id="f218c-202">Test the configuration.</span></span>

    <span data-ttu-id="f218c-203">a.</span><span class="sxs-lookup"><span data-stu-id="f218c-203">a.</span></span> <span data-ttu-id="f218c-204">Open your browser and sign in to the Azure Stack user portal (https://portal.local.azurestack.external/).</span><span class="sxs-lookup"><span data-stu-id="f218c-204">Open your browser and sign in to the Azure Stack user portal (https://portal.local.azurestack.external/).</span></span>
    
    <span data-ttu-id="f218c-205">b.</span><span class="sxs-lookup"><span data-stu-id="f218c-205">b.</span></span> <span data-ttu-id="f218c-206">After you sign in as a tenant and the portal loads, you'll see errors about not being able to fetch subscriptions or extensions from the Azure Pack cloud.</span><span class="sxs-lookup"><span data-stu-id="f218c-206">After you sign in as a tenant and the portal loads, you'll see errors about not being able to fetch subscriptions or extensions from the Azure Pack cloud.</span></span> <span data-ttu-id="f218c-207">Click **OK** to close these messages.</span><span class="sxs-lookup"><span data-stu-id="f218c-207">Click **OK** to close these messages.</span></span> <span data-ttu-id="f218c-208">(These error messages will go away after you configure Windows Azure Pack.)</span><span class="sxs-lookup"><span data-stu-id="f218c-208">(These error messages will go away after you configure Windows Azure Pack.)</span></span>

    <span data-ttu-id="f218c-209">c.</span><span class="sxs-lookup"><span data-stu-id="f218c-209">c.</span></span> <span data-ttu-id="f218c-210">Notice the **Cloud** drop-down list in the upper-left corner of the portal.</span><span class="sxs-lookup"><span data-stu-id="f218c-210">Notice the **Cloud** drop-down list in the upper-left corner of the portal.</span></span>

    ![The cloud selector in the Azure Stack user interface](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-stack/media/azure-stack-manage-wap/image3.PNG)

## <a name="configure-windows-azure-pack"></a><span data-ttu-id="f218c-212">Configure Windows Azure Pack</span><span class="sxs-lookup"><span data-stu-id="f218c-212">Configure Windows Azure Pack</span></span>
<span data-ttu-id="f218c-213">For this preview release only, Windows Azure Pack requires manual configuration.</span><span class="sxs-lookup"><span data-stu-id="f218c-213">For this preview release only, Windows Azure Pack requires manual configuration.</span></span>

>[!IMPORTANT]
<span data-ttu-id="f218c-214">For this preview release, use the Windows Azure Pack Connector only in test environments, and not in production deployments.</span><span class="sxs-lookup"><span data-stu-id="f218c-214">For this preview release, use the Windows Azure Pack Connector only in test environments, and not in production deployments.</span></span>

1.  <span data-ttu-id="f218c-215">Install Connector MSI files on the Windows Azure Pack tenant portal virtual machine, and install certificates.</span><span class="sxs-lookup"><span data-stu-id="f218c-215">Install Connector MSI files on the Windows Azure Pack tenant portal virtual machine, and install certificates.</span></span> <span data-ttu-id="f218c-216">(If you have multiple tenant portal virtual machines, you must complete this step on each virtual machine.)</span><span class="sxs-lookup"><span data-stu-id="f218c-216">(If you have multiple tenant portal virtual machines, you must complete this step on each virtual machine.)</span></span>

    <span data-ttu-id="f218c-217">a.</span><span class="sxs-lookup"><span data-stu-id="f218c-217">a.</span></span> <span data-ttu-id="f218c-218">In File Explorer, copy the **WAPConnector** folder (what you downloaded earlier) to a folder named **c:\temp** in the tenant portal virtual machine.</span><span class="sxs-lookup"><span data-stu-id="f218c-218">In File Explorer, copy the **WAPConnector** folder (what you downloaded earlier) to a folder named **c:\temp** in the tenant portal virtual machine.</span></span>

    <span data-ttu-id="f218c-219">b.</span><span class="sxs-lookup"><span data-stu-id="f218c-219">b.</span></span> <span data-ttu-id="f218c-220">Open a Console or RDP connection to the tenant portal virtual machine.</span><span class="sxs-lookup"><span data-stu-id="f218c-220">Open a Console or RDP connection to the tenant portal virtual machine.</span></span>

    <span data-ttu-id="f218c-221">c.</span><span class="sxs-lookup"><span data-stu-id="f218c-221">c.</span></span> <span data-ttu-id="f218c-222">Change directories to **c:\temp\wapconnector\setup\scripts**, and run the **Install-Connector.ps1** script to install three MSI files.</span><span class="sxs-lookup"><span data-stu-id="f218c-222">Change directories to **c:\temp\wapconnector\setup\scripts**, and run the **Install-Connector.ps1** script to install three MSI files.</span></span> <span data-ttu-id="f218c-223">No parameters are required.</span><span class="sxs-lookup"><span data-stu-id="f218c-223">No parameters are required.</span></span>

     ```powershell
    cd C:\temp\wapconnector\setup\scripts\

    .\Install-Connector.ps1
    ```
     <span data-ttu-id="f218c-224">d.</span><span class="sxs-lookup"><span data-stu-id="f218c-224">d.</span></span> <span data-ttu-id="f218c-225">Change directories to **c:\inetpub** and verify that the three new sites are installed:</span><span class="sxs-lookup"><span data-stu-id="f218c-225">Change directories to **c:\inetpub** and verify that the three new sites are installed:</span></span>

       * <span data-ttu-id="f218c-226">MgmtSvc-Connector</span><span class="sxs-lookup"><span data-stu-id="f218c-226">MgmtSvc-Connector</span></span>

       * <span data-ttu-id="f218c-227">MgmtSvc-ConnectorExtension</span><span class="sxs-lookup"><span data-stu-id="f218c-227">MgmtSvc-ConnectorExtension</span></span>

       * <span data-ttu-id="f218c-228">MgmtSvc-ConnectorController</span><span class="sxs-lookup"><span data-stu-id="f218c-228">MgmtSvc-ConnectorController</span></span>

    <span data-ttu-id="f218c-229">e.</span><span class="sxs-lookup"><span data-stu-id="f218c-229">e.</span></span> <span data-ttu-id="f218c-230">From the same **c:\temp\wapconnector\setup\scripts** folder, run the **Configure-Certificates.ps1** script to install certificates.</span><span class="sxs-lookup"><span data-stu-id="f218c-230">From the same **c:\temp\wapconnector\setup\scripts** folder, run the **Configure-Certificates.ps1** script to install certificates.</span></span> <span data-ttu-id="f218c-231">By default, it will use the same certificate that is available for the Tenant Portal site in Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="f218c-231">By default, it will use the same certificate that is available for the Tenant Portal site in Windows Azure Pack.</span></span> <span data-ttu-id="f218c-232">Make sure this is a valid certificate (trusted by the Azure Stack MAS-WASP01 virtual machine and any client computer that accesses the Azure Stack portal).</span><span class="sxs-lookup"><span data-stu-id="f218c-232">Make sure this is a valid certificate (trusted by the Azure Stack MAS-WASP01 virtual machine and any client computer that accesses the Azure Stack portal).</span></span> <span data-ttu-id="f218c-233">Otherwise, communication won’t work.</span><span class="sxs-lookup"><span data-stu-id="f218c-233">Otherwise, communication won’t work.</span></span> <span data-ttu-id="f218c-234">(Alternatively, you can explicitly pass a certificate thumbprint as a parameter by using the -Thumbprint parameter.)</span><span class="sxs-lookup"><span data-stu-id="f218c-234">(Alternatively, you can explicitly pass a certificate thumbprint as a parameter by using the -Thumbprint parameter.)</span></span>

     ```powershell
        cd C:\temp\wapconnector\setup\scripts\

        .\Configure-Certificates.ps1
    ```

    <span data-ttu-id="f218c-235">f.</span><span class="sxs-lookup"><span data-stu-id="f218c-235">f.</span></span> <span data-ttu-id="f218c-236">To finish the configuration of these three services, run the **Configure-WapConnector.ps1** script to update the Web.config file parameters.</span><span class="sxs-lookup"><span data-stu-id="f218c-236">To finish the configuration of these three services, run the **Configure-WapConnector.ps1** script to update the Web.config file parameters.</span></span>

    |  <span data-ttu-id="f218c-237">Parameter</span><span class="sxs-lookup"><span data-stu-id="f218c-237">Parameter</span></span> | <span data-ttu-id="f218c-238">Description</span><span class="sxs-lookup"><span data-stu-id="f218c-238">Description</span></span> | <span data-ttu-id="f218c-239">Example</span><span class="sxs-lookup"><span data-stu-id="f218c-239">Example</span></span> |   
    | -------- | ------------- | ------- |  
    | <span data-ttu-id="f218c-240">TenantPortalFQDN</span><span class="sxs-lookup"><span data-stu-id="f218c-240">TenantPortalFQDN</span></span> | <span data-ttu-id="f218c-241">The Windows Azure Pack tenant portal FQDN.</span><span class="sxs-lookup"><span data-stu-id="f218c-241">The Windows Azure Pack tenant portal FQDN.</span></span> | <span data-ttu-id="f218c-242">tenant.contoso.com</span><span class="sxs-lookup"><span data-stu-id="f218c-242">tenant.contoso.com</span></span> | 
    | <span data-ttu-id="f218c-243">TenantAPIFQDN</span><span class="sxs-lookup"><span data-stu-id="f218c-243">TenantAPIFQDN</span></span> | <span data-ttu-id="f218c-244">The Windows Azure Pack Tenant API FQDN.</span><span class="sxs-lookup"><span data-stu-id="f218c-244">The Windows Azure Pack Tenant API FQDN.</span></span> | <span data-ttu-id="f218c-245">tenantapi.contoso.com</span><span class="sxs-lookup"><span data-stu-id="f218c-245">tenantapi.contoso.com</span></span>  |
    | <span data-ttu-id="f218c-246">AzureStackPortalFQDN</span><span class="sxs-lookup"><span data-stu-id="f218c-246">AzureStackPortalFQDN</span></span> | <span data-ttu-id="f218c-247">The Azure Stack user portal FQDN.</span><span class="sxs-lookup"><span data-stu-id="f218c-247">The Azure Stack user portal FQDN.</span></span> | <span data-ttu-id="f218c-248">portal.local.azurestack.external</span><span class="sxs-lookup"><span data-stu-id="f218c-248">portal.local.azurestack.external</span></span> |
    | | |
    
     ```powershell
    .\Configure-WapConnector.ps1 -TenantPortalFQDN "tenant.contoso.com" `
         -TenantAPIFQDN "tenantapi.contoso.com" `
         -AzureStackPortalFQDN  "portal.local.azurestack.external"
    ```
    <span data-ttu-id="f218c-249">g.</span><span class="sxs-lookup"><span data-stu-id="f218c-249">g.</span></span> <span data-ttu-id="f218c-250">If you have multiple tenant portal virtual machines, repeat step 1 for each of these virtual machines.</span><span class="sxs-lookup"><span data-stu-id="f218c-250">If you have multiple tenant portal virtual machines, repeat step 1 for each of these virtual machines.</span></span>

2. <span data-ttu-id="f218c-251">Install the new Tenant API MSI on each Windows Azure Pack Tenant API virtual machine.</span><span class="sxs-lookup"><span data-stu-id="f218c-251">Install the new Tenant API MSI on each Windows Azure Pack Tenant API virtual machine.</span></span>

    <span data-ttu-id="f218c-252">a.</span><span class="sxs-lookup"><span data-stu-id="f218c-252">a.</span></span> <span data-ttu-id="f218c-253">If a load balancer is in use, you may want to mark the virtual machine as offline.</span><span class="sxs-lookup"><span data-stu-id="f218c-253">If a load balancer is in use, you may want to mark the virtual machine as offline.</span></span>

    <span data-ttu-id="f218c-254">b.</span><span class="sxs-lookup"><span data-stu-id="f218c-254">b.</span></span> <span data-ttu-id="f218c-255">In File Explorer, copy the **WAPConnector** folder to a folder named **c:\temp** on each Tenant API machine.</span><span class="sxs-lookup"><span data-stu-id="f218c-255">In File Explorer, copy the **WAPConnector** folder to a folder named **c:\temp** on each Tenant API machine.</span></span>

    <span data-ttu-id="f218c-256">c.</span><span class="sxs-lookup"><span data-stu-id="f218c-256">c.</span></span> <span data-ttu-id="f218c-257">Copy the AzurePackConnectorOutput.txt file that you saved earlier, to **c:\temp\WAPConnector**.</span><span class="sxs-lookup"><span data-stu-id="f218c-257">Copy the AzurePackConnectorOutput.txt file that you saved earlier, to **c:\temp\WAPConnector**.</span></span>

    <span data-ttu-id="f218c-258">d.</span><span class="sxs-lookup"><span data-stu-id="f218c-258">d.</span></span> <span data-ttu-id="f218c-259">Open a Console or RDP connection to the Tenant API VM you copied the files to.</span><span class="sxs-lookup"><span data-stu-id="f218c-259">Open a Console or RDP connection to the Tenant API VM you copied the files to.</span></span>
    
    <span data-ttu-id="f218c-260">e.</span><span class="sxs-lookup"><span data-stu-id="f218c-260">e.</span></span> <span data-ttu-id="f218c-261">Change directories to **c:\temp\wapconnector\setup\scripts**, and run **Update-TenantAPI.ps1**.</span><span class="sxs-lookup"><span data-stu-id="f218c-261">Change directories to **c:\temp\wapconnector\setup\scripts**, and run **Update-TenantAPI.ps1**.</span></span> <span data-ttu-id="f218c-262">This new version of the WAP Tenant API contains a change to enable a trust relationship not only with the current STS, but also with the instance of AD FS in Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="f218c-262">This new version of the WAP Tenant API contains a change to enable a trust relationship not only with the current STS, but also with the instance of AD FS in Azure Stack.</span></span>

     ```powershell
    cd C:\temp\wapconnector\setup\packages\

    .\Update-TenantAPI.ps1
    ```

    <span data-ttu-id="f218c-263">f.</span><span class="sxs-lookup"><span data-stu-id="f218c-263">f.</span></span>  <span data-ttu-id="f218c-264">Repeat step 2 on any other virtual machine running the Tenant API.</span><span class="sxs-lookup"><span data-stu-id="f218c-264">Repeat step 2 on any other virtual machine running the Tenant API.</span></span>
3. <span data-ttu-id="f218c-265">From **only one** of the Tenant API VMs, run the Configure-TrustAzureStack.ps1 script to add a trust relationship between the Tenant API and the AD FS instance on Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="f218c-265">From **only one** of the Tenant API VMs, run the Configure-TrustAzureStack.ps1 script to add a trust relationship between the Tenant API and the AD FS instance on Azure Stack.</span></span> <span data-ttu-id="f218c-266">You must use an account with sysadmin access to the Microsoft.MgmtSvc.Store database.</span><span class="sxs-lookup"><span data-stu-id="f218c-266">You must use an account with sysadmin access to the Microsoft.MgmtSvc.Store database.</span></span> <span data-ttu-id="f218c-267">This script has the following parameters:</span><span class="sxs-lookup"><span data-stu-id="f218c-267">This script has the following parameters:</span></span>

    | <span data-ttu-id="f218c-268">Parameter</span><span class="sxs-lookup"><span data-stu-id="f218c-268">Parameter</span></span> | <span data-ttu-id="f218c-269">Description</span><span class="sxs-lookup"><span data-stu-id="f218c-269">Description</span></span> | <span data-ttu-id="f218c-270">Example</span><span class="sxs-lookup"><span data-stu-id="f218c-270">Example</span></span> |
    | --------- | ------------| ------- |
   | <span data-ttu-id="f218c-271">SqlServer</span><span class="sxs-lookup"><span data-stu-id="f218c-271">SqlServer</span></span> | <span data-ttu-id="f218c-272">The name of the SQL Server that contains the Microsoft.MgmtSvc.Store database.</span><span class="sxs-lookup"><span data-stu-id="f218c-272">The name of the SQL Server that contains the Microsoft.MgmtSvc.Store database.</span></span> <span data-ttu-id="f218c-273">This parameter is required.</span><span class="sxs-lookup"><span data-stu-id="f218c-273">This parameter is required.</span></span> | <span data-ttu-id="f218c-274">SQLServer</span><span class="sxs-lookup"><span data-stu-id="f218c-274">SQLServer</span></span> | 
   | <span data-ttu-id="f218c-275">DataFile</span><span class="sxs-lookup"><span data-stu-id="f218c-275">DataFile</span></span> | <span data-ttu-id="f218c-276">The output file that was generated during the configuration of the Azure Stack multi-cloud mode earlier.</span><span class="sxs-lookup"><span data-stu-id="f218c-276">The output file that was generated during the configuration of the Azure Stack multi-cloud mode earlier.</span></span> <span data-ttu-id="f218c-277">This parameter is required.</span><span class="sxs-lookup"><span data-stu-id="f218c-277">This parameter is required.</span></span> | <span data-ttu-id="f218c-278">AzurePackConnectorOutput.txt</span><span class="sxs-lookup"><span data-stu-id="f218c-278">AzurePackConnectorOutput.txt</span></span> | 
   | <span data-ttu-id="f218c-279">PromptForSqlCredential</span><span class="sxs-lookup"><span data-stu-id="f218c-279">PromptForSqlCredential</span></span> | <span data-ttu-id="f218c-280">Indicates that the script should prompt you interactively for a SQL Authentication credential to use when connecting to the SQL Server instance.</span><span class="sxs-lookup"><span data-stu-id="f218c-280">Indicates that the script should prompt you interactively for a SQL Authentication credential to use when connecting to the SQL Server instance.</span></span> <span data-ttu-id="f218c-281">The given credential must have sufficient permissions to uninstall databases, schemas, and delete user logins.</span><span class="sxs-lookup"><span data-stu-id="f218c-281">The given credential must have sufficient permissions to uninstall databases, schemas, and delete user logins.</span></span> <span data-ttu-id="f218c-282">If none is provided, the script assumes that current user context has access.</span><span class="sxs-lookup"><span data-stu-id="f218c-282">If none is provided, the script assumes that current user context has access.</span></span> | <span data-ttu-id="f218c-283">No value is needed.</span><span class="sxs-lookup"><span data-stu-id="f218c-283">No value is needed.</span></span> |
   |  |  |

    <span data-ttu-id="f218c-284">If you don't know the SQL Server to use, you can discover it.</span><span class="sxs-lookup"><span data-stu-id="f218c-284">If you don't know the SQL Server to use, you can discover it.</span></span> <span data-ttu-id="f218c-285">Connect to the Tenant API computer, use the Unprotect-MgmtSvc command to unprotect the Tenant API Web.config file, and look for the server name in the connection string.</span><span class="sxs-lookup"><span data-stu-id="f218c-285">Connect to the Tenant API computer, use the Unprotect-MgmtSvc command to unprotect the Tenant API Web.config file, and look for the server name in the connection string.</span></span> <span data-ttu-id="f218c-286">Remember to run Protect-MgmtSvc again to protect the Tenant API Web.config file.</span><span class="sxs-lookup"><span data-stu-id="f218c-286">Remember to run Protect-MgmtSvc again to protect the Tenant API Web.config file.</span></span>

  ```powershell
  cd C:\temp\wapconnector\setup\scripts\

 .\Configure-TrustAzureStack.ps1 -SqlServer "SQLServer" `
       -DataFile "C:\temp\wapconnector\AzurePackConnectorOutput.txt"
  ```

## <a name="example"></a><span data-ttu-id="f218c-287">Example</span><span class="sxs-lookup"><span data-stu-id="f218c-287">Example</span></span>
<span data-ttu-id="f218c-288">The following example shows a complete Windows Azure Pack Connector deployment on a single-node Azure Stack configuration and a Windows Azure Pack Express installation.</span><span class="sxs-lookup"><span data-stu-id="f218c-288">The following example shows a complete Windows Azure Pack Connector deployment on a single-node Azure Stack configuration and a Windows Azure Pack Express installation.</span></span> <span data-ttu-id="f218c-289">(The Express installation is on a single computer, with the example name *wapcomputer*.)</span><span class="sxs-lookup"><span data-stu-id="f218c-289">(The Express installation is on a single computer, with the example name *wapcomputer*.)</span></span>

```powershell
# Run the following script on the Azure Stack host
cd C:\CloudDeployment\Setup\Activation\AzurePackConnector\
./ConfigureAzurePackConnector.ps1 -AzurePackConnectorEndpoint "https://wapcomputer.com:40005" `
     -AzurePackCloudName "Azure_Pack" `
     -AzureStackCloudName "Azure_Stack" `
     -EnableMultiCloud $true 
```
<span data-ttu-id="f218c-290">Download the .exe file from the [Microsoft Download Center](https://aka.ms/wapconnectorazurestackdlc), extract it, and copy the WAPConnector folder to a **c:\temp** folder on the Windows Azure Pack computer.</span><span class="sxs-lookup"><span data-stu-id="f218c-290">Download the .exe file from the [Microsoft Download Center](https://aka.ms/wapconnectorazurestackdlc), extract it, and copy the WAPConnector folder to a **c:\temp** folder on the Windows Azure Pack computer.</span></span> <span data-ttu-id="f218c-291">Copy the file "AzurePackConnectorOutput.txt" that was generated as output in the previous script to the **c:\temp\WAPConnector** folder, and then run the following script:</span><span class="sxs-lookup"><span data-stu-id="f218c-291">Copy the file "AzurePackConnectorOutput.txt" that was generated as output in the previous script to the **c:\temp\WAPConnector** folder, and then run the following script:</span></span>

 ```powershell
# Install Connector components
cd C:\temp\WAPConnector\Setup\Scripts
.\Install-Connector.ps1

# Configure Certificates for the new Connector services
.\Configure-Certificates.ps1

# Configure the Connector services
.\Configure-WapConnector.ps1 -TenantPortalFQDN "wapcomputer.com" `
     -TenantAPIFQDN "wapcomputer.com" `
     -AzureStackPortalFQDN "portal.local.azurestack.external"

# Install the updated TenantAPI
.\Update-TenantAPI.ps1

# Establish trust with the Azure Stack AD FS
.\Configure-TrustAzureStack.ps1 -SqlServer "wapcomputer" `
     -DataFile "C:\temp\wapconnector\AzurePackConnectorOutput.original.txt" 

```
## <a name="troubleshooting-tips"></a><span data-ttu-id="f218c-292">Troubleshooting tips</span><span class="sxs-lookup"><span data-stu-id="f218c-292">Troubleshooting tips</span></span>
1.  <span data-ttu-id="f218c-293">Ensure there is network connectivity between Azure Stack and Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="f218c-293">Ensure there is network connectivity between Azure Stack and Windows Azure Pack.</span></span> <span data-ttu-id="f218c-294">This connectivity should be between any tenant computer that accesses the Azure Stack portal and the Windows Azure Pack tenant portal VM where the new Connector services are running.</span><span class="sxs-lookup"><span data-stu-id="f218c-294">This connectivity should be between any tenant computer that accesses the Azure Stack portal and the Windows Azure Pack tenant portal VM where the new Connector services are running.</span></span>
2.  <span data-ttu-id="f218c-295">Ensure that all specified FQDNs are correct.</span><span class="sxs-lookup"><span data-stu-id="f218c-295">Ensure that all specified FQDNs are correct.</span></span>
3.  <span data-ttu-id="f218c-296">Ensure that the SSL certificates used in the new Connector services are trusted by Azure Stack (specifically the MAS-WASP01 VM) and any other computer the tenant may use to access the Azure Stack user portal.</span><span class="sxs-lookup"><span data-stu-id="f218c-296">Ensure that the SSL certificates used in the new Connector services are trusted by Azure Stack (specifically the MAS-WASP01 VM) and any other computer the tenant may use to access the Azure Stack user portal.</span></span>
4. <span data-ttu-id="f218c-297">For known issues, see [Microsoft Azure Stack troubleshooting](azure-stack-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="f218c-297">For known issues, see [Microsoft Azure Stack troubleshooting](azure-stack-troubleshooting.md).</span></span>

  ## <a name="next-steps"></a><span data-ttu-id="f218c-298">Next steps</span><span class="sxs-lookup"><span data-stu-id="f218c-298">Next steps</span></span>
[<span data-ttu-id="f218c-299">Using the administrator and user portals in Azure Stack</span><span class="sxs-lookup"><span data-stu-id="f218c-299">Using the administrator and user portals in Azure Stack</span></span>](azure-stack-manage-portals.md)



