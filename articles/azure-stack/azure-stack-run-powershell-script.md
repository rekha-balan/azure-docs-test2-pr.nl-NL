---
title: Deploy Azure Stack POC | Microsoft Docs
description: Learn how to prepare the Azure Stack POC and run the PowerShell script to deploy Azure Stack POC.
services: azure-stack
documentationcenter: ''
author: ErikjeMS
manager: byronr
editor: ''
ms.assetid: 0ad02941-ed14-4888-8695-b82ad6e43c66
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 4/6/2017
ms.author: erikje
ms.openlocfilehash: 46449a7f99cf4c27aad064aa90517ba00893f23d
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44551456"
---
# <a name="deploy-azure-stack-poc"></a><span data-ttu-id="992f5-103">Deploy Azure Stack POC</span><span class="sxs-lookup"><span data-stu-id="992f5-103">Deploy Azure Stack POC</span></span>
<span data-ttu-id="992f5-104">To deploy the Azure Stack POC, you must complete the following steps:</span><span class="sxs-lookup"><span data-stu-id="992f5-104">To deploy the Azure Stack POC, you must complete the following steps:</span></span>

1. <span data-ttu-id="992f5-105">[Download the deployment package](https://azure.microsoft.com/overview/azure-stack/try/?v=try) to get the Cloudbuilder.vhdx.</span><span class="sxs-lookup"><span data-stu-id="992f5-105">[Download the deployment package](https://azure.microsoft.com/overview/azure-stack/try/?v=try) to get the Cloudbuilder.vhdx.</span></span>
2. <span data-ttu-id="992f5-106">[Prepare the deployment machine](#prepare-the-deployment-machine) by running the PrepareBootFromVHD.ps1 script to configure the computer (the POC host) on which you want to install Azure Stack POC.</span><span class="sxs-lookup"><span data-stu-id="992f5-106">[Prepare the deployment machine](#prepare-the-deployment-machine) by running the PrepareBootFromVHD.ps1 script to configure the computer (the POC host) on which you want to install Azure Stack POC.</span></span> <span data-ttu-id="992f5-107">After this step, the POC host will boot to the Cloudbuilder.vhdx.</span><span class="sxs-lookup"><span data-stu-id="992f5-107">After this step, the POC host will boot to the Cloudbuilder.vhdx.</span></span>
3. <span data-ttu-id="992f5-108">[Run the PowerShell deployment script](#run-the-powershell-deployment-script) on the POC host to install the Azure Stack POC.</span><span class="sxs-lookup"><span data-stu-id="992f5-108">[Run the PowerShell deployment script](#run-the-powershell-deployment-script) on the POC host to install the Azure Stack POC.</span></span>
4. <span data-ttu-id="992f5-109">**NEW step for Technical Preview 3**: If your deployment uses Azure Active Directory, [activate the portals](#activate-the-administrator-and-tenant-portals) to give the Azure Stack portal and Azure Resource Manager the correct permissions for all users of the directory .</span><span class="sxs-lookup"><span data-stu-id="992f5-109">**NEW step for Technical Preview 3**: If your deployment uses Azure Active Directory, [activate the portals](#activate-the-administrator-and-tenant-portals) to give the Azure Stack portal and Azure Resource Manager the correct permissions for all users of the directory .</span></span>

> [!NOTE]
> <span data-ttu-id="992f5-110">For best results, even if you want to use a disconnected Azure Stack environment, it is best to deploy while connected to the internet.</span><span class="sxs-lookup"><span data-stu-id="992f5-110">For best results, even if you want to use a disconnected Azure Stack environment, it is best to deploy while connected to the internet.</span></span> <span data-ttu-id="992f5-111">That way, the Windows Server 2016 evaluation version can be activated at deployment time.</span><span class="sxs-lookup"><span data-stu-id="992f5-111">That way, the Windows Server 2016 evaluation version can be activated at deployment time.</span></span> <span data-ttu-id="992f5-112">If the Windows Server 2016 evaluation version is not activated within 10 days, it shuts down.</span><span class="sxs-lookup"><span data-stu-id="992f5-112">If the Windows Server 2016 evaluation version is not activated within 10 days, it shuts down.</span></span>
> 
> 

## <a name="download-and-extract-microsoft-azure-stack-poc"></a><span data-ttu-id="992f5-113">Download and extract Microsoft Azure Stack POC</span><span class="sxs-lookup"><span data-stu-id="992f5-113">Download and extract Microsoft Azure Stack POC</span></span>
1. <span data-ttu-id="992f5-114">Before you start the download, make sure that your computer meets the following prerequisites:</span><span class="sxs-lookup"><span data-stu-id="992f5-114">Before you start the download, make sure that your computer meets the following prerequisites:</span></span>

   * <span data-ttu-id="992f5-115">The computer must have at least 60 GB of free disk space.</span><span class="sxs-lookup"><span data-stu-id="992f5-115">The computer must have at least 60 GB of free disk space.</span></span>
   * <span data-ttu-id="992f5-116">[.NET Framework 4.6 (or a later version)](https://aka.ms/r6mkiy) must be installed.</span><span class="sxs-lookup"><span data-stu-id="992f5-116">[.NET Framework 4.6 (or a later version)](https://aka.ms/r6mkiy) must be installed.</span></span>

2. <span data-ttu-id="992f5-117">[Go to the Get Started page](https://azure.microsoft.com/overview/azure-stack/try/?v=try), provide your details, and click **Submit**.</span><span class="sxs-lookup"><span data-stu-id="992f5-117">[Go to the Get Started page](https://azure.microsoft.com/overview/azure-stack/try/?v=try), provide your details, and click **Submit**.</span></span>
3. <span data-ttu-id="992f5-118">Under **Download the software**, click **Azure Stack Technical Preview 3**.</span><span class="sxs-lookup"><span data-stu-id="992f5-118">Under **Download the software**, click **Azure Stack Technical Preview 3**.</span></span>
4. <span data-ttu-id="992f5-119">Run the downloaded AzureStackDownloader.exe file.</span><span class="sxs-lookup"><span data-stu-id="992f5-119">Run the downloaded AzureStackDownloader.exe file.</span></span>
5. <span data-ttu-id="992f5-120">In the **Azure Stack POC Downloader** window, follow steps 1 through 5.</span><span class="sxs-lookup"><span data-stu-id="992f5-120">In the **Azure Stack POC Downloader** window, follow steps 1 through 5.</span></span>
6. <span data-ttu-id="992f5-121">After the download completes, click **Run** to launch the MicrosoftAzureStackPOC.exe.</span><span class="sxs-lookup"><span data-stu-id="992f5-121">After the download completes, click **Run** to launch the MicrosoftAzureStackPOC.exe.</span></span>
7. <span data-ttu-id="992f5-122">Review the License Agreement screen and information of the Self-Extractor Wizard and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="992f5-122">Review the License Agreement screen and information of the Self-Extractor Wizard and then click **Next**.</span></span>
8. <span data-ttu-id="992f5-123">Review the Privacy Statement screen and information of the Self-Extractor Wizard and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="992f5-123">Review the Privacy Statement screen and information of the Self-Extractor Wizard and then click **Next**.</span></span>
9. <span data-ttu-id="992f5-124">Select the Destination for the files to be extracted, click **Next**.</span><span class="sxs-lookup"><span data-stu-id="992f5-124">Select the Destination for the files to be extracted, click **Next**.</span></span>
   * <span data-ttu-id="992f5-125">The default is: <drive letter>:\<current folder>\Microsoft Azure Stack POC</span><span class="sxs-lookup"><span data-stu-id="992f5-125">The default is: <drive letter>:\<current folder>\Microsoft Azure Stack POC</span></span>
10. <span data-ttu-id="992f5-126">Review the Destination location screen and information of the Self-Extractor Wizard, and then click **Extract** to extract the CloudBuilder.vhdx (~35 GB) and ThirdPartyLicenses.rtf files.</span><span class="sxs-lookup"><span data-stu-id="992f5-126">Review the Destination location screen and information of the Self-Extractor Wizard, and then click **Extract** to extract the CloudBuilder.vhdx (~35 GB) and ThirdPartyLicenses.rtf files.</span></span> <span data-ttu-id="992f5-127">This will take some time to complete.</span><span class="sxs-lookup"><span data-stu-id="992f5-127">This will take some time to complete.</span></span>

> [!NOTE]
> <span data-ttu-id="992f5-128">After you extract the files, you can delete the exe and bin files to recover space on the machine.</span><span class="sxs-lookup"><span data-stu-id="992f5-128">After you extract the files, you can delete the exe and bin files to recover space on the machine.</span></span> <span data-ttu-id="992f5-129">Or, you can move these files to another location so that if you need to redeploy you don’t need to download the files again.</span><span class="sxs-lookup"><span data-stu-id="992f5-129">Or, you can move these files to another location so that if you need to redeploy you don’t need to download the files again.</span></span>
> 
> 

## <a name="prepare-the-deployment-machine"></a><span data-ttu-id="992f5-130">Prepare the deployment machine</span><span class="sxs-lookup"><span data-stu-id="992f5-130">Prepare the deployment machine</span></span>
1. <span data-ttu-id="992f5-131">Make sure that you can physically connect to the POC host, or have physical console access (such as KVM).</span><span class="sxs-lookup"><span data-stu-id="992f5-131">Make sure that you can physically connect to the POC host, or have physical console access (such as KVM).</span></span> <span data-ttu-id="992f5-132">You will need such access after you reboot the POC host in step 9 below.</span><span class="sxs-lookup"><span data-stu-id="992f5-132">You will need such access after you reboot the POC host in step 9 below.</span></span>
2. <span data-ttu-id="992f5-133">Make sure the POC host meets the [minimum requirements](azure-stack-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="992f5-133">Make sure the POC host meets the [minimum requirements](azure-stack-deploy.md).</span></span> <span data-ttu-id="992f5-134">You can use the [Deployment Checker for Azure Stack](https://gallery.technet.microsoft.com/Deployment-Checker-for-50e0f51b) to confirm your requirements.</span><span class="sxs-lookup"><span data-stu-id="992f5-134">You can use the [Deployment Checker for Azure Stack](https://gallery.technet.microsoft.com/Deployment-Checker-for-50e0f51b) to confirm your requirements.</span></span>
3. <span data-ttu-id="992f5-135">Sign in as the Local Administrator to your POC host.</span><span class="sxs-lookup"><span data-stu-id="992f5-135">Sign in as the Local Administrator to your POC host.</span></span>
4. <span data-ttu-id="992f5-136">Copy or move the CloudBuilder.vhdx file to the root of the C:\ drive (C:\CloudBuilder.vhdx).</span><span class="sxs-lookup"><span data-stu-id="992f5-136">Copy or move the CloudBuilder.vhdx file to the root of the C:\ drive (C:\CloudBuilder.vhdx).</span></span>
   
   > [!NOTE]
   > <span data-ttu-id="992f5-137">If you choose not to use the recommended script to prepare your POC host (steps 5 – step 7), do not enter any license key at the activation page.</span><span class="sxs-lookup"><span data-stu-id="992f5-137">If you choose not to use the recommended script to prepare your POC host (steps 5 – step 7), do not enter any license key at the activation page.</span></span> <span data-ttu-id="992f5-138">A trial version of Windows Server 2016 image is included, and entering a license key causes expiration warning messages.</span><span class="sxs-lookup"><span data-stu-id="992f5-138">A trial version of Windows Server 2016 image is included, and entering a license key causes expiration warning messages.</span></span>
   > 
   > 
5. <span data-ttu-id="992f5-139">On the POC host, run the following PowerShell script to download the Azure Stack support files:</span><span class="sxs-lookup"><span data-stu-id="992f5-139">On the POC host, run the following PowerShell script to download the Azure Stack support files:</span></span>
   
        # Variables
        $Uri = 'https://raw.githubusercontent.com/Azure/AzureStack-Tools/master/Deployment/'
        $LocalPath = 'c:\AzureStack_SupportFiles'
   
        # Create folder
        New-Item $LocalPath -type directory
   
        # Download files
        ( 'BootMenuNoKVM.ps1', 'PrepareBootFromVHD.ps1', 'Unattend.xml', 'unattend_NoKVM.xml') | `
        foreach { Invoke-WebRequest ($uri + $_) -OutFile ($LocalPath + '\' + $_) } 
   
    <span data-ttu-id="992f5-140">This script downloads the Azure Stack support files to the folder specified by the $LocalPath parameter.</span><span class="sxs-lookup"><span data-stu-id="992f5-140">This script downloads the Azure Stack support files to the folder specified by the $LocalPath parameter.</span></span>
6. <span data-ttu-id="992f5-141">Open an elevated PowerShell console and change the directory to where you copied the support files.</span><span class="sxs-lookup"><span data-stu-id="992f5-141">Open an elevated PowerShell console and change the directory to where you copied the support files.</span></span>
7. <span data-ttu-id="992f5-142">Run the PrepareBootFromVHD.ps1 script.</span><span class="sxs-lookup"><span data-stu-id="992f5-142">Run the PrepareBootFromVHD.ps1 script.</span></span> <span data-ttu-id="992f5-143">This script and the unattend files are available with the other support scripts provided along with this build.</span><span class="sxs-lookup"><span data-stu-id="992f5-143">This script and the unattend files are available with the other support scripts provided along with this build.</span></span>
    <span data-ttu-id="992f5-144">There are five parameters for this PowerShell script:</span><span class="sxs-lookup"><span data-stu-id="992f5-144">There are five parameters for this PowerShell script:</span></span>
    
    | <span data-ttu-id="992f5-145">Parameter</span><span class="sxs-lookup"><span data-stu-id="992f5-145">Parameter</span></span> | <span data-ttu-id="992f5-146">Required/Optional</span><span class="sxs-lookup"><span data-stu-id="992f5-146">Required/Optional</span></span> | <span data-ttu-id="992f5-147">Description</span><span class="sxs-lookup"><span data-stu-id="992f5-147">Description</span></span> |
    | --- | --- | --- |
    |<span data-ttu-id="992f5-148">CloudBuilderDiskPath</span><span class="sxs-lookup"><span data-stu-id="992f5-148">CloudBuilderDiskPath</span></span>|<span data-ttu-id="992f5-149">Required</span><span class="sxs-lookup"><span data-stu-id="992f5-149">Required</span></span>|<span data-ttu-id="992f5-150">The path to the CloudBuilder.vhdx on the POC host.</span><span class="sxs-lookup"><span data-stu-id="992f5-150">The path to the CloudBuilder.vhdx on the POC host.</span></span>|
    |<span data-ttu-id="992f5-151">DriverPath</span><span class="sxs-lookup"><span data-stu-id="992f5-151">DriverPath</span></span>|<span data-ttu-id="992f5-152">Optional</span><span class="sxs-lookup"><span data-stu-id="992f5-152">Optional</span></span>|<span data-ttu-id="992f5-153">Lets you add additional drivers for the POC host in the VHD.</span><span class="sxs-lookup"><span data-stu-id="992f5-153">Lets you add additional drivers for the POC host in the VHD.</span></span>|
    |<span data-ttu-id="992f5-154">ApplyUnattend</span><span class="sxs-lookup"><span data-stu-id="992f5-154">ApplyUnattend</span></span>|<span data-ttu-id="992f5-155">Optional</span><span class="sxs-lookup"><span data-stu-id="992f5-155">Optional</span></span>|<span data-ttu-id="992f5-156">Specify this switch parameter to automate the configuration of the operating system.</span><span class="sxs-lookup"><span data-stu-id="992f5-156">Specify this switch parameter to automate the configuration of the operating system.</span></span> <span data-ttu-id="992f5-157">If specified, the user must provide the AdminPassword to configure the OS at boot (requires provided accompanying file unattend_NoKVM.xml).</span><span class="sxs-lookup"><span data-stu-id="992f5-157">If specified, the user must provide the AdminPassword to configure the OS at boot (requires provided accompanying file unattend_NoKVM.xml).</span></span> <span data-ttu-id="992f5-158">If you do not use this parameter, the generic unattend.xml file is used without further customization.</span><span class="sxs-lookup"><span data-stu-id="992f5-158">If you do not use this parameter, the generic unattend.xml file is used without further customization.</span></span> <span data-ttu-id="992f5-159">You'll need KVM access to complete customization after it reboots.</span><span class="sxs-lookup"><span data-stu-id="992f5-159">You'll need KVM access to complete customization after it reboots.</span></span>|
    |<span data-ttu-id="992f5-160">AdminPassword</span><span class="sxs-lookup"><span data-stu-id="992f5-160">AdminPassword</span></span>|<span data-ttu-id="992f5-161">Optional</span><span class="sxs-lookup"><span data-stu-id="992f5-161">Optional</span></span>|<span data-ttu-id="992f5-162">Only used when the ApplyUnattend parameter is set, requires a minimum of six characters.</span><span class="sxs-lookup"><span data-stu-id="992f5-162">Only used when the ApplyUnattend parameter is set, requires a minimum of six characters.</span></span>|
    |<span data-ttu-id="992f5-163">VHDLanguage</span><span class="sxs-lookup"><span data-stu-id="992f5-163">VHDLanguage</span></span>|<span data-ttu-id="992f5-164">Optional</span><span class="sxs-lookup"><span data-stu-id="992f5-164">Optional</span></span>|<span data-ttu-id="992f5-165">Specifies the VHD language, defaulted to “en-US.”</span><span class="sxs-lookup"><span data-stu-id="992f5-165">Specifies the VHD language, defaulted to “en-US.”</span></span>|

    <span data-ttu-id="992f5-166">The script is documented and contains example usage, though the most common usage is:</span><span class="sxs-lookup"><span data-stu-id="992f5-166">The script is documented and contains example usage, though the most common usage is:</span></span>
     
    `.\PrepareBootFromVHD.ps1 -CloudBuilderDiskPath C:\CloudBuilder.vhdx -ApplyUnattend`
     
    <span data-ttu-id="992f5-167">If you run this exact command, you must enter the AdminPassword at the prompt.</span><span class="sxs-lookup"><span data-stu-id="992f5-167">If you run this exact command, you must enter the AdminPassword at the prompt.</span></span>
8. <span data-ttu-id="992f5-168">When the script is complete, you must confirm the reboot.</span><span class="sxs-lookup"><span data-stu-id="992f5-168">When the script is complete, you must confirm the reboot.</span></span> <span data-ttu-id="992f5-169">If there are other users logged in, this command will fail.</span><span class="sxs-lookup"><span data-stu-id="992f5-169">If there are other users logged in, this command will fail.</span></span> <span data-ttu-id="992f5-170">If the command fails, run the following command: `Restart-Computer -force`</span><span class="sxs-lookup"><span data-stu-id="992f5-170">If the command fails, run the following command: `Restart-Computer -force`</span></span> 
9. <span data-ttu-id="992f5-171">The POC host reboots into the OS of the CloudBuilder.vhdx, where the deployment continues.</span><span class="sxs-lookup"><span data-stu-id="992f5-171">The POC host reboots into the OS of the CloudBuilder.vhdx, where the deployment continues.</span></span>

## <a name="run-the-powershell-deployment-script"></a><span data-ttu-id="992f5-172">Run the PowerShell deployment script</span><span class="sxs-lookup"><span data-stu-id="992f5-172">Run the PowerShell deployment script</span></span>
1. <span data-ttu-id="992f5-173">Sign in as the Local Administrator to the POC host.</span><span class="sxs-lookup"><span data-stu-id="992f5-173">Sign in as the Local Administrator to the POC host.</span></span> <span data-ttu-id="992f5-174">Use the credentials specified in the previous steps.</span><span class="sxs-lookup"><span data-stu-id="992f5-174">Use the credentials specified in the previous steps.</span></span>

    > [!IMPORTANT]
    > <span data-ttu-id="992f5-175">Azure Stack requires access to the Internet, either directly or through a transparent proxy.</span><span class="sxs-lookup"><span data-stu-id="992f5-175">Azure Stack requires access to the Internet, either directly or through a transparent proxy.</span></span> <span data-ttu-id="992f5-176">The deployment supports exactly one NIC for networking.</span><span class="sxs-lookup"><span data-stu-id="992f5-176">The deployment supports exactly one NIC for networking.</span></span> <span data-ttu-id="992f5-177">If you have multiple NICs, make sure that only one is enabled (and all others are disabled) before running the deployment script in the next section.</span><span class="sxs-lookup"><span data-stu-id="992f5-177">If you have multiple NICs, make sure that only one is enabled (and all others are disabled) before running the deployment script in the next section.</span></span>
    
2. <span data-ttu-id="992f5-178">Open an elevated PowerShell console.</span><span class="sxs-lookup"><span data-stu-id="992f5-178">Open an elevated PowerShell console.</span></span>
3. <span data-ttu-id="992f5-179">In PowerShell, run this command: `cd C:\CloudDeployment\Setup`.</span><span class="sxs-lookup"><span data-stu-id="992f5-179">In PowerShell, run this command: `cd C:\CloudDeployment\Setup`.</span></span> <span data-ttu-id="992f5-180">If you don't supply any parameters (see **InstallAzureStackPOC.ps1 optional parameters** below), you'll be prompted for the required parameters.</span><span class="sxs-lookup"><span data-stu-id="992f5-180">If you don't supply any parameters (see **InstallAzureStackPOC.ps1 optional parameters** below), you'll be prompted for the required parameters.</span></span>
4. <span data-ttu-id="992f5-181">You can deploy Azure Stack with Azure Active Directory or Active Directory Federation Services.</span><span class="sxs-lookup"><span data-stu-id="992f5-181">You can deploy Azure Stack with Azure Active Directory or Active Directory Federation Services.</span></span> <span data-ttu-id="992f5-182">Azure Stack, resource providers, and other applications work the same way with both.</span><span class="sxs-lookup"><span data-stu-id="992f5-182">Azure Stack, resource providers, and other applications work the same way with both.</span></span> <span data-ttu-id="992f5-183">To learn more about what is supported with AD FS in Azure Stack, see the [Key features and concepts](azure-stack-key-features.md) article.</span><span class="sxs-lookup"><span data-stu-id="992f5-183">To learn more about what is supported with AD FS in Azure Stack, see the [Key features and concepts](azure-stack-key-features.md) article.</span></span>

    <span data-ttu-id="992f5-184">To deploy Azure Stack with Azure Active Directory, run the deploy command:</span><span class="sxs-lookup"><span data-stu-id="992f5-184">To deploy Azure Stack with Azure Active Directory, run the deploy command:</span></span>
    
    ```powershell
    cd C:\CloudDeployment\Setup 
    $adminpass = ConvertTo-SecureString "〈LOCAL_ADMIN_PASSWORD〉" -AsPlainText -Force 
    .\InstallAzureStackPOC.ps1 -AdminPassword $adminpass
    ```

    <span data-ttu-id="992f5-185">To deploy the Azure Stack POC with Active Directory Federation Services instead, run the following script (you just need to add the -UseADFS parameter):</span><span class="sxs-lookup"><span data-stu-id="992f5-185">To deploy the Azure Stack POC with Active Directory Federation Services instead, run the following script (you just need to add the -UseADFS parameter):</span></span>

    ```powershell
    cd C:\CloudDeployment\Setup 
    $adminpass = ConvertTo-SecureString "〈LOCAL_ADMIN_PASSWORD〉" -AsPlainText -Force 
    .\InstallAzureStackPOC.ps1 -AdminPassword $adminpass -UseADFS
    ```

    <span data-ttu-id="992f5-186">In this AD FS deployment, the default stamp Directory Service is used as the identity provider, the default account to sign in with is azurestackadmin@azurestack.local, and the password to use is the one you provided as part of the setup.</span><span class="sxs-lookup"><span data-stu-id="992f5-186">In this AD FS deployment, the default stamp Directory Service is used as the identity provider, the default account to sign in with is azurestackadmin@azurestack.local, and the password to use is the one you provided as part of the setup.</span></span>

5. <span data-ttu-id="992f5-187">If you used the AAD option, enter the credentials for your Azure Active Directory account.</span><span class="sxs-lookup"><span data-stu-id="992f5-187">If you used the AAD option, enter the credentials for your Azure Active Directory account.</span></span> <span data-ttu-id="992f5-188">This user must be the Global Admin in the directory tenant.</span><span class="sxs-lookup"><span data-stu-id="992f5-188">This user must be the Global Admin in the directory tenant.</span></span>
6. <span data-ttu-id="992f5-189">The deployment process can take a few hours, during which the system automatically reboots once.</span><span class="sxs-lookup"><span data-stu-id="992f5-189">The deployment process can take a few hours, during which the system automatically reboots once.</span></span>
   
   > [!IMPORTANT]
   > <span data-ttu-id="992f5-190">If you want to monitor the deployment progress, sign in as azurestack\AzureStackAdmin.</span><span class="sxs-lookup"><span data-stu-id="992f5-190">If you want to monitor the deployment progress, sign in as azurestack\AzureStackAdmin.</span></span> <span data-ttu-id="992f5-191">If you sign in as a local admin after the machine is joined to the domain, you won't see the deployment progress.</span><span class="sxs-lookup"><span data-stu-id="992f5-191">If you sign in as a local admin after the machine is joined to the domain, you won't see the deployment progress.</span></span> <span data-ttu-id="992f5-192">Do not rerun deployment, instead sign in as azurestack\AzureStackAdmin to validate that it's running.</span><span class="sxs-lookup"><span data-stu-id="992f5-192">Do not rerun deployment, instead sign in as azurestack\AzureStackAdmin to validate that it's running.</span></span>
   > 
   > 
   
    <span data-ttu-id="992f5-193">When the deployment succeeds, the PowerShell console displays: **COMPLETE: Action ‘Deployment’**.</span><span class="sxs-lookup"><span data-stu-id="992f5-193">When the deployment succeeds, the PowerShell console displays: **COMPLETE: Action ‘Deployment’**.</span></span>
   
    <span data-ttu-id="992f5-194">If the deployment fails, you can try run the script again using the -rerun parameter.</span><span class="sxs-lookup"><span data-stu-id="992f5-194">If the deployment fails, you can try run the script again using the -rerun parameter.</span></span> <span data-ttu-id="992f5-195">Or, you can [redeploy](azure-stack-redeploy.md) it from scratch.</span><span class="sxs-lookup"><span data-stu-id="992f5-195">Or, you can [redeploy](azure-stack-redeploy.md) it from scratch.</span></span>

### <a name="aad-deployment-script-examples"></a><span data-ttu-id="992f5-196">AAD deployment script examples</span><span class="sxs-lookup"><span data-stu-id="992f5-196">AAD deployment script examples</span></span>
<span data-ttu-id="992f5-197">You can script the entire AAD deployment.</span><span class="sxs-lookup"><span data-stu-id="992f5-197">You can script the entire AAD deployment.</span></span> <span data-ttu-id="992f5-198">Here are some examples.</span><span class="sxs-lookup"><span data-stu-id="992f5-198">Here are some examples.</span></span>

<span data-ttu-id="992f5-199">If your AAD Identity is only associated with ONE AAD Directory:</span><span class="sxs-lookup"><span data-stu-id="992f5-199">If your AAD Identity is only associated with ONE AAD Directory:</span></span>

    cd C:\CloudDeployment\Setup
    $adminpass = ConvertTo-SecureString "<LOCAL ADMIN PASSWORD>" -AsPlainText -Force
    $aadpass = ConvertTo-SecureString "<AAD GLOBAL ADMIN ACCOUNT PASSWORD>" -AsPlainText -Force
    $aadcred = New-Object System.Management.Automation.PSCredential ("<AAD GLOBAL ADMIN ACCOUNT>", $aadpass)
    .\InstallAzureStackPOC.ps1 -AdminPassword $adminpass -InfraAzureDirectoryTenantAdminCredential $aadcred

<span data-ttu-id="992f5-200">If your AAD Identity is associated with GREATER THAN ONE AAD Directory:</span><span class="sxs-lookup"><span data-stu-id="992f5-200">If your AAD Identity is associated with GREATER THAN ONE AAD Directory:</span></span>

    cd C:\CloudDeployment\Setup
    $adminpass = ConvertTo-SecureString "<LOCAL ADMIN PASSWORD>" -AsPlainText -Force
    $aadpass = ConvertTo-SecureString "<AAD GLOBAL ADMIN ACCOUNT PASSWORD>" -AsPlainText -Force
    $aadcred = New-Object System.Management.Automation.PSCredential ("<AAD GLOBAL ADMIN ACCOUNT> ` 
    example: user@AADDirName.onmicrosoft.com>", $aadpass)
    .\InstallAzureStackPOC.ps1 -AdminPassword $adminpass -InfraAzureDirectoryTenantAdminCredential $aadcred ` 
    -InfraAzureDirectoryTenantName "<SPECIFIC AAD DIRECTORY example: AADDirName.onmicrosoft.com>"

### <a name="using-static-ip-addresses"></a><span data-ttu-id="992f5-201">Using static IP addresses</span><span class="sxs-lookup"><span data-stu-id="992f5-201">Using static IP addresses</span></span>

<span data-ttu-id="992f5-202">If your environment DOESN'T have DHCP enabled, you must include the following ADDITIONAL parameters to one of the options above (example usage provided):</span><span class="sxs-lookup"><span data-stu-id="992f5-202">If your environment DOESN'T have DHCP enabled, you must include the following ADDITIONAL parameters to one of the options above (example usage provided):</span></span>

    .\InstallAzureStackPOC.ps1 -AdminPassword $adminpass -InfraAzureDirectoryTenantAdminCredential $aadcred
    -NatIPv4Subnet 10.10.10.0/24 -NatIPv4Address 10.10.10.3 -NatIPv4DefaultGateway 10.10.10.1


### <a name="installazurestackpocps1-optional-parameters"></a><span data-ttu-id="992f5-203">InstallAzureStackPOC.ps1 optional parameters</span><span class="sxs-lookup"><span data-stu-id="992f5-203">InstallAzureStackPOC.ps1 optional parameters</span></span>
| <span data-ttu-id="992f5-204">Parameter</span><span class="sxs-lookup"><span data-stu-id="992f5-204">Parameter</span></span> | <span data-ttu-id="992f5-205">Required/Optional</span><span class="sxs-lookup"><span data-stu-id="992f5-205">Required/Optional</span></span> | <span data-ttu-id="992f5-206">Description</span><span class="sxs-lookup"><span data-stu-id="992f5-206">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="992f5-207">InfraAzureDirectoryTenantAdminCredential</span><span class="sxs-lookup"><span data-stu-id="992f5-207">InfraAzureDirectoryTenantAdminCredential</span></span> |<span data-ttu-id="992f5-208">Optional</span><span class="sxs-lookup"><span data-stu-id="992f5-208">Optional</span></span> |<span data-ttu-id="992f5-209">Sets the Azure Active Directory user name and password.</span><span class="sxs-lookup"><span data-stu-id="992f5-209">Sets the Azure Active Directory user name and password.</span></span> <span data-ttu-id="992f5-210">These Azure credentials must be an Org ID.</span><span class="sxs-lookup"><span data-stu-id="992f5-210">These Azure credentials must be an Org ID.</span></span>|
| <span data-ttu-id="992f5-211">InfraAzureDirectoryTenantName</span><span class="sxs-lookup"><span data-stu-id="992f5-211">InfraAzureDirectoryTenantName</span></span> |<span data-ttu-id="992f5-212">Required</span><span class="sxs-lookup"><span data-stu-id="992f5-212">Required</span></span> |<span data-ttu-id="992f5-213">Sets the tenant directory.</span><span class="sxs-lookup"><span data-stu-id="992f5-213">Sets the tenant directory.</span></span> <span data-ttu-id="992f5-214">Use this parameter to specify a specific directory where the AAD account has permissions to manage multiple directories.</span><span class="sxs-lookup"><span data-stu-id="992f5-214">Use this parameter to specify a specific directory where the AAD account has permissions to manage multiple directories.</span></span> <span data-ttu-id="992f5-215">Full Name of an AAD Directory Tenant in the format of <directoryName>.onmicrosoft.com.</span><span class="sxs-lookup"><span data-stu-id="992f5-215">Full Name of an AAD Directory Tenant in the format of <directoryName>.onmicrosoft.com.</span></span> |
| <span data-ttu-id="992f5-216">AdminPassword</span><span class="sxs-lookup"><span data-stu-id="992f5-216">AdminPassword</span></span> |<span data-ttu-id="992f5-217">Required</span><span class="sxs-lookup"><span data-stu-id="992f5-217">Required</span></span> |<span data-ttu-id="992f5-218">Sets the local administrator account and all other user accounts on all the virtual machines created as part of POC deployment.</span><span class="sxs-lookup"><span data-stu-id="992f5-218">Sets the local administrator account and all other user accounts on all the virtual machines created as part of POC deployment.</span></span> <span data-ttu-id="992f5-219">This password must match the current local administrator password on the host.</span><span class="sxs-lookup"><span data-stu-id="992f5-219">This password must match the current local administrator password on the host.</span></span> |
| <span data-ttu-id="992f5-220">AzureEnvironment</span><span class="sxs-lookup"><span data-stu-id="992f5-220">AzureEnvironment</span></span> |<span data-ttu-id="992f5-221">Optional</span><span class="sxs-lookup"><span data-stu-id="992f5-221">Optional</span></span> |<span data-ttu-id="992f5-222">Select the Azure Environment with which you want to register this Azure Stack deployment.</span><span class="sxs-lookup"><span data-stu-id="992f5-222">Select the Azure Environment with which you want to register this Azure Stack deployment.</span></span> <span data-ttu-id="992f5-223">Options include *Public Azure*, *Azure - China*, *Azure - US Government*.</span><span class="sxs-lookup"><span data-stu-id="992f5-223">Options include *Public Azure*, *Azure - China*, *Azure - US Government*.</span></span> |
| <span data-ttu-id="992f5-224">EnvironmentDNS</span><span class="sxs-lookup"><span data-stu-id="992f5-224">EnvironmentDNS</span></span> |<span data-ttu-id="992f5-225">Optional</span><span class="sxs-lookup"><span data-stu-id="992f5-225">Optional</span></span> |<span data-ttu-id="992f5-226">A DNS server is created as part of the Azure Stack deployment.</span><span class="sxs-lookup"><span data-stu-id="992f5-226">A DNS server is created as part of the Azure Stack deployment.</span></span> <span data-ttu-id="992f5-227">To allow computers inside the solution to resolve names outside of the stamp, provide your existing infrastructure DNS server.</span><span class="sxs-lookup"><span data-stu-id="992f5-227">To allow computers inside the solution to resolve names outside of the stamp, provide your existing infrastructure DNS server.</span></span> <span data-ttu-id="992f5-228">The in-stamp DNS server forwards unknown name resolution requests to this server.</span><span class="sxs-lookup"><span data-stu-id="992f5-228">The in-stamp DNS server forwards unknown name resolution requests to this server.</span></span> |
| <span data-ttu-id="992f5-229">NatIPv4Address</span><span class="sxs-lookup"><span data-stu-id="992f5-229">NatIPv4Address</span></span> |<span data-ttu-id="992f5-230">Required for DHCP NAT support</span><span class="sxs-lookup"><span data-stu-id="992f5-230">Required for DHCP NAT support</span></span> |<span data-ttu-id="992f5-231">Sets a static IP address for MAS-BGPNAT01.</span><span class="sxs-lookup"><span data-stu-id="992f5-231">Sets a static IP address for MAS-BGPNAT01.</span></span> <span data-ttu-id="992f5-232">Only use this parameter if the DHCP can’t assign a valid IP address to access the Internet.</span><span class="sxs-lookup"><span data-stu-id="992f5-232">Only use this parameter if the DHCP can’t assign a valid IP address to access the Internet.</span></span> |
| <span data-ttu-id="992f5-233">NatIPv4DefaultGateway</span><span class="sxs-lookup"><span data-stu-id="992f5-233">NatIPv4DefaultGateway</span></span> |<span data-ttu-id="992f5-234">Required for DHCP NAT support</span><span class="sxs-lookup"><span data-stu-id="992f5-234">Required for DHCP NAT support</span></span> |<span data-ttu-id="992f5-235">Sets the default gateway used with the static IP address for MAS-BGPNAT01.</span><span class="sxs-lookup"><span data-stu-id="992f5-235">Sets the default gateway used with the static IP address for MAS-BGPNAT01.</span></span> <span data-ttu-id="992f5-236">Only use this parameter if the DHCP can’t assign a valid IP address to access the Internet.</span><span class="sxs-lookup"><span data-stu-id="992f5-236">Only use this parameter if the DHCP can’t assign a valid IP address to access the Internet.</span></span> |
| <span data-ttu-id="992f5-237">NatIPv4Subnet</span><span class="sxs-lookup"><span data-stu-id="992f5-237">NatIPv4Subnet</span></span> |<span data-ttu-id="992f5-238">Required for DHCP NAT support</span><span class="sxs-lookup"><span data-stu-id="992f5-238">Required for DHCP NAT support</span></span> |<span data-ttu-id="992f5-239">IP Subnet prefix used for DHCP over NAT support.</span><span class="sxs-lookup"><span data-stu-id="992f5-239">IP Subnet prefix used for DHCP over NAT support.</span></span> <span data-ttu-id="992f5-240">Only use this parameter if the DHCP can’t assign a valid IP address to access the Internet.</span><span class="sxs-lookup"><span data-stu-id="992f5-240">Only use this parameter if the DHCP can’t assign a valid IP address to access the Internet.</span></span> |
| <span data-ttu-id="992f5-241">PublicVLan</span><span class="sxs-lookup"><span data-stu-id="992f5-241">PublicVLan</span></span> |<span data-ttu-id="992f5-242">Optional</span><span class="sxs-lookup"><span data-stu-id="992f5-242">Optional</span></span> |<span data-ttu-id="992f5-243">Sets the VLAN ID.</span><span class="sxs-lookup"><span data-stu-id="992f5-243">Sets the VLAN ID.</span></span> <span data-ttu-id="992f5-244">Only use this parameter if the host and MAS-BGPNAT01 must configure VLAN ID to access the physical network (and Internet).</span><span class="sxs-lookup"><span data-stu-id="992f5-244">Only use this parameter if the host and MAS-BGPNAT01 must configure VLAN ID to access the physical network (and Internet).</span></span> <span data-ttu-id="992f5-245">For example, `.\InstallAzureStackPOC.ps1 –Verbose –PublicVLan 305`</span><span class="sxs-lookup"><span data-stu-id="992f5-245">For example, `.\InstallAzureStackPOC.ps1 –Verbose –PublicVLan 305`</span></span> |
| <span data-ttu-id="992f5-246">Rerun</span><span class="sxs-lookup"><span data-stu-id="992f5-246">Rerun</span></span> |<span data-ttu-id="992f5-247">Optional</span><span class="sxs-lookup"><span data-stu-id="992f5-247">Optional</span></span> |<span data-ttu-id="992f5-248">Use this flag to rerun deployment.</span><span class="sxs-lookup"><span data-stu-id="992f5-248">Use this flag to rerun deployment.</span></span>  <span data-ttu-id="992f5-249">All previous input is used.</span><span class="sxs-lookup"><span data-stu-id="992f5-249">All previous input is used.</span></span> <span data-ttu-id="992f5-250">Re-entering data previously provided is not supported because several unique values are generated and used for deployment.</span><span class="sxs-lookup"><span data-stu-id="992f5-250">Re-entering data previously provided is not supported because several unique values are generated and used for deployment.</span></span> |
| <span data-ttu-id="992f5-251">TimeServer</span><span class="sxs-lookup"><span data-stu-id="992f5-251">TimeServer</span></span> |<span data-ttu-id="992f5-252">Optional</span><span class="sxs-lookup"><span data-stu-id="992f5-252">Optional</span></span> |<span data-ttu-id="992f5-253">Use this parameter if you need to specify a specific time server.</span><span class="sxs-lookup"><span data-stu-id="992f5-253">Use this parameter if you need to specify a specific time server.</span></span> |

## <a name="activate-the-administrator-and-tenant-portals"></a><span data-ttu-id="992f5-254">Activate the administrator and tenant portals</span><span class="sxs-lookup"><span data-stu-id="992f5-254">Activate the administrator and tenant portals</span></span>

<span data-ttu-id="992f5-255">After deployments that use Azure Active Directory, you must activate both the administrator and tenant portals.</span><span class="sxs-lookup"><span data-stu-id="992f5-255">After deployments that use Azure Active Directory, you must activate both the administrator and tenant portals.</span></span> <span data-ttu-id="992f5-256">This activation consents to giving the Azure Stack portal and Azure Resource Manager the correct permissions (listed on the consent page) for all users of the directory.</span><span class="sxs-lookup"><span data-stu-id="992f5-256">This activation consents to giving the Azure Stack portal and Azure Resource Manager the correct permissions (listed on the consent page) for all users of the directory.</span></span>

1. <span data-ttu-id="992f5-257">For the administrator portal, navigate to https://adminportal.local.azurestack.external/guest/signup, read the information, and then click **Accept**.</span><span class="sxs-lookup"><span data-stu-id="992f5-257">For the administrator portal, navigate to https://adminportal.local.azurestack.external/guest/signup, read the information, and then click **Accept**.</span></span> <span data-ttu-id="992f5-258">After accepting, you can add service administrators who are not also directory tenant administrators.</span><span class="sxs-lookup"><span data-stu-id="992f5-258">After accepting, you can add service administrators who are not also directory tenant administrators.</span></span>

2. <span data-ttu-id="992f5-259">For the tenant portal, navigate to https://portal.local.azurestack.external/guest/signup, read the information, and then click **Accept**.</span><span class="sxs-lookup"><span data-stu-id="992f5-259">For the tenant portal, navigate to https://portal.local.azurestack.external/guest/signup, read the information, and then click **Accept**.</span></span> <span data-ttu-id="992f5-260">After accepting, users in the directory can sign in to the tenant portal.</span><span class="sxs-lookup"><span data-stu-id="992f5-260">After accepting, users in the directory can sign in to the tenant portal.</span></span>

> [!NOTE]
> <span data-ttu-id="992f5-261">If the portals are not activated, only the directory administrator can sign in and use the portals.</span><span class="sxs-lookup"><span data-stu-id="992f5-261">If the portals are not activated, only the directory administrator can sign in and use the portals.</span></span> <span data-ttu-id="992f5-262">If any other user signs in, they will see an error that tells them that the administrator has not granted permissions to other users.</span><span class="sxs-lookup"><span data-stu-id="992f5-262">If any other user signs in, they will see an error that tells them that the administrator has not granted permissions to other users.</span></span>
> <span data-ttu-id="992f5-263">When the administrator does not natively belong to the directory Azure Stack is registered to, the Azure Stack directory must be appended to the activation URL.</span><span class="sxs-lookup"><span data-stu-id="992f5-263">When the administrator does not natively belong to the directory Azure Stack is registered to, the Azure Stack directory must be appended to the activation URL.</span></span> <span data-ttu-id="992f5-264">For example, if Azure Stack is registered to fabrikam.onmicrosoft.com and the admin user is admin@contoso.com, navigate to https://portal.local.azurestack.external/guest/signup/fabrikam.onmicrosoft.com to activate the portal.</span><span class="sxs-lookup"><span data-stu-id="992f5-264">For example, if Azure Stack is registered to fabrikam.onmicrosoft.com and the admin user is admin@contoso.com, navigate to https://portal.local.azurestack.external/guest/signup/fabrikam.onmicrosoft.com to activate the portal.</span></span>
> 
> 

## <a name="reset-the-password-expiration-to-180-days"></a><span data-ttu-id="992f5-265">Reset the password expiration to 180 days</span><span class="sxs-lookup"><span data-stu-id="992f5-265">Reset the password expiration to 180 days</span></span>

<span data-ttu-id="992f5-266">To make sure that the password for the POC host doesn't expire too soon, follow these steps after you deploy:</span><span class="sxs-lookup"><span data-stu-id="992f5-266">To make sure that the password for the POC host doesn't expire too soon, follow these steps after you deploy:</span></span>

1. <span data-ttu-id="992f5-267">Sign in to the POC host as azurestack\azurestackadmin.</span><span class="sxs-lookup"><span data-stu-id="992f5-267">Sign in to the POC host as azurestack\azurestackadmin.</span></span>

2. <span data-ttu-id="992f5-268">Run the following command to display the current MaxPasswordAge of 42 days: `Get-ADDefaultDomainPasswordPolicy`</span><span class="sxs-lookup"><span data-stu-id="992f5-268">Run the following command to display the current MaxPasswordAge of 42 days: `Get-ADDefaultDomainPasswordPolicy`</span></span>

3. <span data-ttu-id="992f5-269">Run the following command to update the MaxPasswordAge to 180 days:</span><span class="sxs-lookup"><span data-stu-id="992f5-269">Run the following command to update the MaxPasswordAge to 180 days:</span></span>

    `Set-ADDefaultDomainPasswordPolicy -MaxPasswordAge 180.00:00:00 -Identity azurestack.local`   

4. <span data-ttu-id="992f5-270">Run the following command again to confirm the password age change: `Get-ADDefaultDomainPasswordPolicy`.</span><span class="sxs-lookup"><span data-stu-id="992f5-270">Run the following command again to confirm the password age change: `Get-ADDefaultDomainPasswordPolicy`.</span></span>

## <a name="next-steps"></a><span data-ttu-id="992f5-271">Next steps</span><span class="sxs-lookup"><span data-stu-id="992f5-271">Next steps</span></span>
<span data-ttu-id="992f5-272">[Register Azure Stack with your Azure subscription](azure-stack-register.md)
[Connect to Azure Stack](azure-stack-connect-azure-stack.md)</span><span class="sxs-lookup"><span data-stu-id="992f5-272">[Register Azure Stack with your Azure subscription](azure-stack-register.md)
[Connect to Azure Stack](azure-stack-connect-azure-stack.md)</span></span>

