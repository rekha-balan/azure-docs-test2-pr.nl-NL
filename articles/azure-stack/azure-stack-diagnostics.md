---
title: Diagnostics in Azure Stack
description: How to collect log files for diagnostics in Azure Stack
services: azure-stack
author: jeffgilb
manager: femila
cloud: azure-stack
ms.service: azure-stack
ms.topic: article
ms.date: 08/22/2018
ms.author: jeffgilb
ms.reviewer: adshar
ms.openlocfilehash: a36609ae63351070bb28469d9ccf1f3deb7bc6ff
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44783931"
---
# <a name="azure-stack-diagnostics-tools"></a><span data-ttu-id="8bbc0-103">Azure Stack diagnostics tools</span><span class="sxs-lookup"><span data-stu-id="8bbc0-103">Azure Stack diagnostics tools</span></span>

<span data-ttu-id="8bbc0-104">Azure Stack is a large collection of components working together and interacting with each other.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-104">Azure Stack is a large collection of components working together and interacting with each other.</span></span> <span data-ttu-id="8bbc0-105">All these components  generate their own unique logs.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-105">All these components  generate their own unique logs.</span></span> <span data-ttu-id="8bbc0-106">This can make diagnosing issues a challenging task, especially for errors coming from multiple, interacting Azure Stack components.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-106">This can make diagnosing issues a challenging task, especially for errors coming from multiple, interacting Azure Stack components.</span></span> 

<span data-ttu-id="8bbc0-107">Our diagnostics tools help ensure the log collection mechanism is easy and efficient.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-107">Our diagnostics tools help ensure the log collection mechanism is easy and efficient.</span></span> <span data-ttu-id="8bbc0-108">The following diagram shows how log collection tools in Azure Stack work:</span><span class="sxs-lookup"><span data-stu-id="8bbc0-108">The following diagram shows how log collection tools in Azure Stack work:</span></span>

![Azure Stack diagnostic tools](media/azure-stack-diagnostics/get-azslogs.png)
 
 
## <a name="trace-collector"></a><span data-ttu-id="8bbc0-110">Trace Collector</span><span class="sxs-lookup"><span data-stu-id="8bbc0-110">Trace Collector</span></span>
 
<span data-ttu-id="8bbc0-111">The Trace Collector is enabled by default and runs continuously in the background to collect all Event Tracing for Windows (ETW) logs from Azure Stack component services.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-111">The Trace Collector is enabled by default and runs continuously in the background to collect all Event Tracing for Windows (ETW) logs from Azure Stack component services.</span></span> <span data-ttu-id="8bbc0-112">ETW logs are stored in a common local share with a five day age limit.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-112">ETW logs are stored in a common local share with a five day age limit.</span></span> <span data-ttu-id="8bbc0-113">Once this limit is reached, the oldest files are deleted as new ones are created.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-113">Once this limit is reached, the oldest files are deleted as new ones are created.</span></span> <span data-ttu-id="8bbc0-114">The default maximum size allowed for each file  is 200 MB.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-114">The default maximum size allowed for each file  is 200 MB.</span></span> <span data-ttu-id="8bbc0-115">A size check occurs every 2 minutes, and if the current file is >= 200 MB, it is saved and a new file is generated.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-115">A size check occurs every 2 minutes, and if the current file is >= 200 MB, it is saved and a new file is generated.</span></span> <span data-ttu-id="8bbc0-116">There is also an 8 GB limit on the total file size generated per event session.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-116">There is also an 8 GB limit on the total file size generated per event session.</span></span> 

## <a name="log-collection-tool"></a><span data-ttu-id="8bbc0-117">Log collection tool</span><span class="sxs-lookup"><span data-stu-id="8bbc0-117">Log collection tool</span></span>
 
<span data-ttu-id="8bbc0-118">The PowerShell cmdlet **Get-AzureStackLog** can be used to collect logs from all the components  in an Azure Stack environment.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-118">The PowerShell cmdlet **Get-AzureStackLog** can be used to collect logs from all the components  in an Azure Stack environment.</span></span> <span data-ttu-id="8bbc0-119">It saves them in zip files in a user-defined location.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-119">It saves them in zip files in a user-defined location.</span></span> <span data-ttu-id="8bbc0-120">If the Azure Stack technical support team needs your logs to help troubleshoot an issue, they may ask you to run this tool.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-120">If the Azure Stack technical support team needs your logs to help troubleshoot an issue, they may ask you to run this tool.</span></span>

> [!CAUTION]
> <span data-ttu-id="8bbc0-121">These log files may contain personally identifiable information (PII).</span><span class="sxs-lookup"><span data-stu-id="8bbc0-121">These log files may contain personally identifiable information (PII).</span></span> <span data-ttu-id="8bbc0-122">Take this into account before you publicly post any log files.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-122">Take this into account before you publicly post any log files.</span></span>
 
<span data-ttu-id="8bbc0-123">The following are some example log types that are collected:</span><span class="sxs-lookup"><span data-stu-id="8bbc0-123">The following are some example log types that are collected:</span></span>
*   <span data-ttu-id="8bbc0-124">**Azure Stack deployment logs**</span><span class="sxs-lookup"><span data-stu-id="8bbc0-124">**Azure Stack deployment logs**</span></span>
*   <span data-ttu-id="8bbc0-125">**Windows event logs**</span><span class="sxs-lookup"><span data-stu-id="8bbc0-125">**Windows event logs**</span></span>
*   <span data-ttu-id="8bbc0-126">**Panther logs**</span><span class="sxs-lookup"><span data-stu-id="8bbc0-126">**Panther logs**</span></span>
*   <span data-ttu-id="8bbc0-127">**Cluster logs**</span><span class="sxs-lookup"><span data-stu-id="8bbc0-127">**Cluster logs**</span></span>
*   <span data-ttu-id="8bbc0-128">**Storage diagnostic logs**</span><span class="sxs-lookup"><span data-stu-id="8bbc0-128">**Storage diagnostic logs**</span></span>
*   <span data-ttu-id="8bbc0-129">**ETW logs**</span><span class="sxs-lookup"><span data-stu-id="8bbc0-129">**ETW logs**</span></span>

<span data-ttu-id="8bbc0-130">These files are collected and saved in a share by Trace Collector.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-130">These files are collected and saved in a share by Trace Collector.</span></span> <span data-ttu-id="8bbc0-131">The  **Get-AzureStackLog** PowerShell cmdlet can then be used to collect them when necessary.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-131">The  **Get-AzureStackLog** PowerShell cmdlet can then be used to collect them when necessary.</span></span>

### <a name="to-run-get-azurestacklog-on-azure-stack-integrated-systems"></a><span data-ttu-id="8bbc0-132">To run Get-AzureStackLog on Azure Stack integrated systems</span><span class="sxs-lookup"><span data-stu-id="8bbc0-132">To run Get-AzureStackLog on Azure Stack integrated systems</span></span> 
<span data-ttu-id="8bbc0-133">To run the log collection tool on an integrated system, you need to have access to the Privileged End Point (PEP).</span><span class="sxs-lookup"><span data-stu-id="8bbc0-133">To run the log collection tool on an integrated system, you need to have access to the Privileged End Point (PEP).</span></span> <span data-ttu-id="8bbc0-134">Here is an example script you can run using the PEP to collect logs on an integrated system:</span><span class="sxs-lookup"><span data-stu-id="8bbc0-134">Here is an example script you can run using the PEP to collect logs on an integrated system:</span></span>

```powershell
$ip = "<IP ADDRESS OF THE PEP VM>" # You can also use the machine name instead of IP here.
 
$pwd= ConvertTo-SecureString "<CLOUD ADMIN PASSWORD>" -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential ("<DOMAIN NAME>\CloudAdmin", $pwd)
 
$shareCred = Get-Credential
 
$s = New-PSSession -ComputerName $ip -ConfigurationName PrivilegedEndpoint -Credential $cred

$fromDate = (Get-Date).AddHours(-8)
$toDate = (Get-Date).AddHours(-2)  #provide the time that includes the period for your issue
 
Invoke-Command -Session $s {    Get-AzureStackLog -OutputSharePath "<EXTERNAL SHARE ADDRESS>" -OutputShareCredential $using:shareCred  -FilterByRole Storage -FromDate $using:fromDate -ToDate $using:toDate}

if($s)
{
    Remove-PSSession $s
}
```

- <span data-ttu-id="8bbc0-135">The parameters **OutputSharePath** and **OutputShareCredential** are used to upload logs to an external shared folder.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-135">The parameters **OutputSharePath** and **OutputShareCredential** are used to upload logs to an external shared folder.</span></span>
- <span data-ttu-id="8bbc0-136">As shown in the previous example, the **FromDate** and **ToDate** parameters can be used to collect logs for a particular time period.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-136">As shown in the previous example, the **FromDate** and **ToDate** parameters can be used to collect logs for a particular time period.</span></span> <span data-ttu-id="8bbc0-137">This can come in handy for scenarios like collecting logs after applying an update package on an integrated system.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-137">This can come in handy for scenarios like collecting logs after applying an update package on an integrated system.</span></span>


 
### <a name="to-run-get-azurestacklog-on-an-azure-stack-development-kit-asdk-system"></a><span data-ttu-id="8bbc0-138">To run Get-AzureStackLog on an Azure Stack Development Kit (ASDK) system</span><span class="sxs-lookup"><span data-stu-id="8bbc0-138">To run Get-AzureStackLog on an Azure Stack Development Kit (ASDK) system</span></span>
1. <span data-ttu-id="8bbc0-139">Sign in as **AzureStack\CloudAdmin** on the host.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-139">Sign in as **AzureStack\CloudAdmin** on the host.</span></span>
2. <span data-ttu-id="8bbc0-140">Open a PowerShell window as an administrator.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-140">Open a PowerShell window as an administrator.</span></span>
3. <span data-ttu-id="8bbc0-141">Run the **Get-AzureStackLog** PowerShell cmdlet.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-141">Run the **Get-AzureStackLog** PowerShell cmdlet.</span></span>

<span data-ttu-id="8bbc0-142">**Examples:**</span><span class="sxs-lookup"><span data-stu-id="8bbc0-142">**Examples:**</span></span>

  <span data-ttu-id="8bbc0-143">Collect all logs for all roles:</span><span class="sxs-lookup"><span data-stu-id="8bbc0-143">Collect all logs for all roles:</span></span>

  ```powershell
  Get-AzureStackLog -OutputPath C:\AzureStackLogs
  ```

  <span data-ttu-id="8bbc0-144">Collect logs from VirtualMachines and BareMetal roles:</span><span class="sxs-lookup"><span data-stu-id="8bbc0-144">Collect logs from VirtualMachines and BareMetal roles:</span></span>

  ```powershell
  Get-AzureStackLog -OutputPath C:\AzureStackLogs -FilterByRole VirtualMachines,BareMetal
  ```

  <span data-ttu-id="8bbc0-145">Collect logs from VirtualMachines and BareMetal roles, with date filtering for log files for the past 8 hours:</span><span class="sxs-lookup"><span data-stu-id="8bbc0-145">Collect logs from VirtualMachines and BareMetal roles, with date filtering for log files for the past 8 hours:</span></span>
    
  ```powershell
  Get-AzureStackLog -OutputPath C:\AzureStackLogs -FilterByRole VirtualMachines,BareMetal -FromDate (Get-Date).AddHours(-8)
  ```

  <span data-ttu-id="8bbc0-146">Collect logs from VirtualMachines and BareMetal roles, with date filtering for log files for the time period between 8 hours ago and 2 hours ago:</span><span class="sxs-lookup"><span data-stu-id="8bbc0-146">Collect logs from VirtualMachines and BareMetal roles, with date filtering for log files for the time period between 8 hours ago and 2 hours ago:</span></span>

  ```powershell
  Get-AzureStackLog -OutputPath C:\AzureStackLogs -FilterByRole VirtualMachines,BareMetal -FromDate (Get-Date).AddHours(-8) -ToDate (Get-Date).AddHours(-2)
  ```

### <a name="parameter-considerations-for-both-asdk-and-integrated-systems"></a><span data-ttu-id="8bbc0-147">Parameter considerations for both ASDK and integrated systems</span><span class="sxs-lookup"><span data-stu-id="8bbc0-147">Parameter considerations for both ASDK and integrated systems</span></span>

- <span data-ttu-id="8bbc0-148">If the **FromDate** and **ToDate** parameters are not specified, logs are collected for the past four hours by default.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-148">If the **FromDate** and **ToDate** parameters are not specified, logs are collected for the past four hours by default.</span></span>
- <span data-ttu-id="8bbc0-149">Use the **FilterByNode** parameter to filter logs by computer name.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-149">Use the **FilterByNode** parameter to filter logs by computer name.</span></span> <span data-ttu-id="8bbc0-150">For example: ```Get-AzureStackLog -OutputPath <path> -FilterByNode azs-xrp01```</span><span class="sxs-lookup"><span data-stu-id="8bbc0-150">For example: ```Get-AzureStackLog -OutputPath <path> -FilterByNode azs-xrp01```</span></span>
- <span data-ttu-id="8bbc0-151">Use the **FilterByLogType** parameter to filter logs by type.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-151">Use the **FilterByLogType** parameter to filter logs by type.</span></span> <span data-ttu-id="8bbc0-152">You can choose to filter by File, Share or WindowsEvent.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-152">You can choose to filter by File, Share or WindowsEvent.</span></span> <span data-ttu-id="8bbc0-153">For example: ```Get-AzureStackLog -OutputPath <path> -FilterByLogType File```</span><span class="sxs-lookup"><span data-stu-id="8bbc0-153">For example: ```Get-AzureStackLog -OutputPath <path> -FilterByLogType File```</span></span>
- <span data-ttu-id="8bbc0-154">You can use the **TimeOutInMinutes** parameter to set the timeout for log collection.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-154">You can use the **TimeOutInMinutes** parameter to set the timeout for log collection.</span></span> <span data-ttu-id="8bbc0-155">It is set to 150 (2.5 hours) by default.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-155">It is set to 150 (2.5 hours) by default.</span></span>
- <span data-ttu-id="8bbc0-156">In version 1805 and later, dump file log collection is disabled by default.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-156">In version 1805 and later, dump file log collection is disabled by default.</span></span> <span data-ttu-id="8bbc0-157">To enable it, use the **IncludeDumpFile** switch parameter.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-157">To enable it, use the **IncludeDumpFile** switch parameter.</span></span> 
- <span data-ttu-id="8bbc0-158">Currently, you can use the **FilterByRole** parameter to filter log collection by the following roles:</span><span class="sxs-lookup"><span data-stu-id="8bbc0-158">Currently, you can use the **FilterByRole** parameter to filter log collection by the following roles:</span></span>

 |   |   |   |    |
 | - | - | - | -  |   
 |<span data-ttu-id="8bbc0-159">ACS</span><span class="sxs-lookup"><span data-stu-id="8bbc0-159">ACS</span></span>|<span data-ttu-id="8bbc0-160">Compute</span><span class="sxs-lookup"><span data-stu-id="8bbc0-160">Compute</span></span>|<span data-ttu-id="8bbc0-161">InfraServiceController</span><span class="sxs-lookup"><span data-stu-id="8bbc0-161">InfraServiceController</span></span>|<span data-ttu-id="8bbc0-162">QueryServiceCoordinator</span><span class="sxs-lookup"><span data-stu-id="8bbc0-162">QueryServiceCoordinator</span></span>|
 |<span data-ttu-id="8bbc0-163">ACSBlob</span><span class="sxs-lookup"><span data-stu-id="8bbc0-163">ACSBlob</span></span>|<span data-ttu-id="8bbc0-164">CPI</span><span class="sxs-lookup"><span data-stu-id="8bbc0-164">CPI</span></span>|<span data-ttu-id="8bbc0-165">Infrastructure</span><span class="sxs-lookup"><span data-stu-id="8bbc0-165">Infrastructure</span></span>|<span data-ttu-id="8bbc0-166">QueryServiceWorker</span><span class="sxs-lookup"><span data-stu-id="8bbc0-166">QueryServiceWorker</span></span>|
 |<span data-ttu-id="8bbc0-167">ACSDownloadService</span><span class="sxs-lookup"><span data-stu-id="8bbc0-167">ACSDownloadService</span></span>|<span data-ttu-id="8bbc0-168">CRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-168">CRP</span></span>|<span data-ttu-id="8bbc0-169">KeyVaultAdminResourceProvider</span><span class="sxs-lookup"><span data-stu-id="8bbc0-169">KeyVaultAdminResourceProvider</span></span>|<span data-ttu-id="8bbc0-170">SeedRing</span><span class="sxs-lookup"><span data-stu-id="8bbc0-170">SeedRing</span></span>|
 |<span data-ttu-id="8bbc0-171">ACSFabric</span><span class="sxs-lookup"><span data-stu-id="8bbc0-171">ACSFabric</span></span>|<span data-ttu-id="8bbc0-172">DatacenterIntegration</span><span class="sxs-lookup"><span data-stu-id="8bbc0-172">DatacenterIntegration</span></span>|<span data-ttu-id="8bbc0-173">KeyVaultControlPlane</span><span class="sxs-lookup"><span data-stu-id="8bbc0-173">KeyVaultControlPlane</span></span>|<span data-ttu-id="8bbc0-174">SeedRingServices</span><span class="sxs-lookup"><span data-stu-id="8bbc0-174">SeedRingServices</span></span>|
 |<span data-ttu-id="8bbc0-175">ACSFrontEnd</span><span class="sxs-lookup"><span data-stu-id="8bbc0-175">ACSFrontEnd</span></span>|<span data-ttu-id="8bbc0-176">DeploymentMachine</span><span class="sxs-lookup"><span data-stu-id="8bbc0-176">DeploymentMachine</span></span>|<span data-ttu-id="8bbc0-177">KeyVaultDataPlane</span><span class="sxs-lookup"><span data-stu-id="8bbc0-177">KeyVaultDataPlane</span></span>|<span data-ttu-id="8bbc0-178">SLB</span><span class="sxs-lookup"><span data-stu-id="8bbc0-178">SLB</span></span>|
 |<span data-ttu-id="8bbc0-179">ACSMetrics</span><span class="sxs-lookup"><span data-stu-id="8bbc0-179">ACSMetrics</span></span>|<span data-ttu-id="8bbc0-180">DiskRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-180">DiskRP</span></span>|<span data-ttu-id="8bbc0-181">KeyVaultInternalControlPlane</span><span class="sxs-lookup"><span data-stu-id="8bbc0-181">KeyVaultInternalControlPlane</span></span>|<span data-ttu-id="8bbc0-182">SlbVips</span><span class="sxs-lookup"><span data-stu-id="8bbc0-182">SlbVips</span></span>|
 |<span data-ttu-id="8bbc0-183">ACSMigrationService</span><span class="sxs-lookup"><span data-stu-id="8bbc0-183">ACSMigrationService</span></span>|<span data-ttu-id="8bbc0-184">Domain</span><span class="sxs-lookup"><span data-stu-id="8bbc0-184">Domain</span></span>|<span data-ttu-id="8bbc0-185">KeyVaultInternalDataPlane</span><span class="sxs-lookup"><span data-stu-id="8bbc0-185">KeyVaultInternalDataPlane</span></span>|<span data-ttu-id="8bbc0-186">SQL</span><span class="sxs-lookup"><span data-stu-id="8bbc0-186">SQL</span></span>|
 |<span data-ttu-id="8bbc0-187">ACSMonitoringService</span><span class="sxs-lookup"><span data-stu-id="8bbc0-187">ACSMonitoringService</span></span>|<span data-ttu-id="8bbc0-188">ECE</span><span class="sxs-lookup"><span data-stu-id="8bbc0-188">ECE</span></span>|<span data-ttu-id="8bbc0-189">KeyVaultNamingService</span><span class="sxs-lookup"><span data-stu-id="8bbc0-189">KeyVaultNamingService</span></span>|<span data-ttu-id="8bbc0-190">SRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-190">SRP</span></span>|
 |<span data-ttu-id="8bbc0-191">ACSSettingsService</span><span class="sxs-lookup"><span data-stu-id="8bbc0-191">ACSSettingsService</span></span>|<span data-ttu-id="8bbc0-192">EventAdminRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-192">EventAdminRP</span></span>|<span data-ttu-id="8bbc0-193">MDM</span><span class="sxs-lookup"><span data-stu-id="8bbc0-193">MDM</span></span>|<span data-ttu-id="8bbc0-194">Storage</span><span class="sxs-lookup"><span data-stu-id="8bbc0-194">Storage</span></span>|
 |<span data-ttu-id="8bbc0-195">ACSTableMaster</span><span class="sxs-lookup"><span data-stu-id="8bbc0-195">ACSTableMaster</span></span>|<span data-ttu-id="8bbc0-196">EventRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-196">EventRP</span></span>|<span data-ttu-id="8bbc0-197">MetricsAdminRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-197">MetricsAdminRP</span></span>|<span data-ttu-id="8bbc0-198">StorageAccounts</span><span class="sxs-lookup"><span data-stu-id="8bbc0-198">StorageAccounts</span></span>|
 |<span data-ttu-id="8bbc0-199">ACSTableServer</span><span class="sxs-lookup"><span data-stu-id="8bbc0-199">ACSTableServer</span></span>|<span data-ttu-id="8bbc0-200">ExternalDNS</span><span class="sxs-lookup"><span data-stu-id="8bbc0-200">ExternalDNS</span></span>|<span data-ttu-id="8bbc0-201">MetricsRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-201">MetricsRP</span></span>|<span data-ttu-id="8bbc0-202">StorageController</span><span class="sxs-lookup"><span data-stu-id="8bbc0-202">StorageController</span></span>|
 |<span data-ttu-id="8bbc0-203">ACSWac</span><span class="sxs-lookup"><span data-stu-id="8bbc0-203">ACSWac</span></span>|<span data-ttu-id="8bbc0-204">Fabric</span><span class="sxs-lookup"><span data-stu-id="8bbc0-204">Fabric</span></span>|<span data-ttu-id="8bbc0-205">MetricsServer</span><span class="sxs-lookup"><span data-stu-id="8bbc0-205">MetricsServer</span></span>|<span data-ttu-id="8bbc0-206">Tenant</span><span class="sxs-lookup"><span data-stu-id="8bbc0-206">Tenant</span></span>|
 |<span data-ttu-id="8bbc0-207">ADFS</span><span class="sxs-lookup"><span data-stu-id="8bbc0-207">ADFS</span></span>|<span data-ttu-id="8bbc0-208">FabricRing</span><span class="sxs-lookup"><span data-stu-id="8bbc0-208">FabricRing</span></span>|<span data-ttu-id="8bbc0-209">MetricsStoreService</span><span class="sxs-lookup"><span data-stu-id="8bbc0-209">MetricsStoreService</span></span>|<span data-ttu-id="8bbc0-210">TraceCollector</span><span class="sxs-lookup"><span data-stu-id="8bbc0-210">TraceCollector</span></span>|
 |<span data-ttu-id="8bbc0-211">ApplicationController</span><span class="sxs-lookup"><span data-stu-id="8bbc0-211">ApplicationController</span></span>|<span data-ttu-id="8bbc0-212">FabricRingServices</span><span class="sxs-lookup"><span data-stu-id="8bbc0-212">FabricRingServices</span></span>|<span data-ttu-id="8bbc0-213">MonAdminRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-213">MonAdminRP</span></span>|<span data-ttu-id="8bbc0-214">URP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-214">URP</span></span>|
 |<span data-ttu-id="8bbc0-215">ASAppGateway</span><span class="sxs-lookup"><span data-stu-id="8bbc0-215">ASAppGateway</span></span>|<span data-ttu-id="8bbc0-216">FirstTierAggregationService</span><span class="sxs-lookup"><span data-stu-id="8bbc0-216">FirstTierAggregationService</span></span>|<span data-ttu-id="8bbc0-217">MonitoringAgent</span><span class="sxs-lookup"><span data-stu-id="8bbc0-217">MonitoringAgent</span></span>|<span data-ttu-id="8bbc0-218">Usage</span><span class="sxs-lookup"><span data-stu-id="8bbc0-218">Usage</span></span>|
 |<span data-ttu-id="8bbc0-219">AzureBridge</span><span class="sxs-lookup"><span data-stu-id="8bbc0-219">AzureBridge</span></span>|<span data-ttu-id="8bbc0-220">FRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-220">FRP</span></span>|<span data-ttu-id="8bbc0-221">MonRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-221">MonRP</span></span>|<span data-ttu-id="8bbc0-222">UsageBridge</span><span class="sxs-lookup"><span data-stu-id="8bbc0-222">UsageBridge</span></span>|
 |<span data-ttu-id="8bbc0-223">AzureMonitor</span><span class="sxs-lookup"><span data-stu-id="8bbc0-223">AzureMonitor</span></span>|<span data-ttu-id="8bbc0-224">Gallery</span><span class="sxs-lookup"><span data-stu-id="8bbc0-224">Gallery</span></span>|<span data-ttu-id="8bbc0-225">NC</span><span class="sxs-lookup"><span data-stu-id="8bbc0-225">NC</span></span>|<span data-ttu-id="8bbc0-226">VirtualMachines</span><span class="sxs-lookup"><span data-stu-id="8bbc0-226">VirtualMachines</span></span>|
 |<span data-ttu-id="8bbc0-227">AzureStackBitlocker</span><span class="sxs-lookup"><span data-stu-id="8bbc0-227">AzureStackBitlocker</span></span>|<span data-ttu-id="8bbc0-228">Gateway</span><span class="sxs-lookup"><span data-stu-id="8bbc0-228">Gateway</span></span>|<span data-ttu-id="8bbc0-229">Network</span><span class="sxs-lookup"><span data-stu-id="8bbc0-229">Network</span></span>|<span data-ttu-id="8bbc0-230">WAS</span><span class="sxs-lookup"><span data-stu-id="8bbc0-230">WAS</span></span>|
 |<span data-ttu-id="8bbc0-231">BareMetal</span><span class="sxs-lookup"><span data-stu-id="8bbc0-231">BareMetal</span></span>|<span data-ttu-id="8bbc0-232">HealthMonitoring</span><span class="sxs-lookup"><span data-stu-id="8bbc0-232">HealthMonitoring</span></span>|<span data-ttu-id="8bbc0-233">NonPrivilegedAppGateway</span><span class="sxs-lookup"><span data-stu-id="8bbc0-233">NonPrivilegedAppGateway</span></span>|<span data-ttu-id="8bbc0-234">WASBootstrap</span><span class="sxs-lookup"><span data-stu-id="8bbc0-234">WASBootstrap</span></span>|
 |<span data-ttu-id="8bbc0-235">BRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-235">BRP</span></span>|<span data-ttu-id="8bbc0-236">HintingServiceV2</span><span class="sxs-lookup"><span data-stu-id="8bbc0-236">HintingServiceV2</span></span>|<span data-ttu-id="8bbc0-237">NRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-237">NRP</span></span>|<span data-ttu-id="8bbc0-238">WASPUBLIC</span><span class="sxs-lookup"><span data-stu-id="8bbc0-238">WASPUBLIC</span></span>|
 |<span data-ttu-id="8bbc0-239">CA</span><span class="sxs-lookup"><span data-stu-id="8bbc0-239">CA</span></span>|<span data-ttu-id="8bbc0-240">HRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-240">HRP</span></span>|<span data-ttu-id="8bbc0-241">OboService</span><span class="sxs-lookup"><span data-stu-id="8bbc0-241">OboService</span></span>|<span data-ttu-id="8bbc0-242">WindowsDefender</span><span class="sxs-lookup"><span data-stu-id="8bbc0-242">WindowsDefender</span></span>|
 |<span data-ttu-id="8bbc0-243">CacheService</span><span class="sxs-lookup"><span data-stu-id="8bbc0-243">CacheService</span></span>|<span data-ttu-id="8bbc0-244">IBC</span><span class="sxs-lookup"><span data-stu-id="8bbc0-244">IBC</span></span>|<span data-ttu-id="8bbc0-245">OEM</span><span class="sxs-lookup"><span data-stu-id="8bbc0-245">OEM</span></span>|     |
 |<span data-ttu-id="8bbc0-246">Cloud</span><span class="sxs-lookup"><span data-stu-id="8bbc0-246">Cloud</span></span>|<span data-ttu-id="8bbc0-247">IdentityProvider</span><span class="sxs-lookup"><span data-stu-id="8bbc0-247">IdentityProvider</span></span>|<span data-ttu-id="8bbc0-248">OnboardRP</span><span class="sxs-lookup"><span data-stu-id="8bbc0-248">OnboardRP</span></span>|     |   
 |<span data-ttu-id="8bbc0-249">Cluster</span><span class="sxs-lookup"><span data-stu-id="8bbc0-249">Cluster</span></span>|<span data-ttu-id="8bbc0-250">iDns</span><span class="sxs-lookup"><span data-stu-id="8bbc0-250">iDns</span></span>|<span data-ttu-id="8bbc0-251">PXE</span><span class="sxs-lookup"><span data-stu-id="8bbc0-251">PXE</span></span>|     |
 |   |   |   |    |


### <a name="bkmk_gui"></a><span data-ttu-id="8bbc0-252">Collect logs using a graphical user interface</span><span class="sxs-lookup"><span data-stu-id="8bbc0-252">Collect logs using a graphical user interface</span></span>
<span data-ttu-id="8bbc0-253">Rather than providing the required parameters for the Get-AzureStackLog cmdlet to retrieve Azure Stack logs, you can also leverage the available open source Azure Stack tools located in the main Azure Stack tools GitHub tools repository at http://aka.ms/AzureStackTools.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-253">Rather than providing the required parameters for the Get-AzureStackLog cmdlet to retrieve Azure Stack logs, you can also leverage the available open source Azure Stack tools located in the main Azure Stack tools GitHub tools repository at http://aka.ms/AzureStackTools.</span></span>

<span data-ttu-id="8bbc0-254">The **ERCS_AzureStackLogs.ps1** PowerShell script is stored in the GitHub tools repository and is updated on a regular basis.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-254">The **ERCS_AzureStackLogs.ps1** PowerShell script is stored in the GitHub tools repository and is updated on a regular basis.</span></span> <span data-ttu-id="8bbc0-255">To ensure that you have the latest version available, you should download it directly from http://aka.ms/ERCS.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-255">To ensure that you have the latest version available, you should download it directly from http://aka.ms/ERCS.</span></span> <span data-ttu-id="8bbc0-256">Started from an administrative PowerShell session, the script connects to the privileged endpoint and runs Get-AzureStackLog with supplied parameters.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-256">Started from an administrative PowerShell session, the script connects to the privileged endpoint and runs Get-AzureStackLog with supplied parameters.</span></span> <span data-ttu-id="8bbc0-257">If no parameters are supplied, the script defaults to prompting for parameters via a graphical user interface.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-257">If no parameters are supplied, the script defaults to prompting for parameters via a graphical user interface.</span></span>

<span data-ttu-id="8bbc0-258">To learn more about the ERCS_AzureStackLogs.ps1 PowerShell script, you can watch [a short video](https://www.youtube.com/watch?v=Utt7pLsXEBc) or view the script’s [readme file](https://github.com/Azure/AzureStack-Tools/blob/master/Support/ERCS_Logs/ReadMe.md) located in the Azure Stack tools GitHub repository.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-258">To learn more about the ERCS_AzureStackLogs.ps1 PowerShell script, you can watch [a short video](https://www.youtube.com/watch?v=Utt7pLsXEBc) or view the script’s [readme file](https://github.com/Azure/AzureStack-Tools/blob/master/Support/ERCS_Logs/ReadMe.md) located in the Azure Stack tools GitHub repository.</span></span> 

### <a name="additional-considerations"></a><span data-ttu-id="8bbc0-259">Additional considerations</span><span class="sxs-lookup"><span data-stu-id="8bbc0-259">Additional considerations</span></span>

* <span data-ttu-id="8bbc0-260">The command takes some time to run based on which role(s) the logs are collecting.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-260">The command takes some time to run based on which role(s) the logs are collecting.</span></span> <span data-ttu-id="8bbc0-261">Contributing factors also include the time duration specified for log collection, and the numbers of nodes in the Azure Stack environment.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-261">Contributing factors also include the time duration specified for log collection, and the numbers of nodes in the Azure Stack environment.</span></span>
* <span data-ttu-id="8bbc0-262">As log collection runs, check the new folder created in the **OutputSharePath** parameter specified in the command.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-262">As log collection runs, check the new folder created in the **OutputSharePath** parameter specified in the command.</span></span>
* <span data-ttu-id="8bbc0-263">Each role has its logs inside individual zip files.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-263">Each role has its logs inside individual zip files.</span></span> <span data-ttu-id="8bbc0-264">Depending on the size of the collected logs, a role may have its logs split in to multiple zip files.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-264">Depending on the size of the collected logs, a role may have its logs split in to multiple zip files.</span></span> <span data-ttu-id="8bbc0-265">For such a role, if you want to have all the log files unzipped in to a single folder, use a tool that can  unzip in bulk (such as 7zip).</span><span class="sxs-lookup"><span data-stu-id="8bbc0-265">For such a role, if you want to have all the log files unzipped in to a single folder, use a tool that can  unzip in bulk (such as 7zip).</span></span> <span data-ttu-id="8bbc0-266">Select all the zipped files for the role, and select **extract here**.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-266">Select all the zipped files for the role, and select **extract here**.</span></span> <span data-ttu-id="8bbc0-267">This unzips all the log files for that role in a single merged folder.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-267">This unzips all the log files for that role in a single merged folder.</span></span>
* <span data-ttu-id="8bbc0-268">A file called **Get-AzureStackLog_Output.log** is also created in the folder that contains the zipped log files.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-268">A file called **Get-AzureStackLog_Output.log** is also created in the folder that contains the zipped log files.</span></span> <span data-ttu-id="8bbc0-269">This file is a log of the command output, which can be used for troubleshooting problems during log collection.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-269">This file is a log of the command output, which can be used for troubleshooting problems during log collection.</span></span> <span data-ttu-id="8bbc0-270">Sometimes the log file includes `PS>TerminatingError` entries which can be safely ignored, unless expected log files are missing after log collection runs.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-270">Sometimes the log file includes `PS>TerminatingError` entries which can be safely ignored, unless expected log files are missing after log collection runs.</span></span>
* <span data-ttu-id="8bbc0-271">To investigate a specific failure, logs may be needed from more than one component.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-271">To investigate a specific failure, logs may be needed from more than one component.</span></span>
    -   <span data-ttu-id="8bbc0-272">System and Event logs for all infrastructure VMs are collected in the *VirtualMachines* role.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-272">System and Event logs for all infrastructure VMs are collected in the *VirtualMachines* role.</span></span>
    -   <span data-ttu-id="8bbc0-273">System and Event logs for all hosts are collected in the *BareMetal* role.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-273">System and Event logs for all hosts are collected in the *BareMetal* role.</span></span>
    -   <span data-ttu-id="8bbc0-274">Failover Cluster and Hyper-V event logs are collected in the *Storage* role.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-274">Failover Cluster and Hyper-V event logs are collected in the *Storage* role.</span></span>
    -   <span data-ttu-id="8bbc0-275">ACS logs are collected in the *Storage* and *ACS* roles.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-275">ACS logs are collected in the *Storage* and *ACS* roles.</span></span>

> [!NOTE]
> <span data-ttu-id="8bbc0-276">Size and age limits are enforced on the logs collected as it is essential to ensure efficient utilization of your storage space to ensure it doesn't get flooded with logs.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-276">Size and age limits are enforced on the logs collected as it is essential to ensure efficient utilization of your storage space to ensure it doesn't get flooded with logs.</span></span> <span data-ttu-id="8bbc0-277">However, when diagnosing a problem you sometimes need logs that might not exist anymore because of these limits.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-277">However, when diagnosing a problem you sometimes need logs that might not exist anymore because of these limits.</span></span> <span data-ttu-id="8bbc0-278">Thus, it is **highly recommended** that you offload your logs to an external storage space (a storage account in Azure, an additional on-prem storage device etc.) every 8 to 12 hours and keep them there for 1 - 3 months, depending on your requirements.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-278">Thus, it is **highly recommended** that you offload your logs to an external storage space (a storage account in Azure, an additional on-prem storage device etc.) every 8 to 12 hours and keep them there for 1 - 3 months, depending on your requirements.</span></span> <span data-ttu-id="8bbc0-279">Also, ensure this storage location is encrypted.</span><span class="sxs-lookup"><span data-stu-id="8bbc0-279">Also, ensure this storage location is encrypted.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8bbc0-280">Next steps</span><span class="sxs-lookup"><span data-stu-id="8bbc0-280">Next steps</span></span>
[<span data-ttu-id="8bbc0-281">Microsoft Azure Stack troubleshooting</span><span class="sxs-lookup"><span data-stu-id="8bbc0-281">Microsoft Azure Stack troubleshooting</span></span>](azure-stack-troubleshooting.md)

