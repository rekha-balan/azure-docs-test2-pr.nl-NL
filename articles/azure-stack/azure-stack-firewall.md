---
title: Azure Stack firewall planning for Azure Stack integrated systems | Microsoft Docs
description: Describes the Azure Stack firewall considerations for multi-node Azure Stack Azure-connected deployments.
services: azure-stack
documentationcenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/23/2018
ms.author: jeffgilb
ms.reviewer: wfayed
ms.openlocfilehash: 9d980c800f930c00b2b0140314f78ff3f043aa58
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44967405"
---
# <a name="azure-stack-firewall-integration"></a><span data-ttu-id="0a4c3-103">Azure Stack firewall integration</span><span class="sxs-lookup"><span data-stu-id="0a4c3-103">Azure Stack firewall integration</span></span>
<span data-ttu-id="0a4c3-104">It is recommended that you use a firewall device to help secure Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-104">It is recommended that you use a firewall device to help secure Azure Stack.</span></span> <span data-ttu-id="0a4c3-105">Although firewalls can help with things like distributed denial-of-service (DDOS) attacks, intrusion detection and content inspection, they can also become a throughput bottleneck for Azure storage services like blobs, tables, and queues.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-105">Although firewalls can help with things like distributed denial-of-service (DDOS) attacks, intrusion detection and content inspection, they can also become a throughput bottleneck for Azure storage services like blobs, tables, and queues.</span></span>

<span data-ttu-id="0a4c3-106">Based on the identity model Azure Active Directory (Azure AD) or Windows Server Active Directory Federation Services (AD FS), you might be required to publish the AD FS endpoint.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-106">Based on the identity model Azure Active Directory (Azure AD) or Windows Server Active Directory Federation Services (AD FS), you might be required to publish the AD FS endpoint.</span></span> <span data-ttu-id="0a4c3-107">If a disconnected deployment mode is used, you must publish the AD FS endpoint.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-107">If a disconnected deployment mode is used, you must publish the AD FS endpoint.</span></span> <span data-ttu-id="0a4c3-108">For more information, see the [datacenter integration identity article](azure-stack-integrate-identity.md).</span><span class="sxs-lookup"><span data-stu-id="0a4c3-108">For more information, see the [datacenter integration identity article](azure-stack-integrate-identity.md).</span></span>

<span data-ttu-id="0a4c3-109">The Azure Resource Manager (administrator), administrator portal, and Key Vault (administrator) endpoints do not necessarily require external publishing.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-109">The Azure Resource Manager (administrator), administrator portal, and Key Vault (administrator) endpoints do not necessarily require external publishing.</span></span> <span data-ttu-id="0a4c3-110">For example, as a service provider, you might want to limit the attack surface and only administer Azure Stack from inside your network, and not from the internet.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-110">For example, as a service provider, you might want to limit the attack surface and only administer Azure Stack from inside your network, and not from the internet.</span></span>

<span data-ttu-id="0a4c3-111">For enterprise organizations, the external network can be the existing corporate network.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-111">For enterprise organizations, the external network can be the existing corporate network.</span></span> <span data-ttu-id="0a4c3-112">In such a scenario, you must publish those endpoints to operate Azure Stack from the corporate network.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-112">In such a scenario, you must publish those endpoints to operate Azure Stack from the corporate network.</span></span>

### <a name="network-address-translation"></a><span data-ttu-id="0a4c3-113">Network Address Translation</span><span class="sxs-lookup"><span data-stu-id="0a4c3-113">Network Address Translation</span></span>
<span data-ttu-id="0a4c3-114">Network Address Translation (NAT) is the recommended method to allow the deployment virtual machine (DVM) to access the external resources and the internet during deployment as well as the Emergency Recovery Console (ERCS) VMs or Privileged End Point (PEP) during registration and troubleshooting.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-114">Network Address Translation (NAT) is the recommended method to allow the deployment virtual machine (DVM) to access the external resources and the internet during deployment as well as the Emergency Recovery Console (ERCS) VMs or Privileged End Point (PEP) during registration and troubleshooting.</span></span>

<span data-ttu-id="0a4c3-115">NAT can also be an alternative to Public IP addresses on the external network or public VIPs.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-115">NAT can also be an alternative to Public IP addresses on the external network or public VIPs.</span></span> <span data-ttu-id="0a4c3-116">However, it is not recommended to do so because it limits the tenant user experience and increases complexity.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-116">However, it is not recommended to do so because it limits the tenant user experience and increases complexity.</span></span> <span data-ttu-id="0a4c3-117">The two options would be a 1:1 NAT which still requires one public IP per user IP on the pool or many:1 NAT which requires a NAT rule per user VIP that contains associations to all ports a user might use.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-117">The two options would be a 1:1 NAT which still requires one public IP per user IP on the pool or many:1 NAT which requires a NAT rule per user VIP that contains associations to all ports a user might use.</span></span>

<span data-ttu-id="0a4c3-118">Some of the downsides of using NAT for Public VIP are:</span><span class="sxs-lookup"><span data-stu-id="0a4c3-118">Some of the downsides of using NAT for Public VIP are:</span></span>
- <span data-ttu-id="0a4c3-119">NAT adds overhead when managing firewall rules because users control their own endpoints and their own publishing rules in the software-defined networking (SDN) stack.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-119">NAT adds overhead when managing firewall rules because users control their own endpoints and their own publishing rules in the software-defined networking (SDN) stack.</span></span> <span data-ttu-id="0a4c3-120">Users must contact the Azure Stack operator to get their VIPs published, and to update the port list.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-120">Users must contact the Azure Stack operator to get their VIPs published, and to update the port list.</span></span>
- <span data-ttu-id="0a4c3-121">While NAT usage limits the user experience, it gives full control to the operator over publishing requests.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-121">While NAT usage limits the user experience, it gives full control to the operator over publishing requests.</span></span>
- <span data-ttu-id="0a4c3-122">For hybrid cloud scenarios with Azure, consider that Azure does not support setting up a VPN tunnel to an endpoint using NAT.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-122">For hybrid cloud scenarios with Azure, consider that Azure does not support setting up a VPN tunnel to an endpoint using NAT.</span></span>

### <a name="ssl-decryption"></a><span data-ttu-id="0a4c3-123">SSL decryption</span><span class="sxs-lookup"><span data-stu-id="0a4c3-123">SSL decryption</span></span>
<span data-ttu-id="0a4c3-124">It is currently recommended to disable SSL decryption on all Azure Stack traffic.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-124">It is currently recommended to disable SSL decryption on all Azure Stack traffic.</span></span> <span data-ttu-id="0a4c3-125">If it is supported in future updates, guidance will be provided about how to enable SSL decryption for Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-125">If it is supported in future updates, guidance will be provided about how to enable SSL decryption for Azure Stack.</span></span>

## <a name="edge-firewall-scenario"></a><span data-ttu-id="0a4c3-126">Edge firewall scenario</span><span class="sxs-lookup"><span data-stu-id="0a4c3-126">Edge firewall scenario</span></span>
<span data-ttu-id="0a4c3-127">In an edge deployment, Azure Stack is deployed directly behind the edge router or the firewall.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-127">In an edge deployment, Azure Stack is deployed directly behind the edge router or the firewall.</span></span> <span data-ttu-id="0a4c3-128">In these scenarios, it is supported for the firewall to be above the border (Scenario 1) where it supports both active-active and active-passive firewall configurations or acting as the border device (Scenario 2) where it only supports active-active firewall configuration relying on Equal Cost Multi Path (ECMP) with either BGP or static routing for failover.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-128">In these scenarios, it is supported for the firewall to be above the border (Scenario 1) where it supports both active-active and active-passive firewall configurations or acting as the border device (Scenario 2) where it only supports active-active firewall configuration relying on Equal Cost Multi Path (ECMP) with either BGP or static routing for failover.</span></span>

<span data-ttu-id="0a4c3-129">Typically, public routable IP addresses are specified for the public VIP pool from the external network at deployment time.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-129">Typically, public routable IP addresses are specified for the public VIP pool from the external network at deployment time.</span></span> <span data-ttu-id="0a4c3-130">In an edge scenario, it is not recommended to use public routable IPs on any other network for security purposes.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-130">In an edge scenario, it is not recommended to use public routable IPs on any other network for security purposes.</span></span> <span data-ttu-id="0a4c3-131">This scenario enables a user to experience the full self-controlled cloud experience as in a public cloud like Azure.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-131">This scenario enables a user to experience the full self-controlled cloud experience as in a public cloud like Azure.</span></span>  

![Azure Stack edge firewall example](.\media\azure-stack-firewall\firewallScenarios.png)

## <a name="enterprise-intranet-or-perimeter-network-firewall-scenario"></a><span data-ttu-id="0a4c3-133">Enterprise intranet or perimeter network firewall scenario</span><span class="sxs-lookup"><span data-stu-id="0a4c3-133">Enterprise intranet or perimeter network firewall scenario</span></span>
<span data-ttu-id="0a4c3-134">In an enterprise intranet or perimeter deployment, Azure Stack is deployed on a multi-zoned firewall or in between the edge firewall and the internal, corporate network firewall.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-134">In an enterprise intranet or perimeter deployment, Azure Stack is deployed on a multi-zoned firewall or in between the edge firewall and the internal, corporate network firewall.</span></span> <span data-ttu-id="0a4c3-135">Its traffic is then distributed between the secure, perimeter network (or DMZ), and unsecure zones as described below:</span><span class="sxs-lookup"><span data-stu-id="0a4c3-135">Its traffic is then distributed between the secure, perimeter network (or DMZ), and unsecure zones as described below:</span></span>

- <span data-ttu-id="0a4c3-136">**Secure zone**: This is the internal network that uses internal or corporate routable IP addresses.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-136">**Secure zone**: This is the internal network that uses internal or corporate routable IP addresses.</span></span> <span data-ttu-id="0a4c3-137">The secure network can be divided, have internet outbound access through NAT on the Firewall, and is usually accessible from anywhere inside your datacenter via the internal network.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-137">The secure network can be divided, have internet outbound access through NAT on the Firewall, and is usually accessible from anywhere inside your datacenter via the internal network.</span></span> <span data-ttu-id="0a4c3-138">All Azure Stack networks should reside in the secure zone except for the external network's public VIP pool.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-138">All Azure Stack networks should reside in the secure zone except for the external network's public VIP pool.</span></span>
- <span data-ttu-id="0a4c3-139">**Perimeter zone**.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-139">**Perimeter zone**.</span></span> <span data-ttu-id="0a4c3-140">The perimeter network is where external or internet facing applications like Web servers are typically deployed.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-140">The perimeter network is where external or internet facing applications like Web servers are typically deployed.</span></span> <span data-ttu-id="0a4c3-141">It is usually monitored by a firewall to avoid attacks like DDoS and intrusion (hacking) while still allowing specified inbound traffic from the internet.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-141">It is usually monitored by a firewall to avoid attacks like DDoS and intrusion (hacking) while still allowing specified inbound traffic from the internet.</span></span> <span data-ttu-id="0a4c3-142">Only the external network public VIP pool of Azure Stack should reside in the DMZ zone.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-142">Only the external network public VIP pool of Azure Stack should reside in the DMZ zone.</span></span>
- <span data-ttu-id="0a4c3-143">**Unsecure zone**.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-143">**Unsecure zone**.</span></span> <span data-ttu-id="0a4c3-144">This is the external network, the internet.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-144">This is the external network, the internet.</span></span> <span data-ttu-id="0a4c3-145">It **is not** recommended to deploy Azure Stack in the unsecure zone.</span><span class="sxs-lookup"><span data-stu-id="0a4c3-145">It **is not** recommended to deploy Azure Stack in the unsecure zone.</span></span>

![Azure Stack perimeter network example](.\media\azure-stack-firewall\perimeter-network-scenario.png)

## <a name="learn-more"></a><span data-ttu-id="0a4c3-147">Learn more</span><span class="sxs-lookup"><span data-stu-id="0a4c3-147">Learn more</span></span>
<span data-ttu-id="0a4c3-148">Learn more about [ports and protocols used by Azure Stack endpoints](azure-stack-integrate-endpoints.md).</span><span class="sxs-lookup"><span data-stu-id="0a4c3-148">Learn more about [ports and protocols used by Azure Stack endpoints](azure-stack-integrate-endpoints.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="0a4c3-149">Next steps</span><span class="sxs-lookup"><span data-stu-id="0a4c3-149">Next steps</span></span>
[<span data-ttu-id="0a4c3-150">Azure Stack PKI requirements</span><span class="sxs-lookup"><span data-stu-id="0a4c3-150">Azure Stack PKI requirements</span></span>](azure-stack-pki-certs.md)

