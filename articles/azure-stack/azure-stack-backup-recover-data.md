---
title: Recover from catastrophic data loss in Azure Stack using the Infrastructure Backup Service | Microsoft Docs
description: When a catastrophic failure causes Azure Stack to fail, your can restore your infrastructure data when reestablishing your Azure Stack deployment.
services: azure-stack
documentationcenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.assetid: 2ECE8580-0BDE-4D4A-9120-1F6771F2E815
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2018
ms.author: jeffgilb
ms.reviewer: hectorl
ms.openlocfilehash: ed89468d65f35d0a8cda90da365e8625f46e3f92
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44967973"
---
# <a name="recover-from-catastrophic-data-loss"></a><span data-ttu-id="7f978-103">Recover from catastrophic data loss</span><span class="sxs-lookup"><span data-stu-id="7f978-103">Recover from catastrophic data loss</span></span>

<span data-ttu-id="7f978-104">*Applies to: Azure Stack integrated systems.*</span><span class="sxs-lookup"><span data-stu-id="7f978-104">*Applies to: Azure Stack integrated systems.*</span></span>

<span data-ttu-id="7f978-105">Azure Stack runs Azure services in your datacenter.</span><span class="sxs-lookup"><span data-stu-id="7f978-105">Azure Stack runs Azure services in your datacenter.</span></span> <span data-ttu-id="7f978-106">Azure Stack can run on environments as small as four nodes installed in a single rack.</span><span class="sxs-lookup"><span data-stu-id="7f978-106">Azure Stack can run on environments as small as four nodes installed in a single rack.</span></span> <span data-ttu-id="7f978-107">In contrast, Azure runs in more than 40 regions in multiple datacenters and multiple zones in each region.</span><span class="sxs-lookup"><span data-stu-id="7f978-107">In contrast, Azure runs in more than 40 regions in multiple datacenters and multiple zones in each region.</span></span> <span data-ttu-id="7f978-108">User resources can span multiple servers, racks, datacenters, and regions.</span><span class="sxs-lookup"><span data-stu-id="7f978-108">User resources can span multiple servers, racks, datacenters, and regions.</span></span> <span data-ttu-id="7f978-109">With Azure Stack, you currently  only have the choice to deploy your entire cloud to a single rack.</span><span class="sxs-lookup"><span data-stu-id="7f978-109">With Azure Stack, you currently  only have the choice to deploy your entire cloud to a single rack.</span></span> <span data-ttu-id="7f978-110">This exposes your cloud to the risk of catastrophic events at your datacenter or failures due to major product bugs.</span><span class="sxs-lookup"><span data-stu-id="7f978-110">This exposes your cloud to the risk of catastrophic events at your datacenter or failures due to major product bugs.</span></span> <span data-ttu-id="7f978-111">When a disaster strikes, the Azure Stack instance goes offline.</span><span class="sxs-lookup"><span data-stu-id="7f978-111">When a disaster strikes, the Azure Stack instance goes offline.</span></span> <span data-ttu-id="7f978-112">All of the data is potentially unrecoverable.</span><span class="sxs-lookup"><span data-stu-id="7f978-112">All of the data is potentially unrecoverable.</span></span>

<span data-ttu-id="7f978-113">Depending on the root cause of the data loss, you may need to repair a single infrastructure service or restore the entire Azure Stack instance.</span><span class="sxs-lookup"><span data-stu-id="7f978-113">Depending on the root cause of the data loss, you may need to repair a single infrastructure service or restore the entire Azure Stack instance.</span></span> <span data-ttu-id="7f978-114">You may even need to restore to different hardware in the same location or in a different location.</span><span class="sxs-lookup"><span data-stu-id="7f978-114">You may even need to restore to different hardware in the same location or in a different location.</span></span>

<span data-ttu-id="7f978-115">This scenario addresses recovering your entire installation in the event of a failure of the equipment and the redeployment of the private cloud.</span><span class="sxs-lookup"><span data-stu-id="7f978-115">This scenario addresses recovering your entire installation in the event of a failure of the equipment and the redeployment of the private cloud.</span></span>

| <span data-ttu-id="7f978-116">Scenario</span><span class="sxs-lookup"><span data-stu-id="7f978-116">Scenario</span></span>                                                           | <span data-ttu-id="7f978-117">Data Loss</span><span class="sxs-lookup"><span data-stu-id="7f978-117">Data Loss</span></span>                            | <span data-ttu-id="7f978-118">Considerations</span><span class="sxs-lookup"><span data-stu-id="7f978-118">Considerations</span></span>                                                             |
|--------------------------------------------------------------------|--------------------------------------|----------------------------------------------------------------------------|
| <span data-ttu-id="7f978-119">Recover from catastrophic data loss due to disaster or product bug</span><span class="sxs-lookup"><span data-stu-id="7f978-119">Recover from catastrophic data loss due to disaster or product bug</span></span> | <span data-ttu-id="7f978-120">All infrastructure and user and app data</span><span class="sxs-lookup"><span data-stu-id="7f978-120">All infrastructure and user and app data</span></span> | <span data-ttu-id="7f978-121">User application and data are protected separately from infrastructure data</span><span class="sxs-lookup"><span data-stu-id="7f978-121">User application and data are protected separately from infrastructure data</span></span> |

## <a name="workflows"></a><span data-ttu-id="7f978-122">Workflows</span><span class="sxs-lookup"><span data-stu-id="7f978-122">Workflows</span></span>

<span data-ttu-id="7f978-123">The journey of protecting Azure Start starts with backing up the infrastructure and app/tenant data separately.</span><span class="sxs-lookup"><span data-stu-id="7f978-123">The journey of protecting Azure Start starts with backing up the infrastructure and app/tenant data separately.</span></span> <span data-ttu-id="7f978-124">This document covers how to protect the infrastructure.</span><span class="sxs-lookup"><span data-stu-id="7f978-124">This document covers how to protect the infrastructure.</span></span> 

![Initial deployment of Azure Stack](media\azure-stack-backup\azure-stack-backup-workflow1.png)

<span data-ttu-id="7f978-126">In worst case scenarios where all data is lost, recovering Azure Stack is the process of restoring the infrastructure data unique to that deployment of Azure Stack and all user data.</span><span class="sxs-lookup"><span data-stu-id="7f978-126">In worst case scenarios where all data is lost, recovering Azure Stack is the process of restoring the infrastructure data unique to that deployment of Azure Stack and all user data.</span></span> 

![Redeploy Azure Stack](media\azure-stack-backup\azure-stack-backup-workflow2.png)

## <a name="restore"></a><span data-ttu-id="7f978-128">Restore</span><span class="sxs-lookup"><span data-stu-id="7f978-128">Restore</span></span>

<span data-ttu-id="7f978-129">If there is catastrophic data loss but the hardware is still usable, redeployment of Azure Stack is required.</span><span class="sxs-lookup"><span data-stu-id="7f978-129">If there is catastrophic data loss but the hardware is still usable, redeployment of Azure Stack is required.</span></span> <span data-ttu-id="7f978-130">During redeployment, you can specify the storage location and credentials required to access backups.</span><span class="sxs-lookup"><span data-stu-id="7f978-130">During redeployment, you can specify the storage location and credentials required to access backups.</span></span> <span data-ttu-id="7f978-131">In this mode, there is no need to specify the services that need to be restored.</span><span class="sxs-lookup"><span data-stu-id="7f978-131">In this mode, there is no need to specify the services that need to be restored.</span></span> <span data-ttu-id="7f978-132">Infrastructure Backup Controller injects control plane state as part of the deployment workflow.</span><span class="sxs-lookup"><span data-stu-id="7f978-132">Infrastructure Backup Controller injects control plane state as part of the deployment workflow.</span></span>

<span data-ttu-id="7f978-133">If there is a disaster that renders the hardware unusable, redeployment is only possible on new hardware.</span><span class="sxs-lookup"><span data-stu-id="7f978-133">If there is a disaster that renders the hardware unusable, redeployment is only possible on new hardware.</span></span> <span data-ttu-id="7f978-134">Redeployment can take several weeks while replacement hardware is ordered and arrives in the datacenter.</span><span class="sxs-lookup"><span data-stu-id="7f978-134">Redeployment can take several weeks while replacement hardware is ordered and arrives in the datacenter.</span></span> <span data-ttu-id="7f978-135">Restore of control plane data is possible at any time.</span><span class="sxs-lookup"><span data-stu-id="7f978-135">Restore of control plane data is possible at any time.</span></span> <span data-ttu-id="7f978-136">However, restore is not supported if the version of the redeployed instance is more than one version greater than the version used in the last backup.</span><span class="sxs-lookup"><span data-stu-id="7f978-136">However, restore is not supported if the version of the redeployed instance is more than one version greater than the version used in the last backup.</span></span> 

| <span data-ttu-id="7f978-137">Deployment mode</span><span class="sxs-lookup"><span data-stu-id="7f978-137">Deployment mode</span></span> | <span data-ttu-id="7f978-138">Starting point</span><span class="sxs-lookup"><span data-stu-id="7f978-138">Starting point</span></span> | <span data-ttu-id="7f978-139">End point</span><span class="sxs-lookup"><span data-stu-id="7f978-139">End point</span></span>                                                                                                                                                                                                     |
|-----------------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="7f978-140">Clean install</span><span class="sxs-lookup"><span data-stu-id="7f978-140">Clean install</span></span>   | <span data-ttu-id="7f978-141">Baseline build</span><span class="sxs-lookup"><span data-stu-id="7f978-141">Baseline build</span></span> | <span data-ttu-id="7f978-142">OEM deploys Azure Stack and updates to the latest supported version.</span><span class="sxs-lookup"><span data-stu-id="7f978-142">OEM deploys Azure Stack and updates to the latest supported version.</span></span>                                                                                                                                          |
| <span data-ttu-id="7f978-143">Recovery mode</span><span class="sxs-lookup"><span data-stu-id="7f978-143">Recovery mode</span></span>   | <span data-ttu-id="7f978-144">Baseline build</span><span class="sxs-lookup"><span data-stu-id="7f978-144">Baseline build</span></span> | <span data-ttu-id="7f978-145">OEM deploys Azure Stack in recovery mode and handles the version matching requirements based on the latest backup available.</span><span class="sxs-lookup"><span data-stu-id="7f978-145">OEM deploys Azure Stack in recovery mode and handles the version matching requirements based on the latest backup available.</span></span> <span data-ttu-id="7f978-146">The OEM completes the deployment by updating to latest supported version.</span><span class="sxs-lookup"><span data-stu-id="7f978-146">The OEM completes the deployment by updating to latest supported version.</span></span> |

## <a name="data-in-backups"></a><span data-ttu-id="7f978-147">Data in backups</span><span class="sxs-lookup"><span data-stu-id="7f978-147">Data in backups</span></span>

<span data-ttu-id="7f978-148">Azure Stack supports a type of deployment called cloud recovery mode.</span><span class="sxs-lookup"><span data-stu-id="7f978-148">Azure Stack supports a type of deployment called cloud recovery mode.</span></span> <span data-ttu-id="7f978-149">This mode is used only if you choose to recover Azure Stack after a disaster or product bug rendered the solution unrecoverable.</span><span class="sxs-lookup"><span data-stu-id="7f978-149">This mode is used only if you choose to recover Azure Stack after a disaster or product bug rendered the solution unrecoverable.</span></span> <span data-ttu-id="7f978-150">This deployment mode does not recover any of the user data stored in the solution.</span><span class="sxs-lookup"><span data-stu-id="7f978-150">This deployment mode does not recover any of the user data stored in the solution.</span></span> <span data-ttu-id="7f978-151">The scope of this deployment mode is limited to restoring the following data:</span><span class="sxs-lookup"><span data-stu-id="7f978-151">The scope of this deployment mode is limited to restoring the following data:</span></span>

 - <span data-ttu-id="7f978-152">Deployment inputs</span><span class="sxs-lookup"><span data-stu-id="7f978-152">Deployment inputs</span></span>
 - <span data-ttu-id="7f978-153">Internal identity systems</span><span class="sxs-lookup"><span data-stu-id="7f978-153">Internal identity systems</span></span>
 - <span data-ttu-id="7f978-154">Federated identify configuration (disconnected deployments)</span><span class="sxs-lookup"><span data-stu-id="7f978-154">Federated identify configuration (disconnected deployments)</span></span>
 - <span data-ttu-id="7f978-155">Root certificates used by internal certificate authority</span><span class="sxs-lookup"><span data-stu-id="7f978-155">Root certificates used by internal certificate authority</span></span>
 - <span data-ttu-id="7f978-156">Azure Resource Manager configuration user data, such as subscriptions, plans, offers, and quotas for storage, network, and compute resources</span><span class="sxs-lookup"><span data-stu-id="7f978-156">Azure Resource Manager configuration user data, such as subscriptions, plans, offers, and quotas for storage, network, and compute resources</span></span>
 - <span data-ttu-id="7f978-157">KeyVault secrets and vaults</span><span class="sxs-lookup"><span data-stu-id="7f978-157">KeyVault secrets and vaults</span></span>
 - <span data-ttu-id="7f978-158">RBAC policy assignments and role assignments</span><span class="sxs-lookup"><span data-stu-id="7f978-158">RBAC policy assignments and role assignments</span></span> 

<span data-ttu-id="7f978-159">None of the user Infrastructure as a Service (IaaS) or Platform as a Service (PaaS) resources are recovered during deployment.</span><span class="sxs-lookup"><span data-stu-id="7f978-159">None of the user Infrastructure as a Service (IaaS) or Platform as a Service (PaaS) resources are recovered during deployment.</span></span> <span data-ttu-id="7f978-160">That is IaaS VMs, storage accounts, blobs, tables, network configuration, and so on, are lost.</span><span class="sxs-lookup"><span data-stu-id="7f978-160">That is IaaS VMs, storage accounts, blobs, tables, network configuration, and so on, are lost.</span></span> <span data-ttu-id="7f978-161">The purpose of cloud recovery is to ensure your operators and users can log back into the portal after deployment is complete.</span><span class="sxs-lookup"><span data-stu-id="7f978-161">The purpose of cloud recovery is to ensure your operators and users can log back into the portal after deployment is complete.</span></span> <span data-ttu-id="7f978-162">Users logging back in will not see any of their resources.</span><span class="sxs-lookup"><span data-stu-id="7f978-162">Users logging back in will not see any of their resources.</span></span> <span data-ttu-id="7f978-163">Users have their subscriptions restored and along with that the original plans and offers policies defined by the administrator.</span><span class="sxs-lookup"><span data-stu-id="7f978-163">Users have their subscriptions restored and along with that the original plans and offers policies defined by the administrator.</span></span> <span data-ttu-id="7f978-164">Users logging back into the system operates under the same constraints imposed by the original solution before the disaster.</span><span class="sxs-lookup"><span data-stu-id="7f978-164">Users logging back into the system operates under the same constraints imposed by the original solution before the disaster.</span></span> <span data-ttu-id="7f978-165">After cloud recovery completes, the operator can manually restore value-add and third-party RPs and associated data.</span><span class="sxs-lookup"><span data-stu-id="7f978-165">After cloud recovery completes, the operator can manually restore value-add and third-party RPs and associated data.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7f978-166">Next steps</span><span class="sxs-lookup"><span data-stu-id="7f978-166">Next steps</span></span>

 - <span data-ttu-id="7f978-167">Learn about the best practices for [using the Infrastructure Backup Service](azure-stack-backup-best-practices.md).</span><span class="sxs-lookup"><span data-stu-id="7f978-167">Learn about the best practices for [using the Infrastructure Backup Service](azure-stack-backup-best-practices.md).</span></span>
