---
title: Remediate certificate issues for Azure Stack | Microsoft Docs
description: Use the Azure Stack Readiness Checker to review and remediate certificate issues.
services: azure-stack
documentationcenter: ''
author: brenduns
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 05/08/2018
ms.author: brenduns
ms.reviewer: ''
ms.openlocfilehash: 6bc7839e7db0022beaa9b31c390655f31d1d52c0
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44870202"
---
# <a name="remediate-common-issues-for-azure-stack-pki-certificates"></a><span data-ttu-id="3e0d8-103">Remediate common issues for Azure Stack PKI certificates</span><span class="sxs-lookup"><span data-stu-id="3e0d8-103">Remediate common issues for Azure Stack PKI certificates</span></span>
<span data-ttu-id="3e0d8-104">The information in this article can help you understand and resolve common issues for Azure Stack PKI certificates.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-104">The information in this article can help you understand and resolve common issues for Azure Stack PKI certificates.</span></span> <span data-ttu-id="3e0d8-105">You can discover issues when you use Azure Stack Readiness Checker tool to [validate Azure Stack PKI certificates](azure-stack-validate-pki-certs.md).</span><span class="sxs-lookup"><span data-stu-id="3e0d8-105">You can discover issues when you use Azure Stack Readiness Checker tool to [validate Azure Stack PKI certificates](azure-stack-validate-pki-certs.md).</span></span> <span data-ttu-id="3e0d8-106">The tool checks to ensure that certificates meet the PKI requirements of an Azure Stack deployment and Azure Stack Secret Rotation, and logs the results in a [report.json file](azure-stack-validation-report.md).</span><span class="sxs-lookup"><span data-stu-id="3e0d8-106">The tool checks to ensure that certificates meet the PKI requirements of an Azure Stack deployment and Azure Stack Secret Rotation, and logs the results in a [report.json file](azure-stack-validation-report.md).</span></span>  

## <a name="pfx-encryption"></a><span data-ttu-id="3e0d8-107">PFX Encryption</span><span class="sxs-lookup"><span data-stu-id="3e0d8-107">PFX Encryption</span></span>
<span data-ttu-id="3e0d8-108">**Failure** - PFX encryption is not TripleDES-SHA1.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-108">**Failure** - PFX encryption is not TripleDES-SHA1.</span></span>   
<span data-ttu-id="3e0d8-109">**Remediation** - Export PFX files with **TripleDES-SHA1** encryption.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-109">**Remediation** - Export PFX files with **TripleDES-SHA1** encryption.</span></span> <span data-ttu-id="3e0d8-110">This is the default for all Windows 10 Clients when exporting from Certificate Snap in or using Export-PFXCertificate.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-110">This is the default for all Windows 10 Clients when exporting from Certificate Snap in or using Export-PFXCertificate.</span></span> 

## <a name="read-pfx"></a><span data-ttu-id="3e0d8-111">Read PFX</span><span class="sxs-lookup"><span data-stu-id="3e0d8-111">Read PFX</span></span>
<span data-ttu-id="3e0d8-112">**Warning** - Password only protects the private information in the certificate.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-112">**Warning** - Password only protects the private information in the certificate.</span></span>  
<span data-ttu-id="3e0d8-113">**Remediation** - We recommend you export PFX files with the optional setting for **Enable certificate privacy**.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-113">**Remediation** - We recommend you export PFX files with the optional setting for **Enable certificate privacy**.</span></span>  

<span data-ttu-id="3e0d8-114">**Failure** - PFX file invalid.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-114">**Failure** - PFX file invalid.</span></span>  
<span data-ttu-id="3e0d8-115">**Remediation** - Re-export the certificate using the steps in [Prepare Azure Stack PKI certificates for deployment](azure-stack-prepare-pki-certs.md).</span><span class="sxs-lookup"><span data-stu-id="3e0d8-115">**Remediation** - Re-export the certificate using the steps in [Prepare Azure Stack PKI certificates for deployment](azure-stack-prepare-pki-certs.md).</span></span>

## <a name="signature-algorithm"></a><span data-ttu-id="3e0d8-116">Signature Algorithm</span><span class="sxs-lookup"><span data-stu-id="3e0d8-116">Signature Algorithm</span></span>
<span data-ttu-id="3e0d8-117">**Failure** - Signature Algorithm is SHA1.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-117">**Failure** - Signature Algorithm is SHA1.</span></span>    
<span data-ttu-id="3e0d8-118">**Remediation** - Use the steps in Azure Stack certificates signing request generation to regenerate the Certificate Signing Request (CSR) with the Signature Algorithm of SHA256.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-118">**Remediation** - Use the steps in Azure Stack certificates signing request generation to regenerate the Certificate Signing Request (CSR) with the Signature Algorithm of SHA256.</span></span> <span data-ttu-id="3e0d8-119">Then resubmit the CSR to the Certificate Authority to reissue the certificate.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-119">Then resubmit the CSR to the Certificate Authority to reissue the certificate.</span></span>

## <a name="private-key"></a><span data-ttu-id="3e0d8-120">Private key</span><span class="sxs-lookup"><span data-stu-id="3e0d8-120">Private key</span></span>
<span data-ttu-id="3e0d8-121">**Failure** - The private key is missing or does not contain the Local Machine Attribute.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-121">**Failure** - The private key is missing or does not contain the Local Machine Attribute.</span></span>  
<span data-ttu-id="3e0d8-122">**Remediation** - From the computer that generated the CSR, re-export the certificate using the steps in Prepare Azure Stack PKI certificates for deployment.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-122">**Remediation** - From the computer that generated the CSR, re-export the certificate using the steps in Prepare Azure Stack PKI certificates for deployment.</span></span> <span data-ttu-id="3e0d8-123">These steps include exporting from the Local Machine certificate store.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-123">These steps include exporting from the Local Machine certificate store.</span></span>

## <a name="certificate-chain"></a><span data-ttu-id="3e0d8-124">Certificate chain</span><span class="sxs-lookup"><span data-stu-id="3e0d8-124">Certificate chain</span></span>
<span data-ttu-id="3e0d8-125">**Failure** - Certificate chain is not complete.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-125">**Failure** - Certificate chain is not complete.</span></span>  
<span data-ttu-id="3e0d8-126">**Remediation** - Certificates should contain a complete certificate chain.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-126">**Remediation** - Certificates should contain a complete certificate chain.</span></span>  <span data-ttu-id="3e0d8-127">Re-export the certificate using the steps in  [Prepare Azure Stack PKI certificates for deployment](azure-stack-prepare-pki-certs.md) and select the option **Include all certificates in the certification path if possible.**</span><span class="sxs-lookup"><span data-stu-id="3e0d8-127">Re-export the certificate using the steps in  [Prepare Azure Stack PKI certificates for deployment](azure-stack-prepare-pki-certs.md) and select the option **Include all certificates in the certification path if possible.**</span></span>

## <a name="dns-names"></a><span data-ttu-id="3e0d8-128">DNS Names</span><span class="sxs-lookup"><span data-stu-id="3e0d8-128">DNS Names</span></span>
<span data-ttu-id="3e0d8-129">**Failure** - DNSNameList on the certificate does not contain the Azure Stack service endpoint name, or a valid wildcard match.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-129">**Failure** - DNSNameList on the certificate does not contain the Azure Stack service endpoint name, or a valid wildcard match.</span></span>  <span data-ttu-id="3e0d8-130">Wildcard matches are only valid for the left-most namespace of the DNS name.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-130">Wildcard matches are only valid for the left-most namespace of the DNS name.</span></span> <span data-ttu-id="3e0d8-131">For example, _\*.region.domain.com_ is only valid for *portal.region.domain.com*, not _\*.table.region.domain.com_.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-131">For example, _\*.region.domain.com_ is only valid for *portal.region.domain.com*, not _\*.table.region.domain.com_.</span></span>  
<span data-ttu-id="3e0d8-132">**Remediation** - Use the steps in Azure Stack certificates signing request generation to regenerate the CSR with the correct DNS names to support Azure Stack endpoints.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-132">**Remediation** - Use the steps in Azure Stack certificates signing request generation to regenerate the CSR with the correct DNS names to support Azure Stack endpoints.</span></span> <span data-ttu-id="3e0d8-133">Resubmit the CSR to a Certificate Authority, and then follow the steps in [Prepare Azure Stack PKI certificates for deployment](azure-stack-prepare-pki-certs.md) to export the certificate from the machine that generated the CSR.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-133">Resubmit the CSR to a Certificate Authority, and then follow the steps in [Prepare Azure Stack PKI certificates for deployment](azure-stack-prepare-pki-certs.md) to export the certificate from the machine that generated the CSR.</span></span>  

## <a name="key-usage"></a><span data-ttu-id="3e0d8-134">Key Usage</span><span class="sxs-lookup"><span data-stu-id="3e0d8-134">Key Usage</span></span>
<span data-ttu-id="3e0d8-135">**Failure** - Key Usage is missing Digital Signature or Key Encipherment, orEnhanced Key Usage is missing Server Authentication or Client Authentication.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-135">**Failure** - Key Usage is missing Digital Signature or Key Encipherment, orEnhanced Key Usage is missing Server Authentication or Client Authentication.</span></span>  
<span data-ttu-id="3e0d8-136">**Remediation** - Use the steps in [Azure Stack certificates signing request generation](azure-stack-get-pki-certs.md) to regenerate the CSR with the correct Key Usage attributes.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-136">**Remediation** - Use the steps in [Azure Stack certificates signing request generation](azure-stack-get-pki-certs.md) to regenerate the CSR with the correct Key Usage attributes.</span></span>  <span data-ttu-id="3e0d8-137">Resubmit the CSR to the Certificate Authority and confirm that a certificate template is not overwriting the Key Usage in the request.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-137">Resubmit the CSR to the Certificate Authority and confirm that a certificate template is not overwriting the Key Usage in the request.</span></span>

## <a name="key-size"></a><span data-ttu-id="3e0d8-138">Key Size</span><span class="sxs-lookup"><span data-stu-id="3e0d8-138">Key Size</span></span>
<span data-ttu-id="3e0d8-139">**Failure** - Key Size is smaller than 2048</span><span class="sxs-lookup"><span data-stu-id="3e0d8-139">**Failure** - Key Size is smaller than 2048</span></span>    
<span data-ttu-id="3e0d8-140">**Remediation** - Use the steps in [Azure Stack certificates signing request generation](azure-stack-get-pki-certs.md) to regenerate the CSR  with the correct Key Length (2048), and then resubmit the CSR to the Certificate Authority.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-140">**Remediation** - Use the steps in [Azure Stack certificates signing request generation](azure-stack-get-pki-certs.md) to regenerate the CSR  with the correct Key Length (2048), and then resubmit the CSR to the Certificate Authority.</span></span>

## <a name="chain-order"></a><span data-ttu-id="3e0d8-141">Chain order</span><span class="sxs-lookup"><span data-stu-id="3e0d8-141">Chain order</span></span>
<span data-ttu-id="3e0d8-142">**Failure** - The order of the certificate chain is incorrect.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-142">**Failure** - The order of the certificate chain is incorrect.</span></span>  
<span data-ttu-id="3e0d8-143">**Remediation** - Re-export the certificate using the steps in  [Prepare Azure Stack PKI certificates for deployment](azure-stack-prepare-pki-certs.md) and select the option **Include all certificates in the certification path if possible.**</span><span class="sxs-lookup"><span data-stu-id="3e0d8-143">**Remediation** - Re-export the certificate using the steps in  [Prepare Azure Stack PKI certificates for deployment](azure-stack-prepare-pki-certs.md) and select the option **Include all certificates in the certification path if possible.**</span></span> <span data-ttu-id="3e0d8-144">Ensure that only the leaf certificate is selected for export.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-144">Ensure that only the leaf certificate is selected for export.</span></span> 

## <a name="other-certificates"></a><span data-ttu-id="3e0d8-145">Other certificates</span><span class="sxs-lookup"><span data-stu-id="3e0d8-145">Other certificates</span></span>
<span data-ttu-id="3e0d8-146">**Failure** - The PFX package contains certificates that are not the leaf certificate or part of the certificate chain.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-146">**Failure** - The PFX package contains certificates that are not the leaf certificate or part of the certificate chain.</span></span>  
<span data-ttu-id="3e0d8-147">**Remediation** - Re-export the certificate using the steps in [Prepare Azure Stack PKI certificates for deployment](azure-stack-prepare-pki-certs.md), and  select the option **Include all certificates in the certification path if possible.**</span><span class="sxs-lookup"><span data-stu-id="3e0d8-147">**Remediation** - Re-export the certificate using the steps in [Prepare Azure Stack PKI certificates for deployment](azure-stack-prepare-pki-certs.md), and  select the option **Include all certificates in the certification path if possible.**</span></span> <span data-ttu-id="3e0d8-148">Ensure that only the leaf certificate is selected for export.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-148">Ensure that only the leaf certificate is selected for export.</span></span>

## <a name="fix-common-packaging-issues"></a><span data-ttu-id="3e0d8-149">Fix common packaging issues</span><span class="sxs-lookup"><span data-stu-id="3e0d8-149">Fix common packaging issues</span></span>
<span data-ttu-id="3e0d8-150">The AzsReadinessChecker can import and then export a PFX file to fix common packaging issues, including:</span><span class="sxs-lookup"><span data-stu-id="3e0d8-150">The AzsReadinessChecker can import and then export a PFX file to fix common packaging issues, including:</span></span> 
 - <span data-ttu-id="3e0d8-151">*PFX Encryption* is not TripleDES-SHA1</span><span class="sxs-lookup"><span data-stu-id="3e0d8-151">*PFX Encryption* is not TripleDES-SHA1</span></span>
 - <span data-ttu-id="3e0d8-152">*Private Key* is missing Local Machine Attribute.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-152">*Private Key* is missing Local Machine Attribute.</span></span>
 - <span data-ttu-id="3e0d8-153">*Certificate chain* is incomplete or wrong.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-153">*Certificate chain* is incomplete or wrong.</span></span> <span data-ttu-id="3e0d8-154">(The local machine must contain the certificate chain if the PFX package does not.)</span><span class="sxs-lookup"><span data-stu-id="3e0d8-154">(The local machine must contain the certificate chain if the PFX package does not.)</span></span> 
 - <span data-ttu-id="3e0d8-155">*Other certificates*.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-155">*Other certificates*.</span></span>
<span data-ttu-id="3e0d8-156">However, the AzsReadinessChecker cannot help if you need to generate a new CSR and reissue a certificate.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-156">However, the AzsReadinessChecker cannot help if you need to generate a new CSR and reissue a certificate.</span></span> 

### <a name="prerequisites"></a><span data-ttu-id="3e0d8-157">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="3e0d8-157">Prerequisites</span></span>
<span data-ttu-id="3e0d8-158">The following prerequisites must be in place on the computer where the tool runs:</span><span class="sxs-lookup"><span data-stu-id="3e0d8-158">The following prerequisites must be in place on the computer where the tool runs:</span></span> 
 - <span data-ttu-id="3e0d8-159">Windows 10 or Windows Server 2016, with internet connectivity.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-159">Windows 10 or Windows Server 2016, with internet connectivity.</span></span>
 - <span data-ttu-id="3e0d8-160">PowerShell 5.1 or later.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-160">PowerShell 5.1 or later.</span></span> <span data-ttu-id="3e0d8-161">To check your version, run the following PowerShell cmd and then review the *Major* version and *Minor* versions.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-161">To check your version, run the following PowerShell cmd and then review the *Major* version and *Minor* versions.</span></span>

   > `$PSVersionTable.PSVersion`
 - <span data-ttu-id="3e0d8-162">Configure [PowerShell for Azure Stack](azure-stack-powershell-install.md).</span><span class="sxs-lookup"><span data-stu-id="3e0d8-162">Configure [PowerShell for Azure Stack](azure-stack-powershell-install.md).</span></span> 
 - <span data-ttu-id="3e0d8-163">Download the latest version of [Microsoft Azure Stack Readiness Checker](https://aka.ms/AzsReadinessChecker) tool.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-163">Download the latest version of [Microsoft Azure Stack Readiness Checker](https://aka.ms/AzsReadinessChecker) tool.</span></span>

### <a name="import-and-export-an-existing-pfx-file"></a><span data-ttu-id="3e0d8-164">Import and export an existing PFX File</span><span class="sxs-lookup"><span data-stu-id="3e0d8-164">Import and export an existing PFX File</span></span>
1. <span data-ttu-id="3e0d8-165">On a computer that meets the prerequisites, open an administrative PowerShell prompt and then run the following command to install the AzsReadinessChecker</span><span class="sxs-lookup"><span data-stu-id="3e0d8-165">On a computer that meets the prerequisites, open an administrative PowerShell prompt and then run the following command to install the AzsReadinessChecker</span></span>  
   > `Install-Module Microsoft.AzureStack.ReadinessChecker- Force`

2. <span data-ttu-id="3e0d8-166">From the PowerShell prompt, run the following to set the PFX password.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-166">From the PowerShell prompt, run the following to set the PFX password.</span></span> <span data-ttu-id="3e0d8-167">Replace *PFXpassword* with the actual password.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-167">Replace *PFXpassword* with the actual password.</span></span> 
   > `$password = Read-Host -Prompt PFXpassword -AsSecureString`

3. <span data-ttu-id="3e0d8-168">From the PowerShell prompt, run the following to export a new PFX file.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-168">From the PowerShell prompt, run the following to export a new PFX file.</span></span>
   - <span data-ttu-id="3e0d8-169">For *-PfxPath*, specify the path to the PFX file you are working with.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-169">For *-PfxPath*, specify the path to the PFX file you are working with.</span></span>  <span data-ttu-id="3e0d8-170">In the following example, the path is *.\certificates\ssl.pfx*.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-170">In the following example, the path is *.\certificates\ssl.pfx*.</span></span>
   - <span data-ttu-id="3e0d8-171">For *-ExportPFXPath*, specify the location and name of the PFX file for export.</span><span class="sxs-lookup"><span data-stu-id="3e0d8-171">For *-ExportPFXPath*, specify the location and name of the PFX file for export.</span></span>  <span data-ttu-id="3e0d8-172">In the following example, the path is *.\certificates\ssl_new.pfx*</span><span class="sxs-lookup"><span data-stu-id="3e0d8-172">In the following example, the path is *.\certificates\ssl_new.pfx*</span></span>

   > `Start-AzsReadinessChecker -PfxPassword $password -PfxPath .\certificates\ssl.pfx -ExportPFXPath .\certificates\ssl_new.pfx`  

4. <span data-ttu-id="3e0d8-173">After the tool completes, review the output for success: ![results](./media/azure-stack-remediate-certs/remediate-results.png)</span><span class="sxs-lookup"><span data-stu-id="3e0d8-173">After the tool completes, review the output for success: ![results](./media/azure-stack-remediate-certs/remediate-results.png)</span></span>

## <a name="next-steps"></a><span data-ttu-id="3e0d8-174">Next steps</span><span class="sxs-lookup"><span data-stu-id="3e0d8-174">Next steps</span></span>
[<span data-ttu-id="3e0d8-175">Learn more about Azure Stack security</span><span class="sxs-lookup"><span data-stu-id="3e0d8-175">Learn more about Azure Stack security</span></span>](azure-stack-rotate-secrets.md)
