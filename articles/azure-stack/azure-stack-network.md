---
title: Network integration considerations for Azure Stack integrated systems | Microsoft Docs
description: Learn what you can do to plan for datacenter network integration with multi-node Azure Stack.
services: azure-stack
documentationcenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/30/2018
ms.author: jeffgilb
ms.reviewer: wamota
ms.openlocfilehash: 9b1eb6878dcafba68c230255f3b3f43e005421ab
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44969143"
---
# <a name="network-connectivity"></a><span data-ttu-id="efc2b-103">Network connectivity</span><span class="sxs-lookup"><span data-stu-id="efc2b-103">Network connectivity</span></span>
<span data-ttu-id="efc2b-104">This article provides Azure Stack network infrastructure information to help you decide how to best integrate Azure Stack into your existing networking environment.</span><span class="sxs-lookup"><span data-stu-id="efc2b-104">This article provides Azure Stack network infrastructure information to help you decide how to best integrate Azure Stack into your existing networking environment.</span></span> 

> [!NOTE]
> <span data-ttu-id="efc2b-105">To resolve external DNS names from Azure Stack (for example, www.bing.com), you need to provide DNS servers to forward DNS requests.</span><span class="sxs-lookup"><span data-stu-id="efc2b-105">To resolve external DNS names from Azure Stack (for example, www.bing.com), you need to provide DNS servers to forward DNS requests.</span></span> <span data-ttu-id="efc2b-106">For more information about Azure Stack DNS requirements, see [Azure Stack datacenter integration - DNS](azure-stack-integrate-dns.md).</span><span class="sxs-lookup"><span data-stu-id="efc2b-106">For more information about Azure Stack DNS requirements, see [Azure Stack datacenter integration - DNS](azure-stack-integrate-dns.md).</span></span>

## <a name="physical-network-design"></a><span data-ttu-id="efc2b-107">Physical network design</span><span class="sxs-lookup"><span data-stu-id="efc2b-107">Physical network design</span></span>
<span data-ttu-id="efc2b-108">The Azure Stack solution requires a resilient and highly available physical infrastructure to support its operation and services.</span><span class="sxs-lookup"><span data-stu-id="efc2b-108">The Azure Stack solution requires a resilient and highly available physical infrastructure to support its operation and services.</span></span> <span data-ttu-id="efc2b-109">Uplinks from ToR to Border switches are limited to SFP+ or SFP28 media and 1 GB, 10 GB, or 25 GB speeds.</span><span class="sxs-lookup"><span data-stu-id="efc2b-109">Uplinks from ToR to Border switches are limited to SFP+ or SFP28 media and 1 GB, 10 GB, or 25 GB speeds.</span></span> <span data-ttu-id="efc2b-110">Check with your original equipment manufacturer (OEM) hardware vendor for availability.</span><span class="sxs-lookup"><span data-stu-id="efc2b-110">Check with your original equipment manufacturer (OEM) hardware vendor for availability.</span></span> <span data-ttu-id="efc2b-111">The following diagram presents our recommended design:</span><span class="sxs-lookup"><span data-stu-id="efc2b-111">The following diagram presents our recommended design:</span></span>

![Recommended Azure Stack network design](media/azure-stack-network/recommended-design.png)


## <a name="logical-networks"></a><span data-ttu-id="efc2b-113">Logical Networks</span><span class="sxs-lookup"><span data-stu-id="efc2b-113">Logical Networks</span></span>
<span data-ttu-id="efc2b-114">Logical networks represent an abstraction of the underlying physical network infrastructure.</span><span class="sxs-lookup"><span data-stu-id="efc2b-114">Logical networks represent an abstraction of the underlying physical network infrastructure.</span></span> <span data-ttu-id="efc2b-115">They are used to organize and simplify network assignments for hosts, virtual machines, and services.</span><span class="sxs-lookup"><span data-stu-id="efc2b-115">They are used to organize and simplify network assignments for hosts, virtual machines, and services.</span></span> <span data-ttu-id="efc2b-116">As part of logical network creation, network sites are created to define the virtual local area networks (VLANs), IP subnets, and IP subnet/VLAN pairs that are associated with the logical network in each physical location.</span><span class="sxs-lookup"><span data-stu-id="efc2b-116">As part of logical network creation, network sites are created to define the virtual local area networks (VLANs), IP subnets, and IP subnet/VLAN pairs that are associated with the logical network in each physical location.</span></span>

<span data-ttu-id="efc2b-117">The following table shows the logical networks and associated IPv4 subnet ranges that you must plan for:</span><span class="sxs-lookup"><span data-stu-id="efc2b-117">The following table shows the logical networks and associated IPv4 subnet ranges that you must plan for:</span></span>

| <span data-ttu-id="efc2b-118">Logical Network</span><span class="sxs-lookup"><span data-stu-id="efc2b-118">Logical Network</span></span> | <span data-ttu-id="efc2b-119">Description</span><span class="sxs-lookup"><span data-stu-id="efc2b-119">Description</span></span> | <span data-ttu-id="efc2b-120">Size</span><span class="sxs-lookup"><span data-stu-id="efc2b-120">Size</span></span> | 
| -------- | ------------- | ------------ | 
| <span data-ttu-id="efc2b-121">Public VIP</span><span class="sxs-lookup"><span data-stu-id="efc2b-121">Public VIP</span></span> | <span data-ttu-id="efc2b-122">Azure Stack uses a total of 31 addresses from this network.</span><span class="sxs-lookup"><span data-stu-id="efc2b-122">Azure Stack uses a total of 31 addresses from this network.</span></span> <span data-ttu-id="efc2b-123">Eight public IP addresses are used for a small set of Azure Stack services, and the rest are used by tenant virtual machines.</span><span class="sxs-lookup"><span data-stu-id="efc2b-123">Eight public IP addresses are used for a small set of Azure Stack services, and the rest are used by tenant virtual machines.</span></span> <span data-ttu-id="efc2b-124">If you plan to use App Service and the SQL resource providers, 7 more addresses are used.</span><span class="sxs-lookup"><span data-stu-id="efc2b-124">If you plan to use App Service and the SQL resource providers, 7 more addresses are used.</span></span> <span data-ttu-id="efc2b-125">The remaining 15 IPs are reserved for future Azure services.</span><span class="sxs-lookup"><span data-stu-id="efc2b-125">The remaining 15 IPs are reserved for future Azure services.</span></span> | <span data-ttu-id="efc2b-126">/26 (62 hosts) - /22 (1022 hosts)</span><span class="sxs-lookup"><span data-stu-id="efc2b-126">/26 (62 hosts) - /22 (1022 hosts)</span></span><br><br><span data-ttu-id="efc2b-127">Recommended = /24 (254 hosts)</span><span class="sxs-lookup"><span data-stu-id="efc2b-127">Recommended = /24 (254 hosts)</span></span> | 
| <span data-ttu-id="efc2b-128">Switch infrastructure</span><span class="sxs-lookup"><span data-stu-id="efc2b-128">Switch infrastructure</span></span> | <span data-ttu-id="efc2b-129">Point-to-point IP addresses for routing purposes, dedicated switch management interfaces, and loopback addresses assigned to the switch.</span><span class="sxs-lookup"><span data-stu-id="efc2b-129">Point-to-point IP addresses for routing purposes, dedicated switch management interfaces, and loopback addresses assigned to the switch.</span></span> | <span data-ttu-id="efc2b-130">/26</span><span class="sxs-lookup"><span data-stu-id="efc2b-130">/26</span></span> | 
| <span data-ttu-id="efc2b-131">Infrastructure</span><span class="sxs-lookup"><span data-stu-id="efc2b-131">Infrastructure</span></span> | <span data-ttu-id="efc2b-132">Used for Azure Stack internal components to communicate.</span><span class="sxs-lookup"><span data-stu-id="efc2b-132">Used for Azure Stack internal components to communicate.</span></span> | <span data-ttu-id="efc2b-133">/24</span><span class="sxs-lookup"><span data-stu-id="efc2b-133">/24</span></span> |
| <span data-ttu-id="efc2b-134">Private</span><span class="sxs-lookup"><span data-stu-id="efc2b-134">Private</span></span> | <span data-ttu-id="efc2b-135">Used for the storage network and private VIPs.</span><span class="sxs-lookup"><span data-stu-id="efc2b-135">Used for the storage network and private VIPs.</span></span> | <span data-ttu-id="efc2b-136">/24</span><span class="sxs-lookup"><span data-stu-id="efc2b-136">/24</span></span> | 
| <span data-ttu-id="efc2b-137">BMC</span><span class="sxs-lookup"><span data-stu-id="efc2b-137">BMC</span></span> | <span data-ttu-id="efc2b-138">Used to communicate with the BMCs on the physical hosts.</span><span class="sxs-lookup"><span data-stu-id="efc2b-138">Used to communicate with the BMCs on the physical hosts.</span></span> | <span data-ttu-id="efc2b-139">/26</span><span class="sxs-lookup"><span data-stu-id="efc2b-139">/26</span></span> | 
| | | |

## <a name="network-infrastructure"></a><span data-ttu-id="efc2b-140">Network infrastructure</span><span class="sxs-lookup"><span data-stu-id="efc2b-140">Network infrastructure</span></span>
<span data-ttu-id="efc2b-141">The network infrastructure for Azure Stack consists of several logical networks that are configured on the switches.</span><span class="sxs-lookup"><span data-stu-id="efc2b-141">The network infrastructure for Azure Stack consists of several logical networks that are configured on the switches.</span></span> <span data-ttu-id="efc2b-142">The following diagram shows these logical networks, and how they integrate with the top-of-rack (TOR), baseboard management controller (BMC), and border (customer network) switches.</span><span class="sxs-lookup"><span data-stu-id="efc2b-142">The following diagram shows these logical networks, and how they integrate with the top-of-rack (TOR), baseboard management controller (BMC), and border (customer network) switches.</span></span>

![Logical network diagram and switch connections](media/azure-stack-network/NetworkDiagram.png)

### <a name="bmc-network"></a><span data-ttu-id="efc2b-144">BMC network</span><span class="sxs-lookup"><span data-stu-id="efc2b-144">BMC network</span></span>
<span data-ttu-id="efc2b-145">This network is dedicated to connecting all the baseboard management controllers (also known as service processors, for example, iDRAC, iLO, iBMC, etc.) to the management network.</span><span class="sxs-lookup"><span data-stu-id="efc2b-145">This network is dedicated to connecting all the baseboard management controllers (also known as service processors, for example, iDRAC, iLO, iBMC, etc.) to the management network.</span></span> <span data-ttu-id="efc2b-146">If present, the Hardware Lifecycle Host (HLH) is located on this network and may provide OEM-specific software for hardware maintenance or monitoring.</span><span class="sxs-lookup"><span data-stu-id="efc2b-146">If present, the Hardware Lifecycle Host (HLH) is located on this network and may provide OEM-specific software for hardware maintenance or monitoring.</span></span> 

<span data-ttu-id="efc2b-147">The HLH also hosts the Deployment VM (DVM).</span><span class="sxs-lookup"><span data-stu-id="efc2b-147">The HLH also hosts the Deployment VM (DVM).</span></span> <span data-ttu-id="efc2b-148">The DVM is used during Azure Stack deployment and is removed when deployment completes.</span><span class="sxs-lookup"><span data-stu-id="efc2b-148">The DVM is used during Azure Stack deployment and is removed when deployment completes.</span></span> <span data-ttu-id="efc2b-149">The DVM requires internet access in connected deployment scenarios to test, validate, and access multiple components.</span><span class="sxs-lookup"><span data-stu-id="efc2b-149">The DVM requires internet access in connected deployment scenarios to test, validate, and access multiple components.</span></span> <span data-ttu-id="efc2b-150">These components can be inside and outside of your corporate network; for example, NTP, DNS, and Azure.</span><span class="sxs-lookup"><span data-stu-id="efc2b-150">These components can be inside and outside of your corporate network; for example, NTP, DNS, and Azure.</span></span> <span data-ttu-id="efc2b-151">For more information about connectivity requirements, see the [NAT section in Azure Stack firewall integration](azure-stack-firewall.md#network-address-translation).</span><span class="sxs-lookup"><span data-stu-id="efc2b-151">For more information about connectivity requirements, see the [NAT section in Azure Stack firewall integration](azure-stack-firewall.md#network-address-translation).</span></span> 

### <a name="private-network"></a><span data-ttu-id="efc2b-152">Private network</span><span class="sxs-lookup"><span data-stu-id="efc2b-152">Private network</span></span>
<span data-ttu-id="efc2b-153">This /24 (254 host IPs) network is private to the Azure Stack region (does not expand beyond the border switch devices of the Azure Stack region) and is divided into two subnets:</span><span class="sxs-lookup"><span data-stu-id="efc2b-153">This /24 (254 host IPs) network is private to the Azure Stack region (does not expand beyond the border switch devices of the Azure Stack region) and is divided into two subnets:</span></span>

- <span data-ttu-id="efc2b-154">**Storage network**.</span><span class="sxs-lookup"><span data-stu-id="efc2b-154">**Storage network**.</span></span> <span data-ttu-id="efc2b-155">A /25 (126 host IPs) network used to support the use of Spaces Direct and Server Message Block (SMB) storage traffic and virtual machine live migration.</span><span class="sxs-lookup"><span data-stu-id="efc2b-155">A /25 (126 host IPs) network used to support the use of Spaces Direct and Server Message Block (SMB) storage traffic and virtual machine live migration.</span></span> 
- <span data-ttu-id="efc2b-156">**Internal virtual IP network**.</span><span class="sxs-lookup"><span data-stu-id="efc2b-156">**Internal virtual IP network**.</span></span> <span data-ttu-id="efc2b-157">A /25 network dedicated to internal-only VIPs for the software load balancer.</span><span class="sxs-lookup"><span data-stu-id="efc2b-157">A /25 network dedicated to internal-only VIPs for the software load balancer.</span></span>

### <a name="azure-stack-infrastructure-network"></a><span data-ttu-id="efc2b-158">Azure Stack infrastructure network</span><span class="sxs-lookup"><span data-stu-id="efc2b-158">Azure Stack infrastructure network</span></span>
<span data-ttu-id="efc2b-159">This /24 network is dedicated to internal Azure Stack components so that they can communicate and exchange data among themselves.</span><span class="sxs-lookup"><span data-stu-id="efc2b-159">This /24 network is dedicated to internal Azure Stack components so that they can communicate and exchange data among themselves.</span></span> <span data-ttu-id="efc2b-160">This subnet requires routable IP addresses, but is kept private to the solution by using Access Control Lists (ACLs).</span><span class="sxs-lookup"><span data-stu-id="efc2b-160">This subnet requires routable IP addresses, but is kept private to the solution by using Access Control Lists (ACLs).</span></span> <span data-ttu-id="efc2b-161">It isn’t expected to be routed beyond the border switches except for a small range equivalent in size to a /27 network utilized by some of these services when they require access to external resources and/or the internet.</span><span class="sxs-lookup"><span data-stu-id="efc2b-161">It isn’t expected to be routed beyond the border switches except for a small range equivalent in size to a /27 network utilized by some of these services when they require access to external resources and/or the internet.</span></span> 

### <a name="public-infrastructure-network"></a><span data-ttu-id="efc2b-162">Public infrastructure network</span><span class="sxs-lookup"><span data-stu-id="efc2b-162">Public infrastructure network</span></span>
<span data-ttu-id="efc2b-163">This /27 network is the small range from the Azure Stack infrastructure subnet mentioned earlier, it does not require public IP addresses, but it does require internet access through a NAT or Transparent Proxy.</span><span class="sxs-lookup"><span data-stu-id="efc2b-163">This /27 network is the small range from the Azure Stack infrastructure subnet mentioned earlier, it does not require public IP addresses, but it does require internet access through a NAT or Transparent Proxy.</span></span> <span data-ttu-id="efc2b-164">This network will be allocated for the Emergency Recovery Console System (ERCS), the ERCS VM requires internet access during registration to Azure and during infrastructure backups.</span><span class="sxs-lookup"><span data-stu-id="efc2b-164">This network will be allocated for the Emergency Recovery Console System (ERCS), the ERCS VM requires internet access during registration to Azure and during infrastructure backups.</span></span> <span data-ttu-id="efc2b-165">The ERCS VM should be routable to your management network for troubleshooting purposes.</span><span class="sxs-lookup"><span data-stu-id="efc2b-165">The ERCS VM should be routable to your management network for troubleshooting purposes.</span></span>

### <a name="public-vip-network"></a><span data-ttu-id="efc2b-166">Public VIP network</span><span class="sxs-lookup"><span data-stu-id="efc2b-166">Public VIP network</span></span>
<span data-ttu-id="efc2b-167">The Public VIP Network is assigned to the network controller in Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="efc2b-167">The Public VIP Network is assigned to the network controller in Azure Stack.</span></span> <span data-ttu-id="efc2b-168">It’s not a logical network on the switch.</span><span class="sxs-lookup"><span data-stu-id="efc2b-168">It’s not a logical network on the switch.</span></span> <span data-ttu-id="efc2b-169">The SLB uses the pool of addresses and assigns /32 networks for tenant workloads.</span><span class="sxs-lookup"><span data-stu-id="efc2b-169">The SLB uses the pool of addresses and assigns /32 networks for tenant workloads.</span></span> <span data-ttu-id="efc2b-170">On the switch routing table, these /32 IPs are advertised as an available route via BGP.</span><span class="sxs-lookup"><span data-stu-id="efc2b-170">On the switch routing table, these /32 IPs are advertised as an available route via BGP.</span></span> <span data-ttu-id="efc2b-171">This network contains the external-accessible or public IP addresses.</span><span class="sxs-lookup"><span data-stu-id="efc2b-171">This network contains the external-accessible or public IP addresses.</span></span> <span data-ttu-id="efc2b-172">The Azure Stack infrastructure reserves the first 31 addresses from this Public VIP Network while the remainder is used by tenant VMs.</span><span class="sxs-lookup"><span data-stu-id="efc2b-172">The Azure Stack infrastructure reserves the first 31 addresses from this Public VIP Network while the remainder is used by tenant VMs.</span></span> <span data-ttu-id="efc2b-173">The network size on this subnet can range from a minimum of /26 (64 hosts) to a maximum of /22 (1022 hosts), we recommend that you plan for a /24 network.</span><span class="sxs-lookup"><span data-stu-id="efc2b-173">The network size on this subnet can range from a minimum of /26 (64 hosts) to a maximum of /22 (1022 hosts), we recommend that you plan for a /24 network.</span></span>

### <a name="switch-infrastructure-network"></a><span data-ttu-id="efc2b-174">Switch infrastructure network</span><span class="sxs-lookup"><span data-stu-id="efc2b-174">Switch infrastructure network</span></span>
<span data-ttu-id="efc2b-175">This /26 network is the subnet that contains the routable point-to-point IP /30 (2 host IPs) subnets and the loopbacks, which are dedicated /32 subnets for in-band switch management and BGP router ID.</span><span class="sxs-lookup"><span data-stu-id="efc2b-175">This /26 network is the subnet that contains the routable point-to-point IP /30 (2 host IPs) subnets and the loopbacks, which are dedicated /32 subnets for in-band switch management and BGP router ID.</span></span> <span data-ttu-id="efc2b-176">This range of IP addresses must be routable externally of the Azure Stack solution to your datacenter, they may be private or public IPs.</span><span class="sxs-lookup"><span data-stu-id="efc2b-176">This range of IP addresses must be routable externally of the Azure Stack solution to your datacenter, they may be private or public IPs.</span></span>

### <a name="switch-management-network"></a><span data-ttu-id="efc2b-177">Switch management network</span><span class="sxs-lookup"><span data-stu-id="efc2b-177">Switch management network</span></span>
<span data-ttu-id="efc2b-178">This /29 (6 host IPs) network is dedicated to connecting the management ports of the switches.</span><span class="sxs-lookup"><span data-stu-id="efc2b-178">This /29 (6 host IPs) network is dedicated to connecting the management ports of the switches.</span></span> <span data-ttu-id="efc2b-179">It allows out-of-band access for deployment, management, and troubleshooting.</span><span class="sxs-lookup"><span data-stu-id="efc2b-179">It allows out-of-band access for deployment, management, and troubleshooting.</span></span> <span data-ttu-id="efc2b-180">It is calculated from the switch infrastructure network mentioned above.</span><span class="sxs-lookup"><span data-stu-id="efc2b-180">It is calculated from the switch infrastructure network mentioned above.</span></span>

## <a name="publish-azure-stack-services"></a><span data-ttu-id="efc2b-181">Publish Azure Stack services</span><span class="sxs-lookup"><span data-stu-id="efc2b-181">Publish Azure Stack services</span></span>
<span data-ttu-id="efc2b-182">You'll need to make Azure Stack services available to users from outside Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="efc2b-182">You'll need to make Azure Stack services available to users from outside Azure Stack.</span></span> <span data-ttu-id="efc2b-183">Azure Stack sets up various endpoints for its infrastructure roles.</span><span class="sxs-lookup"><span data-stu-id="efc2b-183">Azure Stack sets up various endpoints for its infrastructure roles.</span></span> <span data-ttu-id="efc2b-184">These endpoints are assigned VIPs from the public IP address pool.</span><span class="sxs-lookup"><span data-stu-id="efc2b-184">These endpoints are assigned VIPs from the public IP address pool.</span></span> <span data-ttu-id="efc2b-185">A DNS entry is created for each endpoint in the external DNS zone, which was specified at deployment time.</span><span class="sxs-lookup"><span data-stu-id="efc2b-185">A DNS entry is created for each endpoint in the external DNS zone, which was specified at deployment time.</span></span> <span data-ttu-id="efc2b-186">For example, the user portal is assigned the DNS host entry of portal.*&lt;region>.&lt;fqdn>*.</span><span class="sxs-lookup"><span data-stu-id="efc2b-186">For example, the user portal is assigned the DNS host entry of portal.*&lt;region>.&lt;fqdn>*.</span></span>

### <a name="ports-and-urls"></a><span data-ttu-id="efc2b-187">Ports and URLs</span><span class="sxs-lookup"><span data-stu-id="efc2b-187">Ports and URLs</span></span>
<span data-ttu-id="efc2b-188">To make Azure Stack services (such as the portals, Azure Resource Manager, DNS, etc.) available to external networks, you must allow inbound traffic to these endpoints for specific URLs, ports, and protocols.</span><span class="sxs-lookup"><span data-stu-id="efc2b-188">To make Azure Stack services (such as the portals, Azure Resource Manager, DNS, etc.) available to external networks, you must allow inbound traffic to these endpoints for specific URLs, ports, and protocols.</span></span>
 
<span data-ttu-id="efc2b-189">In a deployment where a transparent proxy uplinks to a traditional proxy server, you must allow specific ports and URLs for both [inbound](https://docs.microsoft.com/azure/azure-stack/azure-stack-integrate-endpoints#ports-and-protocols-inbound) and [outbound](https://docs.microsoft.com/azure/azure-stack/azure-stack-integrate-endpoints#ports-and-urls-outbound) communication.</span><span class="sxs-lookup"><span data-stu-id="efc2b-189">In a deployment where a transparent proxy uplinks to a traditional proxy server, you must allow specific ports and URLs for both [inbound](https://docs.microsoft.com/azure/azure-stack/azure-stack-integrate-endpoints#ports-and-protocols-inbound) and [outbound](https://docs.microsoft.com/azure/azure-stack/azure-stack-integrate-endpoints#ports-and-urls-outbound) communication.</span></span> <span data-ttu-id="efc2b-190">These include ports and URLs for identity, the marketplace, patch and update, registration, and usage data.</span><span class="sxs-lookup"><span data-stu-id="efc2b-190">These include ports and URLs for identity, the marketplace, patch and update, registration, and usage data.</span></span>

## <a name="next-steps"></a><span data-ttu-id="efc2b-191">Next steps</span><span class="sxs-lookup"><span data-stu-id="efc2b-191">Next steps</span></span>
[<span data-ttu-id="efc2b-192">Border connectivity</span><span class="sxs-lookup"><span data-stu-id="efc2b-192">Border connectivity</span></span>](azure-stack-border-connectivity.md)