---
title: Best Practices for Azure App Service
description: Learn best practices and troubleshooting for Azure App Service.
services: app-service
documentationcenter: ''
author: dariagrigoriu
manager: erikre
editor: mollybos
ms.assetid: f3359464-fa44-4f4a-9ea6-7821060e8d0d
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/01/2016
ms.author: dariagrigoriu
ms.openlocfilehash: 7c5eb6190d4a4cdfa47779d2c4d7aadac5a2fb80
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44869029"
---
# <a name="best-practices-for-azure-app-service"></a><span data-ttu-id="129fe-103">Best Practices for Azure App Service</span><span class="sxs-lookup"><span data-stu-id="129fe-103">Best Practices for Azure App Service</span></span>
<span data-ttu-id="129fe-104">This article summarizes best practices for using [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714).</span><span class="sxs-lookup"><span data-stu-id="129fe-104">This article summarizes best practices for using [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714).</span></span> 

## <a name="colocation"></a><span data-ttu-id="129fe-105">Colocation</span><span class="sxs-lookup"><span data-stu-id="129fe-105">Colocation</span></span>
<span data-ttu-id="129fe-106">When Azure resources composing a solution such as a web app and a database are located in different regions, it can have the following effects:</span><span class="sxs-lookup"><span data-stu-id="129fe-106">When Azure resources composing a solution such as a web app and a database are located in different regions, it can have the following effects:</span></span>

* <span data-ttu-id="129fe-107">Increased latency in communication between resources</span><span class="sxs-lookup"><span data-stu-id="129fe-107">Increased latency in communication between resources</span></span>
* <span data-ttu-id="129fe-108">Monetary charges for outbound data transfer cross-region as noted on the [Azure pricing page](https://azure.microsoft.com/pricing/details/data-transfers).</span><span class="sxs-lookup"><span data-stu-id="129fe-108">Monetary charges for outbound data transfer cross-region as noted on the [Azure pricing page](https://azure.microsoft.com/pricing/details/data-transfers).</span></span>

<span data-ttu-id="129fe-109">Colocation in the same region is best for Azure resources composing a solution such as a web app and a database or storage account used to hold content or data.</span><span class="sxs-lookup"><span data-stu-id="129fe-109">Colocation in the same region is best for Azure resources composing a solution such as a web app and a database or storage account used to hold content or data.</span></span> <span data-ttu-id="129fe-110">When creating resources, make sure they are in the same Azure region unless you have specific business or design reason for them not to be.</span><span class="sxs-lookup"><span data-stu-id="129fe-110">When creating resources, make sure they are in the same Azure region unless you have specific business or design reason for them not to be.</span></span> <span data-ttu-id="129fe-111">You can move an App Service app to the same region as your database by using the [App Service cloning feature](app-service-web-app-cloning.md) currently available for Premium App Service Plan apps.</span><span class="sxs-lookup"><span data-stu-id="129fe-111">You can move an App Service app to the same region as your database by using the [App Service cloning feature](app-service-web-app-cloning.md) currently available for Premium App Service Plan apps.</span></span>   

## <a name="memoryresources"></a><span data-ttu-id="129fe-112">When apps consume more memory than expected</span><span class="sxs-lookup"><span data-stu-id="129fe-112">When apps consume more memory than expected</span></span>
<span data-ttu-id="129fe-113">When you notice an app consumes more memory than expected as indicated via monitoring or service recommendations, consider the [App Service Auto-Healing feature](https://azure.microsoft.com/blog/auto-healing-windows-azure-web-sites).</span><span class="sxs-lookup"><span data-stu-id="129fe-113">When you notice an app consumes more memory than expected as indicated via monitoring or service recommendations, consider the [App Service Auto-Healing feature](https://azure.microsoft.com/blog/auto-healing-windows-azure-web-sites).</span></span> <span data-ttu-id="129fe-114">One of the options for the Auto-Healing feature is taking custom actions based on a memory threshold.</span><span class="sxs-lookup"><span data-stu-id="129fe-114">One of the options for the Auto-Healing feature is taking custom actions based on a memory threshold.</span></span> <span data-ttu-id="129fe-115">Actions span the spectrum from email notifications to investigation via memory dump to on-the-spot mitigation by recycling the worker process.</span><span class="sxs-lookup"><span data-stu-id="129fe-115">Actions span the spectrum from email notifications to investigation via memory dump to on-the-spot mitigation by recycling the worker process.</span></span> <span data-ttu-id="129fe-116">Auto-healing can be configured via web.config and via a friendly user interface as described at in this blog post for the [App Service Support Site Extension](https://azure.microsoft.com/blog/additional-updates-to-support-site-extension-for-azure-app-service-web-apps).</span><span class="sxs-lookup"><span data-stu-id="129fe-116">Auto-healing can be configured via web.config and via a friendly user interface as described at in this blog post for the [App Service Support Site Extension](https://azure.microsoft.com/blog/additional-updates-to-support-site-extension-for-azure-app-service-web-apps).</span></span>   

## <a name="CPUresources"></a><span data-ttu-id="129fe-117">When apps consume more CPU than expected</span><span class="sxs-lookup"><span data-stu-id="129fe-117">When apps consume more CPU than expected</span></span>
<span data-ttu-id="129fe-118">When you notice an app consumes more CPU than expected or experiences repeated CPU spikes as indicated via monitoring or service recommendations, consider scaling up or scaling out the App Service plan.</span><span class="sxs-lookup"><span data-stu-id="129fe-118">When you notice an app consumes more CPU than expected or experiences repeated CPU spikes as indicated via monitoring or service recommendations, consider scaling up or scaling out the App Service plan.</span></span> <span data-ttu-id="129fe-119">If your application is stateful, scaling up is the only option, while if your application is stateless, scaling out gives you more flexibility and higher scale potential.</span><span class="sxs-lookup"><span data-stu-id="129fe-119">If your application is stateful, scaling up is the only option, while if your application is stateless, scaling out gives you more flexibility and higher scale potential.</span></span> 

<span data-ttu-id="129fe-120">For more information about “stateful” vs “stateless” applications you can watch this video: [Planning a Scalable End-to-End Multi-Tier Application on Microsoft Azure Web App](https://channel9.msdn.com/Events/TechEd/NorthAmerica/2014/DEV-B414#fbid=?hashlink=fbid).</span><span class="sxs-lookup"><span data-stu-id="129fe-120">For more information about “stateful” vs “stateless” applications you can watch this video: [Planning a Scalable End-to-End Multi-Tier Application on Microsoft Azure Web App](https://channel9.msdn.com/Events/TechEd/NorthAmerica/2014/DEV-B414#fbid=?hashlink=fbid).</span></span> <span data-ttu-id="129fe-121">For more information about App Service scaling and autoscaling options, see [Scale a Web App in Azure App Service](web-sites-scale.md).</span><span class="sxs-lookup"><span data-stu-id="129fe-121">For more information about App Service scaling and autoscaling options, see [Scale a Web App in Azure App Service](web-sites-scale.md).</span></span>  

## <a name="socketresources"></a><span data-ttu-id="129fe-122">When socket resources are exhausted</span><span class="sxs-lookup"><span data-stu-id="129fe-122">When socket resources are exhausted</span></span>
<span data-ttu-id="129fe-123">A common reason for exhausting outbound TCP connections is the use of client libraries, which are not implemented to reuse TCP connections, or when a higher-level protocol such as HTTP - Keep-Alive is not used.</span><span class="sxs-lookup"><span data-stu-id="129fe-123">A common reason for exhausting outbound TCP connections is the use of client libraries, which are not implemented to reuse TCP connections, or when a higher-level protocol such as HTTP - Keep-Alive is not used.</span></span> <span data-ttu-id="129fe-124">Review the documentation for each of the libraries referenced by the apps in your App Service Plan to ensure they are configured or accessed in your code for efficient reuse of outbound connections.</span><span class="sxs-lookup"><span data-stu-id="129fe-124">Review the documentation for each of the libraries referenced by the apps in your App Service Plan to ensure they are configured or accessed in your code for efficient reuse of outbound connections.</span></span> <span data-ttu-id="129fe-125">Also follow the library documentation guidance for proper creation and release or cleanup to avoid leaking connections.</span><span class="sxs-lookup"><span data-stu-id="129fe-125">Also follow the library documentation guidance for proper creation and release or cleanup to avoid leaking connections.</span></span> <span data-ttu-id="129fe-126">While such client libraries investigations are in progress, impact may be mitigated by scaling out to multiple instances.</span><span class="sxs-lookup"><span data-stu-id="129fe-126">While such client libraries investigations are in progress, impact may be mitigated by scaling out to multiple instances.</span></span>

### <a name="nodejs-and-outgoing-http-requests"></a><span data-ttu-id="129fe-127">Node.js and outgoing http requests</span><span class="sxs-lookup"><span data-stu-id="129fe-127">Node.js and outgoing http requests</span></span>
<span data-ttu-id="129fe-128">When working with Node.js and many outgoing http requests, dealing with HTTP - Keep-Alive is important.</span><span class="sxs-lookup"><span data-stu-id="129fe-128">When working with Node.js and many outgoing http requests, dealing with HTTP - Keep-Alive is important.</span></span> <span data-ttu-id="129fe-129">You can use the [agentkeepalive](https://www.npmjs.com/package/agentkeepalive) `npm` package to make it easier in your code.</span><span class="sxs-lookup"><span data-stu-id="129fe-129">You can use the [agentkeepalive](https://www.npmjs.com/package/agentkeepalive) `npm` package to make it easier in your code.</span></span>

<span data-ttu-id="129fe-130">Always handle the `http` response, even if you do nothing in the handler.</span><span class="sxs-lookup"><span data-stu-id="129fe-130">Always handle the `http` response, even if you do nothing in the handler.</span></span> <span data-ttu-id="129fe-131">If you don't handle the response properly, your application gets stuck eventually because no more sockets are available.</span><span class="sxs-lookup"><span data-stu-id="129fe-131">If you don't handle the response properly, your application gets stuck eventually because no more sockets are available.</span></span>

<span data-ttu-id="129fe-132">For example, when working with the `http` or `https` package:</span><span class="sxs-lookup"><span data-stu-id="129fe-132">For example, when working with the `http` or `https` package:</span></span>

```
var request = https.request(options, function(response) {
    response.on('data', function() { /* do nothing */ });
});
```

<span data-ttu-id="129fe-133">If you are running on App Service on Linux on a machine with multiple cores, another best practice is to use PM2 to start multiple Node.js processes to execute your application.</span><span class="sxs-lookup"><span data-stu-id="129fe-133">If you are running on App Service on Linux on a machine with multiple cores, another best practice is to use PM2 to start multiple Node.js processes to execute your application.</span></span> <span data-ttu-id="129fe-134">You can do it by specifying a startup command to your container.</span><span class="sxs-lookup"><span data-stu-id="129fe-134">You can do it by specifying a startup command to your container.</span></span>

<span data-ttu-id="129fe-135">For example, to start four instances:</span><span class="sxs-lookup"><span data-stu-id="129fe-135">For example, to start four instances:</span></span>

```
pm2 start /home/site/wwwroot/app.js --no-daemon -i 4
```

## <a name="appbackup"></a><span data-ttu-id="129fe-136">When your app backup starts failing</span><span class="sxs-lookup"><span data-stu-id="129fe-136">When your app backup starts failing</span></span>
<span data-ttu-id="129fe-137">The two most common reasons why app backup fails are: invalid storage settings and invalid database configuration.</span><span class="sxs-lookup"><span data-stu-id="129fe-137">The two most common reasons why app backup fails are: invalid storage settings and invalid database configuration.</span></span> <span data-ttu-id="129fe-138">These failures typically happen when there are changes to storage or database resources, or changes for how to access these resources (for example, credentials updated for the database selected in the backup settings).</span><span class="sxs-lookup"><span data-stu-id="129fe-138">These failures typically happen when there are changes to storage or database resources, or changes for how to access these resources (for example, credentials updated for the database selected in the backup settings).</span></span> <span data-ttu-id="129fe-139">Backups typically run on a schedule and require access to storage (for outputting the backed-up files) and databases (for copying and reading contents to be included in the backup).</span><span class="sxs-lookup"><span data-stu-id="129fe-139">Backups typically run on a schedule and require access to storage (for outputting the backed-up files) and databases (for copying and reading contents to be included in the backup).</span></span> <span data-ttu-id="129fe-140">The result of failing to access either of these resources would be consistent backup failure.</span><span class="sxs-lookup"><span data-stu-id="129fe-140">The result of failing to access either of these resources would be consistent backup failure.</span></span> 

<span data-ttu-id="129fe-141">When backup failures happen, review most recent results to understand which type of failure is happening.</span><span class="sxs-lookup"><span data-stu-id="129fe-141">When backup failures happen, review most recent results to understand which type of failure is happening.</span></span> <span data-ttu-id="129fe-142">For storage access failures, review and update the storage settings used in the backup configuration.</span><span class="sxs-lookup"><span data-stu-id="129fe-142">For storage access failures, review and update the storage settings used in the backup configuration.</span></span> <span data-ttu-id="129fe-143">For database access failures, review and update your connections strings as part of app settings; then proceed to update your backup configuration to properly include the required databases.</span><span class="sxs-lookup"><span data-stu-id="129fe-143">For database access failures, review and update your connections strings as part of app settings; then proceed to update your backup configuration to properly include the required databases.</span></span> <span data-ttu-id="129fe-144">For more information on app backups, see [Back up a web app in Azure App Service](web-sites-backup.md).</span><span class="sxs-lookup"><span data-stu-id="129fe-144">For more information on app backups, see [Back up a web app in Azure App Service](web-sites-backup.md).</span></span>

## <a name="nodejs"></a><span data-ttu-id="129fe-145">When new Node.js apps are deployed to Azure App Service</span><span class="sxs-lookup"><span data-stu-id="129fe-145">When new Node.js apps are deployed to Azure App Service</span></span>
<span data-ttu-id="129fe-146">Azure App Service default configuration for Node.js apps is intended to best suit the needs of most common apps.</span><span class="sxs-lookup"><span data-stu-id="129fe-146">Azure App Service default configuration for Node.js apps is intended to best suit the needs of most common apps.</span></span> <span data-ttu-id="129fe-147">If configuration for your Node.js app would benefit from personalized tuning to improve performance or optimize resource usage for CPU/memory/network resources, see [Best practices and troubleshooting guide for Node applications on Azure App Service](app-service-web-nodejs-best-practices-and-troubleshoot-guide.md).</span><span class="sxs-lookup"><span data-stu-id="129fe-147">If configuration for your Node.js app would benefit from personalized tuning to improve performance or optimize resource usage for CPU/memory/network resources, see [Best practices and troubleshooting guide for Node applications on Azure App Service](app-service-web-nodejs-best-practices-and-troubleshoot-guide.md).</span></span> <span data-ttu-id="129fe-148">This article describes the iisnode settings you may need to configure for your Node.js app, describes the various scenarios or issues that your app may be facing, and shows how to address these issues.</span><span class="sxs-lookup"><span data-stu-id="129fe-148">This article describes the iisnode settings you may need to configure for your Node.js app, describes the various scenarios or issues that your app may be facing, and shows how to address these issues.</span></span>

