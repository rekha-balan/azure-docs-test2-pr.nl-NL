---
title: Networking considerations with an Azure App Service environment
description: Explains the ASE network traffic and how to set NSGs and UDRs with your ASE
services: app-service
documentationcenter: na
author: ccompy
manager: stefsch
ms.assetid: 955a4d84-94ca-418d-aa79-b57a5eb8cb85
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/29/2018
ms.author: ccompy
ms.openlocfilehash: ef2288e2f756db6529f1ec5f7b3a49067b2998aa
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44868553"
---
# <a name="networking-considerations-for-an-app-service-environment"></a><span data-ttu-id="fb0b5-103">Networking considerations for an App Service Environment</span><span class="sxs-lookup"><span data-stu-id="fb0b5-103">Networking considerations for an App Service Environment</span></span> #

## <a name="overview"></a><span data-ttu-id="fb0b5-104">Overview</span><span class="sxs-lookup"><span data-stu-id="fb0b5-104">Overview</span></span> ##

 <span data-ttu-id="fb0b5-105">Azure [App Service Environment][Intro] is a deployment of Azure App Service into a subnet in your Azure virtual network (VNet).</span><span class="sxs-lookup"><span data-stu-id="fb0b5-105">Azure [App Service Environment][Intro] is a deployment of Azure App Service into a subnet in your Azure virtual network (VNet).</span></span> <span data-ttu-id="fb0b5-106">There are two deployment types for an App Service environment (ASE):</span><span class="sxs-lookup"><span data-stu-id="fb0b5-106">There are two deployment types for an App Service environment (ASE):</span></span>

- <span data-ttu-id="fb0b5-107">**External ASE**: Exposes the ASE-hosted apps on an internet-accessible IP address.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-107">**External ASE**: Exposes the ASE-hosted apps on an internet-accessible IP address.</span></span> <span data-ttu-id="fb0b5-108">For more information, see [Create an External ASE][MakeExternalASE].</span><span class="sxs-lookup"><span data-stu-id="fb0b5-108">For more information, see [Create an External ASE][MakeExternalASE].</span></span>
- <span data-ttu-id="fb0b5-109">**ILB ASE**: Exposes the ASE-hosted apps on an IP address inside your VNet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-109">**ILB ASE**: Exposes the ASE-hosted apps on an IP address inside your VNet.</span></span> <span data-ttu-id="fb0b5-110">The internal endpoint is an internal load balancer (ILB), which is why it's called an ILB ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-110">The internal endpoint is an internal load balancer (ILB), which is why it's called an ILB ASE.</span></span> <span data-ttu-id="fb0b5-111">For more information, see [Create and use an ILB ASE][MakeILBASE].</span><span class="sxs-lookup"><span data-stu-id="fb0b5-111">For more information, see [Create and use an ILB ASE][MakeILBASE].</span></span>

<span data-ttu-id="fb0b5-112">There are two versions of App Service Environment: ASEv1 and ASEv2.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-112">There are two versions of App Service Environment: ASEv1 and ASEv2.</span></span> <span data-ttu-id="fb0b5-113">For information on ASEv1, see [Introduction to App Service Environment v1][ASEv1Intro].</span><span class="sxs-lookup"><span data-stu-id="fb0b5-113">For information on ASEv1, see [Introduction to App Service Environment v1][ASEv1Intro].</span></span> <span data-ttu-id="fb0b5-114">ASEv1 can be deployed in a classic or Resource Manager VNet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-114">ASEv1 can be deployed in a classic or Resource Manager VNet.</span></span> <span data-ttu-id="fb0b5-115">ASEv2 can only be deployed into a Resource Manager VNet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-115">ASEv2 can only be deployed into a Resource Manager VNet.</span></span>

<span data-ttu-id="fb0b5-116">All calls from an ASE that go to the internet leave the VNet through a VIP assigned for the ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-116">All calls from an ASE that go to the internet leave the VNet through a VIP assigned for the ASE.</span></span> <span data-ttu-id="fb0b5-117">The public IP of this VIP is the source IP for all calls from the ASE that go to the internet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-117">The public IP of this VIP is the source IP for all calls from the ASE that go to the internet.</span></span> <span data-ttu-id="fb0b5-118">If the apps in your ASE make calls to resources in your VNet or across a VPN, the source IP is one of the IPs in the subnet used by your ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-118">If the apps in your ASE make calls to resources in your VNet or across a VPN, the source IP is one of the IPs in the subnet used by your ASE.</span></span> <span data-ttu-id="fb0b5-119">Because the ASE is within the VNet, it can also access resources within the VNet without any additional configuration.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-119">Because the ASE is within the VNet, it can also access resources within the VNet without any additional configuration.</span></span> <span data-ttu-id="fb0b5-120">If the VNet is connected to your on-premises network, apps in your ASE also have access to resources there without additional configuration.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-120">If the VNet is connected to your on-premises network, apps in your ASE also have access to resources there without additional configuration.</span></span>

![External ASE][1] 

<span data-ttu-id="fb0b5-122">If you have an External ASE, the public VIP is also the endpoint that your ASE apps resolve to for:</span><span class="sxs-lookup"><span data-stu-id="fb0b5-122">If you have an External ASE, the public VIP is also the endpoint that your ASE apps resolve to for:</span></span>

* <span data-ttu-id="fb0b5-123">HTTP/S.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-123">HTTP/S.</span></span> 
* <span data-ttu-id="fb0b5-124">FTP/S.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-124">FTP/S.</span></span> 
* <span data-ttu-id="fb0b5-125">Web deployment.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-125">Web deployment.</span></span>
* <span data-ttu-id="fb0b5-126">Remote debugging.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-126">Remote debugging.</span></span>

![ILB ASE][2]

<span data-ttu-id="fb0b5-128">If you have an ILB ASE, the address of the ILB is the endpoint for HTTP/S, FTP/S, web deployment, and remote debugging.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-128">If you have an ILB ASE, the address of the ILB is the endpoint for HTTP/S, FTP/S, web deployment, and remote debugging.</span></span>

<span data-ttu-id="fb0b5-129">The normal app access ports are:</span><span class="sxs-lookup"><span data-stu-id="fb0b5-129">The normal app access ports are:</span></span>

| <span data-ttu-id="fb0b5-130">Use</span><span class="sxs-lookup"><span data-stu-id="fb0b5-130">Use</span></span> | <span data-ttu-id="fb0b5-131">From</span><span class="sxs-lookup"><span data-stu-id="fb0b5-131">From</span></span> | <span data-ttu-id="fb0b5-132">To</span><span class="sxs-lookup"><span data-stu-id="fb0b5-132">To</span></span> |
|----------|---------|-------------|
|  <span data-ttu-id="fb0b5-133">HTTP/HTTPS</span><span class="sxs-lookup"><span data-stu-id="fb0b5-133">HTTP/HTTPS</span></span>  | <span data-ttu-id="fb0b5-134">User configurable</span><span class="sxs-lookup"><span data-stu-id="fb0b5-134">User configurable</span></span> |  <span data-ttu-id="fb0b5-135">80, 443</span><span class="sxs-lookup"><span data-stu-id="fb0b5-135">80, 443</span></span> |
|  <span data-ttu-id="fb0b5-136">FTP/FTPS</span><span class="sxs-lookup"><span data-stu-id="fb0b5-136">FTP/FTPS</span></span>    | <span data-ttu-id="fb0b5-137">User configurable</span><span class="sxs-lookup"><span data-stu-id="fb0b5-137">User configurable</span></span> |  <span data-ttu-id="fb0b5-138">21, 990, 10001-10020</span><span class="sxs-lookup"><span data-stu-id="fb0b5-138">21, 990, 10001-10020</span></span> |
|  <span data-ttu-id="fb0b5-139">Visual Studio remote debugging</span><span class="sxs-lookup"><span data-stu-id="fb0b5-139">Visual Studio remote debugging</span></span>  |  <span data-ttu-id="fb0b5-140">User configurable</span><span class="sxs-lookup"><span data-stu-id="fb0b5-140">User configurable</span></span> |  <span data-ttu-id="fb0b5-141">4016, 4018, 4020, 4022</span><span class="sxs-lookup"><span data-stu-id="fb0b5-141">4016, 4018, 4020, 4022</span></span> |

<span data-ttu-id="fb0b5-142">This is true if you're on an External ASE or on an ILB ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-142">This is true if you're on an External ASE or on an ILB ASE.</span></span> <span data-ttu-id="fb0b5-143">If you're on an External ASE, you hit those ports on the public VIP.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-143">If you're on an External ASE, you hit those ports on the public VIP.</span></span> <span data-ttu-id="fb0b5-144">If you're on an ILB ASE, you hit those ports on the ILB.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-144">If you're on an ILB ASE, you hit those ports on the ILB.</span></span> <span data-ttu-id="fb0b5-145">If you lock down port 443, there can be an effect on some features exposed in the portal.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-145">If you lock down port 443, there can be an effect on some features exposed in the portal.</span></span> <span data-ttu-id="fb0b5-146">For more information, see [Portal dependencies](#portaldep).</span><span class="sxs-lookup"><span data-stu-id="fb0b5-146">For more information, see [Portal dependencies](#portaldep).</span></span>

## <a name="ase-subnet-size"></a><span data-ttu-id="fb0b5-147">ASE subnet size</span><span class="sxs-lookup"><span data-stu-id="fb0b5-147">ASE subnet size</span></span> ##

<span data-ttu-id="fb0b5-148">The size of the subnet used to host an ASE cannot be altered after the ASE is deployed.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-148">The size of the subnet used to host an ASE cannot be altered after the ASE is deployed.</span></span>  <span data-ttu-id="fb0b5-149">The ASE uses an address for each infrastructure role as well as for each Isolated App Service plan instance.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-149">The ASE uses an address for each infrastructure role as well as for each Isolated App Service plan instance.</span></span>  <span data-ttu-id="fb0b5-150">Additionally, there are 5 addresses used by Azure Networking for every subnet that is created.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-150">Additionally, there are 5 addresses used by Azure Networking for every subnet that is created.</span></span>  <span data-ttu-id="fb0b5-151">An ASE with no App Service plans at all will use 12 addresses before you create an app.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-151">An ASE with no App Service plans at all will use 12 addresses before you create an app.</span></span>  <span data-ttu-id="fb0b5-152">If it is an ILB ASE then it will use 13 addresses before you create an app in that ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-152">If it is an ILB ASE then it will use 13 addresses before you create an app in that ASE.</span></span> <span data-ttu-id="fb0b5-153">As you scale out your ASE, infrastructure roles are added every multiple of 15 and 20 of your App Service plan instances.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-153">As you scale out your ASE, infrastructure roles are added every multiple of 15 and 20 of your App Service plan instances.</span></span>

   > [!NOTE]
   > <span data-ttu-id="fb0b5-154">Nothing else can be in the subnet but the ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-154">Nothing else can be in the subnet but the ASE.</span></span> <span data-ttu-id="fb0b5-155">Be sure to choose an address space that allows for future growth.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-155">Be sure to choose an address space that allows for future growth.</span></span> <span data-ttu-id="fb0b5-156">You can't change this setting later.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-156">You can't change this setting later.</span></span> <span data-ttu-id="fb0b5-157">We recommend a size of `/24` with 256 addresses.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-157">We recommend a size of `/24` with 256 addresses.</span></span>

<span data-ttu-id="fb0b5-158">When you scale up or down, new roles of the appropriate size are added and then your workloads are migrated from the current size to the target size.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-158">When you scale up or down, new roles of the appropriate size are added and then your workloads are migrated from the current size to the target size.</span></span> <span data-ttu-id="fb0b5-159">Only after your apps are migrated are the original VMs removed.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-159">Only after your apps are migrated are the original VMs removed.</span></span> <span data-ttu-id="fb0b5-160">This means that if you had an ASE with 100 ASP instances there would be a period where you need double the number of VMs.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-160">This means that if you had an ASE with 100 ASP instances there would be a period where you need double the number of VMs.</span></span>  <span data-ttu-id="fb0b5-161">It is for this reason that we recommend the use of a '/24' to accomodate any changes you might require.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-161">It is for this reason that we recommend the use of a '/24' to accomodate any changes you might require.</span></span>  

## <a name="ase-dependencies"></a><span data-ttu-id="fb0b5-162">ASE dependencies</span><span class="sxs-lookup"><span data-stu-id="fb0b5-162">ASE dependencies</span></span> ##

<span data-ttu-id="fb0b5-163">The ASE inbound access dependencies are:</span><span class="sxs-lookup"><span data-stu-id="fb0b5-163">The ASE inbound access dependencies are:</span></span>

| <span data-ttu-id="fb0b5-164">Use</span><span class="sxs-lookup"><span data-stu-id="fb0b5-164">Use</span></span> | <span data-ttu-id="fb0b5-165">From</span><span class="sxs-lookup"><span data-stu-id="fb0b5-165">From</span></span> | <span data-ttu-id="fb0b5-166">To</span><span class="sxs-lookup"><span data-stu-id="fb0b5-166">To</span></span> |
|-----|------|----|
| <span data-ttu-id="fb0b5-167">Management</span><span class="sxs-lookup"><span data-stu-id="fb0b5-167">Management</span></span> | <span data-ttu-id="fb0b5-168">App Service management addresses</span><span class="sxs-lookup"><span data-stu-id="fb0b5-168">App Service management addresses</span></span> | <span data-ttu-id="fb0b5-169">ASE subnet: 454, 455</span><span class="sxs-lookup"><span data-stu-id="fb0b5-169">ASE subnet: 454, 455</span></span> |
|  <span data-ttu-id="fb0b5-170">ASE internal communication</span><span class="sxs-lookup"><span data-stu-id="fb0b5-170">ASE internal communication</span></span> | <span data-ttu-id="fb0b5-171">ASE subnet: All ports</span><span class="sxs-lookup"><span data-stu-id="fb0b5-171">ASE subnet: All ports</span></span> | <span data-ttu-id="fb0b5-172">ASE subnet: All ports</span><span class="sxs-lookup"><span data-stu-id="fb0b5-172">ASE subnet: All ports</span></span>
|  <span data-ttu-id="fb0b5-173">Allow Azure load balancer inbound</span><span class="sxs-lookup"><span data-stu-id="fb0b5-173">Allow Azure load balancer inbound</span></span> | <span data-ttu-id="fb0b5-174">Azure load balancer</span><span class="sxs-lookup"><span data-stu-id="fb0b5-174">Azure load balancer</span></span> | <span data-ttu-id="fb0b5-175">ASE subnet: All ports</span><span class="sxs-lookup"><span data-stu-id="fb0b5-175">ASE subnet: All ports</span></span>
|  <span data-ttu-id="fb0b5-176">App assigned IP addresses</span><span class="sxs-lookup"><span data-stu-id="fb0b5-176">App assigned IP addresses</span></span> | <span data-ttu-id="fb0b5-177">App assigned addresses</span><span class="sxs-lookup"><span data-stu-id="fb0b5-177">App assigned addresses</span></span> | <span data-ttu-id="fb0b5-178">ASE subnet: All ports</span><span class="sxs-lookup"><span data-stu-id="fb0b5-178">ASE subnet: All ports</span></span>

<span data-ttu-id="fb0b5-179">The inbound management traffic provides command and control of the ASE in addition to system monitoring.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-179">The inbound management traffic provides command and control of the ASE in addition to system monitoring.</span></span> <span data-ttu-id="fb0b5-180">The source addresses for this traffic are listed in the [ASE Management addresses][ASEManagement] document.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-180">The source addresses for this traffic are listed in the [ASE Management addresses][ASEManagement] document.</span></span> <span data-ttu-id="fb0b5-181">The network security configuration needs to allow access from all IPs on ports 454 and 455.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-181">The network security configuration needs to allow access from all IPs on ports 454 and 455.</span></span> <span data-ttu-id="fb0b5-182">If you block access from those addresses, your ASE will become unhealthy and then become suspended.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-182">If you block access from those addresses, your ASE will become unhealthy and then become suspended.</span></span>

<span data-ttu-id="fb0b5-183">Within the ASE subnet there are many ports used for internal component communication and they can change.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-183">Within the ASE subnet there are many ports used for internal component communication and they can change.</span></span>  <span data-ttu-id="fb0b5-184">This requires all of the ports in the ASE subnet to be accessible from the ASE subnet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-184">This requires all of the ports in the ASE subnet to be accessible from the ASE subnet.</span></span> 

<span data-ttu-id="fb0b5-185">For the communication between the Azure load balancer and the ASE subnet the minimum ports that need to be open are 454, 455 and 16001.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-185">For the communication between the Azure load balancer and the ASE subnet the minimum ports that need to be open are 454, 455 and 16001.</span></span> <span data-ttu-id="fb0b5-186">The 16001 port is used for keep alive traffic between the load balancer and the ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-186">The 16001 port is used for keep alive traffic between the load balancer and the ASE.</span></span> <span data-ttu-id="fb0b5-187">If you are using an ILB ASE then you can lock traffic down to just the 454, 455, 16001 ports.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-187">If you are using an ILB ASE then you can lock traffic down to just the 454, 455, 16001 ports.</span></span>  <span data-ttu-id="fb0b5-188">If you are using an External ASE then you need to take into account the normal app access ports.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-188">If you are using an External ASE then you need to take into account the normal app access ports.</span></span>  <span data-ttu-id="fb0b5-189">If you are using app assigned addresses you need to open it to all ports.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-189">If you are using app assigned addresses you need to open it to all ports.</span></span>  <span data-ttu-id="fb0b5-190">When an address is assigned to a specific app, then the load balancer will use ports that are not known of in advance to send HTTP and HTTPS traffic to the ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-190">When an address is assigned to a specific app, then the load balancer will use ports that are not known of in advance to send HTTP and HTTPS traffic to the ASE.</span></span>

<span data-ttu-id="fb0b5-191">If you are using app assigned IP addresses you need to allow traffic from the IPs assigned to your apps to the ASE subnet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-191">If you are using app assigned IP addresses you need to allow traffic from the IPs assigned to your apps to the ASE subnet.</span></span>

<span data-ttu-id="fb0b5-192">For outbound access, an ASE depends on multiple external systems.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-192">For outbound access, an ASE depends on multiple external systems.</span></span> <span data-ttu-id="fb0b5-193">Those system dependencies are defined with DNS names and don't map to a fixed set of IP addresses.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-193">Those system dependencies are defined with DNS names and don't map to a fixed set of IP addresses.</span></span> <span data-ttu-id="fb0b5-194">Thus, the ASE requires outbound access from the ASE subnet to all external IPs across a variety of ports.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-194">Thus, the ASE requires outbound access from the ASE subnet to all external IPs across a variety of ports.</span></span> <span data-ttu-id="fb0b5-195">An ASE has the following outbound dependencies:</span><span class="sxs-lookup"><span data-stu-id="fb0b5-195">An ASE has the following outbound dependencies:</span></span>

| <span data-ttu-id="fb0b5-196">Use</span><span class="sxs-lookup"><span data-stu-id="fb0b5-196">Use</span></span> | <span data-ttu-id="fb0b5-197">From</span><span class="sxs-lookup"><span data-stu-id="fb0b5-197">From</span></span> | <span data-ttu-id="fb0b5-198">To</span><span class="sxs-lookup"><span data-stu-id="fb0b5-198">To</span></span> |
|-----|------|----|
| <span data-ttu-id="fb0b5-199">Azure Storage</span><span class="sxs-lookup"><span data-stu-id="fb0b5-199">Azure Storage</span></span> | <span data-ttu-id="fb0b5-200">ASE subnet</span><span class="sxs-lookup"><span data-stu-id="fb0b5-200">ASE subnet</span></span> | <span data-ttu-id="fb0b5-201">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 is only needed for ASEv1.)</span><span class="sxs-lookup"><span data-stu-id="fb0b5-201">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 is only needed for ASEv1.)</span></span> |
| <span data-ttu-id="fb0b5-202">Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="fb0b5-202">Azure SQL Database</span></span> | <span data-ttu-id="fb0b5-203">ASE subnet</span><span class="sxs-lookup"><span data-stu-id="fb0b5-203">ASE subnet</span></span> | <span data-ttu-id="fb0b5-204">database.windows.net: 1433</span><span class="sxs-lookup"><span data-stu-id="fb0b5-204">database.windows.net: 1433</span></span> |
| <span data-ttu-id="fb0b5-205">Azure management</span><span class="sxs-lookup"><span data-stu-id="fb0b5-205">Azure management</span></span> | <span data-ttu-id="fb0b5-206">ASE subnet</span><span class="sxs-lookup"><span data-stu-id="fb0b5-206">ASE subnet</span></span> | <span data-ttu-id="fb0b5-207">management.core.windows.net, management.azure.com, admin.core.windows.net: 443</span><span class="sxs-lookup"><span data-stu-id="fb0b5-207">management.core.windows.net, management.azure.com, admin.core.windows.net: 443</span></span> |
| <span data-ttu-id="fb0b5-208">SSL certificate verification</span><span class="sxs-lookup"><span data-stu-id="fb0b5-208">SSL certificate verification</span></span> |  <span data-ttu-id="fb0b5-209">ASE subnet</span><span class="sxs-lookup"><span data-stu-id="fb0b5-209">ASE subnet</span></span>            |  <span data-ttu-id="fb0b5-210">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443</span><span class="sxs-lookup"><span data-stu-id="fb0b5-210">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443</span></span> |
| <span data-ttu-id="fb0b5-211">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="fb0b5-211">Azure Active Directory</span></span>        | <span data-ttu-id="fb0b5-212">ASE subnet</span><span class="sxs-lookup"><span data-stu-id="fb0b5-212">ASE subnet</span></span>            |  <span data-ttu-id="fb0b5-213">login.windows.net: 443</span><span class="sxs-lookup"><span data-stu-id="fb0b5-213">login.windows.net: 443</span></span> |
| <span data-ttu-id="fb0b5-214">App Service management</span><span class="sxs-lookup"><span data-stu-id="fb0b5-214">App Service management</span></span>        | <span data-ttu-id="fb0b5-215">ASE subnet</span><span class="sxs-lookup"><span data-stu-id="fb0b5-215">ASE subnet</span></span>            |  <span data-ttu-id="fb0b5-216">gr-prod-<regionspecific>.cloudapp.net, az-prod.metrics.nsatc.net: 443</span><span class="sxs-lookup"><span data-stu-id="fb0b5-216">gr-prod-<regionspecific>.cloudapp.net, az-prod.metrics.nsatc.net: 443</span></span> |
| <span data-ttu-id="fb0b5-217">Azure DNS</span><span class="sxs-lookup"><span data-stu-id="fb0b5-217">Azure DNS</span></span>                     | <span data-ttu-id="fb0b5-218">ASE subnet</span><span class="sxs-lookup"><span data-stu-id="fb0b5-218">ASE subnet</span></span>            |  <span data-ttu-id="fb0b5-219">Internet: 53</span><span class="sxs-lookup"><span data-stu-id="fb0b5-219">Internet: 53</span></span> |
| <span data-ttu-id="fb0b5-220">ASE internal communication</span><span class="sxs-lookup"><span data-stu-id="fb0b5-220">ASE internal communication</span></span>    | <span data-ttu-id="fb0b5-221">ASE subnet: All ports</span><span class="sxs-lookup"><span data-stu-id="fb0b5-221">ASE subnet: All ports</span></span> |  <span data-ttu-id="fb0b5-222">ASE subnet: All ports</span><span class="sxs-lookup"><span data-stu-id="fb0b5-222">ASE subnet: All ports</span></span> |

<span data-ttu-id="fb0b5-223">If the ASE loses access to these dependencies, it stops working.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-223">If the ASE loses access to these dependencies, it stops working.</span></span> <span data-ttu-id="fb0b5-224">When that happens long enough, the ASE is suspended.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-224">When that happens long enough, the ASE is suspended.</span></span>

### <a name="customer-dns"></a><span data-ttu-id="fb0b5-225">Customer DNS</span><span class="sxs-lookup"><span data-stu-id="fb0b5-225">Customer DNS</span></span> ###

<span data-ttu-id="fb0b5-226">If the VNet is configured with a customer-defined DNS server, the tenant workloads use it.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-226">If the VNet is configured with a customer-defined DNS server, the tenant workloads use it.</span></span> <span data-ttu-id="fb0b5-227">The ASE still needs to communicate with Azure DNS for management purposes.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-227">The ASE still needs to communicate with Azure DNS for management purposes.</span></span> 

<span data-ttu-id="fb0b5-228">If the VNet is configured with a customer DNS on the other side of a VPN, the DNS server must be reachable from the subnet that contains the ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-228">If the VNet is configured with a customer DNS on the other side of a VPN, the DNS server must be reachable from the subnet that contains the ASE.</span></span>

<a name="portaldep"></a>

## <a name="portal-dependencies"></a><span data-ttu-id="fb0b5-229">Portal dependencies</span><span class="sxs-lookup"><span data-stu-id="fb0b5-229">Portal dependencies</span></span> ##

<span data-ttu-id="fb0b5-230">In addition to the ASE functional dependencies, there are a few extra items related to the portal experience.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-230">In addition to the ASE functional dependencies, there are a few extra items related to the portal experience.</span></span> <span data-ttu-id="fb0b5-231">Some of the capabilities in the Azure portal depend on direct access to _SCM site_.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-231">Some of the capabilities in the Azure portal depend on direct access to _SCM site_.</span></span> <span data-ttu-id="fb0b5-232">For every app in Azure App Service, there are two URLs.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-232">For every app in Azure App Service, there are two URLs.</span></span> <span data-ttu-id="fb0b5-233">The first URL is to access your app.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-233">The first URL is to access your app.</span></span> <span data-ttu-id="fb0b5-234">The second URL is to access the SCM site, which is also called the _Kudu console_.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-234">The second URL is to access the SCM site, which is also called the _Kudu console_.</span></span> <span data-ttu-id="fb0b5-235">Features that use the SCM site include:</span><span class="sxs-lookup"><span data-stu-id="fb0b5-235">Features that use the SCM site include:</span></span>

-   <span data-ttu-id="fb0b5-236">Web jobs</span><span class="sxs-lookup"><span data-stu-id="fb0b5-236">Web jobs</span></span>
-   <span data-ttu-id="fb0b5-237">Functions</span><span class="sxs-lookup"><span data-stu-id="fb0b5-237">Functions</span></span>
-   <span data-ttu-id="fb0b5-238">Log streaming</span><span class="sxs-lookup"><span data-stu-id="fb0b5-238">Log streaming</span></span>
-   <span data-ttu-id="fb0b5-239">Kudu</span><span class="sxs-lookup"><span data-stu-id="fb0b5-239">Kudu</span></span>
-   <span data-ttu-id="fb0b5-240">Extensions</span><span class="sxs-lookup"><span data-stu-id="fb0b5-240">Extensions</span></span>
-   <span data-ttu-id="fb0b5-241">Process Explorer</span><span class="sxs-lookup"><span data-stu-id="fb0b5-241">Process Explorer</span></span>
-   <span data-ttu-id="fb0b5-242">Console</span><span class="sxs-lookup"><span data-stu-id="fb0b5-242">Console</span></span>

<span data-ttu-id="fb0b5-243">When you use an ILB ASE, the SCM site isn't internet accessible from outside the VNet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-243">When you use an ILB ASE, the SCM site isn't internet accessible from outside the VNet.</span></span> <span data-ttu-id="fb0b5-244">When your app is hosted on an ILB ASE, some capabilities will not work from the portal.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-244">When your app is hosted on an ILB ASE, some capabilities will not work from the portal.</span></span>  

<span data-ttu-id="fb0b5-245">Many of those capabilities that depend upon the SCM site are also available directly in the Kudu console.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-245">Many of those capabilities that depend upon the SCM site are also available directly in the Kudu console.</span></span> <span data-ttu-id="fb0b5-246">You can connect to it directly rather than by using the portal.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-246">You can connect to it directly rather than by using the portal.</span></span> <span data-ttu-id="fb0b5-247">If your app is hosted in an ILB ASE, use your publishing credentials to sign in.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-247">If your app is hosted in an ILB ASE, use your publishing credentials to sign in.</span></span> <span data-ttu-id="fb0b5-248">The URL to access the SCM site of an app hosted in an ILB ASE has the following format:</span><span class="sxs-lookup"><span data-stu-id="fb0b5-248">The URL to access the SCM site of an app hosted in an ILB ASE has the following format:</span></span> 

```
<appname>.scm.<domain name the ILB ASE was created with> 
```

<span data-ttu-id="fb0b5-249">If your ILB ASE is the domain name *contoso.net* and your app name is *testapp*, the app is reached at *testapp.contoso.net*.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-249">If your ILB ASE is the domain name *contoso.net* and your app name is *testapp*, the app is reached at *testapp.contoso.net*.</span></span> <span data-ttu-id="fb0b5-250">The SCM site that goes with it is reached at *testapp.scm.contoso.net*.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-250">The SCM site that goes with it is reached at *testapp.scm.contoso.net*.</span></span>

## <a name="functions-and-web-jobs"></a><span data-ttu-id="fb0b5-251">Functions and Web jobs</span><span class="sxs-lookup"><span data-stu-id="fb0b5-251">Functions and Web jobs</span></span> ##

<span data-ttu-id="fb0b5-252">Both Functions and Web jobs depend on the SCM site but are supported for use in the portal, even if your apps are in an ILB ASE, so long as your browser can reach the SCM site.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-252">Both Functions and Web jobs depend on the SCM site but are supported for use in the portal, even if your apps are in an ILB ASE, so long as your browser can reach the SCM site.</span></span>  <span data-ttu-id="fb0b5-253">If you are using a self-signed certificate with your ILB ASE, you will need to enable your browser to trust that certificate.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-253">If you are using a self-signed certificate with your ILB ASE, you will need to enable your browser to trust that certificate.</span></span>  <span data-ttu-id="fb0b5-254">For IE and Edge that means the certificate has to be in the computer trust store.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-254">For IE and Edge that means the certificate has to be in the computer trust store.</span></span>  <span data-ttu-id="fb0b5-255">If you are using Chrome then that means you accepted the certificate in the browser earlier by presumably hitting the scm site directly.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-255">If you are using Chrome then that means you accepted the certificate in the browser earlier by presumably hitting the scm site directly.</span></span>  <span data-ttu-id="fb0b5-256">The best solution is to use a commercial certificate that is in the browser chain of trust.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-256">The best solution is to use a commercial certificate that is in the browser chain of trust.</span></span>  

## <a name="ase-ip-addresses"></a><span data-ttu-id="fb0b5-257">ASE IP addresses</span><span class="sxs-lookup"><span data-stu-id="fb0b5-257">ASE IP addresses</span></span> ##

<span data-ttu-id="fb0b5-258">An ASE has a few IP addresses to be aware of.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-258">An ASE has a few IP addresses to be aware of.</span></span> <span data-ttu-id="fb0b5-259">They are:</span><span class="sxs-lookup"><span data-stu-id="fb0b5-259">They are:</span></span>

- <span data-ttu-id="fb0b5-260">**Public inbound IP address**: Used for app traffic in an External ASE, and management traffic in both an External ASE and an ILB ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-260">**Public inbound IP address**: Used for app traffic in an External ASE, and management traffic in both an External ASE and an ILB ASE.</span></span>
- <span data-ttu-id="fb0b5-261">**Outbound public IP**: Used as the "from" IP for outbound connections from the ASE that leave the VNet, which aren't routed down a VPN.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-261">**Outbound public IP**: Used as the "from" IP for outbound connections from the ASE that leave the VNet, which aren't routed down a VPN.</span></span>
- <span data-ttu-id="fb0b5-262">**ILB IP address**: If you use an ILB ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-262">**ILB IP address**: If you use an ILB ASE.</span></span>
- <span data-ttu-id="fb0b5-263">**App-assigned IP-based SSL addresses**: Only possible with an External ASE and when IP-based SSL is configured.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-263">**App-assigned IP-based SSL addresses**: Only possible with an External ASE and when IP-based SSL is configured.</span></span>

<span data-ttu-id="fb0b5-264">All these IP addresses are easily visible in an ASEv2 in the Azure portal from the ASE UI.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-264">All these IP addresses are easily visible in an ASEv2 in the Azure portal from the ASE UI.</span></span> <span data-ttu-id="fb0b5-265">If you have an ILB ASE, the IP for the ILB is listed.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-265">If you have an ILB ASE, the IP for the ILB is listed.</span></span>

   > [!NOTE]
   > <span data-ttu-id="fb0b5-266">These IP addresses will not change so long as your ASE stays up and running.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-266">These IP addresses will not change so long as your ASE stays up and running.</span></span>  <span data-ttu-id="fb0b5-267">If your ASE becomes suspended and restored, the addresses used by your ASE will change.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-267">If your ASE becomes suspended and restored, the addresses used by your ASE will change.</span></span> <span data-ttu-id="fb0b5-268">The normal cause for an ASE to become suspended is if you block inbound management access or block access to an ASE dependency.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-268">The normal cause for an ASE to become suspended is if you block inbound management access or block access to an ASE dependency.</span></span> 

![IP addresses][3]

### <a name="app-assigned-ip-addresses"></a><span data-ttu-id="fb0b5-270">App-assigned IP addresses</span><span class="sxs-lookup"><span data-stu-id="fb0b5-270">App-assigned IP addresses</span></span> ###

<span data-ttu-id="fb0b5-271">With an External ASE, you can assign IP addresses to individual apps.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-271">With an External ASE, you can assign IP addresses to individual apps.</span></span> <span data-ttu-id="fb0b5-272">You can't do that with an ILB ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-272">You can't do that with an ILB ASE.</span></span> <span data-ttu-id="fb0b5-273">For more information on how to configure your app to have its own IP address, see [Bind an existing custom SSL certificate to Azure web apps](../app-service-web-tutorial-custom-ssl.md).</span><span class="sxs-lookup"><span data-stu-id="fb0b5-273">For more information on how to configure your app to have its own IP address, see [Bind an existing custom SSL certificate to Azure web apps](../app-service-web-tutorial-custom-ssl.md).</span></span>

<span data-ttu-id="fb0b5-274">When an app has its own IP-based SSL address, the ASE reserves two ports to map to that IP address.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-274">When an app has its own IP-based SSL address, the ASE reserves two ports to map to that IP address.</span></span> <span data-ttu-id="fb0b5-275">One port is for HTTP traffic, and the other port is for HTTPS.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-275">One port is for HTTP traffic, and the other port is for HTTPS.</span></span> <span data-ttu-id="fb0b5-276">Those ports are listed in the ASE UI in the IP addresses section.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-276">Those ports are listed in the ASE UI in the IP addresses section.</span></span> <span data-ttu-id="fb0b5-277">Traffic must be able to reach those ports from the VIP or the apps are inaccessible.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-277">Traffic must be able to reach those ports from the VIP or the apps are inaccessible.</span></span> <span data-ttu-id="fb0b5-278">This requirement is important to remember when you configure Network Security Groups (NSGs).</span><span class="sxs-lookup"><span data-stu-id="fb0b5-278">This requirement is important to remember when you configure Network Security Groups (NSGs).</span></span>

## <a name="network-security-groups"></a><span data-ttu-id="fb0b5-279">Network Security Groups</span><span class="sxs-lookup"><span data-stu-id="fb0b5-279">Network Security Groups</span></span> ##

<span data-ttu-id="fb0b5-280">[Network Security Groups][NSGs] provide the ability to control network access within a VNet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-280">[Network Security Groups][NSGs] provide the ability to control network access within a VNet.</span></span> <span data-ttu-id="fb0b5-281">When you use the portal, there's an implicit deny rule at the lowest priority to deny everything.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-281">When you use the portal, there's an implicit deny rule at the lowest priority to deny everything.</span></span> <span data-ttu-id="fb0b5-282">What you build are your allow rules.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-282">What you build are your allow rules.</span></span>

<span data-ttu-id="fb0b5-283">In an ASE, you don't have access to the VMs used to host the ASE itself.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-283">In an ASE, you don't have access to the VMs used to host the ASE itself.</span></span> <span data-ttu-id="fb0b5-284">They're in a Microsoft-managed subscription.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-284">They're in a Microsoft-managed subscription.</span></span> <span data-ttu-id="fb0b5-285">If you want to restrict access to the apps on the ASE, set NSGs on the ASE subnet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-285">If you want to restrict access to the apps on the ASE, set NSGs on the ASE subnet.</span></span> <span data-ttu-id="fb0b5-286">In doing so, pay careful attention to the ASE dependencies.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-286">In doing so, pay careful attention to the ASE dependencies.</span></span> <span data-ttu-id="fb0b5-287">If you block any dependencies, the ASE stops working.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-287">If you block any dependencies, the ASE stops working.</span></span>

<span data-ttu-id="fb0b5-288">NSGs can be configured through the Azure portal or via PowerShell.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-288">NSGs can be configured through the Azure portal or via PowerShell.</span></span> <span data-ttu-id="fb0b5-289">The information here shows the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-289">The information here shows the Azure portal.</span></span> <span data-ttu-id="fb0b5-290">You create and manage NSGs in the portal as a top-level resource under **Networking**.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-290">You create and manage NSGs in the portal as a top-level resource under **Networking**.</span></span>

<span data-ttu-id="fb0b5-291">When the inbound and outbound requirements are taken into account, the NSGs should look similar to the NSGs shown in this example.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-291">When the inbound and outbound requirements are taken into account, the NSGs should look similar to the NSGs shown in this example.</span></span> <span data-ttu-id="fb0b5-292">The VNet address range is _192.168.250.0/23_, and the subnet that the ASE is in is _192.168.251.128/25_.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-292">The VNet address range is _192.168.250.0/23_, and the subnet that the ASE is in is _192.168.251.128/25_.</span></span>

<span data-ttu-id="fb0b5-293">The first two inbound requirements for the ASE to function are shown at the top of the list in this example.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-293">The first two inbound requirements for the ASE to function are shown at the top of the list in this example.</span></span> <span data-ttu-id="fb0b5-294">They enable ASE management and allow the ASE to communicate with itself.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-294">They enable ASE management and allow the ASE to communicate with itself.</span></span> <span data-ttu-id="fb0b5-295">The other entries are all tenant configurable and can govern network access to the ASE-hosted applications.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-295">The other entries are all tenant configurable and can govern network access to the ASE-hosted applications.</span></span> 

![Inbound security rules][4]

<span data-ttu-id="fb0b5-297">A default rule enables the IPs in the VNet to talk to the ASE subnet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-297">A default rule enables the IPs in the VNet to talk to the ASE subnet.</span></span> <span data-ttu-id="fb0b5-298">Another default rule enables the load balancer, also known as the public VIP, to communicate with the ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-298">Another default rule enables the load balancer, also known as the public VIP, to communicate with the ASE.</span></span> <span data-ttu-id="fb0b5-299">To see the default rules, select **Default rules** next to the **Add** icon.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-299">To see the default rules, select **Default rules** next to the **Add** icon.</span></span> <span data-ttu-id="fb0b5-300">If you put a deny everything else rule after the NSG rules shown, you prevent traffic between the VIP and the ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-300">If you put a deny everything else rule after the NSG rules shown, you prevent traffic between the VIP and the ASE.</span></span> <span data-ttu-id="fb0b5-301">To prevent traffic coming from inside the VNet, add your own rule to allow inbound.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-301">To prevent traffic coming from inside the VNet, add your own rule to allow inbound.</span></span> <span data-ttu-id="fb0b5-302">Use a source equal to AzureLoadBalancer with a destination of **Any** and a port range of **\***.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-302">Use a source equal to AzureLoadBalancer with a destination of **Any** and a port range of **\***.</span></span> <span data-ttu-id="fb0b5-303">Because the NSG rule is applied to the ASE subnet, you don't need to be specific in the destination.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-303">Because the NSG rule is applied to the ASE subnet, you don't need to be specific in the destination.</span></span>

<span data-ttu-id="fb0b5-304">If you assigned an IP address to your app, make sure you keep the ports open.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-304">If you assigned an IP address to your app, make sure you keep the ports open.</span></span> <span data-ttu-id="fb0b5-305">To see the ports, select **App Service Environment** > **IP addresses**.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-305">To see the ports, select **App Service Environment** > **IP addresses**.</span></span>  

<span data-ttu-id="fb0b5-306">All the items shown in the following outbound rules are needed, except for the last item.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-306">All the items shown in the following outbound rules are needed, except for the last item.</span></span> <span data-ttu-id="fb0b5-307">They enable network access to the ASE dependencies that were noted earlier in this article.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-307">They enable network access to the ASE dependencies that were noted earlier in this article.</span></span> <span data-ttu-id="fb0b5-308">If you block any of them, your ASE stops working.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-308">If you block any of them, your ASE stops working.</span></span> <span data-ttu-id="fb0b5-309">The last item in the list enables your ASE to communicate with other resources in your VNet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-309">The last item in the list enables your ASE to communicate with other resources in your VNet.</span></span>

![Outbound security rules][5]

<span data-ttu-id="fb0b5-311">After your NSGs are defined, assign them to the subnet that your ASE is on.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-311">After your NSGs are defined, assign them to the subnet that your ASE is on.</span></span> <span data-ttu-id="fb0b5-312">If you don’t remember the ASE VNet or subnet, you can see it from the ASE portal page.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-312">If you don’t remember the ASE VNet or subnet, you can see it from the ASE portal page.</span></span> <span data-ttu-id="fb0b5-313">To assign the NSG to your subnet, go to the subnet UI and select the NSG.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-313">To assign the NSG to your subnet, go to the subnet UI and select the NSG.</span></span>

## <a name="routes"></a><span data-ttu-id="fb0b5-314">Routes</span><span class="sxs-lookup"><span data-stu-id="fb0b5-314">Routes</span></span> ##

<span data-ttu-id="fb0b5-315">Forced tunneling is when you set routes in your VNet so the outbound traffic doesn't go directly to the internet but somewhere else like an ExpressRoute gateway or a virtual appliance.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-315">Forced tunneling is when you set routes in your VNet so the outbound traffic doesn't go directly to the internet but somewhere else like an ExpressRoute gateway or a virtual appliance.</span></span>  <span data-ttu-id="fb0b5-316">If you need to configure your ASE in such a manner then read the document on [Configuring your App Service Environment with Forced Tunneling][forcedtunnel].</span><span class="sxs-lookup"><span data-stu-id="fb0b5-316">If you need to configure your ASE in such a manner then read the document on [Configuring your App Service Environment with Forced Tunneling][forcedtunnel].</span></span>  <span data-ttu-id="fb0b5-317">This document will tell you the options available to work with ExpressRoute and forced tunneling.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-317">This document will tell you the options available to work with ExpressRoute and forced tunneling.</span></span>

<span data-ttu-id="fb0b5-318">When you create an ASE in the portal we also create a set of route tables on the subnet that is created with the ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-318">When you create an ASE in the portal we also create a set of route tables on the subnet that is created with the ASE.</span></span>  <span data-ttu-id="fb0b5-319">Those routes simply say to send outbound traffic directly to the internet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-319">Those routes simply say to send outbound traffic directly to the internet.</span></span>  
<span data-ttu-id="fb0b5-320">To create the same routes manually, follow these steps:</span><span class="sxs-lookup"><span data-stu-id="fb0b5-320">To create the same routes manually, follow these steps:</span></span>

1. <span data-ttu-id="fb0b5-321">Go to the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-321">Go to the Azure portal.</span></span> <span data-ttu-id="fb0b5-322">Select **Networking** > **Route Tables**.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-322">Select **Networking** > **Route Tables**.</span></span>

2. <span data-ttu-id="fb0b5-323">Create a new route table in the same region as your VNet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-323">Create a new route table in the same region as your VNet.</span></span>

3. <span data-ttu-id="fb0b5-324">From within your route table UI, select **Routes** > **Add**.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-324">From within your route table UI, select **Routes** > **Add**.</span></span>

4. <span data-ttu-id="fb0b5-325">Set the **Next hop type** to **Internet** and the **Address prefix** to **0.0.0.0/0**.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-325">Set the **Next hop type** to **Internet** and the **Address prefix** to **0.0.0.0/0**.</span></span> <span data-ttu-id="fb0b5-326">Select **Save**.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-326">Select **Save**.</span></span>

    <span data-ttu-id="fb0b5-327">You then see something like the following:</span><span class="sxs-lookup"><span data-stu-id="fb0b5-327">You then see something like the following:</span></span>

    ![Functional routes][6]

5. <span data-ttu-id="fb0b5-329">After you create the new route table, go to the subnet that contains your ASE.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-329">After you create the new route table, go to the subnet that contains your ASE.</span></span> <span data-ttu-id="fb0b5-330">Select your route table from the list in the portal.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-330">Select your route table from the list in the portal.</span></span> <span data-ttu-id="fb0b5-331">After you save the change, you should then see the NSGs and routes noted with your subnet.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-331">After you save the change, you should then see the NSGs and routes noted with your subnet.</span></span>

    ![NSGs and routes][7]

## <a name="service-endpoints"></a><span data-ttu-id="fb0b5-333">Service Endpoints</span><span class="sxs-lookup"><span data-stu-id="fb0b5-333">Service Endpoints</span></span> ##

<span data-ttu-id="fb0b5-334">Service Endpoints enable you to restrict access to multi-tenant services to a set of Azure virtual networks and subnets.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-334">Service Endpoints enable you to restrict access to multi-tenant services to a set of Azure virtual networks and subnets.</span></span> <span data-ttu-id="fb0b5-335">You can read more about Service Endpoints in the [Virtual Network Service Endpoints][serviceendpoints] documentation.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-335">You can read more about Service Endpoints in the [Virtual Network Service Endpoints][serviceendpoints] documentation.</span></span> 

   > [!NOTE]
   > <span data-ttu-id="fb0b5-336">Service endpoints with SQL does not work with ASE in the US Government regions.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-336">Service endpoints with SQL does not work with ASE in the US Government regions.</span></span> <span data-ttu-id="fb0b5-337">This information is only valid in the Azure public regions.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-337">This information is only valid in the Azure public regions.</span></span>

<span data-ttu-id="fb0b5-338">When you enable Service Endpoints on a resource, there are routes created with higher priority than all other routes.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-338">When you enable Service Endpoints on a resource, there are routes created with higher priority than all other routes.</span></span> <span data-ttu-id="fb0b5-339">If you use Service Endpoints with a forced tunneled ASE, the Azure SQL and Azure Storage management traffic isn't forced tunneled.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-339">If you use Service Endpoints with a forced tunneled ASE, the Azure SQL and Azure Storage management traffic isn't forced tunneled.</span></span> 

<span data-ttu-id="fb0b5-340">When Service Endpoints is enabled on a subnet with an Azure SQL instance, all Azure SQL instances connected to from that subnet must have Service Endpoints enabled.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-340">When Service Endpoints is enabled on a subnet with an Azure SQL instance, all Azure SQL instances connected to from that subnet must have Service Endpoints enabled.</span></span> <span data-ttu-id="fb0b5-341">if you want to access multiple Azure SQL instances from the same subnet, you can't enable Service Endpoints on one Azure SQL instance and not on another.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-341">if you want to access multiple Azure SQL instances from the same subnet, you can't enable Service Endpoints on one Azure SQL instance and not on another.</span></span> <span data-ttu-id="fb0b5-342">Azure Storage does not behave the same as Azure SQL.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-342">Azure Storage does not behave the same as Azure SQL.</span></span> <span data-ttu-id="fb0b5-343">When you enable Service Endpoints with Azure Storage, you lock access to that resource from your subnet but can still access other Azure Storage accounts even if they do not have Service Endpoints enabled.</span><span class="sxs-lookup"><span data-stu-id="fb0b5-343">When you enable Service Endpoints with Azure Storage, you lock access to that resource from your subnet but can still access other Azure Storage accounts even if they do not have Service Endpoints enabled.</span></span>  

![Service Endpoints][8]

<!--Image references-->
[1]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow.png
[2]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow2.png
[3]: ./media/network_considerations_with_an_app_service_environment/networkase-ipaddresses.png
[4]: ./media/network_considerations_with_an_app_service_environment/networkase-inboundnsg.png
[5]: ./media/network_considerations_with_an_app_service_environment/networkase-outboundnsg.png
[6]: ./media/network_considerations_with_an_app_service_environment/networkase-udr.png
[7]: ./media/network_considerations_with_an_app_service_environment/networkase-subnet.png
[8]: ./media/network_considerations_with_an_app_service_environment/serviceendpoint.png

<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/security-overview.md
[ConfigureASEv1]: app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: app-service-app-service-environment-intro.md
[mobileapps]: ../../app-service-mobile/app-service-mobile-value-prop.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: http://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/resource-group-overview.md
[ConfigureSSL]: ../web-sites-purchase-ssl-web-site.md
[Kudu]: http://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[ASEWAF]: app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
[ASEManagement]: ./management-addresses.md
[serviceendpoints]: ../../virtual-network/virtual-network-service-endpoints-overview.md
[forcedtunnel]: ./forced-tunnel-support.md
[serviceendpoints]: ../../virtual-network/virtual-network-service-endpoints-overview.md
