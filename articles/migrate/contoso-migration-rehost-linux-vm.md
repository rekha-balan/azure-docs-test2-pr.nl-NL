---
title: Rehost-Migrate and rehost an on-premises Linux app to Azure VMs | Microsoft Docs
description: Learn how Contoso rehost an on-premises Linux app by migrating to Azure VMs.
services: site-recovery
author: rayne-wiselman
ms.service: site-recovery
ms.topic: conceptual
ms.date: 09/05/2018
ms.author: raynew
ms.openlocfilehash: 4378351d6da6943485b7f382d96094543bfffa23
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44870295"
---
# <a name="contoso-migration-rehost-an-on-premises-linux-app-to-azure-vms"></a><span data-ttu-id="363fc-103">Contoso migration: Rehost an on-premises Linux app to Azure VMs</span><span class="sxs-lookup"><span data-stu-id="363fc-103">Contoso migration: Rehost an on-premises Linux app to Azure VMs</span></span>

<span data-ttu-id="363fc-104">This article shows how Contoso is rehosting an on-premises Linux-based service desk app (**osTicket**), to Azure IaaS VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-104">This article shows how Contoso is rehosting an on-premises Linux-based service desk app (**osTicket**), to Azure IaaS VMs.</span></span>

<span data-ttu-id="363fc-105">This document is one in a series of articles that document how the fictitious company Contoso migrates its on-premises resources to the Microsoft Azure cloud.</span><span class="sxs-lookup"><span data-stu-id="363fc-105">This document is one in a series of articles that document how the fictitious company Contoso migrates its on-premises resources to the Microsoft Azure cloud.</span></span> <span data-ttu-id="363fc-106">The series includes background information, and a set of scenarios that illustrate how to set up a migration infrastructure, and run different types of migrations.</span><span class="sxs-lookup"><span data-stu-id="363fc-106">The series includes background information, and a set of scenarios that illustrate how to set up a migration infrastructure, and run different types of migrations.</span></span> <span data-ttu-id="363fc-107">Scenarios grow in complexity.</span><span class="sxs-lookup"><span data-stu-id="363fc-107">Scenarios grow in complexity.</span></span> <span data-ttu-id="363fc-108">We'll add additional articles over time.</span><span class="sxs-lookup"><span data-stu-id="363fc-108">We'll add additional articles over time.</span></span>

<span data-ttu-id="363fc-109">**Article**</span><span class="sxs-lookup"><span data-stu-id="363fc-109">**Article**</span></span> | <span data-ttu-id="363fc-110">**Details**</span><span class="sxs-lookup"><span data-stu-id="363fc-110">**Details**</span></span> | <span data-ttu-id="363fc-111">**Status**</span><span class="sxs-lookup"><span data-stu-id="363fc-111">**Status**</span></span>
--- | --- | ---
[<span data-ttu-id="363fc-112">Article 1: Overview</span><span class="sxs-lookup"><span data-stu-id="363fc-112">Article 1: Overview</span></span>](contoso-migration-overview.md) | <span data-ttu-id="363fc-113">Overview of the article series, Contoso's migration strategy, and the sample apps that are used in the series.</span><span class="sxs-lookup"><span data-stu-id="363fc-113">Overview of the article series, Contoso's migration strategy, and the sample apps that are used in the series.</span></span> | <span data-ttu-id="363fc-114">Available</span><span class="sxs-lookup"><span data-stu-id="363fc-114">Available</span></span>
[<span data-ttu-id="363fc-115">Article 2: Deploy Azure infrastructure</span><span class="sxs-lookup"><span data-stu-id="363fc-115">Article 2: Deploy Azure infrastructure</span></span>](contoso-migration-infrastructure.md) | <span data-ttu-id="363fc-116">Contoso prepares its on-premises infrastructure and its Azure infrastructure for migration.</span><span class="sxs-lookup"><span data-stu-id="363fc-116">Contoso prepares its on-premises infrastructure and its Azure infrastructure for migration.</span></span> <span data-ttu-id="363fc-117">The same infrastructure is used for all migration articles in the series.</span><span class="sxs-lookup"><span data-stu-id="363fc-117">The same infrastructure is used for all migration articles in the series.</span></span> | <span data-ttu-id="363fc-118">Available</span><span class="sxs-lookup"><span data-stu-id="363fc-118">Available</span></span>
[<span data-ttu-id="363fc-119">Article 3: Assess on-premises resources for migration to Azure</span><span class="sxs-lookup"><span data-stu-id="363fc-119">Article 3: Assess on-premises resources for migration to Azure</span></span>](contoso-migration-assessment.md)  | <span data-ttu-id="363fc-120">Contoso runs an assessment of its on-premises SmartHotel360 app running on VMware.</span><span class="sxs-lookup"><span data-stu-id="363fc-120">Contoso runs an assessment of its on-premises SmartHotel360 app running on VMware.</span></span> <span data-ttu-id="363fc-121">Contoso assesses app VMs using the Azure Migrate service, and the app SQL Server database using Data Migration Assistant.</span><span class="sxs-lookup"><span data-stu-id="363fc-121">Contoso assesses app VMs using the Azure Migrate service, and the app SQL Server database using Data Migration Assistant.</span></span> | <span data-ttu-id="363fc-122">Available</span><span class="sxs-lookup"><span data-stu-id="363fc-122">Available</span></span>
[<span data-ttu-id="363fc-123">Article 4: Rehost an app on an Azure VM and SQL Database Managed Instance</span><span class="sxs-lookup"><span data-stu-id="363fc-123">Article 4: Rehost an app on an Azure VM and SQL Database Managed Instance</span></span>](contoso-migration-rehost-vm-sql-managed-instance.md) | <span data-ttu-id="363fc-124">Contoso runs a lift-and-shift migration to Azure for its on-premises SmartHotel360 app.</span><span class="sxs-lookup"><span data-stu-id="363fc-124">Contoso runs a lift-and-shift migration to Azure for its on-premises SmartHotel360 app.</span></span> <span data-ttu-id="363fc-125">Contoso migrates the app front-end VM using [Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/site-recovery-overview).</span><span class="sxs-lookup"><span data-stu-id="363fc-125">Contoso migrates the app front-end VM using [Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/site-recovery-overview).</span></span> <span data-ttu-id="363fc-126">Contoso migrates the app database to an Azure SQL Database Managed Instance using the [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview).</span><span class="sxs-lookup"><span data-stu-id="363fc-126">Contoso migrates the app database to an Azure SQL Database Managed Instance using the [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview).</span></span> | <span data-ttu-id="363fc-127">Available</span><span class="sxs-lookup"><span data-stu-id="363fc-127">Available</span></span>   
[<span data-ttu-id="363fc-128">Article 5: Rehost an app on Azure VMs</span><span class="sxs-lookup"><span data-stu-id="363fc-128">Article 5: Rehost an app on Azure VMs</span></span>](contoso-migration-rehost-vm.md) | <span data-ttu-id="363fc-129">Contoso migrates its SmartHotel360 app VMs to Azure VMs using the Site Recovery service.</span><span class="sxs-lookup"><span data-stu-id="363fc-129">Contoso migrates its SmartHotel360 app VMs to Azure VMs using the Site Recovery service.</span></span> | <span data-ttu-id="363fc-130">Available</span><span class="sxs-lookup"><span data-stu-id="363fc-130">Available</span></span>
[<span data-ttu-id="363fc-131">Article 6: Rehost an app on Azure VMs and in a  SQL Server AlwaysOn availability group</span><span class="sxs-lookup"><span data-stu-id="363fc-131">Article 6: Rehost an app on Azure VMs and in a  SQL Server AlwaysOn availability group</span></span>](contoso-migration-rehost-vm-sql-ag.md) | <span data-ttu-id="363fc-132">Contoso migrates the SmartHotel360 app.</span><span class="sxs-lookup"><span data-stu-id="363fc-132">Contoso migrates the SmartHotel360 app.</span></span> <span data-ttu-id="363fc-133">Contoso uses Site Recovery to migrate the app VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-133">Contoso uses Site Recovery to migrate the app VMs.</span></span> <span data-ttu-id="363fc-134">It uses the Database Migration Service to migrate the app database to a SQL Server cluster that's protected by an AlwaysOn availability group.</span><span class="sxs-lookup"><span data-stu-id="363fc-134">It uses the Database Migration Service to migrate the app database to a SQL Server cluster that's protected by an AlwaysOn availability group.</span></span> | <span data-ttu-id="363fc-135">Available</span><span class="sxs-lookup"><span data-stu-id="363fc-135">Available</span></span> 
<span data-ttu-id="363fc-136">Article 7: Rehost a Linux app on Azure VMs</span><span class="sxs-lookup"><span data-stu-id="363fc-136">Article 7: Rehost a Linux app on Azure VMs</span></span> | <span data-ttu-id="363fc-137">Contoso completes a lift-and-shift migration of the Linux osTicket app to Azure VMs, using Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="363fc-137">Contoso completes a lift-and-shift migration of the Linux osTicket app to Azure VMs, using Azure Site Recovery</span></span> | <span data-ttu-id="363fc-138">This article</span><span class="sxs-lookup"><span data-stu-id="363fc-138">This article</span></span>
[<span data-ttu-id="363fc-139">Article 8: Rehost a Linux app on Azure VMs and Azure MySQL</span><span class="sxs-lookup"><span data-stu-id="363fc-139">Article 8: Rehost a Linux app on Azure VMs and Azure MySQL</span></span>](contoso-migration-rehost-linux-vm-mysql.md) | <span data-ttu-id="363fc-140">Contoso migrates the Linux osTicket app to Azure VMs using Azure Site Recovery, and migrates the app database to an Azure MySQL Server instance using MySQL Workbench.</span><span class="sxs-lookup"><span data-stu-id="363fc-140">Contoso migrates the Linux osTicket app to Azure VMs using Azure Site Recovery, and migrates the app database to an Azure MySQL Server instance using MySQL Workbench.</span></span> | <span data-ttu-id="363fc-141">Available</span><span class="sxs-lookup"><span data-stu-id="363fc-141">Available</span></span>
[<span data-ttu-id="363fc-142">Article 9: Refactor an app on Azure Web Apps and Azure SQL database</span><span class="sxs-lookup"><span data-stu-id="363fc-142">Article 9: Refactor an app on Azure Web Apps and Azure SQL database</span></span>](contoso-migration-refactor-web-app-sql.md) | <span data-ttu-id="363fc-143">Contoso migrates the SmartHotel360 app to an Azure Web App, and migrates the app database to an Azure SQL Server instance with Database Migration Assistant</span><span class="sxs-lookup"><span data-stu-id="363fc-143">Contoso migrates the SmartHotel360 app to an Azure Web App, and migrates the app database to an Azure SQL Server instance with Database Migration Assistant</span></span> | <span data-ttu-id="363fc-144">Available</span><span class="sxs-lookup"><span data-stu-id="363fc-144">Available</span></span>
[<span data-ttu-id="363fc-145">Article 10: Refactor a Linux app on Azure Web Apps and Azure MySQL</span><span class="sxs-lookup"><span data-stu-id="363fc-145">Article 10: Refactor a Linux app on Azure Web Apps and Azure MySQL</span></span>](contoso-migration-refactor-linux-app-service-mysql.md) | <span data-ttu-id="363fc-146">Contoso migrates its Linux osTicket app to an Azure web app on multiple Azure regions using Azure Traffic Manager, integrated with GitHub for continuous delivery.</span><span class="sxs-lookup"><span data-stu-id="363fc-146">Contoso migrates its Linux osTicket app to an Azure web app on multiple Azure regions using Azure Traffic Manager, integrated with GitHub for continuous delivery.</span></span> <span data-ttu-id="363fc-147">Contoso migrates the app database to an Azure Database for MySQL instance.</span><span class="sxs-lookup"><span data-stu-id="363fc-147">Contoso migrates the app database to an Azure Database for MySQL instance.</span></span> | <span data-ttu-id="363fc-148">Available</span><span class="sxs-lookup"><span data-stu-id="363fc-148">Available</span></span> 
[<span data-ttu-id="363fc-149">Article 11: Refactor TFS on Azure DevOps Services</span><span class="sxs-lookup"><span data-stu-id="363fc-149">Article 11: Refactor TFS on Azure DevOps Services</span></span>](contoso-migration-tfs-vsts.md) | <span data-ttu-id="363fc-150">Contoso migrates its on-premises Team Foundation Server deployment to Azure DevOps Services in Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-150">Contoso migrates its on-premises Team Foundation Server deployment to Azure DevOps Services in Azure.</span></span> | <span data-ttu-id="363fc-151">Available</span><span class="sxs-lookup"><span data-stu-id="363fc-151">Available</span></span>
[<span data-ttu-id="363fc-152">Article 12: Rearchitect an app on Azure containers and Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="363fc-152">Article 12: Rearchitect an app on Azure containers and Azure SQL Database</span></span>](contoso-migration-rearchitect-container-sql.md) | <span data-ttu-id="363fc-153">Contoso migrates its SmartHotel app to Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-153">Contoso migrates its SmartHotel app to Azure.</span></span> <span data-ttu-id="363fc-154">Then, it rearchitects the app web tier as a Windows container running in Azure Service Fabric, and the database with Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="363fc-154">Then, it rearchitects the app web tier as a Windows container running in Azure Service Fabric, and the database with Azure SQL Database.</span></span> | <span data-ttu-id="363fc-155">Available</span><span class="sxs-lookup"><span data-stu-id="363fc-155">Available</span></span>
[<span data-ttu-id="363fc-156">Article 13: Rebuild an app in Azure</span><span class="sxs-lookup"><span data-stu-id="363fc-156">Article 13: Rebuild an app in Azure</span></span>](contoso-migration-rebuild.md) | <span data-ttu-id="363fc-157">Contoso rebuilds its SmartHotel app by using a range of Azure capabilities and services, including Azure App Service, Azure Kubernetes Service (AKS), Azure Functions, Azure Cognitive Services, and Azure Cosmos DB..</span><span class="sxs-lookup"><span data-stu-id="363fc-157">Contoso rebuilds its SmartHotel app by using a range of Azure capabilities and services, including Azure App Service, Azure Kubernetes Service (AKS), Azure Functions, Azure Cognitive Services, and Azure Cosmos DB..</span></span> | <span data-ttu-id="363fc-158">Available</span><span class="sxs-lookup"><span data-stu-id="363fc-158">Available</span></span>



<span data-ttu-id="363fc-159">In this article, Contoso will migrate the two-tier **osTicket** app, running on Linux Apache MySQL PHP (LAMP) to Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-159">In this article, Contoso will migrate the two-tier **osTicket** app, running on Linux Apache MySQL PHP (LAMP) to Azure.</span></span> <span data-ttu-id="363fc-160">The app VMs will be migrated using the Azure Site Recovery service.</span><span class="sxs-lookup"><span data-stu-id="363fc-160">The app VMs will be migrated using the Azure Site Recovery service.</span></span> <span data-ttu-id="363fc-161">If you'd like to use this open-source app, you can download it from [GitHub](https://github.com/osTicket/osTicket).</span><span class="sxs-lookup"><span data-stu-id="363fc-161">If you'd like to use this open-source app, you can download it from [GitHub](https://github.com/osTicket/osTicket).</span></span>

## <a name="business-drivers"></a><span data-ttu-id="363fc-162">Business drivers</span><span class="sxs-lookup"><span data-stu-id="363fc-162">Business drivers</span></span>

<span data-ttu-id="363fc-163">The IT Leadership team has worked closely with business partners to understand what they want to achieve with this migration:</span><span class="sxs-lookup"><span data-stu-id="363fc-163">The IT Leadership team has worked closely with business partners to understand what they want to achieve with this migration:</span></span>

- <span data-ttu-id="363fc-164">**Address business growth**: Contoso is growing, and as a result there's pressure on the on-premises systems and infrastructure.</span><span class="sxs-lookup"><span data-stu-id="363fc-164">**Address business growth**: Contoso is growing, and as a result there's pressure on the on-premises systems and infrastructure.</span></span>
- <span data-ttu-id="363fc-165">**Limit risk**: The service desk app is critical for the Contoso business.</span><span class="sxs-lookup"><span data-stu-id="363fc-165">**Limit risk**: The service desk app is critical for the Contoso business.</span></span> <span data-ttu-id="363fc-166">Contoso wants to move it to Azure with zero risk.</span><span class="sxs-lookup"><span data-stu-id="363fc-166">Contoso wants to move it to Azure with zero risk.</span></span>
- <span data-ttu-id="363fc-167">**Extend**:  Contoso don't want to change the app right now.</span><span class="sxs-lookup"><span data-stu-id="363fc-167">**Extend**:  Contoso don't want to change the app right now.</span></span> <span data-ttu-id="363fc-168">It simply wants to ensure that the app is stable.</span><span class="sxs-lookup"><span data-stu-id="363fc-168">It simply wants to ensure that the app is stable.</span></span>


## <a name="migration-goals"></a><span data-ttu-id="363fc-169">Migration goals</span><span class="sxs-lookup"><span data-stu-id="363fc-169">Migration goals</span></span>

<span data-ttu-id="363fc-170">The Contoso cloud team has pinned down goals for this migration, to determine the best migration method:</span><span class="sxs-lookup"><span data-stu-id="363fc-170">The Contoso cloud team has pinned down goals for this migration, to determine the best migration method:</span></span>

- <span data-ttu-id="363fc-171">After migration, the app in Azure should have the same performance capabilities as it does today in their on-premises VMWare environment.</span><span class="sxs-lookup"><span data-stu-id="363fc-171">After migration, the app in Azure should have the same performance capabilities as it does today in their on-premises VMWare environment.</span></span>  <span data-ttu-id="363fc-172">The app will remain as critical in the cloud as it is on-premises.</span><span class="sxs-lookup"><span data-stu-id="363fc-172">The app will remain as critical in the cloud as it is on-premises.</span></span> 
- <span data-ttu-id="363fc-173">Contoso doesn’t want to invest in this app.</span><span class="sxs-lookup"><span data-stu-id="363fc-173">Contoso doesn’t want to invest in this app.</span></span>  <span data-ttu-id="363fc-174">It is important to the business, but in its current form Contoso simply wants to move it safely to the cloud.</span><span class="sxs-lookup"><span data-stu-id="363fc-174">It is important to the business, but in its current form Contoso simply wants to move it safely to the cloud.</span></span>
- <span data-ttu-id="363fc-175">Contoso doesn't want to change the ops model for this app.</span><span class="sxs-lookup"><span data-stu-id="363fc-175">Contoso doesn't want to change the ops model for this app.</span></span> <span data-ttu-id="363fc-176">It wants to interact with the app in the cloud in the same way that they do now.</span><span class="sxs-lookup"><span data-stu-id="363fc-176">It wants to interact with the app in the cloud in the same way that they do now.</span></span>
- <span data-ttu-id="363fc-177">Contoso doesn't want to change app functionality.</span><span class="sxs-lookup"><span data-stu-id="363fc-177">Contoso doesn't want to change app functionality.</span></span> <span data-ttu-id="363fc-178">Only the app location will change.</span><span class="sxs-lookup"><span data-stu-id="363fc-178">Only the app location will change.</span></span>
- <span data-ttu-id="363fc-179">Having completed a couple of Windows app migrations, Contoso wants to learn how to use a Linux-based infrastructure in Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-179">Having completed a couple of Windows app migrations, Contoso wants to learn how to use a Linux-based infrastructure in Azure.</span></span>


## <a name="solution-design"></a><span data-ttu-id="363fc-180">Solution design</span><span class="sxs-lookup"><span data-stu-id="363fc-180">Solution design</span></span>

<span data-ttu-id="363fc-181">After pinning down goals and requirements, Contoso designs and review a deployment solution, and identifies the migration process, including the Azure services that Contoso will use for the migration.</span><span class="sxs-lookup"><span data-stu-id="363fc-181">After pinning down goals and requirements, Contoso designs and review a deployment solution, and identifies the migration process, including the Azure services that Contoso will use for the migration.</span></span>

### <a name="current-app"></a><span data-ttu-id="363fc-182">Current app</span><span class="sxs-lookup"><span data-stu-id="363fc-182">Current app</span></span>

- <span data-ttu-id="363fc-183">The OSTicket app is tiered across two VMs (**OSTICKETWEB** and **OSTICKETMYSQL**).</span><span class="sxs-lookup"><span data-stu-id="363fc-183">The OSTicket app is tiered across two VMs (**OSTICKETWEB** and **OSTICKETMYSQL**).</span></span>
- <span data-ttu-id="363fc-184">The VMs are located on VMware ESXi host **contosohost1.contoso.com** (version 6.5).</span><span class="sxs-lookup"><span data-stu-id="363fc-184">The VMs are located on VMware ESXi host **contosohost1.contoso.com** (version 6.5).</span></span>
- <span data-ttu-id="363fc-185">The VMware environment is managed by vCenter Server 6.5 (**vcenter.contoso.com**), running on a VM.</span><span class="sxs-lookup"><span data-stu-id="363fc-185">The VMware environment is managed by vCenter Server 6.5 (**vcenter.contoso.com**), running on a VM.</span></span>
- <span data-ttu-id="363fc-186">Contoso has an on-premises datacenter (**contoso-datacenter**), with an on-premises domain controller (**contosodc1**)</span><span class="sxs-lookup"><span data-stu-id="363fc-186">Contoso has an on-premises datacenter (**contoso-datacenter**), with an on-premises domain controller (**contosodc1**)</span></span>

### <a name="proposed-architecture"></a><span data-ttu-id="363fc-187">Proposed architecture</span><span class="sxs-lookup"><span data-stu-id="363fc-187">Proposed architecture</span></span>

- <span data-ttu-id="363fc-188">Since the app is a production workload, the VMs in Azure will reside in the production resource group **ContosoRG**.</span><span class="sxs-lookup"><span data-stu-id="363fc-188">Since the app is a production workload, the VMs in Azure will reside in the production resource group **ContosoRG**.</span></span>
- <span data-ttu-id="363fc-189">The VMs will be migrated to the primary region (East US 2) and placed in the production network (VNET-PROD-EUS2):</span><span class="sxs-lookup"><span data-stu-id="363fc-189">The VMs will be migrated to the primary region (East US 2) and placed in the production network (VNET-PROD-EUS2):</span></span>
    - <span data-ttu-id="363fc-190">The web VM will reside in the frontend subnet (PROD-FE-EUS2).</span><span class="sxs-lookup"><span data-stu-id="363fc-190">The web VM will reside in the frontend subnet (PROD-FE-EUS2).</span></span>
    - <span data-ttu-id="363fc-191">The database VM will reside in the database subnet (PROD-DB-EUS2).</span><span class="sxs-lookup"><span data-stu-id="363fc-191">The database VM will reside in the database subnet (PROD-DB-EUS2).</span></span>
- <span data-ttu-id="363fc-192">The on-premises VMs in the Contoso datacenter will be decommissioned after the migration is done.</span><span class="sxs-lookup"><span data-stu-id="363fc-192">The on-premises VMs in the Contoso datacenter will be decommissioned after the migration is done.</span></span>

![Scenario architecture](./media/contoso-migration-rehost-linux-vm/architecture.png) 

### <a name="solution-review"></a><span data-ttu-id="363fc-194">Solution review</span><span class="sxs-lookup"><span data-stu-id="363fc-194">Solution review</span></span>

<span data-ttu-id="363fc-195">Contoso evaluates the proposed design by putting together a pros and cons list.</span><span class="sxs-lookup"><span data-stu-id="363fc-195">Contoso evaluates the proposed design by putting together a pros and cons list.</span></span>

<span data-ttu-id="363fc-196">**Consideration**</span><span class="sxs-lookup"><span data-stu-id="363fc-196">**Consideration**</span></span> | <span data-ttu-id="363fc-197">**Details**</span><span class="sxs-lookup"><span data-stu-id="363fc-197">**Details**</span></span>
--- | ---
<span data-ttu-id="363fc-198">**Pros**</span><span class="sxs-lookup"><span data-stu-id="363fc-198">**Pros**</span></span> | <span data-ttu-id="363fc-199">Both the app VMs will be moved to Azure without changes, making the migration simple.</span><span class="sxs-lookup"><span data-stu-id="363fc-199">Both the app VMs will be moved to Azure without changes, making the migration simple.</span></span><br/><br/> <span data-ttu-id="363fc-200">Since Contoso is using lift-and-shift for both app VMs, no special configuration or migration tools are needed for the app database.</span><span class="sxs-lookup"><span data-stu-id="363fc-200">Since Contoso is using lift-and-shift for both app VMs, no special configuration or migration tools are needed for the app database.</span></span><br/><br/> <span data-ttu-id="363fc-201">Contoso will retain full control of the app VMs in Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-201">Contoso will retain full control of the app VMs in Azure.</span></span> </br><span data-ttu-id="363fc-202">/br> The app VMs are running Ubuntu 16.04-TLS, which is a endorsed Linux distribution.</span><span class="sxs-lookup"><span data-stu-id="363fc-202">/br> The app VMs are running Ubuntu 16.04-TLS, which is a endorsed Linux distribution.</span></span> <span data-ttu-id="363fc-203">[Learn more](https://docs.microsoft.com/azure/virtual-machines/linux/endorsed-distros).</span><span class="sxs-lookup"><span data-stu-id="363fc-203">[Learn more](https://docs.microsoft.com/azure/virtual-machines/linux/endorsed-distros).</span></span>
<span data-ttu-id="363fc-204">**Cons**</span><span class="sxs-lookup"><span data-stu-id="363fc-204">**Cons**</span></span> | <span data-ttu-id="363fc-205">The web and data tier of the app will remain a single point of failover.</span><span class="sxs-lookup"><span data-stu-id="363fc-205">The web and data tier of the app will remain a single point of failover.</span></span> <br/><br/> <span data-ttu-id="363fc-206">Contoso will need to continue supporting the app as Azure VMs rather than moving to a managed service such as Azure App Service and Azure Database for MySQL.</span><span class="sxs-lookup"><span data-stu-id="363fc-206">Contoso will need to continue supporting the app as Azure VMs rather than moving to a managed service such as Azure App Service and Azure Database for MySQL.</span></span><br/><br/> <span data-ttu-id="363fc-207">Contoso is aware that by keeping things simple with a lift-and-shift VM migration, they're not taking full advantage of the features provided by [Azure Database for MySQL](https://docs.microsoft.com/azure/mysql/overview) (built-in high availability, predictable performance, simple scaling, automatic backups and built-in security).</span><span class="sxs-lookup"><span data-stu-id="363fc-207">Contoso is aware that by keeping things simple with a lift-and-shift VM migration, they're not taking full advantage of the features provided by [Azure Database for MySQL](https://docs.microsoft.com/azure/mysql/overview) (built-in high availability, predictable performance, simple scaling, automatic backups and built-in security).</span></span>

### <a name="migration-process"></a><span data-ttu-id="363fc-208">Migration process</span><span class="sxs-lookup"><span data-stu-id="363fc-208">Migration process</span></span>

<span data-ttu-id="363fc-209">Contoso will migrate as follows:</span><span class="sxs-lookup"><span data-stu-id="363fc-209">Contoso will migrate as follows:</span></span>

1. <span data-ttu-id="363fc-210">As a first step, Contoso sets up the Azure and on-premises infrastructure needed to deploy Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="363fc-210">As a first step, Contoso sets up the Azure and on-premises infrastructure needed to deploy Site Recovery.</span></span>
2. <span data-ttu-id="363fc-211">After preparing Azure and on-premises components, Contoso sets up and enables replication for the VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-211">After preparing Azure and on-premises components, Contoso sets up and enables replication for the VMs.</span></span>
3. <span data-ttu-id="363fc-212">After replication is working, Contoso migrates the VMs by failing them over to Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-212">After replication is working, Contoso migrates the VMs by failing them over to Azure.</span></span>

![Migration process](./media/contoso-migration-rehost-linux-vm/migration-process.png)

### <a name="azure-services"></a><span data-ttu-id="363fc-214">Azure services</span><span class="sxs-lookup"><span data-stu-id="363fc-214">Azure services</span></span>

<span data-ttu-id="363fc-215">**Service**</span><span class="sxs-lookup"><span data-stu-id="363fc-215">**Service**</span></span> | <span data-ttu-id="363fc-216">**Description**</span><span class="sxs-lookup"><span data-stu-id="363fc-216">**Description**</span></span> | <span data-ttu-id="363fc-217">**Cost**</span><span class="sxs-lookup"><span data-stu-id="363fc-217">**Cost**</span></span>
--- | --- | ---
[<span data-ttu-id="363fc-218">Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="363fc-218">Azure Site Recovery</span></span>](https://docs.microsoft.com/azure/site-recovery/) | <span data-ttu-id="363fc-219">The service orchestrates and manages migration and disaster recovery for Azure VMs, and on-premises VMs and physical servers.</span><span class="sxs-lookup"><span data-stu-id="363fc-219">The service orchestrates and manages migration and disaster recovery for Azure VMs, and on-premises VMs and physical servers.</span></span>  | <span data-ttu-id="363fc-220">During replication to Azure, Azure Storage charges are incurred.</span><span class="sxs-lookup"><span data-stu-id="363fc-220">During replication to Azure, Azure Storage charges are incurred.</span></span>  <span data-ttu-id="363fc-221">Azure VMs are created, and incur charges, when failover occurs.</span><span class="sxs-lookup"><span data-stu-id="363fc-221">Azure VMs are created, and incur charges, when failover occurs.</span></span> <span data-ttu-id="363fc-222">[Learn more](https://azure.microsoft.com/pricing/details/site-recovery/) about charges and pricing.</span><span class="sxs-lookup"><span data-stu-id="363fc-222">[Learn more](https://azure.microsoft.com/pricing/details/site-recovery/) about charges and pricing.</span></span>

 
## <a name="prerequisites"></a><span data-ttu-id="363fc-223">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="363fc-223">Prerequisites</span></span>

<span data-ttu-id="363fc-224">Here's what Contoso needs for this scenario.</span><span class="sxs-lookup"><span data-stu-id="363fc-224">Here's what Contoso needs for this scenario.</span></span>

<span data-ttu-id="363fc-225">**Requirements**</span><span class="sxs-lookup"><span data-stu-id="363fc-225">**Requirements**</span></span> | <span data-ttu-id="363fc-226">**Details**</span><span class="sxs-lookup"><span data-stu-id="363fc-226">**Details**</span></span>
--- | ---
<span data-ttu-id="363fc-227">**Azure subscription**</span><span class="sxs-lookup"><span data-stu-id="363fc-227">**Azure subscription**</span></span> | <span data-ttu-id="363fc-228">Contoso created subscriptions in an early article in this series.</span><span class="sxs-lookup"><span data-stu-id="363fc-228">Contoso created subscriptions in an early article in this series.</span></span> <span data-ttu-id="363fc-229">If you don't have an Azure subscription, create a [free account](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="363fc-229">If you don't have an Azure subscription, create a [free account](https://azure.microsoft.com/pricing/free-trial/).</span></span><br/><br/> <span data-ttu-id="363fc-230">If you create a free account, you're the administrator of your subscription and can perform all actions.</span><span class="sxs-lookup"><span data-stu-id="363fc-230">If you create a free account, you're the administrator of your subscription and can perform all actions.</span></span><br/><br/> <span data-ttu-id="363fc-231">If you use an existing subscription and you're not the administrator, you need to work with the admin to assign you Owner or Contributor permissions.</span><span class="sxs-lookup"><span data-stu-id="363fc-231">If you use an existing subscription and you're not the administrator, you need to work with the admin to assign you Owner or Contributor permissions.</span></span><br/><br/> <span data-ttu-id="363fc-232">If you need more granular permissions, review [this article](../site-recovery/site-recovery-role-based-linked-access-control.md).</span><span class="sxs-lookup"><span data-stu-id="363fc-232">If you need more granular permissions, review [this article](../site-recovery/site-recovery-role-based-linked-access-control.md).</span></span> 
<span data-ttu-id="363fc-233">**Azure infrastructure**</span><span class="sxs-lookup"><span data-stu-id="363fc-233">**Azure infrastructure**</span></span> | <span data-ttu-id="363fc-234">Contoso set up their Azure infrastructure as described in [Azure infrastructure for migration](contoso-migration-infrastructure.md).</span><span class="sxs-lookup"><span data-stu-id="363fc-234">Contoso set up their Azure infrastructure as described in [Azure infrastructure for migration](contoso-migration-infrastructure.md).</span></span><br/><br/> <span data-ttu-id="363fc-235">Learn more about specific [network](https://docs.microsoft.com/azure/site-recovery/vmware-physical-azure-support-matrix#network) and [storage](https://docs.microsoft.com/azure/site-recovery/vmware-physical-azure-support-matrix#storage) requirements for Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="363fc-235">Learn more about specific [network](https://docs.microsoft.com/azure/site-recovery/vmware-physical-azure-support-matrix#network) and [storage](https://docs.microsoft.com/azure/site-recovery/vmware-physical-azure-support-matrix#storage) requirements for Site Recovery.</span></span>
<span data-ttu-id="363fc-236">**On-premises servers**</span><span class="sxs-lookup"><span data-stu-id="363fc-236">**On-premises servers**</span></span> | <span data-ttu-id="363fc-237">The on-premises vCenter server should be running version 5.5, 6.0, or 6.5</span><span class="sxs-lookup"><span data-stu-id="363fc-237">The on-premises vCenter server should be running version 5.5, 6.0, or 6.5</span></span><br/><br/> <span data-ttu-id="363fc-238">An ESXi host running version 5.5, 6.0 or 6.5</span><span class="sxs-lookup"><span data-stu-id="363fc-238">An ESXi host running version 5.5, 6.0 or 6.5</span></span><br/><br/> <span data-ttu-id="363fc-239">One or more VMware VMs running on the ESXi host.</span><span class="sxs-lookup"><span data-stu-id="363fc-239">One or more VMware VMs running on the ESXi host.</span></span>
<span data-ttu-id="363fc-240">**On-premises VMs**</span><span class="sxs-lookup"><span data-stu-id="363fc-240">**On-premises VMs**</span></span> | <span data-ttu-id="363fc-241">[Review Linux machines](https://docs.microsoft.com//azure/site-recovery/vmware-physical-azure-support-matrix#replicated-machines) that are supported for migration with Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="363fc-241">[Review Linux machines](https://docs.microsoft.com//azure/site-recovery/vmware-physical-azure-support-matrix#replicated-machines) that are supported for migration with Site Recovery.</span></span><br/><br/> <span data-ttu-id="363fc-242">Verify supported [Linux file and storage systems](https://docs.microsoft.com/azure/site-recovery/vmware-physical-azure-support-matrix#linux-file-systemsguest-storage).</span><span class="sxs-lookup"><span data-stu-id="363fc-242">Verify supported [Linux file and storage systems](https://docs.microsoft.com/azure/site-recovery/vmware-physical-azure-support-matrix#linux-file-systemsguest-storage).</span></span><br/><br/> <span data-ttu-id="363fc-243">VMs must meet [Azure requirements](https://docs.microsoft.com/azure/site-recovery/vmware-physical-azure-support-matrix#azure-vm-requirements).</span><span class="sxs-lookup"><span data-stu-id="363fc-243">VMs must meet [Azure requirements](https://docs.microsoft.com/azure/site-recovery/vmware-physical-azure-support-matrix#azure-vm-requirements).</span></span>


## <a name="scenario-steps"></a><span data-ttu-id="363fc-244">Scenario steps</span><span class="sxs-lookup"><span data-stu-id="363fc-244">Scenario steps</span></span>

<span data-ttu-id="363fc-245">Here's how Contoso will complete the migration:</span><span class="sxs-lookup"><span data-stu-id="363fc-245">Here's how Contoso will complete the migration:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="363fc-246">**Step 1: Prepare Azure for Site Recovery**: Contoso creates an Azure storage account to hold replicated data, and creates a Recovery Services vault.</span><span class="sxs-lookup"><span data-stu-id="363fc-246">**Step 1: Prepare Azure for Site Recovery**: Contoso creates an Azure storage account to hold replicated data, and creates a Recovery Services vault.</span></span>
> * <span data-ttu-id="363fc-247">**Step 2: Prepare on-premises VMware for Site Recovery**: Contoso prepares accounts to be used for VM discovery and agent installation, and prepares to connect to Azure VMs after failover.</span><span class="sxs-lookup"><span data-stu-id="363fc-247">**Step 2: Prepare on-premises VMware for Site Recovery**: Contoso prepares accounts to be used for VM discovery and agent installation, and prepares to connect to Azure VMs after failover.</span></span>
> * <span data-ttu-id="363fc-248">**Step 3: Replicate VMs**: Contoso sets up the source and target migration environment, creates a replication policy, and starts replicating VMs to Azure storage.</span><span class="sxs-lookup"><span data-stu-id="363fc-248">**Step 3: Replicate VMs**: Contoso sets up the source and target migration environment, creates a replication policy, and starts replicating VMs to Azure storage.</span></span>
> * <span data-ttu-id="363fc-249">**Step 4: Migrate the VMs with Site Recovery**: Contoso runs a test failover to make sure everything's working, and then runs a full failover to migrate the VMs to Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-249">**Step 4: Migrate the VMs with Site Recovery**: Contoso runs a test failover to make sure everything's working, and then runs a full failover to migrate the VMs to Azure.</span></span>


## <a name="step-1-prepare-azure-for-the-site-recovery-service"></a><span data-ttu-id="363fc-250">Step 1: Prepare Azure for the Site Recovery service</span><span class="sxs-lookup"><span data-stu-id="363fc-250">Step 1: Prepare Azure for the Site Recovery service</span></span>

<span data-ttu-id="363fc-251">Contoso needs a couple of Azure components for Site Recovery:</span><span class="sxs-lookup"><span data-stu-id="363fc-251">Contoso needs a couple of Azure components for Site Recovery:</span></span>

- <span data-ttu-id="363fc-252">A new Azure storage account to hold replicated data.</span><span class="sxs-lookup"><span data-stu-id="363fc-252">A new Azure storage account to hold replicated data.</span></span> 
- <span data-ttu-id="363fc-253">A Recovery Services vault in Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-253">A Recovery Services vault in Azure.</span></span>
- <span data-ttu-id="363fc-254">A VNet in which failed over resources are located.</span><span class="sxs-lookup"><span data-stu-id="363fc-254">A VNet in which failed over resources are located.</span></span> <span data-ttu-id="363fc-255">Contoso already created the VNet during [Azure infrastructure deployment](contoso-migration-infrastructure.md), so they just need to create a storage account and vault.</span><span class="sxs-lookup"><span data-stu-id="363fc-255">Contoso already created the VNet during [Azure infrastructure deployment](contoso-migration-infrastructure.md), so they just need to create a storage account and vault.</span></span>

1. <span data-ttu-id="363fc-256">Contoso admins create an Azure storage account (contosovmsacc20180528) in the East US 2 region.</span><span class="sxs-lookup"><span data-stu-id="363fc-256">Contoso admins create an Azure storage account (contosovmsacc20180528) in the East US 2 region.</span></span>

    - <span data-ttu-id="363fc-257">The storage account must be in the same region as the Recovery Services vault.</span><span class="sxs-lookup"><span data-stu-id="363fc-257">The storage account must be in the same region as the Recovery Services vault.</span></span>
    - <span data-ttu-id="363fc-258">They use a general purpose account, with standard storage, and LRS replication.</span><span class="sxs-lookup"><span data-stu-id="363fc-258">They use a general purpose account, with standard storage, and LRS replication.</span></span>

    ![Site Recovery storage](./media/contoso-migration-rehost-linux-vm/asr-storage.png)

2. <span data-ttu-id="363fc-260">With the network and storage account in place, they create a vault (ContosoMigrationVault), and place it in the **ContosoFailoverRG** resource group, in the primary East US 2 region.</span><span class="sxs-lookup"><span data-stu-id="363fc-260">With the network and storage account in place, they create a vault (ContosoMigrationVault), and place it in the **ContosoFailoverRG** resource group, in the primary East US 2 region.</span></span>

    ![Recovery Services vault](./media/contoso-migration-rehost-linux-vm/asr-vault.png)


<span data-ttu-id="363fc-262">**Need more help?**</span><span class="sxs-lookup"><span data-stu-id="363fc-262">**Need more help?**</span></span>

<span data-ttu-id="363fc-263">[Learn about](https://docs.microsoft.com/azure/site-recovery/tutorial-prepare-azure) setting up Azure for Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="363fc-263">[Learn about](https://docs.microsoft.com/azure/site-recovery/tutorial-prepare-azure) setting up Azure for Site Recovery.</span></span>


## <a name="step-2-prepare-on-premises-vmware-for-site-recovery"></a><span data-ttu-id="363fc-264">Step 2: Prepare on-premises VMware for Site Recovery</span><span class="sxs-lookup"><span data-stu-id="363fc-264">Step 2: Prepare on-premises VMware for Site Recovery</span></span>

<span data-ttu-id="363fc-265">Contoso admins prepare the on-premises VMware infrastructure as follows:</span><span class="sxs-lookup"><span data-stu-id="363fc-265">Contoso admins prepare the on-premises VMware infrastructure as follows:</span></span>

- <span data-ttu-id="363fc-266">They create an account on the vCenter server or vSphere ESXi host, to automate VM discovery.</span><span class="sxs-lookup"><span data-stu-id="363fc-266">They create an account on the vCenter server or vSphere ESXi host, to automate VM discovery.</span></span>
- <span data-ttu-id="363fc-267">They create an account that allows automatic installation of the Mobility service on VMware VMs that you want to replicate.</span><span class="sxs-lookup"><span data-stu-id="363fc-267">They create an account that allows automatic installation of the Mobility service on VMware VMs that you want to replicate.</span></span>
- <span data-ttu-id="363fc-268">They prepare on-premises VMs, so that they can connect to Azure VMs when they're created after migration.</span><span class="sxs-lookup"><span data-stu-id="363fc-268">They prepare on-premises VMs, so that they can connect to Azure VMs when they're created after migration.</span></span>


### <a name="prepare-an-account-for-automatic-discovery"></a><span data-ttu-id="363fc-269">Prepare an account for automatic discovery</span><span class="sxs-lookup"><span data-stu-id="363fc-269">Prepare an account for automatic discovery</span></span>

<span data-ttu-id="363fc-270">Site Recovery needs access to VMware servers to:</span><span class="sxs-lookup"><span data-stu-id="363fc-270">Site Recovery needs access to VMware servers to:</span></span>

- <span data-ttu-id="363fc-271">Automatically discover VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-271">Automatically discover VMs.</span></span> <span data-ttu-id="363fc-272">At least a read-only account is required.</span><span class="sxs-lookup"><span data-stu-id="363fc-272">At least a read-only account is required.</span></span>
- <span data-ttu-id="363fc-273">Orchestrate replication, failover, and failback.</span><span class="sxs-lookup"><span data-stu-id="363fc-273">Orchestrate replication, failover, and failback.</span></span> <span data-ttu-id="363fc-274">You need an account that can run operations such as creating and removing disks, and turning on VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-274">You need an account that can run operations such as creating and removing disks, and turning on VMs.</span></span>

<span data-ttu-id="363fc-275">Contoso admins set up the account as follows:</span><span class="sxs-lookup"><span data-stu-id="363fc-275">Contoso admins set up the account as follows:</span></span>

1. <span data-ttu-id="363fc-276">They create a role at the vCenter level.</span><span class="sxs-lookup"><span data-stu-id="363fc-276">They create a role at the vCenter level.</span></span>
2. <span data-ttu-id="363fc-277">They assign that role the required permissions.</span><span class="sxs-lookup"><span data-stu-id="363fc-277">They assign that role the required permissions.</span></span>



### <a name="prepare-an-account-for-mobility-service-installation"></a><span data-ttu-id="363fc-278">Prepare an account for Mobility service installation</span><span class="sxs-lookup"><span data-stu-id="363fc-278">Prepare an account for Mobility service installation</span></span>

<span data-ttu-id="363fc-279">The Mobility service must be installed on the Linux VMs that will be migrated.</span><span class="sxs-lookup"><span data-stu-id="363fc-279">The Mobility service must be installed on the Linux VMs that will be migrated.</span></span>

- <span data-ttu-id="363fc-280">Site Recovery can do an automatic push installation of this component when replication is enabled for VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-280">Site Recovery can do an automatic push installation of this component when replication is enabled for VMs.</span></span>
- <span data-ttu-id="363fc-281">For automatic push installation, they need to prepare an account that Site Recovery will use to access the VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-281">For automatic push installation, they need to prepare an account that Site Recovery will use to access the VMs.</span></span>
- <span data-ttu-id="363fc-282">Accounts details are input during replication setup.</span><span class="sxs-lookup"><span data-stu-id="363fc-282">Accounts details are input during replication setup.</span></span> 
- <span data-ttu-id="363fc-283">The account can be domain or local account, with permissions to install on VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-283">The account can be domain or local account, with permissions to install on VMs.</span></span>


### <a name="prepare-to-connect-to-azure-vms-after-failover"></a><span data-ttu-id="363fc-284">Prepare to connect to Azure VMs after failover</span><span class="sxs-lookup"><span data-stu-id="363fc-284">Prepare to connect to Azure VMs after failover</span></span>

<span data-ttu-id="363fc-285">After failover to Azure, Contoso wants to be able to connect to the replicated VMs in Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-285">After failover to Azure, Contoso wants to be able to connect to the replicated VMs in Azure.</span></span> <span data-ttu-id="363fc-286">To do this, there's a couple of things that the Contoso admins need to do:</span><span class="sxs-lookup"><span data-stu-id="363fc-286">To do this, there's a couple of things that the Contoso admins need to do:</span></span>

- <span data-ttu-id="363fc-287">To access Azure VMs over the internet, they enable SSH on the on-premises Linux VM before migration.</span><span class="sxs-lookup"><span data-stu-id="363fc-287">To access Azure VMs over the internet, they enable SSH on the on-premises Linux VM before migration.</span></span>  <span data-ttu-id="363fc-288">For Ubuntu this can be completed using the following command: **Sudo apt-get ssh install -y**.</span><span class="sxs-lookup"><span data-stu-id="363fc-288">For Ubuntu this can be completed using the following command: **Sudo apt-get ssh install -y**.</span></span>
- <span data-ttu-id="363fc-289">After they run the migration (failover), they can check **Boot diagnostics** to view a screenshot of the VM.</span><span class="sxs-lookup"><span data-stu-id="363fc-289">After they run the migration (failover), they can check **Boot diagnostics** to view a screenshot of the VM.</span></span>
- <span data-ttu-id="363fc-290">If this doesn't work, they'll need to check that the VM is running, and review these [troubleshooting tips](http://social.technet.microsoft.com/wiki/contents/articles/31666.troubleshooting-remote-desktop-connection-after-failover-using-asr.aspx).</span><span class="sxs-lookup"><span data-stu-id="363fc-290">If this doesn't work, they'll need to check that the VM is running, and review these [troubleshooting tips](http://social.technet.microsoft.com/wiki/contents/articles/31666.troubleshooting-remote-desktop-connection-after-failover-using-asr.aspx).</span></span>


<span data-ttu-id="363fc-291">**Need more help?**</span><span class="sxs-lookup"><span data-stu-id="363fc-291">**Need more help?**</span></span>

- <span data-ttu-id="363fc-292">[Learn about](https://docs.microsoft.com/azure/site-recovery/vmware-azure-tutorial-prepare-on-premises#prepare-an-account-for-automatic-discovery) creating and assigning a role for automatic discovery.</span><span class="sxs-lookup"><span data-stu-id="363fc-292">[Learn about](https://docs.microsoft.com/azure/site-recovery/vmware-azure-tutorial-prepare-on-premises#prepare-an-account-for-automatic-discovery) creating and assigning a role for automatic discovery.</span></span>
- <span data-ttu-id="363fc-293">[Learn about](https://docs.microsoft.com/azure/site-recovery/vmware-azure-tutorial-prepare-on-premises#prepare-an-account-for-mobility-service-installation) creating an account for push installation of the Mobility service.</span><span class="sxs-lookup"><span data-stu-id="363fc-293">[Learn about](https://docs.microsoft.com/azure/site-recovery/vmware-azure-tutorial-prepare-on-premises#prepare-an-account-for-mobility-service-installation) creating an account for push installation of the Mobility service.</span></span>


## <a name="step-3-replicate-the-on-premises-vms"></a><span data-ttu-id="363fc-294">Step 3: Replicate the on-premises VMs</span><span class="sxs-lookup"><span data-stu-id="363fc-294">Step 3: Replicate the on-premises VMs</span></span>

<span data-ttu-id="363fc-295">Before they can migrate the web VM to Azure, Contoso admins set up and enable replication.</span><span class="sxs-lookup"><span data-stu-id="363fc-295">Before they can migrate the web VM to Azure, Contoso admins set up and enable replication.</span></span>

### <a name="set-a-protection-goal"></a><span data-ttu-id="363fc-296">Set a protection goal</span><span class="sxs-lookup"><span data-stu-id="363fc-296">Set a protection goal</span></span>

1. <span data-ttu-id="363fc-297">In the vault, under the vault name (ContosoVMVault) they set a replication goal (**Getting Started** > **Site Recovery** > **Prepare infrastructure**.</span><span class="sxs-lookup"><span data-stu-id="363fc-297">In the vault, under the vault name (ContosoVMVault) they set a replication goal (**Getting Started** > **Site Recovery** > **Prepare infrastructure**.</span></span>
2. <span data-ttu-id="363fc-298">They specify that their machines are located on-premises, that they're VMware VMs, and that they want to replicate to Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-298">They specify that their machines are located on-premises, that they're VMware VMs, and that they want to replicate to Azure.</span></span>
    <span data-ttu-id="363fc-299">![Replication goal](./media/contoso-migration-rehost-linux-vm/replication-goal.png)</span><span class="sxs-lookup"><span data-stu-id="363fc-299">![Replication goal](./media/contoso-migration-rehost-linux-vm/replication-goal.png)</span></span>

### <a name="confirm-deployment-planning"></a><span data-ttu-id="363fc-300">Confirm deployment planning</span><span class="sxs-lookup"><span data-stu-id="363fc-300">Confirm deployment planning</span></span>

<span data-ttu-id="363fc-301">To continue, they confirm that they've completed deployment planning, by selecting **Yes, I have done it**.</span><span class="sxs-lookup"><span data-stu-id="363fc-301">To continue, they confirm that they've completed deployment planning, by selecting **Yes, I have done it**.</span></span> <span data-ttu-id="363fc-302">Contoso are only migrating a single VM in this scenario, and don't need deployment planning.</span><span class="sxs-lookup"><span data-stu-id="363fc-302">Contoso are only migrating a single VM in this scenario, and don't need deployment planning.</span></span>

### <a name="set-up-the-source-environment"></a><span data-ttu-id="363fc-303">Set up the source environment</span><span class="sxs-lookup"><span data-stu-id="363fc-303">Set up the source environment</span></span>

<span data-ttu-id="363fc-304">Contoso admins now need to configure the source environment.</span><span class="sxs-lookup"><span data-stu-id="363fc-304">Contoso admins now need to configure the source environment.</span></span> <span data-ttu-id="363fc-305">To do this, they download an OVF template and use it to deploy the Site Recovery configuration server as a highly available, on-premises VMware VM.</span><span class="sxs-lookup"><span data-stu-id="363fc-305">To do this, they download an OVF template and use it to deploy the Site Recovery configuration server as a highly available, on-premises VMware VM.</span></span> <span data-ttu-id="363fc-306">After the configuration server is up and running, they register it in the vault.</span><span class="sxs-lookup"><span data-stu-id="363fc-306">After the configuration server is up and running, they register it in the vault.</span></span>

<span data-ttu-id="363fc-307">The configuration server runs a number of components:</span><span class="sxs-lookup"><span data-stu-id="363fc-307">The configuration server runs a number of components:</span></span>

- <span data-ttu-id="363fc-308">The configuration server component that coordinates communications between on-premises and Azure and manages data replication.</span><span class="sxs-lookup"><span data-stu-id="363fc-308">The configuration server component that coordinates communications between on-premises and Azure and manages data replication.</span></span>
- <span data-ttu-id="363fc-309">The process server that acts as a replication gateway.</span><span class="sxs-lookup"><span data-stu-id="363fc-309">The process server that acts as a replication gateway.</span></span> <span data-ttu-id="363fc-310">It receives replication data; optimizes it with caching, compression, and encryption; and sends it to Azure storage.</span><span class="sxs-lookup"><span data-stu-id="363fc-310">It receives replication data; optimizes it with caching, compression, and encryption; and sends it to Azure storage.</span></span>
- <span data-ttu-id="363fc-311">The process server also installs Mobility Service on VMs you want to replicate and performs automatic discovery of on-premises VMware VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-311">The process server also installs Mobility Service on VMs you want to replicate and performs automatic discovery of on-premises VMware VMs.</span></span>

<span data-ttu-id="363fc-312">Contoso admins perform these steps as follows:</span><span class="sxs-lookup"><span data-stu-id="363fc-312">Contoso admins perform these steps as follows:</span></span>

1. <span data-ttu-id="363fc-313">They download the OVF template from **Prepare Infrastructure** > **Source** > **Configuration Server**.</span><span class="sxs-lookup"><span data-stu-id="363fc-313">They download the OVF template from **Prepare Infrastructure** > **Source** > **Configuration Server**.</span></span>
    
    ![Download OVF](./media/contoso-migration-rehost-linux-vm/add-cs.png)

2. <span data-ttu-id="363fc-315">They import the template into VMware to create the VM, and deploy the VM.</span><span class="sxs-lookup"><span data-stu-id="363fc-315">They import the template into VMware to create the VM, and deploy the VM.</span></span>

    ![OVF template](./media/contoso-migration-rehost-linux-vm/vcenter-wizard.png)

3. <span data-ttu-id="363fc-317">When they turn on the VM for the first time, it boots up into a Windows Server 2016 installation experience.</span><span class="sxs-lookup"><span data-stu-id="363fc-317">When they turn on the VM for the first time, it boots up into a Windows Server 2016 installation experience.</span></span> <span data-ttu-id="363fc-318">They accept the license agreement, and enter an administrator password.</span><span class="sxs-lookup"><span data-stu-id="363fc-318">They accept the license agreement, and enter an administrator password.</span></span>
4. <span data-ttu-id="363fc-319">After the installation finishes, they sign into the VM as an administrator.</span><span class="sxs-lookup"><span data-stu-id="363fc-319">After the installation finishes, they sign into the VM as an administrator.</span></span> <span data-ttu-id="363fc-320">At first sign-in, the Azure Site Recovery Configuration Tool runs by default.</span><span class="sxs-lookup"><span data-stu-id="363fc-320">At first sign-in, the Azure Site Recovery Configuration Tool runs by default.</span></span>
5. <span data-ttu-id="363fc-321">In the tool, they specify a name to use for registering the configuration server in the vault.</span><span class="sxs-lookup"><span data-stu-id="363fc-321">In the tool, they specify a name to use for registering the configuration server in the vault.</span></span>
6. <span data-ttu-id="363fc-322">The tool checks that the VM can connect to Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-322">The tool checks that the VM can connect to Azure.</span></span> <span data-ttu-id="363fc-323">After the connection is established, they sign in to the Azure subscription.</span><span class="sxs-lookup"><span data-stu-id="363fc-323">After the connection is established, they sign in to the Azure subscription.</span></span> <span data-ttu-id="363fc-324">The credentials must have access to the vault in which you want to register the configuration server.</span><span class="sxs-lookup"><span data-stu-id="363fc-324">The credentials must have access to the vault in which you want to register the configuration server.</span></span>

    ![Register configuration server](./media/contoso-migration-rehost-linux-vm/config-server-register2.png)

7. <span data-ttu-id="363fc-326">The tool performs some configuration tasks and then reboots.</span><span class="sxs-lookup"><span data-stu-id="363fc-326">The tool performs some configuration tasks and then reboots.</span></span>
8. <span data-ttu-id="363fc-327">They sign in to the machine again, and the Configuration Server Management Wizard starts automatically.</span><span class="sxs-lookup"><span data-stu-id="363fc-327">They sign in to the machine again, and the Configuration Server Management Wizard starts automatically.</span></span>
9. <span data-ttu-id="363fc-328">In the wizard, they select the NIC to receive replication traffic.</span><span class="sxs-lookup"><span data-stu-id="363fc-328">In the wizard, they select the NIC to receive replication traffic.</span></span> <span data-ttu-id="363fc-329">This setting can't be changed after it's configured.</span><span class="sxs-lookup"><span data-stu-id="363fc-329">This setting can't be changed after it's configured.</span></span>
10. <span data-ttu-id="363fc-330">They select the subscription, resource group, and vault in which to register the configuration server.</span><span class="sxs-lookup"><span data-stu-id="363fc-330">They select the subscription, resource group, and vault in which to register the configuration server.</span></span>

    ![vault](./media/contoso-migration-rehost-linux-vm/cswiz1.png) 

11. <span data-ttu-id="363fc-332">They then download and install MySQL Server, and VMWare PowerCLI.</span><span class="sxs-lookup"><span data-stu-id="363fc-332">They then download and install MySQL Server, and VMWare PowerCLI.</span></span> 
12. <span data-ttu-id="363fc-333">After validation, they specify the FQDN or IP address of the vCenter server or vSphere host.</span><span class="sxs-lookup"><span data-stu-id="363fc-333">After validation, they specify the FQDN or IP address of the vCenter server or vSphere host.</span></span> <span data-ttu-id="363fc-334">They leave the default port, and specify a friendly name for the vCenter server.</span><span class="sxs-lookup"><span data-stu-id="363fc-334">They leave the default port, and specify a friendly name for the vCenter server.</span></span>
13. <span data-ttu-id="363fc-335">They specify the account that they created for automatic discovery, and the credentials that should be used to automatically install the Mobility Service.</span><span class="sxs-lookup"><span data-stu-id="363fc-335">They specify the account that they created for automatic discovery, and the credentials that should be used to automatically install the Mobility Service.</span></span>

    ![vCenter](./media/contoso-migration-rehost-linux-vm/cswiz2.png)

14. <span data-ttu-id="363fc-337">After registration finishes, in the Azure portal, they check that the configuration server and VMware server are listed on the **Source** page in the vault.</span><span class="sxs-lookup"><span data-stu-id="363fc-337">After registration finishes, in the Azure portal, they check that the configuration server and VMware server are listed on the **Source** page in the vault.</span></span> <span data-ttu-id="363fc-338">Discovery can take 15 minutes or more.</span><span class="sxs-lookup"><span data-stu-id="363fc-338">Discovery can take 15 minutes or more.</span></span> 
15. <span data-ttu-id="363fc-339">Site Recovery then connects to VMware servers, and discovers VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-339">Site Recovery then connects to VMware servers, and discovers VMs.</span></span>

### <a name="set-up-the-target"></a><span data-ttu-id="363fc-340">Set up the target</span><span class="sxs-lookup"><span data-stu-id="363fc-340">Set up the target</span></span>

<span data-ttu-id="363fc-341">Now Contoso admins configure the target replication settings.</span><span class="sxs-lookup"><span data-stu-id="363fc-341">Now Contoso admins configure the target replication settings.</span></span>

1. <span data-ttu-id="363fc-342">In **Prepare infrastructure** > **Target**, they select the target settings.</span><span class="sxs-lookup"><span data-stu-id="363fc-342">In **Prepare infrastructure** > **Target**, they select the target settings.</span></span>
2. <span data-ttu-id="363fc-343">Site Recovery checks that there's an Azure storage account and network in the specified target.</span><span class="sxs-lookup"><span data-stu-id="363fc-343">Site Recovery checks that there's an Azure storage account and network in the specified target.</span></span>

### <a name="create-a-replication-policy"></a><span data-ttu-id="363fc-344">Create a replication policy</span><span class="sxs-lookup"><span data-stu-id="363fc-344">Create a replication policy</span></span>

<span data-ttu-id="363fc-345">After the source and target are set up, they're ready to create a replication policy.</span><span class="sxs-lookup"><span data-stu-id="363fc-345">After the source and target are set up, they're ready to create a replication policy.</span></span>

1. <span data-ttu-id="363fc-346">In  **Prepare infrastructure** > **Replication Settings** > **Replication Policy** >  **Create and Associate**, they create a policy **ContosoMigrationPolicy**.</span><span class="sxs-lookup"><span data-stu-id="363fc-346">In  **Prepare infrastructure** > **Replication Settings** > **Replication Policy** >  **Create and Associate**, they create a policy **ContosoMigrationPolicy**.</span></span>
2. <span data-ttu-id="363fc-347">They use the default settings:</span><span class="sxs-lookup"><span data-stu-id="363fc-347">They use the default settings:</span></span>
    - <span data-ttu-id="363fc-348">**RPO threshold**: Default of 60 minutes.</span><span class="sxs-lookup"><span data-stu-id="363fc-348">**RPO threshold**: Default of 60 minutes.</span></span> <span data-ttu-id="363fc-349">This value defines how often recovery points are created.</span><span class="sxs-lookup"><span data-stu-id="363fc-349">This value defines how often recovery points are created.</span></span> <span data-ttu-id="363fc-350">An alert is generated if continuous replication exceeds this limit.</span><span class="sxs-lookup"><span data-stu-id="363fc-350">An alert is generated if continuous replication exceeds this limit.</span></span>
    - <span data-ttu-id="363fc-351">**Recovery point retention**.</span><span class="sxs-lookup"><span data-stu-id="363fc-351">**Recovery point retention**.</span></span> <span data-ttu-id="363fc-352">Default of 24 hours.</span><span class="sxs-lookup"><span data-stu-id="363fc-352">Default of 24 hours.</span></span> <span data-ttu-id="363fc-353">This value specifies how long the retention window is for each recovery point.</span><span class="sxs-lookup"><span data-stu-id="363fc-353">This value specifies how long the retention window is for each recovery point.</span></span> <span data-ttu-id="363fc-354">Replicated VMs can be recovered to any point in a window.</span><span class="sxs-lookup"><span data-stu-id="363fc-354">Replicated VMs can be recovered to any point in a window.</span></span>
    - <span data-ttu-id="363fc-355">**App-consistent snapshot frequency**.</span><span class="sxs-lookup"><span data-stu-id="363fc-355">**App-consistent snapshot frequency**.</span></span> <span data-ttu-id="363fc-356">Default of one hour.</span><span class="sxs-lookup"><span data-stu-id="363fc-356">Default of one hour.</span></span> <span data-ttu-id="363fc-357">This value specifies the frequency at which application-consistent snapshots are created.</span><span class="sxs-lookup"><span data-stu-id="363fc-357">This value specifies the frequency at which application-consistent snapshots are created.</span></span>
 
        ![Create replication policy](./media/contoso-migration-rehost-linux-vm/replication-policy.png)

5. <span data-ttu-id="363fc-359">The policy is automatically associated with the configuration server.</span><span class="sxs-lookup"><span data-stu-id="363fc-359">The policy is automatically associated with the configuration server.</span></span> 

    ![Associate replication policy](./media/contoso-migration-rehost-linux-vm/replication-policy2.png)

<span data-ttu-id="363fc-361">**Need more help?**</span><span class="sxs-lookup"><span data-stu-id="363fc-361">**Need more help?**</span></span>

- <span data-ttu-id="363fc-362">You can read a full walkthrough of all these steps in [Set up disaster recovery for on-premises VMware VMs](https://docs.microsoft.com/azure/site-recovery/vmware-azure-tutorial).</span><span class="sxs-lookup"><span data-stu-id="363fc-362">You can read a full walkthrough of all these steps in [Set up disaster recovery for on-premises VMware VMs](https://docs.microsoft.com/azure/site-recovery/vmware-azure-tutorial).</span></span>
- <span data-ttu-id="363fc-363">Detailed instructions are available to help you [set up the source environment](https://docs.microsoft.com/azure/site-recovery/vmware-azure-set-up-source), [deploy the configuration server](https://docs.microsoft.com/azure/site-recovery/vmware-azure-deploy-configuration-server), and [configure replication settings](https://docs.microsoft.com/azure/site-recovery/vmware-azure-set-up-replication).</span><span class="sxs-lookup"><span data-stu-id="363fc-363">Detailed instructions are available to help you [set up the source environment](https://docs.microsoft.com/azure/site-recovery/vmware-azure-set-up-source), [deploy the configuration server](https://docs.microsoft.com/azure/site-recovery/vmware-azure-deploy-configuration-server), and [configure replication settings](https://docs.microsoft.com/azure/site-recovery/vmware-azure-set-up-replication).</span></span>
- <span data-ttu-id="363fc-364">[Learn more](https://docs.microsoft.com/azure/virtual-machines/extensions/agent-linux) about the Azure Guest agent for Linux.</span><span class="sxs-lookup"><span data-stu-id="363fc-364">[Learn more](https://docs.microsoft.com/azure/virtual-machines/extensions/agent-linux) about the Azure Guest agent for Linux.</span></span>

<span data-ttu-id="363fc-365">**Need more help?**</span><span class="sxs-lookup"><span data-stu-id="363fc-365">**Need more help?**</span></span>

- <span data-ttu-id="363fc-366">You can read a full walkthrough of all these steps in [Set up disaster recovery for on-premises VMware VMs](https://docs.microsoft.com/azure/site-recovery/vmware-azure-tutorial).</span><span class="sxs-lookup"><span data-stu-id="363fc-366">You can read a full walkthrough of all these steps in [Set up disaster recovery for on-premises VMware VMs](https://docs.microsoft.com/azure/site-recovery/vmware-azure-tutorial).</span></span>
- <span data-ttu-id="363fc-367">Detailed instructions are available to help you [set up the source environment](https://docs.microsoft.com/azure/site-recovery/vmware-azure-set-up-source), [deploy the configuration server](https://docs.microsoft.com/azure/site-recovery/vmware-azure-deploy-configuration-server), and [configure replication settings](https://docs.microsoft.com/azure/site-recovery/vmware-azure-set-up-replication).</span><span class="sxs-lookup"><span data-stu-id="363fc-367">Detailed instructions are available to help you [set up the source environment](https://docs.microsoft.com/azure/site-recovery/vmware-azure-set-up-source), [deploy the configuration server](https://docs.microsoft.com/azure/site-recovery/vmware-azure-deploy-configuration-server), and [configure replication settings](https://docs.microsoft.com/azure/site-recovery/vmware-azure-set-up-replication).</span></span>
- <span data-ttu-id="363fc-368">[Learn more](https://docs.microsoft.com/azure/virtual-machines/extensions/agent-linux) about the Azure Guest agent for Linux.</span><span class="sxs-lookup"><span data-stu-id="363fc-368">[Learn more](https://docs.microsoft.com/azure/virtual-machines/extensions/agent-linux) about the Azure Guest agent for Linux.</span></span>



### <a name="enable-replication-for-osticketweb"></a><span data-ttu-id="363fc-369">Enable replication for OSTICKETWEB</span><span class="sxs-lookup"><span data-stu-id="363fc-369">Enable replication for OSTICKETWEB</span></span>

<span data-ttu-id="363fc-370">Now Contoso admins can start replicating the **OSTICKETWEB** VM.</span><span class="sxs-lookup"><span data-stu-id="363fc-370">Now Contoso admins can start replicating the **OSTICKETWEB** VM.</span></span>

1. <span data-ttu-id="363fc-371">In **Replicate application** > **Source** > **+Replicate** they select the source settings.</span><span class="sxs-lookup"><span data-stu-id="363fc-371">In **Replicate application** > **Source** > **+Replicate** they select the source settings.</span></span>
2. <span data-ttu-id="363fc-372">They select that they want to enable virtual machines, select the source settings, including the vCenter server, and the configuration server.</span><span class="sxs-lookup"><span data-stu-id="363fc-372">They select that they want to enable virtual machines, select the source settings, including the vCenter server, and the configuration server.</span></span>

    ![Enable replication](./media/contoso-migration-rehost-linux-vm/enable-replication-source.png)

3. <span data-ttu-id="363fc-374">They specify the target settings, including the resource group and VNet in which the Azure VM will be located after failover, and the storage account in which replicated data will be stored.</span><span class="sxs-lookup"><span data-stu-id="363fc-374">They specify the target settings, including the resource group and VNet in which the Azure VM will be located after failover, and the storage account in which replicated data will be stored.</span></span>

     ![Enable replication](./media/contoso-migration-rehost-linux-vm/enable-replication2.png)

3. <span data-ttu-id="363fc-376">They select the **OSTICKETWEB** VM for replication.</span><span class="sxs-lookup"><span data-stu-id="363fc-376">They select the **OSTICKETWEB** VM for replication.</span></span> 

    - <span data-ttu-id="363fc-377">At this stage they select **OSTICKETWEB** only, because the VNet and subnet must both be selected, and the VMs aren't in the same subnet.</span><span class="sxs-lookup"><span data-stu-id="363fc-377">At this stage they select **OSTICKETWEB** only, because the VNet and subnet must both be selected, and the VMs aren't in the same subnet.</span></span>
    - <span data-ttu-id="363fc-378">Site Recovery automatically installs the Mobility service when replication is enabled for the VM.</span><span class="sxs-lookup"><span data-stu-id="363fc-378">Site Recovery automatically installs the Mobility service when replication is enabled for the VM.</span></span>

    ![Enable replication](./media/contoso-migration-rehost-linux-vm/enable-replication3.png)

4. <span data-ttu-id="363fc-380">In the VM properties, they select the account that's used by the process server to automatically install Mobility Service on the machine.</span><span class="sxs-lookup"><span data-stu-id="363fc-380">In the VM properties, they select the account that's used by the process server to automatically install Mobility Service on the machine.</span></span>

     ![Mobility service](./media/contoso-migration-rehost-linux-vm/linux-mobility.png)

5. <span data-ttu-id="363fc-382">in **Replication settings** > **Configure replication settings**, they check that the correct replication policy is applied, and select **Enable Replication**.</span><span class="sxs-lookup"><span data-stu-id="363fc-382">in **Replication settings** > **Configure replication settings**, they check that the correct replication policy is applied, and select **Enable Replication**.</span></span>
6.  <span data-ttu-id="363fc-383">They track replication progress in **Jobs**.</span><span class="sxs-lookup"><span data-stu-id="363fc-383">They track replication progress in **Jobs**.</span></span> <span data-ttu-id="363fc-384">After the **Finalize Protection** job runs, the machine is ready for failover.</span><span class="sxs-lookup"><span data-stu-id="363fc-384">After the **Finalize Protection** job runs, the machine is ready for failover.</span></span>



### <a name="enable-replication-for-osticketmysql"></a><span data-ttu-id="363fc-385">Enable replication for OSTICKETMYSQL</span><span class="sxs-lookup"><span data-stu-id="363fc-385">Enable replication for OSTICKETMYSQL</span></span>

<span data-ttu-id="363fc-386">Now Contoso admins can start replicating **OSTICKETMYSQL**.</span><span class="sxs-lookup"><span data-stu-id="363fc-386">Now Contoso admins can start replicating **OSTICKETMYSQL**.</span></span>

1. <span data-ttu-id="363fc-387">In **Replicate application** > **Source** > **+Replicate** they select the source and target settings.</span><span class="sxs-lookup"><span data-stu-id="363fc-387">In **Replicate application** > **Source** > **+Replicate** they select the source and target settings.</span></span>
2. <span data-ttu-id="363fc-388">They select the **OSTICKETMYSQL** VM for replication, and select the account to use for Mobility service installation.</span><span class="sxs-lookup"><span data-stu-id="363fc-388">They select the **OSTICKETMYSQL** VM for replication, and select the account to use for Mobility service installation.</span></span>

    ![Enable replication](./media/contoso-migration-rehost-linux-vm/mysql-enable.png)

3. <span data-ttu-id="363fc-390">They apply the same replication policy that was used for OSTICKETWEB, and enable replication.</span><span class="sxs-lookup"><span data-stu-id="363fc-390">They apply the same replication policy that was used for OSTICKETWEB, and enable replication.</span></span>  

<span data-ttu-id="363fc-391">**Need more help?**</span><span class="sxs-lookup"><span data-stu-id="363fc-391">**Need more help?**</span></span>

<span data-ttu-id="363fc-392">You can read a full walkthrough of all these steps in [Enable replication](https://docs.microsoft.com/azure/site-recovery/vmware-azure-enable-replication).</span><span class="sxs-lookup"><span data-stu-id="363fc-392">You can read a full walkthrough of all these steps in [Enable replication](https://docs.microsoft.com/azure/site-recovery/vmware-azure-enable-replication).</span></span>


## <a name="step-4-migrate-the-vms"></a><span data-ttu-id="363fc-393">Step 4: Migrate the VMs</span><span class="sxs-lookup"><span data-stu-id="363fc-393">Step 4: Migrate the VMs</span></span> 

<span data-ttu-id="363fc-394">Contoso admins run a quick test failover, and then migrate the VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-394">Contoso admins run a quick test failover, and then migrate the VMs.</span></span>

### <a name="run-a-test-failover"></a><span data-ttu-id="363fc-395">Run a test failover</span><span class="sxs-lookup"><span data-stu-id="363fc-395">Run a test failover</span></span>

<span data-ttu-id="363fc-396">Running a test failover helps ensure that everything's working as expected before the migration.</span><span class="sxs-lookup"><span data-stu-id="363fc-396">Running a test failover helps ensure that everything's working as expected before the migration.</span></span> 

1. <span data-ttu-id="363fc-397">They run a test failover to the latest available point in time (**Latest processed**).</span><span class="sxs-lookup"><span data-stu-id="363fc-397">They run a test failover to the latest available point in time (**Latest processed**).</span></span>
2. <span data-ttu-id="363fc-398">They select **Shut down machine before beginning failover**, so that Site Recovery attempts to shut down the source VM before triggering the failover.</span><span class="sxs-lookup"><span data-stu-id="363fc-398">They select **Shut down machine before beginning failover**, so that Site Recovery attempts to shut down the source VM before triggering the failover.</span></span> <span data-ttu-id="363fc-399">Failover continues even if shutdown fails.</span><span class="sxs-lookup"><span data-stu-id="363fc-399">Failover continues even if shutdown fails.</span></span> 
3. <span data-ttu-id="363fc-400">Test failover runs:</span><span class="sxs-lookup"><span data-stu-id="363fc-400">Test failover runs:</span></span> 
    - <span data-ttu-id="363fc-401">A prerequisites check runs to make sure all of the conditions required for migration are in place.</span><span class="sxs-lookup"><span data-stu-id="363fc-401">A prerequisites check runs to make sure all of the conditions required for migration are in place.</span></span>
    - <span data-ttu-id="363fc-402">Failover processes the data, so that an Azure VM can be created.</span><span class="sxs-lookup"><span data-stu-id="363fc-402">Failover processes the data, so that an Azure VM can be created.</span></span> <span data-ttu-id="363fc-403">If the latest recovery point is selected, a recovery point is created from the data.</span><span class="sxs-lookup"><span data-stu-id="363fc-403">If the latest recovery point is selected, a recovery point is created from the data.</span></span>
    - <span data-ttu-id="363fc-404">An Azure VM is created using the data processed in the previous step.</span><span class="sxs-lookup"><span data-stu-id="363fc-404">An Azure VM is created using the data processed in the previous step.</span></span>
3. <span data-ttu-id="363fc-405">After the failover finishes, the replica Azure VM appears in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="363fc-405">After the failover finishes, the replica Azure VM appears in the Azure portal.</span></span> <span data-ttu-id="363fc-406">They check that the VM is the appropriate size, that it's connected to the right network, and that it's running.</span><span class="sxs-lookup"><span data-stu-id="363fc-406">They check that the VM is the appropriate size, that it's connected to the right network, and that it's running.</span></span> 
4. <span data-ttu-id="363fc-407">After verifying, they clean up the failover, and record and save any observations.</span><span class="sxs-lookup"><span data-stu-id="363fc-407">After verifying, they clean up the failover, and record and save any observations.</span></span>

### <a name="create-and-customize-a-recovery-plan"></a><span data-ttu-id="363fc-408">Create and customize a recovery plan</span><span class="sxs-lookup"><span data-stu-id="363fc-408">Create and customize a recovery plan</span></span>

 <span data-ttu-id="363fc-409">After verifying that the test failover worked as expected, Contoso admins create a recovery plan for migration.</span><span class="sxs-lookup"><span data-stu-id="363fc-409">After verifying that the test failover worked as expected, Contoso admins create a recovery plan for migration.</span></span> 

- <span data-ttu-id="363fc-410">A recovery plan specifies the order in which failover occurs, how Azure VMs will be brought up in Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-410">A recovery plan specifies the order in which failover occurs, how Azure VMs will be brought up in Azure.</span></span>
- <span data-ttu-id="363fc-411">Since they want to migrate a two-tier app, they'll customize the recovery plan so that the data VM (SQLVM) starts before the frontend (WEBVM).</span><span class="sxs-lookup"><span data-stu-id="363fc-411">Since they want to migrate a two-tier app, they'll customize the recovery plan so that the data VM (SQLVM) starts before the frontend (WEBVM).</span></span>


1. <span data-ttu-id="363fc-412">In **Recovery Plans (Site Recovery)** > **+Recovery Plan**, they create a plan and add the VMs to it.</span><span class="sxs-lookup"><span data-stu-id="363fc-412">In **Recovery Plans (Site Recovery)** > **+Recovery Plan**, they create a plan and add the VMs to it.</span></span>

    ![Recovery plan](./media/contoso-migration-rehost-linux-vm/recovery-plan.png)

2. <span data-ttu-id="363fc-414">After creating the plan, they select it for customization (**Recovery Plans** > **OsTicketMigrationPlan** > **Customize**.</span><span class="sxs-lookup"><span data-stu-id="363fc-414">After creating the plan, they select it for customization (**Recovery Plans** > **OsTicketMigrationPlan** > **Customize**.</span></span>
3.  <span data-ttu-id="363fc-415">They remove **OSTICKETWEB** from **Group 1: Start**.</span><span class="sxs-lookup"><span data-stu-id="363fc-415">They remove **OSTICKETWEB** from **Group 1: Start**.</span></span>  <span data-ttu-id="363fc-416">This ensures that the first start action affects **OSTICKETMYSQL** only.</span><span class="sxs-lookup"><span data-stu-id="363fc-416">This ensures that the first start action affects **OSTICKETMYSQL** only.</span></span>

    ![Recovery group](./media/contoso-migration-rehost-linux-vm/recovery-group1.png)

4.  <span data-ttu-id="363fc-418">In **+Group** > **Add protected items**, they add **OSTICKETWEB** to **Group 2: Start**.</span><span class="sxs-lookup"><span data-stu-id="363fc-418">In **+Group** > **Add protected items**, they add **OSTICKETWEB** to **Group 2: Start**.</span></span>  <span data-ttu-id="363fc-419">They need these in two different groups.</span><span class="sxs-lookup"><span data-stu-id="363fc-419">They need these in two different groups.</span></span>

    ![Recovery group](./media/contoso-migration-rehost-linux-vm/recovery-group2.png)


### <a name="migrate-the-vms"></a><span data-ttu-id="363fc-421">Migrate the VMs</span><span class="sxs-lookup"><span data-stu-id="363fc-421">Migrate the VMs</span></span>


<span data-ttu-id="363fc-422">Contoso admins are now ready to run a failover on the recovery plan, to migrate the VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-422">Contoso admins are now ready to run a failover on the recovery plan, to migrate the VMs.</span></span>

1. <span data-ttu-id="363fc-423">They select the plan > **Failover**.</span><span class="sxs-lookup"><span data-stu-id="363fc-423">They select the plan > **Failover**.</span></span>
2.  <span data-ttu-id="363fc-424">They select to fail over to the latest recovery point, and specify that Site Recovery should try to shut down the on-premises VM before triggering the failover.</span><span class="sxs-lookup"><span data-stu-id="363fc-424">They select to fail over to the latest recovery point, and specify that Site Recovery should try to shut down the on-premises VM before triggering the failover.</span></span> <span data-ttu-id="363fc-425">They can follow the failover progress on the **Jobs** page.</span><span class="sxs-lookup"><span data-stu-id="363fc-425">They can follow the failover progress on the **Jobs** page.</span></span>

    ![Failover](./media/contoso-migration-rehost-vm/failover1.png)

3. <span data-ttu-id="363fc-427">During the failover, vCenter Server issues commands to stop the two VMs running on the ESXi host.</span><span class="sxs-lookup"><span data-stu-id="363fc-427">During the failover, vCenter Server issues commands to stop the two VMs running on the ESXi host.</span></span>

    ![Failover](./media/contoso-migration-rehost-linux-vm/vcenter-failover.png)

3. <span data-ttu-id="363fc-429">After the failover, they verify that the Azure VM appears as expected in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="363fc-429">After the failover, they verify that the Azure VM appears as expected in the Azure portal.</span></span>

    ![Failover](./media/contoso-migration-rehost-linux-vm/failover2.png)  

3. <span data-ttu-id="363fc-431">After verifying the VM in Azure, they complete the migration to finish the migration process for each VM.</span><span class="sxs-lookup"><span data-stu-id="363fc-431">After verifying the VM in Azure, they complete the migration to finish the migration process for each VM.</span></span> <span data-ttu-id="363fc-432">This stops replication for the VM, and stops Site Recovery billing for the VM.</span><span class="sxs-lookup"><span data-stu-id="363fc-432">This stops replication for the VM, and stops Site Recovery billing for the VM.</span></span>

    ![Failover](./media/contoso-migration-rehost-linux-vm/failover3.png)


### <a name="connect-the-vm-to-the-database"></a><span data-ttu-id="363fc-434">Connect the VM to the database</span><span class="sxs-lookup"><span data-stu-id="363fc-434">Connect the VM to the database</span></span>

<span data-ttu-id="363fc-435">As the final step in the migration process, Contoso adins update the connection string of the application to point to the app database running on the **OSTICKETMYSQL** VM.</span><span class="sxs-lookup"><span data-stu-id="363fc-435">As the final step in the migration process, Contoso adins update the connection string of the application to point to the app database running on the **OSTICKETMYSQL** VM.</span></span> 

1. <span data-ttu-id="363fc-436">They make an SSH connection to the **OSTICKETWEB** VM using Putty or another SSH client.</span><span class="sxs-lookup"><span data-stu-id="363fc-436">They make an SSH connection to the **OSTICKETWEB** VM using Putty or another SSH client.</span></span> <span data-ttu-id="363fc-437">The VM is private so they connect using the private IP address.</span><span class="sxs-lookup"><span data-stu-id="363fc-437">The VM is private so they connect using the private IP address.</span></span>

    ![Connect to database](./media/contoso-migration-rehost-linux-vm/db-connect.png)  

    ![Connect to database](./media/contoso-migration-rehost-linux-vm/db-connect2.png)  

2. <span data-ttu-id="363fc-440">They need to make sure that the **OSTICKETWEB** VM can communicate with the **OSTICKETMYSQL** VM.</span><span class="sxs-lookup"><span data-stu-id="363fc-440">They need to make sure that the **OSTICKETWEB** VM can communicate with the **OSTICKETMYSQL** VM.</span></span> <span data-ttu-id="363fc-441">Currently the configuration is hardcoded with the on-premises IP address 172.16.0.43.</span><span class="sxs-lookup"><span data-stu-id="363fc-441">Currently the configuration is hardcoded with the on-premises IP address 172.16.0.43.</span></span>

    <span data-ttu-id="363fc-442">**Before the update**</span><span class="sxs-lookup"><span data-stu-id="363fc-442">**Before the update**</span></span>
    
    ![Update IP](./media/contoso-migration-rehost-linux-vm/update-ip1.png)  

    <span data-ttu-id="363fc-444">**After the update**</span><span class="sxs-lookup"><span data-stu-id="363fc-444">**After the update**</span></span>
    
    ![Update IP](./media/contoso-migration-rehost-linux-vm/update-ip2.png) 
    
3. <span data-ttu-id="363fc-446">They restart the service with **systemctl restart apache2**.</span><span class="sxs-lookup"><span data-stu-id="363fc-446">They restart the service with **systemctl restart apache2**.</span></span>

    ![Restart](./media/contoso-migration-rehost-linux-vm/restart.png) 

4. <span data-ttu-id="363fc-448">Finally, they update the DNS records for **OSTICKETWEB** and **OSTICKETMYSQL**, on one of the Contoso domain controllers.</span><span class="sxs-lookup"><span data-stu-id="363fc-448">Finally, they update the DNS records for **OSTICKETWEB** and **OSTICKETMYSQL**, on one of the Contoso domain controllers.</span></span>

    ![Update DNS](./media/contoso-migration-rehost-linux-vm-mysql/update-dns.png) 

    ![Update DNS](./media/contoso-migration-rehost-linux-vm-mysql/update-dns.png) 

<span data-ttu-id="363fc-451">**Need more help?**</span><span class="sxs-lookup"><span data-stu-id="363fc-451">**Need more help?**</span></span>

- <span data-ttu-id="363fc-452">[Learn about](https://docs.microsoft.com/azure/site-recovery/tutorial-dr-drill-azure) running a test failover.</span><span class="sxs-lookup"><span data-stu-id="363fc-452">[Learn about](https://docs.microsoft.com/azure/site-recovery/tutorial-dr-drill-azure) running a test failover.</span></span> 
- <span data-ttu-id="363fc-453">[Learn](https://docs.microsoft.com/azure/site-recovery/site-recovery-create-recovery-plans) how to create a recovery plan.</span><span class="sxs-lookup"><span data-stu-id="363fc-453">[Learn](https://docs.microsoft.com/azure/site-recovery/site-recovery-create-recovery-plans) how to create a recovery plan.</span></span>
- <span data-ttu-id="363fc-454">[Learn about](https://docs.microsoft.com/azure/site-recovery/site-recovery-failover) failing over to Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-454">[Learn about](https://docs.microsoft.com/azure/site-recovery/site-recovery-failover) failing over to Azure.</span></span>

## <a name="clean-up-after-migration"></a><span data-ttu-id="363fc-455">Clean up after migration</span><span class="sxs-lookup"><span data-stu-id="363fc-455">Clean up after migration</span></span>

<span data-ttu-id="363fc-456">With migration complete, the osTicket app tiers are now running on Azure VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-456">With migration complete, the osTicket app tiers are now running on Azure VMs.</span></span>

<span data-ttu-id="363fc-457">Now, Contoso needs to clean up as follows:</span><span class="sxs-lookup"><span data-stu-id="363fc-457">Now, Contoso needs to clean up as follows:</span></span> 

- <span data-ttu-id="363fc-458">Remove the on-premises VMs from the vCenter inventory.</span><span class="sxs-lookup"><span data-stu-id="363fc-458">Remove the on-premises VMs from the vCenter inventory.</span></span>
- <span data-ttu-id="363fc-459">Remove the on-premises VMs from local backup jobs.</span><span class="sxs-lookup"><span data-stu-id="363fc-459">Remove the on-premises VMs from local backup jobs.</span></span>
- <span data-ttu-id="363fc-460">Update their internal documentation to show the new location, and IP addresses for OSTICKETWEB and OSTICKETMYSQL.</span><span class="sxs-lookup"><span data-stu-id="363fc-460">Update their internal documentation to show the new location, and IP addresses for OSTICKETWEB and OSTICKETMYSQL.</span></span>
- <span data-ttu-id="363fc-461">Review any resources that interact with the VMs, and update any relevant settings or documentation to reflect the new configuration.</span><span class="sxs-lookup"><span data-stu-id="363fc-461">Review any resources that interact with the VMs, and update any relevant settings or documentation to reflect the new configuration.</span></span>
- <span data-ttu-id="363fc-462">Contoso used the Azure Migrate service with dependency mapping to assess the VMs for migration.</span><span class="sxs-lookup"><span data-stu-id="363fc-462">Contoso used the Azure Migrate service with dependency mapping to assess the VMs for migration.</span></span> <span data-ttu-id="363fc-463">Admins should remove the Microsoft Monitoring Agent, and the Dependency Agent they installed for this purpose, from the VM.</span><span class="sxs-lookup"><span data-stu-id="363fc-463">Admins should remove the Microsoft Monitoring Agent, and the Dependency Agent they installed for this purpose, from the VM.</span></span>

## <a name="review-the-deployment"></a><span data-ttu-id="363fc-464">Review the deployment</span><span class="sxs-lookup"><span data-stu-id="363fc-464">Review the deployment</span></span>

<span data-ttu-id="363fc-465">With the app now running, Contoso needs to fully operationalize and secure their new infrastructure.</span><span class="sxs-lookup"><span data-stu-id="363fc-465">With the app now running, Contoso needs to fully operationalize and secure their new infrastructure.</span></span>

### <a name="security"></a><span data-ttu-id="363fc-466">Security</span><span class="sxs-lookup"><span data-stu-id="363fc-466">Security</span></span>

<span data-ttu-id="363fc-467">The Contoso security team review the OSTICKETWEB and OSTICKETMYSQLVMs to determine any security issues.</span><span class="sxs-lookup"><span data-stu-id="363fc-467">The Contoso security team review the OSTICKETWEB and OSTICKETMYSQLVMs to determine any security issues.</span></span>

- <span data-ttu-id="363fc-468">The team reviews the Network Security Groups (NSGs) for the VMs to control access.</span><span class="sxs-lookup"><span data-stu-id="363fc-468">The team reviews the Network Security Groups (NSGs) for the VMs to control access.</span></span> <span data-ttu-id="363fc-469">NSGs are used to ensure that only traffic allowed to the application can pass.</span><span class="sxs-lookup"><span data-stu-id="363fc-469">NSGs are used to ensure that only traffic allowed to the application can pass.</span></span>
- <span data-ttu-id="363fc-470">The team also considers securing the data on the VM disks using Disk encryption and Azure KeyVault.</span><span class="sxs-lookup"><span data-stu-id="363fc-470">The team also considers securing the data on the VM disks using Disk encryption and Azure KeyVault.</span></span>

<span data-ttu-id="363fc-471">[Read more](https://docs.microsoft.com/azure/security/azure-security-best-practices-vms#vm-authentication-and-access-control) about security practices for VMs.</span><span class="sxs-lookup"><span data-stu-id="363fc-471">[Read more](https://docs.microsoft.com/azure/security/azure-security-best-practices-vms#vm-authentication-and-access-control) about security practices for VMs.</span></span>

### <a name="bcdr"></a><span data-ttu-id="363fc-472">BCDR</span><span class="sxs-lookup"><span data-stu-id="363fc-472">BCDR</span></span>

<span data-ttu-id="363fc-473">For business continuity and disaster recovery, Contoso takes the following actions:</span><span class="sxs-lookup"><span data-stu-id="363fc-473">For business continuity and disaster recovery, Contoso takes the following actions:</span></span>

- <span data-ttu-id="363fc-474">**Keep data safe**: Contoso backs up the data on the VMs using the Azure Backup service.</span><span class="sxs-lookup"><span data-stu-id="363fc-474">**Keep data safe**: Contoso backs up the data on the VMs using the Azure Backup service.</span></span> <span data-ttu-id="363fc-475">[Learn more](https://docs.microsoft.com/azure/backup/backup-introduction-to-azure-backup?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="363fc-475">[Learn more](https://docs.microsoft.com/azure/backup/backup-introduction-to-azure-backup?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>
- <span data-ttu-id="363fc-476">**Keep apps up and running**: Contoso replicates the app VMs in Azure to a secondary region using Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="363fc-476">**Keep apps up and running**: Contoso replicates the app VMs in Azure to a secondary region using Site Recovery.</span></span> <span data-ttu-id="363fc-477">[Learn more](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-quickstart).</span><span class="sxs-lookup"><span data-stu-id="363fc-477">[Learn more](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-quickstart).</span></span>

### <a name="licensing-and-cost-optimization"></a><span data-ttu-id="363fc-478">Licensing and cost optimization</span><span class="sxs-lookup"><span data-stu-id="363fc-478">Licensing and cost optimization</span></span>

- <span data-ttu-id="363fc-479">After deploying resources, Contoso assigns Azure tags as defined during the [Azure infrastructure deployment](contoso-migration-infrastructure.md#set-up-tagging).</span><span class="sxs-lookup"><span data-stu-id="363fc-479">After deploying resources, Contoso assigns Azure tags as defined during the [Azure infrastructure deployment](contoso-migration-infrastructure.md#set-up-tagging).</span></span>
- <span data-ttu-id="363fc-480">Contoso has no licensing issues with the Ubuntu servers.</span><span class="sxs-lookup"><span data-stu-id="363fc-480">Contoso has no licensing issues with the Ubuntu servers.</span></span>
- <span data-ttu-id="363fc-481">Contoso will enable Azure Cost Management licensed by Cloudyn, a Microsoft subsidiary.</span><span class="sxs-lookup"><span data-stu-id="363fc-481">Contoso will enable Azure Cost Management licensed by Cloudyn, a Microsoft subsidiary.</span></span> <span data-ttu-id="363fc-482">It's a multi-cloud cost management solution that helps you to utilize and manage Azure and other cloud resources.</span><span class="sxs-lookup"><span data-stu-id="363fc-482">It's a multi-cloud cost management solution that helps you to utilize and manage Azure and other cloud resources.</span></span>  <span data-ttu-id="363fc-483">[Learn more](https://docs.microsoft.com/azure/cost-management/overview) about Azure Cost Management.</span><span class="sxs-lookup"><span data-stu-id="363fc-483">[Learn more](https://docs.microsoft.com/azure/cost-management/overview) about Azure Cost Management.</span></span> 


## <a name="next-steps"></a><span data-ttu-id="363fc-484">Next steps</span><span class="sxs-lookup"><span data-stu-id="363fc-484">Next steps</span></span>

<span data-ttu-id="363fc-485">In this article we showed how Contoso migrated an on-premises service desk app tiered on two Linux VMs to Azure IaaS VMs, using Azure Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="363fc-485">In this article we showed how Contoso migrated an on-premises service desk app tiered on two Linux VMs to Azure IaaS VMs, using Azure Site Recovery.</span></span>

<span data-ttu-id="363fc-486">In the next article in the series, we'll show you how Contoso migrates the same service desk app to Azure.</span><span class="sxs-lookup"><span data-stu-id="363fc-486">In the next article in the series, we'll show you how Contoso migrates the same service desk app to Azure.</span></span> <span data-ttu-id="363fc-487">This time Contoso uses Site Recovery to migrate the frontend VM for the app, and migrates the app database using backup and restore to Azure Database for MySQL, using the MySQL workbench tool.</span><span class="sxs-lookup"><span data-stu-id="363fc-487">This time Contoso uses Site Recovery to migrate the frontend VM for the app, and migrates the app database using backup and restore to Azure Database for MySQL, using the MySQL workbench tool.</span></span> <span data-ttu-id="363fc-488">[Get started](contoso-migration-rehost-linux-vm-mysql.md).</span><span class="sxs-lookup"><span data-stu-id="363fc-488">[Get started](contoso-migration-rehost-linux-vm-mysql.md).</span></span>
