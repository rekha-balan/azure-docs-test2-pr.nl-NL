---
title: Refactor a Contoso app by migrating it to Azure Web App and Azure SQL Database | Microsoft Docs
description: Learn how Contoso rehosts an on-premises app by migrating it to an Azure Web App and Azure SQL Server database.
services: site-recovery
author: rayne-wiselman
ms.service: site-recovery
ms.topic: conceptual
ms.date: 09/03/2018
ms.author: raynew
ms.openlocfilehash: d42839bb744d3ed09feb482d09946ccee2f691e7
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44868145"
---
# <a name="contoso-migration-refactor-an-on-premises-app-to-an-azure-web-app-and-azure-sql-database"></a><span data-ttu-id="2fce9-103">Contoso migration: Refactor an on-premises app to an Azure Web App and Azure SQL database</span><span class="sxs-lookup"><span data-stu-id="2fce9-103">Contoso migration: Refactor an on-premises app to an Azure Web App and Azure SQL database</span></span>

<span data-ttu-id="2fce9-104">This article demonstrates how Contoso refactors their SmartHotel360 app in Azure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-104">This article demonstrates how Contoso refactors their SmartHotel360 app in Azure.</span></span> <span data-ttu-id="2fce9-105">They migrate the app frontend VM to an Azure Web App, and the app database to an Azure SQL database.</span><span class="sxs-lookup"><span data-stu-id="2fce9-105">They migrate the app frontend VM to an Azure Web App, and the app database to an Azure SQL database.</span></span>

<span data-ttu-id="2fce9-106">This document is one in a series of articles that show how the fictitious company Contoso migrates their on-premises resources to the Microsoft Azure cloud.</span><span class="sxs-lookup"><span data-stu-id="2fce9-106">This document is one in a series of articles that show how the fictitious company Contoso migrates their on-premises resources to the Microsoft Azure cloud.</span></span> <span data-ttu-id="2fce9-107">The series includes background information, and scenarios that illustrate setting up a migration infrastructure, assessing on-premises resources for migration, and running different types of migrations.</span><span class="sxs-lookup"><span data-stu-id="2fce9-107">The series includes background information, and scenarios that illustrate setting up a migration infrastructure, assessing on-premises resources for migration, and running different types of migrations.</span></span> <span data-ttu-id="2fce9-108">Scenarios grow in complexity.</span><span class="sxs-lookup"><span data-stu-id="2fce9-108">Scenarios grow in complexity.</span></span> <span data-ttu-id="2fce9-109">We'll add additional articles over time.</span><span class="sxs-lookup"><span data-stu-id="2fce9-109">We'll add additional articles over time.</span></span>

<span data-ttu-id="2fce9-110">**Article**</span><span class="sxs-lookup"><span data-stu-id="2fce9-110">**Article**</span></span> | <span data-ttu-id="2fce9-111">**Details**</span><span class="sxs-lookup"><span data-stu-id="2fce9-111">**Details**</span></span> | <span data-ttu-id="2fce9-112">**Status**</span><span class="sxs-lookup"><span data-stu-id="2fce9-112">**Status**</span></span>
--- | --- | ---
[<span data-ttu-id="2fce9-113">Article 1: Overview</span><span class="sxs-lookup"><span data-stu-id="2fce9-113">Article 1: Overview</span></span>](contoso-migration-overview.md) | <span data-ttu-id="2fce9-114">Provides an overview of Contoso's migration strategy, the article series, and the sample apps we use.</span><span class="sxs-lookup"><span data-stu-id="2fce9-114">Provides an overview of Contoso's migration strategy, the article series, and the sample apps we use.</span></span> | <span data-ttu-id="2fce9-115">Available</span><span class="sxs-lookup"><span data-stu-id="2fce9-115">Available</span></span>
[<span data-ttu-id="2fce9-116">Article 2: Deploy an Azure infrastructure</span><span class="sxs-lookup"><span data-stu-id="2fce9-116">Article 2: Deploy an Azure infrastructure</span></span>](contoso-migration-infrastructure.md) | <span data-ttu-id="2fce9-117">Describes how Contoso prepares its on-premises and Azure infrastructure for migration.</span><span class="sxs-lookup"><span data-stu-id="2fce9-117">Describes how Contoso prepares its on-premises and Azure infrastructure for migration.</span></span> <span data-ttu-id="2fce9-118">The same infrastructure is used for all migration articles.</span><span class="sxs-lookup"><span data-stu-id="2fce9-118">The same infrastructure is used for all migration articles.</span></span> | <span data-ttu-id="2fce9-119">Available</span><span class="sxs-lookup"><span data-stu-id="2fce9-119">Available</span></span>
[<span data-ttu-id="2fce9-120">Article 3: Assess on-premises resources</span><span class="sxs-lookup"><span data-stu-id="2fce9-120">Article 3: Assess on-premises resources</span></span>](contoso-migration-assessment.md)  | <span data-ttu-id="2fce9-121">Shows how Contoso runs an assessment of an on-premises two-tier SmartHotel app running on VMware.</span><span class="sxs-lookup"><span data-stu-id="2fce9-121">Shows how Contoso runs an assessment of an on-premises two-tier SmartHotel app running on VMware.</span></span> <span data-ttu-id="2fce9-122">Contoso assesses app VMs with the [Azure Migrate](migrate-overview.md) service, and the app SQL Server database with the [Database Migration Assistant](https://docs.microsoft.com/sql/dma/dma-overview?view=sql-server-2017).</span><span class="sxs-lookup"><span data-stu-id="2fce9-122">Contoso assesses app VMs with the [Azure Migrate](migrate-overview.md) service, and the app SQL Server database with the [Database Migration Assistant](https://docs.microsoft.com/sql/dma/dma-overview?view=sql-server-2017).</span></span> | <span data-ttu-id="2fce9-123">Available</span><span class="sxs-lookup"><span data-stu-id="2fce9-123">Available</span></span>
[<span data-ttu-id="2fce9-124">Article 4: Rehost an app to Azure VMs and a SQL Managed Instance</span><span class="sxs-lookup"><span data-stu-id="2fce9-124">Article 4: Rehost an app to Azure VMs and a SQL Managed Instance</span></span>](contoso-migration-rehost-vm-sql-managed-instance.md) | <span data-ttu-id="2fce9-125">Demonstrates how Contoso runs a lift-and-shift migration to Azure for the SmartHotel app.</span><span class="sxs-lookup"><span data-stu-id="2fce9-125">Demonstrates how Contoso runs a lift-and-shift migration to Azure for the SmartHotel app.</span></span> <span data-ttu-id="2fce9-126">Contoso migrates the app frontend VM using [Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/site-recovery-overview), and the app database to a SQL Managed Instance, using the [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview).</span><span class="sxs-lookup"><span data-stu-id="2fce9-126">Contoso migrates the app frontend VM using [Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/site-recovery-overview), and the app database to a SQL Managed Instance, using the [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview).</span></span> | <span data-ttu-id="2fce9-127">Available</span><span class="sxs-lookup"><span data-stu-id="2fce9-127">Available</span></span>
[<span data-ttu-id="2fce9-128">Article 5: Rehost an app to Azure VMs</span><span class="sxs-lookup"><span data-stu-id="2fce9-128">Article 5: Rehost an app to Azure VMs</span></span>](contoso-migration-rehost-vm.md) | <span data-ttu-id="2fce9-129">Shows how Contoso migrate the SmartHotel app VMs using Site Recovery only.</span><span class="sxs-lookup"><span data-stu-id="2fce9-129">Shows how Contoso migrate the SmartHotel app VMs using Site Recovery only.</span></span> | <span data-ttu-id="2fce9-130">Available</span><span class="sxs-lookup"><span data-stu-id="2fce9-130">Available</span></span>
[<span data-ttu-id="2fce9-131">Article 6: Rehost an app to Azure VMs and SQL Server Always On Availability Group</span><span class="sxs-lookup"><span data-stu-id="2fce9-131">Article 6: Rehost an app to Azure VMs and SQL Server Always On Availability Group</span></span>](contoso-migration-rehost-vm-sql-ag.md) | <span data-ttu-id="2fce9-132">Shows how Contoso migrates the SmartHotel app.</span><span class="sxs-lookup"><span data-stu-id="2fce9-132">Shows how Contoso migrates the SmartHotel app.</span></span> <span data-ttu-id="2fce9-133">Contoso uses Site Recovery to migrate the app VMs, and the Database Migration service to migrate the app database to a SQL Server cluster protected by an AlwaysOn availability group.</span><span class="sxs-lookup"><span data-stu-id="2fce9-133">Contoso uses Site Recovery to migrate the app VMs, and the Database Migration service to migrate the app database to a SQL Server cluster protected by an AlwaysOn availability group.</span></span> | <span data-ttu-id="2fce9-134">Available</span><span class="sxs-lookup"><span data-stu-id="2fce9-134">Available</span></span>
[<span data-ttu-id="2fce9-135">Article 7: Rehost a Linux app to Azure VMs</span><span class="sxs-lookup"><span data-stu-id="2fce9-135">Article 7: Rehost a Linux app to Azure VMs</span></span>](contoso-migration-rehost-linux-vm.md) | <span data-ttu-id="2fce9-136">Shows how Contoso does a lift-and-shift migration of the Linux osTicket app to Azure VMs, using Site Recovery</span><span class="sxs-lookup"><span data-stu-id="2fce9-136">Shows how Contoso does a lift-and-shift migration of the Linux osTicket app to Azure VMs, using Site Recovery</span></span> | <span data-ttu-id="2fce9-137">Available</span><span class="sxs-lookup"><span data-stu-id="2fce9-137">Available</span></span>
[<span data-ttu-id="2fce9-138">Article 8: Rehost a Linux app to Azure VMs and Azure MySQL Server</span><span class="sxs-lookup"><span data-stu-id="2fce9-138">Article 8: Rehost a Linux app to Azure VMs and Azure MySQL Server</span></span>](contoso-migration-rehost-linux-vm-mysql.md) | <span data-ttu-id="2fce9-139">Demonstrates how Contoso migrates the Linux osTicket app to Azure VMs using Site Recovery, and migrates the app database to an Azure MySQL Server instance using MySQL Workbench.</span><span class="sxs-lookup"><span data-stu-id="2fce9-139">Demonstrates how Contoso migrates the Linux osTicket app to Azure VMs using Site Recovery, and migrates the app database to an Azure MySQL Server instance using MySQL Workbench.</span></span> | <span data-ttu-id="2fce9-140">Available</span><span class="sxs-lookup"><span data-stu-id="2fce9-140">Available</span></span>
<span data-ttu-id="2fce9-141">Article 9: Refactor an app to an Azure Web App and Azure SQL database</span><span class="sxs-lookup"><span data-stu-id="2fce9-141">Article 9: Refactor an app to an Azure Web App and Azure SQL database</span></span> | <span data-ttu-id="2fce9-142">Demonstrates how Contoso migrates the SmartHotel app to an Azure Web App, and migrates the app database to Azure SQL Server instance</span><span class="sxs-lookup"><span data-stu-id="2fce9-142">Demonstrates how Contoso migrates the SmartHotel app to an Azure Web App, and migrates the app database to Azure SQL Server instance</span></span> | <span data-ttu-id="2fce9-143">This article</span><span class="sxs-lookup"><span data-stu-id="2fce9-143">This article</span></span>
[<span data-ttu-id="2fce9-144">Article 10: Refactor a Linux app to Azure Web Apps and Azure MySQL</span><span class="sxs-lookup"><span data-stu-id="2fce9-144">Article 10: Refactor a Linux app to Azure Web Apps and Azure MySQL</span></span>](contoso-migration-refactor-linux-app-service-mysql.md) | <span data-ttu-id="2fce9-145">Shows how Contoso migrates the Linux osTicket app to Azure Web Apps in multiple sites, integrated with GitHub for continuous delivery.</span><span class="sxs-lookup"><span data-stu-id="2fce9-145">Shows how Contoso migrates the Linux osTicket app to Azure Web Apps in multiple sites, integrated with GitHub for continuous delivery.</span></span> <span data-ttu-id="2fce9-146">They migrate the app database to an Azure MySQL instance.</span><span class="sxs-lookup"><span data-stu-id="2fce9-146">They migrate the app database to an Azure MySQL instance.</span></span> | <span data-ttu-id="2fce9-147">Available</span><span class="sxs-lookup"><span data-stu-id="2fce9-147">Available</span></span>
[<span data-ttu-id="2fce9-148">Article 11: Refactor TFS on Azure DevOps Services</span><span class="sxs-lookup"><span data-stu-id="2fce9-148">Article 11: Refactor TFS on Azure DevOps Services</span></span>](contoso-migration-tfs-vsts.md) | <span data-ttu-id="2fce9-149">Shows how Contoso migrates their on-premises Team Foundation Server (TFS) deployment by migrating it to Azure DevOps Services in Azure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-149">Shows how Contoso migrates their on-premises Team Foundation Server (TFS) deployment by migrating it to Azure DevOps Services in Azure.</span></span> | <span data-ttu-id="2fce9-150">Available</span><span class="sxs-lookup"><span data-stu-id="2fce9-150">Available</span></span>
[<span data-ttu-id="2fce9-151">Article 12: Rearchitect an app on Azure containers and Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="2fce9-151">Article 12: Rearchitect an app on Azure containers and Azure SQL Database</span></span>](contoso-migration-rearchitect-container-sql.md) | <span data-ttu-id="2fce9-152">Shows how Contoso migrates and rearchitects their SmartHotel app to Azure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-152">Shows how Contoso migrates and rearchitects their SmartHotel app to Azure.</span></span> <span data-ttu-id="2fce9-153">They rearchitect the app web tier as a Windows container, and the app database in an Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="2fce9-153">They rearchitect the app web tier as a Windows container, and the app database in an Azure SQL Database.</span></span> | <span data-ttu-id="2fce9-154">Available</span><span class="sxs-lookup"><span data-stu-id="2fce9-154">Available</span></span>
[<span data-ttu-id="2fce9-155">Article 13: Rebuild an app in Azure</span><span class="sxs-lookup"><span data-stu-id="2fce9-155">Article 13: Rebuild an app in Azure</span></span>](contoso-migration-rebuild.md) | <span data-ttu-id="2fce9-156">Shows how Contoso rebuild their SmartHotel app using a range of Azure capabilities and services, including App Services, Azure Kubernetes, Azure Functions, Cognitive services, and Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="2fce9-156">Shows how Contoso rebuild their SmartHotel app using a range of Azure capabilities and services, including App Services, Azure Kubernetes, Azure Functions, Cognitive services, and Cosmos DB.</span></span> | <span data-ttu-id="2fce9-157">Available</span><span class="sxs-lookup"><span data-stu-id="2fce9-157">Available</span></span>

<span data-ttu-id="2fce9-158">In this article, Contoso migrates the two-tier Windows.</span><span class="sxs-lookup"><span data-stu-id="2fce9-158">In this article, Contoso migrates the two-tier Windows.</span></span> <span data-ttu-id="2fce9-159">NET SmartHotel360 app running on VMware VMs to Azure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-159">NET SmartHotel360 app running on VMware VMs to Azure.</span></span> <span data-ttu-id="2fce9-160">If you'd like to use this app, it's provided as open source and you can download it from [GitHub](https://github.com/Microsoft/SmartHotel360).</span><span class="sxs-lookup"><span data-stu-id="2fce9-160">If you'd like to use this app, it's provided as open source and you can download it from [GitHub](https://github.com/Microsoft/SmartHotel360).</span></span>

## <a name="business-drivers"></a><span data-ttu-id="2fce9-161">Business drivers</span><span class="sxs-lookup"><span data-stu-id="2fce9-161">Business drivers</span></span>

<span data-ttu-id="2fce9-162">The IT leadership team has worked closely with business partners to understand what they want to achieve with this migration:</span><span class="sxs-lookup"><span data-stu-id="2fce9-162">The IT leadership team has worked closely with business partners to understand what they want to achieve with this migration:</span></span>

- <span data-ttu-id="2fce9-163">**Address business growth**: Contoso is growing, and there is pressure on on-premises systems and infrastructure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-163">**Address business growth**: Contoso is growing, and there is pressure on on-premises systems and infrastructure.</span></span>
- <span data-ttu-id="2fce9-164">**Increase efficiency**: Contoso needs to remove unnecessary procedures, and streamline processes for developers and users.</span><span class="sxs-lookup"><span data-stu-id="2fce9-164">**Increase efficiency**: Contoso needs to remove unnecessary procedures, and streamline processes for developers and users.</span></span>  <span data-ttu-id="2fce9-165">The business needs IT to be fast and not waste time or money, thus delivering faster on customer requirements.</span><span class="sxs-lookup"><span data-stu-id="2fce9-165">The business needs IT to be fast and not waste time or money, thus delivering faster on customer requirements.</span></span>
- <span data-ttu-id="2fce9-166">**Increase agility**:  Contoso IT needs to be more responsive to the needs of the business.</span><span class="sxs-lookup"><span data-stu-id="2fce9-166">**Increase agility**:  Contoso IT needs to be more responsive to the needs of the business.</span></span> <span data-ttu-id="2fce9-167">It must be able to react faster than the changes in the marketplace, to enable the success in a global economy.</span><span class="sxs-lookup"><span data-stu-id="2fce9-167">It must be able to react faster than the changes in the marketplace, to enable the success in a global economy.</span></span>  <span data-ttu-id="2fce9-168">It mustn't get in the way, or become a business blocker.</span><span class="sxs-lookup"><span data-stu-id="2fce9-168">It mustn't get in the way, or become a business blocker.</span></span>
- <span data-ttu-id="2fce9-169">**Scale**: As the business grows successfully, Contoso IT must provide systems that are able to grow at the same pace.</span><span class="sxs-lookup"><span data-stu-id="2fce9-169">**Scale**: As the business grows successfully, Contoso IT must provide systems that are able to grow at the same pace.</span></span>
- <span data-ttu-id="2fce9-170">**Costs**: Contoso wants to minimize licensing costs.</span><span class="sxs-lookup"><span data-stu-id="2fce9-170">**Costs**: Contoso wants to minimize licensing costs.</span></span>

## <a name="migration-goals"></a><span data-ttu-id="2fce9-171">Migration goals</span><span class="sxs-lookup"><span data-stu-id="2fce9-171">Migration goals</span></span>

<span data-ttu-id="2fce9-172">The Contoso cloud team has pinned down goals for this migration.</span><span class="sxs-lookup"><span data-stu-id="2fce9-172">The Contoso cloud team has pinned down goals for this migration.</span></span> <span data-ttu-id="2fce9-173">These goals were used to determine the best migration method.</span><span class="sxs-lookup"><span data-stu-id="2fce9-173">These goals were used to determine the best migration method.</span></span>

<span data-ttu-id="2fce9-174">**Requirements**</span><span class="sxs-lookup"><span data-stu-id="2fce9-174">**Requirements**</span></span> | <span data-ttu-id="2fce9-175">**Details**</span><span class="sxs-lookup"><span data-stu-id="2fce9-175">**Details**</span></span>
--- | --- 
<span data-ttu-id="2fce9-176">**App**</span><span class="sxs-lookup"><span data-stu-id="2fce9-176">**App**</span></span> | <span data-ttu-id="2fce9-177">The app in Azure will remain as critical as it is today.</span><span class="sxs-lookup"><span data-stu-id="2fce9-177">The app in Azure will remain as critical as it is today.</span></span><br/><br/> <span data-ttu-id="2fce9-178">It should have the same performance capabilities as it currently does in VMWare.</span><span class="sxs-lookup"><span data-stu-id="2fce9-178">It should have the same performance capabilities as it currently does in VMWare.</span></span><br/><br/> <span data-ttu-id="2fce9-179">The team doesn't want to invest in the app.</span><span class="sxs-lookup"><span data-stu-id="2fce9-179">The team doesn't want to invest in the app.</span></span> <span data-ttu-id="2fce9-180">For now, admins will simply move the app safely to the cloud.</span><span class="sxs-lookup"><span data-stu-id="2fce9-180">For now, admins will simply move the app safely to the cloud.</span></span><br/><br/> <span data-ttu-id="2fce9-181">The team want to stop supporting Windows Server 2008 R2, on which the app currently runs.</span><span class="sxs-lookup"><span data-stu-id="2fce9-181">The team want to stop supporting Windows Server 2008 R2, on which the app currently runs.</span></span><br/><br/> <span data-ttu-id="2fce9-182">The team also wants to move away from SQL Server 2008 R2 to a modern PaaS Database platform, which will minimize the need for management.</span><span class="sxs-lookup"><span data-stu-id="2fce9-182">The team also wants to move away from SQL Server 2008 R2 to a modern PaaS Database platform, which will minimize the need for management.</span></span><br/><br/> <span data-ttu-id="2fce9-183">Contoso want to leverage its investment in SQL Server licensing and Software Assurance where possible.</span><span class="sxs-lookup"><span data-stu-id="2fce9-183">Contoso want to leverage its investment in SQL Server licensing and Software Assurance where possible.</span></span><br/><br/> <span data-ttu-id="2fce9-184">In addition, Contoso wants to mitigate the single point of failure on the web tier.</span><span class="sxs-lookup"><span data-stu-id="2fce9-184">In addition, Contoso wants to mitigate the single point of failure on the web tier.</span></span>
<span data-ttu-id="2fce9-185">**Limitations**</span><span class="sxs-lookup"><span data-stu-id="2fce9-185">**Limitations**</span></span> | <span data-ttu-id="2fce9-186">The app consists of an ASP.NET app and a WCF service running on the same VM.</span><span class="sxs-lookup"><span data-stu-id="2fce9-186">The app consists of an ASP.NET app and a WCF service running on the same VM.</span></span> <span data-ttu-id="2fce9-187">They want to split this across two web apps using the Azure App Service.</span><span class="sxs-lookup"><span data-stu-id="2fce9-187">They want to split this across two web apps using the Azure App Service.</span></span> 
<span data-ttu-id="2fce9-188">**Azure**</span><span class="sxs-lookup"><span data-stu-id="2fce9-188">**Azure**</span></span> | <span data-ttu-id="2fce9-189">Contoso wants to move the app to Azure, but doesn't want to run it on VMs.</span><span class="sxs-lookup"><span data-stu-id="2fce9-189">Contoso wants to move the app to Azure, but doesn't want to run it on VMs.</span></span> <span data-ttu-id="2fce9-190">Contoso wants to leverage Azure PaaS services for both the web and data tiers.</span><span class="sxs-lookup"><span data-stu-id="2fce9-190">Contoso wants to leverage Azure PaaS services for both the web and data tiers.</span></span> 
<span data-ttu-id="2fce9-191">**DevOps**</span><span class="sxs-lookup"><span data-stu-id="2fce9-191">**DevOps**</span></span> | <span data-ttu-id="2fce9-192">Contoso wants to move to a DevOps model, using Visual Studio Team Services (VSTS) for their builds and release pipelines.</span><span class="sxs-lookup"><span data-stu-id="2fce9-192">Contoso wants to move to a DevOps model, using Visual Studio Team Services (VSTS) for their builds and release pipelines.</span></span>

## <a name="solution-design"></a><span data-ttu-id="2fce9-193">Solution design</span><span class="sxs-lookup"><span data-stu-id="2fce9-193">Solution design</span></span>

<span data-ttu-id="2fce9-194">After pinning down goals and requirements, Contoso designs and review a deployment solution, and identifies the migration process, including the Azure services that will be used for migration.</span><span class="sxs-lookup"><span data-stu-id="2fce9-194">After pinning down goals and requirements, Contoso designs and review a deployment solution, and identifies the migration process, including the Azure services that will be used for migration.</span></span>

### <a name="current-app"></a><span data-ttu-id="2fce9-195">Current app</span><span class="sxs-lookup"><span data-stu-id="2fce9-195">Current app</span></span>

- <span data-ttu-id="2fce9-196">The SmartHotel360 on-premises app is tiered across two VMs (WEBVM and SQLVM).</span><span class="sxs-lookup"><span data-stu-id="2fce9-196">The SmartHotel360 on-premises app is tiered across two VMs (WEBVM and SQLVM).</span></span>
- <span data-ttu-id="2fce9-197">The VMs are located on VMware ESXi host **contosohost1.contoso.com** (version 6.5)</span><span class="sxs-lookup"><span data-stu-id="2fce9-197">The VMs are located on VMware ESXi host **contosohost1.contoso.com** (version 6.5)</span></span>
- <span data-ttu-id="2fce9-198">The VMware environment is managed by vCenter Server 6.5 (**vcenter.contoso.com**), running on a VM.</span><span class="sxs-lookup"><span data-stu-id="2fce9-198">The VMware environment is managed by vCenter Server 6.5 (**vcenter.contoso.com**), running on a VM.</span></span>
- <span data-ttu-id="2fce9-199">Contoso has an on-premises datacenter (contoso-datacenter), with an on-premises domain controller (**contosodc1**).</span><span class="sxs-lookup"><span data-stu-id="2fce9-199">Contoso has an on-premises datacenter (contoso-datacenter), with an on-premises domain controller (**contosodc1**).</span></span>
- <span data-ttu-id="2fce9-200">The on-premises VMs in the Contoso datacenter will be decommissioned after the migration is done.</span><span class="sxs-lookup"><span data-stu-id="2fce9-200">The on-premises VMs in the Contoso datacenter will be decommissioned after the migration is done.</span></span>


### <a name="proposed-solution"></a><span data-ttu-id="2fce9-201">Proposed solution</span><span class="sxs-lookup"><span data-stu-id="2fce9-201">Proposed solution</span></span>

- <span data-ttu-id="2fce9-202">For the database tier of the app, Contoso compared Azure SQL Database with SQL Server using [this article](https://docs.microsoft.com/azure/sql-database/sql-database-features).</span><span class="sxs-lookup"><span data-stu-id="2fce9-202">For the database tier of the app, Contoso compared Azure SQL Database with SQL Server using [this article](https://docs.microsoft.com/azure/sql-database/sql-database-features).</span></span> <span data-ttu-id="2fce9-203">Contoso decided to go with Azure SQL Database for a few reasons:</span><span class="sxs-lookup"><span data-stu-id="2fce9-203">Contoso decided to go with Azure SQL Database for a few reasons:</span></span>
    - <span data-ttu-id="2fce9-204">Azure SQL Database is a relational-database managed service.</span><span class="sxs-lookup"><span data-stu-id="2fce9-204">Azure SQL Database is a relational-database managed service.</span></span> <span data-ttu-id="2fce9-205">It delivers predictable performance at multiple service levels, with near-zero administration.</span><span class="sxs-lookup"><span data-stu-id="2fce9-205">It delivers predictable performance at multiple service levels, with near-zero administration.</span></span> <span data-ttu-id="2fce9-206">Advantages include dynamic scalability with no downtime, built-in intelligent optimization, and global scalability and availability.</span><span class="sxs-lookup"><span data-stu-id="2fce9-206">Advantages include dynamic scalability with no downtime, built-in intelligent optimization, and global scalability and availability.</span></span>
    - <span data-ttu-id="2fce9-207">Contoso can leverage the lightweight Data Migration Assistant (DMA) to assess and migrate the on-premises database to Azure SQL.</span><span class="sxs-lookup"><span data-stu-id="2fce9-207">Contoso can leverage the lightweight Data Migration Assistant (DMA) to assess and migrate the on-premises database to Azure SQL.</span></span>
    - <span data-ttu-id="2fce9-208">With Software Assurance, Contoso can exchange existing licenses for discounted rates on a SQL Database, using the Azure Hybrid Benefit for SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2fce9-208">With Software Assurance, Contoso can exchange existing licenses for discounted rates on a SQL Database, using the Azure Hybrid Benefit for SQL Server.</span></span> <span data-ttu-id="2fce9-209">This could provide savings of up to 30%.</span><span class="sxs-lookup"><span data-stu-id="2fce9-209">This could provide savings of up to 30%.</span></span>
    - <span data-ttu-id="2fce9-210">SQL Database provides a number of security features including always encrypted, dynamic data masking, and row-level security/threat detection.</span><span class="sxs-lookup"><span data-stu-id="2fce9-210">SQL Database provides a number of security features including always encrypted, dynamic data masking, and row-level security/threat detection.</span></span>
- <span data-ttu-id="2fce9-211">For the app web tier, Contoso has decided to use Azure App Service.</span><span class="sxs-lookup"><span data-stu-id="2fce9-211">For the app web tier, Contoso has decided to use Azure App Service.</span></span> <span data-ttu-id="2fce9-212">This PaaS service enables that to deploy the app with just a few configuration changes.</span><span class="sxs-lookup"><span data-stu-id="2fce9-212">This PaaS service enables that to deploy the app with just a few configuration changes.</span></span> <span data-ttu-id="2fce9-213">Contoso will use Visual Studio to make the change, and deploy two web apps.</span><span class="sxs-lookup"><span data-stu-id="2fce9-213">Contoso will use Visual Studio to make the change, and deploy two web apps.</span></span> <span data-ttu-id="2fce9-214">One for the website, and one for the WCF service.</span><span class="sxs-lookup"><span data-stu-id="2fce9-214">One for the website, and one for the WCF service.</span></span>
- <span data-ttu-id="2fce9-215">To meet requirements for a DevOps pipeline, Contoso has selected to use VSTS.</span><span class="sxs-lookup"><span data-stu-id="2fce9-215">To meet requirements for a DevOps pipeline, Contoso has selected to use VSTS.</span></span> <span data-ttu-id="2fce9-216">They'll deploy VSTS for Source Code Management (SCM) with Git repos.</span><span class="sxs-lookup"><span data-stu-id="2fce9-216">They'll deploy VSTS for Source Code Management (SCM) with Git repos.</span></span> <span data-ttu-id="2fce9-217">Automated builds and release will be used to build the code, and deploy it to the Azure Web Apps.</span><span class="sxs-lookup"><span data-stu-id="2fce9-217">Automated builds and release will be used to build the code, and deploy it to the Azure Web Apps.</span></span>
  
### <a name="solution-review"></a><span data-ttu-id="2fce9-218">Solution review</span><span class="sxs-lookup"><span data-stu-id="2fce9-218">Solution review</span></span>
<span data-ttu-id="2fce9-219">Contoso evaluates their proposed design by putting together a pros and cons list.</span><span class="sxs-lookup"><span data-stu-id="2fce9-219">Contoso evaluates their proposed design by putting together a pros and cons list.</span></span>

<span data-ttu-id="2fce9-220">**Consideration**</span><span class="sxs-lookup"><span data-stu-id="2fce9-220">**Consideration**</span></span> | <span data-ttu-id="2fce9-221">**Details**</span><span class="sxs-lookup"><span data-stu-id="2fce9-221">**Details**</span></span>
--- | ---
<span data-ttu-id="2fce9-222">**Pros**</span><span class="sxs-lookup"><span data-stu-id="2fce9-222">**Pros**</span></span> | <span data-ttu-id="2fce9-223">The SmartHotel360 app code won't need to be altered for migration to Azure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-223">The SmartHotel360 app code won't need to be altered for migration to Azure.</span></span><br/><br/> <span data-ttu-id="2fce9-224">Contoso can leverage their investment in Software Assurance using the Azure Hybrid Benefit for both SQL Server and Windows Server.</span><span class="sxs-lookup"><span data-stu-id="2fce9-224">Contoso can leverage their investment in Software Assurance using the Azure Hybrid Benefit for both SQL Server and Windows Server.</span></span><br/><br/> <span data-ttu-id="2fce9-225">After the migration Windows Server 2008 R2 won't need to be supported.</span><span class="sxs-lookup"><span data-stu-id="2fce9-225">After the migration Windows Server 2008 R2 won't need to be supported.</span></span> <span data-ttu-id="2fce9-226">[Learn more](https://support.microsoft.com/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="2fce9-226">[Learn more](https://support.microsoft.com/lifecycle).</span></span><br/><br/> <span data-ttu-id="2fce9-227">Contoso can configure the web tier of the app with multiple instances, so that it's no longer a single point of failure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-227">Contoso can configure the web tier of the app with multiple instances, so that it's no longer a single point of failure.</span></span><br/><br/> <span data-ttu-id="2fce9-228">The database will no longer be dependent on the aging SQL Server 2008 R2.</span><span class="sxs-lookup"><span data-stu-id="2fce9-228">The database will no longer be dependent on the aging SQL Server 2008 R2.</span></span><br/><br/> <span data-ttu-id="2fce9-229">SQL Database supports the technical requirements.</span><span class="sxs-lookup"><span data-stu-id="2fce9-229">SQL Database supports the technical requirements.</span></span> <span data-ttu-id="2fce9-230">Contoso assessed the on-premises database using the Database Migration Assistant and found that it's compatible.</span><span class="sxs-lookup"><span data-stu-id="2fce9-230">Contoso assessed the on-premises database using the Database Migration Assistant and found that it's compatible.</span></span><br/><br/> <span data-ttu-id="2fce9-231">SQL Database has built-in fault tolerance that Contoso don't need to set up.</span><span class="sxs-lookup"><span data-stu-id="2fce9-231">SQL Database has built-in fault tolerance that Contoso don't need to set up.</span></span> <span data-ttu-id="2fce9-232">This ensures that the data tier is no longer a single point of failover.</span><span class="sxs-lookup"><span data-stu-id="2fce9-232">This ensures that the data tier is no longer a single point of failover.</span></span>
<span data-ttu-id="2fce9-233">**Cons**</span><span class="sxs-lookup"><span data-stu-id="2fce9-233">**Cons**</span></span> | <span data-ttu-id="2fce9-234">Azure App Services only supports one app deployment for each Web App.</span><span class="sxs-lookup"><span data-stu-id="2fce9-234">Azure App Services only supports one app deployment for each Web App.</span></span> <span data-ttu-id="2fce9-235">This means that two Web Apps must be provisioned (one for the website and one for the WCF service).</span><span class="sxs-lookup"><span data-stu-id="2fce9-235">This means that two Web Apps must be provisioned (one for the website and one for the WCF service).</span></span><br/><br/> <span data-ttu-id="2fce9-236">If Contoso uses the Data Migration Assistant instead of Data Migration Service to migrate their database, it won’t have the infrastructure ready for migrating databases at scale.</span><span class="sxs-lookup"><span data-stu-id="2fce9-236">If Contoso uses the Data Migration Assistant instead of Data Migration Service to migrate their database, it won’t have the infrastructure ready for migrating databases at scale.</span></span> <span data-ttu-id="2fce9-237">Contoso will need to build another region to ensure failover if the primary region is unavailable.</span><span class="sxs-lookup"><span data-stu-id="2fce9-237">Contoso will need to build another region to ensure failover if the primary region is unavailable.</span></span>

## <a name="proposed-architecture"></a><span data-ttu-id="2fce9-238">Proposed architecture</span><span class="sxs-lookup"><span data-stu-id="2fce9-238">Proposed architecture</span></span>

![Scenario architecture](media/contoso-migration-refactor-web-app-sql/architecture.png) 


### <a name="migration-process"></a><span data-ttu-id="2fce9-240">Migration process</span><span class="sxs-lookup"><span data-stu-id="2fce9-240">Migration process</span></span>

1. <span data-ttu-id="2fce9-241">Contoso provisions an Azure SQL instance, and migrates the SmartHotel360 database to it.</span><span class="sxs-lookup"><span data-stu-id="2fce9-241">Contoso provisions an Azure SQL instance, and migrates the SmartHotel360 database to it.</span></span>
2. <span data-ttu-id="2fce9-242">Contoso provisions and configures Web Apps, and deploys the SmartHotel360 app to them.</span><span class="sxs-lookup"><span data-stu-id="2fce9-242">Contoso provisions and configures Web Apps, and deploys the SmartHotel360 app to them.</span></span>

    ![Migration process](media/contoso-migration-refactor-web-app-sql/migration-process.png) 

### <a name="azure-services"></a><span data-ttu-id="2fce9-244">Azure services</span><span class="sxs-lookup"><span data-stu-id="2fce9-244">Azure services</span></span>

<span data-ttu-id="2fce9-245">**Service**</span><span class="sxs-lookup"><span data-stu-id="2fce9-245">**Service**</span></span> | <span data-ttu-id="2fce9-246">**Description**</span><span class="sxs-lookup"><span data-stu-id="2fce9-246">**Description**</span></span> | <span data-ttu-id="2fce9-247">**Cost**</span><span class="sxs-lookup"><span data-stu-id="2fce9-247">**Cost**</span></span>
--- | --- | ---
[<span data-ttu-id="2fce9-248">Database Migration Assistant (DMA)</span><span class="sxs-lookup"><span data-stu-id="2fce9-248">Database Migration Assistant (DMA)</span></span>](https://docs.microsoft.com/sql/dma/dma-overview?view=ssdt-18vs2017) | <span data-ttu-id="2fce9-249">Contoso will use DMA to assess and detect compatibility issues that might impact their database functionality in Azure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-249">Contoso will use DMA to assess and detect compatibility issues that might impact their database functionality in Azure.</span></span> <span data-ttu-id="2fce9-250">DMA assesses feature parity between SQL sources and targets, and recommends performance and reliability improvements.</span><span class="sxs-lookup"><span data-stu-id="2fce9-250">DMA assesses feature parity between SQL sources and targets, and recommends performance and reliability improvements.</span></span> | <span data-ttu-id="2fce9-251">It's a downloadable tool free of charge.</span><span class="sxs-lookup"><span data-stu-id="2fce9-251">It's a downloadable tool free of charge.</span></span>
[<span data-ttu-id="2fce9-252">Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="2fce9-252">Azure SQL Database</span></span>](https://azure.microsoft.com/services/sql-database/) | <span data-ttu-id="2fce9-253">An intelligent, fully managed relational cloud database service.</span><span class="sxs-lookup"><span data-stu-id="2fce9-253">An intelligent, fully managed relational cloud database service.</span></span> | <span data-ttu-id="2fce9-254">Cost based on features, throughput, and size.</span><span class="sxs-lookup"><span data-stu-id="2fce9-254">Cost based on features, throughput, and size.</span></span> <span data-ttu-id="2fce9-255">[Learn more](https://azure.microsoft.com/pricing/details/sql-database/managed/).</span><span class="sxs-lookup"><span data-stu-id="2fce9-255">[Learn more](https://azure.microsoft.com/pricing/details/sql-database/managed/).</span></span>
[<span data-ttu-id="2fce9-256">Azure App Services - Web Apps</span><span class="sxs-lookup"><span data-stu-id="2fce9-256">Azure App Services - Web Apps</span></span>](https://docs.microsoft.com/azure/app-service/app-service-web-overview) | <span data-ttu-id="2fce9-257">Create powerful cloud apps using a fully managed platform</span><span class="sxs-lookup"><span data-stu-id="2fce9-257">Create powerful cloud apps using a fully managed platform</span></span> | <span data-ttu-id="2fce9-258">Cost based on size, location, and usage duration.</span><span class="sxs-lookup"><span data-stu-id="2fce9-258">Cost based on size, location, and usage duration.</span></span> <span data-ttu-id="2fce9-259">[Learn more](https://azure.microsoft.com/pricing/details/app-service/windows/).</span><span class="sxs-lookup"><span data-stu-id="2fce9-259">[Learn more](https://azure.microsoft.com/pricing/details/app-service/windows/).</span></span>

## <a name="prerequisites"></a><span data-ttu-id="2fce9-260">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="2fce9-260">Prerequisites</span></span>

<span data-ttu-id="2fce9-261">Here's Contoso needs to run this scenario:</span><span class="sxs-lookup"><span data-stu-id="2fce9-261">Here's Contoso needs to run this scenario:</span></span>

<span data-ttu-id="2fce9-262">**Requirements**</span><span class="sxs-lookup"><span data-stu-id="2fce9-262">**Requirements**</span></span> | <span data-ttu-id="2fce9-263">**Details**</span><span class="sxs-lookup"><span data-stu-id="2fce9-263">**Details**</span></span>
--- | ---
<span data-ttu-id="2fce9-264">**Azure subscription**</span><span class="sxs-lookup"><span data-stu-id="2fce9-264">**Azure subscription**</span></span> | <span data-ttu-id="2fce9-265">Contoso created subscriptions during an early article.</span><span class="sxs-lookup"><span data-stu-id="2fce9-265">Contoso created subscriptions during an early article.</span></span> <span data-ttu-id="2fce9-266">If you don't have an Azure subscription, create a [free account](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="2fce9-266">If you don't have an Azure subscription, create a [free account](https://azure.microsoft.com/pricing/free-trial/).</span></span><br/><br/> <span data-ttu-id="2fce9-267">If you create a free account, you're the administrator of your subscription and can perform all actions.</span><span class="sxs-lookup"><span data-stu-id="2fce9-267">If you create a free account, you're the administrator of your subscription and can perform all actions.</span></span><br/><br/> <span data-ttu-id="2fce9-268">If you use an existing subscription and you're not the administrator, you need to work with the admin to assign you Owner or Contributor permissions.</span><span class="sxs-lookup"><span data-stu-id="2fce9-268">If you use an existing subscription and you're not the administrator, you need to work with the admin to assign you Owner or Contributor permissions.</span></span>
<span data-ttu-id="2fce9-269">**Azure infrastructure**</span><span class="sxs-lookup"><span data-stu-id="2fce9-269">**Azure infrastructure**</span></span> | <span data-ttu-id="2fce9-270">[Learn how](contoso-migration-infrastructure.md) Contoso set up an Azure infrastructure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-270">[Learn how](contoso-migration-infrastructure.md) Contoso set up an Azure infrastructure.</span></span>


## <a name="scenario-steps"></a><span data-ttu-id="2fce9-271">Scenario steps</span><span class="sxs-lookup"><span data-stu-id="2fce9-271">Scenario steps</span></span>

<span data-ttu-id="2fce9-272">Here's how Contoso will run the migration:</span><span class="sxs-lookup"><span data-stu-id="2fce9-272">Here's how Contoso will run the migration:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="2fce9-273">**Step 1: Provision a SQL Database instance in Azure**: Contoso provisions a SQL instance in Azure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-273">**Step 1: Provision a SQL Database instance in Azure**: Contoso provisions a SQL instance in Azure.</span></span> <span data-ttu-id="2fce9-274">After the app website is migrate to Azure, the WCF service web app will point to this instance.</span><span class="sxs-lookup"><span data-stu-id="2fce9-274">After the app website is migrate to Azure, the WCF service web app will point to this instance.</span></span>
> * <span data-ttu-id="2fce9-275">**Step 2: Migrate the database with DMA**: Contoso migrates the app database with the Database Migration Assistant.</span><span class="sxs-lookup"><span data-stu-id="2fce9-275">**Step 2: Migrate the database with DMA**: Contoso migrates the app database with the Database Migration Assistant.</span></span>
> * <span data-ttu-id="2fce9-276">**Step 3: Provision Web Apps**: Contoso provisions the two web apps.</span><span class="sxs-lookup"><span data-stu-id="2fce9-276">**Step 3: Provision Web Apps**: Contoso provisions the two web apps.</span></span>
> * <span data-ttu-id="2fce9-277">**Step 4: Set up VSTS**: Contoso creates a new VSTS project, and imports the Git repo.</span><span class="sxs-lookup"><span data-stu-id="2fce9-277">**Step 4: Set up VSTS**: Contoso creates a new VSTS project, and imports the Git repo.</span></span>
> * <span data-ttu-id="2fce9-278">**Step 5: Configure connection strings**: Contoso configures connection strings so that the web tier web app, the WCF service web app, and the SQL instance can communicate.</span><span class="sxs-lookup"><span data-stu-id="2fce9-278">**Step 5: Configure connection strings**: Contoso configures connection strings so that the web tier web app, the WCF service web app, and the SQL instance can communicate.</span></span>
> * <span data-ttu-id="2fce9-279">**Step 6: Set up build and release pipelines in VSTS**: As a final step, Contoso sets up build and release pipelines to create the app, and deploys them to two separate Azure Web Apps.</span><span class="sxs-lookup"><span data-stu-id="2fce9-279">**Step 6: Set up build and release pipelines in VSTS**: As a final step, Contoso sets up build and release pipelines to create the app, and deploys them to two separate Azure Web Apps.</span></span>


## <a name="step-1-provision-an-azure-sql-database"></a><span data-ttu-id="2fce9-280">Step 1: Provision an Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="2fce9-280">Step 1: Provision an Azure SQL Database</span></span>

1. <span data-ttu-id="2fce9-281">Contoso admins select to create a SQL Database in Azure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-281">Contoso admins select to create a SQL Database in Azure.</span></span> 

    ![Provision SQL](media/contoso-migration-refactor-web-app-sql/provision-sql1.png)

2. <span data-ttu-id="2fce9-283">They specify a database  name to match the database running on the on-premises VM (**SmartHotel.Registration**).</span><span class="sxs-lookup"><span data-stu-id="2fce9-283">They specify a database  name to match the database running on the on-premises VM (**SmartHotel.Registration**).</span></span> <span data-ttu-id="2fce9-284">They place the database in the ContosoRG resource group.</span><span class="sxs-lookup"><span data-stu-id="2fce9-284">They place the database in the ContosoRG resource group.</span></span> <span data-ttu-id="2fce9-285">This is the resource group they use for production resources in Azure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-285">This is the resource group they use for production resources in Azure.</span></span>

    ![Provision SQL](media/contoso-migration-refactor-web-app-sql/provision-sql2.png)

3. <span data-ttu-id="2fce9-287">They set up a new SQL Server instance (**sql-smarthotel-eus2**) in the primary region.</span><span class="sxs-lookup"><span data-stu-id="2fce9-287">They set up a new SQL Server instance (**sql-smarthotel-eus2**) in the primary region.</span></span>

    ![Provision SQL](media/contoso-migration-refactor-web-app-sql/provision-sql3.png)

4. <span data-ttu-id="2fce9-289">They set the pricing tier to match their server and database needs.</span><span class="sxs-lookup"><span data-stu-id="2fce9-289">They set the pricing tier to match their server and database needs.</span></span> <span data-ttu-id="2fce9-290">And they select to save money with Azure Hybrid Benefit because they already have a SQL Server license.</span><span class="sxs-lookup"><span data-stu-id="2fce9-290">And they select to save money with Azure Hybrid Benefit because they already have a SQL Server license.</span></span>
5. <span data-ttu-id="2fce9-291">For sizing they use v-Core-based purchasing, and set the limits for their expected requirements.</span><span class="sxs-lookup"><span data-stu-id="2fce9-291">For sizing they use v-Core-based purchasing, and set the limits for their expected requirements.</span></span>

    ![Provision SQL](media/contoso-migration-refactor-web-app-sql/provision-sql4.png)

6. <span data-ttu-id="2fce9-293">Then they create the database instance.</span><span class="sxs-lookup"><span data-stu-id="2fce9-293">Then they create the database instance.</span></span>

    ![Provision SQL](media/contoso-migration-refactor-web-app-sql/provision-sql5.png)

7. <span data-ttu-id="2fce9-295">After the instance is created, they open the database, and note details they need when they use the Database Migration Assistance for migration.</span><span class="sxs-lookup"><span data-stu-id="2fce9-295">After the instance is created, they open the database, and note details they need when they use the Database Migration Assistance for migration.</span></span>

    ![Provision SQL](media/contoso-migration-refactor-web-app-sql/provision-sql6.png)


<span data-ttu-id="2fce9-297">**Need more help?**</span><span class="sxs-lookup"><span data-stu-id="2fce9-297">**Need more help?**</span></span>

- <span data-ttu-id="2fce9-298">[Get help](https://docs.microsoft.com/azure/sql-database/sql-database-get-started-portal) provisioning a SQL Database.</span><span class="sxs-lookup"><span data-stu-id="2fce9-298">[Get help](https://docs.microsoft.com/azure/sql-database/sql-database-get-started-portal) provisioning a SQL Database.</span></span>
- <span data-ttu-id="2fce9-299">[Learn about](https://docs.microsoft.com/azure/sql-database/sql-database-vcore-resource-limits-elastic-pools) v-Core resource limits.</span><span class="sxs-lookup"><span data-stu-id="2fce9-299">[Learn about](https://docs.microsoft.com/azure/sql-database/sql-database-vcore-resource-limits-elastic-pools) v-Core resource limits.</span></span>


## <a name="step-2-migrate-the-database-with-dma"></a><span data-ttu-id="2fce9-300">Step 2: Migrate the database with DMA</span><span class="sxs-lookup"><span data-stu-id="2fce9-300">Step 2: Migrate the database with DMA</span></span>

<span data-ttu-id="2fce9-301">Contoso admins will migrate the SmartHotel360 database using DMA.</span><span class="sxs-lookup"><span data-stu-id="2fce9-301">Contoso admins will migrate the SmartHotel360 database using DMA.</span></span>

### <a name="install-dma"></a><span data-ttu-id="2fce9-302">Install DMA</span><span class="sxs-lookup"><span data-stu-id="2fce9-302">Install DMA</span></span>

1. <span data-ttu-id="2fce9-303">They download the tool from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=53595) to the on-premises SQL Server VM (**SQLVM**).</span><span class="sxs-lookup"><span data-stu-id="2fce9-303">They download the tool from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=53595) to the on-premises SQL Server VM (**SQLVM**).</span></span>
2. <span data-ttu-id="2fce9-304">They run setup (DownloadMigrationAssistant.msi) on the VM.</span><span class="sxs-lookup"><span data-stu-id="2fce9-304">They run setup (DownloadMigrationAssistant.msi) on the VM.</span></span>
3. <span data-ttu-id="2fce9-305">On the **Finish** page, they select **Launch Microsoft Data Migration Assistant** before finishing the wizard.</span><span class="sxs-lookup"><span data-stu-id="2fce9-305">On the **Finish** page, they select **Launch Microsoft Data Migration Assistant** before finishing the wizard.</span></span>

### <a name="migrate-the-database-with-dma"></a><span data-ttu-id="2fce9-306">Migrate the database with DMA</span><span class="sxs-lookup"><span data-stu-id="2fce9-306">Migrate the database with DMA</span></span>

1. <span data-ttu-id="2fce9-307">In the DMA, they create a new project (**SmartHotelDB**) and select **Migration**</span><span class="sxs-lookup"><span data-stu-id="2fce9-307">In the DMA, they create a new project (**SmartHotelDB**) and select **Migration**</span></span> 
2. <span data-ttu-id="2fce9-308">They select the source server type as **SQL Server**, and the target as **Azure SQL Database**.</span><span class="sxs-lookup"><span data-stu-id="2fce9-308">They select the source server type as **SQL Server**, and the target as **Azure SQL Database**.</span></span> 

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-1.png)

3. <span data-ttu-id="2fce9-310">In the migration details, they add **SQLVM** as the source server, and the **SmartHotel.Registration** database.</span><span class="sxs-lookup"><span data-stu-id="2fce9-310">In the migration details, they add **SQLVM** as the source server, and the **SmartHotel.Registration** database.</span></span> 

     ![DMA](media/contoso-migration-refactor-web-app-sql/dma-2.png)

4. <span data-ttu-id="2fce9-312">They receive an error which seems to be associated with authentication.</span><span class="sxs-lookup"><span data-stu-id="2fce9-312">They receive an error which seems to be associated with authentication.</span></span> <span data-ttu-id="2fce9-313">However after investigating, the issue is the period (.) in the database name.</span><span class="sxs-lookup"><span data-stu-id="2fce9-313">However after investigating, the issue is the period (.) in the database name.</span></span> <span data-ttu-id="2fce9-314">As a workaround, they decided to provision a new SQL database using the name **SmartHotel-Registration**, to resolve the issue.</span><span class="sxs-lookup"><span data-stu-id="2fce9-314">As a workaround, they decided to provision a new SQL database using the name **SmartHotel-Registration**, to resolve the issue.</span></span> <span data-ttu-id="2fce9-315">When they run DMA again, they're able to select **SmartHotel-Registration**, and continue with the wizard.</span><span class="sxs-lookup"><span data-stu-id="2fce9-315">When they run DMA again, they're able to select **SmartHotel-Registration**, and continue with the wizard.</span></span>

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-3.png)

5. <span data-ttu-id="2fce9-317">In **Select Objects**, they select the database tables, and generate a SQL script.</span><span class="sxs-lookup"><span data-stu-id="2fce9-317">In **Select Objects**, they select the database tables, and generate a SQL script.</span></span>

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-4.png)

6. <span data-ttu-id="2fce9-319">After DMS creates the script, they click **Deploy schema**.</span><span class="sxs-lookup"><span data-stu-id="2fce9-319">After DMS creates the script, they click **Deploy schema**.</span></span>

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-5.png)

7. <span data-ttu-id="2fce9-321">DMA confirms that the deployment succeeded.</span><span class="sxs-lookup"><span data-stu-id="2fce9-321">DMA confirms that the deployment succeeded.</span></span>

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-6.png)

8. <span data-ttu-id="2fce9-323">Now they start the migration.</span><span class="sxs-lookup"><span data-stu-id="2fce9-323">Now they start the migration.</span></span>

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-7.png)

9. <span data-ttu-id="2fce9-325">After the migration finishes, Contoso admins can verify that the database is running on the Azure SQL instance.</span><span class="sxs-lookup"><span data-stu-id="2fce9-325">After the migration finishes, Contoso admins can verify that the database is running on the Azure SQL instance.</span></span>

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-8.png)

10. <span data-ttu-id="2fce9-327">They delete the extra SQL database **SmartHotel.Registration** in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="2fce9-327">They delete the extra SQL database **SmartHotel.Registration** in the Azure portal.</span></span>

    ![DMA](media/contoso-migration-refactor-web-app-sql/dma-9.png)


## <a name="step-3-provision-web-apps"></a><span data-ttu-id="2fce9-329">Step 3: Provision Web Apps</span><span class="sxs-lookup"><span data-stu-id="2fce9-329">Step 3: Provision Web Apps</span></span>

<span data-ttu-id="2fce9-330">With the database migrated, Contoso admins can now provision the two web apps.</span><span class="sxs-lookup"><span data-stu-id="2fce9-330">With the database migrated, Contoso admins can now provision the two web apps.</span></span>

1. <span data-ttu-id="2fce9-331">They select **Web App** in the portal.</span><span class="sxs-lookup"><span data-stu-id="2fce9-331">They select **Web App** in the portal.</span></span>

    ![Web app](media/contoso-migration-refactor-web-app-sql/web-app1.png)

2. <span data-ttu-id="2fce9-333">They provide an app name (**SHWEB-EUS2**), run it on Windows, and place it un the production resources group **ContosoRG**.</span><span class="sxs-lookup"><span data-stu-id="2fce9-333">They provide an app name (**SHWEB-EUS2**), run it on Windows, and place it un the production resources group **ContosoRG**.</span></span> <span data-ttu-id="2fce9-334">They create a new app service and plan.</span><span class="sxs-lookup"><span data-stu-id="2fce9-334">They create a new app service and plan.</span></span>

    ![Web app](media/contoso-migration-refactor-web-app-sql/web-app2.png)

3. <span data-ttu-id="2fce9-336">After the web app is provisioned, they repeat the process to create a web app for the WCF service (**SHWCF-EUS2**)</span><span class="sxs-lookup"><span data-stu-id="2fce9-336">After the web app is provisioned, they repeat the process to create a web app for the WCF service (**SHWCF-EUS2**)</span></span>

    ![Web app](media/contoso-migration-refactor-web-app-sql/web-app3.png)

4. <span data-ttu-id="2fce9-338">After they're done, they browse to the address of the apps to check they've been created successfully.</span><span class="sxs-lookup"><span data-stu-id="2fce9-338">After they're done, they browse to the address of the apps to check they've been created successfully.</span></span>


## <a name="step-4-set-up-vsts"></a><span data-ttu-id="2fce9-339">Step 4: Set up VSTS</span><span class="sxs-lookup"><span data-stu-id="2fce9-339">Step 4: Set up VSTS</span></span>


<span data-ttu-id="2fce9-340">Contoso needs to build the DevOps infrastructure and pipelines for the application.</span><span class="sxs-lookup"><span data-stu-id="2fce9-340">Contoso needs to build the DevOps infrastructure and pipelines for the application.</span></span>  <span data-ttu-id="2fce9-341">To do this, Contoso admins create a new VSTS project, import the code, and then set up build and release pipelines.</span><span class="sxs-lookup"><span data-stu-id="2fce9-341">To do this, Contoso admins create a new VSTS project, import the code, and then set up build and release pipelines.</span></span>

1.   <span data-ttu-id="2fce9-342">In the Contoso VSTS account, they create a new project (**ContosoSmartHotelRefactor**), and select **Git** for version control.</span><span class="sxs-lookup"><span data-stu-id="2fce9-342">In the Contoso VSTS account, they create a new project (**ContosoSmartHotelRefactor**), and select **Git** for version control.</span></span>

    ![New project](./media/contoso-migration-refactor-web-app-sql/vsts1.png)

2. <span data-ttu-id="2fce9-344">They import the Git Repo that currently holds their app code.</span><span class="sxs-lookup"><span data-stu-id="2fce9-344">They import the Git Repo that currently holds their app code.</span></span> <span data-ttu-id="2fce9-345">It's in a [public repo](https://github.com/Microsoft/SmartHotel360-internal-booking-apps) and you can download it.</span><span class="sxs-lookup"><span data-stu-id="2fce9-345">It's in a [public repo](https://github.com/Microsoft/SmartHotel360-internal-booking-apps) and you can download it.</span></span>

    ![Download app code](./media/contoso-migration-refactor-web-app-sql/vsts2.png)

3. <span data-ttu-id="2fce9-347">After the code is imported, they connect Visual Studio to the repo, and clone the code using Team Explorer.</span><span class="sxs-lookup"><span data-stu-id="2fce9-347">After the code is imported, they connect Visual Studio to the repo, and clone the code using Team Explorer.</span></span>

    ![Connect to repo](./media/contoso-migration-refactor-web-app-sql/vsts3.png)

4. <span data-ttu-id="2fce9-349">After the repo is cloned to the developer machine, they open the Solution file for the app.</span><span class="sxs-lookup"><span data-stu-id="2fce9-349">After the repo is cloned to the developer machine, they open the Solution file for the app.</span></span> <span data-ttu-id="2fce9-350">The web app and wcf service each have separate project within the file.</span><span class="sxs-lookup"><span data-stu-id="2fce9-350">The web app and wcf service each have separate project within the file.</span></span>

    ![Solution file](./media/contoso-migration-refactor-web-app-sql/vsts4.png)

## <a name="step-5-configure-connection-strings"></a><span data-ttu-id="2fce9-352">Step 5: Configure connection strings</span><span class="sxs-lookup"><span data-stu-id="2fce9-352">Step 5: Configure connection strings</span></span>

<span data-ttu-id="2fce9-353">Contoso admins need to make sure the web apps and database can all communicate.</span><span class="sxs-lookup"><span data-stu-id="2fce9-353">Contoso admins need to make sure the web apps and database can all communicate.</span></span> <span data-ttu-id="2fce9-354">To do this, they configure connection strings in the code and in the web apps.</span><span class="sxs-lookup"><span data-stu-id="2fce9-354">To do this, they configure connection strings in the code and in the web apps.</span></span>

1. <span data-ttu-id="2fce9-355">In the web app for the WCF service (**SHWCF-EUS2**) > **Settings** > **Application settings**, they add a new connection string named **DefaultConnection**.</span><span class="sxs-lookup"><span data-stu-id="2fce9-355">In the web app for the WCF service (**SHWCF-EUS2**) > **Settings** > **Application settings**, they add a new connection string named **DefaultConnection**.</span></span>
2. <span data-ttu-id="2fce9-356">The connection string is pulled from the **SmartHotel-Registration** database, and should be updated with the correct credentials.</span><span class="sxs-lookup"><span data-stu-id="2fce9-356">The connection string is pulled from the **SmartHotel-Registration** database, and should be updated with the correct credentials.</span></span>

    ![Connection string](media/contoso-migration-refactor-web-app-sql/string1.png)

3. <span data-ttu-id="2fce9-358">Using Visual Studio, they open the **SmartHotel.Registration.wcf** project from the solution file.</span><span class="sxs-lookup"><span data-stu-id="2fce9-358">Using Visual Studio, they open the **SmartHotel.Registration.wcf** project from the solution file.</span></span> <span data-ttu-id="2fce9-359">The **connectionStrings** section of the web.config file for the WCF service SmartHotel.Registration.Wcf should be updated with the connection string.</span><span class="sxs-lookup"><span data-stu-id="2fce9-359">The **connectionStrings** section of the web.config file for the WCF service SmartHotel.Registration.Wcf should be updated with the connection string.</span></span>

     ![Connection string](media/contoso-migration-refactor-web-app-sql/string2.png)

4. <span data-ttu-id="2fce9-361">The **client** section of the web.config file for the SmartHotel.Registration.Web should be changed to point to the new location of the WCF service.</span><span class="sxs-lookup"><span data-stu-id="2fce9-361">The **client** section of the web.config file for the SmartHotel.Registration.Web should be changed to point to the new location of the WCF service.</span></span> <span data-ttu-id="2fce9-362">This is the URL of the WCF web app hosting the service endpoint.</span><span class="sxs-lookup"><span data-stu-id="2fce9-362">This is the URL of the WCF web app hosting the service endpoint.</span></span>

    ![Connection string](media/contoso-migration-refactor-web-app-sql/strings3.png)

5. <span data-ttu-id="2fce9-364">After the changes are in the code, admins need to commit the changes.</span><span class="sxs-lookup"><span data-stu-id="2fce9-364">After the changes are in the code, admins need to commit the changes.</span></span> <span data-ttu-id="2fce9-365">Using Team Explorer in Visual Studio, they commmit and sync.</span><span class="sxs-lookup"><span data-stu-id="2fce9-365">Using Team Explorer in Visual Studio, they commmit and sync.</span></span>


## <a name="step-6-set-up-build-and-release-pipelines-in-vsts"></a><span data-ttu-id="2fce9-366">Step 6: Set up build and release pipelines in VSTS</span><span class="sxs-lookup"><span data-stu-id="2fce9-366">Step 6: Set up build and release pipelines in VSTS</span></span>

<span data-ttu-id="2fce9-367">Contoso admins now configure VSTS to perform build and release process to action the DevOps practices.</span><span class="sxs-lookup"><span data-stu-id="2fce9-367">Contoso admins now configure VSTS to perform build and release process to action the DevOps practices.</span></span>

1. <span data-ttu-id="2fce9-368">In VSTS, they click **Build and release** > **New pipeline**.</span><span class="sxs-lookup"><span data-stu-id="2fce9-368">In VSTS, they click **Build and release** > **New pipeline**.</span></span>

    ![New pipeline](./media/contoso-migration-refactor-web-app-sql/pipeline1.png)

2. <span data-ttu-id="2fce9-370">They select **VSTS Git** and the relevant repo.</span><span class="sxs-lookup"><span data-stu-id="2fce9-370">They select **VSTS Git** and the relevant repo.</span></span>

    ![Git and repo](./media/contoso-migration-refactor-web-app-sql/pipeline2.png)

3. <span data-ttu-id="2fce9-372">In **Select a template**, they select the ASP.NET template for their build.</span><span class="sxs-lookup"><span data-stu-id="2fce9-372">In **Select a template**, they select the ASP.NET template for their build.</span></span>

     ![ASP.NET template](./media/contoso-migration-refactor-web-app-sql/pipeline3.png)
    
4. <span data-ttu-id="2fce9-374">They specify the name ContosoSmartHotelRefactor-ASP.NET-CI for the build, and click **Save & Queue**.</span><span class="sxs-lookup"><span data-stu-id="2fce9-374">They specify the name ContosoSmartHotelRefactor-ASP.NET-CI for the build, and click **Save & Queue**.</span></span>

     ![Save and queue](./media/contoso-migration-refactor-web-app-sql/pipeline4.png)

5. <span data-ttu-id="2fce9-376">This kicks off their first build.</span><span class="sxs-lookup"><span data-stu-id="2fce9-376">This kicks off their first build.</span></span> <span data-ttu-id="2fce9-377">They click on the build number to watch the process.</span><span class="sxs-lookup"><span data-stu-id="2fce9-377">They click on the build number to watch the process.</span></span> <span data-ttu-id="2fce9-378">After it's finished they can see the process feedback.</span><span class="sxs-lookup"><span data-stu-id="2fce9-378">After it's finished they can see the process feedback.</span></span>

    ![Feedback](./media/contoso-migration-refactor-web-app-sql/pipeline5.png)

6. <span data-ttu-id="2fce9-380">After a successful build, then open the build, and click They click **Artifacts**.</span><span class="sxs-lookup"><span data-stu-id="2fce9-380">After a successful build, then open the build, and click They click **Artifacts**.</span></span> <span data-ttu-id="2fce9-381">This folder contains the build results</span><span class="sxs-lookup"><span data-stu-id="2fce9-381">This folder contains the build results</span></span>

    - <span data-ttu-id="2fce9-382">The two zip files are the packages that contain the apps.</span><span class="sxs-lookup"><span data-stu-id="2fce9-382">The two zip files are the packages that contain the apps.</span></span>
    - <span data-ttu-id="2fce9-383">These files are used in the release pipeline for deployment to Azure Web Apps</span><span class="sxs-lookup"><span data-stu-id="2fce9-383">These files are used in the release pipeline for deployment to Azure Web Apps</span></span>

     ![Artifact](./media/contoso-migration-refactor-web-app-sql/pipeline6.png)

7. <span data-ttu-id="2fce9-385">They click **Releases** > **+New pipeline**.</span><span class="sxs-lookup"><span data-stu-id="2fce9-385">They click **Releases** > **+New pipeline**.</span></span>

    ![New pipeline](./media/contoso-migration-refactor-web-app-sql/pipeline7.png)

8. <span data-ttu-id="2fce9-387">They select the Azure App Service deployment template.</span><span class="sxs-lookup"><span data-stu-id="2fce9-387">They select the Azure App Service deployment template.</span></span>

    ![Azure App Service template](./media/contoso-migration-refactor-web-app-sql/pipeline8.png)

9. <span data-ttu-id="2fce9-389">They name the release pipeline **ContosoSmartHotelRefactor**, and specify the name of the WCF web app (SHWCF-EUS2) for the environment name.</span><span class="sxs-lookup"><span data-stu-id="2fce9-389">They name the release pipeline **ContosoSmartHotelRefactor**, and specify the name of the WCF web app (SHWCF-EUS2) for the environment name.</span></span>

    ![Environment](./media/contoso-migration-refactor-web-app-sql/pipeline9.png)

10. <span data-ttu-id="2fce9-391">Under the environment, they click **1 phase, 1 task** to configure deployment of the WCF service.</span><span class="sxs-lookup"><span data-stu-id="2fce9-391">Under the environment, they click **1 phase, 1 task** to configure deployment of the WCF service.</span></span>

    ![Deploy WCF](./media/contoso-migration-refactor-web-app-sql/pipeline10.png)

11. <span data-ttu-id="2fce9-393">They verify the subscription is selected and authorized, and select the **App service name**.</span><span class="sxs-lookup"><span data-stu-id="2fce9-393">They verify the subscription is selected and authorized, and select the **App service name**.</span></span>

     ![Select app service](./media/contoso-migration-refactor-web-app-sql/pipeline11.png)

12. <span data-ttu-id="2fce9-395">In **Artifacts**, they select **+Add an artifact**, and select to build with the **ContosoSmarthotelRefactor-ASP.NET-CI** pipeline.</span><span class="sxs-lookup"><span data-stu-id="2fce9-395">In **Artifacts**, they select **+Add an artifact**, and select to build with the **ContosoSmarthotelRefactor-ASP.NET-CI** pipeline.</span></span>

     ![Build](./media/contoso-migration-refactor-web-app-sql/pipeline12.png)

15. <span data-ttu-id="2fce9-397">They click the lightning bolt on the artifact is checked., to enable continuous deployment trigger.</span><span class="sxs-lookup"><span data-stu-id="2fce9-397">They click the lightning bolt on the artifact is checked., to enable continuous deployment trigger.</span></span>

     ![Lightning bolt](./media/contoso-migration-refactor-web-app-sql/pipeline13.png)

16. <span data-ttu-id="2fce9-399">In addition, note that the continuous deployment trigger should be set to **Enabled**.</span><span class="sxs-lookup"><span data-stu-id="2fce9-399">In addition, note that the continuous deployment trigger should be set to **Enabled**.</span></span>

   ![Continuous deployment enabled](./media/contoso-migration-refactor-web-app-sql/pipeline14.png) 

17. <span data-ttu-id="2fce9-401">Now, they click to **Deploy Azure App Service**.</span><span class="sxs-lookup"><span data-stu-id="2fce9-401">Now, they click to **Deploy Azure App Service**.</span></span>

    ![Deploy app service](./media/contoso-migration-refactor-web-app-sql/pipeline15.png)

18. <span data-ttu-id="2fce9-403">In **Select a file or folder**, they locate the **SmartHotel.Registration.Wcf.zip** file that was creating during the build, and clilck **Save**.-sql</span><span class="sxs-lookup"><span data-stu-id="2fce9-403">In **Select a file or folder**, they locate the **SmartHotel.Registration.Wcf.zip** file that was creating during the build, and clilck **Save**.-sql</span></span>

    ![Save WCF](./media/contoso-migration-refactor-web-app-sql/pipeline16.png)

19. <span data-ttu-id="2fce9-405">They click **Pipeline** >**+Add**, to add an environment for **SHWEB-EUS2**, selecting another Azure App Service deployment.</span><span class="sxs-lookup"><span data-stu-id="2fce9-405">They click **Pipeline** >**+Add**, to add an environment for **SHWEB-EUS2**, selecting another Azure App Service deployment.</span></span>

    ![Add environment](./media/contoso-migration-refactor-web-app-sql/pipeline17.png)

20. <span data-ttu-id="2fce9-407">They repeat the process to publish the web app (**SmartHotel.Registration.Web.zip**) file to the correct web app.</span><span class="sxs-lookup"><span data-stu-id="2fce9-407">They repeat the process to publish the web app (**SmartHotel.Registration.Web.zip**) file to the correct web app.</span></span>

    ![Publish web app](./media/contoso-migration-refactor-web-app-sql/pipeline18.png)

21. <span data-ttu-id="2fce9-409">After it's saved, the release pipeline will show as follows.</span><span class="sxs-lookup"><span data-stu-id="2fce9-409">After it's saved, the release pipeline will show as follows.</span></span>

     ![Release pipeline summary](./media/contoso-migration-refactor-web-app-sql/pipeline19.png)

22. <span data-ttu-id="2fce9-411">They move back to **Build**, and click **Triggers** > **Enable continuous integration**.</span><span class="sxs-lookup"><span data-stu-id="2fce9-411">They move back to **Build**, and click **Triggers** > **Enable continuous integration**.</span></span> <span data-ttu-id="2fce9-412">This enables the pipeline so that when changes are committed to the code, and full build and release occurs.</span><span class="sxs-lookup"><span data-stu-id="2fce9-412">This enables the pipeline so that when changes are committed to the code, and full build and release occurs.</span></span>

    ![Enable continuous integration](./media/contoso-migration-refactor-web-app-sql/pipeline20.png)

23. <span data-ttu-id="2fce9-414">They click **Save & Queue** to run the full pipeline.</span><span class="sxs-lookup"><span data-stu-id="2fce9-414">They click **Save & Queue** to run the full pipeline.</span></span> <span data-ttu-id="2fce9-415">A new build is triggered that in turn creates the first release of the app to the Azure App Service.</span><span class="sxs-lookup"><span data-stu-id="2fce9-415">A new build is triggered that in turn creates the first release of the app to the Azure App Service.</span></span>

    ![Save pipeline](./media/contoso-migration-refactor-web-app-sql/pipeline21.png)

24. <span data-ttu-id="2fce9-417">Contoso admins can follow the build and release pipeline process from VSTS.</span><span class="sxs-lookup"><span data-stu-id="2fce9-417">Contoso admins can follow the build and release pipeline process from VSTS.</span></span> <span data-ttu-id="2fce9-418">After the build completes, the release will start.</span><span class="sxs-lookup"><span data-stu-id="2fce9-418">After the build completes, the release will start.</span></span>

    ![Build and release app](./media/contoso-migration-refactor-web-app-sql/pipeline22.png)

25. <span data-ttu-id="2fce9-420">After the pipeline finishes, both sites have been deployed and the app is up and running online.</span><span class="sxs-lookup"><span data-stu-id="2fce9-420">After the pipeline finishes, both sites have been deployed and the app is up and running online.</span></span>

    ![Finish release](./media/contoso-migration-refactor-web-app-sql/pipeline23.png)

<span data-ttu-id="2fce9-422">At this point, the app is successfully migrated to Azure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-422">At this point, the app is successfully migrated to Azure.</span></span>



## <a name="clean-up-after-migration"></a><span data-ttu-id="2fce9-423">Clean up after migration</span><span class="sxs-lookup"><span data-stu-id="2fce9-423">Clean up after migration</span></span>

<span data-ttu-id="2fce9-424">After migration, Contoso needs to complete these cleanup steps:</span><span class="sxs-lookup"><span data-stu-id="2fce9-424">After migration, Contoso needs to complete these cleanup steps:</span></span>  

- <span data-ttu-id="2fce9-425">Remove the on-premises VMs from the vCenter inventory.</span><span class="sxs-lookup"><span data-stu-id="2fce9-425">Remove the on-premises VMs from the vCenter inventory.</span></span>
- <span data-ttu-id="2fce9-426">Remove the VMs from local backup jobs.</span><span class="sxs-lookup"><span data-stu-id="2fce9-426">Remove the VMs from local backup jobs.</span></span>
- <span data-ttu-id="2fce9-427">Update internal documentation to show the new locations for the SmartHotel360 app.</span><span class="sxs-lookup"><span data-stu-id="2fce9-427">Update internal documentation to show the new locations for the SmartHotel360 app.</span></span> <span data-ttu-id="2fce9-428">Show the database as running in Azure SQL database, and the front end as running in two web apps.</span><span class="sxs-lookup"><span data-stu-id="2fce9-428">Show the database as running in Azure SQL database, and the front end as running in two web apps.</span></span>
- <span data-ttu-id="2fce9-429">Review any resources that interact with the decommissioned VMs, and update any relevant settings or documentation to reflect the new configuration.</span><span class="sxs-lookup"><span data-stu-id="2fce9-429">Review any resources that interact with the decommissioned VMs, and update any relevant settings or documentation to reflect the new configuration.</span></span>


## <a name="review-the-deployment"></a><span data-ttu-id="2fce9-430">Review the deployment</span><span class="sxs-lookup"><span data-stu-id="2fce9-430">Review the deployment</span></span>

<span data-ttu-id="2fce9-431">With the migrated resources in Azure, Contoso needs to fully operationalize and secure their new infrastructure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-431">With the migrated resources in Azure, Contoso needs to fully operationalize and secure their new infrastructure.</span></span>

### <a name="security"></a><span data-ttu-id="2fce9-432">Security</span><span class="sxs-lookup"><span data-stu-id="2fce9-432">Security</span></span>

- <span data-ttu-id="2fce9-433">Contoso needs to ensure that their new **SmartHotel-Registration** database is secure.</span><span class="sxs-lookup"><span data-stu-id="2fce9-433">Contoso needs to ensure that their new **SmartHotel-Registration** database is secure.</span></span> <span data-ttu-id="2fce9-434">[Learn more](https://docs.microsoft.com/azure/sql-database/sql-database-security-overview).</span><span class="sxs-lookup"><span data-stu-id="2fce9-434">[Learn more](https://docs.microsoft.com/azure/sql-database/sql-database-security-overview).</span></span>
- <span data-ttu-id="2fce9-435">In particular, Contoso should update the web apps to use SSL with certificates.</span><span class="sxs-lookup"><span data-stu-id="2fce9-435">In particular, Contoso should update the web apps to use SSL with certificates.</span></span>

### <a name="backups"></a><span data-ttu-id="2fce9-436">Backups</span><span class="sxs-lookup"><span data-stu-id="2fce9-436">Backups</span></span>

- <span data-ttu-id="2fce9-437">Contoso needs to review backup requirements for the Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="2fce9-437">Contoso needs to review backup requirements for the Azure SQL Database.</span></span> <span data-ttu-id="2fce9-438">[Learn more](https://docs.microsoft.com/azure/sql-database/sql-database-automated-backups).</span><span class="sxs-lookup"><span data-stu-id="2fce9-438">[Learn more](https://docs.microsoft.com/azure/sql-database/sql-database-automated-backups).</span></span>
- <span data-ttu-id="2fce9-439">Contoso also needs to learn about managing SQL Database backups and restores.</span><span class="sxs-lookup"><span data-stu-id="2fce9-439">Contoso also needs to learn about managing SQL Database backups and restores.</span></span> <span data-ttu-id="2fce9-440">[Learn more](https://docs.microsoft.com/azure/sql-database/sql-database-automated-backups) about automatic backups.</span><span class="sxs-lookup"><span data-stu-id="2fce9-440">[Learn more](https://docs.microsoft.com/azure/sql-database/sql-database-automated-backups) about automatic backups.</span></span>
- <span data-ttu-id="2fce9-441">Contoso should consider implementing failover groups to provide regional failover for the database.</span><span class="sxs-lookup"><span data-stu-id="2fce9-441">Contoso should consider implementing failover groups to provide regional failover for the database.</span></span> <span data-ttu-id="2fce9-442">[Learn more](https://docs.microsoft.com/azure/sql-database/sql-database-geo-replication-overview).</span><span class="sxs-lookup"><span data-stu-id="2fce9-442">[Learn more](https://docs.microsoft.com/azure/sql-database/sql-database-geo-replication-overview).</span></span>
- <span data-ttu-id="2fce9-443">Contoso needs to consider deploying the Web App in the main East US 2 and Central US region for resilience.</span><span class="sxs-lookup"><span data-stu-id="2fce9-443">Contoso needs to consider deploying the Web App in the main East US 2 and Central US region for resilience.</span></span> <span data-ttu-id="2fce9-444">Contoso could configure Traffic Manager to ensure failover in case of regional outages.</span><span class="sxs-lookup"><span data-stu-id="2fce9-444">Contoso could configure Traffic Manager to ensure failover in case of regional outages.</span></span>

### <a name="licensing-and-cost-optimization"></a><span data-ttu-id="2fce9-445">Licensing and cost optimization</span><span class="sxs-lookup"><span data-stu-id="2fce9-445">Licensing and cost optimization</span></span>

- <span data-ttu-id="2fce9-446">After all resources are deployed, Contoso should assign Azure tags based on their [infrastructure planning](contoso-migration-infrastructure.md#set-up-tagging).</span><span class="sxs-lookup"><span data-stu-id="2fce9-446">After all resources are deployed, Contoso should assign Azure tags based on their [infrastructure planning](contoso-migration-infrastructure.md#set-up-tagging).</span></span>
- <span data-ttu-id="2fce9-447">All licensing is built into the cost of the PaaS services that Contoso is consuming.</span><span class="sxs-lookup"><span data-stu-id="2fce9-447">All licensing is built into the cost of the PaaS services that Contoso is consuming.</span></span> <span data-ttu-id="2fce9-448">This will be deducted from the EA.</span><span class="sxs-lookup"><span data-stu-id="2fce9-448">This will be deducted from the EA.</span></span>
- <span data-ttu-id="2fce9-449">Contoso will enable Azure Cost Management licensed by Cloudyn, a Microsoft subsidiary.</span><span class="sxs-lookup"><span data-stu-id="2fce9-449">Contoso will enable Azure Cost Management licensed by Cloudyn, a Microsoft subsidiary.</span></span> <span data-ttu-id="2fce9-450">It's a multi-cloud cost management solution that helps you to utilize and manage Azure and other cloud resources.</span><span class="sxs-lookup"><span data-stu-id="2fce9-450">It's a multi-cloud cost management solution that helps you to utilize and manage Azure and other cloud resources.</span></span>  <span data-ttu-id="2fce9-451">[Learn more](https://docs.microsoft.com/azure/cost-management/overview) about Azure Cost Management.</span><span class="sxs-lookup"><span data-stu-id="2fce9-451">[Learn more](https://docs.microsoft.com/azure/cost-management/overview) about Azure Cost Management.</span></span>

## <a name="conclusion"></a><span data-ttu-id="2fce9-452">Conclusion</span><span class="sxs-lookup"><span data-stu-id="2fce9-452">Conclusion</span></span>

<span data-ttu-id="2fce9-453">In this article, Contoso refactored the SmartHotel360 app in Azure by migrating the app frontend VM to two Azure Web Apps.</span><span class="sxs-lookup"><span data-stu-id="2fce9-453">In this article, Contoso refactored the SmartHotel360 app in Azure by migrating the app frontend VM to two Azure Web Apps.</span></span> <span data-ttu-id="2fce9-454">The app database was migrated to an Azure SQL database.</span><span class="sxs-lookup"><span data-stu-id="2fce9-454">The app database was migrated to an Azure SQL database.</span></span>






