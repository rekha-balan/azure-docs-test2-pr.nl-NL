---
title: Contoso-Set up a migration infrastructure | Microsoft Docs
description: Learn how Contoso sets up an Azure infrastructure for migration to Azure.
services: azure-migrate
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: conceptual
ms.date: 09/05/2018
ms.author: raynew
ms.openlocfilehash: 533b12f5a2a70834d9f0dc7ecabebf7864fb3a1e
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44869965"
---
# <a name="contoso---deploy-a-migration-infrastructure"></a><span data-ttu-id="582c6-103">Contoso - Deploy a migration infrastructure</span><span class="sxs-lookup"><span data-stu-id="582c6-103">Contoso - Deploy a migration infrastructure</span></span>

<span data-ttu-id="582c6-104">In this article, Contoso prepares its on-premises infrastructure for migration, and sets up an Azure infrastructure, in preparation for migration, and for running the business in a hybrid environment.</span><span class="sxs-lookup"><span data-stu-id="582c6-104">In this article, Contoso prepares its on-premises infrastructure for migration, and sets up an Azure infrastructure, in preparation for migration, and for running the business in a hybrid environment.</span></span>

- <span data-ttu-id="582c6-105">It's a sample architecture that's specific to Contoso.</span><span class="sxs-lookup"><span data-stu-id="582c6-105">It's a sample architecture that's specific to Contoso.</span></span>
- <span data-ttu-id="582c6-106">Whether you need all the elements described in this article depends upon your migration strategy.</span><span class="sxs-lookup"><span data-stu-id="582c6-106">Whether you need all the elements described in this article depends upon your migration strategy.</span></span> <span data-ttu-id="582c6-107">For example, if you're building only cloud-native apps in Azure, you might need a less complex networking structure.</span><span class="sxs-lookup"><span data-stu-id="582c6-107">For example, if you're building only cloud-native apps in Azure, you might need a less complex networking structure.</span></span>

<span data-ttu-id="582c6-108">This article is part of a series of articles that document how the fictitious company Contoso migrates its on-premises resources to the Microsoft Azure cloud.</span><span class="sxs-lookup"><span data-stu-id="582c6-108">This article is part of a series of articles that document how the fictitious company Contoso migrates its on-premises resources to the Microsoft Azure cloud.</span></span> <span data-ttu-id="582c6-109">The series includes background information and a series of deployment scenarios that illustrate how to set up a migration infrastructure, assess the suitability of on-premises resources for migration, and run different types of migrations.</span><span class="sxs-lookup"><span data-stu-id="582c6-109">The series includes background information and a series of deployment scenarios that illustrate how to set up a migration infrastructure, assess the suitability of on-premises resources for migration, and run different types of migrations.</span></span> <span data-ttu-id="582c6-110">Scenarios grow in complexity.</span><span class="sxs-lookup"><span data-stu-id="582c6-110">Scenarios grow in complexity.</span></span> <span data-ttu-id="582c6-111">Articles will be added to the series over time.</span><span class="sxs-lookup"><span data-stu-id="582c6-111">Articles will be added to the series over time.</span></span>


<span data-ttu-id="582c6-112">**Article**</span><span class="sxs-lookup"><span data-stu-id="582c6-112">**Article**</span></span> | <span data-ttu-id="582c6-113">**Details**</span><span class="sxs-lookup"><span data-stu-id="582c6-113">**Details**</span></span> | <span data-ttu-id="582c6-114">**Status**</span><span class="sxs-lookup"><span data-stu-id="582c6-114">**Status**</span></span>
--- | --- | ---
[<span data-ttu-id="582c6-115">Article 1: Overview</span><span class="sxs-lookup"><span data-stu-id="582c6-115">Article 1: Overview</span></span>](contoso-migration-overview.md) | <span data-ttu-id="582c6-116">Overview of the article series, Contoso's migration strategy, and the sample apps that are used in the series.</span><span class="sxs-lookup"><span data-stu-id="582c6-116">Overview of the article series, Contoso's migration strategy, and the sample apps that are used in the series.</span></span> | <span data-ttu-id="582c6-117">Available</span><span class="sxs-lookup"><span data-stu-id="582c6-117">Available</span></span>
<span data-ttu-id="582c6-118">Article 2: Deploy an Azure infrastructure</span><span class="sxs-lookup"><span data-stu-id="582c6-118">Article 2: Deploy an Azure infrastructure</span></span> | <span data-ttu-id="582c6-119">Contoso prepares its on-premises infrastructure and its Azure infrastructure for migration.</span><span class="sxs-lookup"><span data-stu-id="582c6-119">Contoso prepares its on-premises infrastructure and its Azure infrastructure for migration.</span></span> <span data-ttu-id="582c6-120">The same infrastructure is used for all migration articles in the series.</span><span class="sxs-lookup"><span data-stu-id="582c6-120">The same infrastructure is used for all migration articles in the series.</span></span> | <span data-ttu-id="582c6-121">This article</span><span class="sxs-lookup"><span data-stu-id="582c6-121">This article</span></span>
[<span data-ttu-id="582c6-122">Article 3: Assess on-premises resources for migration to Azure</span><span class="sxs-lookup"><span data-stu-id="582c6-122">Article 3: Assess on-premises resources for migration to Azure</span></span>](contoso-migration-assessment.md)  | <span data-ttu-id="582c6-123">SContoso runs an assessment of its on-premises SmartHotel360 app running on VMware.</span><span class="sxs-lookup"><span data-stu-id="582c6-123">SContoso runs an assessment of its on-premises SmartHotel360 app running on VMware.</span></span> <span data-ttu-id="582c6-124">Contoso assesses app VMs using the Azure Migrate service, and the app SQL Server database using Data Migration Assistant.</span><span class="sxs-lookup"><span data-stu-id="582c6-124">Contoso assesses app VMs using the Azure Migrate service, and the app SQL Server database using Data Migration Assistant.</span></span> | <span data-ttu-id="582c6-125">Available</span><span class="sxs-lookup"><span data-stu-id="582c6-125">Available</span></span>
[<span data-ttu-id="582c6-126">Article 4: Rehost an app on an Azure VM and SQL Database Managed Instance</span><span class="sxs-lookup"><span data-stu-id="582c6-126">Article 4: Rehost an app on an Azure VM and SQL Database Managed Instance</span></span>](contoso-migration-rehost-vm-sql-managed-instance.md) | <span data-ttu-id="582c6-127">Contoso runs a lift-and-shift migration to Azure for its on-premises SmartHotel360 app.</span><span class="sxs-lookup"><span data-stu-id="582c6-127">Contoso runs a lift-and-shift migration to Azure for its on-premises SmartHotel360 app.</span></span> <span data-ttu-id="582c6-128">Contoso migrates the app front-end VM using [Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/site-recovery-overview).</span><span class="sxs-lookup"><span data-stu-id="582c6-128">Contoso migrates the app front-end VM using [Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/site-recovery-overview).</span></span> <span data-ttu-id="582c6-129">Contoso migrates the app database to an Azure SQL Database Managed Instance using the [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview).</span><span class="sxs-lookup"><span data-stu-id="582c6-129">Contoso migrates the app database to an Azure SQL Database Managed Instance using the [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview).</span></span> | <span data-ttu-id="582c6-130">Available</span><span class="sxs-lookup"><span data-stu-id="582c6-130">Available</span></span>   
[<span data-ttu-id="582c6-131">Article 5: Rehost an app on Azure VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-131">Article 5: Rehost an app on Azure VMs</span></span>](contoso-migration-rehost-vm.md) | <span data-ttu-id="582c6-132">Contoso migrates its SmartHotel360 app VMs to Azure VMs using the Site Recovery service.</span><span class="sxs-lookup"><span data-stu-id="582c6-132">Contoso migrates its SmartHotel360 app VMs to Azure VMs using the Site Recovery service.</span></span> | <span data-ttu-id="582c6-133">Available</span><span class="sxs-lookup"><span data-stu-id="582c6-133">Available</span></span>
[<span data-ttu-id="582c6-134">Article 6: Rehost an app on Azure VMs and in a  SQL Server AlwaysOn availability group</span><span class="sxs-lookup"><span data-stu-id="582c6-134">Article 6: Rehost an app on Azure VMs and in a  SQL Server AlwaysOn availability group</span></span>](contoso-migration-rehost-vm-sql-ag.md) | <span data-ttu-id="582c6-135">Contoso migrates the app, using Site Recovery to migrate the app VMs, and the Database Migration Service to migrate the app database to a SQL Server cluster that's protected by an AlwaysOn availability group.</span><span class="sxs-lookup"><span data-stu-id="582c6-135">Contoso migrates the app, using Site Recovery to migrate the app VMs, and the Database Migration Service to migrate the app database to a SQL Server cluster that's protected by an AlwaysOn availability group.</span></span> | <span data-ttu-id="582c6-136">Available</span><span class="sxs-lookup"><span data-stu-id="582c6-136">Available</span></span>
[<span data-ttu-id="582c6-137">Article 7: Rehost a Linux app on Azure VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-137">Article 7: Rehost a Linux app on Azure VMs</span></span>](contoso-migration-rehost-linux-vm.md) | <span data-ttu-id="582c6-138">Contoso completes a lift-and-shift migration of its Linux osTicket app to Azure VMs, using the Site Recovery service.</span><span class="sxs-lookup"><span data-stu-id="582c6-138">Contoso completes a lift-and-shift migration of its Linux osTicket app to Azure VMs, using the Site Recovery service.</span></span> | <span data-ttu-id="582c6-139">Available</span><span class="sxs-lookup"><span data-stu-id="582c6-139">Available</span></span>
[<span data-ttu-id="582c6-140">Article 8: Rehost a Linux app on Azure VMs and Azure Database for MySQL</span><span class="sxs-lookup"><span data-stu-id="582c6-140">Article 8: Rehost a Linux app on Azure VMs and Azure Database for MySQL</span></span>](contoso-migration-rehost-linux-vm-mysql.md) | <span data-ttu-id="582c6-141">Contoso migrates its Linux osTicket app to Azure VMs by using Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="582c6-141">Contoso migrates its Linux osTicket app to Azure VMs by using Site Recovery.</span></span> <span data-ttu-id="582c6-142">It migrates the app database to Azure Database for MySQL by using MySQL Workbench.</span><span class="sxs-lookup"><span data-stu-id="582c6-142">It migrates the app database to Azure Database for MySQL by using MySQL Workbench.</span></span> | <span data-ttu-id="582c6-143">Available</span><span class="sxs-lookup"><span data-stu-id="582c6-143">Available</span></span>
[<span data-ttu-id="582c6-144">Article 9: Refactor an app in an Azure web app and Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="582c6-144">Article 9: Refactor an app in an Azure web app and Azure SQL Database</span></span>](contoso-migration-refactor-web-app-sql.md) | <span data-ttu-id="582c6-145">Contoso migrates its SmartHotel360 app to an Azure web app and migrates the app database to an Azure SQL Server instance with the Database Migration Assistant.</span><span class="sxs-lookup"><span data-stu-id="582c6-145">Contoso migrates its SmartHotel360 app to an Azure web app and migrates the app database to an Azure SQL Server instance with the Database Migration Assistant.</span></span> | <span data-ttu-id="582c6-146">Available</span><span class="sxs-lookup"><span data-stu-id="582c6-146">Available</span></span>    
[<span data-ttu-id="582c6-147">Article 10: Refactor a Linux app in an Azure web app and Azure Database for MySQL</span><span class="sxs-lookup"><span data-stu-id="582c6-147">Article 10: Refactor a Linux app in an Azure web app and Azure Database for MySQL</span></span>](contoso-migration-refactor-linux-app-service-mysql.md) | <span data-ttu-id="582c6-148">Contoso migrates its Linux osTicket app to an Azure web app on multiple sites.</span><span class="sxs-lookup"><span data-stu-id="582c6-148">Contoso migrates its Linux osTicket app to an Azure web app on multiple sites.</span></span> <span data-ttu-id="582c6-149">The web app is integrated with GitHub for continuous delivery.</span><span class="sxs-lookup"><span data-stu-id="582c6-149">The web app is integrated with GitHub for continuous delivery.</span></span> <span data-ttu-id="582c6-150">It migrates the app database to an Azure Database for MySQL instance.</span><span class="sxs-lookup"><span data-stu-id="582c6-150">It migrates the app database to an Azure Database for MySQL instance.</span></span> | <span data-ttu-id="582c6-151">Available</span><span class="sxs-lookup"><span data-stu-id="582c6-151">Available</span></span>
[<span data-ttu-id="582c6-152">Article 11: Refactor Team Foundation Server on Azure DevOps Services</span><span class="sxs-lookup"><span data-stu-id="582c6-152">Article 11: Refactor Team Foundation Server on Azure DevOps Services</span></span>](contoso-migration-tfs-vsts.md) | <span data-ttu-id="582c6-153">Contoso migrates its on-premises Team Foundation Server deployment to Azure DevOps Services in Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-153">Contoso migrates its on-premises Team Foundation Server deployment to Azure DevOps Services in Azure.</span></span> | <span data-ttu-id="582c6-154">Available</span><span class="sxs-lookup"><span data-stu-id="582c6-154">Available</span></span>
[<span data-ttu-id="582c6-155">Article 12: Rearchitect an app in Azure containers and Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="582c6-155">Article 12: Rearchitect an app in Azure containers and Azure SQL Database</span></span>](contoso-migration-rearchitect-container-sql.md) | <span data-ttu-id="582c6-156">Contoso migrates its SmartHotel app to Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-156">Contoso migrates its SmartHotel app to Azure.</span></span> <span data-ttu-id="582c6-157">Then, it rearchitects the app web tier as a Windows container running in Azure Service Fabric, and the app database with Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="582c6-157">Then, it rearchitects the app web tier as a Windows container running in Azure Service Fabric, and the app database with Azure SQL Database.</span></span> | <span data-ttu-id="582c6-158">Available</span><span class="sxs-lookup"><span data-stu-id="582c6-158">Available</span></span>    
[<span data-ttu-id="582c6-159">Article 13: Rebuild an app in Azure</span><span class="sxs-lookup"><span data-stu-id="582c6-159">Article 13: Rebuild an app in Azure</span></span>](contoso-migration-rebuild.md) | <span data-ttu-id="582c6-160">Contoso rebuilds its SmartHotel app by using a range of Azure capabilities and services, including Azure App Service, Azure Kubernetes Service (AKS), Azure Functions, Azure Cognitive Services, and Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="582c6-160">Contoso rebuilds its SmartHotel app by using a range of Azure capabilities and services, including Azure App Service, Azure Kubernetes Service (AKS), Azure Functions, Azure Cognitive Services, and Azure Cosmos DB.</span></span> | <span data-ttu-id="582c6-161">Available</span><span class="sxs-lookup"><span data-stu-id="582c6-161">Available</span></span> 

<span data-ttu-id="582c6-162">In this article Contoso sets up all the infrastructure elements it needs to complete all migration scenarios.</span><span class="sxs-lookup"><span data-stu-id="582c6-162">In this article Contoso sets up all the infrastructure elements it needs to complete all migration scenarios.</span></span> 


## <a name="overview"></a><span data-ttu-id="582c6-163">Overview</span><span class="sxs-lookup"><span data-stu-id="582c6-163">Overview</span></span>

<span data-ttu-id="582c6-164">Before Contoso can migrate to Azure, it's critical to prepare an Azure infrastructure.</span><span class="sxs-lookup"><span data-stu-id="582c6-164">Before Contoso can migrate to Azure, it's critical to prepare an Azure infrastructure.</span></span>  <span data-ttu-id="582c6-165">Generally, there are five broad areas Contoso needs to think about:</span><span class="sxs-lookup"><span data-stu-id="582c6-165">Generally, there are five broad areas Contoso needs to think about:</span></span>

<span data-ttu-id="582c6-166">**Step 1: Azure subscriptions**: How will Contoso purchase Azure, and interact with the Azure platform and services?</span><span class="sxs-lookup"><span data-stu-id="582c6-166">**Step 1: Azure subscriptions**: How will Contoso purchase Azure, and interact with the Azure platform and services?</span></span>  
<span data-ttu-id="582c6-167">**Step 2: Hybrid identity**: How will it manage and control access to on-premises and Azure resources after migration?</span><span class="sxs-lookup"><span data-stu-id="582c6-167">**Step 2: Hybrid identity**: How will it manage and control access to on-premises and Azure resources after migration?</span></span> <span data-ttu-id="582c6-168">How does Contoso extend or move identity management to the cloud?</span><span class="sxs-lookup"><span data-stu-id="582c6-168">How does Contoso extend or move identity management to the cloud?</span></span>  
<span data-ttu-id="582c6-169">**Step 3: Disaster recovery and resilience**: How will Contoso ensure that its apps and infrastructure are resilient if outages and disasters occur?</span><span class="sxs-lookup"><span data-stu-id="582c6-169">**Step 3: Disaster recovery and resilience**: How will Contoso ensure that its apps and infrastructure are resilient if outages and disasters occur?</span></span>  
<span data-ttu-id="582c6-170">**Step 4: Networking**: How should Contoso design a networking infrastructure, and establish connectivity between its on-premises datacenter and Azure?</span><span class="sxs-lookup"><span data-stu-id="582c6-170">**Step 4: Networking**: How should Contoso design a networking infrastructure, and establish connectivity between its on-premises datacenter and Azure?</span></span>  
<span data-ttu-id="582c6-171">**Step 5: Security**: How will its secure the hybrid/Azure deployment?</span><span class="sxs-lookup"><span data-stu-id="582c6-171">**Step 5: Security**: How will its secure the hybrid/Azure deployment?</span></span>  
<span data-ttu-id="582c6-172">**Step 6: Governance**: How will Contoso keep the deployment aligned with security and governance requirements?</span><span class="sxs-lookup"><span data-stu-id="582c6-172">**Step 6: Governance**: How will Contoso keep the deployment aligned with security and governance requirements?</span></span>

## <a name="before-you-start"></a><span data-ttu-id="582c6-173">Before you start</span><span class="sxs-lookup"><span data-stu-id="582c6-173">Before you start</span></span>

<span data-ttu-id="582c6-174">Before we start looking at the infrastructure, you might want to read some background information about the Azure capabilities we discuss in this article:</span><span class="sxs-lookup"><span data-stu-id="582c6-174">Before we start looking at the infrastructure, you might want to read some background information about the Azure capabilities we discuss in this article:</span></span>

- <span data-ttu-id="582c6-175">There are a number of options available for purchasing Azure access, including Pay-As-You-Go, Enterprise Agreements (EA), or Open Licensing from Microsoft resellers, or from Microsoft Partners know as Cloud Solution Providers (CSPs).</span><span class="sxs-lookup"><span data-stu-id="582c6-175">There are a number of options available for purchasing Azure access, including Pay-As-You-Go, Enterprise Agreements (EA), or Open Licensing from Microsoft resellers, or from Microsoft Partners know as Cloud Solution Providers (CSPs).</span></span> <span data-ttu-id="582c6-176">Learn about [purchase options](https://azure.microsoft.com/pricing/purchase-options/), and read about how [Azure subscriptions are organized](https://azure.microsoft.com/blog/organizing-subscriptions-and-resource-groups-within-the-enterprise/).</span><span class="sxs-lookup"><span data-stu-id="582c6-176">Learn about [purchase options](https://azure.microsoft.com/pricing/purchase-options/), and read about how [Azure subscriptions are organized](https://azure.microsoft.com/blog/organizing-subscriptions-and-resource-groups-within-the-enterprise/).</span></span>
- <span data-ttu-id="582c6-177">Get an overview of Azure [identity and access management](https://www.microsoft.com/trustcenter/security/identity).</span><span class="sxs-lookup"><span data-stu-id="582c6-177">Get an overview of Azure [identity and access management](https://www.microsoft.com/trustcenter/security/identity).</span></span> <span data-ttu-id="582c6-178">In particular, learn about [Azure AD and extending on-premises AD to the cloud](https://docs.microsoft.com/azure/active-directory/identity-fundamentals).</span><span class="sxs-lookup"><span data-stu-id="582c6-178">In particular, learn about [Azure AD and extending on-premises AD to the cloud](https://docs.microsoft.com/azure/active-directory/identity-fundamentals).</span></span> <span data-ttu-id="582c6-179">There's a useful downloadable e-book about [identity and access management (IAM) in a hybrid environment](https://azure.microsoft.com/resources/hybrid-cloud-identity/).</span><span class="sxs-lookup"><span data-stu-id="582c6-179">There's a useful downloadable e-book about [identity and access management (IAM) in a hybrid environment](https://azure.microsoft.com/resources/hybrid-cloud-identity/).</span></span>
- <span data-ttu-id="582c6-180">Azure provides a robust networking infrastructure with options for hybrid connectivity.</span><span class="sxs-lookup"><span data-stu-id="582c6-180">Azure provides a robust networking infrastructure with options for hybrid connectivity.</span></span> <span data-ttu-id="582c6-181">Get an overview of [networking and network access control](https://docs.microsoft.com/azure/security/security-network-overview).</span><span class="sxs-lookup"><span data-stu-id="582c6-181">Get an overview of [networking and network access control](https://docs.microsoft.com/azure/security/security-network-overview).</span></span>
- <span data-ttu-id="582c6-182">Get an introduction to [Azure Security](https://docs.microsoft.com/azure/security/azure-security), and read about creating a plan for [governance](https://docs.microsoft.com/azure/security/governance-in-azure).</span><span class="sxs-lookup"><span data-stu-id="582c6-182">Get an introduction to [Azure Security](https://docs.microsoft.com/azure/security/azure-security), and read about creating a plan for [governance](https://docs.microsoft.com/azure/security/governance-in-azure).</span></span>


## <a name="on-premises-architecture"></a><span data-ttu-id="582c6-183">On-premises architecture</span><span class="sxs-lookup"><span data-stu-id="582c6-183">On-premises architecture</span></span>

<span data-ttu-id="582c6-184">Here's a diagram showing the current Contoso on-premises infrastructure.</span><span class="sxs-lookup"><span data-stu-id="582c6-184">Here's a diagram showing the current Contoso on-premises infrastructure.</span></span>

 ![Contoso architecture](./media/contoso-migration-infrastructure/contoso-architecture.png)  

- <span data-ttu-id="582c6-186">Contoso has one main datacenter located in the city of New York in the Eastern United States.</span><span class="sxs-lookup"><span data-stu-id="582c6-186">Contoso has one main datacenter located in the city of New York in the Eastern United States.</span></span>
- <span data-ttu-id="582c6-187">There are three additional local branches across the United States.</span><span class="sxs-lookup"><span data-stu-id="582c6-187">There are three additional local branches across the United States.</span></span>
- <span data-ttu-id="582c6-188">The main datacenter is connected to the internet with a fiber metro ethernet connection (500 mbps).</span><span class="sxs-lookup"><span data-stu-id="582c6-188">The main datacenter is connected to the internet with a fiber metro ethernet connection (500 mbps).</span></span>
- <span data-ttu-id="582c6-189">Each branch is connected locally to the internet using business class connections, with IPSec VPN tunnels back to the main datacenter.</span><span class="sxs-lookup"><span data-stu-id="582c6-189">Each branch is connected locally to the internet using business class connections, with IPSec VPN tunnels back to the main datacenter.</span></span> <span data-ttu-id="582c6-190">This allows the entire network to be permanently connected, and optimizes internet connectivity.</span><span class="sxs-lookup"><span data-stu-id="582c6-190">This allows the entire network to be permanently connected, and optimizes internet connectivity.</span></span>
- <span data-ttu-id="582c6-191">The main datacenter is fully virtualized with VMware.</span><span class="sxs-lookup"><span data-stu-id="582c6-191">The main datacenter is fully virtualized with VMware.</span></span> <span data-ttu-id="582c6-192">Contoso has two ESXi 6.5 virtualization hosts, managed by vCenter Server 6.5.</span><span class="sxs-lookup"><span data-stu-id="582c6-192">Contoso has two ESXi 6.5 virtualization hosts, managed by vCenter Server 6.5.</span></span>
- <span data-ttu-id="582c6-193">Contoso uses Active Directory for identity management, and DNS servers on the internal network.</span><span class="sxs-lookup"><span data-stu-id="582c6-193">Contoso uses Active Directory for identity management, and DNS servers on the internal network.</span></span>
- <span data-ttu-id="582c6-194">The domain controllers in the datacenter run on VMware VMs.</span><span class="sxs-lookup"><span data-stu-id="582c6-194">The domain controllers in the datacenter run on VMware VMs.</span></span> <span data-ttu-id="582c6-195">The domain controllers at local branches run on physical servers.</span><span class="sxs-lookup"><span data-stu-id="582c6-195">The domain controllers at local branches run on physical servers.</span></span>


## <a name="step-1-buy-and-subscribe-to-azure"></a><span data-ttu-id="582c6-196">Step 1: Buy and subscribe to Azure</span><span class="sxs-lookup"><span data-stu-id="582c6-196">Step 1: Buy and subscribe to Azure</span></span>

<span data-ttu-id="582c6-197">Contoso needs to figure out how to buy Azure, how to architect subscriptions, and how to license services and resources.</span><span class="sxs-lookup"><span data-stu-id="582c6-197">Contoso needs to figure out how to buy Azure, how to architect subscriptions, and how to license services and resources.</span></span>

### <a name="buy-azure"></a><span data-ttu-id="582c6-198">Buy Azure</span><span class="sxs-lookup"><span data-stu-id="582c6-198">Buy Azure</span></span>

<span data-ttu-id="582c6-199">Contoso is going with an [Enterprise Agreement (EA)](https://azure.microsoft.com/pricing/enterprise-agreement/).</span><span class="sxs-lookup"><span data-stu-id="582c6-199">Contoso is going with an [Enterprise Agreement (EA)](https://azure.microsoft.com/pricing/enterprise-agreement/).</span></span> <span data-ttu-id="582c6-200">This entails an upfront monetary commitment to Azure, entitling Contoso to earn great benefits, including flexible billing options and optimized pricing.</span><span class="sxs-lookup"><span data-stu-id="582c6-200">This entails an upfront monetary commitment to Azure, entitling Contoso to earn great benefits, including flexible billing options and optimized pricing.</span></span>

- <span data-ttu-id="582c6-201">Contoso estimated what its yearly Azure spend will be.</span><span class="sxs-lookup"><span data-stu-id="582c6-201">Contoso estimated what its yearly Azure spend will be.</span></span> <span data-ttu-id="582c6-202">When it signed the agreement, Contoso paid for the first year in full.</span><span class="sxs-lookup"><span data-stu-id="582c6-202">When it signed the agreement, Contoso paid for the first year in full.</span></span>
- <span data-ttu-id="582c6-203">Contoso needs to use all commitments before the year is over, or lose the value for those dollars.</span><span class="sxs-lookup"><span data-stu-id="582c6-203">Contoso needs to use all commitments before the year is over, or lose the value for those dollars.</span></span>
- <span data-ttu-id="582c6-204">If for some reason Contoso exceeds its commitment and spends more, Microsoft will invoice them for the difference.</span><span class="sxs-lookup"><span data-stu-id="582c6-204">If for some reason Contoso exceeds its commitment and spends more, Microsoft will invoice them for the difference.</span></span>
- <span data-ttu-id="582c6-205">Any cost incurred above the commitment will be at the same rates and those in the Contoso contract.</span><span class="sxs-lookup"><span data-stu-id="582c6-205">Any cost incurred above the commitment will be at the same rates and those in the Contoso contract.</span></span> <span data-ttu-id="582c6-206">There are no penalties for going over.</span><span class="sxs-lookup"><span data-stu-id="582c6-206">There are no penalties for going over.</span></span>

### <a name="manage-subscriptions"></a><span data-ttu-id="582c6-207">Manage subscriptions</span><span class="sxs-lookup"><span data-stu-id="582c6-207">Manage subscriptions</span></span>

<span data-ttu-id="582c6-208">After paying for Azure, Contoso needs to figure out how to manage Azure subscriptions.</span><span class="sxs-lookup"><span data-stu-id="582c6-208">After paying for Azure, Contoso needs to figure out how to manage Azure subscriptions.</span></span> <span data-ttu-id="582c6-209">Contoso has an EA, and thus no limit on the number of Azure subscriptions it can set up.</span><span class="sxs-lookup"><span data-stu-id="582c6-209">Contoso has an EA, and thus no limit on the number of Azure subscriptions it can set up.</span></span>

- <span data-ttu-id="582c6-210">An Azure Enterprise Enrollment defines how a company shape and uses Azure services, and defines a core governance structure.</span><span class="sxs-lookup"><span data-stu-id="582c6-210">An Azure Enterprise Enrollment defines how a company shape and uses Azure services, and defines a core governance structure.</span></span>
- <span data-ttu-id="582c6-211">As a first step, Contoso has determined a structure (known as an enterprise scaffold for Enterprise Enrollment.</span><span class="sxs-lookup"><span data-stu-id="582c6-211">As a first step, Contoso has determined a structure (known as an enterprise scaffold for Enterprise Enrollment.</span></span> <span data-ttu-id="582c6-212">Contoso used [this article](https://docs.microsoft.com/azure/azure-resource-manager/resource-manager-subscription-governance) to help understand and design a scaffold.</span><span class="sxs-lookup"><span data-stu-id="582c6-212">Contoso used [this article](https://docs.microsoft.com/azure/azure-resource-manager/resource-manager-subscription-governance) to help understand and design a scaffold.</span></span>
- <span data-ttu-id="582c6-213">For now, Contoso has decided to use a functional approach to manage subscriptions.</span><span class="sxs-lookup"><span data-stu-id="582c6-213">For now, Contoso has decided to use a functional approach to manage subscriptions.</span></span>
    - <span data-ttu-id="582c6-214">Inside the enterprise it  will use a single IT department that controls the Azure budget.</span><span class="sxs-lookup"><span data-stu-id="582c6-214">Inside the enterprise it  will use a single IT department that controls the Azure budget.</span></span> <span data-ttu-id="582c6-215">This will be the only group with subscriptions.</span><span class="sxs-lookup"><span data-stu-id="582c6-215">This will be the only group with subscriptions.</span></span>
    - <span data-ttu-id="582c6-216">Contoso will extend this model in the future, so that other corporate groups can join as departments in the Enterprise Enrollment.</span><span class="sxs-lookup"><span data-stu-id="582c6-216">Contoso will extend this model in the future, so that other corporate groups can join as departments in the Enterprise Enrollment.</span></span>
    - <span data-ttu-id="582c6-217">Inside the IT department Contoso has structured two subscriptions, Production and Development.</span><span class="sxs-lookup"><span data-stu-id="582c6-217">Inside the IT department Contoso has structured two subscriptions, Production and Development.</span></span>
    - <span data-ttu-id="582c6-218">If Contoso requires additional subscriptions in the future, it needs to manage access, policies and compliance for those subscriptions.</span><span class="sxs-lookup"><span data-stu-id="582c6-218">If Contoso requires additional subscriptions in the future, it needs to manage access, policies and compliance for those subscriptions.</span></span> <span data-ttu-id="582c6-219">Contoso will do that by introducing [Azure management groups](https://docs.microsoft.com/azure/azure-resource-manager/management-groups-overview), as an additional layer above subscriptions.</span><span class="sxs-lookup"><span data-stu-id="582c6-219">Contoso will do that by introducing [Azure management groups](https://docs.microsoft.com/azure/azure-resource-manager/management-groups-overview), as an additional layer above subscriptions.</span></span>

    ![Enterprise structure](./media/contoso-migration-infrastructure/enterprise-structure.png) 

### <a name="examine-licensing"></a><span data-ttu-id="582c6-221">Examine licensing</span><span class="sxs-lookup"><span data-stu-id="582c6-221">Examine licensing</span></span>

<span data-ttu-id="582c6-222">With subscriptions configured, Contoso can look at Microsoft licensing.</span><span class="sxs-lookup"><span data-stu-id="582c6-222">With subscriptions configured, Contoso can look at Microsoft licensing.</span></span> <span data-ttu-id="582c6-223">The licensing strategy will depend on the resources that Contoso want to migrate into Azure, and how Azure VMs and services are selected and deployed.</span><span class="sxs-lookup"><span data-stu-id="582c6-223">The licensing strategy will depend on the resources that Contoso want to migrate into Azure, and how Azure VMs and services are selected and deployed.</span></span> 

#### <a name="azure-hybrid-benefit"></a><span data-ttu-id="582c6-224">Azure Hybrid Benefit</span><span class="sxs-lookup"><span data-stu-id="582c6-224">Azure Hybrid Benefit</span></span>

<span data-ttu-id="582c6-225">When deploying VMs in Azure, standard images include a license that will charge Contoso by the minute for the software being used.</span><span class="sxs-lookup"><span data-stu-id="582c6-225">When deploying VMs in Azure, standard images include a license that will charge Contoso by the minute for the software being used.</span></span> <span data-ttu-id="582c6-226">However, Contoso has been a long-term Microsoft customer, and has maintained EAs and open licenses with software assurance (SA).</span><span class="sxs-lookup"><span data-stu-id="582c6-226">However, Contoso has been a long-term Microsoft customer, and has maintained EAs and open licenses with software assurance (SA).</span></span> 

<span data-ttu-id="582c6-227">Azure Hybrid Benefit provides a cost-effective method for Contoso migration, by allowing it to save on Azure VMs and SQL Server workloads by converting or reusing Windows Server Datacenter and Standard edition licenses covered with Software Assurance.</span><span class="sxs-lookup"><span data-stu-id="582c6-227">Azure Hybrid Benefit provides a cost-effective method for Contoso migration, by allowing it to save on Azure VMs and SQL Server workloads by converting or reusing Windows Server Datacenter and Standard edition licenses covered with Software Assurance.</span></span> <span data-ttu-id="582c6-228">This will enable Contoso to pay a lower based compute rate for VMs and SQL Server.</span><span class="sxs-lookup"><span data-stu-id="582c6-228">This will enable Contoso to pay a lower based compute rate for VMs and SQL Server.</span></span> <span data-ttu-id="582c6-229">[Learn more](https://azure.microsoft.com/pricing/hybrid-benefit/).</span><span class="sxs-lookup"><span data-stu-id="582c6-229">[Learn more](https://azure.microsoft.com/pricing/hybrid-benefit/).</span></span>


#### <a name="license-mobility"></a><span data-ttu-id="582c6-230">License Mobility</span><span class="sxs-lookup"><span data-stu-id="582c6-230">License Mobility</span></span>

<span data-ttu-id="582c6-231">License Mobility through SA gives Microsoft Volume Licensing customers like Contoso the flexibility to deploy eligible server apps with active SA on Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-231">License Mobility through SA gives Microsoft Volume Licensing customers like Contoso the flexibility to deploy eligible server apps with active SA on Azure.</span></span> <span data-ttu-id="582c6-232">This eliminates the need to purchase new licenses.</span><span class="sxs-lookup"><span data-stu-id="582c6-232">This eliminates the need to purchase new licenses.</span></span> <span data-ttu-id="582c6-233">With no associated mobility fees, existing licenses can easily be deployed in Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-233">With no associated mobility fees, existing licenses can easily be deployed in Azure.</span></span> <span data-ttu-id="582c6-234">[Learn more](https://azure.microsoft.com/pricing/license-mobility/).</span><span class="sxs-lookup"><span data-stu-id="582c6-234">[Learn more](https://azure.microsoft.com/pricing/license-mobility/).</span></span>

#### <a name="reserve-instances-for-predictable-workloads"></a><span data-ttu-id="582c6-235">Reserve instances for predictable workloads</span><span class="sxs-lookup"><span data-stu-id="582c6-235">Reserve instances for predictable workloads</span></span>

<span data-ttu-id="582c6-236">Predictable workloads are those that always need to be available with VMs running.</span><span class="sxs-lookup"><span data-stu-id="582c6-236">Predictable workloads are those that always need to be available with VMs running.</span></span> <span data-ttu-id="582c6-237">For example, line-of-business apps such as a SAP ERP system.</span><span class="sxs-lookup"><span data-stu-id="582c6-237">For example, line-of-business apps such as a SAP ERP system.</span></span>  <span data-ttu-id="582c6-238">On the other hand, unpredictable workloads are those that are variable.</span><span class="sxs-lookup"><span data-stu-id="582c6-238">On the other hand, unpredictable workloads are those that are variable.</span></span> <span data-ttu-id="582c6-239">For example VMs that are on during high demand and off at non-peak times.</span><span class="sxs-lookup"><span data-stu-id="582c6-239">For example VMs that are on during high demand and off at non-peak times.</span></span>

![Reserved instance](./media/contoso-migration-infrastructure/reserved-instance.png) 

<span data-ttu-id="582c6-241">In exchange for using reserved instances for specific VM instances must be maintained for large durations of time, Console can get both a discount, and prioritized capacity.</span><span class="sxs-lookup"><span data-stu-id="582c6-241">In exchange for using reserved instances for specific VM instances must be maintained for large durations of time, Console can get both a discount, and prioritized capacity.</span></span> <span data-ttu-id="582c6-242">Using [Azure Reserved Instances](https://azure.microsoft.com/pricing/reserved-vm-instances/), together with Azure Hybrid Benefit, Contoso can save up to 82% off regular pay-as-you-go pricing (April 2018).</span><span class="sxs-lookup"><span data-stu-id="582c6-242">Using [Azure Reserved Instances](https://azure.microsoft.com/pricing/reserved-vm-instances/), together with Azure Hybrid Benefit, Contoso can save up to 82% off regular pay-as-you-go pricing (April 2018).</span></span>


## <a name="step-2-manage-hybrid-identity"></a><span data-ttu-id="582c6-243">Step 2: Manage hybrid identity</span><span class="sxs-lookup"><span data-stu-id="582c6-243">Step 2: Manage hybrid identity</span></span>

<span data-ttu-id="582c6-244">Giving and controlling user access to Azure resources with identity and access management (IAM) is an important step in pulling together an Azure infrastructure.</span><span class="sxs-lookup"><span data-stu-id="582c6-244">Giving and controlling user access to Azure resources with identity and access management (IAM) is an important step in pulling together an Azure infrastructure.</span></span>  

- <span data-ttu-id="582c6-245">Contoso decides to extend its on-premises Active Directory into the cloud, rather than build a new separate system in Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-245">Contoso decides to extend its on-premises Active Directory into the cloud, rather than build a new separate system in Azure.</span></span>
- <span data-ttu-id="582c6-246">It creates an Azure-based Active Directory to do this.</span><span class="sxs-lookup"><span data-stu-id="582c6-246">It creates an Azure-based Active Directory to do this.</span></span>
- <span data-ttu-id="582c6-247">Contoso doesn't have Office 365 in place, so it needs to provision a new Azure AD.</span><span class="sxs-lookup"><span data-stu-id="582c6-247">Contoso doesn't have Office 365 in place, so it needs to provision a new Azure AD.</span></span>
- <span data-ttu-id="582c6-248">Office 365 uses Azure AD for user management.</span><span class="sxs-lookup"><span data-stu-id="582c6-248">Office 365 uses Azure AD for user management.</span></span> <span data-ttu-id="582c6-249">If Contoso was using Office 365, it would already have an Azure AD tenet, and use that as the primary AD.</span><span class="sxs-lookup"><span data-stu-id="582c6-249">If Contoso was using Office 365, it would already have an Azure AD tenet, and use that as the primary AD.</span></span>
- <span data-ttu-id="582c6-250">[Learn more](https://support.office.com/article/understanding-office-365-identity-and-azure-active-directory-06a189e7-5ec6-4af2-94bf-a22ea225a7a9) about Azure AD for Office 365, and learn [how to add a subscription](https://docs.microsoft.com/azure/active-directory/active-directory-how-subscriptions-associated-directory) to an existing Azure AD.</span><span class="sxs-lookup"><span data-stu-id="582c6-250">[Learn more](https://support.office.com/article/understanding-office-365-identity-and-azure-active-directory-06a189e7-5ec6-4af2-94bf-a22ea225a7a9) about Azure AD for Office 365, and learn [how to add a subscription](https://docs.microsoft.com/azure/active-directory/active-directory-how-subscriptions-associated-directory) to an existing Azure AD.</span></span>

### <a name="create-an-azure-ad"></a><span data-ttu-id="582c6-251">Create an Azure AD</span><span class="sxs-lookup"><span data-stu-id="582c6-251">Create an Azure AD</span></span>

<span data-ttu-id="582c6-252">Contoso is using the Azure AD Free edition that's included with an Azure subscription.</span><span class="sxs-lookup"><span data-stu-id="582c6-252">Contoso is using the Azure AD Free edition that's included with an Azure subscription.</span></span> <span data-ttu-id="582c6-253">Contoso admins set up an AD directory as follows:</span><span class="sxs-lookup"><span data-stu-id="582c6-253">Contoso admins set up an AD directory as follows:</span></span>

1. <span data-ttu-id="582c6-254">In the [Azure portal](http://portal.azure.com/), they navigate to **Create a resource** > **Identity** > **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="582c6-254">In the [Azure portal](http://portal.azure.com/), they navigate to **Create a resource** > **Identity** > **Azure Active Directory**.</span></span>
2. <span data-ttu-id="582c6-255">In **Create Directory**, they specify a name for the directory, an initial domain name, and region in which the Azure AD directory should be created.</span><span class="sxs-lookup"><span data-stu-id="582c6-255">In **Create Directory**, they specify a name for the directory, an initial domain name, and region in which the Azure AD directory should be created.</span></span>

    ![Create Azure AD](./media/contoso-migration-infrastructure/azure-ad-create.png) 

    > [!NOTE]
    > <span data-ttu-id="582c6-257">The directory that's created has an initial domain name in the form **domainname.onmicrosoft.com**.</span><span class="sxs-lookup"><span data-stu-id="582c6-257">The directory that's created has an initial domain name in the form **domainname.onmicrosoft.com**.</span></span> <span data-ttu-id="582c6-258">The name can't be changed or deleted.</span><span class="sxs-lookup"><span data-stu-id="582c6-258">The name can't be changed or deleted.</span></span> <span data-ttu-id="582c6-259">Instead, they need to add its registered domain name to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="582c6-259">Instead, they need to add its registered domain name to Azure AD.</span></span>

### <a name="add-the-domain-name"></a><span data-ttu-id="582c6-260">Add the domain name</span><span class="sxs-lookup"><span data-stu-id="582c6-260">Add the domain name</span></span>

<span data-ttu-id="582c6-261">To use its standard domain name, Contoso admins need to add it as a custom name to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="582c6-261">To use its standard domain name, Contoso admins need to add it as a custom name to Azure AD.</span></span> <span data-ttu-id="582c6-262">This option allows them to assign familiar user names.</span><span class="sxs-lookup"><span data-stu-id="582c6-262">This option allows them to assign familiar user names.</span></span> <span data-ttu-id="582c6-263">For example, a user can log in with email address billg@contoso.com, rather than needing billg@contosomigration.microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="582c6-263">For example, a user can log in with email address billg@contoso.com, rather than needing billg@contosomigration.microsoft.com.</span></span> 

<span data-ttu-id="582c6-264">To set up a custom name they add it to the directory, add a DNS entry, and then verify the name in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="582c6-264">To set up a custom name they add it to the directory, add a DNS entry, and then verify the name in Azure AD.</span></span>

1. <span data-ttu-id="582c6-265">In **Custom domain names** > **Add custom domain**, they add the domain.</span><span class="sxs-lookup"><span data-stu-id="582c6-265">In **Custom domain names** > **Add custom domain**, they add the domain.</span></span>
2. <span data-ttu-id="582c6-266">To use a DNS entry in Azure they need to register it with their domain registrar.</span><span class="sxs-lookup"><span data-stu-id="582c6-266">To use a DNS entry in Azure they need to register it with their domain registrar.</span></span> 

    - <span data-ttu-id="582c6-267">In the **Custom domain names** list, they note the DNS information for the name.</span><span class="sxs-lookup"><span data-stu-id="582c6-267">In the **Custom domain names** list, they note the DNS information for the name.</span></span> <span data-ttu-id="582c6-268">It's using an MX entry.</span><span class="sxs-lookup"><span data-stu-id="582c6-268">It's using an MX entry.</span></span>
    - <span data-ttu-id="582c6-269">They need access to the name server to do this.</span><span class="sxs-lookup"><span data-stu-id="582c6-269">They need access to the name server to do this.</span></span> <span data-ttu-id="582c6-270">They log into the Contoso.com domain, and create a new MX record for the DNS entry provided by Azure AD, using the details noted.</span><span class="sxs-lookup"><span data-stu-id="582c6-270">They log into the Contoso.com domain, and create a new MX record for the DNS entry provided by Azure AD, using the details noted.</span></span>  
1. <span data-ttu-id="582c6-271">After the DNS records propagate, in the details name for the domain, they click **Verify** to check the custom name.</span><span class="sxs-lookup"><span data-stu-id="582c6-271">After the DNS records propagate, in the details name for the domain, they click **Verify** to check the custom name.</span></span>

     ![Azure AD DNS](./media/contoso-migration-infrastructure/azure-ad-dns.png) 

### <a name="set-up-on-premises-and-azure-groups-and-users"></a><span data-ttu-id="582c6-273">Set up on-premises and Azure groups and users</span><span class="sxs-lookup"><span data-stu-id="582c6-273">Set up on-premises and Azure groups and users</span></span>

<span data-ttu-id="582c6-274">Now that the Azure AD is up and running, Contoso admins need to add employees to on-premises AD groups that will synchronize to Azure AD.</span><span class="sxs-lookup"><span data-stu-id="582c6-274">Now that the Azure AD is up and running, Contoso admins need to add employees to on-premises AD groups that will synchronize to Azure AD.</span></span> <span data-ttu-id="582c6-275">They should use on-premises group names that match the names of resource groups in Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-275">They should use on-premises group names that match the names of resource groups in Azure.</span></span> <span data-ttu-id="582c6-276">This makes it easier to identify matches for synchronization purposes.</span><span class="sxs-lookup"><span data-stu-id="582c6-276">This makes it easier to identify matches for synchronization purposes.</span></span>

#### <a name="create-resource-groups-in-azure"></a><span data-ttu-id="582c6-277">Create resource groups in Azure</span><span class="sxs-lookup"><span data-stu-id="582c6-277">Create resource groups in Azure</span></span>

<span data-ttu-id="582c6-278">Azure resource groups gather Azure resources together.</span><span class="sxs-lookup"><span data-stu-id="582c6-278">Azure resource groups gather Azure resources together.</span></span> <span data-ttu-id="582c6-279">Using a resource group ID allows Azure to perform operations on the resources within the group.</span><span class="sxs-lookup"><span data-stu-id="582c6-279">Using a resource group ID allows Azure to perform operations on the resources within the group.</span></span>

- <span data-ttu-id="582c6-280">An Azure subscription can have multiple resource groups, but a resource group can only exist within a single subscription.</span><span class="sxs-lookup"><span data-stu-id="582c6-280">An Azure subscription can have multiple resource groups, but a resource group can only exist within a single subscription.</span></span>
- <span data-ttu-id="582c6-281">In addition, a single resource group can have multiple resources, but a resource can only belong to a single group.</span><span class="sxs-lookup"><span data-stu-id="582c6-281">In addition, a single resource group can have multiple resources, but a resource can only belong to a single group.</span></span>

<span data-ttu-id="582c6-282">Contoso admins set up Azure resource groups as summarized in the following table.</span><span class="sxs-lookup"><span data-stu-id="582c6-282">Contoso admins set up Azure resource groups as summarized in the following table.</span></span>

<span data-ttu-id="582c6-283">**Resource group**</span><span class="sxs-lookup"><span data-stu-id="582c6-283">**Resource group**</span></span> | <span data-ttu-id="582c6-284">**Details**</span><span class="sxs-lookup"><span data-stu-id="582c6-284">**Details**</span></span>
--- | ---
<span data-ttu-id="582c6-285">**ContosoCobRG**</span><span class="sxs-lookup"><span data-stu-id="582c6-285">**ContosoCobRG**</span></span> | <span data-ttu-id="582c6-286">This group contains all resources related to continuity of business (COB).</span><span class="sxs-lookup"><span data-stu-id="582c6-286">This group contains all resources related to continuity of business (COB).</span></span>  <span data-ttu-id="582c6-287">It includes vaults that Contoso will use for the Azure Site Recovery service, and the Azure Backup service.</span><span class="sxs-lookup"><span data-stu-id="582c6-287">It includes vaults that Contoso will use for the Azure Site Recovery service, and the Azure Backup service.</span></span><br/><br/> <span data-ttu-id="582c6-288">It will also include resources used for migration, including the Azure Migrate and Database Migration Services.</span><span class="sxs-lookup"><span data-stu-id="582c6-288">It will also include resources used for migration, including the Azure Migrate and Database Migration Services.</span></span>
<span data-ttu-id="582c6-289">**ContosoDevRG**</span><span class="sxs-lookup"><span data-stu-id="582c6-289">**ContosoDevRG**</span></span> | <span data-ttu-id="582c6-290">This group contains development and test resources.</span><span class="sxs-lookup"><span data-stu-id="582c6-290">This group contains development and test resources.</span></span>
<span data-ttu-id="582c6-291">**ContosoFailoverRG**</span><span class="sxs-lookup"><span data-stu-id="582c6-291">**ContosoFailoverRG**</span></span> | <span data-ttu-id="582c6-292">This group serves as a landing zone for failed over resources.</span><span class="sxs-lookup"><span data-stu-id="582c6-292">This group serves as a landing zone for failed over resources.</span></span>
<span data-ttu-id="582c6-293">**ContosoNetworkingRG**</span><span class="sxs-lookup"><span data-stu-id="582c6-293">**ContosoNetworkingRG**</span></span> | <span data-ttu-id="582c6-294">This group contains all networking resources.</span><span class="sxs-lookup"><span data-stu-id="582c6-294">This group contains all networking resources.</span></span>
<span data-ttu-id="582c6-295">**ContosoRG**</span><span class="sxs-lookup"><span data-stu-id="582c6-295">**ContosoRG**</span></span> | <span data-ttu-id="582c6-296">This group contains resources related to production apps and databases.</span><span class="sxs-lookup"><span data-stu-id="582c6-296">This group contains resources related to production apps and databases.</span></span>

<span data-ttu-id="582c6-297">They create resource groups as follows:</span><span class="sxs-lookup"><span data-stu-id="582c6-297">They create resource groups as follows:</span></span>

1. <span data-ttu-id="582c6-298">In the Azure portal > **Resource groups**, they add a group.</span><span class="sxs-lookup"><span data-stu-id="582c6-298">In the Azure portal > **Resource groups**, they add a group.</span></span>
2. <span data-ttu-id="582c6-299">For each group they specify a name, the subscription to which the group belongs, and the region.</span><span class="sxs-lookup"><span data-stu-id="582c6-299">For each group they specify a name, the subscription to which the group belongs, and the region.</span></span>
3. <span data-ttu-id="582c6-300">Resource groups appear in the **Resource groups** list.</span><span class="sxs-lookup"><span data-stu-id="582c6-300">Resource groups appear in the **Resource groups** list.</span></span>

    ![Resource groups](./media/contoso-migration-infrastructure/resource-groups.png) 

##### <a name="scaling-resource-groups"></a><span data-ttu-id="582c6-302">Scaling resource groups</span><span class="sxs-lookup"><span data-stu-id="582c6-302">Scaling resource groups</span></span>

<span data-ttu-id="582c6-303">In future, Contoso will add other resource groups based on needs.</span><span class="sxs-lookup"><span data-stu-id="582c6-303">In future, Contoso will add other resource groups based on needs.</span></span> <span data-ttu-id="582c6-304">For example, they could define a resource group for each app or service, so that they can be managed and secure independently.</span><span class="sxs-lookup"><span data-stu-id="582c6-304">For example, they could define a resource group for each app or service, so that they can be managed and secure independently.</span></span>

#### <a name="create-matching-security-groups-on-premises"></a><span data-ttu-id="582c6-305">Create matching security groups on-premises</span><span class="sxs-lookup"><span data-stu-id="582c6-305">Create matching security groups on-premises</span></span>

1. <span data-ttu-id="582c6-306">In the on-premises Active Directory, Contoso admins set up security groups with names that match the names of the Azure resource groups.</span><span class="sxs-lookup"><span data-stu-id="582c6-306">In the on-premises Active Directory, Contoso admins set up security groups with names that match the names of the Azure resource groups.</span></span>
 
    ![On-premises AD security groups](./media/contoso-migration-infrastructure/on-prem-ad.png) 

2. <span data-ttu-id="582c6-308">For management purposes, they create an additional group that will be added to all of the other groups.</span><span class="sxs-lookup"><span data-stu-id="582c6-308">For management purposes, they create an additional group that will be added to all of the other groups.</span></span> <span data-ttu-id="582c6-309">This group will have rights to all resource groups in Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-309">This group will have rights to all resource groups in Azure.</span></span> <span data-ttu-id="582c6-310">A limited number of Global Admins will be added to this group.</span><span class="sxs-lookup"><span data-stu-id="582c6-310">A limited number of Global Admins will be added to this group.</span></span>

### <a name="synchronize-ad"></a><span data-ttu-id="582c6-311">Synchronize AD</span><span class="sxs-lookup"><span data-stu-id="582c6-311">Synchronize AD</span></span>

<span data-ttu-id="582c6-312">Contoso wants to provide a common identity for accessing resources on-premises and in the cloud.</span><span class="sxs-lookup"><span data-stu-id="582c6-312">Contoso wants to provide a common identity for accessing resources on-premises and in the cloud.</span></span> <span data-ttu-id="582c6-313">To do this, it will integrate the on-premises Active Directory with Azure AD.</span><span class="sxs-lookup"><span data-stu-id="582c6-313">To do this, it will integrate the on-premises Active Directory with Azure AD.</span></span> <span data-ttu-id="582c6-314">With this model:</span><span class="sxs-lookup"><span data-stu-id="582c6-314">With this model:</span></span>

- <span data-ttu-id="582c6-315">Users and organizations can take advantage of a single identity to access on-premises applications and cloud services such as Office 365, or thousands of other sites on the internet.</span><span class="sxs-lookup"><span data-stu-id="582c6-315">Users and organizations can take advantage of a single identity to access on-premises applications and cloud services such as Office 365, or thousands of other sites on the internet.</span></span>
- <span data-ttu-id="582c6-316">Admins can leverage the groups in AD to implement [Role Based Access Control (RBAC)](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal) in Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-316">Admins can leverage the groups in AD to implement [Role Based Access Control (RBAC)](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal) in Azure.</span></span>

<span data-ttu-id="582c6-317">To facilitate integration, Contoso uses the [Azure AD Connect tool](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect).</span><span class="sxs-lookup"><span data-stu-id="582c6-317">To facilitate integration, Contoso uses the [Azure AD Connect tool](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect).</span></span> <span data-ttu-id="582c6-318">When you install and configure the tool on a domain controller, it synchronizes the local on-premises AD identities to the Azure AD.</span><span class="sxs-lookup"><span data-stu-id="582c6-318">When you install and configure the tool on a domain controller, it synchronizes the local on-premises AD identities to the Azure AD.</span></span> 

### <a name="download-the-tool"></a><span data-ttu-id="582c6-319">Download the tool</span><span class="sxs-lookup"><span data-stu-id="582c6-319">Download the tool</span></span>


1. <span data-ttu-id="582c6-320">In the Azure portal, Contoso admins go to **Azure Active Directory** > **Azure AD Connect**, and download the latest version of the tool to the server they're using for synchronization.</span><span class="sxs-lookup"><span data-stu-id="582c6-320">In the Azure portal, Contoso admins go to **Azure Active Directory** > **Azure AD Connect**, and download the latest version of the tool to the server they're using for synchronization.</span></span>

    ![Download AD Connect](./media/contoso-migration-infrastructure/download-ad-connect.png) 

2. <span data-ttu-id="582c6-322">They start the **AzureADConnect.msi** installation, using **Use express settings**.</span><span class="sxs-lookup"><span data-stu-id="582c6-322">They start the **AzureADConnect.msi** installation, using **Use express settings**.</span></span> <span data-ttu-id="582c6-323">This is the most common installation, and can be used for a single-forest topology, with password hash synchronization for authentication.</span><span class="sxs-lookup"><span data-stu-id="582c6-323">This is the most common installation, and can be used for a single-forest topology, with password hash synchronization for authentication.</span></span>

    ![AD Connect Wizard](./media/contoso-migration-infrastructure/ad-connect-wiz1.png) 

3. <span data-ttu-id="582c6-325">In **Connect to Azure AD**, they specify the credentials for connecting to the Azure AD (in the form CONTOSO\admin or contoso.com\admin).</span><span class="sxs-lookup"><span data-stu-id="582c6-325">In **Connect to Azure AD**, they specify the credentials for connecting to the Azure AD (in the form CONTOSO\admin or contoso.com\admin).</span></span>

    ![AD Connect Wizard](./media/contoso-migration-infrastructure/ad-connect-wiz2.png) 

4. <span data-ttu-id="582c6-327">In **Connect to AD DS**, they specify credentials for the on-premises AD.</span><span class="sxs-lookup"><span data-stu-id="582c6-327">In **Connect to AD DS**, they specify credentials for the on-premises AD.</span></span>

     ![AD Connect Wizard](./media/contoso-migration-infrastructure/ad-connect-wiz3.png) 

5. <span data-ttu-id="582c6-329">In **Ready to configure**, they click **Start the synchronization process when configuration completes** to start the sync immediately.</span><span class="sxs-lookup"><span data-stu-id="582c6-329">In **Ready to configure**, they click **Start the synchronization process when configuration completes** to start the sync immediately.</span></span> <span data-ttu-id="582c6-330">Then they install.</span><span class="sxs-lookup"><span data-stu-id="582c6-330">Then they install.</span></span>

<span data-ttu-id="582c6-331">Note that:</span><span class="sxs-lookup"><span data-stu-id="582c6-331">Note that:</span></span>
- <span data-ttu-id="582c6-332">Contoso has a direct connection to Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-332">Contoso has a direct connection to Azure.</span></span> <span data-ttu-id="582c6-333">If your on-premises AD is behind a proxy, read this [article](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-troubleshoot-connectivity).</span><span class="sxs-lookup"><span data-stu-id="582c6-333">If your on-premises AD is behind a proxy, read this [article](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-troubleshoot-connectivity).</span></span>
- <span data-ttu-id="582c6-334">After the first synchronization, on-premises AD objects can be seen in the Azure AD.</span><span class="sxs-lookup"><span data-stu-id="582c6-334">After the first synchronization, on-premises AD objects can be seen in the Azure AD.</span></span>

    ![On-premises AD in Azure](./media/contoso-migration-infrastructure/on-prem-ad-groups.png) 

- <span data-ttu-id="582c6-336">Contoso IT team is represented in each group, based on its role.</span><span class="sxs-lookup"><span data-stu-id="582c6-336">Contoso IT team is represented in each group, based on its role.</span></span>

    ![On-premises AD members in Azure](./media/contoso-migration-infrastructure/on-prem-ad-group-members.png) 

### <a name="set-up-rbac"></a><span data-ttu-id="582c6-338">Set up RBAC</span><span class="sxs-lookup"><span data-stu-id="582c6-338">Set up RBAC</span></span>

<span data-ttu-id="582c6-339">Azure [Role-Based Access Control (RBAC)](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal) enables fine-grained access management for Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-339">Azure [Role-Based Access Control (RBAC)](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal) enables fine-grained access management for Azure.</span></span> <span data-ttu-id="582c6-340">Using RBAC, you can grant only the amount of access that users need to perform tasks.</span><span class="sxs-lookup"><span data-stu-id="582c6-340">Using RBAC, you can grant only the amount of access that users need to perform tasks.</span></span> <span data-ttu-id="582c6-341">You assign the appropriate RBAC role to users, groups, and applications at a scope level.</span><span class="sxs-lookup"><span data-stu-id="582c6-341">You assign the appropriate RBAC role to users, groups, and applications at a scope level.</span></span> <span data-ttu-id="582c6-342">The scope of a role assignment can be a subscription, a resource group, or a single resource.</span><span class="sxs-lookup"><span data-stu-id="582c6-342">The scope of a role assignment can be a subscription, a resource group, or a single resource.</span></span> 

<span data-ttu-id="582c6-343">Contoso admins now assigns roles to the AD groups that they synchronized from on-premises.</span><span class="sxs-lookup"><span data-stu-id="582c6-343">Contoso admins now assigns roles to the AD groups that they synchronized from on-premises.</span></span>

1. <span data-ttu-id="582c6-344">In the **ControlCobRG** resource group, they click **Access control (IAM)** > **Add**.</span><span class="sxs-lookup"><span data-stu-id="582c6-344">In the **ControlCobRG** resource group, they click **Access control (IAM)** > **Add**.</span></span>
2. <span data-ttu-id="582c6-345">In **Add Permissions** > **Role**, they select **Contributor**, and select the **ContosoCobRG** AD group from the list.</span><span class="sxs-lookup"><span data-stu-id="582c6-345">In **Add Permissions** > **Role**, they select **Contributor**, and select the **ContosoCobRG** AD group from the list.</span></span> <span data-ttu-id="582c6-346">The group then appears in  **Selected members** list.</span><span class="sxs-lookup"><span data-stu-id="582c6-346">The group then appears in  **Selected members** list.</span></span> 
3. <span data-ttu-id="582c6-347">They repeat this with the same permissions for the other resource groups (except for **ContosoAzureAdmins**), by adding the Contributor permissions to the AD account that matches the resource group.</span><span class="sxs-lookup"><span data-stu-id="582c6-347">They repeat this with the same permissions for the other resource groups (except for **ContosoAzureAdmins**), by adding the Contributor permissions to the AD account that matches the resource group.</span></span>
4. <span data-ttu-id="582c6-348">For the **ContosoAzureAdmins** AD group, they assign the **Owner** role.</span><span class="sxs-lookup"><span data-stu-id="582c6-348">For the **ContosoAzureAdmins** AD group, they assign the **Owner** role.</span></span>

    ![On-premises AD members in Azure](./media/contoso-migration-infrastructure/on-prem-ad-groups.png) 


## <a name="step-3-design-for-resilience-and-disaster"></a><span data-ttu-id="582c6-350">Step 3: Design for resilience and disaster</span><span class="sxs-lookup"><span data-stu-id="582c6-350">Step 3: Design for resilience and disaster</span></span>

### <a name="set-up-regions"></a><span data-ttu-id="582c6-351">Set up regions</span><span class="sxs-lookup"><span data-stu-id="582c6-351">Set up regions</span></span>

<span data-ttu-id="582c6-352">Azure resources are deployed within regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-352">Azure resources are deployed within regions.</span></span>

- <span data-ttu-id="582c6-353">Regions are organized into geographies, and data residency, sovereignty, compliance and resiliency requirements are honored within geographical boundaries.</span><span class="sxs-lookup"><span data-stu-id="582c6-353">Regions are organized into geographies, and data residency, sovereignty, compliance and resiliency requirements are honored within geographical boundaries.</span></span>
- <span data-ttu-id="582c6-354">A region is composed of a set of datacenters.</span><span class="sxs-lookup"><span data-stu-id="582c6-354">A region is composed of a set of datacenters.</span></span> <span data-ttu-id="582c6-355">These datacenters are deployed within a latency-defined perimeter, and connected through a dedicated regional low-latency network.</span><span class="sxs-lookup"><span data-stu-id="582c6-355">These datacenters are deployed within a latency-defined perimeter, and connected through a dedicated regional low-latency network.</span></span>
- <span data-ttu-id="582c6-356">Each Azure region is paired with a different region for resiliency.</span><span class="sxs-lookup"><span data-stu-id="582c6-356">Each Azure region is paired with a different region for resiliency.</span></span>
- <span data-ttu-id="582c6-357">Read about [Azure regions](https://azure.microsoft.com/global-infrastructure/regions/), and understand [how regions are paired](https://docs.microsoft.com/azure/best-practices-availability-paired-regions).</span><span class="sxs-lookup"><span data-stu-id="582c6-357">Read about [Azure regions](https://azure.microsoft.com/global-infrastructure/regions/), and understand [how regions are paired](https://docs.microsoft.com/azure/best-practices-availability-paired-regions).</span></span>


<span data-ttu-id="582c6-358">Contoso has decided to go with the East US 2 (located in Virginia) as the primary region, and Central US as the secondary region.</span><span class="sxs-lookup"><span data-stu-id="582c6-358">Contoso has decided to go with the East US 2 (located in Virginia) as the primary region, and Central US as the secondary region.</span></span> <span data-ttu-id="582c6-359">There are a couple of reasons for this:</span><span class="sxs-lookup"><span data-stu-id="582c6-359">There are a couple of reasons for this:</span></span>

- <span data-ttu-id="582c6-360">The Contoso datacenter is located in New York, and Contoso considered latency to the closest datacenter.</span><span class="sxs-lookup"><span data-stu-id="582c6-360">The Contoso datacenter is located in New York, and Contoso considered latency to the closest datacenter.</span></span>
- <span data-ttu-id="582c6-361">The East US 2 region has all the service and products that Contoso needs to use.</span><span class="sxs-lookup"><span data-stu-id="582c6-361">The East US 2 region has all the service and products that Contoso needs to use.</span></span> <span data-ttu-id="582c6-362">Not all Azure regions are the same in terms of the products and services available.</span><span class="sxs-lookup"><span data-stu-id="582c6-362">Not all Azure regions are the same in terms of the products and services available.</span></span> <span data-ttu-id="582c6-363">You can review [Azure products by region](https://azure.microsoft.com/global-infrastructure/services/).</span><span class="sxs-lookup"><span data-stu-id="582c6-363">You can review [Azure products by region](https://azure.microsoft.com/global-infrastructure/services/).</span></span>
- <span data-ttu-id="582c6-364">Central US is the Azure paired region for East US 2.</span><span class="sxs-lookup"><span data-stu-id="582c6-364">Central US is the Azure paired region for East US 2.</span></span>

<span data-ttu-id="582c6-365">As it thinks about the hybrid environment, Contoso needs to consider how to build resilience and a disaster recovery strategy into the region design.</span><span class="sxs-lookup"><span data-stu-id="582c6-365">As it thinks about the hybrid environment, Contoso needs to consider how to build resilience and a disaster recovery strategy into the region design.</span></span> <span data-ttu-id="582c6-366">Broadly, strategies range from a single-region deployment, which relies on Azure platform features such as fault domains and regional pairing for resilience, through to a full Active-Active model in which cloud services and database are deployed and servicing users from two regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-366">Broadly, strategies range from a single-region deployment, which relies on Azure platform features such as fault domains and regional pairing for resilience, through to a full Active-Active model in which cloud services and database are deployed and servicing users from two regions.</span></span>

<span data-ttu-id="582c6-367">Contoso has decided to take a middle road.</span><span class="sxs-lookup"><span data-stu-id="582c6-367">Contoso has decided to take a middle road.</span></span> <span data-ttu-id="582c6-368">It will deploy apps and resources in a primary region, and keep a full infrastructure in the secondary region, so that it's ready to act as a full backup in case of complete app disaster, or region failure.</span><span class="sxs-lookup"><span data-stu-id="582c6-368">It will deploy apps and resources in a primary region, and keep a full infrastructure in the secondary region, so that it's ready to act as a full backup in case of complete app disaster, or region failure.</span></span>

### <a name="set-up-availability-zones"></a><span data-ttu-id="582c6-369">Set up availability zones</span><span class="sxs-lookup"><span data-stu-id="582c6-369">Set up availability zones</span></span>

<span data-ttu-id="582c6-370">Availability zones help protect apps and data from datacenter failures.</span><span class="sxs-lookup"><span data-stu-id="582c6-370">Availability zones help protect apps and data from datacenter failures.</span></span>

- <span data-ttu-id="582c6-371">Each availability zone is a unique physical location within an Azure region.</span><span class="sxs-lookup"><span data-stu-id="582c6-371">Each availability zone is a unique physical location within an Azure region.</span></span>
- <span data-ttu-id="582c6-372">Each zone is made up of one or more datacenters equipped with independent power, cooling, and networking.</span><span class="sxs-lookup"><span data-stu-id="582c6-372">Each zone is made up of one or more datacenters equipped with independent power, cooling, and networking.</span></span> 
- <span data-ttu-id="582c6-373">There's a minimum of three separate zones in all enabled regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-373">There's a minimum of three separate zones in all enabled regions.</span></span>
- <span data-ttu-id="582c6-374">The physical separation of zones within a region protects applications and data from datacenter failures.</span><span class="sxs-lookup"><span data-stu-id="582c6-374">The physical separation of zones within a region protects applications and data from datacenter failures.</span></span>

<span data-ttu-id="582c6-375">Contoso will deploy availability zones as apps call for scalability, high-availability, and resiliency.</span><span class="sxs-lookup"><span data-stu-id="582c6-375">Contoso will deploy availability zones as apps call for scalability, high-availability, and resiliency.</span></span> <span data-ttu-id="582c6-376">[Learn more](https://docs.microsoft.com/azure/availability-zones/az-overview).</span><span class="sxs-lookup"><span data-stu-id="582c6-376">[Learn more](https://docs.microsoft.com/azure/availability-zones/az-overview).</span></span> 


## <a name="step-4-design-a-network-infrastructure"></a><span data-ttu-id="582c6-377">Step 4: Design a network infrastructure</span><span class="sxs-lookup"><span data-stu-id="582c6-377">Step 4: Design a network infrastructure</span></span>

<span data-ttu-id="582c6-378">With the regional design in place, Contoso is ready to consider a networking strategy.</span><span class="sxs-lookup"><span data-stu-id="582c6-378">With the regional design in place, Contoso is ready to consider a networking strategy.</span></span> <span data-ttu-id="582c6-379">It needs to think about how the on-premises datacenter and Azure connect and communicate with each other, and how to design your network infrastructure in Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-379">It needs to think about how the on-premises datacenter and Azure connect and communicate with each other, and how to design your network infrastructure in Azure.</span></span> <span data-ttu-id="582c6-380">Specifically Contoso needs to:</span><span class="sxs-lookup"><span data-stu-id="582c6-380">Specifically Contoso needs to:</span></span>

<span data-ttu-id="582c6-381">**Plan hybrid network connectivity**: Figure out how it's going to connect networks across on-premises and Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-381">**Plan hybrid network connectivity**: Figure out how it's going to connect networks across on-premises and Azure.</span></span>
<span data-ttu-id="582c6-382">**Design an Azure network infrastructure**: Decide how it will deploy networks over regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-382">**Design an Azure network infrastructure**: Decide how it will deploy networks over regions.</span></span> <span data-ttu-id="582c6-383">How will networks communicate within the same region, and across regions?</span><span class="sxs-lookup"><span data-stu-id="582c6-383">How will networks communicate within the same region, and across regions?</span></span>
<span data-ttu-id="582c6-384">**Design and set up Azure networks**: Set up Azure networks and subnets, and decide what will reside in them.</span><span class="sxs-lookup"><span data-stu-id="582c6-384">**Design and set up Azure networks**: Set up Azure networks and subnets, and decide what will reside in them.</span></span>

### <a name="plan-hybrid-network-connectivity"></a><span data-ttu-id="582c6-385">Plan hybrid network connectivity</span><span class="sxs-lookup"><span data-stu-id="582c6-385">Plan hybrid network connectivity</span></span>

<span data-ttu-id="582c6-386">Contoso considered a [number of architectures](https://docs.microsoft.com/azure/architecture/reference-architectures/hybrid-networking/) for hybrid networking between Azure and the on-premises datacenter.</span><span class="sxs-lookup"><span data-stu-id="582c6-386">Contoso considered a [number of architectures](https://docs.microsoft.com/azure/architecture/reference-architectures/hybrid-networking/) for hybrid networking between Azure and the on-premises datacenter.</span></span> <span data-ttu-id="582c6-387">[Read more](https://docs.microsoft.com/azure/architecture/reference-architectures/hybrid-networking/considerations) about comparing options.</span><span class="sxs-lookup"><span data-stu-id="582c6-387">[Read more](https://docs.microsoft.com/azure/architecture/reference-architectures/hybrid-networking/considerations) about comparing options.</span></span>

<span data-ttu-id="582c6-388">As a reminder, the Contoso on-premises network infrastructure currently consists of the datacenter in New York, and local branches in the eastern portion of the US.</span><span class="sxs-lookup"><span data-stu-id="582c6-388">As a reminder, the Contoso on-premises network infrastructure currently consists of the datacenter in New York, and local branches in the eastern portion of the US.</span></span>  <span data-ttu-id="582c6-389">All locations have a business class connection to the internet.</span><span class="sxs-lookup"><span data-stu-id="582c6-389">All locations have a business class connection to the internet.</span></span>  <span data-ttu-id="582c6-390">Each of the branches is then connected to the datacenter via a IPSec VPN tunnel over the internet.</span><span class="sxs-lookup"><span data-stu-id="582c6-390">Each of the branches is then connected to the datacenter via a IPSec VPN tunnel over the internet.</span></span>

![Contoso network](./media/contoso-migration-infrastructure/contoso-networking.png) 

<span data-ttu-id="582c6-392">Here's how Contoso decided to implement hybrid connectivity:</span><span class="sxs-lookup"><span data-stu-id="582c6-392">Here's how Contoso decided to implement hybrid connectivity:</span></span>

1. <span data-ttu-id="582c6-393">Set up a new site-to-site VPN connection between the Contoso datacenter in New York and the two Azure regions in East US 2 and Central US.</span><span class="sxs-lookup"><span data-stu-id="582c6-393">Set up a new site-to-site VPN connection between the Contoso datacenter in New York and the two Azure regions in East US 2 and Central US.</span></span>
2. <span data-ttu-id="582c6-394">Branch office traffic bound for Azure virtual networks will route through the main Contoso datacenter.</span><span class="sxs-lookup"><span data-stu-id="582c6-394">Branch office traffic bound for Azure virtual networks will route through the main Contoso datacenter.</span></span> 
3. <span data-ttu-id="582c6-395">As Contoso scales up Azure deployment, it will establish an ExpressRoute connection between the datacenter and the Azure regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-395">As Contoso scales up Azure deployment, it will establish an ExpressRoute connection between the datacenter and the Azure regions.</span></span> <span data-ttu-id="582c6-396">When this happens, Contoso will retain the VPN site-to-site connection for failover purposes only.</span><span class="sxs-lookup"><span data-stu-id="582c6-396">When this happens, Contoso will retain the VPN site-to-site connection for failover purposes only.</span></span>
    - <span data-ttu-id="582c6-397">[Learn more](https://docs.microsoft.com/azure/architecture/reference-architectures/hybrid-networking/considerations) about choosing between a VPN and ExpressRoute hybrid solution.</span><span class="sxs-lookup"><span data-stu-id="582c6-397">[Learn more](https://docs.microsoft.com/azure/architecture/reference-architectures/hybrid-networking/considerations) about choosing between a VPN and ExpressRoute hybrid solution.</span></span>
    - <span data-ttu-id="582c6-398">Verify [ExpressRoute locations and support](https://docs.microsoft.com/azure/expressroute/expressroute-locations-providers).</span><span class="sxs-lookup"><span data-stu-id="582c6-398">Verify [ExpressRoute locations and support](https://docs.microsoft.com/azure/expressroute/expressroute-locations-providers).</span></span>


<span data-ttu-id="582c6-399">**VPN only**</span><span class="sxs-lookup"><span data-stu-id="582c6-399">**VPN only**</span></span>

![Contoso VPN](./media/contoso-migration-infrastructure/hybrid-vpn.png) 


<span data-ttu-id="582c6-401">**VPN and ExpressRoute**</span><span class="sxs-lookup"><span data-stu-id="582c6-401">**VPN and ExpressRoute**</span></span>

![Contoso VPN/ExpressRoute](./media/contoso-migration-infrastructure/hybrid-vpn-expressroute.png) 


### <a name="design-the-azure-network-infrastructure"></a><span data-ttu-id="582c6-403">Design the Azure network infrastructure</span><span class="sxs-lookup"><span data-stu-id="582c6-403">Design the Azure network infrastructure</span></span>

<span data-ttu-id="582c6-404">It's critical that Contoso puts networks in place in a way that makes the hybrid deployment secure and scalable.</span><span class="sxs-lookup"><span data-stu-id="582c6-404">It's critical that Contoso puts networks in place in a way that makes the hybrid deployment secure and scalable.</span></span> <span data-ttu-id="582c6-405">To do this, Contoso are taking a long-term approach, and are designing virtual networks (VNets) to be resilience and enterprise ready.</span><span class="sxs-lookup"><span data-stu-id="582c6-405">To do this, Contoso are taking a long-term approach, and are designing virtual networks (VNets) to be resilience and enterprise ready.</span></span> <span data-ttu-id="582c6-406">[Learn more](https://docs.microsoft.com/azure/virtual-network/virtual-network-vnet-plan-design-arm) about planning VNets.</span><span class="sxs-lookup"><span data-stu-id="582c6-406">[Learn more](https://docs.microsoft.com/azure/virtual-network/virtual-network-vnet-plan-design-arm) about planning VNets.</span></span>

<span data-ttu-id="582c6-407">To connect the two regions, Contoso has decided to implement a hub-to-hub network model:</span><span class="sxs-lookup"><span data-stu-id="582c6-407">To connect the two regions, Contoso has decided to implement a hub-to-hub network model:</span></span>

- <span data-ttu-id="582c6-408">Within each region, Contoso will use a hub-and-spoke model.</span><span class="sxs-lookup"><span data-stu-id="582c6-408">Within each region, Contoso will use a hub-and-spoke model.</span></span>
- <span data-ttu-id="582c6-409">To connect networks and  hubs, Contoso will use Azure network peering.</span><span class="sxs-lookup"><span data-stu-id="582c6-409">To connect networks and  hubs, Contoso will use Azure network peering.</span></span>

#### <a name="network-peering"></a><span data-ttu-id="582c6-410">Network peering</span><span class="sxs-lookup"><span data-stu-id="582c6-410">Network peering</span></span>

<span data-ttu-id="582c6-411">Azure provides network peering to connect VNets and hubs.</span><span class="sxs-lookup"><span data-stu-id="582c6-411">Azure provides network peering to connect VNets and hubs.</span></span> <span data-ttu-id="582c6-412">Global peering allows connections between VNets/hubs in different regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-412">Global peering allows connections between VNets/hubs in different regions.</span></span> <span data-ttu-id="582c6-413">Local peering connects VNets in the same region.</span><span class="sxs-lookup"><span data-stu-id="582c6-413">Local peering connects VNets in the same region.</span></span> <span data-ttu-id="582c6-414">VNet peering provide a number of advantages:</span><span class="sxs-lookup"><span data-stu-id="582c6-414">VNet peering provide a number of advantages:</span></span>

- <span data-ttu-id="582c6-415">Network traffic between peered VNets is private.</span><span class="sxs-lookup"><span data-stu-id="582c6-415">Network traffic between peered VNets is private.</span></span>
- <span data-ttu-id="582c6-416">Traffic between the VNets is kept on the Microsoft backbone network.</span><span class="sxs-lookup"><span data-stu-id="582c6-416">Traffic between the VNets is kept on the Microsoft backbone network.</span></span> <span data-ttu-id="582c6-417">No public internet, gateways, or encryption is required in the communication between the VNets.</span><span class="sxs-lookup"><span data-stu-id="582c6-417">No public internet, gateways, or encryption is required in the communication between the VNets.</span></span>
- <span data-ttu-id="582c6-418">Peering provides a default, low-latency, high-bandwidth connection between resources in different VNets.</span><span class="sxs-lookup"><span data-stu-id="582c6-418">Peering provides a default, low-latency, high-bandwidth connection between resources in different VNets.</span></span>

<span data-ttu-id="582c6-419">[Learn more](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) about network peering.</span><span class="sxs-lookup"><span data-stu-id="582c6-419">[Learn more](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview) about network peering.</span></span>

#### <a name="hub-to-hub-across-regions"></a><span data-ttu-id="582c6-420">Hub-to-hub across regions</span><span class="sxs-lookup"><span data-stu-id="582c6-420">Hub-to-hub across regions</span></span>

<span data-ttu-id="582c6-421">Contoso will deploy a hub in each region.</span><span class="sxs-lookup"><span data-stu-id="582c6-421">Contoso will deploy a hub in each region.</span></span> <span data-ttu-id="582c6-422">A hub is a virtual network (VNet) in Azure that acts as a central point of connectivity to your on-premises network.</span><span class="sxs-lookup"><span data-stu-id="582c6-422">A hub is a virtual network (VNet) in Azure that acts as a central point of connectivity to your on-premises network.</span></span> <span data-ttu-id="582c6-423">The hub VNets will connect to each other using global VNet peering.</span><span class="sxs-lookup"><span data-stu-id="582c6-423">The hub VNets will connect to each other using global VNet peering.</span></span> <span data-ttu-id="582c6-424">Global VNet peering connects VNets across Azure regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-424">Global VNet peering connects VNets across Azure regions.</span></span>

- <span data-ttu-id="582c6-425">The hub in each region is peered to its partner hub in the other region.</span><span class="sxs-lookup"><span data-stu-id="582c6-425">The hub in each region is peered to its partner hub in the other region.</span></span>
- <span data-ttu-id="582c6-426">The hub is peered to every network in its region, and can connect to all network resources.</span><span class="sxs-lookup"><span data-stu-id="582c6-426">The hub is peered to every network in its region, and can connect to all network resources.</span></span>

    ![Global peering](./media/contoso-migration-infrastructure/global-peering.png) 

#### <a name="hub-and-spoke-within-a-region"></a><span data-ttu-id="582c6-428">Hub-and-spoke within a region</span><span class="sxs-lookup"><span data-stu-id="582c6-428">Hub-and-spoke within a region</span></span>

<span data-ttu-id="582c6-429">Within each region, Contoso will deploy VNets for different purposes, as spoke networks from the region hub.</span><span class="sxs-lookup"><span data-stu-id="582c6-429">Within each region, Contoso will deploy VNets for different purposes, as spoke networks from the region hub.</span></span> <span data-ttu-id="582c6-430">VNets within a region use peering to connect to their hub, and to each other.</span><span class="sxs-lookup"><span data-stu-id="582c6-430">VNets within a region use peering to connect to their hub, and to each other.</span></span>

#### <a name="design-the-hub-network"></a><span data-ttu-id="582c6-431">Design the hub network</span><span class="sxs-lookup"><span data-stu-id="582c6-431">Design the hub network</span></span>

<span data-ttu-id="582c6-432">Within the hub and spoke model that Contoso has chosen, it needs to think about how traffic from the on-premises datacenter, and from the internet, will be routed.</span><span class="sxs-lookup"><span data-stu-id="582c6-432">Within the hub and spoke model that Contoso has chosen, it needs to think about how traffic from the on-premises datacenter, and from the internet, will be routed.</span></span> <span data-ttu-id="582c6-433">Here's how Contoso has decided to handle routing for both the East US 2 and Central US hubs:</span><span class="sxs-lookup"><span data-stu-id="582c6-433">Here's how Contoso has decided to handle routing for both the East US 2 and Central US hubs:</span></span>

- <span data-ttu-id="582c6-434">Contoso is designing a network known as "reverse c", as this is the path that the packets follow from the inbound to outbound network.</span><span class="sxs-lookup"><span data-stu-id="582c6-434">Contoso is designing a network known as "reverse c", as this is the path that the packets follow from the inbound to outbound network.</span></span>
- <span data-ttu-id="582c6-435">The network architecture has two boundaries, an untrusted front-end perimeter zone and a back-end trusted zone.</span><span class="sxs-lookup"><span data-stu-id="582c6-435">The network architecture has two boundaries, an untrusted front-end perimeter zone and a back-end trusted zone.</span></span>
- <span data-ttu-id="582c6-436">A firewall will have a network adapter in each zone, controlling access to trusted zones.</span><span class="sxs-lookup"><span data-stu-id="582c6-436">A firewall will have a network adapter in each zone, controlling access to trusted zones.</span></span>
- <span data-ttu-id="582c6-437">From the internet:</span><span class="sxs-lookup"><span data-stu-id="582c6-437">From the internet:</span></span>
    - <span data-ttu-id="582c6-438">Internet traffic will hit a load-balanced public IP address on the perimeter network.</span><span class="sxs-lookup"><span data-stu-id="582c6-438">Internet traffic will hit a load-balanced public IP address on the perimeter network.</span></span>
    - <span data-ttu-id="582c6-439">This traffic is routed through the firewall, and subject to firewall rules.</span><span class="sxs-lookup"><span data-stu-id="582c6-439">This traffic is routed through the firewall, and subject to firewall rules.</span></span>
    - <span data-ttu-id="582c6-440">After network access controls are implemented, traffic will be forwarded to the appropriate location in the trusted zone.</span><span class="sxs-lookup"><span data-stu-id="582c6-440">After network access controls are implemented, traffic will be forwarded to the appropriate location in the trusted zone.</span></span>
    - <span data-ttu-id="582c6-441">Outbound traffic from the VNet will be routed to the internet using user-defined routes (UDRs).</span><span class="sxs-lookup"><span data-stu-id="582c6-441">Outbound traffic from the VNet will be routed to the internet using user-defined routes (UDRs).</span></span> <span data-ttu-id="582c6-442">The traffic is forced through the firewall, and inspected in line with Contoso policies.</span><span class="sxs-lookup"><span data-stu-id="582c6-442">The traffic is forced through the firewall, and inspected in line with Contoso policies.</span></span>
- <span data-ttu-id="582c6-443">From the Contoso datacenter:</span><span class="sxs-lookup"><span data-stu-id="582c6-443">From the Contoso datacenter:</span></span>
    - <span data-ttu-id="582c6-444">Incoming traffic over VPN site-to-site (or ExpressRoute) hits the public IP address of the Azure VPN gateway.</span><span class="sxs-lookup"><span data-stu-id="582c6-444">Incoming traffic over VPN site-to-site (or ExpressRoute) hits the public IP address of the Azure VPN gateway.</span></span>
    - <span data-ttu-id="582c6-445">Traffic is routed through the firewall and subject to firewall rules.</span><span class="sxs-lookup"><span data-stu-id="582c6-445">Traffic is routed through the firewall and subject to firewall rules.</span></span>
    - <span data-ttu-id="582c6-446">After applying rules traffic is forwarded to an internal load balancer (Standard SKU) on the trusted internal zone subnet.</span><span class="sxs-lookup"><span data-stu-id="582c6-446">After applying rules traffic is forwarded to an internal load balancer (Standard SKU) on the trusted internal zone subnet.</span></span>
    - <span data-ttu-id="582c6-447">Outbound traffic from the trusted subnet to the on-premises datacenter over VPN is routed through the firewall, and rules applied, before going over the VPN site-to-site connection.</span><span class="sxs-lookup"><span data-stu-id="582c6-447">Outbound traffic from the trusted subnet to the on-premises datacenter over VPN is routed through the firewall, and rules applied, before going over the VPN site-to-site connection.</span></span>



### <a name="design-and-set-up-azure-networks"></a><span data-ttu-id="582c6-448">Design and set up Azure networks</span><span class="sxs-lookup"><span data-stu-id="582c6-448">Design and set up Azure networks</span></span>

<span data-ttu-id="582c6-449">With a network and routing topology in place, Contoso is ready to set up Azure networks and subnets.</span><span class="sxs-lookup"><span data-stu-id="582c6-449">With a network and routing topology in place, Contoso is ready to set up Azure networks and subnets.</span></span>

- <span data-ttu-id="582c6-450">Contoso will implement a Class A private network in Azure (0.0.0.0 to 127.255.255.255).</span><span class="sxs-lookup"><span data-stu-id="582c6-450">Contoso will implement a Class A private network in Azure (0.0.0.0 to 127.255.255.255).</span></span> <span data-ttu-id="582c6-451">This works, since on-premises it currently has a Class B private address space 172.160.0/16 so Contoso can be sure there won't be any overlap between address ranges.</span><span class="sxs-lookup"><span data-stu-id="582c6-451">This works, since on-premises it currently has a Class B private address space 172.160.0/16 so Contoso can be sure there won't be any overlap between address ranges.</span></span>
- <span data-ttu-id="582c6-452">It's going to deploy VNets in the primary and secondary regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-452">It's going to deploy VNets in the primary and secondary regions.</span></span>
- <span data-ttu-id="582c6-453">Contoso will use a naming convention that includes the prefix **VNET** and the region abbreviation **EUS2** or **CUS**.</span><span class="sxs-lookup"><span data-stu-id="582c6-453">Contoso will use a naming convention that includes the prefix **VNET** and the region abbreviation **EUS2** or **CUS**.</span></span> <span data-ttu-id="582c6-454">Using this standard, the hub networks will be named **VNET-HUB-EUS2** (East US 2), and **VNET-HUB-CUS** (Central US).</span><span class="sxs-lookup"><span data-stu-id="582c6-454">Using this standard, the hub networks will be named **VNET-HUB-EUS2** (East US 2), and **VNET-HUB-CUS** (Central US).</span></span>
- <span data-ttu-id="582c6-455">Contoso doesn't have an [IPAM solution](https://docs.microsoft.com/windows-server/networking/technologies/ipam/ipam-top), so it needs to plan for network routing without NAT.</span><span class="sxs-lookup"><span data-stu-id="582c6-455">Contoso doesn't have an [IPAM solution](https://docs.microsoft.com/windows-server/networking/technologies/ipam/ipam-top), so it needs to plan for network routing without NAT.</span></span>


#### <a name="virtual-networks-in-east-us-2"></a><span data-ttu-id="582c6-456">Virtual networks in East US 2</span><span class="sxs-lookup"><span data-stu-id="582c6-456">Virtual networks in East US 2</span></span>

<span data-ttu-id="582c6-457">East US 2 is the primary region that Contoso will use to deploy resources and services.</span><span class="sxs-lookup"><span data-stu-id="582c6-457">East US 2 is the primary region that Contoso will use to deploy resources and services.</span></span> <span data-ttu-id="582c6-458">Here's how Contoso will architect networks within it:</span><span class="sxs-lookup"><span data-stu-id="582c6-458">Here's how Contoso will architect networks within it:</span></span>

- <span data-ttu-id="582c6-459">**Hub**: The hub VNet in East US 2 is the central point of primary connectivity to the on-premises datacenter.</span><span class="sxs-lookup"><span data-stu-id="582c6-459">**Hub**: The hub VNet in East US 2 is the central point of primary connectivity to the on-premises datacenter.</span></span>
- <span data-ttu-id="582c6-460">**VNets**: Spoke VNets in East US 2 can be used to isolate workloads if required.</span><span class="sxs-lookup"><span data-stu-id="582c6-460">**VNets**: Spoke VNets in East US 2 can be used to isolate workloads if required.</span></span> <span data-ttu-id="582c6-461">In addition to the Hub VNet, Contoso will have two spoke VNets in East US 2:</span><span class="sxs-lookup"><span data-stu-id="582c6-461">In addition to the Hub VNet, Contoso will have two spoke VNets in East US 2:</span></span>
    - <span data-ttu-id="582c6-462">**VNET-DEV-EUS2**.</span><span class="sxs-lookup"><span data-stu-id="582c6-462">**VNET-DEV-EUS2**.</span></span> <span data-ttu-id="582c6-463">This VNet will provide the development and test team will a fully functional network for dev projects.</span><span class="sxs-lookup"><span data-stu-id="582c6-463">This VNet will provide the development and test team will a fully functional network for dev projects.</span></span> <span data-ttu-id="582c6-464">It will act as a production pilot area, and will rely on the production infrastructure to function.</span><span class="sxs-lookup"><span data-stu-id="582c6-464">It will act as a production pilot area, and will rely on the production infrastructure to function.</span></span>
    - <span data-ttu-id="582c6-465">**VNET-PROD-EUS2**: Azure IaaS production components will be located in this network.</span><span class="sxs-lookup"><span data-stu-id="582c6-465">**VNET-PROD-EUS2**: Azure IaaS production components will be located in this network.</span></span> 
    -  <span data-ttu-id="582c6-466">Each VNet will have its own unique address space, with no overlap.</span><span class="sxs-lookup"><span data-stu-id="582c6-466">Each VNet will have its own unique address space, with no overlap.</span></span> <span data-ttu-id="582c6-467">Contoso intend to configure routing without requiring NAT.</span><span class="sxs-lookup"><span data-stu-id="582c6-467">Contoso intend to configure routing without requiring NAT.</span></span>
- <span data-ttu-id="582c6-468">**Subnets**:</span><span class="sxs-lookup"><span data-stu-id="582c6-468">**Subnets**:</span></span>
    - <span data-ttu-id="582c6-469">There will be a subnet in each network for each app tier</span><span class="sxs-lookup"><span data-stu-id="582c6-469">There will be a subnet in each network for each app tier</span></span>
    - <span data-ttu-id="582c6-470">Each subnet in the Production network will have a matching subnet in the Dev VNet.</span><span class="sxs-lookup"><span data-stu-id="582c6-470">Each subnet in the Production network will have a matching subnet in the Dev VNet.</span></span>
    - <span data-ttu-id="582c6-471">In addition, the Production network has a subnet for domain controllers.</span><span class="sxs-lookup"><span data-stu-id="582c6-471">In addition, the Production network has a subnet for domain controllers.</span></span>

<span data-ttu-id="582c6-472">VNets in East  US 2 are summarized in the following table.</span><span class="sxs-lookup"><span data-stu-id="582c6-472">VNets in East  US 2 are summarized in the following table.</span></span>

<span data-ttu-id="582c6-473">**VNet**</span><span class="sxs-lookup"><span data-stu-id="582c6-473">**VNet**</span></span> | <span data-ttu-id="582c6-474">**Range**</span><span class="sxs-lookup"><span data-stu-id="582c6-474">**Range**</span></span> | <span data-ttu-id="582c6-475">**Peer**</span><span class="sxs-lookup"><span data-stu-id="582c6-475">**Peer**</span></span>
--- | --- | ---
<span data-ttu-id="582c6-476">**VNET-HUB-EUS2**</span><span class="sxs-lookup"><span data-stu-id="582c6-476">**VNET-HUB-EUS2**</span></span> | <span data-ttu-id="582c6-477">10.240.0.0/20</span><span class="sxs-lookup"><span data-stu-id="582c6-477">10.240.0.0/20</span></span> | <span data-ttu-id="582c6-478">VNET-HUB-CUS2, VNET-DEV-EUS2, VNET-PROD-EUS2</span><span class="sxs-lookup"><span data-stu-id="582c6-478">VNET-HUB-CUS2, VNET-DEV-EUS2, VNET-PROD-EUS2</span></span>
<span data-ttu-id="582c6-479">**VNET-DEV-EUS2**</span><span class="sxs-lookup"><span data-stu-id="582c6-479">**VNET-DEV-EUS2**</span></span> | <span data-ttu-id="582c6-480">10.245.16.0/20</span><span class="sxs-lookup"><span data-stu-id="582c6-480">10.245.16.0/20</span></span> | <span data-ttu-id="582c6-481">VNET-HUB-EUS2</span><span class="sxs-lookup"><span data-stu-id="582c6-481">VNET-HUB-EUS2</span></span>
<span data-ttu-id="582c6-482">**VNET-PROD-EUS2**</span><span class="sxs-lookup"><span data-stu-id="582c6-482">**VNET-PROD-EUS2**</span></span> | <span data-ttu-id="582c6-483">10.245.32.0/20</span><span class="sxs-lookup"><span data-stu-id="582c6-483">10.245.32.0/20</span></span> | <span data-ttu-id="582c6-484">VNET-HUB-EUS2, VNET-PROD-CUS</span><span class="sxs-lookup"><span data-stu-id="582c6-484">VNET-HUB-EUS2, VNET-PROD-CUS</span></span>

![Hub/spoke in primary region](./media/contoso-migration-infrastructure/primary-hub-peer.png) 


#### <a name="subnets-in-the-east-us-2-hub-network-vnet-hub-eus2"></a><span data-ttu-id="582c6-486">Subnets in the East US 2 Hub network (VNET-HUB-EUS2)</span><span class="sxs-lookup"><span data-stu-id="582c6-486">Subnets in the East US 2 Hub network (VNET-HUB-EUS2)</span></span>

<span data-ttu-id="582c6-487">**Subnet/zone**</span><span class="sxs-lookup"><span data-stu-id="582c6-487">**Subnet/zone**</span></span> | <span data-ttu-id="582c6-488">**CIDR**</span><span class="sxs-lookup"><span data-stu-id="582c6-488">**CIDR**</span></span> | <span data-ttu-id="582c6-489">\*\*Usable IP addresses</span><span class="sxs-lookup"><span data-stu-id="582c6-489">\*\*Usable IP addresses</span></span>
--- | --- | ---
<span data-ttu-id="582c6-490">**IB-UntrustZone**</span><span class="sxs-lookup"><span data-stu-id="582c6-490">**IB-UntrustZone**</span></span> | <span data-ttu-id="582c6-491">10.240.0.0/24</span><span class="sxs-lookup"><span data-stu-id="582c6-491">10.240.0.0/24</span></span> | <span data-ttu-id="582c6-492">251</span><span class="sxs-lookup"><span data-stu-id="582c6-492">251</span></span>
<span data-ttu-id="582c6-493">**IB-TrustZone**</span><span class="sxs-lookup"><span data-stu-id="582c6-493">**IB-TrustZone**</span></span> | <span data-ttu-id="582c6-494">10.240.1.0/24</span><span class="sxs-lookup"><span data-stu-id="582c6-494">10.240.1.0/24</span></span> | <span data-ttu-id="582c6-495">251</span><span class="sxs-lookup"><span data-stu-id="582c6-495">251</span></span>
<span data-ttu-id="582c6-496">**OB-UntrustZone**</span><span class="sxs-lookup"><span data-stu-id="582c6-496">**OB-UntrustZone**</span></span> | <span data-ttu-id="582c6-497">10.240.2.0/24</span><span class="sxs-lookup"><span data-stu-id="582c6-497">10.240.2.0/24</span></span> | <span data-ttu-id="582c6-498">251</span><span class="sxs-lookup"><span data-stu-id="582c6-498">251</span></span>
<span data-ttu-id="582c6-499">**OB-TrustZone**</span><span class="sxs-lookup"><span data-stu-id="582c6-499">**OB-TrustZone**</span></span> | <span data-ttu-id="582c6-500">10.240.3.0/24</span><span class="sxs-lookup"><span data-stu-id="582c6-500">10.240.3.0/24</span></span> | <span data-ttu-id="582c6-501">251</span><span class="sxs-lookup"><span data-stu-id="582c6-501">251</span></span>
<span data-ttu-id="582c6-502">**GatewaySubnets**</span><span class="sxs-lookup"><span data-stu-id="582c6-502">**GatewaySubnets**</span></span> | <span data-ttu-id="582c6-503">10.240.10.0/24</span><span class="sxs-lookup"><span data-stu-id="582c6-503">10.240.10.0/24</span></span> | <span data-ttu-id="582c6-504">251</span><span class="sxs-lookup"><span data-stu-id="582c6-504">251</span></span>


#### <a name="subnets-in-the-east-us-2-dev-network-vnet-dev-eus2"></a><span data-ttu-id="582c6-505">Subnets in the East US 2 Dev network (VNET-DEV-EUS2)</span><span class="sxs-lookup"><span data-stu-id="582c6-505">Subnets in the East US 2 Dev network (VNET-DEV-EUS2)</span></span>

<span data-ttu-id="582c6-506">The Dev VNet is used by the development team as a production pilot area.</span><span class="sxs-lookup"><span data-stu-id="582c6-506">The Dev VNet is used by the development team as a production pilot area.</span></span> <span data-ttu-id="582c6-507">It has three subnets.</span><span class="sxs-lookup"><span data-stu-id="582c6-507">It has three subnets.</span></span>

<span data-ttu-id="582c6-508">**Subnet**</span><span class="sxs-lookup"><span data-stu-id="582c6-508">**Subnet**</span></span> | <span data-ttu-id="582c6-509">**CIDR**</span><span class="sxs-lookup"><span data-stu-id="582c6-509">**CIDR**</span></span> | <span data-ttu-id="582c6-510">**Addresses**</span><span class="sxs-lookup"><span data-stu-id="582c6-510">**Addresses**</span></span> | <span data-ttu-id="582c6-511">**In subnet**</span><span class="sxs-lookup"><span data-stu-id="582c6-511">**In subnet**</span></span>
--- | --- | --- | ---
<span data-ttu-id="582c6-512">**DEV-FE-EUS2**</span><span class="sxs-lookup"><span data-stu-id="582c6-512">**DEV-FE-EUS2**</span></span> | <span data-ttu-id="582c6-513">10.245.16.0/22</span><span class="sxs-lookup"><span data-stu-id="582c6-513">10.245.16.0/22</span></span> | <span data-ttu-id="582c6-514">1019</span><span class="sxs-lookup"><span data-stu-id="582c6-514">1019</span></span> | <span data-ttu-id="582c6-515">Frontends/web tier VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-515">Frontends/web tier VMs</span></span>
<span data-ttu-id="582c6-516">**DEV-APP-EUS2**</span><span class="sxs-lookup"><span data-stu-id="582c6-516">**DEV-APP-EUS2**</span></span> | <span data-ttu-id="582c6-517">10.245.20.0/22</span><span class="sxs-lookup"><span data-stu-id="582c6-517">10.245.20.0/22</span></span> | <span data-ttu-id="582c6-518">1019</span><span class="sxs-lookup"><span data-stu-id="582c6-518">1019</span></span> | <span data-ttu-id="582c6-519">App-tier VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-519">App-tier VMs</span></span>
<span data-ttu-id="582c6-520">**DEV-DB-EUS2**</span><span class="sxs-lookup"><span data-stu-id="582c6-520">**DEV-DB-EUS2**</span></span> | <span data-ttu-id="582c6-521">10.245.24.0/23</span><span class="sxs-lookup"><span data-stu-id="582c6-521">10.245.24.0/23</span></span> | <span data-ttu-id="582c6-522">507</span><span class="sxs-lookup"><span data-stu-id="582c6-522">507</span></span> | <span data-ttu-id="582c6-523">Database VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-523">Database VMs</span></span>


#### <a name="subnets-in-the-east-us-2-production-network-vnet-prod-eus2"></a><span data-ttu-id="582c6-524">Subnets in the East US 2 Production network (VNET-PROD-EUS2)</span><span class="sxs-lookup"><span data-stu-id="582c6-524">Subnets in the East US 2 Production network (VNET-PROD-EUS2)</span></span>

<span data-ttu-id="582c6-525">Azure IaaS components are located in the Production network.</span><span class="sxs-lookup"><span data-stu-id="582c6-525">Azure IaaS components are located in the Production network.</span></span> <span data-ttu-id="582c6-526">Each app tier has its own subnet.</span><span class="sxs-lookup"><span data-stu-id="582c6-526">Each app tier has its own subnet.</span></span> <span data-ttu-id="582c6-527">Subnets match those in the Dev network, with the addition of a subnet for domain controllers.</span><span class="sxs-lookup"><span data-stu-id="582c6-527">Subnets match those in the Dev network, with the addition of a subnet for domain controllers.</span></span>

<span data-ttu-id="582c6-528">**Subnet**</span><span class="sxs-lookup"><span data-stu-id="582c6-528">**Subnet**</span></span> | <span data-ttu-id="582c6-529">**CIDR**</span><span class="sxs-lookup"><span data-stu-id="582c6-529">**CIDR**</span></span> | <span data-ttu-id="582c6-530">**Addresses**</span><span class="sxs-lookup"><span data-stu-id="582c6-530">**Addresses**</span></span> | <span data-ttu-id="582c6-531">**In subnet**</span><span class="sxs-lookup"><span data-stu-id="582c6-531">**In subnet**</span></span>
--- | --- | --- | ---
<span data-ttu-id="582c6-532">**PROD-FE-EUS2**</span><span class="sxs-lookup"><span data-stu-id="582c6-532">**PROD-FE-EUS2**</span></span> | <span data-ttu-id="582c6-533">10.245.32.0/22</span><span class="sxs-lookup"><span data-stu-id="582c6-533">10.245.32.0/22</span></span> | <span data-ttu-id="582c6-534">1019</span><span class="sxs-lookup"><span data-stu-id="582c6-534">1019</span></span> | <span data-ttu-id="582c6-535">Frontends/web tier VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-535">Frontends/web tier VMs</span></span>
<span data-ttu-id="582c6-536">**PROD-APP-EUS2**</span><span class="sxs-lookup"><span data-stu-id="582c6-536">**PROD-APP-EUS2**</span></span> | <span data-ttu-id="582c6-537">10.245.36.0/22</span><span class="sxs-lookup"><span data-stu-id="582c6-537">10.245.36.0/22</span></span> | <span data-ttu-id="582c6-538">1019</span><span class="sxs-lookup"><span data-stu-id="582c6-538">1019</span></span> | <span data-ttu-id="582c6-539">App-tier VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-539">App-tier VMs</span></span>
<span data-ttu-id="582c6-540">**PROD-DB-EUS2**</span><span class="sxs-lookup"><span data-stu-id="582c6-540">**PROD-DB-EUS2**</span></span> | <span data-ttu-id="582c6-541">10.245.40.0/23</span><span class="sxs-lookup"><span data-stu-id="582c6-541">10.245.40.0/23</span></span> | <span data-ttu-id="582c6-542">507</span><span class="sxs-lookup"><span data-stu-id="582c6-542">507</span></span> | <span data-ttu-id="582c6-543">Database VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-543">Database VMs</span></span>
<span data-ttu-id="582c6-544">**PROD-DC-EUS2**</span><span class="sxs-lookup"><span data-stu-id="582c6-544">**PROD-DC-EUS2**</span></span> | <span data-ttu-id="582c6-545">10.245.42.0/23</span><span class="sxs-lookup"><span data-stu-id="582c6-545">10.245.42.0/23</span></span> | <span data-ttu-id="582c6-546">251</span><span class="sxs-lookup"><span data-stu-id="582c6-546">251</span></span> | <span data-ttu-id="582c6-547">Domain controller VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-547">Domain controller VMs</span></span>


![Hub network architecture](./media/contoso-migration-infrastructure/azure-networks-eus2.png)


#### <a name="virtual-networks-in-central-us-secondary-region"></a><span data-ttu-id="582c6-549">Virtual networks in Central US (secondary region)</span><span class="sxs-lookup"><span data-stu-id="582c6-549">Virtual networks in Central US (secondary region)</span></span>

<span data-ttu-id="582c6-550">Central US is Contoso's secondary region.</span><span class="sxs-lookup"><span data-stu-id="582c6-550">Central US is Contoso's secondary region.</span></span> <span data-ttu-id="582c6-551">Here's how Contoso will architect networks within it:</span><span class="sxs-lookup"><span data-stu-id="582c6-551">Here's how Contoso will architect networks within it:</span></span>

- <span data-ttu-id="582c6-552">**Hub**: The hub Vnet in East US 2 is the central point of connectivity to the on-premises datacenter, and the spoke VNets in East US 2 can be used to isolate workloads if required, managed separately from other spokes.</span><span class="sxs-lookup"><span data-stu-id="582c6-552">**Hub**: The hub Vnet in East US 2 is the central point of connectivity to the on-premises datacenter, and the spoke VNets in East US 2 can be used to isolate workloads if required, managed separately from other spokes.</span></span>
- <span data-ttu-id="582c6-553">**VNets**: Contoso will have two VNets in Central US:</span><span class="sxs-lookup"><span data-stu-id="582c6-553">**VNets**: Contoso will have two VNets in Central US:</span></span>
    - <span data-ttu-id="582c6-554">VNET-PROD-CUS.</span><span class="sxs-lookup"><span data-stu-id="582c6-554">VNET-PROD-CUS.</span></span> <span data-ttu-id="582c6-555">This VNet is a production network, similar to VNET-PROD_EUS2.</span><span class="sxs-lookup"><span data-stu-id="582c6-555">This VNet is a production network, similar to VNET-PROD_EUS2.</span></span> 
    - <span data-ttu-id="582c6-556">VNET-ASR-CUS.</span><span class="sxs-lookup"><span data-stu-id="582c6-556">VNET-ASR-CUS.</span></span> <span data-ttu-id="582c6-557">This VNet will act as a location in which VMs are created after failover from on-premises, or as a location for Azure VMs that are failed over from the primary to the secondary region.</span><span class="sxs-lookup"><span data-stu-id="582c6-557">This VNet will act as a location in which VMs are created after failover from on-premises, or as a location for Azure VMs that are failed over from the primary to the secondary region.</span></span> <span data-ttu-id="582c6-558">This network is similar to the production networks, but without any domain controllers on it.</span><span class="sxs-lookup"><span data-stu-id="582c6-558">This network is similar to the production networks, but without any domain controllers on it.</span></span>
    -  <span data-ttu-id="582c6-559">Each VNet in the region will have its own address space, with no overlap.</span><span class="sxs-lookup"><span data-stu-id="582c6-559">Each VNet in the region will have its own address space, with no overlap.</span></span> <span data-ttu-id="582c6-560">Contoso will configure routing without NAT.</span><span class="sxs-lookup"><span data-stu-id="582c6-560">Contoso will configure routing without NAT.</span></span>
- <span data-ttu-id="582c6-561">**Subnets**: The subnets will be architected in a similar way to those in East US 2.</span><span class="sxs-lookup"><span data-stu-id="582c6-561">**Subnets**: The subnets will be architected in a similar way to those in East US 2.</span></span> <span data-ttu-id="582c6-562">The exception is that Contoso doesn't need a subnet for domain controllers.</span><span class="sxs-lookup"><span data-stu-id="582c6-562">The exception is that Contoso doesn't need a subnet for domain controllers.</span></span>

<span data-ttu-id="582c6-563">The VNets in Central US are summarized in the following table.</span><span class="sxs-lookup"><span data-stu-id="582c6-563">The VNets in Central US are summarized in the following table.</span></span>

<span data-ttu-id="582c6-564">**VNet**</span><span class="sxs-lookup"><span data-stu-id="582c6-564">**VNet**</span></span> | <span data-ttu-id="582c6-565">**Range**</span><span class="sxs-lookup"><span data-stu-id="582c6-565">**Range**</span></span> | <span data-ttu-id="582c6-566">**Peer**</span><span class="sxs-lookup"><span data-stu-id="582c6-566">**Peer**</span></span>
--- | --- | ---
<span data-ttu-id="582c6-567">**VNET-HUB-CUS**</span><span class="sxs-lookup"><span data-stu-id="582c6-567">**VNET-HUB-CUS**</span></span> | <span data-ttu-id="582c6-568">10.250.0.0/20</span><span class="sxs-lookup"><span data-stu-id="582c6-568">10.250.0.0/20</span></span> | <span data-ttu-id="582c6-569">VNET-HUB-EUS2, VNET-ASR-CUS, VNET-PROD-CUS</span><span class="sxs-lookup"><span data-stu-id="582c6-569">VNET-HUB-EUS2, VNET-ASR-CUS, VNET-PROD-CUS</span></span>
<span data-ttu-id="582c6-570">**VNET-ASR-CUS**</span><span class="sxs-lookup"><span data-stu-id="582c6-570">**VNET-ASR-CUS**</span></span> | <span data-ttu-id="582c6-571">10.255.16.0/20</span><span class="sxs-lookup"><span data-stu-id="582c6-571">10.255.16.0/20</span></span> | <span data-ttu-id="582c6-572">VNET-HUB-CUS, VNET-PROD-CUS</span><span class="sxs-lookup"><span data-stu-id="582c6-572">VNET-HUB-CUS, VNET-PROD-CUS</span></span>
<span data-ttu-id="582c6-573">**VNET-PROD-CUS**</span><span class="sxs-lookup"><span data-stu-id="582c6-573">**VNET-PROD-CUS**</span></span> | <span data-ttu-id="582c6-574">10.255.32.0/20</span><span class="sxs-lookup"><span data-stu-id="582c6-574">10.255.32.0/20</span></span> | <span data-ttu-id="582c6-575">VNET-HUB-CUS, VNET-ASR-CUS, VNET-PROD-EUS2</span><span class="sxs-lookup"><span data-stu-id="582c6-575">VNET-HUB-CUS, VNET-ASR-CUS, VNET-PROD-EUS2</span></span>  


![Hub/spoke in paired region](./media/contoso-migration-infrastructure/paired-hub-peer.png)


#### <a name="subnets-in-the--central-us-hub-network-vnet-hub-cus"></a><span data-ttu-id="582c6-577">Subnets in the  Central US Hub network (VNET-HUB-CUS)</span><span class="sxs-lookup"><span data-stu-id="582c6-577">Subnets in the  Central US Hub network (VNET-HUB-CUS)</span></span>

<span data-ttu-id="582c6-578">**Subnet**</span><span class="sxs-lookup"><span data-stu-id="582c6-578">**Subnet**</span></span> | <span data-ttu-id="582c6-579">**CIDR**</span><span class="sxs-lookup"><span data-stu-id="582c6-579">**CIDR**</span></span> | <span data-ttu-id="582c6-580">**Usable IP addresses**</span><span class="sxs-lookup"><span data-stu-id="582c6-580">**Usable IP addresses**</span></span>
--- | --- | ---
<span data-ttu-id="582c6-581">**IB-UntrustZone**</span><span class="sxs-lookup"><span data-stu-id="582c6-581">**IB-UntrustZone**</span></span> | <span data-ttu-id="582c6-582">10.250.0.0/24</span><span class="sxs-lookup"><span data-stu-id="582c6-582">10.250.0.0/24</span></span> | <span data-ttu-id="582c6-583">251</span><span class="sxs-lookup"><span data-stu-id="582c6-583">251</span></span>
<span data-ttu-id="582c6-584">**IB-TrustZone**</span><span class="sxs-lookup"><span data-stu-id="582c6-584">**IB-TrustZone**</span></span> | <span data-ttu-id="582c6-585">10.250.1.0/24</span><span class="sxs-lookup"><span data-stu-id="582c6-585">10.250.1.0/24</span></span> | <span data-ttu-id="582c6-586">251</span><span class="sxs-lookup"><span data-stu-id="582c6-586">251</span></span>
<span data-ttu-id="582c6-587">**OB-UntrustZone**</span><span class="sxs-lookup"><span data-stu-id="582c6-587">**OB-UntrustZone**</span></span> | <span data-ttu-id="582c6-588">10.250.2.0/24</span><span class="sxs-lookup"><span data-stu-id="582c6-588">10.250.2.0/24</span></span> | <span data-ttu-id="582c6-589">251</span><span class="sxs-lookup"><span data-stu-id="582c6-589">251</span></span>
<span data-ttu-id="582c6-590">**OB-TrustZone**</span><span class="sxs-lookup"><span data-stu-id="582c6-590">**OB-TrustZone**</span></span> | <span data-ttu-id="582c6-591">10.250.3.0/24</span><span class="sxs-lookup"><span data-stu-id="582c6-591">10.250.3.0/24</span></span> | <span data-ttu-id="582c6-592">251</span><span class="sxs-lookup"><span data-stu-id="582c6-592">251</span></span>
<span data-ttu-id="582c6-593">**GatewaySubnet**</span><span class="sxs-lookup"><span data-stu-id="582c6-593">**GatewaySubnet**</span></span> | <span data-ttu-id="582c6-594">10.250.2.0/24</span><span class="sxs-lookup"><span data-stu-id="582c6-594">10.250.2.0/24</span></span> | <span data-ttu-id="582c6-595">251</span><span class="sxs-lookup"><span data-stu-id="582c6-595">251</span></span>


#### <a name="subnets-in-the-central-us-production-network-vnet-prod-cus"></a><span data-ttu-id="582c6-596">Subnets in the Central US Production network (VNET-PROD-CUS)</span><span class="sxs-lookup"><span data-stu-id="582c6-596">Subnets in the Central US Production network (VNET-PROD-CUS)</span></span>

<span data-ttu-id="582c6-597">In parallel to the production network in the primary East US 2 region, there's a production network in the secondary Central US region.</span><span class="sxs-lookup"><span data-stu-id="582c6-597">In parallel to the production network in the primary East US 2 region, there's a production network in the secondary Central US region.</span></span> 

<span data-ttu-id="582c6-598">**Subnet**</span><span class="sxs-lookup"><span data-stu-id="582c6-598">**Subnet**</span></span> | <span data-ttu-id="582c6-599">**CIDR**</span><span class="sxs-lookup"><span data-stu-id="582c6-599">**CIDR**</span></span> | <span data-ttu-id="582c6-600">**Addresses**</span><span class="sxs-lookup"><span data-stu-id="582c6-600">**Addresses**</span></span> | <span data-ttu-id="582c6-601">**In subnet**</span><span class="sxs-lookup"><span data-stu-id="582c6-601">**In subnet**</span></span>
--- | --- | --- | ---
<span data-ttu-id="582c6-602">**PROD-FE-CUS**</span><span class="sxs-lookup"><span data-stu-id="582c6-602">**PROD-FE-CUS**</span></span> | <span data-ttu-id="582c6-603">10.255.32.0/22</span><span class="sxs-lookup"><span data-stu-id="582c6-603">10.255.32.0/22</span></span> | <span data-ttu-id="582c6-604">1019</span><span class="sxs-lookup"><span data-stu-id="582c6-604">1019</span></span> | <span data-ttu-id="582c6-605">Frontends/web tier VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-605">Frontends/web tier VMs</span></span>
<span data-ttu-id="582c6-606">**PROD-APP-CUS**</span><span class="sxs-lookup"><span data-stu-id="582c6-606">**PROD-APP-CUS**</span></span> | <span data-ttu-id="582c6-607">10.255.36.0/22</span><span class="sxs-lookup"><span data-stu-id="582c6-607">10.255.36.0/22</span></span> | <span data-ttu-id="582c6-608">1019</span><span class="sxs-lookup"><span data-stu-id="582c6-608">1019</span></span> | <span data-ttu-id="582c6-609">App-tier VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-609">App-tier VMs</span></span>
<span data-ttu-id="582c6-610">**PROD-DB-CUS**</span><span class="sxs-lookup"><span data-stu-id="582c6-610">**PROD-DB-CUS**</span></span> | <span data-ttu-id="582c6-611">10.255.40.0/23</span><span class="sxs-lookup"><span data-stu-id="582c6-611">10.255.40.0/23</span></span> | <span data-ttu-id="582c6-612">507</span><span class="sxs-lookup"><span data-stu-id="582c6-612">507</span></span> | <span data-ttu-id="582c6-613">Database VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-613">Database VMs</span></span>
<span data-ttu-id="582c6-614">**PROD-DC-CUS**</span><span class="sxs-lookup"><span data-stu-id="582c6-614">**PROD-DC-CUS**</span></span> | <span data-ttu-id="582c6-615">10.255.42.0/24</span><span class="sxs-lookup"><span data-stu-id="582c6-615">10.255.42.0/24</span></span> | <span data-ttu-id="582c6-616">251</span><span class="sxs-lookup"><span data-stu-id="582c6-616">251</span></span> | <span data-ttu-id="582c6-617">Domain controller VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-617">Domain controller VMs</span></span>

#### <a name="subnets-in-the-central-us-failoverrecovery-network-in-central-us-vnet-asr-cus"></a><span data-ttu-id="582c6-618">Subnets in the Central US failover/recovery network in Central US (VNET-ASR-CUS)</span><span class="sxs-lookup"><span data-stu-id="582c6-618">Subnets in the Central US failover/recovery network in Central US (VNET-ASR-CUS)</span></span>

<span data-ttu-id="582c6-619">The VNET-ASR-CUS network is used for purposes of failover between regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-619">The VNET-ASR-CUS network is used for purposes of failover between regions.</span></span> <span data-ttu-id="582c6-620">Site Recovery will be used to replicate and fail over Azure VMs between the regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-620">Site Recovery will be used to replicate and fail over Azure VMs between the regions.</span></span> <span data-ttu-id="582c6-621">It also functions as a Contoso datacenter to Azure network for protected workloads that remain on-premises, but fail over to Azure for disaster recovery.</span><span class="sxs-lookup"><span data-stu-id="582c6-621">It also functions as a Contoso datacenter to Azure network for protected workloads that remain on-premises, but fail over to Azure for disaster recovery.</span></span>

<span data-ttu-id="582c6-622">VNET-ASR-CUS is the same basic subnet as the production VNET in East US 2, but without the need for a domain controller subnet.</span><span class="sxs-lookup"><span data-stu-id="582c6-622">VNET-ASR-CUS is the same basic subnet as the production VNET in East US 2, but without the need for a domain controller subnet.</span></span>

<span data-ttu-id="582c6-623">**Subnet**</span><span class="sxs-lookup"><span data-stu-id="582c6-623">**Subnet**</span></span> | <span data-ttu-id="582c6-624">**CIDR**</span><span class="sxs-lookup"><span data-stu-id="582c6-624">**CIDR**</span></span> | <span data-ttu-id="582c6-625">**Addresses**</span><span class="sxs-lookup"><span data-stu-id="582c6-625">**Addresses**</span></span> | <span data-ttu-id="582c6-626">**In subnet**</span><span class="sxs-lookup"><span data-stu-id="582c6-626">**In subnet**</span></span>
--- | --- | --- | ---
<span data-ttu-id="582c6-627">**ASR-FE-CUS**</span><span class="sxs-lookup"><span data-stu-id="582c6-627">**ASR-FE-CUS**</span></span> | <span data-ttu-id="582c6-628">10.255.16.0/22</span><span class="sxs-lookup"><span data-stu-id="582c6-628">10.255.16.0/22</span></span> | <span data-ttu-id="582c6-629">1019</span><span class="sxs-lookup"><span data-stu-id="582c6-629">1019</span></span> | <span data-ttu-id="582c6-630">Frontends/web tier VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-630">Frontends/web tier VMs</span></span>
<span data-ttu-id="582c6-631">**ASR-APP-CUS**</span><span class="sxs-lookup"><span data-stu-id="582c6-631">**ASR-APP-CUS**</span></span> | <span data-ttu-id="582c6-632">10.255.20.0/22</span><span class="sxs-lookup"><span data-stu-id="582c6-632">10.255.20.0/22</span></span> | <span data-ttu-id="582c6-633">1019</span><span class="sxs-lookup"><span data-stu-id="582c6-633">1019</span></span> | <span data-ttu-id="582c6-634">App-tier VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-634">App-tier VMs</span></span>
<span data-ttu-id="582c6-635">**ASR-DB-CUS**</span><span class="sxs-lookup"><span data-stu-id="582c6-635">**ASR-DB-CUS**</span></span> | <span data-ttu-id="582c6-636">10.255.24.0/23</span><span class="sxs-lookup"><span data-stu-id="582c6-636">10.255.24.0/23</span></span> | <span data-ttu-id="582c6-637">507</span><span class="sxs-lookup"><span data-stu-id="582c6-637">507</span></span> | <span data-ttu-id="582c6-638">Database VMs</span><span class="sxs-lookup"><span data-stu-id="582c6-638">Database VMs</span></span>

![Hub network architecture](./media/contoso-migration-infrastructure/azure-networks-cus.png)

#### <a name="configure-peered-connections"></a><span data-ttu-id="582c6-640">Configure peered connections</span><span class="sxs-lookup"><span data-stu-id="582c6-640">Configure peered connections</span></span>

<span data-ttu-id="582c6-641">The hub in each region will be peered to the hub in the other region, and to all VNets within the hub region.</span><span class="sxs-lookup"><span data-stu-id="582c6-641">The hub in each region will be peered to the hub in the other region, and to all VNets within the hub region.</span></span> <span data-ttu-id="582c6-642">This allows for hubs to communicate, and to view all VNets within a region.</span><span class="sxs-lookup"><span data-stu-id="582c6-642">This allows for hubs to communicate, and to view all VNets within a region.</span></span> <span data-ttu-id="582c6-643">Note that:</span><span class="sxs-lookup"><span data-stu-id="582c6-643">Note that:</span></span>

- <span data-ttu-id="582c6-644">Peering creates a two-sided connection.</span><span class="sxs-lookup"><span data-stu-id="582c6-644">Peering creates a two-sided connection.</span></span> <span data-ttu-id="582c6-645">One from the initiating peer on the first VNet, and another one on the second VNet.</span><span class="sxs-lookup"><span data-stu-id="582c6-645">One from the initiating peer on the first VNet, and another one on the second VNet.</span></span>
- <span data-ttu-id="582c6-646">In a hybrid deployment, traffic that passes between peers needs to be seen from the VPN connection between the on-premises datacenter and Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-646">In a hybrid deployment, traffic that passes between peers needs to be seen from the VPN connection between the on-premises datacenter and Azure.</span></span> <span data-ttu-id="582c6-647">To enable this, there are some specific settings that must be set on peered connections.</span><span class="sxs-lookup"><span data-stu-id="582c6-647">To enable this, there are some specific settings that must be set on peered connections.</span></span>

<span data-ttu-id="582c6-648">For any connections from spoke VNets through the hub to the on-premises datacenter, Contoso needs to allow traffic to be forwarded, and transverse the VPN gateways.</span><span class="sxs-lookup"><span data-stu-id="582c6-648">For any connections from spoke VNets through the hub to the on-premises datacenter, Contoso needs to allow traffic to be forwarded, and transverse the VPN gateways.</span></span>

##### <a name="domain-controller"></a><span data-ttu-id="582c6-649">Domain controller</span><span class="sxs-lookup"><span data-stu-id="582c6-649">Domain controller</span></span>

<span data-ttu-id="582c6-650">For the domain controllers in the VNET-PROD-EUS2 network, Contoso wants traffic to flow both between the EUS2 hub/production network, and over the VPN connection to on-premises.</span><span class="sxs-lookup"><span data-stu-id="582c6-650">For the domain controllers in the VNET-PROD-EUS2 network, Contoso wants traffic to flow both between the EUS2 hub/production network, and over the VPN connection to on-premises.</span></span> <span data-ttu-id="582c6-651">To do this it Contoso admins must allow the following:</span><span class="sxs-lookup"><span data-stu-id="582c6-651">To do this it Contoso admins must allow the following:</span></span>

1. <span data-ttu-id="582c6-652">**Allow forwarded traffic** and **Allow gateway transit configurations** on the peered connection.</span><span class="sxs-lookup"><span data-stu-id="582c6-652">**Allow forwarded traffic** and **Allow gateway transit configurations** on the peered connection.</span></span> <span data-ttu-id="582c6-653">In our example this would be the VNET-HUB-EUS2 to VNET-PROD-EUS2 connection.</span><span class="sxs-lookup"><span data-stu-id="582c6-653">In our example this would be the VNET-HUB-EUS2 to VNET-PROD-EUS2 connection.</span></span>

    ![Peering](./media/contoso-migration-infrastructure/peering1.png)

2. <span data-ttu-id="582c6-655">**Allow forwarded traffic** and **Use remote gateways** on the other side of the peering, on the VNET-PROD-EUS2 to VNET-HUB-EUS2 connection.</span><span class="sxs-lookup"><span data-stu-id="582c6-655">**Allow forwarded traffic** and **Use remote gateways** on the other side of the peering, on the VNET-PROD-EUS2 to VNET-HUB-EUS2 connection.</span></span>

    ![Peering](./media/contoso-migration-infrastructure/peering2.png)

3. <span data-ttu-id="582c6-657">On-premises they'll set up a static route that directs the local traffic to route across the VPN tunnel to the VNet.</span><span class="sxs-lookup"><span data-stu-id="582c6-657">On-premises they'll set up a static route that directs the local traffic to route across the VPN tunnel to the VNet.</span></span> <span data-ttu-id="582c6-658">The configuration would be completed on the gateway that provides the VPN tunnel from Contoso to Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-658">The configuration would be completed on the gateway that provides the VPN tunnel from Contoso to Azure.</span></span> <span data-ttu-id="582c6-659">They use Windows Routing and Remote Access for this.</span><span class="sxs-lookup"><span data-stu-id="582c6-659">They use Windows Routing and Remote Access for this.</span></span>

    ![Peering](./media/contoso-migration-infrastructure/peering3.png)

##### <a name="production-networks"></a><span data-ttu-id="582c6-661">Production networks</span><span class="sxs-lookup"><span data-stu-id="582c6-661">Production networks</span></span> 

<span data-ttu-id="582c6-662">A spoked peer network can't see a spoked peer network in another region via a hub.</span><span class="sxs-lookup"><span data-stu-id="582c6-662">A spoked peer network can't see a spoked peer network in another region via a hub.</span></span>

<span data-ttu-id="582c6-663">For Contoso's production networks in both regions to see each other, Contoso admins need to create a direct peered connection for VNET-PROD-EUS2 and VENT-PROD-CUS.</span><span class="sxs-lookup"><span data-stu-id="582c6-663">For Contoso's production networks in both regions to see each other, Contoso admins need to create a direct peered connection for VNET-PROD-EUS2 and VENT-PROD-CUS.</span></span> 

![Peering](./media/contoso-migration-infrastructure/peering4.png)

### <a name="set-up-dns"></a><span data-ttu-id="582c6-665">Set up DNS</span><span class="sxs-lookup"><span data-stu-id="582c6-665">Set up DNS</span></span>

<span data-ttu-id="582c6-666">When you deploy resources in virtual networks, you have a couple of choices for domain name resolution.</span><span class="sxs-lookup"><span data-stu-id="582c6-666">When you deploy resources in virtual networks, you have a couple of choices for domain name resolution.</span></span> <span data-ttu-id="582c6-667">You can use name resolution provided by Azure, or provide DNS servers for resolution.</span><span class="sxs-lookup"><span data-stu-id="582c6-667">You can use name resolution provided by Azure, or provide DNS servers for resolution.</span></span> <span data-ttu-id="582c6-668">The type of name resolution you use depends on how your resources need to communicate with each other.</span><span class="sxs-lookup"><span data-stu-id="582c6-668">The type of name resolution you use depends on how your resources need to communicate with each other.</span></span> <span data-ttu-id="582c6-669">Get [more information](https://docs.microsoft.com/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances#azure-provided-name-resolution) about the Azure DNS service.</span><span class="sxs-lookup"><span data-stu-id="582c6-669">Get [more information](https://docs.microsoft.com/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances#azure-provided-name-resolution) about the Azure DNS service.</span></span>

<span data-ttu-id="582c6-670">Contoso admins have decided that the Azure DNS service isn't a good choice in the hybrid environment.</span><span class="sxs-lookup"><span data-stu-id="582c6-670">Contoso admins have decided that the Azure DNS service isn't a good choice in the hybrid environment.</span></span> <span data-ttu-id="582c6-671">Instead, they're going to leverage the on-premises DNS servers.</span><span class="sxs-lookup"><span data-stu-id="582c6-671">Instead, they're going to leverage the on-premises DNS servers.</span></span>

- <span data-ttu-id="582c6-672">Since this is a hybrid network all the VMs on-premises and in Azure need to be able to resolve names to function properly.</span><span class="sxs-lookup"><span data-stu-id="582c6-672">Since this is a hybrid network all the VMs on-premises and in Azure need to be able to resolve names to function properly.</span></span> <span data-ttu-id="582c6-673">This means that custom DNS settings must be applied to all the VNets.</span><span class="sxs-lookup"><span data-stu-id="582c6-673">This means that custom DNS settings must be applied to all the VNets.</span></span>
- <span data-ttu-id="582c6-674">Contoso currently has DCs deployed in the Contoso datacenter and at the branch offices.</span><span class="sxs-lookup"><span data-stu-id="582c6-674">Contoso currently has DCs deployed in the Contoso datacenter and at the branch offices.</span></span> <span data-ttu-id="582c6-675">The primary DNS servers are CONTOSODC1(172.16.0.10) and CONTOSODC2(172.16.0.1)</span><span class="sxs-lookup"><span data-stu-id="582c6-675">The primary DNS servers are CONTOSODC1(172.16.0.10) and CONTOSODC2(172.16.0.1)</span></span>
- <span data-ttu-id="582c6-676">When the VNets are deployed, the on-premises domain controllers will be set to be used as DNS server in the networks.</span><span class="sxs-lookup"><span data-stu-id="582c6-676">When the VNets are deployed, the on-premises domain controllers will be set to be used as DNS server in the networks.</span></span> 
- <span data-ttu-id="582c6-677">To configure this, when using custom DNS on the VNet, Azure's recursive resolvers IP address (such as 168.63.129.16) must be added to the DNS list.</span><span class="sxs-lookup"><span data-stu-id="582c6-677">To configure this, when using custom DNS on the VNet, Azure's recursive resolvers IP address (such as 168.63.129.16) must be added to the DNS list.</span></span>  <span data-ttu-id="582c6-678">To do this, Contoso configures DNS server settings on each VNet.</span><span class="sxs-lookup"><span data-stu-id="582c6-678">To do this, Contoso configures DNS server settings on each VNet.</span></span> <span data-ttu-id="582c6-679">For example, the custom DNS settings for the VNET-HUB-EUS2 network would be as follows:</span><span class="sxs-lookup"><span data-stu-id="582c6-679">For example, the custom DNS settings for the VNET-HUB-EUS2 network would be as follows:</span></span>
    
    ![Custom DNS](./media/contoso-migration-infrastructure/custom-dns.png)

<span data-ttu-id="582c6-681">In addition to the on-premises domain controllers, Contoso are going to implement four more to support the Azure networks, two for each region.</span><span class="sxs-lookup"><span data-stu-id="582c6-681">In addition to the on-premises domain controllers, Contoso are going to implement four more to support the Azure networks, two for each region.</span></span> <span data-ttu-id="582c6-682">Here's what Contoso will deploy in Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-682">Here's what Contoso will deploy in Azure.</span></span>

<span data-ttu-id="582c6-683">**Region**</span><span class="sxs-lookup"><span data-stu-id="582c6-683">**Region**</span></span> | <span data-ttu-id="582c6-684">**DC**</span><span class="sxs-lookup"><span data-stu-id="582c6-684">**DC**</span></span> | <span data-ttu-id="582c6-685">**VNet**</span><span class="sxs-lookup"><span data-stu-id="582c6-685">**VNet**</span></span> | <span data-ttu-id="582c6-686">**Subnet**</span><span class="sxs-lookup"><span data-stu-id="582c6-686">**Subnet**</span></span> | <span data-ttu-id="582c6-687">**IP address**</span><span class="sxs-lookup"><span data-stu-id="582c6-687">**IP address**</span></span>
--- | --- | --- | --- | ---
<span data-ttu-id="582c6-688">EUS2</span><span class="sxs-lookup"><span data-stu-id="582c6-688">EUS2</span></span> | <span data-ttu-id="582c6-689">CONTOSODC3</span><span class="sxs-lookup"><span data-stu-id="582c6-689">CONTOSODC3</span></span> | <span data-ttu-id="582c6-690">VNET-PROD-EUS2</span><span class="sxs-lookup"><span data-stu-id="582c6-690">VNET-PROD-EUS2</span></span> | <span data-ttu-id="582c6-691">PROD-DC-EUS2</span><span class="sxs-lookup"><span data-stu-id="582c6-691">PROD-DC-EUS2</span></span> | <span data-ttu-id="582c6-692">10.245.42.4</span><span class="sxs-lookup"><span data-stu-id="582c6-692">10.245.42.4</span></span>
<span data-ttu-id="582c6-693">EUS2</span><span class="sxs-lookup"><span data-stu-id="582c6-693">EUS2</span></span> | <span data-ttu-id="582c6-694">CONTOSODC4</span><span class="sxs-lookup"><span data-stu-id="582c6-694">CONTOSODC4</span></span> | <span data-ttu-id="582c6-695">VNET-PROD-EUS2</span><span class="sxs-lookup"><span data-stu-id="582c6-695">VNET-PROD-EUS2</span></span> | <span data-ttu-id="582c6-696">PROD-DC-EUS2</span><span class="sxs-lookup"><span data-stu-id="582c6-696">PROD-DC-EUS2</span></span> | <span data-ttu-id="582c6-697">10.245.42.5</span><span class="sxs-lookup"><span data-stu-id="582c6-697">10.245.42.5</span></span>
<span data-ttu-id="582c6-698">CUS</span><span class="sxs-lookup"><span data-stu-id="582c6-698">CUS</span></span> | <span data-ttu-id="582c6-699">CONTOSODC5</span><span class="sxs-lookup"><span data-stu-id="582c6-699">CONTOSODC5</span></span> | <span data-ttu-id="582c6-700">VNET-PROD-CUS</span><span class="sxs-lookup"><span data-stu-id="582c6-700">VNET-PROD-CUS</span></span> | <span data-ttu-id="582c6-701">PROD-DC-CUS</span><span class="sxs-lookup"><span data-stu-id="582c6-701">PROD-DC-CUS</span></span> | <span data-ttu-id="582c6-702">10.255.42.4</span><span class="sxs-lookup"><span data-stu-id="582c6-702">10.255.42.4</span></span>
<span data-ttu-id="582c6-703">CUS</span><span class="sxs-lookup"><span data-stu-id="582c6-703">CUS</span></span> | <span data-ttu-id="582c6-704">CONTOSODC6</span><span class="sxs-lookup"><span data-stu-id="582c6-704">CONTOSODC6</span></span> | <span data-ttu-id="582c6-705">VNET-PROD-CUS</span><span class="sxs-lookup"><span data-stu-id="582c6-705">VNET-PROD-CUS</span></span> | <span data-ttu-id="582c6-706">PROD-DC-CUS</span><span class="sxs-lookup"><span data-stu-id="582c6-706">PROD-DC-CUS</span></span> | <span data-ttu-id="582c6-707">10.255.42.4</span><span class="sxs-lookup"><span data-stu-id="582c6-707">10.255.42.4</span></span>

<span data-ttu-id="582c6-708">After deploying the on-premises domain controllers, Contoso needs to update the DNS settings on networks on either region to include the new domain controllers in the DNS server list.</span><span class="sxs-lookup"><span data-stu-id="582c6-708">After deploying the on-premises domain controllers, Contoso needs to update the DNS settings on networks on either region to include the new domain controllers in the DNS server list.</span></span>



#### <a name="set-up-domain-controllers-in-azure"></a><span data-ttu-id="582c6-709">Set up domain controllers in Azure</span><span class="sxs-lookup"><span data-stu-id="582c6-709">Set up domain controllers in Azure</span></span>

<span data-ttu-id="582c6-710">After updating network settings, Contoso admins are ready to build out the domain controllers in Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-710">After updating network settings, Contoso admins are ready to build out the domain controllers in Azure.</span></span>

1. <span data-ttu-id="582c6-711">In the Azure portal, they deploy a new Windows Server VM to the appropriate VNet.</span><span class="sxs-lookup"><span data-stu-id="582c6-711">In the Azure portal, they deploy a new Windows Server VM to the appropriate VNet.</span></span>
2. <span data-ttu-id="582c6-712">They create availability sets in each location for the VM.</span><span class="sxs-lookup"><span data-stu-id="582c6-712">They create availability sets in each location for the VM.</span></span> <span data-ttu-id="582c6-713">Availability sets do the following:</span><span class="sxs-lookup"><span data-stu-id="582c6-713">Availability sets do the following:</span></span>
    - <span data-ttu-id="582c6-714">Ensure that the Azure fabric separates the VMs into different infrastructures in the Azure Region.</span><span class="sxs-lookup"><span data-stu-id="582c6-714">Ensure that the Azure fabric separates the VMs into different infrastructures in the Azure Region.</span></span> 
    -  <span data-ttu-id="582c6-715">Allows Contoso to be eligible for the 99.95% SLA for VMs in Azure.</span><span class="sxs-lookup"><span data-stu-id="582c6-715">Allows Contoso to be eligible for the 99.95% SLA for VMs in Azure.</span></span>  <span data-ttu-id="582c6-716">[Learn more](https://docs.microsoft.com/azure/virtual-machines/windows/tutorial-availability-sets).</span><span class="sxs-lookup"><span data-stu-id="582c6-716">[Learn more](https://docs.microsoft.com/azure/virtual-machines/windows/tutorial-availability-sets).</span></span>

    ![Availability group](./media/contoso-migration-infrastructure/availability-group.png) 
3. <span data-ttu-id="582c6-718">After the VM is deployed, they open the network interface for the VM.</span><span class="sxs-lookup"><span data-stu-id="582c6-718">After the VM is deployed, they open the network interface for the VM.</span></span> <span data-ttu-id="582c6-719">They set the private IP address to static, and specify a valid address.</span><span class="sxs-lookup"><span data-stu-id="582c6-719">They set the private IP address to static, and specify a valid address.</span></span>

    ![VM NIC](./media/contoso-migration-infrastructure/vm-nic.png)

4. <span data-ttu-id="582c6-721">Now, they attach a new data disk to the VM.</span><span class="sxs-lookup"><span data-stu-id="582c6-721">Now, they attach a new data disk to the VM.</span></span> <span data-ttu-id="582c6-722">This disk contains the Active Directory database, and the sysvol share.</span><span class="sxs-lookup"><span data-stu-id="582c6-722">This disk contains the Active Directory database, and the sysvol share.</span></span> 
    - <span data-ttu-id="582c6-723">The size of the disk will determine the number of IOPS that it supports.</span><span class="sxs-lookup"><span data-stu-id="582c6-723">The size of the disk will determine the number of IOPS that it supports.</span></span>
    - <span data-ttu-id="582c6-724">Over time the disk size might need to increase as the environment grows.</span><span class="sxs-lookup"><span data-stu-id="582c6-724">Over time the disk size might need to increase as the environment grows.</span></span>
    - <span data-ttu-id="582c6-725">The drive shouldn't be set to Read/Write for host caching.</span><span class="sxs-lookup"><span data-stu-id="582c6-725">The drive shouldn't be set to Read/Write for host caching.</span></span> <span data-ttu-id="582c6-726">Active Directory databases don't support this.</span><span class="sxs-lookup"><span data-stu-id="582c6-726">Active Directory databases don't support this.</span></span>

     ![Active Directory disk](./media/contoso-migration-infrastructure/ad-disk.png)

5. <span data-ttu-id="582c6-728">After the disk is added, they connect to the VM over Remote Desktop, and open Server Manager.</span><span class="sxs-lookup"><span data-stu-id="582c6-728">After the disk is added, they connect to the VM over Remote Desktop, and open Server Manager.</span></span>
6. <span data-ttu-id="582c6-729">Then in **File and Storage Services**, they run the New Volume Wizard, ensuring that the drive is given the letter F: or above on the local VM.</span><span class="sxs-lookup"><span data-stu-id="582c6-729">Then in **File and Storage Services**, they run the New Volume Wizard, ensuring that the drive is given the letter F: or above on the local VM.</span></span>

     ![New Volume Wizard](./media/contoso-migration-infrastructure/volume-wizard.png)

7. <span data-ttu-id="582c6-731">In Server Manager, they add the **Active Directory Domain Services** role.</span><span class="sxs-lookup"><span data-stu-id="582c6-731">In Server Manager, they add the **Active Directory Domain Services** role.</span></span> <span data-ttu-id="582c6-732">Then, they configure the VM as a domain controller.</span><span class="sxs-lookup"><span data-stu-id="582c6-732">Then, they configure the VM as a domain controller.</span></span>

      ![Server role](./media/contoso-migration-infrastructure/server-role.png)  

9. <span data-ttu-id="582c6-734">After the VM is configured as a DC and rebooted, they open DNS Manager and configure the Azure DNS resolver as a forwarder.</span><span class="sxs-lookup"><span data-stu-id="582c6-734">After the VM is configured as a DC and rebooted, they open DNS Manager and configure the Azure DNS resolver as a forwarder.</span></span>  <span data-ttu-id="582c6-735">This allows the DC to forward DNS queries it can't resolve in the Azure DNS.</span><span class="sxs-lookup"><span data-stu-id="582c6-735">This allows the DC to forward DNS queries it can't resolve in the Azure DNS.</span></span>

    ![DNS forwarder](./media/contoso-migration-infrastructure/dns-forwarder.png)

10. <span data-ttu-id="582c6-737">Now, then update the custom DNS settings for each VNet with the appropriate domain controller for the VNet region.</span><span class="sxs-lookup"><span data-stu-id="582c6-737">Now, then update the custom DNS settings for each VNet with the appropriate domain controller for the VNet region.</span></span> <span data-ttu-id="582c6-738">They include on-premises DCs in the list.</span><span class="sxs-lookup"><span data-stu-id="582c6-738">They include on-premises DCs in the list.</span></span>

### <a name="set-up-active-directory"></a><span data-ttu-id="582c6-739">Set up Active Directory</span><span class="sxs-lookup"><span data-stu-id="582c6-739">Set up Active Directory</span></span>

<span data-ttu-id="582c6-740">AD is a critical service in networking, and must be configured correctly.</span><span class="sxs-lookup"><span data-stu-id="582c6-740">AD is a critical service in networking, and must be configured correctly.</span></span> <span data-ttu-id="582c6-741">Contoso admins will build AD sites for the Contoso datacenter, and for the EUS2 and CUS regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-741">Contoso admins will build AD sites for the Contoso datacenter, and for the EUS2 and CUS regions.</span></span>  

1. <span data-ttu-id="582c6-742">They create two new sites (AZURE-EUS2, and AZURE-CUS) along with the datacenter site (ContosoDatacenter).</span><span class="sxs-lookup"><span data-stu-id="582c6-742">They create two new sites (AZURE-EUS2, and AZURE-CUS) along with the datacenter site (ContosoDatacenter).</span></span>
2. <span data-ttu-id="582c6-743">After creating the sites, they create subnets in the sites, to match the VNets and datacenter.</span><span class="sxs-lookup"><span data-stu-id="582c6-743">After creating the sites, they create subnets in the sites, to match the VNets and datacenter.</span></span>

    ![DC subnets](./media/contoso-migration-infrastructure/dc-subnets.png)

3. <span data-ttu-id="582c6-745">Then, they create two site links to connect everything.</span><span class="sxs-lookup"><span data-stu-id="582c6-745">Then, they create two site links to connect everything.</span></span> <span data-ttu-id="582c6-746">The domain controllers should then be moved to their location.</span><span class="sxs-lookup"><span data-stu-id="582c6-746">The domain controllers should then be moved to their location.</span></span>

    ![DC links](./media/contoso-migration-infrastructure/dc-links.png)

4. <span data-ttu-id="582c6-748">After everything is configured, the Active Directory replication topology is in place.</span><span class="sxs-lookup"><span data-stu-id="582c6-748">After everything is configured, the Active Directory replication topology is in place.</span></span>
    
    ![DC replication](./media/contoso-migration-infrastructure/ad-resolution.png)

5. <span data-ttu-id="582c6-750">With everything complete, a list of the domain controllers and sites are shown in the on-premises Active Directory Administrative Center.</span><span class="sxs-lookup"><span data-stu-id="582c6-750">With everything complete, a list of the domain controllers and sites are shown in the on-premises Active Directory Administrative Center.</span></span>

    ![AD admin center](./media/contoso-migration-infrastructure/ad-center.png)

## <a name="step-5-plan-for-governance"></a><span data-ttu-id="582c6-752">Step 5: Plan for governance</span><span class="sxs-lookup"><span data-stu-id="582c6-752">Step 5: Plan for governance</span></span>

<span data-ttu-id="582c6-753">Azure provides a range of governance controls across services and the Azure platform.</span><span class="sxs-lookup"><span data-stu-id="582c6-753">Azure provides a range of governance controls across services and the Azure platform.</span></span> <span data-ttu-id="582c6-754">[Read more](https://docs.microsoft.com/azure/security/governance-in-azure) for a basic understanding of options.</span><span class="sxs-lookup"><span data-stu-id="582c6-754">[Read more](https://docs.microsoft.com/azure/security/governance-in-azure) for a basic understanding of options.</span></span>

<span data-ttu-id="582c6-755">As they configure identity and access control, Contoso has already begun to put some aspects of governance and security in place.</span><span class="sxs-lookup"><span data-stu-id="582c6-755">As they configure identity and access control, Contoso has already begun to put some aspects of governance and security in place.</span></span> <span data-ttu-id="582c6-756">Broadly, there are three areas it needs to consider:</span><span class="sxs-lookup"><span data-stu-id="582c6-756">Broadly, there are three areas it needs to consider:</span></span>

- <span data-ttu-id="582c6-757">**Policy**: Policy in Azure applies and enforces rules and effects over your resources, so that resources stay compliant with corporate requirements and SLAs.</span><span class="sxs-lookup"><span data-stu-id="582c6-757">**Policy**: Policy in Azure applies and enforces rules and effects over your resources, so that resources stay compliant with corporate requirements and SLAs.</span></span>
- <span data-ttu-id="582c6-758">**Locks**: Azure allows you to lock subscriptions, resources groups, and other resources, so that they can only be modified by those with authority to do so.</span><span class="sxs-lookup"><span data-stu-id="582c6-758">**Locks**: Azure allows you to lock subscriptions, resources groups, and other resources, so that they can only be modified by those with authority to do so.</span></span>
- <span data-ttu-id="582c6-759">**Tags**: Resources can be controlled, audited, and managed with tags.</span><span class="sxs-lookup"><span data-stu-id="582c6-759">**Tags**: Resources can be controlled, audited, and managed with tags.</span></span> <span data-ttu-id="582c6-760">Tags attach metadata to resources, providing information about resources or owners.</span><span class="sxs-lookup"><span data-stu-id="582c6-760">Tags attach metadata to resources, providing information about resources or owners.</span></span>

### <a name="set-up-policies"></a><span data-ttu-id="582c6-761">Set up policies</span><span class="sxs-lookup"><span data-stu-id="582c6-761">Set up policies</span></span>

<span data-ttu-id="582c6-762">The Azure Policy service evaluates your resources, scanning for those not compliant with the policy definitions you have in place.</span><span class="sxs-lookup"><span data-stu-id="582c6-762">The Azure Policy service evaluates your resources, scanning for those not compliant with the policy definitions you have in place.</span></span> <span data-ttu-id="582c6-763">For example, might have a policy that only allows certain type of VMs, or requires resources to have a specific tag.</span><span class="sxs-lookup"><span data-stu-id="582c6-763">For example, might have a policy that only allows certain type of VMs, or requires resources to have a specific tag.</span></span> 

<span data-ttu-id="582c6-764">Azure policies specify a policy definition, and policy assignment specify the scope in which a policy should be applied.</span><span class="sxs-lookup"><span data-stu-id="582c6-764">Azure policies specify a policy definition, and policy assignment specify the scope in which a policy should be applied.</span></span> <span data-ttu-id="582c6-765">The scope can range from a management group to a resource group.</span><span class="sxs-lookup"><span data-stu-id="582c6-765">The scope can range from a management group to a resource group.</span></span> <span data-ttu-id="582c6-766">[Learn](https://docs.microsoft.com/azure/azure-policy/create-manage-policy) about creating and managing policies.</span><span class="sxs-lookup"><span data-stu-id="582c6-766">[Learn](https://docs.microsoft.com/azure/azure-policy/create-manage-policy) about creating and managing policies.</span></span>

<span data-ttu-id="582c6-767">Contoso want to get started with a couple of policies:</span><span class="sxs-lookup"><span data-stu-id="582c6-767">Contoso want to get started with a couple of policies:</span></span>

- <span data-ttu-id="582c6-768">It wants a policy to ensure that resources can only be deployed in the EUS2 and CUS regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-768">It wants a policy to ensure that resources can only be deployed in the EUS2 and CUS regions.</span></span>
- <span data-ttu-id="582c6-769">It wants to limit VM SKUs to approved SKUs only.</span><span class="sxs-lookup"><span data-stu-id="582c6-769">It wants to limit VM SKUs to approved SKUs only.</span></span> <span data-ttu-id="582c6-770">The intention is to ensure that expensive VM SKUs aren't used.</span><span class="sxs-lookup"><span data-stu-id="582c6-770">The intention is to ensure that expensive VM SKUs aren't used.</span></span>

#### <a name="limit-resources-to-regions"></a><span data-ttu-id="582c6-771">Limit resources to regions</span><span class="sxs-lookup"><span data-stu-id="582c6-771">Limit resources to regions</span></span>

<span data-ttu-id="582c6-772">Contoso uses the built-in policy definition **Allowed locations** to limit resource regions.</span><span class="sxs-lookup"><span data-stu-id="582c6-772">Contoso uses the built-in policy definition **Allowed locations** to limit resource regions.</span></span>

1. <span data-ttu-id="582c6-773">In the Azure portal, click **All Services**, and search for **Policy**.</span><span class="sxs-lookup"><span data-stu-id="582c6-773">In the Azure portal, click **All Services**, and search for **Policy**.</span></span>
2. <span data-ttu-id="582c6-774">Select **Assignments** > **Assign Policy**.</span><span class="sxs-lookup"><span data-stu-id="582c6-774">Select **Assignments** > **Assign Policy**.</span></span>
3. <span data-ttu-id="582c6-775">In the policy list, select **Allowed locations**.</span><span class="sxs-lookup"><span data-stu-id="582c6-775">In the policy list, select **Allowed locations**.</span></span>
4. <span data-ttu-id="582c6-776">Set **Scope** to the name of the Azure subscription, and select the two regions in the allowed list.</span><span class="sxs-lookup"><span data-stu-id="582c6-776">Set **Scope** to the name of the Azure subscription, and select the two regions in the allowed list.</span></span>

    ![Policy allowed regions](./media/contoso-migration-infrastructure/policy-region.png)

5. <span data-ttu-id="582c6-778">By default the policy is set with **Deny**, meaning that if someone starts a deployment in the subscription that isn't in EUS2 or CUS, the deployment will fail.</span><span class="sxs-lookup"><span data-stu-id="582c6-778">By default the policy is set with **Deny**, meaning that if someone starts a deployment in the subscription that isn't in EUS2 or CUS, the deployment will fail.</span></span> <span data-ttu-id="582c6-779">Here's what happens if someone in the Contoso subscription tries to set up a deployment in West US.</span><span class="sxs-lookup"><span data-stu-id="582c6-779">Here's what happens if someone in the Contoso subscription tries to set up a deployment in West US.</span></span>

    ![Policy failed](./media/contoso-migration-infrastructure/policy-failed.png)

#### <a name="allow-specific-vm-skus"></a><span data-ttu-id="582c6-781">Allow specific VM SKUs</span><span class="sxs-lookup"><span data-stu-id="582c6-781">Allow specific VM SKUs</span></span>

<span data-ttu-id="582c6-782">Contoso will use the built-in policy definition **Allow virtual machines SKUs** to limit the type of VMs that can be created in the subscription.</span><span class="sxs-lookup"><span data-stu-id="582c6-782">Contoso will use the built-in policy definition **Allow virtual machines SKUs** to limit the type of VMs that can be created in the subscription.</span></span> 

![Policy SKU](./media/contoso-migration-infrastructure/policy-sku.png)



#### <a name="check-policy-compliance"></a><span data-ttu-id="582c6-784">Check policy compliance</span><span class="sxs-lookup"><span data-stu-id="582c6-784">Check policy compliance</span></span>

<span data-ttu-id="582c6-785">Policies go into effect immediately, and Contoso can check resources for compliance.</span><span class="sxs-lookup"><span data-stu-id="582c6-785">Policies go into effect immediately, and Contoso can check resources for compliance.</span></span> 

1. <span data-ttu-id="582c6-786">In the Azure portal, click the **Compliance** link.</span><span class="sxs-lookup"><span data-stu-id="582c6-786">In the Azure portal, click the **Compliance** link.</span></span>
2. <span data-ttu-id="582c6-787">The compliance dashboard appears.</span><span class="sxs-lookup"><span data-stu-id="582c6-787">The compliance dashboard appears.</span></span> <span data-ttu-id="582c6-788">You can drill down for further details.</span><span class="sxs-lookup"><span data-stu-id="582c6-788">You can drill down for further details.</span></span>

    ![Policy compliance](./media/contoso-migration-infrastructure/policy-compliance.png)


### <a name="set-up-locks"></a><span data-ttu-id="582c6-790">Set up locks</span><span class="sxs-lookup"><span data-stu-id="582c6-790">Set up locks</span></span>

<span data-ttu-id="582c6-791">Contoso has long been using the ITIL framework for the management of its systems.</span><span class="sxs-lookup"><span data-stu-id="582c6-791">Contoso has long been using the ITIL framework for the management of its systems.</span></span> <span data-ttu-id="582c6-792">One of the most important aspects of the framework is change control, and Contoso wants to make sure that change control is implemented in the Azure deployment.</span><span class="sxs-lookup"><span data-stu-id="582c6-792">One of the most important aspects of the framework is change control, and Contoso wants to make sure that change control is implemented in the Azure deployment.</span></span>

<span data-ttu-id="582c6-793">Contoso is going to implement locks as follows:</span><span class="sxs-lookup"><span data-stu-id="582c6-793">Contoso is going to implement locks as follows:</span></span>

- <span data-ttu-id="582c6-794">Any production or failover component must be in a resource group that has a ReadOnly lock.</span><span class="sxs-lookup"><span data-stu-id="582c6-794">Any production or failover component must be in a resource group that has a ReadOnly lock.</span></span>  <span data-ttu-id="582c6-795">This means that to modify or delete production items, the lock must be removed.</span><span class="sxs-lookup"><span data-stu-id="582c6-795">This means that to modify or delete production items, the lock must be removed.</span></span> 
- <span data-ttu-id="582c6-796">Non-production resource groups will have CanNotDelete locks.</span><span class="sxs-lookup"><span data-stu-id="582c6-796">Non-production resource groups will have CanNotDelete locks.</span></span> <span data-ttu-id="582c6-797">This means that authorized users can read or modify a resource, but can't delete it.</span><span class="sxs-lookup"><span data-stu-id="582c6-797">This means that authorized users can read or modify a resource, but can't delete it.</span></span>

<span data-ttu-id="582c6-798">[Learn more](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-lock-resources) about locks.</span><span class="sxs-lookup"><span data-stu-id="582c6-798">[Learn more](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-lock-resources) about locks.</span></span>

### <a name="set-up-tagging"></a><span data-ttu-id="582c6-799">Set up tagging</span><span class="sxs-lookup"><span data-stu-id="582c6-799">Set up tagging</span></span>

<span data-ttu-id="582c6-800">To track resources as they're added, it will be increasingly important for Contoso to associate resources with an appropriate department, customer, and environment.</span><span class="sxs-lookup"><span data-stu-id="582c6-800">To track resources as they're added, it will be increasingly important for Contoso to associate resources with an appropriate department, customer, and environment.</span></span> 

<span data-ttu-id="582c6-801">In addition to providing information about resources and owners, tags will enable Contoso to aggregate and group resources, and to use that data for chargeback purposes.</span><span class="sxs-lookup"><span data-stu-id="582c6-801">In addition to providing information about resources and owners, tags will enable Contoso to aggregate and group resources, and to use that data for chargeback purposes.</span></span>

<span data-ttu-id="582c6-802">Contoso needs to visualize its Azure assets in a way that makes sense for the business.</span><span class="sxs-lookup"><span data-stu-id="582c6-802">Contoso needs to visualize its Azure assets in a way that makes sense for the business.</span></span> <span data-ttu-id="582c6-803">For example but role or department.</span><span class="sxs-lookup"><span data-stu-id="582c6-803">For example but role or department.</span></span> <span data-ttu-id="582c6-804">Note that resources don't need to reside in the same resource group to share a tag.</span><span class="sxs-lookup"><span data-stu-id="582c6-804">Note that resources don't need to reside in the same resource group to share a tag.</span></span> <span data-ttu-id="582c6-805">To do this, Contoso will create a simple tag taxonomy so that everyone's using the same tags.</span><span class="sxs-lookup"><span data-stu-id="582c6-805">To do this, Contoso will create a simple tag taxonomy so that everyone's using the same tags.</span></span>

<span data-ttu-id="582c6-806">**Tag name**</span><span class="sxs-lookup"><span data-stu-id="582c6-806">**Tag name**</span></span> | <span data-ttu-id="582c6-807">**Value**</span><span class="sxs-lookup"><span data-stu-id="582c6-807">**Value**</span></span>
--- | ---
<span data-ttu-id="582c6-808">CostCenter</span><span class="sxs-lookup"><span data-stu-id="582c6-808">CostCenter</span></span> | <span data-ttu-id="582c6-809">12345: It must be a valid cost center from SAP.</span><span class="sxs-lookup"><span data-stu-id="582c6-809">12345: It must be a valid cost center from SAP.</span></span>
<span data-ttu-id="582c6-810">BusinessUnit</span><span class="sxs-lookup"><span data-stu-id="582c6-810">BusinessUnit</span></span> | <span data-ttu-id="582c6-811">Name of business unit (from SAP).</span><span class="sxs-lookup"><span data-stu-id="582c6-811">Name of business unit (from SAP).</span></span> <span data-ttu-id="582c6-812">Matches CostCenter.</span><span class="sxs-lookup"><span data-stu-id="582c6-812">Matches CostCenter.</span></span>
<span data-ttu-id="582c6-813">ApplicationTeam</span><span class="sxs-lookup"><span data-stu-id="582c6-813">ApplicationTeam</span></span> | <span data-ttu-id="582c6-814">Email alias of the team that owns support for the app.</span><span class="sxs-lookup"><span data-stu-id="582c6-814">Email alias of the team that owns support for the app.</span></span>
<span data-ttu-id="582c6-815">CatalogName</span><span class="sxs-lookup"><span data-stu-id="582c6-815">CatalogName</span></span> | <span data-ttu-id="582c6-816">Name of the app or ShareServices, per the service catalog that the resource supports.</span><span class="sxs-lookup"><span data-stu-id="582c6-816">Name of the app or ShareServices, per the service catalog that the resource supports.</span></span>
<span data-ttu-id="582c6-817">ServiceManager</span><span class="sxs-lookup"><span data-stu-id="582c6-817">ServiceManager</span></span> | <span data-ttu-id="582c6-818">Email alias of the ITIL Service Manager for the resource.</span><span class="sxs-lookup"><span data-stu-id="582c6-818">Email alias of the ITIL Service Manager for the resource.</span></span>
<span data-ttu-id="582c6-819">COBPriority</span><span class="sxs-lookup"><span data-stu-id="582c6-819">COBPriority</span></span> | <span data-ttu-id="582c6-820">Priority set by the business for BCDR.</span><span class="sxs-lookup"><span data-stu-id="582c6-820">Priority set by the business for BCDR.</span></span> <span data-ttu-id="582c6-821">Values of 1-5.</span><span class="sxs-lookup"><span data-stu-id="582c6-821">Values of 1-5.</span></span>
<span data-ttu-id="582c6-822">ENV</span><span class="sxs-lookup"><span data-stu-id="582c6-822">ENV</span></span> | <span data-ttu-id="582c6-823">DEV, STG, PROD are the possible values.</span><span class="sxs-lookup"><span data-stu-id="582c6-823">DEV, STG, PROD are the possible values.</span></span> <span data-ttu-id="582c6-824">Representing developing, staging, and production.</span><span class="sxs-lookup"><span data-stu-id="582c6-824">Representing developing, staging, and production.</span></span>

<span data-ttu-id="582c6-825">For example:</span><span class="sxs-lookup"><span data-stu-id="582c6-825">For example:</span></span> 

 ![Azure tags](./media/contoso-migration-infrastructure/azure-tag.png)

<span data-ttu-id="582c6-827">After creating the tag, Contoso will go back and create new Azure policy definitions and assignments, to enforce the use of the required tags across the organization.</span><span class="sxs-lookup"><span data-stu-id="582c6-827">After creating the tag, Contoso will go back and create new Azure policy definitions and assignments, to enforce the use of the required tags across the organization.</span></span>


## <a name="step-6-consider-security"></a><span data-ttu-id="582c6-828">Step 6: Consider security</span><span class="sxs-lookup"><span data-stu-id="582c6-828">Step 6: Consider security</span></span>

<span data-ttu-id="582c6-829">Security is crucial in the cloud, and Azure provides a wide array of security tools and capabilities.</span><span class="sxs-lookup"><span data-stu-id="582c6-829">Security is crucial in the cloud, and Azure provides a wide array of security tools and capabilities.</span></span> <span data-ttu-id="582c6-830">These help you to create secure solutions, on the secure Azure platform.</span><span class="sxs-lookup"><span data-stu-id="582c6-830">These help you to create secure solutions, on the secure Azure platform.</span></span> <span data-ttu-id="582c6-831">Read [Confidence in the trusted cloud](https://azure.microsoft.com/overview/trusted-cloud/) to learn more about Azure security.</span><span class="sxs-lookup"><span data-stu-id="582c6-831">Read [Confidence in the trusted cloud](https://azure.microsoft.com/overview/trusted-cloud/) to learn more about Azure security.</span></span>

<span data-ttu-id="582c6-832">There a few main aspects for Contoso to consider:</span><span class="sxs-lookup"><span data-stu-id="582c6-832">There a few main aspects for Contoso to consider:</span></span>

- <span data-ttu-id="582c6-833">**Azure Security Center**: Azure Security Center provides unified security management and advanced threat protection across hybrid cloud workloads.</span><span class="sxs-lookup"><span data-stu-id="582c6-833">**Azure Security Center**: Azure Security Center provides unified security management and advanced threat protection across hybrid cloud workloads.</span></span> <span data-ttu-id="582c6-834">With Security Center, you can apply security policies across your workloads, limit your exposure to threats, and detect and respond to attacks.</span><span class="sxs-lookup"><span data-stu-id="582c6-834">With Security Center, you can apply security policies across your workloads, limit your exposure to threats, and detect and respond to attacks.</span></span>  <span data-ttu-id="582c6-835">[Learn more](https://docs.microsoft.com/azure/security-center/security-center-intro).</span><span class="sxs-lookup"><span data-stu-id="582c6-835">[Learn more](https://docs.microsoft.com/azure/security-center/security-center-intro).</span></span>
- <span data-ttu-id="582c6-836">**Network Security Groups (NSGs)**: An NSG is a filter (firewall) that contains a list of security rules which, when applied, allow or deny network traffic to resources connected to Azure VNets.</span><span class="sxs-lookup"><span data-stu-id="582c6-836">**Network Security Groups (NSGs)**: An NSG is a filter (firewall) that contains a list of security rules which, when applied, allow or deny network traffic to resources connected to Azure VNets.</span></span> <span data-ttu-id="582c6-837">[Learn more](https://docs.microsoft.com/azure/virtual-network/security-overview).</span><span class="sxs-lookup"><span data-stu-id="582c6-837">[Learn more](https://docs.microsoft.com/azure/virtual-network/security-overview).</span></span>
- <span data-ttu-id="582c6-838">**Data encryption**: Azure Disk Encryption is a capability that helps you encrypt your Windows and Linux IaaS virtual machine disks.</span><span class="sxs-lookup"><span data-stu-id="582c6-838">**Data encryption**: Azure Disk Encryption is a capability that helps you encrypt your Windows and Linux IaaS virtual machine disks.</span></span> <span data-ttu-id="582c6-839">[Learn more](https://docs.microsoft.com/azure/security/azure-security-encryption-atrest).</span><span class="sxs-lookup"><span data-stu-id="582c6-839">[Learn more](https://docs.microsoft.com/azure/security/azure-security-encryption-atrest).</span></span>

### <a name="work-with-the-azure-security-center"></a><span data-ttu-id="582c6-840">Work with the Azure Security Center</span><span class="sxs-lookup"><span data-stu-id="582c6-840">Work with the Azure Security Center</span></span>

<span data-ttu-id="582c6-841">Contoso is looking for a quick view into the security posture of its new hybrid cloud, and specifically its Azure workloads.</span><span class="sxs-lookup"><span data-stu-id="582c6-841">Contoso is looking for a quick view into the security posture of its new hybrid cloud, and specifically its Azure workloads.</span></span>  <span data-ttu-id="582c6-842">As a result, Contoso has decided to implement Azure Security Center starting with the following features:</span><span class="sxs-lookup"><span data-stu-id="582c6-842">As a result, Contoso has decided to implement Azure Security Center starting with the following features:</span></span> 

- <span data-ttu-id="582c6-843">Centralized policy management</span><span class="sxs-lookup"><span data-stu-id="582c6-843">Centralized policy management</span></span>
- <span data-ttu-id="582c6-844">Continuous assessment</span><span class="sxs-lookup"><span data-stu-id="582c6-844">Continuous assessment</span></span>
- <span data-ttu-id="582c6-845">Actionable recommendations</span><span class="sxs-lookup"><span data-stu-id="582c6-845">Actionable recommendations</span></span> 

#### <a name="centralize-policy-management"></a><span data-ttu-id="582c6-846">Centralize policy management</span><span class="sxs-lookup"><span data-stu-id="582c6-846">Centralize policy management</span></span>

<span data-ttu-id="582c6-847">With centralized policy management, Contoso will ensure compliance with security requirements by centrally managing security policies across the entire environment.</span><span class="sxs-lookup"><span data-stu-id="582c6-847">With centralized policy management, Contoso will ensure compliance with security requirements by centrally managing security policies across the entire environment.</span></span> <span data-ttu-id="582c6-848">It can simply and quickly implement a policy which applies to all of its Azure resources.</span><span class="sxs-lookup"><span data-stu-id="582c6-848">It can simply and quickly implement a policy which applies to all of its Azure resources.</span></span>

![Security policy](./media/contoso-migration-infrastructure/security-policy.png)

#### <a name="assess-and-action"></a><span data-ttu-id="582c6-850">Assess and action</span><span class="sxs-lookup"><span data-stu-id="582c6-850">Assess and action</span></span>

<span data-ttu-id="582c6-851">Contoso will leverage the continuous security assessment which monitors the security of machines, networks, storage, data, and applications; to discover potential security issues.</span><span class="sxs-lookup"><span data-stu-id="582c6-851">Contoso will leverage the continuous security assessment which monitors the security of machines, networks, storage, data, and applications; to discover potential security issues.</span></span> 

- <span data-ttu-id="582c6-852">Security Center will analyze the security state of Contosos compute, infrastructure, and data resources, and of Azure apps and services.</span><span class="sxs-lookup"><span data-stu-id="582c6-852">Security Center will analyze the security state of Contosos compute, infrastructure, and data resources, and of Azure apps and services.</span></span>
- <span data-ttu-id="582c6-853">Continuous assessment helps the Contoso operations team to discover potential security issues, such as systems with missing security updates or exposed network ports.</span><span class="sxs-lookup"><span data-stu-id="582c6-853">Continuous assessment helps the Contoso operations team to discover potential security issues, such as systems with missing security updates or exposed network ports.</span></span> 
- <span data-ttu-id="582c6-854">In particular Contoso wants to make sure all of the VMs are protected.</span><span class="sxs-lookup"><span data-stu-id="582c6-854">In particular Contoso wants to make sure all of the VMs are protected.</span></span> <span data-ttu-id="582c6-855">Security Center helps with this, verifying VM health, and making prioritized and actionable recommendations to remediate security vulnerabilities before they're exploited.</span><span class="sxs-lookup"><span data-stu-id="582c6-855">Security Center helps with this, verifying VM health, and making prioritized and actionable recommendations to remediate security vulnerabilities before they're exploited.</span></span>

![Monitoring](./media/contoso-migration-infrastructure/monitoring.png)

### <a name="work-with-nsgs"></a><span data-ttu-id="582c6-857">Work with NSGs</span><span class="sxs-lookup"><span data-stu-id="582c6-857">Work with NSGs</span></span>

<span data-ttu-id="582c6-858">Contoso can limit network traffic to resources in a virtual network using network security groups.</span><span class="sxs-lookup"><span data-stu-id="582c6-858">Contoso can limit network traffic to resources in a virtual network using network security groups.</span></span>

- <span data-ttu-id="582c6-859">A network security group contains a list of security rules that allow or deny inbound or outbound network traffic based on source or destination IP address, port, and protocol.</span><span class="sxs-lookup"><span data-stu-id="582c6-859">A network security group contains a list of security rules that allow or deny inbound or outbound network traffic based on source or destination IP address, port, and protocol.</span></span>
- <span data-ttu-id="582c6-860">When applied to a subnet, rules are applied to all resources in the subnet.</span><span class="sxs-lookup"><span data-stu-id="582c6-860">When applied to a subnet, rules are applied to all resources in the subnet.</span></span> <span data-ttu-id="582c6-861">In addition to network interfaces, this includes instances of Azure services deployed in the subnet.</span><span class="sxs-lookup"><span data-stu-id="582c6-861">In addition to network interfaces, this includes instances of Azure services deployed in the subnet.</span></span>
- <span data-ttu-id="582c6-862">Application security groups (ASGs) enable you to configure network security as a natural extension of an app structure, allowing you to group VMs and define network security policies based on those groups.</span><span class="sxs-lookup"><span data-stu-id="582c6-862">Application security groups (ASGs) enable you to configure network security as a natural extension of an app structure, allowing you to group VMs and define network security policies based on those groups.</span></span>
    - <span data-ttu-id="582c6-863">App security groups mean that you can reuse your security policy at scale, without manual maintenance of explicit IP addresses.</span><span class="sxs-lookup"><span data-stu-id="582c6-863">App security groups mean that you can reuse your security policy at scale, without manual maintenance of explicit IP addresses.</span></span> <span data-ttu-id="582c6-864">The platform handles the complexity of explicit IP addresses and multiple rule sets, allowing you to focus on your business logic.</span><span class="sxs-lookup"><span data-stu-id="582c6-864">The platform handles the complexity of explicit IP addresses and multiple rule sets, allowing you to focus on your business logic.</span></span>
    - <span data-ttu-id="582c6-865">You can specify an application security group as the source and destination in a security rule.</span><span class="sxs-lookup"><span data-stu-id="582c6-865">You can specify an application security group as the source and destination in a security rule.</span></span> <span data-ttu-id="582c6-866">After your security policy is defined, you can create VMs, and assign the VM NICs to a group.</span><span class="sxs-lookup"><span data-stu-id="582c6-866">After your security policy is defined, you can create VMs, and assign the VM NICs to a group.</span></span> 


<span data-ttu-id="582c6-867">Contoso will implement a mix of NSGs and ASGs.</span><span class="sxs-lookup"><span data-stu-id="582c6-867">Contoso will implement a mix of NSGs and ASGs.</span></span> <span data-ttu-id="582c6-868">Contoso are concerned about NSG management.</span><span class="sxs-lookup"><span data-stu-id="582c6-868">Contoso are concerned about NSG management.</span></span> <span data-ttu-id="582c6-869">It's also worried about the overuse of NSGs, and the added complexity for operations staff.</span><span class="sxs-lookup"><span data-stu-id="582c6-869">It's also worried about the overuse of NSGs, and the added complexity for operations staff.</span></span>
- <span data-ttu-id="582c6-870">All traffic into and out of all subnets (north-south), will be subject to an NSG rule, except for the GatewaySubnets in the Hub networks.</span><span class="sxs-lookup"><span data-stu-id="582c6-870">All traffic into and out of all subnets (north-south), will be subject to an NSG rule, except for the GatewaySubnets in the Hub networks.</span></span>
- <span data-ttu-id="582c6-871">Any firewalls or domain controller will be protected by both subnet NSGs and NIC NSGs.</span><span class="sxs-lookup"><span data-stu-id="582c6-871">Any firewalls or domain controller will be protected by both subnet NSGs and NIC NSGs.</span></span>
- <span data-ttu-id="582c6-872">All production applications will have ASGs applied.</span><span class="sxs-lookup"><span data-stu-id="582c6-872">All production applications will have ASGs applied.</span></span>


<span data-ttu-id="582c6-873">Contoso has built a model of how this will look for its applications.</span><span class="sxs-lookup"><span data-stu-id="582c6-873">Contoso has built a model of how this will look for its applications.</span></span>

![Security](./media/contoso-migration-infrastructure/asg.png)


<span data-ttu-id="582c6-875">The NSGs associated with the ASGs will be configured with least privilege to ensure that only allowed packets can flow from one part of the network to its destination.</span><span class="sxs-lookup"><span data-stu-id="582c6-875">The NSGs associated with the ASGs will be configured with least privilege to ensure that only allowed packets can flow from one part of the network to its destination.</span></span>

<span data-ttu-id="582c6-876">**Action**</span><span class="sxs-lookup"><span data-stu-id="582c6-876">**Action**</span></span> | <span data-ttu-id="582c6-877">**Name**</span><span class="sxs-lookup"><span data-stu-id="582c6-877">**Name**</span></span> | <span data-ttu-id="582c6-878">**Source**</span><span class="sxs-lookup"><span data-stu-id="582c6-878">**Source**</span></span> | <span data-ttu-id="582c6-879">**Target**</span><span class="sxs-lookup"><span data-stu-id="582c6-879">**Target**</span></span> | <span data-ttu-id="582c6-880">**Port**</span><span class="sxs-lookup"><span data-stu-id="582c6-880">**Port**</span></span>
--- | --- | --- | --- | --- 
<span data-ttu-id="582c6-881">Allow</span><span class="sxs-lookup"><span data-stu-id="582c6-881">Allow</span></span> | <span data-ttu-id="582c6-882">AllowiInternetToFE</span><span class="sxs-lookup"><span data-stu-id="582c6-882">AllowiInternetToFE</span></span> | <span data-ttu-id="582c6-883">VNET-HUB-EUS1/IB-TrustZone</span><span class="sxs-lookup"><span data-stu-id="582c6-883">VNET-HUB-EUS1/IB-TrustZone</span></span> | <span data-ttu-id="582c6-884">APP1-FE 80, 443</span><span class="sxs-lookup"><span data-stu-id="582c6-884">APP1-FE 80, 443</span></span>
<span data-ttu-id="582c6-885">Allow</span><span class="sxs-lookup"><span data-stu-id="582c6-885">Allow</span></span> | <span data-ttu-id="582c6-886">AllowWebToApp</span><span class="sxs-lookup"><span data-stu-id="582c6-886">AllowWebToApp</span></span> | <span data-ttu-id="582c6-887">APP1-FE</span><span class="sxs-lookup"><span data-stu-id="582c6-887">APP1-FE</span></span> | <span data-ttu-id="582c6-888">APP1-DB</span><span class="sxs-lookup"><span data-stu-id="582c6-888">APP1-DB</span></span> | <span data-ttu-id="582c6-889">1433</span><span class="sxs-lookup"><span data-stu-id="582c6-889">1433</span></span>
<span data-ttu-id="582c6-890">Allow</span><span class="sxs-lookup"><span data-stu-id="582c6-890">Allow</span></span> | <span data-ttu-id="582c6-891">AllowAppToDB</span><span class="sxs-lookup"><span data-stu-id="582c6-891">AllowAppToDB</span></span> | <span data-ttu-id="582c6-892">APP1-APP</span><span class="sxs-lookup"><span data-stu-id="582c6-892">APP1-APP</span></span> | <span data-ttu-id="582c6-893">Any</span><span class="sxs-lookup"><span data-stu-id="582c6-893">Any</span></span> | <span data-ttu-id="582c6-894">Any</span><span class="sxs-lookup"><span data-stu-id="582c6-894">Any</span></span>
<span data-ttu-id="582c6-895">Deny</span><span class="sxs-lookup"><span data-stu-id="582c6-895">Deny</span></span> | <span data-ttu-id="582c6-896">DenyAllInbound</span><span class="sxs-lookup"><span data-stu-id="582c6-896">DenyAllInbound</span></span> | <span data-ttu-id="582c6-897">Any</span><span class="sxs-lookup"><span data-stu-id="582c6-897">Any</span></span> | <span data-ttu-id="582c6-898">Any</span><span class="sxs-lookup"><span data-stu-id="582c6-898">Any</span></span> | <span data-ttu-id="582c6-899">Any</span><span class="sxs-lookup"><span data-stu-id="582c6-899">Any</span></span>

### <a name="encrypt-data"></a><span data-ttu-id="582c6-900">Encrypt data</span><span class="sxs-lookup"><span data-stu-id="582c6-900">Encrypt data</span></span>

<span data-ttu-id="582c6-901">Azure Disk Encryption integrates with Azure Key Vault to help control and manage the disk-encryption keys and secrets in a key vault subscription.</span><span class="sxs-lookup"><span data-stu-id="582c6-901">Azure Disk Encryption integrates with Azure Key Vault to help control and manage the disk-encryption keys and secrets in a key vault subscription.</span></span> <span data-ttu-id="582c6-902">It ensures that all data on VM disks are encrypted at rest in Azure storage.</span><span class="sxs-lookup"><span data-stu-id="582c6-902">It ensures that all data on VM disks are encrypted at rest in Azure storage.</span></span>  

- <span data-ttu-id="582c6-903">Contoso has determined that specific VMs require encryption.</span><span class="sxs-lookup"><span data-stu-id="582c6-903">Contoso has determined that specific VMs require encryption.</span></span>
- <span data-ttu-id="582c6-904">Contoso will apply encryption to VMs with customer, confidential, or PPI data.</span><span class="sxs-lookup"><span data-stu-id="582c6-904">Contoso will apply encryption to VMs with customer, confidential, or PPI data.</span></span>


## <a name="conclusion"></a><span data-ttu-id="582c6-905">Conclusion</span><span class="sxs-lookup"><span data-stu-id="582c6-905">Conclusion</span></span>

<span data-ttu-id="582c6-906">In this article, Contoso set up an Azure infrastructure and policy for Azure subscription, hybrid identify, disaster recovery, networking, governance, and security.</span><span class="sxs-lookup"><span data-stu-id="582c6-906">In this article, Contoso set up an Azure infrastructure and policy for Azure subscription, hybrid identify, disaster recovery, networking, governance, and security.</span></span> 

<span data-ttu-id="582c6-907">Not all of the steps that Contoso completed here are required for a migration to the cloud.</span><span class="sxs-lookup"><span data-stu-id="582c6-907">Not all of the steps that Contoso completed here are required for a migration to the cloud.</span></span> <span data-ttu-id="582c6-908">In this case, it wanted to plan a network infrastructure that can be used for all types of migrations, and is secure, resilient, and scalable.</span><span class="sxs-lookup"><span data-stu-id="582c6-908">In this case, it wanted to plan a network infrastructure that can be used for all types of migrations, and is secure, resilient, and scalable.</span></span> 

<span data-ttu-id="582c6-909">With this infrastructure in place, Contoso is ready to move on and try out migration.</span><span class="sxs-lookup"><span data-stu-id="582c6-909">With this infrastructure in place, Contoso is ready to move on and try out migration.</span></span>

## <a name="next-steps"></a><span data-ttu-id="582c6-910">Next steps</span><span class="sxs-lookup"><span data-stu-id="582c6-910">Next steps</span></span>

<span data-ttu-id="582c6-911">As a first migration scenario, Contoso is going to [assess the on-premises SmartHotel360 two-tiered app for migration to Azure](contoso-migration-assessment.md).</span><span class="sxs-lookup"><span data-stu-id="582c6-911">As a first migration scenario, Contoso is going to [assess the on-premises SmartHotel360 two-tiered app for migration to Azure](contoso-migration-assessment.md).</span></span> 
