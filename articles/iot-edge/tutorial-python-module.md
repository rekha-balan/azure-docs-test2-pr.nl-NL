---
title: Azure IoT Edge Python tutorial | Microsoft Docs
description: This tutorial shows you how to create an IoT Edge module with Python code and deploy it to an edge device.
services: iot-edge
author: shizn
manager: timlt
ms.author: xshi
ms.date: 06/26/2018
ms.topic: tutorial
ms.service: iot-edge
ms.custom: mvc
ms.openlocfilehash: 6cf3a721dfd601fc4d4beb122f56b4a4de5fe426
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44867338"
---
# <a name="tutorial-develop-and-deploy-a-python-iot-edge-module-to-your-simulated-device"></a><span data-ttu-id="4696e-103">Tutorial: Develop and deploy a Python IoT Edge module to your simulated device</span><span class="sxs-lookup"><span data-stu-id="4696e-103">Tutorial: Develop and deploy a Python IoT Edge module to your simulated device</span></span>

<span data-ttu-id="4696e-104">You can use Azure IoT Edge modules to deploy code that implements your business logic directly to your IoT Edge devices.</span><span class="sxs-lookup"><span data-stu-id="4696e-104">You can use Azure IoT Edge modules to deploy code that implements your business logic directly to your IoT Edge devices.</span></span> <span data-ttu-id="4696e-105">This tutorial walks you through creating and deploying an IoT Edge module that filters sensor data.</span><span class="sxs-lookup"><span data-stu-id="4696e-105">This tutorial walks you through creating and deploying an IoT Edge module that filters sensor data.</span></span> <span data-ttu-id="4696e-106">You'll use the simulated IoT Edge device that you created in the Deploy Azure IoT Edge on a simulated device in [Windows][lnk-quickstart-win] or [Linux][lnk-quickstart-lin] quickstarts.</span><span class="sxs-lookup"><span data-stu-id="4696e-106">You'll use the simulated IoT Edge device that you created in the Deploy Azure IoT Edge on a simulated device in [Windows][lnk-quickstart-win] or [Linux][lnk-quickstart-lin] quickstarts.</span></span> <span data-ttu-id="4696e-107">In this tutorial, you learn how to:</span><span class="sxs-lookup"><span data-stu-id="4696e-107">In this tutorial, you learn how to:</span></span>    

> [!div class="checklist"]
> * <span data-ttu-id="4696e-108">Use Visual Studio Code to create an IoT Edge Python module.</span><span class="sxs-lookup"><span data-stu-id="4696e-108">Use Visual Studio Code to create an IoT Edge Python module.</span></span>
> * <span data-ttu-id="4696e-109">Use Visual Studio Code and Docker to create a Docker image and publish it to your registry.</span><span class="sxs-lookup"><span data-stu-id="4696e-109">Use Visual Studio Code and Docker to create a Docker image and publish it to your registry.</span></span>
> * <span data-ttu-id="4696e-110">Deploy the module to your IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="4696e-110">Deploy the module to your IoT Edge device.</span></span>
> * <span data-ttu-id="4696e-111">View generated data.</span><span class="sxs-lookup"><span data-stu-id="4696e-111">View generated data.</span></span>


<span data-ttu-id="4696e-112">The IoT Edge module that you create in this tutorial filters the temperature data that's generated by your device.</span><span class="sxs-lookup"><span data-stu-id="4696e-112">The IoT Edge module that you create in this tutorial filters the temperature data that's generated by your device.</span></span> <span data-ttu-id="4696e-113">It only sends messages upstream if the temperature is above a specified threshold.</span><span class="sxs-lookup"><span data-stu-id="4696e-113">It only sends messages upstream if the temperature is above a specified threshold.</span></span> <span data-ttu-id="4696e-114">This type of analysis at the edge is useful for reducing the amount of data that's communicated to and stored in the cloud.</span><span class="sxs-lookup"><span data-stu-id="4696e-114">This type of analysis at the edge is useful for reducing the amount of data that's communicated to and stored in the cloud.</span></span> 

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]


## <a name="prerequisites"></a><span data-ttu-id="4696e-115">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="4696e-115">Prerequisites</span></span>

<span data-ttu-id="4696e-116">An Azure IoT Edge device:</span><span class="sxs-lookup"><span data-stu-id="4696e-116">An Azure IoT Edge device:</span></span>

* <span data-ttu-id="4696e-117">You can use your development machine or a virtual machine as an Edge device by following the steps in the quickstart for [Linux](quickstart-linux.md).</span><span class="sxs-lookup"><span data-stu-id="4696e-117">You can use your development machine or a virtual machine as an Edge device by following the steps in the quickstart for [Linux](quickstart-linux.md).</span></span>
* <span data-ttu-id="4696e-118">Python modules for IoT Edge don't support Windows devices.</span><span class="sxs-lookup"><span data-stu-id="4696e-118">Python modules for IoT Edge don't support Windows devices.</span></span>

<span data-ttu-id="4696e-119">Cloud resources:</span><span class="sxs-lookup"><span data-stu-id="4696e-119">Cloud resources:</span></span>

* <span data-ttu-id="4696e-120">A standard-tier [IoT Hub](../iot-hub/iot-hub-create-through-portal.md) in Azure.</span><span class="sxs-lookup"><span data-stu-id="4696e-120">A standard-tier [IoT Hub](../iot-hub/iot-hub-create-through-portal.md) in Azure.</span></span> 

<span data-ttu-id="4696e-121">Development resources:</span><span class="sxs-lookup"><span data-stu-id="4696e-121">Development resources:</span></span>

* <span data-ttu-id="4696e-122">[Visual Studio Code](https://code.visualstudio.com/).</span><span class="sxs-lookup"><span data-stu-id="4696e-122">[Visual Studio Code](https://code.visualstudio.com/).</span></span> 
* <span data-ttu-id="4696e-123">[Azure IoT Edge extension](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge) for Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="4696e-123">[Azure IoT Edge extension](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge) for Visual Studio Code.</span></span>
* <span data-ttu-id="4696e-124">[Python extension](https://marketplace.visualstudio.com/items?itemName=ms-python.python) for Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="4696e-124">[Python extension](https://marketplace.visualstudio.com/items?itemName=ms-python.python) for Visual Studio Code.</span></span> 
* <span data-ttu-id="4696e-125">[Docker CE](https://docs.docker.com/engine/installation/).</span><span class="sxs-lookup"><span data-stu-id="4696e-125">[Docker CE](https://docs.docker.com/engine/installation/).</span></span> 
* <span data-ttu-id="4696e-126">[Python](https://www.python.org/downloads/).</span><span class="sxs-lookup"><span data-stu-id="4696e-126">[Python](https://www.python.org/downloads/).</span></span>
* <span data-ttu-id="4696e-127">[Pip](https://pip.pypa.io/en/stable/installing/#installation) for installing Python packages (typically included with your Python installation).</span><span class="sxs-lookup"><span data-stu-id="4696e-127">[Pip](https://pip.pypa.io/en/stable/installing/#installation) for installing Python packages (typically included with your Python installation).</span></span>

>[!Note]
><span data-ttu-id="4696e-128">Ensure that your `bin` folder is on your path for your platform.</span><span class="sxs-lookup"><span data-stu-id="4696e-128">Ensure that your `bin` folder is on your path for your platform.</span></span> <span data-ttu-id="4696e-129">Typically `~/.local/` for UNIX and macOS, or `%APPDATA%\Python` on Windows.</span><span class="sxs-lookup"><span data-stu-id="4696e-129">Typically `~/.local/` for UNIX and macOS, or `%APPDATA%\Python` on Windows.</span></span>

## <a name="create-a-container-registry"></a><span data-ttu-id="4696e-130">Create a container registry</span><span class="sxs-lookup"><span data-stu-id="4696e-130">Create a container registry</span></span>
<span data-ttu-id="4696e-131">In this tutorial, you use the Azure IoT Edge extension for VS Code to build a module and create a **container image** from the files.</span><span class="sxs-lookup"><span data-stu-id="4696e-131">In this tutorial, you use the Azure IoT Edge extension for VS Code to build a module and create a **container image** from the files.</span></span> <span data-ttu-id="4696e-132">Then you push this image to a **registry** that stores and manages your images.</span><span class="sxs-lookup"><span data-stu-id="4696e-132">Then you push this image to a **registry** that stores and manages your images.</span></span> <span data-ttu-id="4696e-133">Finally, you deploy your image from your registry to run on your IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="4696e-133">Finally, you deploy your image from your registry to run on your IoT Edge device.</span></span>  

<span data-ttu-id="4696e-134">You can use any Docker-compatible registry for this tutorial.</span><span class="sxs-lookup"><span data-stu-id="4696e-134">You can use any Docker-compatible registry for this tutorial.</span></span> <span data-ttu-id="4696e-135">Two popular Docker registry services that are available in the cloud are [Azure Container Registry](https://docs.microsoft.com/azure/container-registry/) and [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags).</span><span class="sxs-lookup"><span data-stu-id="4696e-135">Two popular Docker registry services that are available in the cloud are [Azure Container Registry](https://docs.microsoft.com/azure/container-registry/) and [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags).</span></span> <span data-ttu-id="4696e-136">This tutorial uses Azure Container Registry.</span><span class="sxs-lookup"><span data-stu-id="4696e-136">This tutorial uses Azure Container Registry.</span></span> 

1. <span data-ttu-id="4696e-137">In the [Azure portal](https://portal.azure.com), select **Create a resource** > **Containers** > **Azure Container Registry**.</span><span class="sxs-lookup"><span data-stu-id="4696e-137">In the [Azure portal](https://portal.azure.com), select **Create a resource** > **Containers** > **Azure Container Registry**.</span></span>
2. <span data-ttu-id="4696e-138">Give your registry a name, choose a subscription, choose a resource group, and set the SKU to **Basic**.</span><span class="sxs-lookup"><span data-stu-id="4696e-138">Give your registry a name, choose a subscription, choose a resource group, and set the SKU to **Basic**.</span></span> 
3. <span data-ttu-id="4696e-139">Select **Create**.</span><span class="sxs-lookup"><span data-stu-id="4696e-139">Select **Create**.</span></span>
4. <span data-ttu-id="4696e-140">After your container registry is created, browse to it, and select **Access keys**.</span><span class="sxs-lookup"><span data-stu-id="4696e-140">After your container registry is created, browse to it, and select **Access keys**.</span></span> 
5. <span data-ttu-id="4696e-141">Toggle **Admin user** to **Enable**.</span><span class="sxs-lookup"><span data-stu-id="4696e-141">Toggle **Admin user** to **Enable**.</span></span>
6. <span data-ttu-id="4696e-142">Copy the values for **Login server**, **Username**, and **Password**.</span><span class="sxs-lookup"><span data-stu-id="4696e-142">Copy the values for **Login server**, **Username**, and **Password**.</span></span> <span data-ttu-id="4696e-143">You use these values later in the tutorial.</span><span class="sxs-lookup"><span data-stu-id="4696e-143">You use these values later in the tutorial.</span></span> 

## <a name="create-an-iot-edge-module-project"></a><span data-ttu-id="4696e-144">Create an IoT Edge module project</span><span class="sxs-lookup"><span data-stu-id="4696e-144">Create an IoT Edge module project</span></span>
<span data-ttu-id="4696e-145">The following steps create an IoT Edge Python module by using Visual Studio Code and the Azure IoT Edge extension.</span><span class="sxs-lookup"><span data-stu-id="4696e-145">The following steps create an IoT Edge Python module by using Visual Studio Code and the Azure IoT Edge extension.</span></span>

### <a name="create-a-new-solution"></a><span data-ttu-id="4696e-146">Create a new solution</span><span class="sxs-lookup"><span data-stu-id="4696e-146">Create a new solution</span></span>

<span data-ttu-id="4696e-147">Use the Python package **cookiecutter** to create a Python solution template that you can build on top of.</span><span class="sxs-lookup"><span data-stu-id="4696e-147">Use the Python package **cookiecutter** to create a Python solution template that you can build on top of.</span></span> 

1. <span data-ttu-id="4696e-148">In Visual Studio Code, select **View** > **Integrated Terminal** to open the VS Code integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="4696e-148">In Visual Studio Code, select **View** > **Integrated Terminal** to open the VS Code integrated terminal.</span></span>

2. <span data-ttu-id="4696e-149">In the integrated terminal, enter the following command to install (or update) **cookiecutter**, which you use to create the IoT Edge solution template in VS Code:</span><span class="sxs-lookup"><span data-stu-id="4696e-149">In the integrated terminal, enter the following command to install (or update) **cookiecutter**, which you use to create the IoT Edge solution template in VS Code:</span></span>

    ```cmd/sh
    pip install --upgrade --user cookiecutter
    ```
   >[!Note]
   ><span data-ttu-id="4696e-150">Ensure the directory where cookiecutter will be installed is in your environment’s `Path` in order to make it possible to invoke it from a command prompt.</span><span class="sxs-lookup"><span data-stu-id="4696e-150">Ensure the directory where cookiecutter will be installed is in your environment’s `Path` in order to make it possible to invoke it from a command prompt.</span></span>

3. <span data-ttu-id="4696e-151">Select **View** > **Command Palette** to open the VS Code command palette.</span><span class="sxs-lookup"><span data-stu-id="4696e-151">Select **View** > **Command Palette** to open the VS Code command palette.</span></span> 

4. <span data-ttu-id="4696e-152">In the command palette, enter and run the command **Azure: Sign in** and follow the instructions to sign in your Azure account.</span><span class="sxs-lookup"><span data-stu-id="4696e-152">In the command palette, enter and run the command **Azure: Sign in** and follow the instructions to sign in your Azure account.</span></span> <span data-ttu-id="4696e-153">If you're already signed in, you can skip this step.</span><span class="sxs-lookup"><span data-stu-id="4696e-153">If you're already signed in, you can skip this step.</span></span>

5. <span data-ttu-id="4696e-154">In the command palette, enter and run the command **Azure IoT Edge: New IoT Edge solution**.</span><span class="sxs-lookup"><span data-stu-id="4696e-154">In the command palette, enter and run the command **Azure IoT Edge: New IoT Edge solution**.</span></span> <span data-ttu-id="4696e-155">In the command palette, provide the following information to create your solution:</span><span class="sxs-lookup"><span data-stu-id="4696e-155">In the command palette, provide the following information to create your solution:</span></span> 

   1. <span data-ttu-id="4696e-156">Select the folder where you want to create the solution.</span><span class="sxs-lookup"><span data-stu-id="4696e-156">Select the folder where you want to create the solution.</span></span> 
   2. <span data-ttu-id="4696e-157">Provide a name for your solution or accept the default **EdgeSolution**.</span><span class="sxs-lookup"><span data-stu-id="4696e-157">Provide a name for your solution or accept the default **EdgeSolution**.</span></span>
   3. <span data-ttu-id="4696e-158">Choose **Python Module** as the module template.</span><span class="sxs-lookup"><span data-stu-id="4696e-158">Choose **Python Module** as the module template.</span></span> 
   4. <span data-ttu-id="4696e-159">Name your module **PythonModule**.</span><span class="sxs-lookup"><span data-stu-id="4696e-159">Name your module **PythonModule**.</span></span> 
   5. <span data-ttu-id="4696e-160">Specify the Azure container registry that you created in the previous section as the image repository for your first module.</span><span class="sxs-lookup"><span data-stu-id="4696e-160">Specify the Azure container registry that you created in the previous section as the image repository for your first module.</span></span> <span data-ttu-id="4696e-161">Replace **localhost:5000** with the login server value that you copied.</span><span class="sxs-lookup"><span data-stu-id="4696e-161">Replace **localhost:5000** with the login server value that you copied.</span></span> <span data-ttu-id="4696e-162">The final string looks like \<registry name\>.azurecr.io/pythonmodule.</span><span class="sxs-lookup"><span data-stu-id="4696e-162">The final string looks like \<registry name\>.azurecr.io/pythonmodule.</span></span>
 
   ![Provide Docker image repository](./media/tutorial-python-module/repository.png)

<span data-ttu-id="4696e-164">The VS Code window loads your IoT Edge solution workspace.</span><span class="sxs-lookup"><span data-stu-id="4696e-164">The VS Code window loads your IoT Edge solution workspace.</span></span> <span data-ttu-id="4696e-165">The solution workspace contains five top-level components.</span><span class="sxs-lookup"><span data-stu-id="4696e-165">The solution workspace contains five top-level components.</span></span> <span data-ttu-id="4696e-166">You won't edit the **\.gitignore** file in this tutorial.</span><span class="sxs-lookup"><span data-stu-id="4696e-166">You won't edit the **\.gitignore** file in this tutorial.</span></span> <span data-ttu-id="4696e-167">The **modules** folder contains the Python code for your module as well as Dockerfiles for building your module as a container image.</span><span class="sxs-lookup"><span data-stu-id="4696e-167">The **modules** folder contains the Python code for your module as well as Dockerfiles for building your module as a container image.</span></span> <span data-ttu-id="4696e-168">The **\.env** file stores your container registry credentials.</span><span class="sxs-lookup"><span data-stu-id="4696e-168">The **\.env** file stores your container registry credentials.</span></span> <span data-ttu-id="4696e-169">The **deployment.template.json** file contains the information that the IoT Edge runtime uses to deploy modules on a device.</span><span class="sxs-lookup"><span data-stu-id="4696e-169">The **deployment.template.json** file contains the information that the IoT Edge runtime uses to deploy modules on a device.</span></span> 

<span data-ttu-id="4696e-170">If you didn't specify a container registry when creating your solution, but accepted the default localhost:5000 value, you won't have a \.env file.</span><span class="sxs-lookup"><span data-stu-id="4696e-170">If you didn't specify a container registry when creating your solution, but accepted the default localhost:5000 value, you won't have a \.env file.</span></span> 

   ![Python solution workspace](./media/tutorial-python-module/workspace.png)

### <a name="add-your-registry-credentials"></a><span data-ttu-id="4696e-172">Add your registry credentials</span><span class="sxs-lookup"><span data-stu-id="4696e-172">Add your registry credentials</span></span>

<span data-ttu-id="4696e-173">The environment file stores the credentials for your container repository and shares them with the IoT Edge runtime.</span><span class="sxs-lookup"><span data-stu-id="4696e-173">The environment file stores the credentials for your container repository and shares them with the IoT Edge runtime.</span></span> <span data-ttu-id="4696e-174">The runtime needs these credentials to pull your private images onto the IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="4696e-174">The runtime needs these credentials to pull your private images onto the IoT Edge device.</span></span> 

1. <span data-ttu-id="4696e-175">In the VS Code explorer, open the .env file.</span><span class="sxs-lookup"><span data-stu-id="4696e-175">In the VS Code explorer, open the .env file.</span></span> 
2. <span data-ttu-id="4696e-176">Update the fields with the **username** and **password** values that you copied from your Azure container registry.</span><span class="sxs-lookup"><span data-stu-id="4696e-176">Update the fields with the **username** and **password** values that you copied from your Azure container registry.</span></span> 
3. <span data-ttu-id="4696e-177">Save this file.</span><span class="sxs-lookup"><span data-stu-id="4696e-177">Save this file.</span></span> 

### <a name="update-the-module-with-custom-code"></a><span data-ttu-id="4696e-178">Update the module with custom code</span><span class="sxs-lookup"><span data-stu-id="4696e-178">Update the module with custom code</span></span>

<span data-ttu-id="4696e-179">Each template includes sample code, which takes simulated sensor data from the **tempSensor** module and routes it to the IoT hub.</span><span class="sxs-lookup"><span data-stu-id="4696e-179">Each template includes sample code, which takes simulated sensor data from the **tempSensor** module and routes it to the IoT hub.</span></span> <span data-ttu-id="4696e-180">In this section, add the code that expands the **PythonModule** to analyze the messages before sending them.</span><span class="sxs-lookup"><span data-stu-id="4696e-180">In this section, add the code that expands the **PythonModule** to analyze the messages before sending them.</span></span> 

1. <span data-ttu-id="4696e-181">In the VS Code explorer, open **modules** > **PythonModule** > **main.py**.</span><span class="sxs-lookup"><span data-stu-id="4696e-181">In the VS Code explorer, open **modules** > **PythonModule** > **main.py**.</span></span>

2. <span data-ttu-id="4696e-182">At the top of the **main.py** file, import the **json** library:</span><span class="sxs-lookup"><span data-stu-id="4696e-182">At the top of the **main.py** file, import the **json** library:</span></span>

    ```python
    import json
    ```

3. <span data-ttu-id="4696e-183">Add the **TEMPERATURE_THRESHOLD** and **TWIN_CALLBACKS** variables under the global counters.</span><span class="sxs-lookup"><span data-stu-id="4696e-183">Add the **TEMPERATURE_THRESHOLD** and **TWIN_CALLBACKS** variables under the global counters.</span></span> <span data-ttu-id="4696e-184">The temperature threshold sets the value that the measured machine temperature must exceed for the data to be sent to the IoT hub.</span><span class="sxs-lookup"><span data-stu-id="4696e-184">The temperature threshold sets the value that the measured machine temperature must exceed for the data to be sent to the IoT hub.</span></span>

    ```python
    TEMPERATURE_THRESHOLD = 25
    TWIN_CALLBACKS = 0
    ```

4. <span data-ttu-id="4696e-185">Replace the **receive_message_callback** function with the following code:</span><span class="sxs-lookup"><span data-stu-id="4696e-185">Replace the **receive_message_callback** function with the following code:</span></span>

    ```python
    # receive_message_callback is invoked when an incoming message arrives on the specified 
    # input queue (in the case of this sample, "input1").  Because this is a filter module, 
    # we forward this message to the "output1" queue.
    def receive_message_callback(message, hubManager):
        global RECEIVE_CALLBACKS
        global TEMPERATURE_THRESHOLD
        message_buffer = message.get_bytearray()
        size = len(message_buffer)
        message_text = message_buffer[:size].decode('utf-8')
        print ( "    Data: <<<%s>>> & Size=%d" % (message_text, size) )
        map_properties = message.properties()
        key_value_pair = map_properties.get_internals()
        print ( "    Properties: %s" % key_value_pair )
        RECEIVE_CALLBACKS += 1
        print ( "    Total calls received: %d" % RECEIVE_CALLBACKS )
        data = json.loads(message_text)
        if "machine" in data and "temperature" in data["machine"] and data["machine"]["temperature"] > TEMPERATURE_THRESHOLD:
            map_properties.add("MessageType", "Alert")
            print("Machine temperature %s exceeds threshold %s" % (data["machine"]["temperature"], TEMPERATURE_THRESHOLD))
        hubManager.forward_event_to_output("output1", message, 0)
        return IoTHubMessageDispositionResult.ACCEPTED
    ```

5. <span data-ttu-id="4696e-186">Add a new function called **module_twin_callback**.</span><span class="sxs-lookup"><span data-stu-id="4696e-186">Add a new function called **module_twin_callback**.</span></span> <span data-ttu-id="4696e-187">This function is invoked when the desired properties are updated.</span><span class="sxs-lookup"><span data-stu-id="4696e-187">This function is invoked when the desired properties are updated.</span></span>

    ```python
    # module_twin_callback is invoked when the module twin's desired properties are updated.
    def module_twin_callback(update_state, payload, user_context):
        global TWIN_CALLBACKS
        global TEMPERATURE_THRESHOLD
        print ( "\nTwin callback called with:\nupdateStatus = %s\npayload = %s\ncontext = %s" % (update_state, payload, user_context) )
        data = json.loads(payload)
        if "desired" in data and "TemperatureThreshold" in data["desired"]:
            TEMPERATURE_THRESHOLD = data["desired"]["TemperatureThreshold"]
        if "TemperatureThreshold" in data:
            TEMPERATURE_THRESHOLD = data["TemperatureThreshold"]
        TWIN_CALLBACKS += 1
        print ( "Total calls confirmed: %d\n" % TWIN_CALLBACKS )
    ```

6. <span data-ttu-id="4696e-188">In the **HubManager** class, add a new line to the **__init__** method to initialize the **module_twin_callback** function that you just added:</span><span class="sxs-lookup"><span data-stu-id="4696e-188">In the **HubManager** class, add a new line to the **__init__** method to initialize the **module_twin_callback** function that you just added:</span></span>

    ```python
    # Sets the callback when a module twin's desired properties are updated.
    self.client.set_module_twin_callback(module_twin_callback, self)
    ```

7. <span data-ttu-id="4696e-189">Save this file.</span><span class="sxs-lookup"><span data-stu-id="4696e-189">Save this file.</span></span>

## <a name="build-your-iot-edge-solution"></a><span data-ttu-id="4696e-190">Build your IoT Edge solution</span><span class="sxs-lookup"><span data-stu-id="4696e-190">Build your IoT Edge solution</span></span>

<span data-ttu-id="4696e-191">In the previous section, you created an IoT Edge solution and added code to the **PythonModule** to filter out messages where the reported machine temperature is below the acceptable threshold.</span><span class="sxs-lookup"><span data-stu-id="4696e-191">In the previous section, you created an IoT Edge solution and added code to the **PythonModule** to filter out messages where the reported machine temperature is below the acceptable threshold.</span></span> <span data-ttu-id="4696e-192">Now you need to build the solution as a container image and push it to your container registry.</span><span class="sxs-lookup"><span data-stu-id="4696e-192">Now you need to build the solution as a container image and push it to your container registry.</span></span> 

1. <span data-ttu-id="4696e-193">Sign in to Docker by entering the following command in the Visual Studio Code integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="4696e-193">Sign in to Docker by entering the following command in the Visual Studio Code integrated terminal.</span></span> <span data-ttu-id="4696e-194">Then you can push your module image to your Azure container registry:</span><span class="sxs-lookup"><span data-stu-id="4696e-194">Then you can push your module image to your Azure container registry:</span></span> 
     
   ```csh/sh
   docker login -u <ACR username> -p <ACR password> <ACR login server>
   ```
   <span data-ttu-id="4696e-195">Use the username, password, and login server that you copied from your Azure container registry in the first section.</span><span class="sxs-lookup"><span data-stu-id="4696e-195">Use the username, password, and login server that you copied from your Azure container registry in the first section.</span></span> <span data-ttu-id="4696e-196">You can also retrieve these values from the **Access keys** section of your registry in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="4696e-196">You can also retrieve these values from the **Access keys** section of your registry in the Azure portal.</span></span>

2. <span data-ttu-id="4696e-197">In the VS Code explorer, open the deployment.template.json file in your IoT Edge solution workspace.</span><span class="sxs-lookup"><span data-stu-id="4696e-197">In the VS Code explorer, open the deployment.template.json file in your IoT Edge solution workspace.</span></span> 

   <span data-ttu-id="4696e-198">This file tells the **$edgeAgent** to deploy two modules: **tempSensor**, which simulates device data, and **PythonModule**.</span><span class="sxs-lookup"><span data-stu-id="4696e-198">This file tells the **$edgeAgent** to deploy two modules: **tempSensor**, which simulates device data, and **PythonModule**.</span></span> <span data-ttu-id="4696e-199">The **PythonModule.image** value is set to a Linux amd64 version of the image.</span><span class="sxs-lookup"><span data-stu-id="4696e-199">The **PythonModule.image** value is set to a Linux amd64 version of the image.</span></span> <span data-ttu-id="4696e-200">To learn more about deployment manifests, see [Understand how IoT Edge modules can be used, configured, and reused](module-composition.md).</span><span class="sxs-lookup"><span data-stu-id="4696e-200">To learn more about deployment manifests, see [Understand how IoT Edge modules can be used, configured, and reused](module-composition.md).</span></span>

   <span data-ttu-id="4696e-201">This file also contains your registry credentials.</span><span class="sxs-lookup"><span data-stu-id="4696e-201">This file also contains your registry credentials.</span></span> <span data-ttu-id="4696e-202">In the template file, your user name and password are filled in with placeholders.</span><span class="sxs-lookup"><span data-stu-id="4696e-202">In the template file, your user name and password are filled in with placeholders.</span></span> <span data-ttu-id="4696e-203">When you generate the deployment manifest, the fields are updated with the values that you added to the .env file.</span><span class="sxs-lookup"><span data-stu-id="4696e-203">When you generate the deployment manifest, the fields are updated with the values that you added to the .env file.</span></span> 

3. <span data-ttu-id="4696e-204">Add the **PythonModule** module twin to the deployment manifest.</span><span class="sxs-lookup"><span data-stu-id="4696e-204">Add the **PythonModule** module twin to the deployment manifest.</span></span> <span data-ttu-id="4696e-205">Insert the following JSON content at the bottom of the **moduleContent** section, after the **$edgeHub** module twin:</span><span class="sxs-lookup"><span data-stu-id="4696e-205">Insert the following JSON content at the bottom of the **moduleContent** section, after the **$edgeHub** module twin:</span></span> 
    ```json
        "PythonModule": {
            "properties.desired":{
                "TemperatureThreshold":25
            }
        }
    ```

4. <span data-ttu-id="4696e-206">Save this file.</span><span class="sxs-lookup"><span data-stu-id="4696e-206">Save this file.</span></span>

5. <span data-ttu-id="4696e-207">In the VS Code explorer, right-click the deployment.template.json file and select **Build and Push IoT Edge solution**.</span><span class="sxs-lookup"><span data-stu-id="4696e-207">In the VS Code explorer, right-click the deployment.template.json file and select **Build and Push IoT Edge solution**.</span></span> 

<span data-ttu-id="4696e-208">When you tell Visual Studio Code to build your solution, it first takes the information in the deployment template and generates a deployment.json file in a new folder named **config**. Then it runs two commands in the integrated terminal: `docker build` and `docker push`.</span><span class="sxs-lookup"><span data-stu-id="4696e-208">When you tell Visual Studio Code to build your solution, it first takes the information in the deployment template and generates a deployment.json file in a new folder named **config**. Then it runs two commands in the integrated terminal: `docker build` and `docker push`.</span></span> <span data-ttu-id="4696e-209">These two commands build your code, containerize the Python code, and then push the code to the container registry that you specified when you initialized the solution.</span><span class="sxs-lookup"><span data-stu-id="4696e-209">These two commands build your code, containerize the Python code, and then push the code to the container registry that you specified when you initialized the solution.</span></span> 

<span data-ttu-id="4696e-210">You can see the full container image address with tag in the `docker build` command that runs in the VS Code integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="4696e-210">You can see the full container image address with tag in the `docker build` command that runs in the VS Code integrated terminal.</span></span> <span data-ttu-id="4696e-211">The image address is built from information in the module.json file with the format \<repository\>:\<version\>-\<platform\>.</span><span class="sxs-lookup"><span data-stu-id="4696e-211">The image address is built from information in the module.json file with the format \<repository\>:\<version\>-\<platform\>.</span></span> <span data-ttu-id="4696e-212">For this tutorial, it should look like registryname.azurecr.io/pythonmodule:0.0.1-amd64.</span><span class="sxs-lookup"><span data-stu-id="4696e-212">For this tutorial, it should look like registryname.azurecr.io/pythonmodule:0.0.1-amd64.</span></span>

## <a name="deploy-and-run-the-solution"></a><span data-ttu-id="4696e-213">Deploy and run the solution</span><span class="sxs-lookup"><span data-stu-id="4696e-213">Deploy and run the solution</span></span>

<span data-ttu-id="4696e-214">In the quickstart article that you used to set up your IoT Edge device, you deployed a module by using the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="4696e-214">In the quickstart article that you used to set up your IoT Edge device, you deployed a module by using the Azure portal.</span></span> <span data-ttu-id="4696e-215">You can also deploy modules using the Azure IoT Toolkit extension for Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="4696e-215">You can also deploy modules using the Azure IoT Toolkit extension for Visual Studio Code.</span></span> <span data-ttu-id="4696e-216">You already have a deployment manifest prepared for your scenario, the **deployment.json** file.</span><span class="sxs-lookup"><span data-stu-id="4696e-216">You already have a deployment manifest prepared for your scenario, the **deployment.json** file.</span></span> <span data-ttu-id="4696e-217">All you need to do now is select a device to receive the deployment.</span><span class="sxs-lookup"><span data-stu-id="4696e-217">All you need to do now is select a device to receive the deployment.</span></span>

1. <span data-ttu-id="4696e-218">In the VS Code command palette, run **Azure IoT Hub: Select IoT Hub**.</span><span class="sxs-lookup"><span data-stu-id="4696e-218">In the VS Code command palette, run **Azure IoT Hub: Select IoT Hub**.</span></span> 

2. <span data-ttu-id="4696e-219">Choose the subscription and IoT hub that contain the IoT Edge device that you want to configure.</span><span class="sxs-lookup"><span data-stu-id="4696e-219">Choose the subscription and IoT hub that contain the IoT Edge device that you want to configure.</span></span> 

3. <span data-ttu-id="4696e-220">In the VS Code explorer, expand the **Azure IoT Hub Devices** section.</span><span class="sxs-lookup"><span data-stu-id="4696e-220">In the VS Code explorer, expand the **Azure IoT Hub Devices** section.</span></span> 

4. <span data-ttu-id="4696e-221">Right-click the name of your IoT Edge device, then select **Create Deployment for Single Device**.</span><span class="sxs-lookup"><span data-stu-id="4696e-221">Right-click the name of your IoT Edge device, then select **Create Deployment for Single Device**.</span></span> 

   ![Create deployment for single device](./media/tutorial-python-module/create-deployment.png)

5. <span data-ttu-id="4696e-223">Select the **deployment.json** file in the **config** folder and then click **Select Edge Deployment Manifest**.</span><span class="sxs-lookup"><span data-stu-id="4696e-223">Select the **deployment.json** file in the **config** folder and then click **Select Edge Deployment Manifest**.</span></span> <span data-ttu-id="4696e-224">Do not use the deployment.template.json file.</span><span class="sxs-lookup"><span data-stu-id="4696e-224">Do not use the deployment.template.json file.</span></span> 

6. <span data-ttu-id="4696e-225">Click the refresh button.</span><span class="sxs-lookup"><span data-stu-id="4696e-225">Click the refresh button.</span></span> <span data-ttu-id="4696e-226">You should see the new **PythonModule** running along with the **TempSensor** module and the **$edgeAgent** and **$edgeHub**.</span><span class="sxs-lookup"><span data-stu-id="4696e-226">You should see the new **PythonModule** running along with the **TempSensor** module and the **$edgeAgent** and **$edgeHub**.</span></span> 

## <a name="view-generated-data"></a><span data-ttu-id="4696e-227">View generated data</span><span class="sxs-lookup"><span data-stu-id="4696e-227">View generated data</span></span>

1. <span data-ttu-id="4696e-228">To monitor data that arrives at the IoT hub, select the ellipsis (**...**), and then select **Start Monitoring D2C Messages**.</span><span class="sxs-lookup"><span data-stu-id="4696e-228">To monitor data that arrives at the IoT hub, select the ellipsis (**...**), and then select **Start Monitoring D2C Messages**.</span></span>
2. <span data-ttu-id="4696e-229">To monitor the D2C message for a specific device, right-click the device in the list, and select **Start Monitoring D2C Messages**.</span><span class="sxs-lookup"><span data-stu-id="4696e-229">To monitor the D2C message for a specific device, right-click the device in the list, and select **Start Monitoring D2C Messages**.</span></span>
3. <span data-ttu-id="4696e-230">To stop monitoring data, run the command **Azure IoT Hub: Stop monitoring D2C message** in the command palette.</span><span class="sxs-lookup"><span data-stu-id="4696e-230">To stop monitoring data, run the command **Azure IoT Hub: Stop monitoring D2C message** in the command palette.</span></span> 
4. <span data-ttu-id="4696e-231">To view or update the module twin, right-click the module in the list, and select **Edit module twin**.</span><span class="sxs-lookup"><span data-stu-id="4696e-231">To view or update the module twin, right-click the module in the list, and select **Edit module twin**.</span></span> <span data-ttu-id="4696e-232">To update the module twin, save the twin JSON file, right-click the editor area, and select **Update Module Twin**.</span><span class="sxs-lookup"><span data-stu-id="4696e-232">To update the module twin, save the twin JSON file, right-click the editor area, and select **Update Module Twin**.</span></span>
5. <span data-ttu-id="4696e-233">To view Docker logs, install [Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker) for VS Code.</span><span class="sxs-lookup"><span data-stu-id="4696e-233">To view Docker logs, install [Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker) for VS Code.</span></span> <span data-ttu-id="4696e-234">You can find your running modules locally in Docker explorer.</span><span class="sxs-lookup"><span data-stu-id="4696e-234">You can find your running modules locally in Docker explorer.</span></span> <span data-ttu-id="4696e-235">In the context menu, click **Show Logs** to view in the integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="4696e-235">In the context menu, click **Show Logs** to view in the integrated terminal.</span></span> 

## <a name="clean-up-resources"></a><span data-ttu-id="4696e-236">Clean up resources</span><span class="sxs-lookup"><span data-stu-id="4696e-236">Clean up resources</span></span> 

<span data-ttu-id="4696e-237">If you plan to continue to the next recommended article, you can keep the resources and configurations that you created and reuse them.</span><span class="sxs-lookup"><span data-stu-id="4696e-237">If you plan to continue to the next recommended article, you can keep the resources and configurations that you created and reuse them.</span></span> <span data-ttu-id="4696e-238">You can also keep using the same IoT Edge device as a test device.</span><span class="sxs-lookup"><span data-stu-id="4696e-238">You can also keep using the same IoT Edge device as a test device.</span></span> 

<span data-ttu-id="4696e-239">Otherwise, you can delete the local configurations and the Azure resources that you created in this article to avoid charges.</span><span class="sxs-lookup"><span data-stu-id="4696e-239">Otherwise, you can delete the local configurations and the Azure resources that you created in this article to avoid charges.</span></span> 

[!INCLUDE [iot-edge-clean-up-cloud-resources](../../includes/iot-edge-clean-up-cloud-resources.md)]

### <a name="delete-local-resources"></a><span data-ttu-id="4696e-240">Delete local resources</span><span class="sxs-lookup"><span data-stu-id="4696e-240">Delete local resources</span></span>

<span data-ttu-id="4696e-241">If you want to remove the IoT Edge runtime and related resources from your device, use the following commands.</span><span class="sxs-lookup"><span data-stu-id="4696e-241">If you want to remove the IoT Edge runtime and related resources from your device, use the following commands.</span></span> 

<span data-ttu-id="4696e-242">Remove the IoT Edge runtime.</span><span class="sxs-lookup"><span data-stu-id="4696e-242">Remove the IoT Edge runtime.</span></span>

   ```bash
   sudo apt-get remove --purge iotedge
   ```

<span data-ttu-id="4696e-243">When the IoT Edge runtime is removed, the containers that it created are stopped, but still exist on your device.</span><span class="sxs-lookup"><span data-stu-id="4696e-243">When the IoT Edge runtime is removed, the containers that it created are stopped, but still exist on your device.</span></span> <span data-ttu-id="4696e-244">View all containers.</span><span class="sxs-lookup"><span data-stu-id="4696e-244">View all containers.</span></span>

   ```bash
   sudo docker ps -a
   ```

<span data-ttu-id="4696e-245">Delete the runtime containers that were created on your device.</span><span class="sxs-lookup"><span data-stu-id="4696e-245">Delete the runtime containers that were created on your device.</span></span>

   ```bash
   docker rm -f edgeHub
   docker rm -f edgeAgent
   ```

<span data-ttu-id="4696e-246">Delete any additional containers that were listed in the `docker ps` output by referring to the container names.</span><span class="sxs-lookup"><span data-stu-id="4696e-246">Delete any additional containers that were listed in the `docker ps` output by referring to the container names.</span></span> 

<span data-ttu-id="4696e-247">Remove the container runtime.</span><span class="sxs-lookup"><span data-stu-id="4696e-247">Remove the container runtime.</span></span>

   ```bash
   sudo apt-get remove --purge moby
   ```

## <a name="next-steps"></a><span data-ttu-id="4696e-248">Next steps</span><span class="sxs-lookup"><span data-stu-id="4696e-248">Next steps</span></span>

<span data-ttu-id="4696e-249">In this tutorial, you created an IoT Edge module with code to filter raw data that's generated by your IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="4696e-249">In this tutorial, you created an IoT Edge module with code to filter raw data that's generated by your IoT Edge device.</span></span> <span data-ttu-id="4696e-250">You can continue on to the next tutorials to learn other ways that Azure IoT Edge can help you turn data into business insights at the edge.</span><span class="sxs-lookup"><span data-stu-id="4696e-250">You can continue on to the next tutorials to learn other ways that Azure IoT Edge can help you turn data into business insights at the edge.</span></span>

> [!div class="nextstepaction"]
> <span data-ttu-id="4696e-251">[Deploy Azure functions as a module](tutorial-deploy-function.md)
> [Deploy Azure Stream Analytics as a module](tutorial-deploy-stream-analytics.md)</span><span class="sxs-lookup"><span data-stu-id="4696e-251">[Deploy Azure functions as a module](tutorial-deploy-function.md)
[Deploy Azure Stream Analytics as a module](tutorial-deploy-stream-analytics.md)</span></span>


<!-- Links -->
[lnk-quickstart-win]: quickstart.md
[lnk-quickstart-lin]: quickstart-linux.md

<!-- Images -->
[1]: ./media/tutorial-csharp-module/programcs.png
[2]: ./media/tutorial-csharp-module/build-module.png
[3]: ./media/tutorial-csharp-module/docker-os.png
