---
title: Azure IoT Edge Java tutorial | Microsoft Docs
description: This tutorial shows you how to create an IoT Edge module with Java code and deploy it to an edge device.
services: iot-edge
author: kgremban
manager: timlt
ms.author: kgremban
ms.date: 08/30/2018
ms.topic: tutorial
ms.service: iot-edge
ms.custom: mvc
ms.openlocfilehash: d4f3f97e8e3a56a389e377b1300ee99b3c7bfe8d
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44871547"
---
# <a name="tutorial-develop-a-java-iot-edge-module-and-deploy-to-your-simulated-device"></a><span data-ttu-id="2061c-103">Tutorial: Develop a Java IoT Edge module and deploy to your simulated device</span><span class="sxs-lookup"><span data-stu-id="2061c-103">Tutorial: Develop a Java IoT Edge module and deploy to your simulated device</span></span>

<span data-ttu-id="2061c-104">You can use Azure IoT Edge modules to deploy code that implements your business logic directly to your IoT Edge devices.</span><span class="sxs-lookup"><span data-stu-id="2061c-104">You can use Azure IoT Edge modules to deploy code that implements your business logic directly to your IoT Edge devices.</span></span> <span data-ttu-id="2061c-105">This tutorial walks you through creating and deploying an IoT Edge module that filters sensor data.</span><span class="sxs-lookup"><span data-stu-id="2061c-105">This tutorial walks you through creating and deploying an IoT Edge module that filters sensor data.</span></span> <span data-ttu-id="2061c-106">You'll use the simulated IoT Edge device that you created in the Deploy Azure IoT Edge on a simulated device in [Windows][lnk-tutorial1-win] or [Linux][lnk-tutorial1-lin] quickstarts.</span><span class="sxs-lookup"><span data-stu-id="2061c-106">You'll use the simulated IoT Edge device that you created in the Deploy Azure IoT Edge on a simulated device in [Windows][lnk-tutorial1-win] or [Linux][lnk-tutorial1-lin] quickstarts.</span></span> <span data-ttu-id="2061c-107">In this tutorial, you learn how to:</span><span class="sxs-lookup"><span data-stu-id="2061c-107">In this tutorial, you learn how to:</span></span>    

> [!div class="checklist"]
> * <span data-ttu-id="2061c-108">Use Visual Studio Code to create an IoT Edge Java module based on the Azure IoT Edge maven template package and Azure IoT Java device SDK.</span><span class="sxs-lookup"><span data-stu-id="2061c-108">Use Visual Studio Code to create an IoT Edge Java module based on the Azure IoT Edge maven template package and Azure IoT Java device SDK.</span></span>
> * <span data-ttu-id="2061c-109">Use Visual Studio Code and Docker to create a Docker image and publish it to your registry.</span><span class="sxs-lookup"><span data-stu-id="2061c-109">Use Visual Studio Code and Docker to create a Docker image and publish it to your registry.</span></span>
> * <span data-ttu-id="2061c-110">Deploy the module to your IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="2061c-110">Deploy the module to your IoT Edge device.</span></span>
> * <span data-ttu-id="2061c-111">View generated data.</span><span class="sxs-lookup"><span data-stu-id="2061c-111">View generated data.</span></span>


<span data-ttu-id="2061c-112">The IoT Edge module that you create in this tutorial filters the temperature data that's generated by your device.</span><span class="sxs-lookup"><span data-stu-id="2061c-112">The IoT Edge module that you create in this tutorial filters the temperature data that's generated by your device.</span></span> <span data-ttu-id="2061c-113">It only sends messages upstream if the temperature is above a specified threshold.</span><span class="sxs-lookup"><span data-stu-id="2061c-113">It only sends messages upstream if the temperature is above a specified threshold.</span></span> <span data-ttu-id="2061c-114">This type of analysis at the edge is useful for reducing the amount of data that's communicated to and stored in the cloud.</span><span class="sxs-lookup"><span data-stu-id="2061c-114">This type of analysis at the edge is useful for reducing the amount of data that's communicated to and stored in the cloud.</span></span> 

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]


## <a name="prerequisites"></a><span data-ttu-id="2061c-115">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="2061c-115">Prerequisites</span></span>

<span data-ttu-id="2061c-116">An Azure IoT Edge device:</span><span class="sxs-lookup"><span data-stu-id="2061c-116">An Azure IoT Edge device:</span></span>

* <span data-ttu-id="2061c-117">You can use your development machine or a virtual machine as an Edge device by following the steps in the quickstart for [Linux](quickstart-linux.md).</span><span class="sxs-lookup"><span data-stu-id="2061c-117">You can use your development machine or a virtual machine as an Edge device by following the steps in the quickstart for [Linux](quickstart-linux.md).</span></span>
* <span data-ttu-id="2061c-118">Java modules for IoT Edge don't support Windows devices.</span><span class="sxs-lookup"><span data-stu-id="2061c-118">Java modules for IoT Edge don't support Windows devices.</span></span>

<span data-ttu-id="2061c-119">Cloud resources:</span><span class="sxs-lookup"><span data-stu-id="2061c-119">Cloud resources:</span></span>

* <span data-ttu-id="2061c-120">A standard-tier [IoT Hub](../iot-hub/iot-hub-create-through-portal.md) in Azure.</span><span class="sxs-lookup"><span data-stu-id="2061c-120">A standard-tier [IoT Hub](../iot-hub/iot-hub-create-through-portal.md) in Azure.</span></span> 

<span data-ttu-id="2061c-121">Development resources:</span><span class="sxs-lookup"><span data-stu-id="2061c-121">Development resources:</span></span>

* <span data-ttu-id="2061c-122">[Visual Studio Code](https://code.visualstudio.com/).</span><span class="sxs-lookup"><span data-stu-id="2061c-122">[Visual Studio Code](https://code.visualstudio.com/).</span></span> 
* <span data-ttu-id="2061c-123">[Java Extension Pack](https://marketplace.visualstudio.com/items?itemName=vscjava.vscode-java-pack) for Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="2061c-123">[Java Extension Pack](https://marketplace.visualstudio.com/items?itemName=vscjava.vscode-java-pack) for Visual Studio Code.</span></span>
* <span data-ttu-id="2061c-124">[Azure IoT Edge extension](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge) for Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="2061c-124">[Azure IoT Edge extension](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge) for Visual Studio Code.</span></span> 
* <span data-ttu-id="2061c-125">[Java SE Development Kit 10](http://www.oracle.com/technetwork/java/javase/downloads/index.html), and [set the `JAVA_HOME` environment variable](https://docs.oracle.com/cd/E19182-01/820-7851/inst_cli_jdk_javahome_t/) to point to your JDK installation.</span><span class="sxs-lookup"><span data-stu-id="2061c-125">[Java SE Development Kit 10](http://www.oracle.com/technetwork/java/javase/downloads/index.html), and [set the `JAVA_HOME` environment variable](https://docs.oracle.com/cd/E19182-01/820-7851/inst_cli_jdk_javahome_t/) to point to your JDK installation.</span></span>
* [<span data-ttu-id="2061c-126">Maven</span><span class="sxs-lookup"><span data-stu-id="2061c-126">Maven</span></span>](https://maven.apache.org/)
* [<span data-ttu-id="2061c-127">Docker CE</span><span class="sxs-lookup"><span data-stu-id="2061c-127">Docker CE</span></span>](https://docs.docker.com/install/)
   * <span data-ttu-id="2061c-128">If you're developing on a Windows device, make sure Docker is [configured to use Linux containers](https://docs.docker.com/docker-for-windows/#switch-between-windows-and-linux-containers).</span><span class="sxs-lookup"><span data-stu-id="2061c-128">If you're developing on a Windows device, make sure Docker is [configured to use Linux containers](https://docs.docker.com/docker-for-windows/#switch-between-windows-and-linux-containers).</span></span> 


## <a name="create-a-container-registry"></a><span data-ttu-id="2061c-129">Create a container registry</span><span class="sxs-lookup"><span data-stu-id="2061c-129">Create a container registry</span></span>
<span data-ttu-id="2061c-130">In this tutorial, you use the Azure IoT Edge extension for VS Code to build a module and create a **container image** from the files.</span><span class="sxs-lookup"><span data-stu-id="2061c-130">In this tutorial, you use the Azure IoT Edge extension for VS Code to build a module and create a **container image** from the files.</span></span> <span data-ttu-id="2061c-131">Then you push this image to a **registry** that stores and manages your images.</span><span class="sxs-lookup"><span data-stu-id="2061c-131">Then you push this image to a **registry** that stores and manages your images.</span></span> <span data-ttu-id="2061c-132">Finally, you deploy your image from your registry to run on your IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="2061c-132">Finally, you deploy your image from your registry to run on your IoT Edge device.</span></span>  

<span data-ttu-id="2061c-133">You can use any Docker-compatible registry for this tutorial.</span><span class="sxs-lookup"><span data-stu-id="2061c-133">You can use any Docker-compatible registry for this tutorial.</span></span> <span data-ttu-id="2061c-134">Two popular Docker registry services that are available in the cloud are [Azure Container Registry](https://docs.microsoft.com/azure/container-registry/) and [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags).</span><span class="sxs-lookup"><span data-stu-id="2061c-134">Two popular Docker registry services that are available in the cloud are [Azure Container Registry](https://docs.microsoft.com/azure/container-registry/) and [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags).</span></span> <span data-ttu-id="2061c-135">This tutorial uses Azure Container Registry.</span><span class="sxs-lookup"><span data-stu-id="2061c-135">This tutorial uses Azure Container Registry.</span></span> 

1. <span data-ttu-id="2061c-136">In the [Azure portal](https://portal.azure.com), select **Create a resource** > **Containers** > **Azure Container Registry**.</span><span class="sxs-lookup"><span data-stu-id="2061c-136">In the [Azure portal](https://portal.azure.com), select **Create a resource** > **Containers** > **Azure Container Registry**.</span></span>
2. <span data-ttu-id="2061c-137">Give your registry a name, choose a subscription, choose a resource group, and set the SKU to **Basic**.</span><span class="sxs-lookup"><span data-stu-id="2061c-137">Give your registry a name, choose a subscription, choose a resource group, and set the SKU to **Basic**.</span></span> 
3. <span data-ttu-id="2061c-138">Select **Create**.</span><span class="sxs-lookup"><span data-stu-id="2061c-138">Select **Create**.</span></span>
4. <span data-ttu-id="2061c-139">After your container registry is created, browse to it, and select **Access keys**.</span><span class="sxs-lookup"><span data-stu-id="2061c-139">After your container registry is created, browse to it, and select **Access keys**.</span></span> 
5. <span data-ttu-id="2061c-140">Toggle **Admin user** to **Enable**.</span><span class="sxs-lookup"><span data-stu-id="2061c-140">Toggle **Admin user** to **Enable**.</span></span>
6. <span data-ttu-id="2061c-141">Copy the values for **Login server**, **Username**, and **Password**.</span><span class="sxs-lookup"><span data-stu-id="2061c-141">Copy the values for **Login server**, **Username**, and **Password**.</span></span> <span data-ttu-id="2061c-142">You use these values later in the tutorial to publish the Docker image to your registry and to add the registry credentials to the Azure IoT Edge runtime.</span><span class="sxs-lookup"><span data-stu-id="2061c-142">You use these values later in the tutorial to publish the Docker image to your registry and to add the registry credentials to the Azure IoT Edge runtime.</span></span> 

## <a name="create-an-iot-edge-module-project"></a><span data-ttu-id="2061c-143">Create an IoT Edge module project</span><span class="sxs-lookup"><span data-stu-id="2061c-143">Create an IoT Edge module project</span></span>
<span data-ttu-id="2061c-144">The following steps create an IoT Edge module project that's based on the Azure IoT Edge maven template package and Azure IoT Java device SDK by using Visual Studio Code and the Azure IoT Edge extension.</span><span class="sxs-lookup"><span data-stu-id="2061c-144">The following steps create an IoT Edge module project that's based on the Azure IoT Edge maven template package and Azure IoT Java device SDK by using Visual Studio Code and the Azure IoT Edge extension.</span></span>

### <a name="create-a-new-solution"></a><span data-ttu-id="2061c-145">Create a new solution</span><span class="sxs-lookup"><span data-stu-id="2061c-145">Create a new solution</span></span>

<span data-ttu-id="2061c-146">Create a Java solution template that you can customize with your own code.</span><span class="sxs-lookup"><span data-stu-id="2061c-146">Create a Java solution template that you can customize with your own code.</span></span> 

1. <span data-ttu-id="2061c-147">In Visual Studio Code, select **View** > **Command Palette** to open the VS Code command palette.</span><span class="sxs-lookup"><span data-stu-id="2061c-147">In Visual Studio Code, select **View** > **Command Palette** to open the VS Code command palette.</span></span> 

2. <span data-ttu-id="2061c-148">In the command palette, enter and run the command **Azure: Sign in** and follow the instructions to sign in your Azure account.</span><span class="sxs-lookup"><span data-stu-id="2061c-148">In the command palette, enter and run the command **Azure: Sign in** and follow the instructions to sign in your Azure account.</span></span> <span data-ttu-id="2061c-149">If you're already signed in, you can skip this step.</span><span class="sxs-lookup"><span data-stu-id="2061c-149">If you're already signed in, you can skip this step.</span></span>

3. <span data-ttu-id="2061c-150">In the command palette, enter and run the command **Azure IoT Edge: New IoT Edge solution**.</span><span class="sxs-lookup"><span data-stu-id="2061c-150">In the command palette, enter and run the command **Azure IoT Edge: New IoT Edge solution**.</span></span> <span data-ttu-id="2061c-151">In the command palette, provide the following information to create your solution:</span><span class="sxs-lookup"><span data-stu-id="2061c-151">In the command palette, provide the following information to create your solution:</span></span> 

   1. <span data-ttu-id="2061c-152">Select the folder where you want to create the solution.</span><span class="sxs-lookup"><span data-stu-id="2061c-152">Select the folder where you want to create the solution.</span></span> 
   2. <span data-ttu-id="2061c-153">Provide a name for your solution or accept the default **EdgeSolution**.</span><span class="sxs-lookup"><span data-stu-id="2061c-153">Provide a name for your solution or accept the default **EdgeSolution**.</span></span>
   3. <span data-ttu-id="2061c-154">Choose **Java Module** as the module template.</span><span class="sxs-lookup"><span data-stu-id="2061c-154">Choose **Java Module** as the module template.</span></span> 
   4. <span data-ttu-id="2061c-155">Provide a value for groupId or accept the default **com.edgemodule**.</span><span class="sxs-lookup"><span data-stu-id="2061c-155">Provide a value for groupId or accept the default **com.edgemodule**.</span></span>
   5. <span data-ttu-id="2061c-156">Replace the default module name with **JavaModule**.</span><span class="sxs-lookup"><span data-stu-id="2061c-156">Replace the default module name with **JavaModule**.</span></span> 
   6. <span data-ttu-id="2061c-157">Specify the Azure container registry that you created in the previous section as the image repository for your first module.</span><span class="sxs-lookup"><span data-stu-id="2061c-157">Specify the Azure container registry that you created in the previous section as the image repository for your first module.</span></span> <span data-ttu-id="2061c-158">Replace **localhost:5000** with the login server value that you copied.</span><span class="sxs-lookup"><span data-stu-id="2061c-158">Replace **localhost:5000** with the login server value that you copied.</span></span> <span data-ttu-id="2061c-159">The final string looks like \<registry name\>.azurecr.io/javamodule.</span><span class="sxs-lookup"><span data-stu-id="2061c-159">The final string looks like \<registry name\>.azurecr.io/javamodule.</span></span>


<span data-ttu-id="2061c-160">If it's the first time to create Java module, it might take several minutes to download maven packages.</span><span class="sxs-lookup"><span data-stu-id="2061c-160">If it's the first time to create Java module, it might take several minutes to download maven packages.</span></span> <span data-ttu-id="2061c-161">Then the VS Code window loads your IoT Edge solution workspace.</span><span class="sxs-lookup"><span data-stu-id="2061c-161">Then the VS Code window loads your IoT Edge solution workspace.</span></span> <span data-ttu-id="2061c-162">The solution workspace contains five top-level components.</span><span class="sxs-lookup"><span data-stu-id="2061c-162">The solution workspace contains five top-level components.</span></span> <span data-ttu-id="2061c-163">You won't edit the **\.vscode** folder or **\.gitignore** file in this tutorial.</span><span class="sxs-lookup"><span data-stu-id="2061c-163">You won't edit the **\.vscode** folder or **\.gitignore** file in this tutorial.</span></span> <span data-ttu-id="2061c-164">The **modules** folder contains the Java code for your module as well as Dockerfiles for building your module as a container image.</span><span class="sxs-lookup"><span data-stu-id="2061c-164">The **modules** folder contains the Java code for your module as well as Dockerfiles for building your module as a container image.</span></span> <span data-ttu-id="2061c-165">The **\.env** file stores your container registry credentials.</span><span class="sxs-lookup"><span data-stu-id="2061c-165">The **\.env** file stores your container registry credentials.</span></span> <span data-ttu-id="2061c-166">The **deployment.template.json** file contains the information that the IoT Edge runtime uses to deploy modules on a device.</span><span class="sxs-lookup"><span data-stu-id="2061c-166">The **deployment.template.json** file contains the information that the IoT Edge runtime uses to deploy modules on a device.</span></span> 

<span data-ttu-id="2061c-167">If you didn't specify a container registry when creating your solution, but accepted the default localhost:5000 value, you won't have a \.env file.</span><span class="sxs-lookup"><span data-stu-id="2061c-167">If you didn't specify a container registry when creating your solution, but accepted the default localhost:5000 value, you won't have a \.env file.</span></span> 

### <a name="add-your-registry-credentials"></a><span data-ttu-id="2061c-168">Add your registry credentials</span><span class="sxs-lookup"><span data-stu-id="2061c-168">Add your registry credentials</span></span>

<span data-ttu-id="2061c-169">The environment file stores the credentials for your container registry and shares them with the IoT Edge runtime.</span><span class="sxs-lookup"><span data-stu-id="2061c-169">The environment file stores the credentials for your container registry and shares them with the IoT Edge runtime.</span></span> <span data-ttu-id="2061c-170">The runtime needs these credentials to pull your private images onto the IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="2061c-170">The runtime needs these credentials to pull your private images onto the IoT Edge device.</span></span> 

1. <span data-ttu-id="2061c-171">In the VS Code explorer, open the .env file.</span><span class="sxs-lookup"><span data-stu-id="2061c-171">In the VS Code explorer, open the .env file.</span></span> 
2. <span data-ttu-id="2061c-172">Update the fields with the **username** and **password** values that you copied from your Azure container registry.</span><span class="sxs-lookup"><span data-stu-id="2061c-172">Update the fields with the **username** and **password** values that you copied from your Azure container registry.</span></span> 
3. <span data-ttu-id="2061c-173">Save this file.</span><span class="sxs-lookup"><span data-stu-id="2061c-173">Save this file.</span></span> 

### <a name="update-the-module-with-custom-code"></a><span data-ttu-id="2061c-174">Update the module with custom code</span><span class="sxs-lookup"><span data-stu-id="2061c-174">Update the module with custom code</span></span>

1. <span data-ttu-id="2061c-175">In the VS Code explorer, open **modules** > **JavaModule** > **src** > **main** > **java** > **com** > **edgemodule** > **App.java**.</span><span class="sxs-lookup"><span data-stu-id="2061c-175">In the VS Code explorer, open **modules** > **JavaModule** > **src** > **main** > **java** > **com** > **edgemodule** > **App.java**.</span></span>

5. <span data-ttu-id="2061c-176">Add the following code at the top of the file to import new referenced classes.</span><span class="sxs-lookup"><span data-stu-id="2061c-176">Add the following code at the top of the file to import new referenced classes.</span></span>

    ```java
    import java.io.StringReader;
    import java.util.concurrent.atomic.AtomicLong;
    import java.util.HashMap;
    import java.util.Map;
    
    import javax.json.Json;
    import javax.json.JsonObject;
    import javax.json.JsonReader;
    
    import com.microsoft.azure.sdk.iot.device.DeviceTwin.Pair;
    import com.microsoft.azure.sdk.iot.device.DeviceTwin.Property;
    import com.microsoft.azure.sdk.iot.device.DeviceTwin.TwinPropertyCallBack;
    ```

5. <span data-ttu-id="2061c-177">Add the following definition into class **App**.</span><span class="sxs-lookup"><span data-stu-id="2061c-177">Add the following definition into class **App**.</span></span> <span data-ttu-id="2061c-178">This variable sets the value that the measured temperature must exceed for the data to be sent to the IoT hub.</span><span class="sxs-lookup"><span data-stu-id="2061c-178">This variable sets the value that the measured temperature must exceed for the data to be sent to the IoT hub.</span></span> 

    ```java
    private static final String TEMP_THRESHOLD = "TemperatureThreshold";
    private static AtomicLong tempThreshold = new AtomicLong(25);
    ```

7. <span data-ttu-id="2061c-179">Replace the execute method of **MessageCallbackMqtt** with the following code.</span><span class="sxs-lookup"><span data-stu-id="2061c-179">Replace the execute method of **MessageCallbackMqtt** with the following code.</span></span> <span data-ttu-id="2061c-180">This method is called whenever the module receives an MQTT message from the IoT Edge hub.</span><span class="sxs-lookup"><span data-stu-id="2061c-180">This method is called whenever the module receives an MQTT message from the IoT Edge hub.</span></span> <span data-ttu-id="2061c-181">It filters out messages that report temperatures below the temperature threshold set via the module twin.</span><span class="sxs-lookup"><span data-stu-id="2061c-181">It filters out messages that report temperatures below the temperature threshold set via the module twin.</span></span>

    ```java
        private int counter = 0;
       @Override
        public IotHubMessageResult execute(Message msg, Object context) {
            this.counter += 1;
 
            String msgString = new String(msg.getBytes(), Message.DEFAULT_IOTHUB_MESSAGE_CHARSET);
            System.out.println(
                   String.format("Received message %d: %s",
                            this.counter, msgString));
            if (context instanceof ModuleClient) {
                try (JsonReader jsonReader = Json.createReader(new StringReader(msgString))) {
                    final JsonObject msgObject = jsonReader.readObject();
                    double temperature = msgObject.getJsonObject("machine").getJsonNumber("temperature").doubleValue();
                    long threshold = App.tempThreshold.get();
                    if (temperature >= threshold) {
                        ModuleClient client = (ModuleClient) context;
                        System.out.println(
                            String.format("Temperature above threshold %d. Sending message: %s",
                            threshold, msgString));
                        client.sendEventAsync(msg, eventCallback, msg, App.OUTPUT_NAME);
                    }
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
            return IotHubMessageResult.COMPLETE;
        }
    ```

8. <span data-ttu-id="2061c-182">Add the following two static inner classes into class **App**.</span><span class="sxs-lookup"><span data-stu-id="2061c-182">Add the following two static inner classes into class **App**.</span></span> <span data-ttu-id="2061c-183">These classes receive updates on the desired properties from the module twin, and updates the **tempThreshold** variable to match.</span><span class="sxs-lookup"><span data-stu-id="2061c-183">These classes receive updates on the desired properties from the module twin, and updates the **tempThreshold** variable to match.</span></span> <span data-ttu-id="2061c-184">All modules have their own module twin, which lets you configure the code that's running inside a module directly from the cloud.</span><span class="sxs-lookup"><span data-stu-id="2061c-184">All modules have their own module twin, which lets you configure the code that's running inside a module directly from the cloud.</span></span>

    ```java
    protected static class DeviceTwinStatusCallBack implements IotHubEventCallback {
        @Override
        public void execute(IotHubStatusCode status, Object context) {
            System.out.println("IoT Hub responded to device twin operation with status " + status.name());
        }
    }
 
    protected static class OnProperty implements TwinPropertyCallBack {
        @Override
        public void TwinPropertyCallBack(Property property, Object context) {
            if (!property.getIsReported()) {
                if (property.getKey().equals(App.TEMP_THRESHOLD)) {
                    try {
                        long threshold = Math.round((double) property.getValue());
                        App.tempThreshold.set(threshold);
                    } catch (Exception e) {
                        System.out.println("Faile to set TemperatureThread with exception");
                        e.printStackTrace();
                    }
                }
            }
        }
    }
    ```

9. <span data-ttu-id="2061c-185">Add the following lines in to **main** method after **client.open()** to subscribe the module twin updates.</span><span class="sxs-lookup"><span data-stu-id="2061c-185">Add the following lines in to **main** method after **client.open()** to subscribe the module twin updates.</span></span>

    ```java
    client.startTwin(new DeviceTwinStatusCallBack(), null, new OnProperty(), null);
    Map<Property, Pair<TwinPropertyCallBack, Object>> onDesiredPropertyChange = new HashMap<Property, Pair<TwinPropertyCallBack, Object>>() {
        {
            put(new Property(App.TEMP_THRESHOLD, null), new Pair<TwinPropertyCallBack, Object>(new OnProperty(), null));
        }
    };
    client.subscribeToTwinDesiredProperties(onDesiredPropertyChange);
    client.getTwin();
    ```

11. <span data-ttu-id="2061c-186">Save this file.</span><span class="sxs-lookup"><span data-stu-id="2061c-186">Save this file.</span></span>

## <a name="build-your-iot-edge-solution"></a><span data-ttu-id="2061c-187">Build your IoT Edge solution</span><span class="sxs-lookup"><span data-stu-id="2061c-187">Build your IoT Edge solution</span></span>

<span data-ttu-id="2061c-188">In the previous section, you created an IoT Edge solution and added code to the **JavaModule** to filter out messages where the reported machine temperature is below the acceptable threshold.</span><span class="sxs-lookup"><span data-stu-id="2061c-188">In the previous section, you created an IoT Edge solution and added code to the **JavaModule** to filter out messages where the reported machine temperature is below the acceptable threshold.</span></span> <span data-ttu-id="2061c-189">Now you need to build the solution as a container image and push it to your container registry.</span><span class="sxs-lookup"><span data-stu-id="2061c-189">Now you need to build the solution as a container image and push it to your container registry.</span></span> 

1. <span data-ttu-id="2061c-190">Sign in to Docker by entering the following command in the Visual Studio Code integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="2061c-190">Sign in to Docker by entering the following command in the Visual Studio Code integrated terminal.</span></span> <span data-ttu-id="2061c-191">Then you can push your module image to your Azure container registry.</span><span class="sxs-lookup"><span data-stu-id="2061c-191">Then you can push your module image to your Azure container registry.</span></span>
     
   ```csh/sh
   docker login -u <ACR username> -p <ACR password> <ACR login server>
   ```
   <span data-ttu-id="2061c-192">Use the username, password, and login server that you copied from your Azure container registry in the first section.</span><span class="sxs-lookup"><span data-stu-id="2061c-192">Use the username, password, and login server that you copied from your Azure container registry in the first section.</span></span> <span data-ttu-id="2061c-193">You can also retrieve these values from the **Access keys** section of your registry in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="2061c-193">You can also retrieve these values from the **Access keys** section of your registry in the Azure portal.</span></span>

2. <span data-ttu-id="2061c-194">In the VS Code explorer, open the deployment.template.json file in your IoT Edge solution workspace.</span><span class="sxs-lookup"><span data-stu-id="2061c-194">In the VS Code explorer, open the deployment.template.json file in your IoT Edge solution workspace.</span></span> <span data-ttu-id="2061c-195">This file tells the **$edgeAgent** to deploy two modules: **tempSensor** and **JavaModule**.</span><span class="sxs-lookup"><span data-stu-id="2061c-195">This file tells the **$edgeAgent** to deploy two modules: **tempSensor** and **JavaModule**.</span></span> <span data-ttu-id="2061c-196">The **JavaModule.image** value is set to a Linux amd64 version of the image.</span><span class="sxs-lookup"><span data-stu-id="2061c-196">The **JavaModule.image** value is set to a Linux amd64 version of the image.</span></span> <span data-ttu-id="2061c-197">Change the image version to **arm32v7** if that is your IoT Edge device's architecture.</span><span class="sxs-lookup"><span data-stu-id="2061c-197">Change the image version to **arm32v7** if that is your IoT Edge device's architecture.</span></span> 

   <span data-ttu-id="2061c-198">Verify that the template has the correct module name, not the default **SampleModule** name that you changed when you created the IoT Edge solution.</span><span class="sxs-lookup"><span data-stu-id="2061c-198">Verify that the template has the correct module name, not the default **SampleModule** name that you changed when you created the IoT Edge solution.</span></span>

   <span data-ttu-id="2061c-199">To learn more about deployment manifests, see [Understand how IoT Edge modules can be used, configured, and reused](module-composition.md).</span><span class="sxs-lookup"><span data-stu-id="2061c-199">To learn more about deployment manifests, see [Understand how IoT Edge modules can be used, configured, and reused](module-composition.md).</span></span>

3. <span data-ttu-id="2061c-200">In the deployment.template.json file, the **registryCredentials** section stores your Docker registry credentials.</span><span class="sxs-lookup"><span data-stu-id="2061c-200">In the deployment.template.json file, the **registryCredentials** section stores your Docker registry credentials.</span></span> <span data-ttu-id="2061c-201">The actual username and password pairs are stored in the .env file, which is ignored by git.</span><span class="sxs-lookup"><span data-stu-id="2061c-201">The actual username and password pairs are stored in the .env file, which is ignored by git.</span></span>  

4. <span data-ttu-id="2061c-202">Add the **JavaModule** module twin to the deployment manifest.</span><span class="sxs-lookup"><span data-stu-id="2061c-202">Add the **JavaModule** module twin to the deployment manifest.</span></span> <span data-ttu-id="2061c-203">Insert the following JSON content at the bottom of the **moduleContent** section, after the **$edgeHub** module twin:</span><span class="sxs-lookup"><span data-stu-id="2061c-203">Insert the following JSON content at the bottom of the **moduleContent** section, after the **$edgeHub** module twin:</span></span> 
    ```json
        "JavaModule": {
            "properties.desired":{
                "TemperatureThreshold":25
            }
        }
    ```

4. <span data-ttu-id="2061c-204">Save this file.</span><span class="sxs-lookup"><span data-stu-id="2061c-204">Save this file.</span></span>

5. <span data-ttu-id="2061c-205">In the VS Code explorer, right-click the deployment.template.json file and select **Build and Push IoT Edge solution**.</span><span class="sxs-lookup"><span data-stu-id="2061c-205">In the VS Code explorer, right-click the deployment.template.json file and select **Build and Push IoT Edge solution**.</span></span> 

<span data-ttu-id="2061c-206">When you tell Visual Studio Code to build your solution, it first takes the information in the deployment template and generates a deployment.json file in a new folder named **config**. Then, it runs two commands in the integrated terminal: `docker build` and `docker push`.</span><span class="sxs-lookup"><span data-stu-id="2061c-206">When you tell Visual Studio Code to build your solution, it first takes the information in the deployment template and generates a deployment.json file in a new folder named **config**. Then, it runs two commands in the integrated terminal: `docker build` and `docker push`.</span></span> <span data-ttu-id="2061c-207">These two commands build your code, containerize the Java app, and then push the code to the container registry that you specified when you initialized the solution.</span><span class="sxs-lookup"><span data-stu-id="2061c-207">These two commands build your code, containerize the Java app, and then push the code to the container registry that you specified when you initialized the solution.</span></span> 

<span data-ttu-id="2061c-208">You can see the full container image address with tag in the VS Code integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="2061c-208">You can see the full container image address with tag in the VS Code integrated terminal.</span></span> <span data-ttu-id="2061c-209">The image address is built from information that's in the module.json file with the format \<repository\>:\<version\>-\<platform\>.</span><span class="sxs-lookup"><span data-stu-id="2061c-209">The image address is built from information that's in the module.json file with the format \<repository\>:\<version\>-\<platform\>.</span></span> <span data-ttu-id="2061c-210">For this tutorial, it should look like registryname.azurecr.io/javamodule:0.0.1-amd64.</span><span class="sxs-lookup"><span data-stu-id="2061c-210">For this tutorial, it should look like registryname.azurecr.io/javamodule:0.0.1-amd64.</span></span>

## <a name="deploy-and-run-the-solution"></a><span data-ttu-id="2061c-211">Deploy and run the solution</span><span class="sxs-lookup"><span data-stu-id="2061c-211">Deploy and run the solution</span></span>

<span data-ttu-id="2061c-212">In the quickstart article that you used to set up your IoT Edge device, you deployed a module by using the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="2061c-212">In the quickstart article that you used to set up your IoT Edge device, you deployed a module by using the Azure portal.</span></span> <span data-ttu-id="2061c-213">You can also deploy modules using the Azure IoT Toolkit extension for Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="2061c-213">You can also deploy modules using the Azure IoT Toolkit extension for Visual Studio Code.</span></span> <span data-ttu-id="2061c-214">You already have a deployment manifest prepared for your scenario, the **deployment.json** file.</span><span class="sxs-lookup"><span data-stu-id="2061c-214">You already have a deployment manifest prepared for your scenario, the **deployment.json** file.</span></span> <span data-ttu-id="2061c-215">All you need to do now is select a device to receive the deployment.</span><span class="sxs-lookup"><span data-stu-id="2061c-215">All you need to do now is select a device to receive the deployment.</span></span>

1. <span data-ttu-id="2061c-216">In the VS Code command palette, run **Azure IoT Hub: Select IoT Hub**.</span><span class="sxs-lookup"><span data-stu-id="2061c-216">In the VS Code command palette, run **Azure IoT Hub: Select IoT Hub**.</span></span> 

2. <span data-ttu-id="2061c-217">Choose the subscription and IoT hub that contain the IoT Edge device that you want to configure.</span><span class="sxs-lookup"><span data-stu-id="2061c-217">Choose the subscription and IoT hub that contain the IoT Edge device that you want to configure.</span></span> 

3. <span data-ttu-id="2061c-218">In the VS Code explorer, expand the **Azure IoT Hub Devices** section.</span><span class="sxs-lookup"><span data-stu-id="2061c-218">In the VS Code explorer, expand the **Azure IoT Hub Devices** section.</span></span> 

4. <span data-ttu-id="2061c-219">Right-click the name of your IoT Edge device, then select **Create Deployment for Single Device**.</span><span class="sxs-lookup"><span data-stu-id="2061c-219">Right-click the name of your IoT Edge device, then select **Create Deployment for Single Device**.</span></span> 

   ![Create deployment for single device](./media/tutorial-java-module/create-deployment.png)

5. <span data-ttu-id="2061c-221">Select the **deployment.json** file in the **config** folder and then click **Select Edge Deployment Manifest**.</span><span class="sxs-lookup"><span data-stu-id="2061c-221">Select the **deployment.json** file in the **config** folder and then click **Select Edge Deployment Manifest**.</span></span> <span data-ttu-id="2061c-222">Do not use the deployment.template.json file.</span><span class="sxs-lookup"><span data-stu-id="2061c-222">Do not use the deployment.template.json file.</span></span> 

6. <span data-ttu-id="2061c-223">Click the refresh button.</span><span class="sxs-lookup"><span data-stu-id="2061c-223">Click the refresh button.</span></span> <span data-ttu-id="2061c-224">You should see the new **JavaModule** running along with the **TempSensor** module and the **$edgeAgent** and **$edgeHub**.</span><span class="sxs-lookup"><span data-stu-id="2061c-224">You should see the new **JavaModule** running along with the **TempSensor** module and the **$edgeAgent** and **$edgeHub**.</span></span>  

## <a name="view-generated-data"></a><span data-ttu-id="2061c-225">View generated data</span><span class="sxs-lookup"><span data-stu-id="2061c-225">View generated data</span></span>

1. <span data-ttu-id="2061c-226">To monitor data that arrives at the IoT hub, select the ellipsis (**...**), and then select **Start Monitoring D2C Messages**.</span><span class="sxs-lookup"><span data-stu-id="2061c-226">To monitor data that arrives at the IoT hub, select the ellipsis (**...**), and then select **Start Monitoring D2C Messages**.</span></span>
2. <span data-ttu-id="2061c-227">To monitor the D2C message for a specific device, right-click the device in the list, and select **Start Monitoring D2C Messages**.</span><span class="sxs-lookup"><span data-stu-id="2061c-227">To monitor the D2C message for a specific device, right-click the device in the list, and select **Start Monitoring D2C Messages**.</span></span>
3. <span data-ttu-id="2061c-228">To stop monitoring data, run the command **Azure IoT Hub: Stop monitoring D2C message** in the command palette.</span><span class="sxs-lookup"><span data-stu-id="2061c-228">To stop monitoring data, run the command **Azure IoT Hub: Stop monitoring D2C message** in the command palette.</span></span> 
4. <span data-ttu-id="2061c-229">To view or update the module twin, right-click the module in the list, and select **Edit module twin**.</span><span class="sxs-lookup"><span data-stu-id="2061c-229">To view or update the module twin, right-click the module in the list, and select **Edit module twin**.</span></span> <span data-ttu-id="2061c-230">To update the module twin, save the twin JSON file, right-click the editor area, and select **Update Module Twin**.</span><span class="sxs-lookup"><span data-stu-id="2061c-230">To update the module twin, save the twin JSON file, right-click the editor area, and select **Update Module Twin**.</span></span>
5. <span data-ttu-id="2061c-231">To view Docker logs, install [Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker) for VS Code.</span><span class="sxs-lookup"><span data-stu-id="2061c-231">To view Docker logs, install [Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker) for VS Code.</span></span> <span data-ttu-id="2061c-232">You can find your running modules locally in Docker explorer.</span><span class="sxs-lookup"><span data-stu-id="2061c-232">You can find your running modules locally in Docker explorer.</span></span> <span data-ttu-id="2061c-233">In the context menu, select **Show Logs** to view in the integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="2061c-233">In the context menu, select **Show Logs** to view in the integrated terminal.</span></span>
 
## <a name="clean-up-resources"></a><span data-ttu-id="2061c-234">Clean up resources</span><span class="sxs-lookup"><span data-stu-id="2061c-234">Clean up resources</span></span> 

<span data-ttu-id="2061c-235">If you plan to continue to the next recommended article, you can keep the resources and configurations that you created and reuse them.</span><span class="sxs-lookup"><span data-stu-id="2061c-235">If you plan to continue to the next recommended article, you can keep the resources and configurations that you created and reuse them.</span></span> <span data-ttu-id="2061c-236">You can also keep using the same IoT Edge device as a test device.</span><span class="sxs-lookup"><span data-stu-id="2061c-236">You can also keep using the same IoT Edge device as a test device.</span></span> 

<span data-ttu-id="2061c-237">Otherwise, you can delete the local configurations and the Azure resources that you created in this article to avoid charges.</span><span class="sxs-lookup"><span data-stu-id="2061c-237">Otherwise, you can delete the local configurations and the Azure resources that you created in this article to avoid charges.</span></span> 

[!INCLUDE [iot-edge-clean-up-cloud-resources](../../includes/iot-edge-clean-up-cloud-resources.md)]

[!INCLUDE [iot-edge-clean-up-local-resources](../../includes/iot-edge-clean-up-local-resources.md)]


## <a name="next-steps"></a><span data-ttu-id="2061c-238">Next steps</span><span class="sxs-lookup"><span data-stu-id="2061c-238">Next steps</span></span>

<span data-ttu-id="2061c-239">In this tutorial, you created an IoT Edge module with code to filter raw data that's generated by your IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="2061c-239">In this tutorial, you created an IoT Edge module with code to filter raw data that's generated by your IoT Edge device.</span></span> <span data-ttu-id="2061c-240">You can continue on to the next tutorials to learn other ways that Azure IoT Edge can help you turn data into business insights at the edge.</span><span class="sxs-lookup"><span data-stu-id="2061c-240">You can continue on to the next tutorials to learn other ways that Azure IoT Edge can help you turn data into business insights at the edge.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="2061c-241">Store data at the edge with SQL Server databases</span><span class="sxs-lookup"><span data-stu-id="2061c-241">Store data at the edge with SQL Server databases</span></span>](tutorial-store-data-sql-server.md)

<!-- Links -->
[lnk-tutorial1-win]: quickstart.md
[lnk-tutorial1-lin]: quickstart-linux.md

<!-- Images -->
[1]: ./media/tutorial-csharp-module/programcs.png
[2]: ./media/tutorial-csharp-module/build-module.png
[3]: ./media/tutorial-csharp-module/docker-os.png
