---
title: Debug C modules for Azure IoT Edge | Microsoft Docs
description: Use Visual Studio Code to develop, build, and debug a C module for Azure IoT Edge
services: iot-edge
keywords: ''
author: shizn
manager: timlt
ms.author: xshi
ms.date: 07/20/2018
ms.topic: article
ms.service: iot-edge
ms.openlocfilehash: 5732f6986750dfee49084e2744052bb54e3a8139
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44868630"
---
# <a name="use-visual-studio-code-to-develop-and-debug-c-modules-for-azure-iot-edge"></a><span data-ttu-id="daddc-103">Use Visual Studio Code to develop and debug C modules for Azure IoT Edge</span><span class="sxs-lookup"><span data-stu-id="daddc-103">Use Visual Studio Code to develop and debug C modules for Azure IoT Edge</span></span>

<span data-ttu-id="daddc-104">You can turn your business logic into modules for Azure IoT Edge.</span><span class="sxs-lookup"><span data-stu-id="daddc-104">You can turn your business logic into modules for Azure IoT Edge.</span></span> <span data-ttu-id="daddc-105">This article shows you how to use Visual Studio Code (VS Code) as the main tool to develop and debug C modules.</span><span class="sxs-lookup"><span data-stu-id="daddc-105">This article shows you how to use Visual Studio Code (VS Code) as the main tool to develop and debug C modules.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="daddc-106">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="daddc-106">Prerequisites</span></span>
<span data-ttu-id="daddc-107">This article assumes that you use a computer or virtual machine running Windows or Linux as your development machine.</span><span class="sxs-lookup"><span data-stu-id="daddc-107">This article assumes that you use a computer or virtual machine running Windows or Linux as your development machine.</span></span> <span data-ttu-id="daddc-108">And you simulate your IoT Edge device on your development machine.</span><span class="sxs-lookup"><span data-stu-id="daddc-108">And you simulate your IoT Edge device on your development machine.</span></span>

> [!NOTE]
> <span data-ttu-id="daddc-109">This debugging article demonstrates how to attach a process in a module container and debug it with VS Code.</span><span class="sxs-lookup"><span data-stu-id="daddc-109">This debugging article demonstrates how to attach a process in a module container and debug it with VS Code.</span></span> <span data-ttu-id="daddc-110">You can only debug C modules in Linux amd64 containers.</span><span class="sxs-lookup"><span data-stu-id="daddc-110">You can only debug C modules in Linux amd64 containers.</span></span> <span data-ttu-id="daddc-111">If you aren't familiar with the debugging capabilities of Visual Studio Code, read about [Debugging](https://code.visualstudio.com/Docs/editor/debugging).</span><span class="sxs-lookup"><span data-stu-id="daddc-111">If you aren't familiar with the debugging capabilities of Visual Studio Code, read about [Debugging](https://code.visualstudio.com/Docs/editor/debugging).</span></span> 

<span data-ttu-id="daddc-112">Because this article uses Visual Studio Code as the main development tool, install VS Code.</span><span class="sxs-lookup"><span data-stu-id="daddc-112">Because this article uses Visual Studio Code as the main development tool, install VS Code.</span></span> <span data-ttu-id="daddc-113">Then add the necessary extensions:</span><span class="sxs-lookup"><span data-stu-id="daddc-113">Then add the necessary extensions:</span></span>
* [<span data-ttu-id="daddc-114">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="daddc-114">Visual Studio Code</span></span>](https://code.visualstudio.com/) 
* [<span data-ttu-id="daddc-115">Azure IoT Edge extension</span><span class="sxs-lookup"><span data-stu-id="daddc-115">Azure IoT Edge extension</span></span>](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge) 
* <span data-ttu-id="daddc-116">[C/C++ extension](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools) for Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="daddc-116">[C/C++ extension](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools) for Visual Studio Code.</span></span>
* [<span data-ttu-id="daddc-117">Docker extension</span><span class="sxs-lookup"><span data-stu-id="daddc-117">Docker extension</span></span>](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker)

<span data-ttu-id="daddc-118">To create a module, you need Docker to build the module image, and a container registry to hold the module image:</span><span class="sxs-lookup"><span data-stu-id="daddc-118">To create a module, you need Docker to build the module image, and a container registry to hold the module image:</span></span>
* <span data-ttu-id="daddc-119">[Docker Community Edition](https://docs.docker.com/install/) on your development machine.</span><span class="sxs-lookup"><span data-stu-id="daddc-119">[Docker Community Edition](https://docs.docker.com/install/) on your development machine.</span></span> 
* <span data-ttu-id="daddc-120">[Azure Container Registry](https://docs.microsoft.com/azure/container-registry/) or [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags)</span><span class="sxs-lookup"><span data-stu-id="daddc-120">[Azure Container Registry](https://docs.microsoft.com/azure/container-registry/) or [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags)</span></span>
   * <span data-ttu-id="daddc-121">You can use a local Docker registry for prototype and testing purposes instead of a cloud registry.</span><span class="sxs-lookup"><span data-stu-id="daddc-121">You can use a local Docker registry for prototype and testing purposes instead of a cloud registry.</span></span> 

<span data-ttu-id="daddc-122">To test your module on a device, you need an active IoT hub with at least one IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="daddc-122">To test your module on a device, you need an active IoT hub with at least one IoT Edge device.</span></span> <span data-ttu-id="daddc-123">To use your computer as an IoT Edge device, follow the steps in the quickstart for [Windows](quickstart.md) or [Linux](quickstart-linux.md).</span><span class="sxs-lookup"><span data-stu-id="daddc-123">To use your computer as an IoT Edge device, follow the steps in the quickstart for [Windows](quickstart.md) or [Linux](quickstart-linux.md).</span></span> 

## <a name="create-a-new-solution-template"></a><span data-ttu-id="daddc-124">Create a new solution template</span><span class="sxs-lookup"><span data-stu-id="daddc-124">Create a new solution template</span></span>

<span data-ttu-id="daddc-125">Take these steps to create an IoT Edge module based on Azure IoT C SDK using Visual Studio Code and the Azure IoT Edge extension.</span><span class="sxs-lookup"><span data-stu-id="daddc-125">Take these steps to create an IoT Edge module based on Azure IoT C SDK using Visual Studio Code and the Azure IoT Edge extension.</span></span> <span data-ttu-id="daddc-126">First you create a solution, and then you generate the first module in that solution.</span><span class="sxs-lookup"><span data-stu-id="daddc-126">First you create a solution, and then you generate the first module in that solution.</span></span> <span data-ttu-id="daddc-127">Each solution can contain more than one module.</span><span class="sxs-lookup"><span data-stu-id="daddc-127">Each solution can contain more than one module.</span></span> 

1. <span data-ttu-id="daddc-128">In Visual Studio Code, select **View** > **Integrated Terminal**.</span><span class="sxs-lookup"><span data-stu-id="daddc-128">In Visual Studio Code, select **View** > **Integrated Terminal**.</span></span>

2. <span data-ttu-id="daddc-129">Select **View** > **Command Palette**.</span><span class="sxs-lookup"><span data-stu-id="daddc-129">Select **View** > **Command Palette**.</span></span> 

3. <span data-ttu-id="daddc-130">In the command palette, enter and run the command **Azure IoT Edge: New IoT Edge Solution**.</span><span class="sxs-lookup"><span data-stu-id="daddc-130">In the command palette, enter and run the command **Azure IoT Edge: New IoT Edge Solution**.</span></span>

   ![Run New IoT Edge Solution](./media/how-to-develop-csharp-module/new-solution.png)

4. <span data-ttu-id="daddc-132">Browse to the folder where you want to create the new solution.</span><span class="sxs-lookup"><span data-stu-id="daddc-132">Browse to the folder where you want to create the new solution.</span></span> <span data-ttu-id="daddc-133">Choose **Select folder**.</span><span class="sxs-lookup"><span data-stu-id="daddc-133">Choose **Select folder**.</span></span> 

5. <span data-ttu-id="daddc-134">Enter a name for your solution.</span><span class="sxs-lookup"><span data-stu-id="daddc-134">Enter a name for your solution.</span></span> 

6. <span data-ttu-id="daddc-135">Select **C Module** as the template for the first module in the solution.</span><span class="sxs-lookup"><span data-stu-id="daddc-135">Select **C Module** as the template for the first module in the solution.</span></span>

7. <span data-ttu-id="daddc-136">Enter a name for your module.</span><span class="sxs-lookup"><span data-stu-id="daddc-136">Enter a name for your module.</span></span> <span data-ttu-id="daddc-137">Choose a name that's unique within your container registry.</span><span class="sxs-lookup"><span data-stu-id="daddc-137">Choose a name that's unique within your container registry.</span></span> 

8. <span data-ttu-id="daddc-138">Provide the name of the module's image repository.</span><span class="sxs-lookup"><span data-stu-id="daddc-138">Provide the name of the module's image repository.</span></span> <span data-ttu-id="daddc-139">VS Code autopopulates the module name with **localhost:5000**.</span><span class="sxs-lookup"><span data-stu-id="daddc-139">VS Code autopopulates the module name with **localhost:5000**.</span></span> <span data-ttu-id="daddc-140">Replace it with your own registry information.</span><span class="sxs-lookup"><span data-stu-id="daddc-140">Replace it with your own registry information.</span></span> <span data-ttu-id="daddc-141">If you use a local Docker registry for testing, then **localhost** is fine.</span><span class="sxs-lookup"><span data-stu-id="daddc-141">If you use a local Docker registry for testing, then **localhost** is fine.</span></span> <span data-ttu-id="daddc-142">If you use Azure Container Registry, then use the login server from your registry's settings.</span><span class="sxs-lookup"><span data-stu-id="daddc-142">If you use Azure Container Registry, then use the login server from your registry's settings.</span></span> <span data-ttu-id="daddc-143">The login server looks like **\<registry name\>.azurecr.io**.</span><span class="sxs-lookup"><span data-stu-id="daddc-143">The login server looks like **\<registry name\>.azurecr.io**.</span></span> <span data-ttu-id="daddc-144">Only replace the localhost part of the string, don't delete your module name.</span><span class="sxs-lookup"><span data-stu-id="daddc-144">Only replace the localhost part of the string, don't delete your module name.</span></span> 

   ![Provide Docker image repository](./media/how-to-develop-c-module/repository.png)

<span data-ttu-id="daddc-146">VS Code takes the information you provided, creates an IoT Edge solution, and then loads it in a new window.</span><span class="sxs-lookup"><span data-stu-id="daddc-146">VS Code takes the information you provided, creates an IoT Edge solution, and then loads it in a new window.</span></span>

   ![View IoT Edge solution](./media/how-to-develop-c-module/view-solution.png)

<span data-ttu-id="daddc-148">There are four items within the solution:</span><span class="sxs-lookup"><span data-stu-id="daddc-148">There are four items within the solution:</span></span> 
* <span data-ttu-id="daddc-149">A **.vscode** folder contains debug configurations.</span><span class="sxs-lookup"><span data-stu-id="daddc-149">A **.vscode** folder contains debug configurations.</span></span>
* <span data-ttu-id="daddc-150">A **modules** folder has subfolders for each module.</span><span class="sxs-lookup"><span data-stu-id="daddc-150">A **modules** folder has subfolders for each module.</span></span> <span data-ttu-id="daddc-151">At this point, you only have one.</span><span class="sxs-lookup"><span data-stu-id="daddc-151">At this point, you only have one.</span></span> <span data-ttu-id="daddc-152">But you can add more in the command palette with the command **Azure IoT Edge: Add IoT Edge Module**.</span><span class="sxs-lookup"><span data-stu-id="daddc-152">But you can add more in the command palette with the command **Azure IoT Edge: Add IoT Edge Module**.</span></span> 
* <span data-ttu-id="daddc-153">An **.env** file lists your environment variables.</span><span class="sxs-lookup"><span data-stu-id="daddc-153">An **.env** file lists your environment variables.</span></span> <span data-ttu-id="daddc-154">If Azure Container Registry is your registry, you'll have an Azure Container Registry username and password in it.</span><span class="sxs-lookup"><span data-stu-id="daddc-154">If Azure Container Registry is your registry, you'll have an Azure Container Registry username and password in it.</span></span> 

   > [!NOTE]
   > <span data-ttu-id="daddc-155">The environment file is only created if you provide an image repository for the module.</span><span class="sxs-lookup"><span data-stu-id="daddc-155">The environment file is only created if you provide an image repository for the module.</span></span> <span data-ttu-id="daddc-156">If you accepted the localhost defaults to test and debug locally, then you don't need to declare environment variables.</span><span class="sxs-lookup"><span data-stu-id="daddc-156">If you accepted the localhost defaults to test and debug locally, then you don't need to declare environment variables.</span></span> 

* <span data-ttu-id="daddc-157">A **deployment.template.json** file lists your new module along with a sample **tempSensor** module that simulates data you can use for testing.</span><span class="sxs-lookup"><span data-stu-id="daddc-157">A **deployment.template.json** file lists your new module along with a sample **tempSensor** module that simulates data you can use for testing.</span></span> <span data-ttu-id="daddc-158">For more information about how deployment manifests work, see [Learn how to use deployment manifests to deploy modules and establish routes](module-composition.md).</span><span class="sxs-lookup"><span data-stu-id="daddc-158">For more information about how deployment manifests work, see [Learn how to use deployment manifests to deploy modules and establish routes](module-composition.md).</span></span> 

## <a name="develop-your-module"></a><span data-ttu-id="daddc-159">Develop your module</span><span class="sxs-lookup"><span data-stu-id="daddc-159">Develop your module</span></span>

<span data-ttu-id="daddc-160">The default C module code that comes with the solution is located at **modules** > [your module name] > **main.c**.</span><span class="sxs-lookup"><span data-stu-id="daddc-160">The default C module code that comes with the solution is located at **modules** > [your module name] > **main.c**.</span></span> <span data-ttu-id="daddc-161">The module and the deployment.template.json file are set up so that you can build the solution, push it to your container registry, and deploy it to a device to start testing without touching any code.</span><span class="sxs-lookup"><span data-stu-id="daddc-161">The module and the deployment.template.json file are set up so that you can build the solution, push it to your container registry, and deploy it to a device to start testing without touching any code.</span></span> <span data-ttu-id="daddc-162">The module is built to simply take input from a source (in this case, the tempSensor module that simulates data) and pipe it to IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="daddc-162">The module is built to simply take input from a source (in this case, the tempSensor module that simulates data) and pipe it to IoT Hub.</span></span> 

<span data-ttu-id="daddc-163">When you're ready to customize the C template with your own code, use the [Azure IoT Hub SDKs](../iot-hub/iot-hub-devguide-sdks.md) to build modules that address the key needs for IoT solutions such as security, device management, and reliability.</span><span class="sxs-lookup"><span data-stu-id="daddc-163">When you're ready to customize the C template with your own code, use the [Azure IoT Hub SDKs](../iot-hub/iot-hub-devguide-sdks.md) to build modules that address the key needs for IoT solutions such as security, device management, and reliability.</span></span> 

## <a name="build-and-deploy-your-module-for-debugging"></a><span data-ttu-id="daddc-164">Build and deploy your module for debugging</span><span class="sxs-lookup"><span data-stu-id="daddc-164">Build and deploy your module for debugging</span></span>

<span data-ttu-id="daddc-165">In each module folder, there are several Docker files for different container types.</span><span class="sxs-lookup"><span data-stu-id="daddc-165">In each module folder, there are several Docker files for different container types.</span></span> <span data-ttu-id="daddc-166">Use any of these files that end with the extension **.debug** to build your module for testing.</span><span class="sxs-lookup"><span data-stu-id="daddc-166">Use any of these files that end with the extension **.debug** to build your module for testing.</span></span> <span data-ttu-id="daddc-167">Currently, C modules support debugging only in Linux amd64 containers.</span><span class="sxs-lookup"><span data-stu-id="daddc-167">Currently, C modules support debugging only in Linux amd64 containers.</span></span>

1. <span data-ttu-id="daddc-168">In VS Code, navigate to the `deployment.template.json` file.</span><span class="sxs-lookup"><span data-stu-id="daddc-168">In VS Code, navigate to the `deployment.template.json` file.</span></span> <span data-ttu-id="daddc-169">Update your module image URL by adding **.debug** to the end.</span><span class="sxs-lookup"><span data-stu-id="daddc-169">Update your module image URL by adding **.debug** to the end.</span></span>

    ![Add **.debug** to your image name](./media/how-to-develop-c-module/image-debug.png)

2. <span data-ttu-id="daddc-171">Replace the C module createOptions in **deployment.template.json** with below content and save this file:</span><span class="sxs-lookup"><span data-stu-id="daddc-171">Replace the C module createOptions in **deployment.template.json** with below content and save this file:</span></span> 
    
    ```json
    "createOptions": "{\"HostConfig\": {\"Privileged\": true}}"
    ```

2. <span data-ttu-id="daddc-172">In the VS Code command palette, enter and run the command **Edge: Build IoT Edge solution**.</span><span class="sxs-lookup"><span data-stu-id="daddc-172">In the VS Code command palette, enter and run the command **Edge: Build IoT Edge solution**.</span></span>
3. <span data-ttu-id="daddc-173">Select the `deployment.template.json` file for your solution from the command palette.</span><span class="sxs-lookup"><span data-stu-id="daddc-173">Select the `deployment.template.json` file for your solution from the command palette.</span></span> 
4. <span data-ttu-id="daddc-174">In Azure IoT Hub Device Explorer, right-click an IoT Edge device ID.</span><span class="sxs-lookup"><span data-stu-id="daddc-174">In Azure IoT Hub Device Explorer, right-click an IoT Edge device ID.</span></span> <span data-ttu-id="daddc-175">Then select **Create deployment for Single Device**.</span><span class="sxs-lookup"><span data-stu-id="daddc-175">Then select **Create deployment for Single Device**.</span></span> 
5. <span data-ttu-id="daddc-176">Open your solution's **config** folder.</span><span class="sxs-lookup"><span data-stu-id="daddc-176">Open your solution's **config** folder.</span></span> <span data-ttu-id="daddc-177">Then select the `deployment.json` file.</span><span class="sxs-lookup"><span data-stu-id="daddc-177">Then select the `deployment.json` file.</span></span> <span data-ttu-id="daddc-178">Choose **Select Edge Deployment Manifest**.</span><span class="sxs-lookup"><span data-stu-id="daddc-178">Choose **Select Edge Deployment Manifest**.</span></span> 

<span data-ttu-id="daddc-179">You'll see the deployment successfully created with a deployment ID in a VS Code-integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="daddc-179">You'll see the deployment successfully created with a deployment ID in a VS Code-integrated terminal.</span></span>

<span data-ttu-id="daddc-180">Check your container status in the VS Code Docker explorer or by running the `docker ps` command in the terminal.</span><span class="sxs-lookup"><span data-stu-id="daddc-180">Check your container status in the VS Code Docker explorer or by running the `docker ps` command in the terminal.</span></span>

## <a name="start-debugging-c-module-in-vs-code"></a><span data-ttu-id="daddc-181">Start debugging C module in VS Code</span><span class="sxs-lookup"><span data-stu-id="daddc-181">Start debugging C module in VS Code</span></span>
<span data-ttu-id="daddc-182">VS Code keeps debugging configuration information in a `launch.json` file located in a `.vscode` folder in your workspace.</span><span class="sxs-lookup"><span data-stu-id="daddc-182">VS Code keeps debugging configuration information in a `launch.json` file located in a `.vscode` folder in your workspace.</span></span> <span data-ttu-id="daddc-183">This `launch.json` file was generated when you created a new IoT Edge solution.</span><span class="sxs-lookup"><span data-stu-id="daddc-183">This `launch.json` file was generated when you created a new IoT Edge solution.</span></span> <span data-ttu-id="daddc-184">It updates each time you add a new module that supports debugging.</span><span class="sxs-lookup"><span data-stu-id="daddc-184">It updates each time you add a new module that supports debugging.</span></span> 

1. <span data-ttu-id="daddc-185">Navigate to the VS Code debug view.</span><span class="sxs-lookup"><span data-stu-id="daddc-185">Navigate to the VS Code debug view.</span></span> <span data-ttu-id="daddc-186">Select the debug configuration file for your module.</span><span class="sxs-lookup"><span data-stu-id="daddc-186">Select the debug configuration file for your module.</span></span> <span data-ttu-id="daddc-187">The debug option name should be similar to **ModuleName Remote Debug (C)**</span><span class="sxs-lookup"><span data-stu-id="daddc-187">The debug option name should be similar to **ModuleName Remote Debug (C)**</span></span>

   ![Select debug configuration](./media/how-to-develop-c-module/debug-config.png)<span data-ttu-id="daddc-189">.</span><span class="sxs-lookup"><span data-stu-id="daddc-189">.</span></span>

2. <span data-ttu-id="daddc-190">Navigate to `main.c`.</span><span class="sxs-lookup"><span data-stu-id="daddc-190">Navigate to `main.c`.</span></span> <span data-ttu-id="daddc-191">Add a breakpoint in this file.</span><span class="sxs-lookup"><span data-stu-id="daddc-191">Add a breakpoint in this file.</span></span>

3. <span data-ttu-id="daddc-192">Select **Start Debugging** or select **F5**.</span><span class="sxs-lookup"><span data-stu-id="daddc-192">Select **Start Debugging** or select **F5**.</span></span> <span data-ttu-id="daddc-193">Select the process to attach to.</span><span class="sxs-lookup"><span data-stu-id="daddc-193">Select the process to attach to.</span></span>

4. <span data-ttu-id="daddc-194">In VS Code Debug view, you'll see the variables in the left panel.</span><span class="sxs-lookup"><span data-stu-id="daddc-194">In VS Code Debug view, you'll see the variables in the left panel.</span></span> 

<span data-ttu-id="daddc-195">The preceding example shows how to debug C IoT Edge modules on containers.</span><span class="sxs-lookup"><span data-stu-id="daddc-195">The preceding example shows how to debug C IoT Edge modules on containers.</span></span> <span data-ttu-id="daddc-196">It added exposed ports in your module container createOptions.</span><span class="sxs-lookup"><span data-stu-id="daddc-196">It added exposed ports in your module container createOptions.</span></span> <span data-ttu-id="daddc-197">After you finish debugging your C modules, we recommend you remove these exposed ports for production-ready IoT Edge modules.</span><span class="sxs-lookup"><span data-stu-id="daddc-197">After you finish debugging your C modules, we recommend you remove these exposed ports for production-ready IoT Edge modules.</span></span>

## <a name="next-steps"></a><span data-ttu-id="daddc-198">Next steps</span><span class="sxs-lookup"><span data-stu-id="daddc-198">Next steps</span></span>

<span data-ttu-id="daddc-199">After you've built your module, learn how to [deploy Azure IoT Edge modules from Visual Studio Code](how-to-deploy-modules-vscode.md).</span><span class="sxs-lookup"><span data-stu-id="daddc-199">After you've built your module, learn how to [deploy Azure IoT Edge modules from Visual Studio Code](how-to-deploy-modules-vscode.md).</span></span>

<span data-ttu-id="daddc-200">To develop modules for your IoT Edge devices, [Understand and use Azure IoT Hub SDKs](../iot-hub/iot-hub-devguide-sdks.md).</span><span class="sxs-lookup"><span data-stu-id="daddc-200">To develop modules for your IoT Edge devices, [Understand and use Azure IoT Hub SDKs](../iot-hub/iot-hub-devguide-sdks.md).</span></span>
