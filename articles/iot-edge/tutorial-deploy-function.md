---
title: Deploy Azure functions with Azure IoT Edge | Microsoft Docs
description: In this tutorial, you deploy an Azure function as a module to an edge device.
author: kgremban
manager: timlt
ms.author: kgremban
ms.date: 08/22/2018
ms.topic: tutorial
ms.service: iot-edge
services: iot-edge
ms.custom: mvc
ms.openlocfilehash: cf973899a6f56010c47588bdd506418a3d9a7cd8
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44857194"
---
# <a name="tutorial-deploy-azure-functions-as-iot-edge-modules-preview"></a><span data-ttu-id="22dfb-103">Tutorial: Deploy Azure functions as IoT Edge modules (preview)</span><span class="sxs-lookup"><span data-stu-id="22dfb-103">Tutorial: Deploy Azure functions as IoT Edge modules (preview)</span></span>

<span data-ttu-id="22dfb-104">You can use Azure Functions to deploy code that implements your business logic directly to your Azure IoT Edge devices.</span><span class="sxs-lookup"><span data-stu-id="22dfb-104">You can use Azure Functions to deploy code that implements your business logic directly to your Azure IoT Edge devices.</span></span> <span data-ttu-id="22dfb-105">This tutorial walks you through creating and deploying an Azure function that filters sensor data on the simulated IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="22dfb-105">This tutorial walks you through creating and deploying an Azure function that filters sensor data on the simulated IoT Edge device.</span></span> <span data-ttu-id="22dfb-106">You use the simulated IoT Edge device that you created in the Deploy Azure IoT Edge on a simulated device on [Windows][lnk-tutorial1-win] or [Linux][lnk-tutorial1-lin] quickstarts.</span><span class="sxs-lookup"><span data-stu-id="22dfb-106">You use the simulated IoT Edge device that you created in the Deploy Azure IoT Edge on a simulated device on [Windows][lnk-tutorial1-win] or [Linux][lnk-tutorial1-lin] quickstarts.</span></span> <span data-ttu-id="22dfb-107">In this tutorial, you learn how to:</span><span class="sxs-lookup"><span data-stu-id="22dfb-107">In this tutorial, you learn how to:</span></span>     

> [!div class="checklist"]
> * <span data-ttu-id="22dfb-108">Use Visual Studio Code to create an Azure function.</span><span class="sxs-lookup"><span data-stu-id="22dfb-108">Use Visual Studio Code to create an Azure function.</span></span>
> * <span data-ttu-id="22dfb-109">Use VS Code and Docker to create a Docker image and publish it to a container registry.</span><span class="sxs-lookup"><span data-stu-id="22dfb-109">Use VS Code and Docker to create a Docker image and publish it to a container registry.</span></span>
> * <span data-ttu-id="22dfb-110">Deploy the module from the container registry to your IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="22dfb-110">Deploy the module from the container registry to your IoT Edge device.</span></span>
> * <span data-ttu-id="22dfb-111">View filtered data.</span><span class="sxs-lookup"><span data-stu-id="22dfb-111">View filtered data.</span></span>

<span data-ttu-id="22dfb-112"><center>
![Tutorial architecture diagram](./media/tutorial-deploy-function/FunctionsTutDiagram.png)
</center></span><span class="sxs-lookup"><span data-stu-id="22dfb-112"><center>
![Tutorial architecture diagram](./media/tutorial-deploy-function/FunctionsTutDiagram.png)
</center></span></span>

>[!NOTE]
><span data-ttu-id="22dfb-113">Azure Function modules on Azure IoT Edge are in [public preview](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).</span><span class="sxs-lookup"><span data-stu-id="22dfb-113">Azure Function modules on Azure IoT Edge are in [public preview](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).</span></span> 

<span data-ttu-id="22dfb-114">The Azure function that you create in this tutorial filters the temperature data that's generated by your device.</span><span class="sxs-lookup"><span data-stu-id="22dfb-114">The Azure function that you create in this tutorial filters the temperature data that's generated by your device.</span></span> <span data-ttu-id="22dfb-115">The function only sends messages upstream to Azure IoT Hub when the temperature is above a specified threshold.</span><span class="sxs-lookup"><span data-stu-id="22dfb-115">The function only sends messages upstream to Azure IoT Hub when the temperature is above a specified threshold.</span></span> 

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

## <a name="prerequisites"></a><span data-ttu-id="22dfb-116">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="22dfb-116">Prerequisites</span></span>

<span data-ttu-id="22dfb-117">An Azure IoT Edge device:</span><span class="sxs-lookup"><span data-stu-id="22dfb-117">An Azure IoT Edge device:</span></span>

* <span data-ttu-id="22dfb-118">You can use your development machine or a virtual machine as an Edge device by following the steps in the quickstart for [Linux](quickstart-linux.md) or [Windows devices](quickstart.md).</span><span class="sxs-lookup"><span data-stu-id="22dfb-118">You can use your development machine or a virtual machine as an Edge device by following the steps in the quickstart for [Linux](quickstart-linux.md) or [Windows devices](quickstart.md).</span></span>

<span data-ttu-id="22dfb-119">Cloud resources:</span><span class="sxs-lookup"><span data-stu-id="22dfb-119">Cloud resources:</span></span>

* <span data-ttu-id="22dfb-120">A standard-tier [IoT Hub](../iot-hub/iot-hub-create-through-portal.md) in Azure.</span><span class="sxs-lookup"><span data-stu-id="22dfb-120">A standard-tier [IoT Hub](../iot-hub/iot-hub-create-through-portal.md) in Azure.</span></span> 

<span data-ttu-id="22dfb-121">Development resources:</span><span class="sxs-lookup"><span data-stu-id="22dfb-121">Development resources:</span></span>

* <span data-ttu-id="22dfb-122">[Visual Studio Code](https://code.visualstudio.com/).</span><span class="sxs-lookup"><span data-stu-id="22dfb-122">[Visual Studio Code](https://code.visualstudio.com/).</span></span> 
* <span data-ttu-id="22dfb-123">[C# for Visual Studio Code (powered by OmniSharp) extension](https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp).</span><span class="sxs-lookup"><span data-stu-id="22dfb-123">[C# for Visual Studio Code (powered by OmniSharp) extension](https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp).</span></span>
* <span data-ttu-id="22dfb-124">[Azure IoT Edge extension](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge) for Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="22dfb-124">[Azure IoT Edge extension](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge) for Visual Studio Code.</span></span> 
* <span data-ttu-id="22dfb-125">[The .NET Core 2.1 SDK](https://www.microsoft.com/net/download).</span><span class="sxs-lookup"><span data-stu-id="22dfb-125">[The .NET Core 2.1 SDK](https://www.microsoft.com/net/download).</span></span>
* <span data-ttu-id="22dfb-126">[Docker CE](https://docs.docker.com/install/).</span><span class="sxs-lookup"><span data-stu-id="22dfb-126">[Docker CE](https://docs.docker.com/install/).</span></span> 

## <a name="create-a-container-registry"></a><span data-ttu-id="22dfb-127">Create a container registry</span><span class="sxs-lookup"><span data-stu-id="22dfb-127">Create a container registry</span></span>

<span data-ttu-id="22dfb-128">In this tutorial, you use the Azure IoT Edge extension for VS Code to build a module and create a **container image** from the files.</span><span class="sxs-lookup"><span data-stu-id="22dfb-128">In this tutorial, you use the Azure IoT Edge extension for VS Code to build a module and create a **container image** from the files.</span></span> <span data-ttu-id="22dfb-129">Then you push this image to a **registry** that stores and manages your images.</span><span class="sxs-lookup"><span data-stu-id="22dfb-129">Then you push this image to a **registry** that stores and manages your images.</span></span> <span data-ttu-id="22dfb-130">Finally, you deploy your image from your registry to run on your IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="22dfb-130">Finally, you deploy your image from your registry to run on your IoT Edge device.</span></span>  

<span data-ttu-id="22dfb-131">You can use any Docker-compatible registry for this tutorial.</span><span class="sxs-lookup"><span data-stu-id="22dfb-131">You can use any Docker-compatible registry for this tutorial.</span></span> <span data-ttu-id="22dfb-132">Two popular Docker registry services that are available in the cloud are [Azure Container Registry](https://docs.microsoft.com/azure/container-registry/) and [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags).</span><span class="sxs-lookup"><span data-stu-id="22dfb-132">Two popular Docker registry services that are available in the cloud are [Azure Container Registry](https://docs.microsoft.com/azure/container-registry/) and [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags).</span></span> <span data-ttu-id="22dfb-133">This tutorial uses Azure Container Registry.</span><span class="sxs-lookup"><span data-stu-id="22dfb-133">This tutorial uses Azure Container Registry.</span></span> 

1. <span data-ttu-id="22dfb-134">In the [Azure portal](https://portal.azure.com), select **Create a resource** > **Containers** > **Container Registry**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-134">In the [Azure portal](https://portal.azure.com), select **Create a resource** > **Containers** > **Container Registry**.</span></span>

    ![Create a container registry](./media/tutorial-deploy-function/create-container-registry.png)

2. <span data-ttu-id="22dfb-136">Provide the following values to create your container registry:</span><span class="sxs-lookup"><span data-stu-id="22dfb-136">Provide the following values to create your container registry:</span></span>

   | <span data-ttu-id="22dfb-137">Field</span><span class="sxs-lookup"><span data-stu-id="22dfb-137">Field</span></span> | <span data-ttu-id="22dfb-138">Value</span><span class="sxs-lookup"><span data-stu-id="22dfb-138">Value</span></span> | 
   | ----- | ----- |
   | <span data-ttu-id="22dfb-139">Registry name</span><span class="sxs-lookup"><span data-stu-id="22dfb-139">Registry name</span></span> | <span data-ttu-id="22dfb-140">Provide a unique name.</span><span class="sxs-lookup"><span data-stu-id="22dfb-140">Provide a unique name.</span></span> |
   | <span data-ttu-id="22dfb-141">Subscription</span><span class="sxs-lookup"><span data-stu-id="22dfb-141">Subscription</span></span> | <span data-ttu-id="22dfb-142">Select a subscription from the drop-down list.</span><span class="sxs-lookup"><span data-stu-id="22dfb-142">Select a subscription from the drop-down list.</span></span> |
   | <span data-ttu-id="22dfb-143">Resource group</span><span class="sxs-lookup"><span data-stu-id="22dfb-143">Resource group</span></span> | <span data-ttu-id="22dfb-144">We recommend that you use the same resource group for all of the test resources that you create during the IoT Edge quickstarts and tutorials.</span><span class="sxs-lookup"><span data-stu-id="22dfb-144">We recommend that you use the same resource group for all of the test resources that you create during the IoT Edge quickstarts and tutorials.</span></span> <span data-ttu-id="22dfb-145">For example, **IoTEdgeResources**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-145">For example, **IoTEdgeResources**.</span></span> |
   | <span data-ttu-id="22dfb-146">Location</span><span class="sxs-lookup"><span data-stu-id="22dfb-146">Location</span></span> | <span data-ttu-id="22dfb-147">Choose a location close to you.</span><span class="sxs-lookup"><span data-stu-id="22dfb-147">Choose a location close to you.</span></span> |
   | <span data-ttu-id="22dfb-148">Admin user</span><span class="sxs-lookup"><span data-stu-id="22dfb-148">Admin user</span></span> | <span data-ttu-id="22dfb-149">Set to **Enable**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-149">Set to **Enable**.</span></span> |
   | <span data-ttu-id="22dfb-150">SKU</span><span class="sxs-lookup"><span data-stu-id="22dfb-150">SKU</span></span> | <span data-ttu-id="22dfb-151">Select **Basic**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-151">Select **Basic**.</span></span> | 

5. <span data-ttu-id="22dfb-152">Select **Create**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-152">Select **Create**.</span></span>

6. <span data-ttu-id="22dfb-153">After your container registry is created, browse to it, and then select **Access keys**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-153">After your container registry is created, browse to it, and then select **Access keys**.</span></span> 

7. <span data-ttu-id="22dfb-154">Copy the values for **Login server**, **Username**, and **Password**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-154">Copy the values for **Login server**, **Username**, and **Password**.</span></span> <span data-ttu-id="22dfb-155">You use these values later in the tutorial.</span><span class="sxs-lookup"><span data-stu-id="22dfb-155">You use these values later in the tutorial.</span></span> 

## <a name="create-a-function-project"></a><span data-ttu-id="22dfb-156">Create a function project</span><span class="sxs-lookup"><span data-stu-id="22dfb-156">Create a function project</span></span>

<span data-ttu-id="22dfb-157">The Azure IoT Edge extension for Visual Studio Code that you installed in the prerequisites provides management capabilities as well as some code templates.</span><span class="sxs-lookup"><span data-stu-id="22dfb-157">The Azure IoT Edge extension for Visual Studio Code that you installed in the prerequisites provides management capabilities as well as some code templates.</span></span> <span data-ttu-id="22dfb-158">In this section, you use Visual Studio Code to create an IoT Edge solution that contains an Azure function.</span><span class="sxs-lookup"><span data-stu-id="22dfb-158">In this section, you use Visual Studio Code to create an IoT Edge solution that contains an Azure function.</span></span> 

1. <span data-ttu-id="22dfb-159">Open Visual Studio Code on your development machine.</span><span class="sxs-lookup"><span data-stu-id="22dfb-159">Open Visual Studio Code on your development machine.</span></span>

2. <span data-ttu-id="22dfb-160">Open the VS Code command palette by selecting **View** > **Command Palette**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-160">Open the VS Code command palette by selecting **View** > **Command Palette**.</span></span>

3. <span data-ttu-id="22dfb-161">In the command palette, enter and run the command **Azure: Sign in**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-161">In the command palette, enter and run the command **Azure: Sign in**.</span></span> <span data-ttu-id="22dfb-162">Follow the instructions to sign in your Azure account.</span><span class="sxs-lookup"><span data-stu-id="22dfb-162">Follow the instructions to sign in your Azure account.</span></span>

4. <span data-ttu-id="22dfb-163">In the command palette, enter and run the command **Azure IoT Edge: New IoT Edge solution**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-163">In the command palette, enter and run the command **Azure IoT Edge: New IoT Edge solution**.</span></span> <span data-ttu-id="22dfb-164">Follow the prompts in the command palette to create your solution.</span><span class="sxs-lookup"><span data-stu-id="22dfb-164">Follow the prompts in the command palette to create your solution.</span></span>

   1. <span data-ttu-id="22dfb-165">Select the folder where you want to create the solution.</span><span class="sxs-lookup"><span data-stu-id="22dfb-165">Select the folder where you want to create the solution.</span></span> 
   2. <span data-ttu-id="22dfb-166">Provide a name for your solution or accept the default **EdgeSolution**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-166">Provide a name for your solution or accept the default **EdgeSolution**.</span></span>
   3. <span data-ttu-id="22dfb-167">Choose **Azure Functions - C#** as the module template.</span><span class="sxs-lookup"><span data-stu-id="22dfb-167">Choose **Azure Functions - C#** as the module template.</span></span> 
   4. <span data-ttu-id="22dfb-168">Name your module **CSharpFunction**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-168">Name your module **CSharpFunction**.</span></span> 
   5. <span data-ttu-id="22dfb-169">Specify the Azure container registry that you created in the previous section as the image repository for your first module.</span><span class="sxs-lookup"><span data-stu-id="22dfb-169">Specify the Azure container registry that you created in the previous section as the image repository for your first module.</span></span> <span data-ttu-id="22dfb-170">Replace **localhost:5000** with the login server value that you copied.</span><span class="sxs-lookup"><span data-stu-id="22dfb-170">Replace **localhost:5000** with the login server value that you copied.</span></span> <span data-ttu-id="22dfb-171">The final string looks like \<registry name\>.azurecr.io/csharpfunction.</span><span class="sxs-lookup"><span data-stu-id="22dfb-171">The final string looks like \<registry name\>.azurecr.io/csharpfunction.</span></span>

   ![Provide Docker image repository](./media/tutorial-deploy-function/repository.png)

4. <span data-ttu-id="22dfb-173">The VS Code window loads your IoT Edge solution workspace: a \.vscode folder, a modules folder, a deployment manifest template file.</span><span class="sxs-lookup"><span data-stu-id="22dfb-173">The VS Code window loads your IoT Edge solution workspace: a \.vscode folder, a modules folder, a deployment manifest template file.</span></span> <span data-ttu-id="22dfb-174">and a \.env file.</span><span class="sxs-lookup"><span data-stu-id="22dfb-174">and a \.env file.</span></span> <span data-ttu-id="22dfb-175">In the VS Code explorer, open **modules** > **CSharpFunction** > **EdgeHubTrigger-Csharp** > **run.csx**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-175">In the VS Code explorer, open **modules** > **CSharpFunction** > **EdgeHubTrigger-Csharp** > **run.csx**.</span></span>

5. <span data-ttu-id="22dfb-176">Replace the contents of the **run.csx** file with the following code:</span><span class="sxs-lookup"><span data-stu-id="22dfb-176">Replace the contents of the **run.csx** file with the following code:</span></span>

   ```csharp
   #r "Microsoft.Azure.Devices.Client"
   #r "Newtonsoft.Json"

   using System.IO;
   using Microsoft.Azure.Devices.Client;
   using Newtonsoft.Json;

   // Filter messages based on the temperature value in the body of the message and the temperature threshold value.
   public static async Task Run(Message messageReceived, IAsyncCollector<Message> output, TraceWriter log)
   {
        const int temperatureThreshold = 25;
        byte[] messageBytes = messageReceived.GetBytes();
        var messageString = System.Text.Encoding.UTF8.GetString(messageBytes);

        if (!string.IsNullOrEmpty(messageString))
        {
            // Get the body of the message and deserialize it.
            var messageBody = JsonConvert.DeserializeObject<MessageBody>(messageString);

            if (messageBody != null && messageBody.machine.temperature > temperatureThreshold)
            {
                // Send the message to the output as the temperature value is greater than the threashold.
                var filteredMessage = new Message(messageBytes);
                // Copy the properties of the original message into the new Message object.
                foreach (KeyValuePair<string, string> prop in messageReceived.Properties)
                {
                    filteredMessage.Properties.Add(prop.Key, prop.Value);                }
                // Add a new property to the message to indicate it is an alert.
                filteredMessage.Properties.Add("MessageType", "Alert");
                // Send the message.       
                await output.AddAsync(filteredMessage);
                log.Info("Received and transferred a message with temperature above the threshold");
            }
        }
    }

    //Define the expected schema for the body of incoming messages.
    class MessageBody
    {
        public Machine machine {get; set;}
        public Ambient ambient {get; set;}
        public string timeCreated {get; set;}
    }
    class Machine
    {
       public double temperature {get; set;}
       public double pressure {get; set;}         
    }
    class Ambient
    {
       public double temperature {get; set;}
       public int humidity {get; set;}         
    }
   ```

6. <span data-ttu-id="22dfb-177">Save the file.</span><span class="sxs-lookup"><span data-stu-id="22dfb-177">Save the file.</span></span>

## <a name="build-your-iot-edge-solution"></a><span data-ttu-id="22dfb-178">Build your IoT Edge solution</span><span class="sxs-lookup"><span data-stu-id="22dfb-178">Build your IoT Edge solution</span></span>

<span data-ttu-id="22dfb-179">In the previous section, you created an IoT Edge solution and added code to the **CSharpFunction** to filter out messages where the reported machine temperature is less than the acceptable threshold.</span><span class="sxs-lookup"><span data-stu-id="22dfb-179">In the previous section, you created an IoT Edge solution and added code to the **CSharpFunction** to filter out messages where the reported machine temperature is less than the acceptable threshold.</span></span> <span data-ttu-id="22dfb-180">Now you need to build the solution as a container image and push it to your container registry.</span><span class="sxs-lookup"><span data-stu-id="22dfb-180">Now you need to build the solution as a container image and push it to your container registry.</span></span>

<span data-ttu-id="22dfb-181">In this section, you provide the credentials for your container registry twice.</span><span class="sxs-lookup"><span data-stu-id="22dfb-181">In this section, you provide the credentials for your container registry twice.</span></span> <span data-ttu-id="22dfb-182">The first is to sign in locally from your development machine so that Visual Studio Code can push images to your registry.</span><span class="sxs-lookup"><span data-stu-id="22dfb-182">The first is to sign in locally from your development machine so that Visual Studio Code can push images to your registry.</span></span> <span data-ttu-id="22dfb-183">The second is in the **.env** file of your IoT Edge solution, which gives your IoT Edge device permissions to pull images from your registry.</span><span class="sxs-lookup"><span data-stu-id="22dfb-183">The second is in the **.env** file of your IoT Edge solution, which gives your IoT Edge device permissions to pull images from your registry.</span></span> 

1. <span data-ttu-id="22dfb-184">Open the VS Code integrated terminal by selecting **View** > **Terminal**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-184">Open the VS Code integrated terminal by selecting **View** > **Terminal**.</span></span> 

1. <span data-ttu-id="22dfb-185">Sign in to your container registry by entering the following command in the integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="22dfb-185">Sign in to your container registry by entering the following command in the integrated terminal.</span></span> <span data-ttu-id="22dfb-186">Then you can push your module image to your Azure container registry:</span><span class="sxs-lookup"><span data-stu-id="22dfb-186">Then you can push your module image to your Azure container registry:</span></span> 
     
    ```csh/sh
    docker login -u <ACR username> <ACR login server>
    ```
    <span data-ttu-id="22dfb-187">Use the username and login server that you copied from your Azure container registry earlier.</span><span class="sxs-lookup"><span data-stu-id="22dfb-187">Use the username and login server that you copied from your Azure container registry earlier.</span></span> <span data-ttu-id="22dfb-188">When you're prompted for the password, paste the password for your container registry and press **Enter**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-188">When you're prompted for the password, paste the password for your container registry and press **Enter**.</span></span>

    ```csh/sh
    Password: <paste in the ACR password and press enter>
    Login Succeeded
    ```

2. <span data-ttu-id="22dfb-189">In the VS Code explorer, open the **deployment.template.json** file in your IoT Edge solution workspace.</span><span class="sxs-lookup"><span data-stu-id="22dfb-189">In the VS Code explorer, open the **deployment.template.json** file in your IoT Edge solution workspace.</span></span> <span data-ttu-id="22dfb-190">This file tells the IoT Edge runtime which modules to deploy to a device.</span><span class="sxs-lookup"><span data-stu-id="22dfb-190">This file tells the IoT Edge runtime which modules to deploy to a device.</span></span> <span data-ttu-id="22dfb-191">Notice that your Function module, **CSharpFunction** is listed along with the **tempSensor** module that provides test data.</span><span class="sxs-lookup"><span data-stu-id="22dfb-191">Notice that your Function module, **CSharpFunction** is listed along with the **tempSensor** module that provides test data.</span></span> <span data-ttu-id="22dfb-192">To learn more about deployment manifests, see [Understand how IoT Edge modules can be used, configured, and reused](module-composition.md).</span><span class="sxs-lookup"><span data-stu-id="22dfb-192">To learn more about deployment manifests, see [Understand how IoT Edge modules can be used, configured, and reused](module-composition.md).</span></span>

   ![View your module in the deployment manifest](./media/tutorial-deploy-function/deployment-template.png)

3. <span data-ttu-id="22dfb-194">Open the **.env** file in your IoT Edge solution workspace.</span><span class="sxs-lookup"><span data-stu-id="22dfb-194">Open the **.env** file in your IoT Edge solution workspace.</span></span> <span data-ttu-id="22dfb-195">This git-ignored file stores your container registry credentials so that you don't have to put them in the deployment manifest template.</span><span class="sxs-lookup"><span data-stu-id="22dfb-195">This git-ignored file stores your container registry credentials so that you don't have to put them in the deployment manifest template.</span></span> <span data-ttu-id="22dfb-196">Provide the **username** and **password** for your container registry.</span><span class="sxs-lookup"><span data-stu-id="22dfb-196">Provide the **username** and **password** for your container registry.</span></span> 

5. <span data-ttu-id="22dfb-197">Save this file.</span><span class="sxs-lookup"><span data-stu-id="22dfb-197">Save this file.</span></span>

6. <span data-ttu-id="22dfb-198">In the VS Code explorer, right-click the deployment.template.json file and select **Build and Push IoT Edge solution**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-198">In the VS Code explorer, right-click the deployment.template.json file and select **Build and Push IoT Edge solution**.</span></span> 

<span data-ttu-id="22dfb-199">When you tell Visual Studio Code to build your solution, it first takes the information in the deployment template and generates a deployment.json file in a new folder named **config**. Then it runs two commands in the integrated terminal: `docker build` and `docker push`.</span><span class="sxs-lookup"><span data-stu-id="22dfb-199">When you tell Visual Studio Code to build your solution, it first takes the information in the deployment template and generates a deployment.json file in a new folder named **config**. Then it runs two commands in the integrated terminal: `docker build` and `docker push`.</span></span> <span data-ttu-id="22dfb-200">These two commands build your code, containerize the functions, and then push the code to the container registry that you specified when you initialized the solution.</span><span class="sxs-lookup"><span data-stu-id="22dfb-200">These two commands build your code, containerize the functions, and then push the code to the container registry that you specified when you initialized the solution.</span></span> 

## <a name="view-your-container-image"></a><span data-ttu-id="22dfb-201">View your container image</span><span class="sxs-lookup"><span data-stu-id="22dfb-201">View your container image</span></span>

<span data-ttu-id="22dfb-202">Visual Studio Code outputs a success message when your container image is pushed to your container registry.</span><span class="sxs-lookup"><span data-stu-id="22dfb-202">Visual Studio Code outputs a success message when your container image is pushed to your container registry.</span></span> <span data-ttu-id="22dfb-203">If you want to confirm the successful operation for yourself, you can view the image in the registry.</span><span class="sxs-lookup"><span data-stu-id="22dfb-203">If you want to confirm the successful operation for yourself, you can view the image in the registry.</span></span> 

1. <span data-ttu-id="22dfb-204">In the Azure portal, browse to your Azure container registry.</span><span class="sxs-lookup"><span data-stu-id="22dfb-204">In the Azure portal, browse to your Azure container registry.</span></span> 
2. <span data-ttu-id="22dfb-205">Select **Repositories**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-205">Select **Repositories**.</span></span>
3. <span data-ttu-id="22dfb-206">You should see the **csharpfunction** repository in the list.</span><span class="sxs-lookup"><span data-stu-id="22dfb-206">You should see the **csharpfunction** repository in the list.</span></span> <span data-ttu-id="22dfb-207">Select this repository to see more details.</span><span class="sxs-lookup"><span data-stu-id="22dfb-207">Select this repository to see more details.</span></span>
4. <span data-ttu-id="22dfb-208">In the **Tags** section, you should see the **0.0.1-amd64** tag.</span><span class="sxs-lookup"><span data-stu-id="22dfb-208">In the **Tags** section, you should see the **0.0.1-amd64** tag.</span></span> <span data-ttu-id="22dfb-209">This tag indicates the version and platform of the image that you built.</span><span class="sxs-lookup"><span data-stu-id="22dfb-209">This tag indicates the version and platform of the image that you built.</span></span> <span data-ttu-id="22dfb-210">These values are set in the module.json file in the CSharpFunction folder.</span><span class="sxs-lookup"><span data-stu-id="22dfb-210">These values are set in the module.json file in the CSharpFunction folder.</span></span> 

## <a name="deploy-and-run-the-solution"></a><span data-ttu-id="22dfb-211">Deploy and run the solution</span><span class="sxs-lookup"><span data-stu-id="22dfb-211">Deploy and run the solution</span></span>

<span data-ttu-id="22dfb-212">You can use the Azure portal to deploy your function module to an IoT Edge device like you did in the quickstarts.</span><span class="sxs-lookup"><span data-stu-id="22dfb-212">You can use the Azure portal to deploy your function module to an IoT Edge device like you did in the quickstarts.</span></span> <span data-ttu-id="22dfb-213">You can also deploy and monitor modules from within Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="22dfb-213">You can also deploy and monitor modules from within Visual Studio Code.</span></span> <span data-ttu-id="22dfb-214">The following sections use the Azure IoT Edge extension for VS Code that was listed in the prerequisites.</span><span class="sxs-lookup"><span data-stu-id="22dfb-214">The following sections use the Azure IoT Edge extension for VS Code that was listed in the prerequisites.</span></span> <span data-ttu-id="22dfb-215">Install the extension now, if you didn't already.</span><span class="sxs-lookup"><span data-stu-id="22dfb-215">Install the extension now, if you didn't already.</span></span> 

1. <span data-ttu-id="22dfb-216">Open the VS Code command palette by selecting **View** > **Command Palette**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-216">Open the VS Code command palette by selecting **View** > **Command Palette**.</span></span>

2. <span data-ttu-id="22dfb-217">Search for and run the command **Azure: Sign in**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-217">Search for and run the command **Azure: Sign in**.</span></span> <span data-ttu-id="22dfb-218">Follow the instructions to sign in your Azure account.</span><span class="sxs-lookup"><span data-stu-id="22dfb-218">Follow the instructions to sign in your Azure account.</span></span> 

3. <span data-ttu-id="22dfb-219">In the command palette, search for and run the command **Azure IoT Hub: Select IoT Hub**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-219">In the command palette, search for and run the command **Azure IoT Hub: Select IoT Hub**.</span></span> 

4. <span data-ttu-id="22dfb-220">Select the subscription that has your IoT hub, and then select the IoT hub that you want to access.</span><span class="sxs-lookup"><span data-stu-id="22dfb-220">Select the subscription that has your IoT hub, and then select the IoT hub that you want to access.</span></span>

5. <span data-ttu-id="22dfb-221">In the VS Code explorer, expand the **Azure IoT Hub Devices** section.</span><span class="sxs-lookup"><span data-stu-id="22dfb-221">In the VS Code explorer, expand the **Azure IoT Hub Devices** section.</span></span> 

6. <span data-ttu-id="22dfb-222">Right-click the name of your IoT Edge device, and then select **Create Deployment for single device**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-222">Right-click the name of your IoT Edge device, and then select **Create Deployment for single device**.</span></span> 

7. <span data-ttu-id="22dfb-223">Browse to the solution folder that contains the **CSharpFunction**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-223">Browse to the solution folder that contains the **CSharpFunction**.</span></span> <span data-ttu-id="22dfb-224">Open the config folder, select the deployment.json file, and then choose **Select Edge Deployment Manifest**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-224">Open the config folder, select the deployment.json file, and then choose **Select Edge Deployment Manifest**.</span></span>

8. <span data-ttu-id="22dfb-225">Refresh the **Azure IoT Hub Devices** section.</span><span class="sxs-lookup"><span data-stu-id="22dfb-225">Refresh the **Azure IoT Hub Devices** section.</span></span> <span data-ttu-id="22dfb-226">You should see the new **CSharpFunction** running along with the **TempSensor** module and the **$edgeAgent** and **$edgeHub**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-226">You should see the new **CSharpFunction** running along with the **TempSensor** module and the **$edgeAgent** and **$edgeHub**.</span></span> 

   ![View deployed modules in VS Code](./media/tutorial-deploy-function/view-modules.png)

## <a name="view-generated-data"></a><span data-ttu-id="22dfb-228">View generated data</span><span class="sxs-lookup"><span data-stu-id="22dfb-228">View generated data</span></span>

<span data-ttu-id="22dfb-229">You can see all of the messages that arrive at your IoT hub by running **Azure IoT Hub: Start Monitoring D2C Message** in the command palette.</span><span class="sxs-lookup"><span data-stu-id="22dfb-229">You can see all of the messages that arrive at your IoT hub by running **Azure IoT Hub: Start Monitoring D2C Message** in the command palette.</span></span>

<span data-ttu-id="22dfb-230">You can also filter the view to see all of the messages that arrive at your IoT hub from a specific device.</span><span class="sxs-lookup"><span data-stu-id="22dfb-230">You can also filter the view to see all of the messages that arrive at your IoT hub from a specific device.</span></span> <span data-ttu-id="22dfb-231">Right-click the device in the **Azure IoT Hub Devices** section and select **Start Monitoring D2C Messages**.</span><span class="sxs-lookup"><span data-stu-id="22dfb-231">Right-click the device in the **Azure IoT Hub Devices** section and select **Start Monitoring D2C Messages**.</span></span>

<span data-ttu-id="22dfb-232">To stop monitoring messages, run the command **Azure IoT Hub: Stop monitoring D2C message** in the command palette.</span><span class="sxs-lookup"><span data-stu-id="22dfb-232">To stop monitoring messages, run the command **Azure IoT Hub: Stop monitoring D2C message** in the command palette.</span></span> 


## <a name="clean-up-resources"></a><span data-ttu-id="22dfb-233">Clean up resources</span><span class="sxs-lookup"><span data-stu-id="22dfb-233">Clean up resources</span></span>

<span data-ttu-id="22dfb-234">If you plan to continue to the next recommended article, you can keep the resources and configurations that you created and reuse them.</span><span class="sxs-lookup"><span data-stu-id="22dfb-234">If you plan to continue to the next recommended article, you can keep the resources and configurations that you created and reuse them.</span></span> <span data-ttu-id="22dfb-235">You can also keep using the same IoT Edge device as a test device.</span><span class="sxs-lookup"><span data-stu-id="22dfb-235">You can also keep using the same IoT Edge device as a test device.</span></span> 

<span data-ttu-id="22dfb-236">Otherwise, you can delete the local configurations and the Azure resources that you created in this article to avoid charges.</span><span class="sxs-lookup"><span data-stu-id="22dfb-236">Otherwise, you can delete the local configurations and the Azure resources that you created in this article to avoid charges.</span></span> 

[!INCLUDE [iot-edge-clean-up-cloud-resources](../../includes/iot-edge-clean-up-cloud-resources.md)]

[!INCLUDE [iot-edge-clean-up-local-resources](../../includes/iot-edge-clean-up-local-resources.md)]


## <a name="next-steps"></a><span data-ttu-id="22dfb-237">Next steps</span><span class="sxs-lookup"><span data-stu-id="22dfb-237">Next steps</span></span>

<span data-ttu-id="22dfb-238">In this tutorial, you created an Azure function module with code to filter raw data that's generated by your IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="22dfb-238">In this tutorial, you created an Azure function module with code to filter raw data that's generated by your IoT Edge device.</span></span> <span data-ttu-id="22dfb-239">When you're ready to build your own modules, you can learn more about how to [Develop Azure functions with Azure IoT Edge for Visual Studio Code](how-to-develop-csharp-function.md).</span><span class="sxs-lookup"><span data-stu-id="22dfb-239">When you're ready to build your own modules, you can learn more about how to [Develop Azure functions with Azure IoT Edge for Visual Studio Code](how-to-develop-csharp-function.md).</span></span> 

<span data-ttu-id="22dfb-240">Continue on to the next tutorials to learn other ways that Azure IoT Edge can help you turn data into business insights at the edge.</span><span class="sxs-lookup"><span data-stu-id="22dfb-240">Continue on to the next tutorials to learn other ways that Azure IoT Edge can help you turn data into business insights at the edge.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="22dfb-241">Find averages by using a floating window in Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="22dfb-241">Find averages by using a floating window in Azure Stream Analytics</span></span>](tutorial-deploy-stream-analytics.md)

<!--Links-->
[lnk-tutorial1-win]: quickstart.md
[lnk-tutorial1-lin]: quickstart-linux.md
