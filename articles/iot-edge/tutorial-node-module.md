---
title: Azure IoT Edge Node.js tutorial | Microsoft Docs
description: This tutorial shows you how to create an IoT Edge module with Node.js code and deploy it to an edge device
services: iot-edge
author: shizn
manager: timlt
ms.author: xshi
ms.date: 06/26/2018
ms.topic: tutorial
ms.service: iot-edge
ms.custom: mvc
ms.openlocfilehash: 6c47deebfe9617cdb21f473b282dd6ea2b912dc0
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44871433"
---
# <a name="tutorial-develop-and-deploy-a-nodejs-iot-edge-module-to-your-simulated-device"></a><span data-ttu-id="cbe43-103">Tutorial: Develop and deploy a Node.js IoT Edge module to your simulated device</span><span class="sxs-lookup"><span data-stu-id="cbe43-103">Tutorial: Develop and deploy a Node.js IoT Edge module to your simulated device</span></span>

<span data-ttu-id="cbe43-104">You can use IoT Edge modules to deploy code that implements your business logic directly to your IoT Edge devices.</span><span class="sxs-lookup"><span data-stu-id="cbe43-104">You can use IoT Edge modules to deploy code that implements your business logic directly to your IoT Edge devices.</span></span> <span data-ttu-id="cbe43-105">This tutorial walks you through creating and deploying an IoT Edge module that filters sensor data.</span><span class="sxs-lookup"><span data-stu-id="cbe43-105">This tutorial walks you through creating and deploying an IoT Edge module that filters sensor data.</span></span> <span data-ttu-id="cbe43-106">You'll use the simulated IoT Edge device that you created in the Deploy Azure IoT Edge on a simulated device in [Windows][lnk-tutorial1-win] or [Linux][lnk-tutorial1-lin] tutorials.</span><span class="sxs-lookup"><span data-stu-id="cbe43-106">You'll use the simulated IoT Edge device that you created in the Deploy Azure IoT Edge on a simulated device in [Windows][lnk-tutorial1-win] or [Linux][lnk-tutorial1-lin] tutorials.</span></span> <span data-ttu-id="cbe43-107">In this tutorial, you learn how to:</span><span class="sxs-lookup"><span data-stu-id="cbe43-107">In this tutorial, you learn how to:</span></span>    

> [!div class="checklist"]
> * <span data-ttu-id="cbe43-108">Use Visual Studio Code to create an IoT Edge Node.js module</span><span class="sxs-lookup"><span data-stu-id="cbe43-108">Use Visual Studio Code to create an IoT Edge Node.js module</span></span>
> * <span data-ttu-id="cbe43-109">Use Visual Studio Code and Docker to create a docker image and publish it to your registry</span><span class="sxs-lookup"><span data-stu-id="cbe43-109">Use Visual Studio Code and Docker to create a docker image and publish it to your registry</span></span> 
> * <span data-ttu-id="cbe43-110">Deploy the module to your IoT Edge device</span><span class="sxs-lookup"><span data-stu-id="cbe43-110">Deploy the module to your IoT Edge device</span></span>
> * <span data-ttu-id="cbe43-111">View generated data</span><span class="sxs-lookup"><span data-stu-id="cbe43-111">View generated data</span></span>


<span data-ttu-id="cbe43-112">The IoT Edge module that you create in this tutorial filters the temperature data generated by your device.</span><span class="sxs-lookup"><span data-stu-id="cbe43-112">The IoT Edge module that you create in this tutorial filters the temperature data generated by your device.</span></span> <span data-ttu-id="cbe43-113">It only sends messages upstream if the temperature is above a specified threshold.</span><span class="sxs-lookup"><span data-stu-id="cbe43-113">It only sends messages upstream if the temperature is above a specified threshold.</span></span> <span data-ttu-id="cbe43-114">This type of analysis at the edge is useful for reducing the amount of data communicated to and stored in the cloud.</span><span class="sxs-lookup"><span data-stu-id="cbe43-114">This type of analysis at the edge is useful for reducing the amount of data communicated to and stored in the cloud.</span></span> 

[!INCLUDE [quickstarts-free-trial-note](../../includes/quickstarts-free-trial-note.md)]

## <a name="prerequisites"></a><span data-ttu-id="cbe43-115">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="cbe43-115">Prerequisites</span></span>

<span data-ttu-id="cbe43-116">An Azure IoT Edge device:</span><span class="sxs-lookup"><span data-stu-id="cbe43-116">An Azure IoT Edge device:</span></span>

* <span data-ttu-id="cbe43-117">You can use your development machine or a virtual machine as an Edge device by following the steps in the quickstart for [Linux](quickstart-linux.md) or [Windows devices](quickstart.md).</span><span class="sxs-lookup"><span data-stu-id="cbe43-117">You can use your development machine or a virtual machine as an Edge device by following the steps in the quickstart for [Linux](quickstart-linux.md) or [Windows devices](quickstart.md).</span></span>

<span data-ttu-id="cbe43-118">Cloud resources:</span><span class="sxs-lookup"><span data-stu-id="cbe43-118">Cloud resources:</span></span>

* <span data-ttu-id="cbe43-119">A standard-tier [IoT Hub](../iot-hub/iot-hub-create-through-portal.md) in Azure.</span><span class="sxs-lookup"><span data-stu-id="cbe43-119">A standard-tier [IoT Hub](../iot-hub/iot-hub-create-through-portal.md) in Azure.</span></span> 

<span data-ttu-id="cbe43-120">Development resources:</span><span class="sxs-lookup"><span data-stu-id="cbe43-120">Development resources:</span></span>

* <span data-ttu-id="cbe43-121">[Visual Studio Code](https://code.visualstudio.com/).</span><span class="sxs-lookup"><span data-stu-id="cbe43-121">[Visual Studio Code](https://code.visualstudio.com/).</span></span> 
* <span data-ttu-id="cbe43-122">[Azure IoT Edge extension](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge) for Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="cbe43-122">[Azure IoT Edge extension](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge) for Visual Studio Code.</span></span> 
* <span data-ttu-id="cbe43-123">[Docker CE](https://docs.docker.com/engine/installation/).</span><span class="sxs-lookup"><span data-stu-id="cbe43-123">[Docker CE](https://docs.docker.com/engine/installation/).</span></span> 
* <span data-ttu-id="cbe43-124">[Node.js and npm](https://nodejs.org).</span><span class="sxs-lookup"><span data-stu-id="cbe43-124">[Node.js and npm](https://nodejs.org).</span></span> <span data-ttu-id="cbe43-125">The npm package is distributed with Node.js, which means that when you download Node.js, you automatically get npm installed on your computer.</span><span class="sxs-lookup"><span data-stu-id="cbe43-125">The npm package is distributed with Node.js, which means that when you download Node.js, you automatically get npm installed on your computer.</span></span>

## <a name="create-a-container-registry"></a><span data-ttu-id="cbe43-126">Create a container registry</span><span class="sxs-lookup"><span data-stu-id="cbe43-126">Create a container registry</span></span>
<span data-ttu-id="cbe43-127">In this tutorial, you use the Azure IoT Edge extension for VS Code to build a module and create a **container image** from the files.</span><span class="sxs-lookup"><span data-stu-id="cbe43-127">In this tutorial, you use the Azure IoT Edge extension for VS Code to build a module and create a **container image** from the files.</span></span> <span data-ttu-id="cbe43-128">Then you push this image to a **registry** that stores and manages your images.</span><span class="sxs-lookup"><span data-stu-id="cbe43-128">Then you push this image to a **registry** that stores and manages your images.</span></span> <span data-ttu-id="cbe43-129">Finally, you deploy your image from your registry to run on your IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="cbe43-129">Finally, you deploy your image from your registry to run on your IoT Edge device.</span></span>  

<span data-ttu-id="cbe43-130">You can use any Docker-compatible registry for this tutorial.</span><span class="sxs-lookup"><span data-stu-id="cbe43-130">You can use any Docker-compatible registry for this tutorial.</span></span> <span data-ttu-id="cbe43-131">Two popular Docker registry services available in the cloud are [Azure Container Registry](https://docs.microsoft.com/azure/container-registry/) and [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags).</span><span class="sxs-lookup"><span data-stu-id="cbe43-131">Two popular Docker registry services available in the cloud are [Azure Container Registry](https://docs.microsoft.com/azure/container-registry/) and [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags).</span></span> <span data-ttu-id="cbe43-132">This tutorial uses Azure Container Registry.</span><span class="sxs-lookup"><span data-stu-id="cbe43-132">This tutorial uses Azure Container Registry.</span></span> 

1. <span data-ttu-id="cbe43-133">In the [Azure portal](https://portal.azure.com), select **Create a resource** > **Containers** > **Azure Container Registry**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-133">In the [Azure portal](https://portal.azure.com), select **Create a resource** > **Containers** > **Azure Container Registry**.</span></span>
2. <span data-ttu-id="cbe43-134">Give your registry a name, choose a subscription, choose a resource group, and set the SKU to **Basic**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-134">Give your registry a name, choose a subscription, choose a resource group, and set the SKU to **Basic**.</span></span> 
3. <span data-ttu-id="cbe43-135">Select **Create**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-135">Select **Create**.</span></span>
4. <span data-ttu-id="cbe43-136">Once your container registry is created, navigate to it and select **Access keys**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-136">Once your container registry is created, navigate to it and select **Access keys**.</span></span> 
5. <span data-ttu-id="cbe43-137">Toggle **Admin user** to **Enable**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-137">Toggle **Admin user** to **Enable**.</span></span>
6. <span data-ttu-id="cbe43-138">Copy the values for **Login server**, **Username**, and **Password**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-138">Copy the values for **Login server**, **Username**, and **Password**.</span></span> <span data-ttu-id="cbe43-139">You'll use these values later in the tutorial.</span><span class="sxs-lookup"><span data-stu-id="cbe43-139">You'll use these values later in the tutorial.</span></span> 

## <a name="create-an-iot-edge-module-project"></a><span data-ttu-id="cbe43-140">Create an IoT Edge module project</span><span class="sxs-lookup"><span data-stu-id="cbe43-140">Create an IoT Edge module project</span></span>
<span data-ttu-id="cbe43-141">The following steps show you how to create an IoT Edge Node.js module using Visual Studio Code and the Azure IoT Edge extension.</span><span class="sxs-lookup"><span data-stu-id="cbe43-141">The following steps show you how to create an IoT Edge Node.js module using Visual Studio Code and the Azure IoT Edge extension.</span></span>

### <a name="create-a-new-solution"></a><span data-ttu-id="cbe43-142">Create a new solution</span><span class="sxs-lookup"><span data-stu-id="cbe43-142">Create a new solution</span></span>

<span data-ttu-id="cbe43-143">Use **npm** to create a Node.js solution template that you can build on top of.</span><span class="sxs-lookup"><span data-stu-id="cbe43-143">Use **npm** to create a Node.js solution template that you can build on top of.</span></span> 

1. <span data-ttu-id="cbe43-144">In Visual Studio Code, select **View** > **Integrated Terminal** to open the VS Code integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="cbe43-144">In Visual Studio Code, select **View** > **Integrated Terminal** to open the VS Code integrated terminal.</span></span>

2. <span data-ttu-id="cbe43-145">In the integrated terminal, enter the following command to install **yeoman** and the generator for Node.js Azure IoT Edge module:</span><span class="sxs-lookup"><span data-stu-id="cbe43-145">In the integrated terminal, enter the following command to install **yeoman** and the generator for Node.js Azure IoT Edge module:</span></span> 

    ```cmd/sh
    npm install -g yo generator-azure-iot-edge-module
    ```

3. <span data-ttu-id="cbe43-146">Select **View** > **Command Palette** to open the VS Code command palette.</span><span class="sxs-lookup"><span data-stu-id="cbe43-146">Select **View** > **Command Palette** to open the VS Code command palette.</span></span> 

3. <span data-ttu-id="cbe43-147">In the command palette, type and run the command **Azure: Sign in** and follow the instructions to sign in your Azure account.</span><span class="sxs-lookup"><span data-stu-id="cbe43-147">In the command palette, type and run the command **Azure: Sign in** and follow the instructions to sign in your Azure account.</span></span> <span data-ttu-id="cbe43-148">If you've already signed in, you can skip this step.</span><span class="sxs-lookup"><span data-stu-id="cbe43-148">If you've already signed in, you can skip this step.</span></span>

4. <span data-ttu-id="cbe43-149">In the command palette, type and run the command **Azure IoT Edge: New IoT Edge solution**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-149">In the command palette, type and run the command **Azure IoT Edge: New IoT Edge solution**.</span></span> <span data-ttu-id="cbe43-150">In the command palette, provide the following information to create your solution:</span><span class="sxs-lookup"><span data-stu-id="cbe43-150">In the command palette, provide the following information to create your solution:</span></span> 

   1. <span data-ttu-id="cbe43-151">Select the folder where you want to create the solution.</span><span class="sxs-lookup"><span data-stu-id="cbe43-151">Select the folder where you want to create the solution.</span></span> 
   2. <span data-ttu-id="cbe43-152">Provide a name for your solution or accept the default **EdgeSolution**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-152">Provide a name for your solution or accept the default **EdgeSolution**.</span></span>
   3. <span data-ttu-id="cbe43-153">Choose **Node.js Module** as the module template.</span><span class="sxs-lookup"><span data-stu-id="cbe43-153">Choose **Node.js Module** as the module template.</span></span> 
   4. <span data-ttu-id="cbe43-154">Name your module **NodeModule**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-154">Name your module **NodeModule**.</span></span> 
   5. <span data-ttu-id="cbe43-155">Specify the Azure Container Registry that you created in the previous section as the image repository for your first module.</span><span class="sxs-lookup"><span data-stu-id="cbe43-155">Specify the Azure Container Registry that you created in the previous section as the image repository for your first module.</span></span> <span data-ttu-id="cbe43-156">Replace **localhost:5000** with the login server value that you copied.</span><span class="sxs-lookup"><span data-stu-id="cbe43-156">Replace **localhost:5000** with the login server value that you copied.</span></span> <span data-ttu-id="cbe43-157">The final string looks like **\<registry name\>.azurecr.io/nodemodule**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-157">The final string looks like **\<registry name\>.azurecr.io/nodemodule**.</span></span>

   ![Provide Docker image repository](./media/tutorial-node-module/repository.png)

<span data-ttu-id="cbe43-159">The VS Code window loads your IoT Edge solution workspace.</span><span class="sxs-lookup"><span data-stu-id="cbe43-159">The VS Code window loads your IoT Edge solution workspace.</span></span> <span data-ttu-id="cbe43-160">The solution workspace contains five top-level components.</span><span class="sxs-lookup"><span data-stu-id="cbe43-160">The solution workspace contains five top-level components.</span></span> <span data-ttu-id="cbe43-161">You won't edit the **\.vscode** folder or **\.gitignore** file in this tutorial.</span><span class="sxs-lookup"><span data-stu-id="cbe43-161">You won't edit the **\.vscode** folder or **\.gitignore** file in this tutorial.</span></span> <span data-ttu-id="cbe43-162">The **modules** folder contains the Node.js code for your module as well as Dockerfiles for building your module as a container image.</span><span class="sxs-lookup"><span data-stu-id="cbe43-162">The **modules** folder contains the Node.js code for your module as well as Dockerfiles for building your module as a container image.</span></span> <span data-ttu-id="cbe43-163">The **\.env** file stores your container registry credentials.</span><span class="sxs-lookup"><span data-stu-id="cbe43-163">The **\.env** file stores your container registry credentials.</span></span> <span data-ttu-id="cbe43-164">The **deployment.template.json** file contains the information that the IoT Edge runtime uses to deploy modules on a device.</span><span class="sxs-lookup"><span data-stu-id="cbe43-164">The **deployment.template.json** file contains the information that the IoT Edge runtime uses to deploy modules on a device.</span></span> 

<span data-ttu-id="cbe43-165">If you didn't specify a container registry when creating your solution, but accepted the default localhost:5000 value, you won't have a \.env file.</span><span class="sxs-lookup"><span data-stu-id="cbe43-165">If you didn't specify a container registry when creating your solution, but accepted the default localhost:5000 value, you won't have a \.env file.</span></span> 

   ![Node.js solution workspace](./media/tutorial-node-module/workspace.png)

### <a name="add-your-registry-credentials"></a><span data-ttu-id="cbe43-167">Add your registry credentials</span><span class="sxs-lookup"><span data-stu-id="cbe43-167">Add your registry credentials</span></span>

<span data-ttu-id="cbe43-168">The environment file stores the credentials for your container repository and shares those with the IoT Edge runtime.</span><span class="sxs-lookup"><span data-stu-id="cbe43-168">The environment file stores the credentials for your container repository and shares those with the IoT Edge runtime.</span></span> <span data-ttu-id="cbe43-169">The runtime needs these credentials to pull your private images onto the IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="cbe43-169">The runtime needs these credentials to pull your private images onto the IoT Edge device.</span></span> 

1. <span data-ttu-id="cbe43-170">In the VS Code explorer, open the **.env** file.</span><span class="sxs-lookup"><span data-stu-id="cbe43-170">In the VS Code explorer, open the **.env** file.</span></span> 
2. <span data-ttu-id="cbe43-171">Update the fields with the **username** and **password** values that you copied from your Azure container registry.</span><span class="sxs-lookup"><span data-stu-id="cbe43-171">Update the fields with the **username** and **password** values that you copied from your Azure container registry.</span></span> 
3. <span data-ttu-id="cbe43-172">Save this file.</span><span class="sxs-lookup"><span data-stu-id="cbe43-172">Save this file.</span></span> 

### <a name="update-the-module-with-custom-code"></a><span data-ttu-id="cbe43-173">Update the module with custom code</span><span class="sxs-lookup"><span data-stu-id="cbe43-173">Update the module with custom code</span></span>

<span data-ttu-id="cbe43-174">Each template comes with sample code included, which takes simulated sensor data from the **tempSensor** module and routes it to IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="cbe43-174">Each template comes with sample code included, which takes simulated sensor data from the **tempSensor** module and routes it to IoT Hub.</span></span> <span data-ttu-id="cbe43-175">In this section, add code to have NodeModule analyze the messages before sending them.</span><span class="sxs-lookup"><span data-stu-id="cbe43-175">In this section, add code to have NodeModule analyze the messages before sending them.</span></span> 

1. <span data-ttu-id="cbe43-176">In the VS Code explorer, open **modules** > **NodeModule** > **app.js**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-176">In the VS Code explorer, open **modules** > **NodeModule** > **app.js**.</span></span>

5. <span data-ttu-id="cbe43-177">Add a temperature threshold variable below required node modules.</span><span class="sxs-lookup"><span data-stu-id="cbe43-177">Add a temperature threshold variable below required node modules.</span></span> <span data-ttu-id="cbe43-178">The temperature threshold sets the value that the measured temperature must exceed in order for the data to be sent to IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="cbe43-178">The temperature threshold sets the value that the measured temperature must exceed in order for the data to be sent to IoT Hub.</span></span>

    ```javascript
    var temperatureThreshold = 25;
    ```

6. <span data-ttu-id="cbe43-179">Replace the entire `PipeMessage` function with the `FilterMessage` function.</span><span class="sxs-lookup"><span data-stu-id="cbe43-179">Replace the entire `PipeMessage` function with the `FilterMessage` function.</span></span>
    
    ```javascript
    // This function filters out messages that report temperatures below the temperature threshold.
    // It also adds the MessageType property to the message with the value set to Alert.
    function filterMessage(client, inputName, msg) {
        client.complete(msg, printResultFor('Receiving message'));
        if (inputName === 'input1') {
            var message = msg.getBytes().toString('utf8');
            var messageBody = JSON.parse(message);
            if (messageBody && messageBody.machine && messageBody.machine.temperature && messageBody.machine.temperature > temperatureThreshold) {
                console.log(`Machine temperature ${messageBody.machine.temperature} exceeds threshold ${temperatureThreshold}`);
                var outputMsg = new Message(message);
                outputMsg.properties.add('MessageType', 'Alert');
                client.sendOutputEvent('output1', outputMsg, printResultFor('Sending received message'));
            }
        }
    }

    ```

7. <span data-ttu-id="cbe43-180">Replace the function name `pipeMessage` with `filterMessage` in `client.on()` function.</span><span class="sxs-lookup"><span data-stu-id="cbe43-180">Replace the function name `pipeMessage` with `filterMessage` in `client.on()` function.</span></span>

    ```javascript
    client.on('inputMessage', function (inputName, msg) {
        filterMessage(client, inputName, msg);
        });
    ```

8. <span data-ttu-id="cbe43-181">Copy the following code snippet into the `client.open()` function callback, after `client.on()` inside the `else` statement.</span><span class="sxs-lookup"><span data-stu-id="cbe43-181">Copy the following code snippet into the `client.open()` function callback, after `client.on()` inside the `else` statement.</span></span> <span data-ttu-id="cbe43-182">This function is invoked when the desired properties are updated.</span><span class="sxs-lookup"><span data-stu-id="cbe43-182">This function is invoked when the desired properties are updated.</span></span>

    ```javascript
    client.getTwin(function (err, twin) {
        if (err) {
            console.error('Error getting twin: ' + err.message);
        } else {
            twin.on('properties.desired', function(delta) {
                if (delta.TemperatureThreshold) {
                    temperatureThreshold = delta.TemperatureThreshold;
                }
            });
        }
    });
    ```

9. <span data-ttu-id="cbe43-183">Save this file.</span><span class="sxs-lookup"><span data-stu-id="cbe43-183">Save this file.</span></span>

## <a name="build-your-iot-edge-solution"></a><span data-ttu-id="cbe43-184">Build your IoT Edge solution</span><span class="sxs-lookup"><span data-stu-id="cbe43-184">Build your IoT Edge solution</span></span>

<span data-ttu-id="cbe43-185">In the previous section you created an IoT Edge solution and added code to the NodeModule that will filter out messages where the reported machine temperature is below the acceptable threshold.</span><span class="sxs-lookup"><span data-stu-id="cbe43-185">In the previous section you created an IoT Edge solution and added code to the NodeModule that will filter out messages where the reported machine temperature is below the acceptable threshold.</span></span> <span data-ttu-id="cbe43-186">Now you need to build the solution as a container image and push it to your container registry.</span><span class="sxs-lookup"><span data-stu-id="cbe43-186">Now you need to build the solution as a container image and push it to your container registry.</span></span> 

1. <span data-ttu-id="cbe43-187">Sign in to Docker by entering the following command in the Visual Studio Code integrated terminal, so you can push your module image to the ACR:</span><span class="sxs-lookup"><span data-stu-id="cbe43-187">Sign in to Docker by entering the following command in the Visual Studio Code integrated terminal, so you can push your module image to the ACR:</span></span> 
     
   ```csh/sh
   docker login -u <ACR username> -p <ACR password> <ACR login server>
   ```
   <span data-ttu-id="cbe43-188">Use the username, password, and login server that you copied from your Azure Container Registry in the first section.</span><span class="sxs-lookup"><span data-stu-id="cbe43-188">Use the username, password, and login server that you copied from your Azure Container Registry in the first section.</span></span> <span data-ttu-id="cbe43-189">Or retrieve them again from the **Access keys** section of your registry in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="cbe43-189">Or retrieve them again from the **Access keys** section of your registry in the Azure portal.</span></span>

2. <span data-ttu-id="cbe43-190">In the VS Code explorer, open the **deployment.template.json** file in your IoT Edge solution workspace.</span><span class="sxs-lookup"><span data-stu-id="cbe43-190">In the VS Code explorer, open the **deployment.template.json** file in your IoT Edge solution workspace.</span></span> 

   <span data-ttu-id="cbe43-191">This file tells the `$edgeAgent` to deploy two modules: **tempSensor**, which simulates device data, and **NodeModule**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-191">This file tells the `$edgeAgent` to deploy two modules: **tempSensor**, which simulates device data, and **NodeModule**.</span></span> <span data-ttu-id="cbe43-192">The `NodeModule.image` value is set to a Linux amd64 version of the image.</span><span class="sxs-lookup"><span data-stu-id="cbe43-192">The `NodeModule.image` value is set to a Linux amd64 version of the image.</span></span> <span data-ttu-id="cbe43-193">To learn more about deployment manifests, see [Understand how IoT Edge modules can be used, configured, and reused](module-composition.md).</span><span class="sxs-lookup"><span data-stu-id="cbe43-193">To learn more about deployment manifests, see [Understand how IoT Edge modules can be used, configured, and reused](module-composition.md).</span></span>

   <span data-ttu-id="cbe43-194">This file also contains your registry credentials.</span><span class="sxs-lookup"><span data-stu-id="cbe43-194">This file also contains your registry credentials.</span></span> <span data-ttu-id="cbe43-195">In the template file, your username and password are filled in with placeholders.</span><span class="sxs-lookup"><span data-stu-id="cbe43-195">In the template file, your username and password are filled in with placeholders.</span></span> <span data-ttu-id="cbe43-196">When you generate the deployment manifest, the fields are updated with the values you added to **.env**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-196">When you generate the deployment manifest, the fields are updated with the values you added to **.env**.</span></span> 

4. <span data-ttu-id="cbe43-197">Add the NodeModule module twin to the deployment manifest.</span><span class="sxs-lookup"><span data-stu-id="cbe43-197">Add the NodeModule module twin to the deployment manifest.</span></span> <span data-ttu-id="cbe43-198">Insert the following JSON content at the bottom of the `moduleContent` section, after the `$edgeHub` module twin:</span><span class="sxs-lookup"><span data-stu-id="cbe43-198">Insert the following JSON content at the bottom of the `moduleContent` section, after the `$edgeHub` module twin:</span></span> 
    ```json
        "NodeModule": {
            "properties.desired":{
                "TemperatureThreshold":25
            }
        }
    ```
5. <span data-ttu-id="cbe43-199">Save this file.</span><span class="sxs-lookup"><span data-stu-id="cbe43-199">Save this file.</span></span>
6. <span data-ttu-id="cbe43-200">In the VS Code explorer, right-click the **deployment.template.json** file and select **Build and Push IoT Edge solution**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-200">In the VS Code explorer, right-click the **deployment.template.json** file and select **Build and Push IoT Edge solution**.</span></span> 

<span data-ttu-id="cbe43-201">When you tell Visual Studio Code to build your solution, it first takes the information in the deployment template and generates a `deployment.json` file in a new **config** folder.</span><span class="sxs-lookup"><span data-stu-id="cbe43-201">When you tell Visual Studio Code to build your solution, it first takes the information in the deployment template and generates a `deployment.json` file in a new **config** folder.</span></span> <span data-ttu-id="cbe43-202">Then it runs two commands in the integrated terminal: `docker build` and `docker push`.</span><span class="sxs-lookup"><span data-stu-id="cbe43-202">Then it runs two commands in the integrated terminal: `docker build` and `docker push`.</span></span> <span data-ttu-id="cbe43-203">These two commands build your code, containerize the your Node.js code, and the push it to the container registry that you specified when you initialized the solution.</span><span class="sxs-lookup"><span data-stu-id="cbe43-203">These two commands build your code, containerize the your Node.js code, and the push it to the container registry that you specified when you initialized the solution.</span></span> 

<span data-ttu-id="cbe43-204">You can see the full container image address with tag in the `docker build` command that runs in the VS Code integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="cbe43-204">You can see the full container image address with tag in the `docker build` command that runs in the VS Code integrated terminal.</span></span> <span data-ttu-id="cbe43-205">The image address is built from information in the `module.json` file, with the format **\<repository\>:\<version\>-\<platform\>**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-205">The image address is built from information in the `module.json` file, with the format **\<repository\>:\<version\>-\<platform\>**.</span></span> <span data-ttu-id="cbe43-206">For this tutorial, it should look like **registryname.azurecr.io/nodemodule:0.0.1-amd64**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-206">For this tutorial, it should look like **registryname.azurecr.io/nodemodule:0.0.1-amd64**.</span></span>

## <a name="deploy-and-run-the-solution"></a><span data-ttu-id="cbe43-207">Deploy and run the solution</span><span class="sxs-lookup"><span data-stu-id="cbe43-207">Deploy and run the solution</span></span>

<span data-ttu-id="cbe43-208">In the quickstart article that you used to set up your IoT Edge device, you deployed a module by using the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="cbe43-208">In the quickstart article that you used to set up your IoT Edge device, you deployed a module by using the Azure portal.</span></span> <span data-ttu-id="cbe43-209">You can also deploy modules using the Azure IoT Toolkit extension for Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="cbe43-209">You can also deploy modules using the Azure IoT Toolkit extension for Visual Studio Code.</span></span> <span data-ttu-id="cbe43-210">You already have a deployment manifest prepared for your scenario, the **deployment.json** file.</span><span class="sxs-lookup"><span data-stu-id="cbe43-210">You already have a deployment manifest prepared for your scenario, the **deployment.json** file.</span></span> <span data-ttu-id="cbe43-211">All you need to do now is select a device to receive the deployment.</span><span class="sxs-lookup"><span data-stu-id="cbe43-211">All you need to do now is select a device to receive the deployment.</span></span>

1. <span data-ttu-id="cbe43-212">In the VS Code command palette, run **Azure IoT Hub: Select IoT Hub**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-212">In the VS Code command palette, run **Azure IoT Hub: Select IoT Hub**.</span></span> 

2. <span data-ttu-id="cbe43-213">Choose the subscription and IoT hub that contain the IoT Edge device that you want to configure.</span><span class="sxs-lookup"><span data-stu-id="cbe43-213">Choose the subscription and IoT hub that contain the IoT Edge device that you want to configure.</span></span> 

3. <span data-ttu-id="cbe43-214">In the VS Code explorer, expand the **Azure IoT Hub Devices** section.</span><span class="sxs-lookup"><span data-stu-id="cbe43-214">In the VS Code explorer, expand the **Azure IoT Hub Devices** section.</span></span> 

4. <span data-ttu-id="cbe43-215">Right-click the name of your IoT Edge device, then select **Create Deployment for Single Device**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-215">Right-click the name of your IoT Edge device, then select **Create Deployment for Single Device**.</span></span> 

   ![Create deployment for single device](./media/tutorial-node-module/create-deployment.png)

5. <span data-ttu-id="cbe43-217">Select the **deployment.json** file in the **config** folder and then click **Select Edge Deployment Manifest**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-217">Select the **deployment.json** file in the **config** folder and then click **Select Edge Deployment Manifest**.</span></span> <span data-ttu-id="cbe43-218">Do not use the deployment.template.json file.</span><span class="sxs-lookup"><span data-stu-id="cbe43-218">Do not use the deployment.template.json file.</span></span> 

6. <span data-ttu-id="cbe43-219">Click the refresh button.</span><span class="sxs-lookup"><span data-stu-id="cbe43-219">Click the refresh button.</span></span> <span data-ttu-id="cbe43-220">You should see the new **NodeModule** running along with the **TempSensor** module and the **$edgeAgent** and **$edgeHub**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-220">You should see the new **NodeModule** running along with the **TempSensor** module and the **$edgeAgent** and **$edgeHub**.</span></span> 


## <a name="view-generated-data"></a><span data-ttu-id="cbe43-221">View generated data</span><span class="sxs-lookup"><span data-stu-id="cbe43-221">View generated data</span></span>

1. <span data-ttu-id="cbe43-222">To monitor data arriving at the IoT hub, click **...**, and select **Start Monitoring D2C Messages**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-222">To monitor data arriving at the IoT hub, click **...**, and select **Start Monitoring D2C Messages**.</span></span>
2. <span data-ttu-id="cbe43-223">To monitor the D2C message for a specific device, right-click the device in the list, and select **Start Monitoring D2C Messages**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-223">To monitor the D2C message for a specific device, right-click the device in the list, and select **Start Monitoring D2C Messages**.</span></span>
3. <span data-ttu-id="cbe43-224">To stop monitoring data, run the command **Azure IoT Hub: Stop monitoring D2C message** in command palette.</span><span class="sxs-lookup"><span data-stu-id="cbe43-224">To stop monitoring data, run the command **Azure IoT Hub: Stop monitoring D2C message** in command palette.</span></span> 
4. <span data-ttu-id="cbe43-225">To view or update module twin, right-click the module in the list, and select **Edit module twin**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-225">To view or update module twin, right-click the module in the list, and select **Edit module twin**.</span></span> <span data-ttu-id="cbe43-226">To update the module twin, save the twin JSON file and right-click the editor area and select **Update Module Twin**.</span><span class="sxs-lookup"><span data-stu-id="cbe43-226">To update the module twin, save the twin JSON file and right-click the editor area and select **Update Module Twin**.</span></span>
5. <span data-ttu-id="cbe43-227">To view Docker logs, you can install [Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker) for VS Code and find your running modules locally in Docker explorer.</span><span class="sxs-lookup"><span data-stu-id="cbe43-227">To view Docker logs, you can install [Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker) for VS Code and find your running modules locally in Docker explorer.</span></span> <span data-ttu-id="cbe43-228">In the context menu, click **Show Logs** to view in integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="cbe43-228">In the context menu, click **Show Logs** to view in integrated terminal.</span></span> 

## <a name="clean-up-resources"></a><span data-ttu-id="cbe43-229">Clean up resources</span><span class="sxs-lookup"><span data-stu-id="cbe43-229">Clean up resources</span></span> 

<span data-ttu-id="cbe43-230">If you plan to continue to the next recommended article, you can keep the resources and configurations that you created and reuse them.</span><span class="sxs-lookup"><span data-stu-id="cbe43-230">If you plan to continue to the next recommended article, you can keep the resources and configurations that you created and reuse them.</span></span> <span data-ttu-id="cbe43-231">You can also keep using the same IoT Edge device as a test device.</span><span class="sxs-lookup"><span data-stu-id="cbe43-231">You can also keep using the same IoT Edge device as a test device.</span></span> 

<span data-ttu-id="cbe43-232">Otherwise, you can delete the local configurations and the Azure resources that you created in this article to avoid charges.</span><span class="sxs-lookup"><span data-stu-id="cbe43-232">Otherwise, you can delete the local configurations and the Azure resources that you created in this article to avoid charges.</span></span> 

[!INCLUDE [iot-edge-clean-up-cloud-resources](../../includes/iot-edge-clean-up-cloud-resources.md)]

[!INCLUDE [iot-edge-clean-up-local-resources](../../includes/iot-edge-clean-up-local-resources.md)]


## <a name="next-steps"></a><span data-ttu-id="cbe43-233">Next steps</span><span class="sxs-lookup"><span data-stu-id="cbe43-233">Next steps</span></span>

<span data-ttu-id="cbe43-234">In this tutorial, you created an IoT Edge module that contains code to filter raw data generated by your IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="cbe43-234">In this tutorial, you created an IoT Edge module that contains code to filter raw data generated by your IoT Edge device.</span></span> <span data-ttu-id="cbe43-235">You can continue on to either of the following tutorials to learn about other ways that Azure IoT Edge can help you turn data into business insights at the edge.</span><span class="sxs-lookup"><span data-stu-id="cbe43-235">You can continue on to either of the following tutorials to learn about other ways that Azure IoT Edge can help you turn data into business insights at the edge.</span></span>

> [!div class="nextstepaction"]
> <span data-ttu-id="cbe43-236">[Deploy Azure Function as a module](tutorial-deploy-function.md)
> [Deploy Azure Stream Analytics as a module](tutorial-deploy-stream-analytics.md)</span><span class="sxs-lookup"><span data-stu-id="cbe43-236">[Deploy Azure Function as a module](tutorial-deploy-function.md)
[Deploy Azure Stream Analytics as a module](tutorial-deploy-stream-analytics.md)</span></span>


<!-- Links -->
[lnk-tutorial1-win]: quickstart.md
[lnk-tutorial1-lin]: quickstart-linux.md

<!-- Images -->
[1]: ./media/tutorial-csharp-module/programcs.png
[2]: ./media/tutorial-csharp-module/build-module.png
[3]: ./media/tutorial-csharp-module/docker-os.png
