---
title: Debug Azure function modules for Azure IoT Edge | Microsoft Docs
description: Use Visual Studio Code to debug C# Azure functions with Azure IoT Edge
author: shizn
manager: ''
ms.author: xshi
ms.date: 06/26/2018
ms.topic: conceptual
ms.service: iot-edge
services: iot-edge
ms.openlocfilehash: 4b4f9bd1c7390d64a0db08b55bfb777498a10cb0
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44870687"
---
# <a name="use-visual-studio-code-to-develop-and-debug-azure-functions-for-azure-iot-edge"></a><span data-ttu-id="122e3-103">Use Visual Studio Code to develop and debug Azure functions for Azure IoT Edge</span><span class="sxs-lookup"><span data-stu-id="122e3-103">Use Visual Studio Code to develop and debug Azure functions for Azure IoT Edge</span></span>

<span data-ttu-id="122e3-104">This article shows you how to use [Visual Studio Code (VS Code)](https://code.visualstudio.com/) to debug your Azure functions on Azure IoT Edge.</span><span class="sxs-lookup"><span data-stu-id="122e3-104">This article shows you how to use [Visual Studio Code (VS Code)](https://code.visualstudio.com/) to debug your Azure functions on Azure IoT Edge.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="122e3-105">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="122e3-105">Prerequisites</span></span>
<span data-ttu-id="122e3-106">This article assumes that you use a computer or virtual machine running Windows or Linux as your development machine.</span><span class="sxs-lookup"><span data-stu-id="122e3-106">This article assumes that you use a computer or virtual machine running Windows or Linux as your development machine.</span></span> <span data-ttu-id="122e3-107">Your IoT Edge device can be another physical device.</span><span class="sxs-lookup"><span data-stu-id="122e3-107">Your IoT Edge device can be another physical device.</span></span> <span data-ttu-id="122e3-108">Or you can simulate your IoT Edge device on your development machine.</span><span class="sxs-lookup"><span data-stu-id="122e3-108">Or you can simulate your IoT Edge device on your development machine.</span></span>

> [!NOTE]
> <span data-ttu-id="122e3-109">This debugging article demonstrates how to attach a process in a module container and debug it with VS Code.</span><span class="sxs-lookup"><span data-stu-id="122e3-109">This debugging article demonstrates how to attach a process in a module container and debug it with VS Code.</span></span> <span data-ttu-id="122e3-110">You can only debug C# functions in Linux amd64 containers.</span><span class="sxs-lookup"><span data-stu-id="122e3-110">You can only debug C# functions in Linux amd64 containers.</span></span> <span data-ttu-id="122e3-111">If you aren't familiar with the debugging capabilities of Visual Studio Code, read about [Debugging](https://code.visualstudio.com/Docs/editor/debugging).</span><span class="sxs-lookup"><span data-stu-id="122e3-111">If you aren't familiar with the debugging capabilities of Visual Studio Code, read about [Debugging](https://code.visualstudio.com/Docs/editor/debugging).</span></span> 

<span data-ttu-id="122e3-112">This article uses Visual Studio Code as the main development tool.</span><span class="sxs-lookup"><span data-stu-id="122e3-112">This article uses Visual Studio Code as the main development tool.</span></span> <span data-ttu-id="122e3-113">Install VS Code.</span><span class="sxs-lookup"><span data-stu-id="122e3-113">Install VS Code.</span></span> <span data-ttu-id="122e3-114">Then add the necessary extensions:</span><span class="sxs-lookup"><span data-stu-id="122e3-114">Then add the necessary extensions:</span></span> 

* [<span data-ttu-id="122e3-115">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="122e3-115">Visual Studio Code</span></span>](https://code.visualstudio.com/) 
* [<span data-ttu-id="122e3-116">Azure IoT Edge extension</span><span class="sxs-lookup"><span data-stu-id="122e3-116">Azure IoT Edge extension</span></span>](https://marketplace.visualstudio.com/items?itemName=vsciot-vscode.azure-iot-edge) 
* [<span data-ttu-id="122e3-117">C# extension</span><span class="sxs-lookup"><span data-stu-id="122e3-117">C# extension</span></span>](https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp) 
* [<span data-ttu-id="122e3-118">Docker extension</span><span class="sxs-lookup"><span data-stu-id="122e3-118">Docker extension</span></span>](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker)

<span data-ttu-id="122e3-119">To create a module, you need .NET to build the project folder, Docker to build the module image, and a container registry to hold the module image:</span><span class="sxs-lookup"><span data-stu-id="122e3-119">To create a module, you need .NET to build the project folder, Docker to build the module image, and a container registry to hold the module image:</span></span>

* [<span data-ttu-id="122e3-120">.NET Core 2.1 SDK</span><span class="sxs-lookup"><span data-stu-id="122e3-120">.NET Core 2.1 SDK</span></span>](https://www.microsoft.com/net/download)
* <span data-ttu-id="122e3-121">[Docker Community Edition](https://docs.docker.com/install/) on your development machine</span><span class="sxs-lookup"><span data-stu-id="122e3-121">[Docker Community Edition](https://docs.docker.com/install/) on your development machine</span></span> 
* <span data-ttu-id="122e3-122">[Azure Container Registry](https://docs.microsoft.com/azure/container-registry/) or [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags)</span><span class="sxs-lookup"><span data-stu-id="122e3-122">[Azure Container Registry](https://docs.microsoft.com/azure/container-registry/) or [Docker Hub](https://docs.docker.com/docker-hub/repos/#viewing-repository-tags)</span></span>
   * <span data-ttu-id="122e3-123">You can use a local Docker registry for prototype and testing purposes instead of a cloud registry.</span><span class="sxs-lookup"><span data-stu-id="122e3-123">You can use a local Docker registry for prototype and testing purposes instead of a cloud registry.</span></span> 

<span data-ttu-id="122e3-124">To test your module on a device, you need an active IoT hub with at least one IoT Edge device.</span><span class="sxs-lookup"><span data-stu-id="122e3-124">To test your module on a device, you need an active IoT hub with at least one IoT Edge device.</span></span> <span data-ttu-id="122e3-125">To use your computer as an IoT Edge device, follow the steps in the quickstart for [Windows](quickstart.md) or [Linux](quickstart-linux.md).</span><span class="sxs-lookup"><span data-stu-id="122e3-125">To use your computer as an IoT Edge device, follow the steps in the quickstart for [Windows](quickstart.md) or [Linux](quickstart-linux.md).</span></span> 

## <a name="create-a-new-solution-template"></a><span data-ttu-id="122e3-126">Create a new solution template</span><span class="sxs-lookup"><span data-stu-id="122e3-126">Create a new solution template</span></span>

<span data-ttu-id="122e3-127">Take these steps to create an IoT Edge solution that has one C# function module.</span><span class="sxs-lookup"><span data-stu-id="122e3-127">Take these steps to create an IoT Edge solution that has one C# function module.</span></span> <span data-ttu-id="122e3-128">Each solution can have several modules.</span><span class="sxs-lookup"><span data-stu-id="122e3-128">Each solution can have several modules.</span></span>

1. <span data-ttu-id="122e3-129">In Visual Studio Code, select **View** > **Integrated Terminal**.</span><span class="sxs-lookup"><span data-stu-id="122e3-129">In Visual Studio Code, select **View** > **Integrated Terminal**.</span></span>
3. <span data-ttu-id="122e3-130">Select **View** > **Command Palette**.</span><span class="sxs-lookup"><span data-stu-id="122e3-130">Select **View** > **Command Palette**.</span></span>
4. <span data-ttu-id="122e3-131">In the command palette, enter and run the command **Azure IoT Edge: New IoT Edge Solution**.</span><span class="sxs-lookup"><span data-stu-id="122e3-131">In the command palette, enter and run the command **Azure IoT Edge: New IoT Edge Solution**.</span></span> 

   ![Run new IoT Edge solution](./media/how-to-develop-csharp-module/new-solution.png)

5. <span data-ttu-id="122e3-133">Browse to the folder where you want to create the new solution.</span><span class="sxs-lookup"><span data-stu-id="122e3-133">Browse to the folder where you want to create the new solution.</span></span> <span data-ttu-id="122e3-134">Choose **Select folder**.</span><span class="sxs-lookup"><span data-stu-id="122e3-134">Choose **Select folder**.</span></span> 
6. <span data-ttu-id="122e3-135">Enter a name for your solution.</span><span class="sxs-lookup"><span data-stu-id="122e3-135">Enter a name for your solution.</span></span> 
7. <span data-ttu-id="122e3-136">Choose **Azure Functions - C#** as the template for the first module in the solution.</span><span class="sxs-lookup"><span data-stu-id="122e3-136">Choose **Azure Functions - C#** as the template for the first module in the solution.</span></span>
8. <span data-ttu-id="122e3-137">Enter a name for your module.</span><span class="sxs-lookup"><span data-stu-id="122e3-137">Enter a name for your module.</span></span> <span data-ttu-id="122e3-138">Choose a name that's unique within your container registry.</span><span class="sxs-lookup"><span data-stu-id="122e3-138">Choose a name that's unique within your container registry.</span></span> 
9. <span data-ttu-id="122e3-139">Provide the image repository for the module.</span><span class="sxs-lookup"><span data-stu-id="122e3-139">Provide the image repository for the module.</span></span> <span data-ttu-id="122e3-140">VS Code autopopulates the module name with **localhost:5000**.</span><span class="sxs-lookup"><span data-stu-id="122e3-140">VS Code autopopulates the module name with **localhost:5000**.</span></span> <span data-ttu-id="122e3-141">Replace it with your own registry information.</span><span class="sxs-lookup"><span data-stu-id="122e3-141">Replace it with your own registry information.</span></span> <span data-ttu-id="122e3-142">If you use a local Docker registry for testing, then **localhost** is fine.</span><span class="sxs-lookup"><span data-stu-id="122e3-142">If you use a local Docker registry for testing, then **localhost** is fine.</span></span> <span data-ttu-id="122e3-143">If you use Azure Container Registry, then use the login server from your registry's settings.</span><span class="sxs-lookup"><span data-stu-id="122e3-143">If you use Azure Container Registry, then use the login server from your registry's settings.</span></span> <span data-ttu-id="122e3-144">The login server looks like **\<registry name\>.azurecr.io**.</span><span class="sxs-lookup"><span data-stu-id="122e3-144">The login server looks like **\<registry name\>.azurecr.io**.</span></span> <span data-ttu-id="122e3-145">Only replace the localhost part of the string, don't delete your module name.</span><span class="sxs-lookup"><span data-stu-id="122e3-145">Only replace the localhost part of the string, don't delete your module name.</span></span>

   ![Provide Docker image repository](./media/how-to-develop-csharp-function/repository.png)

<span data-ttu-id="122e3-147">VS Code takes the information you provided, creates an IoT Edge solution with an Azure Functions project, and then loads it in a new window.</span><span class="sxs-lookup"><span data-stu-id="122e3-147">VS Code takes the information you provided, creates an IoT Edge solution with an Azure Functions project, and then loads it in a new window.</span></span>

<span data-ttu-id="122e3-148">There are four items within the solution:</span><span class="sxs-lookup"><span data-stu-id="122e3-148">There are four items within the solution:</span></span> 

* <span data-ttu-id="122e3-149">A **.vscode** folder contains debug configurations.</span><span class="sxs-lookup"><span data-stu-id="122e3-149">A **.vscode** folder contains debug configurations.</span></span>
* <span data-ttu-id="122e3-150">A **modules** folder has subfolders for each module.</span><span class="sxs-lookup"><span data-stu-id="122e3-150">A **modules** folder has subfolders for each module.</span></span> <span data-ttu-id="122e3-151">At this point, you only have one.</span><span class="sxs-lookup"><span data-stu-id="122e3-151">At this point, you only have one.</span></span> <span data-ttu-id="122e3-152">But you can add more through the command palette with the command **Azure IoT Edge: Add IoT Edge Module**.</span><span class="sxs-lookup"><span data-stu-id="122e3-152">But you can add more through the command palette with the command **Azure IoT Edge: Add IoT Edge Module**.</span></span>
* <span data-ttu-id="122e3-153">An **.env** file lists your environment variables.</span><span class="sxs-lookup"><span data-stu-id="122e3-153">An **.env** file lists your environment variables.</span></span> <span data-ttu-id="122e3-154">If Azure Container Registry is your registry, you'll have an Azure Container Registry username and password in it.</span><span class="sxs-lookup"><span data-stu-id="122e3-154">If Azure Container Registry is your registry, you'll have an Azure Container Registry username and password in it.</span></span> 

   >[!NOTE]
   ><span data-ttu-id="122e3-155">The environment file is only created if you provide an image repository for the module.</span><span class="sxs-lookup"><span data-stu-id="122e3-155">The environment file is only created if you provide an image repository for the module.</span></span> <span data-ttu-id="122e3-156">If you accepted the localhost defaults to test and debug locally, then you don't need to declare environment variables.</span><span class="sxs-lookup"><span data-stu-id="122e3-156">If you accepted the localhost defaults to test and debug locally, then you don't need to declare environment variables.</span></span> 

* <span data-ttu-id="122e3-157">A **deployment.template.json** file lists your new module along with a sample **tempSensor** module that simulates data you can use for testing.</span><span class="sxs-lookup"><span data-stu-id="122e3-157">A **deployment.template.json** file lists your new module along with a sample **tempSensor** module that simulates data you can use for testing.</span></span> <span data-ttu-id="122e3-158">For more information about how deployment manifests work, see [Learn how to use deployment manifests to deploy modules and establish routes](module-composition.md).</span><span class="sxs-lookup"><span data-stu-id="122e3-158">For more information about how deployment manifests work, see [Learn how to use deployment manifests to deploy modules and establish routes](module-composition.md).</span></span>

## <a name="develop-your-module"></a><span data-ttu-id="122e3-159">Develop your module</span><span class="sxs-lookup"><span data-stu-id="122e3-159">Develop your module</span></span>

<span data-ttu-id="122e3-160">The default Azure Function code that comes with the solution is located at **modules** > [your module name] > **EdgeHubTrigger-Csharp** > **run.csx**.</span><span class="sxs-lookup"><span data-stu-id="122e3-160">The default Azure Function code that comes with the solution is located at **modules** > [your module name] > **EdgeHubTrigger-Csharp** > **run.csx**.</span></span> <span data-ttu-id="122e3-161">The module and the deployment.template.json file are set up so that you can build the solution, push it to your container registry, and deploy it to a device to start testing without touching any code.</span><span class="sxs-lookup"><span data-stu-id="122e3-161">The module and the deployment.template.json file are set up so that you can build the solution, push it to your container registry, and deploy it to a device to start testing without touching any code.</span></span> <span data-ttu-id="122e3-162">The module is built to simply take input from a source (in this case, the tempSensor module that simulates data) and pipe it to IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="122e3-162">The module is built to simply take input from a source (in this case, the tempSensor module that simulates data) and pipe it to IoT Hub.</span></span> 

<span data-ttu-id="122e3-163">When you're ready to customize the Azure Function template with your own code, use the [Azure IoT Hub SDKs](../iot-hub/iot-hub-devguide-sdks.md) to build modules that address the key needs for IoT solutions such as security, device management, and reliability.</span><span class="sxs-lookup"><span data-stu-id="122e3-163">When you're ready to customize the Azure Function template with your own code, use the [Azure IoT Hub SDKs](../iot-hub/iot-hub-devguide-sdks.md) to build modules that address the key needs for IoT solutions such as security, device management, and reliability.</span></span> 

## <a name="build-your-module-for-debugging"></a><span data-ttu-id="122e3-164">Build your module for debugging</span><span class="sxs-lookup"><span data-stu-id="122e3-164">Build your module for debugging</span></span>
1. <span data-ttu-id="122e3-165">To start debugging, use **Dockerfile.amd64.debug** to rebuild your docker image and deploy your Edge solution again.</span><span class="sxs-lookup"><span data-stu-id="122e3-165">To start debugging, use **Dockerfile.amd64.debug** to rebuild your docker image and deploy your Edge solution again.</span></span> <span data-ttu-id="122e3-166">In VS Code explorer, navigate to the `deployment.template.json` file.</span><span class="sxs-lookup"><span data-stu-id="122e3-166">In VS Code explorer, navigate to the `deployment.template.json` file.</span></span> <span data-ttu-id="122e3-167">Update your function image URL by adding `.debug` to the end.</span><span class="sxs-lookup"><span data-stu-id="122e3-167">Update your function image URL by adding `.debug` to the end.</span></span>

    ![Build debug image](./media/how-to-debug-csharp-function/build-debug-image.png)

2. <span data-ttu-id="122e3-169">Rebuild your solution.</span><span class="sxs-lookup"><span data-stu-id="122e3-169">Rebuild your solution.</span></span> <span data-ttu-id="122e3-170">In the VS Code command palette, enter and run the command **Azure IoT Edge: Build IoT Edge solution**.</span><span class="sxs-lookup"><span data-stu-id="122e3-170">In the VS Code command palette, enter and run the command **Azure IoT Edge: Build IoT Edge solution**.</span></span>
3. <span data-ttu-id="122e3-171">In Azure IoT Hub Devices explorer, right-click an IoT Edge device ID, and then select **Create deployment for Edge device**.</span><span class="sxs-lookup"><span data-stu-id="122e3-171">In Azure IoT Hub Devices explorer, right-click an IoT Edge device ID, and then select **Create deployment for Edge device**.</span></span> <span data-ttu-id="122e3-172">Select the `deployment.json` file in the `config` folder.</span><span class="sxs-lookup"><span data-stu-id="122e3-172">Select the `deployment.json` file in the `config` folder.</span></span> <span data-ttu-id="122e3-173">You'll see the deployment successfully created with a deployment ID in a VS Code-integrated terminal.</span><span class="sxs-lookup"><span data-stu-id="122e3-173">You'll see the deployment successfully created with a deployment ID in a VS Code-integrated terminal.</span></span>

<span data-ttu-id="122e3-174">Check your container status in VS Code Docker explorer or by running the `docker ps` command in the terminal.</span><span class="sxs-lookup"><span data-stu-id="122e3-174">Check your container status in VS Code Docker explorer or by running the `docker ps` command in the terminal.</span></span>

## <a name="start-debugging-c-functions-in-vs-code"></a><span data-ttu-id="122e3-175">Start debugging C# functions in VS Code</span><span class="sxs-lookup"><span data-stu-id="122e3-175">Start debugging C# functions in VS Code</span></span>
1. <span data-ttu-id="122e3-176">VS Code keeps debugging configuration information in a `launch.json` file located in a `.vscode` folder in your workspace.</span><span class="sxs-lookup"><span data-stu-id="122e3-176">VS Code keeps debugging configuration information in a `launch.json` file located in a `.vscode` folder in your workspace.</span></span> <span data-ttu-id="122e3-177">This `launch.json` file was generated when you created a new IoT Edge solution.</span><span class="sxs-lookup"><span data-stu-id="122e3-177">This `launch.json` file was generated when you created a new IoT Edge solution.</span></span> <span data-ttu-id="122e3-178">It updates each time you add a new module that supports debugging.</span><span class="sxs-lookup"><span data-stu-id="122e3-178">It updates each time you add a new module that supports debugging.</span></span> <span data-ttu-id="122e3-179">Navigate to the debug view.</span><span class="sxs-lookup"><span data-stu-id="122e3-179">Navigate to the debug view.</span></span> <span data-ttu-id="122e3-180">Select the corresponding debug configuration file.</span><span class="sxs-lookup"><span data-stu-id="122e3-180">Select the corresponding debug configuration file.</span></span> <span data-ttu-id="122e3-181">The debug option name should be similar to **ModuleName Remote Debug (.NET Core)**.</span><span class="sxs-lookup"><span data-stu-id="122e3-181">The debug option name should be similar to **ModuleName Remote Debug (.NET Core)**.</span></span>

   ![Select debug configuration](./media/how-to-debug-csharp-function/select-debug-configuration.jpg)

2. <span data-ttu-id="122e3-183">Navigate to `run.csx`.</span><span class="sxs-lookup"><span data-stu-id="122e3-183">Navigate to `run.csx`.</span></span> <span data-ttu-id="122e3-184">Add a breakpoint in the function.</span><span class="sxs-lookup"><span data-stu-id="122e3-184">Add a breakpoint in the function.</span></span>
3. <span data-ttu-id="122e3-185">Select **Start Debugging** or select **F5**.</span><span class="sxs-lookup"><span data-stu-id="122e3-185">Select **Start Debugging** or select **F5**.</span></span> <span data-ttu-id="122e3-186">Select the process to attach to.</span><span class="sxs-lookup"><span data-stu-id="122e3-186">Select the process to attach to.</span></span>
4. <span data-ttu-id="122e3-187">In VS Code debug view, you'll see the variables in the left panel.</span><span class="sxs-lookup"><span data-stu-id="122e3-187">In VS Code debug view, you'll see the variables in the left panel.</span></span> 


> [!NOTE]
> <span data-ttu-id="122e3-188">This example shows how to debug .Net Core IoT Edge functions on containers.</span><span class="sxs-lookup"><span data-stu-id="122e3-188">This example shows how to debug .Net Core IoT Edge functions on containers.</span></span> <span data-ttu-id="122e3-189">It's based on the debug version of the `Dockerfile.amd64.debug`, which includes the .NET Core command-line debugger VSDBG in your container image while building it.</span><span class="sxs-lookup"><span data-stu-id="122e3-189">It's based on the debug version of the `Dockerfile.amd64.debug`, which includes the .NET Core command-line debugger VSDBG in your container image while building it.</span></span> <span data-ttu-id="122e3-190">We recommend that you directly use or customize the `Dockerfile` without VSDBG for production-ready IoT Edge functions after you debug your C# functions.</span><span class="sxs-lookup"><span data-stu-id="122e3-190">We recommend that you directly use or customize the `Dockerfile` without VSDBG for production-ready IoT Edge functions after you debug your C# functions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="122e3-191">Next steps</span><span class="sxs-lookup"><span data-stu-id="122e3-191">Next steps</span></span>

<span data-ttu-id="122e3-192">After you've built your module, learn how to [Deploy Azure IoT Edge modules from Visual Studio Code](how-to-deploy-modules-vscode.md).</span><span class="sxs-lookup"><span data-stu-id="122e3-192">After you've built your module, learn how to [Deploy Azure IoT Edge modules from Visual Studio Code](how-to-deploy-modules-vscode.md).</span></span>

<span data-ttu-id="122e3-193">To develop modules for your IoT Edge devices, [Understand and use Azure IoT Hub SDKs](../iot-hub/iot-hub-devguide-sdks.md).</span><span class="sxs-lookup"><span data-stu-id="122e3-193">To develop modules for your IoT Edge devices, [Understand and use Azure IoT Hub SDKs](../iot-hub/iot-hub-devguide-sdks.md).</span></span>
