---
title: Create self-hosted integration runtime in Azure Data Factory | Microsoft Docs
description: Learn how to create self-hosted integration runtime in Azure Data Factory, which allows data factories to access data stores in a private network.
services: data-factory
documentationcenter: ''
author: nabhishek
manager: craigg
ms.service: data-factory
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 01/15/2018
ms.author: abnarain
ms.openlocfilehash: 7948b54bd6402cf238c5709d270087746ed4fa95
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44965868"
---
# <a name="how-to-create-and-configure-self-hosted-integration-runtime"></a><span data-ttu-id="7e081-103">How to create and configure Self-hosted Integration Runtime</span><span class="sxs-lookup"><span data-stu-id="7e081-103">How to create and configure Self-hosted Integration Runtime</span></span>
<span data-ttu-id="7e081-104">The Integration Runtime (IR) is the compute infrastructure used by Azure Data Factory to provide data integration capabilities across different network environments.</span><span class="sxs-lookup"><span data-stu-id="7e081-104">The Integration Runtime (IR) is the compute infrastructure used by Azure Data Factory to provide data integration capabilities across different network environments.</span></span> <span data-ttu-id="7e081-105">For details about IR, see [Integration Runtime Overview](concepts-integration-runtime.md).</span><span class="sxs-lookup"><span data-stu-id="7e081-105">For details about IR, see [Integration Runtime Overview](concepts-integration-runtime.md).</span></span>

<span data-ttu-id="7e081-106">A self-hosted integration runtime is capable of running copy activities between a cloud data stores and a data store in private network and dispatching transform activities against compute resources in an on-premises or Azure Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="7e081-106">A self-hosted integration runtime is capable of running copy activities between a cloud data stores and a data store in private network and dispatching transform activities against compute resources in an on-premises or Azure Virtual Network.</span></span> <span data-ttu-id="7e081-107">Install Self-hosted integration runtime needs on an on-premises machine or a virtual machine inside a private network.</span><span class="sxs-lookup"><span data-stu-id="7e081-107">Install Self-hosted integration runtime needs on an on-premises machine or a virtual machine inside a private network.</span></span>  

<span data-ttu-id="7e081-108">This document introduces how you can create and configure Self-hosted IR.</span><span class="sxs-lookup"><span data-stu-id="7e081-108">This document introduces how you can create and configure Self-hosted IR.</span></span>

## <a name="high-level-steps-to-install-self-hosted-ir"></a><span data-ttu-id="7e081-109">High-level steps to install self-hosted IR</span><span class="sxs-lookup"><span data-stu-id="7e081-109">High-level steps to install self-hosted IR</span></span>
1. <span data-ttu-id="7e081-110">Create a Self-hosted integration runtime.</span><span class="sxs-lookup"><span data-stu-id="7e081-110">Create a Self-hosted integration runtime.</span></span> <span data-ttu-id="7e081-111">You can use ADF UI for creating the self-hosted IR.</span><span class="sxs-lookup"><span data-stu-id="7e081-111">You can use ADF UI for creating the self-hosted IR.</span></span> <span data-ttu-id="7e081-112">Here is a PowerShell example:</span><span class="sxs-lookup"><span data-stu-id="7e081-112">Here is a PowerShell example:</span></span>

    ```powershell
    Set-AzureRmDataFactoryV2IntegrationRuntime -ResourceGroupName $resourceGroupName -DataFactoryName $dataFactoryName -Name $selfHostedIntegrationRuntimeName -Type SelfHosted -Description "selfhosted IR description"
    ```
2. <span data-ttu-id="7e081-113">Download and install self-hosted integration runtime (on local machine).</span><span class="sxs-lookup"><span data-stu-id="7e081-113">Download and install self-hosted integration runtime (on local machine).</span></span>
3. <span data-ttu-id="7e081-114">Retrieve authentication key and register self-hosted integration runtime with the key.</span><span class="sxs-lookup"><span data-stu-id="7e081-114">Retrieve authentication key and register self-hosted integration runtime with the key.</span></span> <span data-ttu-id="7e081-115">Here is a PowerShell example:</span><span class="sxs-lookup"><span data-stu-id="7e081-115">Here is a PowerShell example:</span></span>

    ```powershell
    Get-AzureRmDataFactoryV2IntegrationRuntimeKey -ResourceGroupName $resourceGroupName -DataFactoryName $dataFactoryName -Name $selfHostedIntegrationRuntime.  
    ```

## <a name="setting-up-self-hosted-ir-on-azure-vm-using-azure-resource-manager-template-automation"></a><span data-ttu-id="7e081-116">Setting up self-hosted IR on Azure VM using Azure Resource Manager Template (automation)</span><span class="sxs-lookup"><span data-stu-id="7e081-116">Setting up self-hosted IR on Azure VM using Azure Resource Manager Template (automation)</span></span>
<span data-ttu-id="7e081-117">You can automate self-hosted IR setup on an Azure VM using [this Azure Resource Manager template](https://github.com/Azure/azure-quickstart-templates/tree/master/101-vms-with-selfhost-integration-runtime).</span><span class="sxs-lookup"><span data-stu-id="7e081-117">You can automate self-hosted IR setup on an Azure VM using [this Azure Resource Manager template](https://github.com/Azure/azure-quickstart-templates/tree/master/101-vms-with-selfhost-integration-runtime).</span></span> <span data-ttu-id="7e081-118">This provides an easy way to have a fully functioning Self-hosted IR inside Azure VNet with High Avalaibility and Scalability feature (as long as you set node count to be 2 or higher).</span><span class="sxs-lookup"><span data-stu-id="7e081-118">This provides an easy way to have a fully functioning Self-hosted IR inside Azure VNet with High Avalaibility and Scalability feature (as long as you set node count to be 2 or higher).</span></span>

## <a name="command-flow-and-data-flow"></a><span data-ttu-id="7e081-119">Command flow and data flow</span><span class="sxs-lookup"><span data-stu-id="7e081-119">Command flow and data flow</span></span>
<span data-ttu-id="7e081-120">When you move the data between on-premises and cloud, the activity uses a self-hosted integration runtime to transfer the data from on-premises data source to cloud and vice versa.</span><span class="sxs-lookup"><span data-stu-id="7e081-120">When you move the data between on-premises and cloud, the activity uses a self-hosted integration runtime to transfer the data from on-premises data source to cloud and vice versa.</span></span>

<span data-ttu-id="7e081-121">Here is a high-level data flow for the summary of steps for copy with self-hosted IR:</span><span class="sxs-lookup"><span data-stu-id="7e081-121">Here is a high-level data flow for the summary of steps for copy with self-hosted IR:</span></span>

![High-level overview](media\create-self-hosted-integration-runtime\high-level-overview.png)

1. <span data-ttu-id="7e081-123">Data developer creates a self-hosted integration runtime within an Azure data factory using a PowerShell cmdlet.</span><span class="sxs-lookup"><span data-stu-id="7e081-123">Data developer creates a self-hosted integration runtime within an Azure data factory using a PowerShell cmdlet.</span></span> <span data-ttu-id="7e081-124">Currently, the Azure portal does not support this feature.</span><span class="sxs-lookup"><span data-stu-id="7e081-124">Currently, the Azure portal does not support this feature.</span></span>
2. <span data-ttu-id="7e081-125">Data developer creates a linked service for an on-premises data store by specifying the self-hosted integration runtime instance that it should use to connect to data stores.</span><span class="sxs-lookup"><span data-stu-id="7e081-125">Data developer creates a linked service for an on-premises data store by specifying the self-hosted integration runtime instance that it should use to connect to data stores.</span></span> <span data-ttu-id="7e081-126">As part of setting up the linked service, data developer uses the ‘Credential Manager’ application (currently, not supported) for setting authentication types and credentials.</span><span class="sxs-lookup"><span data-stu-id="7e081-126">As part of setting up the linked service, data developer uses the ‘Credential Manager’ application (currently, not supported) for setting authentication types and credentials.</span></span> <span data-ttu-id="7e081-127">The Credential manager application dialog communicates with the data store to test connection and the self-hosted integration runtime to save credentials.</span><span class="sxs-lookup"><span data-stu-id="7e081-127">The Credential manager application dialog communicates with the data store to test connection and the self-hosted integration runtime to save credentials.</span></span>
   - <span data-ttu-id="7e081-128">Self-hosted integration runtime node encrypts the credential using Windows Data Protection Application Programming Interface (DPAPI) and saves it locally.</span><span class="sxs-lookup"><span data-stu-id="7e081-128">Self-hosted integration runtime node encrypts the credential using Windows Data Protection Application Programming Interface (DPAPI) and saves it locally.</span></span> <span data-ttu-id="7e081-129">If multiple nodes are set for high availability, the credentials are further synchronized across other nodes.</span><span class="sxs-lookup"><span data-stu-id="7e081-129">If multiple nodes are set for high availability, the credentials are further synchronized across other nodes.</span></span> <span data-ttu-id="7e081-130">Each node encrypts it using DPAPI and stores it locally.</span><span class="sxs-lookup"><span data-stu-id="7e081-130">Each node encrypts it using DPAPI and stores it locally.</span></span> <span data-ttu-id="7e081-131">Credential synchronization is transparent to the data developer and is handled by self-hosted IR.</span><span class="sxs-lookup"><span data-stu-id="7e081-131">Credential synchronization is transparent to the data developer and is handled by self-hosted IR.</span></span>    
   - <span data-ttu-id="7e081-132">Data Factory service communicates with the self-hosted integration runtime for scheduling & management of jobs via **control channel** that uses a shared Azure service bus queue.</span><span class="sxs-lookup"><span data-stu-id="7e081-132">Data Factory service communicates with the self-hosted integration runtime for scheduling & management of jobs via **control channel** that uses a shared Azure service bus queue.</span></span> <span data-ttu-id="7e081-133">When an activity job needs to be run, Data Factory queues the request along with any credential information (in case credentials are not already stored on the self-hosted integration runtime).</span><span class="sxs-lookup"><span data-stu-id="7e081-133">When an activity job needs to be run, Data Factory queues the request along with any credential information (in case credentials are not already stored on the self-hosted integration runtime).</span></span> <span data-ttu-id="7e081-134">Self-hosted integration runtime kicks off the job after polling the queue.</span><span class="sxs-lookup"><span data-stu-id="7e081-134">Self-hosted integration runtime kicks off the job after polling the queue.</span></span>
   - <span data-ttu-id="7e081-135">Self-hosted integration runtime copies data from an on-premises store to a cloud storage, or vice versa depending on how the copy activity is configured in the data pipeline.</span><span class="sxs-lookup"><span data-stu-id="7e081-135">Self-hosted integration runtime copies data from an on-premises store to a cloud storage, or vice versa depending on how the copy activity is configured in the data pipeline.</span></span> <span data-ttu-id="7e081-136">For this step, the self-hosted integration runtime directly communicates with cloud-based storage services such as Azure Blob Storage over a secure (HTTPS) channel.</span><span class="sxs-lookup"><span data-stu-id="7e081-136">For this step, the self-hosted integration runtime directly communicates with cloud-based storage services such as Azure Blob Storage over a secure (HTTPS) channel.</span></span>

## <a name="considerations-for-using-self-hosted-ir"></a><span data-ttu-id="7e081-137">Considerations for using self-hosted IR</span><span class="sxs-lookup"><span data-stu-id="7e081-137">Considerations for using self-hosted IR</span></span>

- <span data-ttu-id="7e081-138">A single self-hosted integration runtime can be used for multiple on-premises data sources.</span><span class="sxs-lookup"><span data-stu-id="7e081-138">A single self-hosted integration runtime can be used for multiple on-premises data sources.</span></span> <span data-ttu-id="7e081-139">However, a **single self-hosted integration runtime is tied to only one Azure data factory** and cannot be shared with another data factory.</span><span class="sxs-lookup"><span data-stu-id="7e081-139">However, a **single self-hosted integration runtime is tied to only one Azure data factory** and cannot be shared with another data factory.</span></span>
- <span data-ttu-id="7e081-140">You can have **only one instance of self-hosted integration runtime** installed on a single machine.</span><span class="sxs-lookup"><span data-stu-id="7e081-140">You can have **only one instance of self-hosted integration runtime** installed on a single machine.</span></span> <span data-ttu-id="7e081-141">Suppose, you have two data factories that need to access on-premises data sources, you need to install self-hosted integration runtime on two on-premises computers.</span><span class="sxs-lookup"><span data-stu-id="7e081-141">Suppose, you have two data factories that need to access on-premises data sources, you need to install self-hosted integration runtime on two on-premises computers.</span></span> <span data-ttu-id="7e081-142">In other words, a self-hosted integration runtime is tied to a specific data factory</span><span class="sxs-lookup"><span data-stu-id="7e081-142">In other words, a self-hosted integration runtime is tied to a specific data factory</span></span>
- <span data-ttu-id="7e081-143">The **self-hosted integration runtime does not need to be on the same machine as the data source**.</span><span class="sxs-lookup"><span data-stu-id="7e081-143">The **self-hosted integration runtime does not need to be on the same machine as the data source**.</span></span> <span data-ttu-id="7e081-144">However, having self-hosted integration runtime closer to the data source reduces the time for the self-hosted integration runtime to connect to the data source.</span><span class="sxs-lookup"><span data-stu-id="7e081-144">However, having self-hosted integration runtime closer to the data source reduces the time for the self-hosted integration runtime to connect to the data source.</span></span> <span data-ttu-id="7e081-145">We recommend that you install the self-hosted integration runtime on a machine that is different from the one that hosts on-premises data source.</span><span class="sxs-lookup"><span data-stu-id="7e081-145">We recommend that you install the self-hosted integration runtime on a machine that is different from the one that hosts on-premises data source.</span></span> <span data-ttu-id="7e081-146">When the self-hosted integration runtime and data source are on different machines, the self-hosted integration runtime does not compete for resources with data source.</span><span class="sxs-lookup"><span data-stu-id="7e081-146">When the self-hosted integration runtime and data source are on different machines, the self-hosted integration runtime does not compete for resources with data source.</span></span>
- <span data-ttu-id="7e081-147">You can have **multiple self-hosted integration runtimes on different machines connecting to the same on-premises data source**.</span><span class="sxs-lookup"><span data-stu-id="7e081-147">You can have **multiple self-hosted integration runtimes on different machines connecting to the same on-premises data source**.</span></span> <span data-ttu-id="7e081-148">For example, you may have two self-hosted integration runtime serving two data factories but the same on-premises data source is registered with both the data factories.</span><span class="sxs-lookup"><span data-stu-id="7e081-148">For example, you may have two self-hosted integration runtime serving two data factories but the same on-premises data source is registered with both the data factories.</span></span>
- <span data-ttu-id="7e081-149">If you already have a gateway installed on your computer serving a **Power BI** scenario, install a **separate self-hosted integration runtime for Azure Data Factory** on another machine.</span><span class="sxs-lookup"><span data-stu-id="7e081-149">If you already have a gateway installed on your computer serving a **Power BI** scenario, install a **separate self-hosted integration runtime for Azure Data Factory** on another machine.</span></span>
- <span data-ttu-id="7e081-150">Self-hosted integration runtime must be used for supporting data integration within Azure Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="7e081-150">Self-hosted integration runtime must be used for supporting data integration within Azure Virtual Network.</span></span>
- <span data-ttu-id="7e081-151">Treat your data source as an on-premises data source (that is behind a firewall) even when you use **ExpressRoute**.</span><span class="sxs-lookup"><span data-stu-id="7e081-151">Treat your data source as an on-premises data source (that is behind a firewall) even when you use **ExpressRoute**.</span></span> <span data-ttu-id="7e081-152">Use the self-hosted integration runtime to establish connectivity between the service and the data source.</span><span class="sxs-lookup"><span data-stu-id="7e081-152">Use the self-hosted integration runtime to establish connectivity between the service and the data source.</span></span>
- <span data-ttu-id="7e081-153">You must use the self-hosted integration runtime even if the data store is in the cloud on an **Azure IaaS virtual machine**.</span><span class="sxs-lookup"><span data-stu-id="7e081-153">You must use the self-hosted integration runtime even if the data store is in the cloud on an **Azure IaaS virtual machine**.</span></span>
- <span data-ttu-id="7e081-154">Tasks may fail in a Self-hosted Integration Runtime installed on a Windows Server on which FIPS-compliant encryption is enabled.</span><span class="sxs-lookup"><span data-stu-id="7e081-154">Tasks may fail in a Self-hosted Integration Runtime installed on a Windows Server on which FIPS-compliant encryption is enabled.</span></span> <span data-ttu-id="7e081-155">To work around this issue, disable FIPS-compliant encryption on the server.</span><span class="sxs-lookup"><span data-stu-id="7e081-155">To work around this issue, disable FIPS-compliant encryption on the server.</span></span> <span data-ttu-id="7e081-156">To disable FIPS-compliant encryption, change the following registry value from 1 (enabled) to 0 (disabled): `HKLM\System\CurrentControlSet\Control\Lsa\FIPSAlgorithmPolicy\Enabled`.</span><span class="sxs-lookup"><span data-stu-id="7e081-156">To disable FIPS-compliant encryption, change the following registry value from 1 (enabled) to 0 (disabled): `HKLM\System\CurrentControlSet\Control\Lsa\FIPSAlgorithmPolicy\Enabled`.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="7e081-157">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="7e081-157">Prerequisites</span></span>

- <span data-ttu-id="7e081-158">The supported **Operating System** versions are Windows 7 Service Pack 1, Windows 8.1, Windows 10, Windows Server 2008 R2 SP1, Windows Server 2012, Windows Server 2012 R2, Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="7e081-158">The supported **Operating System** versions are Windows 7 Service Pack 1, Windows 8.1, Windows 10, Windows Server 2008 R2 SP1, Windows Server 2012, Windows Server 2012 R2, Windows Server 2016.</span></span> <span data-ttu-id="7e081-159">Installation of the self-hosted integration runtime on a **domain controller is not supported**.</span><span class="sxs-lookup"><span data-stu-id="7e081-159">Installation of the self-hosted integration runtime on a **domain controller is not supported**.</span></span>
- <span data-ttu-id="7e081-160">**.NET Framework 4.6.1 or above** is required.</span><span class="sxs-lookup"><span data-stu-id="7e081-160">**.NET Framework 4.6.1 or above** is required.</span></span> <span data-ttu-id="7e081-161">If you are installing self-hosted integration runtime on a Windows 7 machine, install .NET Framework 4.6.1 or later.</span><span class="sxs-lookup"><span data-stu-id="7e081-161">If you are installing self-hosted integration runtime on a Windows 7 machine, install .NET Framework 4.6.1 or later.</span></span> <span data-ttu-id="7e081-162">See [.NET Framework System Requirements](/dotnet/framework/get-started/system-requirements) for details.</span><span class="sxs-lookup"><span data-stu-id="7e081-162">See [.NET Framework System Requirements](/dotnet/framework/get-started/system-requirements) for details.</span></span>
- <span data-ttu-id="7e081-163">The recommended **configuration** for the self-hosted integration runtime machine is at least 2 GHz, 4 cores, 8-GB RAM, and 80-GB disk.</span><span class="sxs-lookup"><span data-stu-id="7e081-163">The recommended **configuration** for the self-hosted integration runtime machine is at least 2 GHz, 4 cores, 8-GB RAM, and 80-GB disk.</span></span>
- <span data-ttu-id="7e081-164">If the host machine hibernates, the self-hosted integration runtime does not respond to data requests.</span><span class="sxs-lookup"><span data-stu-id="7e081-164">If the host machine hibernates, the self-hosted integration runtime does not respond to data requests.</span></span> <span data-ttu-id="7e081-165">Therefore, configure an appropriate power plan on the computer before installing the self-hosted integration runtime.</span><span class="sxs-lookup"><span data-stu-id="7e081-165">Therefore, configure an appropriate power plan on the computer before installing the self-hosted integration runtime.</span></span> <span data-ttu-id="7e081-166">If the machine is configured to hibernate, the self-hosted integration runtime installation prompts a message.</span><span class="sxs-lookup"><span data-stu-id="7e081-166">If the machine is configured to hibernate, the self-hosted integration runtime installation prompts a message.</span></span>
- <span data-ttu-id="7e081-167">You must be an administrator on the machine to install and configure the self-hosted integration runtime successfully.</span><span class="sxs-lookup"><span data-stu-id="7e081-167">You must be an administrator on the machine to install and configure the self-hosted integration runtime successfully.</span></span>
- <span data-ttu-id="7e081-168">As copy activity runs happen on a specific frequency, the resource usage (CPU, memory) on the machine also follows the same pattern with peak and idle times.</span><span class="sxs-lookup"><span data-stu-id="7e081-168">As copy activity runs happen on a specific frequency, the resource usage (CPU, memory) on the machine also follows the same pattern with peak and idle times.</span></span> <span data-ttu-id="7e081-169">Resource utilization also depends heavily on the amount of data being moved.</span><span class="sxs-lookup"><span data-stu-id="7e081-169">Resource utilization also depends heavily on the amount of data being moved.</span></span> <span data-ttu-id="7e081-170">When multiple copy jobs are in progress, you see resource usage go up during peak times.</span><span class="sxs-lookup"><span data-stu-id="7e081-170">When multiple copy jobs are in progress, you see resource usage go up during peak times.</span></span>

## <a name="installation-best-practices"></a><span data-ttu-id="7e081-171">Installation best practices</span><span class="sxs-lookup"><span data-stu-id="7e081-171">Installation best practices</span></span>
<span data-ttu-id="7e081-172">Self-hosted integration runtime can be installed by downloading an MSI setup package from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=39717).</span><span class="sxs-lookup"><span data-stu-id="7e081-172">Self-hosted integration runtime can be installed by downloading an MSI setup package from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=39717).</span></span> <span data-ttu-id="7e081-173">See [Move data between on-premises and cloud article](tutorial-hybrid-copy-powershell.md) for step-by-step instructions.</span><span class="sxs-lookup"><span data-stu-id="7e081-173">See [Move data between on-premises and cloud article](tutorial-hybrid-copy-powershell.md) for step-by-step instructions.</span></span>

- <span data-ttu-id="7e081-174">Configure power plan on the host machine for the self-hosted integration runtime so that the machine does not hibernate.</span><span class="sxs-lookup"><span data-stu-id="7e081-174">Configure power plan on the host machine for the self-hosted integration runtime so that the machine does not hibernate.</span></span> <span data-ttu-id="7e081-175">If the host machine hibernates, the self-hosted integration runtime turns offline.</span><span class="sxs-lookup"><span data-stu-id="7e081-175">If the host machine hibernates, the self-hosted integration runtime turns offline.</span></span>
- <span data-ttu-id="7e081-176">Back up the credentials associated with the self-hosted integration runtime regularly.</span><span class="sxs-lookup"><span data-stu-id="7e081-176">Back up the credentials associated with the self-hosted integration runtime regularly.</span></span>

## <a name="install-and-register-self-hosted-ir-from-download-center"></a><span data-ttu-id="7e081-177">Install and Register Self-hosted IR from download center</span><span class="sxs-lookup"><span data-stu-id="7e081-177">Install and Register Self-hosted IR from download center</span></span>

1. <span data-ttu-id="7e081-178">Navigate to [Microsoft Integration Runtime download page](https://www.microsoft.com/download/details.aspx?id=39717).</span><span class="sxs-lookup"><span data-stu-id="7e081-178">Navigate to [Microsoft Integration Runtime download page](https://www.microsoft.com/download/details.aspx?id=39717).</span></span>
2. <span data-ttu-id="7e081-179">Click **Download**, select the appropriate version (**32-bit** vs. **64-bit**), and click **Next**.</span><span class="sxs-lookup"><span data-stu-id="7e081-179">Click **Download**, select the appropriate version (**32-bit** vs. **64-bit**), and click **Next**.</span></span>
3. <span data-ttu-id="7e081-180">Run the **MSI** directly or save it to your hard disk and run.</span><span class="sxs-lookup"><span data-stu-id="7e081-180">Run the **MSI** directly or save it to your hard disk and run.</span></span>
4. <span data-ttu-id="7e081-181">On the **Welcome** page, select a **language** click **Next**.</span><span class="sxs-lookup"><span data-stu-id="7e081-181">On the **Welcome** page, select a **language** click **Next**.</span></span>
5. <span data-ttu-id="7e081-182">**Accept** the End-User License Agreement and click **Next**.</span><span class="sxs-lookup"><span data-stu-id="7e081-182">**Accept** the End-User License Agreement and click **Next**.</span></span>
6. <span data-ttu-id="7e081-183">Select **folder** to install the self-hosted integration runtime and click **Next**.</span><span class="sxs-lookup"><span data-stu-id="7e081-183">Select **folder** to install the self-hosted integration runtime and click **Next**.</span></span>
7. <span data-ttu-id="7e081-184">On the **Ready to install** page, click **Install**.</span><span class="sxs-lookup"><span data-stu-id="7e081-184">On the **Ready to install** page, click **Install**.</span></span>
8. <span data-ttu-id="7e081-185">Click **Finish** to complete installation.</span><span class="sxs-lookup"><span data-stu-id="7e081-185">Click **Finish** to complete installation.</span></span>
9. <span data-ttu-id="7e081-186">Get the Authentication key using Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="7e081-186">Get the Authentication key using Azure PowerShell.</span></span> <span data-ttu-id="7e081-187">PowerShell example for retrieving authentication key:</span><span class="sxs-lookup"><span data-stu-id="7e081-187">PowerShell example for retrieving authentication key:</span></span>

    ```powershell
    Get-AzureRmDataFactoryV2IntegrationRuntimeKey -ResourceGroupName $resouceGroupName -DataFactoryName $dataFactoryName -Name $selfHostedIntegrationRuntime
    ```
11. <span data-ttu-id="7e081-188">On the **Register Integration Runtime (Self-hosted)** page of Microsoft Integration Runtime Configuration Manager running on your machine, do the following steps:</span><span class="sxs-lookup"><span data-stu-id="7e081-188">On the **Register Integration Runtime (Self-hosted)** page of Microsoft Integration Runtime Configuration Manager running on your machine, do the following steps:</span></span>
    1. <span data-ttu-id="7e081-189">Paste the **authentication key** in the text area.</span><span class="sxs-lookup"><span data-stu-id="7e081-189">Paste the **authentication key** in the text area.</span></span>
    2. <span data-ttu-id="7e081-190">Optionally, click **Show authentication key** to see the key text.</span><span class="sxs-lookup"><span data-stu-id="7e081-190">Optionally, click **Show authentication key** to see the key text.</span></span>
    3. <span data-ttu-id="7e081-191">Click **Register**.</span><span class="sxs-lookup"><span data-stu-id="7e081-191">Click **Register**.</span></span>


## <a name="high-availability-and-scalability"></a><span data-ttu-id="7e081-192">High Availability and Scalability</span><span class="sxs-lookup"><span data-stu-id="7e081-192">High Availability and Scalability</span></span>
<span data-ttu-id="7e081-193">A Self-hosted Integration Runtime can be associated to multiple on-premises machines.</span><span class="sxs-lookup"><span data-stu-id="7e081-193">A Self-hosted Integration Runtime can be associated to multiple on-premises machines.</span></span> <span data-ttu-id="7e081-194">These machines are called nodes.</span><span class="sxs-lookup"><span data-stu-id="7e081-194">These machines are called nodes.</span></span> <span data-ttu-id="7e081-195">You can have up to four nodes associated with a Self-hosted Integration Runtime.</span><span class="sxs-lookup"><span data-stu-id="7e081-195">You can have up to four nodes associated with a Self-hosted Integration Runtime.</span></span> <span data-ttu-id="7e081-196">The benefits of having multiple nodes (on-premises machines with gateway installed) for a logical gateway are:</span><span class="sxs-lookup"><span data-stu-id="7e081-196">The benefits of having multiple nodes (on-premises machines with gateway installed) for a logical gateway are:</span></span>
1. <span data-ttu-id="7e081-197">Higher availability of Self-hosted Integration Runtime so that it is no longer the single point of failure in your Big Data  solution or cloud data integration with Azure Data Factory, ensuring continuity with up to 4 nodes.</span><span class="sxs-lookup"><span data-stu-id="7e081-197">Higher availability of Self-hosted Integration Runtime so that it is no longer the single point of failure in your Big Data  solution or cloud data integration with Azure Data Factory, ensuring continuity with up to 4 nodes.</span></span>
2. <span data-ttu-id="7e081-198">Improved performance and throughput during data movement between on-premises and cloud data stores.</span><span class="sxs-lookup"><span data-stu-id="7e081-198">Improved performance and throughput during data movement between on-premises and cloud data stores.</span></span> <span data-ttu-id="7e081-199">Get more information on [performance comparisons](copy-activity-performance.md).</span><span class="sxs-lookup"><span data-stu-id="7e081-199">Get more information on [performance comparisons](copy-activity-performance.md).</span></span>

<span data-ttu-id="7e081-200">You can associate multiple nodes by simply installing the Self-hosted Integration Runtime software from the [download center](https://www.microsoft.com/download/details.aspx?id=39717) and by registering it by either of the Authentication Keys obtained from New-AzureRmDataFactoryV2IntegrationRuntimeKey cmdlet as described in the [Tutorial](tutorial-hybrid-copy-powershell.md)</span><span class="sxs-lookup"><span data-stu-id="7e081-200">You can associate multiple nodes by simply installing the Self-hosted Integration Runtime software from the [download center](https://www.microsoft.com/download/details.aspx?id=39717) and by registering it by either of the Authentication Keys obtained from New-AzureRmDataFactoryV2IntegrationRuntimeKey cmdlet as described in the [Tutorial](tutorial-hybrid-copy-powershell.md)</span></span>

> [!NOTE]
> <span data-ttu-id="7e081-201">You do not need to create new Self-hosted Integration Runtime for associating each node.</span><span class="sxs-lookup"><span data-stu-id="7e081-201">You do not need to create new Self-hosted Integration Runtime for associating each node.</span></span> <span data-ttu-id="7e081-202">You can install the self-hosted integration runtime on another machine and register it using the same Authentication Key.</span><span class="sxs-lookup"><span data-stu-id="7e081-202">You can install the self-hosted integration runtime on another machine and register it using the same Authentication Key.</span></span> 

> [!NOTE]
> <span data-ttu-id="7e081-203">Before adding another node for **High Availability and Scalability**, please ensure **'Remote access to intranet'** option is **enabled** on the 1st node (Microsoft Integration Runtime Configuration Manager -> Settings -> Remote access to intranet).</span><span class="sxs-lookup"><span data-stu-id="7e081-203">Before adding another node for **High Availability and Scalability**, please ensure **'Remote access to intranet'** option is **enabled** on the 1st node (Microsoft Integration Runtime Configuration Manager -> Settings -> Remote access to intranet).</span></span> 

### <a name="scale-considerations"></a><span data-ttu-id="7e081-204">Scale considerations</span><span class="sxs-lookup"><span data-stu-id="7e081-204">Scale considerations</span></span>

#### <a name="scale-out"></a><span data-ttu-id="7e081-205">Scale out</span><span class="sxs-lookup"><span data-stu-id="7e081-205">Scale out</span></span>

<span data-ttu-id="7e081-206">When the **available memory on the self-hosted IR is low** and the **CPU usage is high**, adding a new node helps scale out the load across machines.</span><span class="sxs-lookup"><span data-stu-id="7e081-206">When the **available memory on the self-hosted IR is low** and the **CPU usage is high**, adding a new node helps scale out the load across machines.</span></span> <span data-ttu-id="7e081-207">If activities are failing due to time-out or self-hosted IR node being offline, it helps if you add a node to the gateway.</span><span class="sxs-lookup"><span data-stu-id="7e081-207">If activities are failing due to time-out or self-hosted IR node being offline, it helps if you add a node to the gateway.</span></span>

#### <a name="scale-up"></a><span data-ttu-id="7e081-208">Scale up</span><span class="sxs-lookup"><span data-stu-id="7e081-208">Scale up</span></span>

<span data-ttu-id="7e081-209">When the available memory and CPU are not utilized well, but the concurrent jobs execution is reaching the limit, you should scale up by increasing the number of concurrent jobs that can run on a node.</span><span class="sxs-lookup"><span data-stu-id="7e081-209">When the available memory and CPU are not utilized well, but the concurrent jobs execution is reaching the limit, you should scale up by increasing the number of concurrent jobs that can run on a node.</span></span> <span data-ttu-id="7e081-210">You may also want to scale up when activities are timing out because the self-hosted IR is overloaded.</span><span class="sxs-lookup"><span data-stu-id="7e081-210">You may also want to scale up when activities are timing out because the self-hosted IR is overloaded.</span></span> <span data-ttu-id="7e081-211">As shown in the following image, you can increase the maximum capacity for a node.</span><span class="sxs-lookup"><span data-stu-id="7e081-211">As shown in the following image, you can increase the maximum capacity for a node.</span></span>  

![](media\create-self-hosted-integration-runtime\scale-up-self-hosted-IR.png)

### <a name="tlsssl-certificate-requirements"></a><span data-ttu-id="7e081-212">TLS/SSL certificate requirements</span><span class="sxs-lookup"><span data-stu-id="7e081-212">TLS/SSL certificate requirements</span></span>

<span data-ttu-id="7e081-213">Here are the requirements for the TLS/SSL certificate that is used for securing communications between integration runtime nodes:</span><span class="sxs-lookup"><span data-stu-id="7e081-213">Here are the requirements for the TLS/SSL certificate that is used for securing communications between integration runtime nodes:</span></span>

- <span data-ttu-id="7e081-214">The certificate must be a publicly trusted X509 v3 certificate.</span><span class="sxs-lookup"><span data-stu-id="7e081-214">The certificate must be a publicly trusted X509 v3 certificate.</span></span> <span data-ttu-id="7e081-215">We recommend that you use certificates that are issued by a public (third-party) certification authority (CA).</span><span class="sxs-lookup"><span data-stu-id="7e081-215">We recommend that you use certificates that are issued by a public (third-party) certification authority (CA).</span></span>
- <span data-ttu-id="7e081-216">Each integration runtime node must trust this certificate.</span><span class="sxs-lookup"><span data-stu-id="7e081-216">Each integration runtime node must trust this certificate.</span></span>
- <span data-ttu-id="7e081-217">SAN certificates are not recommended since only the last item of the Subject Alternative Names will be used and all others will be ignored due to current limitation.</span><span class="sxs-lookup"><span data-stu-id="7e081-217">SAN certificates are not recommended since only the last item of the Subject Alternative Names will be used and all others will be ignored due to current limitation.</span></span> <span data-ttu-id="7e081-218">E.g.</span><span class="sxs-lookup"><span data-stu-id="7e081-218">E.g.</span></span> <span data-ttu-id="7e081-219">you have a SAN certificate whose SAN are **node1.domain.contoso.com** and **node2.domain.contoso.com**, you can only use this cert on machine whose FQDN is **node2.domain.contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="7e081-219">you have a SAN certificate whose SAN are **node1.domain.contoso.com** and **node2.domain.contoso.com**, you can only use this cert on machine whose FQDN is **node2.domain.contoso.com**.</span></span>
- <span data-ttu-id="7e081-220">Supports any key size supported by Windows Server 2012 R2 for SSL certificates.</span><span class="sxs-lookup"><span data-stu-id="7e081-220">Supports any key size supported by Windows Server 2012 R2 for SSL certificates.</span></span>
- <span data-ttu-id="7e081-221">Certificate using CNG keys are not supported.</span><span class="sxs-lookup"><span data-stu-id="7e081-221">Certificate using CNG keys are not supported.</span></span>  

## <a name="sharing-the-self-hosted-integration-runtime-ir-with-multiple-data-factories"></a><span data-ttu-id="7e081-222">Sharing the self-hosted Integration Runtime (IR) with multiple data factories</span><span class="sxs-lookup"><span data-stu-id="7e081-222">Sharing the self-hosted Integration Runtime (IR) with multiple data factories</span></span>

<span data-ttu-id="7e081-223">You can reuse an existing self-hosted integration runtime infrastructure that you may already have setup in a data factory.</span><span class="sxs-lookup"><span data-stu-id="7e081-223">You can reuse an existing self-hosted integration runtime infrastructure that you may already have setup in a data factory.</span></span> <span data-ttu-id="7e081-224">This allows you to create a **linked self-hosted integration runtime** in a different data factory by referencing an already existing self-hosted IR (Shared).</span><span class="sxs-lookup"><span data-stu-id="7e081-224">This allows you to create a **linked self-hosted integration runtime** in a different data factory by referencing an already existing self-hosted IR (Shared).</span></span>

#### <a name="terminologies"></a><span data-ttu-id="7e081-225">**Terminologies**</span><span class="sxs-lookup"><span data-stu-id="7e081-225">**Terminologies**</span></span>

- <span data-ttu-id="7e081-226">**Shared IR** – The original self-hosted IR which is running on a physical infrastructure.</span><span class="sxs-lookup"><span data-stu-id="7e081-226">**Shared IR** – The original self-hosted IR which is running on a physical infrastructure.</span></span>  
- <span data-ttu-id="7e081-227">**Linked IR** – The IR which references another Shared IR.</span><span class="sxs-lookup"><span data-stu-id="7e081-227">**Linked IR** – The IR which references another Shared IR.</span></span> <span data-ttu-id="7e081-228">This is a logical IR and uses the infrastructure of another self-hosted IR (shared).</span><span class="sxs-lookup"><span data-stu-id="7e081-228">This is a logical IR and uses the infrastructure of another self-hosted IR (shared).</span></span>

#### <a name="high-level-steps-for-creating-a-linked-self-hosted-ir"></a><span data-ttu-id="7e081-229">High level steps for creating a Linked self-hosted IR</span><span class="sxs-lookup"><span data-stu-id="7e081-229">High level steps for creating a Linked self-hosted IR</span></span>

<span data-ttu-id="7e081-230">In the self-hosted IR to be shared,</span><span class="sxs-lookup"><span data-stu-id="7e081-230">In the self-hosted IR to be shared,</span></span>

1. <span data-ttu-id="7e081-231">Grant permission to the Data Factory in which you would like to create the Linked IR.</span><span class="sxs-lookup"><span data-stu-id="7e081-231">Grant permission to the Data Factory in which you would like to create the Linked IR.</span></span> 

   ![](media\create-self-hosted-integration-runtime\grant-permissions-IR-sharing.png)

   ![](media\create-self-hosted-integration-runtime\3_rbac_permissions.png)

2. <span data-ttu-id="7e081-232">Note the **Resource ID** of the self-hosted IR to be shared.</span><span class="sxs-lookup"><span data-stu-id="7e081-232">Note the **Resource ID** of the self-hosted IR to be shared.</span></span>

   ![](media\create-self-hosted-integration-runtime\4_ResourceID_self-hostedIR.png)

<span data-ttu-id="7e081-233">In the Data Factory to which the permissions were granted,</span><span class="sxs-lookup"><span data-stu-id="7e081-233">In the Data Factory to which the permissions were granted,</span></span>

3. <span data-ttu-id="7e081-234">Create a new Self-hosted IR (linked) and enter the above **Resource ID**</span><span class="sxs-lookup"><span data-stu-id="7e081-234">Create a new Self-hosted IR (linked) and enter the above **Resource ID**</span></span>

   ![](media\create-self-hosted-integration-runtime\6_create-linkedIR_2.png)

   ![](media\create-self-hosted-integration-runtime\6_create-linkedIR_3.png)

#### <a name="monitoring"></a><span data-ttu-id="7e081-235">Monitoring</span><span class="sxs-lookup"><span data-stu-id="7e081-235">Monitoring</span></span> 

- <span data-ttu-id="7e081-236">**Shared IR**</span><span class="sxs-lookup"><span data-stu-id="7e081-236">**Shared IR**</span></span>

  ![](media\create-self-hosted-integration-runtime\Contoso-shared-IR.png)

  ![](media\create-self-hosted-integration-runtime\contoso-shared-ir-monitoring.png)

- <span data-ttu-id="7e081-237">**Linked IR**</span><span class="sxs-lookup"><span data-stu-id="7e081-237">**Linked IR**</span></span>

  ![](media\create-self-hosted-integration-runtime\Contoso-linked-ir.png)

  ![](media\create-self-hosted-integration-runtime\Contoso-linked-ir-monitoring.png)

#### <a name="known-limitations-of-self-hosted-ir-sharing"></a><span data-ttu-id="7e081-238">Known limitations of self-hosted IR sharing</span><span class="sxs-lookup"><span data-stu-id="7e081-238">Known limitations of self-hosted IR sharing</span></span>

1. <span data-ttu-id="7e081-239">Default number of linked IR that can be created under single self-hosted IR is **20**.</span><span class="sxs-lookup"><span data-stu-id="7e081-239">Default number of linked IR that can be created under single self-hosted IR is **20**.</span></span> <span data-ttu-id="7e081-240">If you require more then contact Support.</span><span class="sxs-lookup"><span data-stu-id="7e081-240">If you require more then contact Support.</span></span> 

2. <span data-ttu-id="7e081-241">The data factory in which linked IR is to be created must have an MSI ([managed service identity](https://docs.microsoft.com/azure/active-directory/managed-service-identity/overview)).</span><span class="sxs-lookup"><span data-stu-id="7e081-241">The data factory in which linked IR is to be created must have an MSI ([managed service identity](https://docs.microsoft.com/azure/active-directory/managed-service-identity/overview)).</span></span> <span data-ttu-id="7e081-242">By default, the data factories created in Ibiza portal or PowerShell cmdlets will have MSI created implicitly.</span><span class="sxs-lookup"><span data-stu-id="7e081-242">By default, the data factories created in Ibiza portal or PowerShell cmdlets will have MSI created implicitly.</span></span> <span data-ttu-id="7e081-243">However, in some cases when data factory is created using an Azure Resorce Manager template or SDK, the “**Identity**” **property must be set** explicitly to ensure Azure Resorce Manager creates a data factory containing an MSI.</span><span class="sxs-lookup"><span data-stu-id="7e081-243">However, in some cases when data factory is created using an Azure Resorce Manager template or SDK, the “**Identity**” **property must be set** explicitly to ensure Azure Resorce Manager creates a data factory containing an MSI.</span></span> 

3. <span data-ttu-id="7e081-244">The self-hosted IR version must be equal or greater than 3.8.xxxx.xx.</span><span class="sxs-lookup"><span data-stu-id="7e081-244">The self-hosted IR version must be equal or greater than 3.8.xxxx.xx.</span></span> <span data-ttu-id="7e081-245">Please [download the latest version](https://www.microsoft.com/download/details.aspx?id=39717) of self-hosted IR</span><span class="sxs-lookup"><span data-stu-id="7e081-245">Please [download the latest version](https://www.microsoft.com/download/details.aspx?id=39717) of self-hosted IR</span></span>

4. <span data-ttu-id="7e081-246">The data factory in which linked IR is to be created must have an MSI ([managed service identity](https://docs.microsoft.com/azure/active-directory/managed-service-identity/overview)).</span><span class="sxs-lookup"><span data-stu-id="7e081-246">The data factory in which linked IR is to be created must have an MSI ([managed service identity](https://docs.microsoft.com/azure/active-directory/managed-service-identity/overview)).</span></span> <span data-ttu-id="7e081-247">By default, the data factories created in Ibiza portal or PowerShell cmdlets will have MSI ([managed service identity](https://docs.microsoft.com/azure/active-directory/managed-service-identity/overview)).</span><span class="sxs-lookup"><span data-stu-id="7e081-247">By default, the data factories created in Ibiza portal or PowerShell cmdlets will have MSI ([managed service identity](https://docs.microsoft.com/azure/active-directory/managed-service-identity/overview)).</span></span>
<span data-ttu-id="7e081-248">created implicitly, however, data factories created with Azure Resource Manager (ARM) template or SDK requires “Identity” property to be set to ensure an MSI is created.</span><span class="sxs-lookup"><span data-stu-id="7e081-248">created implicitly, however, data factories created with Azure Resource Manager (ARM) template or SDK requires “Identity” property to be set to ensure an MSI is created.</span></span>

5. <span data-ttu-id="7e081-249">The ADF .Net SDK which support this feature is version >= 1.1.0</span><span class="sxs-lookup"><span data-stu-id="7e081-249">The ADF .Net SDK which support this feature is version >= 1.1.0</span></span>

6. <span data-ttu-id="7e081-250">The Azure PowerShell which support this feature is version >= 6.6.0 (AzureRM.DataFactoryV2 >= 0.5.7)</span><span class="sxs-lookup"><span data-stu-id="7e081-250">The Azure PowerShell which support this feature is version >= 6.6.0 (AzureRM.DataFactoryV2 >= 0.5.7)</span></span>

7. <span data-ttu-id="7e081-251">To Grant permission, the user will require "Owner" role or inherited "Owner" role in the Data Factory where the Shared IR exists.</span><span class="sxs-lookup"><span data-stu-id="7e081-251">To Grant permission, the user will require "Owner" role or inherited "Owner" role in the Data Factory where the Shared IR exists.</span></span> 

  > [!NOTE]
  > <span data-ttu-id="7e081-252">This feature is only available in Azure Data Factory version 2</span><span class="sxs-lookup"><span data-stu-id="7e081-252">This feature is only available in Azure Data Factory version 2</span></span> 

## <a name="system-tray-icons-notifications"></a><span data-ttu-id="7e081-253">System tray icons/ notifications</span><span class="sxs-lookup"><span data-stu-id="7e081-253">System tray icons/ notifications</span></span>

<span data-ttu-id="7e081-254">If you move cursor over the system tray icon/notification message, you can find details about the state of the self-hosted integration runtime.</span><span class="sxs-lookup"><span data-stu-id="7e081-254">If you move cursor over the system tray icon/notification message, you can find details about the state of the self-hosted integration runtime.</span></span>

![System tray notifications](media\create-self-hosted-integration-runtime\system-tray-notifications.png)

## <a name="ports-and-firewall"></a><span data-ttu-id="7e081-256">Ports and firewall</span><span class="sxs-lookup"><span data-stu-id="7e081-256">Ports and firewall</span></span>
<span data-ttu-id="7e081-257">There are two firewalls you need to consider: **corporate firewall** running on the central router of the organization, and **Windows firewall** configured as a daemon on the local machine where the self-hosted integration runtime is installed.</span><span class="sxs-lookup"><span data-stu-id="7e081-257">There are two firewalls you need to consider: **corporate firewall** running on the central router of the organization, and **Windows firewall** configured as a daemon on the local machine where the self-hosted integration runtime is installed.</span></span>

![Firewall](media\create-self-hosted-integration-runtime\firewall.png)

<span data-ttu-id="7e081-259">At **corporate firewall** level, you need configure the following domains and outbound ports:</span><span class="sxs-lookup"><span data-stu-id="7e081-259">At **corporate firewall** level, you need configure the following domains and outbound ports:</span></span>

<span data-ttu-id="7e081-260">Domain names</span><span class="sxs-lookup"><span data-stu-id="7e081-260">Domain names</span></span> | <span data-ttu-id="7e081-261">Ports</span><span class="sxs-lookup"><span data-stu-id="7e081-261">Ports</span></span> | <span data-ttu-id="7e081-262">Description</span><span class="sxs-lookup"><span data-stu-id="7e081-262">Description</span></span>
------------ | ----- | ------------
<span data-ttu-id="7e081-263">\*.servicebus.windows.net</span><span class="sxs-lookup"><span data-stu-id="7e081-263">\*.servicebus.windows.net</span></span> | <span data-ttu-id="7e081-264">443</span><span class="sxs-lookup"><span data-stu-id="7e081-264">443</span></span> | <span data-ttu-id="7e081-265">Used for communication with Data Movement Service backend</span><span class="sxs-lookup"><span data-stu-id="7e081-265">Used for communication with Data Movement Service backend</span></span>
<span data-ttu-id="7e081-266">\*.core.windows.net</span><span class="sxs-lookup"><span data-stu-id="7e081-266">\*.core.windows.net</span></span> | <span data-ttu-id="7e081-267">443</span><span class="sxs-lookup"><span data-stu-id="7e081-267">443</span></span> | <span data-ttu-id="7e081-268">Used for Staged copy using Azure Blob (if configured)</span><span class="sxs-lookup"><span data-stu-id="7e081-268">Used for Staged copy using Azure Blob (if configured)</span></span>
<span data-ttu-id="7e081-269">\*.frontend.clouddatahub.net</span><span class="sxs-lookup"><span data-stu-id="7e081-269">\*.frontend.clouddatahub.net</span></span> | <span data-ttu-id="7e081-270">443</span><span class="sxs-lookup"><span data-stu-id="7e081-270">443</span></span> | <span data-ttu-id="7e081-271">Used for communication with Data Movement Service backend</span><span class="sxs-lookup"><span data-stu-id="7e081-271">Used for communication with Data Movement Service backend</span></span>
<span data-ttu-id="7e081-272">download.microsoft.com</span><span class="sxs-lookup"><span data-stu-id="7e081-272">download.microsoft.com</span></span> | <span data-ttu-id="7e081-273">443</span><span class="sxs-lookup"><span data-stu-id="7e081-273">443</span></span> | <span data-ttu-id="7e081-274">Used for downloading the updates</span><span class="sxs-lookup"><span data-stu-id="7e081-274">Used for downloading the updates</span></span>

<span data-ttu-id="7e081-275">At **Windows firewall** level (machine level), these outbound ports are normally enabled.</span><span class="sxs-lookup"><span data-stu-id="7e081-275">At **Windows firewall** level (machine level), these outbound ports are normally enabled.</span></span> <span data-ttu-id="7e081-276">If not, you can configure the domains and ports accordingly on self-hosted integration runtime machine.</span><span class="sxs-lookup"><span data-stu-id="7e081-276">If not, you can configure the domains and ports accordingly on self-hosted integration runtime machine.</span></span>

> [!NOTE]
> <span data-ttu-id="7e081-277">Based on your source/ sinks, you may have to whitelist additional domains and outbound ports in your corporate/Windows firewall.</span><span class="sxs-lookup"><span data-stu-id="7e081-277">Based on your source/ sinks, you may have to whitelist additional domains and outbound ports in your corporate/Windows firewall.</span></span>
>
> <span data-ttu-id="7e081-278">For some Cloud Databases (For example: Azure SQL Database, Azure Data Lake, etc.), you may need to whitelist IP address of self-hosted integration runtime machine on their firewall configuration.</span><span class="sxs-lookup"><span data-stu-id="7e081-278">For some Cloud Databases (For example: Azure SQL Database, Azure Data Lake, etc.), you may need to whitelist IP address of self-hosted integration runtime machine on their firewall configuration.</span></span>

### <a name="copy-data-from-a-source-to-a-sink"></a><span data-ttu-id="7e081-279">Copy data from a source to a sink</span><span class="sxs-lookup"><span data-stu-id="7e081-279">Copy data from a source to a sink</span></span>
<span data-ttu-id="7e081-280">Ensure that the firewall rules are enabled properly on the corporate firewall, Windows firewall on the self-hosted integration runtime machine, and the data store itself.</span><span class="sxs-lookup"><span data-stu-id="7e081-280">Ensure that the firewall rules are enabled properly on the corporate firewall, Windows firewall on the self-hosted integration runtime machine, and the data store itself.</span></span> <span data-ttu-id="7e081-281">Enabling these rules allows the self-hosted integration runtime to connect to both source and sink successfully.</span><span class="sxs-lookup"><span data-stu-id="7e081-281">Enabling these rules allows the self-hosted integration runtime to connect to both source and sink successfully.</span></span> <span data-ttu-id="7e081-282">Enable rules for each data store that is involved in the copy operation.</span><span class="sxs-lookup"><span data-stu-id="7e081-282">Enable rules for each data store that is involved in the copy operation.</span></span>

<span data-ttu-id="7e081-283">For example, to copy from an **on-premises data store to an Azure SQL Database sink or an Azure SQL Data Warehouse sink**, do the following steps:</span><span class="sxs-lookup"><span data-stu-id="7e081-283">For example, to copy from an **on-premises data store to an Azure SQL Database sink or an Azure SQL Data Warehouse sink**, do the following steps:</span></span>

- <span data-ttu-id="7e081-284">Allow outbound **TCP** communication on port **1433** for both Windows firewall and corporate firewall.</span><span class="sxs-lookup"><span data-stu-id="7e081-284">Allow outbound **TCP** communication on port **1433** for both Windows firewall and corporate firewall.</span></span>
- <span data-ttu-id="7e081-285">Configure the firewall settings of Azure SQL server to add the IP address of the self-hosted integration runtime machine to the list of allowed IP addresses.</span><span class="sxs-lookup"><span data-stu-id="7e081-285">Configure the firewall settings of Azure SQL server to add the IP address of the self-hosted integration runtime machine to the list of allowed IP addresses.</span></span>

> [!NOTE]
> <span data-ttu-id="7e081-286">If your firewall does not allow outbound port 1433, self-hosted integration runtime can't access Azure SQL directly.</span><span class="sxs-lookup"><span data-stu-id="7e081-286">If your firewall does not allow outbound port 1433, self-hosted integration runtime can't access Azure SQL directly.</span></span> <span data-ttu-id="7e081-287">In this case, you may use [Staged Copy](copy-activity-performance.md) to SQL Azure Database/ SQL Azure DW.</span><span class="sxs-lookup"><span data-stu-id="7e081-287">In this case, you may use [Staged Copy](copy-activity-performance.md) to SQL Azure Database/ SQL Azure DW.</span></span> <span data-ttu-id="7e081-288">In this scenario, you would only require HTTPS (port 443) for the data movement.</span><span class="sxs-lookup"><span data-stu-id="7e081-288">In this scenario, you would only require HTTPS (port 443) for the data movement.</span></span>


## <a name="proxy-server-considerations"></a><span data-ttu-id="7e081-289">Proxy server considerations</span><span class="sxs-lookup"><span data-stu-id="7e081-289">Proxy server considerations</span></span>
<span data-ttu-id="7e081-290">If your corporate network environment uses a proxy server to access the internet, configure self-hosted integration runtime to use appropriate proxy settings.</span><span class="sxs-lookup"><span data-stu-id="7e081-290">If your corporate network environment uses a proxy server to access the internet, configure self-hosted integration runtime to use appropriate proxy settings.</span></span> <span data-ttu-id="7e081-291">You can set the proxy during the initial registration phase.</span><span class="sxs-lookup"><span data-stu-id="7e081-291">You can set the proxy during the initial registration phase.</span></span>

![Specify proxy](media\create-self-hosted-integration-runtime\specify-proxy.png)

<span data-ttu-id="7e081-293">Self-hosted integration runtime uses the proxy server to connect to the cloud service.</span><span class="sxs-lookup"><span data-stu-id="7e081-293">Self-hosted integration runtime uses the proxy server to connect to the cloud service.</span></span> <span data-ttu-id="7e081-294">Click Change link during initial setup.</span><span class="sxs-lookup"><span data-stu-id="7e081-294">Click Change link during initial setup.</span></span> <span data-ttu-id="7e081-295">You see the proxy setting dialog.</span><span class="sxs-lookup"><span data-stu-id="7e081-295">You see the proxy setting dialog.</span></span>

![Set proxy](media\create-self-hosted-integration-runtime\set-http-proxy.png)

<span data-ttu-id="7e081-297">There are three configuration options:</span><span class="sxs-lookup"><span data-stu-id="7e081-297">There are three configuration options:</span></span>

- <span data-ttu-id="7e081-298">**Do not use proxy**: Self-hosted integration runtime does not explicitly use any proxy to connect to cloud services.</span><span class="sxs-lookup"><span data-stu-id="7e081-298">**Do not use proxy**: Self-hosted integration runtime does not explicitly use any proxy to connect to cloud services.</span></span>
- <span data-ttu-id="7e081-299">**Use system proxy**: Self-hosted integration runtime uses the proxy setting that is configured in diahost.exe.config and diawp.exe.config. If no proxy is configured in diahost.exe.config and diawp.exe.config, self-hosted integration runtime connects to cloud service directly without going through proxy.</span><span class="sxs-lookup"><span data-stu-id="7e081-299">**Use system proxy**: Self-hosted integration runtime uses the proxy setting that is configured in diahost.exe.config and diawp.exe.config. If no proxy is configured in diahost.exe.config and diawp.exe.config, self-hosted integration runtime connects to cloud service directly without going through proxy.</span></span>
- <span data-ttu-id="7e081-300">**Use custom proxy**: Configure the HTTP proxy setting to use for self-hosted integration runtime, instead of using configurations in diahost.exe.config and diawp.exe.config. Address and Port are required.</span><span class="sxs-lookup"><span data-stu-id="7e081-300">**Use custom proxy**: Configure the HTTP proxy setting to use for self-hosted integration runtime, instead of using configurations in diahost.exe.config and diawp.exe.config. Address and Port are required.</span></span> <span data-ttu-id="7e081-301">User Name and Password are optional depending on your proxy’s authentication setting.</span><span class="sxs-lookup"><span data-stu-id="7e081-301">User Name and Password are optional depending on your proxy’s authentication setting.</span></span> <span data-ttu-id="7e081-302">All settings are encrypted with Windows DPAPI on the self-hosted integration runtime and stored locally on the machine.</span><span class="sxs-lookup"><span data-stu-id="7e081-302">All settings are encrypted with Windows DPAPI on the self-hosted integration runtime and stored locally on the machine.</span></span>

<span data-ttu-id="7e081-303">The integration runtime Host Service restarts automatically after you save the updated proxy settings.</span><span class="sxs-lookup"><span data-stu-id="7e081-303">The integration runtime Host Service restarts automatically after you save the updated proxy settings.</span></span>

<span data-ttu-id="7e081-304">After self-hosted integration runtime has been successfully registered, if you want to view or update proxy settings, use Integration Runtime Configuration Manager.</span><span class="sxs-lookup"><span data-stu-id="7e081-304">After self-hosted integration runtime has been successfully registered, if you want to view or update proxy settings, use Integration Runtime Configuration Manager.</span></span>

1. <span data-ttu-id="7e081-305">Launch **Microsoft Integration Runtime Configuration Manager**.</span><span class="sxs-lookup"><span data-stu-id="7e081-305">Launch **Microsoft Integration Runtime Configuration Manager**.</span></span>
   - <span data-ttu-id="7e081-306">Switch to the **Settings** tab.</span><span class="sxs-lookup"><span data-stu-id="7e081-306">Switch to the **Settings** tab.</span></span>
   - <span data-ttu-id="7e081-307">Click **Change** link in **HTTP Proxy** section to launch the **Set HTTP Proxy** dialog.</span><span class="sxs-lookup"><span data-stu-id="7e081-307">Click **Change** link in **HTTP Proxy** section to launch the **Set HTTP Proxy** dialog.</span></span>
   - <span data-ttu-id="7e081-308">After you click the **Next** button, you see a warning dialog asking for your permission to save the proxy setting and restart the Integration Runtime Host Service.</span><span class="sxs-lookup"><span data-stu-id="7e081-308">After you click the **Next** button, you see a warning dialog asking for your permission to save the proxy setting and restart the Integration Runtime Host Service.</span></span>

<span data-ttu-id="7e081-309">You can view and update HTTP proxy by using Configuration Manager tool.</span><span class="sxs-lookup"><span data-stu-id="7e081-309">You can view and update HTTP proxy by using Configuration Manager tool.</span></span>

![View proxy](media\create-self-hosted-integration-runtime\view-proxy.png)

> [!NOTE]
> <span data-ttu-id="7e081-311">If you set up a proxy server with NTLM authentication, Integration runtime Host Service runs under the domain account.</span><span class="sxs-lookup"><span data-stu-id="7e081-311">If you set up a proxy server with NTLM authentication, Integration runtime Host Service runs under the domain account.</span></span> <span data-ttu-id="7e081-312">If you change the password for the domain account later, remember to update configuration settings for the service and restart it accordingly.</span><span class="sxs-lookup"><span data-stu-id="7e081-312">If you change the password for the domain account later, remember to update configuration settings for the service and restart it accordingly.</span></span> <span data-ttu-id="7e081-313">Due to this requirement, we suggest you use a dedicated domain account to access the proxy server that does not require you to update the password frequently.</span><span class="sxs-lookup"><span data-stu-id="7e081-313">Due to this requirement, we suggest you use a dedicated domain account to access the proxy server that does not require you to update the password frequently.</span></span>

### <a name="configure-proxy-server-settings"></a><span data-ttu-id="7e081-314">Configure proxy server settings</span><span class="sxs-lookup"><span data-stu-id="7e081-314">Configure proxy server settings</span></span>

<span data-ttu-id="7e081-315">If you select **Use system proxy** setting for the HTTP proxy, self-hosted integration runtime uses the proxy setting in diahost.exe.config and diawp.exe.config. If no proxy is specified in diahost.exe.config and diawp.exe.config, self-hosted integration runtime connects to cloud service directly without going through proxy.</span><span class="sxs-lookup"><span data-stu-id="7e081-315">If you select **Use system proxy** setting for the HTTP proxy, self-hosted integration runtime uses the proxy setting in diahost.exe.config and diawp.exe.config. If no proxy is specified in diahost.exe.config and diawp.exe.config, self-hosted integration runtime connects to cloud service directly without going through proxy.</span></span> <span data-ttu-id="7e081-316">The following procedure provides instructions for updating the diahost.exe.config file.</span><span class="sxs-lookup"><span data-stu-id="7e081-316">The following procedure provides instructions for updating the diahost.exe.config file.</span></span>

1. <span data-ttu-id="7e081-317">In File Explorer, make a safe copy of C:\Program Files\Microsoft Integration Runtime\3.0\Shared\diahost.exe.config to back up the original file.</span><span class="sxs-lookup"><span data-stu-id="7e081-317">In File Explorer, make a safe copy of C:\Program Files\Microsoft Integration Runtime\3.0\Shared\diahost.exe.config to back up the original file.</span></span>
2. <span data-ttu-id="7e081-318">Launch Notepad.exe running as administrator, and open text file “C:\Program Files\Microsoft Integration Runtime\3.0\Shared\diahost.exe.config. You find the default tag for system.net as shown in the following code:</span><span class="sxs-lookup"><span data-stu-id="7e081-318">Launch Notepad.exe running as administrator, and open text file “C:\Program Files\Microsoft Integration Runtime\3.0\Shared\diahost.exe.config. You find the default tag for system.net as shown in the following code:</span></span>

    ```xml
    <system.net>
        <defaultProxy useDefaultCredentials="true" />
    </system.net>
    ```
    <span data-ttu-id="7e081-319">You can then add proxy server details as shown in the following example:</span><span class="sxs-lookup"><span data-stu-id="7e081-319">You can then add proxy server details as shown in the following example:</span></span>

    ```xml
    <system.net>
        <defaultProxy enabled="true">
              <proxy bypassonlocal="true" proxyaddress="http://proxy.domain.org:8888/" />
        </defaultProxy>
    </system.net>
    ```

    <span data-ttu-id="7e081-320">Additional properties are allowed inside the proxy tag to specify the required settings like scriptLocation.</span><span class="sxs-lookup"><span data-stu-id="7e081-320">Additional properties are allowed inside the proxy tag to specify the required settings like scriptLocation.</span></span> <span data-ttu-id="7e081-321">See [proxy Element (Network Settings)](https://msdn.microsoft.com/library/sa91de1e.aspx) for syntax.</span><span class="sxs-lookup"><span data-stu-id="7e081-321">See [proxy Element (Network Settings)](https://msdn.microsoft.com/library/sa91de1e.aspx) for syntax.</span></span>

    ```xml
    <proxy autoDetect="true|false|unspecified" bypassonlocal="true|false|unspecified" proxyaddress="uriString" scriptLocation="uriString" usesystemdefault="true|false|unspecified "/>
    ```
3. <span data-ttu-id="7e081-322">Save the configuration file into the original location, then restart the Self-hosted Integration Runtime Host service, which picks up the changes.</span><span class="sxs-lookup"><span data-stu-id="7e081-322">Save the configuration file into the original location, then restart the Self-hosted Integration Runtime Host service, which picks up the changes.</span></span> <span data-ttu-id="7e081-323">To restart the service: use services applet from the control panel, or from the **Integration Runtime Configuration Manager** > click the **Stop Service** button, then click the **Start Service**.</span><span class="sxs-lookup"><span data-stu-id="7e081-323">To restart the service: use services applet from the control panel, or from the **Integration Runtime Configuration Manager** > click the **Stop Service** button, then click the **Start Service**.</span></span> <span data-ttu-id="7e081-324">If the service does not start, it is likely that an incorrect XML tag syntax has been added into the application configuration file that was edited.</span><span class="sxs-lookup"><span data-stu-id="7e081-324">If the service does not start, it is likely that an incorrect XML tag syntax has been added into the application configuration file that was edited.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7e081-325">Do not forget to update both diahost.exe.config and diawp.exe.config.</span><span class="sxs-lookup"><span data-stu-id="7e081-325">Do not forget to update both diahost.exe.config and diawp.exe.config.</span></span>

<span data-ttu-id="7e081-326">In addition to these points, you also need to make sure Microsoft Azure is in your company’s whitelist.</span><span class="sxs-lookup"><span data-stu-id="7e081-326">In addition to these points, you also need to make sure Microsoft Azure is in your company’s whitelist.</span></span> <span data-ttu-id="7e081-327">The list of valid Microsoft Azure IP addresses can be downloaded from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=41653).</span><span class="sxs-lookup"><span data-stu-id="7e081-327">The list of valid Microsoft Azure IP addresses can be downloaded from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=41653).</span></span>

### <a name="possible-symptoms-for-firewall-and-proxy-server-related-issues"></a><span data-ttu-id="7e081-328">Possible symptoms for firewall and proxy server-related issues</span><span class="sxs-lookup"><span data-stu-id="7e081-328">Possible symptoms for firewall and proxy server-related issues</span></span>
<span data-ttu-id="7e081-329">If you encounter errors similar to the following ones, it is likely due to improper configuration of the firewall or proxy server, which blocks self-hosted integration runtime from connecting to Data Factory to authenticate itself.</span><span class="sxs-lookup"><span data-stu-id="7e081-329">If you encounter errors similar to the following ones, it is likely due to improper configuration of the firewall or proxy server, which blocks self-hosted integration runtime from connecting to Data Factory to authenticate itself.</span></span> <span data-ttu-id="7e081-330">Refer to previous section to ensure your firewall and proxy server are properly configured.</span><span class="sxs-lookup"><span data-stu-id="7e081-330">Refer to previous section to ensure your firewall and proxy server are properly configured.</span></span>

1. <span data-ttu-id="7e081-331">When you try to register the self-hosted integration runtime, you receive the following error: "Failed to register this Integration Runtime node!</span><span class="sxs-lookup"><span data-stu-id="7e081-331">When you try to register the self-hosted integration runtime, you receive the following error: "Failed to register this Integration Runtime node!</span></span> <span data-ttu-id="7e081-332">Confirm that the Authentication key is valid and the Integration Service Host Service is running on this machine.</span><span class="sxs-lookup"><span data-stu-id="7e081-332">Confirm that the Authentication key is valid and the Integration Service Host Service is running on this machine.</span></span> <span data-ttu-id="7e081-333">"</span><span class="sxs-lookup"><span data-stu-id="7e081-333">"</span></span>
   - <span data-ttu-id="7e081-334">When you open Integration Runtime Configuration Manager, you see status as “**Disconnected**” or “**Connecting**”.</span><span class="sxs-lookup"><span data-stu-id="7e081-334">When you open Integration Runtime Configuration Manager, you see status as “**Disconnected**” or “**Connecting**”.</span></span> <span data-ttu-id="7e081-335">When viewing Windows event logs, under “Event Viewer” > “Application and Services Logs” > “Microsoft Integration Runtime”, you see error messages such as the following error:</span><span class="sxs-lookup"><span data-stu-id="7e081-335">When viewing Windows event logs, under “Event Viewer” > “Application and Services Logs” > “Microsoft Integration Runtime”, you see error messages such as the following error:</span></span>

    ```
    Unable to connect to the remote server
    A component of Integration Runtime has become unresponsive and restarts automatically. Component name: Integration Runtime (Self-hosted).
    ```

### <a name="enable-remote-access-from-intranet"></a><span data-ttu-id="7e081-336">Enable Remote Access from Intranet</span><span class="sxs-lookup"><span data-stu-id="7e081-336">Enable Remote Access from Intranet</span></span>  
<span data-ttu-id="7e081-337">In case if you use **PowerShell** or **Credential Manager application**  to encrypt credentials from another machine (in the network) other than where the self-hosted integration runtime is installed, then you would require the **'Remote Access from Intranet'** option to be enabled.</span><span class="sxs-lookup"><span data-stu-id="7e081-337">In case if you use **PowerShell** or **Credential Manager application**  to encrypt credentials from another machine (in the network) other than where the self-hosted integration runtime is installed, then you would require the **'Remote Access from Intranet'** option to be enabled.</span></span> <span data-ttu-id="7e081-338">If you run the **PowerShell** or **Credential Manager application**  to encrypt credential on the same machine where the self-hosted integration runtime is installed, then **'Remote Access from Intranet'** may not be enabled.</span><span class="sxs-lookup"><span data-stu-id="7e081-338">If you run the **PowerShell** or **Credential Manager application**  to encrypt credential on the same machine where the self-hosted integration runtime is installed, then **'Remote Access from Intranet'** may not be enabled.</span></span>

<span data-ttu-id="7e081-339">Remote Access from Intranet should be **enabled** before adding another node for **High Availability and Scalability**.</span><span class="sxs-lookup"><span data-stu-id="7e081-339">Remote Access from Intranet should be **enabled** before adding another node for **High Availability and Scalability**.</span></span>  

<span data-ttu-id="7e081-340">During self-hosted integration runtime setup (v 3.3.xxxx.x onwards), by default, the self-hosted integration runtime installation disables the **'Remote Access from Intranet'** on the self-hosted integration runtime machine.</span><span class="sxs-lookup"><span data-stu-id="7e081-340">During self-hosted integration runtime setup (v 3.3.xxxx.x onwards), by default, the self-hosted integration runtime installation disables the **'Remote Access from Intranet'** on the self-hosted integration runtime machine.</span></span>

<span data-ttu-id="7e081-341">If you are using a third-party firewall, you can manually open the port 8060 (or the user configured port).</span><span class="sxs-lookup"><span data-stu-id="7e081-341">If you are using a third-party firewall, you can manually open the port 8060 (or the user configured port).</span></span> <span data-ttu-id="7e081-342">If you run into firewall issue during self-hosted integration runtime setup, you can try using the following command to install the self-hosted integration runtime without configuring the firewall.</span><span class="sxs-lookup"><span data-stu-id="7e081-342">If you run into firewall issue during self-hosted integration runtime setup, you can try using the following command to install the self-hosted integration runtime without configuring the firewall.</span></span>

```
msiexec /q /i IntegrationRuntime.msi NOFIREWALL=1
```
> [!NOTE]
> <span data-ttu-id="7e081-343">**Credential Manager Application** is not yet available for encrypting credentials in ADFv2.</span><span class="sxs-lookup"><span data-stu-id="7e081-343">**Credential Manager Application** is not yet available for encrypting credentials in ADFv2.</span></span> <span data-ttu-id="7e081-344">We will add this support later.</span><span class="sxs-lookup"><span data-stu-id="7e081-344">We will add this support later.</span></span>  

<span data-ttu-id="7e081-345">If you choose not to open the port 8060 on the self-hosted integration runtime machine, use mechanisms other than using the \*\*Setting Credentials \*\*application to configure data store credentials.</span><span class="sxs-lookup"><span data-stu-id="7e081-345">If you choose not to open the port 8060 on the self-hosted integration runtime machine, use mechanisms other than using the \*\*Setting Credentials \*\*application to configure data store credentials.</span></span> <span data-ttu-id="7e081-346">For example, you could use New-AzureRmDataFactoryV2LinkedServiceEncryptCredential PowerShell cmdlet.</span><span class="sxs-lookup"><span data-stu-id="7e081-346">For example, you could use New-AzureRmDataFactoryV2LinkedServiceEncryptCredential PowerShell cmdlet.</span></span> <span data-ttu-id="7e081-347">See Setting Credentials and Security section on how data store credentials can be set.</span><span class="sxs-lookup"><span data-stu-id="7e081-347">See Setting Credentials and Security section on how data store credentials can be set.</span></span>


## <a name="next-steps"></a><span data-ttu-id="7e081-348">Next steps</span><span class="sxs-lookup"><span data-stu-id="7e081-348">Next steps</span></span>
<span data-ttu-id="7e081-349">See the following tutorial for step-by-step instructions: [Tutorial: copy on-premises data to cloud](tutorial-hybrid-copy-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="7e081-349">See the following tutorial for step-by-step instructions: [Tutorial: copy on-premises data to cloud](tutorial-hybrid-copy-powershell.md).</span></span>
