---
title: Configure a Virtual Network for a Premium Azure Redis Cache | Microsoft Docs
description: Learn how to create and manage Virtual Network support for your Premium tier Azure Redis Cache instances
services: redis-cache
documentationcenter: ''
author: steved0x
manager: douge
editor: ''
ms.assetid: 8b1e43a0-a70e-41e6-8994-0ac246d8bf7f
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 04/12/2017
ms.author: sdanie
ms.openlocfilehash: 0e6182bde878b48d888871843faa229d07ff9f6d
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44563398"
---
# <a name="how-to-configure-virtual-network-support-for-a-premium-azure-redis-cache"></a><span data-ttu-id="c2c34-103">How to configure Virtual Network Support for a Premium Azure Redis Cache</span><span class="sxs-lookup"><span data-stu-id="c2c34-103">How to configure Virtual Network Support for a Premium Azure Redis Cache</span></span>
<span data-ttu-id="c2c34-104">Azure Redis Cache has different cache offerings, which provide flexibility in the choice of cache size and features, including Premium tier features such as clustering, persistence, and virtual network support.</span><span class="sxs-lookup"><span data-stu-id="c2c34-104">Azure Redis Cache has different cache offerings, which provide flexibility in the choice of cache size and features, including Premium tier features such as clustering, persistence, and virtual network support.</span></span> <span data-ttu-id="c2c34-105">A VNet is a private network in the cloud.</span><span class="sxs-lookup"><span data-stu-id="c2c34-105">A VNet is a private network in the cloud.</span></span> <span data-ttu-id="c2c34-106">When an Azure Redis Cache instance is configured with a VNet, it is not publicly addressable and can only be accessed from virtual machines and applications within the VNet.</span><span class="sxs-lookup"><span data-stu-id="c2c34-106">When an Azure Redis Cache instance is configured with a VNet, it is not publicly addressable and can only be accessed from virtual machines and applications within the VNet.</span></span> <span data-ttu-id="c2c34-107">This article describes how to configure virtual network support for a premium Azure Redis Cache instance.</span><span class="sxs-lookup"><span data-stu-id="c2c34-107">This article describes how to configure virtual network support for a premium Azure Redis Cache instance.</span></span>

> [!NOTE]
> <span data-ttu-id="c2c34-108">Azure Redis Cache supports both classic and Resource Manager VNets.</span><span class="sxs-lookup"><span data-stu-id="c2c34-108">Azure Redis Cache supports both classic and Resource Manager VNets.</span></span>
> 
> 

<span data-ttu-id="c2c34-109">For information on other premium cache features, see [Introduction to the Azure Redis Cache Premium tier](cache-premium-tier-intro.md).</span><span class="sxs-lookup"><span data-stu-id="c2c34-109">For information on other premium cache features, see [Introduction to the Azure Redis Cache Premium tier](cache-premium-tier-intro.md).</span></span>

## <a name="why-vnet"></a><span data-ttu-id="c2c34-110">Why VNet?</span><span class="sxs-lookup"><span data-stu-id="c2c34-110">Why VNet?</span></span>
<span data-ttu-id="c2c34-111">[Azure Virtual Network (VNet)](https://azure.microsoft.com/services/virtual-network/) deployment provides enhanced security and isolation for your Azure Redis Cache, as well as subnets, access control policies, and other features to further restrict access.</span><span class="sxs-lookup"><span data-stu-id="c2c34-111">[Azure Virtual Network (VNet)](https://azure.microsoft.com/services/virtual-network/) deployment provides enhanced security and isolation for your Azure Redis Cache, as well as subnets, access control policies, and other features to further restrict access.</span></span>

## <a name="virtual-network-support"></a><span data-ttu-id="c2c34-112">Virtual network support</span><span class="sxs-lookup"><span data-stu-id="c2c34-112">Virtual network support</span></span>
<span data-ttu-id="c2c34-113">Virtual Network (VNet) support is configured on the **New Redis Cache** blade during cache creation.</span><span class="sxs-lookup"><span data-stu-id="c2c34-113">Virtual Network (VNet) support is configured on the **New Redis Cache** blade during cache creation.</span></span> 

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

<span data-ttu-id="c2c34-114">Once you have selected a premium pricing tier, you can configure Redis VNet integration by selecting a VNet that is in the same subscription and location as your cache.</span><span class="sxs-lookup"><span data-stu-id="c2c34-114">Once you have selected a premium pricing tier, you can configure Redis VNet integration by selecting a VNet that is in the same subscription and location as your cache.</span></span> <span data-ttu-id="c2c34-115">To use a new VNet, create it first by following the steps in [Create a virtual network using the Azure portal](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) or [Create a virtual network (classic) by using the Azure portal](../virtual-network/virtual-networks-create-vnet-classic-portal.md) and then return to the **New Redis Cache** blade to create and configure your premium cache.</span><span class="sxs-lookup"><span data-stu-id="c2c34-115">To use a new VNet, create it first by following the steps in [Create a virtual network using the Azure portal](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) or [Create a virtual network (classic) by using the Azure portal](../virtual-network/virtual-networks-create-vnet-classic-portal.md) and then return to the **New Redis Cache** blade to create and configure your premium cache.</span></span>

<span data-ttu-id="c2c34-116">To configure the VNet for your new cache, click **Virtual Network** on the **New Redis Cache** blade, and select the desired VNet from the drop-down list.</span><span class="sxs-lookup"><span data-stu-id="c2c34-116">To configure the VNet for your new cache, click **Virtual Network** on the **New Redis Cache** blade, and select the desired VNet from the drop-down list.</span></span>

![Virtual network][redis-cache-vnet]

<span data-ttu-id="c2c34-118">Select the desired subnet from the **Subnet** drop-down list, and specify the desired **Static IP address**.</span><span class="sxs-lookup"><span data-stu-id="c2c34-118">Select the desired subnet from the **Subnet** drop-down list, and specify the desired **Static IP address**.</span></span> <span data-ttu-id="c2c34-119">If you are using a classic VNet the **Static IP address** field is optional, and if none is specified, one is chosen from the selected subnet.</span><span class="sxs-lookup"><span data-stu-id="c2c34-119">If you are using a classic VNet the **Static IP address** field is optional, and if none is specified, one is chosen from the selected subnet.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c2c34-120">When deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resources except for Azure Redis Cache instances.</span><span class="sxs-lookup"><span data-stu-id="c2c34-120">When deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resources except for Azure Redis Cache instances.</span></span> <span data-ttu-id="c2c34-121">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet to a subnet that contains other resources, the deployment fails.</span><span class="sxs-lookup"><span data-stu-id="c2c34-121">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet to a subnet that contains other resources, the deployment fails.</span></span>
> 
> 

![Virtual network][redis-cache-vnet-ip]

> [!IMPORTANT]
> <span data-ttu-id="c2c34-123">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span><span class="sxs-lookup"><span data-stu-id="c2c34-123">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="c2c34-124">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span><span class="sxs-lookup"><span data-stu-id="c2c34-124">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="c2c34-125">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="c2c34-125">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>
> 
> <span data-ttu-id="c2c34-126">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span><span class="sxs-lookup"><span data-stu-id="c2c34-126">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="c2c34-127">A non-clustered cache is considered to have one shard.</span><span class="sxs-lookup"><span data-stu-id="c2c34-127">A non-clustered cache is considered to have one shard.</span></span>
> 
> 

<span data-ttu-id="c2c34-128">After the cache is created, you can view the configuration for the VNet by clicking **Virtual Network** from the **Resource menu**.</span><span class="sxs-lookup"><span data-stu-id="c2c34-128">After the cache is created, you can view the configuration for the VNet by clicking **Virtual Network** from the **Resource menu**.</span></span>

![Virtual network][redis-cache-vnet-info]

<span data-ttu-id="c2c34-130">To connect to your Azure Redis cache instance when using a VNet, specify the host name of your cache in the connection string as shown in the following example:</span><span class="sxs-lookup"><span data-stu-id="c2c34-130">To connect to your Azure Redis cache instance when using a VNet, specify the host name of your cache in the connection string as shown in the following example:</span></span>

    private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
    {
        return ConnectionMultiplexer.Connect("contoso5premium.redis.cache.windows.net,abortConnect=false,ssl=true,password=password");
    });

    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }

## <a name="azure-redis-cache-vnet-faq"></a><span data-ttu-id="c2c34-131">Azure Redis Cache VNet FAQ</span><span class="sxs-lookup"><span data-stu-id="c2c34-131">Azure Redis Cache VNet FAQ</span></span>
<span data-ttu-id="c2c34-132">The following list contains answers to commonly asked questions about the Azure Redis Cache scaling.</span><span class="sxs-lookup"><span data-stu-id="c2c34-132">The following list contains answers to commonly asked questions about the Azure Redis Cache scaling.</span></span>

* [<span data-ttu-id="c2c34-133">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span><span class="sxs-lookup"><span data-stu-id="c2c34-133">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>](#what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets)
* [<span data-ttu-id="c2c34-134">Can I use VNets with a standard or basic cache?</span><span class="sxs-lookup"><span data-stu-id="c2c34-134">Can I use VNets with a standard or basic cache?</span></span>](#can-i-use-vnets-with-a-standard-or-basic-cache)
* [<span data-ttu-id="c2c34-135">Why does creating a Redis cache fail in some subnets but not others?</span><span class="sxs-lookup"><span data-stu-id="c2c34-135">Why does creating a Redis cache fail in some subnets but not others?</span></span>](#why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others)
* [<span data-ttu-id="c2c34-136">What are the subnet address space requirements?</span><span class="sxs-lookup"><span data-stu-id="c2c34-136">What are the subnet address space requirements?</span></span>](#what-are-the-subnet-address-space-requirements)
* [<span data-ttu-id="c2c34-137">Do all cache features work when hosting a cache in a VNET?</span><span class="sxs-lookup"><span data-stu-id="c2c34-137">Do all cache features work when hosting a cache in a VNET?</span></span>](#do-all-cache-features-work-when-hosting-a-cache-in-a-vnet)

## <a name="what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets"></a><span data-ttu-id="c2c34-138">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span><span class="sxs-lookup"><span data-stu-id="c2c34-138">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>
<span data-ttu-id="c2c34-139">When Azure Redis Cache is hosted in a VNet, the ports in the following table are used.</span><span class="sxs-lookup"><span data-stu-id="c2c34-139">When Azure Redis Cache is hosted in a VNet, the ports in the following table are used.</span></span> <span data-ttu-id="c2c34-140">If these ports are blocked, the cache may not function correctly.</span><span class="sxs-lookup"><span data-stu-id="c2c34-140">If these ports are blocked, the cache may not function correctly.</span></span> <span data-ttu-id="c2c34-141">Having one or more of these ports blocked is the most common misconfiguration issue when using Azure Redis Cache in a VNet.</span><span class="sxs-lookup"><span data-stu-id="c2c34-141">Having one or more of these ports blocked is the most common misconfiguration issue when using Azure Redis Cache in a VNet.</span></span>

| <span data-ttu-id="c2c34-142">Port(s)</span><span class="sxs-lookup"><span data-stu-id="c2c34-142">Port(s)</span></span> | <span data-ttu-id="c2c34-143">Direction</span><span class="sxs-lookup"><span data-stu-id="c2c34-143">Direction</span></span> | <span data-ttu-id="c2c34-144">Transport Protocol</span><span class="sxs-lookup"><span data-stu-id="c2c34-144">Transport Protocol</span></span> | <span data-ttu-id="c2c34-145">Purpose</span><span class="sxs-lookup"><span data-stu-id="c2c34-145">Purpose</span></span> | <span data-ttu-id="c2c34-146">Remote IP</span><span class="sxs-lookup"><span data-stu-id="c2c34-146">Remote IP</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="c2c34-147">80, 443</span><span class="sxs-lookup"><span data-stu-id="c2c34-147">80, 443</span></span> |<span data-ttu-id="c2c34-148">Outbound</span><span class="sxs-lookup"><span data-stu-id="c2c34-148">Outbound</span></span> |<span data-ttu-id="c2c34-149">TCP</span><span class="sxs-lookup"><span data-stu-id="c2c34-149">TCP</span></span> |<span data-ttu-id="c2c34-150">Redis dependencies on Azure Storage/PKI (Internet)</span><span class="sxs-lookup"><span data-stu-id="c2c34-150">Redis dependencies on Azure Storage/PKI (Internet)</span></span> |* |
| <span data-ttu-id="c2c34-151">53</span><span class="sxs-lookup"><span data-stu-id="c2c34-151">53</span></span> |<span data-ttu-id="c2c34-152">Outbound</span><span class="sxs-lookup"><span data-stu-id="c2c34-152">Outbound</span></span> |<span data-ttu-id="c2c34-153">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="c2c34-153">TCP/UDP</span></span> |<span data-ttu-id="c2c34-154">Redis dependencies on DNS (Internet/VNet)</span><span class="sxs-lookup"><span data-stu-id="c2c34-154">Redis dependencies on DNS (Internet/VNet)</span></span> |* |
| <span data-ttu-id="c2c34-155">6379, 6380</span><span class="sxs-lookup"><span data-stu-id="c2c34-155">6379, 6380</span></span> |<span data-ttu-id="c2c34-156">Inbound</span><span class="sxs-lookup"><span data-stu-id="c2c34-156">Inbound</span></span> |<span data-ttu-id="c2c34-157">TCP</span><span class="sxs-lookup"><span data-stu-id="c2c34-157">TCP</span></span> |<span data-ttu-id="c2c34-158">Client communication to Redis, Azure Load Balancing</span><span class="sxs-lookup"><span data-stu-id="c2c34-158">Client communication to Redis, Azure Load Balancing</span></span> |<span data-ttu-id="c2c34-159">VIRTUAL_NETWORK, AZURE_LOADBALANCER</span><span class="sxs-lookup"><span data-stu-id="c2c34-159">VIRTUAL_NETWORK, AZURE_LOADBALANCER</span></span> |
| <span data-ttu-id="c2c34-160">8443</span><span class="sxs-lookup"><span data-stu-id="c2c34-160">8443</span></span> |<span data-ttu-id="c2c34-161">Inbound/Outbound</span><span class="sxs-lookup"><span data-stu-id="c2c34-161">Inbound/Outbound</span></span> |<span data-ttu-id="c2c34-162">TCP</span><span class="sxs-lookup"><span data-stu-id="c2c34-162">TCP</span></span> |<span data-ttu-id="c2c34-163">Implementation Detail for Redis</span><span class="sxs-lookup"><span data-stu-id="c2c34-163">Implementation Detail for Redis</span></span> |<span data-ttu-id="c2c34-164">VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="c2c34-164">VIRTUAL_NETWORK</span></span> |
| <span data-ttu-id="c2c34-165">8500</span><span class="sxs-lookup"><span data-stu-id="c2c34-165">8500</span></span> |<span data-ttu-id="c2c34-166">Inbound</span><span class="sxs-lookup"><span data-stu-id="c2c34-166">Inbound</span></span> |<span data-ttu-id="c2c34-167">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="c2c34-167">TCP/UDP</span></span> |<span data-ttu-id="c2c34-168">Azure Load Balancing</span><span class="sxs-lookup"><span data-stu-id="c2c34-168">Azure Load Balancing</span></span> |<span data-ttu-id="c2c34-169">AZURE_LOADBALANCER</span><span class="sxs-lookup"><span data-stu-id="c2c34-169">AZURE_LOADBALANCER</span></span> |
| <span data-ttu-id="c2c34-170">10221-10231</span><span class="sxs-lookup"><span data-stu-id="c2c34-170">10221-10231</span></span> |<span data-ttu-id="c2c34-171">Inbound/Outbound</span><span class="sxs-lookup"><span data-stu-id="c2c34-171">Inbound/Outbound</span></span> |<span data-ttu-id="c2c34-172">TCP</span><span class="sxs-lookup"><span data-stu-id="c2c34-172">TCP</span></span> |<span data-ttu-id="c2c34-173">Implementation Detail for Redis (can restrict remote endpoint to VIRTUAL_NETWORK)</span><span class="sxs-lookup"><span data-stu-id="c2c34-173">Implementation Detail for Redis (can restrict remote endpoint to VIRTUAL_NETWORK)</span></span> |<span data-ttu-id="c2c34-174">VIRTUAL_NETWORK, AZURE_LOADBALANCER</span><span class="sxs-lookup"><span data-stu-id="c2c34-174">VIRTUAL_NETWORK, AZURE_LOADBALANCER</span></span> |
| <span data-ttu-id="c2c34-175">13000-13999</span><span class="sxs-lookup"><span data-stu-id="c2c34-175">13000-13999</span></span> |<span data-ttu-id="c2c34-176">Inbound</span><span class="sxs-lookup"><span data-stu-id="c2c34-176">Inbound</span></span> |<span data-ttu-id="c2c34-177">TCP</span><span class="sxs-lookup"><span data-stu-id="c2c34-177">TCP</span></span> |<span data-ttu-id="c2c34-178">Client communication to Redis Clusters, Azure Load Balancing</span><span class="sxs-lookup"><span data-stu-id="c2c34-178">Client communication to Redis Clusters, Azure Load Balancing</span></span> |<span data-ttu-id="c2c34-179">VIRTUAL_NETWORK, AZURE_LOADBALANCER</span><span class="sxs-lookup"><span data-stu-id="c2c34-179">VIRTUAL_NETWORK, AZURE_LOADBALANCER</span></span> |
| <span data-ttu-id="c2c34-180">15000-15999</span><span class="sxs-lookup"><span data-stu-id="c2c34-180">15000-15999</span></span> |<span data-ttu-id="c2c34-181">Inbound</span><span class="sxs-lookup"><span data-stu-id="c2c34-181">Inbound</span></span> |<span data-ttu-id="c2c34-182">TCP</span><span class="sxs-lookup"><span data-stu-id="c2c34-182">TCP</span></span> |<span data-ttu-id="c2c34-183">Client communication to Redis Clusters, Azure Load Balancing</span><span class="sxs-lookup"><span data-stu-id="c2c34-183">Client communication to Redis Clusters, Azure Load Balancing</span></span> |<span data-ttu-id="c2c34-184">VIRTUAL_NETWORK, AZURE_LOADBALANCER</span><span class="sxs-lookup"><span data-stu-id="c2c34-184">VIRTUAL_NETWORK, AZURE_LOADBALANCER</span></span> |
| <span data-ttu-id="c2c34-185">16001</span><span class="sxs-lookup"><span data-stu-id="c2c34-185">16001</span></span> |<span data-ttu-id="c2c34-186">Inbound</span><span class="sxs-lookup"><span data-stu-id="c2c34-186">Inbound</span></span> |<span data-ttu-id="c2c34-187">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="c2c34-187">TCP/UDP</span></span> |<span data-ttu-id="c2c34-188">Azure Load Balancing</span><span class="sxs-lookup"><span data-stu-id="c2c34-188">Azure Load Balancing</span></span> |<span data-ttu-id="c2c34-189">AZURE_LOADBALANCER</span><span class="sxs-lookup"><span data-stu-id="c2c34-189">AZURE_LOADBALANCER</span></span> |
| <span data-ttu-id="c2c34-190">20226</span><span class="sxs-lookup"><span data-stu-id="c2c34-190">20226</span></span> |<span data-ttu-id="c2c34-191">Inbound+Outbound</span><span class="sxs-lookup"><span data-stu-id="c2c34-191">Inbound+Outbound</span></span> |<span data-ttu-id="c2c34-192">TCP</span><span class="sxs-lookup"><span data-stu-id="c2c34-192">TCP</span></span> |<span data-ttu-id="c2c34-193">Implementation Detail for Redis Clusters</span><span class="sxs-lookup"><span data-stu-id="c2c34-193">Implementation Detail for Redis Clusters</span></span> |<span data-ttu-id="c2c34-194">VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="c2c34-194">VIRTUAL_NETWORK</span></span> |

<span data-ttu-id="c2c34-195">There are network connectivity requirements for Azure Redis Cache that may not be initially met in a virtual network.</span><span class="sxs-lookup"><span data-stu-id="c2c34-195">There are network connectivity requirements for Azure Redis Cache that may not be initially met in a virtual network.</span></span> <span data-ttu-id="c2c34-196">Azure Redis Cache requires all the following items to function properly when used within a virtual network.</span><span class="sxs-lookup"><span data-stu-id="c2c34-196">Azure Redis Cache requires all the following items to function properly when used within a virtual network.</span></span>

* <span data-ttu-id="c2c34-197">Outbound network connectivity to Azure Storage endpoints worldwide.</span><span class="sxs-lookup"><span data-stu-id="c2c34-197">Outbound network connectivity to Azure Storage endpoints worldwide.</span></span> <span data-ttu-id="c2c34-198">This includes endpoints located in the same region as the Azure Redis Cache instance, as well as storage endpoints located in **other** Azure regions.</span><span class="sxs-lookup"><span data-stu-id="c2c34-198">This includes endpoints located in the same region as the Azure Redis Cache instance, as well as storage endpoints located in **other** Azure regions.</span></span> <span data-ttu-id="c2c34-199">Azure Storage endpoints resolve under the following DNS domains: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, and *file.core.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="c2c34-199">Azure Storage endpoints resolve under the following DNS domains: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, and *file.core.windows.net*.</span></span> 
* <span data-ttu-id="c2c34-200">Outbound network connectivity to *ocsp.msocsp.com*, *mscrl.microsoft.com*, and *crl.microsoft.com*.</span><span class="sxs-lookup"><span data-stu-id="c2c34-200">Outbound network connectivity to *ocsp.msocsp.com*, *mscrl.microsoft.com*, and *crl.microsoft.com*.</span></span> <span data-ttu-id="c2c34-201">This connectivity is needed to support SSL functionality.</span><span class="sxs-lookup"><span data-stu-id="c2c34-201">This connectivity is needed to support SSL functionality.</span></span>
* <span data-ttu-id="c2c34-202">The DNS configuration for the virtual network must be capable of resolving all of the endpoints and domains mentioned in the earlier points.</span><span class="sxs-lookup"><span data-stu-id="c2c34-202">The DNS configuration for the virtual network must be capable of resolving all of the endpoints and domains mentioned in the earlier points.</span></span> <span data-ttu-id="c2c34-203">These DNS requirements can be met by ensuring a valid DNS infrastructure is configured and maintained for the virtual network.</span><span class="sxs-lookup"><span data-stu-id="c2c34-203">These DNS requirements can be met by ensuring a valid DNS infrastructure is configured and maintained for the virtual network.</span></span>
* <span data-ttu-id="c2c34-204">Outbound network connectivity to the following Azure Monitoring endpoints, which resolve under the following DNS domains: shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net, azglobal-red.azglobal.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="c2c34-204">Outbound network connectivity to the following Azure Monitoring endpoints, which resolve under the following DNS domains: shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net, azglobal-red.azglobal.metrics.nsatc.net.</span></span>

### <a name="can-i-use-vnets-with-a-standard-or-basic-cache"></a><span data-ttu-id="c2c34-205">Can I use VNets with a standard or basic cache?</span><span class="sxs-lookup"><span data-stu-id="c2c34-205">Can I use VNets with a standard or basic cache?</span></span>
<span data-ttu-id="c2c34-206">VNets can only be used with premium caches.</span><span class="sxs-lookup"><span data-stu-id="c2c34-206">VNets can only be used with premium caches.</span></span>

### <a name="why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others"></a><span data-ttu-id="c2c34-207">Why does creating a Redis cache fail in some subnets but not others?</span><span class="sxs-lookup"><span data-stu-id="c2c34-207">Why does creating a Redis cache fail in some subnets but not others?</span></span>
<span data-ttu-id="c2c34-208">If you are deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resource type.</span><span class="sxs-lookup"><span data-stu-id="c2c34-208">If you are deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resource type.</span></span> <span data-ttu-id="c2c34-209">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet subnet that contains other resources, the deployment fails.</span><span class="sxs-lookup"><span data-stu-id="c2c34-209">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet subnet that contains other resources, the deployment fails.</span></span> <span data-ttu-id="c2c34-210">You must delete the existing resources inside the subnet before you can create a new Redis cache.</span><span class="sxs-lookup"><span data-stu-id="c2c34-210">You must delete the existing resources inside the subnet before you can create a new Redis cache.</span></span>

<span data-ttu-id="c2c34-211">You can deploy multiple types of resources to a classic VNet as long as you have enough IP addresses available.</span><span class="sxs-lookup"><span data-stu-id="c2c34-211">You can deploy multiple types of resources to a classic VNet as long as you have enough IP addresses available.</span></span>

### <a name="what-are-the-subnet-address-space-requirements"></a><span data-ttu-id="c2c34-212">What are the subnet address space requirements?</span><span class="sxs-lookup"><span data-stu-id="c2c34-212">What are the subnet address space requirements?</span></span>
<span data-ttu-id="c2c34-213">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span><span class="sxs-lookup"><span data-stu-id="c2c34-213">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="c2c34-214">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span><span class="sxs-lookup"><span data-stu-id="c2c34-214">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="c2c34-215">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="c2c34-215">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>

<span data-ttu-id="c2c34-216">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span><span class="sxs-lookup"><span data-stu-id="c2c34-216">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="c2c34-217">A non-clustered cache is considered to have one shard.</span><span class="sxs-lookup"><span data-stu-id="c2c34-217">A non-clustered cache is considered to have one shard.</span></span>

### <a name="do-all-cache-features-work-when-hosting-a-cache-in-a-vnet"></a><span data-ttu-id="c2c34-218">Do all cache features work when hosting a cache in a VNET?</span><span class="sxs-lookup"><span data-stu-id="c2c34-218">Do all cache features work when hosting a cache in a VNET?</span></span>
<span data-ttu-id="c2c34-219">When your cache is part of a VNET, only clients in the VNET can access the cache.</span><span class="sxs-lookup"><span data-stu-id="c2c34-219">When your cache is part of a VNET, only clients in the VNET can access the cache.</span></span> <span data-ttu-id="c2c34-220">As a result, the following cache management features don't work at this time.</span><span class="sxs-lookup"><span data-stu-id="c2c34-220">As a result, the following cache management features don't work at this time.</span></span>

* <span data-ttu-id="c2c34-221">Redis Console - Because Redis Console runs in your local browser, which is outside the VNET, it can't connect to your cache.</span><span class="sxs-lookup"><span data-stu-id="c2c34-221">Redis Console - Because Redis Console runs in your local browser, which is outside the VNET, it can't connect to your cache.</span></span>

## <a name="use-expressroute-with-azure-redis-cache"></a><span data-ttu-id="c2c34-222">Use ExpressRoute with Azure Redis Cache</span><span class="sxs-lookup"><span data-stu-id="c2c34-222">Use ExpressRoute with Azure Redis Cache</span></span>
<span data-ttu-id="c2c34-223">Customers can connect an [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) circuit to their virtual network infrastructure, thus extending their on-premises network to Azure.</span><span class="sxs-lookup"><span data-stu-id="c2c34-223">Customers can connect an [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) circuit to their virtual network infrastructure, thus extending their on-premises network to Azure.</span></span> 

<span data-ttu-id="c2c34-224">By default, a newly created ExpressRoute circuit advertises a default route that allows outbound Internet connectivity.</span><span class="sxs-lookup"><span data-stu-id="c2c34-224">By default, a newly created ExpressRoute circuit advertises a default route that allows outbound Internet connectivity.</span></span> <span data-ttu-id="c2c34-225">With this configuration, client applications are able to connect to other Azure endpoints including Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="c2c34-225">With this configuration, client applications are able to connect to other Azure endpoints including Azure Redis Cache.</span></span>

<span data-ttu-id="c2c34-226">However a common customer configuration is to define their own default route (0.0.0.0/0) which forces outbound Internet traffic to instead flow on-premises.</span><span class="sxs-lookup"><span data-stu-id="c2c34-226">However a common customer configuration is to define their own default route (0.0.0.0/0) which forces outbound Internet traffic to instead flow on-premises.</span></span> <span data-ttu-id="c2c34-227">This traffic flow breaks connectivity with Azure Redis Cache if the outbound traffic is then blocked on-premises such that the Azure Redis Cache instance is not able to communicate with its dependencies.</span><span class="sxs-lookup"><span data-stu-id="c2c34-227">This traffic flow breaks connectivity with Azure Redis Cache if the outbound traffic is then blocked on-premises such that the Azure Redis Cache instance is not able to communicate with its dependencies.</span></span>

<span data-ttu-id="c2c34-228">The solution is to define one (or more) user-defined routes (UDRs) on the subnet that contains the Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="c2c34-228">The solution is to define one (or more) user-defined routes (UDRs) on the subnet that contains the Azure Redis Cache.</span></span> <span data-ttu-id="c2c34-229">A UDR defines subnet-specific routes that will be honored instead of the default route.</span><span class="sxs-lookup"><span data-stu-id="c2c34-229">A UDR defines subnet-specific routes that will be honored instead of the default route.</span></span>

<span data-ttu-id="c2c34-230">If possible, it is recommended to use the following configuration:</span><span class="sxs-lookup"><span data-stu-id="c2c34-230">If possible, it is recommended to use the following configuration:</span></span>

* <span data-ttu-id="c2c34-231">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span><span class="sxs-lookup"><span data-stu-id="c2c34-231">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
* <span data-ttu-id="c2c34-232">The UDR applied to the subnet containing the Azure Redis Cache defines 0.0.0.0/0 with a working route for TCP/IP traffic to the public internet; for example by setting the next hop type to 'Internet'.</span><span class="sxs-lookup"><span data-stu-id="c2c34-232">The UDR applied to the subnet containing the Azure Redis Cache defines 0.0.0.0/0 with a working route for TCP/IP traffic to the public internet; for example by setting the next hop type to 'Internet'.</span></span>

<span data-ttu-id="c2c34-233">The combined effect of these steps is that the subnet level UDR takes precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="c2c34-233">The combined effect of these steps is that the subnet level UDR takes precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the Azure Redis Cache.</span></span>

<span data-ttu-id="c2c34-234">Connecting to an Azure Redis Cache instance from an on-premises application using ExpressRoute is not a typical usage scenario due to performance reasons (for best performance Azure Redis Cache clients should be in the same region as the Azure Redis Cache).</span><span class="sxs-lookup"><span data-stu-id="c2c34-234">Connecting to an Azure Redis Cache instance from an on-premises application using ExpressRoute is not a typical usage scenario due to performance reasons (for best performance Azure Redis Cache clients should be in the same region as the Azure Redis Cache).</span></span>

>[!IMPORTANT] 
><span data-ttu-id="c2c34-235">The routes defined in a UDR **must** be specific enough to take precedence over any routes advertised by the ExpressRoute configuration.</span><span class="sxs-lookup"><span data-stu-id="c2c34-235">The routes defined in a UDR **must** be specific enough to take precedence over any routes advertised by the ExpressRoute configuration.</span></span> <span data-ttu-id="c2c34-236">The following example uses the broad 0.0.0.0/0 address range, and as such can potentially be accidentally overridden by route advertisements using more specific address ranges.</span><span class="sxs-lookup"><span data-stu-id="c2c34-236">The following example uses the broad 0.0.0.0/0 address range, and as such can potentially be accidentally overridden by route advertisements using more specific address ranges.</span></span>

>[!WARNING]  
><span data-ttu-id="c2c34-237">Azure Redis Cache is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from the public peering path to the private peering path**.</span><span class="sxs-lookup"><span data-stu-id="c2c34-237">Azure Redis Cache is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from the public peering path to the private peering path**.</span></span> <span data-ttu-id="c2c34-238">ExpressRoute configurations that have public peering configured, receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span><span class="sxs-lookup"><span data-stu-id="c2c34-238">ExpressRoute configurations that have public peering configured, receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="c2c34-239">If these address ranges are incorrectly cross-advertised on the private peering path, the result is that all outbound network packets from the Azure Redis Cache instance's subnet are incorrectly force-tunneled to a customer's on-premises network infrastructure.</span><span class="sxs-lookup"><span data-stu-id="c2c34-239">If these address ranges are incorrectly cross-advertised on the private peering path, the result is that all outbound network packets from the Azure Redis Cache instance's subnet are incorrectly force-tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="c2c34-240">This network flow breaks Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="c2c34-240">This network flow breaks Azure Redis Cache.</span></span> <span data-ttu-id="c2c34-241">The solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span><span class="sxs-lookup"><span data-stu-id="c2c34-241">The solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span></span>


<span data-ttu-id="c2c34-242">Background information on user-defined routes is available in this [overview](../virtual-network/virtual-networks-udr-overview.md).</span><span class="sxs-lookup"><span data-stu-id="c2c34-242">Background information on user-defined routes is available in this [overview](../virtual-network/virtual-networks-udr-overview.md).</span></span>

<span data-ttu-id="c2c34-243">For more information about ExpressRoute, see [ExpressRoute technical overview](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="c2c34-243">For more information about ExpressRoute, see [ExpressRoute technical overview](../expressroute/expressroute-introduction.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="c2c34-244">Next steps</span><span class="sxs-lookup"><span data-stu-id="c2c34-244">Next steps</span></span>
<span data-ttu-id="c2c34-245">Learn how to use more premium cache features.</span><span class="sxs-lookup"><span data-stu-id="c2c34-245">Learn how to use more premium cache features.</span></span>

* [<span data-ttu-id="c2c34-246">Introduction to the Azure Redis Cache Premium tier</span><span class="sxs-lookup"><span data-stu-id="c2c34-246">Introduction to the Azure Redis Cache Premium tier</span></span>](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-vnet]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/redis-cache/media/cache-how-to-premium-vnet/redis-cache-vnet.png

[redis-cache-vnet-ip]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/redis-cache/media/cache-how-to-premium-vnet/redis-cache-vnet-ip.png

[redis-cache-vnet-info]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/redis-cache/media/cache-how-to-premium-vnet/redis-cache-vnet-info.png




