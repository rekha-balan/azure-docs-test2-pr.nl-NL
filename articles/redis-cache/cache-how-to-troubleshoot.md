---
title: How to troubleshoot Azure Redis Cache | Microsoft Docs
description: Learn how to resolve common issues with Azure Redis Cache.
services: redis-cache
documentationcenter: ''
author: steved0x
manager: douge
editor: ''
ms.assetid: 928b9b9c-d64f-4252-884f-af7ba8309af6
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 01/06/2017
ms.author: sdanie
ms.openlocfilehash: 2e9d1b644f1e80c7d916a261a6c47fcc11a1ffe0
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44564482"
---
# <a name="how-to-troubleshoot-azure-redis-cache"></a><span data-ttu-id="4deb2-103">How to troubleshoot Azure Redis Cache</span><span class="sxs-lookup"><span data-stu-id="4deb2-103">How to troubleshoot Azure Redis Cache</span></span>
<span data-ttu-id="4deb2-104">This article provides guidance for troubleshooting the following categories of Azure Redis Cache issues.</span><span class="sxs-lookup"><span data-stu-id="4deb2-104">This article provides guidance for troubleshooting the following categories of Azure Redis Cache issues.</span></span>

* <span data-ttu-id="4deb2-105">[Client side troubleshooting](#client-side-troubleshooting) - This section provides guidelines on identifying and resolving issues caused by the application connecting to Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="4deb2-105">[Client side troubleshooting](#client-side-troubleshooting) - This section provides guidelines on identifying and resolving issues caused by the application connecting to Azure Redis Cache.</span></span>
* <span data-ttu-id="4deb2-106">[Server side troubleshooting](#server-side-troubleshooting) - This section provides guidelines on identifying and resolving issues caused on the Azure Redis Cache server side.</span><span class="sxs-lookup"><span data-stu-id="4deb2-106">[Server side troubleshooting](#server-side-troubleshooting) - This section provides guidelines on identifying and resolving issues caused on the Azure Redis Cache server side.</span></span>
* <span data-ttu-id="4deb2-107">[StackExchange.Redis timeout exceptions](#stackexchangeredis-timeout-exceptions) - This section provides information on troubleshooting issues when using the StackExchange.Redis client.</span><span class="sxs-lookup"><span data-stu-id="4deb2-107">[StackExchange.Redis timeout exceptions](#stackexchangeredis-timeout-exceptions) - This section provides information on troubleshooting issues when using the StackExchange.Redis client.</span></span>

> [!NOTE]
> <span data-ttu-id="4deb2-108">Several of the troubleshooting steps in this guide include instructions to run Redis commands and monitor various performance metrics.</span><span class="sxs-lookup"><span data-stu-id="4deb2-108">Several of the troubleshooting steps in this guide include instructions to run Redis commands and monitor various performance metrics.</span></span> <span data-ttu-id="4deb2-109">For more information and instructions, see the articles in the [Additional information](#additional-information) section.</span><span class="sxs-lookup"><span data-stu-id="4deb2-109">For more information and instructions, see the articles in the [Additional information](#additional-information) section.</span></span>
> 
> 

## <a name="client-side-troubleshooting"></a><span data-ttu-id="4deb2-110">Client side troubleshooting</span><span class="sxs-lookup"><span data-stu-id="4deb2-110">Client side troubleshooting</span></span>
<span data-ttu-id="4deb2-111">This section discusses troubleshooting issues that occur because of a condition on the client application.</span><span class="sxs-lookup"><span data-stu-id="4deb2-111">This section discusses troubleshooting issues that occur because of a condition on the client application.</span></span>

* [<span data-ttu-id="4deb2-112">Memory pressure on the client</span><span class="sxs-lookup"><span data-stu-id="4deb2-112">Memory pressure on the client</span></span>](#memory-pressure-on-the-client)
* [<span data-ttu-id="4deb2-113">Burst of traffic</span><span class="sxs-lookup"><span data-stu-id="4deb2-113">Burst of traffic</span></span>](#burst-of-traffic)
* [<span data-ttu-id="4deb2-114">High client CPU usage</span><span class="sxs-lookup"><span data-stu-id="4deb2-114">High client CPU usage</span></span>](#high-client-cpu-usage)
* [<span data-ttu-id="4deb2-115">Client Side Bandwidth Exceeded</span><span class="sxs-lookup"><span data-stu-id="4deb2-115">Client Side Bandwidth Exceeded</span></span>](#client-side-bandwidth-exceeded)
* [<span data-ttu-id="4deb2-116">Large Request/Response Size</span><span class="sxs-lookup"><span data-stu-id="4deb2-116">Large Request/Response Size</span></span>](#large-requestresponse-size)
* [<span data-ttu-id="4deb2-117">What happened to my data in Redis?</span><span class="sxs-lookup"><span data-stu-id="4deb2-117">What happened to my data in Redis?</span></span>](#what-happened-to-my-data-in-redis)

### <a name="memory-pressure-on-the-client"></a><span data-ttu-id="4deb2-118">Memory pressure on the client</span><span class="sxs-lookup"><span data-stu-id="4deb2-118">Memory pressure on the client</span></span>
#### <a name="problem"></a><span data-ttu-id="4deb2-119">Problem</span><span class="sxs-lookup"><span data-stu-id="4deb2-119">Problem</span></span>
<span data-ttu-id="4deb2-120">Memory pressure on the client machine leads to all kinds of performance problems that can delay processing of data that was sent by the Redis instance without any delay.</span><span class="sxs-lookup"><span data-stu-id="4deb2-120">Memory pressure on the client machine leads to all kinds of performance problems that can delay processing of data that was sent by the Redis instance without any delay.</span></span> <span data-ttu-id="4deb2-121">When memory pressure hits, the system typically has to page data from physical memory to virtual memory which is on disk.</span><span class="sxs-lookup"><span data-stu-id="4deb2-121">When memory pressure hits, the system typically has to page data from physical memory to virtual memory which is on disk.</span></span> <span data-ttu-id="4deb2-122">This *page faulting* causes the system to slow down significantly.</span><span class="sxs-lookup"><span data-stu-id="4deb2-122">This *page faulting* causes the system to slow down significantly.</span></span>

#### <a name="measurement"></a><span data-ttu-id="4deb2-123">Measurement</span><span class="sxs-lookup"><span data-stu-id="4deb2-123">Measurement</span></span>
1. <span data-ttu-id="4deb2-124">Monitor memory usage on machine to make sure that it does not exceed available memory.</span><span class="sxs-lookup"><span data-stu-id="4deb2-124">Monitor memory usage on machine to make sure that it does not exceed available memory.</span></span> 
2. <span data-ttu-id="4deb2-125">Monitor the `Page Faults/Sec` performance counter.</span><span class="sxs-lookup"><span data-stu-id="4deb2-125">Monitor the `Page Faults/Sec` performance counter.</span></span> <span data-ttu-id="4deb2-126">Most systems will have some page faults even during normal operation, so watch for spikes in this page faults performance counter which correspond with timeouts.</span><span class="sxs-lookup"><span data-stu-id="4deb2-126">Most systems will have some page faults even during normal operation, so watch for spikes in this page faults performance counter which correspond with timeouts.</span></span>

#### <a name="resolution"></a><span data-ttu-id="4deb2-127">Resolution</span><span class="sxs-lookup"><span data-stu-id="4deb2-127">Resolution</span></span>
<span data-ttu-id="4deb2-128">Upgrade your client to a larger client VM size with more memory or dig into your memory usage patterns to reduce memory consuption.</span><span class="sxs-lookup"><span data-stu-id="4deb2-128">Upgrade your client to a larger client VM size with more memory or dig into your memory usage patterns to reduce memory consuption.</span></span>

### <a name="burst-of-traffic"></a><span data-ttu-id="4deb2-129">Burst of traffic</span><span class="sxs-lookup"><span data-stu-id="4deb2-129">Burst of traffic</span></span>
#### <a name="problem"></a><span data-ttu-id="4deb2-130">Problem</span><span class="sxs-lookup"><span data-stu-id="4deb2-130">Problem</span></span>
<span data-ttu-id="4deb2-131">Bursts of traffic combined with poor `ThreadPool` settings can result in delays in processing data already sent by the Redis Server but not yet consumed on the client side.</span><span class="sxs-lookup"><span data-stu-id="4deb2-131">Bursts of traffic combined with poor `ThreadPool` settings can result in delays in processing data already sent by the Redis Server but not yet consumed on the client side.</span></span>

#### <a name="measurement"></a><span data-ttu-id="4deb2-132">Measurement</span><span class="sxs-lookup"><span data-stu-id="4deb2-132">Measurement</span></span>
<span data-ttu-id="4deb2-133">Monitor how your `ThreadPool` statistics change over time using code [like this](https://github.com/JonCole/SampleCode/blob/master/ThreadPoolMonitor/ThreadPoolLogger.cs).</span><span class="sxs-lookup"><span data-stu-id="4deb2-133">Monitor how your `ThreadPool` statistics change over time using code [like this](https://github.com/JonCole/SampleCode/blob/master/ThreadPoolMonitor/ThreadPoolLogger.cs).</span></span> <span data-ttu-id="4deb2-134">You can also look at the `TimeoutException` message from StackExchange.Redis.</span><span class="sxs-lookup"><span data-stu-id="4deb2-134">You can also look at the `TimeoutException` message from StackExchange.Redis.</span></span> <span data-ttu-id="4deb2-135">Here is an example :</span><span class="sxs-lookup"><span data-stu-id="4deb2-135">Here is an example :</span></span>

    System.TimeoutException: Timeout performing EVAL, inst: 8, mgr: Inactive, queue: 0, qu: 0, qs: 0, qc: 0, wr: 0, wq: 0, in: 64221, ar: 0, 
    IOCP: (Busy=6,Free=999,Min=2,Max=1000), WORKER: (Busy=7,Free=8184,Min=2,Max=8191)

<span data-ttu-id="4deb2-136">In the above message, there are several issues that are interesting:</span><span class="sxs-lookup"><span data-stu-id="4deb2-136">In the above message, there are several issues that are interesting:</span></span>

1. <span data-ttu-id="4deb2-137">Notice that in the `IOCP` section and the `WORKER` section you have a `Busy` value that is greater than the `Min` value.</span><span class="sxs-lookup"><span data-stu-id="4deb2-137">Notice that in the `IOCP` section and the `WORKER` section you have a `Busy` value that is greater than the `Min` value.</span></span> <span data-ttu-id="4deb2-138">This means that your `ThreadPool` settings need adjusting.</span><span class="sxs-lookup"><span data-stu-id="4deb2-138">This means that your `ThreadPool` settings need adjusting.</span></span>
2. <span data-ttu-id="4deb2-139">You can also see `in: 64221`.</span><span class="sxs-lookup"><span data-stu-id="4deb2-139">You can also see `in: 64221`.</span></span> <span data-ttu-id="4deb2-140">This indicates that 64211 bytes have been received at the kernel socket layer but haven't yet been read by the application (e.g. StackExchange.Redis).</span><span class="sxs-lookup"><span data-stu-id="4deb2-140">This indicates that 64211 bytes have been received at the kernel socket layer but haven't yet been read by the application (e.g. StackExchange.Redis).</span></span> <span data-ttu-id="4deb2-141">This typically means that your application isn't reading data from the network as quickly as the server is sending it to you.</span><span class="sxs-lookup"><span data-stu-id="4deb2-141">This typically means that your application isn't reading data from the network as quickly as the server is sending it to you.</span></span>

#### <a name="resolution"></a><span data-ttu-id="4deb2-142">Resolution</span><span class="sxs-lookup"><span data-stu-id="4deb2-142">Resolution</span></span>
<span data-ttu-id="4deb2-143">Configure your [ThreadPool Settings](https://gist.github.com/JonCole/e65411214030f0d823cb) to make sure that your thread pool will scale up quickly under burst scenarios.</span><span class="sxs-lookup"><span data-stu-id="4deb2-143">Configure your [ThreadPool Settings](https://gist.github.com/JonCole/e65411214030f0d823cb) to make sure that your thread pool will scale up quickly under burst scenarios.</span></span>

### <a name="high-client-cpu-usage"></a><span data-ttu-id="4deb2-144">High client CPU usage</span><span class="sxs-lookup"><span data-stu-id="4deb2-144">High client CPU usage</span></span>
#### <a name="problem"></a><span data-ttu-id="4deb2-145">Problem</span><span class="sxs-lookup"><span data-stu-id="4deb2-145">Problem</span></span>
<span data-ttu-id="4deb2-146">High CPU usage on the client is an indication that the system cannot keep up with the work that it has been asked to perform.</span><span class="sxs-lookup"><span data-stu-id="4deb2-146">High CPU usage on the client is an indication that the system cannot keep up with the work that it has been asked to perform.</span></span> <span data-ttu-id="4deb2-147">This means that the client may fail to process a response from Redis in a timely fashion even though Redis sent the response very quickly.</span><span class="sxs-lookup"><span data-stu-id="4deb2-147">This means that the client may fail to process a response from Redis in a timely fashion even though Redis sent the response very quickly.</span></span>

#### <a name="measurement"></a><span data-ttu-id="4deb2-148">Measurement</span><span class="sxs-lookup"><span data-stu-id="4deb2-148">Measurement</span></span>
<span data-ttu-id="4deb2-149">Monitor the System Wide CPU usage through the Azure Portal or through the associated performance counter.</span><span class="sxs-lookup"><span data-stu-id="4deb2-149">Monitor the System Wide CPU usage through the Azure Portal or through the associated performance counter.</span></span> <span data-ttu-id="4deb2-150">Be careful not to monitor *process* CPU because a single process can have low CPU usage at the same time that overall system CPU can be high.</span><span class="sxs-lookup"><span data-stu-id="4deb2-150">Be careful not to monitor *process* CPU because a single process can have low CPU usage at the same time that overall system CPU can be high.</span></span> <span data-ttu-id="4deb2-151">Watch for spikes in CPU usage that correspond with timeouts.</span><span class="sxs-lookup"><span data-stu-id="4deb2-151">Watch for spikes in CPU usage that correspond with timeouts.</span></span> <span data-ttu-id="4deb2-152">As a result of high CPU, you may also see high `in: XXX` values in `TimeoutException` error messages as described in the [Burst of traffic](#burst-of-traffic) section.</span><span class="sxs-lookup"><span data-stu-id="4deb2-152">As a result of high CPU, you may also see high `in: XXX` values in `TimeoutException` error messages as described in the [Burst of traffic](#burst-of-traffic) section.</span></span>

> [!NOTE]
> <span data-ttu-id="4deb2-153">StackExchange.Redis 1.1.603 and later includes the `local-cpu` metric in `TimeoutException` error messages.</span><span class="sxs-lookup"><span data-stu-id="4deb2-153">StackExchange.Redis 1.1.603 and later includes the `local-cpu` metric in `TimeoutException` error messages.</span></span> <span data-ttu-id="4deb2-154">Ensure you using the latest version of the [StackExchange.Redis NuGet package](https://www.nuget.org/packages/StackExchange.Redis/).</span><span class="sxs-lookup"><span data-stu-id="4deb2-154">Ensure you using the latest version of the [StackExchange.Redis NuGet package](https://www.nuget.org/packages/StackExchange.Redis/).</span></span> <span data-ttu-id="4deb2-155">There are bugs constantly being fixed in the code to make it more robust to timeouts so having the latest version is important.</span><span class="sxs-lookup"><span data-stu-id="4deb2-155">There are bugs constantly being fixed in the code to make it more robust to timeouts so having the latest version is important.</span></span>
> 
> 

#### <a name="resolution"></a><span data-ttu-id="4deb2-156">Resolution</span><span class="sxs-lookup"><span data-stu-id="4deb2-156">Resolution</span></span>
<span data-ttu-id="4deb2-157">Upgrade to a larger VM size with more CPU capacity or investigate what is causing CPU spikes.</span><span class="sxs-lookup"><span data-stu-id="4deb2-157">Upgrade to a larger VM size with more CPU capacity or investigate what is causing CPU spikes.</span></span> 

### <a name="client-side-bandwidth-exceeded"></a><span data-ttu-id="4deb2-158">Client side bandwidth exceeded</span><span class="sxs-lookup"><span data-stu-id="4deb2-158">Client side bandwidth exceeded</span></span>
#### <a name="problem"></a><span data-ttu-id="4deb2-159">Problem</span><span class="sxs-lookup"><span data-stu-id="4deb2-159">Problem</span></span>
<span data-ttu-id="4deb2-160">Different sized client machines have limitations on how much network bandwidth they have available.</span><span class="sxs-lookup"><span data-stu-id="4deb2-160">Different sized client machines have limitations on how much network bandwidth they have available.</span></span> <span data-ttu-id="4deb2-161">If the client exceeds the available bandwidth, then data will not be processed on the client side as quickly as the server is sending it.</span><span class="sxs-lookup"><span data-stu-id="4deb2-161">If the client exceeds the available bandwidth, then data will not be processed on the client side as quickly as the server is sending it.</span></span> <span data-ttu-id="4deb2-162">This can lead to timeouts.</span><span class="sxs-lookup"><span data-stu-id="4deb2-162">This can lead to timeouts.</span></span>

#### <a name="measurement"></a><span data-ttu-id="4deb2-163">Measurement</span><span class="sxs-lookup"><span data-stu-id="4deb2-163">Measurement</span></span>
<span data-ttu-id="4deb2-164">Monitor how your Bandwidth usage change over time using code [like this](https://github.com/JonCole/SampleCode/blob/master/BandWidthMonitor/BandwidthLogger.cs).</span><span class="sxs-lookup"><span data-stu-id="4deb2-164">Monitor how your Bandwidth usage change over time using code [like this](https://github.com/JonCole/SampleCode/blob/master/BandWidthMonitor/BandwidthLogger.cs).</span></span> <span data-ttu-id="4deb2-165">Note that this code may not run successfully in some environments with restricted permissions (like Azure web sites).</span><span class="sxs-lookup"><span data-stu-id="4deb2-165">Note that this code may not run successfully in some environments with restricted permissions (like Azure web sites).</span></span>

#### <a name="resolution"></a><span data-ttu-id="4deb2-166">Resolution</span><span class="sxs-lookup"><span data-stu-id="4deb2-166">Resolution</span></span>
<span data-ttu-id="4deb2-167">Increase Client VM size or reduce network bandwidth consumption.</span><span class="sxs-lookup"><span data-stu-id="4deb2-167">Increase Client VM size or reduce network bandwidth consumption.</span></span>

### <a name="large-requestresponse-size"></a><span data-ttu-id="4deb2-168">Large Request/Response Size</span><span class="sxs-lookup"><span data-stu-id="4deb2-168">Large Request/Response Size</span></span>
#### <a name="problem"></a><span data-ttu-id="4deb2-169">Problem</span><span class="sxs-lookup"><span data-stu-id="4deb2-169">Problem</span></span>
<span data-ttu-id="4deb2-170">A large request/response can cause timeouts.</span><span class="sxs-lookup"><span data-stu-id="4deb2-170">A large request/response can cause timeouts.</span></span> <span data-ttu-id="4deb2-171">As an example, Suppose your timeout value configured on your client is 1 second.</span><span class="sxs-lookup"><span data-stu-id="4deb2-171">As an example, Suppose your timeout value configured on your client is 1 second.</span></span> <span data-ttu-id="4deb2-172">Your application requests two keys (e.g. 'A' and 'B') at the same time (using the same physical network connection).</span><span class="sxs-lookup"><span data-stu-id="4deb2-172">Your application requests two keys (e.g. 'A' and 'B') at the same time (using the same physical network connection).</span></span> <span data-ttu-id="4deb2-173">Most clients support "Pipelining" of requests, such that both requests 'A' and 'B' are sent on the wire to the server one after the other without waiting for the responses.</span><span class="sxs-lookup"><span data-stu-id="4deb2-173">Most clients support "Pipelining" of requests, such that both requests 'A' and 'B' are sent on the wire to the server one after the other without waiting for the responses.</span></span> <span data-ttu-id="4deb2-174">The server will send the responses back in the same order.</span><span class="sxs-lookup"><span data-stu-id="4deb2-174">The server will send the responses back in the same order.</span></span> <span data-ttu-id="4deb2-175">If response 'A' is large enough it can eat up most of the timeout for subsequent requests.</span><span class="sxs-lookup"><span data-stu-id="4deb2-175">If response 'A' is large enough it can eat up most of the timeout for subsequent requests.</span></span> 

<span data-ttu-id="4deb2-176">The following example demonstrates this scenario.</span><span class="sxs-lookup"><span data-stu-id="4deb2-176">The following example demonstrates this scenario.</span></span> <span data-ttu-id="4deb2-177">In this scenario, Request 'A' and 'B' are sent quickly, the server starts sending responses 'A' and 'B' quickly, but because of data transfer times, 'B' get stuck behind the other request and times out even though the server responded quickly.</span><span class="sxs-lookup"><span data-stu-id="4deb2-177">In this scenario, Request 'A' and 'B' are sent quickly, the server starts sending responses 'A' and 'B' quickly, but because of data transfer times, 'B' get stuck behind the other request and times out even though the server responded quickly.</span></span>

    |-------- 1 Second Timeout (A)----------|
    |-Request A-|
         |-------- 1 Second Timeout (B) ----------|
         |-Request B-|
                |- Read Response A --------|
                                           |- Read Response B-| (**TIMEOUT**)



#### <a name="measurement"></a><span data-ttu-id="4deb2-178">Measurement</span><span class="sxs-lookup"><span data-stu-id="4deb2-178">Measurement</span></span>
<span data-ttu-id="4deb2-179">This is a difficult one to measure.</span><span class="sxs-lookup"><span data-stu-id="4deb2-179">This is a difficult one to measure.</span></span> <span data-ttu-id="4deb2-180">You basically have to instrument your client code to track large requests and responses.</span><span class="sxs-lookup"><span data-stu-id="4deb2-180">You basically have to instrument your client code to track large requests and responses.</span></span> 

#### <a name="resolution"></a><span data-ttu-id="4deb2-181">Resolution</span><span class="sxs-lookup"><span data-stu-id="4deb2-181">Resolution</span></span>
1. <span data-ttu-id="4deb2-182">Redis is optimized for a large number of small values, rather than a few large values.</span><span class="sxs-lookup"><span data-stu-id="4deb2-182">Redis is optimized for a large number of small values, rather than a few large values.</span></span> <span data-ttu-id="4deb2-183">The preferred solution is to break up your data into related smaller values.</span><span class="sxs-lookup"><span data-stu-id="4deb2-183">The preferred solution is to break up your data into related smaller values.</span></span> <span data-ttu-id="4deb2-184">See the [What is the ideal value size range for redis? Is 100KB too large?](https://groups.google.com/forum/#!searchin/redis-db/size/redis-db/n7aa2A4DZDs/3OeEPHSQBAAJ) post for details around why smaller values are recommended.</span><span class="sxs-lookup"><span data-stu-id="4deb2-184">See the [What is the ideal value size range for redis? Is 100KB too large?](https://groups.google.com/forum/#!searchin/redis-db/size/redis-db/n7aa2A4DZDs/3OeEPHSQBAAJ) post for details around why smaller values are recommended.</span></span>
2. <span data-ttu-id="4deb2-185">Increase the size of your VM (for client and Redis Cache Server), to get higher bandwidth capabilities, reducing data transfer times for larger responses.</span><span class="sxs-lookup"><span data-stu-id="4deb2-185">Increase the size of your VM (for client and Redis Cache Server), to get higher bandwidth capabilities, reducing data transfer times for larger responses.</span></span> <span data-ttu-id="4deb2-186">Note that getting more bandwidth on just the server or just on the client may not be enough.</span><span class="sxs-lookup"><span data-stu-id="4deb2-186">Note that getting more bandwidth on just the server or just on the client may not be enough.</span></span> <span data-ttu-id="4deb2-187">Measure your bandwidth usage and compare it to the capabilities of the size of VM you currently have.</span><span class="sxs-lookup"><span data-stu-id="4deb2-187">Measure your bandwidth usage and compare it to the capabilities of the size of VM you currently have.</span></span>
3. <span data-ttu-id="4deb2-188">Increase the number of `ConnectionMultiplexer` objects you use and round-robin requests over different connections.</span><span class="sxs-lookup"><span data-stu-id="4deb2-188">Increase the number of `ConnectionMultiplexer` objects you use and round-robin requests over different connections.</span></span>

### <a name="what-happened-to-my-data-in-redis"></a><span data-ttu-id="4deb2-189">What happened to my data in Redis?</span><span class="sxs-lookup"><span data-stu-id="4deb2-189">What happened to my data in Redis?</span></span>
#### <a name="problem"></a><span data-ttu-id="4deb2-190">Problem</span><span class="sxs-lookup"><span data-stu-id="4deb2-190">Problem</span></span>
<span data-ttu-id="4deb2-191">I expected for certain data to be in my Azure Redis Cache instance but it didn't seem to be there.</span><span class="sxs-lookup"><span data-stu-id="4deb2-191">I expected for certain data to be in my Azure Redis Cache instance but it didn't seem to be there.</span></span>

#### <a name="resolution"></a><span data-ttu-id="4deb2-192">Resolution</span><span class="sxs-lookup"><span data-stu-id="4deb2-192">Resolution</span></span>
<span data-ttu-id="4deb2-193">See [What happened to my data in Redis?](https://gist.github.com/JonCole/b6354d92a2d51c141490f10142884ea4#file-whathappenedtomydatainredis-md) for possible causes and resolutions.</span><span class="sxs-lookup"><span data-stu-id="4deb2-193">See [What happened to my data in Redis?](https://gist.github.com/JonCole/b6354d92a2d51c141490f10142884ea4#file-whathappenedtomydatainredis-md) for possible causes and resolutions.</span></span>

## <a name="server-side-troubleshooting"></a><span data-ttu-id="4deb2-194">Server side troubleshooting</span><span class="sxs-lookup"><span data-stu-id="4deb2-194">Server side troubleshooting</span></span>
<span data-ttu-id="4deb2-195">This section discusses troubleshooting issues that occur because of a condition on the cache server.</span><span class="sxs-lookup"><span data-stu-id="4deb2-195">This section discusses troubleshooting issues that occur because of a condition on the cache server.</span></span>

* [<span data-ttu-id="4deb2-196">Memory Pressure on the server</span><span class="sxs-lookup"><span data-stu-id="4deb2-196">Memory Pressure on the server</span></span>](#memory-pressure-on-the-server)
* [<span data-ttu-id="4deb2-197">High CPU usage / Server Load</span><span class="sxs-lookup"><span data-stu-id="4deb2-197">High CPU usage / Server Load</span></span>](#high-cpu-usage-server-load)
* [<span data-ttu-id="4deb2-198">Server Side Bandwidth Exceeded</span><span class="sxs-lookup"><span data-stu-id="4deb2-198">Server Side Bandwidth Exceeded</span></span>](#server-side-bandwidth-exceeded)

### <a name="memory-pressure-on-the-server"></a><span data-ttu-id="4deb2-199">Memory Pressure on the server</span><span class="sxs-lookup"><span data-stu-id="4deb2-199">Memory Pressure on the server</span></span>
#### <a name="problem"></a><span data-ttu-id="4deb2-200">Problem</span><span class="sxs-lookup"><span data-stu-id="4deb2-200">Problem</span></span>
<span data-ttu-id="4deb2-201">Memory pressure on the server side leads to all kinds of performance problems that can delay processing of requests.</span><span class="sxs-lookup"><span data-stu-id="4deb2-201">Memory pressure on the server side leads to all kinds of performance problems that can delay processing of requests.</span></span> <span data-ttu-id="4deb2-202">When memory pressure hits, the system typically has to page data from physical memory to virtual memory which is on disk.</span><span class="sxs-lookup"><span data-stu-id="4deb2-202">When memory pressure hits, the system typically has to page data from physical memory to virtual memory which is on disk.</span></span> <span data-ttu-id="4deb2-203">This *page faulting* causes the system to slow down significantly.</span><span class="sxs-lookup"><span data-stu-id="4deb2-203">This *page faulting* causes the system to slow down significantly.</span></span> <span data-ttu-id="4deb2-204">There are several possible causes of this memory pressure:</span><span class="sxs-lookup"><span data-stu-id="4deb2-204">There are several possible causes of this memory pressure:</span></span> 

1. <span data-ttu-id="4deb2-205">You have filled the cache to full capacity with data.</span><span class="sxs-lookup"><span data-stu-id="4deb2-205">You have filled the cache to full capacity with data.</span></span> 
2. <span data-ttu-id="4deb2-206">Redis is seeing high memory fragmentation - most often caused by storing large objects (Redis is optimized for a small objects - See the [What is the ideal value size range for redis? Is 100KB too large?](https://groups.google.com/forum/#!searchin/redis-db/size/redis-db/n7aa2A4DZDs/3OeEPHSQBAAJ) post for details).</span><span class="sxs-lookup"><span data-stu-id="4deb2-206">Redis is seeing high memory fragmentation - most often caused by storing large objects (Redis is optimized for a small objects - See the [What is the ideal value size range for redis? Is 100KB too large?](https://groups.google.com/forum/#!searchin/redis-db/size/redis-db/n7aa2A4DZDs/3OeEPHSQBAAJ) post for details).</span></span> 

#### <a name="measurement"></a><span data-ttu-id="4deb2-207">Measurement</span><span class="sxs-lookup"><span data-stu-id="4deb2-207">Measurement</span></span>
<span data-ttu-id="4deb2-208">Redis exposes two metrics that can help you identify this issue.</span><span class="sxs-lookup"><span data-stu-id="4deb2-208">Redis exposes two metrics that can help you identify this issue.</span></span> <span data-ttu-id="4deb2-209">The first is `used_memory` and the other is `used_memory_rss`.</span><span class="sxs-lookup"><span data-stu-id="4deb2-209">The first is `used_memory` and the other is `used_memory_rss`.</span></span> <span data-ttu-id="4deb2-210">[These metrics](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) are available in the Azure Portal or through the [Redis INFO](http://redis.io/commands/info) command.</span><span class="sxs-lookup"><span data-stu-id="4deb2-210">[These metrics](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) are available in the Azure Portal or through the [Redis INFO](http://redis.io/commands/info) command.</span></span>

#### <a name="resolution"></a><span data-ttu-id="4deb2-211">Resolution</span><span class="sxs-lookup"><span data-stu-id="4deb2-211">Resolution</span></span>
<span data-ttu-id="4deb2-212">There are several possible changes that you can make to help keep memory usage healthy:</span><span class="sxs-lookup"><span data-stu-id="4deb2-212">There are several possible changes that you can make to help keep memory usage healthy:</span></span>

1. <span data-ttu-id="4deb2-213">[Configure a memory policy](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) and set expiration times on your keys.</span><span class="sxs-lookup"><span data-stu-id="4deb2-213">[Configure a memory policy](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) and set expiration times on your keys.</span></span> <span data-ttu-id="4deb2-214">Note that this may not be sufficient if you have fragmentation.</span><span class="sxs-lookup"><span data-stu-id="4deb2-214">Note that this may not be sufficient if you have fragmentation.</span></span>
2. <span data-ttu-id="4deb2-215">[Configure a maxmemory-reserved value](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) that is large enough to compensate for memory fragmentation.</span><span class="sxs-lookup"><span data-stu-id="4deb2-215">[Configure a maxmemory-reserved value](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) that is large enough to compensate for memory fragmentation.</span></span>
3. <span data-ttu-id="4deb2-216">Break up your large cached objects into smaller related objects.</span><span class="sxs-lookup"><span data-stu-id="4deb2-216">Break up your large cached objects into smaller related objects.</span></span>
4. <span data-ttu-id="4deb2-217">[Scale](cache-how-to-scale.md) to a larger cache size.</span><span class="sxs-lookup"><span data-stu-id="4deb2-217">[Scale](cache-how-to-scale.md) to a larger cache size.</span></span>
5. <span data-ttu-id="4deb2-218">If you are using a [premium cache with Redis cluster enabled](cache-how-to-premium-clustering.md) you can [increase the number of shards](cache-how-to-premium-clustering.md#change-the-cluster-size-on-a-running-premium-cache).</span><span class="sxs-lookup"><span data-stu-id="4deb2-218">If you are using a [premium cache with Redis cluster enabled](cache-how-to-premium-clustering.md) you can [increase the number of shards](cache-how-to-premium-clustering.md#change-the-cluster-size-on-a-running-premium-cache).</span></span>

### <a name="high-cpu-usage--server-load"></a><span data-ttu-id="4deb2-219">High CPU usage / Server Load</span><span class="sxs-lookup"><span data-stu-id="4deb2-219">High CPU usage / Server Load</span></span>
#### <a name="problem"></a><span data-ttu-id="4deb2-220">Problem</span><span class="sxs-lookup"><span data-stu-id="4deb2-220">Problem</span></span>
<span data-ttu-id="4deb2-221">High CPU usage can mean that the client side can fail to process a response from Redis in a timely fashion even though Redis sent the response very quickly.</span><span class="sxs-lookup"><span data-stu-id="4deb2-221">High CPU usage can mean that the client side can fail to process a response from Redis in a timely fashion even though Redis sent the response very quickly.</span></span>

#### <a name="measurement"></a><span data-ttu-id="4deb2-222">Measurement</span><span class="sxs-lookup"><span data-stu-id="4deb2-222">Measurement</span></span>
<span data-ttu-id="4deb2-223">Monitor the System Wide CPU usage through the Azure Portal or through the associated performance counter.</span><span class="sxs-lookup"><span data-stu-id="4deb2-223">Monitor the System Wide CPU usage through the Azure Portal or through the associated performance counter.</span></span> <span data-ttu-id="4deb2-224">Be careful not to monitor *process* CPU because a single process can have low CPU usage at the same time that overall system CPU can be high.</span><span class="sxs-lookup"><span data-stu-id="4deb2-224">Be careful not to monitor *process* CPU because a single process can have low CPU usage at the same time that overall system CPU can be high.</span></span> <span data-ttu-id="4deb2-225">Watch for spikes in CPU usage that correspond with timeouts.</span><span class="sxs-lookup"><span data-stu-id="4deb2-225">Watch for spikes in CPU usage that correspond with timeouts.</span></span>

#### <a name="resolution"></a><span data-ttu-id="4deb2-226">Resolution</span><span class="sxs-lookup"><span data-stu-id="4deb2-226">Resolution</span></span>
<span data-ttu-id="4deb2-227">[Scale](cache-how-to-scale.md) to a larger cache tier with more CPU capacity or investigate what is causing CPU spikes.</span><span class="sxs-lookup"><span data-stu-id="4deb2-227">[Scale](cache-how-to-scale.md) to a larger cache tier with more CPU capacity or investigate what is causing CPU spikes.</span></span> 

### <a name="server-side-bandwidth-exceeded"></a><span data-ttu-id="4deb2-228">Server Side Bandwidth Exceeded</span><span class="sxs-lookup"><span data-stu-id="4deb2-228">Server Side Bandwidth Exceeded</span></span>
#### <a name="problem"></a><span data-ttu-id="4deb2-229">Problem</span><span class="sxs-lookup"><span data-stu-id="4deb2-229">Problem</span></span>
<span data-ttu-id="4deb2-230">Different sized cache instances have limitations on how much network bandwidth they have available.</span><span class="sxs-lookup"><span data-stu-id="4deb2-230">Different sized cache instances have limitations on how much network bandwidth they have available.</span></span> <span data-ttu-id="4deb2-231">If the server exceeds the available bandwidth, then data will not be sent to the client as quickly.</span><span class="sxs-lookup"><span data-stu-id="4deb2-231">If the server exceeds the available bandwidth, then data will not be sent to the client as quickly.</span></span> <span data-ttu-id="4deb2-232">This can lead to timeouts.</span><span class="sxs-lookup"><span data-stu-id="4deb2-232">This can lead to timeouts.</span></span>

#### <a name="measurement"></a><span data-ttu-id="4deb2-233">Measurement</span><span class="sxs-lookup"><span data-stu-id="4deb2-233">Measurement</span></span>
<span data-ttu-id="4deb2-234">You can monitor the `Cache Read` metric, which is the amount of data read from the cache in Megabytes per second (MB/s) during the specified reporting interval.</span><span class="sxs-lookup"><span data-stu-id="4deb2-234">You can monitor the `Cache Read` metric, which is the amount of data read from the cache in Megabytes per second (MB/s) during the specified reporting interval.</span></span> <span data-ttu-id="4deb2-235">This value corresponds to the network bandwidth used by this cache.</span><span class="sxs-lookup"><span data-stu-id="4deb2-235">This value corresponds to the network bandwidth used by this cache.</span></span> <span data-ttu-id="4deb2-236">If you want to set up alerts for server side network bandwidth limits, you can create them using this `Cache Read` counter.</span><span class="sxs-lookup"><span data-stu-id="4deb2-236">If you want to set up alerts for server side network bandwidth limits, you can create them using this `Cache Read` counter.</span></span> <span data-ttu-id="4deb2-237">Compare your readings with the values in [this table](cache-faq.md#cache-performance) for the observed bandwidth limits for various cache pricing tiers and sizes.</span><span class="sxs-lookup"><span data-stu-id="4deb2-237">Compare your readings with the values in [this table](cache-faq.md#cache-performance) for the observed bandwidth limits for various cache pricing tiers and sizes.</span></span>

#### <a name="resolution"></a><span data-ttu-id="4deb2-238">Resolution</span><span class="sxs-lookup"><span data-stu-id="4deb2-238">Resolution</span></span>
<span data-ttu-id="4deb2-239">If you are consistently near the observed maximum bandwidth for your pricing tier and cache size, consider [scaling](cache-how-to-scale.md) to a pricing tier or size that has greater network bandwidth, using the values in [this table](cache-faq.md#cache-performance) as a guide.</span><span class="sxs-lookup"><span data-stu-id="4deb2-239">If you are consistently near the observed maximum bandwidth for your pricing tier and cache size, consider [scaling](cache-how-to-scale.md) to a pricing tier or size that has greater network bandwidth, using the values in [this table](cache-faq.md#cache-performance) as a guide.</span></span>

## <a name="stackexchangeredis-timeout-exceptions"></a><span data-ttu-id="4deb2-240">StackExchange.Redis timeout exceptions</span><span class="sxs-lookup"><span data-stu-id="4deb2-240">StackExchange.Redis timeout exceptions</span></span>
<span data-ttu-id="4deb2-241">StackExchange.Redis uses a configuration setting named `synctimeout` for synchronous operations which has a default value  of 1000 ms.</span><span class="sxs-lookup"><span data-stu-id="4deb2-241">StackExchange.Redis uses a configuration setting named `synctimeout` for synchronous operations which has a default value  of 1000 ms.</span></span> <span data-ttu-id="4deb2-242">If a synchronous call doesn’t complete in the stipulated time, the StackExchange.Redis client throws a timeout error similar to the following example.</span><span class="sxs-lookup"><span data-stu-id="4deb2-242">If a synchronous call doesn’t complete in the stipulated time, the StackExchange.Redis client throws a timeout error similar to the following example.</span></span>

    System.TimeoutException: Timeout performing MGET 2728cc84-58ae-406b-8ec8-3f962419f641, inst: 1,mgr: Inactive, queue: 73, qu=6, qs=67, qc=0, wr=1/1, in=0/0 IOCP: (Busy=6, Free=999, Min=2,Max=1000), WORKER (Busy=7,Free=8184,Min=2,Max=8191)


<span data-ttu-id="4deb2-243">This error message contains metrics that can help point you to the cause and possible resolution of the issue.</span><span class="sxs-lookup"><span data-stu-id="4deb2-243">This error message contains metrics that can help point you to the cause and possible resolution of the issue.</span></span> <span data-ttu-id="4deb2-244">The following table contains details about the error message metrics.</span><span class="sxs-lookup"><span data-stu-id="4deb2-244">The following table contains details about the error message metrics.</span></span>

| <span data-ttu-id="4deb2-245">Error message metric</span><span class="sxs-lookup"><span data-stu-id="4deb2-245">Error message metric</span></span> | <span data-ttu-id="4deb2-246">Details</span><span class="sxs-lookup"><span data-stu-id="4deb2-246">Details</span></span> |
| --- | --- |
| <span data-ttu-id="4deb2-247">inst</span><span class="sxs-lookup"><span data-stu-id="4deb2-247">inst</span></span> |<span data-ttu-id="4deb2-248">In the last time slice: 0 commands have been issued</span><span class="sxs-lookup"><span data-stu-id="4deb2-248">In the last time slice: 0 commands have been issued</span></span> |
| <span data-ttu-id="4deb2-249">mgr</span><span class="sxs-lookup"><span data-stu-id="4deb2-249">mgr</span></span> |<span data-ttu-id="4deb2-250">The socket manager is performing `socket.select` which means it is asking the OS to indicate a socket that has something to do; basically: the reader is not actively reading from the network because it doesn't think there is anything to do</span><span class="sxs-lookup"><span data-stu-id="4deb2-250">The socket manager is performing `socket.select` which means it is asking the OS to indicate a socket that has something to do; basically: the reader is not actively reading from the network because it doesn't think there is anything to do</span></span> |
| <span data-ttu-id="4deb2-251">queue</span><span class="sxs-lookup"><span data-stu-id="4deb2-251">queue</span></span> |<span data-ttu-id="4deb2-252">There are 73 total in-progress operations</span><span class="sxs-lookup"><span data-stu-id="4deb2-252">There are 73 total in-progress operations</span></span> |
| <span data-ttu-id="4deb2-253">qu</span><span class="sxs-lookup"><span data-stu-id="4deb2-253">qu</span></span> |<span data-ttu-id="4deb2-254">6 of the in-progress operations are in the unsent queue and have not yet been written to the outbound network</span><span class="sxs-lookup"><span data-stu-id="4deb2-254">6 of the in-progress operations are in the unsent queue and have not yet been written to the outbound network</span></span> |
| <span data-ttu-id="4deb2-255">qs</span><span class="sxs-lookup"><span data-stu-id="4deb2-255">qs</span></span> |<span data-ttu-id="4deb2-256">67 of he in-progress operations have been sent to the server but a response is not yet available.</span><span class="sxs-lookup"><span data-stu-id="4deb2-256">67 of he in-progress operations have been sent to the server but a response is not yet available.</span></span> <span data-ttu-id="4deb2-257">The response could be `Not yet sent by the server` or `sent by the server but not yet processed by the client.`</span><span class="sxs-lookup"><span data-stu-id="4deb2-257">The response could be `Not yet sent by the server` or `sent by the server but not yet processed by the client.`</span></span> |
| <span data-ttu-id="4deb2-258">qc</span><span class="sxs-lookup"><span data-stu-id="4deb2-258">qc</span></span> |<span data-ttu-id="4deb2-259">0 of the in-progress operations have seen replies but have not yet been marked as complete due to waiting on the completion loop</span><span class="sxs-lookup"><span data-stu-id="4deb2-259">0 of the in-progress operations have seen replies but have not yet been marked as complete due to waiting on the completion loop</span></span> |
| <span data-ttu-id="4deb2-260">wr</span><span class="sxs-lookup"><span data-stu-id="4deb2-260">wr</span></span> |<span data-ttu-id="4deb2-261">There is an active writer (meaning the 6 unsent requests are not being ignored) bytes/activewriters</span><span class="sxs-lookup"><span data-stu-id="4deb2-261">There is an active writer (meaning the 6 unsent requests are not being ignored) bytes/activewriters</span></span> |
| <span data-ttu-id="4deb2-262">in</span><span class="sxs-lookup"><span data-stu-id="4deb2-262">in</span></span> |<span data-ttu-id="4deb2-263">There are no active readers and zero bytes are available to be read on the NIC bytes/activereaders</span><span class="sxs-lookup"><span data-stu-id="4deb2-263">There are no active readers and zero bytes are available to be read on the NIC bytes/activereaders</span></span> |

### <a name="steps-to-investigate"></a><span data-ttu-id="4deb2-264">Steps to investigate</span><span class="sxs-lookup"><span data-stu-id="4deb2-264">Steps to investigate</span></span>
1. <span data-ttu-id="4deb2-265">As a best practice make sure you are using the following pattern to connect when using the StackExchange.Redis client.</span><span class="sxs-lookup"><span data-stu-id="4deb2-265">As a best practice make sure you are using the following pattern to connect when using the StackExchange.Redis client.</span></span>

    ```c#
    private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
    {
        return ConnectionMultiplexer.Connect("cachename.redis.cache.windows.net,abortConnect=false,ssl=true,password=...");
    
    });
    
    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }
    ````

    <span data-ttu-id="4deb2-266">For more information, see [Connect to the cache using StackExchange.Redis](cache-dotnet-how-to-use-azure-redis-cache.md#connect-to-the-cache).</span><span class="sxs-lookup"><span data-stu-id="4deb2-266">For more information, see [Connect to the cache using StackExchange.Redis](cache-dotnet-how-to-use-azure-redis-cache.md#connect-to-the-cache).</span></span>

1. <span data-ttu-id="4deb2-267">Ensure that your Azure Redis Cache and the client application are in the same region in Azure.</span><span class="sxs-lookup"><span data-stu-id="4deb2-267">Ensure that your Azure Redis Cache and the client application are in the same region in Azure.</span></span> <span data-ttu-id="4deb2-268">For example, you might be getting timeouts when your cache is in East US but the client is in West US and the request doesn't complete within the `synctimeout` interval or you might be getting timeouts when you are debugging from your local development machine.</span><span class="sxs-lookup"><span data-stu-id="4deb2-268">For example, you might be getting timeouts when your cache is in East US but the client is in West US and the request doesn't complete within the `synctimeout` interval or you might be getting timeouts when you are debugging from your local development machine.</span></span> 
   
    <span data-ttu-id="4deb2-269">It’s highly recommended to have the cache and in the client in the same Azure region.</span><span class="sxs-lookup"><span data-stu-id="4deb2-269">It’s highly recommended to have the cache and in the client in the same Azure region.</span></span> <span data-ttu-id="4deb2-270">If you have a scenario that includes cross region calls, you should set the `synctimeout` interval to a value higher than the default 1000 ms interval by including a `synctimeout` property in the connection string.</span><span class="sxs-lookup"><span data-stu-id="4deb2-270">If you have a scenario that includes cross region calls, you should set the `synctimeout` interval to a value higher than the default 1000 ms interval by including a `synctimeout` property in the connection string.</span></span> <span data-ttu-id="4deb2-271">The following example shows a StackExchange.Redis cache connection string snippet with a `synctimeout` of 2000 ms.</span><span class="sxs-lookup"><span data-stu-id="4deb2-271">The following example shows a StackExchange.Redis cache connection string snippet with a `synctimeout` of 2000 ms.</span></span>
   
        synctimeout=2000,cachename.redis.cache.windows.net,abortConnect=false,ssl=true,password=...
2. <span data-ttu-id="4deb2-272">Ensure you using the latest version of the [StackExchange.Redis NuGet package](https://www.nuget.org/packages/StackExchange.Redis/).</span><span class="sxs-lookup"><span data-stu-id="4deb2-272">Ensure you using the latest version of the [StackExchange.Redis NuGet package](https://www.nuget.org/packages/StackExchange.Redis/).</span></span> <span data-ttu-id="4deb2-273">There are bugs constantly being fixed in the code to make it more robust to timeouts so having the latest version is important.</span><span class="sxs-lookup"><span data-stu-id="4deb2-273">There are bugs constantly being fixed in the code to make it more robust to timeouts so having the latest version is important.</span></span>
3. <span data-ttu-id="4deb2-274">If there are requests that are getting bound by bandwidth limitations on the server or client, it will take longer for them to complete and thereby cause timeouts.</span><span class="sxs-lookup"><span data-stu-id="4deb2-274">If there are requests that are getting bound by bandwidth limitations on the server or client, it will take longer for them to complete and thereby cause timeouts.</span></span> <span data-ttu-id="4deb2-275">To see if your timeout is due to network bandwidth on the server, see [Server side bandwidth exceeded](#server-side-bandwidth-exceeded).</span><span class="sxs-lookup"><span data-stu-id="4deb2-275">To see if your timeout is due to network bandwidth on the server, see [Server side bandwidth exceeded](#server-side-bandwidth-exceeded).</span></span> <span data-ttu-id="4deb2-276">To see if your timeout is due to client network bandwidth, see [Client side bandwidth exceeded](#client-side-bandwidth-exceeded).</span><span class="sxs-lookup"><span data-stu-id="4deb2-276">To see if your timeout is due to client network bandwidth, see [Client side bandwidth exceeded](#client-side-bandwidth-exceeded).</span></span>
4. <span data-ttu-id="4deb2-277">Are you getting CPU bound on the server or on the client?</span><span class="sxs-lookup"><span data-stu-id="4deb2-277">Are you getting CPU bound on the server or on the client?</span></span>
   
   * <span data-ttu-id="4deb2-278">Check if you are getting bound by CPU on your client which could cause the request to not be processed within the `synctimeout` interval, thus causing a timeout.</span><span class="sxs-lookup"><span data-stu-id="4deb2-278">Check if you are getting bound by CPU on your client which could cause the request to not be processed within the `synctimeout` interval, thus causing a timeout.</span></span> <span data-ttu-id="4deb2-279">Moving to a larger client size or distributing the load can help to control this.</span><span class="sxs-lookup"><span data-stu-id="4deb2-279">Moving to a larger client size or distributing the load can help to control this.</span></span> 
   * <span data-ttu-id="4deb2-280">Check if you are getting CPU bound on the server by monitoring the `CPU` [cache performance metric](cache-how-to-monitor.md#available-metrics-and-reporting-intervals).</span><span class="sxs-lookup"><span data-stu-id="4deb2-280">Check if you are getting CPU bound on the server by monitoring the `CPU` [cache performance metric](cache-how-to-monitor.md#available-metrics-and-reporting-intervals).</span></span> <span data-ttu-id="4deb2-281">Requests coming in while Redis is CPU bound can cause those requests to timeout.</span><span class="sxs-lookup"><span data-stu-id="4deb2-281">Requests coming in while Redis is CPU bound can cause those requests to timeout.</span></span> <span data-ttu-id="4deb2-282">To address this you can distribute the load across multiple shards in a premium cache, or upgrade to a larger size or pricing tier.</span><span class="sxs-lookup"><span data-stu-id="4deb2-282">To address this you can distribute the load across multiple shards in a premium cache, or upgrade to a larger size or pricing tier.</span></span> <span data-ttu-id="4deb2-283">For more information, see [Server Side Bandwidth Exceeded](#server-side-bandwidth-exceeded).</span><span class="sxs-lookup"><span data-stu-id="4deb2-283">For more information, see [Server Side Bandwidth Exceeded](#server-side-bandwidth-exceeded).</span></span>
5. <span data-ttu-id="4deb2-284">Are there commands taking long time to process on the server?</span><span class="sxs-lookup"><span data-stu-id="4deb2-284">Are there commands taking long time to process on the server?</span></span> <span data-ttu-id="4deb2-285">Long running commands that are taking long time to process on the redis-server can cause timeouts.</span><span class="sxs-lookup"><span data-stu-id="4deb2-285">Long running commands that are taking long time to process on the redis-server can cause timeouts.</span></span> <span data-ttu-id="4deb2-286">Some examples of long running commands are `mget` with large numbers of keys, `keys *` or poorly written lua scripts.</span><span class="sxs-lookup"><span data-stu-id="4deb2-286">Some examples of long running commands are `mget` with large numbers of keys, `keys *` or poorly written lua scripts.</span></span> <span data-ttu-id="4deb2-287">You can connect to your Azure Redis Cache instance using the redis-cli client or use the [Redis Console](cache-configure.md#redis-console) and run the [SlowLog](http://redis.io/commands/slowlog) command to see if there are requests taking longer than expected.</span><span class="sxs-lookup"><span data-stu-id="4deb2-287">You can connect to your Azure Redis Cache instance using the redis-cli client or use the [Redis Console](cache-configure.md#redis-console) and run the [SlowLog](http://redis.io/commands/slowlog) command to see if there are requests taking longer than expected.</span></span> <span data-ttu-id="4deb2-288">Redis Server and StackExchange.Redis are optimized for many small requests rather than fewer large requests.</span><span class="sxs-lookup"><span data-stu-id="4deb2-288">Redis Server and StackExchange.Redis are optimized for many small requests rather than fewer large requests.</span></span> <span data-ttu-id="4deb2-289">Splitting your data into smaller chunks may improve things here.</span><span class="sxs-lookup"><span data-stu-id="4deb2-289">Splitting your data into smaller chunks may improve things here.</span></span> 
   
    <span data-ttu-id="4deb2-290">For information on connecting to the Azure Redis Cache SSL endpoint using redis-cli and stunnel, see the [Announcing ASP.NET Session State Provider for Redis Preview Release](http://blogs.msdn.com/b/webdev/archive/2014/05/12/announcing-asp-net-session-state-provider-for-redis-preview-release.aspx) blog post.</span><span class="sxs-lookup"><span data-stu-id="4deb2-290">For information on connecting to the Azure Redis Cache SSL endpoint using redis-cli and stunnel, see the [Announcing ASP.NET Session State Provider for Redis Preview Release](http://blogs.msdn.com/b/webdev/archive/2014/05/12/announcing-asp-net-session-state-provider-for-redis-preview-release.aspx) blog post.</span></span> <span data-ttu-id="4deb2-291">For more information, see [SlowLog](http://redis.io/commands/slowlog).</span><span class="sxs-lookup"><span data-stu-id="4deb2-291">For more information, see [SlowLog](http://redis.io/commands/slowlog).</span></span>
6. <span data-ttu-id="4deb2-292">High Redis server load can cause timeouts.</span><span class="sxs-lookup"><span data-stu-id="4deb2-292">High Redis server load can cause timeouts.</span></span> <span data-ttu-id="4deb2-293">You can monitor the server load by monitoring the `Redis Server Load` [cache performance metric](cache-how-to-monitor.md#available-metrics-and-reporting-intervals).</span><span class="sxs-lookup"><span data-stu-id="4deb2-293">You can monitor the server load by monitoring the `Redis Server Load` [cache performance metric](cache-how-to-monitor.md#available-metrics-and-reporting-intervals).</span></span> <span data-ttu-id="4deb2-294">A server load of 100 (maximum value) signifies that the redis server has been busy, with no idle time, processing requests.</span><span class="sxs-lookup"><span data-stu-id="4deb2-294">A server load of 100 (maximum value) signifies that the redis server has been busy, with no idle time, processing requests.</span></span> <span data-ttu-id="4deb2-295">To see if certain requests are taking up all of the server capability, run the SlowLog command, as described in the previous paragraph.</span><span class="sxs-lookup"><span data-stu-id="4deb2-295">To see if certain requests are taking up all of the server capability, run the SlowLog command, as described in the previous paragraph.</span></span> <span data-ttu-id="4deb2-296">For more information, see [High CPU usage / Server Load](#high-cpu-usage-server-load).</span><span class="sxs-lookup"><span data-stu-id="4deb2-296">For more information, see [High CPU usage / Server Load](#high-cpu-usage-server-load).</span></span>
7. <span data-ttu-id="4deb2-297">Was there any other event on the client side that could have caused a network blip?</span><span class="sxs-lookup"><span data-stu-id="4deb2-297">Was there any other event on the client side that could have caused a network blip?</span></span> <span data-ttu-id="4deb2-298">Check on the client (web, worker role or an Iaas VM) if there was an event like scaling the number of client instances up or down, or deploying a new version of the client or auto-scale is enabled?In our testing we have found that autoscale or scaling up/down can cause outbound network connectivity can be lost for several seconds.</span><span class="sxs-lookup"><span data-stu-id="4deb2-298">Check on the client (web, worker role or an Iaas VM) if there was an event like scaling the number of client instances up or down, or deploying a new version of the client or auto-scale is enabled?In our testing we have found that autoscale or scaling up/down can cause outbound network connectivity can be lost for several seconds.</span></span> <span data-ttu-id="4deb2-299">StackExchange.Redis code is resilient to such events and will reconnect.</span><span class="sxs-lookup"><span data-stu-id="4deb2-299">StackExchange.Redis code is resilient to such events and will reconnect.</span></span> <span data-ttu-id="4deb2-300">During this time of re-connection any requests in the queue can time out.</span><span class="sxs-lookup"><span data-stu-id="4deb2-300">During this time of re-connection any requests in the queue can time out.</span></span>
8. <span data-ttu-id="4deb2-301">Was there a big request preceding several small requests to the Redis Cache that timed out?</span><span class="sxs-lookup"><span data-stu-id="4deb2-301">Was there a big request preceding several small requests to the Redis Cache that timed out?</span></span> <span data-ttu-id="4deb2-302">The parameter `qs` in the error message tells you how many requests were sent from the client to the server, but have not yet processed a response.</span><span class="sxs-lookup"><span data-stu-id="4deb2-302">The parameter `qs` in the error message tells you how many requests were sent from the client to the server, but have not yet processed a response.</span></span> <span data-ttu-id="4deb2-303">This value can keep growing because StackExchange.Redis uses a single TCP connection and can only read one response at a time.</span><span class="sxs-lookup"><span data-stu-id="4deb2-303">This value can keep growing because StackExchange.Redis uses a single TCP connection and can only read one response at a time.</span></span> <span data-ttu-id="4deb2-304">Even though the first operation timed out, it does not stop the data being sent to/from the server, and other requests are blocked until this is finished, causing time outs.</span><span class="sxs-lookup"><span data-stu-id="4deb2-304">Even though the first operation timed out, it does not stop the data being sent to/from the server, and other requests are blocked until this is finished, causing time outs.</span></span> <span data-ttu-id="4deb2-305">One solution is to minimize the chance of timeouts by ensuring that your cache is large enough for your workload and splitting large values into smaller chunks.</span><span class="sxs-lookup"><span data-stu-id="4deb2-305">One solution is to minimize the chance of timeouts by ensuring that your cache is large enough for your workload and splitting large values into smaller chunks.</span></span> <span data-ttu-id="4deb2-306">Another possible solution is to use a pool of `ConnectionMultiplexer` objects in your client, and choose the least loaded `ConnectionMultiplexer` when sending a new request.</span><span class="sxs-lookup"><span data-stu-id="4deb2-306">Another possible solution is to use a pool of `ConnectionMultiplexer` objects in your client, and choose the least loaded `ConnectionMultiplexer` when sending a new request.</span></span> <span data-ttu-id="4deb2-307">This should prevent a single timeout from causing other requests to also timeout.</span><span class="sxs-lookup"><span data-stu-id="4deb2-307">This should prevent a single timeout from causing other requests to also timeout.</span></span>
9. <span data-ttu-id="4deb2-308">If you are using `RedisSessionStateprovider`, ensure you have set the retry timeout correctly.</span><span class="sxs-lookup"><span data-stu-id="4deb2-308">If you are using `RedisSessionStateprovider`, ensure you have set the retry timeout correctly.</span></span> <span data-ttu-id="4deb2-309">`retrytimeoutInMilliseconds` should be higher than `operationTimeoutinMilliseonds`, otherwise no retries will occur.</span><span class="sxs-lookup"><span data-stu-id="4deb2-309">`retrytimeoutInMilliseconds` should be higher than `operationTimeoutinMilliseonds`, otherwise no retries will occur.</span></span> <span data-ttu-id="4deb2-310">In the following example `retrytimeoutInMilliseconds` is set to 3000.</span><span class="sxs-lookup"><span data-stu-id="4deb2-310">In the following example `retrytimeoutInMilliseconds` is set to 3000.</span></span> <span data-ttu-id="4deb2-311">For more information, see [ASP.NET Session State Provider for Azure Redis Cache](cache-aspnet-session-state-provider.md) and [How to use the configuration parameters of Session State Provider and Output Cache Provider](https://github.com/Azure/aspnet-redis-providers/wiki/Configuration).</span><span class="sxs-lookup"><span data-stu-id="4deb2-311">For more information, see [ASP.NET Session State Provider for Azure Redis Cache](cache-aspnet-session-state-provider.md) and [How to use the configuration parameters of Session State Provider and Output Cache Provider](https://github.com/Azure/aspnet-redis-providers/wiki/Configuration).</span></span>

    <add
      name="AFRedisCacheSessionStateProvider"
      type="Microsoft.Web.Redis.RedisSessionStateProvider"
      host="enbwcache.redis.cache.windows.net"
      port="6380"
      accessKey="…"
      ssl="true"
      databaseId="0"
      applicationName="AFRedisCacheSessionState"
      connectionTimeoutInMilliseconds = "5000"
      operationTimeoutInMilliseconds = "1000"
      retryTimeoutInMilliseconds="3000" />


1. <span data-ttu-id="4deb2-312">Check memory usage on the Azure Redis Cache server by [monitoring](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) `Used Memory RSS` and `Used Memory`.</span><span class="sxs-lookup"><span data-stu-id="4deb2-312">Check memory usage on the Azure Redis Cache server by [monitoring](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) `Used Memory RSS` and `Used Memory`.</span></span> <span data-ttu-id="4deb2-313">If an eviction policy is in place, Redis starts evicting keys when `Used_Memory` reaches the cache size.</span><span class="sxs-lookup"><span data-stu-id="4deb2-313">If an eviction policy is in place, Redis starts evicting keys when `Used_Memory` reaches the cache size.</span></span> <span data-ttu-id="4deb2-314">Ideally, `Used Memory RSS` should be only slightly higher than `Used memory`.</span><span class="sxs-lookup"><span data-stu-id="4deb2-314">Ideally, `Used Memory RSS` should be only slightly higher than `Used memory`.</span></span> <span data-ttu-id="4deb2-315">A large difference means there is memory fragmentation (internal or external.</span><span class="sxs-lookup"><span data-stu-id="4deb2-315">A large difference means there is memory fragmentation (internal or external.</span></span> <span data-ttu-id="4deb2-316">When `Used Memory RSS` is less than `Used Memory`, it means part of the cache memory has been swapped  by the operating system.</span><span class="sxs-lookup"><span data-stu-id="4deb2-316">When `Used Memory RSS` is less than `Used Memory`, it means part of the cache memory has been swapped  by the operating system.</span></span> <span data-ttu-id="4deb2-317">If this occurs you can expect some significant latencies.</span><span class="sxs-lookup"><span data-stu-id="4deb2-317">If this occurs you can expect some significant latencies.</span></span> <span data-ttu-id="4deb2-318">Because Redis does not have control over how its allocations are mapped to memory pages, high `Used Memory RSS` is often the result of a spike in memory usage.</span><span class="sxs-lookup"><span data-stu-id="4deb2-318">Because Redis does not have control over how its allocations are mapped to memory pages, high `Used Memory RSS` is often the result of a spike in memory usage.</span></span> <span data-ttu-id="4deb2-319">When Redis frees memory, the memory is given back to the allocator, and the allocator may or may not give the memory back to the system.</span><span class="sxs-lookup"><span data-stu-id="4deb2-319">When Redis frees memory, the memory is given back to the allocator, and the allocator may or may not give the memory back to the system.</span></span> <span data-ttu-id="4deb2-320">There may be a discrepancy between the `Used Memory` value and memory consumption as reported by the operating system.</span><span class="sxs-lookup"><span data-stu-id="4deb2-320">There may be a discrepancy between the `Used Memory` value and memory consumption as reported by the operating system.</span></span> <span data-ttu-id="4deb2-321">It may be due to the fact memory has been used and released by Redis, but not given back to the system.</span><span class="sxs-lookup"><span data-stu-id="4deb2-321">It may be due to the fact memory has been used and released by Redis, but not given back to the system.</span></span> <span data-ttu-id="4deb2-322">To help mitigate memory issues you can perform the following steps.</span><span class="sxs-lookup"><span data-stu-id="4deb2-322">To help mitigate memory issues you can perform the following steps.</span></span>
   
   * <span data-ttu-id="4deb2-323">Upgrade the cache to a larger size so that you are not running up against memory limitations on the system.</span><span class="sxs-lookup"><span data-stu-id="4deb2-323">Upgrade the cache to a larger size so that you are not running up against memory limitations on the system.</span></span>
   * <span data-ttu-id="4deb2-324">Set expiration times on the keys so that older values are evicted proactively.</span><span class="sxs-lookup"><span data-stu-id="4deb2-324">Set expiration times on the keys so that older values are evicted proactively.</span></span>
   * <span data-ttu-id="4deb2-325">Monitor the the `used_memory_rss` cache metric.</span><span class="sxs-lookup"><span data-stu-id="4deb2-325">Monitor the the `used_memory_rss` cache metric.</span></span> <span data-ttu-id="4deb2-326">When this value approaches the size of their cache, you are likely to start seeing performance issues.</span><span class="sxs-lookup"><span data-stu-id="4deb2-326">When this value approaches the size of their cache, you are likely to start seeing performance issues.</span></span> <span data-ttu-id="4deb2-327">Distribute the data across multiple shards if you are using a premium cache, or upgrade to a larger cache size.</span><span class="sxs-lookup"><span data-stu-id="4deb2-327">Distribute the data across multiple shards if you are using a premium cache, or upgrade to a larger cache size.</span></span>
   
   <span data-ttu-id="4deb2-328">For more information, see [Memory Pressure on the server](#memory-pressure-on-the-server).</span><span class="sxs-lookup"><span data-stu-id="4deb2-328">For more information, see [Memory Pressure on the server](#memory-pressure-on-the-server).</span></span>

## <a name="additional-information"></a><span data-ttu-id="4deb2-329">Additional information</span><span class="sxs-lookup"><span data-stu-id="4deb2-329">Additional information</span></span>
* [<span data-ttu-id="4deb2-330">What Redis Cache offering and size should I use?</span><span class="sxs-lookup"><span data-stu-id="4deb2-330">What Redis Cache offering and size should I use?</span></span>](cache-faq.md#what-redis-cache-offering-and-size-should-i-use)
* [<span data-ttu-id="4deb2-331">How can I benchmark and test the performance of my cache?</span><span class="sxs-lookup"><span data-stu-id="4deb2-331">How can I benchmark and test the performance of my cache?</span></span>](cache-faq.md#how-can-i-benchmark-and-test-the-performance-of-my-cache)
* [<span data-ttu-id="4deb2-332">How can I run Redis commands?</span><span class="sxs-lookup"><span data-stu-id="4deb2-332">How can I run Redis commands?</span></span>](cache-faq.md#how-can-i-run-redis-commands)
* [<span data-ttu-id="4deb2-333">How to monitor Azure Redis Cache</span><span class="sxs-lookup"><span data-stu-id="4deb2-333">How to monitor Azure Redis Cache</span></span>](cache-how-to-monitor.md)

