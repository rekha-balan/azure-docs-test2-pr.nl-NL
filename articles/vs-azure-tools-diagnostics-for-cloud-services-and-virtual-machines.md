---
title: Set up diagnostics for Azure Cloud Services and virtual machines | Microsoft Docs
description: Learn how to set up diagnostics for debugging Azure cloude services and virtual machines (VMs) in Visual Studio.
services: visual-studio-online
documentationcenter: na
author: mikejo
manager: douge
editor: ''
ms.assetid: e70cd7b4-6298-43aa-adea-6fd618414c26
ms.service: multiple
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: multiple
ms.date: 06/28/2018
ms.author: mikejo
ms.openlocfilehash: 2ff2a619dabd7dfabf89361172557efa4884ba12
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44828191"
---
# <a name="set-up-diagnostics-for-azure-cloud-services-and-virtual-machines"></a><span data-ttu-id="82b6a-103">Set up diagnostics for Azure Cloud Services and virtual machines</span><span class="sxs-lookup"><span data-stu-id="82b6a-103">Set up diagnostics for Azure Cloud Services and virtual machines</span></span>
<span data-ttu-id="82b6a-104">When you need to troubleshoot an Azure cloud service or virtual machine, you can use Visual Studio to more easily set up Azure Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="82b6a-104">When you need to troubleshoot an Azure cloud service or virtual machine, you can use Visual Studio to more easily set up Azure Diagnostics.</span></span> <span data-ttu-id="82b6a-105">Diagnostics captures system data and logging data on the virtual machines and virtual machine instances that run your cloud service.</span><span class="sxs-lookup"><span data-stu-id="82b6a-105">Diagnostics captures system data and logging data on the virtual machines and virtual machine instances that run your cloud service.</span></span> <span data-ttu-id="82b6a-106">Diagnostics data is transferred to a storage account that you choose.</span><span class="sxs-lookup"><span data-stu-id="82b6a-106">Diagnostics data is transferred to a storage account that you choose.</span></span> <span data-ttu-id="82b6a-107">For more information about diagnostics logging in Azure, see [Enable diagnostics logging for Web Apps in Azure App Service](app-service/web-sites-enable-diagnostic-log.md).</span><span class="sxs-lookup"><span data-stu-id="82b6a-107">For more information about diagnostics logging in Azure, see [Enable diagnostics logging for Web Apps in Azure App Service](app-service/web-sites-enable-diagnostic-log.md).</span></span>

<span data-ttu-id="82b6a-108">In this article, we show you how to use Visual Studio to turn on and set up Azure Diagnostics, both before and after deployment.</span><span class="sxs-lookup"><span data-stu-id="82b6a-108">In this article, we show you how to use Visual Studio to turn on and set up Azure Diagnostics, both before and after deployment.</span></span> <span data-ttu-id="82b6a-109">Learn how to set up Diagnostics on Azure virtual machines, how to select the types of diagnostics information to collect, and how to view the information after it's collected.</span><span class="sxs-lookup"><span data-stu-id="82b6a-109">Learn how to set up Diagnostics on Azure virtual machines, how to select the types of diagnostics information to collect, and how to view the information after it's collected.</span></span>

<span data-ttu-id="82b6a-110">You can use one of the following options to set up Azure Diagnostics:</span><span class="sxs-lookup"><span data-stu-id="82b6a-110">You can use one of the following options to set up Azure Diagnostics:</span></span>

* <span data-ttu-id="82b6a-111">Change diagnostics settings in the **Diagnostics Configuration** dialog box in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="82b6a-111">Change diagnostics settings in the **Diagnostics Configuration** dialog box in Visual Studio.</span></span> <span data-ttu-id="82b6a-112">The settings are saved in a file called diagnostics.wadcfgx (in Azure SDK 2.4 and earlier, the file is called diagnostics.wadcfg).</span><span class="sxs-lookup"><span data-stu-id="82b6a-112">The settings are saved in a file called diagnostics.wadcfgx (in Azure SDK 2.4 and earlier, the file is called diagnostics.wadcfg).</span></span> <span data-ttu-id="82b6a-113">You also you can directly modify the configuration file.</span><span class="sxs-lookup"><span data-stu-id="82b6a-113">You also you can directly modify the configuration file.</span></span> <span data-ttu-id="82b6a-114">If you manually update the file, the configuration changes take effect the next time you deploy the cloud service to Azure or run the service in the emulator.</span><span class="sxs-lookup"><span data-stu-id="82b6a-114">If you manually update the file, the configuration changes take effect the next time you deploy the cloud service to Azure or run the service in the emulator.</span></span>
* <span data-ttu-id="82b6a-115">Use Cloud Explorer or Server Explorer in Visual Studio to change the diagnostics settings for a cloud service or virtual machine that is running.</span><span class="sxs-lookup"><span data-stu-id="82b6a-115">Use Cloud Explorer or Server Explorer in Visual Studio to change the diagnostics settings for a cloud service or virtual machine that is running.</span></span>

## <a name="azure-sdk-26-diagnostics-changes"></a><span data-ttu-id="82b6a-116">Azure SDK 2.6 diagnostics changes</span><span class="sxs-lookup"><span data-stu-id="82b6a-116">Azure SDK 2.6 diagnostics changes</span></span>
<span data-ttu-id="82b6a-117">The following changes apply to Azure SDK 2.6 and later projects in Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="82b6a-117">The following changes apply to Azure SDK 2.6 and later projects in Visual Studio:</span></span>

* <span data-ttu-id="82b6a-118">The local emulator now supports diagnostics.</span><span class="sxs-lookup"><span data-stu-id="82b6a-118">The local emulator now supports diagnostics.</span></span> <span data-ttu-id="82b6a-119">This means that you can collect diagnostics data and ensure that your application creates the right traces while you develop and test in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="82b6a-119">This means that you can collect diagnostics data and ensure that your application creates the right traces while you develop and test in Visual Studio.</span></span> <span data-ttu-id="82b6a-120">The connection string `UseDevelopmentStorage=true` turns on diagnostics data collection while you are running your cloud service project in Visual Studio by using the Azure storage emulator.</span><span class="sxs-lookup"><span data-stu-id="82b6a-120">The connection string `UseDevelopmentStorage=true` turns on diagnostics data collection while you are running your cloud service project in Visual Studio by using the Azure storage emulator.</span></span> <span data-ttu-id="82b6a-121">All diagnostics data is collected in the Development Storage storage account.</span><span class="sxs-lookup"><span data-stu-id="82b6a-121">All diagnostics data is collected in the Development Storage storage account.</span></span>
* <span data-ttu-id="82b6a-122">The diagnostics storage account connection string `Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString` is stored in the service configuration (.cscfg) file.</span><span class="sxs-lookup"><span data-stu-id="82b6a-122">The diagnostics storage account connection string `Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString` is stored in the service configuration (.cscfg) file.</span></span> <span data-ttu-id="82b6a-123">In Azure SDK 2.5, the diagnostics storage account is specified in the diagnostics.wadcfgx file.</span><span class="sxs-lookup"><span data-stu-id="82b6a-123">In Azure SDK 2.5, the diagnostics storage account is specified in the diagnostics.wadcfgx file.</span></span>

<span data-ttu-id="82b6a-124">The connection string works differently in some key ways in Azure SDK 2.6 and later versus Azure SDK 2.4 and earlier:</span><span class="sxs-lookup"><span data-stu-id="82b6a-124">The connection string works differently in some key ways in Azure SDK 2.6 and later versus Azure SDK 2.4 and earlier:</span></span>

* <span data-ttu-id="82b6a-125">In Azure SDK 2.4 and earlier, the connection string is used as a runtime by the diagnostics plug-in to get the storage account information for transferring diagnostics logs.</span><span class="sxs-lookup"><span data-stu-id="82b6a-125">In Azure SDK 2.4 and earlier, the connection string is used as a runtime by the diagnostics plug-in to get the storage account information for transferring diagnostics logs.</span></span>
* <span data-ttu-id="82b6a-126">In Azure SDK 2.6 and later, Visual Studio uses the diagnostics connection string to set up the Azure Diagnostics Extension with the appropriate storage account information during publishing.</span><span class="sxs-lookup"><span data-stu-id="82b6a-126">In Azure SDK 2.6 and later, Visual Studio uses the diagnostics connection string to set up the Azure Diagnostics Extension with the appropriate storage account information during publishing.</span></span> <span data-ttu-id="82b6a-127">You can use the connection string to define different storage accounts for different service configurations that Visual Studio uses during publishing.</span><span class="sxs-lookup"><span data-stu-id="82b6a-127">You can use the connection string to define different storage accounts for different service configurations that Visual Studio uses during publishing.</span></span> <span data-ttu-id="82b6a-128">However, because the diagnostics plug-in is not available after Azure SDK 2.5, the .cscfg file by itself can't set up the diagnostics extension.</span><span class="sxs-lookup"><span data-stu-id="82b6a-128">However, because the diagnostics plug-in is not available after Azure SDK 2.5, the .cscfg file by itself can't set up the diagnostics extension.</span></span> <span data-ttu-id="82b6a-129">You must set up the extension separately by using tools like Visual Studio or PowerShell.</span><span class="sxs-lookup"><span data-stu-id="82b6a-129">You must set up the extension separately by using tools like Visual Studio or PowerShell.</span></span>
* <span data-ttu-id="82b6a-130">To simplify the process of setting up the diagnostics extension by using PowerShell, the package output from Visual Studio includes the public configuration XML for the diagnostics extension for each role.</span><span class="sxs-lookup"><span data-stu-id="82b6a-130">To simplify the process of setting up the diagnostics extension by using PowerShell, the package output from Visual Studio includes the public configuration XML for the diagnostics extension for each role.</span></span> <span data-ttu-id="82b6a-131">Visual Studio uses the diagnostics connection string to populate the storage account information in the public configuration.</span><span class="sxs-lookup"><span data-stu-id="82b6a-131">Visual Studio uses the diagnostics connection string to populate the storage account information in the public configuration.</span></span> <span data-ttu-id="82b6a-132">The public config files are created in the Extensions folder.</span><span class="sxs-lookup"><span data-stu-id="82b6a-132">The public config files are created in the Extensions folder.</span></span> <span data-ttu-id="82b6a-133">The public config files use the naming pattern PaaSDiagnostics.&lt;role name\>.PubConfig.xml.</span><span class="sxs-lookup"><span data-stu-id="82b6a-133">The public config files use the naming pattern PaaSDiagnostics.&lt;role name\>.PubConfig.xml.</span></span> <span data-ttu-id="82b6a-134">Any PowerShell-based deployments can use this pattern to map each configuration to a role.</span><span class="sxs-lookup"><span data-stu-id="82b6a-134">Any PowerShell-based deployments can use this pattern to map each configuration to a role.</span></span>
* <span data-ttu-id="82b6a-135">The [Azure portal](http://go.microsoft.com/fwlink/p/?LinkID=525040) uses the connection string in the .cscfg file to access the diagnostics data.</span><span class="sxs-lookup"><span data-stu-id="82b6a-135">The [Azure portal](http://go.microsoft.com/fwlink/p/?LinkID=525040) uses the connection string in the .cscfg file to access the diagnostics data.</span></span> <span data-ttu-id="82b6a-136">The data appears on the **Monitoring** tab. The connection string is required to set the service to show verbose monitoring data in the portal.</span><span class="sxs-lookup"><span data-stu-id="82b6a-136">The data appears on the **Monitoring** tab. The connection string is required to set the service to show verbose monitoring data in the portal.</span></span>

## <a name="migrate-projects-to-azure-sdk-26-and-later"></a><span data-ttu-id="82b6a-137">Migrate projects to Azure SDK 2.6 and later</span><span class="sxs-lookup"><span data-stu-id="82b6a-137">Migrate projects to Azure SDK 2.6 and later</span></span>
<span data-ttu-id="82b6a-138">When you migrate from Azure SDK 2.5 to Azure SDK 2.6 or later, if you had a diagnostics storage account specified in the .wadcfgx file, the storage account stays in that file.</span><span class="sxs-lookup"><span data-stu-id="82b6a-138">When you migrate from Azure SDK 2.5 to Azure SDK 2.6 or later, if you had a diagnostics storage account specified in the .wadcfgx file, the storage account stays in that file.</span></span> <span data-ttu-id="82b6a-139">To take advantage of the flexibility of using different storage accounts for different storage configurations, manually add the connection string to your project.</span><span class="sxs-lookup"><span data-stu-id="82b6a-139">To take advantage of the flexibility of using different storage accounts for different storage configurations, manually add the connection string to your project.</span></span> <span data-ttu-id="82b6a-140">If you're migrating a project from Azure SDK 2.4 or earlier to Azure SDK 2.6, the diagnostics connection strings are preserved.</span><span class="sxs-lookup"><span data-stu-id="82b6a-140">If you're migrating a project from Azure SDK 2.4 or earlier to Azure SDK 2.6, the diagnostics connection strings are preserved.</span></span> <span data-ttu-id="82b6a-141">However, note the changes in how connection strings are treated in Azure SDK 2.6, described in the preceding section.</span><span class="sxs-lookup"><span data-stu-id="82b6a-141">However, note the changes in how connection strings are treated in Azure SDK 2.6, described in the preceding section.</span></span>

### <a name="how-visual-studio-determines-the-diagnostics-storage-account"></a><span data-ttu-id="82b6a-142">How Visual Studio determines the diagnostics storage account</span><span class="sxs-lookup"><span data-stu-id="82b6a-142">How Visual Studio determines the diagnostics storage account</span></span>
* <span data-ttu-id="82b6a-143">If a diagnostics connection string is specified in the .cscfg file, Visual Studio uses it to set up the diagnostics extension during publishing and when it generates the public configuration XML files during packaging.</span><span class="sxs-lookup"><span data-stu-id="82b6a-143">If a diagnostics connection string is specified in the .cscfg file, Visual Studio uses it to set up the diagnostics extension during publishing and when it generates the public configuration XML files during packaging.</span></span>
* <span data-ttu-id="82b6a-144">If a diagnostics connection string is not specified in the .cscfg file, Visual Studio falls back to using the storage account that's specified in the .wadcfgx file to set up the diagnostics extension for publishing and for generating the public configuration XML files during packaging.</span><span class="sxs-lookup"><span data-stu-id="82b6a-144">If a diagnostics connection string is not specified in the .cscfg file, Visual Studio falls back to using the storage account that's specified in the .wadcfgx file to set up the diagnostics extension for publishing and for generating the public configuration XML files during packaging.</span></span>
* <span data-ttu-id="82b6a-145">The diagnostics connection string in the .cscfg file takes precedence over the storage account in the .wadcfgx file.</span><span class="sxs-lookup"><span data-stu-id="82b6a-145">The diagnostics connection string in the .cscfg file takes precedence over the storage account in the .wadcfgx file.</span></span> <span data-ttu-id="82b6a-146">If a diagnostics connection string is specified in the .cscfg file, Visual Studio uses that connection string and ignores the storage account in .wadcfgx.</span><span class="sxs-lookup"><span data-stu-id="82b6a-146">If a diagnostics connection string is specified in the .cscfg file, Visual Studio uses that connection string and ignores the storage account in .wadcfgx.</span></span>

### <a name="what-does-the-update-development-storage-connection-strings-check-box-do"></a><span data-ttu-id="82b6a-147">What does the "Update development storage connection strings..." check box do?</span><span class="sxs-lookup"><span data-stu-id="82b6a-147">What does the "Update development storage connection strings..." check box do?</span></span>
<span data-ttu-id="82b6a-148">The **Update development storage connection strings for Diagnostics and Caching with Microsoft Azure storage account credentials when publishing to Microsoft Azure** check box is a convenient way to update any development storage account connection strings with the Azure storage account that you specify during publishing.</span><span class="sxs-lookup"><span data-stu-id="82b6a-148">The **Update development storage connection strings for Diagnostics and Caching with Microsoft Azure storage account credentials when publishing to Microsoft Azure** check box is a convenient way to update any development storage account connection strings with the Azure storage account that you specify during publishing.</span></span>

<span data-ttu-id="82b6a-149">For example, if you select this check box and the diagnostics connection string specifies `UseDevelopmentStorage=true`, when you publish the project to Azure, Visual Studio automatically updates the diagnostics connection string with the storage account that you specified in the Publish wizard.</span><span class="sxs-lookup"><span data-stu-id="82b6a-149">For example, if you select this check box and the diagnostics connection string specifies `UseDevelopmentStorage=true`, when you publish the project to Azure, Visual Studio automatically updates the diagnostics connection string with the storage account that you specified in the Publish wizard.</span></span> <span data-ttu-id="82b6a-150">However, if a real storage account was specified as the diagnostics connection string, that account is used instead.</span><span class="sxs-lookup"><span data-stu-id="82b6a-150">However, if a real storage account was specified as the diagnostics connection string, that account is used instead.</span></span>

## <a name="diagnostics-functionality-differences-in-azure-sdk-24-and-earlier-vs-azure-sdk-25-and-later"></a><span data-ttu-id="82b6a-151">Diagnostics functionality differences in Azure SDK 2.4 and earlier vs. Azure SDK 2.5 and later</span><span class="sxs-lookup"><span data-stu-id="82b6a-151">Diagnostics functionality differences in Azure SDK 2.4 and earlier vs. Azure SDK 2.5 and later</span></span>
<span data-ttu-id="82b6a-152">If you're upgrading your project from Azure SDK 2.4 and earlier to Azure SDK 2.5 or later, keep in mind the following diagnostics functionality differences:</span><span class="sxs-lookup"><span data-stu-id="82b6a-152">If you're upgrading your project from Azure SDK 2.4 and earlier to Azure SDK 2.5 or later, keep in mind the following diagnostics functionality differences:</span></span>

* <span data-ttu-id="82b6a-153">**Configuration APIs are deprecated**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-153">**Configuration APIs are deprecated**.</span></span> <span data-ttu-id="82b6a-154">Programmatic configuration of diagnostics is available in Azure SDK 2.4 and earlier, but is deprecated in Azure SDK 2.5 and later.</span><span class="sxs-lookup"><span data-stu-id="82b6a-154">Programmatic configuration of diagnostics is available in Azure SDK 2.4 and earlier, but is deprecated in Azure SDK 2.5 and later.</span></span> <span data-ttu-id="82b6a-155">If your diagnostics configuration currently is defined in code, you must reconfigure those settings from scratch in the migrated project for diagnostics to keep working.</span><span class="sxs-lookup"><span data-stu-id="82b6a-155">If your diagnostics configuration currently is defined in code, you must reconfigure those settings from scratch in the migrated project for diagnostics to keep working.</span></span> <span data-ttu-id="82b6a-156">The diagnostics configuration file for Azure SDK 2.4 is diagnostics.wadcfg.</span><span class="sxs-lookup"><span data-stu-id="82b6a-156">The diagnostics configuration file for Azure SDK 2.4 is diagnostics.wadcfg.</span></span> <span data-ttu-id="82b6a-157">The diagnostics configuration file for Azure SDK 2.5 and later is diagnostics.wadcfgx.</span><span class="sxs-lookup"><span data-stu-id="82b6a-157">The diagnostics configuration file for Azure SDK 2.5 and later is diagnostics.wadcfgx.</span></span>
* <span data-ttu-id="82b6a-158">**Diagnostics for cloud service applications can be configured only at the role level**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-158">**Diagnostics for cloud service applications can be configured only at the role level**.</span></span> <span data-ttu-id="82b6a-159">In Azure SDK 2.5 and later, you can't set up diagnostics for cloud service applications at the instance level.</span><span class="sxs-lookup"><span data-stu-id="82b6a-159">In Azure SDK 2.5 and later, you can't set up diagnostics for cloud service applications at the instance level.</span></span>
* <span data-ttu-id="82b6a-160">**Every time you deploy your app, the diagnostics configuration is updated**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-160">**Every time you deploy your app, the diagnostics configuration is updated**.</span></span> <span data-ttu-id="82b6a-161">This can cause parity issues if you change your diagnostics configuration from Visual Studio Server Explorer and then redeploy your app.</span><span class="sxs-lookup"><span data-stu-id="82b6a-161">This can cause parity issues if you change your diagnostics configuration from Visual Studio Server Explorer and then redeploy your app.</span></span>
* <span data-ttu-id="82b6a-162">**In Azure SDK 2.5 and later, crash dumps are configured in the diagnostics configuration file, and not in code**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-162">**In Azure SDK 2.5 and later, crash dumps are configured in the diagnostics configuration file, and not in code**.</span></span> <span data-ttu-id="82b6a-163">If you have crash dumps configured in code, you must manually transfer the configuration from code to the configuration file.</span><span class="sxs-lookup"><span data-stu-id="82b6a-163">If you have crash dumps configured in code, you must manually transfer the configuration from code to the configuration file.</span></span> <span data-ttu-id="82b6a-164">Crash dumps aren't transferred during the migration to Azure SDK 2.6.</span><span class="sxs-lookup"><span data-stu-id="82b6a-164">Crash dumps aren't transferred during the migration to Azure SDK 2.6.</span></span>

## <a name="turn-on-diagnostics-in-cloud-service-projects-before-you-deploy-them"></a><span data-ttu-id="82b6a-165">Turn on diagnostics in cloud service projects before you deploy them</span><span class="sxs-lookup"><span data-stu-id="82b6a-165">Turn on diagnostics in cloud service projects before you deploy them</span></span>
<span data-ttu-id="82b6a-166">In Visual Studio, you can collect diagnostics data for roles that run in Azure when you run the service in the emulator before deployment.</span><span class="sxs-lookup"><span data-stu-id="82b6a-166">In Visual Studio, you can collect diagnostics data for roles that run in Azure when you run the service in the emulator before deployment.</span></span> <span data-ttu-id="82b6a-167">All changes to diagnostics settings in Visual Studio are saved in the diagnostics.wadcfgx configuration file.</span><span class="sxs-lookup"><span data-stu-id="82b6a-167">All changes to diagnostics settings in Visual Studio are saved in the diagnostics.wadcfgx configuration file.</span></span> <span data-ttu-id="82b6a-168">These settings specify the storage account where diagnostics data is saved when you deploy your cloud service.</span><span class="sxs-lookup"><span data-stu-id="82b6a-168">These settings specify the storage account where diagnostics data is saved when you deploy your cloud service.</span></span>

[!INCLUDE [cloud-services-wad-warning](../includes/cloud-services-wad-warning.md)]

### <a name="to-turn-on-diagnostics-in-visual-studio-before-deployment"></a><span data-ttu-id="82b6a-169">To turn on diagnostics in Visual Studio before deployment</span><span class="sxs-lookup"><span data-stu-id="82b6a-169">To turn on diagnostics in Visual Studio before deployment</span></span>

1. <span data-ttu-id="82b6a-170">On the shortcut menu for the role, select **Properties**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-170">On the shortcut menu for the role, select **Properties**.</span></span> <span data-ttu-id="82b6a-171">In the role’s **Properties** dialog box, select the **Configuration** tab.</span><span class="sxs-lookup"><span data-stu-id="82b6a-171">In the role’s **Properties** dialog box, select the **Configuration** tab.</span></span>
2. <span data-ttu-id="82b6a-172">In the **Diagnostics** section, make sure that the **Enable Diagnostics** check box is selected.</span><span class="sxs-lookup"><span data-stu-id="82b6a-172">In the **Diagnostics** section, make sure that the **Enable Diagnostics** check box is selected.</span></span>
   
    ![Access the Enable Diagnostics option](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796660.png)
3. <span data-ttu-id="82b6a-174">To specify the storage account for the diagnostics data, select the ellipsis (…) button.</span><span class="sxs-lookup"><span data-stu-id="82b6a-174">To specify the storage account for the diagnostics data, select the ellipsis (…) button.</span></span>
   
    ![Specify the storage account to use](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796661.png)
4. <span data-ttu-id="82b6a-176">In the **Create Storage Connection String** dialog box, specify whether you want to connect by using the Azure storage emulator, an Azure subscription, or manually entered credentials.</span><span class="sxs-lookup"><span data-stu-id="82b6a-176">In the **Create Storage Connection String** dialog box, specify whether you want to connect by using the Azure storage emulator, an Azure subscription, or manually entered credentials.</span></span>
   
    ![Storage account dialog box](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796662.png)
   
   * <span data-ttu-id="82b6a-178">If you select **Microsoft Azure storage emulator**, the connection string is set to `UseDevelopmentStorage=true`.</span><span class="sxs-lookup"><span data-stu-id="82b6a-178">If you select **Microsoft Azure storage emulator**, the connection string is set to `UseDevelopmentStorage=true`.</span></span>
   * <span data-ttu-id="82b6a-179">If you select **Your subscription**, you can select the Azure subscription that you want to use, and enter an account name.</span><span class="sxs-lookup"><span data-stu-id="82b6a-179">If you select **Your subscription**, you can select the Azure subscription that you want to use, and enter an account name.</span></span> <span data-ttu-id="82b6a-180">To manage your Azure subscriptions, select **Manage Accounts**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-180">To manage your Azure subscriptions, select **Manage Accounts**.</span></span>
   * <span data-ttu-id="82b6a-181">If you select **Manually entered credentials**, enter the name and key of the Azure account that you want to use.</span><span class="sxs-lookup"><span data-stu-id="82b6a-181">If you select **Manually entered credentials**, enter the name and key of the Azure account that you want to use.</span></span>
5. <span data-ttu-id="82b6a-182">To view the **Diagnostics configuration** dialog box, select **Configure**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-182">To view the **Diagnostics configuration** dialog box, select **Configure**.</span></span> <span data-ttu-id="82b6a-183">Except for **General** and **Log Directories**, each tab represents a diagnostics data source that you can collect.</span><span class="sxs-lookup"><span data-stu-id="82b6a-183">Except for **General** and **Log Directories**, each tab represents a diagnostics data source that you can collect.</span></span> <span data-ttu-id="82b6a-184">The default **General** tab offers the following diagnostics data collection options: **Errors only**, **All information**, and **Custom plan**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-184">The default **General** tab offers the following diagnostics data collection options: **Errors only**, **All information**, and **Custom plan**.</span></span> <span data-ttu-id="82b6a-185">The default **Errors only** option uses the least amount of storage, because it doesn’t transfer warnings or tracing messages.</span><span class="sxs-lookup"><span data-stu-id="82b6a-185">The default **Errors only** option uses the least amount of storage, because it doesn’t transfer warnings or tracing messages.</span></span> <span data-ttu-id="82b6a-186">The **All information** option transfers the most information, uses the most storage, and therefore, is the most expensive option.</span><span class="sxs-lookup"><span data-stu-id="82b6a-186">The **All information** option transfers the most information, uses the most storage, and therefore, is the most expensive option.</span></span>

   > [!NOTE]
   > <span data-ttu-id="82b6a-187">Minimum supported size for “Disk Quota in MB” is 4GB.</span><span class="sxs-lookup"><span data-stu-id="82b6a-187">Minimum supported size for “Disk Quota in MB” is 4GB.</span></span> <span data-ttu-id="82b6a-188">However, if you are collecting Memory dumps, increase this to a higher value like 10GB.</span><span class="sxs-lookup"><span data-stu-id="82b6a-188">However, if you are collecting Memory dumps, increase this to a higher value like 10GB.</span></span>
   >
  
    ![Enable Azure diagnostics and configuration](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758144.png)
6. <span data-ttu-id="82b6a-190">For this example, select the **Custom plan** option, so you can customize the collected data.</span><span class="sxs-lookup"><span data-stu-id="82b6a-190">For this example, select the **Custom plan** option, so you can customize the collected data.</span></span>
7. <span data-ttu-id="82b6a-191">In the **Disk Quota in MB** box, you can set how much space to allocate in your storage account for diagnostics data.</span><span class="sxs-lookup"><span data-stu-id="82b6a-191">In the **Disk Quota in MB** box, you can set how much space to allocate in your storage account for diagnostics data.</span></span> <span data-ttu-id="82b6a-192">You can change or accept the default value.</span><span class="sxs-lookup"><span data-stu-id="82b6a-192">You can change or accept the default value.</span></span>
8. <span data-ttu-id="82b6a-193">On each tab of diagnostics data that you want to collect, select the **Enable Transfer of \<log type\>** check box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-193">On each tab of diagnostics data that you want to collect, select the **Enable Transfer of \<log type\>** check box.</span></span> <span data-ttu-id="82b6a-194">For example, if you want to collect application logs, on the **Application Logs** tab, select the **Enable transfer of Application Logs** check box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-194">For example, if you want to collect application logs, on the **Application Logs** tab, select the **Enable transfer of Application Logs** check box.</span></span> <span data-ttu-id="82b6a-195">Also, specify any other information that's required by each diagnostics data type.</span><span class="sxs-lookup"><span data-stu-id="82b6a-195">Also, specify any other information that's required by each diagnostics data type.</span></span> <span data-ttu-id="82b6a-196">For configuration information for each tab, see the section **Set up diagnostics data sources** later in this article.</span><span class="sxs-lookup"><span data-stu-id="82b6a-196">For configuration information for each tab, see the section **Set up diagnostics data sources** later in this article.</span></span> 
9. <span data-ttu-id="82b6a-197">After you’ve enabled collection of all the diagnostics data you want, select **OK**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-197">After you’ve enabled collection of all the diagnostics data you want, select **OK**.</span></span>
10. <span data-ttu-id="82b6a-198">Run your Azure cloud service project in Visual Studio as usual.</span><span class="sxs-lookup"><span data-stu-id="82b6a-198">Run your Azure cloud service project in Visual Studio as usual.</span></span> <span data-ttu-id="82b6a-199">As you use your application, the log information that you enabled is saved to the Azure storage account that you specified.</span><span class="sxs-lookup"><span data-stu-id="82b6a-199">As you use your application, the log information that you enabled is saved to the Azure storage account that you specified.</span></span>

## <a name="turn-on-diagnostics-on-azure-virtual-machines"></a><span data-ttu-id="82b6a-200">Turn on diagnostics on Azure virtual machines</span><span class="sxs-lookup"><span data-stu-id="82b6a-200">Turn on diagnostics on Azure virtual machines</span></span>
<span data-ttu-id="82b6a-201">In Visual Studio, you can collect diagnostics data for Azure virtual machines.</span><span class="sxs-lookup"><span data-stu-id="82b6a-201">In Visual Studio, you can collect diagnostics data for Azure virtual machines.</span></span>

### <a name="to-turn-on-diagnostics-on-azure-virtual-machines"></a><span data-ttu-id="82b6a-202">To turn on diagnostics on Azure virtual machines</span><span class="sxs-lookup"><span data-stu-id="82b6a-202">To turn on diagnostics on Azure virtual machines</span></span>

1. <span data-ttu-id="82b6a-203">In Server Explorer, select the Azure node, and then connect to your Azure subscription, if you're not already connected.</span><span class="sxs-lookup"><span data-stu-id="82b6a-203">In Server Explorer, select the Azure node, and then connect to your Azure subscription, if you're not already connected.</span></span>
2. <span data-ttu-id="82b6a-204">Expand the **Virtual Machines** node.</span><span class="sxs-lookup"><span data-stu-id="82b6a-204">Expand the **Virtual Machines** node.</span></span> <span data-ttu-id="82b6a-205">You can create a new virtual machine, or select an existing node.</span><span class="sxs-lookup"><span data-stu-id="82b6a-205">You can create a new virtual machine, or select an existing node.</span></span>
3. <span data-ttu-id="82b6a-206">On the shortcut menu for the virtual machine you want, select **Configure**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-206">On the shortcut menu for the virtual machine you want, select **Configure**.</span></span> <span data-ttu-id="82b6a-207">The virtual machine configuration dialog box appears.</span><span class="sxs-lookup"><span data-stu-id="82b6a-207">The virtual machine configuration dialog box appears.</span></span>
   
    ![Configure an Azure virtual machine](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796663.png)
4. <span data-ttu-id="82b6a-209">If it's not already installed, add the Microsoft Monitoring Agent Diagnostics extension.</span><span class="sxs-lookup"><span data-stu-id="82b6a-209">If it's not already installed, add the Microsoft Monitoring Agent Diagnostics extension.</span></span> <span data-ttu-id="82b6a-210">With this extension, you can gather diagnostics data for the Azure virtual machine.</span><span class="sxs-lookup"><span data-stu-id="82b6a-210">With this extension, you can gather diagnostics data for the Azure virtual machine.</span></span> <span data-ttu-id="82b6a-211">Under **Installed Extensions**, in the **Select an available extension** drop-down list box, select **Microsoft Monitoring Agent Diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-211">Under **Installed Extensions**, in the **Select an available extension** drop-down list box, select **Microsoft Monitoring Agent Diagnostics**.</span></span>
   
    ![Install an Azure virtual machine extension](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766024.png)
   
    > [!NOTE]
   > <span data-ttu-id="82b6a-213">Other diagnostics extensions are available for your virtual machines.</span><span class="sxs-lookup"><span data-stu-id="82b6a-213">Other diagnostics extensions are available for your virtual machines.</span></span> <span data-ttu-id="82b6a-214">For more information, see [Virtual machine extensions and features for Windows](https://docs.microsoft.com/azure/virtual-machines/windows/extensions-features).</span><span class="sxs-lookup"><span data-stu-id="82b6a-214">For more information, see [Virtual machine extensions and features for Windows](https://docs.microsoft.com/azure/virtual-machines/windows/extensions-features).</span></span>
   > 
   > 
5. <span data-ttu-id="82b6a-215">To add the extension and view its **Diagnostics configuration** dialog box, select **Add**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-215">To add the extension and view its **Diagnostics configuration** dialog box, select **Add**.</span></span>
6. <span data-ttu-id="82b6a-216">To specify a storage account, select **Configure**,  and then select **OK**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-216">To specify a storage account, select **Configure**,  and then select **OK**.</span></span>
   
    <span data-ttu-id="82b6a-217">Each tab (except for **General** and **Log Directories**) represents a diagnostics data source that you can collect.</span><span class="sxs-lookup"><span data-stu-id="82b6a-217">Each tab (except for **General** and **Log Directories**) represents a diagnostics data source that you can collect.</span></span>
   
    ![Enable Azure diagnostics and configuration](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758144.png)
   
    <span data-ttu-id="82b6a-219">The default tab, **General**, offers you the following diagnostics data collection options: **Errors only**, **All information**, and **Custom plan**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-219">The default tab, **General**, offers you the following diagnostics data collection options: **Errors only**, **All information**, and **Custom plan**.</span></span> <span data-ttu-id="82b6a-220">The default option, **Errors only**, takes the least amount of storage because it doesn’t transfer warnings or tracing messages.</span><span class="sxs-lookup"><span data-stu-id="82b6a-220">The default option, **Errors only**, takes the least amount of storage because it doesn’t transfer warnings or tracing messages.</span></span> <span data-ttu-id="82b6a-221">The **All information** option transfers the most information and is, therefore, the most expensive option in terms of storage.</span><span class="sxs-lookup"><span data-stu-id="82b6a-221">The **All information** option transfers the most information and is, therefore, the most expensive option in terms of storage.</span></span>
7. <span data-ttu-id="82b6a-222">For this example, select the **Custom plan** option so you can customize the data collected.</span><span class="sxs-lookup"><span data-stu-id="82b6a-222">For this example, select the **Custom plan** option so you can customize the data collected.</span></span>
8. <span data-ttu-id="82b6a-223">The **Disk Quota in MB** box specifies how much space you want to allocate in your storage account for diagnostics data.</span><span class="sxs-lookup"><span data-stu-id="82b6a-223">The **Disk Quota in MB** box specifies how much space you want to allocate in your storage account for diagnostics data.</span></span> <span data-ttu-id="82b6a-224">You can change the default value if you want.</span><span class="sxs-lookup"><span data-stu-id="82b6a-224">You can change the default value if you want.</span></span>
9. <span data-ttu-id="82b6a-225">On each tab of diagnostics data you want to collect, select its **Enable Transfer of \<log type\>** check box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-225">On each tab of diagnostics data you want to collect, select its **Enable Transfer of \<log type\>** check box.</span></span>
   
    <span data-ttu-id="82b6a-226">For example, if you want to collect application logs, select the **Enable transfer of Application Logs** check box on the **Application Logs** tab. Also, specify any other information that's required for each diagnostics data type.</span><span class="sxs-lookup"><span data-stu-id="82b6a-226">For example, if you want to collect application logs, select the **Enable transfer of Application Logs** check box on the **Application Logs** tab. Also, specify any other information that's required for each diagnostics data type.</span></span> <span data-ttu-id="82b6a-227">For configuration information for each tab, see the section **Set up diagnostics data sources** later in this article.</span><span class="sxs-lookup"><span data-stu-id="82b6a-227">For configuration information for each tab, see the section **Set up diagnostics data sources** later in this article.</span></span>
10. <span data-ttu-id="82b6a-228">After you’ve enabled collection of all the diagnostics data that you want, select **OK**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-228">After you’ve enabled collection of all the diagnostics data that you want, select **OK**.</span></span>
11. <span data-ttu-id="82b6a-229">Save the updated project.</span><span class="sxs-lookup"><span data-stu-id="82b6a-229">Save the updated project.</span></span>
    
    <span data-ttu-id="82b6a-230">A message in the **Microsoft Azure Activity Log** window indicates that the virtual machine has been updated.</span><span class="sxs-lookup"><span data-stu-id="82b6a-230">A message in the **Microsoft Azure Activity Log** window indicates that the virtual machine has been updated.</span></span>

## <a name="set-up-diagnostics-data-sources"></a><span data-ttu-id="82b6a-231">Set up diagnostics data sources</span><span class="sxs-lookup"><span data-stu-id="82b6a-231">Set up diagnostics data sources</span></span>
<span data-ttu-id="82b6a-232">After you enable diagnostics data collection, you can choose exactly what data sources you want to collect, and what information is collected.</span><span class="sxs-lookup"><span data-stu-id="82b6a-232">After you enable diagnostics data collection, you can choose exactly what data sources you want to collect, and what information is collected.</span></span> <span data-ttu-id="82b6a-233">The next sections describe the tabs in the **Diagnostics configuration** dialog box and what each configuration option means.</span><span class="sxs-lookup"><span data-stu-id="82b6a-233">The next sections describe the tabs in the **Diagnostics configuration** dialog box and what each configuration option means.</span></span>

### <a name="application-logs"></a><span data-ttu-id="82b6a-234">Application logs</span><span class="sxs-lookup"><span data-stu-id="82b6a-234">Application logs</span></span>
<span data-ttu-id="82b6a-235">Application logs have diagnostics information that's produced by a web application.</span><span class="sxs-lookup"><span data-stu-id="82b6a-235">Application logs have diagnostics information that's produced by a web application.</span></span> <span data-ttu-id="82b6a-236">If you want to capture application logs, select the **Enable transfer of Application Logs** check box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-236">If you want to capture application logs, select the **Enable transfer of Application Logs** check box.</span></span> <span data-ttu-id="82b6a-237">To increase or decrease the interval between the transfer of application logs to your storage account, change the **Transfer Period (min)** value.</span><span class="sxs-lookup"><span data-stu-id="82b6a-237">To increase or decrease the interval between the transfer of application logs to your storage account, change the **Transfer Period (min)** value.</span></span> <span data-ttu-id="82b6a-238">You also can change the amount of information captured in the log by setting the **Log level** value.</span><span class="sxs-lookup"><span data-stu-id="82b6a-238">You also can change the amount of information captured in the log by setting the **Log level** value.</span></span> <span data-ttu-id="82b6a-239">For example, select **Verbose** to get more information, or select **Critical** to capture only critical errors.</span><span class="sxs-lookup"><span data-stu-id="82b6a-239">For example, select **Verbose** to get more information, or select **Critical** to capture only critical errors.</span></span> <span data-ttu-id="82b6a-240">If you have a specific diagnostics provider that emits application logs, you can capture the logs by adding the provider’s GUID in the **Provider GUID** box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-240">If you have a specific diagnostics provider that emits application logs, you can capture the logs by adding the provider’s GUID in the **Provider GUID** box.</span></span>

  ![Application logs](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758145.png)

<span data-ttu-id="82b6a-242">For more information about application logs, see [Enable diagnostics logging for Web Apps in Azure App Service](app-service/web-sites-enable-diagnostic-log.md).</span><span class="sxs-lookup"><span data-stu-id="82b6a-242">For more information about application logs, see [Enable diagnostics logging for Web Apps in Azure App Service](app-service/web-sites-enable-diagnostic-log.md).</span></span>

### <a name="windows-event-logs"></a><span data-ttu-id="82b6a-243">Windows event logs</span><span class="sxs-lookup"><span data-stu-id="82b6a-243">Windows event logs</span></span>
<span data-ttu-id="82b6a-244">To capture Windows event logs, select the **Enable transfer of Windows Event Logs** check box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-244">To capture Windows event logs, select the **Enable transfer of Windows Event Logs** check box.</span></span> <span data-ttu-id="82b6a-245">To increase or decrease the interval between the transfer of event logs to your storage account, change the **Transfer Period (min)** value.</span><span class="sxs-lookup"><span data-stu-id="82b6a-245">To increase or decrease the interval between the transfer of event logs to your storage account, change the **Transfer Period (min)** value.</span></span> <span data-ttu-id="82b6a-246">Select the check boxes for the types of events that you want to track.</span><span class="sxs-lookup"><span data-stu-id="82b6a-246">Select the check boxes for the types of events that you want to track.</span></span>

![Event logs](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796664.png)

<span data-ttu-id="82b6a-248">If you're using Azure SDK 2.6 or later and you want to specify a custom data source, enter it in the **\<Data source name\>** text box, and then select **Add**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-248">If you're using Azure SDK 2.6 or later and you want to specify a custom data source, enter it in the **\<Data source name\>** text box, and then select **Add**.</span></span> <span data-ttu-id="82b6a-249">The data source is added to the diagnostics.cfcfg file.</span><span class="sxs-lookup"><span data-stu-id="82b6a-249">The data source is added to the diagnostics.cfcfg file.</span></span>

<span data-ttu-id="82b6a-250">If you're using Azure SDK 2.5 and want to specify a custom data source, you can add it to the `WindowsEventLog` section of the diagnostics.wadcfgx file, like in the following example:</span><span class="sxs-lookup"><span data-stu-id="82b6a-250">If you're using Azure SDK 2.5 and want to specify a custom data source, you can add it to the `WindowsEventLog` section of the diagnostics.wadcfgx file, like in the following example:</span></span>

```
<WindowsEventLog scheduledTransferPeriod="PT1M">
   <DataSource name="Application!*" />
   <DataSource name="CustomDataSource!*" />
</WindowsEventLog>
```
### <a name="performance-counters"></a><span data-ttu-id="82b6a-251">Performance counters</span><span class="sxs-lookup"><span data-stu-id="82b6a-251">Performance counters</span></span>
<span data-ttu-id="82b6a-252">Performance counter information can help you locate system bottlenecks and fine-tune system and application performance.</span><span class="sxs-lookup"><span data-stu-id="82b6a-252">Performance counter information can help you locate system bottlenecks and fine-tune system and application performance.</span></span> <span data-ttu-id="82b6a-253">For more information, see [Create and use performance counters in an Azure application](https://msdn.microsoft.com/library/azure/hh411542.aspx).</span><span class="sxs-lookup"><span data-stu-id="82b6a-253">For more information, see [Create and use performance counters in an Azure application](https://msdn.microsoft.com/library/azure/hh411542.aspx).</span></span> <span data-ttu-id="82b6a-254">To capture performance counters, select the **Enable transfer of Performance Counters** check box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-254">To capture performance counters, select the **Enable transfer of Performance Counters** check box.</span></span> <span data-ttu-id="82b6a-255">To increase or decrease the interval between the transfer of event logs to your storage account, change the **Transfer Period (min)** value.</span><span class="sxs-lookup"><span data-stu-id="82b6a-255">To increase or decrease the interval between the transfer of event logs to your storage account, change the **Transfer Period (min)** value.</span></span> <span data-ttu-id="82b6a-256">Select the check boxes for the performance counters that you want to track.</span><span class="sxs-lookup"><span data-stu-id="82b6a-256">Select the check boxes for the performance counters that you want to track.</span></span>

![Performance counters](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758147.png)

<span data-ttu-id="82b6a-258">To track a performance counter that isn’t listed, enter the performance counter by using the suggested syntax.</span><span class="sxs-lookup"><span data-stu-id="82b6a-258">To track a performance counter that isn’t listed, enter the performance counter by using the suggested syntax.</span></span> <span data-ttu-id="82b6a-259">and then select **Add**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-259">and then select **Add**.</span></span> <span data-ttu-id="82b6a-260">The operating system on the virtual machine determines which performance counters you can track. For more information about syntax, see [Specify a counter path](https://msdn.microsoft.com/library/windows/desktop/aa373193.aspx).</span><span class="sxs-lookup"><span data-stu-id="82b6a-260">The operating system on the virtual machine determines which performance counters you can track. For more information about syntax, see [Specify a counter path](https://msdn.microsoft.com/library/windows/desktop/aa373193.aspx).</span></span>

### <a name="infrastructure-logs"></a><span data-ttu-id="82b6a-261">Infrastructure logs</span><span class="sxs-lookup"><span data-stu-id="82b6a-261">Infrastructure logs</span></span>
<span data-ttu-id="82b6a-262">Infrastructure logs have information about the Azure diagnostic infrastructure, the RemoteAccess module, and the RemoteForwarder module.</span><span class="sxs-lookup"><span data-stu-id="82b6a-262">Infrastructure logs have information about the Azure diagnostic infrastructure, the RemoteAccess module, and the RemoteForwarder module.</span></span> <span data-ttu-id="82b6a-263">To collect information about infrastructure logs, select the **Enable transfer of Infrastructure Logs** check box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-263">To collect information about infrastructure logs, select the **Enable transfer of Infrastructure Logs** check box.</span></span> <span data-ttu-id="82b6a-264">To increase or decrease the interval between the transfer of infrastructure logs to your storage account, change the **Transfer Period (min)** value.</span><span class="sxs-lookup"><span data-stu-id="82b6a-264">To increase or decrease the interval between the transfer of infrastructure logs to your storage account, change the **Transfer Period (min)** value.</span></span>

![Diagnostics infrastructure logs](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC758148.png)

<span data-ttu-id="82b6a-266">For more information, see [Collect logging data by using Azure Diagnostics](https://msdn.microsoft.com/library/azure/gg433048.aspx).</span><span class="sxs-lookup"><span data-stu-id="82b6a-266">For more information, see [Collect logging data by using Azure Diagnostics](https://msdn.microsoft.com/library/azure/gg433048.aspx).</span></span>

### <a name="log-directories"></a><span data-ttu-id="82b6a-267">Log directories</span><span class="sxs-lookup"><span data-stu-id="82b6a-267">Log directories</span></span>
<span data-ttu-id="82b6a-268">Log directories have data collected from log directories for Internet Information Services (IIS) requests, failed requests, or folders that you choose.</span><span class="sxs-lookup"><span data-stu-id="82b6a-268">Log directories have data collected from log directories for Internet Information Services (IIS) requests, failed requests, or folders that you choose.</span></span> <span data-ttu-id="82b6a-269">To capture log directories, select the **Enable transfer of Log Directories** check box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-269">To capture log directories, select the **Enable transfer of Log Directories** check box.</span></span> <span data-ttu-id="82b6a-270">To increase or decrease the interval between the transfer of logs to your storage account, change the **Transfer Period (min)** value.</span><span class="sxs-lookup"><span data-stu-id="82b6a-270">To increase or decrease the interval between the transfer of logs to your storage account, change the **Transfer Period (min)** value.</span></span>

<span data-ttu-id="82b6a-271">Select the check boxes of the logs that you want to collect, such as **IIS Logs** and **Failed Request** logs.</span><span class="sxs-lookup"><span data-stu-id="82b6a-271">Select the check boxes of the logs that you want to collect, such as **IIS Logs** and **Failed Request** logs.</span></span> <span data-ttu-id="82b6a-272">Default storage container names are provided, but you can change the names.</span><span class="sxs-lookup"><span data-stu-id="82b6a-272">Default storage container names are provided, but you can change the names.</span></span>

<span data-ttu-id="82b6a-273">You can capture logs from any folder.</span><span class="sxs-lookup"><span data-stu-id="82b6a-273">You can capture logs from any folder.</span></span> <span data-ttu-id="82b6a-274">Specify the path in the **Log from Absolute Directory** section, and then select **Add Directory**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-274">Specify the path in the **Log from Absolute Directory** section, and then select **Add Directory**.</span></span> <span data-ttu-id="82b6a-275">The logs are captured in the specified containers.</span><span class="sxs-lookup"><span data-stu-id="82b6a-275">The logs are captured in the specified containers.</span></span>

![Log directories](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796665.png)

### <a name="etw-logs"></a><span data-ttu-id="82b6a-277">ETW logs</span><span class="sxs-lookup"><span data-stu-id="82b6a-277">ETW logs</span></span>
<span data-ttu-id="82b6a-278">If you use [Event Tracing for Windows](https://msdn.microsoft.com/library/windows/desktop/bb968803\(v=vs.85\).aspx) (ETW) and want to capture ETW logs, select the **Enable transfer of ETW Logs** check box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-278">If you use [Event Tracing for Windows](https://msdn.microsoft.com/library/windows/desktop/bb968803\(v=vs.85\).aspx) (ETW) and want to capture ETW logs, select the **Enable transfer of ETW Logs** check box.</span></span> <span data-ttu-id="82b6a-279">To increase or decrease the interval between the transfer of logs to your storage account, change the **Transfer Period (min)** value.</span><span class="sxs-lookup"><span data-stu-id="82b6a-279">To increase or decrease the interval between the transfer of logs to your storage account, change the **Transfer Period (min)** value.</span></span>

<span data-ttu-id="82b6a-280">The events are captured from event sources and event manifests that you specify.</span><span class="sxs-lookup"><span data-stu-id="82b6a-280">The events are captured from event sources and event manifests that you specify.</span></span> <span data-ttu-id="82b6a-281">To specify an event source, in the **Event Sources** section, enter a name and then select **Add Event Source**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-281">To specify an event source, in the **Event Sources** section, enter a name and then select **Add Event Source**.</span></span> <span data-ttu-id="82b6a-282">Similarly, you can specify an event manifest in the **Event Manifests** section, and then select **Add Event Manifest**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-282">Similarly, you can specify an event manifest in the **Event Manifests** section, and then select **Add Event Manifest**.</span></span>

![ETW logs](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766025.png)

<span data-ttu-id="82b6a-284">The ETW framework is supported in ASP.NET through classes in the [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110)) namespace.</span><span class="sxs-lookup"><span data-stu-id="82b6a-284">The ETW framework is supported in ASP.NET through classes in the [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110)) namespace.</span></span> <span data-ttu-id="82b6a-285">The Microsoft.WindowsAzure.Diagnostics namespace, which inherits from and extends standard [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110)) classes, enables the use of [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110)) as a logging framework in the Azure environment.</span><span class="sxs-lookup"><span data-stu-id="82b6a-285">The Microsoft.WindowsAzure.Diagnostics namespace, which inherits from and extends standard [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110)) classes, enables the use of [System.Diagnostics.aspx](https://msdn.microsoft.com/library/system.diagnostics(v=vs.110)) as a logging framework in the Azure environment.</span></span> <span data-ttu-id="82b6a-286">For more information, see [Take control of logging and tracing in Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) and [Enable diagnostics in Azure Cloud Services and virtual machines](cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="82b6a-286">For more information, see [Take control of logging and tracing in Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) and [Enable diagnostics in Azure Cloud Services and virtual machines](cloud-services/cloud-services-dotnet-diagnostics.md).</span></span>

### <a name="crash-dumps"></a><span data-ttu-id="82b6a-287">Crash dumps</span><span class="sxs-lookup"><span data-stu-id="82b6a-287">Crash dumps</span></span>
<span data-ttu-id="82b6a-288">To capture information about when a role instance crashes, select the **Enable transfer of Crash Dumps** check box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-288">To capture information about when a role instance crashes, select the **Enable transfer of Crash Dumps** check box.</span></span> <span data-ttu-id="82b6a-289">(Because ASP.NET handles most exceptions, this is generally useful only for worker roles.) To increase or decrease the percentage of storage space devoted to the crash dumps, change the **Directory Quota (%)** value.</span><span class="sxs-lookup"><span data-stu-id="82b6a-289">(Because ASP.NET handles most exceptions, this is generally useful only for worker roles.) To increase or decrease the percentage of storage space devoted to the crash dumps, change the **Directory Quota (%)** value.</span></span> <span data-ttu-id="82b6a-290">You can change the storage container where the crash dumps are stored, and select whether you want to capture a **Full** or **Mini** dump.</span><span class="sxs-lookup"><span data-stu-id="82b6a-290">You can change the storage container where the crash dumps are stored, and select whether you want to capture a **Full** or **Mini** dump.</span></span>

<span data-ttu-id="82b6a-291">The processes currently being tracked are listed in the next screenshot.</span><span class="sxs-lookup"><span data-stu-id="82b6a-291">The processes currently being tracked are listed in the next screenshot.</span></span> <span data-ttu-id="82b6a-292">Select the check boxes for the processes that you want to capture.</span><span class="sxs-lookup"><span data-stu-id="82b6a-292">Select the check boxes for the processes that you want to capture.</span></span> <span data-ttu-id="82b6a-293">To add another process to the list, enter the process name and then select **Add Process**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-293">To add another process to the list, enter the process name and then select **Add Process**.</span></span>

![Crash dumps](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766026.png)

<span data-ttu-id="82b6a-295">For more information, see [Take control of logging and tracing in Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) and [Microsoft Azure Diagnostics Part 4: Custom logging components and Azure Diagnostics 1.3 changes](http://justazure.com/microsoft-azure-diagnostics-part-4-custom-logging-components-azure-diagnostics-1-3-changes/).</span><span class="sxs-lookup"><span data-stu-id="82b6a-295">For more information, see [Take control of logging and tracing in Microsoft Azure](https://msdn.microsoft.com/magazine/ff714589.aspx) and [Microsoft Azure Diagnostics Part 4: Custom logging components and Azure Diagnostics 1.3 changes](http://justazure.com/microsoft-azure-diagnostics-part-4-custom-logging-components-azure-diagnostics-1-3-changes/).</span></span>

## <a name="view-the-diagnostics-data"></a><span data-ttu-id="82b6a-296">View the diagnostics data</span><span class="sxs-lookup"><span data-stu-id="82b6a-296">View the diagnostics data</span></span>
<span data-ttu-id="82b6a-297">After you’ve collected the diagnostics data for a cloud service or virtual machine, you can view it.</span><span class="sxs-lookup"><span data-stu-id="82b6a-297">After you’ve collected the diagnostics data for a cloud service or virtual machine, you can view it.</span></span>

### <a name="to-view-cloud-service-diagnostics-data"></a><span data-ttu-id="82b6a-298">To view cloud service diagnostics data</span><span class="sxs-lookup"><span data-stu-id="82b6a-298">To view cloud service diagnostics data</span></span>
1. <span data-ttu-id="82b6a-299">Deploy your cloud service as usual, and then run it.</span><span class="sxs-lookup"><span data-stu-id="82b6a-299">Deploy your cloud service as usual, and then run it.</span></span>
2. <span data-ttu-id="82b6a-300">You can view the diagnostics data either in a report that Visual Studio generates, or in tables in your storage account.</span><span class="sxs-lookup"><span data-stu-id="82b6a-300">You can view the diagnostics data either in a report that Visual Studio generates, or in tables in your storage account.</span></span> <span data-ttu-id="82b6a-301">To view the data in a report, open Cloud Explorer or Server Explorer, open the shortcut menu of the node for the role that you want, and then select **View Diagnostic Data**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-301">To view the data in a report, open Cloud Explorer or Server Explorer, open the shortcut menu of the node for the role that you want, and then select **View Diagnostic Data**.</span></span>
   
    ![View diagnostics data](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC748912.png)
   
    <span data-ttu-id="82b6a-303">A report that shows the available data appears.</span><span class="sxs-lookup"><span data-stu-id="82b6a-303">A report that shows the available data appears.</span></span>
   
    ![Microsoft Azure Diagnostics report in Visual Studio](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796666.png)
   
    <span data-ttu-id="82b6a-305">If the most recent data isn't shown, you might have to wait for the transfer period to elapse.</span><span class="sxs-lookup"><span data-stu-id="82b6a-305">If the most recent data isn't shown, you might have to wait for the transfer period to elapse.</span></span>
   
    <span data-ttu-id="82b6a-306">To immediately update the data, select the **Refresh** link.</span><span class="sxs-lookup"><span data-stu-id="82b6a-306">To immediately update the data, select the **Refresh** link.</span></span> <span data-ttu-id="82b6a-307">To have the data updated automatically, select an interval in the **Auto-Refresh** drop-down list box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-307">To have the data updated automatically, select an interval in the **Auto-Refresh** drop-down list box.</span></span> <span data-ttu-id="82b6a-308">To export the error data, select the **Export to CSV** button to create a comma-separated value file that you can open in an Excel worksheet.</span><span class="sxs-lookup"><span data-stu-id="82b6a-308">To export the error data, select the **Export to CSV** button to create a comma-separated value file that you can open in an Excel worksheet.</span></span>
   
    <span data-ttu-id="82b6a-309">In Cloud Explorer or Server Explorer, open the storage account that's associated with the deployment.</span><span class="sxs-lookup"><span data-stu-id="82b6a-309">In Cloud Explorer or Server Explorer, open the storage account that's associated with the deployment.</span></span>
3. <span data-ttu-id="82b6a-310">Open the diagnostics tables in the table viewer, and then review the data that you collected.</span><span class="sxs-lookup"><span data-stu-id="82b6a-310">Open the diagnostics tables in the table viewer, and then review the data that you collected.</span></span> <span data-ttu-id="82b6a-311">For IIS logs and custom logs, you can open a blob container.</span><span class="sxs-lookup"><span data-stu-id="82b6a-311">For IIS logs and custom logs, you can open a blob container.</span></span> <span data-ttu-id="82b6a-312">The following table lists the tables or blob containers that contain the data for the different log files.</span><span class="sxs-lookup"><span data-stu-id="82b6a-312">The following table lists the tables or blob containers that contain the data for the different log files.</span></span> <span data-ttu-id="82b6a-313">In addition to the data for that log file, the table entries contain **EventTickCount**, **DeploymentId**, **Role**, and **RoleInstance**, to help you identify which virtual machine and role generated the data, and when.</span><span class="sxs-lookup"><span data-stu-id="82b6a-313">In addition to the data for that log file, the table entries contain **EventTickCount**, **DeploymentId**, **Role**, and **RoleInstance**, to help you identify which virtual machine and role generated the data, and when.</span></span> 
   
   | <span data-ttu-id="82b6a-314">Diagnostic data</span><span class="sxs-lookup"><span data-stu-id="82b6a-314">Diagnostic data</span></span> | <span data-ttu-id="82b6a-315">Description</span><span class="sxs-lookup"><span data-stu-id="82b6a-315">Description</span></span> | <span data-ttu-id="82b6a-316">Location</span><span class="sxs-lookup"><span data-stu-id="82b6a-316">Location</span></span> |
   | --- | --- | --- |
   | <span data-ttu-id="82b6a-317">Application logs</span><span class="sxs-lookup"><span data-stu-id="82b6a-317">Application logs</span></span> |<span data-ttu-id="82b6a-318">Logs that your code generates by calling methods of the **System.Diagnostics.Trace** class.</span><span class="sxs-lookup"><span data-stu-id="82b6a-318">Logs that your code generates by calling methods of the **System.Diagnostics.Trace** class.</span></span> |<span data-ttu-id="82b6a-319">WADLogsTable</span><span class="sxs-lookup"><span data-stu-id="82b6a-319">WADLogsTable</span></span> |
   | <span data-ttu-id="82b6a-320">Event logs</span><span class="sxs-lookup"><span data-stu-id="82b6a-320">Event logs</span></span> |<span data-ttu-id="82b6a-321">Data from the Windows event logs on the virtual machines.</span><span class="sxs-lookup"><span data-stu-id="82b6a-321">Data from the Windows event logs on the virtual machines.</span></span> <span data-ttu-id="82b6a-322">Windows stores information in these logs, but applications and services also use the logs to report errors or log information.</span><span class="sxs-lookup"><span data-stu-id="82b6a-322">Windows stores information in these logs, but applications and services also use the logs to report errors or log information.</span></span> |<span data-ttu-id="82b6a-323">WADWindowsEventLogsTable</span><span class="sxs-lookup"><span data-stu-id="82b6a-323">WADWindowsEventLogsTable</span></span> |
   | <span data-ttu-id="82b6a-324">Performance counters</span><span class="sxs-lookup"><span data-stu-id="82b6a-324">Performance counters</span></span> |<span data-ttu-id="82b6a-325">You can collect data on any performance counter that’s available on the virtual machine.</span><span class="sxs-lookup"><span data-stu-id="82b6a-325">You can collect data on any performance counter that’s available on the virtual machine.</span></span> <span data-ttu-id="82b6a-326">The operating system provides performance counters, which include many statistics, like memory usage and processor time.</span><span class="sxs-lookup"><span data-stu-id="82b6a-326">The operating system provides performance counters, which include many statistics, like memory usage and processor time.</span></span> |<span data-ttu-id="82b6a-327">WADPerformanceCountersTable</span><span class="sxs-lookup"><span data-stu-id="82b6a-327">WADPerformanceCountersTable</span></span> |
   | <span data-ttu-id="82b6a-328">Infrastructure logs</span><span class="sxs-lookup"><span data-stu-id="82b6a-328">Infrastructure logs</span></span> |<span data-ttu-id="82b6a-329">Logs that are generated from the diagnostics infrastructure itself.</span><span class="sxs-lookup"><span data-stu-id="82b6a-329">Logs that are generated from the diagnostics infrastructure itself.</span></span> |<span data-ttu-id="82b6a-330">WADDiagnosticInfrastructureLogsTable</span><span class="sxs-lookup"><span data-stu-id="82b6a-330">WADDiagnosticInfrastructureLogsTable</span></span> |
   | <span data-ttu-id="82b6a-331">IIS logs</span><span class="sxs-lookup"><span data-stu-id="82b6a-331">IIS logs</span></span> |<span data-ttu-id="82b6a-332">Logs that record web requests.</span><span class="sxs-lookup"><span data-stu-id="82b6a-332">Logs that record web requests.</span></span> <span data-ttu-id="82b6a-333">If your cloud service gets a significant amount of traffic, these logs can be lengthy.</span><span class="sxs-lookup"><span data-stu-id="82b6a-333">If your cloud service gets a significant amount of traffic, these logs can be lengthy.</span></span> <span data-ttu-id="82b6a-334">It's a good idea to collect and store this data only when you need it.</span><span class="sxs-lookup"><span data-stu-id="82b6a-334">It's a good idea to collect and store this data only when you need it.</span></span> |<span data-ttu-id="82b6a-335">You can find failed-request logs in the blob container under wad-iis-failedreqlogs, under a path for that deployment, role, and instance.</span><span class="sxs-lookup"><span data-stu-id="82b6a-335">You can find failed-request logs in the blob container under wad-iis-failedreqlogs, under a path for that deployment, role, and instance.</span></span> <span data-ttu-id="82b6a-336">You can find complete logs under wad-iis-logfiles.</span><span class="sxs-lookup"><span data-stu-id="82b6a-336">You can find complete logs under wad-iis-logfiles.</span></span> <span data-ttu-id="82b6a-337">Entries for each file are made in the WADDirectories table.</span><span class="sxs-lookup"><span data-stu-id="82b6a-337">Entries for each file are made in the WADDirectories table.</span></span> |
   | <span data-ttu-id="82b6a-338">Crash dumps</span><span class="sxs-lookup"><span data-stu-id="82b6a-338">Crash dumps</span></span> |<span data-ttu-id="82b6a-339">Provides binary images of your cloud service’s process (typically a worker role).</span><span class="sxs-lookup"><span data-stu-id="82b6a-339">Provides binary images of your cloud service’s process (typically a worker role).</span></span> |<span data-ttu-id="82b6a-340">wad-crush-dumps blob container</span><span class="sxs-lookup"><span data-stu-id="82b6a-340">wad-crush-dumps blob container</span></span> |
   | <span data-ttu-id="82b6a-341">Custom log files</span><span class="sxs-lookup"><span data-stu-id="82b6a-341">Custom log files</span></span> |<span data-ttu-id="82b6a-342">Logs of data that you predefined.</span><span class="sxs-lookup"><span data-stu-id="82b6a-342">Logs of data that you predefined.</span></span> |<span data-ttu-id="82b6a-343">You can specify in code the location of custom log files in your storage account.</span><span class="sxs-lookup"><span data-stu-id="82b6a-343">You can specify in code the location of custom log files in your storage account.</span></span> <span data-ttu-id="82b6a-344">For example, you can specify a custom blob container.</span><span class="sxs-lookup"><span data-stu-id="82b6a-344">For example, you can specify a custom blob container.</span></span> |
4. <span data-ttu-id="82b6a-345">If data of any type is truncated, you can try increasing the buffer for that data type or shortening the interval between transfers of data from the virtual machine to your storage account.</span><span class="sxs-lookup"><span data-stu-id="82b6a-345">If data of any type is truncated, you can try increasing the buffer for that data type or shortening the interval between transfers of data from the virtual machine to your storage account.</span></span>
5. <span data-ttu-id="82b6a-346">(Optional) Purge data from the storage account occasionally to reduce overall storage costs.</span><span class="sxs-lookup"><span data-stu-id="82b6a-346">(Optional) Purge data from the storage account occasionally to reduce overall storage costs.</span></span>
6. <span data-ttu-id="82b6a-347">When you do a full deployment, the diagnostics.cscfg file (.wadcfgx for Azure SDK 2.5) is updated in Azure, and your cloud service picks up any changes to your diagnostics configuration.</span><span class="sxs-lookup"><span data-stu-id="82b6a-347">When you do a full deployment, the diagnostics.cscfg file (.wadcfgx for Azure SDK 2.5) is updated in Azure, and your cloud service picks up any changes to your diagnostics configuration.</span></span> <span data-ttu-id="82b6a-348">If you instead update an existing deployment, the .cscfg file isn’t updated in Azure.</span><span class="sxs-lookup"><span data-stu-id="82b6a-348">If you instead update an existing deployment, the .cscfg file isn’t updated in Azure.</span></span> <span data-ttu-id="82b6a-349">You can still change diagnostics settings, though, by following the steps in the next section.</span><span class="sxs-lookup"><span data-stu-id="82b6a-349">You can still change diagnostics settings, though, by following the steps in the next section.</span></span> <span data-ttu-id="82b6a-350">For more information about performing a full deployment and updating an existing deployment, see [Publish Azure Application Wizard](vs-azure-tools-publish-azure-application-wizard.md).</span><span class="sxs-lookup"><span data-stu-id="82b6a-350">For more information about performing a full deployment and updating an existing deployment, see [Publish Azure Application Wizard](vs-azure-tools-publish-azure-application-wizard.md).</span></span>

### <a name="to-view-virtual-machine-diagnostics-data"></a><span data-ttu-id="82b6a-351">To view virtual machine diagnostics data</span><span class="sxs-lookup"><span data-stu-id="82b6a-351">To view virtual machine diagnostics data</span></span>
1. <span data-ttu-id="82b6a-352">On the shortcut menu for the virtual machine, select **View Diagnostics Data**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-352">On the shortcut menu for the virtual machine, select **View Diagnostics Data**.</span></span>
   
    ![View diagnostics data in an Azure virtual machine](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC766027.png)
   
    <span data-ttu-id="82b6a-354">The **Diagnostics summary** dialog box appears.</span><span class="sxs-lookup"><span data-stu-id="82b6a-354">The **Diagnostics summary** dialog box appears.</span></span>
   
    ![Azure virtual machine diagnostics summary](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC796667.png)  
   
    <span data-ttu-id="82b6a-356">If the most recent data isn't shown, you might have to wait for the transfer period to elapse.</span><span class="sxs-lookup"><span data-stu-id="82b6a-356">If the most recent data isn't shown, you might have to wait for the transfer period to elapse.</span></span>
   
    <span data-ttu-id="82b6a-357">To immediately update the data, select the **Refresh** link.</span><span class="sxs-lookup"><span data-stu-id="82b6a-357">To immediately update the data, select the **Refresh** link.</span></span> <span data-ttu-id="82b6a-358">To have the data updated automatically, select an interval in the **Auto-Refresh** drop-down list box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-358">To have the data updated automatically, select an interval in the **Auto-Refresh** drop-down list box.</span></span> <span data-ttu-id="82b6a-359">To export the error data, select the **Export to CSV** button to create a comma-separated value file that you can open in an Excel worksheet.</span><span class="sxs-lookup"><span data-stu-id="82b6a-359">To export the error data, select the **Export to CSV** button to create a comma-separated value file that you can open in an Excel worksheet.</span></span>

## <a name="set-up-cloud-service-diagnostics-after-deployment"></a><span data-ttu-id="82b6a-360">Set up cloud service diagnostics after deployment</span><span class="sxs-lookup"><span data-stu-id="82b6a-360">Set up cloud service diagnostics after deployment</span></span>
<span data-ttu-id="82b6a-361">If you're investigating a problem with a cloud service that is already running, you might want to collect data that you didn't specify before you originally deployed the role.</span><span class="sxs-lookup"><span data-stu-id="82b6a-361">If you're investigating a problem with a cloud service that is already running, you might want to collect data that you didn't specify before you originally deployed the role.</span></span> <span data-ttu-id="82b6a-362">In this case, you can start collecting that data by changing the settings in Server Explorer.</span><span class="sxs-lookup"><span data-stu-id="82b6a-362">In this case, you can start collecting that data by changing the settings in Server Explorer.</span></span> <span data-ttu-id="82b6a-363">You can set up diagnostics either for a single instance or for all the instances in a role, depending on whether you open the **Diagnostics Configuration** dialog box from the shortcut menu for the instance or for the role.</span><span class="sxs-lookup"><span data-stu-id="82b6a-363">You can set up diagnostics either for a single instance or for all the instances in a role, depending on whether you open the **Diagnostics Configuration** dialog box from the shortcut menu for the instance or for the role.</span></span> <span data-ttu-id="82b6a-364">If you configure the role node, any changes that you make apply to all instances.</span><span class="sxs-lookup"><span data-stu-id="82b6a-364">If you configure the role node, any changes that you make apply to all instances.</span></span> <span data-ttu-id="82b6a-365">If you configure the instance node, any changes that you make apply only to that instance.</span><span class="sxs-lookup"><span data-stu-id="82b6a-365">If you configure the instance node, any changes that you make apply only to that instance.</span></span>

### <a name="to-set-up-diagnostics-for-a-running-cloud-service"></a><span data-ttu-id="82b6a-366">To set up diagnostics for a running cloud service</span><span class="sxs-lookup"><span data-stu-id="82b6a-366">To set up diagnostics for a running cloud service</span></span>
1. <span data-ttu-id="82b6a-367">In Server Explorer, expand the **Cloud Services** node, and then expand the list of nodes to locate the role or instance (or both) that you want to investigate.</span><span class="sxs-lookup"><span data-stu-id="82b6a-367">In Server Explorer, expand the **Cloud Services** node, and then expand the list of nodes to locate the role or instance (or both) that you want to investigate.</span></span>
   
    ![Configure diagnostics](./media/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines/IC748913.png)
2. <span data-ttu-id="82b6a-369">On the shortcut menu for an instance node or role node, select **Update Diagnostics Settings**, and then select the diagnostic settings that you want to collect.</span><span class="sxs-lookup"><span data-stu-id="82b6a-369">On the shortcut menu for an instance node or role node, select **Update Diagnostics Settings**, and then select the diagnostic settings that you want to collect.</span></span>
   
    <span data-ttu-id="82b6a-370">For information about the configuration settings, see the section **Set up diagnostics data sources** in this article.</span><span class="sxs-lookup"><span data-stu-id="82b6a-370">For information about the configuration settings, see the section **Set up diagnostics data sources** in this article.</span></span> <span data-ttu-id="82b6a-371">For information about how to view the diagnostics data, see the section **View the diagnostics data** in this article.</span><span class="sxs-lookup"><span data-stu-id="82b6a-371">For information about how to view the diagnostics data, see the section **View the diagnostics data** in this article.</span></span>
   
    <span data-ttu-id="82b6a-372">If you change data collection in Server Explorer, the changes remain in effect until you fully redeploy your cloud service.</span><span class="sxs-lookup"><span data-stu-id="82b6a-372">If you change data collection in Server Explorer, the changes remain in effect until you fully redeploy your cloud service.</span></span> <span data-ttu-id="82b6a-373">If you use the default publish settings, the changes are not overwritten.</span><span class="sxs-lookup"><span data-stu-id="82b6a-373">If you use the default publish settings, the changes are not overwritten.</span></span> <span data-ttu-id="82b6a-374">The default publish setting is to update the existing deployment, rather than to do a full redeployment.</span><span class="sxs-lookup"><span data-stu-id="82b6a-374">The default publish setting is to update the existing deployment, rather than to do a full redeployment.</span></span> <span data-ttu-id="82b6a-375">To ensure that the settings clear at deployment time, go to the **Advanced Settings** tab in the Publish wizard, and then clear the **Deployment update** check box.</span><span class="sxs-lookup"><span data-stu-id="82b6a-375">To ensure that the settings clear at deployment time, go to the **Advanced Settings** tab in the Publish wizard, and then clear the **Deployment update** check box.</span></span> <span data-ttu-id="82b6a-376">When you redeploy with that check box cleared, the settings revert to those in the .wadcfgx (or .wadcfg) file as set through the **Properties** editor for the role.</span><span class="sxs-lookup"><span data-stu-id="82b6a-376">When you redeploy with that check box cleared, the settings revert to those in the .wadcfgx (or .wadcfg) file as set through the **Properties** editor for the role.</span></span> <span data-ttu-id="82b6a-377">If you update your deployment, Azure keeps the earlier settings.</span><span class="sxs-lookup"><span data-stu-id="82b6a-377">If you update your deployment, Azure keeps the earlier settings.</span></span>

## <a name="troubleshoot-azure-cloud-service-issues"></a><span data-ttu-id="82b6a-378">Troubleshoot Azure cloud service issues</span><span class="sxs-lookup"><span data-stu-id="82b6a-378">Troubleshoot Azure cloud service issues</span></span>
<span data-ttu-id="82b6a-379">If you experience problems with your cloud service projects, like a role that gets stuck in a "busy" status, repeatedly recycles, or throws an internal server error, there are tools and techniques that you can use to diagnose and fix the issue.</span><span class="sxs-lookup"><span data-stu-id="82b6a-379">If you experience problems with your cloud service projects, like a role that gets stuck in a "busy" status, repeatedly recycles, or throws an internal server error, there are tools and techniques that you can use to diagnose and fix the issue.</span></span> <span data-ttu-id="82b6a-380">For specific examples of common problems and solutions, and for an overview of the concepts and tools that you can use to diagnose and fix these errors, see [Azure PaaS compute diagnostics data](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).</span><span class="sxs-lookup"><span data-stu-id="82b6a-380">For specific examples of common problems and solutions, and for an overview of the concepts and tools that you can use to diagnose and fix these errors, see [Azure PaaS compute diagnostics data](http://blogs.msdn.com/b/kwill/archive/2013/08/09/windows-azure-paas-compute-diagnostics-data.aspx).</span></span>

## <a name="q--a"></a><span data-ttu-id="82b6a-381">Q & A</span><span class="sxs-lookup"><span data-stu-id="82b6a-381">Q & A</span></span>
<span data-ttu-id="82b6a-382">**What is the buffer size, and how large should it be?**</span><span class="sxs-lookup"><span data-stu-id="82b6a-382">**What is the buffer size, and how large should it be?**</span></span>

<span data-ttu-id="82b6a-383">On each virtual machine instance, quotas limit how much diagnostics data can be stored on the local file system.</span><span class="sxs-lookup"><span data-stu-id="82b6a-383">On each virtual machine instance, quotas limit how much diagnostics data can be stored on the local file system.</span></span> <span data-ttu-id="82b6a-384">In addition, you specify a buffer size for each type of diagnostics data that's available.</span><span class="sxs-lookup"><span data-stu-id="82b6a-384">In addition, you specify a buffer size for each type of diagnostics data that's available.</span></span> <span data-ttu-id="82b6a-385">This buffer size acts like an individual quota for that type of data.</span><span class="sxs-lookup"><span data-stu-id="82b6a-385">This buffer size acts like an individual quota for that type of data.</span></span> <span data-ttu-id="82b6a-386">To determine the overall quota and the amount of memory that remains, see the bottom of the dialog box for the diagnostics data type.</span><span class="sxs-lookup"><span data-stu-id="82b6a-386">To determine the overall quota and the amount of memory that remains, see the bottom of the dialog box for the diagnostics data type.</span></span> <span data-ttu-id="82b6a-387">If you specify larger buffers or more types of data, you'll approach the overall quota.</span><span class="sxs-lookup"><span data-stu-id="82b6a-387">If you specify larger buffers or more types of data, you'll approach the overall quota.</span></span> <span data-ttu-id="82b6a-388">You can change the overall quota by modifying the diagnostics.wadcfg or .wadcfgx configuration file.</span><span class="sxs-lookup"><span data-stu-id="82b6a-388">You can change the overall quota by modifying the diagnostics.wadcfg or .wadcfgx configuration file.</span></span> <span data-ttu-id="82b6a-389">The diagnostics data is stored on the same file system as your application’s data.</span><span class="sxs-lookup"><span data-stu-id="82b6a-389">The diagnostics data is stored on the same file system as your application’s data.</span></span> <span data-ttu-id="82b6a-390">If your application uses a large amount of disk space, you shouldn’t increase the overall diagnostics quota.</span><span class="sxs-lookup"><span data-stu-id="82b6a-390">If your application uses a large amount of disk space, you shouldn’t increase the overall diagnostics quota.</span></span>

<span data-ttu-id="82b6a-391">**What is the transfer period, and how long should it be?**</span><span class="sxs-lookup"><span data-stu-id="82b6a-391">**What is the transfer period, and how long should it be?**</span></span>

<span data-ttu-id="82b6a-392">The transfer period is the amount of time that elapses between data captures.</span><span class="sxs-lookup"><span data-stu-id="82b6a-392">The transfer period is the amount of time that elapses between data captures.</span></span> <span data-ttu-id="82b6a-393">After each transfer period, data is moved from the local file system on a virtual machine to tables in your storage account.</span><span class="sxs-lookup"><span data-stu-id="82b6a-393">After each transfer period, data is moved from the local file system on a virtual machine to tables in your storage account.</span></span> <span data-ttu-id="82b6a-394">If the amount of data that's collected exceeds the quota before the end of a transfer period, older data is discarded.</span><span class="sxs-lookup"><span data-stu-id="82b6a-394">If the amount of data that's collected exceeds the quota before the end of a transfer period, older data is discarded.</span></span> <span data-ttu-id="82b6a-395">If you are losing data because your data exceeds the buffer size or the overall quota, you might want to decrease the transfer period.</span><span class="sxs-lookup"><span data-stu-id="82b6a-395">If you are losing data because your data exceeds the buffer size or the overall quota, you might want to decrease the transfer period.</span></span>

<span data-ttu-id="82b6a-396">**What time zone are the time stamps in?**</span><span class="sxs-lookup"><span data-stu-id="82b6a-396">**What time zone are the time stamps in?**</span></span>

<span data-ttu-id="82b6a-397">Time stamps are in the local time zone of the datacenter that hosts your cloud service.</span><span class="sxs-lookup"><span data-stu-id="82b6a-397">Time stamps are in the local time zone of the datacenter that hosts your cloud service.</span></span> <span data-ttu-id="82b6a-398">The following three time stamp columns in the log tables are used:</span><span class="sxs-lookup"><span data-stu-id="82b6a-398">The following three time stamp columns in the log tables are used:</span></span>

* <span data-ttu-id="82b6a-399">**PreciseTimeStamp**: The ETW timestamp of the event.</span><span class="sxs-lookup"><span data-stu-id="82b6a-399">**PreciseTimeStamp**: The ETW timestamp of the event.</span></span> <span data-ttu-id="82b6a-400">That is, the time the event is logged from the client.</span><span class="sxs-lookup"><span data-stu-id="82b6a-400">That is, the time the event is logged from the client.</span></span>
* <span data-ttu-id="82b6a-401">**TIMESTAMP**: The value for **PreciseTimeStamp** rounded down to the upload frequency boundary.</span><span class="sxs-lookup"><span data-stu-id="82b6a-401">**TIMESTAMP**: The value for **PreciseTimeStamp** rounded down to the upload frequency boundary.</span></span> <span data-ttu-id="82b6a-402">For example, if your upload frequency is 5 minutes and the event time 00:17:12, TIMESTAMP is 00:15:00.</span><span class="sxs-lookup"><span data-stu-id="82b6a-402">For example, if your upload frequency is 5 minutes and the event time 00:17:12, TIMESTAMP is 00:15:00.</span></span>
* <span data-ttu-id="82b6a-403">**Timestamp**: The time stamp at which the entity was created in the Azure table.</span><span class="sxs-lookup"><span data-stu-id="82b6a-403">**Timestamp**: The time stamp at which the entity was created in the Azure table.</span></span>

<span data-ttu-id="82b6a-404">**How do I manage costs when collecting diagnostic information?**</span><span class="sxs-lookup"><span data-stu-id="82b6a-404">**How do I manage costs when collecting diagnostic information?**</span></span>

<span data-ttu-id="82b6a-405">The default settings (**Log level** set to **Error**, and **Transfer period** set to **1 minute**) are designed to minimize costs.</span><span class="sxs-lookup"><span data-stu-id="82b6a-405">The default settings (**Log level** set to **Error**, and **Transfer period** set to **1 minute**) are designed to minimize costs.</span></span> <span data-ttu-id="82b6a-406">Your compute costs increase when you collect more diagnostics data or if you decrease the transfer period.</span><span class="sxs-lookup"><span data-stu-id="82b6a-406">Your compute costs increase when you collect more diagnostics data or if you decrease the transfer period.</span></span> <span data-ttu-id="82b6a-407">Don’t collect more data than you need, and don’t forget to disable data collection when you no longer need it.</span><span class="sxs-lookup"><span data-stu-id="82b6a-407">Don’t collect more data than you need, and don’t forget to disable data collection when you no longer need it.</span></span> <span data-ttu-id="82b6a-408">You can always enable it again, even at run time, as described earlier in this article.</span><span class="sxs-lookup"><span data-stu-id="82b6a-408">You can always enable it again, even at run time, as described earlier in this article.</span></span>

<span data-ttu-id="82b6a-409">**How do I collect failed-request logs from IIS?**</span><span class="sxs-lookup"><span data-stu-id="82b6a-409">**How do I collect failed-request logs from IIS?**</span></span>

<span data-ttu-id="82b6a-410">By default, IIS doesn’t collect failed-request logs.</span><span class="sxs-lookup"><span data-stu-id="82b6a-410">By default, IIS doesn’t collect failed-request logs.</span></span> <span data-ttu-id="82b6a-411">You can set up IIS to collect failed-request logs by editing the web.config file for your web role.</span><span class="sxs-lookup"><span data-stu-id="82b6a-411">You can set up IIS to collect failed-request logs by editing the web.config file for your web role.</span></span>

<span data-ttu-id="82b6a-412">**I’m not getting trace information from RoleEntryPoint methods like OnStart. What’s wrong?**</span><span class="sxs-lookup"><span data-stu-id="82b6a-412">**I’m not getting trace information from RoleEntryPoint methods like OnStart. What’s wrong?**</span></span>

<span data-ttu-id="82b6a-413">The methods of **RoleEntryPoint** are called in the context of WAIISHost.exe, not in IIS.</span><span class="sxs-lookup"><span data-stu-id="82b6a-413">The methods of **RoleEntryPoint** are called in the context of WAIISHost.exe, not in IIS.</span></span> <span data-ttu-id="82b6a-414">The configuration information in web.config that normally enables tracing doesn’t apply.</span><span class="sxs-lookup"><span data-stu-id="82b6a-414">The configuration information in web.config that normally enables tracing doesn’t apply.</span></span> <span data-ttu-id="82b6a-415">To resolve this issue, add a .config file to your web role project, and name the file to match the output assembly that contains the **RoleEntryPoint** code.</span><span class="sxs-lookup"><span data-stu-id="82b6a-415">To resolve this issue, add a .config file to your web role project, and name the file to match the output assembly that contains the **RoleEntryPoint** code.</span></span> <span data-ttu-id="82b6a-416">In the default web role project, the name of the .config file should be WAIISHost.exe.config. Add the following lines to this file:</span><span class="sxs-lookup"><span data-stu-id="82b6a-416">In the default web role project, the name of the .config file should be WAIISHost.exe.config. Add the following lines to this file:</span></span>

```
<system.diagnostics>
  <trace>
      <listeners>
          <add name “AzureDiagnostics” type=”Microsoft.WindowsAzure.Diagnostics.DiagnosticMonitorTraceListener”>
              <filter type=”” />
          </add>
      </listeners>
  </trace>
</system.diagnostics>
```

<span data-ttu-id="82b6a-417">In the **Properties** window, set the **Copy to Output Directory** property to **Copy always**.</span><span class="sxs-lookup"><span data-stu-id="82b6a-417">In the **Properties** window, set the **Copy to Output Directory** property to **Copy always**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="82b6a-418">Next steps</span><span class="sxs-lookup"><span data-stu-id="82b6a-418">Next steps</span></span>
<span data-ttu-id="82b6a-419">To learn more about diagnostics logging in Azure, see [Enable diagnostics in Azure Cloud Services and virtual machines](cloud-services/cloud-services-dotnet-diagnostics.md) and [Enable diagnostics logging for Web Apps in Azure App Service](app-service/web-sites-enable-diagnostic-log.md).</span><span class="sxs-lookup"><span data-stu-id="82b6a-419">To learn more about diagnostics logging in Azure, see [Enable diagnostics in Azure Cloud Services and virtual machines](cloud-services/cloud-services-dotnet-diagnostics.md) and [Enable diagnostics logging for Web Apps in Azure App Service](app-service/web-sites-enable-diagnostic-log.md).</span></span>

