---
title: Azure SQL Database performance for single databases | Microsoft Docs
description: This article can help you determine which service tier to choose for your application. It also recommends ways to tune your application to get the most from Azure SQL Database.
services: sql-database
documentationcenter: na
author: CarlRabeler
manager: jhubbard
editor: ''
ms.assetid: dd8d95fa-24b2-4233-b3f1-8e8952a7a22b
ms.service: sql-database
ms.custom: monitor and tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 04/14/2017
ms.author: carlrab
ms.openlocfilehash: 9c3c1c5ff0bf489fa6e86ebb906a71bff6eef006
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44550277"
---
# <a name="azure-sql-database-and-performance-for-single-databases"></a><span data-ttu-id="9961f-104">Azure SQL Database and performance for single databases</span><span class="sxs-lookup"><span data-stu-id="9961f-104">Azure SQL Database and performance for single databases</span></span>
<span data-ttu-id="9961f-105">Azure SQL Database offers four [service tiers](sql-database-service-tiers.md): Basic, Standard, Premium, and Premium RS.</span><span class="sxs-lookup"><span data-stu-id="9961f-105">Azure SQL Database offers four [service tiers](sql-database-service-tiers.md): Basic, Standard, Premium, and Premium RS.</span></span> <span data-ttu-id="9961f-106">Each service tier strictly isolates the resources that your SQL database can use, and guarantees predictable performance for that service level.</span><span class="sxs-lookup"><span data-stu-id="9961f-106">Each service tier strictly isolates the resources that your SQL database can use, and guarantees predictable performance for that service level.</span></span> <span data-ttu-id="9961f-107">In this article, we offer guidance that can help you choose the service tier for your application.</span><span class="sxs-lookup"><span data-stu-id="9961f-107">In this article, we offer guidance that can help you choose the service tier for your application.</span></span> <span data-ttu-id="9961f-108">We also discuss ways that you can tune your application to get the most from Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9961f-108">We also discuss ways that you can tune your application to get the most from Azure SQL Database.</span></span>

> [!NOTE]
> <span data-ttu-id="9961f-109">This article focuses on performance guidance for single databases in Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9961f-109">This article focuses on performance guidance for single databases in Azure SQL Database.</span></span> <span data-ttu-id="9961f-110">For performance guidance related to elastic pools, see [Price and performance considerations for elastic pools](sql-database-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="9961f-110">For performance guidance related to elastic pools, see [Price and performance considerations for elastic pools](sql-database-elastic-pool.md).</span></span> <span data-ttu-id="9961f-111">Note, though, that you can apply many of the tuning recommendations in this article to databases in an elastic pool, and get similar performance benefits.</span><span class="sxs-lookup"><span data-stu-id="9961f-111">Note, though, that you can apply many of the tuning recommendations in this article to databases in an elastic pool, and get similar performance benefits.</span></span>
>
>

## <a name="why-service-tiers"></a><span data-ttu-id="9961f-112">Why service tiers?</span><span class="sxs-lookup"><span data-stu-id="9961f-112">Why service tiers?</span></span>
<span data-ttu-id="9961f-113">Although each database workload can differ, the purpose of service tiers is to provide performance predictability at various performance levels.</span><span class="sxs-lookup"><span data-stu-id="9961f-113">Although each database workload can differ, the purpose of service tiers is to provide performance predictability at various performance levels.</span></span> <span data-ttu-id="9961f-114">Customers with large-scale database resource requirements can work in a more dedicated computing environment.</span><span class="sxs-lookup"><span data-stu-id="9961f-114">Customers with large-scale database resource requirements can work in a more dedicated computing environment.</span></span>

### <a name="common-service-tier-use-cases"></a><span data-ttu-id="9961f-115">Common service tier use cases</span><span class="sxs-lookup"><span data-stu-id="9961f-115">Common service tier use cases</span></span>
#### <a name="basic"></a><span data-ttu-id="9961f-116">Basic</span><span class="sxs-lookup"><span data-stu-id="9961f-116">Basic</span></span>
* <span data-ttu-id="9961f-117">**You're just getting started with Azure SQL Database**.</span><span class="sxs-lookup"><span data-stu-id="9961f-117">**You're just getting started with Azure SQL Database**.</span></span> <span data-ttu-id="9961f-118">Applications that are in development often don't need high-performance levels.</span><span class="sxs-lookup"><span data-stu-id="9961f-118">Applications that are in development often don't need high-performance levels.</span></span> <span data-ttu-id="9961f-119">Basic databases are an ideal environment for database development, at a low price point.</span><span class="sxs-lookup"><span data-stu-id="9961f-119">Basic databases are an ideal environment for database development, at a low price point.</span></span>
* <span data-ttu-id="9961f-120">**You have a database with a single user**.</span><span class="sxs-lookup"><span data-stu-id="9961f-120">**You have a database with a single user**.</span></span> <span data-ttu-id="9961f-121">Applications that associate a single user with a database typically don’t have high concurrency and performance requirements.</span><span class="sxs-lookup"><span data-stu-id="9961f-121">Applications that associate a single user with a database typically don’t have high concurrency and performance requirements.</span></span> <span data-ttu-id="9961f-122">These applications are candidates for the Basic service tier.</span><span class="sxs-lookup"><span data-stu-id="9961f-122">These applications are candidates for the Basic service tier.</span></span>

#### <a name="standard"></a><span data-ttu-id="9961f-123">Standard</span><span class="sxs-lookup"><span data-stu-id="9961f-123">Standard</span></span>
* <span data-ttu-id="9961f-124">**Your database has multiple concurrent requests**.</span><span class="sxs-lookup"><span data-stu-id="9961f-124">**Your database has multiple concurrent requests**.</span></span> <span data-ttu-id="9961f-125">Applications that service more than one user at a time usually need higher performance levels.</span><span class="sxs-lookup"><span data-stu-id="9961f-125">Applications that service more than one user at a time usually need higher performance levels.</span></span> <span data-ttu-id="9961f-126">For example, websites that get moderate traffic or departmental applications that require more resources are good candidates for the Standard service tier.</span><span class="sxs-lookup"><span data-stu-id="9961f-126">For example, websites that get moderate traffic or departmental applications that require more resources are good candidates for the Standard service tier.</span></span>

#### <a name="premium"></a><span data-ttu-id="9961f-127">Premium</span><span class="sxs-lookup"><span data-stu-id="9961f-127">Premium</span></span>
<span data-ttu-id="9961f-128">Most Premium service tier use cases have one or more of these characteristics:</span><span class="sxs-lookup"><span data-stu-id="9961f-128">Most Premium service tier use cases have one or more of these characteristics:</span></span>

* <span data-ttu-id="9961f-129">**High peak load**.</span><span class="sxs-lookup"><span data-stu-id="9961f-129">**High peak load**.</span></span> <span data-ttu-id="9961f-130">An application that requires substantial CPU, memory, or input/output (I/O) to complete its operations requires a dedicated, high-performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-130">An application that requires substantial CPU, memory, or input/output (I/O) to complete its operations requires a dedicated, high-performance level.</span></span> <span data-ttu-id="9961f-131">For example, a database operation known to consume several CPU cores for an extended time is a candidate for the Premium service tier.</span><span class="sxs-lookup"><span data-stu-id="9961f-131">For example, a database operation known to consume several CPU cores for an extended time is a candidate for the Premium service tier.</span></span>
* <span data-ttu-id="9961f-132">**Many concurrent requests**.</span><span class="sxs-lookup"><span data-stu-id="9961f-132">**Many concurrent requests**.</span></span> <span data-ttu-id="9961f-133">Some database applications service many concurrent requests, for example, when serving a website that has a high traffic volume.</span><span class="sxs-lookup"><span data-stu-id="9961f-133">Some database applications service many concurrent requests, for example, when serving a website that has a high traffic volume.</span></span> <span data-ttu-id="9961f-134">Basic and Standard service tiers limit the number of concurrent requests per database.</span><span class="sxs-lookup"><span data-stu-id="9961f-134">Basic and Standard service tiers limit the number of concurrent requests per database.</span></span> <span data-ttu-id="9961f-135">Applications that require more connections would need to choose an appropriate reservation size to handle the maximum number of needed requests.</span><span class="sxs-lookup"><span data-stu-id="9961f-135">Applications that require more connections would need to choose an appropriate reservation size to handle the maximum number of needed requests.</span></span>
* <span data-ttu-id="9961f-136">**Low latency**.</span><span class="sxs-lookup"><span data-stu-id="9961f-136">**Low latency**.</span></span> <span data-ttu-id="9961f-137">Some applications need to guarantee a response from the database in minimal time.</span><span class="sxs-lookup"><span data-stu-id="9961f-137">Some applications need to guarantee a response from the database in minimal time.</span></span> <span data-ttu-id="9961f-138">If a specific stored procedure is called as part of a broader customer operation, you might have a requirement to have a return from that call in no more than 20 milliseconds, 99 percent of the time.</span><span class="sxs-lookup"><span data-stu-id="9961f-138">If a specific stored procedure is called as part of a broader customer operation, you might have a requirement to have a return from that call in no more than 20 milliseconds, 99 percent of the time.</span></span> <span data-ttu-id="9961f-139">This type of application benefits from the Premium service tier, to make sure that the required computing power is available.</span><span class="sxs-lookup"><span data-stu-id="9961f-139">This type of application benefits from the Premium service tier, to make sure that the required computing power is available.</span></span>

* <span data-ttu-id="9961f-140">**Premium RS**.</span><span class="sxs-lookup"><span data-stu-id="9961f-140">**Premium RS**.</span></span> <span data-ttu-id="9961f-141">Designed for customers that have IO-intensive workloads but do not require the highest availability guarantees.</span><span class="sxs-lookup"><span data-stu-id="9961f-141">Designed for customers that have IO-intensive workloads but do not require the highest availability guarantees.</span></span> <span data-ttu-id="9961f-142">Examples include testing high-performance workloads, or an analytical workload where the database is not the system of record.</span><span class="sxs-lookup"><span data-stu-id="9961f-142">Examples include testing high-performance workloads, or an analytical workload where the database is not the system of record.</span></span>

<span data-ttu-id="9961f-143">The service level that you need for your SQL database depends on the peak load requirements for each resource dimension.</span><span class="sxs-lookup"><span data-stu-id="9961f-143">The service level that you need for your SQL database depends on the peak load requirements for each resource dimension.</span></span> <span data-ttu-id="9961f-144">Some applications use a trivial amount of a single resource, but have significant requirements for other resources.</span><span class="sxs-lookup"><span data-stu-id="9961f-144">Some applications use a trivial amount of a single resource, but have significant requirements for other resources.</span></span>

## <a name="service-tier-capabilities-and-limits"></a><span data-ttu-id="9961f-145">Service tier capabilities and limits</span><span class="sxs-lookup"><span data-stu-id="9961f-145">Service tier capabilities and limits</span></span>
<span data-ttu-id="9961f-146">Each service tier and performance level is associated with different limits and performance characteristics.</span><span class="sxs-lookup"><span data-stu-id="9961f-146">Each service tier and performance level is associated with different limits and performance characteristics.</span></span> <span data-ttu-id="9961f-147">This table describes these characteristics for a single database.</span><span class="sxs-lookup"><span data-stu-id="9961f-147">This table describes these characteristics for a single database.</span></span>

[!INCLUDE [SQL DB service tiers table](../../includes/sql-database-service-tiers-table.md)]

> [!IMPORTANT]
> <span data-ttu-id="9961f-148">Customers using P11 and P15 performance levels can use up to 4 TB of included storage at no additional charge.</span><span class="sxs-lookup"><span data-stu-id="9961f-148">Customers using P11 and P15 performance levels can use up to 4 TB of included storage at no additional charge.</span></span> <span data-ttu-id="9961f-149">This 4 TB option is currently available in the following regions: US East2, West US, West Europe, South East Asia, Japan East, Australia East, Canada Central, and Canada East.</span><span class="sxs-lookup"><span data-stu-id="9961f-149">This 4 TB option is currently available in the following regions: US East2, West US, West Europe, South East Asia, Japan East, Australia East, Canada Central, and Canada East.</span></span>
>

### <a name="maximum-in-memory-oltp-storage"></a><span data-ttu-id="9961f-150">Maximum In-Memory OLTP storage</span><span class="sxs-lookup"><span data-stu-id="9961f-150">Maximum In-Memory OLTP storage</span></span>
<span data-ttu-id="9961f-151">You can use the **sys.dm_db_resource_stats** view to monitor your Azure In-Memory storage use.</span><span class="sxs-lookup"><span data-stu-id="9961f-151">You can use the **sys.dm_db_resource_stats** view to monitor your Azure In-Memory storage use.</span></span> <span data-ttu-id="9961f-152">For more information about monitoring, see [Monitor In-Memory OLTP storage](sql-database-in-memory-oltp-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="9961f-152">For more information about monitoring, see [Monitor In-Memory OLTP storage](sql-database-in-memory-oltp-monitoring.md).</span></span>

### <a name="maximum-concurrent-requests"></a><span data-ttu-id="9961f-153">Maximum concurrent requests</span><span class="sxs-lookup"><span data-stu-id="9961f-153">Maximum concurrent requests</span></span>
<span data-ttu-id="9961f-154">To see the number of concurrent requests, run this Transact-SQL query on your SQL database:</span><span class="sxs-lookup"><span data-stu-id="9961f-154">To see the number of concurrent requests, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R

<span data-ttu-id="9961f-155">To analyze the workload of an on-premises SQL Server database, modify this query to filter on the specific database you want to analyze.</span><span class="sxs-lookup"><span data-stu-id="9961f-155">To analyze the workload of an on-premises SQL Server database, modify this query to filter on the specific database you want to analyze.</span></span> <span data-ttu-id="9961f-156">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns the count of concurrent requests in that database:</span><span class="sxs-lookup"><span data-stu-id="9961f-156">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns the count of concurrent requests in that database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R
    INNER JOIN sys.databases D ON D.database_id = R.database_id
    AND D.name = 'MyDatabase'

<span data-ttu-id="9961f-157">This is just a snapshot at a single point in time.</span><span class="sxs-lookup"><span data-stu-id="9961f-157">This is just a snapshot at a single point in time.</span></span> <span data-ttu-id="9961f-158">To get a better understanding of your workload and concurrent request requirements, you'll need to collect many samples over time.</span><span class="sxs-lookup"><span data-stu-id="9961f-158">To get a better understanding of your workload and concurrent request requirements, you'll need to collect many samples over time.</span></span>

### <a name="maximum-concurrent-logins"></a><span data-ttu-id="9961f-159">Maximum concurrent logins</span><span class="sxs-lookup"><span data-stu-id="9961f-159">Maximum concurrent logins</span></span>
<span data-ttu-id="9961f-160">You can analyze your user and application patterns to get an idea of the frequency of logins.</span><span class="sxs-lookup"><span data-stu-id="9961f-160">You can analyze your user and application patterns to get an idea of the frequency of logins.</span></span> <span data-ttu-id="9961f-161">You also can run real-world loads in a test environment to make sure that you're not hitting this or other limits we discuss in this article.</span><span class="sxs-lookup"><span data-stu-id="9961f-161">You also can run real-world loads in a test environment to make sure that you're not hitting this or other limits we discuss in this article.</span></span> <span data-ttu-id="9961f-162">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span><span class="sxs-lookup"><span data-stu-id="9961f-162">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span></span>

<span data-ttu-id="9961f-163">If multiple clients use the same connection string, the service authenticates each login.</span><span class="sxs-lookup"><span data-stu-id="9961f-163">If multiple clients use the same connection string, the service authenticates each login.</span></span> <span data-ttu-id="9961f-164">If 10 users simultaneously connect to a database by using the same username and password, there would be 10 concurrent logins.</span><span class="sxs-lookup"><span data-stu-id="9961f-164">If 10 users simultaneously connect to a database by using the same username and password, there would be 10 concurrent logins.</span></span> <span data-ttu-id="9961f-165">This limit applies only to the duration of the login and authentication.</span><span class="sxs-lookup"><span data-stu-id="9961f-165">This limit applies only to the duration of the login and authentication.</span></span> <span data-ttu-id="9961f-166">If the same 10 users connect to the database sequentially, the number of concurrent logins would never be greater than 1.</span><span class="sxs-lookup"><span data-stu-id="9961f-166">If the same 10 users connect to the database sequentially, the number of concurrent logins would never be greater than 1.</span></span>

> [!NOTE]
> <span data-ttu-id="9961f-167">Currently, this limit does not apply to databases in elastic pools.</span><span class="sxs-lookup"><span data-stu-id="9961f-167">Currently, this limit does not apply to databases in elastic pools.</span></span>
>
>

### <a name="maximum-sessions"></a><span data-ttu-id="9961f-168">Maximum sessions</span><span class="sxs-lookup"><span data-stu-id="9961f-168">Maximum sessions</span></span>
<span data-ttu-id="9961f-169">To see the number of current active sessions, run this Transact-SQL query on your SQL database:</span><span class="sxs-lookup"><span data-stu-id="9961f-169">To see the number of current active sessions, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Sessions]
    FROM sys.dm_exec_connections

<span data-ttu-id="9961f-170">If you're analyzing an on-premises SQL Server workload, modify the query to focus on a specific database.</span><span class="sxs-lookup"><span data-stu-id="9961f-170">If you're analyzing an on-premises SQL Server workload, modify the query to focus on a specific database.</span></span> <span data-ttu-id="9961f-171">This query helps you determine possible session needs for the database if you are considering moving it to Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9961f-171">This query helps you determine possible session needs for the database if you are considering moving it to Azure SQL Database.</span></span>

    SELECT COUNT(*)  AS [Sessions]
    FROM sys.dm_exec_connections C
    INNER JOIN sys.dm_exec_sessions S ON (S.session_id = C.session_id)
    INNER JOIN sys.databases D ON (D.database_id = S.database_id)
    WHERE D.name = 'MyDatabase'

<span data-ttu-id="9961f-172">Again, these queries return a point-in-time count.</span><span class="sxs-lookup"><span data-stu-id="9961f-172">Again, these queries return a point-in-time count.</span></span> <span data-ttu-id="9961f-173">If you collect multiple samples over time, you’ll have the best understanding of your session use.</span><span class="sxs-lookup"><span data-stu-id="9961f-173">If you collect multiple samples over time, you’ll have the best understanding of your session use.</span></span>

<span data-ttu-id="9961f-174">For SQL Database analysis, you can get historical statistics on sessions by querying the [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing the **active_session_count** column.</span><span class="sxs-lookup"><span data-stu-id="9961f-174">For SQL Database analysis, you can get historical statistics on sessions by querying the [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing the **active_session_count** column.</span></span>

## <a name="monitor-resource-use"></a><span data-ttu-id="9961f-175">Monitor resource use</span><span class="sxs-lookup"><span data-stu-id="9961f-175">Monitor resource use</span></span>

<span data-ttu-id="9961f-176">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span><span class="sxs-lookup"><span data-stu-id="9961f-176">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span></span>

<span data-ttu-id="9961f-177">You can also monitor usage using these two views:</span><span class="sxs-lookup"><span data-stu-id="9961f-177">You can also monitor usage using these two views:</span></span>

* [<span data-ttu-id="9961f-178">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="9961f-178">sys.dm_db_resource_stats</span></span>](https://msdn.microsoft.com/library/dn800981.aspx)
* [<span data-ttu-id="9961f-179">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="9961f-179">sys.resource_stats</span></span>](https://msdn.microsoft.com/library/dn269979.aspx)

### <a name="sysdmdbresourcestats"></a><span data-ttu-id="9961f-180">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="9961f-180">sys.dm_db_resource_stats</span></span>
<span data-ttu-id="9961f-181">You can use the [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span><span class="sxs-lookup"><span data-stu-id="9961f-181">You can use the [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span></span> <span data-ttu-id="9961f-182">The **sys.dm_db_resource_stats** view shows recent resource use data relative to the service tier.</span><span class="sxs-lookup"><span data-stu-id="9961f-182">The **sys.dm_db_resource_stats** view shows recent resource use data relative to the service tier.</span></span> <span data-ttu-id="9961f-183">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span><span class="sxs-lookup"><span data-stu-id="9961f-183">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span></span>

<span data-ttu-id="9961f-184">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span><span class="sxs-lookup"><span data-stu-id="9961f-184">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span></span> <span data-ttu-id="9961f-185">For example, this query shows the average and maximum resource use for the current database over the past hour:</span><span class="sxs-lookup"><span data-stu-id="9961f-185">For example, this query shows the average and maximum resource use for the current database over the past hour:</span></span>

    SELECT  
        AVG(avg_cpu_percent) AS 'Average CPU use in percent',
        MAX(avg_cpu_percent) AS 'Maximum CPU use in percent',
        AVG(avg_data_io_percent) AS 'Average data I/O in percent',
        MAX(avg_data_io_percent) AS 'Maximum data I/O in percent',
        AVG(avg_log_write_percent) AS 'Average log write use in percent',
        MAX(avg_log_write_percent) AS 'Maximum log write use in percent',
        AVG(avg_memory_usage_percent) AS 'Average memory use in percent',
        MAX(avg_memory_usage_percent) AS 'Maximum memory use in percent'
    FROM sys.dm_db_resource_stats;  

<span data-ttu-id="9961f-186">For other queries, see the examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="9961f-186">For other queries, see the examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span></span>

### <a name="sysresourcestats"></a><span data-ttu-id="9961f-187">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="9961f-187">sys.resource_stats</span></span>
<span data-ttu-id="9961f-188">The [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in the **master** database has additional information that can help you monitor the performance of your SQL database at its specific service tier and performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-188">The [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in the **master** database has additional information that can help you monitor the performance of your SQL database at its specific service tier and performance level.</span></span> <span data-ttu-id="9961f-189">The data is collected every 5 minutes and is maintained for approximately 14 days.</span><span class="sxs-lookup"><span data-stu-id="9961f-189">The data is collected every 5 minutes and is maintained for approximately 14 days.</span></span> <span data-ttu-id="9961f-190">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span><span class="sxs-lookup"><span data-stu-id="9961f-190">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span></span>

<span data-ttu-id="9961f-191">The following graph shows the CPU resource use for a Premium database with the P2 performance level for each hour in a week.</span><span class="sxs-lookup"><span data-stu-id="9961f-191">The following graph shows the CPU resource use for a Premium database with the P2 performance level for each hour in a week.</span></span> <span data-ttu-id="9961f-192">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on the application.</span><span class="sxs-lookup"><span data-stu-id="9961f-192">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on the application.</span></span>

![SQL database resource use](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-performance-guidance/sql_db_resource_utilization.png)

<span data-ttu-id="9961f-194">From the data, this database currently has a peak CPU load of just over 50 percent CPU use relative to the P2 performance level (midday on Tuesday).</span><span class="sxs-lookup"><span data-stu-id="9961f-194">From the data, this database currently has a peak CPU load of just over 50 percent CPU use relative to the P2 performance level (midday on Tuesday).</span></span> <span data-ttu-id="9961f-195">If CPU is the dominant factor in the application’s resource profile, then you might decide that P2 is the right performance level to guarantee that the workload always fits.</span><span class="sxs-lookup"><span data-stu-id="9961f-195">If CPU is the dominant factor in the application’s resource profile, then you might decide that P2 is the right performance level to guarantee that the workload always fits.</span></span> <span data-ttu-id="9961f-196">If you expect an application to grow over time, it's a good idea to have an extra resource buffer so that the application doesn't ever reach the performance-level limit.</span><span class="sxs-lookup"><span data-stu-id="9961f-196">If you expect an application to grow over time, it's a good idea to have an extra resource buffer so that the application doesn't ever reach the performance-level limit.</span></span> <span data-ttu-id="9961f-197">If you increase the performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power to process requests effectively, especially in latency-sensitive environments.</span><span class="sxs-lookup"><span data-stu-id="9961f-197">If you increase the performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power to process requests effectively, especially in latency-sensitive environments.</span></span> <span data-ttu-id="9961f-198">An example is a database that supports an application that paints webpages based on the results of database calls.</span><span class="sxs-lookup"><span data-stu-id="9961f-198">An example is a database that supports an application that paints webpages based on the results of database calls.</span></span>

<span data-ttu-id="9961f-199">Other application types might interpret the same graph differently.</span><span class="sxs-lookup"><span data-stu-id="9961f-199">Other application types might interpret the same graph differently.</span></span> <span data-ttu-id="9961f-200">For example, if an application tries to process payroll data each day and has the same chart, this kind of "batch job" model might do fine at a P1 performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-200">For example, if an application tries to process payroll data each day and has the same chart, this kind of "batch job" model might do fine at a P1 performance level.</span></span> <span data-ttu-id="9961f-201">The P1 performance level has 100 DTUs compared to 200 DTUs at the P2 performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-201">The P1 performance level has 100 DTUs compared to 200 DTUs at the P2 performance level.</span></span> <span data-ttu-id="9961f-202">The P1 performance level provides half the performance of the P2 performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-202">The P1 performance level provides half the performance of the P2 performance level.</span></span> <span data-ttu-id="9961f-203">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span><span class="sxs-lookup"><span data-stu-id="9961f-203">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span></span> <span data-ttu-id="9961f-204">If the application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours to finish, if it gets done today.</span><span class="sxs-lookup"><span data-stu-id="9961f-204">If the application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours to finish, if it gets done today.</span></span> <span data-ttu-id="9961f-205">An application in this category probably can use a P1 performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-205">An application in this category probably can use a P1 performance level.</span></span> <span data-ttu-id="9961f-206">You can take advantage of the fact that there are periods of time during the day when resource use is lower, so that any "big peak" might spill over into one of the troughs later in the day.</span><span class="sxs-lookup"><span data-stu-id="9961f-206">You can take advantage of the fact that there are periods of time during the day when resource use is lower, so that any "big peak" might spill over into one of the troughs later in the day.</span></span> <span data-ttu-id="9961f-207">The P1 performance level might be good for that kind of application (and save money), as long as the jobs can finish on time each day.</span><span class="sxs-lookup"><span data-stu-id="9961f-207">The P1 performance level might be good for that kind of application (and save money), as long as the jobs can finish on time each day.</span></span>

<span data-ttu-id="9961f-208">Azure SQL Database exposes consumed resource information for each active database in the **sys.resource_stats** view of the **master** database in each server.</span><span class="sxs-lookup"><span data-stu-id="9961f-208">Azure SQL Database exposes consumed resource information for each active database in the **sys.resource_stats** view of the **master** database in each server.</span></span> <span data-ttu-id="9961f-209">The data in the table is aggregated for 5-minute intervals.</span><span class="sxs-lookup"><span data-stu-id="9961f-209">The data in the table is aggregated for 5-minute intervals.</span></span> <span data-ttu-id="9961f-210">With the Basic, Standard, Premium, and Premium RS service tiers, the data can take more than 5 minutes to appear in the table, so this data is more useful for historical analysis rather than near-real-time analysis.</span><span class="sxs-lookup"><span data-stu-id="9961f-210">With the Basic, Standard, Premium, and Premium RS service tiers, the data can take more than 5 minutes to appear in the table, so this data is more useful for historical analysis rather than near-real-time analysis.</span></span> <span data-ttu-id="9961f-211">Query the **sys.resource_stats** view to see the recent history of a database and to validate whether the reservation you chose delivered the performance you want when needed.</span><span class="sxs-lookup"><span data-stu-id="9961f-211">Query the **sys.resource_stats** view to see the recent history of a database and to validate whether the reservation you chose delivered the performance you want when needed.</span></span>

> [!NOTE]
> <span data-ttu-id="9961f-212">You must be connected to the **master** database of your logical SQL database server to query **sys.resource_stats** in the following examples.</span><span class="sxs-lookup"><span data-stu-id="9961f-212">You must be connected to the **master** database of your logical SQL database server to query **sys.resource_stats** in the following examples.</span></span>
>
>

<span data-ttu-id="9961f-213">This example shows you how the data in this view is exposed:</span><span class="sxs-lookup"><span data-stu-id="9961f-213">This example shows you how the data in this view is exposed:</span></span>

    SELECT TOP 10 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![The sys.resource_stats catalog view](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-performance-guidance/sys_resource_stats.png)

<span data-ttu-id="9961f-215">The next example shows you different ways that you can use the **sys.resource_stats** catalog view to get information about how your SQL database uses resources:</span><span class="sxs-lookup"><span data-stu-id="9961f-215">The next example shows you different ways that you can use the **sys.resource_stats** catalog view to get information about how your SQL database uses resources:</span></span>

1. <span data-ttu-id="9961f-216">To look at the past week’s resource use for the database userdb1, you can run this query:</span><span class="sxs-lookup"><span data-stu-id="9961f-216">To look at the past week’s resource use for the database userdb1, you can run this query:</span></span>

        SELECT *
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND
              start_time > DATEADD(day, -7, GETDATE())
        ORDER BY start_time DESC;
2. <span data-ttu-id="9961f-217">To evaluate how well your workload fits the performance level, you need to drill down into each aspect of the resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span><span class="sxs-lookup"><span data-stu-id="9961f-217">To evaluate how well your workload fits the performance level, you need to drill down into each aspect of the resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span></span> <span data-ttu-id="9961f-218">Here's a revised query using **sys.resource_stats** to report the average and maximum values of these resource metrics:</span><span class="sxs-lookup"><span data-stu-id="9961f-218">Here's a revised query using **sys.resource_stats** to report the average and maximum values of these resource metrics:</span></span>

        SELECT
            avg(avg_cpu_percent) AS 'Average CPU use in percent',
            max(avg_cpu_percent) AS 'Maximum CPU use in percent',
            avg(avg_data_io_percent) AS 'Average physical data I/O use in percent',
            max(avg_data_io_percent) AS 'Maximum physical data I/O use in percent',
            avg(avg_log_write_percent) AS 'Average log write use in percent',
            max(avg_log_write_percent) AS 'Maximum log write use in percent',
            avg(max_session_percent) AS 'Average % of sessions',
            max(max_session_percent) AS 'Maximum % of sessions',
            avg(max_worker_percent) AS 'Average % of workers',
            max(max_worker_percent) AS 'Maximum % of workers'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
3. <span data-ttu-id="9961f-219">With this information about the average and maximum values of each resource metric, you can assess how well your workload fits into the performance level you chose.</span><span class="sxs-lookup"><span data-stu-id="9961f-219">With this information about the average and maximum values of each resource metric, you can assess how well your workload fits into the performance level you chose.</span></span> <span data-ttu-id="9961f-220">Usually, average values from **sys.resource_stats** give you a good baseline to use against the target size.</span><span class="sxs-lookup"><span data-stu-id="9961f-220">Usually, average values from **sys.resource_stats** give you a good baseline to use against the target size.</span></span> <span data-ttu-id="9961f-221">It should be your primary measurement stick.</span><span class="sxs-lookup"><span data-stu-id="9961f-221">It should be your primary measurement stick.</span></span> <span data-ttu-id="9961f-222">For an example, you might be using the Standard service tier with S2 performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-222">For an example, you might be using the Standard service tier with S2 performance level.</span></span> <span data-ttu-id="9961f-223">The average use percentages for CPU and I/O reads and writes are below 40 percent, the average number of workers is below 50, and the average number of sessions is below 200.</span><span class="sxs-lookup"><span data-stu-id="9961f-223">The average use percentages for CPU and I/O reads and writes are below 40 percent, the average number of workers is below 50, and the average number of sessions is below 200.</span></span> <span data-ttu-id="9961f-224">Your workload might fit into the S1 performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-224">Your workload might fit into the S1 performance level.</span></span> <span data-ttu-id="9961f-225">It's easy to see whether your database fits in the worker and session limits.</span><span class="sxs-lookup"><span data-stu-id="9961f-225">It's easy to see whether your database fits in the worker and session limits.</span></span> <span data-ttu-id="9961f-226">To see whether a database fits into a lower performance level with regards to CPU, reads, and writes, divide the DTU number of the lower performance level by the DTU number of your current performance level, and then multiply the result by 100:</span><span class="sxs-lookup"><span data-stu-id="9961f-226">To see whether a database fits into a lower performance level with regards to CPU, reads, and writes, divide the DTU number of the lower performance level by the DTU number of your current performance level, and then multiply the result by 100:</span></span>

    <span data-ttu-id="9961f-227">**S1 DTU / S2 DTU \* 100 = 20 / 50 \* 100 = 40**</span><span class="sxs-lookup"><span data-stu-id="9961f-227">**S1 DTU / S2 DTU \* 100 = 20 / 50 \* 100 = 40**</span></span>

    <span data-ttu-id="9961f-228">The result is the relative performance difference between the two performance levels in percentage.</span><span class="sxs-lookup"><span data-stu-id="9961f-228">The result is the relative performance difference between the two performance levels in percentage.</span></span> <span data-ttu-id="9961f-229">If your resource use doesn't exceed this amount, your workload might fit into the lower performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-229">If your resource use doesn't exceed this amount, your workload might fit into the lower performance level.</span></span> <span data-ttu-id="9961f-230">However, you need to look at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into the lower performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-230">However, you need to look at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into the lower performance level.</span></span> <span data-ttu-id="9961f-231">The following query outputs the fit percentage per resource dimension, based on the threshold of 40 percent that we calculated in this example:</span><span class="sxs-lookup"><span data-stu-id="9961f-231">The following query outputs the fit percentage per resource dimension, based on the threshold of 40 percent that we calculated in this example:</span></span>

        SELECT
            (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log Write Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical Data IO Fit Percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());

    <span data-ttu-id="9961f-232">Based on your database service level objective (SLO), you can decide whether your workload fits into the lower performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-232">Based on your database service level objective (SLO), you can decide whether your workload fits into the lower performance level.</span></span> <span data-ttu-id="9961f-233">If your database workload SLO is 99.9 percent and the preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into the lower performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-233">If your database workload SLO is 99.9 percent and the preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into the lower performance level.</span></span>

    <span data-ttu-id="9961f-234">Looking at the fit percentage also gives you insight into whether you should move to the next higher performance level to meet your SLO.</span><span class="sxs-lookup"><span data-stu-id="9961f-234">Looking at the fit percentage also gives you insight into whether you should move to the next higher performance level to meet your SLO.</span></span> <span data-ttu-id="9961f-235">For example, userdb1 shows the following CPU use for the past week:</span><span class="sxs-lookup"><span data-stu-id="9961f-235">For example, userdb1 shows the following CPU use for the past week:</span></span>

   | <span data-ttu-id="9961f-236">Average CPU percent</span><span class="sxs-lookup"><span data-stu-id="9961f-236">Average CPU percent</span></span> | <span data-ttu-id="9961f-237">Maximum CPU percent</span><span class="sxs-lookup"><span data-stu-id="9961f-237">Maximum CPU percent</span></span> |
   | --- | --- |
   | <span data-ttu-id="9961f-238">24.5</span><span class="sxs-lookup"><span data-stu-id="9961f-238">24.5</span></span> |<span data-ttu-id="9961f-239">100.00</span><span class="sxs-lookup"><span data-stu-id="9961f-239">100.00</span></span> |

    <span data-ttu-id="9961f-240">The average CPU is about a quarter of the limit of the performance level, which would fit well into the performance level of the database.</span><span class="sxs-lookup"><span data-stu-id="9961f-240">The average CPU is about a quarter of the limit of the performance level, which would fit well into the performance level of the database.</span></span> <span data-ttu-id="9961f-241">But, the maximum value shows that the database reaches the limit of the performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-241">But, the maximum value shows that the database reaches the limit of the performance level.</span></span> <span data-ttu-id="9961f-242">Do you need to move to the next higher performance level?</span><span class="sxs-lookup"><span data-stu-id="9961f-242">Do you need to move to the next higher performance level?</span></span> <span data-ttu-id="9961f-243">Look at how many times your workload reaches 100 percent, and then compare it to your database workload SLO.</span><span class="sxs-lookup"><span data-stu-id="9961f-243">Look at how many times your workload reaches 100 percent, and then compare it to your database workload SLO.</span></span>

        SELECT
        (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log write fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical data I/O fit percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());

    <span data-ttu-id="9961f-244">If this query returns a value less than 99.9 percent for any of the three resource dimensions, consider either moving to the next higher performance level or use application-tuning techniques to reduce the load on the SQL database.</span><span class="sxs-lookup"><span data-stu-id="9961f-244">If this query returns a value less than 99.9 percent for any of the three resource dimensions, consider either moving to the next higher performance level or use application-tuning techniques to reduce the load on the SQL database.</span></span>
4. <span data-ttu-id="9961f-245">This exercise also considers your projected workload increase in the future.</span><span class="sxs-lookup"><span data-stu-id="9961f-245">This exercise also considers your projected workload increase in the future.</span></span>

## <a name="tune-your-application"></a><span data-ttu-id="9961f-246">Tune your application</span><span class="sxs-lookup"><span data-stu-id="9961f-246">Tune your application</span></span>
<span data-ttu-id="9961f-247">In traditional on-premises SQL Server, the process of initial capacity planning often is separated from the process of running an application in production.</span><span class="sxs-lookup"><span data-stu-id="9961f-247">In traditional on-premises SQL Server, the process of initial capacity planning often is separated from the process of running an application in production.</span></span> <span data-ttu-id="9961f-248">Hardware and product licenses are purchased first, and performance tuning is done afterward.</span><span class="sxs-lookup"><span data-stu-id="9961f-248">Hardware and product licenses are purchased first, and performance tuning is done afterward.</span></span> <span data-ttu-id="9961f-249">When you use Azure SQL Database, it's a good idea to interweave the process of running an application and tuning it.</span><span class="sxs-lookup"><span data-stu-id="9961f-249">When you use Azure SQL Database, it's a good idea to interweave the process of running an application and tuning it.</span></span> <span data-ttu-id="9961f-250">With the model of paying for capacity on demand, you can tune your application to use the minimum resources needed now, instead of overprovisioning on hardware based on guesses of future growth plans for an application, which often are incorrect.</span><span class="sxs-lookup"><span data-stu-id="9961f-250">With the model of paying for capacity on demand, you can tune your application to use the minimum resources needed now, instead of overprovisioning on hardware based on guesses of future growth plans for an application, which often are incorrect.</span></span> <span data-ttu-id="9961f-251">Some customers might choose not to tune an application, and instead choose to overprovision hardware resources.</span><span class="sxs-lookup"><span data-stu-id="9961f-251">Some customers might choose not to tune an application, and instead choose to overprovision hardware resources.</span></span> <span data-ttu-id="9961f-252">This approach might be a good idea if you don't want to change a key application during a busy period.</span><span class="sxs-lookup"><span data-stu-id="9961f-252">This approach might be a good idea if you don't want to change a key application during a busy period.</span></span> <span data-ttu-id="9961f-253">But, tuning an application can minimize resource requirements and lower monthly bills when you use the service tiers in Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9961f-253">But, tuning an application can minimize resource requirements and lower monthly bills when you use the service tiers in Azure SQL Database.</span></span>

### <a name="application-characteristics"></a><span data-ttu-id="9961f-254">Application characteristics</span><span class="sxs-lookup"><span data-stu-id="9961f-254">Application characteristics</span></span>
<span data-ttu-id="9961f-255">Although Azure SQL Database service tiers are designed to improve performance stability and predictability for an application, some best practices can help you tune your application to better take advantage of the resources at a performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-255">Although Azure SQL Database service tiers are designed to improve performance stability and predictability for an application, some best practices can help you tune your application to better take advantage of the resources at a performance level.</span></span> <span data-ttu-id="9961f-256">Although many applications have significant performance gains simply by switching to a higher performance level or service tier, some applications need additional tuning to benefit from a higher level of service.</span><span class="sxs-lookup"><span data-stu-id="9961f-256">Although many applications have significant performance gains simply by switching to a higher performance level or service tier, some applications need additional tuning to benefit from a higher level of service.</span></span> <span data-ttu-id="9961f-257">For increased performance, consider additional application tuning for applications that have these characteristics:</span><span class="sxs-lookup"><span data-stu-id="9961f-257">For increased performance, consider additional application tuning for applications that have these characteristics:</span></span>

* <span data-ttu-id="9961f-258">**Applications that have slow performance because of "chatty" behavior**.</span><span class="sxs-lookup"><span data-stu-id="9961f-258">**Applications that have slow performance because of "chatty" behavior**.</span></span> <span data-ttu-id="9961f-259">Chatty applications make excessive data access operations that are sensitive to network latency.</span><span class="sxs-lookup"><span data-stu-id="9961f-259">Chatty applications make excessive data access operations that are sensitive to network latency.</span></span> <span data-ttu-id="9961f-260">You might need to modify these kinds of applications to reduce the number of data access operations to the SQL database.</span><span class="sxs-lookup"><span data-stu-id="9961f-260">You might need to modify these kinds of applications to reduce the number of data access operations to the SQL database.</span></span> <span data-ttu-id="9961f-261">For example, you might improve application performance by using techniques like batching ad-hoc queries or moving the queries to stored procedures.</span><span class="sxs-lookup"><span data-stu-id="9961f-261">For example, you might improve application performance by using techniques like batching ad-hoc queries or moving the queries to stored procedures.</span></span> <span data-ttu-id="9961f-262">For more information, see [Batch queries](#batch-queries).</span><span class="sxs-lookup"><span data-stu-id="9961f-262">For more information, see [Batch queries](#batch-queries).</span></span>
* <span data-ttu-id="9961f-263">**Databases with an intensive workload that can't be supported by an entire single machine**.</span><span class="sxs-lookup"><span data-stu-id="9961f-263">**Databases with an intensive workload that can't be supported by an entire single machine**.</span></span> <span data-ttu-id="9961f-264">Databases that exceed the resources of the highest Premium performance level might benefit from scaling out the workload.</span><span class="sxs-lookup"><span data-stu-id="9961f-264">Databases that exceed the resources of the highest Premium performance level might benefit from scaling out the workload.</span></span> <span data-ttu-id="9961f-265">For more information, see [Cross-database sharding](#cross-database-sharding) and [Functional partitioning](#functional-partitioning).</span><span class="sxs-lookup"><span data-stu-id="9961f-265">For more information, see [Cross-database sharding](#cross-database-sharding) and [Functional partitioning](#functional-partitioning).</span></span>
* <span data-ttu-id="9961f-266">**Applications that have suboptimal queries**.</span><span class="sxs-lookup"><span data-stu-id="9961f-266">**Applications that have suboptimal queries**.</span></span> <span data-ttu-id="9961f-267">Applications, especially those in the data access layer, that have poorly tuned queries might not benefit from a higher performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-267">Applications, especially those in the data access layer, that have poorly tuned queries might not benefit from a higher performance level.</span></span> <span data-ttu-id="9961f-268">This includes queries that lack a WHERE clause, have missing indexes, or have outdated statistics.</span><span class="sxs-lookup"><span data-stu-id="9961f-268">This includes queries that lack a WHERE clause, have missing indexes, or have outdated statistics.</span></span> <span data-ttu-id="9961f-269">These applications benefit from standard query performance-tuning techniques.</span><span class="sxs-lookup"><span data-stu-id="9961f-269">These applications benefit from standard query performance-tuning techniques.</span></span> <span data-ttu-id="9961f-270">For more information, see [Missing indexes](#missing-indexes) and [Query tuning and hinting](#query-tuning-and-hinting).</span><span class="sxs-lookup"><span data-stu-id="9961f-270">For more information, see [Missing indexes](#missing-indexes) and [Query tuning and hinting](#query-tuning-and-hinting).</span></span>
* <span data-ttu-id="9961f-271">**Applications that have suboptimal data access design**.</span><span class="sxs-lookup"><span data-stu-id="9961f-271">**Applications that have suboptimal data access design**.</span></span> <span data-ttu-id="9961f-272">Applications that have inherent data access concurrency issues, for example deadlocking, might not benefit from a higher performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-272">Applications that have inherent data access concurrency issues, for example deadlocking, might not benefit from a higher performance level.</span></span> <span data-ttu-id="9961f-273">Consider reducing round trips against the Azure SQL Database by caching data on the client side with the Azure Caching service or another caching technology.</span><span class="sxs-lookup"><span data-stu-id="9961f-273">Consider reducing round trips against the Azure SQL Database by caching data on the client side with the Azure Caching service or another caching technology.</span></span> <span data-ttu-id="9961f-274">See [Application tier caching](#application-tier-caching).</span><span class="sxs-lookup"><span data-stu-id="9961f-274">See [Application tier caching](#application-tier-caching).</span></span>

## <a name="tuning-techniques"></a><span data-ttu-id="9961f-275">Tuning techniques</span><span class="sxs-lookup"><span data-stu-id="9961f-275">Tuning techniques</span></span>
<span data-ttu-id="9961f-276">In this section, we look at some techniques that you can use to tune Azure SQL Database to gain the best performance for your application and run it at the lowest possible performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-276">In this section, we look at some techniques that you can use to tune Azure SQL Database to gain the best performance for your application and run it at the lowest possible performance level.</span></span> <span data-ttu-id="9961f-277">Some of these techniques match traditional SQL Server tuning best practices, but others are specific to Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9961f-277">Some of these techniques match traditional SQL Server tuning best practices, but others are specific to Azure SQL Database.</span></span> <span data-ttu-id="9961f-278">In some cases, you can examine the consumed resources for a database to find areas to further tune and extend traditional SQL Server techniques to work in Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9961f-278">In some cases, you can examine the consumed resources for a database to find areas to further tune and extend traditional SQL Server techniques to work in Azure SQL Database.</span></span>

### <a name="azure-portal-tools"></a><span data-ttu-id="9961f-279">Azure portal tools</span><span class="sxs-lookup"><span data-stu-id="9961f-279">Azure portal tools</span></span>
<span data-ttu-id="9961f-280">The following tools in the Azure portal can help you analyze and fix performance issues with your SQL database:</span><span class="sxs-lookup"><span data-stu-id="9961f-280">The following tools in the Azure portal can help you analyze and fix performance issues with your SQL database:</span></span>

* [<span data-ttu-id="9961f-281">Query Performance Insight</span><span class="sxs-lookup"><span data-stu-id="9961f-281">Query Performance Insight</span></span>](sql-database-query-performance.md)
* [<span data-ttu-id="9961f-282">SQL Database Advisor</span><span class="sxs-lookup"><span data-stu-id="9961f-282">SQL Database Advisor</span></span>](sql-database-advisor.md)

<span data-ttu-id="9961f-283">The Azure portal has more information about both of these tools and how to use them.</span><span class="sxs-lookup"><span data-stu-id="9961f-283">The Azure portal has more information about both of these tools and how to use them.</span></span> <span data-ttu-id="9961f-284">To efficiently diagnose and correct problems, we recommend that you first try the tools in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="9961f-284">To efficiently diagnose and correct problems, we recommend that you first try the tools in the Azure portal.</span></span> <span data-ttu-id="9961f-285">We recommend that you use the manual tuning approaches that we discuss next, for missing indexes and query tuning, in special cases.</span><span class="sxs-lookup"><span data-stu-id="9961f-285">We recommend that you use the manual tuning approaches that we discuss next, for missing indexes and query tuning, in special cases.</span></span>

### <a name="missing-indexes"></a><span data-ttu-id="9961f-286">Missing indexes</span><span class="sxs-lookup"><span data-stu-id="9961f-286">Missing indexes</span></span>
<span data-ttu-id="9961f-287">A common problem in OLTP database performance relates to the physical database design.</span><span class="sxs-lookup"><span data-stu-id="9961f-287">A common problem in OLTP database performance relates to the physical database design.</span></span> <span data-ttu-id="9961f-288">Often, database schemas are designed and shipped without testing at scale (either in load or in data volume).</span><span class="sxs-lookup"><span data-stu-id="9961f-288">Often, database schemas are designed and shipped without testing at scale (either in load or in data volume).</span></span> <span data-ttu-id="9961f-289">Unfortunately, the performance of a query plan might be acceptable on a small scale but degrade substantially under production-level data volumes.</span><span class="sxs-lookup"><span data-stu-id="9961f-289">Unfortunately, the performance of a query plan might be acceptable on a small scale but degrade substantially under production-level data volumes.</span></span> <span data-ttu-id="9961f-290">The most common source of this issue is the lack of appropriate indexes to satisfy filters or other restrictions in a query.</span><span class="sxs-lookup"><span data-stu-id="9961f-290">The most common source of this issue is the lack of appropriate indexes to satisfy filters or other restrictions in a query.</span></span> <span data-ttu-id="9961f-291">Often, missing indexes manifests as a table scan when an index seek could suffice.</span><span class="sxs-lookup"><span data-stu-id="9961f-291">Often, missing indexes manifests as a table scan when an index seek could suffice.</span></span>

<span data-ttu-id="9961f-292">In this example, the selected query plan uses a scan when a seek would suffice:</span><span class="sxs-lookup"><span data-stu-id="9961f-292">In this example, the selected query plan uses a scan when a seek would suffice:</span></span>

    DROP TABLE dbo.missingindex;
    CREATE TABLE dbo.missingindex (col1 INT IDENTITY PRIMARY KEY, col2 INT);
    DECLARE @a int = 0;
    SET NOCOUNT ON;
    BEGIN TRANSACTION
    WHILE @a < 20000
    BEGIN
        INSERT INTO dbo.missingindex(col2) VALUES (@a);
        SET @a += 1;
    END
    COMMIT TRANSACTION;
    GO
    SELECT m1.col1
    FROM dbo.missingindex m1 INNER JOIN dbo.missingindex m2 ON(m1.col1=m2.col1)
    WHERE m1.col2 = 4;

![A query plan with missing indexes](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-performance-guidance/query_plan_missing_indexes.png)

<span data-ttu-id="9961f-294">Azure SQL Database can help you find and fix common missing index conditions.</span><span class="sxs-lookup"><span data-stu-id="9961f-294">Azure SQL Database can help you find and fix common missing index conditions.</span></span> <span data-ttu-id="9961f-295">DMVs that are built into Azure SQL Database look at query compilations in which an index would significantly reduce the estimated cost to run a query.</span><span class="sxs-lookup"><span data-stu-id="9961f-295">DMVs that are built into Azure SQL Database look at query compilations in which an index would significantly reduce the estimated cost to run a query.</span></span> <span data-ttu-id="9961f-296">During query execution, SQL Database tracks how often each query plan is executed, and tracks the estimated gap between the executing query plan and the imagined one where that index existed.</span><span class="sxs-lookup"><span data-stu-id="9961f-296">During query execution, SQL Database tracks how often each query plan is executed, and tracks the estimated gap between the executing query plan and the imagined one where that index existed.</span></span> <span data-ttu-id="9961f-297">You can use these DMVs to quickly guess which changes to your physical database design might improve overall workload cost for a database and its real workload.</span><span class="sxs-lookup"><span data-stu-id="9961f-297">You can use these DMVs to quickly guess which changes to your physical database design might improve overall workload cost for a database and its real workload.</span></span>

<span data-ttu-id="9961f-298">You can use this query to evaluate potential missing indexes:</span><span class="sxs-lookup"><span data-stu-id="9961f-298">You can use this query to evaluate potential missing indexes:</span></span>

    SELECT CONVERT (varchar, getdate(), 126) AS runtime,
        mig.index_group_handle, mid.index_handle,
        CONVERT (decimal (28,1), migs.avg_total_user_cost * migs.avg_user_impact *
                (migs.user_seeks + migs.user_scans)) AS improvement_measure,
        'CREATE INDEX missing_index_' + CONVERT (varchar, mig.index_group_handle) + '_' +
                  CONVERT (varchar, mid.index_handle) + ' ON ' + mid.statement + '
                  (' + ISNULL (mid.equality_columns,'')
                  + CASE WHEN mid.equality_columns IS NOT NULL
                              AND mid.inequality_columns IS NOT NULL
                         THEN ',' ELSE '' END + ISNULL (mid.inequality_columns, '')
                  + ')'
                  + ISNULL (' INCLUDE (' + mid.included_columns + ')', '') AS create_index_statement,
        migs.*,
        mid.database_id,
        mid.[object_id]
    FROM sys.dm_db_missing_index_groups AS mig
    INNER JOIN sys.dm_db_missing_index_group_stats AS migs
        ON migs.group_handle = mig.index_group_handle
    INNER JOIN sys.dm_db_missing_index_details AS mid
        ON mig.index_handle = mid.index_handle
    ORDER BY migs.avg_total_user_cost * migs.avg_user_impact * (migs.user_seeks + migs.user_scans) DESC

<span data-ttu-id="9961f-299">In this example, the query resulted in this suggestion:</span><span class="sxs-lookup"><span data-stu-id="9961f-299">In this example, the query resulted in this suggestion:</span></span>

    CREATE INDEX missing_index_5006_5005 ON [dbo].[missingindex] ([col2])  

<span data-ttu-id="9961f-300">After it's created, that same SELECT statement picks a different plan, which uses a seek instead of a scan, and then executes the plan more efficiently:</span><span class="sxs-lookup"><span data-stu-id="9961f-300">After it's created, that same SELECT statement picks a different plan, which uses a seek instead of a scan, and then executes the plan more efficiently:</span></span>

![A query plan with corrected indexes](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-performance-guidance/query_plan_corrected_indexes.png)

<span data-ttu-id="9961f-302">The key insight is that the I/O capacity of a shared, commodity system is more limited than that of a dedicated server machine.</span><span class="sxs-lookup"><span data-stu-id="9961f-302">The key insight is that the I/O capacity of a shared, commodity system is more limited than that of a dedicated server machine.</span></span> <span data-ttu-id="9961f-303">There's a premium on minimizing unnecessary I/O to take maximum advantage of the system in the DTU of each performance level of the Azure SQL Database service tiers.</span><span class="sxs-lookup"><span data-stu-id="9961f-303">There's a premium on minimizing unnecessary I/O to take maximum advantage of the system in the DTU of each performance level of the Azure SQL Database service tiers.</span></span> <span data-ttu-id="9961f-304">Appropriate physical database design choices can significantly improve the latency for individual queries, improve the throughput of concurrent requests handled per scale unit, and minimize the costs required to satisfy the query.</span><span class="sxs-lookup"><span data-stu-id="9961f-304">Appropriate physical database design choices can significantly improve the latency for individual queries, improve the throughput of concurrent requests handled per scale unit, and minimize the costs required to satisfy the query.</span></span> <span data-ttu-id="9961f-305">For more information about the missing index DMVs, see [sys.dm_db_missing_index_details](https://msdn.microsoft.com/library/ms345434.aspx).</span><span class="sxs-lookup"><span data-stu-id="9961f-305">For more information about the missing index DMVs, see [sys.dm_db_missing_index_details](https://msdn.microsoft.com/library/ms345434.aspx).</span></span>

### <a name="query-tuning-and-hinting"></a><span data-ttu-id="9961f-306">Query tuning and hinting</span><span class="sxs-lookup"><span data-stu-id="9961f-306">Query tuning and hinting</span></span>
<span data-ttu-id="9961f-307">The query optimizer in Azure SQL Database is similar to the traditional SQL Server query optimizer.</span><span class="sxs-lookup"><span data-stu-id="9961f-307">The query optimizer in Azure SQL Database is similar to the traditional SQL Server query optimizer.</span></span> <span data-ttu-id="9961f-308">Most of the best practices for tuning queries and understanding the reasoning model limitations for the query optimizer also apply to Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9961f-308">Most of the best practices for tuning queries and understanding the reasoning model limitations for the query optimizer also apply to Azure SQL Database.</span></span> <span data-ttu-id="9961f-309">If you tune queries in Azure SQL Database, you might get the additional benefit of reducing aggregate resource demands.</span><span class="sxs-lookup"><span data-stu-id="9961f-309">If you tune queries in Azure SQL Database, you might get the additional benefit of reducing aggregate resource demands.</span></span> <span data-ttu-id="9961f-310">Your application might be able to run at a lower cost than an untuned equivalent because it can run at a lower performance level.</span><span class="sxs-lookup"><span data-stu-id="9961f-310">Your application might be able to run at a lower cost than an untuned equivalent because it can run at a lower performance level.</span></span>

<span data-ttu-id="9961f-311">An example that is common in SQL Server and which also applies to Azure SQL Database is how the query optimizer "sniffs" parameters.</span><span class="sxs-lookup"><span data-stu-id="9961f-311">An example that is common in SQL Server and which also applies to Azure SQL Database is how the query optimizer "sniffs" parameters.</span></span> <span data-ttu-id="9961f-312">During compilation, the query optimizer evaluates the current value of a parameter to determine whether it can generate a more optimal query plan.</span><span class="sxs-lookup"><span data-stu-id="9961f-312">During compilation, the query optimizer evaluates the current value of a parameter to determine whether it can generate a more optimal query plan.</span></span> <span data-ttu-id="9961f-313">Although this strategy often can lead to a query plan that is significantly faster than a plan compiled without known parameter values, currently it works imperfectly both in SQL Server and in Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9961f-313">Although this strategy often can lead to a query plan that is significantly faster than a plan compiled without known parameter values, currently it works imperfectly both in SQL Server and in Azure SQL Database.</span></span> <span data-ttu-id="9961f-314">Sometimes the parameter is not sniffed, and sometimes the parameter is sniffed but the generated plan is suboptimal for the full set of parameter values in a workload.</span><span class="sxs-lookup"><span data-stu-id="9961f-314">Sometimes the parameter is not sniffed, and sometimes the parameter is sniffed but the generated plan is suboptimal for the full set of parameter values in a workload.</span></span> <span data-ttu-id="9961f-315">Microsoft includes query hints (directives) so that you can specify intent more deliberately and override the default behavior of parameter sniffing.</span><span class="sxs-lookup"><span data-stu-id="9961f-315">Microsoft includes query hints (directives) so that you can specify intent more deliberately and override the default behavior of parameter sniffing.</span></span> <span data-ttu-id="9961f-316">Often, if you use hints, you can fix cases in which the default SQL Server or Azure SQL Database behavior is imperfect for a specific customer workload.</span><span class="sxs-lookup"><span data-stu-id="9961f-316">Often, if you use hints, you can fix cases in which the default SQL Server or Azure SQL Database behavior is imperfect for a specific customer workload.</span></span>

<span data-ttu-id="9961f-317">The next example demonstrates how the query processor can generate a plan that is suboptimal both for performance and resource requirements.</span><span class="sxs-lookup"><span data-stu-id="9961f-317">The next example demonstrates how the query processor can generate a plan that is suboptimal both for performance and resource requirements.</span></span> <span data-ttu-id="9961f-318">This example also shows that if you use a query hint, you can reduce query run time and resource requirements for your SQL database:</span><span class="sxs-lookup"><span data-stu-id="9961f-318">This example also shows that if you use a query hint, you can reduce query run time and resource requirements for your SQL database:</span></span>

    DROP TABLE psptest1;
    CREATE TABLE psptest1(col1 int primary key identity, col2 int, col3 binary(200));

    DECLARE @a int = 0;
    SET NOCOUNT ON;
    BEGIN TRANSACTION
    WHILE @a < 20000
    BEGIN
        INSERT INTO psptest1(col2) values (1);
        INSERT INTO psptest1(col2) values (@a);
        SET @a += 1;
    END
    COMMIT TRANSACTION
    CREATE INDEX i1 on psptest1(col2);
    GO

    CREATE PROCEDURE psp1 (@param1 int)
    AS
    BEGIN
        INSERT INTO t1 SELECT * FROM psptest1
        WHERE col2 = @param1
        ORDER BY col2;
    END
    GO

    CREATE PROCEDURE psp2 (@param2 int)
    AS
    BEGIN
        INSERT INTO t1 SELECT * FROM psptest1 WHERE col2 = @param2
        ORDER BY col2
        OPTION (OPTIMIZE FOR (@param2 UNKNOWN))
    END
    GO

    CREATE TABLE t1 (col1 int primary key, col2 int, col3 binary(200));
    GO

<span data-ttu-id="9961f-319">The setup code creates a table that has skewed data distribution.</span><span class="sxs-lookup"><span data-stu-id="9961f-319">The setup code creates a table that has skewed data distribution.</span></span> <span data-ttu-id="9961f-320">The optimal query plan differs based on which parameter is selected.</span><span class="sxs-lookup"><span data-stu-id="9961f-320">The optimal query plan differs based on which parameter is selected.</span></span> <span data-ttu-id="9961f-321">Unfortunately, the plan caching behavior doesn't always recompile the query based on the most common parameter value.</span><span class="sxs-lookup"><span data-stu-id="9961f-321">Unfortunately, the plan caching behavior doesn't always recompile the query based on the most common parameter value.</span></span> <span data-ttu-id="9961f-322">So, it's possible for a suboptimal plan to be cached and used for many values, even when a different plan might be a better plan choice on average.</span><span class="sxs-lookup"><span data-stu-id="9961f-322">So, it's possible for a suboptimal plan to be cached and used for many values, even when a different plan might be a better plan choice on average.</span></span> <span data-ttu-id="9961f-323">Then the query plan creates two stored procedures that are identical, except that one has a special query hint.</span><span class="sxs-lookup"><span data-stu-id="9961f-323">Then the query plan creates two stored procedures that are identical, except that one has a special query hint.</span></span>

<span data-ttu-id="9961f-324">**Example, part 1**</span><span class="sxs-lookup"><span data-stu-id="9961f-324">**Example, part 1**</span></span>

    -- Prime Procedure Cache with scan plan
    EXEC psp1 @param1=1;
    TRUNCATE TABLE t1;

    -- Iterate multiple times to show the performance difference
    DECLARE @i int = 0;
    WHILE @i < 1000
    BEGIN
        EXEC psp1 @param1=2;
        TRUNCATE TABLE t1;
        SET @i += 1;
    END

<span data-ttu-id="9961f-325">**Example, part 2**</span><span class="sxs-lookup"><span data-stu-id="9961f-325">**Example, part 2**</span></span>

<span data-ttu-id="9961f-326">(We recommend that you wait at least 10 minutes before you begin part 2 of the example, so that the results are distinct in the resulting telemetry data.)</span><span class="sxs-lookup"><span data-stu-id="9961f-326">(We recommend that you wait at least 10 minutes before you begin part 2 of the example, so that the results are distinct in the resulting telemetry data.)</span></span>

    EXEC psp2 @param2=1;
    TRUNCATE TABLE t1;

    DECLARE @i int = 0;
    WHILE @i < 1000
    BEGIN
        EXEC psp2 @param2=2;
        TRUNCATE TABLE t1;
        SET @i += 1;
    END

<span data-ttu-id="9961f-327">Each part of this example attempts to run a parameterized insert statement 1,000 times (to generate a sufficient load to use as a test data set).</span><span class="sxs-lookup"><span data-stu-id="9961f-327">Each part of this example attempts to run a parameterized insert statement 1,000 times (to generate a sufficient load to use as a test data set).</span></span> <span data-ttu-id="9961f-328">When it executes stored procedures, the query processor examines the parameter value that is passed to the procedure during its first compilation (parameter "sniffing").</span><span class="sxs-lookup"><span data-stu-id="9961f-328">When it executes stored procedures, the query processor examines the parameter value that is passed to the procedure during its first compilation (parameter "sniffing").</span></span> <span data-ttu-id="9961f-329">The processor caches the resulting plan and uses it for later invocations, even if the parameter value is different.</span><span class="sxs-lookup"><span data-stu-id="9961f-329">The processor caches the resulting plan and uses it for later invocations, even if the parameter value is different.</span></span> <span data-ttu-id="9961f-330">The optimal plan might not be used in all cases.</span><span class="sxs-lookup"><span data-stu-id="9961f-330">The optimal plan might not be used in all cases.</span></span> <span data-ttu-id="9961f-331">Sometimes you need to guide the optimizer to pick a plan that is better for the average case rather than the specific case from when the query was first compiled.</span><span class="sxs-lookup"><span data-stu-id="9961f-331">Sometimes you need to guide the optimizer to pick a plan that is better for the average case rather than the specific case from when the query was first compiled.</span></span> <span data-ttu-id="9961f-332">In this example, the initial plan generates a "scan" plan that reads all rows to find each value that matches the parameter:</span><span class="sxs-lookup"><span data-stu-id="9961f-332">In this example, the initial plan generates a "scan" plan that reads all rows to find each value that matches the parameter:</span></span>

![Query tuning by using a scan plan](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-performance-guidance/query_tuning_1.png)

<span data-ttu-id="9961f-334">Because we executed the procedure by using the value 1, the resulting plan was optimal for the value 1 but was suboptimal for all other values in the table.</span><span class="sxs-lookup"><span data-stu-id="9961f-334">Because we executed the procedure by using the value 1, the resulting plan was optimal for the value 1 but was suboptimal for all other values in the table.</span></span> <span data-ttu-id="9961f-335">The result likely isn't what you would want if you were to pick each plan randomly, because the plan performs more slowly and uses more resources.</span><span class="sxs-lookup"><span data-stu-id="9961f-335">The result likely isn't what you would want if you were to pick each plan randomly, because the plan performs more slowly and uses more resources.</span></span>

<span data-ttu-id="9961f-336">If you run the test with `SET STATISTICS IO` set to `ON`, the logical scan work in this example is done behind the scenes.</span><span class="sxs-lookup"><span data-stu-id="9961f-336">If you run the test with `SET STATISTICS IO` set to `ON`, the logical scan work in this example is done behind the scenes.</span></span> <span data-ttu-id="9961f-337">You can see that there are 1,148 reads done by the plan (which is inefficient, if the average case is to return just one row):</span><span class="sxs-lookup"><span data-stu-id="9961f-337">You can see that there are 1,148 reads done by the plan (which is inefficient, if the average case is to return just one row):</span></span>

![Query tuning by using a logical scan](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-performance-guidance/query_tuning_2.png)

<span data-ttu-id="9961f-339">The second part of the example uses a query hint to tell the optimizer to use a specific value during the compilation process.</span><span class="sxs-lookup"><span data-stu-id="9961f-339">The second part of the example uses a query hint to tell the optimizer to use a specific value during the compilation process.</span></span> <span data-ttu-id="9961f-340">In this case, it forces the query processor to ignore the value that is passed as the parameter, and instead to assume `UNKNOWN`.</span><span class="sxs-lookup"><span data-stu-id="9961f-340">In this case, it forces the query processor to ignore the value that is passed as the parameter, and instead to assume `UNKNOWN`.</span></span> <span data-ttu-id="9961f-341">This refers to a value that has the average frequency in the table (ignoring skew).</span><span class="sxs-lookup"><span data-stu-id="9961f-341">This refers to a value that has the average frequency in the table (ignoring skew).</span></span> <span data-ttu-id="9961f-342">The resulting plan is a seek-based plan that is faster and uses fewer resources, on average, than the plan in part 1 of this example:</span><span class="sxs-lookup"><span data-stu-id="9961f-342">The resulting plan is a seek-based plan that is faster and uses fewer resources, on average, than the plan in part 1 of this example:</span></span>

![Query tuning by using a query hint](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-performance-guidance/query_tuning_3.png)

<span data-ttu-id="9961f-344">You can see the effect in the **sys.resource_stats** table (there is a delay from the time that you execute the test and when the data populates the table).</span><span class="sxs-lookup"><span data-stu-id="9961f-344">You can see the effect in the **sys.resource_stats** table (there is a delay from the time that you execute the test and when the data populates the table).</span></span> <span data-ttu-id="9961f-345">For this example, part 1 executed during the 22:25:00 time window, and part 2 executed at 22:35:00.</span><span class="sxs-lookup"><span data-stu-id="9961f-345">For this example, part 1 executed during the 22:25:00 time window, and part 2 executed at 22:35:00.</span></span> <span data-ttu-id="9961f-346">The earlier time window used more resources in that time window than the later one (because of plan efficiency improvements).</span><span class="sxs-lookup"><span data-stu-id="9961f-346">The earlier time window used more resources in that time window than the later one (because of plan efficiency improvements).</span></span>

    SELECT TOP 1000 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![Query tuning example results](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-performance-guidance/query_tuning_4.png)

> [!NOTE]
> <span data-ttu-id="9961f-348">Although the volume in this example is intentionally small, the effect of suboptimal parameters can be substantial, especially on larger databases.</span><span class="sxs-lookup"><span data-stu-id="9961f-348">Although the volume in this example is intentionally small, the effect of suboptimal parameters can be substantial, especially on larger databases.</span></span> <span data-ttu-id="9961f-349">The difference, in extreme cases, can be between seconds for fast cases and hours for slow cases.</span><span class="sxs-lookup"><span data-stu-id="9961f-349">The difference, in extreme cases, can be between seconds for fast cases and hours for slow cases.</span></span>
>
>

<span data-ttu-id="9961f-350">You can examine **sys.resource_stats** to determine whether the resource for a test uses more or fewer resources than another test.</span><span class="sxs-lookup"><span data-stu-id="9961f-350">You can examine **sys.resource_stats** to determine whether the resource for a test uses more or fewer resources than another test.</span></span> <span data-ttu-id="9961f-351">When you compare data, separate the timing of tests so that they are not in the same 5-minute window in the **sys.resource_stats** view.</span><span class="sxs-lookup"><span data-stu-id="9961f-351">When you compare data, separate the timing of tests so that they are not in the same 5-minute window in the **sys.resource_stats** view.</span></span> <span data-ttu-id="9961f-352">The goal of the exercise is to minimize the total amount of resources used, and not to minimize the peak resources.</span><span class="sxs-lookup"><span data-stu-id="9961f-352">The goal of the exercise is to minimize the total amount of resources used, and not to minimize the peak resources.</span></span> <span data-ttu-id="9961f-353">Generally, optimizing a piece of code for latency also reduces resource consumption.</span><span class="sxs-lookup"><span data-stu-id="9961f-353">Generally, optimizing a piece of code for latency also reduces resource consumption.</span></span> <span data-ttu-id="9961f-354">Make sure that the changes you make to an application are necessary, and that the changes don't negatively affect the customer experience for someone who might be using query hints in the application.</span><span class="sxs-lookup"><span data-stu-id="9961f-354">Make sure that the changes you make to an application are necessary, and that the changes don't negatively affect the customer experience for someone who might be using query hints in the application.</span></span>

<span data-ttu-id="9961f-355">If a workload has a set of repeating queries, often it makes sense to capture and validate the optimality of your plan choices because it drives the minimum resource size unit required to host the database.</span><span class="sxs-lookup"><span data-stu-id="9961f-355">If a workload has a set of repeating queries, often it makes sense to capture and validate the optimality of your plan choices because it drives the minimum resource size unit required to host the database.</span></span> <span data-ttu-id="9961f-356">After you validate it, occasionally reexamine the plans to help you make sure that they have not degraded.</span><span class="sxs-lookup"><span data-stu-id="9961f-356">After you validate it, occasionally reexamine the plans to help you make sure that they have not degraded.</span></span> <span data-ttu-id="9961f-357">You can learn more about [query hints (Transact-SQL)](https://msdn.microsoft.com/library/ms181714.aspx).</span><span class="sxs-lookup"><span data-stu-id="9961f-357">You can learn more about [query hints (Transact-SQL)](https://msdn.microsoft.com/library/ms181714.aspx).</span></span>

### <a name="cross-database-sharding"></a><span data-ttu-id="9961f-358">Cross-database sharding</span><span class="sxs-lookup"><span data-stu-id="9961f-358">Cross-database sharding</span></span>
<span data-ttu-id="9961f-359">Because Azure SQL Database runs on commodity hardware, the capacity limits for a single database are lower than for a traditional on-premises SQL Server installation.</span><span class="sxs-lookup"><span data-stu-id="9961f-359">Because Azure SQL Database runs on commodity hardware, the capacity limits for a single database are lower than for a traditional on-premises SQL Server installation.</span></span> <span data-ttu-id="9961f-360">Some customers use sharding techniques to spread database operations over multiple databases when the operations don't fit inside the limits of a single database in Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9961f-360">Some customers use sharding techniques to spread database operations over multiple databases when the operations don't fit inside the limits of a single database in Azure SQL Database.</span></span> <span data-ttu-id="9961f-361">Most customers who use sharding techniques in Azure SQL Database split their data on a single dimension across multiple databases.</span><span class="sxs-lookup"><span data-stu-id="9961f-361">Most customers who use sharding techniques in Azure SQL Database split their data on a single dimension across multiple databases.</span></span> <span data-ttu-id="9961f-362">For this approach, you need to understand that OLTP applications often perform transactions that apply to only one row or to a small group of rows in the schema.</span><span class="sxs-lookup"><span data-stu-id="9961f-362">For this approach, you need to understand that OLTP applications often perform transactions that apply to only one row or to a small group of rows in the schema.</span></span>

> [!NOTE]
> <span data-ttu-id="9961f-363">SQL Database now provides a library to assist with sharding.</span><span class="sxs-lookup"><span data-stu-id="9961f-363">SQL Database now provides a library to assist with sharding.</span></span> <span data-ttu-id="9961f-364">For more information, see [Elastic Database client library overview](sql-database-elastic-database-client-library.md).</span><span class="sxs-lookup"><span data-stu-id="9961f-364">For more information, see [Elastic Database client library overview](sql-database-elastic-database-client-library.md).</span></span>
>
>

<span data-ttu-id="9961f-365">For example, if a database has customer name, order, and order details (like the traditional example Northwind database that ships with SQL Server), you could split this data into multiple databases by grouping a customer with the related order and order detail information.</span><span class="sxs-lookup"><span data-stu-id="9961f-365">For example, if a database has customer name, order, and order details (like the traditional example Northwind database that ships with SQL Server), you could split this data into multiple databases by grouping a customer with the related order and order detail information.</span></span> <span data-ttu-id="9961f-366">You can guarantee that the customer's data stays in a single database.</span><span class="sxs-lookup"><span data-stu-id="9961f-366">You can guarantee that the customer's data stays in a single database.</span></span> <span data-ttu-id="9961f-367">The application would split different customers across databases, effectively spreading the load across multiple databases.</span><span class="sxs-lookup"><span data-stu-id="9961f-367">The application would split different customers across databases, effectively spreading the load across multiple databases.</span></span> <span data-ttu-id="9961f-368">With sharding, customers not only can avoid the maximum database size limit, but Azure SQL Database also can process workloads that are significantly larger than the limits of the different performance levels, as long as each individual database fits into its DTU.</span><span class="sxs-lookup"><span data-stu-id="9961f-368">With sharding, customers not only can avoid the maximum database size limit, but Azure SQL Database also can process workloads that are significantly larger than the limits of the different performance levels, as long as each individual database fits into its DTU.</span></span>

<span data-ttu-id="9961f-369">Although database sharding doesn't reduce the aggregate resource capacity for a solution, it's highly effective at supporting very large solutions that are spread over multiple databases.</span><span class="sxs-lookup"><span data-stu-id="9961f-369">Although database sharding doesn't reduce the aggregate resource capacity for a solution, it's highly effective at supporting very large solutions that are spread over multiple databases.</span></span> <span data-ttu-id="9961f-370">Each database can run at a different performance level to support very large, "effective" databases with high resource requirements.</span><span class="sxs-lookup"><span data-stu-id="9961f-370">Each database can run at a different performance level to support very large, "effective" databases with high resource requirements.</span></span>

### <a name="functional-partitioning"></a><span data-ttu-id="9961f-371">Functional partitioning</span><span class="sxs-lookup"><span data-stu-id="9961f-371">Functional partitioning</span></span>
<span data-ttu-id="9961f-372">SQL Server users often combine many functions in a single database.</span><span class="sxs-lookup"><span data-stu-id="9961f-372">SQL Server users often combine many functions in a single database.</span></span> <span data-ttu-id="9961f-373">For example, if an application has logic to manage inventory for a store, that database might have logic associated with inventory, tracking purchase orders, stored procedures, and indexed or materialized views that manage end-of-month reporting.</span><span class="sxs-lookup"><span data-stu-id="9961f-373">For example, if an application has logic to manage inventory for a store, that database might have logic associated with inventory, tracking purchase orders, stored procedures, and indexed or materialized views that manage end-of-month reporting.</span></span> <span data-ttu-id="9961f-374">This technique makes it easier to administer the database for operations like backup, but it also requires you to size the hardware to handle the peak load across all functions of an application.</span><span class="sxs-lookup"><span data-stu-id="9961f-374">This technique makes it easier to administer the database for operations like backup, but it also requires you to size the hardware to handle the peak load across all functions of an application.</span></span>

<span data-ttu-id="9961f-375">If you use a scale-out architecture in Azure SQL Database, it's a good idea to split different functions of an application into different databases.</span><span class="sxs-lookup"><span data-stu-id="9961f-375">If you use a scale-out architecture in Azure SQL Database, it's a good idea to split different functions of an application into different databases.</span></span> <span data-ttu-id="9961f-376">By using this technique, each application scales independently.</span><span class="sxs-lookup"><span data-stu-id="9961f-376">By using this technique, each application scales independently.</span></span> <span data-ttu-id="9961f-377">As an application becomes busier (and the load on the database increases), the administrator can choose independent performance levels for each function in the application.</span><span class="sxs-lookup"><span data-stu-id="9961f-377">As an application becomes busier (and the load on the database increases), the administrator can choose independent performance levels for each function in the application.</span></span> <span data-ttu-id="9961f-378">At the limit, with this architecture, an application can be larger than a single commodity machine can handle because the load is spread across multiple machines.</span><span class="sxs-lookup"><span data-stu-id="9961f-378">At the limit, with this architecture, an application can be larger than a single commodity machine can handle because the load is spread across multiple machines.</span></span>

### <a name="batch-queries"></a><span data-ttu-id="9961f-379">Batch queries</span><span class="sxs-lookup"><span data-stu-id="9961f-379">Batch queries</span></span>
<span data-ttu-id="9961f-380">For applications that access data by using high-volume, frequent, ad hoc querying, a substantial amount of response time is spent on network communication between the application tier and the Azure SQL Database tier.</span><span class="sxs-lookup"><span data-stu-id="9961f-380">For applications that access data by using high-volume, frequent, ad hoc querying, a substantial amount of response time is spent on network communication between the application tier and the Azure SQL Database tier.</span></span> <span data-ttu-id="9961f-381">Even when both the application and Azure SQL Database are in the same data center, the network latency between the two might be magnified by a large number of data access operations.</span><span class="sxs-lookup"><span data-stu-id="9961f-381">Even when both the application and Azure SQL Database are in the same data center, the network latency between the two might be magnified by a large number of data access operations.</span></span> <span data-ttu-id="9961f-382">To reduce the network round trips for the data access operations, consider using the option to either batch the ad hoc queries, or to compile them as stored procedures.</span><span class="sxs-lookup"><span data-stu-id="9961f-382">To reduce the network round trips for the data access operations, consider using the option to either batch the ad hoc queries, or to compile them as stored procedures.</span></span> <span data-ttu-id="9961f-383">If you batch the ad hoc queries, you can send multiple queries as one large batch in a single trip to Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9961f-383">If you batch the ad hoc queries, you can send multiple queries as one large batch in a single trip to Azure SQL Database.</span></span> <span data-ttu-id="9961f-384">If you compile ad hoc queries in a stored procedure, you could achieve the same result as if you batch them.</span><span class="sxs-lookup"><span data-stu-id="9961f-384">If you compile ad hoc queries in a stored procedure, you could achieve the same result as if you batch them.</span></span> <span data-ttu-id="9961f-385">Using a stored procedure also gives you the benefit of increasing the chances of caching the query plans in Azure SQL Database so you can use the stored procedure again.</span><span class="sxs-lookup"><span data-stu-id="9961f-385">Using a stored procedure also gives you the benefit of increasing the chances of caching the query plans in Azure SQL Database so you can use the stored procedure again.</span></span>

<span data-ttu-id="9961f-386">Some applications are write-intensive.</span><span class="sxs-lookup"><span data-stu-id="9961f-386">Some applications are write-intensive.</span></span> <span data-ttu-id="9961f-387">Sometimes you can reduce the total I/O load on a database by considering how to batch writes together.</span><span class="sxs-lookup"><span data-stu-id="9961f-387">Sometimes you can reduce the total I/O load on a database by considering how to batch writes together.</span></span> <span data-ttu-id="9961f-388">Often, this is as simple as using explicit transactions instead of auto-commit transactions in stored procedures and ad hoc batches.</span><span class="sxs-lookup"><span data-stu-id="9961f-388">Often, this is as simple as using explicit transactions instead of auto-commit transactions in stored procedures and ad hoc batches.</span></span> <span data-ttu-id="9961f-389">For an evaluation of different techniques you can use, see [Batching techniques for SQL Database applications in Azure](https://msdn.microsoft.com/library/windowsazure/dn132615.aspx).</span><span class="sxs-lookup"><span data-stu-id="9961f-389">For an evaluation of different techniques you can use, see [Batching techniques for SQL Database applications in Azure](https://msdn.microsoft.com/library/windowsazure/dn132615.aspx).</span></span> <span data-ttu-id="9961f-390">Experiment with your own workload to find the right model for batching.</span><span class="sxs-lookup"><span data-stu-id="9961f-390">Experiment with your own workload to find the right model for batching.</span></span> <span data-ttu-id="9961f-391">Be sure to understand that a model might have slightly different transactional consistency guarantees.</span><span class="sxs-lookup"><span data-stu-id="9961f-391">Be sure to understand that a model might have slightly different transactional consistency guarantees.</span></span> <span data-ttu-id="9961f-392">Finding the right workload that minimizes resource use requires finding the right combination of consistency and performance trade-offs.</span><span class="sxs-lookup"><span data-stu-id="9961f-392">Finding the right workload that minimizes resource use requires finding the right combination of consistency and performance trade-offs.</span></span>

### <a name="application-tier-caching"></a><span data-ttu-id="9961f-393">Application-tier caching</span><span class="sxs-lookup"><span data-stu-id="9961f-393">Application-tier caching</span></span>
<span data-ttu-id="9961f-394">Some database applications have read-heavy workloads.</span><span class="sxs-lookup"><span data-stu-id="9961f-394">Some database applications have read-heavy workloads.</span></span> <span data-ttu-id="9961f-395">Caching layers might reduce the load on the database and might potentially reduce the performance level required to support a database by using Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9961f-395">Caching layers might reduce the load on the database and might potentially reduce the performance level required to support a database by using Azure SQL Database.</span></span> <span data-ttu-id="9961f-396">With [Azure Redis Cache](https://azure.microsoft.com/services/cache/), if you have a read-heavy workload, you can read the data once (or perhaps once per application-tier machine, depending on how it is configured), and then store that data outside your SQL database.</span><span class="sxs-lookup"><span data-stu-id="9961f-396">With [Azure Redis Cache](https://azure.microsoft.com/services/cache/), if you have a read-heavy workload, you can read the data once (or perhaps once per application-tier machine, depending on how it is configured), and then store that data outside your SQL database.</span></span> <span data-ttu-id="9961f-397">This is a way to reduce database load (CPU and read I/O), but there is an effect on transactional consistency because the data being read from the cache might be out of sync with the data in the database.</span><span class="sxs-lookup"><span data-stu-id="9961f-397">This is a way to reduce database load (CPU and read I/O), but there is an effect on transactional consistency because the data being read from the cache might be out of sync with the data in the database.</span></span> <span data-ttu-id="9961f-398">Although in many applications some level of inconsistency is acceptable, that's not true for all workloads.</span><span class="sxs-lookup"><span data-stu-id="9961f-398">Although in many applications some level of inconsistency is acceptable, that's not true for all workloads.</span></span> <span data-ttu-id="9961f-399">You should fully understand any application requirements before you implement an application-tier caching strategy.</span><span class="sxs-lookup"><span data-stu-id="9961f-399">You should fully understand any application requirements before you implement an application-tier caching strategy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9961f-400">Next steps</span><span class="sxs-lookup"><span data-stu-id="9961f-400">Next steps</span></span>
* <span data-ttu-id="9961f-401">For more information about service tiers, see [SQL Database options and performance](sql-database-service-tiers.md)</span><span class="sxs-lookup"><span data-stu-id="9961f-401">For more information about service tiers, see [SQL Database options and performance](sql-database-service-tiers.md)</span></span>
* <span data-ttu-id="9961f-402">For more information about elastic pools, see [What is an Azure elastic pool?](sql-database-elastic-pool.md)</span><span class="sxs-lookup"><span data-stu-id="9961f-402">For more information about elastic pools, see [What is an Azure elastic pool?](sql-database-elastic-pool.md)</span></span>
* <span data-ttu-id="9961f-403">For information about performance and elastic pools, see [When to consider an elastic pool](sql-database-elastic-pool.md)</span><span class="sxs-lookup"><span data-stu-id="9961f-403">For information about performance and elastic pools, see [When to consider an elastic pool](sql-database-elastic-pool.md)</span></span>








