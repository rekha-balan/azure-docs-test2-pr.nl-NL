---
title: Rolling application upgrades - Azure SQL Database | Microsoft Docs
description: Learn how to use Azure SQL Database geo-replication to support online upgrades of your cloud application.
services: sql-database
documentationcenter: ''
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 58f42859-1e37-463c-a3d8-a3ca2e867148
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: 1b5ec99eae2c350f3d3cc4a787558a4ff33a6e0d
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44540899"
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a><span data-ttu-id="37242-103">Managing rolling upgrades of cloud applications using SQL Database Active Geo-Replication</span><span class="sxs-lookup"><span data-stu-id="37242-103">Managing rolling upgrades of cloud applications using SQL Database Active Geo-Replication</span></span>
> [!NOTE]
> <span data-ttu-id="37242-104">[Active Geo-Replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span><span class="sxs-lookup"><span data-stu-id="37242-104">[Active Geo-Replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
> 
> 

<span data-ttu-id="37242-105">Learn how to use [Geo-Replication](sql-database-geo-replication-overview.md) in SQL Database to enable rolling upgrades of your cloud application.</span><span class="sxs-lookup"><span data-stu-id="37242-105">Learn how to use [Geo-Replication](sql-database-geo-replication-overview.md) in SQL Database to enable rolling upgrades of your cloud application.</span></span> <span data-ttu-id="37242-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span><span class="sxs-lookup"><span data-stu-id="37242-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span></span> <span data-ttu-id="37242-107">In this article we look at two different methods of orchestrating the upgrade process, and discuss the benefits and trade-offs of each option.</span><span class="sxs-lookup"><span data-stu-id="37242-107">In this article we look at two different methods of orchestrating the upgrade process, and discuss the benefits and trade-offs of each option.</span></span> <span data-ttu-id="37242-108">For the purposes of this article we will use a simple application that consists of a web site connected to a single database as its data tier.</span><span class="sxs-lookup"><span data-stu-id="37242-108">For the purposes of this article we will use a simple application that consists of a web site connected to a single database as its data tier.</span></span> <span data-ttu-id="37242-109">Our goal is to upgrade version 1 of the application to version 2 without any significant impact on the end user experience.</span><span class="sxs-lookup"><span data-stu-id="37242-109">Our goal is to upgrade version 1 of the application to version 2 without any significant impact on the end user experience.</span></span> 

<span data-ttu-id="37242-110">When evaluating the upgrade options you should consider the following factors:</span><span class="sxs-lookup"><span data-stu-id="37242-110">When evaluating the upgrade options you should consider the following factors:</span></span>

* <span data-ttu-id="37242-111">Impact on application availability during upgrades.</span><span class="sxs-lookup"><span data-stu-id="37242-111">Impact on application availability during upgrades.</span></span> <span data-ttu-id="37242-112">How long the application function may be limited or degraded.</span><span class="sxs-lookup"><span data-stu-id="37242-112">How long the application function may be limited or degraded.</span></span>
* <span data-ttu-id="37242-113">Ability to roll back in case of an upgrade failure.</span><span class="sxs-lookup"><span data-stu-id="37242-113">Ability to roll back in case of an upgrade failure.</span></span>
* <span data-ttu-id="37242-114">Vulnerability of the application if an unrelated catastrophic failure occurs during the upgrade.</span><span class="sxs-lookup"><span data-stu-id="37242-114">Vulnerability of the application if an unrelated catastrophic failure occurs during the upgrade.</span></span>
* <span data-ttu-id="37242-115">Total dollar cost.</span><span class="sxs-lookup"><span data-stu-id="37242-115">Total dollar cost.</span></span>  <span data-ttu-id="37242-116">This includes additional redundancy and incremental costs of the temporary components  used by the upgrade process.</span><span class="sxs-lookup"><span data-stu-id="37242-116">This includes additional redundancy and incremental costs of the temporary components  used by the upgrade process.</span></span> 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a><span data-ttu-id="37242-117">Upgrading applications that rely on database backups for disaster recovery</span><span class="sxs-lookup"><span data-stu-id="37242-117">Upgrading applications that rely on database backups for disaster recovery</span></span>
<span data-ttu-id="37242-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed to a single Azure region.</span><span class="sxs-lookup"><span data-stu-id="37242-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed to a single Azure region.</span></span> <span data-ttu-id="37242-119">In this case the upgrade process involves creating a backup deployment of all application components involved in the upgrade.</span><span class="sxs-lookup"><span data-stu-id="37242-119">In this case the upgrade process involves creating a backup deployment of all application components involved in the upgrade.</span></span> <span data-ttu-id="37242-120">To minimize the end-user disruption you will leverage Azure Traffic Manager (WATM) with the failover profile.</span><span class="sxs-lookup"><span data-stu-id="37242-120">To minimize the end-user disruption you will leverage Azure Traffic Manager (WATM) with the failover profile.</span></span>  <span data-ttu-id="37242-121">The following diagram illustrates the operational environment prior to the upgrade process.</span><span class="sxs-lookup"><span data-stu-id="37242-121">The following diagram illustrates the operational environment prior to the upgrade process.</span></span> <span data-ttu-id="37242-122">The endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of the application that needs to be upgraded.</span><span class="sxs-lookup"><span data-stu-id="37242-122">The endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of the application that needs to be upgraded.</span></span> <span data-ttu-id="37242-123">To enable the ability to rollback the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span><span class="sxs-lookup"><span data-stu-id="37242-123">To enable the ability to rollback the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span></span> <span data-ttu-id="37242-124">The following steps are required to prepare the application for the upgrade:</span><span class="sxs-lookup"><span data-stu-id="37242-124">The following steps are required to prepare the application for the upgrade:</span></span>

1. <span data-ttu-id="37242-125">Create a stage slot for the upgrade.</span><span class="sxs-lookup"><span data-stu-id="37242-125">Create a stage slot for the upgrade.</span></span> <span data-ttu-id="37242-126">To do that create a secondary database (1) and deploy a identical web site in the same Azure region.</span><span class="sxs-lookup"><span data-stu-id="37242-126">To do that create a secondary database (1) and deploy a identical web site in the same Azure region.</span></span> <span data-ttu-id="37242-127">Monitor the secondary to see if the seeding process is completed.</span><span class="sxs-lookup"><span data-stu-id="37242-127">Monitor the secondary to see if the seeding process is completed.</span></span>
2. <span data-ttu-id="37242-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span><span class="sxs-lookup"><span data-stu-id="37242-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span></span> 

> [!NOTE]
> <span data-ttu-id="37242-129">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span><span class="sxs-lookup"><span data-stu-id="37242-129">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span></span>
> 
> 

![SQL Database Go-Replication configuration.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

<span data-ttu-id="37242-132">Once the preparation steps are completed the application is ready for the actual upgrade.</span><span class="sxs-lookup"><span data-stu-id="37242-132">Once the preparation steps are completed the application is ready for the actual upgrade.</span></span> <span data-ttu-id="37242-133">The following diagram illustrates the steps involved in the upgrade process.</span><span class="sxs-lookup"><span data-stu-id="37242-133">The following diagram illustrates the steps involved in the upgrade process.</span></span> 

1. <span data-ttu-id="37242-134">Set the primary database in the production slot to read-only mode (3).</span><span class="sxs-lookup"><span data-stu-id="37242-134">Set the primary database in the production slot to read-only mode (3).</span></span> <span data-ttu-id="37242-135">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span><span class="sxs-lookup"><span data-stu-id="37242-135">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="37242-136">Disconnect the secondary database using the planned termination mode (4).</span><span class="sxs-lookup"><span data-stu-id="37242-136">Disconnect the secondary database using the planned termination mode (4).</span></span> <span data-ttu-id="37242-137">It will create a fully synchronized independent copy of the primary database.</span><span class="sxs-lookup"><span data-stu-id="37242-137">It will create a fully synchronized independent copy of the primary database.</span></span> <span data-ttu-id="37242-138">This database will be upgraded.</span><span class="sxs-lookup"><span data-stu-id="37242-138">This database will be upgraded.</span></span>
3. <span data-ttu-id="37242-139">Turn the primary database to read-write mode and run the upgrade script in the stage slot  (5).</span><span class="sxs-lookup"><span data-stu-id="37242-139">Turn the primary database to read-write mode and run the upgrade script in the stage slot  (5).</span></span>     

![SQL Database Geo-Replication configuration.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

<span data-ttu-id="37242-142">If the upgrade completed successfully you are now ready to switch the end users to the staged copy the application.</span><span class="sxs-lookup"><span data-stu-id="37242-142">If the upgrade completed successfully you are now ready to switch the end users to the staged copy the application.</span></span> <span data-ttu-id="37242-143">It will now become the production slot of the application.</span><span class="sxs-lookup"><span data-stu-id="37242-143">It will now become the production slot of the application.</span></span>  <span data-ttu-id="37242-144">This involves a few more steps as illustrated on the following diagram.</span><span class="sxs-lookup"><span data-stu-id="37242-144">This involves a few more steps as illustrated on the following diagram.</span></span>

1. <span data-ttu-id="37242-145">Switch the online endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which points to the V2 version of the web site (6).</span><span class="sxs-lookup"><span data-stu-id="37242-145">Switch the online endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which points to the V2 version of the web site (6).</span></span> <span data-ttu-id="37242-146">It now becomes the production slot with the V2 application and the end user traffic is directed to it.</span><span class="sxs-lookup"><span data-stu-id="37242-146">It now becomes the production slot with the V2 application and the end user traffic is directed to it.</span></span>  
2. <span data-ttu-id="37242-147">If you no longer need the V1 application components so you can safely remove them (7).</span><span class="sxs-lookup"><span data-stu-id="37242-147">If you no longer need the V1 application components so you can safely remove them (7).</span></span>   

![SQL Database Geo-Replication configuration.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

<span data-ttu-id="37242-150">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span><span class="sxs-lookup"><span data-stu-id="37242-150">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span></span> <span data-ttu-id="37242-151">To rollback the application to the pre-upgrade state you simply revert the application in the production slot to full access.</span><span class="sxs-lookup"><span data-stu-id="37242-151">To rollback the application to the pre-upgrade state you simply revert the application in the production slot to full access.</span></span> <span data-ttu-id="37242-152">The steps involved are shown on the next diagram.</span><span class="sxs-lookup"><span data-stu-id="37242-152">The steps involved are shown on the next diagram.</span></span>    

1. <span data-ttu-id="37242-153">Set the database copy to read-write mode (8).</span><span class="sxs-lookup"><span data-stu-id="37242-153">Set the database copy to read-write mode (8).</span></span> <span data-ttu-id="37242-154">This will restore the full V1 functionally in the production slot.</span><span class="sxs-lookup"><span data-stu-id="37242-154">This will restore the full V1 functionally in the production slot.</span></span>
2. <span data-ttu-id="37242-155">Perform the root cause analysis and remove the compromised components in the stage slot (9).</span><span class="sxs-lookup"><span data-stu-id="37242-155">Perform the root cause analysis and remove the compromised components in the stage slot (9).</span></span> 

<span data-ttu-id="37242-156">At this point the application is fully functional and the upgrade steps can be repeated.</span><span class="sxs-lookup"><span data-stu-id="37242-156">At this point the application is fully functional and the upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="37242-157">The rollback does not require changes in WATM profile as it already points to <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span><span class="sxs-lookup"><span data-stu-id="37242-157">The rollback does not require changes in WATM profile as it already points to <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span></span>
> 
> 

![SQL Database Geo-Replication configuration.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

<span data-ttu-id="37242-160">The key **advantage** of this option is that you can upgrade a application in a single region using a set of simple steps.</span><span class="sxs-lookup"><span data-stu-id="37242-160">The key **advantage** of this option is that you can upgrade a application in a single region using a set of simple steps.</span></span> <span data-ttu-id="37242-161">The dollar cost of the upgrade is relatively low.</span><span class="sxs-lookup"><span data-stu-id="37242-161">The dollar cost of the upgrade is relatively low.</span></span> <span data-ttu-id="37242-162">The main **tradeoff** is that if a catastrophic failure occurs during the upgrade the recovery to the pre-upgrade state will involve re-deployment of the application in a different region and restoring the database from backup using geo-restore.</span><span class="sxs-lookup"><span data-stu-id="37242-162">The main **tradeoff** is that if a catastrophic failure occurs during the upgrade the recovery to the pre-upgrade state will involve re-deployment of the application in a different region and restoring the database from backup using geo-restore.</span></span> <span data-ttu-id="37242-163">This process will result in significant downtime.</span><span class="sxs-lookup"><span data-stu-id="37242-163">This process will result in significant downtime.</span></span>   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a><span data-ttu-id="37242-164">Upgrading applications that rely on database Geo-Replication for disaster recovery</span><span class="sxs-lookup"><span data-stu-id="37242-164">Upgrading applications that rely on database Geo-Replication for disaster recovery</span></span>
<span data-ttu-id="37242-165">If your application leverages Geo-Replication for business continuity, it is deployed  to at least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span><span class="sxs-lookup"><span data-stu-id="37242-165">If your application leverages Geo-Replication for business continuity, it is deployed  to at least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span></span> <span data-ttu-id="37242-166">In addition to the factors mentioned earlier, the upgrade process must guarantee that:</span><span class="sxs-lookup"><span data-stu-id="37242-166">In addition to the factors mentioned earlier, the upgrade process must guarantee that:</span></span>

* <span data-ttu-id="37242-167">The application remains protected from catastrophic failures at all times during the upgrade process</span><span class="sxs-lookup"><span data-stu-id="37242-167">The application remains protected from catastrophic failures at all times during the upgrade process</span></span>
* <span data-ttu-id="37242-168">The geo-redundant components of the application are upgraded in parallel with the active components</span><span class="sxs-lookup"><span data-stu-id="37242-168">The geo-redundant components of the application are upgraded in parallel with the active components</span></span>

<span data-ttu-id="37242-169">To achieve these goals you will leverage Azure Traffic Manager (WATM) using the failover profile with one active and three backup endpoints.</span><span class="sxs-lookup"><span data-stu-id="37242-169">To achieve these goals you will leverage Azure Traffic Manager (WATM) using the failover profile with one active and three backup endpoints.</span></span>  <span data-ttu-id="37242-170">The following diagram illustrates the operational environment prior to the upgrade process.</span><span class="sxs-lookup"><span data-stu-id="37242-170">The following diagram illustrates the operational environment prior to the upgrade process.</span></span> <span data-ttu-id="37242-171">The web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of the application with full geographic redundancy.</span><span class="sxs-lookup"><span data-stu-id="37242-171">The web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of the application with full geographic redundancy.</span></span> <span data-ttu-id="37242-172">To enable the ability to rollback the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span><span class="sxs-lookup"><span data-stu-id="37242-172">To enable the ability to rollback the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span></span> <span data-ttu-id="37242-173">Because you you need to ensure that the application can quickly recover in case a catastrophic failure occurs during the upgrade process the stage slot needs to be geo-redundant as well.</span><span class="sxs-lookup"><span data-stu-id="37242-173">Because you you need to ensure that the application can quickly recover in case a catastrophic failure occurs during the upgrade process the stage slot needs to be geo-redundant as well.</span></span> <span data-ttu-id="37242-174">The following steps are required to prepare the application for the upgrade:</span><span class="sxs-lookup"><span data-stu-id="37242-174">The following steps are required to prepare the application for the upgrade:</span></span>

1. <span data-ttu-id="37242-175">Create a stage slot for the upgrade.</span><span class="sxs-lookup"><span data-stu-id="37242-175">Create a stage slot for the upgrade.</span></span> <span data-ttu-id="37242-176">To do that create a secondary database (1) and deploy a identical copy of the web site in the same Azure region .</span><span class="sxs-lookup"><span data-stu-id="37242-176">To do that create a secondary database (1) and deploy a identical copy of the web site in the same Azure region .</span></span> <span data-ttu-id="37242-177">Monitor the secondary to see if the seeding process is completed.</span><span class="sxs-lookup"><span data-stu-id="37242-177">Monitor the secondary to see if the seeding process is completed.</span></span>
2. <span data-ttu-id="37242-178">Create a geo-redundant secondary database in the stage slot by geo-replicating the secondary database to the backup region (this is called "chained geo-replication").</span><span class="sxs-lookup"><span data-stu-id="37242-178">Create a geo-redundant secondary database in the stage slot by geo-replicating the secondary database to the backup region (this is called "chained geo-replication").</span></span> <span data-ttu-id="37242-179">Monitor the backup secondary to see if the seeding process is completed (3).</span><span class="sxs-lookup"><span data-stu-id="37242-179">Monitor the backup secondary to see if the seeding process is completed (3).</span></span>
3. <span data-ttu-id="37242-180">Create a standby copy of the web site in the backup region and link it to the geo-redundant secondary (4).</span><span class="sxs-lookup"><span data-stu-id="37242-180">Create a standby copy of the web site in the backup region and link it to the geo-redundant secondary (4).</span></span>  
4. <span data-ttu-id="37242-181">Add the additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> to the failover profile in WATM as offline endpoints (5).</span><span class="sxs-lookup"><span data-stu-id="37242-181">Add the additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> to the failover profile in WATM as offline endpoints (5).</span></span> 

> [!NOTE]
> <span data-ttu-id="37242-182">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span><span class="sxs-lookup"><span data-stu-id="37242-182">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span></span>
> 
> 

![SQL Database Geo-Replication configuration.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

<span data-ttu-id="37242-185">Once the preparation steps are completed, the stage slot is ready for the upgrade.</span><span class="sxs-lookup"><span data-stu-id="37242-185">Once the preparation steps are completed, the stage slot is ready for the upgrade.</span></span> <span data-ttu-id="37242-186">The following diagram illustrates the upgrade steps.</span><span class="sxs-lookup"><span data-stu-id="37242-186">The following diagram illustrates the upgrade steps.</span></span>

1. <span data-ttu-id="37242-187">Set the primary database in the production slot to read-only mode (6).</span><span class="sxs-lookup"><span data-stu-id="37242-187">Set the primary database in the production slot to read-only mode (6).</span></span> <span data-ttu-id="37242-188">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span><span class="sxs-lookup"><span data-stu-id="37242-188">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="37242-189">Disconnect the secondary database in the same region using the planned termination mode (7).</span><span class="sxs-lookup"><span data-stu-id="37242-189">Disconnect the secondary database in the same region using the planned termination mode (7).</span></span> <span data-ttu-id="37242-190">It will create a fully synchronized independent copy of the primary database, which will automatically become a primary after the termination.</span><span class="sxs-lookup"><span data-stu-id="37242-190">It will create a fully synchronized independent copy of the primary database, which will automatically become a primary after the termination.</span></span> <span data-ttu-id="37242-191">This database will be upgraded.</span><span class="sxs-lookup"><span data-stu-id="37242-191">This database will be upgraded.</span></span>
3. <span data-ttu-id="37242-192">Turn the primary database in the stage slot to read-write mode and run the upgrade script (8).</span><span class="sxs-lookup"><span data-stu-id="37242-192">Turn the primary database in the stage slot to read-write mode and run the upgrade script (8).</span></span>    

![SQL Database Geo-Replication configuration.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

<span data-ttu-id="37242-195">If the upgrade completed successfully you are now ready to switch the end users to the V2 version of the application.</span><span class="sxs-lookup"><span data-stu-id="37242-195">If the upgrade completed successfully you are now ready to switch the end users to the V2 version of the application.</span></span> <span data-ttu-id="37242-196">The following diagram illustrates the steps involved.</span><span class="sxs-lookup"><span data-stu-id="37242-196">The following diagram illustrates the steps involved.</span></span>

1. <span data-ttu-id="37242-197">Switch the active endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which now points to the V2 version of the web site (9).</span><span class="sxs-lookup"><span data-stu-id="37242-197">Switch the active endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which now points to the V2 version of the web site (9).</span></span> <span data-ttu-id="37242-198">It now becomes a production slot with the V2 application and end user traffic is directed to it.</span><span class="sxs-lookup"><span data-stu-id="37242-198">It now becomes a production slot with the V2 application and end user traffic is directed to it.</span></span> 
2. <span data-ttu-id="37242-199">If you no longer need the V1 application so you can safely remove it (10 and 11).</span><span class="sxs-lookup"><span data-stu-id="37242-199">If you no longer need the V1 application so you can safely remove it (10 and 11).</span></span>  

![SQL Database Geo-Replication configuration.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

<span data-ttu-id="37242-202">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span><span class="sxs-lookup"><span data-stu-id="37242-202">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span></span> <span data-ttu-id="37242-203">To rollback the application to the pre-upgrade state you simply revert to using the application in the production slot with full access.</span><span class="sxs-lookup"><span data-stu-id="37242-203">To rollback the application to the pre-upgrade state you simply revert to using the application in the production slot with full access.</span></span> <span data-ttu-id="37242-204">The steps involved are shown on the next diagram.</span><span class="sxs-lookup"><span data-stu-id="37242-204">The steps involved are shown on the next diagram.</span></span>    

1. <span data-ttu-id="37242-205">Set the primary database copy in the production slot to read-write mode (12).</span><span class="sxs-lookup"><span data-stu-id="37242-205">Set the primary database copy in the production slot to read-write mode (12).</span></span> <span data-ttu-id="37242-206">This will restore the full V1 functionally in the production slot.</span><span class="sxs-lookup"><span data-stu-id="37242-206">This will restore the full V1 functionally in the production slot.</span></span>
2. <span data-ttu-id="37242-207">Perform the root cause analysis and remove the compromised components in the stage slot (13 and 14).</span><span class="sxs-lookup"><span data-stu-id="37242-207">Perform the root cause analysis and remove the compromised components in the stage slot (13 and 14).</span></span> 

<span data-ttu-id="37242-208">At this point the application is fully functional and the upgrade steps can be repeated.</span><span class="sxs-lookup"><span data-stu-id="37242-208">At this point the application is fully functional and the upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="37242-209">The rollback does not require changes in WATM profile as it already points to  <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span><span class="sxs-lookup"><span data-stu-id="37242-209">The rollback does not require changes in WATM profile as it already points to  <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span></span>
> 
> 

![SQL Database Geo-Replication configuration.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

<span data-ttu-id="37242-212">The key **advantage** of this option is that you can upgrade both the application and its geo-redundant copy in parallel without compromising your business continuity during the upgrade.</span><span class="sxs-lookup"><span data-stu-id="37242-212">The key **advantage** of this option is that you can upgrade both the application and its geo-redundant copy in parallel without compromising your business continuity during the upgrade.</span></span> <span data-ttu-id="37242-213">The main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span><span class="sxs-lookup"><span data-stu-id="37242-213">The main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span></span> <span data-ttu-id="37242-214">It also involves a more complicated workflow.</span><span class="sxs-lookup"><span data-stu-id="37242-214">It also involves a more complicated workflow.</span></span> 

## <a name="summary"></a><span data-ttu-id="37242-215">Summary</span><span class="sxs-lookup"><span data-stu-id="37242-215">Summary</span></span>
<span data-ttu-id="37242-216">The two upgrade methods described in the article differ in complexity and the dollar cost but they both focus on minimizing the time when the end user is limited to read-only operations.</span><span class="sxs-lookup"><span data-stu-id="37242-216">The two upgrade methods described in the article differ in complexity and the dollar cost but they both focus on minimizing the time when the end user is limited to read-only operations.</span></span> <span data-ttu-id="37242-217">That time is directly defined by the duration of the upgrade script.</span><span class="sxs-lookup"><span data-stu-id="37242-217">That time is directly defined by the duration of the upgrade script.</span></span> <span data-ttu-id="37242-218">It does not depend on the database size, the service tier you chose, the web site configuration and other factors that you cannot easily control.</span><span class="sxs-lookup"><span data-stu-id="37242-218">It does not depend on the database size, the service tier you chose, the web site configuration and other factors that you cannot easily control.</span></span> <span data-ttu-id="37242-219">This is because all the preparation steps are decoupled from the upgrade steps and can be done without impacting the production application.</span><span class="sxs-lookup"><span data-stu-id="37242-219">This is because all the preparation steps are decoupled from the upgrade steps and can be done without impacting the production application.</span></span> <span data-ttu-id="37242-220">The efficiency of the upgrade script is the key factor that determines the end-user experience during upgrades.</span><span class="sxs-lookup"><span data-stu-id="37242-220">The efficiency of the upgrade script is the key factor that determines the end-user experience during upgrades.</span></span> <span data-ttu-id="37242-221">So the best way you can improve it is by focusing your efforts on making the upgrade script as efficient as possible.</span><span class="sxs-lookup"><span data-stu-id="37242-221">So the best way you can improve it is by focusing your efforts on making the upgrade script as efficient as possible.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="37242-222">Next steps</span><span class="sxs-lookup"><span data-stu-id="37242-222">Next steps</span></span>
* <span data-ttu-id="37242-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="37242-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="37242-224">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="37242-224">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="37242-225">To learn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="37242-225">To learn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md)</span></span>
* <span data-ttu-id="37242-226">To learn about faster recovery options, see [Active-Geo-Replication](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="37242-226">To learn about faster recovery options, see [Active-Geo-Replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="37242-227">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span><span class="sxs-lookup"><span data-stu-id="37242-227">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span></span>

## <a name="additionale-resources"></a><span data-ttu-id="37242-228">Additionale Resources</span><span class="sxs-lookup"><span data-stu-id="37242-228">Additionale Resources</span></span>
<span data-ttu-id="37242-229">The following pages will help you learn about the specific operations required to implement the upgrade workflow:</span><span class="sxs-lookup"><span data-stu-id="37242-229">The following pages will help you learn about the specific operations required to implement the upgrade workflow:</span></span>

* [<span data-ttu-id="37242-230">Add secondary database</span><span class="sxs-lookup"><span data-stu-id="37242-230">Add secondary database</span></span>](https://msdn.microsoft.com/library/azure/mt603689.aspx) 
* [<span data-ttu-id="37242-231">Failover database to secondary</span><span class="sxs-lookup"><span data-stu-id="37242-231">Failover database to secondary</span></span>](https://msdn.microsoft.com/library/azure/mt619393.aspx)
* [<span data-ttu-id="37242-232">Disconnect Geo-Replication secondary</span><span class="sxs-lookup"><span data-stu-id="37242-232">Disconnect Geo-Replication secondary</span></span>](https://msdn.microsoft.com/library/azure/mt603457.aspx)
* [<span data-ttu-id="37242-233">Geo-restore database</span><span class="sxs-lookup"><span data-stu-id="37242-233">Geo-restore database</span></span>](https://msdn.microsoft.com/library/azure/mt693390.aspx) 
* [<span data-ttu-id="37242-234">Drop database</span><span class="sxs-lookup"><span data-stu-id="37242-234">Drop database</span></span>](https://msdn.microsoft.com/library/azure/mt619368.aspx)
* [<span data-ttu-id="37242-235">Copy database</span><span class="sxs-lookup"><span data-stu-id="37242-235">Copy database</span></span>](https://msdn.microsoft.com/library/azure/mt603644.aspx)
* [<span data-ttu-id="37242-236">Set database to read-only or read-write mode</span><span class="sxs-lookup"><span data-stu-id="37242-236">Set database to read-only or read-write mode</span></span>](https://msdn.microsoft.com/library/bb522682.aspx)









