---
title: SQL Database disaster recovery | Microsoft Docs
description: Learn how to recover a database from a regional datacenter outage or failure with the Azure SQL Database Active Geo-Replication, and Geo-Restore capabilities.
services: sql-database
documentationcenter: ''
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 4800960e-3f9d-40ce-9e55-fb7f2784c067
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 10/13/2016
ms.author: sashan
ms.openlocfilehash: dab476db32b2274049140144847fba24b55856b0
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44551166"
---
# <a name="restore-an-azure-sql-database-or-failover-to-a-secondary"></a><span data-ttu-id="e2f3f-103">Restore an Azure SQL Database or failover to a secondary</span><span class="sxs-lookup"><span data-stu-id="e2f3f-103">Restore an Azure SQL Database or failover to a secondary</span></span>
<span data-ttu-id="e2f3f-104">Azure SQL Database offers the following capabilities for recovering from an outage:</span><span class="sxs-lookup"><span data-stu-id="e2f3f-104">Azure SQL Database offers the following capabilities for recovering from an outage:</span></span>

* [<span data-ttu-id="e2f3f-105">Active Geo-Replication</span><span class="sxs-lookup"><span data-stu-id="e2f3f-105">Active Geo-Replication</span></span>](sql-database-geo-replication-overview.md)
* [<span data-ttu-id="e2f3f-106">Geo-Restore</span><span class="sxs-lookup"><span data-stu-id="e2f3f-106">Geo-Restore</span></span>](sql-database-recovery-using-backups.md#point-in-time-restore)

<span data-ttu-id="e2f3f-107">To learn about business continuity scenarios and the features supporting these scenarios, see [Business continuity](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="e2f3f-107">To learn about business continuity scenarios and the features supporting these scenarios, see [Business continuity](sql-database-business-continuity.md).</span></span>

### <a name="prepare-for-the-event-of-an-outage"></a><span data-ttu-id="e2f3f-108">Prepare for the event of an outage</span><span class="sxs-lookup"><span data-stu-id="e2f3f-108">Prepare for the event of an outage</span></span>
<span data-ttu-id="e2f3f-109">For success with recovery to another data region using either Active Geo-Replication or geo-redundant backups, you need to prepare a server in another data center outage to become the new primary server should the need arise as well as have well defined steps documented and tested to ensure a smooth recovery.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-109">For success with recovery to another data region using either Active Geo-Replication or geo-redundant backups, you need to prepare a server in another data center outage to become the new primary server should the need arise as well as have well defined steps documented and tested to ensure a smooth recovery.</span></span> <span data-ttu-id="e2f3f-110">These preparation steps include:</span><span class="sxs-lookup"><span data-stu-id="e2f3f-110">These preparation steps include:</span></span>

* <span data-ttu-id="e2f3f-111">Identify the logical server in another region to become the new primary server.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-111">Identify the logical server in another region to become the new primary server.</span></span> <span data-ttu-id="e2f3f-112">With Active Geo-Replication, this will be at least one and perhaps each of the secondary servers.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-112">With Active Geo-Replication, this will be at least one and perhaps each of the secondary servers.</span></span> <span data-ttu-id="e2f3f-113">For Geo-Restore, this will generally be a server in the [paired region](../best-practices-availability-paired-regions.md) for the region in which your database is located.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-113">For Geo-Restore, this will generally be a server in the [paired region](../best-practices-availability-paired-regions.md) for the region in which your database is located.</span></span>
* <span data-ttu-id="e2f3f-114">Identify, and optionally define, the server-level firewall rules needed on for users to access the new primary database.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-114">Identify, and optionally define, the server-level firewall rules needed on for users to access the new primary database.</span></span>
* <span data-ttu-id="e2f3f-115">Determine how you are going to redirect users to the new primary server, such as by changing connection strings or by changing DNS entries.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-115">Determine how you are going to redirect users to the new primary server, such as by changing connection strings or by changing DNS entries.</span></span>
* <span data-ttu-id="e2f3f-116">Identify, and optionally create, the logins that must be present in the master database on the new primary server, and ensure these logins have appropriate permissions in the master database, if any.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-116">Identify, and optionally create, the logins that must be present in the master database on the new primary server, and ensure these logins have appropriate permissions in the master database, if any.</span></span> <span data-ttu-id="e2f3f-117">For more information, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md)</span><span class="sxs-lookup"><span data-stu-id="e2f3f-117">For more information, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md)</span></span>
* <span data-ttu-id="e2f3f-118">Identify alert rules that will need to be updated to map to the new primary database.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-118">Identify alert rules that will need to be updated to map to the new primary database.</span></span>
* <span data-ttu-id="e2f3f-119">Document the auditing configuration on the current primary database</span><span class="sxs-lookup"><span data-stu-id="e2f3f-119">Document the auditing configuration on the current primary database</span></span>
* <span data-ttu-id="e2f3f-120">Perform a [disaster recovery drill](sql-database-disaster-recovery-drills.md).</span><span class="sxs-lookup"><span data-stu-id="e2f3f-120">Perform a [disaster recovery drill](sql-database-disaster-recovery-drills.md).</span></span> <span data-ttu-id="e2f3f-121">To simulate an outage for Geo-Restore, you can delete or rename the source database to cause application connectivity failure.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-121">To simulate an outage for Geo-Restore, you can delete or rename the source database to cause application connectivity failure.</span></span> <span data-ttu-id="e2f3f-122">To simulate an outage for Active Geo-Replication, you can disable the web application or virtual machine connected to the database or failover the database to cause application connectity failures.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-122">To simulate an outage for Active Geo-Replication, you can disable the web application or virtual machine connected to the database or failover the database to cause application connectity failures.</span></span>

## <a name="when-to-initiate-recovery"></a><span data-ttu-id="e2f3f-123">When to initiate recovery</span><span class="sxs-lookup"><span data-stu-id="e2f3f-123">When to initiate recovery</span></span>
<span data-ttu-id="e2f3f-124">The recovery operation impacts the application.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-124">The recovery operation impacts the application.</span></span> <span data-ttu-id="e2f3f-125">It requires changing the SQL connection string or redirection using DNS and could result in permanent data loss.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-125">It requires changing the SQL connection string or redirection using DNS and could result in permanent data loss.</span></span> <span data-ttu-id="e2f3f-126">Therefore, it should be done only when the outage is likely to last longer than your application's recovery time objective.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-126">Therefore, it should be done only when the outage is likely to last longer than your application's recovery time objective.</span></span> <span data-ttu-id="e2f3f-127">When the application is deployed to production you should perform regular monitoring of the application health and use the following data points to assert that the recovery is warranted:</span><span class="sxs-lookup"><span data-stu-id="e2f3f-127">When the application is deployed to production you should perform regular monitoring of the application health and use the following data points to assert that the recovery is warranted:</span></span>

1. <span data-ttu-id="e2f3f-128">Permanent connectivity failure from the application tier to the database.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-128">Permanent connectivity failure from the application tier to the database.</span></span>
2. <span data-ttu-id="e2f3f-129">The Azure portal shows an alert about an incident in the region with broad impact.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-129">The Azure portal shows an alert about an incident in the region with broad impact.</span></span>
3. <span data-ttu-id="e2f3f-130">The Azure SQL Database server is marked as degraded.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-130">The Azure SQL Database server is marked as degraded.</span></span>

<span data-ttu-id="e2f3f-131">Depending on your application tolerance to downtime and possible business liability you can consider the following recovery options.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-131">Depending on your application tolerance to downtime and possible business liability you can consider the following recovery options.</span></span>

<span data-ttu-id="e2f3f-132">Use the [Get Recoverable Database](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) to get the latest Geo-replicated restore point.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-132">Use the [Get Recoverable Database](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) to get the latest Geo-replicated restore point.</span></span>

## <a name="wait-for-service-recovery"></a><span data-ttu-id="e2f3f-133">Wait for service recovery</span><span class="sxs-lookup"><span data-stu-id="e2f3f-133">Wait for service recovery</span></span>
<span data-ttu-id="e2f3f-134">The Azure teams work diligently to restore service availability as quickly as possible but depending on the root cause it can take hours or days.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-134">The Azure teams work diligently to restore service availability as quickly as possible but depending on the root cause it can take hours or days.</span></span>  <span data-ttu-id="e2f3f-135">If your application can tolerate significant downtime you can simply wait for the recovery to complete.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-135">If your application can tolerate significant downtime you can simply wait for the recovery to complete.</span></span> <span data-ttu-id="e2f3f-136">In this case, no action on your part is required.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-136">In this case, no action on your part is required.</span></span> <span data-ttu-id="e2f3f-137">You can see the current service status on our [Azure Service Health Dashboard](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="e2f3f-137">You can see the current service status on our [Azure Service Health Dashboard](https://azure.microsoft.com/status/).</span></span> <span data-ttu-id="e2f3f-138">After the recovery of the region your application’s availability will be restored.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-138">After the recovery of the region your application’s availability will be restored.</span></span>

## <a name="failover-to-geo-replicated-secondary-database"></a><span data-ttu-id="e2f3f-139">Failover to geo-replicated secondary database</span><span class="sxs-lookup"><span data-stu-id="e2f3f-139">Failover to geo-replicated secondary database</span></span>
<span data-ttu-id="e2f3f-140">If your application’s downtime can result in business liability you should be using geo-replicated database(s) in your application.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-140">If your application’s downtime can result in business liability you should be using geo-replicated database(s) in your application.</span></span> <span data-ttu-id="e2f3f-141">It will enable the application to quickly restore availability in a different region in case of an outage.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-141">It will enable the application to quickly restore availability in a different region in case of an outage.</span></span> <span data-ttu-id="e2f3f-142">Learn how to [configure Geo-Replication](sql-database-geo-replication-portal.md).</span><span class="sxs-lookup"><span data-stu-id="e2f3f-142">Learn how to [configure Geo-Replication](sql-database-geo-replication-portal.md).</span></span>

<span data-ttu-id="e2f3f-143">To restore availability of the database(s) you need to initiate the failover to the geo-replicated secondary using one of the supported methods.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-143">To restore availability of the database(s) you need to initiate the failover to the geo-replicated secondary using one of the supported methods.</span></span>

<span data-ttu-id="e2f3f-144">Use one of the following guides to failover to a geo-replicated secondary database:</span><span class="sxs-lookup"><span data-stu-id="e2f3f-144">Use one of the following guides to failover to a geo-replicated secondary database:</span></span>

* [<span data-ttu-id="e2f3f-145">Failover to a geo-replicated secondary using Azure Portal</span><span class="sxs-lookup"><span data-stu-id="e2f3f-145">Failover to a geo-replicated secondary using Azure Portal</span></span>](sql-database-geo-replication-portal.md)
* [<span data-ttu-id="e2f3f-146">Failover to a geo-replicated secondary using PowerShell</span><span class="sxs-lookup"><span data-stu-id="e2f3f-146">Failover to a geo-replicated secondary using PowerShell</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
* [<span data-ttu-id="e2f3f-147">Failover to a geo-replicated secondary using T-SQL</span><span class="sxs-lookup"><span data-stu-id="e2f3f-147">Failover to a geo-replicated secondary using T-SQL</span></span>](sql-database-geo-replication-transact-sql.md)

## <a name="recover-using-geo-restore"></a><span data-ttu-id="e2f3f-148">Recover using Geo-Restore</span><span class="sxs-lookup"><span data-stu-id="e2f3f-148">Recover using Geo-Restore</span></span>
<span data-ttu-id="e2f3f-149">If your application’s downtime does not result in business liability you can use [Geo-Restore](sql-database-recovery-using-backups.md) as a method to recover your application database(s).</span><span class="sxs-lookup"><span data-stu-id="e2f3f-149">If your application’s downtime does not result in business liability you can use [Geo-Restore](sql-database-recovery-using-backups.md) as a method to recover your application database(s).</span></span> <span data-ttu-id="e2f3f-150">It creates a copy of the database from its latest geo-redundant backup.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-150">It creates a copy of the database from its latest geo-redundant backup.</span></span>

## <a name="configure-your-database-after-recovery"></a><span data-ttu-id="e2f3f-151">Configure your database after recovery</span><span class="sxs-lookup"><span data-stu-id="e2f3f-151">Configure your database after recovery</span></span>
<span data-ttu-id="e2f3f-152">If you are using either geo-replication failover or geo-restore to recover from an outage, you must make sure that the connectivity to the new databases is properly configured so that the normal application function can be resumed.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-152">If you are using either geo-replication failover or geo-restore to recover from an outage, you must make sure that the connectivity to the new databases is properly configured so that the normal application function can be resumed.</span></span> <span data-ttu-id="e2f3f-153">This is a checklist of tasks to get your recovered database production ready.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-153">This is a checklist of tasks to get your recovered database production ready.</span></span>

### <a name="update-connection-strings"></a><span data-ttu-id="e2f3f-154">Update Connection Strings</span><span class="sxs-lookup"><span data-stu-id="e2f3f-154">Update Connection Strings</span></span>
<span data-ttu-id="e2f3f-155">Because your recovered database will reside in a different server, you need to update your application’s connection string to point to that server.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-155">Because your recovered database will reside in a different server, you need to update your application’s connection string to point to that server.</span></span>

<span data-ttu-id="e2f3f-156">For more information about changing connection strings, see the appropriate development language for your [connection library](sql-database-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="e2f3f-156">For more information about changing connection strings, see the appropriate development language for your [connection library](sql-database-libraries.md).</span></span>

### <a name="configure-firewall-rules"></a><span data-ttu-id="e2f3f-157">Configure Firewall Rules</span><span class="sxs-lookup"><span data-stu-id="e2f3f-157">Configure Firewall Rules</span></span>
<span data-ttu-id="e2f3f-158">You need to make sure that the firewall rules configured on server and on the database match those that were configured on the primary server and primary database.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-158">You need to make sure that the firewall rules configured on server and on the database match those that were configured on the primary server and primary database.</span></span> <span data-ttu-id="e2f3f-159">For more information, see [How to: Configure Firewall Settings (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span><span class="sxs-lookup"><span data-stu-id="e2f3f-159">For more information, see [How to: Configure Firewall Settings (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span></span>

### <a name="configure-logins-and-database-users"></a><span data-ttu-id="e2f3f-160">Configure Logins and Database Users</span><span class="sxs-lookup"><span data-stu-id="e2f3f-160">Configure Logins and Database Users</span></span>
<span data-ttu-id="e2f3f-161">You need to make sure that all the logins used by your application exist on the server which is hosting your recovered database.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-161">You need to make sure that all the logins used by your application exist on the server which is hosting your recovered database.</span></span> <span data-ttu-id="e2f3f-162">For more information, see [Security Configuration for Geo-Replication](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="e2f3f-162">For more information, see [Security Configuration for Geo-Replication](sql-database-geo-replication-security-config.md).</span></span>

> [!NOTE]
> <span data-ttu-id="e2f3f-163">You should configure and test your server firewall rules and logins (and their permissions) during a disaster recovery drill.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-163">You should configure and test your server firewall rules and logins (and their permissions) during a disaster recovery drill.</span></span> <span data-ttu-id="e2f3f-164">These server-level objects and their configuration may not be available during the outage.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-164">These server-level objects and their configuration may not be available during the outage.</span></span>
> 
> 

### <a name="setup-telemetry-alerts"></a><span data-ttu-id="e2f3f-165">Setup Telemetry Alerts</span><span class="sxs-lookup"><span data-stu-id="e2f3f-165">Setup Telemetry Alerts</span></span>
<span data-ttu-id="e2f3f-166">You need to make sure your existing alert rule settings are updated to map to the recovered database and the different server.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-166">You need to make sure your existing alert rule settings are updated to map to the recovered database and the different server.</span></span>

<span data-ttu-id="e2f3f-167">For more information about database alert rules, see [Receive Alert Notifications](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) and [Track Service Health](../monitoring-and-diagnostics/insights-service-health.md).</span><span class="sxs-lookup"><span data-stu-id="e2f3f-167">For more information about database alert rules, see [Receive Alert Notifications](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) and [Track Service Health](../monitoring-and-diagnostics/insights-service-health.md).</span></span>

### <a name="enable-auditing"></a><span data-ttu-id="e2f3f-168">Enable Auditing</span><span class="sxs-lookup"><span data-stu-id="e2f3f-168">Enable Auditing</span></span>
<span data-ttu-id="e2f3f-169">If auditing is required to access your database, you need to enable Auditing after the database recovery.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-169">If auditing is required to access your database, you need to enable Auditing after the database recovery.</span></span> <span data-ttu-id="e2f3f-170">A good indicator that auditing is required is that client applications use secure connection strings in a pattern of \*.database.secure.windows.net.</span><span class="sxs-lookup"><span data-stu-id="e2f3f-170">A good indicator that auditing is required is that client applications use secure connection strings in a pattern of \*.database.secure.windows.net.</span></span> <span data-ttu-id="e2f3f-171">For more information, see [Database auditing](sql-database-auditing.md).</span><span class="sxs-lookup"><span data-stu-id="e2f3f-171">For more information, see [Database auditing](sql-database-auditing.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="e2f3f-172">Next steps</span><span class="sxs-lookup"><span data-stu-id="e2f3f-172">Next steps</span></span>
* <span data-ttu-id="e2f3f-173">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="e2f3f-173">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="e2f3f-174">To learn about business continuity design and recovery scenarios, see [Continuity scenarios](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="e2f3f-174">To learn about business continuity design and recovery scenarios, see [Continuity scenarios](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="e2f3f-175">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="e2f3f-175">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>

