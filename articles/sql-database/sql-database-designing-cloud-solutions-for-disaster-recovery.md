---
title: Disaster recovery app design - Azure SQL Database | Microsoft Docs
description: Learn about application design for Azure SQL Database disaster recovery using geo-replication.
keywords: cloud disaster recovery,disaster recovery solutions,app data backup,geo-replication,business continuity planning
services: sql-database
documentationcenter: ''
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: e8a346ac-dd08-41e7-9685-46cebca04582
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 07/20/2016
ms.author: sashan
ms.openlocfilehash: 704b047e98072dd6b6ce3ca3a0ea16f6be62a445
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44555343"
---
# <a name="application-design-for-cloud-disaster-recovery-using-active-geo-replication-in-sql-database"></a><span data-ttu-id="d77a2-104">Application design for cloud disaster recovery using Active Geo-Replication in SQL Database</span><span class="sxs-lookup"><span data-stu-id="d77a2-104">Application design for cloud disaster recovery using Active Geo-Replication in SQL Database</span></span>
> [!NOTE]
> <span data-ttu-id="d77a2-105">[Active Geo-Replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span><span class="sxs-lookup"><span data-stu-id="d77a2-105">[Active Geo-Replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
>
>

<span data-ttu-id="d77a2-106">Learn how to use [Active Geo-Replication](sql-database-geo-replication-overview.md) in SQL Database to design database applications resilient to regional failures and catastrophic outages.</span><span class="sxs-lookup"><span data-stu-id="d77a2-106">Learn how to use [Active Geo-Replication](sql-database-geo-replication-overview.md) in SQL Database to design database applications resilient to regional failures and catastrophic outages.</span></span> <span data-ttu-id="d77a2-107">For business continuity planning, consider the application deployment topology, the service level agreement you are targeting, traffic latency, and costs.</span><span class="sxs-lookup"><span data-stu-id="d77a2-107">For business continuity planning, consider the application deployment topology, the service level agreement you are targeting, traffic latency, and costs.</span></span> <span data-ttu-id="d77a2-108">In this article, we look at the common application patterns, and discuss the benefits and trade-offs of each option.</span><span class="sxs-lookup"><span data-stu-id="d77a2-108">In this article, we look at the common application patterns, and discuss the benefits and trade-offs of each option.</span></span> <span data-ttu-id="d77a2-109">For information about Active Geo-Replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="d77a2-109">For information about Active Geo-Replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

## <a name="design-pattern-1-active-passive-deployment-for-cloud-disaster-recovery-with-a-co-located-database"></a><span data-ttu-id="d77a2-110">Design pattern 1: Active-passive deployment for cloud disaster recovery with a co-located database</span><span class="sxs-lookup"><span data-stu-id="d77a2-110">Design pattern 1: Active-passive deployment for cloud disaster recovery with a co-located database</span></span>
<span data-ttu-id="d77a2-111">This option is best suited for applications with the following characteristics:</span><span class="sxs-lookup"><span data-stu-id="d77a2-111">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="d77a2-112">Active instance in a single Azure region</span><span class="sxs-lookup"><span data-stu-id="d77a2-112">Active instance in a single Azure region</span></span>
* <span data-ttu-id="d77a2-113">Strong dependency on read-write (RW) access to data</span><span class="sxs-lookup"><span data-stu-id="d77a2-113">Strong dependency on read-write (RW) access to data</span></span>
* <span data-ttu-id="d77a2-114">Cross-region connectivity between the application logic and the database is not acceptable due to latency and traffic cost</span><span class="sxs-lookup"><span data-stu-id="d77a2-114">Cross-region connectivity between the application logic and the database is not acceptable due to latency and traffic cost</span></span>    

<span data-ttu-id="d77a2-115">In this case, the application deployment topology is optimized for handling regional disasters when all application components are impacted and need to failover as a unit.</span><span class="sxs-lookup"><span data-stu-id="d77a2-115">In this case, the application deployment topology is optimized for handling regional disasters when all application components are impacted and need to failover as a unit.</span></span> <span data-ttu-id="d77a2-116">For geographic redundancy, the application logic and the database are replicated to another region but they are not used for the application workload under the normal conditions.</span><span class="sxs-lookup"><span data-stu-id="d77a2-116">For geographic redundancy, the application logic and the database are replicated to another region but they are not used for the application workload under the normal conditions.</span></span> <span data-ttu-id="d77a2-117">The application in the secondary region should be configured to use a SQL connection string to the secondary database.</span><span class="sxs-lookup"><span data-stu-id="d77a2-117">The application in the secondary region should be configured to use a SQL connection string to the secondary database.</span></span> <span data-ttu-id="d77a2-118">Traffic manager is set up to use [failover routing method](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="d77a2-118">Traffic manager is set up to use [failover routing method](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span></span>  

> [!NOTE]
> <span data-ttu-id="d77a2-119">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span><span class="sxs-lookup"><span data-stu-id="d77a2-119">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span></span> <span data-ttu-id="d77a2-120">You can use any load-balancing solution that supports failover routing method.</span><span class="sxs-lookup"><span data-stu-id="d77a2-120">You can use any load-balancing solution that supports failover routing method.</span></span>    
>
>

<span data-ttu-id="d77a2-121">In addition to the main application instances, you should consider deploying a small [worker role application](../cloud-services/cloud-services-choose-me.md#tellmecs) that monitors your primary database by issuing periodic T-SQL read-only (RO) commands.</span><span class="sxs-lookup"><span data-stu-id="d77a2-121">In addition to the main application instances, you should consider deploying a small [worker role application](../cloud-services/cloud-services-choose-me.md#tellmecs) that monitors your primary database by issuing periodic T-SQL read-only (RO) commands.</span></span> <span data-ttu-id="d77a2-122">You can use it to automatically trigger failover, to generate an alert on your application's admin console, or to do both.</span><span class="sxs-lookup"><span data-stu-id="d77a2-122">You can use it to automatically trigger failover, to generate an alert on your application's admin console, or to do both.</span></span> <span data-ttu-id="d77a2-123">To ensure that monitoring is not impacted by region-wide outages, you should deploy the monitoring application instances to each region and have each instance connected to the primary database in the primary region and the secondary database in the local region.</span><span class="sxs-lookup"><span data-stu-id="d77a2-123">To ensure that monitoring is not impacted by region-wide outages, you should deploy the monitoring application instances to each region and have each instance connected to the primary database in the primary region and the secondary database in the local region.</span></span>

> [!NOTE]
> <span data-ttu-id="d77a2-124">Both monitoring applications should be active and probe both primary and secondary databases.</span><span class="sxs-lookup"><span data-stu-id="d77a2-124">Both monitoring applications should be active and probe both primary and secondary databases.</span></span> <span data-ttu-id="d77a2-125">The latter can be used to detect a failure in the secondary region and alert when the application is not protected.</span><span class="sxs-lookup"><span data-stu-id="d77a2-125">The latter can be used to detect a failure in the secondary region and alert when the application is not protected.</span></span>     
>
>

<span data-ttu-id="d77a2-126">The following diagram shows this configuration before an outage.</span><span class="sxs-lookup"><span data-stu-id="d77a2-126">The following diagram shows this configuration before an outage.</span></span>

![SQL Database Geo-Replication configuration.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-1.png)

<span data-ttu-id="d77a2-129">After an outage in the primary region, the monitoring application detects that the primary database is not accessible and registers an alert.</span><span class="sxs-lookup"><span data-stu-id="d77a2-129">After an outage in the primary region, the monitoring application detects that the primary database is not accessible and registers an alert.</span></span> <span data-ttu-id="d77a2-130">Depending on your application SLA, you can decide how many consecutive monitoring probes should fail before it declares a database outage.</span><span class="sxs-lookup"><span data-stu-id="d77a2-130">Depending on your application SLA, you can decide how many consecutive monitoring probes should fail before it declares a database outage.</span></span> <span data-ttu-id="d77a2-131">To achieve coordinated failover of the application end-point and the database, you should have the monitoring application perform the following steps:</span><span class="sxs-lookup"><span data-stu-id="d77a2-131">To achieve coordinated failover of the application end-point and the database, you should have the monitoring application perform the following steps:</span></span>

1. <span data-ttu-id="d77a2-132">[Update the status of the primary end-point](https://msdn.microsoft.com/library/hh758250.aspx) in order to trigger end-point failover.</span><span class="sxs-lookup"><span data-stu-id="d77a2-132">[Update the status of the primary end-point](https://msdn.microsoft.com/library/hh758250.aspx) in order to trigger end-point failover.</span></span>
2. <span data-ttu-id="d77a2-133">Call the secondary database to [initiate database failover](sql-database-geo-replication-portal.md).</span><span class="sxs-lookup"><span data-stu-id="d77a2-133">Call the secondary database to [initiate database failover](sql-database-geo-replication-portal.md).</span></span>

<span data-ttu-id="d77a2-134">After failover, the application will process the user requests in the secondary region but will remain co-located with the database because the primary database will now be in the secondary region.</span><span class="sxs-lookup"><span data-stu-id="d77a2-134">After failover, the application will process the user requests in the secondary region but will remain co-located with the database because the primary database will now be in the secondary region.</span></span> <span data-ttu-id="d77a2-135">This scenario is illustrated by the next diagram.</span><span class="sxs-lookup"><span data-stu-id="d77a2-135">This scenario is illustrated by the next diagram.</span></span> <span data-ttu-id="d77a2-136">In all diagrams, solid lines indicate active connections, dotted lines indicate suspended connections and stop signs indicate action triggers.</span><span class="sxs-lookup"><span data-stu-id="d77a2-136">In all diagrams, solid lines indicate active connections, dotted lines indicate suspended connections and stop signs indicate action triggers.</span></span>

![Geo-Replication: Failover to secondary database.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-2.png)

<span data-ttu-id="d77a2-139">If an outage happens in the secondary region, the replication link between the primary and the secondary database is suspended and the monitoring application registers an alert that the primary database is exposed.</span><span class="sxs-lookup"><span data-stu-id="d77a2-139">If an outage happens in the secondary region, the replication link between the primary and the secondary database is suspended and the monitoring application registers an alert that the primary database is exposed.</span></span> <span data-ttu-id="d77a2-140">The application's performance is not impacted, but the application operates exposed and therefore at higher risk in case both regions fail in succession.</span><span class="sxs-lookup"><span data-stu-id="d77a2-140">The application's performance is not impacted, but the application operates exposed and therefore at higher risk in case both regions fail in succession.</span></span>

> [!NOTE]
> <span data-ttu-id="d77a2-141">We only recommend deployment configurations with a single DR region.</span><span class="sxs-lookup"><span data-stu-id="d77a2-141">We only recommend deployment configurations with a single DR region.</span></span> <span data-ttu-id="d77a2-142">This is because most of the Azure geographies have two regions.</span><span class="sxs-lookup"><span data-stu-id="d77a2-142">This is because most of the Azure geographies have two regions.</span></span> <span data-ttu-id="d77a2-143">These configurations will not protect your application from a catastrophic failure of both regions.</span><span class="sxs-lookup"><span data-stu-id="d77a2-143">These configurations will not protect your application from a catastrophic failure of both regions.</span></span> <span data-ttu-id="d77a2-144">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="d77a2-144">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span>
>
>

<span data-ttu-id="d77a2-145">Once the outage is mitigated, the secondary database is automatically synchronized with the primary.</span><span class="sxs-lookup"><span data-stu-id="d77a2-145">Once the outage is mitigated, the secondary database is automatically synchronized with the primary.</span></span> <span data-ttu-id="d77a2-146">During synchronization, performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span><span class="sxs-lookup"><span data-stu-id="d77a2-146">During synchronization, performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span> <span data-ttu-id="d77a2-147">The following diagram illustrates an outage in the secondary region.</span><span class="sxs-lookup"><span data-stu-id="d77a2-147">The following diagram illustrates an outage in the secondary region.</span></span>

![Secondary database synchronized with primary.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-3.png)

<span data-ttu-id="d77a2-150">The key **advantages** of this design pattern are:</span><span class="sxs-lookup"><span data-stu-id="d77a2-150">The key **advantages** of this design pattern are:</span></span>

* <span data-ttu-id="d77a2-151">The SQL connection string is set during the application deployment in each region and doesn’t change after failover.</span><span class="sxs-lookup"><span data-stu-id="d77a2-151">The SQL connection string is set during the application deployment in each region and doesn’t change after failover.</span></span>
* <span data-ttu-id="d77a2-152">The application's performance is not impacted by failover as the application and the database are always co-located.</span><span class="sxs-lookup"><span data-stu-id="d77a2-152">The application's performance is not impacted by failover as the application and the database are always co-located.</span></span>

<span data-ttu-id="d77a2-153">The main **tradeoff** is that the redundant application instance in the secondary region is only used for disaster recovery.</span><span class="sxs-lookup"><span data-stu-id="d77a2-153">The main **tradeoff** is that the redundant application instance in the secondary region is only used for disaster recovery.</span></span>

## <a name="design-pattern-2-active-active-deployment-for-application-load-balancing"></a><span data-ttu-id="d77a2-154">Design pattern 2: Active-active deployment for application load balancing</span><span class="sxs-lookup"><span data-stu-id="d77a2-154">Design pattern 2: Active-active deployment for application load balancing</span></span>
<span data-ttu-id="d77a2-155">This cloud disaster recovery option is best suited for applications with the following characteristics:</span><span class="sxs-lookup"><span data-stu-id="d77a2-155">This cloud disaster recovery option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="d77a2-156">High ratio of database reads to writes</span><span class="sxs-lookup"><span data-stu-id="d77a2-156">High ratio of database reads to writes</span></span>
* <span data-ttu-id="d77a2-157">Database write latency does not impact the end-user experience</span><span class="sxs-lookup"><span data-stu-id="d77a2-157">Database write latency does not impact the end-user experience</span></span>  
* <span data-ttu-id="d77a2-158">Read-only logic can be separated from read-write logic by using a different connection string</span><span class="sxs-lookup"><span data-stu-id="d77a2-158">Read-only logic can be separated from read-write logic by using a different connection string</span></span>
* <span data-ttu-id="d77a2-159">Read-only logic does not depend on data being fully synchronized with the latest updates</span><span class="sxs-lookup"><span data-stu-id="d77a2-159">Read-only logic does not depend on data being fully synchronized with the latest updates</span></span>  

<span data-ttu-id="d77a2-160">If your applications have these characteristics, load balancing the end-user connections across multiple application instances in different regions can improve performance and the end-user experience.</span><span class="sxs-lookup"><span data-stu-id="d77a2-160">If your applications have these characteristics, load balancing the end-user connections across multiple application instances in different regions can improve performance and the end-user experience.</span></span> <span data-ttu-id="d77a2-161">To implement load-balancing, each region should have an active instance of the application with the read-write (RW) logic connected to the primary database in the primary region.</span><span class="sxs-lookup"><span data-stu-id="d77a2-161">To implement load-balancing, each region should have an active instance of the application with the read-write (RW) logic connected to the primary database in the primary region.</span></span> <span data-ttu-id="d77a2-162">The read-only (RO) logic should be connected to a secondary database in the same region as the application instance.</span><span class="sxs-lookup"><span data-stu-id="d77a2-162">The read-only (RO) logic should be connected to a secondary database in the same region as the application instance.</span></span> <span data-ttu-id="d77a2-163">Traffic manager should be set up to use [round-robin routing](../traffic-manager/traffic-manager-configure-round-robin-routing-method.md) or [performance routing](../traffic-manager/traffic-manager-configure-performance-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for each application instance.</span><span class="sxs-lookup"><span data-stu-id="d77a2-163">Traffic manager should be set up to use [round-robin routing](../traffic-manager/traffic-manager-configure-round-robin-routing-method.md) or [performance routing](../traffic-manager/traffic-manager-configure-performance-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for each application instance.</span></span>

<span data-ttu-id="d77a2-164">As in pattern #1, you should consider deploying a similar monitoring application.</span><span class="sxs-lookup"><span data-stu-id="d77a2-164">As in pattern #1, you should consider deploying a similar monitoring application.</span></span> <span data-ttu-id="d77a2-165">But unlike pattern #1, the monitoring application will not be responsible for triggering the end-point failover.</span><span class="sxs-lookup"><span data-stu-id="d77a2-165">But unlike pattern #1, the monitoring application will not be responsible for triggering the end-point failover.</span></span>

> [!NOTE]
> <span data-ttu-id="d77a2-166">While this pattern uses more than one secondary database, only one of the secondaries would be used for failover for the reasons noted earlier.</span><span class="sxs-lookup"><span data-stu-id="d77a2-166">While this pattern uses more than one secondary database, only one of the secondaries would be used for failover for the reasons noted earlier.</span></span> <span data-ttu-id="d77a2-167">Because this pattern requires read-only access to the secondary, it requires Active Geo-Replication.</span><span class="sxs-lookup"><span data-stu-id="d77a2-167">Because this pattern requires read-only access to the secondary, it requires Active Geo-Replication.</span></span>
>
>

<span data-ttu-id="d77a2-168">Traffic manager should be configured for performance routing to direct the user connections to the application instance closest to the user's geographic location.</span><span class="sxs-lookup"><span data-stu-id="d77a2-168">Traffic manager should be configured for performance routing to direct the user connections to the application instance closest to the user's geographic location.</span></span> <span data-ttu-id="d77a2-169">The following diagram illustrates this configuration before an outage.</span><span class="sxs-lookup"><span data-stu-id="d77a2-169">The following diagram illustrates this configuration before an outage.</span></span>
<span data-ttu-id="d77a2-170">![No outage: Performance routing to nearest application.</span><span class="sxs-lookup"><span data-stu-id="d77a2-170">![No outage: Performance routing to nearest application.</span></span> <span data-ttu-id="d77a2-171">Geo-Replication.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)</span><span class="sxs-lookup"><span data-stu-id="d77a2-171">Geo-Replication.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)</span></span>

<span data-ttu-id="d77a2-172">If a database outage is detected in the primary region, you initiate failover of the primary database to one of the secondary regions, changing the location of the primary database.</span><span class="sxs-lookup"><span data-stu-id="d77a2-172">If a database outage is detected in the primary region, you initiate failover of the primary database to one of the secondary regions, changing the location of the primary database.</span></span> <span data-ttu-id="d77a2-173">The traffic manager automatically excludes the offline end-point from the routing table, but continues routing the end-user traffic to the remaining online instances.</span><span class="sxs-lookup"><span data-stu-id="d77a2-173">The traffic manager automatically excludes the offline end-point from the routing table, but continues routing the end-user traffic to the remaining online instances.</span></span> <span data-ttu-id="d77a2-174">Because the primary database is now in a different region, all online instances must change their read-write SQL connection string to connect to the new primary.</span><span class="sxs-lookup"><span data-stu-id="d77a2-174">Because the primary database is now in a different region, all online instances must change their read-write SQL connection string to connect to the new primary.</span></span> <span data-ttu-id="d77a2-175">It is important that you make this change prior to initiating the database failover.</span><span class="sxs-lookup"><span data-stu-id="d77a2-175">It is important that you make this change prior to initiating the database failover.</span></span> <span data-ttu-id="d77a2-176">The read-only SQL connection strings should remain unchanged as they always point to the database in the same region.</span><span class="sxs-lookup"><span data-stu-id="d77a2-176">The read-only SQL connection strings should remain unchanged as they always point to the database in the same region.</span></span> <span data-ttu-id="d77a2-177">The failover steps are:</span><span class="sxs-lookup"><span data-stu-id="d77a2-177">The failover steps are:</span></span>  

1. <span data-ttu-id="d77a2-178">Change read-write SQL connection strings to point to the new primary.</span><span class="sxs-lookup"><span data-stu-id="d77a2-178">Change read-write SQL connection strings to point to the new primary.</span></span>
2. <span data-ttu-id="d77a2-179">Call the designated secondary database in order to [initiate database failover](sql-database-geo-replication-portal.md).</span><span class="sxs-lookup"><span data-stu-id="d77a2-179">Call the designated secondary database in order to [initiate database failover](sql-database-geo-replication-portal.md).</span></span>

<span data-ttu-id="d77a2-180">The following diagram illustrates the new configuration after the failover.</span><span class="sxs-lookup"><span data-stu-id="d77a2-180">The following diagram illustrates the new configuration after the failover.</span></span>
<span data-ttu-id="d77a2-181">![Configuration after failover.</span><span class="sxs-lookup"><span data-stu-id="d77a2-181">![Configuration after failover.</span></span> <span data-ttu-id="d77a2-182">Cloud disaster recovery.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)</span><span class="sxs-lookup"><span data-stu-id="d77a2-182">Cloud disaster recovery.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)</span></span>

<span data-ttu-id="d77a2-183">In case of an outage in one of the secondary regions, the traffic manager automatically removes the offline end-point in that region from the routing table.</span><span class="sxs-lookup"><span data-stu-id="d77a2-183">In case of an outage in one of the secondary regions, the traffic manager automatically removes the offline end-point in that region from the routing table.</span></span> <span data-ttu-id="d77a2-184">The replication channel to the secondary database in that region is suspended.</span><span class="sxs-lookup"><span data-stu-id="d77a2-184">The replication channel to the secondary database in that region is suspended.</span></span> <span data-ttu-id="d77a2-185">Because the remaining regions get additional user traffic in this scenario, the application's performance is impacted during the outage.</span><span class="sxs-lookup"><span data-stu-id="d77a2-185">Because the remaining regions get additional user traffic in this scenario, the application's performance is impacted during the outage.</span></span> <span data-ttu-id="d77a2-186">Once the outage is mitigated, the secondary database in the impacted region is immediately synchronized with the primary.</span><span class="sxs-lookup"><span data-stu-id="d77a2-186">Once the outage is mitigated, the secondary database in the impacted region is immediately synchronized with the primary.</span></span> <span data-ttu-id="d77a2-187">During synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span><span class="sxs-lookup"><span data-stu-id="d77a2-187">During synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span> <span data-ttu-id="d77a2-188">The following diagram illustrates an outage in one of the secondary regions.</span><span class="sxs-lookup"><span data-stu-id="d77a2-188">The following diagram illustrates an outage in one of the secondary regions.</span></span>

![Outage in secondary region.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-3.png)

<span data-ttu-id="d77a2-191">The key **advantage** of this design pattern is that you can scale the application workload across multiple secondaries to achieve the optimal end-user performance.</span><span class="sxs-lookup"><span data-stu-id="d77a2-191">The key **advantage** of this design pattern is that you can scale the application workload across multiple secondaries to achieve the optimal end-user performance.</span></span> <span data-ttu-id="d77a2-192">The **tradeoffs** of this option are:</span><span class="sxs-lookup"><span data-stu-id="d77a2-192">The **tradeoffs** of this option are:</span></span>

* <span data-ttu-id="d77a2-193">Read-write connections between the application instances and database have varying latency and cost</span><span class="sxs-lookup"><span data-stu-id="d77a2-193">Read-write connections between the application instances and database have varying latency and cost</span></span>
* <span data-ttu-id="d77a2-194">Application performance is impacted during the outage</span><span class="sxs-lookup"><span data-stu-id="d77a2-194">Application performance is impacted during the outage</span></span>
* <span data-ttu-id="d77a2-195">Application instances are required to dynamically change the SQL connection string after database failover.</span><span class="sxs-lookup"><span data-stu-id="d77a2-195">Application instances are required to dynamically change the SQL connection string after database failover.</span></span>  

> [!NOTE]
> <span data-ttu-id="d77a2-196">A similar approach can be used to offload specialized workloads such as reporting jobs, business intelligence tools, or backups.</span><span class="sxs-lookup"><span data-stu-id="d77a2-196">A similar approach can be used to offload specialized workloads such as reporting jobs, business intelligence tools, or backups.</span></span> <span data-ttu-id="d77a2-197">Typically these workloads consume significant database resources therefore it is recommended that you designate one of the secondary databases for them with the performance level matched to the anticipated workload.</span><span class="sxs-lookup"><span data-stu-id="d77a2-197">Typically these workloads consume significant database resources therefore it is recommended that you designate one of the secondary databases for them with the performance level matched to the anticipated workload.</span></span>
>
>

## <a name="design-pattern-3-active-passive-deployment-for-data-preservation"></a><span data-ttu-id="d77a2-198">Design pattern 3: Active-passive deployment for data preservation</span><span class="sxs-lookup"><span data-stu-id="d77a2-198">Design pattern 3: Active-passive deployment for data preservation</span></span>
<span data-ttu-id="d77a2-199">This option is best suited for applications with the following characteristics:</span><span class="sxs-lookup"><span data-stu-id="d77a2-199">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="d77a2-200">Any data loss is high business risk.</span><span class="sxs-lookup"><span data-stu-id="d77a2-200">Any data loss is high business risk.</span></span> <span data-ttu-id="d77a2-201">The database failover can only be used as a last resort if the outage is permanent.</span><span class="sxs-lookup"><span data-stu-id="d77a2-201">The database failover can only be used as a last resort if the outage is permanent.</span></span>
* <span data-ttu-id="d77a2-202">The application can operate in "read-only mode" for a period of time.</span><span class="sxs-lookup"><span data-stu-id="d77a2-202">The application can operate in "read-only mode" for a period of time.</span></span>

<span data-ttu-id="d77a2-203">In this pattern, the application switches to read-only mode when connected to the secondary database.</span><span class="sxs-lookup"><span data-stu-id="d77a2-203">In this pattern, the application switches to read-only mode when connected to the secondary database.</span></span> <span data-ttu-id="d77a2-204">The application logic in the primary region is co-located with the primary database and operates in read-write mode (RW).</span><span class="sxs-lookup"><span data-stu-id="d77a2-204">The application logic in the primary region is co-located with the primary database and operates in read-write mode (RW).</span></span> <span data-ttu-id="d77a2-205">The application logic in the secondary region is co-located with the secondary database and is ready to operate in read-only mode (RO).</span><span class="sxs-lookup"><span data-stu-id="d77a2-205">The application logic in the secondary region is co-located with the secondary database and is ready to operate in read-only mode (RO).</span></span>  <span data-ttu-id="d77a2-206">Traffic manager should be set up to use [failover routing](../traffic-manager/traffic-manager-configure-failover-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for both application instances.</span><span class="sxs-lookup"><span data-stu-id="d77a2-206">Traffic manager should be set up to use [failover routing](../traffic-manager/traffic-manager-configure-failover-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for both application instances.</span></span>

<span data-ttu-id="d77a2-207">The following diagram illustrates this configuration before an outage.</span><span class="sxs-lookup"><span data-stu-id="d77a2-207">The following diagram illustrates this configuration before an outage.</span></span>
<span data-ttu-id="d77a2-208">![Active-passive deployment before failover.</span><span class="sxs-lookup"><span data-stu-id="d77a2-208">![Active-passive deployment before failover.</span></span> <span data-ttu-id="d77a2-209">Cloud disaster recovery.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)</span><span class="sxs-lookup"><span data-stu-id="d77a2-209">Cloud disaster recovery.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)</span></span>

<span data-ttu-id="d77a2-210">When the traffic manager detects a connectivity failure to the primary region, it automatically switches user traffic to the application instance in the secondary region.</span><span class="sxs-lookup"><span data-stu-id="d77a2-210">When the traffic manager detects a connectivity failure to the primary region, it automatically switches user traffic to the application instance in the secondary region.</span></span> <span data-ttu-id="d77a2-211">With this pattern, it is important that you **do not** initiate database failover after the outage is detected.</span><span class="sxs-lookup"><span data-stu-id="d77a2-211">With this pattern, it is important that you **do not** initiate database failover after the outage is detected.</span></span> <span data-ttu-id="d77a2-212">The application in the secondary region is activated and operates in read-only mode using the secondary database.</span><span class="sxs-lookup"><span data-stu-id="d77a2-212">The application in the secondary region is activated and operates in read-only mode using the secondary database.</span></span> <span data-ttu-id="d77a2-213">This is illustrated by the following diagram.</span><span class="sxs-lookup"><span data-stu-id="d77a2-213">This is illustrated by the following diagram.</span></span>

![Outage: Application in read-only mode.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-2.png)

<span data-ttu-id="d77a2-216">Once the outage in the primary region is mitigated, traffic manager detects the restoration of connectivity in the primary region and switches user traffic back to the application instance in the primary region.</span><span class="sxs-lookup"><span data-stu-id="d77a2-216">Once the outage in the primary region is mitigated, traffic manager detects the restoration of connectivity in the primary region and switches user traffic back to the application instance in the primary region.</span></span> <span data-ttu-id="d77a2-217">That application instance resumes and operates in read-write mode using the primary database.</span><span class="sxs-lookup"><span data-stu-id="d77a2-217">That application instance resumes and operates in read-write mode using the primary database.</span></span>

> [!NOTE]
> <span data-ttu-id="d77a2-218">Because this pattern requires read-only access to the secondary it requires Active Geo-Replication.</span><span class="sxs-lookup"><span data-stu-id="d77a2-218">Because this pattern requires read-only access to the secondary it requires Active Geo-Replication.</span></span>
>
>

<span data-ttu-id="d77a2-219">In case of an outage in the secondary region, the traffic manager marks the application end-point in the primary region as degraded and the replication channel is suspended.</span><span class="sxs-lookup"><span data-stu-id="d77a2-219">In case of an outage in the secondary region, the traffic manager marks the application end-point in the primary region as degraded and the replication channel is suspended.</span></span> <span data-ttu-id="d77a2-220">However, this outage does not impact the application's performance during the outage.</span><span class="sxs-lookup"><span data-stu-id="d77a2-220">However, this outage does not impact the application's performance during the outage.</span></span> <span data-ttu-id="d77a2-221">Once the outage is mitigated, the secondary database is immediately synchronized with the primary.</span><span class="sxs-lookup"><span data-stu-id="d77a2-221">Once the outage is mitigated, the secondary database is immediately synchronized with the primary.</span></span> <span data-ttu-id="d77a2-222">During synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span><span class="sxs-lookup"><span data-stu-id="d77a2-222">During synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span>

![Outage: Secondary database.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-3.png)

<span data-ttu-id="d77a2-225">This design pattern has several **advantages**:</span><span class="sxs-lookup"><span data-stu-id="d77a2-225">This design pattern has several **advantages**:</span></span>

* <span data-ttu-id="d77a2-226">It avoids data loss during the temporary outages.</span><span class="sxs-lookup"><span data-stu-id="d77a2-226">It avoids data loss during the temporary outages.</span></span>
* <span data-ttu-id="d77a2-227">It does not require you to deploy a monitoring application as the recovery is triggered by traffic manager.</span><span class="sxs-lookup"><span data-stu-id="d77a2-227">It does not require you to deploy a monitoring application as the recovery is triggered by traffic manager.</span></span>
* <span data-ttu-id="d77a2-228">Downtime depends only on how quickly traffic manager detects the connectivity failure, which is configurable.</span><span class="sxs-lookup"><span data-stu-id="d77a2-228">Downtime depends only on how quickly traffic manager detects the connectivity failure, which is configurable.</span></span>

<span data-ttu-id="d77a2-229">The **tradeoffs** are:</span><span class="sxs-lookup"><span data-stu-id="d77a2-229">The **tradeoffs** are:</span></span>

* <span data-ttu-id="d77a2-230">Application must be able to operate in read-only mode.</span><span class="sxs-lookup"><span data-stu-id="d77a2-230">Application must be able to operate in read-only mode.</span></span>
* <span data-ttu-id="d77a2-231">It is required to dynamically switch to it when it is connected to a read-only database.</span><span class="sxs-lookup"><span data-stu-id="d77a2-231">It is required to dynamically switch to it when it is connected to a read-only database.</span></span>
* <span data-ttu-id="d77a2-232">Resumption of read-write operations requires recovery of the primary region, which means full data access may be disabled for hours or even days.</span><span class="sxs-lookup"><span data-stu-id="d77a2-232">Resumption of read-write operations requires recovery of the primary region, which means full data access may be disabled for hours or even days.</span></span>

> [!NOTE]
> <span data-ttu-id="d77a2-233">In case of a permanent service outage in the region, you must manually activate database failover and accept the data loss.</span><span class="sxs-lookup"><span data-stu-id="d77a2-233">In case of a permanent service outage in the region, you must manually activate database failover and accept the data loss.</span></span> <span data-ttu-id="d77a2-234">The application will be functional in the secondary region with read-write access to the database.</span><span class="sxs-lookup"><span data-stu-id="d77a2-234">The application will be functional in the secondary region with read-write access to the database.</span></span>
>
>

## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a><span data-ttu-id="d77a2-235">Business continuity planning: Choose an application design for cloud disaster recovery</span><span class="sxs-lookup"><span data-stu-id="d77a2-235">Business continuity planning: Choose an application design for cloud disaster recovery</span></span>
<span data-ttu-id="d77a2-236">Your specific cloud disaster recovery strategy can combine or extend these design patterns to best meet the needs of your application.</span><span class="sxs-lookup"><span data-stu-id="d77a2-236">Your specific cloud disaster recovery strategy can combine or extend these design patterns to best meet the needs of your application.</span></span>  <span data-ttu-id="d77a2-237">As mentioned earlier, the strategy you choose is based on the SLA you want to offer to your customers and the application deployment topology.</span><span class="sxs-lookup"><span data-stu-id="d77a2-237">As mentioned earlier, the strategy you choose is based on the SLA you want to offer to your customers and the application deployment topology.</span></span> <span data-ttu-id="d77a2-238">To help guide your decision, the following table compares the choices based on the estimated data loss or recovery point objective (RPO) and estimated recovery time (ERT).</span><span class="sxs-lookup"><span data-stu-id="d77a2-238">To help guide your decision, the following table compares the choices based on the estimated data loss or recovery point objective (RPO) and estimated recovery time (ERT).</span></span>

| <span data-ttu-id="d77a2-239">Pattern</span><span class="sxs-lookup"><span data-stu-id="d77a2-239">Pattern</span></span> | <span data-ttu-id="d77a2-240">RPO</span><span class="sxs-lookup"><span data-stu-id="d77a2-240">RPO</span></span> | <span data-ttu-id="d77a2-241">ERT</span><span class="sxs-lookup"><span data-stu-id="d77a2-241">ERT</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="d77a2-242">Active-passive deployment for disaster recovery with co-located database access</span><span class="sxs-lookup"><span data-stu-id="d77a2-242">Active-passive deployment for disaster recovery with co-located database access</span></span> |<span data-ttu-id="d77a2-243">Read-write access < 5 sec</span><span class="sxs-lookup"><span data-stu-id="d77a2-243">Read-write access < 5 sec</span></span> |<span data-ttu-id="d77a2-244">Failure detection time + failover API call + application verification test</span><span class="sxs-lookup"><span data-stu-id="d77a2-244">Failure detection time + failover API call + application verification test</span></span> |
| <span data-ttu-id="d77a2-245">Active-active deployment for application load balancing</span><span class="sxs-lookup"><span data-stu-id="d77a2-245">Active-active deployment for application load balancing</span></span> |<span data-ttu-id="d77a2-246">Read-write access < 5 sec</span><span class="sxs-lookup"><span data-stu-id="d77a2-246">Read-write access < 5 sec</span></span> |<span data-ttu-id="d77a2-247">Failure detection time + failover API call + SQL connection string change + application verification test</span><span class="sxs-lookup"><span data-stu-id="d77a2-247">Failure detection time + failover API call + SQL connection string change + application verification test</span></span> |
| <span data-ttu-id="d77a2-248">Active-passive deployment for data preservation</span><span class="sxs-lookup"><span data-stu-id="d77a2-248">Active-passive deployment for data preservation</span></span> |<span data-ttu-id="d77a2-249">Read-only access < 5 sec Read-write access = zero</span><span class="sxs-lookup"><span data-stu-id="d77a2-249">Read-only access < 5 sec Read-write access = zero</span></span> |<span data-ttu-id="d77a2-250">Read-only access = connectivity failure detection time + application verification test</span><span class="sxs-lookup"><span data-stu-id="d77a2-250">Read-only access = connectivity failure detection time + application verification test</span></span> <br><span data-ttu-id="d77a2-251">Read-write access = time to mitigate the outage</span><span class="sxs-lookup"><span data-stu-id="d77a2-251">Read-write access = time to mitigate the outage</span></span> |

## <a name="next-steps"></a><span data-ttu-id="d77a2-252">Next steps</span><span class="sxs-lookup"><span data-stu-id="d77a2-252">Next steps</span></span>
* <span data-ttu-id="d77a2-253">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="d77a2-253">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="d77a2-254">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="d77a2-254">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="d77a2-255">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="d77a2-255">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>
* <span data-ttu-id="d77a2-256">To learn about faster recovery options, see [Active-Geo-Replication](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="d77a2-256">To learn about faster recovery options, see [Active-Geo-Replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="d77a2-257">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span><span class="sxs-lookup"><span data-stu-id="d77a2-257">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span></span>
* <span data-ttu-id="d77a2-258">For information about Active Geo-Replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="d77a2-258">For information about Active Geo-Replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>









