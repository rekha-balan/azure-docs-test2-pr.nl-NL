---
title: Design globally available services using Azure SQL Database | Microsoft Docs
description: Learn about application design for highly available services using Azure SQL Database.
keywords: cloud disaster recovery,disaster recovery solutions,app data backup,geo-replication,business continuity planning
services: sql-database
author: anosov1960
manager: craigg
ms.service: sql-database
ms.custom: business continuity
ms.topic: conceptual
ms.date: 07/26/2018
ms.author: sashan
ms.reviewer: carlrab
ms.openlocfilehash: 88a6e1a66390b2b317e1e30a71455ad693e6d7df
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44800883"
---
# <a name="designing-globally-available-services-using-azure-sql-database"></a><span data-ttu-id="57144-104">Designing globally available services using Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="57144-104">Designing globally available services using Azure SQL Database</span></span>

<span data-ttu-id="57144-105">When building and deploying cloud services with Azure SQL Database, you use [failover groups and active geo-replication](sql-database-geo-replication-overview.md) to provide resilience to regional outages and catastrophic failures.</span><span class="sxs-lookup"><span data-stu-id="57144-105">When building and deploying cloud services with Azure SQL Database, you use [failover groups and active geo-replication](sql-database-geo-replication-overview.md) to provide resilience to regional outages and catastrophic failures.</span></span> <span data-ttu-id="57144-106">The same feature allows you to create globally distributed applications optimized for local access to the data.</span><span class="sxs-lookup"><span data-stu-id="57144-106">The same feature allows you to create globally distributed applications optimized for local access to the data.</span></span> <span data-ttu-id="57144-107">This article discusses common application patterns, including the benefits and trade-offs of each option.</span><span class="sxs-lookup"><span data-stu-id="57144-107">This article discusses common application patterns, including the benefits and trade-offs of each option.</span></span> 

> [!NOTE]
> <span data-ttu-id="57144-108">If you are using Premium or Business Critical databases and elastic pools, you can make them resilient to regional outages by converting them to zone redundant deployment configuration.</span><span class="sxs-lookup"><span data-stu-id="57144-108">If you are using Premium or Business Critical databases and elastic pools, you can make them resilient to regional outages by converting them to zone redundant deployment configuration.</span></span> <span data-ttu-id="57144-109">See [Zone-redundant databases](sql-database-high-availability.md).</span><span class="sxs-lookup"><span data-stu-id="57144-109">See [Zone-redundant databases](sql-database-high-availability.md).</span></span>  

## <a name="scenario-1-using-two-azure-regions-for-business-continuity-with-minimal-downtime"></a><span data-ttu-id="57144-110">Scenario 1: Using two Azure regions for business continuity with minimal downtime</span><span class="sxs-lookup"><span data-stu-id="57144-110">Scenario 1: Using two Azure regions for business continuity with minimal downtime</span></span>
<span data-ttu-id="57144-111">In this scenario, the applications have the following characteristics:</span><span class="sxs-lookup"><span data-stu-id="57144-111">In this scenario, the applications have the following characteristics:</span></span> 
*   <span data-ttu-id="57144-112">Application is active in one Azure region</span><span class="sxs-lookup"><span data-stu-id="57144-112">Application is active in one Azure region</span></span>
*   <span data-ttu-id="57144-113">All database sessions require read and write access (RW) to data</span><span class="sxs-lookup"><span data-stu-id="57144-113">All database sessions require read and write access (RW) to data</span></span>
*   <span data-ttu-id="57144-114">Web tier and data tier must be collocated to reduce latency and traffic cost</span><span class="sxs-lookup"><span data-stu-id="57144-114">Web tier and data tier must be collocated to reduce latency and traffic cost</span></span> 
*   <span data-ttu-id="57144-115">Fundamentally, downtime is a higher business risk for these applications than data loss</span><span class="sxs-lookup"><span data-stu-id="57144-115">Fundamentally, downtime is a higher business risk for these applications than data loss</span></span>

<span data-ttu-id="57144-116">In this case, the application deployment topology is optimized for handling regional disasters when all application components need to failover together.</span><span class="sxs-lookup"><span data-stu-id="57144-116">In this case, the application deployment topology is optimized for handling regional disasters when all application components need to failover together.</span></span> <span data-ttu-id="57144-117">The diagram below shows this topology.</span><span class="sxs-lookup"><span data-stu-id="57144-117">The diagram below shows this topology.</span></span> <span data-ttu-id="57144-118">For geographic redundancy, the application’s resources are deployed to Region A and B. However, the resources in Region B are not utilized until Region A fails.</span><span class="sxs-lookup"><span data-stu-id="57144-118">For geographic redundancy, the application’s resources are deployed to Region A and B. However, the resources in Region B are not utilized until Region A fails.</span></span> <span data-ttu-id="57144-119">A failover group is configured between the two regions to manage database connectivity, replication and failover.</span><span class="sxs-lookup"><span data-stu-id="57144-119">A failover group is configured between the two regions to manage database connectivity, replication and failover.</span></span> <span data-ttu-id="57144-120">The web service in both regions is configured to access the database via the read-write listener **&lt;failover-group-name&gt;.database.windows.net** (1).</span><span class="sxs-lookup"><span data-stu-id="57144-120">The web service in both regions is configured to access the database via the read-write listener **&lt;failover-group-name&gt;.database.windows.net** (1).</span></span> <span data-ttu-id="57144-121">Traffic manager is set up to use [priority routing method](../traffic-manager/traffic-manager-configure-priority-routing-method.md) (2).</span><span class="sxs-lookup"><span data-stu-id="57144-121">Traffic manager is set up to use [priority routing method](../traffic-manager/traffic-manager-configure-priority-routing-method.md) (2).</span></span>  

> [!NOTE]
> <span data-ttu-id="57144-122">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span><span class="sxs-lookup"><span data-stu-id="57144-122">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span></span> <span data-ttu-id="57144-123">You can use any load-balancing solution that supports priority routing method.</span><span class="sxs-lookup"><span data-stu-id="57144-123">You can use any load-balancing solution that supports priority routing method.</span></span>    
>

<span data-ttu-id="57144-124">The following diagram shows this configuration before an outage:</span><span class="sxs-lookup"><span data-stu-id="57144-124">The following diagram shows this configuration before an outage:</span></span>

![Scenario 1.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario1-a.png)

<span data-ttu-id="57144-127">After an outage in the primary region, the SQL Database service detects that the primary database is not accessible and triggers failover to the secondary region based on the parameters of the automatic failover policy (1).</span><span class="sxs-lookup"><span data-stu-id="57144-127">After an outage in the primary region, the SQL Database service detects that the primary database is not accessible and triggers failover to the secondary region based on the parameters of the automatic failover policy (1).</span></span> <span data-ttu-id="57144-128">Depending on your application SLA, you can configure a grace period that controls the time between the detection of the outage and the failover itself.</span><span class="sxs-lookup"><span data-stu-id="57144-128">Depending on your application SLA, you can configure a grace period that controls the time between the detection of the outage and the failover itself.</span></span> <span data-ttu-id="57144-129">It is possible that  traffic manager initiates the endpoint failover before the failover group triggers the failover of the database.</span><span class="sxs-lookup"><span data-stu-id="57144-129">It is possible that  traffic manager initiates the endpoint failover before the failover group triggers the failover of the database.</span></span> <span data-ttu-id="57144-130">In that case the web application cannot immediately reconnect to the database.</span><span class="sxs-lookup"><span data-stu-id="57144-130">In that case the web application cannot immediately reconnect to the database.</span></span> <span data-ttu-id="57144-131">But the reconnections will automatically succeed as soon as the database failover completes.</span><span class="sxs-lookup"><span data-stu-id="57144-131">But the reconnections will automatically succeed as soon as the database failover completes.</span></span> <span data-ttu-id="57144-132">When the failed region is restored and back online, the old primary automatically reconnects as a new secondary.</span><span class="sxs-lookup"><span data-stu-id="57144-132">When the failed region is restored and back online, the old primary automatically reconnects as a new secondary.</span></span> <span data-ttu-id="57144-133">The diagram below illustrates the configuration after failover.</span><span class="sxs-lookup"><span data-stu-id="57144-133">The diagram below illustrates the configuration after failover.</span></span>
 
> [!NOTE]
> <span data-ttu-id="57144-134">All transactions committed after the failover are lost during the reconnection.</span><span class="sxs-lookup"><span data-stu-id="57144-134">All transactions committed after the failover are lost during the reconnection.</span></span> <span data-ttu-id="57144-135">After the failover is completed, the application in region B is able to reconnect and restart processing the user requests.</span><span class="sxs-lookup"><span data-stu-id="57144-135">After the failover is completed, the application in region B is able to reconnect and restart processing the user requests.</span></span> <span data-ttu-id="57144-136">Both the  web application and the primary database are now in region B and remain co-located.</span><span class="sxs-lookup"><span data-stu-id="57144-136">Both the  web application and the primary database are now in region B and remain co-located.</span></span> <span data-ttu-id="57144-137">n></span><span class="sxs-lookup"><span data-stu-id="57144-137">n></span></span>

![Scenario 1.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario1-b.png)

<span data-ttu-id="57144-140">If an outage happens in region B, the replication process between the primary and the secondary database gets suspended but the link between the two remains intact (1).</span><span class="sxs-lookup"><span data-stu-id="57144-140">If an outage happens in region B, the replication process between the primary and the secondary database gets suspended but the link between the two remains intact (1).</span></span> <span data-ttu-id="57144-141">Traffic managed detects that connectivity to Region B is broken and marks the endpoint web app 2 as Degraded (2).</span><span class="sxs-lookup"><span data-stu-id="57144-141">Traffic managed detects that connectivity to Region B is broken and marks the endpoint web app 2 as Degraded (2).</span></span> <span data-ttu-id="57144-142">The application's performance is not impacted in this case, but the database becomes exposed and therefore at higher risk of data loss in case region A fails in succession.</span><span class="sxs-lookup"><span data-stu-id="57144-142">The application's performance is not impacted in this case, but the database becomes exposed and therefore at higher risk of data loss in case region A fails in succession.</span></span>

> [!NOTE]
> <span data-ttu-id="57144-143">For disaster recovery, we recommend the configuration with application deployment limited to two regions.</span><span class="sxs-lookup"><span data-stu-id="57144-143">For disaster recovery, we recommend the configuration with application deployment limited to two regions.</span></span> <span data-ttu-id="57144-144">This is because most of the Azure geographies have only two regions.</span><span class="sxs-lookup"><span data-stu-id="57144-144">This is because most of the Azure geographies have only two regions.</span></span> <span data-ttu-id="57144-145">This configuration does not protect your application from a simultaneous catastrophic failure of both regions.</span><span class="sxs-lookup"><span data-stu-id="57144-145">This configuration does not protect your application from a simultaneous catastrophic failure of both regions.</span></span> <span data-ttu-id="57144-146">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="57144-146">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span>
>

 <span data-ttu-id="57144-147">Once the outage is mitigated, the secondary database automatically resynchronizes with the primary.</span><span class="sxs-lookup"><span data-stu-id="57144-147">Once the outage is mitigated, the secondary database automatically resynchronizes with the primary.</span></span> <span data-ttu-id="57144-148">During synchronization, performance of the primary can be impacted.</span><span class="sxs-lookup"><span data-stu-id="57144-148">During synchronization, performance of the primary can be impacted.</span></span> <span data-ttu-id="57144-149">The specific impact depends on the amount of data the new primary acquired since the failover.</span><span class="sxs-lookup"><span data-stu-id="57144-149">The specific impact depends on the amount of data the new primary acquired since the failover.</span></span> <span data-ttu-id="57144-150">The following diagram illustrates an outage in the secondary region:</span><span class="sxs-lookup"><span data-stu-id="57144-150">The following diagram illustrates an outage in the secondary region:</span></span>

![Scenario 1.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario1-c.png)

<span data-ttu-id="57144-153">The key **advantages** of this design pattern are:</span><span class="sxs-lookup"><span data-stu-id="57144-153">The key **advantages** of this design pattern are:</span></span>

* <span data-ttu-id="57144-154">The same web application is deployed to both regions without any region-specific configuration and doesn’t require additional logic to manage failover.</span><span class="sxs-lookup"><span data-stu-id="57144-154">The same web application is deployed to both regions without any region-specific configuration and doesn’t require additional logic to manage failover.</span></span> 
* <span data-ttu-id="57144-155">Application performance is not impacted by failover as the web application and the database are always co-located.</span><span class="sxs-lookup"><span data-stu-id="57144-155">Application performance is not impacted by failover as the web application and the database are always co-located.</span></span>

<span data-ttu-id="57144-156">The main **tradeoff** is that the application resources in Region B are underutilized most of the time.</span><span class="sxs-lookup"><span data-stu-id="57144-156">The main **tradeoff** is that the application resources in Region B are underutilized most of the time.</span></span>

## <a name="scenario-2-azure-regions-for-business-continuity-with-maximum-data-preservation"></a><span data-ttu-id="57144-157">Scenario 2: Azure regions for business continuity with maximum data preservation</span><span class="sxs-lookup"><span data-stu-id="57144-157">Scenario 2: Azure regions for business continuity with maximum data preservation</span></span>
<span data-ttu-id="57144-158">This option is best suited for applications with the following characteristics:</span><span class="sxs-lookup"><span data-stu-id="57144-158">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="57144-159">Any data loss is high business risk.</span><span class="sxs-lookup"><span data-stu-id="57144-159">Any data loss is high business risk.</span></span> <span data-ttu-id="57144-160">The database failover can only be used as a last resort if the outage is caused by a catastrophic failure.</span><span class="sxs-lookup"><span data-stu-id="57144-160">The database failover can only be used as a last resort if the outage is caused by a catastrophic failure.</span></span>
* <span data-ttu-id="57144-161">The application supports read-only and read-write modes of operations and can operate in "read-only mode" for a period of time.</span><span class="sxs-lookup"><span data-stu-id="57144-161">The application supports read-only and read-write modes of operations and can operate in "read-only mode" for a period of time.</span></span>

<span data-ttu-id="57144-162">In this pattern, the application switches to read-only mode when the read-write connections start getting time-out errors.</span><span class="sxs-lookup"><span data-stu-id="57144-162">In this pattern, the application switches to read-only mode when the read-write connections start getting time-out errors.</span></span> <span data-ttu-id="57144-163">The Web Application is deployed to both regions and include a connection to the read-write listener endpoint and different connection to the read-only listener endpoint (1).</span><span class="sxs-lookup"><span data-stu-id="57144-163">The Web Application is deployed to both regions and include a connection to the read-write listener endpoint and different connection to the read-only listener endpoint (1).</span></span> <span data-ttu-id="57144-164">The Traffic manager profile should use [priority routing](../traffic-manager/traffic-manager-configure-priority-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="57144-164">The Traffic manager profile should use [priority routing](../traffic-manager/traffic-manager-configure-priority-routing-method.md).</span></span> <span data-ttu-id="57144-165">[End point monitoring](../traffic-manager/traffic-manager-monitoring.md) should be enabled for the application endpoint in each region (2).</span><span class="sxs-lookup"><span data-stu-id="57144-165">[End point monitoring](../traffic-manager/traffic-manager-monitoring.md) should be enabled for the application endpoint in each region (2).</span></span>

<span data-ttu-id="57144-166">The following diagram illustrates this configuration before an outage:</span><span class="sxs-lookup"><span data-stu-id="57144-166">The following diagram illustrates this configuration before an outage:</span></span>

![Scenario 2.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario2-a.png)

<span data-ttu-id="57144-169">When the traffic manager detects a connectivity failure to region A, it automatically switches user traffic to the application instance in region B. With this pattern, it is important that you set the grace period with data loss to a sufficiently high value, for example 24 hours.</span><span class="sxs-lookup"><span data-stu-id="57144-169">When the traffic manager detects a connectivity failure to region A, it automatically switches user traffic to the application instance in region B. With this pattern, it is important that you set the grace period with data loss to a sufficiently high value, for example 24 hours.</span></span> <span data-ttu-id="57144-170">It ensures that data loss is prevented if the outage is mitigated within that time.</span><span class="sxs-lookup"><span data-stu-id="57144-170">It ensures that data loss is prevented if the outage is mitigated within that time.</span></span> <span data-ttu-id="57144-171">When the Web application in region B is activated the read-write operations start failing.</span><span class="sxs-lookup"><span data-stu-id="57144-171">When the Web application in region B is activated the read-write operations start failing.</span></span> <span data-ttu-id="57144-172">At that point, it should switch to the read-only mode (1).</span><span class="sxs-lookup"><span data-stu-id="57144-172">At that point, it should switch to the read-only mode (1).</span></span> <span data-ttu-id="57144-173">In this mode the requests are automatically routed to the secondary database.</span><span class="sxs-lookup"><span data-stu-id="57144-173">In this mode the requests are automatically routed to the secondary database.</span></span> <span data-ttu-id="57144-174">If the outage is caused by a catastrophic failure, most likely it cannot be mitigated within the grace period.</span><span class="sxs-lookup"><span data-stu-id="57144-174">If the outage is caused by a catastrophic failure, most likely it cannot be mitigated within the grace period.</span></span> <span data-ttu-id="57144-175">When it expires the failover group triggers the failover.</span><span class="sxs-lookup"><span data-stu-id="57144-175">When it expires the failover group triggers the failover.</span></span> <span data-ttu-id="57144-176">After that the read-write listener becomes available and the connections to it stop failing (2).</span><span class="sxs-lookup"><span data-stu-id="57144-176">After that the read-write listener becomes available and the connections to it stop failing (2).</span></span> <span data-ttu-id="57144-177">The following diagram illustrates the two stages of the recovery process.</span><span class="sxs-lookup"><span data-stu-id="57144-177">The following diagram illustrates the two stages of the recovery process.</span></span>

> [!NOTE]
> <span data-ttu-id="57144-178">If the outage in the primary region is mitigated within the grace period, traffic manager detects the restoration of connectivity in the primary region and switches user traffic back to the application instance in region A. That application instance resumes and operates in read-write mode using the primary database in region A as illustrated by the previous diagram.</span><span class="sxs-lookup"><span data-stu-id="57144-178">If the outage in the primary region is mitigated within the grace period, traffic manager detects the restoration of connectivity in the primary region and switches user traffic back to the application instance in region A. That application instance resumes and operates in read-write mode using the primary database in region A as illustrated by the previous diagram.</span></span>
>

![Scenario 2.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario2-b.png)

<span data-ttu-id="57144-181">If an outage happens in region B, the traffic manager detects the failure of the end point web-app-2 in region B and marks it degraded (1).</span><span class="sxs-lookup"><span data-stu-id="57144-181">If an outage happens in region B, the traffic manager detects the failure of the end point web-app-2 in region B and marks it degraded (1).</span></span> <span data-ttu-id="57144-182">In the meantime, the failover group switches the read-only listener to region A (2).</span><span class="sxs-lookup"><span data-stu-id="57144-182">In the meantime, the failover group switches the read-only listener to region A (2).</span></span> <span data-ttu-id="57144-183">This outage does not impact the end user experience but the primary database is exposed during the outage.</span><span class="sxs-lookup"><span data-stu-id="57144-183">This outage does not impact the end user experience but the primary database is exposed during the outage.</span></span> <span data-ttu-id="57144-184">The following diagram illustrates a failure in the secondary region:</span><span class="sxs-lookup"><span data-stu-id="57144-184">The following diagram illustrates a failure in the secondary region:</span></span>

![Scenario 2.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario2-c.png)

<span data-ttu-id="57144-187">Once the outage is mitigated, the secondary database is immediately synchronized with the primary and the read-only listener is switched back to the secondary database in region B. During synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span><span class="sxs-lookup"><span data-stu-id="57144-187">Once the outage is mitigated, the secondary database is immediately synchronized with the primary and the read-only listener is switched back to the secondary database in region B. During synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span>

<span data-ttu-id="57144-188">This design pattern has several **advantages**:</span><span class="sxs-lookup"><span data-stu-id="57144-188">This design pattern has several **advantages**:</span></span>

* <span data-ttu-id="57144-189">It avoids data loss during the temporary outages.</span><span class="sxs-lookup"><span data-stu-id="57144-189">It avoids data loss during the temporary outages.</span></span>
* <span data-ttu-id="57144-190">Downtime depends only on how quickly traffic manager detects the connectivity failure, which is configurable.</span><span class="sxs-lookup"><span data-stu-id="57144-190">Downtime depends only on how quickly traffic manager detects the connectivity failure, which is configurable.</span></span>

<span data-ttu-id="57144-191">The **tradeoff** is that the application must be able to operate in read-only mode.</span><span class="sxs-lookup"><span data-stu-id="57144-191">The **tradeoff** is that the application must be able to operate in read-only mode.</span></span>

## <a name="scenario-3-application-relocation-to-a-different-geography-without-data-loss-and-near-zero-downtime"></a><span data-ttu-id="57144-192">Scenario 3: Application relocation to a different geography without data loss and near zero downtime</span><span class="sxs-lookup"><span data-stu-id="57144-192">Scenario 3: Application relocation to a different geography without data loss and near zero downtime</span></span> 
<span data-ttu-id="57144-193">In this scenario the application has the following characteristics:</span><span class="sxs-lookup"><span data-stu-id="57144-193">In this scenario the application has the following characteristics:</span></span> 
* <span data-ttu-id="57144-194">The end users access the application from different geographies</span><span class="sxs-lookup"><span data-stu-id="57144-194">The end users access the application from different geographies</span></span>
* <span data-ttu-id="57144-195">The application includes read-only workloads that do not depend on full synchronization with the latest updates</span><span class="sxs-lookup"><span data-stu-id="57144-195">The application includes read-only workloads that do not depend on full synchronization with the latest updates</span></span>
* <span data-ttu-id="57144-196">Write access to data should be supported in the same geography for majority of the users</span><span class="sxs-lookup"><span data-stu-id="57144-196">Write access to data should be supported in the same geography for majority of the users</span></span> 
* <span data-ttu-id="57144-197">Read latency is critical for the end user experience</span><span class="sxs-lookup"><span data-stu-id="57144-197">Read latency is critical for the end user experience</span></span> 


<span data-ttu-id="57144-198">In order to meet these requirements you need to guarantee that the user device **always** connects to the application deployed in the same geography for the read-only operations, such as browsing data, analytics etc. Whereas, the OLTP operations are processed in the same geography **most of the time**.</span><span class="sxs-lookup"><span data-stu-id="57144-198">In order to meet these requirements you need to guarantee that the user device **always** connects to the application deployed in the same geography for the read-only operations, such as browsing data, analytics etc. Whereas, the OLTP operations are processed in the same geography **most of the time**.</span></span> <span data-ttu-id="57144-199">For example, during the day time OLTP operations are processed in the same geography, but during the off hours they could be processed in a different geography.</span><span class="sxs-lookup"><span data-stu-id="57144-199">For example, during the day time OLTP operations are processed in the same geography, but during the off hours they could be processed in a different geography.</span></span> <span data-ttu-id="57144-200">If the end user activity mostly happens during the working hours, you can guarantee the optimal performance for most of the users most of the time.</span><span class="sxs-lookup"><span data-stu-id="57144-200">If the end user activity mostly happens during the working hours, you can guarantee the optimal performance for most of the users most of the time.</span></span> <span data-ttu-id="57144-201">The following diagram shows this topology.</span><span class="sxs-lookup"><span data-stu-id="57144-201">The following diagram shows this topology.</span></span> 
 
<span data-ttu-id="57144-202">The application’s resources should be deployed in each geography where you have substantial usage demand.</span><span class="sxs-lookup"><span data-stu-id="57144-202">The application’s resources should be deployed in each geography where you have substantial usage demand.</span></span> <span data-ttu-id="57144-203">For example, if your application is actively used in the United States, European Union and South East Asia the application should be deployed to all of these geographies.</span><span class="sxs-lookup"><span data-stu-id="57144-203">For example, if your application is actively used in the United States, European Union and South East Asia the application should be deployed to all of these geographies.</span></span> <span data-ttu-id="57144-204">The primary database should be dynamically switched from one geography to the next at the end of the working hours.</span><span class="sxs-lookup"><span data-stu-id="57144-204">The primary database should be dynamically switched from one geography to the next at the end of the working hours.</span></span> <span data-ttu-id="57144-205">This method is called “follow the sun”.</span><span class="sxs-lookup"><span data-stu-id="57144-205">This method is called “follow the sun”.</span></span> <span data-ttu-id="57144-206">The OLTP workload always connects to the database via the read-write listener **&lt;failover-group-name&gt;.database.windows.net** (1).</span><span class="sxs-lookup"><span data-stu-id="57144-206">The OLTP workload always connects to the database via the read-write listener **&lt;failover-group-name&gt;.database.windows.net** (1).</span></span> <span data-ttu-id="57144-207">The read-only workload connects to the local database directly using the databases server endpoint **&lt;server-name&gt;.database.windows.net** (2).</span><span class="sxs-lookup"><span data-stu-id="57144-207">The read-only workload connects to the local database directly using the databases server endpoint **&lt;server-name&gt;.database.windows.net** (2).</span></span> <span data-ttu-id="57144-208">Traffic manager is configured with the [performance routing method](../traffic-manager/traffic-manager-configure-performance-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="57144-208">Traffic manager is configured with the [performance routing method](../traffic-manager/traffic-manager-configure-performance-routing-method.md).</span></span> <span data-ttu-id="57144-209">It ensures that the end user’s device is connected to the web service in the closest region.</span><span class="sxs-lookup"><span data-stu-id="57144-209">It ensures that the end user’s device is connected to the web service in the closest region.</span></span> <span data-ttu-id="57144-210">Traffic manager should be set up with end point monitoring enabled for each web service end point (3).</span><span class="sxs-lookup"><span data-stu-id="57144-210">Traffic manager should be set up with end point monitoring enabled for each web service end point (3).</span></span>

> [!NOTE]
> <span data-ttu-id="57144-211">The failover group configuration defines which region is used for failover.</span><span class="sxs-lookup"><span data-stu-id="57144-211">The failover group configuration defines which region is used for failover.</span></span> <span data-ttu-id="57144-212">Because the new primary is in a different geography the failover results in longer latency for both OLTP and read-only workloads until the impacted region is back online.</span><span class="sxs-lookup"><span data-stu-id="57144-212">Because the new primary is in a different geography the failover results in longer latency for both OLTP and read-only workloads until the impacted region is back online.</span></span>
>

![Scenario 3.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario3-a.png)

<span data-ttu-id="57144-215">At the end of the day (for example at 11PM local time) the active databases should be switched to the next region (North Europe).</span><span class="sxs-lookup"><span data-stu-id="57144-215">At the end of the day (for example at 11PM local time) the active databases should be switched to the next region (North Europe).</span></span> <span data-ttu-id="57144-216">This task can be fully automated by using [Azure scheduling service](../scheduler/scheduler-intro.md).</span><span class="sxs-lookup"><span data-stu-id="57144-216">This task can be fully automated by using [Azure scheduling service](../scheduler/scheduler-intro.md).</span></span>  <span data-ttu-id="57144-217">The task involves the following steps:</span><span class="sxs-lookup"><span data-stu-id="57144-217">The task involves the following steps:</span></span>
* <span data-ttu-id="57144-218">Switch primary server in the failover group to North Europe using friendly failover (1)</span><span class="sxs-lookup"><span data-stu-id="57144-218">Switch primary server in the failover group to North Europe using friendly failover (1)</span></span>
* <span data-ttu-id="57144-219">Remove the failover group between East US and North Europe</span><span class="sxs-lookup"><span data-stu-id="57144-219">Remove the failover group between East US and North Europe</span></span>
* <span data-ttu-id="57144-220">Create a new failover group with the same name but between North Europe and East Asia (2).</span><span class="sxs-lookup"><span data-stu-id="57144-220">Create a new failover group with the same name but between North Europe and East Asia (2).</span></span> 
* <span data-ttu-id="57144-221">Add the primary in North Europe and secondary in East Asia to this failover group (3).</span><span class="sxs-lookup"><span data-stu-id="57144-221">Add the primary in North Europe and secondary in East Asia to this failover group (3).</span></span>


<span data-ttu-id="57144-222">The following diagram illustrates the new configuration after the planned failover:</span><span class="sxs-lookup"><span data-stu-id="57144-222">The following diagram illustrates the new configuration after the planned failover:</span></span>

![Scenario 3.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario3-b.png)

<span data-ttu-id="57144-225">If an outage happens in North Europe for example, the automatic database failover is initiated by the failover group, which effectively results in moving the application to the next region ahead of schedule (1).</span><span class="sxs-lookup"><span data-stu-id="57144-225">If an outage happens in North Europe for example, the automatic database failover is initiated by the failover group, which effectively results in moving the application to the next region ahead of schedule (1).</span></span>  <span data-ttu-id="57144-226">In that case the US East is the only remaining secondary region until North Europe is back online.</span><span class="sxs-lookup"><span data-stu-id="57144-226">In that case the US East is the only remaining secondary region until North Europe is back online.</span></span> <span data-ttu-id="57144-227">The remaining two regions serve the customers in all three geographies by switching roles.</span><span class="sxs-lookup"><span data-stu-id="57144-227">The remaining two regions serve the customers in all three geographies by switching roles.</span></span> <span data-ttu-id="57144-228">Azure scheduler has to be adjusted accordingly.</span><span class="sxs-lookup"><span data-stu-id="57144-228">Azure scheduler has to be adjusted accordingly.</span></span> <span data-ttu-id="57144-229">Because the remaining regions get additional user traffic from Europe, the application's performance is impacted not only by additional latency but also by an increased number of end user connections.</span><span class="sxs-lookup"><span data-stu-id="57144-229">Because the remaining regions get additional user traffic from Europe, the application's performance is impacted not only by additional latency but also by an increased number of end user connections.</span></span> <span data-ttu-id="57144-230">Once the outage is mitigated in North Europe, the secondary database there is immediately synchronized with the current primary.</span><span class="sxs-lookup"><span data-stu-id="57144-230">Once the outage is mitigated in North Europe, the secondary database there is immediately synchronized with the current primary.</span></span> <span data-ttu-id="57144-231">The following diagram illustrates an outage in North Europe:</span><span class="sxs-lookup"><span data-stu-id="57144-231">The following diagram illustrates an outage in North Europe:</span></span>

![Scenario 3.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/scenario3-c.png)

> [!NOTE]
> <span data-ttu-id="57144-234">You can reduce the time when the end user’s experience in Europe is degraded by the long latency.</span><span class="sxs-lookup"><span data-stu-id="57144-234">You can reduce the time when the end user’s experience in Europe is degraded by the long latency.</span></span> <span data-ttu-id="57144-235">To do that you should proactively deploy an application copy and create the secondary database(s) in another local region (West Europe) as a replacement of the offline application instance in North Europe.</span><span class="sxs-lookup"><span data-stu-id="57144-235">To do that you should proactively deploy an application copy and create the secondary database(s) in another local region (West Europe) as a replacement of the offline application instance in North Europe.</span></span> <span data-ttu-id="57144-236">When the latter is back online you can decide whether to continue using West Europe or to remove the copy of the application there and switch back to using North Europe,</span><span class="sxs-lookup"><span data-stu-id="57144-236">When the latter is back online you can decide whether to continue using West Europe or to remove the copy of the application there and switch back to using North Europe,</span></span>
>

<span data-ttu-id="57144-237">The key **benefits** of this design are:</span><span class="sxs-lookup"><span data-stu-id="57144-237">The key **benefits** of this design are:</span></span>
* <span data-ttu-id="57144-238">The read-only application workload accesses data in the closets region at all times.</span><span class="sxs-lookup"><span data-stu-id="57144-238">The read-only application workload accesses data in the closets region at all times.</span></span> 
* <span data-ttu-id="57144-239">The read-write application workload accesses data in the closest region during the period of the highest activity in each geography</span><span class="sxs-lookup"><span data-stu-id="57144-239">The read-write application workload accesses data in the closest region during the period of the highest activity in each geography</span></span>
* <span data-ttu-id="57144-240">Because the application is deployed to multiple regions, it can survive a loss of one of the regions without any significant downtime.</span><span class="sxs-lookup"><span data-stu-id="57144-240">Because the application is deployed to multiple regions, it can survive a loss of one of the regions without any significant downtime.</span></span> 

<span data-ttu-id="57144-241">But there are some **tradeoffs**:</span><span class="sxs-lookup"><span data-stu-id="57144-241">But there are some **tradeoffs**:</span></span>
* <span data-ttu-id="57144-242">A regional outage results in the geography to be impacted by longer latency.</span><span class="sxs-lookup"><span data-stu-id="57144-242">A regional outage results in the geography to be impacted by longer latency.</span></span> <span data-ttu-id="57144-243">Both read-write and read-only workloads is served by the application in a different geography.</span><span class="sxs-lookup"><span data-stu-id="57144-243">Both read-write and read-only workloads is served by the application in a different geography.</span></span> 
* <span data-ttu-id="57144-244">The read-only workloads must connect to a different end point in each region.</span><span class="sxs-lookup"><span data-stu-id="57144-244">The read-only workloads must connect to a different end point in each region.</span></span> 


## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a><span data-ttu-id="57144-245">Business continuity planning: Choose an application design for cloud disaster recovery</span><span class="sxs-lookup"><span data-stu-id="57144-245">Business continuity planning: Choose an application design for cloud disaster recovery</span></span>
<span data-ttu-id="57144-246">Your specific cloud disaster recovery strategy can combine or extend these design patterns to best meet the needs of your application.</span><span class="sxs-lookup"><span data-stu-id="57144-246">Your specific cloud disaster recovery strategy can combine or extend these design patterns to best meet the needs of your application.</span></span>  <span data-ttu-id="57144-247">As mentioned earlier, the strategy you choose is based on the SLA you want to offer to your customers and the application deployment topology.</span><span class="sxs-lookup"><span data-stu-id="57144-247">As mentioned earlier, the strategy you choose is based on the SLA you want to offer to your customers and the application deployment topology.</span></span> <span data-ttu-id="57144-248">To help guide your decision, the following table compares the choices based on recovery point objective (RPO) and estimated recovery time (ERT).</span><span class="sxs-lookup"><span data-stu-id="57144-248">To help guide your decision, the following table compares the choices based on recovery point objective (RPO) and estimated recovery time (ERT).</span></span>

| <span data-ttu-id="57144-249">Pattern</span><span class="sxs-lookup"><span data-stu-id="57144-249">Pattern</span></span> | <span data-ttu-id="57144-250">RPO</span><span class="sxs-lookup"><span data-stu-id="57144-250">RPO</span></span> | <span data-ttu-id="57144-251">ERT</span><span class="sxs-lookup"><span data-stu-id="57144-251">ERT</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="57144-252">Active-passive deployment for disaster recovery with co-located database access</span><span class="sxs-lookup"><span data-stu-id="57144-252">Active-passive deployment for disaster recovery with co-located database access</span></span> |<span data-ttu-id="57144-253">Read-write access < 5 sec</span><span class="sxs-lookup"><span data-stu-id="57144-253">Read-write access < 5 sec</span></span> |<span data-ttu-id="57144-254">Failure detection time + DNS TTL</span><span class="sxs-lookup"><span data-stu-id="57144-254">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="57144-255">Active-active deployment for application load balancing</span><span class="sxs-lookup"><span data-stu-id="57144-255">Active-active deployment for application load balancing</span></span> |<span data-ttu-id="57144-256">Read-write access < 5 sec</span><span class="sxs-lookup"><span data-stu-id="57144-256">Read-write access < 5 sec</span></span> |<span data-ttu-id="57144-257">Failure detection time + DNS TTL</span><span class="sxs-lookup"><span data-stu-id="57144-257">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="57144-258">Active-passive deployment for data preservation</span><span class="sxs-lookup"><span data-stu-id="57144-258">Active-passive deployment for data preservation</span></span> |<span data-ttu-id="57144-259">Read-only access < 5 sec</span><span class="sxs-lookup"><span data-stu-id="57144-259">Read-only access < 5 sec</span></span> | <span data-ttu-id="57144-260">Read-only access = 0</span><span class="sxs-lookup"><span data-stu-id="57144-260">Read-only access = 0</span></span> |
||<span data-ttu-id="57144-261">Read-write access = zero</span><span class="sxs-lookup"><span data-stu-id="57144-261">Read-write access = zero</span></span> | <span data-ttu-id="57144-262">Read-write access = Failure detection time + grace period with data loss</span><span class="sxs-lookup"><span data-stu-id="57144-262">Read-write access = Failure detection time + grace period with data loss</span></span> |
|||

## <a name="next-steps"></a><span data-ttu-id="57144-263">Next steps</span><span class="sxs-lookup"><span data-stu-id="57144-263">Next steps</span></span>
* <span data-ttu-id="57144-264">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="57144-264">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="57144-265">To learn about geo-replication and failover groups, see [active geo-replication](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="57144-265">To learn about geo-replication and failover groups, see [active geo-replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="57144-266">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="57144-266">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
