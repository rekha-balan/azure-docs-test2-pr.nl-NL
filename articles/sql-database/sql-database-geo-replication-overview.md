---
title: Active Geo-Replication for Azure SQL Database
description: Active Geo-Replication enables you to setup 4 replicas of your database in any of the Azure datacenters.
services: sql-database
documentationcenter: na
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 2a29f657-82fb-4283-9a83-e14a144bfd93
ms.service: sql-database
ms.custom: business continuity
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: NA
ms.date: 09/26/2016
ms.author: sashan
ms.openlocfilehash: 54895846687fe93e70a43c323a37d5f9fb18820c
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44550204"
---
# <a name="overview-sql-database-active-geo-replication"></a><span data-ttu-id="0265e-103">Overview: SQL Database Active Geo-Replication</span><span class="sxs-lookup"><span data-stu-id="0265e-103">Overview: SQL Database Active Geo-Replication</span></span>
<span data-ttu-id="0265e-104">Active Geo-Replication enables you to configure up to four readable secondary databases in the same or different data center locations (regions).</span><span class="sxs-lookup"><span data-stu-id="0265e-104">Active Geo-Replication enables you to configure up to four readable secondary databases in the same or different data center locations (regions).</span></span> <span data-ttu-id="0265e-105">Secondary databases are available for querying and for failover in the case of a data center outage or the inability to connect to the primary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-105">Secondary databases are available for querying and for failover in the case of a data center outage or the inability to connect to the primary database.</span></span> <span data-ttu-id="0265e-106">Active geo-replication must be between databases within the same subscription.</span><span class="sxs-lookup"><span data-stu-id="0265e-106">Active geo-replication must be between databases within the same subscription.</span></span>

> [!NOTE]
> <span data-ttu-id="0265e-107">Active Geo-Replication (readable secondaries) is now available for all databases in all service tiers.</span><span class="sxs-lookup"><span data-stu-id="0265e-107">Active Geo-Replication (readable secondaries) is now available for all databases in all service tiers.</span></span> <span data-ttu-id="0265e-108">In April 2017, the non-readable secondary type will be retired and existing non-readable databases will automatically be upgraded to readable secondaries.</span><span class="sxs-lookup"><span data-stu-id="0265e-108">In April 2017, the non-readable secondary type will be retired and existing non-readable databases will automatically be upgraded to readable secondaries.</span></span>
>  

 <span data-ttu-id="0265e-109">You can configure Active Geo-Replication using the [Azure portal](sql-database-geo-replication-portal.md), [PowerShell](scripts/sql-database-setup-geodr-and-failover-database-powershell.md), [Transact-SQL](sql-database-geo-replication-transact-sql.md), or the [REST API - Create or Update Database](https://msdn.microsoft.com/library/azure/mt163685.aspx).</span><span class="sxs-lookup"><span data-stu-id="0265e-109">You can configure Active Geo-Replication using the [Azure portal](sql-database-geo-replication-portal.md), [PowerShell](scripts/sql-database-setup-geodr-and-failover-database-powershell.md), [Transact-SQL](sql-database-geo-replication-transact-sql.md), or the [REST API - Create or Update Database](https://msdn.microsoft.com/library/azure/mt163685.aspx).</span></span>

<span data-ttu-id="0265e-110">If for any reason your primary database fails, or simply needs to be taken offline, you can *failover* to any of your secondary databases.</span><span class="sxs-lookup"><span data-stu-id="0265e-110">If for any reason your primary database fails, or simply needs to be taken offline, you can *failover* to any of your secondary databases.</span></span> <span data-ttu-id="0265e-111">When failover is activated to one of the secondary databases, all other secondaries are automatically linked to the new primary.</span><span class="sxs-lookup"><span data-stu-id="0265e-111">When failover is activated to one of the secondary databases, all other secondaries are automatically linked to the new primary.</span></span>

<span data-ttu-id="0265e-112">You can failover to a secondary using the [Azure portal](sql-database-geo-replication-portal.md), [PowerShell](scripts/sql-database-setup-geodr-and-failover-database-powershell.md), [Transact-SQL](sql-database-geo-replication-failover-transact-sql.md), the [REST API - Planned Failover](https://msdn.microsoft.com/library/mt575007.aspx), or [REST API - Unplanned Failover](https://msdn.microsoft.com/library/mt582027.aspx).</span><span class="sxs-lookup"><span data-stu-id="0265e-112">You can failover to a secondary using the [Azure portal](sql-database-geo-replication-portal.md), [PowerShell](scripts/sql-database-setup-geodr-and-failover-database-powershell.md), [Transact-SQL](sql-database-geo-replication-failover-transact-sql.md), the [REST API - Planned Failover](https://msdn.microsoft.com/library/mt575007.aspx), or [REST API - Unplanned Failover](https://msdn.microsoft.com/library/mt582027.aspx).</span></span>

<span data-ttu-id="0265e-113">After failover, ensure the authentication requirements for your server and database are configured on the new primary.</span><span class="sxs-lookup"><span data-stu-id="0265e-113">After failover, ensure the authentication requirements for your server and database are configured on the new primary.</span></span> <span data-ttu-id="0265e-114">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="0265e-114">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>

<span data-ttu-id="0265e-115">The Active Geo-Replication feature implements a mechanism to provide database redundancy within the same Microsoft Azure region or in different regions (geo-redundancy).</span><span class="sxs-lookup"><span data-stu-id="0265e-115">The Active Geo-Replication feature implements a mechanism to provide database redundancy within the same Microsoft Azure region or in different regions (geo-redundancy).</span></span> <span data-ttu-id="0265e-116">Active Geo-Replication asynchronously replicates committed transactions from a database to up to four copies of the database on different servers, using read committed snapshot isolation (RCSI) for isolation.</span><span class="sxs-lookup"><span data-stu-id="0265e-116">Active Geo-Replication asynchronously replicates committed transactions from a database to up to four copies of the database on different servers, using read committed snapshot isolation (RCSI) for isolation.</span></span> <span data-ttu-id="0265e-117">When Active Geo-Replication is configured, a secondary database is created on the specified server.</span><span class="sxs-lookup"><span data-stu-id="0265e-117">When Active Geo-Replication is configured, a secondary database is created on the specified server.</span></span> <span data-ttu-id="0265e-118">The original database becomes the primary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-118">The original database becomes the primary database.</span></span> <span data-ttu-id="0265e-119">The primary database asynchronously replicates committed transactions to each of the secondary databases.</span><span class="sxs-lookup"><span data-stu-id="0265e-119">The primary database asynchronously replicates committed transactions to each of the secondary databases.</span></span> <span data-ttu-id="0265e-120">Only full transactions are replicated.</span><span class="sxs-lookup"><span data-stu-id="0265e-120">Only full transactions are replicated.</span></span> <span data-ttu-id="0265e-121">While at any given point, the secondary database might be slightly behind the primary database, the secondary data is guaranteed to never have partial transactions.</span><span class="sxs-lookup"><span data-stu-id="0265e-121">While at any given point, the secondary database might be slightly behind the primary database, the secondary data is guaranteed to never have partial transactions.</span></span> <span data-ttu-id="0265e-122">The specific RPO data can be found at [Overview of Business Continuity](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="0265e-122">The specific RPO data can be found at [Overview of Business Continuity](sql-database-business-continuity.md).</span></span>

<span data-ttu-id="0265e-123">One of the primary benefits of Active Geo-Replication is that it provides a database-level disaster recovery solution with low recovery time.</span><span class="sxs-lookup"><span data-stu-id="0265e-123">One of the primary benefits of Active Geo-Replication is that it provides a database-level disaster recovery solution with low recovery time.</span></span> <span data-ttu-id="0265e-124">When you place the secondary database on a server in a different region, you add maximum resilience to your application.</span><span class="sxs-lookup"><span data-stu-id="0265e-124">When you place the secondary database on a server in a different region, you add maximum resilience to your application.</span></span> <span data-ttu-id="0265e-125">Cross-region redundancy enables applications to recover from a permanent loss of an entire datacenter or parts of a datacenter caused by natural disasters, catastrophic human errors, or malicious acts.</span><span class="sxs-lookup"><span data-stu-id="0265e-125">Cross-region redundancy enables applications to recover from a permanent loss of an entire datacenter or parts of a datacenter caused by natural disasters, catastrophic human errors, or malicious acts.</span></span> <span data-ttu-id="0265e-126">The following figure shows an example of Active Geo-Replication configured with a primary in the North Central US region and secondary in the South Central US region.</span><span class="sxs-lookup"><span data-stu-id="0265e-126">The following figure shows an example of Active Geo-Replication configured with a primary in the North Central US region and secondary in the South Central US region.</span></span>

![Geo-Replication relationship](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-active-geo-replication/geo-replication-relationship.png)

<span data-ttu-id="0265e-128">Another key benefit is that the secondary databases are readable and can be used to offload read-only workloads such as reporting jobs.</span><span class="sxs-lookup"><span data-stu-id="0265e-128">Another key benefit is that the secondary databases are readable and can be used to offload read-only workloads such as reporting jobs.</span></span> <span data-ttu-id="0265e-129">If you only intend to use the secondary database for load-balancing, you can create it in the same region as the primary.</span><span class="sxs-lookup"><span data-stu-id="0265e-129">If you only intend to use the secondary database for load-balancing, you can create it in the same region as the primary.</span></span> <span data-ttu-id="0265e-130">Creating a secondary in the same region, does not increase the application's resilience to catastrophic failures.</span><span class="sxs-lookup"><span data-stu-id="0265e-130">Creating a secondary in the same region, does not increase the application's resilience to catastrophic failures.</span></span>  

<span data-ttu-id="0265e-131">Other scenarios where Active Geo-Replication can be used include:</span><span class="sxs-lookup"><span data-stu-id="0265e-131">Other scenarios where Active Geo-Replication can be used include:</span></span>

* <span data-ttu-id="0265e-132">**Database migration**: You can use Active Geo-Replication to migrate a database from one server to another online with minimum downtime.</span><span class="sxs-lookup"><span data-stu-id="0265e-132">**Database migration**: You can use Active Geo-Replication to migrate a database from one server to another online with minimum downtime.</span></span>
* <span data-ttu-id="0265e-133">**Application upgrades**: You can create an extra secondary as a fail back copy during application upgrades.</span><span class="sxs-lookup"><span data-stu-id="0265e-133">**Application upgrades**: You can create an extra secondary as a fail back copy during application upgrades.</span></span>

<span data-ttu-id="0265e-134">To achieve real business continuity, adding database redundancy between datacenters is only part of the solution.</span><span class="sxs-lookup"><span data-stu-id="0265e-134">To achieve real business continuity, adding database redundancy between datacenters is only part of the solution.</span></span> <span data-ttu-id="0265e-135">Recovering an application (service) end-to-end after a catastrophic failure requires recovery of all components that constitute the service and any dependent services.</span><span class="sxs-lookup"><span data-stu-id="0265e-135">Recovering an application (service) end-to-end after a catastrophic failure requires recovery of all components that constitute the service and any dependent services.</span></span> <span data-ttu-id="0265e-136">Examples of these components include the client software (for example, a browser with a custom JavaScript), web front ends, storage, and DNS.</span><span class="sxs-lookup"><span data-stu-id="0265e-136">Examples of these components include the client software (for example, a browser with a custom JavaScript), web front ends, storage, and DNS.</span></span> <span data-ttu-id="0265e-137">It is critical that all components are resilient to the same failures and become available within the recovery time objective (RTO) of your application.</span><span class="sxs-lookup"><span data-stu-id="0265e-137">It is critical that all components are resilient to the same failures and become available within the recovery time objective (RTO) of your application.</span></span> <span data-ttu-id="0265e-138">Therefore, you need to identify all dependent services and understand the guarantees and capabilities they provide.</span><span class="sxs-lookup"><span data-stu-id="0265e-138">Therefore, you need to identify all dependent services and understand the guarantees and capabilities they provide.</span></span> <span data-ttu-id="0265e-139">Then, you must take adequate steps to ensure that your service functions during the failover of the services on which it depends.</span><span class="sxs-lookup"><span data-stu-id="0265e-139">Then, you must take adequate steps to ensure that your service functions during the failover of the services on which it depends.</span></span> <span data-ttu-id="0265e-140">For more information about designing solutions for disaster recovery, see [Designing Cloud Solutions for Disaster Recovery Using Active Geo-Replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="0265e-140">For more information about designing solutions for disaster recovery, see [Designing Cloud Solutions for Disaster Recovery Using Active Geo-Replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md).</span></span>

## <a name="active-geo-replication-capabilities"></a><span data-ttu-id="0265e-141">Active Geo-Replication capabilities</span><span class="sxs-lookup"><span data-stu-id="0265e-141">Active Geo-Replication capabilities</span></span>
<span data-ttu-id="0265e-142">The Active Geo-Replication feature provides the following essential capabilities:</span><span class="sxs-lookup"><span data-stu-id="0265e-142">The Active Geo-Replication feature provides the following essential capabilities:</span></span>

* <span data-ttu-id="0265e-143">**Automatic Asynchronous Replication**: You can only create a secondary database by adding to an existing database.</span><span class="sxs-lookup"><span data-stu-id="0265e-143">**Automatic Asynchronous Replication**: You can only create a secondary database by adding to an existing database.</span></span> <span data-ttu-id="0265e-144">The secondary can only be created in a different Azure SQL Database server.</span><span class="sxs-lookup"><span data-stu-id="0265e-144">The secondary can only be created in a different Azure SQL Database server.</span></span> <span data-ttu-id="0265e-145">Once created, the secondary database is populated with the data copied from the primary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-145">Once created, the secondary database is populated with the data copied from the primary database.</span></span> <span data-ttu-id="0265e-146">This process is known as seeding.</span><span class="sxs-lookup"><span data-stu-id="0265e-146">This process is known as seeding.</span></span> <span data-ttu-id="0265e-147">After secondary database has been created and seeded, updates to the primary database are asynchronously replicated to the secondary database automatically.</span><span class="sxs-lookup"><span data-stu-id="0265e-147">After secondary database has been created and seeded, updates to the primary database are asynchronously replicated to the secondary database automatically.</span></span> <span data-ttu-id="0265e-148">Asynchronous replication means that transactions are committed on the primary database before they are replicated to the secondary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-148">Asynchronous replication means that transactions are committed on the primary database before they are replicated to the secondary database.</span></span> 
* <span data-ttu-id="0265e-149">**Multiple secondary databases**: Two or more secondary databases increase redundancy and level of protection for the primary database and application.</span><span class="sxs-lookup"><span data-stu-id="0265e-149">**Multiple secondary databases**: Two or more secondary databases increase redundancy and level of protection for the primary database and application.</span></span> <span data-ttu-id="0265e-150">If multiple secondary databases exist, the application remains protected even if one of the secondary databases fails.</span><span class="sxs-lookup"><span data-stu-id="0265e-150">If multiple secondary databases exist, the application remains protected even if one of the secondary databases fails.</span></span> <span data-ttu-id="0265e-151">If there is only one secondary database, and it fails, the application is exposed to higher risk until a new secondary database is created.</span><span class="sxs-lookup"><span data-stu-id="0265e-151">If there is only one secondary database, and it fails, the application is exposed to higher risk until a new secondary database is created.</span></span>
* <span data-ttu-id="0265e-152">**Readable secondary databases**: An application can access a secondary database for read-only operations using the same or different security principals used for accessing the primary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-152">**Readable secondary databases**: An application can access a secondary database for read-only operations using the same or different security principals used for accessing the primary database.</span></span> <span data-ttu-id="0265e-153">The secondary databases operate in snapshot isolation mode to ensure replication of the updates of the primary (log replay) is not delayed by queries executed on the secondary.</span><span class="sxs-lookup"><span data-stu-id="0265e-153">The secondary databases operate in snapshot isolation mode to ensure replication of the updates of the primary (log replay) is not delayed by queries executed on the secondary.</span></span>

> [!NOTE]
> <span data-ttu-id="0265e-154">The log replay is delayed on the secondary database if there are schema updates that it is receiving from the Primary that require a schema lock on the secondary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-154">The log replay is delayed on the secondary database if there are schema updates that it is receiving from the Primary that require a schema lock on the secondary database.</span></span>
> 
> 

* <span data-ttu-id="0265e-155">**Active geo-replication of elastic pool databases**: Active Geo-Replication can be configured for any database in any elastic pool.</span><span class="sxs-lookup"><span data-stu-id="0265e-155">**Active geo-replication of elastic pool databases**: Active Geo-Replication can be configured for any database in any elastic pool.</span></span> <span data-ttu-id="0265e-156">The secondary database can be in another elastic pool.</span><span class="sxs-lookup"><span data-stu-id="0265e-156">The secondary database can be in another elastic pool.</span></span> <span data-ttu-id="0265e-157">For regular databases, the secondary can be an elastic pool and vice versa as long as the service tiers are the same.</span><span class="sxs-lookup"><span data-stu-id="0265e-157">For regular databases, the secondary can be an elastic pool and vice versa as long as the service tiers are the same.</span></span> 
* <span data-ttu-id="0265e-158">**Configurable performance level of the secondary database**: A secondary database can be created with lower performance level than the primary.</span><span class="sxs-lookup"><span data-stu-id="0265e-158">**Configurable performance level of the secondary database**: A secondary database can be created with lower performance level than the primary.</span></span> <span data-ttu-id="0265e-159">Both primary and secondary databases are required to have the same service tier.</span><span class="sxs-lookup"><span data-stu-id="0265e-159">Both primary and secondary databases are required to have the same service tier.</span></span> <span data-ttu-id="0265e-160">This option is not recommended for applications with high database write activity because the increased replication lag increases the risk of substantial data loss after a failover.</span><span class="sxs-lookup"><span data-stu-id="0265e-160">This option is not recommended for applications with high database write activity because the increased replication lag increases the risk of substantial data loss after a failover.</span></span> <span data-ttu-id="0265e-161">In addition, after failover the application’s performance is impacted until the new primary is upgraded to a higher performance level.</span><span class="sxs-lookup"><span data-stu-id="0265e-161">In addition, after failover the application’s performance is impacted until the new primary is upgraded to a higher performance level.</span></span> <span data-ttu-id="0265e-162">The log IO percentage chart on Azure portal provides a good way to estimate the minimal performance level of the secondary that is required to sustain the replication load.</span><span class="sxs-lookup"><span data-stu-id="0265e-162">The log IO percentage chart on Azure portal provides a good way to estimate the minimal performance level of the secondary that is required to sustain the replication load.</span></span> <span data-ttu-id="0265e-163">For example, if your Primary database is P6 (1000 DTU) and its log IO percent is 50% the secondary needs to be at least P4 (500 DTU).</span><span class="sxs-lookup"><span data-stu-id="0265e-163">For example, if your Primary database is P6 (1000 DTU) and its log IO percent is 50% the secondary needs to be at least P4 (500 DTU).</span></span> <span data-ttu-id="0265e-164">You can also retrieve the log IO data using [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) or [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) database views.</span><span class="sxs-lookup"><span data-stu-id="0265e-164">You can also retrieve the log IO data using [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) or [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) database views.</span></span>  <span data-ttu-id="0265e-165">For more information on the SQL Database performance levels, see [SQL Database options and performance](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="0265e-165">For more information on the SQL Database performance levels, see [SQL Database options and performance](sql-database-service-tiers.md).</span></span> 
* <span data-ttu-id="0265e-166">**User-controlled failover and failback**: A secondary database can explicitly be switched to the primary role at any time by the application or the user.</span><span class="sxs-lookup"><span data-stu-id="0265e-166">**User-controlled failover and failback**: A secondary database can explicitly be switched to the primary role at any time by the application or the user.</span></span> <span data-ttu-id="0265e-167">During a real outage the “unplanned” option should be used, which immediately promotes a secondary to be the primary.</span><span class="sxs-lookup"><span data-stu-id="0265e-167">During a real outage the “unplanned” option should be used, which immediately promotes a secondary to be the primary.</span></span> <span data-ttu-id="0265e-168">When the failed primary recovers and is available again, the system automatically marks the recovered primary as a secondary and bring it up-to-date with the new primary.</span><span class="sxs-lookup"><span data-stu-id="0265e-168">When the failed primary recovers and is available again, the system automatically marks the recovered primary as a secondary and bring it up-to-date with the new primary.</span></span> <span data-ttu-id="0265e-169">Due to the asynchronous nature of replication, a small amount of data can be lost during unplanned failovers if a primary fails before it replicates the most recent changes to the secondary.</span><span class="sxs-lookup"><span data-stu-id="0265e-169">Due to the asynchronous nature of replication, a small amount of data can be lost during unplanned failovers if a primary fails before it replicates the most recent changes to the secondary.</span></span> <span data-ttu-id="0265e-170">When a primary with multiple secondaries fails over, the system automatically reconfigures the replication relationships and links the remaining secondaries to the newly promoted primary without requiring any user intervention.</span><span class="sxs-lookup"><span data-stu-id="0265e-170">When a primary with multiple secondaries fails over, the system automatically reconfigures the replication relationships and links the remaining secondaries to the newly promoted primary without requiring any user intervention.</span></span> <span data-ttu-id="0265e-171">After the outage that caused the failover is mitigated, it may be desirable to return the application to the primary region.</span><span class="sxs-lookup"><span data-stu-id="0265e-171">After the outage that caused the failover is mitigated, it may be desirable to return the application to the primary region.</span></span> <span data-ttu-id="0265e-172">To do that, the failover command should be invoked with the “planned” option.</span><span class="sxs-lookup"><span data-stu-id="0265e-172">To do that, the failover command should be invoked with the “planned” option.</span></span> 
* <span data-ttu-id="0265e-173">**Keeping credentials and firewall rules in sync**: We recommend using [database firewall rules](sql-database-firewall-configure.md) for geo-replicated databases so these rules can be replicated with the database to ensure all secondary databases have the same firewall rules as the primary.</span><span class="sxs-lookup"><span data-stu-id="0265e-173">**Keeping credentials and firewall rules in sync**: We recommend using [database firewall rules](sql-database-firewall-configure.md) for geo-replicated databases so these rules can be replicated with the database to ensure all secondary databases have the same firewall rules as the primary.</span></span> <span data-ttu-id="0265e-174">This approach eliminates the need for customers to manually configure and maintain firewall rules on servers hosting both the primary and secondary databases.</span><span class="sxs-lookup"><span data-stu-id="0265e-174">This approach eliminates the need for customers to manually configure and maintain firewall rules on servers hosting both the primary and secondary databases.</span></span> <span data-ttu-id="0265e-175">Similarly, using [contained database users](sql-database-manage-logins.md) for data access ensures both primary and secondary databases always have the same user credentials so during a failover, there is no disruptions due to mismatches with logins and passwords.</span><span class="sxs-lookup"><span data-stu-id="0265e-175">Similarly, using [contained database users](sql-database-manage-logins.md) for data access ensures both primary and secondary databases always have the same user credentials so during a failover, there is no disruptions due to mismatches with logins and passwords.</span></span> <span data-ttu-id="0265e-176">With the addition of [Azure Active Directory](../active-directory/active-directory-whatis.md), customers can manage user access to both primary and secondary databases and eliminating the need for managing credentials in databases altogether.</span><span class="sxs-lookup"><span data-stu-id="0265e-176">With the addition of [Azure Active Directory](../active-directory/active-directory-whatis.md), customers can manage user access to both primary and secondary databases and eliminating the need for managing credentials in databases altogether.</span></span>

## <a name="upgrading-or-downgrading-a-primary-database"></a><span data-ttu-id="0265e-177">Upgrading or downgrading a primary database</span><span class="sxs-lookup"><span data-stu-id="0265e-177">Upgrading or downgrading a primary database</span></span>
<span data-ttu-id="0265e-178">You can upgrade or downgrade a primary database to a different performance level (within the same service tier) without disconnecting any secondary databases.</span><span class="sxs-lookup"><span data-stu-id="0265e-178">You can upgrade or downgrade a primary database to a different performance level (within the same service tier) without disconnecting any secondary databases.</span></span> <span data-ttu-id="0265e-179">When upgrading, we recommend that you upgrade the secondary database first, and then upgrade the primary.</span><span class="sxs-lookup"><span data-stu-id="0265e-179">When upgrading, we recommend that you upgrade the secondary database first, and then upgrade the primary.</span></span> <span data-ttu-id="0265e-180">When downgrading, reverse the order: downgrade the primary first, and then downgrade the secondary.</span><span class="sxs-lookup"><span data-stu-id="0265e-180">When downgrading, reverse the order: downgrade the primary first, and then downgrade the secondary.</span></span> 

<span data-ttu-id="0265e-181">The secondary database must be in the same service tier as the primary, so migrating your primary database to a different service tier requires you to either terminate the geo-replication link and rename the secondary database, or simply drop it.</span><span class="sxs-lookup"><span data-stu-id="0265e-181">The secondary database must be in the same service tier as the primary, so migrating your primary database to a different service tier requires you to either terminate the geo-replication link and rename the secondary database, or simply drop it.</span></span> <span data-ttu-id="0265e-182">Then migrate the primary to the new service tier and reconfigure geo-replication.</span><span class="sxs-lookup"><span data-stu-id="0265e-182">Then migrate the primary to the new service tier and reconfigure geo-replication.</span></span> <span data-ttu-id="0265e-183">Your new secondary will be created automatically with the same performance level as the primary by default.</span><span class="sxs-lookup"><span data-stu-id="0265e-183">Your new secondary will be created automatically with the same performance level as the primary by default.</span></span>

## <a name="preventing-the-loss-of-critical-data"></a><span data-ttu-id="0265e-184">Preventing the loss of critical data</span><span class="sxs-lookup"><span data-stu-id="0265e-184">Preventing the loss of critical data</span></span>
<span data-ttu-id="0265e-185">Due to the high latency of wide area networks, continuous copy uses an asynchronous replication mechanism.</span><span class="sxs-lookup"><span data-stu-id="0265e-185">Due to the high latency of wide area networks, continuous copy uses an asynchronous replication mechanism.</span></span> <span data-ttu-id="0265e-186">Asynchronous replication makes some data loss unavoidable if a failure occurs.</span><span class="sxs-lookup"><span data-stu-id="0265e-186">Asynchronous replication makes some data loss unavoidable if a failure occurs.</span></span> <span data-ttu-id="0265e-187">However, some applications may require no data loss.</span><span class="sxs-lookup"><span data-stu-id="0265e-187">However, some applications may require no data loss.</span></span> <span data-ttu-id="0265e-188">To protect these critical updates, an application developer can call the [sp_wait_for_database_copy_sync](https://msdn.microsoft.com/library/dn467644.aspx) system procedure immediately after committing the transaction.</span><span class="sxs-lookup"><span data-stu-id="0265e-188">To protect these critical updates, an application developer can call the [sp_wait_for_database_copy_sync](https://msdn.microsoft.com/library/dn467644.aspx) system procedure immediately after committing the transaction.</span></span> <span data-ttu-id="0265e-189">Calling **sp_wait_for_database_copy_sync** blocks the calling thread until the last committed transaction has been replicated to the secondary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-189">Calling **sp_wait_for_database_copy_sync** blocks the calling thread until the last committed transaction has been replicated to the secondary database.</span></span> <span data-ttu-id="0265e-190">The procedure will wait until all queued transactions have been acknowledged by the secondary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-190">The procedure will wait until all queued transactions have been acknowledged by the secondary database.</span></span> <span data-ttu-id="0265e-191">**sp_wait_for_database_copy_sync** is scoped to a specific continuous copy link.</span><span class="sxs-lookup"><span data-stu-id="0265e-191">**sp_wait_for_database_copy_sync** is scoped to a specific continuous copy link.</span></span> <span data-ttu-id="0265e-192">Any user with the connection rights to the primary database can call this procedure.</span><span class="sxs-lookup"><span data-stu-id="0265e-192">Any user with the connection rights to the primary database can call this procedure.</span></span>

> [!NOTE]
> <span data-ttu-id="0265e-193">The delay caused by a **sp_wait_for_database_copy_sync** procedure call can be significant.</span><span class="sxs-lookup"><span data-stu-id="0265e-193">The delay caused by a **sp_wait_for_database_copy_sync** procedure call can be significant.</span></span> <span data-ttu-id="0265e-194">The delay depends on the size of the transaction log length at the moment and this call does not return until the entire log is replicated.</span><span class="sxs-lookup"><span data-stu-id="0265e-194">The delay depends on the size of the transaction log length at the moment and this call does not return until the entire log is replicated.</span></span> <span data-ttu-id="0265e-195">Avoid calling this procedure unless absolutely necessary.</span><span class="sxs-lookup"><span data-stu-id="0265e-195">Avoid calling this procedure unless absolutely necessary.</span></span>
> 
> 

## <a name="programmatically-managing-active-geo-replication"></a><span data-ttu-id="0265e-196">Programmatically managing Active Geo-Replication</span><span class="sxs-lookup"><span data-stu-id="0265e-196">Programmatically managing Active Geo-Replication</span></span>
<span data-ttu-id="0265e-197">As discussed previously, Active Geo-Replication can also be managed programmatically using Azure PowerShell and the REST API.</span><span class="sxs-lookup"><span data-stu-id="0265e-197">As discussed previously, Active Geo-Replication can also be managed programmatically using Azure PowerShell and the REST API.</span></span> <span data-ttu-id="0265e-198">The following tables describe the set of commands available.</span><span class="sxs-lookup"><span data-stu-id="0265e-198">The following tables describe the set of commands available.</span></span>

* <span data-ttu-id="0265e-199">**Azure Resource Manager API and role-based security**: Active Geo-Replication includes a set of [Azure Resource Manager APIs](https://msdn.microsoft.com/library/azure/mt163571.aspx) for management, including [Azure Resource Manager-based PowerShell cmdlets](scripts/sql-database-setup-geodr-and-failover-database-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="0265e-199">**Azure Resource Manager API and role-based security**: Active Geo-Replication includes a set of [Azure Resource Manager APIs](https://msdn.microsoft.com/library/azure/mt163571.aspx) for management, including [Azure Resource Manager-based PowerShell cmdlets](scripts/sql-database-setup-geodr-and-failover-database-powershell.md).</span></span> <span data-ttu-id="0265e-200">These APIs require the use of resource groups and support role-based security (RBAC).</span><span class="sxs-lookup"><span data-stu-id="0265e-200">These APIs require the use of resource groups and support role-based security (RBAC).</span></span> <span data-ttu-id="0265e-201">For more information on how to implement access roles see [Azure Role-Based Access Control](../active-directory/role-based-access-control-configure.md).</span><span class="sxs-lookup"><span data-stu-id="0265e-201">For more information on how to implement access roles see [Azure Role-Based Access Control](../active-directory/role-based-access-control-configure.md).</span></span>

> [!NOTE]
> <span data-ttu-id="0265e-202">Many new features of Active Geo-Replication are only supported using [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) based [Azure SQL REST API](https://msdn.microsoft.com/library/azure/mt163571.aspx) and [Azure SQL Database PowerShell cmdlets](https://msdn.microsoft.com/library/azure/mt574084.aspx).</span><span class="sxs-lookup"><span data-stu-id="0265e-202">Many new features of Active Geo-Replication are only supported using [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) based [Azure SQL REST API](https://msdn.microsoft.com/library/azure/mt163571.aspx) and [Azure SQL Database PowerShell cmdlets](https://msdn.microsoft.com/library/azure/mt574084.aspx).</span></span> <span data-ttu-id="0265e-203">The [(classic) REST API](https://msdn.microsoft.com/library/azure/dn505719.aspx) and [Azure SQL Database (classic) cmdlets](https://msdn.microsoft.com/library/azure/dn546723.aspx) are supported for backward compatibility so using the Azure Resource Manager-based APIs are recommended.</span><span class="sxs-lookup"><span data-stu-id="0265e-203">The [(classic) REST API](https://msdn.microsoft.com/library/azure/dn505719.aspx) and [Azure SQL Database (classic) cmdlets](https://msdn.microsoft.com/library/azure/dn546723.aspx) are supported for backward compatibility so using the Azure Resource Manager-based APIs are recommended.</span></span> 
> 
> 

### <a name="transact-sql"></a><span data-ttu-id="0265e-204">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="0265e-204">Transact-SQL</span></span>
| <span data-ttu-id="0265e-205">Command</span><span class="sxs-lookup"><span data-stu-id="0265e-205">Command</span></span> | <span data-ttu-id="0265e-206">Description</span><span class="sxs-lookup"><span data-stu-id="0265e-206">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="0265e-207">ALTER DATABASE (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="0265e-207">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="0265e-208">Use ADD SECONDARY ON SERVER argument to create a secondary database for an existing database and starts data replication</span><span class="sxs-lookup"><span data-stu-id="0265e-208">Use ADD SECONDARY ON SERVER argument to create a secondary database for an existing database and starts data replication</span></span> |
| [<span data-ttu-id="0265e-209">ALTER DATABASE (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="0265e-209">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="0265e-210">Use FAILOVER or FORCE_FAILOVER_ALLOW_DATA_LOSS to switch a secondary database to be primary to initiate failover</span><span class="sxs-lookup"><span data-stu-id="0265e-210">Use FAILOVER or FORCE_FAILOVER_ALLOW_DATA_LOSS to switch a secondary database to be primary to initiate failover</span></span> |
| [<span data-ttu-id="0265e-211">ALTER DATABASE (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="0265e-211">ALTER DATABASE (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt574871.aspx) |<span data-ttu-id="0265e-212">Use REMOVE SECONDARY ON SERVER to terminate a data replication between a SQL Database and the specified secondary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-212">Use REMOVE SECONDARY ON SERVER to terminate a data replication between a SQL Database and the specified secondary database.</span></span> |
| [<span data-ttu-id="0265e-213">sys.geo_replication_links (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="0265e-213">sys.geo_replication_links (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt575501.aspx) |<span data-ttu-id="0265e-214">Returns information about all existing replication links for each database on the Azure SQL Database logical server.</span><span class="sxs-lookup"><span data-stu-id="0265e-214">Returns information about all existing replication links for each database on the Azure SQL Database logical server.</span></span> |
| [<span data-ttu-id="0265e-215">sys.dm_geo_replication_link_status (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="0265e-215">sys.dm_geo_replication_link_status (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/mt575504.aspx) |<span data-ttu-id="0265e-216">Gets the last replication time, last replication lag, and other information about the replication link for a given SQL database.</span><span class="sxs-lookup"><span data-stu-id="0265e-216">Gets the last replication time, last replication lag, and other information about the replication link for a given SQL database.</span></span> |
| [<span data-ttu-id="0265e-217">sys.dm_operation_status (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="0265e-217">sys.dm_operation_status (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/dn270022.aspx) |<span data-ttu-id="0265e-218">Shows the status for all database operations including the status of the replication links.</span><span class="sxs-lookup"><span data-stu-id="0265e-218">Shows the status for all database operations including the status of the replication links.</span></span> |
| [<span data-ttu-id="0265e-219">sp_wait_for_database_copy_sync (Azure SQL Database)</span><span class="sxs-lookup"><span data-stu-id="0265e-219">sp_wait_for_database_copy_sync (Azure SQL Database)</span></span>](https://msdn.microsoft.com/library/dn467644.aspx) |<span data-ttu-id="0265e-220">causes the application to wait until all committed transactions are replicated and acknowledged by the active secondary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-220">causes the application to wait until all committed transactions are replicated and acknowledged by the active secondary database.</span></span> |
|  | |

### <a name="powershell"></a><span data-ttu-id="0265e-221">PowerShell</span><span class="sxs-lookup"><span data-stu-id="0265e-221">PowerShell</span></span>
| <span data-ttu-id="0265e-222">Cmdlet</span><span class="sxs-lookup"><span data-stu-id="0265e-222">Cmdlet</span></span> | <span data-ttu-id="0265e-223">Description</span><span class="sxs-lookup"><span data-stu-id="0265e-223">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="0265e-224">Get-AzureRmSqlDatabase</span><span class="sxs-lookup"><span data-stu-id="0265e-224">Get-AzureRmSqlDatabase</span></span>](https://msdn.microsoft.com/library/azure/mt603648.aspx) |<span data-ttu-id="0265e-225">Gets one or more databases.</span><span class="sxs-lookup"><span data-stu-id="0265e-225">Gets one or more databases.</span></span> |
| [<span data-ttu-id="0265e-226">New-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="0265e-226">New-AzureRmSqlDatabaseSecondary</span></span>](https://msdn.microsoft.com/library/mt603689.aspx) |<span data-ttu-id="0265e-227">Creates a secondary database for an existing database and starts data replication.</span><span class="sxs-lookup"><span data-stu-id="0265e-227">Creates a secondary database for an existing database and starts data replication.</span></span> |
| [<span data-ttu-id="0265e-228">Set-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="0265e-228">Set-AzureRmSqlDatabaseSecondary</span></span>](https://msdn.microsoft.com/library/mt619393.aspx) |<span data-ttu-id="0265e-229">Switches a secondary database to be primary to initiate failover.</span><span class="sxs-lookup"><span data-stu-id="0265e-229">Switches a secondary database to be primary to initiate failover.</span></span> |
| [<span data-ttu-id="0265e-230">Remove-AzureRmSqlDatabaseSecondary</span><span class="sxs-lookup"><span data-stu-id="0265e-230">Remove-AzureRmSqlDatabaseSecondary</span></span>](https://msdn.microsoft.com/library/mt603457.aspx) |<span data-ttu-id="0265e-231">Terminates data replication between a SQL Database and the specified secondary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-231">Terminates data replication between a SQL Database and the specified secondary database.</span></span> |
| [<span data-ttu-id="0265e-232">Get-AzureRmSqlDatabaseReplicationLink</span><span class="sxs-lookup"><span data-stu-id="0265e-232">Get-AzureRmSqlDatabaseReplicationLink</span></span>](https://msdn.microsoft.com/library/mt619330.aspx) |<span data-ttu-id="0265e-233">Gets the geo-replication links between an Azure SQL Database and a resource group or SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0265e-233">Gets the geo-replication links between an Azure SQL Database and a resource group or SQL Server.</span></span> |
|  | |

### <a name="rest-api"></a><span data-ttu-id="0265e-234">REST API</span><span class="sxs-lookup"><span data-stu-id="0265e-234">REST API</span></span>
| <span data-ttu-id="0265e-235">API</span><span class="sxs-lookup"><span data-stu-id="0265e-235">API</span></span> | <span data-ttu-id="0265e-236">Description</span><span class="sxs-lookup"><span data-stu-id="0265e-236">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="0265e-237">Create or Update Database (createMode=Restore)</span><span class="sxs-lookup"><span data-stu-id="0265e-237">Create or Update Database (createMode=Restore)</span></span>](https://msdn.microsoft.com/library/azure/mt163685.aspx) |<span data-ttu-id="0265e-238">Creates, updates, or restores a primary or a secondary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-238">Creates, updates, or restores a primary or a secondary database.</span></span> |
| [<span data-ttu-id="0265e-239">Get Create or Update Database Status</span><span class="sxs-lookup"><span data-stu-id="0265e-239">Get Create or Update Database Status</span></span>](https://msdn.microsoft.com/library/azure/mt643934.aspx) |<span data-ttu-id="0265e-240">Returns the status during a create operation.</span><span class="sxs-lookup"><span data-stu-id="0265e-240">Returns the status during a create operation.</span></span> |
| [<span data-ttu-id="0265e-241">Set Secondary Database as Primary (Planned Failover)</span><span class="sxs-lookup"><span data-stu-id="0265e-241">Set Secondary Database as Primary (Planned Failover)</span></span>](https://msdn.microsoft.com/library/azure/mt575007.aspx) |<span data-ttu-id="0265e-242">Promote a secondary database in a Geo-Replication partnership to become the new primary database.</span><span class="sxs-lookup"><span data-stu-id="0265e-242">Promote a secondary database in a Geo-Replication partnership to become the new primary database.</span></span> |
| [<span data-ttu-id="0265e-243">Set Secondary Database as Primary (Unplanned Failover)</span><span class="sxs-lookup"><span data-stu-id="0265e-243">Set Secondary Database as Primary (Unplanned Failover)</span></span>](https://msdn.microsoft.com/library/azure/mt582027.aspx) |<span data-ttu-id="0265e-244">To force a failover to the secondary database and set the secondary as the primary.</span><span class="sxs-lookup"><span data-stu-id="0265e-244">To force a failover to the secondary database and set the secondary as the primary.</span></span> |
| [<span data-ttu-id="0265e-245">Get Replication Links</span><span class="sxs-lookup"><span data-stu-id="0265e-245">Get Replication Links</span></span>](https://msdn.microsoft.com/library/azure/mt600929.aspx) |<span data-ttu-id="0265e-246">Gets all replication links for a given SQL database in a geo-replication partnership.</span><span class="sxs-lookup"><span data-stu-id="0265e-246">Gets all replication links for a given SQL database in a geo-replication partnership.</span></span> <span data-ttu-id="0265e-247">It retrieves the information visible in the sys.geo_replication_links catalog view.</span><span class="sxs-lookup"><span data-stu-id="0265e-247">It retrieves the information visible in the sys.geo_replication_links catalog view.</span></span> |
| [<span data-ttu-id="0265e-248">Get Replication Link</span><span class="sxs-lookup"><span data-stu-id="0265e-248">Get Replication Link</span></span>](https://msdn.microsoft.com/library/azure/mt600778.aspx) |<span data-ttu-id="0265e-249">Gets a specific replication link for a given SQL database in a geo-replication partnership.</span><span class="sxs-lookup"><span data-stu-id="0265e-249">Gets a specific replication link for a given SQL database in a geo-replication partnership.</span></span> <span data-ttu-id="0265e-250">It retrieves the information visible in the sys.geo_replication_links catalog view.</span><span class="sxs-lookup"><span data-stu-id="0265e-250">It retrieves the information visible in the sys.geo_replication_links catalog view.</span></span> |
|  | |

## <a name="next-steps"></a><span data-ttu-id="0265e-251">Next steps</span><span class="sxs-lookup"><span data-stu-id="0265e-251">Next steps</span></span>
* <span data-ttu-id="0265e-252">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="0265e-252">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="0265e-253">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="0265e-253">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="0265e-254">To learn about using automated backups for recovery, see [Restore a database from the service-initiated backups](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="0265e-254">To learn about using automated backups for recovery, see [Restore a database from the service-initiated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="0265e-255">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md).</span><span class="sxs-lookup"><span data-stu-id="0265e-255">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md).</span></span>
* <span data-ttu-id="0265e-256">To learn about authentication requirements for a new primary server and database, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="0265e-256">To learn about authentication requirements for a new primary server and database, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>


