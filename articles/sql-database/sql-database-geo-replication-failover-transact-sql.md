---
title: Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL | Microsoft Docs
description: Initiate a planned or unplanned failover for Azure SQL Database using Transact-SQL
services: sql-database
documentationcenter: ''
author: CarlRabeler
manager: jhubbard
editor: ''
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 6d5ee44b57ce3e60b72ff2a2d182f2b8a39ecf81
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44553582"
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="93f55-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="93f55-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="93f55-104">This article shows you how to initiate failover to a secondary SQL Database using Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="93f55-104">This article shows you how to initiate failover to a secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="93f55-105">To configure Geo-Replication, see [Configure Geo-Replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="93f55-105">To configure Geo-Replication, see [Configure Geo-Replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="93f55-106">To initiate failover, you need the following:</span><span class="sxs-lookup"><span data-stu-id="93f55-106">To initiate failover, you need the following:</span></span>

* <span data-ttu-id="93f55-107">A login that is DBManager on the primary, have db_ownership of the local database that you will geo-replicate, and be DBManager on the partner server(s) to which you will configure Geo-Replication.</span><span class="sxs-lookup"><span data-stu-id="93f55-107">A login that is DBManager on the primary, have db_ownership of the local database that you will geo-replicate, and be DBManager on the partner server(s) to which you will configure Geo-Replication.</span></span>
* <span data-ttu-id="93f55-108">SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="93f55-108">SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="93f55-109">It is recommended that you always use the latest version of Management Studio to remain synchronized with updates to Microsoft Azure and SQL Database.</span><span class="sxs-lookup"><span data-stu-id="93f55-109">It is recommended that you always use the latest version of Management Studio to remain synchronized with updates to Microsoft Azure and SQL Database.</span></span> <span data-ttu-id="93f55-110">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="93f55-110">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
> 
> 

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-to-become-the-new-primary"></a><span data-ttu-id="93f55-111">Initiate a planned failover promoting a secondary database to become the new primary</span><span class="sxs-lookup"><span data-stu-id="93f55-111">Initiate a planned failover promoting a secondary database to become the new primary</span></span>
<span data-ttu-id="93f55-112">You can use the **ALTER DATABASE** statement to promote a secondary database to become the new primary database in a planned fashion, demoting the existing primary to become a secondary.</span><span class="sxs-lookup"><span data-stu-id="93f55-112">You can use the **ALTER DATABASE** statement to promote a secondary database to become the new primary database in a planned fashion, demoting the existing primary to become a secondary.</span></span> <span data-ttu-id="93f55-113">This statement is executed on the master database on the Azure SQL Database logical server in which the geo-replicated secondary database that is being promoted resides.</span><span class="sxs-lookup"><span data-stu-id="93f55-113">This statement is executed on the master database on the Azure SQL Database logical server in which the geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="93f55-114">This functionality is designed for planned failover, such as during the DR drills, and requires that the primary database be available.</span><span class="sxs-lookup"><span data-stu-id="93f55-114">This functionality is designed for planned failover, such as during the DR drills, and requires that the primary database be available.</span></span>

<span data-ttu-id="93f55-115">The command performs the following workflow:</span><span class="sxs-lookup"><span data-stu-id="93f55-115">The command performs the following workflow:</span></span>

1. <span data-ttu-id="93f55-116">Temporarily switches replication to synchronous mode, causing all outstanding transactions to be flushed to the secondary and blocking all new transactions;</span><span class="sxs-lookup"><span data-stu-id="93f55-116">Temporarily switches replication to synchronous mode, causing all outstanding transactions to be flushed to the secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="93f55-117">Switches the roles of the two databases in the Geo-Replication partnership.</span><span class="sxs-lookup"><span data-stu-id="93f55-117">Switches the roles of the two databases in the Geo-Replication partnership.</span></span>  

<span data-ttu-id="93f55-118">This sequence guarantees that the two databases are synchronized before the roles switch and therefore no data loss will occur.</span><span class="sxs-lookup"><span data-stu-id="93f55-118">This sequence guarantees that the two databases are synchronized before the roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="93f55-119">There is a short period during which both databases are unavailable (on the order of 0 to 25 seconds) while the roles are switched.</span><span class="sxs-lookup"><span data-stu-id="93f55-119">There is a short period during which both databases are unavailable (on the order of 0 to 25 seconds) while the roles are switched.</span></span> <span data-ttu-id="93f55-120">If the primary database has multiple secondary databases, the command will automatically reconfigure the other secondaries to connect to the new primary.</span><span class="sxs-lookup"><span data-stu-id="93f55-120">If the primary database has multiple secondary databases, the command will automatically reconfigure the other secondaries to connect to the new primary.</span></span>  <span data-ttu-id="93f55-121">The entire operation should take less than a minute to complete under normal circumstances.</span><span class="sxs-lookup"><span data-stu-id="93f55-121">The entire operation should take less than a minute to complete under normal circumstances.</span></span> <span data-ttu-id="93f55-122">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="93f55-122">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="93f55-123">Use the following steps to initiate a planned failover.</span><span class="sxs-lookup"><span data-stu-id="93f55-123">Use the following steps to initiate a planned failover.</span></span>

1. <span data-ttu-id="93f55-124">In Management Studio, connect to the Azure SQL Database logical server in which a geo-replicated secondary database resides.</span><span class="sxs-lookup"><span data-stu-id="93f55-124">In Management Studio, connect to the Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="93f55-125">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span><span class="sxs-lookup"><span data-stu-id="93f55-125">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="93f55-126">Use the following **ALTER DATABASE** statement to switch the secondary database to the primary role.</span><span class="sxs-lookup"><span data-stu-id="93f55-126">Use the following **ALTER DATABASE** statement to switch the secondary database to the primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="93f55-127">Click **Execute** to run the query.</span><span class="sxs-lookup"><span data-stu-id="93f55-127">Click **Execute** to run the query.</span></span>

> [!NOTE]
> <span data-ttu-id="93f55-128">In rare cases, it is possible that the operation cannot complete and may appear stuck.</span><span class="sxs-lookup"><span data-stu-id="93f55-128">In rare cases, it is possible that the operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="93f55-129">In this case, the user can execute the force failover command and accept data loss.</span><span class="sxs-lookup"><span data-stu-id="93f55-129">In this case, the user can execute the force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-the-primary-database-to-the-secondary-database"></a><span data-ttu-id="93f55-130">Initiate an unplanned failover from the primary database to the secondary database</span><span class="sxs-lookup"><span data-stu-id="93f55-130">Initiate an unplanned failover from the primary database to the secondary database</span></span>
<span data-ttu-id="93f55-131">You can use the **ALTER DATABASE** statement to promote a secondary database to become the new primary database in an unplanned fashion, forcing the demotion of the existing primary to become a secondary at a time when the primary databse is no longer available.</span><span class="sxs-lookup"><span data-stu-id="93f55-131">You can use the **ALTER DATABASE** statement to promote a secondary database to become the new primary database in an unplanned fashion, forcing the demotion of the existing primary to become a secondary at a time when the primary databse is no longer available.</span></span> <span data-ttu-id="93f55-132">This statement is executed on the master database on the Azure SQL Database logical server in which the geo-replicated secondary database that is being promoted resides.</span><span class="sxs-lookup"><span data-stu-id="93f55-132">This statement is executed on the master database on the Azure SQL Database logical server in which the geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="93f55-133">This functionality is designed for disaster recovery when restoring availability of the database is critical and some data loss is acceptable.</span><span class="sxs-lookup"><span data-stu-id="93f55-133">This functionality is designed for disaster recovery when restoring availability of the database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="93f55-134">When forced failover is invoked, the specified secondary database immediately becomes the primary database and begins accepting write transactions.</span><span class="sxs-lookup"><span data-stu-id="93f55-134">When forced failover is invoked, the specified secondary database immediately becomes the primary database and begins accepting write transactions.</span></span> <span data-ttu-id="93f55-135">As soon as the original primary database is able to reconnect with this new primary database, an incremental backup is taken on the original primary database and the old primary database is made into a secondary database for the new primary database; subsequently, it is merely a synchronizing replica of the new primary.</span><span class="sxs-lookup"><span data-stu-id="93f55-135">As soon as the original primary database is able to reconnect with this new primary database, an incremental backup is taken on the original primary database and the old primary database is made into a secondary database for the new primary database; subsequently, it is merely a synchronizing replica of the new primary.</span></span>

<span data-ttu-id="93f55-136">However, because Point In Time Restore is not supported on the secondary databases, if the user wishes to recover data committed to the old primary database that had not been replicated to the new primary database before the forced failover occurred, the user will need to engage support to recover this lost data.</span><span class="sxs-lookup"><span data-stu-id="93f55-136">However, because Point In Time Restore is not supported on the secondary databases, if the user wishes to recover data committed to the old primary database that had not been replicated to the new primary database before the forced failover occurred, the user will need to engage support to recover this lost data.</span></span>

<span data-ttu-id="93f55-137">If the primary database has multiple secondary databases, the command will automatically reconfigure the other secondaries to connect to the new primary.</span><span class="sxs-lookup"><span data-stu-id="93f55-137">If the primary database has multiple secondary databases, the command will automatically reconfigure the other secondaries to connect to the new primary.</span></span>

<span data-ttu-id="93f55-138">Use the following steps to initiate an unplanned failover.</span><span class="sxs-lookup"><span data-stu-id="93f55-138">Use the following steps to initiate an unplanned failover.</span></span>

1. <span data-ttu-id="93f55-139">In Management Studio, connect to the Azure SQL Database logical server in which a geo-replicated secondary database resides.</span><span class="sxs-lookup"><span data-stu-id="93f55-139">In Management Studio, connect to the Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="93f55-140">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span><span class="sxs-lookup"><span data-stu-id="93f55-140">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="93f55-141">Use the following **ALTER DATABASE** statement to switch the secondary database to the primary role.</span><span class="sxs-lookup"><span data-stu-id="93f55-141">Use the following **ALTER DATABASE** statement to switch the secondary database to the primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="93f55-142">Click **Execute** to run the query.</span><span class="sxs-lookup"><span data-stu-id="93f55-142">Click **Execute** to run the query.</span></span>

> [!NOTE]
> <span data-ttu-id="93f55-143">If the command is issued when the both primary and secondary are online the old primary will become the new secondary immediately without data synchronization.</span><span class="sxs-lookup"><span data-stu-id="93f55-143">If the command is issued when the both primary and secondary are online the old primary will become the new secondary immediately without data synchronization.</span></span> <span data-ttu-id="93f55-144">If the primary is committing transactions when the command is issued some data loss may occur.</span><span class="sxs-lookup"><span data-stu-id="93f55-144">If the primary is committing transactions when the command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="93f55-145">Next steps</span><span class="sxs-lookup"><span data-stu-id="93f55-145">Next steps</span></span>
* <span data-ttu-id="93f55-146">After failover, ensure the authentication requirements for your server and database are configured on the new primary.</span><span class="sxs-lookup"><span data-stu-id="93f55-146">After failover, ensure the authentication requirements for your server and database are configured on the new primary.</span></span> <span data-ttu-id="93f55-147">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="93f55-147">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="93f55-148">To learn recovering after a disaster using Active Geo-Replication, including pre and post recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="93f55-148">To learn recovering after a disaster using Active Geo-Replication, including pre and post recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="93f55-149">For a Sasha Nosov blog post about Active Geo-Replication, see [Spotlight on new Geo-Replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="93f55-149">For a Sasha Nosov blog post about Active Geo-Replication, see [Spotlight on new Geo-Replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="93f55-150">For information about designing cloud applications to use Active Geo-Replication, see [Designing cloud applications for business continuity using Geo-Replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="93f55-150">For information about designing cloud applications to use Active Geo-Replication, see [Designing cloud applications for business continuity using Geo-Replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="93f55-151">For information about using Active Geo-Replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="93f55-151">For information about using Active Geo-Replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="93f55-152">For an overview of business continurity, see [Business Continuity Overview](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="93f55-152">For an overview of business continurity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>

