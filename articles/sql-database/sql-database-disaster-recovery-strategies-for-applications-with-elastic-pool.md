---
title: Designing Cloud Solutions for Disaster Recovery Using SQL Database Geo-Replication | Microsoft Docs
description: Learn how to design your cloud solution for disaster recovery by choosing the right failover pattern.
services: sql-database
documentationcenter: ''
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 2db99057-0c79-4fb0-a7f1-d1c057ec787f
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: f5a8d7b56abe4ac1f4f737c7c532a3e549a5ccea
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44552858"
---
# <a name="disaster-recovery-strategies-for-applications-using-sql-database-elastic-pools"></a><span data-ttu-id="9c430-103">Disaster recovery strategies for applications using SQL Database elastic pools</span><span class="sxs-lookup"><span data-stu-id="9c430-103">Disaster recovery strategies for applications using SQL Database elastic pools</span></span>
<span data-ttu-id="9c430-104">Over the years we have learned that cloud services are not foolproof and catastrophic incidents can and will happen.</span><span class="sxs-lookup"><span data-stu-id="9c430-104">Over the years we have learned that cloud services are not foolproof and catastrophic incidents can and will happen.</span></span> <span data-ttu-id="9c430-105">SQL Database provides a number of capabilities to provide for the business continuity of your application when these incidents occur.</span><span class="sxs-lookup"><span data-stu-id="9c430-105">SQL Database provides a number of capabilities to provide for the business continuity of your application when these incidents occur.</span></span> <span data-ttu-id="9c430-106">[Elastic pools](sql-database-elastic-pool.md) and single databases support the same kind of disaster recovery capabilities.</span><span class="sxs-lookup"><span data-stu-id="9c430-106">[Elastic pools](sql-database-elastic-pool.md) and single databases support the same kind of disaster recovery capabilities.</span></span> <span data-ttu-id="9c430-107">This article describes several DR strategies for elastic pools that leverage these SQL Database business continuity features.</span><span class="sxs-lookup"><span data-stu-id="9c430-107">This article describes several DR strategies for elastic pools that leverage these SQL Database business continuity features.</span></span>

<span data-ttu-id="9c430-108">For the purposes of this article we will use the canonical SaaS ISV application pattern:</span><span class="sxs-lookup"><span data-stu-id="9c430-108">For the purposes of this article we will use the canonical SaaS ISV application pattern:</span></span>

<span data-ttu-id="9c430-109"><i>A modern cloud based web application provisions one SQL database for each end user. The ISV has a large number of customers and therefore uses many databases, known as tenant databases. Because the tenant databases typically have unpredictable activity patterns, the ISV uses an elastic pool to make the database cost very predictable over extended periods of time. The elastic pool also simplifies the performance management when the user activity spikes. In addition to the tenant databases the application also uses several databases to manage user profiles, security, collect usage patterns etc. Availability of the individual tenants does not impact the application’s availability as whole. However, the availability and performance of management databases is critical for the application’s function and if the management databases are offline the entire application is offline.</i></span><span class="sxs-lookup"><span data-stu-id="9c430-109"><i>A modern cloud based web application provisions one SQL database for each end user. The ISV has a large number of customers and therefore uses many databases, known as tenant databases. Because the tenant databases typically have unpredictable activity patterns, the ISV uses an elastic pool to make the database cost very predictable over extended periods of time. The elastic pool also simplifies the performance management when the user activity spikes. In addition to the tenant databases the application also uses several databases to manage user profiles, security, collect usage patterns etc. Availability of the individual tenants does not impact the application’s availability as whole. However, the availability and performance of management databases is critical for the application’s function and if the management databases are offline the entire application is offline.</i></span></span>  

<span data-ttu-id="9c430-110">In the rest of the paper we will discuss the DR strategies covering a range of scenarios from the cost sensitive startup applications to the ones with stringent availability requirements.</span><span class="sxs-lookup"><span data-stu-id="9c430-110">In the rest of the paper we will discuss the DR strategies covering a range of scenarios from the cost sensitive startup applications to the ones with stringent availability requirements.</span></span>  

## <a name="scenario-1-cost-sensitive-startup"></a><span data-ttu-id="9c430-111">Scenario 1.</span><span class="sxs-lookup"><span data-stu-id="9c430-111">Scenario 1.</span></span> <span data-ttu-id="9c430-112">Cost sensitive startup</span><span class="sxs-lookup"><span data-stu-id="9c430-112">Cost sensitive startup</span></span>
<span data-ttu-id="9c430-113"><i>I am a startup business and am extremely cost sensitive.  I want to simplify deployment and management of the application and I am willing to have a limited SLA for individual customers. But I want to ensure the application as a whole is never offline.</i></span><span class="sxs-lookup"><span data-stu-id="9c430-113"><i>I am a startup business and am extremely cost sensitive.  I want to simplify deployment and management of the application and I am willing to have a limited SLA for individual customers. But I want to ensure the application as a whole is never offline.</i></span></span>

<span data-ttu-id="9c430-114">To satisfy the simplicity requirement, you should deploy all tenant databases into one elastic pool in the Azure region of your choice and deploy the management database(s) as geo-replicated single database(s).</span><span class="sxs-lookup"><span data-stu-id="9c430-114">To satisfy the simplicity requirement, you should deploy all tenant databases into one elastic pool in the Azure region of your choice and deploy the management database(s) as geo-replicated single database(s).</span></span> <span data-ttu-id="9c430-115">For the disaster recovery of tenants, use geo-restore, which comes at no additional cost.</span><span class="sxs-lookup"><span data-stu-id="9c430-115">For the disaster recovery of tenants, use geo-restore, which comes at no additional cost.</span></span> <span data-ttu-id="9c430-116">To ensure the availability of the management databases, they should be geo-replicated to another region (step 1).</span><span class="sxs-lookup"><span data-stu-id="9c430-116">To ensure the availability of the management databases, they should be geo-replicated to another region (step 1).</span></span> <span data-ttu-id="9c430-117">The ongoing cost of the disaster recovery configuration in this scenario is equal to the total cost of the secondary database(s).</span><span class="sxs-lookup"><span data-stu-id="9c430-117">The ongoing cost of the disaster recovery configuration in this scenario is equal to the total cost of the secondary database(s).</span></span> <span data-ttu-id="9c430-118">This configuration is illustrated on the next diagram.</span><span class="sxs-lookup"><span data-stu-id="9c430-118">This configuration is illustrated on the next diagram.</span></span>

![Figure 1](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-1.png)

<span data-ttu-id="9c430-120">In case of an outage in the primary region, the recovery steps to bring your application online are illustrated by the next diagram.</span><span class="sxs-lookup"><span data-stu-id="9c430-120">In case of an outage in the primary region, the recovery steps to bring your application online are illustrated by the next diagram.</span></span>

* <span data-ttu-id="9c430-121">Immediately failover the management databases (2) to the DR region.</span><span class="sxs-lookup"><span data-stu-id="9c430-121">Immediately failover the management databases (2) to the DR region.</span></span> 
* <span data-ttu-id="9c430-122">Change the the application's connection string to point to the DR region.</span><span class="sxs-lookup"><span data-stu-id="9c430-122">Change the the application's connection string to point to the DR region.</span></span> <span data-ttu-id="9c430-123">All new accounts and tenant databases will be created in the DR region.</span><span class="sxs-lookup"><span data-stu-id="9c430-123">All new accounts and tenant databases will be created in the DR region.</span></span> <span data-ttu-id="9c430-124">The existing customers will see their data temporarily unavailable.</span><span class="sxs-lookup"><span data-stu-id="9c430-124">The existing customers will see their data temporarily unavailable.</span></span>
* <span data-ttu-id="9c430-125">Create the elastic pool with the same configuration as the original pool (3).</span><span class="sxs-lookup"><span data-stu-id="9c430-125">Create the elastic pool with the same configuration as the original pool (3).</span></span> 
* <span data-ttu-id="9c430-126">Use geo-restore to create copies of the tenant databases (4).</span><span class="sxs-lookup"><span data-stu-id="9c430-126">Use geo-restore to create copies of the tenant databases (4).</span></span> <span data-ttu-id="9c430-127">You can consider triggering the individual restores by the end-user connections or use some other application specific priority scheme.</span><span class="sxs-lookup"><span data-stu-id="9c430-127">You can consider triggering the individual restores by the end-user connections or use some other application specific priority scheme.</span></span>

<span data-ttu-id="9c430-128">At this point your application is back online in the DR region, but some customers will experience delay when accessing their data.</span><span class="sxs-lookup"><span data-stu-id="9c430-128">At this point your application is back online in the DR region, but some customers will experience delay when accessing their data.</span></span>

![Figure 2](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-2.png)

<span data-ttu-id="9c430-130">If the outage was temporary, it is possible that the primary region will be recovered by Azure before all the restores are complete in the DR region.</span><span class="sxs-lookup"><span data-stu-id="9c430-130">If the outage was temporary, it is possible that the primary region will be recovered by Azure before all the restores are complete in the DR region.</span></span> <span data-ttu-id="9c430-131">In this case, you should orchestrate moving the application back to the primary region.</span><span class="sxs-lookup"><span data-stu-id="9c430-131">In this case, you should orchestrate moving the application back to the primary region.</span></span> <span data-ttu-id="9c430-132">The process will take the steps illustrated on the next diagram.</span><span class="sxs-lookup"><span data-stu-id="9c430-132">The process will take the steps illustrated on the next diagram.</span></span>

* <span data-ttu-id="9c430-133">Cancel all outstanding geo-restore requests.</span><span class="sxs-lookup"><span data-stu-id="9c430-133">Cancel all outstanding geo-restore requests.</span></span>   
* <span data-ttu-id="9c430-134">Failover the management database(s) to the primary region (5).</span><span class="sxs-lookup"><span data-stu-id="9c430-134">Failover the management database(s) to the primary region (5).</span></span> <span data-ttu-id="9c430-135">Note: After the region’s recovery the old primaries have automatically become secondaries.</span><span class="sxs-lookup"><span data-stu-id="9c430-135">Note: After the region’s recovery the old primaries have automatically become secondaries.</span></span> <span data-ttu-id="9c430-136">Now they will switch roles again.</span><span class="sxs-lookup"><span data-stu-id="9c430-136">Now they will switch roles again.</span></span> 
* <span data-ttu-id="9c430-137">Change the application's connection string to point back to the primary region.</span><span class="sxs-lookup"><span data-stu-id="9c430-137">Change the application's connection string to point back to the primary region.</span></span> <span data-ttu-id="9c430-138">Now all new accounts and tenant databases will be created in the primary region.</span><span class="sxs-lookup"><span data-stu-id="9c430-138">Now all new accounts and tenant databases will be created in the primary region.</span></span> <span data-ttu-id="9c430-139">Some existing customers will see their data temporarily unavailable.</span><span class="sxs-lookup"><span data-stu-id="9c430-139">Some existing customers will see their data temporarily unavailable.</span></span>   
* <span data-ttu-id="9c430-140">Set all databases in the DR pool to read-only to ensure they cannot be modified in the DR region (6).</span><span class="sxs-lookup"><span data-stu-id="9c430-140">Set all databases in the DR pool to read-only to ensure they cannot be modified in the DR region (6).</span></span> 
* <span data-ttu-id="9c430-141">For each database in the DR pool that has changed since the recovery, rename or delete the corresponding databases in the primary pool (7).</span><span class="sxs-lookup"><span data-stu-id="9c430-141">For each database in the DR pool that has changed since the recovery, rename or delete the corresponding databases in the primary pool (7).</span></span> 
* <span data-ttu-id="9c430-142">Copy the updated databases from the DR pool to the primary pool (8).</span><span class="sxs-lookup"><span data-stu-id="9c430-142">Copy the updated databases from the DR pool to the primary pool (8).</span></span> 
* <span data-ttu-id="9c430-143">Delete the DR pool (9)</span><span class="sxs-lookup"><span data-stu-id="9c430-143">Delete the DR pool (9)</span></span>

<span data-ttu-id="9c430-144">At this point your application will be online in the primary region with all tenant databases available in the primary pool.</span><span class="sxs-lookup"><span data-stu-id="9c430-144">At this point your application will be online in the primary region with all tenant databases available in the primary pool.</span></span>

![Figure 3](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-3.png)

<span data-ttu-id="9c430-146">The key **benefit** of this strategy is low ongoing cost for data tier redundancy.</span><span class="sxs-lookup"><span data-stu-id="9c430-146">The key **benefit** of this strategy is low ongoing cost for data tier redundancy.</span></span> <span data-ttu-id="9c430-147">Backups are taken automatically by the SQL Database service with no application rewrite and at no additional cost.</span><span class="sxs-lookup"><span data-stu-id="9c430-147">Backups are taken automatically by the SQL Database service with no application rewrite and at no additional cost.</span></span>  <span data-ttu-id="9c430-148">The cost is incurred only when the elastic databases are restored.</span><span class="sxs-lookup"><span data-stu-id="9c430-148">The cost is incurred only when the elastic databases are restored.</span></span> <span data-ttu-id="9c430-149">The **trade-off** is that the complete recovery of all tenant databases will take significant time.</span><span class="sxs-lookup"><span data-stu-id="9c430-149">The **trade-off** is that the complete recovery of all tenant databases will take significant time.</span></span> <span data-ttu-id="9c430-150">It will depend on the total number of restores you will initiate in the DR region and overall size of the tenant databases.</span><span class="sxs-lookup"><span data-stu-id="9c430-150">It will depend on the total number of restores you will initiate in the DR region and overall size of the tenant databases.</span></span> <span data-ttu-id="9c430-151">Even if you prioritize some tenants' restores over others, you will be competing with all the other restores that are initiated in the same region as the service will arbitrate and throttle to minimize the overall impact on the existing customers' databases.</span><span class="sxs-lookup"><span data-stu-id="9c430-151">Even if you prioritize some tenants' restores over others, you will be competing with all the other restores that are initiated in the same region as the service will arbitrate and throttle to minimize the overall impact on the existing customers' databases.</span></span> <span data-ttu-id="9c430-152">In addition, the recovery of the tenant databases cannot start until the new elastic pool in the DR region is created.</span><span class="sxs-lookup"><span data-stu-id="9c430-152">In addition, the recovery of the tenant databases cannot start until the new elastic pool in the DR region is created.</span></span>

## <a name="scenario-2-mature-application-with-tiered-service"></a><span data-ttu-id="9c430-153">Scenario 2.</span><span class="sxs-lookup"><span data-stu-id="9c430-153">Scenario 2.</span></span> <span data-ttu-id="9c430-154">Mature application with tiered service</span><span class="sxs-lookup"><span data-stu-id="9c430-154">Mature application with tiered service</span></span>
<span data-ttu-id="9c430-155"><i>I am a mature SaaS application with tiered service offers and different SLAs for trial customers and for paying customers. For the trial customers, I have to reduce the cost as much as possible. Trial customers can take downtime but I want to reduce its likelihood. For the paying customers, any downtime is a flight risk. So I want to make sure that paying customers are always able to access their data.</i></span><span class="sxs-lookup"><span data-stu-id="9c430-155"><i>I am a mature SaaS application with tiered service offers and different SLAs for trial customers and for paying customers. For the trial customers, I have to reduce the cost as much as possible. Trial customers can take downtime but I want to reduce its likelihood. For the paying customers, any downtime is a flight risk. So I want to make sure that paying customers are always able to access their data.</i></span></span> 

<span data-ttu-id="9c430-156">To support this scenario, you should separate the trial tenants from paid tenants by putting them into separate elastic pools.</span><span class="sxs-lookup"><span data-stu-id="9c430-156">To support this scenario, you should separate the trial tenants from paid tenants by putting them into separate elastic pools.</span></span> <span data-ttu-id="9c430-157">The trial customers would have lower eDTU per tenant and lower SLA with a longer recovery time.</span><span class="sxs-lookup"><span data-stu-id="9c430-157">The trial customers would have lower eDTU per tenant and lower SLA with a longer recovery time.</span></span> <span data-ttu-id="9c430-158">The paying customers would be in a pool with higher eDTU per tenant and a higher SLA.</span><span class="sxs-lookup"><span data-stu-id="9c430-158">The paying customers would be in a pool with higher eDTU per tenant and a higher SLA.</span></span> <span data-ttu-id="9c430-159">To guarantee the lowest recovery time, the paying customers' tenant databases should be geo-replicated.</span><span class="sxs-lookup"><span data-stu-id="9c430-159">To guarantee the lowest recovery time, the paying customers' tenant databases should be geo-replicated.</span></span> <span data-ttu-id="9c430-160">This configuration is illustrated on the next diagram.</span><span class="sxs-lookup"><span data-stu-id="9c430-160">This configuration is illustrated on the next diagram.</span></span> 

![Figure 4](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-4.png)

<span data-ttu-id="9c430-162">As in the first scenario, the management database(s) will be quite active so you use a single geo-replicated database for it (1).</span><span class="sxs-lookup"><span data-stu-id="9c430-162">As in the first scenario, the management database(s) will be quite active so you use a single geo-replicated database for it (1).</span></span> <span data-ttu-id="9c430-163">This will ensure the predictable performance for new customer subscriptions, profile updates and other management operations.</span><span class="sxs-lookup"><span data-stu-id="9c430-163">This will ensure the predictable performance for new customer subscriptions, profile updates and other management operations.</span></span> <span data-ttu-id="9c430-164">The region in which the primaries of the management database(s) reside will be the primary region and the region in which the secondaries of the management database(s) reside will be the DR region.</span><span class="sxs-lookup"><span data-stu-id="9c430-164">The region in which the primaries of the management database(s) reside will be the primary region and the region in which the secondaries of the management database(s) reside will be the DR region.</span></span>

<span data-ttu-id="9c430-165">The paying customers’ tenant databases will have active databases in the “paid” pool provisioned in the primary region.</span><span class="sxs-lookup"><span data-stu-id="9c430-165">The paying customers’ tenant databases will have active databases in the “paid” pool provisioned in the primary region.</span></span> <span data-ttu-id="9c430-166">You should provision a secondary pool with the same name in the DR region.</span><span class="sxs-lookup"><span data-stu-id="9c430-166">You should provision a secondary pool with the same name in the DR region.</span></span> <span data-ttu-id="9c430-167">Each tenant would be geo-replicated to the secondary pool (2).</span><span class="sxs-lookup"><span data-stu-id="9c430-167">Each tenant would be geo-replicated to the secondary pool (2).</span></span> <span data-ttu-id="9c430-168">This will enable a quick recovery of all tenant databases using failover.</span><span class="sxs-lookup"><span data-stu-id="9c430-168">This will enable a quick recovery of all tenant databases using failover.</span></span> 

<span data-ttu-id="9c430-169">If an outage occurs in the primary region, the recovery steps to bring your application online are illustrated in the next diagram:</span><span class="sxs-lookup"><span data-stu-id="9c430-169">If an outage occurs in the primary region, the recovery steps to bring your application online are illustrated in the next diagram:</span></span>

![Figure 5](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-5.png)

* <span data-ttu-id="9c430-171">Immediately fail over the management database(s) to the DR region (3).</span><span class="sxs-lookup"><span data-stu-id="9c430-171">Immediately fail over the management database(s) to the DR region (3).</span></span>
* <span data-ttu-id="9c430-172">Change the application’s connection string to point to the DR region.</span><span class="sxs-lookup"><span data-stu-id="9c430-172">Change the application’s connection string to point to the DR region.</span></span> <span data-ttu-id="9c430-173">Now all new accounts and tenant databases will be created in the DR region.</span><span class="sxs-lookup"><span data-stu-id="9c430-173">Now all new accounts and tenant databases will be created in the DR region.</span></span> <span data-ttu-id="9c430-174">The existing trial customers will see their data temporarily unavailable.</span><span class="sxs-lookup"><span data-stu-id="9c430-174">The existing trial customers will see their data temporarily unavailable.</span></span>
* <span data-ttu-id="9c430-175">Failover the paid tenant's databases to the pool in the DR region to immediately restore their availability (4).</span><span class="sxs-lookup"><span data-stu-id="9c430-175">Failover the paid tenant's databases to the pool in the DR region to immediately restore their availability (4).</span></span> <span data-ttu-id="9c430-176">Since the failover is a quick metadata level change you may consider an optimization where the individual failovers are triggered on demand by the end user connections.</span><span class="sxs-lookup"><span data-stu-id="9c430-176">Since the failover is a quick metadata level change you may consider an optimization where the individual failovers are triggered on demand by the end user connections.</span></span> 
* <span data-ttu-id="9c430-177">If your secondary pool eDTU size was lower than the primary because the secondary databases only required the capacity to process the change logs while they were secondaries, you should immediately increase the pool capacity now to accommodate the full workload of all tenants (5).</span><span class="sxs-lookup"><span data-stu-id="9c430-177">If your secondary pool eDTU size was lower than the primary because the secondary databases only required the capacity to process the change logs while they were secondaries, you should immediately increase the pool capacity now to accommodate the full workload of all tenants (5).</span></span> 
* <span data-ttu-id="9c430-178">Create the new elastic pool with the same name and the same configuration in the DR region for the trial customers' databases (6).</span><span class="sxs-lookup"><span data-stu-id="9c430-178">Create the new elastic pool with the same name and the same configuration in the DR region for the trial customers' databases (6).</span></span> 
* <span data-ttu-id="9c430-179">Once the trial customers’ pool is created, use geo-restore to restore the individual trial tenant databases into the new pool (7).</span><span class="sxs-lookup"><span data-stu-id="9c430-179">Once the trial customers’ pool is created, use geo-restore to restore the individual trial tenant databases into the new pool (7).</span></span> <span data-ttu-id="9c430-180">You can consider triggering the individual restores by the end-user connections or use some other application specific priority scheme.</span><span class="sxs-lookup"><span data-stu-id="9c430-180">You can consider triggering the individual restores by the end-user connections or use some other application specific priority scheme.</span></span>

<span data-ttu-id="9c430-181">At this point your application is back online in the DR region.</span><span class="sxs-lookup"><span data-stu-id="9c430-181">At this point your application is back online in the DR region.</span></span> <span data-ttu-id="9c430-182">All paying customers have access to their data while the trial customers will experience delay when accessing their data.</span><span class="sxs-lookup"><span data-stu-id="9c430-182">All paying customers have access to their data while the trial customers will experience delay when accessing their data.</span></span>

<span data-ttu-id="9c430-183">When the primary region is recovered by Azure *after* you have restored the application in the DR region you can continue running the application in that region or you can decide to fail back to the primary region.</span><span class="sxs-lookup"><span data-stu-id="9c430-183">When the primary region is recovered by Azure *after* you have restored the application in the DR region you can continue running the application in that region or you can decide to fail back to the primary region.</span></span> <span data-ttu-id="9c430-184">If the primary region is recovered *before* the failover process is completed, you should consider failing back right away.</span><span class="sxs-lookup"><span data-stu-id="9c430-184">If the primary region is recovered *before* the failover process is completed, you should consider failing back right away.</span></span> <span data-ttu-id="9c430-185">The failback will take the steps illustrated in the next diagram:</span><span class="sxs-lookup"><span data-stu-id="9c430-185">The failback will take the steps illustrated in the next diagram:</span></span> 

![Figure 6](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-6.png)

* <span data-ttu-id="9c430-187">Cancel all outstanding geo-restore requests.</span><span class="sxs-lookup"><span data-stu-id="9c430-187">Cancel all outstanding geo-restore requests.</span></span>   
* <span data-ttu-id="9c430-188">Failover the management database(s) (8).</span><span class="sxs-lookup"><span data-stu-id="9c430-188">Failover the management database(s) (8).</span></span> <span data-ttu-id="9c430-189">After the region’s recovery the old primary had automatically become the secondary.</span><span class="sxs-lookup"><span data-stu-id="9c430-189">After the region’s recovery the old primary had automatically become the secondary.</span></span> <span data-ttu-id="9c430-190">Now it becomes the primary again.</span><span class="sxs-lookup"><span data-stu-id="9c430-190">Now it becomes the primary again.</span></span>  
* <span data-ttu-id="9c430-191">Failover the paid tenant databases (9).</span><span class="sxs-lookup"><span data-stu-id="9c430-191">Failover the paid tenant databases (9).</span></span> <span data-ttu-id="9c430-192">Similarly, after the region’s recovery the old primaries automatically become the secondaries.</span><span class="sxs-lookup"><span data-stu-id="9c430-192">Similarly, after the region’s recovery the old primaries automatically become the secondaries.</span></span> <span data-ttu-id="9c430-193">Now they will become the primaries again.</span><span class="sxs-lookup"><span data-stu-id="9c430-193">Now they will become the primaries again.</span></span> 
* <span data-ttu-id="9c430-194">Set the restored trial databases that have changed in the DR region to read-only (10).</span><span class="sxs-lookup"><span data-stu-id="9c430-194">Set the restored trial databases that have changed in the DR region to read-only (10).</span></span>
* <span data-ttu-id="9c430-195">For each database in the trial customers DR pool that changed since the recovery, rename or delete the corresponding database in the trial customers primary pool (11).</span><span class="sxs-lookup"><span data-stu-id="9c430-195">For each database in the trial customers DR pool that changed since the recovery, rename or delete the corresponding database in the trial customers primary pool (11).</span></span> 
* <span data-ttu-id="9c430-196">Copy the updated databases from the DR pool to the primary pool (12).</span><span class="sxs-lookup"><span data-stu-id="9c430-196">Copy the updated databases from the DR pool to the primary pool (12).</span></span> 
* <span data-ttu-id="9c430-197">Delete the DR pool (13)</span><span class="sxs-lookup"><span data-stu-id="9c430-197">Delete the DR pool (13)</span></span> 

> [!NOTE]
> <span data-ttu-id="9c430-198">The failover operation is asynchronous.</span><span class="sxs-lookup"><span data-stu-id="9c430-198">The failover operation is asynchronous.</span></span> <span data-ttu-id="9c430-199">To minimize the recovery time it is important that you execute the tenant databases' failover command in batches of at least 20 databases.</span><span class="sxs-lookup"><span data-stu-id="9c430-199">To minimize the recovery time it is important that you execute the tenant databases' failover command in batches of at least 20 databases.</span></span> 
> 
> 

<span data-ttu-id="9c430-200">The key **benefit** of this strategy is that it provides the highest SLA for the paying customers.</span><span class="sxs-lookup"><span data-stu-id="9c430-200">The key **benefit** of this strategy is that it provides the highest SLA for the paying customers.</span></span> <span data-ttu-id="9c430-201">It also guarantees that the new trials are unblocked as soon as the trial DR pool is created.</span><span class="sxs-lookup"><span data-stu-id="9c430-201">It also guarantees that the new trials are unblocked as soon as the trial DR pool is created.</span></span> <span data-ttu-id="9c430-202">The **trade-off** is that this setup will increase the total cost of the tenant databases by the cost of the secondary DR pool for paid customers.</span><span class="sxs-lookup"><span data-stu-id="9c430-202">The **trade-off** is that this setup will increase the total cost of the tenant databases by the cost of the secondary DR pool for paid customers.</span></span> <span data-ttu-id="9c430-203">In addition, if the secondary pool has a different size, the paying customers will experience lower performance after failover until the pool upgrade in the DR region is completed.</span><span class="sxs-lookup"><span data-stu-id="9c430-203">In addition, if the secondary pool has a different size, the paying customers will experience lower performance after failover until the pool upgrade in the DR region is completed.</span></span> 

## <a name="scenario-3-geographically-distributed-application-with-tiered-service"></a><span data-ttu-id="9c430-204">Scenario 3.</span><span class="sxs-lookup"><span data-stu-id="9c430-204">Scenario 3.</span></span> <span data-ttu-id="9c430-205">Geographically distributed application with tiered service</span><span class="sxs-lookup"><span data-stu-id="9c430-205">Geographically distributed application with tiered service</span></span>
<span data-ttu-id="9c430-206"><i>I have a mature SaaS application with tiered service offers. I want to offer a very aggressive SLA to my paid customers and minimize the risk of impact when outages occur because even brief interruption can cause customer dissatisfaction. It is critical that the paying customers can always access their data. The trials are free and an SLA is not offered during the trial period. </i></span><span class="sxs-lookup"><span data-stu-id="9c430-206"><i>I have a mature SaaS application with tiered service offers. I want to offer a very aggressive SLA to my paid customers and minimize the risk of impact when outages occur because even brief interruption can cause customer dissatisfaction. It is critical that the paying customers can always access their data. The trials are free and an SLA is not offered during the trial period. </i></span></span> 

<span data-ttu-id="9c430-207">To support this scenario, you should have three separate elastic pools.</span><span class="sxs-lookup"><span data-stu-id="9c430-207">To support this scenario, you should have three separate elastic pools.</span></span> <span data-ttu-id="9c430-208">Two equal size pools with high eDTUs per database should be provisioned in two different regions to contain the paid customers' tenant databases.</span><span class="sxs-lookup"><span data-stu-id="9c430-208">Two equal size pools with high eDTUs per database should be provisioned in two different regions to contain the paid customers' tenant databases.</span></span> <span data-ttu-id="9c430-209">The third pool containing the trial tenants would have a lower eDTUs per database and be provisioned in one of the two region.</span><span class="sxs-lookup"><span data-stu-id="9c430-209">The third pool containing the trial tenants would have a lower eDTUs per database and be provisioned in one of the two region.</span></span>

<span data-ttu-id="9c430-210">To guarantee the lowest recovery time during outages the paying customers' tenant databases should be geo-replicated with 50% of the primary databases in each of the two regions.</span><span class="sxs-lookup"><span data-stu-id="9c430-210">To guarantee the lowest recovery time during outages the paying customers' tenant databases should be geo-replicated with 50% of the primary databases in each of the two regions.</span></span> <span data-ttu-id="9c430-211">Similarly, each region would have 50% of the secondary databases.</span><span class="sxs-lookup"><span data-stu-id="9c430-211">Similarly, each region would have 50% of the secondary databases.</span></span> <span data-ttu-id="9c430-212">This way if a region is offline only 50% of the paid customers' databases would be impacted and would have to failover.</span><span class="sxs-lookup"><span data-stu-id="9c430-212">This way if a region is offline only 50% of the paid customers' databases would be impacted and would have to failover.</span></span> <span data-ttu-id="9c430-213">The other databases would remain intact.</span><span class="sxs-lookup"><span data-stu-id="9c430-213">The other databases would remain intact.</span></span> <span data-ttu-id="9c430-214">This configuration is illustrated in the following diagram:</span><span class="sxs-lookup"><span data-stu-id="9c430-214">This configuration is illustrated in the following diagram:</span></span>

![Figure 4](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-7.png)

<span data-ttu-id="9c430-216">As in the previous scenarios, the management database(s) will be quite active so you should configure them as single geo-replicated database(s) (1).</span><span class="sxs-lookup"><span data-stu-id="9c430-216">As in the previous scenarios, the management database(s) will be quite active so you should configure them as single geo-replicated database(s) (1).</span></span> <span data-ttu-id="9c430-217">This will ensure the predictable performance of the new customer subscriptions, profile updates and other management operations.</span><span class="sxs-lookup"><span data-stu-id="9c430-217">This will ensure the predictable performance of the new customer subscriptions, profile updates and other management operations.</span></span> <span data-ttu-id="9c430-218">Region A would be the primary region for the management database(s) and the region B will be used for recovery of the management database(s).</span><span class="sxs-lookup"><span data-stu-id="9c430-218">Region A would be the primary region for the management database(s) and the region B will be used for recovery of the management database(s).</span></span>

<span data-ttu-id="9c430-219">The paying customers’ tenant databases will be also geo-replicated but with primaries and secondaries split between region A and region B (2).</span><span class="sxs-lookup"><span data-stu-id="9c430-219">The paying customers’ tenant databases will be also geo-replicated but with primaries and secondaries split between region A and region B (2).</span></span> <span data-ttu-id="9c430-220">This way the tenant primary databases impacted by the outage can failover to the other region and become available.</span><span class="sxs-lookup"><span data-stu-id="9c430-220">This way the tenant primary databases impacted by the outage can failover to the other region and become available.</span></span> <span data-ttu-id="9c430-221">The other half of the tenant databases will not be impacted at all.</span><span class="sxs-lookup"><span data-stu-id="9c430-221">The other half of the tenant databases will not be impacted at all.</span></span> 

<span data-ttu-id="9c430-222">The next diagram illustrates the recovery steps to take if  an outage occurs in region A.</span><span class="sxs-lookup"><span data-stu-id="9c430-222">The next diagram illustrates the recovery steps to take if  an outage occurs in region A.</span></span>

![Figure 5](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-8.png)

* <span data-ttu-id="9c430-224">Immediately fail over the management databases to region B (3).</span><span class="sxs-lookup"><span data-stu-id="9c430-224">Immediately fail over the management databases to region B (3).</span></span>
* <span data-ttu-id="9c430-225">Change the application’s connection string to point to the management database(s) in region B. Modify the management database(s) to make sure the new accounts and tenant databases will be created in region B and the existing tenant databases will be found there as well.</span><span class="sxs-lookup"><span data-stu-id="9c430-225">Change the application’s connection string to point to the management database(s) in region B. Modify the management database(s) to make sure the new accounts and tenant databases will be created in region B and the existing tenant databases will be found there as well.</span></span> <span data-ttu-id="9c430-226">The existing trial customers will see their data temporarily unavailable.</span><span class="sxs-lookup"><span data-stu-id="9c430-226">The existing trial customers will see their data temporarily unavailable.</span></span>
* <span data-ttu-id="9c430-227">Failover the paid tenant's databases to pool 2 in region B to immediately restore their availability (4).</span><span class="sxs-lookup"><span data-stu-id="9c430-227">Failover the paid tenant's databases to pool 2 in region B to immediately restore their availability (4).</span></span> <span data-ttu-id="9c430-228">Since the failover is a quick metadata level change you may consider an optimization where the individual failovers are triggered on demand by the end user connections.</span><span class="sxs-lookup"><span data-stu-id="9c430-228">Since the failover is a quick metadata level change you may consider an optimization where the individual failovers are triggered on demand by the end user connections.</span></span> 
* <span data-ttu-id="9c430-229">Since now pool 2 contains only primary  databases the total workload in the pool will increase so you should immediately increase its eDTU size (5).</span><span class="sxs-lookup"><span data-stu-id="9c430-229">Since now pool 2 contains only primary  databases the total workload in the pool will increase so you should immediately increase its eDTU size (5).</span></span> 
* <span data-ttu-id="9c430-230">Create the new elastic pool with the same name and the same configuration in the region B for the trial customers' databases (6).</span><span class="sxs-lookup"><span data-stu-id="9c430-230">Create the new elastic pool with the same name and the same configuration in the region B for the trial customers' databases (6).</span></span> 
* <span data-ttu-id="9c430-231">Once the pool is created use geo-restore to restore the individual trial tenant database into the pool (7).</span><span class="sxs-lookup"><span data-stu-id="9c430-231">Once the pool is created use geo-restore to restore the individual trial tenant database into the pool (7).</span></span> <span data-ttu-id="9c430-232">You can consider triggering the individual restores by the end-user connections or use some other application specific priority scheme.</span><span class="sxs-lookup"><span data-stu-id="9c430-232">You can consider triggering the individual restores by the end-user connections or use some other application specific priority scheme.</span></span>

> [!NOTE]
> <span data-ttu-id="9c430-233">The failover operation is asynchronous.</span><span class="sxs-lookup"><span data-stu-id="9c430-233">The failover operation is asynchronous.</span></span> <span data-ttu-id="9c430-234">To minimize the recovery time it is important that you execute the tenant databases' failover command in batches of at least 20 databases.</span><span class="sxs-lookup"><span data-stu-id="9c430-234">To minimize the recovery time it is important that you execute the tenant databases' failover command in batches of at least 20 databases.</span></span> 
> 
> 

<span data-ttu-id="9c430-235">At this point your application is back online in region B. All paying customers have access to their data while the trial customers will experience delay when accessing their data.</span><span class="sxs-lookup"><span data-stu-id="9c430-235">At this point your application is back online in region B. All paying customers have access to their data while the trial customers will experience delay when accessing their data.</span></span>

<span data-ttu-id="9c430-236">When region A is recovered you need to decide if you want to use region B for trial customers or failback to using the trial customers pool in region A. One criteria could be the % of trial tenant databases modified since the recovery.</span><span class="sxs-lookup"><span data-stu-id="9c430-236">When region A is recovered you need to decide if you want to use region B for trial customers or failback to using the trial customers pool in region A. One criteria could be the % of trial tenant databases modified since the recovery.</span></span> <span data-ttu-id="9c430-237">Regardless of that decision you will need to re-balance the paid tenants between two pools.</span><span class="sxs-lookup"><span data-stu-id="9c430-237">Regardless of that decision you will need to re-balance the paid tenants between two pools.</span></span> <span data-ttu-id="9c430-238">the next diagram illustrates the process when the trial tenant databases fail back to region A.</span><span class="sxs-lookup"><span data-stu-id="9c430-238">the next diagram illustrates the process when the trial tenant databases fail back to region A.</span></span>  

![Figure 6](https://docstestmedia1.blob.core.windows.net/azure-media/articles/sql-database/media/sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool/diagram-9.png)

* <span data-ttu-id="9c430-240">Cancel all outstanding geo-restore requests to trial DR pool.</span><span class="sxs-lookup"><span data-stu-id="9c430-240">Cancel all outstanding geo-restore requests to trial DR pool.</span></span>   
* <span data-ttu-id="9c430-241">Failover the management database (8).</span><span class="sxs-lookup"><span data-stu-id="9c430-241">Failover the management database (8).</span></span> <span data-ttu-id="9c430-242">After the region’s recovery, the old primary had automatically became the secondary.</span><span class="sxs-lookup"><span data-stu-id="9c430-242">After the region’s recovery, the old primary had automatically became the secondary.</span></span> <span data-ttu-id="9c430-243">Now it becomes the primary again.</span><span class="sxs-lookup"><span data-stu-id="9c430-243">Now it becomes the primary again.</span></span>  
* <span data-ttu-id="9c430-244">Select which paid tenant databases will fail back to pool 1 and initiate failover to their secondaries (9).</span><span class="sxs-lookup"><span data-stu-id="9c430-244">Select which paid tenant databases will fail back to pool 1 and initiate failover to their secondaries (9).</span></span> <span data-ttu-id="9c430-245">After the region’s recovery all databases in pool 1 automatically became secondaries.</span><span class="sxs-lookup"><span data-stu-id="9c430-245">After the region’s recovery all databases in pool 1 automatically became secondaries.</span></span> <span data-ttu-id="9c430-246">Now 50% of them will become primaries again.</span><span class="sxs-lookup"><span data-stu-id="9c430-246">Now 50% of them will become primaries again.</span></span> 
* <span data-ttu-id="9c430-247">Reduce the size of pool 2 to the original eDTU (10).</span><span class="sxs-lookup"><span data-stu-id="9c430-247">Reduce the size of pool 2 to the original eDTU (10).</span></span>
* <span data-ttu-id="9c430-248">Set all restored trial databases in the region B to read-only (11).</span><span class="sxs-lookup"><span data-stu-id="9c430-248">Set all restored trial databases in the region B to read-only (11).</span></span>
* <span data-ttu-id="9c430-249">For each database in the trial DR pool that has changed since the recovery rename or delete the corresponding database in the trial primary pool (12).</span><span class="sxs-lookup"><span data-stu-id="9c430-249">For each database in the trial DR pool that has changed since the recovery rename or delete the corresponding database in the trial primary pool (12).</span></span> 
* <span data-ttu-id="9c430-250">Copy the updated databases from the DR pool to the primary pool (13).</span><span class="sxs-lookup"><span data-stu-id="9c430-250">Copy the updated databases from the DR pool to the primary pool (13).</span></span> 
* <span data-ttu-id="9c430-251">Delete the DR pool (14)</span><span class="sxs-lookup"><span data-stu-id="9c430-251">Delete the DR pool (14)</span></span> 

<span data-ttu-id="9c430-252">The key **benefits** of this strategy are:</span><span class="sxs-lookup"><span data-stu-id="9c430-252">The key **benefits** of this strategy are:</span></span>

* <span data-ttu-id="9c430-253">It supports the most aggressive SLA for the paying customers because it ensures that an outage cannot impact more than 50% of the tenant databases.</span><span class="sxs-lookup"><span data-stu-id="9c430-253">It supports the most aggressive SLA for the paying customers because it ensures that an outage cannot impact more than 50% of the tenant databases.</span></span> 
* <span data-ttu-id="9c430-254">It guarantees that the new trials are unblocked as soon as the trail DR pool is created during the recovery.</span><span class="sxs-lookup"><span data-stu-id="9c430-254">It guarantees that the new trials are unblocked as soon as the trail DR pool is created during the recovery.</span></span> 
* <span data-ttu-id="9c430-255">It allows more efficient use of the pool capacity as 50% of secondary databases in pool 1 and pool 2 are guaranteed to be less active then the primary databases.</span><span class="sxs-lookup"><span data-stu-id="9c430-255">It allows more efficient use of the pool capacity as 50% of secondary databases in pool 1 and pool 2 are guaranteed to be less active then the primary databases.</span></span>

<span data-ttu-id="9c430-256">The main **trade-offs** are:</span><span class="sxs-lookup"><span data-stu-id="9c430-256">The main **trade-offs** are:</span></span>

* <span data-ttu-id="9c430-257">The CRUD operations against the management database(s) will have lower latency for the end users connected to region A than for the end users connected to region B as they will be executed against the primary of the management database(s).</span><span class="sxs-lookup"><span data-stu-id="9c430-257">The CRUD operations against the management database(s) will have lower latency for the end users connected to region A than for the end users connected to region B as they will be executed against the primary of the management database(s).</span></span>
* <span data-ttu-id="9c430-258">It requires more complex design of the management database.</span><span class="sxs-lookup"><span data-stu-id="9c430-258">It requires more complex design of the management database.</span></span> <span data-ttu-id="9c430-259">For example, each tenant record would have to have a location tag that needs to be changed during failover and failback.</span><span class="sxs-lookup"><span data-stu-id="9c430-259">For example, each tenant record would have to have a location tag that needs to be changed during failover and failback.</span></span>  
* <span data-ttu-id="9c430-260">The paying customers may experience lower performance than usual until the pool upgrade in region B is completed.</span><span class="sxs-lookup"><span data-stu-id="9c430-260">The paying customers may experience lower performance than usual until the pool upgrade in region B is completed.</span></span> 

## <a name="summary"></a><span data-ttu-id="9c430-261">Summary</span><span class="sxs-lookup"><span data-stu-id="9c430-261">Summary</span></span>
<span data-ttu-id="9c430-262">This article focuses on the disaster recovery strategies for the database tier used by a SaaS ISV multi-tenant application.</span><span class="sxs-lookup"><span data-stu-id="9c430-262">This article focuses on the disaster recovery strategies for the database tier used by a SaaS ISV multi-tenant application.</span></span> <span data-ttu-id="9c430-263">The strategy you choose should be based on the needs of the application, such as the business model, the SLA you want to offer to your customers, budget constraint etc..</span><span class="sxs-lookup"><span data-stu-id="9c430-263">The strategy you choose should be based on the needs of the application, such as the business model, the SLA you want to offer to your customers, budget constraint etc..</span></span> <span data-ttu-id="9c430-264">Each described strategy outlines the benefits and trade-off so you could make an informed decision.</span><span class="sxs-lookup"><span data-stu-id="9c430-264">Each described strategy outlines the benefits and trade-off so you could make an informed decision.</span></span> <span data-ttu-id="9c430-265">Also, your specific application will likely include other Azure components.</span><span class="sxs-lookup"><span data-stu-id="9c430-265">Also, your specific application will likely include other Azure components.</span></span> <span data-ttu-id="9c430-266">So you should review their business continuity guidance and orchestrate the recovery of the database tier with them.</span><span class="sxs-lookup"><span data-stu-id="9c430-266">So you should review their business continuity guidance and orchestrate the recovery of the database tier with them.</span></span> <span data-ttu-id="9c430-267">To learn more about managing recovery of database applications in Azure, refer to [Designing cloud solutions for disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) .</span><span class="sxs-lookup"><span data-stu-id="9c430-267">To learn more about managing recovery of database applications in Azure, refer to [Designing cloud solutions for disaster recovery](sql-database-designing-cloud-solutions-for-disaster-recovery.md) .</span></span>  

## <a name="next-steps"></a><span data-ttu-id="9c430-268">Next steps</span><span class="sxs-lookup"><span data-stu-id="9c430-268">Next steps</span></span>
* <span data-ttu-id="9c430-269">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="9c430-269">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="9c430-270">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="9c430-270">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="9c430-271">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="9c430-271">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>
* <span data-ttu-id="9c430-272">To learn about faster recovery options, see [Active-Geo-Replication](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="9c430-272">To learn about faster recovery options, see [Active-Geo-Replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="9c430-273">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span><span class="sxs-lookup"><span data-stu-id="9c430-273">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span></span>










