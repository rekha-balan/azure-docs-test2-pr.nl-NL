---
title: Health monitoring overview for Azure Application Gateway | Microsoft Docs
description: Learn about the monitoring capabilities in Azure Application Gateway
services: application-gateway
documentationcenter: na
author: georgewallace
manager: timlt
editor: ''
tags: azure-resource-manager
ms.assetid: 7eeba328-bb2d-4d3e-bdac-7552e7900b7f
ms.service: application-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/14/2016
ms.author: gwallace
ms.openlocfilehash: 9bce7a4d34c7b7e9d7bad00a14230cc6304cd3e7
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44662195"
---
# <a name="application-gateway-health-monitoring-overview"></a><span data-ttu-id="814a2-103">Application Gateway health monitoring overview</span><span class="sxs-lookup"><span data-stu-id="814a2-103">Application Gateway health monitoring overview</span></span>

<span data-ttu-id="814a2-104">Azure Application Gateway by default monitors the health of all resources in its back-end pool and automatically removes any resource considered unhealthy from the pool.</span><span class="sxs-lookup"><span data-stu-id="814a2-104">Azure Application Gateway by default monitors the health of all resources in its back-end pool and automatically removes any resource considered unhealthy from the pool.</span></span> <span data-ttu-id="814a2-105">Application Gateway continues to monitor the unhealthy instances and adds them back to the healthy back-end pool once they become available and respond to health probes.</span><span class="sxs-lookup"><span data-stu-id="814a2-105">Application Gateway continues to monitor the unhealthy instances and adds them back to the healthy back-end pool once they become available and respond to health probes.</span></span> <span data-ttu-id="814a2-106">Application gateway sends the health probes with the same port that is defined in the back-end HTTP settings.</span><span class="sxs-lookup"><span data-stu-id="814a2-106">Application gateway sends the health probes with the same port that is defined in the back-end HTTP settings.</span></span> <span data-ttu-id="814a2-107">This configuration ensures that the probe is testing the same port that customers would be using to connect to the backend.</span><span class="sxs-lookup"><span data-stu-id="814a2-107">This configuration ensures that the probe is testing the same port that customers would be using to connect to the backend.</span></span>

![application gateway probe example][1]

<span data-ttu-id="814a2-109">In addition to using default health probe monitoring, you can also customize the health probe to suit your application's requirements.</span><span class="sxs-lookup"><span data-stu-id="814a2-109">In addition to using default health probe monitoring, you can also customize the health probe to suit your application's requirements.</span></span> <span data-ttu-id="814a2-110">In this article, both default and custom health probes are covered.</span><span class="sxs-lookup"><span data-stu-id="814a2-110">In this article, both default and custom health probes are covered.</span></span>

> [!NOTE]
> <span data-ttu-id="814a2-111">If there is an NSG on Application Gateway subnet, port ranges 65503-65534 should be opened on the Application Gateway subnet for Inbound traffic.</span><span class="sxs-lookup"><span data-stu-id="814a2-111">If there is an NSG on Application Gateway subnet, port ranges 65503-65534 should be opened on the Application Gateway subnet for Inbound traffic.</span></span> <span data-ttu-id="814a2-112">These ports are required for the backend health API to work.</span><span class="sxs-lookup"><span data-stu-id="814a2-112">These ports are required for the backend health API to work.</span></span>

## <a name="default-health-probe"></a><span data-ttu-id="814a2-113">Default health probe</span><span class="sxs-lookup"><span data-stu-id="814a2-113">Default health probe</span></span>

<span data-ttu-id="814a2-114">An application gateway automatically configures a default health probe when you don't set up any custom probe configuration.</span><span class="sxs-lookup"><span data-stu-id="814a2-114">An application gateway automatically configures a default health probe when you don't set up any custom probe configuration.</span></span> <span data-ttu-id="814a2-115">The monitoring behavior works by making an HTTP request to the IP addresses configured for the back-end pool.</span><span class="sxs-lookup"><span data-stu-id="814a2-115">The monitoring behavior works by making an HTTP request to the IP addresses configured for the back-end pool.</span></span> <span data-ttu-id="814a2-116">For default probes if the backend http settings are configured for HTTPS, the probe uses HTTPS as well to test health of the backends.</span><span class="sxs-lookup"><span data-stu-id="814a2-116">For default probes if the backend http settings are configured for HTTPS, the probe uses HTTPS as well to test health of the backends.</span></span>

<span data-ttu-id="814a2-117">For example: You configure your application gateway to use back-end servers A, B, and C to receive HTTP network traffic on port 80.</span><span class="sxs-lookup"><span data-stu-id="814a2-117">For example: You configure your application gateway to use back-end servers A, B, and C to receive HTTP network traffic on port 80.</span></span> <span data-ttu-id="814a2-118">The default health monitoring tests the three servers every 30 seconds for a healthy HTTP response.</span><span class="sxs-lookup"><span data-stu-id="814a2-118">The default health monitoring tests the three servers every 30 seconds for a healthy HTTP response.</span></span> <span data-ttu-id="814a2-119">A healthy HTTP response has a [status code](https://msdn.microsoft.com/library/aa287675.aspx) between 200 and 399.</span><span class="sxs-lookup"><span data-stu-id="814a2-119">A healthy HTTP response has a [status code](https://msdn.microsoft.com/library/aa287675.aspx) between 200 and 399.</span></span>

<span data-ttu-id="814a2-120">If the default probe check fails for server A, the application gateway removes it from its back-end pool, and network traffic stops flowing to this server.</span><span class="sxs-lookup"><span data-stu-id="814a2-120">If the default probe check fails for server A, the application gateway removes it from its back-end pool, and network traffic stops flowing to this server.</span></span> <span data-ttu-id="814a2-121">The default probe still continues to check for server A every 30 seconds.</span><span class="sxs-lookup"><span data-stu-id="814a2-121">The default probe still continues to check for server A every 30 seconds.</span></span> <span data-ttu-id="814a2-122">When server A responds successfully to one request from a default health probe, it is added back as healthy to the back-end pool, and traffic starts flowing to the server again.</span><span class="sxs-lookup"><span data-stu-id="814a2-122">When server A responds successfully to one request from a default health probe, it is added back as healthy to the back-end pool, and traffic starts flowing to the server again.</span></span>

### <a name="default-health-probe-settings"></a><span data-ttu-id="814a2-123">Default health probe settings</span><span class="sxs-lookup"><span data-stu-id="814a2-123">Default health probe settings</span></span>

| <span data-ttu-id="814a2-124">Probe property</span><span class="sxs-lookup"><span data-stu-id="814a2-124">Probe property</span></span> | <span data-ttu-id="814a2-125">Value</span><span class="sxs-lookup"><span data-stu-id="814a2-125">Value</span></span> | <span data-ttu-id="814a2-126">Description</span><span class="sxs-lookup"><span data-stu-id="814a2-126">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="814a2-127">Probe URL</span><span class="sxs-lookup"><span data-stu-id="814a2-127">Probe URL</span></span> |http://127.0.0.1:\<port\>/ |<span data-ttu-id="814a2-128">URL path</span><span class="sxs-lookup"><span data-stu-id="814a2-128">URL path</span></span> |
| <span data-ttu-id="814a2-129">Interval</span><span class="sxs-lookup"><span data-stu-id="814a2-129">Interval</span></span> |<span data-ttu-id="814a2-130">30</span><span class="sxs-lookup"><span data-stu-id="814a2-130">30</span></span> |<span data-ttu-id="814a2-131">Probe interval in seconds</span><span class="sxs-lookup"><span data-stu-id="814a2-131">Probe interval in seconds</span></span> |
| <span data-ttu-id="814a2-132">Time-out</span><span class="sxs-lookup"><span data-stu-id="814a2-132">Time-out</span></span> |<span data-ttu-id="814a2-133">30</span><span class="sxs-lookup"><span data-stu-id="814a2-133">30</span></span> |<span data-ttu-id="814a2-134">Probe time-out in seconds</span><span class="sxs-lookup"><span data-stu-id="814a2-134">Probe time-out in seconds</span></span> |
| <span data-ttu-id="814a2-135">Unhealthy threshold</span><span class="sxs-lookup"><span data-stu-id="814a2-135">Unhealthy threshold</span></span> |<span data-ttu-id="814a2-136">3</span><span class="sxs-lookup"><span data-stu-id="814a2-136">3</span></span> |<span data-ttu-id="814a2-137">Probe retry count.</span><span class="sxs-lookup"><span data-stu-id="814a2-137">Probe retry count.</span></span> <span data-ttu-id="814a2-138">The back-end server is marked down after the consecutive probe failure count reaches the unhealthy threshold.</span><span class="sxs-lookup"><span data-stu-id="814a2-138">The back-end server is marked down after the consecutive probe failure count reaches the unhealthy threshold.</span></span> |

> [!NOTE]
> <span data-ttu-id="814a2-139">The port is the same port as the back-end HTTP settings.</span><span class="sxs-lookup"><span data-stu-id="814a2-139">The port is the same port as the back-end HTTP settings.</span></span>

<span data-ttu-id="814a2-140">The default probe looks only at http://127.0.0.1:\<port\> to determine health status.</span><span class="sxs-lookup"><span data-stu-id="814a2-140">The default probe looks only at http://127.0.0.1:\<port\> to determine health status.</span></span> <span data-ttu-id="814a2-141">If you need to configure the health probe to go to a custom URL or modify any other settings, you must use custom probes as described in the following steps:</span><span class="sxs-lookup"><span data-stu-id="814a2-141">If you need to configure the health probe to go to a custom URL or modify any other settings, you must use custom probes as described in the following steps:</span></span>

## <a name="custom-health-probe"></a><span data-ttu-id="814a2-142">Custom health probe</span><span class="sxs-lookup"><span data-stu-id="814a2-142">Custom health probe</span></span>

<span data-ttu-id="814a2-143">Custom probes allow you to have a more granular control over the health monitoring.</span><span class="sxs-lookup"><span data-stu-id="814a2-143">Custom probes allow you to have a more granular control over the health monitoring.</span></span> <span data-ttu-id="814a2-144">When using custom probes, you can configure the probe interval, the URL and path to test, and how many failed responses to accept before marking the back-end pool instance as unhealthy.</span><span class="sxs-lookup"><span data-stu-id="814a2-144">When using custom probes, you can configure the probe interval, the URL and path to test, and how many failed responses to accept before marking the back-end pool instance as unhealthy.</span></span>

### <a name="custom-health-probe-settings"></a><span data-ttu-id="814a2-145">Custom health probe settings</span><span class="sxs-lookup"><span data-stu-id="814a2-145">Custom health probe settings</span></span>

<span data-ttu-id="814a2-146">The following table provides definitions for the properties of a custom health probe.</span><span class="sxs-lookup"><span data-stu-id="814a2-146">The following table provides definitions for the properties of a custom health probe.</span></span>

| <span data-ttu-id="814a2-147">Probe property</span><span class="sxs-lookup"><span data-stu-id="814a2-147">Probe property</span></span> | <span data-ttu-id="814a2-148">Description</span><span class="sxs-lookup"><span data-stu-id="814a2-148">Description</span></span> |
| --- | --- |
| <span data-ttu-id="814a2-149">Name</span><span class="sxs-lookup"><span data-stu-id="814a2-149">Name</span></span> |<span data-ttu-id="814a2-150">Name of the probe.</span><span class="sxs-lookup"><span data-stu-id="814a2-150">Name of the probe.</span></span> <span data-ttu-id="814a2-151">This name is used to refer to the probe in back-end HTTP settings.</span><span class="sxs-lookup"><span data-stu-id="814a2-151">This name is used to refer to the probe in back-end HTTP settings.</span></span> |
| <span data-ttu-id="814a2-152">Protocol</span><span class="sxs-lookup"><span data-stu-id="814a2-152">Protocol</span></span> |<span data-ttu-id="814a2-153">Protocol used to send the probe.</span><span class="sxs-lookup"><span data-stu-id="814a2-153">Protocol used to send the probe.</span></span> <span data-ttu-id="814a2-154">The probe uses the protocol defined in the back-end HTTP settings</span><span class="sxs-lookup"><span data-stu-id="814a2-154">The probe uses the protocol defined in the back-end HTTP settings</span></span> |
| <span data-ttu-id="814a2-155">Host</span><span class="sxs-lookup"><span data-stu-id="814a2-155">Host</span></span> |<span data-ttu-id="814a2-156">Host name to send the probe.</span><span class="sxs-lookup"><span data-stu-id="814a2-156">Host name to send the probe.</span></span> <span data-ttu-id="814a2-157">Applicable only when multi-site is configured on Application Gateway, otherwise use '127.0.0.1'.</span><span class="sxs-lookup"><span data-stu-id="814a2-157">Applicable only when multi-site is configured on Application Gateway, otherwise use '127.0.0.1'.</span></span> <span data-ttu-id="814a2-158">This value is different from VM host name.</span><span class="sxs-lookup"><span data-stu-id="814a2-158">This value is different from VM host name.</span></span> |
| <span data-ttu-id="814a2-159">Path</span><span class="sxs-lookup"><span data-stu-id="814a2-159">Path</span></span> |<span data-ttu-id="814a2-160">Relative path of the probe.</span><span class="sxs-lookup"><span data-stu-id="814a2-160">Relative path of the probe.</span></span> <span data-ttu-id="814a2-161">The valid path starts from '/'.</span><span class="sxs-lookup"><span data-stu-id="814a2-161">The valid path starts from '/'.</span></span> |
| <span data-ttu-id="814a2-162">Interval</span><span class="sxs-lookup"><span data-stu-id="814a2-162">Interval</span></span> |<span data-ttu-id="814a2-163">Probe interval in seconds.</span><span class="sxs-lookup"><span data-stu-id="814a2-163">Probe interval in seconds.</span></span> <span data-ttu-id="814a2-164">This value is the time interval between two consecutive probes.</span><span class="sxs-lookup"><span data-stu-id="814a2-164">This value is the time interval between two consecutive probes.</span></span> |
| <span data-ttu-id="814a2-165">Time-out</span><span class="sxs-lookup"><span data-stu-id="814a2-165">Time-out</span></span> |<span data-ttu-id="814a2-166">Probe time-out in seconds.</span><span class="sxs-lookup"><span data-stu-id="814a2-166">Probe time-out in seconds.</span></span> <span data-ttu-id="814a2-167">If a valid response is not received within this time-out period, the probe is marked as failed.</span><span class="sxs-lookup"><span data-stu-id="814a2-167">If a valid response is not received within this time-out period, the probe is marked as failed.</span></span>  |
| <span data-ttu-id="814a2-168">Unhealthy threshold</span><span class="sxs-lookup"><span data-stu-id="814a2-168">Unhealthy threshold</span></span> |<span data-ttu-id="814a2-169">Probe retry count.</span><span class="sxs-lookup"><span data-stu-id="814a2-169">Probe retry count.</span></span> <span data-ttu-id="814a2-170">The back-end server is marked down after the consecutive probe failure count reaches the unhealthy threshold.</span><span class="sxs-lookup"><span data-stu-id="814a2-170">The back-end server is marked down after the consecutive probe failure count reaches the unhealthy threshold.</span></span> |

> [!IMPORTANT]
> <span data-ttu-id="814a2-171">If Application Gateway is configured for a single site, by default the Host name should be specified as '127.0.0.1', unless otherwise configured in custom probe.</span><span class="sxs-lookup"><span data-stu-id="814a2-171">If Application Gateway is configured for a single site, by default the Host name should be specified as '127.0.0.1', unless otherwise configured in custom probe.</span></span>
> <span data-ttu-id="814a2-172">For reference a custom probe is sent to \<protocol\>://\<host\>:\<port\>\<path\>.</span><span class="sxs-lookup"><span data-stu-id="814a2-172">For reference a custom probe is sent to \<protocol\>://\<host\>:\<port\>\<path\>.</span></span> <span data-ttu-id="814a2-173">The port used will be the same port as defined in the back-end HTTP settings.</span><span class="sxs-lookup"><span data-stu-id="814a2-173">The port used will be the same port as defined in the back-end HTTP settings.</span></span>

## <a name="next-steps"></a><span data-ttu-id="814a2-174">Next steps</span><span class="sxs-lookup"><span data-stu-id="814a2-174">Next steps</span></span>
<span data-ttu-id="814a2-175">After learning about Application Gateway health monitoring, you can configure a [custom health probe](application-gateway-create-probe-portal.md) in the Azure portal or a [custom health probe](application-gateway-create-probe-ps.md) using PowerShell and the Azure Resource Manager deployment model.</span><span class="sxs-lookup"><span data-stu-id="814a2-175">After learning about Application Gateway health monitoring, you can configure a [custom health probe](application-gateway-create-probe-portal.md) in the Azure portal or a [custom health probe](application-gateway-create-probe-ps.md) using PowerShell and the Azure Resource Manager deployment model.</span></span>

[1]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/application-gateway/media/application-gateway-probe-overview/appgatewayprobe.png

