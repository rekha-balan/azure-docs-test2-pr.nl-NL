---
title: Azure Relay Hybrid Connections protocol guide | Microsoft Docs
description: Azure Relay Hybrid Connections protocol guide.
services: service-bus-relay
documentationcenter: na
author: clemensv
manager: timlt
editor: ''
ms.assetid: 149f980c-3702-4805-8069-5321275bc3e8
ms.service: service-bus-relay
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/23/2017
ms.author: sethm;clemensv
ms.openlocfilehash: a433b918f48b42d3bf7ee8ee16bd912e278a381d
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44669128"
---
# <a name="azure-relay-hybrid-connections-protocol"></a><span data-ttu-id="f6526-103">Azure Relay Hybrid Connections protocol</span><span class="sxs-lookup"><span data-stu-id="f6526-103">Azure Relay Hybrid Connections protocol</span></span>
<span data-ttu-id="f6526-104">Azure Relay is one of the key capability pillars of the Azure Service Bus platform.</span><span class="sxs-lookup"><span data-stu-id="f6526-104">Azure Relay is one of the key capability pillars of the Azure Service Bus platform.</span></span> <span data-ttu-id="f6526-105">The Relay's new "Hybrid Connections" capability is a secure, open-protocol evolution based on HTTP and WebSockets.</span><span class="sxs-lookup"><span data-stu-id="f6526-105">The Relay's new "Hybrid Connections" capability is a secure, open-protocol evolution based on HTTP and WebSockets.</span></span> <span data-ttu-id="f6526-106">It supersedes the former, equally named "BizTalk Services" feature that was built on a proprietary protocol foundation.</span><span class="sxs-lookup"><span data-stu-id="f6526-106">It supersedes the former, equally named "BizTalk Services" feature that was built on a proprietary protocol foundation.</span></span> <span data-ttu-id="f6526-107">The integration of Hybrid Connections into Azure App Services will continue to function as-is.</span><span class="sxs-lookup"><span data-stu-id="f6526-107">The integration of Hybrid Connections into Azure App Services will continue to function as-is.</span></span>

<span data-ttu-id="f6526-108">"Hybrid Connections" enables bi-directional, binary stream communication between two networked applications, whereby either or both parties can reside behind NATs or firewalls.</span><span class="sxs-lookup"><span data-stu-id="f6526-108">"Hybrid Connections" enables bi-directional, binary stream communication between two networked applications, whereby either or both parties can reside behind NATs or firewalls.</span></span> <span data-ttu-id="f6526-109">This article describes the client-side interactions with the Hybrid Connections relay for connecting clients in listener and sender roles, and how listeners accept new connections.</span><span class="sxs-lookup"><span data-stu-id="f6526-109">This article describes the client-side interactions with the Hybrid Connections relay for connecting clients in listener and sender roles, and how listeners accept new connections.</span></span>

## <a name="interaction-model"></a><span data-ttu-id="f6526-110">Interaction model</span><span class="sxs-lookup"><span data-stu-id="f6526-110">Interaction model</span></span>
<span data-ttu-id="f6526-111">The Hybrid Connections relay connects two parties by providing a rendezvous point in the Azure cloud that both parties can discover and connect to from their own network’s perspective.</span><span class="sxs-lookup"><span data-stu-id="f6526-111">The Hybrid Connections relay connects two parties by providing a rendezvous point in the Azure cloud that both parties can discover and connect to from their own network’s perspective.</span></span> <span data-ttu-id="f6526-112">That rendezvous point is called "Hybrid Connection" in this and other documentation, in the APIs, and also in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="f6526-112">That rendezvous point is called "Hybrid Connection" in this and other documentation, in the APIs, and also in the Azure portal.</span></span> <span data-ttu-id="f6526-113">The Hybrid Connections service endpoint will be referred to as the "service" for the rest of this article.</span><span class="sxs-lookup"><span data-stu-id="f6526-113">The Hybrid Connections service endpoint will be referred to as the "service" for the rest of this article.</span></span> <span data-ttu-id="f6526-114">The interaction model leans on the nomenclature established by many other networking APIs:</span><span class="sxs-lookup"><span data-stu-id="f6526-114">The interaction model leans on the nomenclature established by many other networking APIs:</span></span>

<span data-ttu-id="f6526-115">There is a listener that first indicates readiness to handle incoming connections, and subsequently accepts them as they arrive.</span><span class="sxs-lookup"><span data-stu-id="f6526-115">There is a listener that first indicates readiness to handle incoming connections, and subsequently accepts them as they arrive.</span></span> <span data-ttu-id="f6526-116">On the other side, there is a connecting client that connects towards the listener, expecting that connection to be accepted for establishing a bi-directional communication path.</span><span class="sxs-lookup"><span data-stu-id="f6526-116">On the other side, there is a connecting client that connects towards the listener, expecting that connection to be accepted for establishing a bi-directional communication path.</span></span>
<span data-ttu-id="f6526-117">"Connect," "Listen," and "Accept" are the same terms you will find on most socket APIs.</span><span class="sxs-lookup"><span data-stu-id="f6526-117">"Connect," "Listen," and "Accept" are the same terms you will find on most socket APIs.</span></span>

<span data-ttu-id="f6526-118">Any relayed communication model has either party making outbound connections towards a service endpoint, which makes the "listener" also a "client" in colloquial use and may also cause other terminology overloads; the precise terminology we therefore use for Hybrid Connections is as follows:</span><span class="sxs-lookup"><span data-stu-id="f6526-118">Any relayed communication model has either party making outbound connections towards a service endpoint, which makes the "listener" also a "client" in colloquial use and may also cause other terminology overloads; the precise terminology we therefore use for Hybrid Connections is as follows:</span></span>

<span data-ttu-id="f6526-119">The programs on both sides of a connection are called "client," since they are clients to the service.</span><span class="sxs-lookup"><span data-stu-id="f6526-119">The programs on both sides of a connection are called "client," since they are clients to the service.</span></span> <span data-ttu-id="f6526-120">The client that waits for and accepts connections is the "listener," or is said to be in the "listener role."</span><span class="sxs-lookup"><span data-stu-id="f6526-120">The client that waits for and accepts connections is the "listener," or is said to be in the "listener role."</span></span> <span data-ttu-id="f6526-121">The client that initiates a new connection towards a listener via the service is called the "sender," or is in the "sender role."</span><span class="sxs-lookup"><span data-stu-id="f6526-121">The client that initiates a new connection towards a listener via the service is called the "sender," or is in the "sender role."</span></span>

### <a name="listener-interactions"></a><span data-ttu-id="f6526-122">Listener interactions</span><span class="sxs-lookup"><span data-stu-id="f6526-122">Listener interactions</span></span>
<span data-ttu-id="f6526-123">The listener has four interactions with the service; all wire details are described later in this article in the reference section.</span><span class="sxs-lookup"><span data-stu-id="f6526-123">The listener has four interactions with the service; all wire details are described later in this article in the reference section.</span></span>

#### <a name="listen"></a><span data-ttu-id="f6526-124">Listen</span><span class="sxs-lookup"><span data-stu-id="f6526-124">Listen</span></span>
<span data-ttu-id="f6526-125">To indicate readiness to the service that a listener is ready to accept connections, it creates an outbound web socket connection.</span><span class="sxs-lookup"><span data-stu-id="f6526-125">To indicate readiness to the service that a listener is ready to accept connections, it creates an outbound web socket connection.</span></span> <span data-ttu-id="f6526-126">The connection handshake carries the name of a Hybrid Connection configured in the Relay namespace, and a security token that confers the "Listen" right on that name.</span><span class="sxs-lookup"><span data-stu-id="f6526-126">The connection handshake carries the name of a Hybrid Connection configured in the Relay namespace, and a security token that confers the "Listen" right on that name.</span></span>
<span data-ttu-id="f6526-127">When the web socket is accepted by the service, the registration is complete and the established web socket is kept alive as the "control channel" for enabling all subsequent interactions.</span><span class="sxs-lookup"><span data-stu-id="f6526-127">When the web socket is accepted by the service, the registration is complete and the established web socket is kept alive as the "control channel" for enabling all subsequent interactions.</span></span> <span data-ttu-id="f6526-128">The service allows up to 25 concurrent listeners on a Hybrid Connection.</span><span class="sxs-lookup"><span data-stu-id="f6526-128">The service allows up to 25 concurrent listeners on a Hybrid Connection.</span></span> <span data-ttu-id="f6526-129">If there are 2 or more active listeners, incoming connections will be balanced across them in random order; fair distribution is not guaranteed.</span><span class="sxs-lookup"><span data-stu-id="f6526-129">If there are 2 or more active listeners, incoming connections will be balanced across them in random order; fair distribution is not guaranteed.</span></span>

#### <a name="accept"></a><span data-ttu-id="f6526-130">Accept</span><span class="sxs-lookup"><span data-stu-id="f6526-130">Accept</span></span>
<span data-ttu-id="f6526-131">Whenever a sender opens up a new connection on the service, the service will choose and notify one of the active listeners on the Hybrid Connection.</span><span class="sxs-lookup"><span data-stu-id="f6526-131">Whenever a sender opens up a new connection on the service, the service will choose and notify one of the active listeners on the Hybrid Connection.</span></span> <span data-ttu-id="f6526-132">The notification is sent to the listener over the open control channel as a JSON message containing the URL of the Web socket endpoint that the listener must connect to for accepting the connection.</span><span class="sxs-lookup"><span data-stu-id="f6526-132">The notification is sent to the listener over the open control channel as a JSON message containing the URL of the Web socket endpoint that the listener must connect to for accepting the connection.</span></span>

<span data-ttu-id="f6526-133">The URL can and must be used directly by the listener without any extra work; the encoded information is only valid for a short period of time, essentially for as long as the sender is willing to wait for the connection to be established end-to-end, but up to a maximum of 30 seconds.</span><span class="sxs-lookup"><span data-stu-id="f6526-133">The URL can and must be used directly by the listener without any extra work; the encoded information is only valid for a short period of time, essentially for as long as the sender is willing to wait for the connection to be established end-to-end, but up to a maximum of 30 seconds.</span></span> <span data-ttu-id="f6526-134">The URL can only be used for one successful connection attempt.</span><span class="sxs-lookup"><span data-stu-id="f6526-134">The URL can only be used for one successful connection attempt.</span></span> <span data-ttu-id="f6526-135">As soon as the Web socket connection with the rendezvous URL is established, all further activity on this web socket is relayed from and to the sender, without any intervention or interpretation by the service.</span><span class="sxs-lookup"><span data-stu-id="f6526-135">As soon as the Web socket connection with the rendezvous URL is established, all further activity on this web socket is relayed from and to the sender, without any intervention or interpretation by the service.</span></span>

#### <a name="renew"></a><span data-ttu-id="f6526-136">Renew</span><span class="sxs-lookup"><span data-stu-id="f6526-136">Renew</span></span>
<span data-ttu-id="f6526-137">The security token that must be used to register the listener and maintain the control channel may expire while the listener is active.</span><span class="sxs-lookup"><span data-stu-id="f6526-137">The security token that must be used to register the listener and maintain the control channel may expire while the listener is active.</span></span> <span data-ttu-id="f6526-138">The token expiry will not affect ongoing connections, but it will cause the control channel to be dropped by the service at or soon after the instant of expiry.</span><span class="sxs-lookup"><span data-stu-id="f6526-138">The token expiry will not affect ongoing connections, but it will cause the control channel to be dropped by the service at or soon after the instant of expiry.</span></span> <span data-ttu-id="f6526-139">The "renew" operation is a JSON message that the listener can send to replace the token associated with the control channel, so that the control channel can be maintained for extended periods.</span><span class="sxs-lookup"><span data-stu-id="f6526-139">The "renew" operation is a JSON message that the listener can send to replace the token associated with the control channel, so that the control channel can be maintained for extended periods.</span></span>

#### <a name="ping"></a><span data-ttu-id="f6526-140">Ping</span><span class="sxs-lookup"><span data-stu-id="f6526-140">Ping</span></span>
<span data-ttu-id="f6526-141">If the control channel stays idle for a long time, intermediaries on the way, such as load balancers or NATs may drop the TCP connection.</span><span class="sxs-lookup"><span data-stu-id="f6526-141">If the control channel stays idle for a long time, intermediaries on the way, such as load balancers or NATs may drop the TCP connection.</span></span> <span data-ttu-id="f6526-142">The "ping" operation avoids that by sending a small amount of data on the channel that reminds everyone on the network route that the connection is meant to be alive, and it also serves as a "liveness" test for the listener.</span><span class="sxs-lookup"><span data-stu-id="f6526-142">The "ping" operation avoids that by sending a small amount of data on the channel that reminds everyone on the network route that the connection is meant to be alive, and it also serves as a "liveness" test for the listener.</span></span> <span data-ttu-id="f6526-143">If the ping fails, the control channel should be considered unusable and the listener should reconnect.</span><span class="sxs-lookup"><span data-stu-id="f6526-143">If the ping fails, the control channel should be considered unusable and the listener should reconnect.</span></span>

### <a name="sender-interaction"></a><span data-ttu-id="f6526-144">Sender interaction</span><span class="sxs-lookup"><span data-stu-id="f6526-144">Sender interaction</span></span>
<span data-ttu-id="f6526-145">The sender only has a single interaction with the service; it connects.</span><span class="sxs-lookup"><span data-stu-id="f6526-145">The sender only has a single interaction with the service; it connects.</span></span>

#### <a name="connect"></a><span data-ttu-id="f6526-146">Connect</span><span class="sxs-lookup"><span data-stu-id="f6526-146">Connect</span></span>
<span data-ttu-id="f6526-147">The "connect" operation opens a web socket on the service, providing the name of the Hybrid Connection and (optionally, but required by default) a security token conferring "Send" permission in the query string.</span><span class="sxs-lookup"><span data-stu-id="f6526-147">The "connect" operation opens a web socket on the service, providing the name of the Hybrid Connection and (optionally, but required by default) a security token conferring "Send" permission in the query string.</span></span> <span data-ttu-id="f6526-148">The service will then interact with the listener in the way described previously, and have the listener create a rendezvous connection that will be joined with this web socket.</span><span class="sxs-lookup"><span data-stu-id="f6526-148">The service will then interact with the listener in the way described previously, and have the listener create a rendezvous connection that will be joined with this web socket.</span></span> <span data-ttu-id="f6526-149">After the web socket has been accepted, all further interactions on the web socket will therefore be with a connected listener.</span><span class="sxs-lookup"><span data-stu-id="f6526-149">After the web socket has been accepted, all further interactions on the web socket will therefore be with a connected listener.</span></span>

### <a name="interaction-summary"></a><span data-ttu-id="f6526-150">Interaction summary</span><span class="sxs-lookup"><span data-stu-id="f6526-150">Interaction summary</span></span>
<span data-ttu-id="f6526-151">The result of this interaction model is that the sender client comes out of the handshake with a "clean" web socket which is connected to a listener and that needs no further preambles or preparation.</span><span class="sxs-lookup"><span data-stu-id="f6526-151">The result of this interaction model is that the sender client comes out of the handshake with a "clean" web socket which is connected to a listener and that needs no further preambles or preparation.</span></span> <span data-ttu-id="f6526-152">This allows practically any existing web socket client implementation to readily take advantage of the Hybrid Connections service by simply supplying a correctly-constructed URL into their web socket client layer.</span><span class="sxs-lookup"><span data-stu-id="f6526-152">This allows practically any existing web socket client implementation to readily take advantage of the Hybrid Connections service by simply supplying a correctly-constructed URL into their web socket client layer.</span></span>

<span data-ttu-id="f6526-153">The rendezvous connection web Socket that the listener obtains through the accept interaction is also clean and can be handed to any existing web socket server implementation with some minimal extra abstraction that distinguishes between "accept" operations on their framework's local network listeners and Hybrid Connections remote "accept" operations.</span><span class="sxs-lookup"><span data-stu-id="f6526-153">The rendezvous connection web Socket that the listener obtains through the accept interaction is also clean and can be handed to any existing web socket server implementation with some minimal extra abstraction that distinguishes between "accept" operations on their framework's local network listeners and Hybrid Connections remote "accept" operations.</span></span>

## <a name="protocol-reference"></a><span data-ttu-id="f6526-154">Protocol reference</span><span class="sxs-lookup"><span data-stu-id="f6526-154">Protocol reference</span></span>

<span data-ttu-id="f6526-155">This section describes the details of the protocol interactions described above.</span><span class="sxs-lookup"><span data-stu-id="f6526-155">This section describes the details of the protocol interactions described above.</span></span>

<span data-ttu-id="f6526-156">All web socket connections are made on port 443 as an upgrade from HTTPS 1.1, which is commonly abstracted by some web socket framework or API.</span><span class="sxs-lookup"><span data-stu-id="f6526-156">All web socket connections are made on port 443 as an upgrade from HTTPS 1.1, which is commonly abstracted by some web socket framework or API.</span></span> <span data-ttu-id="f6526-157">The description here is kept implementation neutral, without suggesting a specific framework.</span><span class="sxs-lookup"><span data-stu-id="f6526-157">The description here is kept implementation neutral, without suggesting a specific framework.</span></span>

### <a name="listener-protocol"></a><span data-ttu-id="f6526-158">Listener protocol</span><span class="sxs-lookup"><span data-stu-id="f6526-158">Listener protocol</span></span>
<span data-ttu-id="f6526-159">The listener protocol consists of two connection gestures and three message operations.</span><span class="sxs-lookup"><span data-stu-id="f6526-159">The listener protocol consists of two connection gestures and three message operations.</span></span>

#### <a name="listener-control-channel-connection"></a><span data-ttu-id="f6526-160">Listener control channel connection</span><span class="sxs-lookup"><span data-stu-id="f6526-160">Listener control channel connection</span></span>
<span data-ttu-id="f6526-161">The control channel is opened with creating a web socket connection to:</span><span class="sxs-lookup"><span data-stu-id="f6526-161">The control channel is opened with creating a web socket connection to:</span></span>

```
wss://{namespace-address}/$hc/{path}?sb-hc-action=...[&sb-hc-id=...]&sb-hc-token=...
```

<span data-ttu-id="f6526-162">The `namespace-address` is the fully qualified domain name of the Azure Relay namespace that hosts the Hybrid Connection, typically of the form `{myname}.servicebus.windows.net`.</span><span class="sxs-lookup"><span data-stu-id="f6526-162">The `namespace-address` is the fully qualified domain name of the Azure Relay namespace that hosts the Hybrid Connection, typically of the form `{myname}.servicebus.windows.net`.</span></span>

<span data-ttu-id="f6526-163">The query string parameter options are as follows.</span><span class="sxs-lookup"><span data-stu-id="f6526-163">The query string parameter options are as follows.</span></span>

| <span data-ttu-id="f6526-164">Parameter</span><span class="sxs-lookup"><span data-stu-id="f6526-164">Parameter</span></span> | <span data-ttu-id="f6526-165">Required</span><span class="sxs-lookup"><span data-stu-id="f6526-165">Required</span></span> | <span data-ttu-id="f6526-166">Description</span><span class="sxs-lookup"><span data-stu-id="f6526-166">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f6526-167">sb-hc-action</span><span class="sxs-lookup"><span data-stu-id="f6526-167">sb-hc-action</span></span> |<span data-ttu-id="f6526-168">Yes</span><span class="sxs-lookup"><span data-stu-id="f6526-168">Yes</span></span> |<span data-ttu-id="f6526-169">For the listener role the parameter must be **sb-hc-action=listen**</span><span class="sxs-lookup"><span data-stu-id="f6526-169">For the listener role the parameter must be **sb-hc-action=listen**</span></span> |
| <span data-ttu-id="f6526-170">{path}</span><span class="sxs-lookup"><span data-stu-id="f6526-170">{path}</span></span> |<span data-ttu-id="f6526-171">Yes</span><span class="sxs-lookup"><span data-stu-id="f6526-171">Yes</span></span> |<span data-ttu-id="f6526-172">The URL-encoded namespace path of the preconfigured Hybrid Connection to register this listener on.</span><span class="sxs-lookup"><span data-stu-id="f6526-172">The URL-encoded namespace path of the preconfigured Hybrid Connection to register this listener on.</span></span> <span data-ttu-id="f6526-173">This expression is appended to the fixed `$hc/` path portion.</span><span class="sxs-lookup"><span data-stu-id="f6526-173">This expression is appended to the fixed `$hc/` path portion.</span></span> |
| <span data-ttu-id="f6526-174">sb-hc-token</span><span class="sxs-lookup"><span data-stu-id="f6526-174">sb-hc-token</span></span> |<span data-ttu-id="f6526-175">Yes\*</span><span class="sxs-lookup"><span data-stu-id="f6526-175">Yes\*</span></span> |<span data-ttu-id="f6526-176">The listener must provide a valid, URL-encoded Service Bus Shared Access Token for the namespace or Hybrid Connection that confers the **Listen** right.</span><span class="sxs-lookup"><span data-stu-id="f6526-176">The listener must provide a valid, URL-encoded Service Bus Shared Access Token for the namespace or Hybrid Connection that confers the **Listen** right.</span></span> |
| <span data-ttu-id="f6526-177">sb-hc-id</span><span class="sxs-lookup"><span data-stu-id="f6526-177">sb-hc-id</span></span> |<span data-ttu-id="f6526-178">No</span><span class="sxs-lookup"><span data-stu-id="f6526-178">No</span></span> |<span data-ttu-id="f6526-179">This client-supplied optional ID enables end-to-end diagnostic tracing.</span><span class="sxs-lookup"><span data-stu-id="f6526-179">This client-supplied optional ID enables end-to-end diagnostic tracing.</span></span> |

<span data-ttu-id="f6526-180">If the web socket connection fails due to the Hybrid Connection path not being registered, or an invalid or missing token, or some other error, the error feedback will be provided using the regular HTTP 1.1 status feedback model.</span><span class="sxs-lookup"><span data-stu-id="f6526-180">If the web socket connection fails due to the Hybrid Connection path not being registered, or an invalid or missing token, or some other error, the error feedback will be provided using the regular HTTP 1.1 status feedback model.</span></span> <span data-ttu-id="f6526-181">The status description will contain an error tracking-id that can be communicated to Azure support:</span><span class="sxs-lookup"><span data-stu-id="f6526-181">The status description will contain an error tracking-id that can be communicated to Azure support:</span></span>

| <span data-ttu-id="f6526-182">Code</span><span class="sxs-lookup"><span data-stu-id="f6526-182">Code</span></span> | <span data-ttu-id="f6526-183">Error</span><span class="sxs-lookup"><span data-stu-id="f6526-183">Error</span></span> | <span data-ttu-id="f6526-184">Description</span><span class="sxs-lookup"><span data-stu-id="f6526-184">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f6526-185">404</span><span class="sxs-lookup"><span data-stu-id="f6526-185">404</span></span> |<span data-ttu-id="f6526-186">Not Found</span><span class="sxs-lookup"><span data-stu-id="f6526-186">Not Found</span></span> |<span data-ttu-id="f6526-187">The Hybrid Connection **path** is invalid or the base URL is malformed.</span><span class="sxs-lookup"><span data-stu-id="f6526-187">The Hybrid Connection **path** is invalid or the base URL is malformed.</span></span> |
| <span data-ttu-id="f6526-188">401</span><span class="sxs-lookup"><span data-stu-id="f6526-188">401</span></span> |<span data-ttu-id="f6526-189">Unauthorized</span><span class="sxs-lookup"><span data-stu-id="f6526-189">Unauthorized</span></span> |<span data-ttu-id="f6526-190">The security token is missing or malformed or invalid.</span><span class="sxs-lookup"><span data-stu-id="f6526-190">The security token is missing or malformed or invalid.</span></span> |
| <span data-ttu-id="f6526-191">403</span><span class="sxs-lookup"><span data-stu-id="f6526-191">403</span></span> |<span data-ttu-id="f6526-192">Forbidden</span><span class="sxs-lookup"><span data-stu-id="f6526-192">Forbidden</span></span> |<span data-ttu-id="f6526-193">The security token is not valid for this path for this action.</span><span class="sxs-lookup"><span data-stu-id="f6526-193">The security token is not valid for this path for this action.</span></span> |
| <span data-ttu-id="f6526-194">500</span><span class="sxs-lookup"><span data-stu-id="f6526-194">500</span></span> |<span data-ttu-id="f6526-195">Internal Error</span><span class="sxs-lookup"><span data-stu-id="f6526-195">Internal Error</span></span> |<span data-ttu-id="f6526-196">Something went wrong in the service.</span><span class="sxs-lookup"><span data-stu-id="f6526-196">Something went wrong in the service.</span></span> |

<span data-ttu-id="f6526-197">If the web socket connection is intentionally shut down by the service after it was initially set up, the reason for doing so will be communicated using an appropriate web socket protocol error code along with a descriptive error message that will also include a tracking ID.</span><span class="sxs-lookup"><span data-stu-id="f6526-197">If the web socket connection is intentionally shut down by the service after it was initially set up, the reason for doing so will be communicated using an appropriate web socket protocol error code along with a descriptive error message that will also include a tracking ID.</span></span> <span data-ttu-id="f6526-198">The service will not shut down the control channel without encountering an error condition.</span><span class="sxs-lookup"><span data-stu-id="f6526-198">The service will not shut down the control channel without encountering an error condition.</span></span> <span data-ttu-id="f6526-199">Any clean shutdown is client controlled.</span><span class="sxs-lookup"><span data-stu-id="f6526-199">Any clean shutdown is client controlled.</span></span>

| <span data-ttu-id="f6526-200">WS Status</span><span class="sxs-lookup"><span data-stu-id="f6526-200">WS Status</span></span> | <span data-ttu-id="f6526-201">Description</span><span class="sxs-lookup"><span data-stu-id="f6526-201">Description</span></span> |
| --- | --- |
| <span data-ttu-id="f6526-202">1001</span><span class="sxs-lookup"><span data-stu-id="f6526-202">1001</span></span> |<span data-ttu-id="f6526-203">The Hybrid Connection path has been deleted or disabled.</span><span class="sxs-lookup"><span data-stu-id="f6526-203">The Hybrid Connection path has been deleted or disabled.</span></span> |
| <span data-ttu-id="f6526-204">1008</span><span class="sxs-lookup"><span data-stu-id="f6526-204">1008</span></span> |<span data-ttu-id="f6526-205">The security token has expired and the authorization policy is therefore violated.</span><span class="sxs-lookup"><span data-stu-id="f6526-205">The security token has expired and the authorization policy is therefore violated.</span></span> |
| <span data-ttu-id="f6526-206">1011</span><span class="sxs-lookup"><span data-stu-id="f6526-206">1011</span></span> |<span data-ttu-id="f6526-207">Something went wrong in the service.</span><span class="sxs-lookup"><span data-stu-id="f6526-207">Something went wrong in the service.</span></span> |

### <a name="accept-handshake"></a><span data-ttu-id="f6526-208">Accept handshake</span><span class="sxs-lookup"><span data-stu-id="f6526-208">Accept handshake</span></span>
<span data-ttu-id="f6526-209">The accept notification is sent by the service to the listener over the previously established control channel as a JSON message in a web socket text frame.</span><span class="sxs-lookup"><span data-stu-id="f6526-209">The accept notification is sent by the service to the listener over the previously established control channel as a JSON message in a web socket text frame.</span></span> <span data-ttu-id="f6526-210">There is no reply to this message.</span><span class="sxs-lookup"><span data-stu-id="f6526-210">There is no reply to this message.</span></span>

<span data-ttu-id="f6526-211">The message contains a JSON object named "accept," which defines the following properties at this time:</span><span class="sxs-lookup"><span data-stu-id="f6526-211">The message contains a JSON object named "accept," which defines the following properties at this time:</span></span>

* <span data-ttu-id="f6526-212">**address** – the URL string to be used for establishing the web socket to the service to accept an incoming connection.</span><span class="sxs-lookup"><span data-stu-id="f6526-212">**address** – the URL string to be used for establishing the web socket to the service to accept an incoming connection.</span></span>
* <span data-ttu-id="f6526-213">**id** – the unique identifier for this connection.</span><span class="sxs-lookup"><span data-stu-id="f6526-213">**id** – the unique identifier for this connection.</span></span> <span data-ttu-id="f6526-214">If the ID was supplied by the sender client, it is the sender supplied value, otherwise it is a system generated value.</span><span class="sxs-lookup"><span data-stu-id="f6526-214">If the ID was supplied by the sender client, it is the sender supplied value, otherwise it is a system generated value.</span></span>
* <span data-ttu-id="f6526-215">**connectHeaders** – all HTTP headers that have been supplied to the Relay endpoint by the sender, which also includes the Sec-WebSocket-Protocol and the Sec-WebSocket-Extensions headers.</span><span class="sxs-lookup"><span data-stu-id="f6526-215">**connectHeaders** – all HTTP headers that have been supplied to the Relay endpoint by the sender, which also includes the Sec-WebSocket-Protocol and the Sec-WebSocket-Extensions headers.</span></span>

#### <a name="accept-message"></a><span data-ttu-id="f6526-216">Accept Message</span><span class="sxs-lookup"><span data-stu-id="f6526-216">Accept Message</span></span>
```json
{                                                           
    "accept" : {
        "address" : "wss://168.61.148.205:443/$hc/{path}?..."    
        "id" : "4cb542c3-047a-4d40-a19f-bdc66441e736",  
        "connectHeaders" : {                                         
            "Host" : "...",                                                
            "Sec-WebSocket-Protocol" : "...",                              
            "Sec-WebSocket-Extensions" : "..."                             
        }                                                            
     }                                                         
}
```

<span data-ttu-id="f6526-217">The address URL provided in the JSON message is used by the listener to establish the web socket for accepting or rejecting the sender socket.</span><span class="sxs-lookup"><span data-stu-id="f6526-217">The address URL provided in the JSON message is used by the listener to establish the web socket for accepting or rejecting the sender socket.</span></span>

#### <a name="accepting-the-socket"></a><span data-ttu-id="f6526-218">Accepting the Socket</span><span class="sxs-lookup"><span data-stu-id="f6526-218">Accepting the Socket</span></span>
<span data-ttu-id="f6526-219">To accept, the listener establishes a web socket connection to the provided address.</span><span class="sxs-lookup"><span data-stu-id="f6526-219">To accept, the listener establishes a web socket connection to the provided address.</span></span>

<span data-ttu-id="f6526-220">If the "accept" message carries a "Sec-WebSocket-Protocol" header, it is expected that the listener will only accept the web socket if it supports that protocol and that it sets the header as the web socket is established.</span><span class="sxs-lookup"><span data-stu-id="f6526-220">If the "accept" message carries a "Sec-WebSocket-Protocol" header, it is expected that the listener will only accept the web socket if it supports that protocol and that it sets the header as the web socket is established.</span></span>

<span data-ttu-id="f6526-221">The same applies to the "Sec-WebSocket-Extensions" header.</span><span class="sxs-lookup"><span data-stu-id="f6526-221">The same applies to the "Sec-WebSocket-Extensions" header.</span></span> <span data-ttu-id="f6526-222">If the framework supports an extension, it should set the header to the *server* side reply of the required "Sec-WebSocket-Extensions" handshake for the extension.</span><span class="sxs-lookup"><span data-stu-id="f6526-222">If the framework supports an extension, it should set the header to the *server* side reply of the required "Sec-WebSocket-Extensions" handshake for the extension.</span></span>

<span data-ttu-id="f6526-223">The URL must be used as-is for establishing the accept socket, but contains the following parameters:</span><span class="sxs-lookup"><span data-stu-id="f6526-223">The URL must be used as-is for establishing the accept socket, but contains the following parameters:</span></span>

| <span data-ttu-id="f6526-224">Parameter</span><span class="sxs-lookup"><span data-stu-id="f6526-224">Parameter</span></span> | <span data-ttu-id="f6526-225">Required</span><span class="sxs-lookup"><span data-stu-id="f6526-225">Required</span></span> | <span data-ttu-id="f6526-226">Description</span><span class="sxs-lookup"><span data-stu-id="f6526-226">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f6526-227">sb-hc-action</span><span class="sxs-lookup"><span data-stu-id="f6526-227">sb-hc-action</span></span> |<span data-ttu-id="f6526-228">Yes</span><span class="sxs-lookup"><span data-stu-id="f6526-228">Yes</span></span> |<span data-ttu-id="f6526-229">For accepting a socket the parameter must be `sb-hc-action=accept`</span><span class="sxs-lookup"><span data-stu-id="f6526-229">For accepting a socket the parameter must be `sb-hc-action=accept`</span></span> |
| <span data-ttu-id="f6526-230">{path}</span><span class="sxs-lookup"><span data-stu-id="f6526-230">{path}</span></span> |<span data-ttu-id="f6526-231">Yes</span><span class="sxs-lookup"><span data-stu-id="f6526-231">Yes</span></span> |<span data-ttu-id="f6526-232">(see the following paragraph)</span><span class="sxs-lookup"><span data-stu-id="f6526-232">(see the following paragraph)</span></span> |
| <span data-ttu-id="f6526-233">sb-hc-id</span><span class="sxs-lookup"><span data-stu-id="f6526-233">sb-hc-id</span></span> |<span data-ttu-id="f6526-234">No</span><span class="sxs-lookup"><span data-stu-id="f6526-234">No</span></span> |<span data-ttu-id="f6526-235">See description of **id** above.</span><span class="sxs-lookup"><span data-stu-id="f6526-235">See description of **id** above.</span></span> |

<span data-ttu-id="f6526-236">The `{path}` is the URL-encoded namespace path of the preconfigured Hybrid Connection on which to register this listener.</span><span class="sxs-lookup"><span data-stu-id="f6526-236">The `{path}` is the URL-encoded namespace path of the preconfigured Hybrid Connection on which to register this listener.</span></span> <span data-ttu-id="f6526-237">This expression is appended to the fixed `$hc/` path portion.</span><span class="sxs-lookup"><span data-stu-id="f6526-237">This expression is appended to the fixed `$hc/` path portion.</span></span> 

<span data-ttu-id="f6526-238">The path expression MAY be extended with a suffix and a query string expression that follows the registered name after a separating forward slash.</span><span class="sxs-lookup"><span data-stu-id="f6526-238">The path expression MAY be extended with a suffix and a query string expression that follows the registered name after a separating forward slash.</span></span> <span data-ttu-id="f6526-239">This allows the sender client to pass dispatch arguments to the accepting listener when it is not possible to include HTTP headers.</span><span class="sxs-lookup"><span data-stu-id="f6526-239">This allows the sender client to pass dispatch arguments to the accepting listener when it is not possible to include HTTP headers.</span></span> <span data-ttu-id="f6526-240">The expectation is that the listener framework will parse out the fixed path portion and the registered name from the path and make the remainder, possibly without any query string arguments prefixed by "sb-", available to the application for deciding whether to accept the connection.</span><span class="sxs-lookup"><span data-stu-id="f6526-240">The expectation is that the listener framework will parse out the fixed path portion and the registered name from the path and make the remainder, possibly without any query string arguments prefixed by "sb-", available to the application for deciding whether to accept the connection.</span></span>

<span data-ttu-id="f6526-241">For more details see the following "Sender Protocol" section.</span><span class="sxs-lookup"><span data-stu-id="f6526-241">For more details see the following "Sender Protocol" section.</span></span>

<span data-ttu-id="f6526-242">If there’s an error, the service may reply as follows:</span><span class="sxs-lookup"><span data-stu-id="f6526-242">If there’s an error, the service may reply as follows:</span></span>

| <span data-ttu-id="f6526-243">Code</span><span class="sxs-lookup"><span data-stu-id="f6526-243">Code</span></span> | <span data-ttu-id="f6526-244">Error</span><span class="sxs-lookup"><span data-stu-id="f6526-244">Error</span></span> | <span data-ttu-id="f6526-245">Description</span><span class="sxs-lookup"><span data-stu-id="f6526-245">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f6526-246">403</span><span class="sxs-lookup"><span data-stu-id="f6526-246">403</span></span> |<span data-ttu-id="f6526-247">Forbidden</span><span class="sxs-lookup"><span data-stu-id="f6526-247">Forbidden</span></span> |<span data-ttu-id="f6526-248">The URL is not valid.</span><span class="sxs-lookup"><span data-stu-id="f6526-248">The URL is not valid.</span></span> |
| <span data-ttu-id="f6526-249">500</span><span class="sxs-lookup"><span data-stu-id="f6526-249">500</span></span> |<span data-ttu-id="f6526-250">Internal Error</span><span class="sxs-lookup"><span data-stu-id="f6526-250">Internal Error</span></span> |<span data-ttu-id="f6526-251">Something went wrong in the service</span><span class="sxs-lookup"><span data-stu-id="f6526-251">Something went wrong in the service</span></span> |

<span data-ttu-id="f6526-252">After the connection has been established, the server will shut down the web socket when the sender web socket shuts down, or with the following status.</span><span class="sxs-lookup"><span data-stu-id="f6526-252">After the connection has been established, the server will shut down the web socket when the sender web socket shuts down, or with the following status.</span></span>

| <span data-ttu-id="f6526-253">WS Status</span><span class="sxs-lookup"><span data-stu-id="f6526-253">WS Status</span></span> | <span data-ttu-id="f6526-254">Description</span><span class="sxs-lookup"><span data-stu-id="f6526-254">Description</span></span> |
| --- | --- |
| <span data-ttu-id="f6526-255">1001</span><span class="sxs-lookup"><span data-stu-id="f6526-255">1001</span></span> |<span data-ttu-id="f6526-256">The sender client shuts down the connection.</span><span class="sxs-lookup"><span data-stu-id="f6526-256">The sender client shuts down the connection.</span></span> |
| <span data-ttu-id="f6526-257">1001</span><span class="sxs-lookup"><span data-stu-id="f6526-257">1001</span></span> |<span data-ttu-id="f6526-258">The Hybrid Connection path has been deleted or disabled.</span><span class="sxs-lookup"><span data-stu-id="f6526-258">The Hybrid Connection path has been deleted or disabled.</span></span> |
| <span data-ttu-id="f6526-259">1008</span><span class="sxs-lookup"><span data-stu-id="f6526-259">1008</span></span> |<span data-ttu-id="f6526-260">The security token has expired and therefore the authorization policy is violated.</span><span class="sxs-lookup"><span data-stu-id="f6526-260">The security token has expired and therefore the authorization policy is violated.</span></span> |
| <span data-ttu-id="f6526-261">1011</span><span class="sxs-lookup"><span data-stu-id="f6526-261">1011</span></span> |<span data-ttu-id="f6526-262">Something went wrong in the service.</span><span class="sxs-lookup"><span data-stu-id="f6526-262">Something went wrong in the service.</span></span> |

#### <a name="rejecting-the-socket"></a><span data-ttu-id="f6526-263">Rejecting the Socket</span><span class="sxs-lookup"><span data-stu-id="f6526-263">Rejecting the Socket</span></span>
<span data-ttu-id="f6526-264">Rejecting the socket after inspecting the "accept" message requires a similar handshake so that the status code and status description communicating the reason for the rejection can flow back to the sender.</span><span class="sxs-lookup"><span data-stu-id="f6526-264">Rejecting the socket after inspecting the "accept" message requires a similar handshake so that the status code and status description communicating the reason for the rejection can flow back to the sender.</span></span>

<span data-ttu-id="f6526-265">The protocol design choice here is to use a web socket handshake (that is designed to end in a defined error state) so that listener client implementations can continue to rely on a web socket client and don’t need to employ an extra, bare HTTP client.</span><span class="sxs-lookup"><span data-stu-id="f6526-265">The protocol design choice here is to use a web socket handshake (that is designed to end in a defined error state) so that listener client implementations can continue to rely on a web socket client and don’t need to employ an extra, bare HTTP client.</span></span>

<span data-ttu-id="f6526-266">To reject the socket, the client takes the address URI from the "accept" message and appends two query string parameters to it:</span><span class="sxs-lookup"><span data-stu-id="f6526-266">To reject the socket, the client takes the address URI from the "accept" message and appends two query string parameters to it:</span></span>

| <span data-ttu-id="f6526-267">Param</span><span class="sxs-lookup"><span data-stu-id="f6526-267">Param</span></span> | <span data-ttu-id="f6526-268">Required</span><span class="sxs-lookup"><span data-stu-id="f6526-268">Required</span></span> | <span data-ttu-id="f6526-269">Description</span><span class="sxs-lookup"><span data-stu-id="f6526-269">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f6526-270">statusCode</span><span class="sxs-lookup"><span data-stu-id="f6526-270">statusCode</span></span> |<span data-ttu-id="f6526-271">Yes</span><span class="sxs-lookup"><span data-stu-id="f6526-271">Yes</span></span> |<span data-ttu-id="f6526-272">Numeric HTTP status code.</span><span class="sxs-lookup"><span data-stu-id="f6526-272">Numeric HTTP status code.</span></span> |
| <span data-ttu-id="f6526-273">statusDescription</span><span class="sxs-lookup"><span data-stu-id="f6526-273">statusDescription</span></span> |<span data-ttu-id="f6526-274">Yes</span><span class="sxs-lookup"><span data-stu-id="f6526-274">Yes</span></span> |<span data-ttu-id="f6526-275">Human readable reason for the rejection.</span><span class="sxs-lookup"><span data-stu-id="f6526-275">Human readable reason for the rejection.</span></span> |

<span data-ttu-id="f6526-276">The resulting URI is then used to establish a WebSocket connection.</span><span class="sxs-lookup"><span data-stu-id="f6526-276">The resulting URI is then used to establish a WebSocket connection.</span></span>

<span data-ttu-id="f6526-277">When completing correctly, this handshake will intentionally fail with an HTTP error code 410, since no web socket has been established.</span><span class="sxs-lookup"><span data-stu-id="f6526-277">When completing correctly, this handshake will intentionally fail with an HTTP error code 410, since no web socket has been established.</span></span> <span data-ttu-id="f6526-278">If an error occurs, these are the options:</span><span class="sxs-lookup"><span data-stu-id="f6526-278">If an error occurs, these are the options:</span></span>

| <span data-ttu-id="f6526-279">Code</span><span class="sxs-lookup"><span data-stu-id="f6526-279">Code</span></span> | <span data-ttu-id="f6526-280">Error</span><span class="sxs-lookup"><span data-stu-id="f6526-280">Error</span></span> | <span data-ttu-id="f6526-281">Description</span><span class="sxs-lookup"><span data-stu-id="f6526-281">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f6526-282">403</span><span class="sxs-lookup"><span data-stu-id="f6526-282">403</span></span> |<span data-ttu-id="f6526-283">Forbidden</span><span class="sxs-lookup"><span data-stu-id="f6526-283">Forbidden</span></span> |<span data-ttu-id="f6526-284">The URL is not valid.</span><span class="sxs-lookup"><span data-stu-id="f6526-284">The URL is not valid.</span></span> |
| <span data-ttu-id="f6526-285">500</span><span class="sxs-lookup"><span data-stu-id="f6526-285">500</span></span> |<span data-ttu-id="f6526-286">Internal Error</span><span class="sxs-lookup"><span data-stu-id="f6526-286">Internal Error</span></span> |<span data-ttu-id="f6526-287">Something went wrong in the service.</span><span class="sxs-lookup"><span data-stu-id="f6526-287">Something went wrong in the service.</span></span> |

### <a name="listener-token-renewal"></a><span data-ttu-id="f6526-288">Listener token renewal</span><span class="sxs-lookup"><span data-stu-id="f6526-288">Listener token renewal</span></span>
<span data-ttu-id="f6526-289">When the listener token is about to expire, it can replace it by sending a text frame message to the service via the established control channel.</span><span class="sxs-lookup"><span data-stu-id="f6526-289">When the listener token is about to expire, it can replace it by sending a text frame message to the service via the established control channel.</span></span> <span data-ttu-id="f6526-290">The message contains a JSON object named "renewToken," which defines the following property at this time:</span><span class="sxs-lookup"><span data-stu-id="f6526-290">The message contains a JSON object named "renewToken," which defines the following property at this time:</span></span>

* <span data-ttu-id="f6526-291">**token** – a valid, URL-encoded Service Bus Shared Access Token for the namespace or Hybrid Connection that confers the **Listen** right.</span><span class="sxs-lookup"><span data-stu-id="f6526-291">**token** – a valid, URL-encoded Service Bus Shared Access Token for the namespace or Hybrid Connection that confers the **Listen** right.</span></span>

#### <a name="renewtoken-message"></a><span data-ttu-id="f6526-292">renewToken Message</span><span class="sxs-lookup"><span data-stu-id="f6526-292">renewToken Message</span></span>
```json
{                                                                                                                                                                        
    "renewToken" : {                                                                                                                                                      
        "token" : "SharedAccessSignature sr=http%3a%2f%2fcontoso.servicebus.windows.net%2fhyco%2f&amp;sig=XXXXXXXXXX%3d&amp;se=1471633754&amp;skn=SasKeyName"  
    }                                                                                                                                                                     
}
```

<span data-ttu-id="f6526-293">If the token validation fails, access is denied, and cloud service will close the control channel web socket with an error, otherwise there is no reply.</span><span class="sxs-lookup"><span data-stu-id="f6526-293">If the token validation fails, access is denied, and cloud service will close the control channel web socket with an error, otherwise there is no reply.</span></span>

| <span data-ttu-id="f6526-294">WS Status</span><span class="sxs-lookup"><span data-stu-id="f6526-294">WS Status</span></span> | <span data-ttu-id="f6526-295">Description</span><span class="sxs-lookup"><span data-stu-id="f6526-295">Description</span></span> |
| --- | --- |
| <span data-ttu-id="f6526-296">1008</span><span class="sxs-lookup"><span data-stu-id="f6526-296">1008</span></span> |<span data-ttu-id="f6526-297">The security token has expired and the authorization policy is therefore violated.</span><span class="sxs-lookup"><span data-stu-id="f6526-297">The security token has expired and the authorization policy is therefore violated.</span></span> |

## <a name="sender-protocol"></a><span data-ttu-id="f6526-298">Sender protocol</span><span class="sxs-lookup"><span data-stu-id="f6526-298">Sender protocol</span></span>
<span data-ttu-id="f6526-299">The sender protocol is effectively identical to how a listener is established.</span><span class="sxs-lookup"><span data-stu-id="f6526-299">The sender protocol is effectively identical to how a listener is established.</span></span>
<span data-ttu-id="f6526-300">The goal is maximum transparency for the end-to-end web socket.</span><span class="sxs-lookup"><span data-stu-id="f6526-300">The goal is maximum transparency for the end-to-end web socket.</span></span> <span data-ttu-id="f6526-301">The address to connect to is the same as for the listener, but the "action" differs and the token needs a different permission:</span><span class="sxs-lookup"><span data-stu-id="f6526-301">The address to connect to is the same as for the listener, but the "action" differs and the token needs a different permission:</span></span>

```
wss://{namespace-address}/$hc/{path}?sb-hc-action=...&sb-hc-id=...&sbc-hc-token=...
```

<span data-ttu-id="f6526-302">The *namespace-address* is the fully qualified domain name of the Azure Relay namespace that hosts the Hybrid Connection, typically of the form `{myname}.servicebus.windows.net`.</span><span class="sxs-lookup"><span data-stu-id="f6526-302">The *namespace-address* is the fully qualified domain name of the Azure Relay namespace that hosts the Hybrid Connection, typically of the form `{myname}.servicebus.windows.net`.</span></span>

<span data-ttu-id="f6526-303">The request may contain arbitrary extra HTTP headers, including application-defined ones.</span><span class="sxs-lookup"><span data-stu-id="f6526-303">The request may contain arbitrary extra HTTP headers, including application-defined ones.</span></span> <span data-ttu-id="f6526-304">All supplied headers flow to the listener and can be found on the "connectHeader" object of the "accept" control message.</span><span class="sxs-lookup"><span data-stu-id="f6526-304">All supplied headers flow to the listener and can be found on the "connectHeader" object of the "accept" control message.</span></span>

<span data-ttu-id="f6526-305">The query string parameter options are as follows</span><span class="sxs-lookup"><span data-stu-id="f6526-305">The query string parameter options are as follows</span></span>

| <span data-ttu-id="f6526-306">Param</span><span class="sxs-lookup"><span data-stu-id="f6526-306">Param</span></span> | <span data-ttu-id="f6526-307">Required?</span><span class="sxs-lookup"><span data-stu-id="f6526-307">Required?</span></span> | <span data-ttu-id="f6526-308">Description</span><span class="sxs-lookup"><span data-stu-id="f6526-308">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f6526-309">sb-hc-action</span><span class="sxs-lookup"><span data-stu-id="f6526-309">sb-hc-action</span></span> |<span data-ttu-id="f6526-310">Yes</span><span class="sxs-lookup"><span data-stu-id="f6526-310">Yes</span></span> |<span data-ttu-id="f6526-311">For the sender role the parameter must be `action=connect`.</span><span class="sxs-lookup"><span data-stu-id="f6526-311">For the sender role the parameter must be `action=connect`.</span></span> |
| <span data-ttu-id="f6526-312">{path}</span><span class="sxs-lookup"><span data-stu-id="f6526-312">{path}</span></span> |<span data-ttu-id="f6526-313">Yes</span><span class="sxs-lookup"><span data-stu-id="f6526-313">Yes</span></span> |<span data-ttu-id="f6526-314">(see the following paragraph)</span><span class="sxs-lookup"><span data-stu-id="f6526-314">(see the following paragraph)</span></span> |
| <span data-ttu-id="f6526-315">sb-hc-token</span><span class="sxs-lookup"><span data-stu-id="f6526-315">sb-hc-token</span></span> |<span data-ttu-id="f6526-316">Yes\*</span><span class="sxs-lookup"><span data-stu-id="f6526-316">Yes\*</span></span> |<span data-ttu-id="f6526-317">The listener must provide a valid, URL-encoded Service Bus Shared Access Token for the namespace or Hybrid Connection that confers the **Send** right.</span><span class="sxs-lookup"><span data-stu-id="f6526-317">The listener must provide a valid, URL-encoded Service Bus Shared Access Token for the namespace or Hybrid Connection that confers the **Send** right.</span></span> |
| <span data-ttu-id="f6526-318">sb-hc-id</span><span class="sxs-lookup"><span data-stu-id="f6526-318">sb-hc-id</span></span> |<span data-ttu-id="f6526-319">No</span><span class="sxs-lookup"><span data-stu-id="f6526-319">No</span></span> |<span data-ttu-id="f6526-320">An optional ID that enables end-to-end diagnostic tracing and is made available to the listener during the accept handshake.</span><span class="sxs-lookup"><span data-stu-id="f6526-320">An optional ID that enables end-to-end diagnostic tracing and is made available to the listener during the accept handshake.</span></span> |

<span data-ttu-id="f6526-321">The {path} is the URL-encoded namespace path of the preconfigured Hybrid Connection to register this listener on.</span><span class="sxs-lookup"><span data-stu-id="f6526-321">The {path} is the URL-encoded namespace path of the preconfigured Hybrid Connection to register this listener on.</span></span> <span data-ttu-id="f6526-322">The path expression MAY be extended with a suffix and a query string expression to communicate further.</span><span class="sxs-lookup"><span data-stu-id="f6526-322">The path expression MAY be extended with a suffix and a query string expression to communicate further.</span></span> <span data-ttu-id="f6526-323">If the Hybrid Connection is registered under the path "hyco," the path expression can be `hyco/suffix?param=value&...` followed by the query string parameters defined here.</span><span class="sxs-lookup"><span data-stu-id="f6526-323">If the Hybrid Connection is registered under the path "hyco," the path expression can be `hyco/suffix?param=value&...` followed by the query string parameters defined here.</span></span> <span data-ttu-id="f6526-324">A complete expression may then be:</span><span class="sxs-lookup"><span data-stu-id="f6526-324">A complete expression may then be:</span></span>

```
wss://{namespace-address}/$hc/hyco/suffix?param=value&sb-hc-action=...[&sb-hc-id=...&]sbc-hc-token=...
```

<span data-ttu-id="f6526-325">The path expression is passed through to the listener in the address URI contained in the "accept" control message.</span><span class="sxs-lookup"><span data-stu-id="f6526-325">The path expression is passed through to the listener in the address URI contained in the "accept" control message.</span></span>

<span data-ttu-id="f6526-326">If the web socket connection fails due to the Hybrid Connection path not being registered, or an invalid or missing token, or some other error, the error feedback will be provided using the regular HTTP 1.1 status feedback model.</span><span class="sxs-lookup"><span data-stu-id="f6526-326">If the web socket connection fails due to the Hybrid Connection path not being registered, or an invalid or missing token, or some other error, the error feedback will be provided using the regular HTTP 1.1 status feedback model.</span></span> <span data-ttu-id="f6526-327">The status description will contain an error tracking-id that can be communicated to Azure support:</span><span class="sxs-lookup"><span data-stu-id="f6526-327">The status description will contain an error tracking-id that can be communicated to Azure support:</span></span>

| <span data-ttu-id="f6526-328">Code</span><span class="sxs-lookup"><span data-stu-id="f6526-328">Code</span></span> | <span data-ttu-id="f6526-329">Error</span><span class="sxs-lookup"><span data-stu-id="f6526-329">Error</span></span> | <span data-ttu-id="f6526-330">Description</span><span class="sxs-lookup"><span data-stu-id="f6526-330">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f6526-331">404</span><span class="sxs-lookup"><span data-stu-id="f6526-331">404</span></span> |<span data-ttu-id="f6526-332">Not Found</span><span class="sxs-lookup"><span data-stu-id="f6526-332">Not Found</span></span> |<span data-ttu-id="f6526-333">The Hybrid Connection `path` is invalid or the base URL is malformed.</span><span class="sxs-lookup"><span data-stu-id="f6526-333">The Hybrid Connection `path` is invalid or the base URL is malformed.</span></span> |
| <span data-ttu-id="f6526-334">401</span><span class="sxs-lookup"><span data-stu-id="f6526-334">401</span></span> |<span data-ttu-id="f6526-335">Unauthorized</span><span class="sxs-lookup"><span data-stu-id="f6526-335">Unauthorized</span></span> |<span data-ttu-id="f6526-336">The security token is missing or malformed or invalid.</span><span class="sxs-lookup"><span data-stu-id="f6526-336">The security token is missing or malformed or invalid.</span></span> |
| <span data-ttu-id="f6526-337">403</span><span class="sxs-lookup"><span data-stu-id="f6526-337">403</span></span> |<span data-ttu-id="f6526-338">Forbidden</span><span class="sxs-lookup"><span data-stu-id="f6526-338">Forbidden</span></span> |<span data-ttu-id="f6526-339">The security token is not valid for this path for this action.</span><span class="sxs-lookup"><span data-stu-id="f6526-339">The security token is not valid for this path for this action.</span></span> |
| <span data-ttu-id="f6526-340">500</span><span class="sxs-lookup"><span data-stu-id="f6526-340">500</span></span> |<span data-ttu-id="f6526-341">Internal Error</span><span class="sxs-lookup"><span data-stu-id="f6526-341">Internal Error</span></span> |<span data-ttu-id="f6526-342">Something went wrong in the service.</span><span class="sxs-lookup"><span data-stu-id="f6526-342">Something went wrong in the service.</span></span> |

<span data-ttu-id="f6526-343">If the web socket connection is intentionally shut down by the service after it has been initially set up, the reason for doing so will be communicated using an appropriate web socket protocol error code along with a descriptive error message that will also include a tracking ID.</span><span class="sxs-lookup"><span data-stu-id="f6526-343">If the web socket connection is intentionally shut down by the service after it has been initially set up, the reason for doing so will be communicated using an appropriate web socket protocol error code along with a descriptive error message that will also include a tracking ID.</span></span>

| <span data-ttu-id="f6526-344">WS Status</span><span class="sxs-lookup"><span data-stu-id="f6526-344">WS Status</span></span> | <span data-ttu-id="f6526-345">Description</span><span class="sxs-lookup"><span data-stu-id="f6526-345">Description</span></span> |
| --- | --- |
| <span data-ttu-id="f6526-346">1000</span><span class="sxs-lookup"><span data-stu-id="f6526-346">1000</span></span> |<span data-ttu-id="f6526-347">The listener shut down the socket.</span><span class="sxs-lookup"><span data-stu-id="f6526-347">The listener shut down the socket.</span></span> |
| <span data-ttu-id="f6526-348">1001</span><span class="sxs-lookup"><span data-stu-id="f6526-348">1001</span></span> |<span data-ttu-id="f6526-349">The Hybrid Connection path has been deleted or disabled.</span><span class="sxs-lookup"><span data-stu-id="f6526-349">The Hybrid Connection path has been deleted or disabled.</span></span> |
| <span data-ttu-id="f6526-350">1008</span><span class="sxs-lookup"><span data-stu-id="f6526-350">1008</span></span> |<span data-ttu-id="f6526-351">The security token has expired and therefore the authorization policy is violated.</span><span class="sxs-lookup"><span data-stu-id="f6526-351">The security token has expired and therefore the authorization policy is violated.</span></span> |
| <span data-ttu-id="f6526-352">1011</span><span class="sxs-lookup"><span data-stu-id="f6526-352">1011</span></span> |<span data-ttu-id="f6526-353">Something went wrong in the service.</span><span class="sxs-lookup"><span data-stu-id="f6526-353">Something went wrong in the service.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="f6526-354">Next steps</span><span class="sxs-lookup"><span data-stu-id="f6526-354">Next steps</span></span>
* [<span data-ttu-id="f6526-355">Relay FAQ</span><span class="sxs-lookup"><span data-stu-id="f6526-355">Relay FAQ</span></span>](relay-faq.md)
* [<span data-ttu-id="f6526-356">Create a namespace</span><span class="sxs-lookup"><span data-stu-id="f6526-356">Create a namespace</span></span>](relay-create-namespace-portal.md)
* [<span data-ttu-id="f6526-357">Get started with .NET</span><span class="sxs-lookup"><span data-stu-id="f6526-357">Get started with .NET</span></span>](relay-hybrid-connections-dotnet-get-started.md)
* [<span data-ttu-id="f6526-358">Get started with Node</span><span class="sxs-lookup"><span data-stu-id="f6526-358">Get started with Node</span></span>](relay-hybrid-connections-node-get-started.md)

