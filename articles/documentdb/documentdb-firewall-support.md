---
title: Azure DocumentDB firewall support & IP access control | Microsoft Docs
description: Learn how to use IP access control policies for firewall support on Azure DocumentDB database accounts.
keywords: IP access control, firewall support
services: documentdb
author: shahankur11
manager: jhubbard
editor: ''
tags: azure-resource-manager
documentationcenter: ''
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: documentdb
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/05/2017
ms.author: ankshah
ms.openlocfilehash: 85dfc769f1a9119af056e2680d13df69ee22a773
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44549918"
---
# <a name="documentdb-firewall-support"></a><span data-ttu-id="4e19c-104">DocumentDB firewall support</span><span class="sxs-lookup"><span data-stu-id="4e19c-104">DocumentDB firewall support</span></span>
<span data-ttu-id="4e19c-105">To secure data stored in an Azure DocumentDB database account, DocumentDB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span><span class="sxs-lookup"><span data-stu-id="4e19c-105">To secure data stored in an Azure DocumentDB database account, DocumentDB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="4e19c-106">Now, in addition to the secret based authorization model, DocumentDB supports policy driven IP-based access controls for inbound firewall support.</span><span class="sxs-lookup"><span data-stu-id="4e19c-106">Now, in addition to the secret based authorization model, DocumentDB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="4e19c-107">This model is very similar to the firewall rules of a traditional database system and provides an additional level of security to the DocumentDB database account.</span><span class="sxs-lookup"><span data-stu-id="4e19c-107">This model is very similar to the firewall rules of a traditional database system and provides an additional level of security to the DocumentDB database account.</span></span> <span data-ttu-id="4e19c-108">With this model, you can now configure a DocumentDB database account to be accessible only from an approved set of machines and/or cloud services.</span><span class="sxs-lookup"><span data-stu-id="4e19c-108">With this model, you can now configure a DocumentDB database account to be accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="4e19c-109">Access to DocumentDB resources from these approved sets of machines and services still require the caller to present a valid authorization token.</span><span class="sxs-lookup"><span data-stu-id="4e19c-109">Access to DocumentDB resources from these approved sets of machines and services still require the caller to present a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="4e19c-110">IP access control overview</span><span class="sxs-lookup"><span data-stu-id="4e19c-110">IP access control overview</span></span>
<span data-ttu-id="4e19c-111">By default, a DocumentDB database account is accessible from public internet as long as the request is accompanied by a valid authorization token.</span><span class="sxs-lookup"><span data-stu-id="4e19c-111">By default, a DocumentDB database account is accessible from public internet as long as the request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="4e19c-112">To configure IP policy-based access control, the user must provide the set of IP addresses or IP address ranges in CIDR form to be included as the allowed list of client IPs for a given database account.</span><span class="sxs-lookup"><span data-stu-id="4e19c-112">To configure IP policy-based access control, the user must provide the set of IP addresses or IP address ranges in CIDR form to be included as the allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="4e19c-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by the server.</span><span class="sxs-lookup"><span data-stu-id="4e19c-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by the server.</span></span>  <span data-ttu-id="4e19c-114">The connection processing flow for the IP-based access control is described in the following diagram.</span><span class="sxs-lookup"><span data-stu-id="4e19c-114">The connection processing flow for the IP-based access control is described in the following diagram.</span></span>

![Diagram showing the connection process for IP-based access control](https://docstestmedia1.blob.core.windows.net/azure-media/articles/documentdb/media/documentdb-firewall-support/documentdb-firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="4e19c-116">Connections from cloud services</span><span class="sxs-lookup"><span data-stu-id="4e19c-116">Connections from cloud services</span></span>
<span data-ttu-id="4e19c-117">In Azure, cloud services are a very common way for hosting middle tier service logic using DocumentDB.</span><span class="sxs-lookup"><span data-stu-id="4e19c-117">In Azure, cloud services are a very common way for hosting middle tier service logic using DocumentDB.</span></span> <span data-ttu-id="4e19c-118">To enable access to a DocumentDB database account from a cloud service, the public IP address of the cloud service must be added to the allowed list of IP addresses associated with your DocumentDB database account by [configuring the IP access control policy](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="4e19c-118">To enable access to a DocumentDB database account from a cloud service, the public IP address of the cloud service must be added to the allowed list of IP addresses associated with your DocumentDB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="4e19c-119">This ensures that all role instances of cloud services have access to your DocumentDB database account.</span><span class="sxs-lookup"><span data-stu-id="4e19c-119">This ensures that all role instances of cloud services have access to your DocumentDB database account.</span></span> <span data-ttu-id="4e19c-120">You can retrieve IP addresses for your cloud services in the Azure portal, as shown in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="4e19c-120">You can retrieve IP addresses for your cloud services in the Azure portal, as shown in the following screenshot.</span></span>

![Screenshot showing the public IP address for a cloud service displayed in the Azure portal](https://docstestmedia1.blob.core.windows.net/azure-media/articles/documentdb/media/documentdb-firewall-support/documentdb-public-ip-addresses.png)

<span data-ttu-id="4e19c-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access to the DocumentDB database account since they are part of the same cloud service.</span><span class="sxs-lookup"><span data-stu-id="4e19c-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access to the DocumentDB database account since they are part of the same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="4e19c-123">Connections from virtual machines</span><span class="sxs-lookup"><span data-stu-id="4e19c-123">Connections from virtual machines</span></span>
<span data-ttu-id="4e19c-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used to host middle tier services using DocumentDB.</span><span class="sxs-lookup"><span data-stu-id="4e19c-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used to host middle tier services using DocumentDB.</span></span>  <span data-ttu-id="4e19c-125">To configure the DocumentDB database account to allow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of the allowed IP addresses for your DocumentDB database account by [configuring the IP access control policy](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="4e19c-125">To configure the DocumentDB database account to allow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of the allowed IP addresses for your DocumentDB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="4e19c-126">You can retrieve IP addresses for virtual machines in the Azure portal, as shown in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="4e19c-126">You can retrieve IP addresses for virtual machines in the Azure portal, as shown in the following screenshot.</span></span>

![Screenshot showing a public IP address for a virtual machine displayed in the Azure portal](https://docstestmedia1.blob.core.windows.net/azure-media/articles/documentdb/media/documentdb-firewall-support/documentdb-public-ip-addresses-dns.png)

<span data-ttu-id="4e19c-128">When you add additional virtual machine instances to the group, they are automatically provided access to your DocumentDB database account.</span><span class="sxs-lookup"><span data-stu-id="4e19c-128">When you add additional virtual machine instances to the group, they are automatically provided access to your DocumentDB database account.</span></span>

## <a name="connections-from-the-internet"></a><span data-ttu-id="4e19c-129">Connections from the internet</span><span class="sxs-lookup"><span data-stu-id="4e19c-129">Connections from the internet</span></span>
<span data-ttu-id="4e19c-130">When you access a DocumentDB database account from a computer on the internet, the client IP address or IP address range of the machine must be added to the allowed list of IP address for the DocumentDB database account.</span><span class="sxs-lookup"><span data-stu-id="4e19c-130">When you access a DocumentDB database account from a computer on the internet, the client IP address or IP address range of the machine must be added to the allowed list of IP address for the DocumentDB database account.</span></span> 

## <a id="configure-ip-policy"></a> <span data-ttu-id="4e19c-131">Configuring the IP access control policy</span><span class="sxs-lookup"><span data-stu-id="4e19c-131">Configuring the IP access control policy</span></span>
<span data-ttu-id="4e19c-132">The IP access control policy can be set in the Azure portal, or programmatically through [Azure CLI](documentdb-automation-resource-manager-cli.md), [Azure Powershell](documentdb-manage-account-with-powershell.md), or the [REST API](https://msdn.microsoft.com/library/azure/dn781481.aspx) by updating the `ipRangeFilter` property.</span><span class="sxs-lookup"><span data-stu-id="4e19c-132">The IP access control policy can be set in the Azure portal, or programmatically through [Azure CLI](documentdb-automation-resource-manager-cli.md), [Azure Powershell](documentdb-manage-account-with-powershell.md), or the [REST API](https://msdn.microsoft.com/library/azure/dn781481.aspx) by updating the `ipRangeFilter` property.</span></span> <span data-ttu-id="4e19c-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span><span class="sxs-lookup"><span data-stu-id="4e19c-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="4e19c-134">Example: "13.91.6.132,13.91.6.1/24".</span><span class="sxs-lookup"><span data-stu-id="4e19c-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="4e19c-135">When updating your database account through these methods, be sure to populate all of the properties to prevent resetting to default settings.</span><span class="sxs-lookup"><span data-stu-id="4e19c-135">When updating your database account through these methods, be sure to populate all of the properties to prevent resetting to default settings.</span></span>

> [!NOTE]
> <span data-ttu-id="4e19c-136">By enabling an IP access control policy for your DocumentDB database account, all access to your DocumentDB database account from machines outside the configured allowed list of IP address ranges are blocked.</span><span class="sxs-lookup"><span data-stu-id="4e19c-136">By enabling an IP access control policy for your DocumentDB database account, all access to your DocumentDB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="4e19c-137">By virtue of this model, browsing the data plane operation from the portal will also be blocked to ensure the integrity of access control.</span><span class="sxs-lookup"><span data-stu-id="4e19c-137">By virtue of this model, browsing the data plane operation from the portal will also be blocked to ensure the integrity of access control.</span></span>

<span data-ttu-id="4e19c-138">To simplify development, the Azure portal helps you identify and add the IP of your client machine to the allowed list, so that apps running your machine can access the DocumentDB account.</span><span class="sxs-lookup"><span data-stu-id="4e19c-138">To simplify development, the Azure portal helps you identify and add the IP of your client machine to the allowed list, so that apps running your machine can access the DocumentDB account.</span></span> <span data-ttu-id="4e19c-139">Note that the client IP address here is detected as seen by the portal.</span><span class="sxs-lookup"><span data-stu-id="4e19c-139">Note that the client IP address here is detected as seen by the portal.</span></span> <span data-ttu-id="4e19c-140">It may be the client IP address of your machine, but it could also be the IP address of your network gateway.</span><span class="sxs-lookup"><span data-stu-id="4e19c-140">It may be the client IP address of your machine, but it could also be the IP address of your network gateway.</span></span> <span data-ttu-id="4e19c-141">Do not forget to remove it before going to production.</span><span class="sxs-lookup"><span data-stu-id="4e19c-141">Do not forget to remove it before going to production.</span></span>

<span data-ttu-id="4e19c-142">To set the IP access control policy in the Azure portal, navigate to the DocumentDB account blade, click **Firewall** in the navigation menu, then click **ON**</span><span class="sxs-lookup"><span data-stu-id="4e19c-142">To set the IP access control policy in the Azure portal, navigate to the DocumentDB account blade, click **Firewall** in the navigation menu, then click **ON**</span></span> 

![Screenshot showing how to open the Firewall blade in the Azure portal](https://docstestmedia1.blob.core.windows.net/azure-media/articles/documentdb/media/documentdb-firewall-support/documentdb-azure-portal-firewall.png)

<span data-ttu-id="4e19c-144">In the new pane, specify whether the Azure portal can access the account, and add other addresses and ranges as appropriate, then click **Save**.</span><span class="sxs-lookup"><span data-stu-id="4e19c-144">In the new pane, specify whether the Azure portal can access the account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="4e19c-145">When you enable an IP access control policy, you need to add the IP address for the Azure portal to maintain access.</span><span class="sxs-lookup"><span data-stu-id="4e19c-145">When you enable an IP access control policy, you need to add the IP address for the Azure portal to maintain access.</span></span> <span data-ttu-id="4e19c-146">The portal IP addresses are:</span><span class="sxs-lookup"><span data-stu-id="4e19c-146">The portal IP addresses are:</span></span>
> |<span data-ttu-id="4e19c-147">Region</span><span class="sxs-lookup"><span data-stu-id="4e19c-147">Region</span></span>|<span data-ttu-id="4e19c-148">IP address</span><span class="sxs-lookup"><span data-stu-id="4e19c-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="4e19c-149">All regions except those specified below</span><span class="sxs-lookup"><span data-stu-id="4e19c-149">All regions except those specified below</span></span>| <span data-ttu-id="4e19c-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="4e19c-150">104.42.195.92</span></span>|
> |<span data-ttu-id="4e19c-151">Germany</span><span class="sxs-lookup"><span data-stu-id="4e19c-151">Germany</span></span>|<span data-ttu-id="4e19c-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="4e19c-152">51.4.229.218</span></span>|
> |<span data-ttu-id="4e19c-153">China</span><span class="sxs-lookup"><span data-stu-id="4e19c-153">China</span></span>|<span data-ttu-id="4e19c-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="4e19c-154">139.217.8.252</span></span>|
> |<span data-ttu-id="4e19c-155">US Gov Arizona</span><span class="sxs-lookup"><span data-stu-id="4e19c-155">US Gov Arizona</span></span>|<span data-ttu-id="4e19c-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="4e19c-156">52.244.48.71</span></span>|
>

![Screenshot showing a how to configure firewall settings in the Azure portal](https://docstestmedia1.blob.core.windows.net/azure-media/articles/documentdb/media/documentdb-firewall-support/documentdb-azure-portal-firewall-configure.png)

## <a name="troubleshooting-the-ip-access-control-policy"></a><span data-ttu-id="4e19c-158">Troubleshooting the IP access control policy</span><span class="sxs-lookup"><span data-stu-id="4e19c-158">Troubleshooting the IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="4e19c-159">Portal operations</span><span class="sxs-lookup"><span data-stu-id="4e19c-159">Portal operations</span></span>
<span data-ttu-id="4e19c-160">By enabling an IP access control policy for your DocumentDB database account, all access to your DocumentDB database account from machines outside the configured allowed list of IP address ranges are blocked.</span><span class="sxs-lookup"><span data-stu-id="4e19c-160">By enabling an IP access control policy for your DocumentDB database account, all access to your DocumentDB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="4e19c-161">Therefore if you want to enable portal data plane operations like browsing collections and query documents, you need to explicitly allow Azure portal access using the **Firewall** blade in the portal.</span><span class="sxs-lookup"><span data-stu-id="4e19c-161">Therefore if you want to enable portal data plane operations like browsing collections and query documents, you need to explicitly allow Azure portal access using the **Firewall** blade in the portal.</span></span> 

![Screenshot showing a how to enable access to the Azure portal](https://docstestmedia1.blob.core.windows.net/azure-media/articles/documentdb/media/documentdb-firewall-support/documentdb-azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="4e19c-163">SDK & Rest API</span><span class="sxs-lookup"><span data-stu-id="4e19c-163">SDK & Rest API</span></span>
<span data-ttu-id="4e19c-164">For security reasons, access via SDK or REST API from machines not on the allowed list will return a generic 404 Not Found response with no additional details.</span><span class="sxs-lookup"><span data-stu-id="4e19c-164">For security reasons, access via SDK or REST API from machines not on the allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="4e19c-165">Please verify the IP allowed list configured for your DocumentDB database account to ensure the correct policy configuration is applied to your DocumentDB database account.</span><span class="sxs-lookup"><span data-stu-id="4e19c-165">Please verify the IP allowed list configured for your DocumentDB database account to ensure the correct policy configuration is applied to your DocumentDB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4e19c-166">Next steps</span><span class="sxs-lookup"><span data-stu-id="4e19c-166">Next steps</span></span>
<span data-ttu-id="4e19c-167">For information about network related performance tips, see [Performance tips](documentdb-performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="4e19c-167">For information about network related performance tips, see [Performance tips](documentdb-performance-tips.md).</span></span>







