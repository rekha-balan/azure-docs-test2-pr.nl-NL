---
title: Overview of Highly Available configurations with Azure VPN Gateways | Microsoft Docs
description: This article provides an overview of highly available configuration options using Azure VPN Gateways.
services: vpn-gateway
documentationcenter: na
author: yushwang
manager: rossort
editor: ''
tags: ''
ms.assetid: a8bfc955-de49-4172-95ac-5257e262d7ea
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/24/2016
ms.author: yushwang
ms.openlocfilehash: b13f7d38c03d2ef35697409e4d7820822b20acce
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44554172"
---
# <a name="highly-available-cross-premises-and-vnet-to-vnet-connectivity"></a><span data-ttu-id="9d26c-103">Highly Available Cross-Premises and VNet-to-VNet Connectivity</span><span class="sxs-lookup"><span data-stu-id="9d26c-103">Highly Available Cross-Premises and VNet-to-VNet Connectivity</span></span>
<span data-ttu-id="9d26c-104">This article provides an overview of Highly Available configuration options for your cross-premises and VNet-to-VNet connectivity using Azure VPN gateways.</span><span class="sxs-lookup"><span data-stu-id="9d26c-104">This article provides an overview of Highly Available configuration options for your cross-premises and VNet-to-VNet connectivity using Azure VPN gateways.</span></span>

## <a name = "activestandby"></a><span data-ttu-id="9d26c-105">About Azure VPN gateway redundancy</span><span class="sxs-lookup"><span data-stu-id="9d26c-105">About Azure VPN gateway redundancy</span></span>
<span data-ttu-id="9d26c-106">Every Azure VPN gateway consists of two instances in an active-standby configuration.</span><span class="sxs-lookup"><span data-stu-id="9d26c-106">Every Azure VPN gateway consists of two instances in an active-standby configuration.</span></span> <span data-ttu-id="9d26c-107">For any planned maintenance or unplanned disruption that happens to the active instance, the standby instance would take over (failover) automatically, and resume the S2S VPN or VNet-to-VNet connections.</span><span class="sxs-lookup"><span data-stu-id="9d26c-107">For any planned maintenance or unplanned disruption that happens to the active instance, the standby instance would take over (failover) automatically, and resume the S2S VPN or VNet-to-VNet connections.</span></span> <span data-ttu-id="9d26c-108">The switch over will cause a brief interruption.</span><span class="sxs-lookup"><span data-stu-id="9d26c-108">The switch over will cause a brief interruption.</span></span> <span data-ttu-id="9d26c-109">For planned maintenance, the connectivity should be restored within 10 to 15 seconds.</span><span class="sxs-lookup"><span data-stu-id="9d26c-109">For planned maintenance, the connectivity should be restored within 10 to 15 seconds.</span></span> <span data-ttu-id="9d26c-110">For unplanned issues, the connection recovery will be longer, about 1 minute to 1 and a half minutes in the worst case.</span><span class="sxs-lookup"><span data-stu-id="9d26c-110">For unplanned issues, the connection recovery will be longer, about 1 minute to 1 and a half minutes in the worst case.</span></span> <span data-ttu-id="9d26c-111">For P2S VPN client connections to the gateway, the P2S connections will be disconnected and the users will need to reconnect from the client machines.</span><span class="sxs-lookup"><span data-stu-id="9d26c-111">For P2S VPN client connections to the gateway, the P2S connections will be disconnected and the users will need to reconnect from the client machines.</span></span>

![Active-Standby](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-highlyavailable/active-standby.png)

## <a name="highly-available-cross-premises-connectivity"></a><span data-ttu-id="9d26c-113">Highly Available Cross-Premises Connectivity</span><span class="sxs-lookup"><span data-stu-id="9d26c-113">Highly Available Cross-Premises Connectivity</span></span>
<span data-ttu-id="9d26c-114">To provide better availability for your cross premises connections, there are a couple of options available:</span><span class="sxs-lookup"><span data-stu-id="9d26c-114">To provide better availability for your cross premises connections, there are a couple of options available:</span></span>

* <span data-ttu-id="9d26c-115">Multiple on-premises VPN devices</span><span class="sxs-lookup"><span data-stu-id="9d26c-115">Multiple on-premises VPN devices</span></span>
* <span data-ttu-id="9d26c-116">Active-active Azure VPN gateway</span><span class="sxs-lookup"><span data-stu-id="9d26c-116">Active-active Azure VPN gateway</span></span>
* <span data-ttu-id="9d26c-117">Combination of both</span><span class="sxs-lookup"><span data-stu-id="9d26c-117">Combination of both</span></span>

### <a name = "activeactiveonprem"></a><span data-ttu-id="9d26c-118">Multiple on-premises VPN devices</span><span class="sxs-lookup"><span data-stu-id="9d26c-118">Multiple on-premises VPN devices</span></span>
<span data-ttu-id="9d26c-119">You can use multiple VPN devices from your on-premises network to connect to your Azure VPN gateway, as shown in the following diagram:</span><span class="sxs-lookup"><span data-stu-id="9d26c-119">You can use multiple VPN devices from your on-premises network to connect to your Azure VPN gateway, as shown in the following diagram:</span></span>

![Multiple On-Premises VPN](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-highlyavailable/multiple-onprem-vpns.png)

<span data-ttu-id="9d26c-121">This configuration provides multiple active tunnels from the same Azure VPN gateway to your on-premises devices in the same location.</span><span class="sxs-lookup"><span data-stu-id="9d26c-121">This configuration provides multiple active tunnels from the same Azure VPN gateway to your on-premises devices in the same location.</span></span> <span data-ttu-id="9d26c-122">There are some requirements and constraints:</span><span class="sxs-lookup"><span data-stu-id="9d26c-122">There are some requirements and constraints:</span></span>

1. <span data-ttu-id="9d26c-123">You need to create multiple S2S VPN connections from your VPN devices to Azure.</span><span class="sxs-lookup"><span data-stu-id="9d26c-123">You need to create multiple S2S VPN connections from your VPN devices to Azure.</span></span> <span data-ttu-id="9d26c-124">When you connect multiple VPN devices from the same on-premises network to Azure, you need to create one local network gateway for each VPN device, and one connection from your Azure VPN gateway to the local network gateway.</span><span class="sxs-lookup"><span data-stu-id="9d26c-124">When you connect multiple VPN devices from the same on-premises network to Azure, you need to create one local network gateway for each VPN device, and one connection from your Azure VPN gateway to the local network gateway.</span></span>
2. <span data-ttu-id="9d26c-125">The local network gateways corresponding to your VPN devices must have unique public IP addresses in the "GatewayIpAddress" property.</span><span class="sxs-lookup"><span data-stu-id="9d26c-125">The local network gateways corresponding to your VPN devices must have unique public IP addresses in the "GatewayIpAddress" property.</span></span>
3. <span data-ttu-id="9d26c-126">BGP is required for this configuration.</span><span class="sxs-lookup"><span data-stu-id="9d26c-126">BGP is required for this configuration.</span></span> <span data-ttu-id="9d26c-127">Each local network gateway representing a VPN device must have a unique BGP peer IP address specified in the "BgpPeerIpAddress" property.</span><span class="sxs-lookup"><span data-stu-id="9d26c-127">Each local network gateway representing a VPN device must have a unique BGP peer IP address specified in the "BgpPeerIpAddress" property.</span></span>
4. <span data-ttu-id="9d26c-128">The AddressPrefix property field in each local network gateway must not overlap.</span><span class="sxs-lookup"><span data-stu-id="9d26c-128">The AddressPrefix property field in each local network gateway must not overlap.</span></span> <span data-ttu-id="9d26c-129">You should specify the "BgpPeerIpAddress" in /32 CIDR format in the AddressPrefix field, for example, 10.200.200.254/32.</span><span class="sxs-lookup"><span data-stu-id="9d26c-129">You should specify the "BgpPeerIpAddress" in /32 CIDR format in the AddressPrefix field, for example, 10.200.200.254/32.</span></span>
5. <span data-ttu-id="9d26c-130">You should use BGP to advertise the same prefixes of the same on-premises network prefixes to your Azure VPN gateway, and the traffic will be forwarded through these tunnels simultaneously.</span><span class="sxs-lookup"><span data-stu-id="9d26c-130">You should use BGP to advertise the same prefixes of the same on-premises network prefixes to your Azure VPN gateway, and the traffic will be forwarded through these tunnels simultaneously.</span></span>
6. <span data-ttu-id="9d26c-131">Each connection is counted against the maximum number of tunnels for your Azure VPN gateway, 10 for Basic and Standard SKUs, and 30 for HighPerformance SKU.</span><span class="sxs-lookup"><span data-stu-id="9d26c-131">Each connection is counted against the maximum number of tunnels for your Azure VPN gateway, 10 for Basic and Standard SKUs, and 30 for HighPerformance SKU.</span></span> 

<span data-ttu-id="9d26c-132">In this configuration, the Azure VPN gateway is still in active-standby mode, so the same failover behavior and brief interruption will still happen as described [above](#activestandby).</span><span class="sxs-lookup"><span data-stu-id="9d26c-132">In this configuration, the Azure VPN gateway is still in active-standby mode, so the same failover behavior and brief interruption will still happen as described [above](#activestandby).</span></span> <span data-ttu-id="9d26c-133">But this setup guards against failures or interruptions on your on-premises network and VPN devices.</span><span class="sxs-lookup"><span data-stu-id="9d26c-133">But this setup guards against failures or interruptions on your on-premises network and VPN devices.</span></span>

### <a name="active-active-azure-vpn-gateway"></a><span data-ttu-id="9d26c-134">Active-active Azure VPN gateway</span><span class="sxs-lookup"><span data-stu-id="9d26c-134">Active-active Azure VPN gateway</span></span>
<span data-ttu-id="9d26c-135">You can now create an Azure VPN gateway in an active-active configuration, where both instances of the gateway VMs will establish S2S VPN tunnels to your on-premises VPN device, as shown the following diagram:</span><span class="sxs-lookup"><span data-stu-id="9d26c-135">You can now create an Azure VPN gateway in an active-active configuration, where both instances of the gateway VMs will establish S2S VPN tunnels to your on-premises VPN device, as shown the following diagram:</span></span>

![Active-Active](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-highlyavailable/active-active.png)

<span data-ttu-id="9d26c-137">In this configuration, each Azure gateway instance will have a unique public IP address, and each will establish an IPsec/IKE S2S VPN tunnel to your on-premises VPN device specified in your local network gateway and connection.</span><span class="sxs-lookup"><span data-stu-id="9d26c-137">In this configuration, each Azure gateway instance will have a unique public IP address, and each will establish an IPsec/IKE S2S VPN tunnel to your on-premises VPN device specified in your local network gateway and connection.</span></span> <span data-ttu-id="9d26c-138">Note that both VPN tunnels are actually part of the same connection.</span><span class="sxs-lookup"><span data-stu-id="9d26c-138">Note that both VPN tunnels are actually part of the same connection.</span></span> <span data-ttu-id="9d26c-139">You will still need to configure your on-premises VPN device to accept or establish two S2S VPN tunnels to those two Azure VPN gateway public IP addresses.</span><span class="sxs-lookup"><span data-stu-id="9d26c-139">You will still need to configure your on-premises VPN device to accept or establish two S2S VPN tunnels to those two Azure VPN gateway public IP addresses.</span></span>

<span data-ttu-id="9d26c-140">Because the Azure gateway instances are in active-active configuration, the traffic from your Azure virtual network to your on-premises network will be routed through both tunnels simultaneously, even if your on-premises VPN device may favor one tunnel over the other.</span><span class="sxs-lookup"><span data-stu-id="9d26c-140">Because the Azure gateway instances are in active-active configuration, the traffic from your Azure virtual network to your on-premises network will be routed through both tunnels simultaneously, even if your on-premises VPN device may favor one tunnel over the other.</span></span> <span data-ttu-id="9d26c-141">Note though the same TCP or UDP flow will always traverse the same tunnel or path, unless a maintenance event happens on one of the instances.</span><span class="sxs-lookup"><span data-stu-id="9d26c-141">Note though the same TCP or UDP flow will always traverse the same tunnel or path, unless a maintenance event happens on one of the instances.</span></span>

<span data-ttu-id="9d26c-142">When a planned maintenance or unplanned event happens to one gateway instance, the IPsec tunnel from that instance to your on-premises VPN device will be disconnected.</span><span class="sxs-lookup"><span data-stu-id="9d26c-142">When a planned maintenance or unplanned event happens to one gateway instance, the IPsec tunnel from that instance to your on-premises VPN device will be disconnected.</span></span> <span data-ttu-id="9d26c-143">The corresponding routes on your VPN devices should be removed or withdrawn automatically so that the traffic will be switched over to the other active IPsec tunnel.</span><span class="sxs-lookup"><span data-stu-id="9d26c-143">The corresponding routes on your VPN devices should be removed or withdrawn automatically so that the traffic will be switched over to the other active IPsec tunnel.</span></span> <span data-ttu-id="9d26c-144">On the Azure side, the switch over will happen automatically from the affected instance to the active instance.</span><span class="sxs-lookup"><span data-stu-id="9d26c-144">On the Azure side, the switch over will happen automatically from the affected instance to the active instance.</span></span>

### <a name="dual-redundancy-active-active-vpn-gateways-for-both-azure-and-on-premises-networks"></a><span data-ttu-id="9d26c-145">Dual-redundancy: active-active VPN gateways for both Azure and on-premises networks</span><span class="sxs-lookup"><span data-stu-id="9d26c-145">Dual-redundancy: active-active VPN gateways for both Azure and on-premises networks</span></span>
<span data-ttu-id="9d26c-146">The most reliable option is to combine the active-active gateways on both your network and Azure, as shown in the diagram below.</span><span class="sxs-lookup"><span data-stu-id="9d26c-146">The most reliable option is to combine the active-active gateways on both your network and Azure, as shown in the diagram below.</span></span>

![Dual Redundancy](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-highlyavailable/dual-redundancy.png)

<span data-ttu-id="9d26c-148">Here you create and setup the Azure VPN gateway in an active-active configuration, and create two local network gateways and two connections for your two on-premises VPN devices as described above.</span><span class="sxs-lookup"><span data-stu-id="9d26c-148">Here you create and setup the Azure VPN gateway in an active-active configuration, and create two local network gateways and two connections for your two on-premises VPN devices as described above.</span></span> <span data-ttu-id="9d26c-149">The result is a full mesh connectivity of 4 IPsec tunnels between your Azure virtual network and your on-premises network.</span><span class="sxs-lookup"><span data-stu-id="9d26c-149">The result is a full mesh connectivity of 4 IPsec tunnels between your Azure virtual network and your on-premises network.</span></span>

<span data-ttu-id="9d26c-150">All gateways and tunnels are active from the Azure side, so the traffic will be spread among all 4 tunnels simultaneously, although each TCP or UDP flow will again follow the same tunnel or path from the Azure side.</span><span class="sxs-lookup"><span data-stu-id="9d26c-150">All gateways and tunnels are active from the Azure side, so the traffic will be spread among all 4 tunnels simultaneously, although each TCP or UDP flow will again follow the same tunnel or path from the Azure side.</span></span> <span data-ttu-id="9d26c-151">Even though by spreading the traffic, you may see slightly better throughput over the IPsec tunnels, the primary goal of this configuration is for high availability.</span><span class="sxs-lookup"><span data-stu-id="9d26c-151">Even though by spreading the traffic, you may see slightly better throughput over the IPsec tunnels, the primary goal of this configuration is for high availability.</span></span> <span data-ttu-id="9d26c-152">And due to the statistical nature of the spreading, it is difficult to provide the measurement on how different application traffic conditions will affect the aggregate throughput.</span><span class="sxs-lookup"><span data-stu-id="9d26c-152">And due to the statistical nature of the spreading, it is difficult to provide the measurement on how different application traffic conditions will affect the aggregate throughput.</span></span>

<span data-ttu-id="9d26c-153">This topology will require two local network gateways and two connections to support the pair of on-premises VPN devices, and BGP is required to allow the two connections to the same on-premises network.</span><span class="sxs-lookup"><span data-stu-id="9d26c-153">This topology will require two local network gateways and two connections to support the pair of on-premises VPN devices, and BGP is required to allow the two connections to the same on-premises network.</span></span> <span data-ttu-id="9d26c-154">These requirements are the same as the [above](#activeactiveonprem).</span><span class="sxs-lookup"><span data-stu-id="9d26c-154">These requirements are the same as the [above](#activeactiveonprem).</span></span> 

## <a name="highly-available-vnet-to-vnet-connectivity-through-azure-vpn-gateways"></a><span data-ttu-id="9d26c-155">Highly Available VNet-to-VNet Connectivity through Azure VPN Gateways</span><span class="sxs-lookup"><span data-stu-id="9d26c-155">Highly Available VNet-to-VNet Connectivity through Azure VPN Gateways</span></span>
<span data-ttu-id="9d26c-156">The same active-active configuration can also apply to Azure VNet-to-VNet connections.</span><span class="sxs-lookup"><span data-stu-id="9d26c-156">The same active-active configuration can also apply to Azure VNet-to-VNet connections.</span></span> <span data-ttu-id="9d26c-157">You can create active-active VPN gateways for both virtual networks, and connect them together to form the same full mesh connectivity of 4 tunnels between the two VNets, as shown in the diagram below:</span><span class="sxs-lookup"><span data-stu-id="9d26c-157">You can create active-active VPN gateways for both virtual networks, and connect them together to form the same full mesh connectivity of 4 tunnels between the two VNets, as shown in the diagram below:</span></span>

![VNet-to-VNet](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-highlyavailable/vnet-to-vnet.png)

<span data-ttu-id="9d26c-159">This ensures there are always a pair of tunnels between the two virtual networks for any planned maintenance events, providing even better availability.</span><span class="sxs-lookup"><span data-stu-id="9d26c-159">This ensures there are always a pair of tunnels between the two virtual networks for any planned maintenance events, providing even better availability.</span></span> <span data-ttu-id="9d26c-160">Even though the same topology for cross-premises connectivity requires two connections, the VNet-to-VNet topology shown above will need only one connection for each gateway.</span><span class="sxs-lookup"><span data-stu-id="9d26c-160">Even though the same topology for cross-premises connectivity requires two connections, the VNet-to-VNet topology shown above will need only one connection for each gateway.</span></span> <span data-ttu-id="9d26c-161">Additionally, BGP is optional unless transit routing over the VNet-to-VNet connection is required.</span><span class="sxs-lookup"><span data-stu-id="9d26c-161">Additionally, BGP is optional unless transit routing over the VNet-to-VNet connection is required.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9d26c-162">Next steps</span><span class="sxs-lookup"><span data-stu-id="9d26c-162">Next steps</span></span>
<span data-ttu-id="9d26c-163">See [Configuring Active-Active VPN Gateways for Cross-Premises and VNet-to-VNet Connections](vpn-gateway-activeactive-rm-powershell.md) for steps to configure active-active cross-premises and VNet-to-VNet connections.</span><span class="sxs-lookup"><span data-stu-id="9d26c-163">See [Configuring Active-Active VPN Gateways for Cross-Premises and VNet-to-VNet Connections](vpn-gateway-activeactive-rm-powershell.md) for steps to configure active-active cross-premises and VNet-to-VNet connections.</span></span>






