---
title: VPN Gateway Classic to Resource Manager Migration | Microsoft Docs
description: This page provides an overview of the VPN Gateway Classic to Resource Manager migration.
documentationcenter: na
services: vpn-gateway
author: amsriva
manager: rossort
editor: amsriva
ms.assetid: caa8eb19-825a-4031-8b49-18fbf3ebc04e
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/28/2016
ms.author: amsriva
ms.openlocfilehash: 59e02f7cd1cac829a71f3ecc8777a903184879d0
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44551184"
---
# <a name="vpn-gateway-classic-to-resource-manager-migration"></a><span data-ttu-id="fbf7e-103">VPN Gateway classic to Resource Manager migration</span><span class="sxs-lookup"><span data-stu-id="fbf7e-103">VPN Gateway classic to Resource Manager migration</span></span>
<span data-ttu-id="fbf7e-104">VPN Gateways can now be migrated from classic to Resource Manager deployment model.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-104">VPN Gateways can now be migrated from classic to Resource Manager deployment model.</span></span> <span data-ttu-id="fbf7e-105">You can read more about Azure Resource Manager [features and benefits](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="fbf7e-105">You can read more about Azure Resource Manager [features and benefits](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="fbf7e-106">In this article, we  detail how to migrate from classic deployments to newer Resource Manager based model.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-106">In this article, we  detail how to migrate from classic deployments to newer Resource Manager based model.</span></span> 

<span data-ttu-id="fbf7e-107">VPN Gateways are migrated as part of VNet migration from classic to Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-107">VPN Gateways are migrated as part of VNet migration from classic to Resource Manager.</span></span> <span data-ttu-id="fbf7e-108">This migration is done one VNet at a time.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-108">This migration is done one VNet at a time.</span></span> <span data-ttu-id="fbf7e-109">There is no additional requirement in terms of tools or prerequisites to migration.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-109">There is no additional requirement in terms of tools or prerequisites to migration.</span></span> <span data-ttu-id="fbf7e-110">Migration steps are identical to existing VNet migration and are documented at [IaaS resources migration page](../virtual-machines/windows/migration-classic-resource-manager-ps.md).</span><span class="sxs-lookup"><span data-stu-id="fbf7e-110">Migration steps are identical to existing VNet migration and are documented at [IaaS resources migration page](../virtual-machines/windows/migration-classic-resource-manager-ps.md).</span></span> <span data-ttu-id="fbf7e-111">There is no data path downtime during migration and thus existing workloads would continue to function without loss of on-premises connectivity during migration.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-111">There is no data path downtime during migration and thus existing workloads would continue to function without loss of on-premises connectivity during migration.</span></span> <span data-ttu-id="fbf7e-112">The public IP address associated with the VPN gateway does not change during the migration process.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-112">The public IP address associated with the VPN gateway does not change during the migration process.</span></span> <span data-ttu-id="fbf7e-113">This implies that you will not need to reconfigure your on-premises router once the migration is completed.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-113">This implies that you will not need to reconfigure your on-premises router once the migration is completed.</span></span>  

<span data-ttu-id="fbf7e-114">The model in Resource Manager is different from classic model and is composed of virtual network gateways, local network gateways and connection resources.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-114">The model in Resource Manager is different from classic model and is composed of virtual network gateways, local network gateways and connection resources.</span></span> <span data-ttu-id="fbf7e-115">These represent the VPN gateway itself, the local-site representing on premises address space and connectivity between the two respectively.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-115">These represent the VPN gateway itself, the local-site representing on premises address space and connectivity between the two respectively.</span></span> <span data-ttu-id="fbf7e-116">Once migration is completed your gateways would not be available in classic model and all management operations on virtual network gateways, local network gateways, and connection objects must be performed using Resource Manager model.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-116">Once migration is completed your gateways would not be available in classic model and all management operations on virtual network gateways, local network gateways, and connection objects must be performed using Resource Manager model.</span></span>

## <a name="supported-scenarios"></a><span data-ttu-id="fbf7e-117">Supported scenarios</span><span class="sxs-lookup"><span data-stu-id="fbf7e-117">Supported scenarios</span></span>
<span data-ttu-id="fbf7e-118">Most common VPN connectivity scenarios are covered by classic to Resource Manager migration.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-118">Most common VPN connectivity scenarios are covered by classic to Resource Manager migration.</span></span> <span data-ttu-id="fbf7e-119">The supported scenarios include -</span><span class="sxs-lookup"><span data-stu-id="fbf7e-119">The supported scenarios include -</span></span>

* <span data-ttu-id="fbf7e-120">Point to site connectivity</span><span class="sxs-lookup"><span data-stu-id="fbf7e-120">Point to site connectivity</span></span>
* <span data-ttu-id="fbf7e-121">Site to site connectivity with VPN Gateway connected to on premises location</span><span class="sxs-lookup"><span data-stu-id="fbf7e-121">Site to site connectivity with VPN Gateway connected to on premises location</span></span>
* <span data-ttu-id="fbf7e-122">VNet to VNet connectivity between two VNets using VPN gateways</span><span class="sxs-lookup"><span data-stu-id="fbf7e-122">VNet to VNet connectivity between two VNets using VPN gateways</span></span>
* <span data-ttu-id="fbf7e-123">Multiple VNets connected to same on premises location</span><span class="sxs-lookup"><span data-stu-id="fbf7e-123">Multiple VNets connected to same on premises location</span></span>
* <span data-ttu-id="fbf7e-124">Multi-site connectivity</span><span class="sxs-lookup"><span data-stu-id="fbf7e-124">Multi-site connectivity</span></span>
* <span data-ttu-id="fbf7e-125">Forced tunneling enabled VNets</span><span class="sxs-lookup"><span data-stu-id="fbf7e-125">Forced tunneling enabled VNets</span></span>

<span data-ttu-id="fbf7e-126">Scenarios which are not supported include -</span><span class="sxs-lookup"><span data-stu-id="fbf7e-126">Scenarios which are not supported include -</span></span>  

* <span data-ttu-id="fbf7e-127">Currently VNets containing ExpressRoute gateways do not support migration.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-127">Currently VNets containing ExpressRoute gateways do not support migration.</span></span> <span data-ttu-id="fbf7e-128">Therefore coexistence with ExpressRoute gateways on the same VNet is not currently supported.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-128">Therefore coexistence with ExpressRoute gateways on the same VNet is not currently supported.</span></span>
* <span data-ttu-id="fbf7e-129">Transit scenarios where VM extensions are connected to on-premises servers.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-129">Transit scenarios where VM extensions are connected to on-premises servers.</span></span> <span data-ttu-id="fbf7e-130">Transit VPN connectivity limitations are detailed below.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-130">Transit VPN connectivity limitations are detailed below.</span></span>

> [!NOTE]
> <span data-ttu-id="fbf7e-131">CIDR validation in Resource Manager model is more strict than the one in classic model.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-131">CIDR validation in Resource Manager model is more strict than the one in classic model.</span></span> <span data-ttu-id="fbf7e-132">Before migrating ensure that classic address ranges given conform to valid CIDR format before beginning the migration.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-132">Before migrating ensure that classic address ranges given conform to valid CIDR format before beginning the migration.</span></span> <span data-ttu-id="fbf7e-133">CIDR can be validated using any common CIDR validators.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-133">CIDR can be validated using any common CIDR validators.</span></span> <span data-ttu-id="fbf7e-134">VNet or local sites with invalid CIDR ranges when migrated would result in failed state.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-134">VNet or local sites with invalid CIDR ranges when migrated would result in failed state.</span></span>
> 
> 

## <a name="vnet-to-vnet-connectivity-migration"></a><span data-ttu-id="fbf7e-135">VNet to VNet connectivity migration</span><span class="sxs-lookup"><span data-stu-id="fbf7e-135">VNet to VNet connectivity migration</span></span>
<span data-ttu-id="fbf7e-136">VNet to VNet connectivity in classic was achieved by creating a local site representation of the connected VNet.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-136">VNet to VNet connectivity in classic was achieved by creating a local site representation of the connected VNet.</span></span> <span data-ttu-id="fbf7e-137">Customers were required to create two local sites which represented the two VNets which needed to be connected together.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-137">Customers were required to create two local sites which represented the two VNets which needed to be connected together.</span></span> <span data-ttu-id="fbf7e-138">These were then connected to the corresponding VNets using IPsec tunnel to establish connectivity between the two VNets.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-138">These were then connected to the corresponding VNets using IPsec tunnel to establish connectivity between the two VNets.</span></span> <span data-ttu-id="fbf7e-139">This model has manageability challenges since any address range changes in one VNet must also be maintained in the corresponding local site representation.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-139">This model has manageability challenges since any address range changes in one VNet must also be maintained in the corresponding local site representation.</span></span> <span data-ttu-id="fbf7e-140">In Resource Manager model this workaround is no longer needed.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-140">In Resource Manager model this workaround is no longer needed.</span></span> <span data-ttu-id="fbf7e-141">The connection between the two VNets can be directly achieved using 'Vnet2Vnet' connection type in Connection resource.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-141">The connection between the two VNets can be directly achieved using 'Vnet2Vnet' connection type in Connection resource.</span></span> 

![Screenshot of VNet to VNet migration.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-migration/migration1.png)

<span data-ttu-id="fbf7e-143">During VNet migration we detect that the connected entity to current VNet's VPN gateway is another VNet and ensure that once migration of both VNets is completed, you would no longer see two local sites representing the other VNet.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-143">During VNet migration we detect that the connected entity to current VNet's VPN gateway is another VNet and ensure that once migration of both VNets is completed, you would no longer see two local sites representing the other VNet.</span></span> <span data-ttu-id="fbf7e-144">The classic model of two VPN gateways, two local sites and two connections between them is transformed to Resource Manager model with two VPN gateways and two connections of type Vnet2Vnet.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-144">The classic model of two VPN gateways, two local sites and two connections between them is transformed to Resource Manager model with two VPN gateways and two connections of type Vnet2Vnet.</span></span>

## <a name="transit-vpn-connectivity"></a><span data-ttu-id="fbf7e-145">Transit VPN connectivity</span><span class="sxs-lookup"><span data-stu-id="fbf7e-145">Transit VPN connectivity</span></span>
<span data-ttu-id="fbf7e-146">You can configure VPN gateways in a topology such that on-premises connectivity for a VNet is achieved by connecting to another VNet that is directly connected to on-premises.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-146">You can configure VPN gateways in a topology such that on-premises connectivity for a VNet is achieved by connecting to another VNet that is directly connected to on-premises.</span></span> <span data-ttu-id="fbf7e-147">This is transit VPN connectivity where instances in first VNet are connected to on-premises resources via transit to the VPN gateway in connected VNet that is directly connected to on-premises.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-147">This is transit VPN connectivity where instances in first VNet are connected to on-premises resources via transit to the VPN gateway in connected VNet that is directly connected to on-premises.</span></span> <span data-ttu-id="fbf7e-148">To achieve this configuration in classic deployment model, you would need to create a local site which has aggregated prefixes representing both the connected VNet and on-premises address space.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-148">To achieve this configuration in classic deployment model, you would need to create a local site which has aggregated prefixes representing both the connected VNet and on-premises address space.</span></span> <span data-ttu-id="fbf7e-149">This representational local site is then connected to the VNet to achieve transit connectivity.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-149">This representational local site is then connected to the VNet to achieve transit connectivity.</span></span> <span data-ttu-id="fbf7e-150">This classic model also has similar manageability challenges since any change in on-premises address range must also be maintained on the local site representing the aggregate of VNet and on-premises.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-150">This classic model also has similar manageability challenges since any change in on-premises address range must also be maintained on the local site representing the aggregate of VNet and on-premises.</span></span> <span data-ttu-id="fbf7e-151">Introduction of BGP support in Resource Manager supported gateways simplifies manageability since the connected gateways can learn routes from on premises without manual modification to prefixes.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-151">Introduction of BGP support in Resource Manager supported gateways simplifies manageability since the connected gateways can learn routes from on premises without manual modification to prefixes.</span></span>

![Screenshot of transit routing scenario.](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-migration/migration2.png)

<span data-ttu-id="fbf7e-153">Since we transform VNet to VNet connectivity without requiring local sites, the transit scenario loses on-premises connectivity for VNet that is indirectly connected to on-premises.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-153">Since we transform VNet to VNet connectivity without requiring local sites, the transit scenario loses on-premises connectivity for VNet that is indirectly connected to on-premises.</span></span> <span data-ttu-id="fbf7e-154">The loss of connectivity can be mitigated in the following two ways, after migration is completed -</span><span class="sxs-lookup"><span data-stu-id="fbf7e-154">The loss of connectivity can be mitigated in the following two ways, after migration is completed -</span></span> 

* <span data-ttu-id="fbf7e-155">Enable BGP on VPN gateways that are connected together and to on-premises.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-155">Enable BGP on VPN gateways that are connected together and to on-premises.</span></span> <span data-ttu-id="fbf7e-156">Enabling BGP restores connectivity without any other configuration change since routes are learned and advertised between VNet gateways.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-156">Enabling BGP restores connectivity without any other configuration change since routes are learned and advertised between VNet gateways.</span></span> <span data-ttu-id="fbf7e-157">Note that BGP option is only available on Standard and higher SKUs.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-157">Note that BGP option is only available on Standard and higher SKUs.</span></span>
* <span data-ttu-id="fbf7e-158">Establish an explicit connection from affected VNet to the local network gateway representing on-premises location.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-158">Establish an explicit connection from affected VNet to the local network gateway representing on-premises location.</span></span> <span data-ttu-id="fbf7e-159">This would also require changing configuration on the on-premises router to create and configure the IPsec tunnel.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-159">This would also require changing configuration on the on-premises router to create and configure the IPsec tunnel.</span></span>

## <a name="next-steps"></a><span data-ttu-id="fbf7e-160">Next steps</span><span class="sxs-lookup"><span data-stu-id="fbf7e-160">Next steps</span></span>
<span data-ttu-id="fbf7e-161">After learning about VPN gateway migration support, go to [platform-supported migration of IaaS resources from classic to Resource Manager](../virtual-machines/windows/migration-classic-resource-manager-ps.md) to get started.</span><span class="sxs-lookup"><span data-stu-id="fbf7e-161">After learning about VPN gateway migration support, go to [platform-supported migration of IaaS resources from classic to Resource Manager](../virtual-machines/windows/migration-classic-resource-manager-ps.md) to get started.</span></span>



