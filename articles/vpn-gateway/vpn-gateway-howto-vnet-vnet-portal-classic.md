---
title: 'Create a connection between VNets: classic: Azure portal | Microsoft Docs'
description: How to connect Azure virtual networks together using PowerShell and the Azure classic portal.
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: ''
tags: azure-service-management
ms.assetid: ''
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/11/2017
ms.author: cherylmc
ms.openlocfilehash: 6497e7b531375c7ecf0ed94ba363d98cf2c851e0
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44551000"
---
# <a name="configure-a-vnet-to-vnet-connection-classic"></a><span data-ttu-id="3ad8d-103">Configure a VNet-to-VNet connection (classic)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-103">Configure a VNet-to-VNet connection (classic)</span></span>

<span data-ttu-id="3ad8d-104">Connecting a virtual network to another virtual network (VNet-to-VNet) is similar to connecting a VNet to an on-premises site location.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-104">Connecting a virtual network to another virtual network (VNet-to-VNet) is similar to connecting a VNet to an on-premises site location.</span></span> <span data-ttu-id="3ad8d-105">Both connectivity types use a VPN gateway to provide a secure tunnel using IPsec/IKE.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-105">Both connectivity types use a VPN gateway to provide a secure tunnel using IPsec/IKE.</span></span> <span data-ttu-id="3ad8d-106">You can even combine VNet-to-VNet communication with multi-site connection configurations.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-106">You can even combine VNet-to-VNet communication with multi-site connection configurations.</span></span> <span data-ttu-id="3ad8d-107">This lets you establish network topologies that combine cross-premises connectivity with inter-virtual network connectivity.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-107">This lets you establish network topologies that combine cross-premises connectivity with inter-virtual network connectivity.</span></span>


![v2v diagram](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-howto-vnet-vnet-resource-manager-portal/v2vrmps.png)

<span data-ttu-id="3ad8d-109">This article walks you through the steps to create and connect virtual networks together using the classic deployment model.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-109">This article walks you through the steps to create and connect virtual networks together using the classic deployment model.</span></span> <span data-ttu-id="3ad8d-110">The following steps use the Azure portal to create the VNets and gateways, and PowerShell to configure the VNet-to-VNet connection.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-110">The following steps use the Azure portal to create the VNets and gateways, and PowerShell to configure the VNet-to-VNet connection.</span></span> <span data-ttu-id="3ad8d-111">You cannot configure the connection in the portal.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-111">You cannot configure the connection in the portal.</span></span>

<span data-ttu-id="3ad8d-112">[!INCLUDE [deployment models](../../includes/vpn-gateway-deployment-models-include.md)] If you want to create a VNet-to-VNet connection using a different deployment model, between different deployment models, or using a different deployment tool, you can select an option from following article dropdown list:</span><span class="sxs-lookup"><span data-stu-id="3ad8d-112">[!INCLUDE [deployment models](../../includes/vpn-gateway-deployment-models-include.md)] If you want to create a VNet-to-VNet connection using a different deployment model, between different deployment models, or using a different deployment tool, you can select an option from following article dropdown list:</span></span>

> [!div class="op_single_selector"]
> * [Resource Manager - Azure portal](vpn-gateway-howto-vnet-vnet-resource-manager-portal.md)
> * [Resource Manager - PowerShell](vpn-gateway-vnet-vnet-rm-ps.md)
> * [Classic - Azure portal](vpn-gateway-howto-vnet-vnet-portal-classic.md)
> * [Connect different deployment models - Azure portal](vpn-gateway-connect-different-deployment-models-portal.md)
> * [Connect different deployment models - PowerShell](vpn-gateway-connect-different-deployment-models-powershell.md)
>

[!INCLUDE [vpn-gateway-vnetpeeringlink](../../includes/vpn-gateway-vnetpeeringlink-include.md)]

![VNet to VNet Connectivity Diagram](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-howto-vnet-vnet-portal-classic/v2vclassic.png)


## <a name="about-vnet-to-vnet-connections"></a><span data-ttu-id="3ad8d-119">About VNet-to-VNet connections</span><span class="sxs-lookup"><span data-stu-id="3ad8d-119">About VNet-to-VNet connections</span></span>
<span data-ttu-id="3ad8d-120">Connecting a virtual network to another virtual network (VNet-to-VNet) in the classic deployment model using a VPN gateway is similar to connecting a virtual network to an on-premises site location.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-120">Connecting a virtual network to another virtual network (VNet-to-VNet) in the classic deployment model using a VPN gateway is similar to connecting a virtual network to an on-premises site location.</span></span> <span data-ttu-id="3ad8d-121">Both connectivity types use a VPN gateway to provide a secure tunnel using IPsec/IKE.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-121">Both connectivity types use a VPN gateway to provide a secure tunnel using IPsec/IKE.</span></span> 

<span data-ttu-id="3ad8d-122">The VNets you connect can be in different subscriptions and different regions.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-122">The VNets you connect can be in different subscriptions and different regions.</span></span> <span data-ttu-id="3ad8d-123">You can combine VNet to VNet communication with multi-site configurations.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-123">You can combine VNet to VNet communication with multi-site configurations.</span></span> <span data-ttu-id="3ad8d-124">This lets you establish network topologies that combine cross-premises connectivity with inter-virtual network connectivity.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-124">This lets you establish network topologies that combine cross-premises connectivity with inter-virtual network connectivity.</span></span>

### <a name="why-connect-virtual-networks"></a><span data-ttu-id="3ad8d-125">Why connect virtual networks?</span><span class="sxs-lookup"><span data-stu-id="3ad8d-125">Why connect virtual networks?</span></span>
<span data-ttu-id="3ad8d-126">You may want to connect virtual networks for the following reasons:</span><span class="sxs-lookup"><span data-stu-id="3ad8d-126">You may want to connect virtual networks for the following reasons:</span></span>

* <span data-ttu-id="3ad8d-127">**Cross region geo-redundancy and geo-presence**</span><span class="sxs-lookup"><span data-stu-id="3ad8d-127">**Cross region geo-redundancy and geo-presence**</span></span>
  
  * <span data-ttu-id="3ad8d-128">You can set up your own geo-replication or synchronization with secure connectivity without going over Internet-facing endpoints.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-128">You can set up your own geo-replication or synchronization with secure connectivity without going over Internet-facing endpoints.</span></span>
  * <span data-ttu-id="3ad8d-129">With Azure Load Balancer and Microsoft or third-party clustering technology, you can set up highly available workload with geo-redundancy across multiple Azure regions.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-129">With Azure Load Balancer and Microsoft or third-party clustering technology, you can set up highly available workload with geo-redundancy across multiple Azure regions.</span></span> <span data-ttu-id="3ad8d-130">One important example is to set up SQL Always On with Availability Groups spreading across multiple Azure regions.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-130">One important example is to set up SQL Always On with Availability Groups spreading across multiple Azure regions.</span></span>
* <span data-ttu-id="3ad8d-131">**Regional multi-tier applications with strong isolation boundary**</span><span class="sxs-lookup"><span data-stu-id="3ad8d-131">**Regional multi-tier applications with strong isolation boundary**</span></span>
  
  * <span data-ttu-id="3ad8d-132">Within the same region, you can set up multi-tier applications with multiple VNets connected together with strong isolation and secure inter-tier communication.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-132">Within the same region, you can set up multi-tier applications with multiple VNets connected together with strong isolation and secure inter-tier communication.</span></span>
* <span data-ttu-id="3ad8d-133">**Cross subscription, inter-organization communication in Azure**</span><span class="sxs-lookup"><span data-stu-id="3ad8d-133">**Cross subscription, inter-organization communication in Azure**</span></span>
  
  * <span data-ttu-id="3ad8d-134">If you have multiple Azure subscriptions, you can connect workloads from different subscriptions together securely between virtual networks.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-134">If you have multiple Azure subscriptions, you can connect workloads from different subscriptions together securely between virtual networks.</span></span>
  * <span data-ttu-id="3ad8d-135">For enterprises or service providers, you can enable cross-organization communication with secure VPN technology within Azure.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-135">For enterprises or service providers, you can enable cross-organization communication with secure VPN technology within Azure.</span></span>

<span data-ttu-id="3ad8d-136">For more information about VNet-to-VNet connections, see [VNet-to-VNet considerations](#faq) at the end of this article.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-136">For more information about VNet-to-VNet connections, see [VNet-to-VNet considerations](#faq) at the end of this article.</span></span>

## <a name="step1"></a><span data-ttu-id="3ad8d-137">Step 1 - Plan your IP address ranges</span><span class="sxs-lookup"><span data-stu-id="3ad8d-137">Step 1 - Plan your IP address ranges</span></span>
<span data-ttu-id="3ad8d-138">It’s important to decide the ranges that you’ll use to configure your virtual networks.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-138">It’s important to decide the ranges that you’ll use to configure your virtual networks.</span></span> <span data-ttu-id="3ad8d-139">For this configuration, you must make sure that none of your VNet ranges overlap with each other, or with any of the local networks that they connect to.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-139">For this configuration, you must make sure that none of your VNet ranges overlap with each other, or with any of the local networks that they connect to.</span></span>

<span data-ttu-id="3ad8d-140">The following table shows an example of how to define your VNets.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-140">The following table shows an example of how to define your VNets.</span></span> <span data-ttu-id="3ad8d-141">Use the ranges as a guideline only.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-141">Use the ranges as a guideline only.</span></span> <span data-ttu-id="3ad8d-142">Write down the ranges for your virtual networks.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-142">Write down the ranges for your virtual networks.</span></span> <span data-ttu-id="3ad8d-143">You need this information for later steps.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-143">You need this information for later steps.</span></span>

<span data-ttu-id="3ad8d-144">**Example**</span><span class="sxs-lookup"><span data-stu-id="3ad8d-144">**Example**</span></span>

| <span data-ttu-id="3ad8d-145">Virtual Network</span><span class="sxs-lookup"><span data-stu-id="3ad8d-145">Virtual Network</span></span> | <span data-ttu-id="3ad8d-146">Address Space</span><span class="sxs-lookup"><span data-stu-id="3ad8d-146">Address Space</span></span> | <span data-ttu-id="3ad8d-147">Region</span><span class="sxs-lookup"><span data-stu-id="3ad8d-147">Region</span></span> | <span data-ttu-id="3ad8d-148">Connects to local network site</span><span class="sxs-lookup"><span data-stu-id="3ad8d-148">Connects to local network site</span></span> |
|:--- |:--- |:--- |:--- |
| <span data-ttu-id="3ad8d-149">TestVNet1</span><span class="sxs-lookup"><span data-stu-id="3ad8d-149">TestVNet1</span></span> |<span data-ttu-id="3ad8d-150">TestVNet1</span><span class="sxs-lookup"><span data-stu-id="3ad8d-150">TestVNet1</span></span><br><span data-ttu-id="3ad8d-151">(10.11.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-151">(10.11.0.0/16)</span></span><br><span data-ttu-id="3ad8d-152">(10.12.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-152">(10.12.0.0/16)</span></span> |<span data-ttu-id="3ad8d-153">East US</span><span class="sxs-lookup"><span data-stu-id="3ad8d-153">East US</span></span> |<span data-ttu-id="3ad8d-154">VNet4Local</span><span class="sxs-lookup"><span data-stu-id="3ad8d-154">VNet4Local</span></span><br><span data-ttu-id="3ad8d-155">(10.41.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-155">(10.41.0.0/16)</span></span><br><span data-ttu-id="3ad8d-156">(10.42.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-156">(10.42.0.0/16)</span></span> |
| <span data-ttu-id="3ad8d-157">TestVNet4</span><span class="sxs-lookup"><span data-stu-id="3ad8d-157">TestVNet4</span></span> |<span data-ttu-id="3ad8d-158">TestVNet4</span><span class="sxs-lookup"><span data-stu-id="3ad8d-158">TestVNet4</span></span><br><span data-ttu-id="3ad8d-159">(10.41.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-159">(10.41.0.0/16)</span></span><br><span data-ttu-id="3ad8d-160">(10.42.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-160">(10.42.0.0/16)</span></span> |<span data-ttu-id="3ad8d-161">West US</span><span class="sxs-lookup"><span data-stu-id="3ad8d-161">West US</span></span> |<span data-ttu-id="3ad8d-162">VNet1Local</span><span class="sxs-lookup"><span data-stu-id="3ad8d-162">VNet1Local</span></span><br><span data-ttu-id="3ad8d-163">(10.11.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-163">(10.11.0.0/16)</span></span><br><span data-ttu-id="3ad8d-164">(10.12.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-164">(10.12.0.0/16)</span></span> |

## <a name="vnetvalues"></a><span data-ttu-id="3ad8d-165">Step 2 - Create the virtual networks</span><span class="sxs-lookup"><span data-stu-id="3ad8d-165">Step 2 - Create the virtual networks</span></span>
<span data-ttu-id="3ad8d-166">Create two virtual networks in the [Azure portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="3ad8d-166">Create two virtual networks in the [Azure portal](https://portal.azure.com).</span></span> <span data-ttu-id="3ad8d-167">For the steps to create classic virtual networks, see [Create a classic virtual network](../virtual-network/virtual-networks-create-vnet-classic-pportal.md).</span><span class="sxs-lookup"><span data-stu-id="3ad8d-167">For the steps to create classic virtual networks, see [Create a classic virtual network](../virtual-network/virtual-networks-create-vnet-classic-pportal.md).</span></span> <span data-ttu-id="3ad8d-168">If you are using this article as an exercise, you can use the following example values:</span><span class="sxs-lookup"><span data-stu-id="3ad8d-168">If you are using this article as an exercise, you can use the following example values:</span></span>

<span data-ttu-id="3ad8d-169">**Values for TestVNet1**</span><span class="sxs-lookup"><span data-stu-id="3ad8d-169">**Values for TestVNet1**</span></span>

<span data-ttu-id="3ad8d-170">Name: TestVNet1</span><span class="sxs-lookup"><span data-stu-id="3ad8d-170">Name: TestVNet1</span></span><br>
<span data-ttu-id="3ad8d-171">Address space: 10.11.0.0/16, 10.12.0.0/16 (optional)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-171">Address space: 10.11.0.0/16, 10.12.0.0/16 (optional)</span></span><br>
<span data-ttu-id="3ad8d-172">Subnet name: default</span><span class="sxs-lookup"><span data-stu-id="3ad8d-172">Subnet name: default</span></span><br>
<span data-ttu-id="3ad8d-173">Subnet address range: 10.11.0.1/24</span><span class="sxs-lookup"><span data-stu-id="3ad8d-173">Subnet address range: 10.11.0.1/24</span></span><br>
<span data-ttu-id="3ad8d-174">Resource group: ClassicRG</span><span class="sxs-lookup"><span data-stu-id="3ad8d-174">Resource group: ClassicRG</span></span><br>
<span data-ttu-id="3ad8d-175">Location: East US</span><span class="sxs-lookup"><span data-stu-id="3ad8d-175">Location: East US</span></span><br>
<span data-ttu-id="3ad8d-176">GatewaySubnet: 10.11.1.0/27</span><span class="sxs-lookup"><span data-stu-id="3ad8d-176">GatewaySubnet: 10.11.1.0/27</span></span>

<span data-ttu-id="3ad8d-177">**Values for TestVNet4**</span><span class="sxs-lookup"><span data-stu-id="3ad8d-177">**Values for TestVNet4**</span></span>

<span data-ttu-id="3ad8d-178">Name: TestVNet4</span><span class="sxs-lookup"><span data-stu-id="3ad8d-178">Name: TestVNet4</span></span><br>
<span data-ttu-id="3ad8d-179">Address space: 10.41.0.0/16, 10.42.0.0/16 (optional)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-179">Address space: 10.41.0.0/16, 10.42.0.0/16 (optional)</span></span><br>
<span data-ttu-id="3ad8d-180">Subnet name: default</span><span class="sxs-lookup"><span data-stu-id="3ad8d-180">Subnet name: default</span></span><br>
<span data-ttu-id="3ad8d-181">Subnet address range: 10.41.0.1/24</span><span class="sxs-lookup"><span data-stu-id="3ad8d-181">Subnet address range: 10.41.0.1/24</span></span><br>
<span data-ttu-id="3ad8d-182">Resource group: ClassicRG</span><span class="sxs-lookup"><span data-stu-id="3ad8d-182">Resource group: ClassicRG</span></span><br>
<span data-ttu-id="3ad8d-183">Location: West US</span><span class="sxs-lookup"><span data-stu-id="3ad8d-183">Location: West US</span></span><br>
<span data-ttu-id="3ad8d-184">GatewaySubnet: 10.41.1.0/27</span><span class="sxs-lookup"><span data-stu-id="3ad8d-184">GatewaySubnet: 10.41.1.0/27</span></span>

<span data-ttu-id="3ad8d-185">**When creating your VNets, keep in mind the following settings:**</span><span class="sxs-lookup"><span data-stu-id="3ad8d-185">**When creating your VNets, keep in mind the following settings:**</span></span>

* <span data-ttu-id="3ad8d-186">**Virtual Network Address Spaces** – On the Virtual Network Address Spaces page, specify the address range that you want to use for your virtual network.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-186">**Virtual Network Address Spaces** – On the Virtual Network Address Spaces page, specify the address range that you want to use for your virtual network.</span></span> <span data-ttu-id="3ad8d-187">These are the dynamic IP addresses that will be assigned to the VMs and other role instances that you deploy to this virtual network.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-187">These are the dynamic IP addresses that will be assigned to the VMs and other role instances that you deploy to this virtual network.</span></span><br><span data-ttu-id="3ad8d-188">The address spaces you select cannot overlap with the address spaces for any of the other VNets or on-premises locations that this VNet will connect to.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-188">The address spaces you select cannot overlap with the address spaces for any of the other VNets or on-premises locations that this VNet will connect to.</span></span>

* <span data-ttu-id="3ad8d-189">**Location** – When you create a virtual network, you associate it with an Azure location (region).</span><span class="sxs-lookup"><span data-stu-id="3ad8d-189">**Location** – When you create a virtual network, you associate it with an Azure location (region).</span></span> <span data-ttu-id="3ad8d-190">For example, if you want your VMs that are deployed to your virtual network to be physically located in West US, select that location.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-190">For example, if you want your VMs that are deployed to your virtual network to be physically located in West US, select that location.</span></span> <span data-ttu-id="3ad8d-191">You can’t change the location associated with your virtual network after you create it.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-191">You can’t change the location associated with your virtual network after you create it.</span></span>

<span data-ttu-id="3ad8d-192">**After creating your VNets, you can add the following settings:**</span><span class="sxs-lookup"><span data-stu-id="3ad8d-192">**After creating your VNets, you can add the following settings:**</span></span>

* <span data-ttu-id="3ad8d-193">**Address space** – Additional address space is not required for this configuration, but you can add additional address space after creating the VNet.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-193">**Address space** – Additional address space is not required for this configuration, but you can add additional address space after creating the VNet.</span></span>

* <span data-ttu-id="3ad8d-194">**Subnets** – Additional subnets are not required for this configuration, but you might want to have your VMs in a subnet that is separate from your other role instances.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-194">**Subnets** – Additional subnets are not required for this configuration, but you might want to have your VMs in a subnet that is separate from your other role instances.</span></span>

* <span data-ttu-id="3ad8d-195">**DNS servers** – Enter the DNS server name and IP address.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-195">**DNS servers** – Enter the DNS server name and IP address.</span></span> <span data-ttu-id="3ad8d-196">This setting does not create a DNS server.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-196">This setting does not create a DNS server.</span></span> <span data-ttu-id="3ad8d-197">It allows you to specify the DNS servers that you want to use for name resolution for this virtual network.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-197">It allows you to specify the DNS servers that you want to use for name resolution for this virtual network.</span></span>


<span data-ttu-id="3ad8d-198">In this section, you configure the connection type, the local site, and create the gateway.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-198">In this section, you configure the connection type, the local site, and create the gateway.</span></span> 

## <a name="localsite"></a><span data-ttu-id="3ad8d-199">Step 3 - Configure the local site</span><span class="sxs-lookup"><span data-stu-id="3ad8d-199">Step 3 - Configure the local site</span></span>

<span data-ttu-id="3ad8d-200">Azure uses the settings specified in each local network site to determine how to route traffic between the VNets.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-200">Azure uses the settings specified in each local network site to determine how to route traffic between the VNets.</span></span> <span data-ttu-id="3ad8d-201">Each VNet must point to the respective local network that you want to route traffic to.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-201">Each VNet must point to the respective local network that you want to route traffic to.</span></span> <span data-ttu-id="3ad8d-202">You determine the name you want to use to refer to each local network site.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-202">You determine the name you want to use to refer to each local network site.</span></span> <span data-ttu-id="3ad8d-203">It's best to use something descriptive.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-203">It's best to use something descriptive.</span></span>

<span data-ttu-id="3ad8d-204">For example, TestVNet1 connects to a local network site that you create named 'VNet4Local'.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-204">For example, TestVNet1 connects to a local network site that you create named 'VNet4Local'.</span></span> <span data-ttu-id="3ad8d-205">The settings for VNet4Local contain the address prefixes for TestVNet4.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-205">The settings for VNet4Local contain the address prefixes for TestVNet4.</span></span> 

<span data-ttu-id="3ad8d-206">The local site for each VNet is the other VNet.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-206">The local site for each VNet is the other VNet.</span></span> <span data-ttu-id="3ad8d-207">The following example values are used for our configuration:</span><span class="sxs-lookup"><span data-stu-id="3ad8d-207">The following example values are used for our configuration:</span></span>

| <span data-ttu-id="3ad8d-208">Virtual Network</span><span class="sxs-lookup"><span data-stu-id="3ad8d-208">Virtual Network</span></span> | <span data-ttu-id="3ad8d-209">Address Space</span><span class="sxs-lookup"><span data-stu-id="3ad8d-209">Address Space</span></span> | <span data-ttu-id="3ad8d-210">Region</span><span class="sxs-lookup"><span data-stu-id="3ad8d-210">Region</span></span> | <span data-ttu-id="3ad8d-211">Connects to local network site</span><span class="sxs-lookup"><span data-stu-id="3ad8d-211">Connects to local network site</span></span> |
|:--- |:--- |:--- |:--- |
| <span data-ttu-id="3ad8d-212">TestVNet1</span><span class="sxs-lookup"><span data-stu-id="3ad8d-212">TestVNet1</span></span> |<span data-ttu-id="3ad8d-213">TestVNet1</span><span class="sxs-lookup"><span data-stu-id="3ad8d-213">TestVNet1</span></span><br><span data-ttu-id="3ad8d-214">(10.11.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-214">(10.11.0.0/16)</span></span><br><span data-ttu-id="3ad8d-215">(10.12.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-215">(10.12.0.0/16)</span></span> |<span data-ttu-id="3ad8d-216">East US</span><span class="sxs-lookup"><span data-stu-id="3ad8d-216">East US</span></span> |<span data-ttu-id="3ad8d-217">VNet4Local</span><span class="sxs-lookup"><span data-stu-id="3ad8d-217">VNet4Local</span></span><br><span data-ttu-id="3ad8d-218">(10.41.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-218">(10.41.0.0/16)</span></span><br><span data-ttu-id="3ad8d-219">(10.42.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-219">(10.42.0.0/16)</span></span> |
| <span data-ttu-id="3ad8d-220">TestVNet4</span><span class="sxs-lookup"><span data-stu-id="3ad8d-220">TestVNet4</span></span> |<span data-ttu-id="3ad8d-221">TestVNet4</span><span class="sxs-lookup"><span data-stu-id="3ad8d-221">TestVNet4</span></span><br><span data-ttu-id="3ad8d-222">(10.41.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-222">(10.41.0.0/16)</span></span><br><span data-ttu-id="3ad8d-223">(10.42.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-223">(10.42.0.0/16)</span></span> |<span data-ttu-id="3ad8d-224">West US</span><span class="sxs-lookup"><span data-stu-id="3ad8d-224">West US</span></span> |<span data-ttu-id="3ad8d-225">VNet1Local</span><span class="sxs-lookup"><span data-stu-id="3ad8d-225">VNet1Local</span></span><br><span data-ttu-id="3ad8d-226">(10.11.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-226">(10.11.0.0/16)</span></span><br><span data-ttu-id="3ad8d-227">(10.12.0.0/16)</span><span class="sxs-lookup"><span data-stu-id="3ad8d-227">(10.12.0.0/16)</span></span> |

1. <span data-ttu-id="3ad8d-228">Locate TestVNet1 in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-228">Locate TestVNet1 in the Azure portal.</span></span> <span data-ttu-id="3ad8d-229">In the **VPN connections** section of the blade, click **Gateway**.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-229">In the **VPN connections** section of the blade, click **Gateway**.</span></span>
 
    ![No gateway](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-howto-vnet-vnet-portal-classic/nogateway.png)
2. <span data-ttu-id="3ad8d-231">On the **New VPN Connection** page, select **Site-to-Site**.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-231">On the **New VPN Connection** page, select **Site-to-Site**.</span></span>
3. <span data-ttu-id="3ad8d-232">Click **Local site** to open the Local site page and configure the settings.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-232">Click **Local site** to open the Local site page and configure the settings.</span></span>
4. <span data-ttu-id="3ad8d-233">On the **Local site** page, name your local site.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-233">On the **Local site** page, name your local site.</span></span> <span data-ttu-id="3ad8d-234">In our example, we name the local site 'VNet4Local'.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-234">In our example, we name the local site 'VNet4Local'.</span></span> 
5. <span data-ttu-id="3ad8d-235">For **VPN gateway IP address**, you can use any IP address that you want, as long as it's in a valid format.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-235">For **VPN gateway IP address**, you can use any IP address that you want, as long as it's in a valid format.</span></span> <span data-ttu-id="3ad8d-236">Typically, you’d use the actual external IP address for a VPN device.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-236">Typically, you’d use the actual external IP address for a VPN device.</span></span> <span data-ttu-id="3ad8d-237">But, for a classic VNet-to-VNet configuration, you use the public IP address that is assigned to the gateway for your VNet.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-237">But, for a classic VNet-to-VNet configuration, you use the public IP address that is assigned to the gateway for your VNet.</span></span> <span data-ttu-id="3ad8d-238">Given that you’ve not yet created the virtual network gateway, you specify any valid public IP address as a placeholder.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-238">Given that you’ve not yet created the virtual network gateway, you specify any valid public IP address as a placeholder.</span></span><br><span data-ttu-id="3ad8d-239">Don't leave this blank - it's not optional for this configuration.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-239">Don't leave this blank - it's not optional for this configuration.</span></span> <span data-ttu-id="3ad8d-240">In a later step, you go back into these settings and configure them with the corresponding virtual network gateway IP addresses once Azure generates it.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-240">In a later step, you go back into these settings and configure them with the corresponding virtual network gateway IP addresses once Azure generates it.</span></span> 
6. <span data-ttu-id="3ad8d-241">For **Client Address Space**, use the address space of the other VNet.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-241">For **Client Address Space**, use the address space of the other VNet.</span></span> <span data-ttu-id="3ad8d-242">Refer to your planning example.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-242">Refer to your planning example.</span></span> <span data-ttu-id="3ad8d-243">Click **OK** to save your settings and return back to the **New VPN Connection** blade.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-243">Click **OK** to save your settings and return back to the **New VPN Connection** blade.</span></span>

    ![local site](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-howto-vnet-vnet-portal-classic/localsite.png)

## <a name="gw"></a><span data-ttu-id="3ad8d-245">Step 4 - Create the virtual network gateway</span><span class="sxs-lookup"><span data-stu-id="3ad8d-245">Step 4 - Create the virtual network gateway</span></span>

<span data-ttu-id="3ad8d-246">Each virtual network must have a virtual network gateway.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-246">Each virtual network must have a virtual network gateway.</span></span> <span data-ttu-id="3ad8d-247">The virtual network gateway routes and encrypts traffic.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-247">The virtual network gateway routes and encrypts traffic.</span></span>

1. <span data-ttu-id="3ad8d-248">On the **New VPN Connection** blade, select the checkbox **Create gateway immediately**.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-248">On the **New VPN Connection** blade, select the checkbox **Create gateway immediately**.</span></span>
2. <span data-ttu-id="3ad8d-249">Click **Subnet, size and routing type**.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-249">Click **Subnet, size and routing type**.</span></span> <span data-ttu-id="3ad8d-250">On the **Gateway configuration** blade, click **Subnet**.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-250">On the **Gateway configuration** blade, click **Subnet**.</span></span>
3. <span data-ttu-id="3ad8d-251">The gateway subnet name is filled in automatically with the required name 'GatewaySubnet'.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-251">The gateway subnet name is filled in automatically with the required name 'GatewaySubnet'.</span></span> <span data-ttu-id="3ad8d-252">The **Address range** contains the IP addresses that are allocated to the VPN gateway services.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-252">The **Address range** contains the IP addresses that are allocated to the VPN gateway services.</span></span> <span data-ttu-id="3ad8d-253">Some configurations allow a gateway subnet of /29, but it's best to use a /28 or /27 to accommodate future configurations that may require more IP addresses for the gateway services.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-253">Some configurations allow a gateway subnet of /29, but it's best to use a /28 or /27 to accommodate future configurations that may require more IP addresses for the gateway services.</span></span> <span data-ttu-id="3ad8d-254">In our example settings, we use 10.11.1.0/27.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-254">In our example settings, we use 10.11.1.0/27.</span></span> <span data-ttu-id="3ad8d-255">Adjust the address space, then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-255">Adjust the address space, then click **OK**.</span></span>
4. <span data-ttu-id="3ad8d-256">Configure the **Gateway Size**.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-256">Configure the **Gateway Size**.</span></span> <span data-ttu-id="3ad8d-257">This setting refers to the [Gateway SKU](vpn-gateway-about-vpngateways.md#gateway-skus).</span><span class="sxs-lookup"><span data-stu-id="3ad8d-257">This setting refers to the [Gateway SKU](vpn-gateway-about-vpngateways.md#gateway-skus).</span></span>
5. <span data-ttu-id="3ad8d-258">Configure the **Routing Type**.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-258">Configure the **Routing Type**.</span></span> <span data-ttu-id="3ad8d-259">The routing type for this configuration must be **Dynamic**.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-259">The routing type for this configuration must be **Dynamic**.</span></span> <span data-ttu-id="3ad8d-260">You can't change the routing type later unless you tear down the gateway and create a new one.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-260">You can't change the routing type later unless you tear down the gateway and create a new one.</span></span>
6. <span data-ttu-id="3ad8d-261">Click **OK**.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-261">Click **OK**.</span></span> 
7. <span data-ttu-id="3ad8d-262">On the **New VPN Connection** blade, click **OK** to begin creating the virtual network gateway.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-262">On the **New VPN Connection** blade, click **OK** to begin creating the virtual network gateway.</span></span> <span data-ttu-id="3ad8d-263">Creating a gateway can often take 45 minutes or more, depending on the selected gateway SKU.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-263">Creating a gateway can often take 45 minutes or more, depending on the selected gateway SKU.</span></span>

## <a name="step-5---configure-testvnet4-settings"></a><span data-ttu-id="3ad8d-264">Step 5 - Configure TestVNet4 settings</span><span class="sxs-lookup"><span data-stu-id="3ad8d-264">Step 5 - Configure TestVNet4 settings</span></span>

<span data-ttu-id="3ad8d-265">Repeat the steps to [Create a local site](#localsite) and [Create the virtual network gateway](#gw) to configure TestVNet4, substituting the values when necessary.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-265">Repeat the steps to [Create a local site](#localsite) and [Create the virtual network gateway](#gw) to configure TestVNet4, substituting the values when necessary.</span></span> <span data-ttu-id="3ad8d-266">If you are doing this as an exercise, use the [Example values](#vnetvalues).</span><span class="sxs-lookup"><span data-stu-id="3ad8d-266">If you are doing this as an exercise, use the [Example values](#vnetvalues).</span></span>

## <a name="step-6---update-the-local-sites"></a><span data-ttu-id="3ad8d-267">Step 6 - Update the local sites</span><span class="sxs-lookup"><span data-stu-id="3ad8d-267">Step 6 - Update the local sites</span></span>

<span data-ttu-id="3ad8d-268">After your virtual network gateways have been created for both VNets, you must adjust the local sites **VPN gateway IP address** values.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-268">After your virtual network gateways have been created for both VNets, you must adjust the local sites **VPN gateway IP address** values.</span></span> 

|<span data-ttu-id="3ad8d-269">VNet name</span><span class="sxs-lookup"><span data-stu-id="3ad8d-269">VNet name</span></span>|<span data-ttu-id="3ad8d-270">Connected site</span><span class="sxs-lookup"><span data-stu-id="3ad8d-270">Connected site</span></span>|<span data-ttu-id="3ad8d-271">Gateway IP address</span><span class="sxs-lookup"><span data-stu-id="3ad8d-271">Gateway IP address</span></span>|
|:--- |:--- |:--- |
|<span data-ttu-id="3ad8d-272">TestVNet1</span><span class="sxs-lookup"><span data-stu-id="3ad8d-272">TestVNet1</span></span>|<span data-ttu-id="3ad8d-273">VNet4Local</span><span class="sxs-lookup"><span data-stu-id="3ad8d-273">VNet4Local</span></span>|<span data-ttu-id="3ad8d-274">VPN gateway IP address for TestVNet4</span><span class="sxs-lookup"><span data-stu-id="3ad8d-274">VPN gateway IP address for TestVNet4</span></span>|
|<span data-ttu-id="3ad8d-275">TestVNet4</span><span class="sxs-lookup"><span data-stu-id="3ad8d-275">TestVNet4</span></span>|<span data-ttu-id="3ad8d-276">VNet1Local</span><span class="sxs-lookup"><span data-stu-id="3ad8d-276">VNet1Local</span></span>|<span data-ttu-id="3ad8d-277">VPN gateway IP address for TestVNet1</span><span class="sxs-lookup"><span data-stu-id="3ad8d-277">VPN gateway IP address for TestVNet1</span></span>|

### <a name="part-1---get-the-virtual-network-gateway-public-ip-address"></a><span data-ttu-id="3ad8d-278">Part 1 - Get the virtual network gateway public IP address</span><span class="sxs-lookup"><span data-stu-id="3ad8d-278">Part 1 - Get the virtual network gateway public IP address</span></span>

1. <span data-ttu-id="3ad8d-279">Locate your virtual network in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-279">Locate your virtual network in the Azure portal.</span></span>
2. <span data-ttu-id="3ad8d-280">Click to open the VNet **Overview** blade.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-280">Click to open the VNet **Overview** blade.</span></span> <span data-ttu-id="3ad8d-281">On the blade, in **VPN connections**, you can view the IP address for your virtual network gateway.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-281">On the blade, in **VPN connections**, you can view the IP address for your virtual network gateway.</span></span>

    ![Public IP](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-howto-vnet-vnet-portal-classic/publicIP.png)
3. <span data-ttu-id="3ad8d-283">Copy the IP address.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-283">Copy the IP address.</span></span> <span data-ttu-id="3ad8d-284">You will use it in the next section.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-284">You will use it in the next section.</span></span>
4. <span data-ttu-id="3ad8d-285">Repeat these steps for TestVNet4</span><span class="sxs-lookup"><span data-stu-id="3ad8d-285">Repeat these steps for TestVNet4</span></span>

### <a name="part-2---modify-the-local-sites"></a><span data-ttu-id="3ad8d-286">Part 2 - Modify the local sites</span><span class="sxs-lookup"><span data-stu-id="3ad8d-286">Part 2 - Modify the local sites</span></span>

1. <span data-ttu-id="3ad8d-287">Locate your virtual network in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-287">Locate your virtual network in the Azure portal.</span></span>
2. <span data-ttu-id="3ad8d-288">On the VNet **Overview** blade, click the local site.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-288">On the VNet **Overview** blade, click the local site.</span></span>

    ![Local site created](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-howto-vnet-vnet-portal-classic/local.png)
3. <span data-ttu-id="3ad8d-290">On the **Site-to-Site VPN Connections** blade, click the name of the local site that you want to modify.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-290">On the **Site-to-Site VPN Connections** blade, click the name of the local site that you want to modify.</span></span>

    ![Open local site](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-howto-vnet-vnet-portal-classic/openlocal.png)
4. <span data-ttu-id="3ad8d-292">Click the **Local site** that you want to modify.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-292">Click the **Local site** that you want to modify.</span></span>

    ![modify site](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-howto-vnet-vnet-portal-classic/connections.png)
5. <span data-ttu-id="3ad8d-294">Update the **VPN gateway IP address** and click **OK** to save the settings.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-294">Update the **VPN gateway IP address** and click **OK** to save the settings.</span></span>

    ![gateway IP](https://docstestmedia1.blob.core.windows.net/azure-media/articles/vpn-gateway/media/vpn-gateway-howto-vnet-vnet-portal-classic/gwupdate.png)
6. <span data-ttu-id="3ad8d-296">Close the other blades.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-296">Close the other blades.</span></span>
7. <span data-ttu-id="3ad8d-297">Repeat these steps for TestVNet4.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-297">Repeat these steps for TestVNet4.</span></span>


## <a name="step-7---retrieve-values-from-the-network-configuration-file"></a><span data-ttu-id="3ad8d-298">Step 7 - Retrieve values from the network configuration file</span><span class="sxs-lookup"><span data-stu-id="3ad8d-298">Step 7 - Retrieve values from the network configuration file</span></span>

<span data-ttu-id="3ad8d-299">When you create classic VNets in the Azure portal, the name that you view is not the full name that you use for PowerShell.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-299">When you create classic VNets in the Azure portal, the name that you view is not the full name that you use for PowerShell.</span></span> <span data-ttu-id="3ad8d-300">For example, a VNet that appears to be named **TestVNet1** in the portal, may have a much longer name in the network configuration file.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-300">For example, a VNet that appears to be named **TestVNet1** in the portal, may have a much longer name in the network configuration file.</span></span> <span data-ttu-id="3ad8d-301">The name might look something like: **Group ClassicRG TestVNet1**.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-301">The name might look something like: **Group ClassicRG TestVNet1**.</span></span> <span data-ttu-id="3ad8d-302">When you create your connections, it's important to use the values that you see in the network configuration file.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-302">When you create your connections, it's important to use the values that you see in the network configuration file.</span></span> 

<span data-ttu-id="3ad8d-303">In the following steps, you will connect to your Azure account and download and view the network configuration file to obtain the values that are required for your connections.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-303">In the following steps, you will connect to your Azure account and download and view the network configuration file to obtain the values that are required for your connections.</span></span>

1. <span data-ttu-id="3ad8d-304">Download and install the latest version of the Azure Service Management (SM) PowerShell cmdlets.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-304">Download and install the latest version of the Azure Service Management (SM) PowerShell cmdlets.</span></span> <span data-ttu-id="3ad8d-305">For more information, see [How to install and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="3ad8d-305">For more information, see [How to install and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

2. <span data-ttu-id="3ad8d-306">Open your PowerShell console with elevated rights and connect to your account.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-306">Open your PowerShell console with elevated rights and connect to your account.</span></span> <span data-ttu-id="3ad8d-307">Use the following example to help you connect:</span><span class="sxs-lookup"><span data-stu-id="3ad8d-307">Use the following example to help you connect:</span></span>

        Login-AzureRmAccount

    <span data-ttu-id="3ad8d-308">Check the subscriptions for the account.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-308">Check the subscriptions for the account.</span></span>

        Get-AzureRmSubscription

    <span data-ttu-id="3ad8d-309">If you have more than one subscription, select the subscription that you want to use.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-309">If you have more than one subscription, select the subscription that you want to use.</span></span>

        Select-AzureRmSubscription -SubscriptionName "Replace_with_your_subscription_name"

    <span data-ttu-id="3ad8d-310">Next, use the following cmdlet to add your Azure subscription to PowerShell for the classic deployment model.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-310">Next, use the following cmdlet to add your Azure subscription to PowerShell for the classic deployment model.</span></span>

        Add-AzureAccount

3. <span data-ttu-id="3ad8d-311">Export and view the network configuration file.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-311">Export and view the network configuration file.</span></span> <span data-ttu-id="3ad8d-312">Create a directory on your computer and then export the network configuration file to the directory.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-312">Create a directory on your computer and then export the network configuration file to the directory.</span></span> <span data-ttu-id="3ad8d-313">In this example, the network configuration file is exported to **C:\AzureNet**.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-313">In this example, the network configuration file is exported to **C:\AzureNet**.</span></span>

        Get-AzureVNetConfig -ExportToFile C:\AzureNet\NetworkConfig.xml
4. <span data-ttu-id="3ad8d-314">Open the file with a text editor and view the names for your VNets and sites.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-314">Open the file with a text editor and view the names for your VNets and sites.</span></span> <span data-ttu-id="3ad8d-315">These will be the name you use when you create your connections.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-315">These will be the name you use when you create your connections.</span></span><br><span data-ttu-id="3ad8d-316">VNet names are listed as **VirtualNetworkSite name =**</span><span class="sxs-lookup"><span data-stu-id="3ad8d-316">VNet names are listed as **VirtualNetworkSite name =**</span></span><br><span data-ttu-id="3ad8d-317">Site names are listed as **LocalNetworkSiteRef name =**</span><span class="sxs-lookup"><span data-stu-id="3ad8d-317">Site names are listed as **LocalNetworkSiteRef name =**</span></span>

## <a name="step-8---create-the-vpn-gateway-connections"></a><span data-ttu-id="3ad8d-318">Step 8 - Create the VPN gateway connections</span><span class="sxs-lookup"><span data-stu-id="3ad8d-318">Step 8 - Create the VPN gateway connections</span></span>

<span data-ttu-id="3ad8d-319">When all the previous steps have been completed, you can set the IPsec/IKE pre-shared keys and create the connection.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-319">When all the previous steps have been completed, you can set the IPsec/IKE pre-shared keys and create the connection.</span></span> <span data-ttu-id="3ad8d-320">This set of steps uses PowerShell.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-320">This set of steps uses PowerShell.</span></span> <span data-ttu-id="3ad8d-321">VNet-to-VNet connections for the classic deployment model cannot be configured in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-321">VNet-to-VNet connections for the classic deployment model cannot be configured in the Azure portal.</span></span>

<span data-ttu-id="3ad8d-322">In the examples, notice that the shared key is exactly the same.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-322">In the examples, notice that the shared key is exactly the same.</span></span> <span data-ttu-id="3ad8d-323">The shared key must always match.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-323">The shared key must always match.</span></span> <span data-ttu-id="3ad8d-324">Be sure to replace the values in these examples with the exact names for your VNets and Local Network Sites.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-324">Be sure to replace the values in these examples with the exact names for your VNets and Local Network Sites.</span></span>

1. <span data-ttu-id="3ad8d-325">Create the TestVNet1 to TestVNet4 connection.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-325">Create the TestVNet1 to TestVNet4 connection.</span></span>

        Set-AzureVNetGatewayKey -VNetName 'Group ClassicRG TestVNet1' `
        -LocalNetworkSiteName '17BE5E2C_VNet4Local' -SharedKey A1b2C3D4

2. <span data-ttu-id="3ad8d-326">Create the TestVNet4 to TestVNet1 connection.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-326">Create the TestVNet4 to TestVNet1 connection.</span></span>

        Set-AzureVNetGatewayKey -VNetName 'Group ClassicRG TestVNet4' `
        -LocalNetworkSiteName 'F7F7BFC7_VNet1Local' -SharedKey A1b2C3D4

3. <span data-ttu-id="3ad8d-327">Wait for the connections to initialize.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-327">Wait for the connections to initialize.</span></span> <span data-ttu-id="3ad8d-328">Once the gateway has initialized, the Status is 'Successful'.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-328">Once the gateway has initialized, the Status is 'Successful'.</span></span>


        Error          :
        HttpStatusCode : OK
        Id             : 
        Status         : Successful
        RequestId      : 
        StatusCode     : OK

## <a name="faq"></a><span data-ttu-id="3ad8d-329">VNet-to-VNet considerations for classic VNets</span><span class="sxs-lookup"><span data-stu-id="3ad8d-329">VNet-to-VNet considerations for classic VNets</span></span>
* <span data-ttu-id="3ad8d-330">The virtual networks can be in the same or different subscriptions.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-330">The virtual networks can be in the same or different subscriptions.</span></span>
* <span data-ttu-id="3ad8d-331">The virtual networks can be in the same or different Azure regions (locations).</span><span class="sxs-lookup"><span data-stu-id="3ad8d-331">The virtual networks can be in the same or different Azure regions (locations).</span></span>
* <span data-ttu-id="3ad8d-332">A cloud service or a load balancing endpoint can't span across virtual networks, even if they are connected together.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-332">A cloud service or a load balancing endpoint can't span across virtual networks, even if they are connected together.</span></span>
* <span data-ttu-id="3ad8d-333">Connecting multiple virtual networks together doesn't require any VPN devices.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-333">Connecting multiple virtual networks together doesn't require any VPN devices.</span></span>
* <span data-ttu-id="3ad8d-334">VNet-to-VNet supports connecting Azure Virtual Networks.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-334">VNet-to-VNet supports connecting Azure Virtual Networks.</span></span> <span data-ttu-id="3ad8d-335">It does not support connecting virtual machines or cloud services that are not deployed to a virtual network.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-335">It does not support connecting virtual machines or cloud services that are not deployed to a virtual network.</span></span>
* <span data-ttu-id="3ad8d-336">VNet-to-VNet requires dynamic routing gateways.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-336">VNet-to-VNet requires dynamic routing gateways.</span></span> <span data-ttu-id="3ad8d-337">Azure static routing gateways are not supported.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-337">Azure static routing gateways are not supported.</span></span>
* <span data-ttu-id="3ad8d-338">Virtual network connectivity can be used simultaneously with multi-site VPNs.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-338">Virtual network connectivity can be used simultaneously with multi-site VPNs.</span></span> <span data-ttu-id="3ad8d-339">There is a maximum of 10 VPN tunnels for a virtual network VPN gateway connecting to either other virtual networks, or on-premises sites.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-339">There is a maximum of 10 VPN tunnels for a virtual network VPN gateway connecting to either other virtual networks, or on-premises sites.</span></span>
* <span data-ttu-id="3ad8d-340">The address spaces of the virtual networks and on-premises local network sites must not overlap.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-340">The address spaces of the virtual networks and on-premises local network sites must not overlap.</span></span> <span data-ttu-id="3ad8d-341">Overlapping address spaces will cause the creation of virtual networks or uploading netcfg configuration files to fail.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-341">Overlapping address spaces will cause the creation of virtual networks or uploading netcfg configuration files to fail.</span></span>
* <span data-ttu-id="3ad8d-342">Redundant tunnels between a pair of virtual networks are not supported.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-342">Redundant tunnels between a pair of virtual networks are not supported.</span></span>
* <span data-ttu-id="3ad8d-343">All VPN tunnels for the VNet, including P2S VPNs, share the available bandwidth for the VPN gateway, and the same VPN gateway uptime SLA in Azure.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-343">All VPN tunnels for the VNet, including P2S VPNs, share the available bandwidth for the VPN gateway, and the same VPN gateway uptime SLA in Azure.</span></span>
* <span data-ttu-id="3ad8d-344">VNet-to-VNet traffic travels across the Azure backbone.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-344">VNet-to-VNet traffic travels across the Azure backbone.</span></span>




## <a name="next-steps"></a><span data-ttu-id="3ad8d-345">Next steps</span><span class="sxs-lookup"><span data-stu-id="3ad8d-345">Next steps</span></span>
<span data-ttu-id="3ad8d-346">Verify your connections.</span><span class="sxs-lookup"><span data-stu-id="3ad8d-346">Verify your connections.</span></span> <span data-ttu-id="3ad8d-347">See [Verify a VPN Gateway connection](vpn-gateway-verify-connection-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="3ad8d-347">See [Verify a VPN Gateway connection](vpn-gateway-verify-connection-resource-manager.md).</span></span>










