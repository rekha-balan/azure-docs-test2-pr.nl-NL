---
title: Copying blobs from a storage account into an Azure Media Services asset | Microsoft Docs
description: This topic shows how to copy an existing blob into a Media Services Asset. The example uses Azure Media Services .NET SDK Extensions.
services: media-services
documentationcenter: ''
author: Juliako
manager: erikre
editor: ''
ms.assetid: 6a63823f-f3c9-424c-91b8-566f70bec346
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: ne
ms.topic: article
ms.date: 01/31/2017
ms.author: juliako
ms.openlocfilehash: 14bdbe593d8c6ec5297ce37ce57b759deb533cec
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44552028"
---
# <a name="copying-existing-blobs-into-a-media-services-asset"></a><span data-ttu-id="b04ea-104">Copying existing blobs into a Media Services Asset</span><span class="sxs-lookup"><span data-stu-id="b04ea-104">Copying existing blobs into a Media Services Asset</span></span>
<span data-ttu-id="b04ea-105">This topic shows how to copy blobs from a storage account into a new Azure Media Services (AMS) asset using [Azure Media Services .NET SDK Extensions](https://github.com/Azure/azure-sdk-for-media-services-extensions/).</span><span class="sxs-lookup"><span data-stu-id="b04ea-105">This topic shows how to copy blobs from a storage account into a new Azure Media Services (AMS) asset using [Azure Media Services .NET SDK Extensions](https://github.com/Azure/azure-sdk-for-media-services-extensions/).</span></span>

<span data-ttu-id="b04ea-106">The extension methods works with:</span><span class="sxs-lookup"><span data-stu-id="b04ea-106">The extension methods works with:</span></span>

- <span data-ttu-id="b04ea-107">Regular assets.</span><span class="sxs-lookup"><span data-stu-id="b04ea-107">Regular assets.</span></span>
- <span data-ttu-id="b04ea-108">Live archive assets (FragBlob format).</span><span class="sxs-lookup"><span data-stu-id="b04ea-108">Live archive assets (FragBlob format).</span></span>
- <span data-ttu-id="b04ea-109">Source and destination assets belonging to different Media Services accounts (even across different data centers).</span><span class="sxs-lookup"><span data-stu-id="b04ea-109">Source and destination assets belonging to different Media Services accounts (even across different data centers).</span></span> <span data-ttu-id="b04ea-110">However, there may be charges incurred by doing so.</span><span class="sxs-lookup"><span data-stu-id="b04ea-110">However, there may be charges incurred by doing so.</span></span> <span data-ttu-id="b04ea-111">For more information about pricing, see [Data Transfers](https://azure.microsoft.com/pricing/#header-11).</span><span class="sxs-lookup"><span data-stu-id="b04ea-111">For more information about pricing, see [Data Transfers](https://azure.microsoft.com/pricing/#header-11).</span></span>

> [!NOTE]
> <span data-ttu-id="b04ea-112">You should not attempt to change the contents of blob containers that were generated by Media Services without using Media Service APIs.</span><span class="sxs-lookup"><span data-stu-id="b04ea-112">You should not attempt to change the contents of blob containers that were generated by Media Services without using Media Service APIs.</span></span>
> 

<span data-ttu-id="b04ea-113">The topic shows two code samples:</span><span class="sxs-lookup"><span data-stu-id="b04ea-113">The topic shows two code samples:</span></span>

1. <span data-ttu-id="b04ea-114">Copy blobs from an asset in one AMS account into a new asset in another AMS account.</span><span class="sxs-lookup"><span data-stu-id="b04ea-114">Copy blobs from an asset in one AMS account into a new asset in another AMS account.</span></span>
2. <span data-ttu-id="b04ea-115">Copy blobs from some storage account into a new asset in an AMS account.</span><span class="sxs-lookup"><span data-stu-id="b04ea-115">Copy blobs from some storage account into a new asset in an AMS account.</span></span>

## <a name="copy-blobs-between-two-ams-accounts"></a><span data-ttu-id="b04ea-116">Copy blobs between two AMS accounts</span><span class="sxs-lookup"><span data-stu-id="b04ea-116">Copy blobs between two AMS accounts</span></span>  

### <a name="prerequisites"></a><span data-ttu-id="b04ea-117">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="b04ea-117">Prerequisites</span></span>

<span data-ttu-id="b04ea-118">Two Media Services accounts.</span><span class="sxs-lookup"><span data-stu-id="b04ea-118">Two Media Services accounts.</span></span> <span data-ttu-id="b04ea-119">See the topic [How to Create a Media Services Account](media-services-portal-create-account.md).</span><span class="sxs-lookup"><span data-stu-id="b04ea-119">See the topic [How to Create a Media Services Account](media-services-portal-create-account.md).</span></span>

### <a name="download-sample"></a><span data-ttu-id="b04ea-120">Download sample</span><span class="sxs-lookup"><span data-stu-id="b04ea-120">Download sample</span></span>
<span data-ttu-id="b04ea-121">You can follow the steps in this article or you can download a sample that contains the code described in this article from [here](https://azure.microsoft.com/documentation/samples/media-services-dotnet-copy-blob-into-asset/).</span><span class="sxs-lookup"><span data-stu-id="b04ea-121">You can follow the steps in this article or you can download a sample that contains the code described in this article from [here](https://azure.microsoft.com/documentation/samples/media-services-dotnet-copy-blob-into-asset/).</span></span>

### <a name="set-up-your-project"></a><span data-ttu-id="b04ea-122">Set up your project</span><span class="sxs-lookup"><span data-stu-id="b04ea-122">Set up your project</span></span>

1. <span data-ttu-id="b04ea-123">Use Visual Studio to create a new solution that contains the C# Console Application project.</span><span class="sxs-lookup"><span data-stu-id="b04ea-123">Use Visual Studio to create a new solution that contains the C# Console Application project.</span></span> 
3. <span data-ttu-id="b04ea-124">Use [NuGet](https://www.nuget.org/packages/windowsazure.mediaservices.extensions) to install and add Azure Media Services .NET SDK Extensions (windowsazure.mediaservices.extensions).</span><span class="sxs-lookup"><span data-stu-id="b04ea-124">Use [NuGet](https://www.nuget.org/packages/windowsazure.mediaservices.extensions) to install and add Azure Media Services .NET SDK Extensions (windowsazure.mediaservices.extensions).</span></span> <span data-ttu-id="b04ea-125">Installing this package, also installs Media Services .NET SDK and adds all other required dependencies.</span><span class="sxs-lookup"><span data-stu-id="b04ea-125">Installing this package, also installs Media Services .NET SDK and adds all other required dependencies.</span></span>
4. <span data-ttu-id="b04ea-126">Add other references that are required for this project: System.Configuration.</span><span class="sxs-lookup"><span data-stu-id="b04ea-126">Add other references that are required for this project: System.Configuration.</span></span>
6. <span data-ttu-id="b04ea-127">Add the appSettings section to the .config file and update the values based on your Media Services accounts, the destination storage account and the source asset ID.</span><span class="sxs-lookup"><span data-stu-id="b04ea-127">Add the appSettings section to the .config file and update the values based on your Media Services accounts, the destination storage account and the source asset ID.</span></span> 
   
        <appSettings>
              <add key="MediaServicesSourceAccountName" value="name"/>
              <add key="MediaServicesSourceAccountKey" value="key"/>
              <add key="MediaServicesDestAccountName" value="name"/>
              <add key="MediaServicesDestAccountKey" value="key"/>
              <add key="DestStorageAccountName" value="name"/>
              <add key="DestStorageAccountKey" value="key"/>
              <add key="SourceAssetID" value="nb:cid:UUID:assetID"/>       
        </appSettings>

### <a name="copy-blobs-from-an-asset-in-one-ams-account-into-an-asset-in-another-ams-account"></a><span data-ttu-id="b04ea-128">Copy blobs from an asset in one AMS account into an asset in another AMS account</span><span class="sxs-lookup"><span data-stu-id="b04ea-128">Copy blobs from an asset in one AMS account into an asset in another AMS account</span></span>

<span data-ttu-id="b04ea-129">The following code uses extension **IAsset.Copy** method to copy all files in the source asset into the destination asset using a single extension.</span><span class="sxs-lookup"><span data-stu-id="b04ea-129">The following code uses extension **IAsset.Copy** method to copy all files in the source asset into the destination asset using a single extension.</span></span> <span data-ttu-id="b04ea-130">There is an additional overload with async support.</span><span class="sxs-lookup"><span data-stu-id="b04ea-130">There is an additional overload with async support.</span></span>

    using System;
    using System.Linq;
    using System.Configuration;
    using Microsoft.WindowsAzure.MediaServices.Client;
    using Microsoft.WindowsAzure.Storage.Auth;
    
    namespace CopyExistingBlobsIntoAsset
    {
        class Program
        {
            static string _sourceAaccountName = ConfigurationManager.AppSettings["MediaServicesSourceAccountName"];
            static string _sourceAccountKey = ConfigurationManager.AppSettings["MediaServicesSourceAccountKey"];
            static string _destAccountName = ConfigurationManager.AppSettings["MediaServicesDestAccountName"];
            static string _destAccountKey = ConfigurationManager.AppSettings["MediaServicesDestAccountKey"];
            static string _destStorageAccountName = ConfigurationManager.AppSettings["DestStorageAccountName"];
            static string _destStorageAccountKey = ConfigurationManager.AppSettings["DestStorageAccountKey"];
            static string _sourceAssetID = ConfigurationManager.AppSettings["SourceAssetID"];
            
    
            private static CloudMediaContext _sourceContext = null;
            private static CloudMediaContext _destContext = null;
    
            static void Main(string[] args)
            {
                // Create the context for your source Media Services account.
    
                // Use the cached credentials to create CloudMediaContext.
                _sourceContext = new CloudMediaContext(new MediaServicesCredentials(
                    _sourceAaccountName,
                    _sourceAccountKey));

                // Create the context for your destination Media Services account.
                _destContext = new CloudMediaContext(new MediaServicesCredentials(
                    _destAccountName,
                    _destAccountKey));
    
                // Get the credentials of the default Storage account bound to your destination Media Services account.
                StorageCredentials destinationStorageCredentials =
                    new StorageCredentials(_destStorageAccountName, _destStorageAccountKey);
    
                // Get a reference to the source asset in the source context.
                IAsset sourceAsset = _sourceContext.Assets.Where(a => a.Id == _sourceAssetID).First();
    
                // Create an empty destination asset in the destination context.
                IAsset destinationAsset = _destContext.Assets.Create(sourceAsset.Name, AssetCreationOptions.None);
    
                // Copy the files in the source asset instance into the destination asset instance.
                // There is an additional overload with async support.
                sourceAsset.Copy(destinationAsset, destinationStorageCredentials);

                
            }
        }
    }


## <a name="copy-blobs-from-a-storage-account-into-an-ams-account"></a><span data-ttu-id="b04ea-131">Copy blobs from a storage account into an AMS account</span><span class="sxs-lookup"><span data-stu-id="b04ea-131">Copy blobs from a storage account into an AMS account</span></span> 

### <a name="prerequisites"></a><span data-ttu-id="b04ea-132">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="b04ea-132">Prerequisites</span></span>

- <span data-ttu-id="b04ea-133">One Storage account from which you want to copy blobs.</span><span class="sxs-lookup"><span data-stu-id="b04ea-133">One Storage account from which you want to copy blobs.</span></span>
- <span data-ttu-id="b04ea-134">One AMS account into which you want to copy blobs.</span><span class="sxs-lookup"><span data-stu-id="b04ea-134">One AMS account into which you want to copy blobs.</span></span>

### <a name="set-up-your-project"></a><span data-ttu-id="b04ea-135">Set up your project</span><span class="sxs-lookup"><span data-stu-id="b04ea-135">Set up your project</span></span>

1. <span data-ttu-id="b04ea-136">Use Visual Studio to create a new solution that contains the C# Console Application project.</span><span class="sxs-lookup"><span data-stu-id="b04ea-136">Use Visual Studio to create a new solution that contains the C# Console Application project.</span></span> 
3. <span data-ttu-id="b04ea-137">Use [NuGet](https://www.nuget.org/packages/windowsazure.mediaservices.extensions) to install and add Azure Media Services .NET SDK Extensions (windowsazure.mediaservices.extensions).</span><span class="sxs-lookup"><span data-stu-id="b04ea-137">Use [NuGet](https://www.nuget.org/packages/windowsazure.mediaservices.extensions) to install and add Azure Media Services .NET SDK Extensions (windowsazure.mediaservices.extensions).</span></span> <span data-ttu-id="b04ea-138">Installing this package, also installs Media Services .NET SDK and adds all other required dependencies.</span><span class="sxs-lookup"><span data-stu-id="b04ea-138">Installing this package, also installs Media Services .NET SDK and adds all other required dependencies.</span></span>
4. <span data-ttu-id="b04ea-139">Add other references that are required for this project: System.Configuration.</span><span class="sxs-lookup"><span data-stu-id="b04ea-139">Add other references that are required for this project: System.Configuration.</span></span>
6. <span data-ttu-id="b04ea-140">Add the appSettings section to the .config file and update the values based on your source storage and destination AMS accounts.</span><span class="sxs-lookup"><span data-stu-id="b04ea-140">Add the appSettings section to the .config file and update the values based on your source storage and destination AMS accounts.</span></span>
   
          <appSettings>
            <add key="MediaServicesAccountName" value="name" />
            <add key="MediaServicesAccountKey" value="key" />
            <add key="MediaServicesStorageAccountName" value="name" />
            <add key="MediaServicesStorageAccountKey" value="key" />
            <add key="SourceStorageAccountName" value="name" />
            <add key="SourceStorageAccountKey" value="key" />
          </appSettings>

### <a name="copy-blobs-from-some-storage-account-into-a-new-asset-in-a-ams-account"></a><span data-ttu-id="b04ea-141">Copy blobs from some storage account into a new asset in a AMS account</span><span class="sxs-lookup"><span data-stu-id="b04ea-141">Copy blobs from some storage account into a new asset in a AMS account</span></span>

<span data-ttu-id="b04ea-142">The following code copies blobs from a storage account into a Media Services asset.</span><span class="sxs-lookup"><span data-stu-id="b04ea-142">The following code copies blobs from a storage account into a Media Services asset.</span></span> 

>[!NOTE]
><span data-ttu-id="b04ea-143">There is a limit of 1,000,000 policies for different AMS policies (for example, for Locator policy or ContentKeyAuthorizationPolicy).</span><span class="sxs-lookup"><span data-stu-id="b04ea-143">There is a limit of 1,000,000 policies for different AMS policies (for example, for Locator policy or ContentKeyAuthorizationPolicy).</span></span> <span data-ttu-id="b04ea-144">You should use the same policy ID if you are always using the same days / access permissions, for example, policies for locators that are intended to remain in place for a long time (non-upload policies).</span><span class="sxs-lookup"><span data-stu-id="b04ea-144">You should use the same policy ID if you are always using the same days / access permissions, for example, policies for locators that are intended to remain in place for a long time (non-upload policies).</span></span> <span data-ttu-id="b04ea-145">For more information, see [this](media-services-dotnet-manage-entities.md#limit-access-policies) topic.</span><span class="sxs-lookup"><span data-stu-id="b04ea-145">For more information, see [this](media-services-dotnet-manage-entities.md#limit-access-policies) topic.</span></span>

    using System;
    using System.Configuration;
    using System.Linq;
    using Microsoft.WindowsAzure.MediaServices.Client;
    using System.Threading;
    using Microsoft.WindowsAzure.Storage.Auth;
    using Microsoft.WindowsAzure.Storage;
    using Microsoft.WindowsAzure.Storage.Blob;
    using System.Threading.Tasks;
    
    namespace CopyExistingBlobsIntoAsset
    {
        class Program
        {
            // Read values from the App.config file.
            private static readonly string _mediaServicesAccountName =
                ConfigurationManager.AppSettings["MediaServicesAccountName"];
            private static readonly string _mediaServicesAccountKey =
                ConfigurationManager.AppSettings["MediaServicesAccountKey"];
            private static readonly string _mediaServicesStorageAccountName =
                ConfigurationManager.AppSettings["MediaServicesStorageAccountName"];
            private static readonly string _mediaServicesStorageAccountKey =
                ConfigurationManager.AppSettings["MediaServicesStorageAccountKey"];
            private static readonly string _sourceStorageAccountName =
         ConfigurationManager.AppSettings["SourceStorageAccountName"];
            private static readonly string _sourceStorageAccountKey =
                ConfigurationManager.AppSettings["SourceStorageAccountKey"];
    
            // Field for service context.
            private static CloudMediaContext _context = null;
            private static CloudStorageAccount _sourceStorageAccount = null;
            private static CloudStorageAccount _destinationStorageAccount = null;
    
            static void Main(string[] args)
            {
    
                // Used the cached credentials to create CloudMediaContext.
                _context = new CloudMediaContext(new MediaServicesCredentials(
                                _mediaServicesAccountName,
                                _mediaServicesAccountKey));
    
                _sourceStorageAccount = 
                    new CloudStorageAccount(new StorageCredentials(_sourceStorageAccountName, 
                        _sourceStorageAccountKey), true);
    
                _destinationStorageAccount = 
                    new CloudStorageAccount(new StorageCredentials(_mediaServicesStorageAccountName, 
                        _mediaServicesStorageAccountKey), true);
                
                CloudBlobClient sourceCloudBlobClient = 
                    _sourceStorageAccount.CreateCloudBlobClient();
                CloudBlobContainer sourceContainer = 
                    sourceCloudBlobClient.GetContainerReference("NameOfBlobContainerYouWantToCopy");
    
                CreateAssetFromExistingBlobs(sourceContainer);
            }
            
            static public IAsset CreateAssetFromExistingBlobs(CloudBlobContainer sourceBlobContainer)
            {
                CloudBlobClient destBlobStorage = _destinationStorageAccount.CreateCloudBlobClient();
    
                // Create a new asset. 
                IAsset asset = _context.Assets.Create("NewAsset_" + Guid.NewGuid(), AssetCreationOptions.None);
    
                IAccessPolicy writePolicy = _context.AccessPolicies.Create("writePolicy",
                    TimeSpan.FromHours(24), AccessPermissions.Write);
    
                ILocator destinationLocator = 
                    _context.Locators.CreateLocator(LocatorType.Sas, asset, writePolicy);
    
                // Get the asset container URI and Blob copy from mediaContainer to assetContainer. 
                CloudBlobContainer destAssetContainer =
                    destBlobStorage.GetContainerReference((new Uri(destinationLocator.Path)).Segments[1]);
    
                if (destAssetContainer.CreateIfNotExists())
                {
                    destAssetContainer.SetPermissions(new BlobContainerPermissions
                    {
                        PublicAccess = BlobContainerPublicAccessType.Blob
                    });
                }
    
                var blobList = sourceBlobContainer.ListBlobs();
    
                foreach (var sourceBlob in blobList)
                {
                    var assetFile = asset.AssetFiles.Create((sourceBlob as ICloudBlob).Name);
    
                    ICloudBlob destinationBlob = destAssetContainer.GetBlockBlobReference(assetFile.Name);
    
                    // Call the CopyBlobHelpers.CopyBlobAsync extension method to copy blobs.
                    using (Task task = 
                        CopyBlobHelpers.CopyBlobAsync((CloudBlockBlob)sourceBlob, 
                            (CloudBlockBlob)destinationBlob, 
                            new BlobRequestOptions(), 
                            CancellationToken.None))
                    {
                        task.Wait();
                    }
    
                    assetFile.ContentFileSize = (sourceBlob as ICloudBlob).Properties.Length;
                    assetFile.Update();
                    Console.WriteLine("File {0} is of {1} size", assetFile.Name, assetFile.ContentFileSize);
                }
    
                asset.Update();
    
                destinationLocator.Delete();
                writePolicy.Delete();
    
                // Set the primary asset file.
                // If, for example, we copied a set of Smooth Streaming files, 
                // set the .ism file to be the primary file. 
                // If we, for example, copied an .mp4, then the mp4 would be the primary file. 
                var ismAssetFiles = asset.AssetFiles.ToList().
                    Where(f => f.Name.EndsWith(".ism", StringComparison.OrdinalIgnoreCase)).ToArray();
    
                // The following code assigns the first .ism file as the primary file in the asset.
                // An asset should have one .ism file.  
                ismAssetFiles.First().IsPrimary = true;
                ismAssetFiles.First().Update();
    
                return asset;
            }
        }
    }
    
## <a name="next-steps"></a><span data-ttu-id="b04ea-146">Next steps</span><span class="sxs-lookup"><span data-stu-id="b04ea-146">Next steps</span></span>

<span data-ttu-id="b04ea-147">You can now encode your uploaded assets.</span><span class="sxs-lookup"><span data-stu-id="b04ea-147">You can now encode your uploaded assets.</span></span> <span data-ttu-id="b04ea-148">For more information, see [Encode assets](media-services-portal-encode.md).</span><span class="sxs-lookup"><span data-stu-id="b04ea-148">For more information, see [Encode assets](media-services-portal-encode.md).</span></span>

<span data-ttu-id="b04ea-149">You can also use Azure Functions to trigger an encoding job based on a file arriving in the configured container.</span><span class="sxs-lookup"><span data-stu-id="b04ea-149">You can also use Azure Functions to trigger an encoding job based on a file arriving in the configured container.</span></span> <span data-ttu-id="b04ea-150">For more information, see [this sample](https://azure.microsoft.com/resources/samples/media-services-dotnet-functions-integration/ ).</span><span class="sxs-lookup"><span data-stu-id="b04ea-150">For more information, see [this sample](https://azure.microsoft.com/resources/samples/media-services-dotnet-functions-integration/ ).</span></span>

## <a name="media-services-learning-paths"></a><span data-ttu-id="b04ea-151">Media Services learning paths</span><span class="sxs-lookup"><span data-stu-id="b04ea-151">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="b04ea-152">Provide feedback</span><span class="sxs-lookup"><span data-stu-id="b04ea-152">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

