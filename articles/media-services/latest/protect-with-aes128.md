---
title: Use AES Azure Media Services dynamic encryption | Microsoft Docs
description: Deliver your content encrypted with AES 128-bit encryption keys by using Microsoft Azure Media Services. Media Services also provides the key delivery service that delivers encryption keys to authorized users. This topic shows how to dynamically encrypt with AES-128 and use the key delivery service.
services: media-services
documentationcenter: ''
author: Juliako
manager: cfowler
editor: ''
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2018
ms.author: juliako
ms.openlocfilehash: 3e5de521570a587b049702dabd3e3692c4227796
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44967918"
---
# <a name="use-aes-128-dynamic-encryption-and-the-key-delivery-service"></a><span data-ttu-id="33424-105">Use AES-128 dynamic encryption and the key delivery service</span><span class="sxs-lookup"><span data-stu-id="33424-105">Use AES-128 dynamic encryption and the key delivery service</span></span>

<span data-ttu-id="33424-106">You can use Media Services to deliver HTTP Live Streaming (HLS), MPEG-DASH, and Smooth Streaming encrypted with the AES by using 128-bit encryption keys.</span><span class="sxs-lookup"><span data-stu-id="33424-106">You can use Media Services to deliver HTTP Live Streaming (HLS), MPEG-DASH, and Smooth Streaming encrypted with the AES by using 128-bit encryption keys.</span></span> <span data-ttu-id="33424-107">Media Services also provides the key delivery service that delivers encryption keys to authorized users.</span><span class="sxs-lookup"><span data-stu-id="33424-107">Media Services also provides the key delivery service that delivers encryption keys to authorized users.</span></span> <span data-ttu-id="33424-108">If you want for Media Services to encrypt an asset, you associate the encryption key with StreamingLocator and also configure the content key policy.</span><span class="sxs-lookup"><span data-stu-id="33424-108">If you want for Media Services to encrypt an asset, you associate the encryption key with StreamingLocator and also configure the content key policy.</span></span> <span data-ttu-id="33424-109">When a stream is requested by a player, Media Services uses the specified key to dynamically encrypt your content by using AES encryption.</span><span class="sxs-lookup"><span data-stu-id="33424-109">When a stream is requested by a player, Media Services uses the specified key to dynamically encrypt your content by using AES encryption.</span></span> <span data-ttu-id="33424-110">To decrypt the stream, the player requests the key from the key delivery service.</span><span class="sxs-lookup"><span data-stu-id="33424-110">To decrypt the stream, the player requests the key from the key delivery service.</span></span> <span data-ttu-id="33424-111">To determine whether the user is authorized to get the key, the service evaluates the content key policy that you specified for the key.</span><span class="sxs-lookup"><span data-stu-id="33424-111">To determine whether the user is authorized to get the key, the service evaluates the content key policy that you specified for the key.</span></span>

<span data-ttu-id="33424-112">The article is based on the [EncryptWithAES](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/EncryptWithAES) sample.</span><span class="sxs-lookup"><span data-stu-id="33424-112">The article is based on the [EncryptWithAES](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/EncryptWithAES) sample.</span></span> <span data-ttu-id="33424-113">The sample demonstrates how to create an encoding Transform that uses a built-in preset for adaptive bitrate encoding and ingests a file directly from an [HTTPs source URL](job-input-from-http-how-to.md).</span><span class="sxs-lookup"><span data-stu-id="33424-113">The sample demonstrates how to create an encoding Transform that uses a built-in preset for adaptive bitrate encoding and ingests a file directly from an [HTTPs source URL](job-input-from-http-how-to.md).</span></span> <span data-ttu-id="33424-114">The output asset is then published using the AES (ClearKey) encryption.</span><span class="sxs-lookup"><span data-stu-id="33424-114">The output asset is then published using the AES (ClearKey) encryption.</span></span> <span data-ttu-id="33424-115">The output from the sample is a URL to the Azure Media Player, including both the DASH manifest and the AES token needed to play back the content.</span><span class="sxs-lookup"><span data-stu-id="33424-115">The output from the sample is a URL to the Azure Media Player, including both the DASH manifest and the AES token needed to play back the content.</span></span> <span data-ttu-id="33424-116">The sample sets the expiration of the JWT token to 1 hour.</span><span class="sxs-lookup"><span data-stu-id="33424-116">The sample sets the expiration of the JWT token to 1 hour.</span></span> <span data-ttu-id="33424-117">You can open a browser and paste the resulting URL to launch the Azure Media Player demo page with the URL and token filled out for you already in the following format: ```https://ampdemo.azureedge.net/?url= {dash Manifest URL} &aes=true&aestoken=Bearer%3D{ JWT Token here}```.</span><span class="sxs-lookup"><span data-stu-id="33424-117">You can open a browser and paste the resulting URL to launch the Azure Media Player demo page with the URL and token filled out for you already in the following format: ```https://ampdemo.azureedge.net/?url= {dash Manifest URL} &aes=true&aestoken=Bearer%3D{ JWT Token here}```.</span></span>

> [!NOTE]
> <span data-ttu-id="33424-118">You can encrypt each asset with multiple encryption types (AES-128, PlayReady, Widevine, FairPlay).</span><span class="sxs-lookup"><span data-stu-id="33424-118">You can encrypt each asset with multiple encryption types (AES-128, PlayReady, Widevine, FairPlay).</span></span> <span data-ttu-id="33424-119">See [Streaming protocols and encryption types](content-protection-overview.md#streaming-protocols-and-encryption-types), to see what makes sense to combine.</span><span class="sxs-lookup"><span data-stu-id="33424-119">See [Streaming protocols and encryption types](content-protection-overview.md#streaming-protocols-and-encryption-types), to see what makes sense to combine.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="33424-120">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="33424-120">Prerequisites</span></span>

<span data-ttu-id="33424-121">The following are required to complete the tutorial.</span><span class="sxs-lookup"><span data-stu-id="33424-121">The following are required to complete the tutorial.</span></span>

* <span data-ttu-id="33424-122">Review the [Content protection overview](content-protection-overview.md) article.</span><span class="sxs-lookup"><span data-stu-id="33424-122">Review the [Content protection overview](content-protection-overview.md) article.</span></span>
* <span data-ttu-id="33424-123">Install Visual Studio Code or Visual Studio</span><span class="sxs-lookup"><span data-stu-id="33424-123">Install Visual Studio Code or Visual Studio</span></span>
* <span data-ttu-id="33424-124">Create a new Azure Media Services account, as described in [this quickstart](create-account-cli-quickstart.md).</span><span class="sxs-lookup"><span data-stu-id="33424-124">Create a new Azure Media Services account, as described in [this quickstart](create-account-cli-quickstart.md).</span></span>
* <span data-ttu-id="33424-125">Get credentials needed to use Media Services APIs by following [Access APIs](access-api-cli-how-to.md)</span><span class="sxs-lookup"><span data-stu-id="33424-125">Get credentials needed to use Media Services APIs by following [Access APIs](access-api-cli-how-to.md)</span></span>

## <a name="download-code"></a><span data-ttu-id="33424-126">Download code</span><span class="sxs-lookup"><span data-stu-id="33424-126">Download code</span></span>

<span data-ttu-id="33424-127">Clone a GitHub repository that contains the full .NET sample discussed in this article to your machine using the following command:</span><span class="sxs-lookup"><span data-stu-id="33424-127">Clone a GitHub repository that contains the full .NET sample discussed in this article to your machine using the following command:</span></span>

 ```bash
 git clone https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials.git
 ```
 
<span data-ttu-id="33424-128">The "Encrypt with AES-128" sample is located in the [EncryptWithAES](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/EncryptWithAES) folder.</span><span class="sxs-lookup"><span data-stu-id="33424-128">The "Encrypt with AES-128" sample is located in the [EncryptWithAES](https://github.com/Azure-Samples/media-services-v3-dotnet-tutorials/blob/master/AMSV3Tutorials/EncryptWithAES) folder.</span></span>

> [!NOTE]
> <span data-ttu-id="33424-129">The sample creates unique resources every time you run the application.</span><span class="sxs-lookup"><span data-stu-id="33424-129">The sample creates unique resources every time you run the application.</span></span> <span data-ttu-id="33424-130">Typically, you will reuse existing resources like transforms and policies (if existing resource have required configurations).</span><span class="sxs-lookup"><span data-stu-id="33424-130">Typically, you will reuse existing resources like transforms and policies (if existing resource have required configurations).</span></span> 

## <a name="start-using-media-services-apis-with-net-sdk"></a><span data-ttu-id="33424-131">Start using Media Services APIs with .NET SDK</span><span class="sxs-lookup"><span data-stu-id="33424-131">Start using Media Services APIs with .NET SDK</span></span>

<span data-ttu-id="33424-132">To start using Media Services APIs with .NET, you need to create an **AzureMediaServicesClient** object.</span><span class="sxs-lookup"><span data-stu-id="33424-132">To start using Media Services APIs with .NET, you need to create an **AzureMediaServicesClient** object.</span></span> <span data-ttu-id="33424-133">To create the object, you need to supply credentials needed for the client to connect to Azure using Azure AD.</span><span class="sxs-lookup"><span data-stu-id="33424-133">To create the object, you need to supply credentials needed for the client to connect to Azure using Azure AD.</span></span> <span data-ttu-id="33424-134">In the code you cloned at the beginning of the article, the **GetCredentialsAsync** function creates the ServiceClientCredentials object based on the credentials supplied in the local configuration file.</span><span class="sxs-lookup"><span data-stu-id="33424-134">In the code you cloned at the beginning of the article, the **GetCredentialsAsync** function creates the ServiceClientCredentials object based on the credentials supplied in the local configuration file.</span></span> 

[!code-csharp[Main](../../../media-services-v3-dotnet-tutorials/AMSV3Tutorials/EncryptWithAES/Program.cs#CreateMediaServicesClient)]

## <a name="create-an-output-asset"></a><span data-ttu-id="33424-135">Create an output asset</span><span class="sxs-lookup"><span data-stu-id="33424-135">Create an output asset</span></span>  

<span data-ttu-id="33424-136">The output [Asset](https://docs.microsoft.com/rest/api/media/assets) stores the result of your encoding job.</span><span class="sxs-lookup"><span data-stu-id="33424-136">The output [Asset](https://docs.microsoft.com/rest/api/media/assets) stores the result of your encoding job.</span></span>  

[!code-csharp[Main](../../../media-services-v3-dotnet-tutorials/AMSV3Tutorials/EncryptWithAES/Program.cs#CreateOutputAsset)]
 
## <a name="get-or-create-an-encoding-transform"></a><span data-ttu-id="33424-137">Get or create an encoding Transform</span><span class="sxs-lookup"><span data-stu-id="33424-137">Get or create an encoding Transform</span></span>

<span data-ttu-id="33424-138">When creating a new [Transform](https://docs.microsoft.com/rest/api/media/transforms) instance, you need to specify what you want it to produce as an output.</span><span class="sxs-lookup"><span data-stu-id="33424-138">When creating a new [Transform](https://docs.microsoft.com/rest/api/media/transforms) instance, you need to specify what you want it to produce as an output.</span></span> <span data-ttu-id="33424-139">The required parameter is a **TransformOutput** object, as shown in the code below.</span><span class="sxs-lookup"><span data-stu-id="33424-139">The required parameter is a **TransformOutput** object, as shown in the code below.</span></span> <span data-ttu-id="33424-140">Each **TransformOutput** contains a **Preset**.</span><span class="sxs-lookup"><span data-stu-id="33424-140">Each **TransformOutput** contains a **Preset**.</span></span> <span data-ttu-id="33424-141">**Preset** describes the step-by-step instructions of video and/or audio processing operations that are to be used to generate the desired **TransformOutput**.</span><span class="sxs-lookup"><span data-stu-id="33424-141">**Preset** describes the step-by-step instructions of video and/or audio processing operations that are to be used to generate the desired **TransformOutput**.</span></span> <span data-ttu-id="33424-142">The sample described in this article uses a built-in Preset called **AdaptiveStreaming**.</span><span class="sxs-lookup"><span data-stu-id="33424-142">The sample described in this article uses a built-in Preset called **AdaptiveStreaming**.</span></span> <span data-ttu-id="33424-143">The Preset encodes the input video into an auto-generated bitrate ladder (bitrate-resolution pairs) based on the input resolution and bitrate, and produces ISO MP4 files with H.264 video and AAC audio corresponding to each bitrate-resolution pair.</span><span class="sxs-lookup"><span data-stu-id="33424-143">The Preset encodes the input video into an auto-generated bitrate ladder (bitrate-resolution pairs) based on the input resolution and bitrate, and produces ISO MP4 files with H.264 video and AAC audio corresponding to each bitrate-resolution pair.</span></span> 

<span data-ttu-id="33424-144">Before creating a new [Transform](https://docs.microsoft.com/rest/api/media/transforms), you should first check if one already exists using the **Get** method, as shown in the code that follows.</span><span class="sxs-lookup"><span data-stu-id="33424-144">Before creating a new [Transform](https://docs.microsoft.com/rest/api/media/transforms), you should first check if one already exists using the **Get** method, as shown in the code that follows.</span></span>  <span data-ttu-id="33424-145">In Media Services v3, **Get** methods on entities return **null** if the entity doesn’t exist (a case-insensitive check on the name).</span><span class="sxs-lookup"><span data-stu-id="33424-145">In Media Services v3, **Get** methods on entities return **null** if the entity doesn’t exist (a case-insensitive check on the name).</span></span>

[!code-csharp[Main](../../../media-services-v3-dotnet-tutorials/AMSV3Tutorials/EncryptWithAES/Program.cs#EnsureTransformExists)]

## <a name="submit-job"></a><span data-ttu-id="33424-146">Submit Job</span><span class="sxs-lookup"><span data-stu-id="33424-146">Submit Job</span></span>

<span data-ttu-id="33424-147">As mentioned above, the [Transform](https://docs.microsoft.com/rest/api/media/transforms) object is the recipe and a [Job](https://docs.microsoft.com/rest/api/media/jobs) is the actual request to Media Services to apply that **Transform** to a given input video or audio content.</span><span class="sxs-lookup"><span data-stu-id="33424-147">As mentioned above, the [Transform](https://docs.microsoft.com/rest/api/media/transforms) object is the recipe and a [Job](https://docs.microsoft.com/rest/api/media/jobs) is the actual request to Media Services to apply that **Transform** to a given input video or audio content.</span></span> <span data-ttu-id="33424-148">The **Job** specifies information like the location of the input video, and the location for the output.</span><span class="sxs-lookup"><span data-stu-id="33424-148">The **Job** specifies information like the location of the input video, and the location for the output.</span></span>

<span data-ttu-id="33424-149">In this tutorial, we create the job's input based on a file that is ingested directly from an [HTTPs source URL](job-input-from-http-how-to.md).</span><span class="sxs-lookup"><span data-stu-id="33424-149">In this tutorial, we create the job's input based on a file that is ingested directly from an [HTTPs source URL](job-input-from-http-how-to.md).</span></span>

[!code-csharp[Main](../../../media-services-v3-dotnet-tutorials/AMSV3Tutorials/EncryptWithAES/Program.cs#SubmitJob)]

## <a name="wait-for-the-job-to-complete"></a><span data-ttu-id="33424-150">Wait for the Job to complete</span><span class="sxs-lookup"><span data-stu-id="33424-150">Wait for the Job to complete</span></span>

<span data-ttu-id="33424-151">The job takes some time to complete and when it does you want to be notified.</span><span class="sxs-lookup"><span data-stu-id="33424-151">The job takes some time to complete and when it does you want to be notified.</span></span> <span data-ttu-id="33424-152">The code sample below shows how to poll the service for the status of the [Job](https://docs.microsoft.com/rest/api/media/jobs).</span><span class="sxs-lookup"><span data-stu-id="33424-152">The code sample below shows how to poll the service for the status of the [Job](https://docs.microsoft.com/rest/api/media/jobs).</span></span> <span data-ttu-id="33424-153">Polling is not a recommended best practice for production applications because of potential latency.</span><span class="sxs-lookup"><span data-stu-id="33424-153">Polling is not a recommended best practice for production applications because of potential latency.</span></span> <span data-ttu-id="33424-154">Polling can be throttled if overused on an account.</span><span class="sxs-lookup"><span data-stu-id="33424-154">Polling can be throttled if overused on an account.</span></span> <span data-ttu-id="33424-155">Developers should instead use Event Grid.</span><span class="sxs-lookup"><span data-stu-id="33424-155">Developers should instead use Event Grid.</span></span> <span data-ttu-id="33424-156">See [Route events to a custom web endpoint](job-state-events-cli-how-to.md).</span><span class="sxs-lookup"><span data-stu-id="33424-156">See [Route events to a custom web endpoint](job-state-events-cli-how-to.md).</span></span>

<span data-ttu-id="33424-157">The **Job** usually goes through the following states: **Scheduled**, **Queued**, **Processing**, **Finished** (the final state).</span><span class="sxs-lookup"><span data-stu-id="33424-157">The **Job** usually goes through the following states: **Scheduled**, **Queued**, **Processing**, **Finished** (the final state).</span></span> <span data-ttu-id="33424-158">If the job has encountered an error, you get the **Error** state.</span><span class="sxs-lookup"><span data-stu-id="33424-158">If the job has encountered an error, you get the **Error** state.</span></span> <span data-ttu-id="33424-159">If the job is in the process of being canceled, you get **Canceling** and **Canceled** when it is done.</span><span class="sxs-lookup"><span data-stu-id="33424-159">If the job is in the process of being canceled, you get **Canceling** and **Canceled** when it is done.</span></span>

[!code-csharp[Main](../../../media-services-v3-dotnet-tutorials/AMSV3Tutorials/EncryptWithAES/Program.cs#WaitForJobToFinish)]

## <a name="create-a-contentkeypolicy"></a><span data-ttu-id="33424-160">Create a ContentKeyPolicy</span><span class="sxs-lookup"><span data-stu-id="33424-160">Create a ContentKeyPolicy</span></span>

<span data-ttu-id="33424-161">A content key provides secure access to your Assets.</span><span class="sxs-lookup"><span data-stu-id="33424-161">A content key provides secure access to your Assets.</span></span> <span data-ttu-id="33424-162">You need to create a **ContentKeyPolicy** that configures how the content key is delivered to end clients.</span><span class="sxs-lookup"><span data-stu-id="33424-162">You need to create a **ContentKeyPolicy** that configures how the content key is delivered to end clients.</span></span> <span data-ttu-id="33424-163">The content key is associated with **StreamingLocator**.</span><span class="sxs-lookup"><span data-stu-id="33424-163">The content key is associated with **StreamingLocator**.</span></span> <span data-ttu-id="33424-164">Media Services also provides the key delivery service that delivers encryption keys to authorized users.</span><span class="sxs-lookup"><span data-stu-id="33424-164">Media Services also provides the key delivery service that delivers encryption keys to authorized users.</span></span> 

<span data-ttu-id="33424-165">When a stream is requested by a player, Media Services uses the specified key to dynamically encrypt your content (in this case, by using AES encryption.) To decrypt the stream, the player requests the key from the key delivery service.</span><span class="sxs-lookup"><span data-stu-id="33424-165">When a stream is requested by a player, Media Services uses the specified key to dynamically encrypt your content (in this case, by using AES encryption.) To decrypt the stream, the player requests the key from the key delivery service.</span></span> <span data-ttu-id="33424-166">To determine whether the user is authorized to get the key, the service evaluates the content key policy that you specified for the key.</span><span class="sxs-lookup"><span data-stu-id="33424-166">To determine whether the user is authorized to get the key, the service evaluates the content key policy that you specified for the key.</span></span>

[!code-csharp[Main](../../../media-services-v3-dotnet-tutorials/AMSV3Tutorials/EncryptWithAES/Program.cs#GetOrCreateContentKeyPolicy)]

## <a name="create-a-streaminglocator"></a><span data-ttu-id="33424-167">Create a StreamingLocator</span><span class="sxs-lookup"><span data-stu-id="33424-167">Create a StreamingLocator</span></span>

<span data-ttu-id="33424-168">After the encoding is complete, and the content key policy is set, the next step is to make the video in the output Asset available to clients for playback.</span><span class="sxs-lookup"><span data-stu-id="33424-168">After the encoding is complete, and the content key policy is set, the next step is to make the video in the output Asset available to clients for playback.</span></span> <span data-ttu-id="33424-169">You accomplish this in two steps:</span><span class="sxs-lookup"><span data-stu-id="33424-169">You accomplish this in two steps:</span></span> 

1. <span data-ttu-id="33424-170">Create a [StreamingLocator](https://docs.microsoft.com/rest/api/media/streaminglocators)</span><span class="sxs-lookup"><span data-stu-id="33424-170">Create a [StreamingLocator](https://docs.microsoft.com/rest/api/media/streaminglocators)</span></span>
2. <span data-ttu-id="33424-171">Build the streaming URLs that clients can use.</span><span class="sxs-lookup"><span data-stu-id="33424-171">Build the streaming URLs that clients can use.</span></span> 

<span data-ttu-id="33424-172">The process of creating the **StreamingLocator** is called publishing.</span><span class="sxs-lookup"><span data-stu-id="33424-172">The process of creating the **StreamingLocator** is called publishing.</span></span> <span data-ttu-id="33424-173">By default, the **StreamingLocator** is valid immediately after you make the API calls, and lasts until it is deleted, unless you configure the optional start and end times.</span><span class="sxs-lookup"><span data-stu-id="33424-173">By default, the **StreamingLocator** is valid immediately after you make the API calls, and lasts until it is deleted, unless you configure the optional start and end times.</span></span> 

<span data-ttu-id="33424-174">When creating a [StreamingLocator](https://docs.microsoft.com/rest/api/media/streaminglocators), you will need to specify the desired **StreamingPolicyName**.</span><span class="sxs-lookup"><span data-stu-id="33424-174">When creating a [StreamingLocator](https://docs.microsoft.com/rest/api/media/streaminglocators), you will need to specify the desired **StreamingPolicyName**.</span></span> <span data-ttu-id="33424-175">In this tutorial, we are using one of the PredefinedStreamingPolicies, which tells Azure Media Services how to publish the content for streaming.</span><span class="sxs-lookup"><span data-stu-id="33424-175">In this tutorial, we are using one of the PredefinedStreamingPolicies, which tells Azure Media Services how to publish the content for streaming.</span></span> <span data-ttu-id="33424-176">In this example, the AES Envelope encryption is applied (also known as ClearKey encryption because the key is delivered to the playback client via HTTPS and not a DRM license).</span><span class="sxs-lookup"><span data-stu-id="33424-176">In this example, the AES Envelope encryption is applied (also known as ClearKey encryption because the key is delivered to the playback client via HTTPS and not a DRM license).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="33424-177">When using a custom [StreamingPolicy](https://docs.microsoft.com/rest/api/media/streamingpolicies), you should design a limited set of such policies for your Media Service account, and re-use them for your StreamingLocators whenever the same encryption options and protocols are needed.</span><span class="sxs-lookup"><span data-stu-id="33424-177">When using a custom [StreamingPolicy](https://docs.microsoft.com/rest/api/media/streamingpolicies), you should design a limited set of such policies for your Media Service account, and re-use them for your StreamingLocators whenever the same encryption options and protocols are needed.</span></span> <span data-ttu-id="33424-178">Your Media Service account has a quota for the number of StreamingPolicy entries.</span><span class="sxs-lookup"><span data-stu-id="33424-178">Your Media Service account has a quota for the number of StreamingPolicy entries.</span></span> <span data-ttu-id="33424-179">You should not be creating a new StreamingPolicy for each StreamingLocator.</span><span class="sxs-lookup"><span data-stu-id="33424-179">You should not be creating a new StreamingPolicy for each StreamingLocator.</span></span>

[!code-csharp[Main](../../../media-services-v3-dotnet-tutorials/AMSV3Tutorials/EncryptWithAES/Program.cs#CreateStreamingLocator)]

## <a name="get-a-test-token"></a><span data-ttu-id="33424-180">Get a test token</span><span class="sxs-lookup"><span data-stu-id="33424-180">Get a test token</span></span>
        
<span data-ttu-id="33424-181">In this tutorial, we specify for the content key policy to have a token restriction.</span><span class="sxs-lookup"><span data-stu-id="33424-181">In this tutorial, we specify for the content key policy to have a token restriction.</span></span> <span data-ttu-id="33424-182">The token-restricted policy must be accompanied by a token issued by a security token service (STS).</span><span class="sxs-lookup"><span data-stu-id="33424-182">The token-restricted policy must be accompanied by a token issued by a security token service (STS).</span></span> <span data-ttu-id="33424-183">Media Services supports tokens in the [JSON Web Token](https://msdn.microsoft.com/library/gg185950.aspx#BKMK_3) (JWT) formats and that is what we configure in the sample.</span><span class="sxs-lookup"><span data-stu-id="33424-183">Media Services supports tokens in the [JSON Web Token](https://msdn.microsoft.com/library/gg185950.aspx#BKMK_3) (JWT) formats and that is what we configure in the sample.</span></span>

<span data-ttu-id="33424-184">The ContentKeyIdentifierClaim is used in the ContentKeyPolicy, which means that the token presented to the Key Delivery service must have the identifier of the ContentKey in it.</span><span class="sxs-lookup"><span data-stu-id="33424-184">The ContentKeyIdentifierClaim is used in the ContentKeyPolicy, which means that the token presented to the Key Delivery service must have the identifier of the ContentKey in it.</span></span> <span data-ttu-id="33424-185">In the sample, we don't specify a content key when creating the StreamingLocator, the system creates a random one for us.</span><span class="sxs-lookup"><span data-stu-id="33424-185">In the sample, we don't specify a content key when creating the StreamingLocator, the system creates a random one for us.</span></span> <span data-ttu-id="33424-186">In order to generate the test token, we must get the ContentKeyId to put in the ContentKeyIdentifierClaim claim.</span><span class="sxs-lookup"><span data-stu-id="33424-186">In order to generate the test token, we must get the ContentKeyId to put in the ContentKeyIdentifierClaim claim.</span></span>

[!code-csharp[Main](../../../media-services-v3-dotnet-tutorials/AMSV3Tutorials/EncryptWithAES/Program.cs#GetToken)]

## <a name="build-a-dash-streaming-url"></a><span data-ttu-id="33424-187">Build a DASH streaming URL</span><span class="sxs-lookup"><span data-stu-id="33424-187">Build a DASH streaming URL</span></span>

<span data-ttu-id="33424-188">Now that the [StreamingLocator](https://docs.microsoft.com/rest/api/media/streaminglocators) has been created, you can get the streaming URLs.</span><span class="sxs-lookup"><span data-stu-id="33424-188">Now that the [StreamingLocator](https://docs.microsoft.com/rest/api/media/streaminglocators) has been created, you can get the streaming URLs.</span></span> <span data-ttu-id="33424-189">To build a URL, you need to concatenate the [StreamingEndpoint](https://docs.microsoft.com/rest/api/media/streamingendpoints) host name and the **StreamingLocator** path.</span><span class="sxs-lookup"><span data-stu-id="33424-189">To build a URL, you need to concatenate the [StreamingEndpoint](https://docs.microsoft.com/rest/api/media/streamingendpoints) host name and the **StreamingLocator** path.</span></span> <span data-ttu-id="33424-190">In this sample, the *default* **StreamingEndpoint** is used.</span><span class="sxs-lookup"><span data-stu-id="33424-190">In this sample, the *default* **StreamingEndpoint** is used.</span></span> <span data-ttu-id="33424-191">When you first create a Media Service account, this *default* **StreamingEndpoint** will be in a stopped state, so you need to call **Start**.</span><span class="sxs-lookup"><span data-stu-id="33424-191">When you first create a Media Service account, this *default* **StreamingEndpoint** will be in a stopped state, so you need to call **Start**.</span></span>

[!code-csharp[Main](../../../media-services-v3-dotnet-tutorials/AMSV3Tutorials/EncryptWithAES/Program.cs#GetMPEGStreamingUrl)]

## <a name="clean-up-resources-in-your-media-services-account"></a><span data-ttu-id="33424-192">Clean up resources in your Media Services account</span><span class="sxs-lookup"><span data-stu-id="33424-192">Clean up resources in your Media Services account</span></span>

<span data-ttu-id="33424-193">Generally, you should clean up everything except objects that you are planning to reuse (typically, you will reuse Transforms, and you will persist StreamingLocators, etc.).</span><span class="sxs-lookup"><span data-stu-id="33424-193">Generally, you should clean up everything except objects that you are planning to reuse (typically, you will reuse Transforms, and you will persist StreamingLocators, etc.).</span></span> <span data-ttu-id="33424-194">If you want for your account to be clean after experimenting, you should delete the resources that you do not plan to reuse.</span><span class="sxs-lookup"><span data-stu-id="33424-194">If you want for your account to be clean after experimenting, you should delete the resources that you do not plan to reuse.</span></span>  <span data-ttu-id="33424-195">For example, the following code deletes Jobs.</span><span class="sxs-lookup"><span data-stu-id="33424-195">For example, the following code deletes Jobs.</span></span>

[!code-csharp[Main](../../../media-services-v3-dotnet-tutorials/AMSV3Tutorials/EncryptWithAES/Program.cs#CleanUp)]

## <a name="next-steps"></a><span data-ttu-id="33424-196">Next steps</span><span class="sxs-lookup"><span data-stu-id="33424-196">Next steps</span></span>

<span data-ttu-id="33424-197">Check out how to [protect with DRM](protect-with-drm.md)</span><span class="sxs-lookup"><span data-stu-id="33424-197">Check out how to [protect with DRM](protect-with-drm.md)</span></span>
