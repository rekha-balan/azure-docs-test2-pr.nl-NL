---
title: Design of a multi-DRM content protection system with cccess control using Azure Media Services | Microsoft Docs
description: Learn about how to license the Microsoft Smooth Streaming Client Porting Kit.
services: media-services
documentationcenter: ''
author: willzhan
manager: cfowler
editor: ''
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/05/2018
ms.author: willzhan;juliako
ms.openlocfilehash: 3a33c4b157ded3162919494d27488285e52fdd3b
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44969359"
---
# <a name="design-of-a-multi-drm-content-protection-system-with-access-control"></a><span data-ttu-id="7d2ea-103">Design of a multi-DRM content protection system with access control</span><span class="sxs-lookup"><span data-stu-id="7d2ea-103">Design of a multi-DRM content protection system with access control</span></span> 

## <a name="overview"></a><span data-ttu-id="7d2ea-104">Overview</span><span class="sxs-lookup"><span data-stu-id="7d2ea-104">Overview</span></span>

<span data-ttu-id="7d2ea-105">Designing and building a Digital Rights Management (DRM) subsystem for an over-the-top (OTT) or online streaming solution is a complex task.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-105">Designing and building a Digital Rights Management (DRM) subsystem for an over-the-top (OTT) or online streaming solution is a complex task.</span></span> <span data-ttu-id="7d2ea-106">Operators/online video providers typically outsource this task to specialized DRM service providers.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-106">Operators/online video providers typically outsource this task to specialized DRM service providers.</span></span> <span data-ttu-id="7d2ea-107">The goal of this document is to present a reference design and a reference implementation of an end-to-end DRM subsystem in an OTT or online streaming solution.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-107">The goal of this document is to present a reference design and a reference implementation of an end-to-end DRM subsystem in an OTT or online streaming solution.</span></span>

<span data-ttu-id="7d2ea-108">The targeted readers for this document are engineers who work in DRM subsystems of OTT or online streaming/multiscreen solutions or readers who are interested in DRM subsystems.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-108">The targeted readers for this document are engineers who work in DRM subsystems of OTT or online streaming/multiscreen solutions or readers who are interested in DRM subsystems.</span></span> <span data-ttu-id="7d2ea-109">The assumption is that readers are familiar with at least one of the DRM technologies on the market, such as PlayReady, Widevine, FairPlay, or Adobe Access.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-109">The assumption is that readers are familiar with at least one of the DRM technologies on the market, such as PlayReady, Widevine, FairPlay, or Adobe Access.</span></span>

<span data-ttu-id="7d2ea-110">In this discussion, by multi-DRM we include the 3 DRMs supported by Azure Media Services: Common Encryption (CENC) for PlayReady and Widevine, FairPlay as well as AES-128 clear key encryption.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-110">In this discussion, by multi-DRM we include the 3 DRMs supported by Azure Media Services: Common Encryption (CENC) for PlayReady and Widevine, FairPlay as well as AES-128 clear key encryption.</span></span> <span data-ttu-id="7d2ea-111">A major trend in online streaming and the OTT industry is to use native DRMs on various client platforms.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-111">A major trend in online streaming and the OTT industry is to use native DRMs on various client platforms.</span></span> <span data-ttu-id="7d2ea-112">This trend is a shift from the previous one that used a single DRM and its client SDK for various client platforms.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-112">This trend is a shift from the previous one that used a single DRM and its client SDK for various client platforms.</span></span> <span data-ttu-id="7d2ea-113">When you use CENC with multi-native DRM, both PlayReady and Widevine are encrypted per the [Common Encryption (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specification.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-113">When you use CENC with multi-native DRM, both PlayReady and Widevine are encrypted per the [Common Encryption (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specification.</span></span>

<span data-ttu-id="7d2ea-114">The benefits of using native multi-DRM for content protection are that it:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-114">The benefits of using native multi-DRM for content protection are that it:</span></span>

* <span data-ttu-id="7d2ea-115">Reduces encryption cost because a single encryption process is used to target different platforms with its native DRMs.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-115">Reduces encryption cost because a single encryption process is used to target different platforms with its native DRMs.</span></span>
* <span data-ttu-id="7d2ea-116">Reduces the cost of managing assets because only a single copy of asset is needed in storage.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-116">Reduces the cost of managing assets because only a single copy of asset is needed in storage.</span></span>
* <span data-ttu-id="7d2ea-117">Eliminates DRM client licensing cost because the native DRM client is usually free on its native platform.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-117">Eliminates DRM client licensing cost because the native DRM client is usually free on its native platform.</span></span>


### <a name="goals-of-the-article"></a><span data-ttu-id="7d2ea-118">Goals of the article</span><span class="sxs-lookup"><span data-stu-id="7d2ea-118">Goals of the article</span></span>

<span data-ttu-id="7d2ea-119">The goals of this article are to:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-119">The goals of this article are to:</span></span>

* <span data-ttu-id="7d2ea-120">Provide a reference design of a DRM subsystem that uses all 3 DRMs (CENC for DASH, FairPlay for HLS and PlayReady for smooth streaming).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-120">Provide a reference design of a DRM subsystem that uses all 3 DRMs (CENC for DASH, FairPlay for HLS and PlayReady for smooth streaming).</span></span>
* <span data-ttu-id="7d2ea-121">Provide a reference implementation on Azure and Azure Media Services platform.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-121">Provide a reference implementation on Azure and Azure Media Services platform.</span></span>
* <span data-ttu-id="7d2ea-122">Discuss some design and implementation topics.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-122">Discuss some design and implementation topics.</span></span>

<span data-ttu-id="7d2ea-123">The following table summarizes native DRM support on different platforms and EME support in different browsers.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-123">The following table summarizes native DRM support on different platforms and EME support in different browsers.</span></span>

| <span data-ttu-id="7d2ea-124">**Client platform**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-124">**Client platform**</span></span> | <span data-ttu-id="7d2ea-125">**Native DRM**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-125">**Native DRM**</span></span> | <span data-ttu-id="7d2ea-126">**EME**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-126">**EME**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="7d2ea-127">**Smart TVs, STBs**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-127">**Smart TVs, STBs**</span></span> | <span data-ttu-id="7d2ea-128">PlayReady, Widevine, and/or other</span><span class="sxs-lookup"><span data-stu-id="7d2ea-128">PlayReady, Widevine, and/or other</span></span> | <span data-ttu-id="7d2ea-129">Embedded browser/EME for PlayReady and/or Widevine</span><span class="sxs-lookup"><span data-stu-id="7d2ea-129">Embedded browser/EME for PlayReady and/or Widevine</span></span>|
| <span data-ttu-id="7d2ea-130">**Windows 10**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-130">**Windows 10**</span></span> | <span data-ttu-id="7d2ea-131">PlayReady</span><span class="sxs-lookup"><span data-stu-id="7d2ea-131">PlayReady</span></span> | <span data-ttu-id="7d2ea-132">MS Edge/IE11 for PlayReady</span><span class="sxs-lookup"><span data-stu-id="7d2ea-132">MS Edge/IE11 for PlayReady</span></span>|
| <span data-ttu-id="7d2ea-133">**Android devices (phone, tablet, TV)**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-133">**Android devices (phone, tablet, TV)**</span></span> |<span data-ttu-id="7d2ea-134">Widevine</span><span class="sxs-lookup"><span data-stu-id="7d2ea-134">Widevine</span></span> |<span data-ttu-id="7d2ea-135">Chrome for Widevine</span><span class="sxs-lookup"><span data-stu-id="7d2ea-135">Chrome for Widevine</span></span> |
| <span data-ttu-id="7d2ea-136">**iOS**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-136">**iOS**</span></span> | <span data-ttu-id="7d2ea-137">FairPlay</span><span class="sxs-lookup"><span data-stu-id="7d2ea-137">FairPlay</span></span> | <span data-ttu-id="7d2ea-138">Safari for FairPlay (since iOS 11.2)</span><span class="sxs-lookup"><span data-stu-id="7d2ea-138">Safari for FairPlay (since iOS 11.2)</span></span> |
| <span data-ttu-id="7d2ea-139">**macOS**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-139">**macOS**</span></span> | <span data-ttu-id="7d2ea-140">FairPlay</span><span class="sxs-lookup"><span data-stu-id="7d2ea-140">FairPlay</span></span> | <span data-ttu-id="7d2ea-141">Safari for FairPlay (since Safari 9+ on Mac OS X 10.11+ El Capitan)</span><span class="sxs-lookup"><span data-stu-id="7d2ea-141">Safari for FairPlay (since Safari 9+ on Mac OS X 10.11+ El Capitan)</span></span>|
| <span data-ttu-id="7d2ea-142">**tvOS**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-142">**tvOS**</span></span> | <span data-ttu-id="7d2ea-143">FairPlay</span><span class="sxs-lookup"><span data-stu-id="7d2ea-143">FairPlay</span></span> | |

<span data-ttu-id="7d2ea-144">Considering the current state of deployment for each DRM, a service typically wants to implement two or three DRMs to make sure you address all the types of endpoints in the best way.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-144">Considering the current state of deployment for each DRM, a service typically wants to implement two or three DRMs to make sure you address all the types of endpoints in the best way.</span></span>

<span data-ttu-id="7d2ea-145">There is a tradeoff between the complexity of the service logic and the complexity on the client side to reach a certain level of user experience on the various clients.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-145">There is a tradeoff between the complexity of the service logic and the complexity on the client side to reach a certain level of user experience on the various clients.</span></span>

<span data-ttu-id="7d2ea-146">To make your selection, keep in mind:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-146">To make your selection, keep in mind:</span></span>

* <span data-ttu-id="7d2ea-147">PlayReady is natively implemented in every Windows device, on some Android devices, and available through software SDKs on virtually any platform.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-147">PlayReady is natively implemented in every Windows device, on some Android devices, and available through software SDKs on virtually any platform.</span></span>
* <span data-ttu-id="7d2ea-148">Widevine is natively implemented in every Android device, in Chrome, and in some other devices.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-148">Widevine is natively implemented in every Android device, in Chrome, and in some other devices.</span></span> <span data-ttu-id="7d2ea-149">Widevine is also supported in Firefox and Opera browsers over DASH.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-149">Widevine is also supported in Firefox and Opera browsers over DASH.</span></span>
* <span data-ttu-id="7d2ea-150">FairPlay is available on iOS, macOS and tvOS.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-150">FairPlay is available on iOS, macOS and tvOS.</span></span>


## <a name="a-reference-design"></a><span data-ttu-id="7d2ea-151">A reference design</span><span class="sxs-lookup"><span data-stu-id="7d2ea-151">A reference design</span></span>
<span data-ttu-id="7d2ea-152">This section presents a reference design that is agnostic to the technologies used to implement it.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-152">This section presents a reference design that is agnostic to the technologies used to implement it.</span></span>

<span data-ttu-id="7d2ea-153">A DRM subsystem can contain the following components:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-153">A DRM subsystem can contain the following components:</span></span>

* <span data-ttu-id="7d2ea-154">Key management</span><span class="sxs-lookup"><span data-stu-id="7d2ea-154">Key management</span></span>
* <span data-ttu-id="7d2ea-155">DRM encryption packaging</span><span class="sxs-lookup"><span data-stu-id="7d2ea-155">DRM encryption packaging</span></span>
* <span data-ttu-id="7d2ea-156">DRM license delivery</span><span class="sxs-lookup"><span data-stu-id="7d2ea-156">DRM license delivery</span></span>
* <span data-ttu-id="7d2ea-157">Entitlement check/access control</span><span class="sxs-lookup"><span data-stu-id="7d2ea-157">Entitlement check/access control</span></span>
* <span data-ttu-id="7d2ea-158">User authentication/authorization</span><span class="sxs-lookup"><span data-stu-id="7d2ea-158">User authentication/authorization</span></span>
* <span data-ttu-id="7d2ea-159">Player app</span><span class="sxs-lookup"><span data-stu-id="7d2ea-159">Player app</span></span>
* <span data-ttu-id="7d2ea-160">Origin/content delivery network (CDN)</span><span class="sxs-lookup"><span data-stu-id="7d2ea-160">Origin/content delivery network (CDN)</span></span>

<span data-ttu-id="7d2ea-161">The following diagram illustrates the high-level interaction among the components in a DRM subsystem:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-161">The following diagram illustrates the high-level interaction among the components in a DRM subsystem:</span></span>

![DRM subsystem with CENC](./media/design-multi-drm-system-with-access-control/media-services-generic-drm-subsystem-with-cenc.png)

<span data-ttu-id="7d2ea-163">The design has three basic layers:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-163">The design has three basic layers:</span></span>

* <span data-ttu-id="7d2ea-164">A back-office layer (black) is not exposed externally.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-164">A back-office layer (black) is not exposed externally.</span></span>
* <span data-ttu-id="7d2ea-165">A DMZ layer (dark blue) contains all the endpoints that face the public.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-165">A DMZ layer (dark blue) contains all the endpoints that face the public.</span></span>
* <span data-ttu-id="7d2ea-166">A public internet layer (light blue) contains the CDN and players with traffic across the public internet.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-166">A public internet layer (light blue) contains the CDN and players with traffic across the public internet.</span></span>

<span data-ttu-id="7d2ea-167">There also should be a content management tool to control DRM protection, regardless of whether it's static or dynamic encryption.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-167">There also should be a content management tool to control DRM protection, regardless of whether it's static or dynamic encryption.</span></span> <span data-ttu-id="7d2ea-168">The inputs for DRM encryption include:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-168">The inputs for DRM encryption include:</span></span>

* <span data-ttu-id="7d2ea-169">MBR video content</span><span class="sxs-lookup"><span data-stu-id="7d2ea-169">MBR video content</span></span>
* <span data-ttu-id="7d2ea-170">Content key</span><span class="sxs-lookup"><span data-stu-id="7d2ea-170">Content key</span></span>
* <span data-ttu-id="7d2ea-171">License acquisition URLs</span><span class="sxs-lookup"><span data-stu-id="7d2ea-171">License acquisition URLs</span></span>

<span data-ttu-id="7d2ea-172">Here's the high-level flow during playback time:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-172">Here's the high-level flow during playback time:</span></span>

* <span data-ttu-id="7d2ea-173">The user is authenticated.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-173">The user is authenticated.</span></span>
* <span data-ttu-id="7d2ea-174">An authorization token is created for the user.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-174">An authorization token is created for the user.</span></span>
* <span data-ttu-id="7d2ea-175">DRM protected content (manifest) is downloaded to the player.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-175">DRM protected content (manifest) is downloaded to the player.</span></span>
* <span data-ttu-id="7d2ea-176">The player submits a license acquisition request to license servers together with a key ID and an authorization token.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-176">The player submits a license acquisition request to license servers together with a key ID and an authorization token.</span></span>

<span data-ttu-id="7d2ea-177">The following section discusses the design of key management.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-177">The following section discusses the design of key management.</span></span>

| <span data-ttu-id="7d2ea-178">**ContentKey-to-asset**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-178">**ContentKey-to-asset**</span></span> | <span data-ttu-id="7d2ea-179">**Scenario**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-179">**Scenario**</span></span> |
| --- | --- |
| <span data-ttu-id="7d2ea-180">1-to-1</span><span class="sxs-lookup"><span data-stu-id="7d2ea-180">1-to-1</span></span> |<span data-ttu-id="7d2ea-181">The simplest case.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-181">The simplest case.</span></span> <span data-ttu-id="7d2ea-182">It provides the finest control.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-182">It provides the finest control.</span></span> <span data-ttu-id="7d2ea-183">But this arrangement generally results in the highest license delivery cost.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-183">But this arrangement generally results in the highest license delivery cost.</span></span> <span data-ttu-id="7d2ea-184">At minimum, one license request is required for each protected asset.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-184">At minimum, one license request is required for each protected asset.</span></span> |
| <span data-ttu-id="7d2ea-185">1-to-many</span><span class="sxs-lookup"><span data-stu-id="7d2ea-185">1-to-many</span></span> |<span data-ttu-id="7d2ea-186">You could use the same content key for multiple assets.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-186">You could use the same content key for multiple assets.</span></span> <span data-ttu-id="7d2ea-187">For example, for all the assets in a logical group, such as a genre or the subset of a genre (or movie gene), you can use a single content key.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-187">For example, for all the assets in a logical group, such as a genre or the subset of a genre (or movie gene), you can use a single content key.</span></span> |
| <span data-ttu-id="7d2ea-188">Many-to-1</span><span class="sxs-lookup"><span data-stu-id="7d2ea-188">Many-to-1</span></span> |<span data-ttu-id="7d2ea-189">Multiple content keys are needed for each asset.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-189">Multiple content keys are needed for each asset.</span></span> <br/><br/><span data-ttu-id="7d2ea-190">For example, if you need to apply dynamic CENC protection with multi-DRM for MPEG-DASH and dynamic AES-128 encryption for HLS, you need two separate content keys.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-190">For example, if you need to apply dynamic CENC protection with multi-DRM for MPEG-DASH and dynamic AES-128 encryption for HLS, you need two separate content keys.</span></span> <span data-ttu-id="7d2ea-191">Each content key needs its own ContentKeyType.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-191">Each content key needs its own ContentKeyType.</span></span> <span data-ttu-id="7d2ea-192">(For the content key used for dynamic CENC protection, use ContentKeyType.CommonEncryption.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-192">(For the content key used for dynamic CENC protection, use ContentKeyType.CommonEncryption.</span></span> <span data-ttu-id="7d2ea-193">For the content key used for dynamic AES-128 encryption, use ContentKeyType.EnvelopeEncryption.)</span><span class="sxs-lookup"><span data-stu-id="7d2ea-193">For the content key used for dynamic AES-128 encryption, use ContentKeyType.EnvelopeEncryption.)</span></span><br/><br/><span data-ttu-id="7d2ea-194">As another example, in CENC protection of DASH content, in theory, you can use one content key to protect the video stream and another content key to protect the audio stream.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-194">As another example, in CENC protection of DASH content, in theory, you can use one content key to protect the video stream and another content key to protect the audio stream.</span></span> |
| <span data-ttu-id="7d2ea-195">Many-to-many</span><span class="sxs-lookup"><span data-stu-id="7d2ea-195">Many-to-many</span></span> |<span data-ttu-id="7d2ea-196">Combination of the previous two scenarios.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-196">Combination of the previous two scenarios.</span></span> <span data-ttu-id="7d2ea-197">One set of content keys is used for each of the multiple assets in the same asset group.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-197">One set of content keys is used for each of the multiple assets in the same asset group.</span></span> |

<span data-ttu-id="7d2ea-198">Another important factor to consider is the use of persistent and nonpersistent licenses.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-198">Another important factor to consider is the use of persistent and nonpersistent licenses.</span></span>

<span data-ttu-id="7d2ea-199">Why are these considerations important?</span><span class="sxs-lookup"><span data-stu-id="7d2ea-199">Why are these considerations important?</span></span>

<span data-ttu-id="7d2ea-200">If you use a public cloud for license delivery, persistent and nonpersistent licenses have a direct impact on license delivery cost.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-200">If you use a public cloud for license delivery, persistent and nonpersistent licenses have a direct impact on license delivery cost.</span></span> <span data-ttu-id="7d2ea-201">The following two different design cases serve to illustrate:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-201">The following two different design cases serve to illustrate:</span></span>

* <span data-ttu-id="7d2ea-202">Monthly subscription: Use a persistent license and 1-to-many content key-to-asset mapping.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-202">Monthly subscription: Use a persistent license and 1-to-many content key-to-asset mapping.</span></span> <span data-ttu-id="7d2ea-203">For example, for all the kids' movies, we use a single content key for encryption.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-203">For example, for all the kids' movies, we use a single content key for encryption.</span></span> <span data-ttu-id="7d2ea-204">In this case:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-204">In this case:</span></span>

    <span data-ttu-id="7d2ea-205">Total number of licenses requested for all kids' movies/device = 1</span><span class="sxs-lookup"><span data-stu-id="7d2ea-205">Total number of licenses requested for all kids' movies/device = 1</span></span>

* <span data-ttu-id="7d2ea-206">Monthly subscription: Use a nonpersistent license and 1-to-1 mapping between content key and asset.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-206">Monthly subscription: Use a nonpersistent license and 1-to-1 mapping between content key and asset.</span></span> <span data-ttu-id="7d2ea-207">In this case:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-207">In this case:</span></span>

    <span data-ttu-id="7d2ea-208">Total number of licenses requested for all kids' movies/device = [number of movies watched] x [number of sessions]</span><span class="sxs-lookup"><span data-stu-id="7d2ea-208">Total number of licenses requested for all kids' movies/device = [number of movies watched] x [number of sessions]</span></span>

<span data-ttu-id="7d2ea-209">The two different designs result in very different license request patterns.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-209">The two different designs result in very different license request patterns.</span></span> <span data-ttu-id="7d2ea-210">The different patterns result in different license delivery cost if license delivery service is provided by a public cloud such as Media Services.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-210">The different patterns result in different license delivery cost if license delivery service is provided by a public cloud such as Media Services.</span></span>

## <a name="map-design-to-technology-for-implementation"></a><span data-ttu-id="7d2ea-211">Map design to technology for implementation</span><span class="sxs-lookup"><span data-stu-id="7d2ea-211">Map design to technology for implementation</span></span>
<span data-ttu-id="7d2ea-212">Next, the generic design is mapped to technologies on the Azure/Media Services platform by specifying which technology to use for each building block.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-212">Next, the generic design is mapped to technologies on the Azure/Media Services platform by specifying which technology to use for each building block.</span></span>

<span data-ttu-id="7d2ea-213">The following table shows the mapping.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-213">The following table shows the mapping.</span></span>

| <span data-ttu-id="7d2ea-214">**Building block**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-214">**Building block**</span></span> | <span data-ttu-id="7d2ea-215">**Technology**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-215">**Technology**</span></span> |
| --- | --- |
| <span data-ttu-id="7d2ea-216">**Player**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-216">**Player**</span></span> |[<span data-ttu-id="7d2ea-217">Azure Media Player</span><span class="sxs-lookup"><span data-stu-id="7d2ea-217">Azure Media Player</span></span>](https://azure.microsoft.com/services/media-services/media-player/) |
| <span data-ttu-id="7d2ea-218">**Identity Provider (IDP)**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-218">**Identity Provider (IDP)**</span></span> |<span data-ttu-id="7d2ea-219">Azure Active Directory (Azure AD)</span><span class="sxs-lookup"><span data-stu-id="7d2ea-219">Azure Active Directory (Azure AD)</span></span> |
| <span data-ttu-id="7d2ea-220">**Secure Token Service (STS)**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-220">**Secure Token Service (STS)**</span></span> |<span data-ttu-id="7d2ea-221">Azure AD</span><span class="sxs-lookup"><span data-stu-id="7d2ea-221">Azure AD</span></span> |
| <span data-ttu-id="7d2ea-222">**DRM protection workflow**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-222">**DRM protection workflow**</span></span> |<span data-ttu-id="7d2ea-223">Azure Media Services dynamic protection</span><span class="sxs-lookup"><span data-stu-id="7d2ea-223">Azure Media Services dynamic protection</span></span> |
| <span data-ttu-id="7d2ea-224">**DRM license delivery**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-224">**DRM license delivery**</span></span> |<span data-ttu-id="7d2ea-225">\* Media Services license delivery (PlayReady, Widevine, FairPlay)</span><span class="sxs-lookup"><span data-stu-id="7d2ea-225">\* Media Services license delivery (PlayReady, Widevine, FairPlay)</span></span> <br/><span data-ttu-id="7d2ea-226">\* Axinom license server</span><span class="sxs-lookup"><span data-stu-id="7d2ea-226">\* Axinom license server</span></span> <br/><span data-ttu-id="7d2ea-227">\* Custom PlayReady license server</span><span class="sxs-lookup"><span data-stu-id="7d2ea-227">\* Custom PlayReady license server</span></span> |
| <span data-ttu-id="7d2ea-228">**Origin**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-228">**Origin**</span></span> |<span data-ttu-id="7d2ea-229">Azure Media Services streaming endpoint</span><span class="sxs-lookup"><span data-stu-id="7d2ea-229">Azure Media Services streaming endpoint</span></span> |
| <span data-ttu-id="7d2ea-230">**Key management**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-230">**Key management**</span></span> |<span data-ttu-id="7d2ea-231">Not needed for reference implementation</span><span class="sxs-lookup"><span data-stu-id="7d2ea-231">Not needed for reference implementation</span></span> |
| <span data-ttu-id="7d2ea-232">**Content management**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-232">**Content management**</span></span> |<span data-ttu-id="7d2ea-233">A C# console application</span><span class="sxs-lookup"><span data-stu-id="7d2ea-233">A C# console application</span></span> |

<span data-ttu-id="7d2ea-234">In other words, both IDP and STS are provided by Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-234">In other words, both IDP and STS are provided by Azure AD.</span></span> <span data-ttu-id="7d2ea-235">The [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/) is used for the player.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-235">The [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/) is used for the player.</span></span> <span data-ttu-id="7d2ea-236">Both Azure Media Services and Azure Media Player support CENC over DASH, FairPlay over HLS, PlayReady over smooth streaming, and AES-128 ecnryption for DASH, HLS and smooth.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-236">Both Azure Media Services and Azure Media Player support CENC over DASH, FairPlay over HLS, PlayReady over smooth streaming, and AES-128 ecnryption for DASH, HLS and smooth.</span></span>

<span data-ttu-id="7d2ea-237">The following diagram shows the overall structure and flow with the previous technology mapping:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-237">The following diagram shows the overall structure and flow with the previous technology mapping:</span></span>

![CENC on Media Services](./media/design-multi-drm-system-with-access-control/media-services-cenc-subsystem-on-AMS-platform.png)

<span data-ttu-id="7d2ea-239">To set up DRM content protection, the content management tool uses the following inputs:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-239">To set up DRM content protection, the content management tool uses the following inputs:</span></span>

* <span data-ttu-id="7d2ea-240">Open content</span><span class="sxs-lookup"><span data-stu-id="7d2ea-240">Open content</span></span>
* <span data-ttu-id="7d2ea-241">Content key from key management</span><span class="sxs-lookup"><span data-stu-id="7d2ea-241">Content key from key management</span></span>
* <span data-ttu-id="7d2ea-242">License acquisition URLs</span><span class="sxs-lookup"><span data-stu-id="7d2ea-242">License acquisition URLs</span></span>
* <span data-ttu-id="7d2ea-243">A list of information from Azure AD, such as audience, issuer, and token claims</span><span class="sxs-lookup"><span data-stu-id="7d2ea-243">A list of information from Azure AD, such as audience, issuer, and token claims</span></span>

<span data-ttu-id="7d2ea-244">Here's the output of the content management tool:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-244">Here's the output of the content management tool:</span></span>

* <span data-ttu-id="7d2ea-245">ContentKeyPolicy describes DRM license template for each kind of DRM used;</span><span class="sxs-lookup"><span data-stu-id="7d2ea-245">ContentKeyPolicy describes DRM license template for each kind of DRM used;</span></span>
* <span data-ttu-id="7d2ea-246">ContentKeyPolicyRestriction describes the access control before a DRM license is issued</span><span class="sxs-lookup"><span data-stu-id="7d2ea-246">ContentKeyPolicyRestriction describes the access control before a DRM license is issued</span></span>
* <span data-ttu-id="7d2ea-247">Streamingpolicy describes the various combinations of DRM - encryption mode - streaming protocol - container format, for streaming</span><span class="sxs-lookup"><span data-stu-id="7d2ea-247">Streamingpolicy describes the various combinations of DRM - encryption mode - streaming protocol - container format, for streaming</span></span>
* <span data-ttu-id="7d2ea-248">StreamingLocator describes content key/IV used for encryption, and streaming URLs</span><span class="sxs-lookup"><span data-stu-id="7d2ea-248">StreamingLocator describes content key/IV used for encryption, and streaming URLs</span></span> 

<span data-ttu-id="7d2ea-249">Here's the flow during runtime:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-249">Here's the flow during runtime:</span></span>

* <span data-ttu-id="7d2ea-250">Upon user authentication, a JWT is generated.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-250">Upon user authentication, a JWT is generated.</span></span>
* <span data-ttu-id="7d2ea-251">One of the claims contained in the JWT is a groups claim that contains the group object ID EntitledUserGroup.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-251">One of the claims contained in the JWT is a groups claim that contains the group object ID EntitledUserGroup.</span></span> <span data-ttu-id="7d2ea-252">This claim is used to pass the entitlement check.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-252">This claim is used to pass the entitlement check.</span></span>
* <span data-ttu-id="7d2ea-253">The player downloads the client manifest of CENC-protected content and identifies the following:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-253">The player downloads the client manifest of CENC-protected content and identifies the following:</span></span>
   * <span data-ttu-id="7d2ea-254">Key ID.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-254">Key ID.</span></span>
   * <span data-ttu-id="7d2ea-255">The content is DRM protected.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-255">The content is DRM protected.</span></span>
   * <span data-ttu-id="7d2ea-256">License acquisition URLs.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-256">License acquisition URLs.</span></span>
* <span data-ttu-id="7d2ea-257">The player makes a license acquisition request based on the browser/DRM supported.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-257">The player makes a license acquisition request based on the browser/DRM supported.</span></span> <span data-ttu-id="7d2ea-258">In the license acquisition request, the key ID and the JWT are also submitted.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-258">In the license acquisition request, the key ID and the JWT are also submitted.</span></span> <span data-ttu-id="7d2ea-259">The license delivery service verifies the JWT and the claims contained before it issues the needed license.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-259">The license delivery service verifies the JWT and the claims contained before it issues the needed license.</span></span>

## <a name="implementation"></a><span data-ttu-id="7d2ea-260">Implementation</span><span class="sxs-lookup"><span data-stu-id="7d2ea-260">Implementation</span></span>
### <a name="implementation-procedures"></a><span data-ttu-id="7d2ea-261">Implementation procedures</span><span class="sxs-lookup"><span data-stu-id="7d2ea-261">Implementation procedures</span></span>
<span data-ttu-id="7d2ea-262">Implementation includes the following steps:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-262">Implementation includes the following steps:</span></span>

1. <span data-ttu-id="7d2ea-263">Prepare test assets.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-263">Prepare test assets.</span></span> <span data-ttu-id="7d2ea-264">Encode/package a test video to multi-bitrate fragmented MP4 in Media Services.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-264">Encode/package a test video to multi-bitrate fragmented MP4 in Media Services.</span></span> <span data-ttu-id="7d2ea-265">This asset is *not* DRM protected.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-265">This asset is *not* DRM protected.</span></span> <span data-ttu-id="7d2ea-266">DRM protection is done by dynamic protection later.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-266">DRM protection is done by dynamic protection later.</span></span>

2. <span data-ttu-id="7d2ea-267">Create a key ID and a content key (optionally from a key seed).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-267">Create a key ID and a content key (optionally from a key seed).</span></span> <span data-ttu-id="7d2ea-268">In this instance, the key management system isn't needed because only a single key ID and content key are required for a couple of test assets.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-268">In this instance, the key management system isn't needed because only a single key ID and content key are required for a couple of test assets.</span></span>

3. <span data-ttu-id="7d2ea-269">Use the Media Services API to configure multi-DRM license delivery services for the test asset.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-269">Use the Media Services API to configure multi-DRM license delivery services for the test asset.</span></span> <span data-ttu-id="7d2ea-270">If you use custom license servers by your company or your company's vendors instead of license services in Media Services, you can skip this step.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-270">If you use custom license servers by your company or your company's vendors instead of license services in Media Services, you can skip this step.</span></span> <span data-ttu-id="7d2ea-271">You can specify license acquisition URLs in the step when you configure license delivery.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-271">You can specify license acquisition URLs in the step when you configure license delivery.</span></span> <span data-ttu-id="7d2ea-272">The Media Services API is needed to specify some detailed configurations, such as authorization policy restriction and license response templates for different DRM license services.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-272">The Media Services API is needed to specify some detailed configurations, such as authorization policy restriction and license response templates for different DRM license services.</span></span> <span data-ttu-id="7d2ea-273">At this time, the Azure portal doesn't provide the needed UI for this configuration.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-273">At this time, the Azure portal doesn't provide the needed UI for this configuration.</span></span> <span data-ttu-id="7d2ea-274">For API-level information and sample code, see [Use PlayReady and/or Widevine dynamic common encryption](protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-274">For API-level information and sample code, see [Use PlayReady and/or Widevine dynamic common encryption](protect-with-drm.md).</span></span>

4. <span data-ttu-id="7d2ea-275">Use the Media Services API to configure the asset delivery policy for the test asset.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-275">Use the Media Services API to configure the asset delivery policy for the test asset.</span></span> <span data-ttu-id="7d2ea-276">For API-level information and sample code, see [Use PlayReady and/or Widevine dynamic common encryption](protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-276">For API-level information and sample code, see [Use PlayReady and/or Widevine dynamic common encryption](protect-with-drm.md).</span></span>

5. <span data-ttu-id="7d2ea-277">Create and configure an Azure AD tenant in Azure.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-277">Create and configure an Azure AD tenant in Azure.</span></span>

6. <span data-ttu-id="7d2ea-278">Create a few user accounts and groups in your Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-278">Create a few user accounts and groups in your Azure AD tenant.</span></span> <span data-ttu-id="7d2ea-279">Create at least an "Entitled User" group, and add a user to this group.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-279">Create at least an "Entitled User" group, and add a user to this group.</span></span> <span data-ttu-id="7d2ea-280">Users in this group pass the entitlement check in license acquisition.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-280">Users in this group pass the entitlement check in license acquisition.</span></span> <span data-ttu-id="7d2ea-281">Users not in this group fail to pass the authentication check and can't acquire a license.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-281">Users not in this group fail to pass the authentication check and can't acquire a license.</span></span> <span data-ttu-id="7d2ea-282">Membership in this "Entitled User" group is a required groups claim in the JWT issued by Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-282">Membership in this "Entitled User" group is a required groups claim in the JWT issued by Azure AD.</span></span> <span data-ttu-id="7d2ea-283">You specify this claim requirement in the step when you configure multi-DRM license delivery services.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-283">You specify this claim requirement in the step when you configure multi-DRM license delivery services.</span></span>

7. <span data-ttu-id="7d2ea-284">Create an ASP.NET MVC app to host your video player.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-284">Create an ASP.NET MVC app to host your video player.</span></span> <span data-ttu-id="7d2ea-285">This ASP.NET app is protected with user authentication against the Azure AD tenant.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-285">This ASP.NET app is protected with user authentication against the Azure AD tenant.</span></span> <span data-ttu-id="7d2ea-286">Proper claims are included in the access tokens obtained after user authentication.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-286">Proper claims are included in the access tokens obtained after user authentication.</span></span> <span data-ttu-id="7d2ea-287">We recommend OpenID Connect API for this step.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-287">We recommend OpenID Connect API for this step.</span></span> <span data-ttu-id="7d2ea-288">Install the following NuGet packages:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-288">Install the following NuGet packages:</span></span>

   * <span data-ttu-id="7d2ea-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span><span class="sxs-lookup"><span data-stu-id="7d2ea-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span></span>
   * <span data-ttu-id="7d2ea-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span><span class="sxs-lookup"><span data-stu-id="7d2ea-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span></span>
   * <span data-ttu-id="7d2ea-291">Install-Package Microsoft.Owin.Security.Cookies</span><span class="sxs-lookup"><span data-stu-id="7d2ea-291">Install-Package Microsoft.Owin.Security.Cookies</span></span>
   * <span data-ttu-id="7d2ea-292">Install-Package Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="7d2ea-292">Install-Package Microsoft.Owin.Host.SystemWeb</span></span>
   * <span data-ttu-id="7d2ea-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span><span class="sxs-lookup"><span data-stu-id="7d2ea-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span></span>

8. <span data-ttu-id="7d2ea-294">Create a player by using the [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-294">Create a player by using the [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="7d2ea-295">Use the [Azure Media Player ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) to specify which DRM technology to use on different DRM platforms.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-295">Use the [Azure Media Player ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) to specify which DRM technology to use on different DRM platforms.</span></span>

9. <span data-ttu-id="7d2ea-296">The following table shows the test matrix.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-296">The following table shows the test matrix.</span></span>

    | <span data-ttu-id="7d2ea-297">**DRM**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-297">**DRM**</span></span> | <span data-ttu-id="7d2ea-298">**Browser**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-298">**Browser**</span></span> | <span data-ttu-id="7d2ea-299">**Result for entitled user**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-299">**Result for entitled user**</span></span> | <span data-ttu-id="7d2ea-300">**Result for unentitled user**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-300">**Result for unentitled user**</span></span> |
    | --- | --- | --- | --- |
    | <span data-ttu-id="7d2ea-301">**PlayReady**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-301">**PlayReady**</span></span> |<span data-ttu-id="7d2ea-302">Microsoft Edge or Internet Explorer 11 on Windows 10</span><span class="sxs-lookup"><span data-stu-id="7d2ea-302">Microsoft Edge or Internet Explorer 11 on Windows 10</span></span> |<span data-ttu-id="7d2ea-303">Succeed</span><span class="sxs-lookup"><span data-stu-id="7d2ea-303">Succeed</span></span> |<span data-ttu-id="7d2ea-304">Fail</span><span class="sxs-lookup"><span data-stu-id="7d2ea-304">Fail</span></span> |
    | <span data-ttu-id="7d2ea-305">**Widevine**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-305">**Widevine**</span></span> |<span data-ttu-id="7d2ea-306">Chrome, Firefox, Opera</span><span class="sxs-lookup"><span data-stu-id="7d2ea-306">Chrome, Firefox, Opera</span></span> |<span data-ttu-id="7d2ea-307">Succeed</span><span class="sxs-lookup"><span data-stu-id="7d2ea-307">Succeed</span></span> |<span data-ttu-id="7d2ea-308">Fail</span><span class="sxs-lookup"><span data-stu-id="7d2ea-308">Fail</span></span> |
    | <span data-ttu-id="7d2ea-309">**FairPlay**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-309">**FairPlay**</span></span> |<span data-ttu-id="7d2ea-310">Safari on macOS</span><span class="sxs-lookup"><span data-stu-id="7d2ea-310">Safari on macOS</span></span>      |<span data-ttu-id="7d2ea-311">Succeed</span><span class="sxs-lookup"><span data-stu-id="7d2ea-311">Succeed</span></span> |<span data-ttu-id="7d2ea-312">Fail</span><span class="sxs-lookup"><span data-stu-id="7d2ea-312">Fail</span></span> |
    | <span data-ttu-id="7d2ea-313">**AES-128**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-313">**AES-128**</span></span> |<span data-ttu-id="7d2ea-314">Most modern browsers</span><span class="sxs-lookup"><span data-stu-id="7d2ea-314">Most modern browsers</span></span>  |<span data-ttu-id="7d2ea-315">Succeed</span><span class="sxs-lookup"><span data-stu-id="7d2ea-315">Succeed</span></span> |<span data-ttu-id="7d2ea-316">Fail</span><span class="sxs-lookup"><span data-stu-id="7d2ea-316">Fail</span></span> |

<span data-ttu-id="7d2ea-317">For information on how to set up Azure AD for an ASP.NET MVC player app, see [Integrate an Azure Media Services OWIN MVC-based app with Azure Active Directory and restrict content key delivery based on JWT claims](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-317">For information on how to set up Azure AD for an ASP.NET MVC player app, see [Integrate an Azure Media Services OWIN MVC-based app with Azure Active Directory and restrict content key delivery based on JWT claims](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span></span>

<span data-ttu-id="7d2ea-318">For more information, see [JWT token authentication in Azure Media Services and dynamic encryption](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-318">For more information, see [JWT token authentication in Azure Media Services and dynamic encryption](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span>  

<span data-ttu-id="7d2ea-319">For information on Azure AD:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-319">For information on Azure AD:</span></span>

* <span data-ttu-id="7d2ea-320">You can find developer information in the [Azure Active Directory developer's guide](../../active-directory/develop/azure-ad-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-320">You can find developer information in the [Azure Active Directory developer's guide](../../active-directory/develop/azure-ad-developers-guide.md).</span></span>
* <span data-ttu-id="7d2ea-321">You can find administrator information in [Administer your Azure AD tenant directory](../../active-directory/fundamentals/active-directory-administer.md).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-321">You can find administrator information in [Administer your Azure AD tenant directory](../../active-directory/fundamentals/active-directory-administer.md).</span></span>

### <a name="some-issues-in-implementation"></a><span data-ttu-id="7d2ea-322">Some issues in implementation</span><span class="sxs-lookup"><span data-stu-id="7d2ea-322">Some issues in implementation</span></span>
<span data-ttu-id="7d2ea-323">Use the following troubleshooting information for help with implementation issues.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-323">Use the following troubleshooting information for help with implementation issues.</span></span>

* <span data-ttu-id="7d2ea-324">The issuer URL must end with "/".</span><span class="sxs-lookup"><span data-stu-id="7d2ea-324">The issuer URL must end with "/".</span></span> <span data-ttu-id="7d2ea-325">The audience must be the player application client ID.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-325">The audience must be the player application client ID.</span></span> <span data-ttu-id="7d2ea-326">Also, add "/" at the end of the issuer URL.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-326">Also, add "/" at the end of the issuer URL.</span></span>

        <add key="ida:audience" value="[Application Client ID GUID]" />
        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/" />

    <span data-ttu-id="7d2ea-327">In the [JWT Decoder](http://jwt.calebb.net/), you see **aud** and **iss**, as shown in the JWT:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-327">In the [JWT Decoder](http://jwt.calebb.net/), you see **aud** and **iss**, as shown in the JWT:</span></span>

    ![JWT](./media/design-multi-drm-system-with-access-control/media-services-1st-gotcha.png)

* <span data-ttu-id="7d2ea-329">Add permissions to the application in Azure AD on the **Configure** tab of the application.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-329">Add permissions to the application in Azure AD on the **Configure** tab of the application.</span></span> <span data-ttu-id="7d2ea-330">Permissions are required for each application, both local and deployed versions.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-330">Permissions are required for each application, both local and deployed versions.</span></span>

    ![Permissions](./media/design-multi-drm-system-with-access-control/media-services-perms-to-other-apps.png)

* <span data-ttu-id="7d2ea-332">Use the correct issuer when you set up dynamic CENC protection.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-332">Use the correct issuer when you set up dynamic CENC protection.</span></span>

        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/"/>

    <span data-ttu-id="7d2ea-333">The following doesn't work:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-333">The following doesn't work:</span></span>

        <add key="ida:issuer" value="https://willzhanad.onmicrosoft.com/" />

    <span data-ttu-id="7d2ea-334">The GUID is the Azure AD tenant ID.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-334">The GUID is the Azure AD tenant ID.</span></span> <span data-ttu-id="7d2ea-335">The GUID can be found in the **Endpoints** pop-up menu in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-335">The GUID can be found in the **Endpoints** pop-up menu in the Azure portal.</span></span>

* <span data-ttu-id="7d2ea-336">Grant group membership claims privileges.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-336">Grant group membership claims privileges.</span></span> <span data-ttu-id="7d2ea-337">Make sure the following is in the Azure AD application manifest file:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-337">Make sure the following is in the Azure AD application manifest file:</span></span> 

    <span data-ttu-id="7d2ea-338">"groupMembershipClaims": "All"    (the default value is null)</span><span class="sxs-lookup"><span data-stu-id="7d2ea-338">"groupMembershipClaims": "All"    (the default value is null)</span></span>

* <span data-ttu-id="7d2ea-339">Set the proper TokenType when you create restriction requirements.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-339">Set the proper TokenType when you create restriction requirements.</span></span>

        objTokenRestrictionTemplate.TokenType = TokenType.JWT;

    <span data-ttu-id="7d2ea-340">Because you add support for JWT (Azure AD) in addition to SWT (ACS), the default TokenType is TokenType.JWT.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-340">Because you add support for JWT (Azure AD) in addition to SWT (ACS), the default TokenType is TokenType.JWT.</span></span> <span data-ttu-id="7d2ea-341">If you use SWT/ACS, you must set the token to TokenType.SWT.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-341">If you use SWT/ACS, you must set the token to TokenType.SWT.</span></span>

## <a name="faqs"></a><span data-ttu-id="7d2ea-342">FAQs</span><span class="sxs-lookup"><span data-stu-id="7d2ea-342">FAQs</span></span>

<span data-ttu-id="7d2ea-343">This section discusses some additional topics in design and implementation.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-343">This section discusses some additional topics in design and implementation.</span></span>

### <a name="http-or-https"></a><span data-ttu-id="7d2ea-344">HTTP or HTTPS?</span><span class="sxs-lookup"><span data-stu-id="7d2ea-344">HTTP or HTTPS?</span></span>
<span data-ttu-id="7d2ea-345">The ASP.NET MVC player application must support the following:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-345">The ASP.NET MVC player application must support the following:</span></span>

* <span data-ttu-id="7d2ea-346">User authentication through Azure AD, which is under HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-346">User authentication through Azure AD, which is under HTTPS.</span></span>
* <span data-ttu-id="7d2ea-347">JWT exchange between the client and Azure AD, which is under HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-347">JWT exchange between the client and Azure AD, which is under HTTPS.</span></span>
* <span data-ttu-id="7d2ea-348">DRM license acquisition by the client, which must be under HTTPS if license delivery is provided by Media Services.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-348">DRM license acquisition by the client, which must be under HTTPS if license delivery is provided by Media Services.</span></span> <span data-ttu-id="7d2ea-349">The PlayReady product suite doesn't mandate HTTPS for license delivery.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-349">The PlayReady product suite doesn't mandate HTTPS for license delivery.</span></span> <span data-ttu-id="7d2ea-350">If your PlayReady license server is outside Media Services, you can use either HTTP or HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-350">If your PlayReady license server is outside Media Services, you can use either HTTP or HTTPS.</span></span>

<span data-ttu-id="7d2ea-351">The ASP.NET player application uses HTTPS as a best practice, so Media Player is on a page under HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-351">The ASP.NET player application uses HTTPS as a best practice, so Media Player is on a page under HTTPS.</span></span> <span data-ttu-id="7d2ea-352">However, HTTP is preferred for streaming, so you need to consider the issue of mixed content.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-352">However, HTTP is preferred for streaming, so you need to consider the issue of mixed content.</span></span>

* <span data-ttu-id="7d2ea-353">The browser doesn't allow mixed content.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-353">The browser doesn't allow mixed content.</span></span> <span data-ttu-id="7d2ea-354">But plug-ins like Silverlight and the OSMF plug-in for smooth and DASH do allow it.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-354">But plug-ins like Silverlight and the OSMF plug-in for smooth and DASH do allow it.</span></span> <span data-ttu-id="7d2ea-355">Mixed content is a security concern because of the threat of the ability to inject malicious JavaScript, which can cause customer data to be at risk.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-355">Mixed content is a security concern because of the threat of the ability to inject malicious JavaScript, which can cause customer data to be at risk.</span></span> <span data-ttu-id="7d2ea-356">Browsers block this capability by default.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-356">Browsers block this capability by default.</span></span> <span data-ttu-id="7d2ea-357">The only way to work around it is on the server (origin) side by allowing all domains (regardless of HTTPS or HTTP).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-357">The only way to work around it is on the server (origin) side by allowing all domains (regardless of HTTPS or HTTP).</span></span> <span data-ttu-id="7d2ea-358">This is probably not a good idea either.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-358">This is probably not a good idea either.</span></span>
* <span data-ttu-id="7d2ea-359">Avoid mixed content.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-359">Avoid mixed content.</span></span> <span data-ttu-id="7d2ea-360">Both the player application and Media Player should use HTTP or HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-360">Both the player application and Media Player should use HTTP or HTTPS.</span></span> <span data-ttu-id="7d2ea-361">When playing mixed content, the silverlightSS tech requires clearing a mixed-content warning.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-361">When playing mixed content, the silverlightSS tech requires clearing a mixed-content warning.</span></span> <span data-ttu-id="7d2ea-362">The flashSS tech handles mixed content without a mixed-content warning.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-362">The flashSS tech handles mixed content without a mixed-content warning.</span></span>
* <span data-ttu-id="7d2ea-363">If your streaming endpoint was created before August 2014, it won't support HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-363">If your streaming endpoint was created before August 2014, it won't support HTTPS.</span></span> <span data-ttu-id="7d2ea-364">In this case, create and use a new streaming endpoint for HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-364">In this case, create and use a new streaming endpoint for HTTPS.</span></span>

<span data-ttu-id="7d2ea-365">In the reference implementation for DRM-protected contents, both the application and streaming are under HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-365">In the reference implementation for DRM-protected contents, both the application and streaming are under HTTPS.</span></span> <span data-ttu-id="7d2ea-366">For open contents, the player doesn't need authentication or a license, so you can use either HTTP or HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-366">For open contents, the player doesn't need authentication or a license, so you can use either HTTP or HTTPS.</span></span>

### <a name="what-is-azure-active-directory-signing-key-rollover"></a><span data-ttu-id="7d2ea-367">What is Azure Active Directory signing key rollover?</span><span class="sxs-lookup"><span data-stu-id="7d2ea-367">What is Azure Active Directory signing key rollover?</span></span>
<span data-ttu-id="7d2ea-368">Signing key rollover is an important point to take into consideration in your implementation.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-368">Signing key rollover is an important point to take into consideration in your implementation.</span></span> <span data-ttu-id="7d2ea-369">If you ignore it, the finished system eventually stops working completely, within six weeks at the most.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-369">If you ignore it, the finished system eventually stops working completely, within six weeks at the most.</span></span>

<span data-ttu-id="7d2ea-370">Azure AD uses industry standards to establish trust between itself and applications that use Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-370">Azure AD uses industry standards to establish trust between itself and applications that use Azure AD.</span></span> <span data-ttu-id="7d2ea-371">Specifically, Azure AD uses a signing key that consists of a public and private key pair.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-371">Specifically, Azure AD uses a signing key that consists of a public and private key pair.</span></span> <span data-ttu-id="7d2ea-372">When Azure AD creates a security token that contains information about the user, it's signed by Azure AD with a private key before it's sent back to the application.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-372">When Azure AD creates a security token that contains information about the user, it's signed by Azure AD with a private key before it's sent back to the application.</span></span> <span data-ttu-id="7d2ea-373">To verify that the token is valid and originated from Azure AD, the application must validate the token's signature.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-373">To verify that the token is valid and originated from Azure AD, the application must validate the token's signature.</span></span> <span data-ttu-id="7d2ea-374">The application uses the public key exposed by Azure AD that is contained in the tenant's federation metadata document.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-374">The application uses the public key exposed by Azure AD that is contained in the tenant's federation metadata document.</span></span> <span data-ttu-id="7d2ea-375">This public key, and the signing key from which it derives, is the same one used for all tenants in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-375">This public key, and the signing key from which it derives, is the same one used for all tenants in Azure AD.</span></span>

<span data-ttu-id="7d2ea-376">For more information on Azure AD key rollover, see [Important information about signing key rollover in Azure AD](../../active-directory/active-directory-signing-key-rollover.md).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-376">For more information on Azure AD key rollover, see [Important information about signing key rollover in Azure AD](../../active-directory/active-directory-signing-key-rollover.md).</span></span>

<span data-ttu-id="7d2ea-377">Between the [public-private key pair](https://login.microsoftonline.com/common/discovery/keys/):</span><span class="sxs-lookup"><span data-stu-id="7d2ea-377">Between the [public-private key pair](https://login.microsoftonline.com/common/discovery/keys/):</span></span>

* <span data-ttu-id="7d2ea-378">The private key is used by Azure AD to generate a JWT.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-378">The private key is used by Azure AD to generate a JWT.</span></span>
* <span data-ttu-id="7d2ea-379">The public key is used by an application such as DRM license delivery services in Media Services to verify the JWT.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-379">The public key is used by an application such as DRM license delivery services in Media Services to verify the JWT.</span></span>

<span data-ttu-id="7d2ea-380">For security purposes, Azure AD rotates the certificate periodically (every six weeks).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-380">For security purposes, Azure AD rotates the certificate periodically (every six weeks).</span></span> <span data-ttu-id="7d2ea-381">In the case of security breaches, the key rollover can occur any time.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-381">In the case of security breaches, the key rollover can occur any time.</span></span> <span data-ttu-id="7d2ea-382">Therefore, the license delivery services in Media Services need to update the public key used as Azure AD rotates the key pair.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-382">Therefore, the license delivery services in Media Services need to update the public key used as Azure AD rotates the key pair.</span></span> <span data-ttu-id="7d2ea-383">Otherwise, token authentication in Media Services fails and no license is issued.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-383">Otherwise, token authentication in Media Services fails and no license is issued.</span></span>

<span data-ttu-id="7d2ea-384">To set up this service, you set TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument when you configure DRM license delivery services.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-384">To set up this service, you set TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument when you configure DRM license delivery services.</span></span>

<span data-ttu-id="7d2ea-385">Here's the JWT flow:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-385">Here's the JWT flow:</span></span>

* <span data-ttu-id="7d2ea-386">Azure AD issues the JWT with the current private key for an authenticated user.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-386">Azure AD issues the JWT with the current private key for an authenticated user.</span></span>
* <span data-ttu-id="7d2ea-387">When a player sees a CENC with multi-DRM protected content, it first locates the JWT issued by Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-387">When a player sees a CENC with multi-DRM protected content, it first locates the JWT issued by Azure AD.</span></span>
* <span data-ttu-id="7d2ea-388">The player sends a license acquisition request with the JWT to license delivery services in Media Services.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-388">The player sends a license acquisition request with the JWT to license delivery services in Media Services.</span></span>
* <span data-ttu-id="7d2ea-389">The license delivery services in Media Services use the current/valid public key from Azure AD to verify the JWT before issuing licenses.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-389">The license delivery services in Media Services use the current/valid public key from Azure AD to verify the JWT before issuing licenses.</span></span>

<span data-ttu-id="7d2ea-390">DRM license delivery services always check for the current/valid public key from Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-390">DRM license delivery services always check for the current/valid public key from Azure AD.</span></span> <span data-ttu-id="7d2ea-391">The public key presented by Azure AD is the key used to verify a JWT issued by Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-391">The public key presented by Azure AD is the key used to verify a JWT issued by Azure AD.</span></span>

<span data-ttu-id="7d2ea-392">What if the key rollover happens after Azure AD generates a JWT but before the JWT is sent by players to DRM license delivery services in Media Services for verification?</span><span class="sxs-lookup"><span data-stu-id="7d2ea-392">What if the key rollover happens after Azure AD generates a JWT but before the JWT is sent by players to DRM license delivery services in Media Services for verification?</span></span>

<span data-ttu-id="7d2ea-393">Because a key can be rolled over at any moment, more than one valid public key is always available in the federation metadata document.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-393">Because a key can be rolled over at any moment, more than one valid public key is always available in the federation metadata document.</span></span> <span data-ttu-id="7d2ea-394">Media Services license delivery can use any of the keys specified in the document.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-394">Media Services license delivery can use any of the keys specified in the document.</span></span> <span data-ttu-id="7d2ea-395">Because one key might be rolled soon, another might be its replacement, and so forth.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-395">Because one key might be rolled soon, another might be its replacement, and so forth.</span></span>

### <a name="where-is-the-access-token"></a><span data-ttu-id="7d2ea-396">Where is the access token?</span><span class="sxs-lookup"><span data-stu-id="7d2ea-396">Where is the access token?</span></span>
<span data-ttu-id="7d2ea-397">If you look at how a web app calls an API app under [Application identity with OAuth 2.0 client credentials grant](../../active-directory/develop/authentication-scenarios.md#web-application-to-web-api), the authentication flow is as follows:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-397">If you look at how a web app calls an API app under [Application identity with OAuth 2.0 client credentials grant](../../active-directory/develop/authentication-scenarios.md#web-application-to-web-api), the authentication flow is as follows:</span></span>

* <span data-ttu-id="7d2ea-398">A user signs in to Azure AD in the web application.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-398">A user signs in to Azure AD in the web application.</span></span> <span data-ttu-id="7d2ea-399">For more information, see [Web browser to web application](../../active-directory/develop/authentication-scenarios.md#web-browser-to-web-application).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-399">For more information, see [Web browser to web application](../../active-directory/develop/authentication-scenarios.md#web-browser-to-web-application).</span></span>
* <span data-ttu-id="7d2ea-400">The Azure AD authorization endpoint redirects the user agent back to the client application with an authorization code.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-400">The Azure AD authorization endpoint redirects the user agent back to the client application with an authorization code.</span></span> <span data-ttu-id="7d2ea-401">The user agent returns the authorization code to the client application's redirect URI.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-401">The user agent returns the authorization code to the client application's redirect URI.</span></span>
* <span data-ttu-id="7d2ea-402">The web application needs to acquire an access token so that it can authenticate to the web API and retrieve the desired resource.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-402">The web application needs to acquire an access token so that it can authenticate to the web API and retrieve the desired resource.</span></span> <span data-ttu-id="7d2ea-403">It makes a request to the Azure AD token endpoint and provides the credential, client ID, and web API's application ID URI.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-403">It makes a request to the Azure AD token endpoint and provides the credential, client ID, and web API's application ID URI.</span></span> <span data-ttu-id="7d2ea-404">It presents the authorization code to prove that the user consented.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-404">It presents the authorization code to prove that the user consented.</span></span>
* <span data-ttu-id="7d2ea-405">Azure AD authenticates the application and returns a JWT access token that's used to call the web API.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-405">Azure AD authenticates the application and returns a JWT access token that's used to call the web API.</span></span>
* <span data-ttu-id="7d2ea-406">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a "Bearer" designation in the "Authorization" header of the request to the web API.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-406">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a "Bearer" designation in the "Authorization" header of the request to the web API.</span></span> <span data-ttu-id="7d2ea-407">The web API then validates the JWT.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-407">The web API then validates the JWT.</span></span> <span data-ttu-id="7d2ea-408">If validation is successful, it returns the desired resource.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-408">If validation is successful, it returns the desired resource.</span></span>

<span data-ttu-id="7d2ea-409">In this application identity flow, the web API trusts that the web application authenticated the user.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-409">In this application identity flow, the web API trusts that the web application authenticated the user.</span></span> <span data-ttu-id="7d2ea-410">For this reason, this pattern is called a trusted subsystem.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-410">For this reason, this pattern is called a trusted subsystem.</span></span> <span data-ttu-id="7d2ea-411">The [authorization flow diagram](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) describes how authorization-code-grant flow works.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-411">The [authorization flow diagram](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) describes how authorization-code-grant flow works.</span></span>

<span data-ttu-id="7d2ea-412">License acquisition with token restriction follows the same trusted subsystem pattern.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-412">License acquisition with token restriction follows the same trusted subsystem pattern.</span></span> <span data-ttu-id="7d2ea-413">The license delivery service in Media Services is the web API resource, or the "back-end resource" that a web application needs to access.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-413">The license delivery service in Media Services is the web API resource, or the "back-end resource" that a web application needs to access.</span></span> <span data-ttu-id="7d2ea-414">So where is the access token?</span><span class="sxs-lookup"><span data-stu-id="7d2ea-414">So where is the access token?</span></span>

<span data-ttu-id="7d2ea-415">The access token is obtained from Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-415">The access token is obtained from Azure AD.</span></span> <span data-ttu-id="7d2ea-416">After successful user authentication, an authorization code is returned.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-416">After successful user authentication, an authorization code is returned.</span></span> <span data-ttu-id="7d2ea-417">The authorization code is then used, together with the client ID and the app key, to exchange for the access token.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-417">The authorization code is then used, together with the client ID and the app key, to exchange for the access token.</span></span> <span data-ttu-id="7d2ea-418">The access token is used to access a "pointer" application that points to or represents the Media Services license delivery service.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-418">The access token is used to access a "pointer" application that points to or represents the Media Services license delivery service.</span></span>

<span data-ttu-id="7d2ea-419">To register and configure the pointer app in Azure AD, take the following steps:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-419">To register and configure the pointer app in Azure AD, take the following steps:</span></span>

1. <span data-ttu-id="7d2ea-420">In the Azure AD tenant:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-420">In the Azure AD tenant:</span></span>

   * <span data-ttu-id="7d2ea-421">Add an application (resource) with the sign-on URL https://[resource_name].azurewebsites.net/.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-421">Add an application (resource) with the sign-on URL https://[resource_name].azurewebsites.net/.</span></span> 
   * <span data-ttu-id="7d2ea-422">Add an app ID with the URL https://[aad_tenant_name].onmicrosoft.com/[resource_name].</span><span class="sxs-lookup"><span data-stu-id="7d2ea-422">Add an app ID with the URL https://[aad_tenant_name].onmicrosoft.com/[resource_name].</span></span>

2. <span data-ttu-id="7d2ea-423">Add a new key for the resource app.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-423">Add a new key for the resource app.</span></span>

3. <span data-ttu-id="7d2ea-424">Update the app manifest file so that the groupMembershipClaims property has the value "groupMembershipClaims": "All".</span><span class="sxs-lookup"><span data-stu-id="7d2ea-424">Update the app manifest file so that the groupMembershipClaims property has the value "groupMembershipClaims": "All".</span></span>

4. <span data-ttu-id="7d2ea-425">In the Azure AD app that points to the player web app, in the section **Permissions to other applications**, add the resource app that was added in step 1.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-425">In the Azure AD app that points to the player web app, in the section **Permissions to other applications**, add the resource app that was added in step 1.</span></span> <span data-ttu-id="7d2ea-426">Under **Delegated permission**, select **Access [resource_name]**.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-426">Under **Delegated permission**, select **Access [resource_name]**.</span></span> <span data-ttu-id="7d2ea-427">This option gives the web app permission to create access tokens that access the resource app.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-427">This option gives the web app permission to create access tokens that access the resource app.</span></span> <span data-ttu-id="7d2ea-428">Do this for both the local and deployed version of the web app if you develop with Visual Studio and the Azure web app.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-428">Do this for both the local and deployed version of the web app if you develop with Visual Studio and the Azure web app.</span></span>

<span data-ttu-id="7d2ea-429">The JWT issued by Azure AD is the access token used to access the pointer resource.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-429">The JWT issued by Azure AD is the access token used to access the pointer resource.</span></span>

### <a name="what-about-live-streaming"></a><span data-ttu-id="7d2ea-430">What about live streaming?</span><span class="sxs-lookup"><span data-stu-id="7d2ea-430">What about live streaming?</span></span>
<span data-ttu-id="7d2ea-431">The previous discussion focused on on-demand assets.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-431">The previous discussion focused on on-demand assets.</span></span> <span data-ttu-id="7d2ea-432">What about live streaming?</span><span class="sxs-lookup"><span data-stu-id="7d2ea-432">What about live streaming?</span></span>

<span data-ttu-id="7d2ea-433">You can use exactly the same design and implementation to protect live streaming in Media Services by treating the asset associated with a program as a VOD asset.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-433">You can use exactly the same design and implementation to protect live streaming in Media Services by treating the asset associated with a program as a VOD asset.</span></span>

<span data-ttu-id="7d2ea-434">Specifically, to do live streaming in Media Services, you need to create a channel and then create a program under the channel.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-434">Specifically, to do live streaming in Media Services, you need to create a channel and then create a program under the channel.</span></span> <span data-ttu-id="7d2ea-435">To create the program, you need to create an asset that contains the live archive for the program.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-435">To create the program, you need to create an asset that contains the live archive for the program.</span></span> <span data-ttu-id="7d2ea-436">To provide CENC with multi-DRM protection of the live content, apply the same setup/processing to the asset as if it were a VOD asset before you start the program.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-436">To provide CENC with multi-DRM protection of the live content, apply the same setup/processing to the asset as if it were a VOD asset before you start the program.</span></span>

### <a name="what-about-license-servers-outside-media-services"></a><span data-ttu-id="7d2ea-437">What about license servers outside Media Services?</span><span class="sxs-lookup"><span data-stu-id="7d2ea-437">What about license servers outside Media Services?</span></span>

<span data-ttu-id="7d2ea-438">Often, customers invested in a license server farm either in their own data center or one hosted by DRM service providers.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-438">Often, customers invested in a license server farm either in their own data center or one hosted by DRM service providers.</span></span> <span data-ttu-id="7d2ea-439">With Media Services content protection, you can operate in hybrid mode.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-439">With Media Services content protection, you can operate in hybrid mode.</span></span> <span data-ttu-id="7d2ea-440">Contents can be hosted and dynamically protected in Media Services, while DRM licenses are delivered by servers outside Media Services.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-440">Contents can be hosted and dynamically protected in Media Services, while DRM licenses are delivered by servers outside Media Services.</span></span> <span data-ttu-id="7d2ea-441">In this case, consider the following changes:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-441">In this case, consider the following changes:</span></span>

* <span data-ttu-id="7d2ea-442">STS needs to issue tokens that are acceptable and can be verified by the license server farm.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-442">STS needs to issue tokens that are acceptable and can be verified by the license server farm.</span></span> <span data-ttu-id="7d2ea-443">For example, the Widevine license servers provided by Axinom require a specific JWT that contains an entitlement message.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-443">For example, the Widevine license servers provided by Axinom require a specific JWT that contains an entitlement message.</span></span> <span data-ttu-id="7d2ea-444">Therefore, you need to have an STS to issue such a JWT.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-444">Therefore, you need to have an STS to issue such a JWT.</span></span> 
* <span data-ttu-id="7d2ea-445">You no longer need to configure license delivery service in Media Services.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-445">You no longer need to configure license delivery service in Media Services.</span></span> <span data-ttu-id="7d2ea-446">You need to provide the license acquisition URLs (for PlayReady, Widevine, and FairPlay) when you configure ContentKeyPolicies.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-446">You need to provide the license acquisition URLs (for PlayReady, Widevine, and FairPlay) when you configure ContentKeyPolicies.</span></span>

### <a name="what-if-i-want-to-use-a-custom-sts"></a><span data-ttu-id="7d2ea-447">What if I want to use a custom STS?</span><span class="sxs-lookup"><span data-stu-id="7d2ea-447">What if I want to use a custom STS?</span></span>
<span data-ttu-id="7d2ea-448">A customer might choose to use a custom STS to provide JWTs.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-448">A customer might choose to use a custom STS to provide JWTs.</span></span> <span data-ttu-id="7d2ea-449">Reasons include:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-449">Reasons include:</span></span>

* <span data-ttu-id="7d2ea-450">The IDP used by the customer doesn't support STS.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-450">The IDP used by the customer doesn't support STS.</span></span> <span data-ttu-id="7d2ea-451">In this case, a custom STS might be an option.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-451">In this case, a custom STS might be an option.</span></span>
* <span data-ttu-id="7d2ea-452">The customer might need more flexible or tighter control to integrate STS with the customer's subscriber billing system.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-452">The customer might need more flexible or tighter control to integrate STS with the customer's subscriber billing system.</span></span> <span data-ttu-id="7d2ea-453">For example, an MVPD operator might offer multiple OTT subscriber packages, such as premium, basic, and sports.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-453">For example, an MVPD operator might offer multiple OTT subscriber packages, such as premium, basic, and sports.</span></span> <span data-ttu-id="7d2ea-454">The operator might want to match the claims in a token with a subscriber's package so that only the contents in a specific package are made available.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-454">The operator might want to match the claims in a token with a subscriber's package so that only the contents in a specific package are made available.</span></span> <span data-ttu-id="7d2ea-455">In this case, a custom STS provides the needed flexibility and control.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-455">In this case, a custom STS provides the needed flexibility and control.</span></span>

<span data-ttu-id="7d2ea-456">When you use a custom STS, two changes must be made:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-456">When you use a custom STS, two changes must be made:</span></span>

* <span data-ttu-id="7d2ea-457">When you configure license delivery service for an asset, you need to specify the security key used for verification by the custom STS instead of the current key from Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-457">When you configure license delivery service for an asset, you need to specify the security key used for verification by the custom STS instead of the current key from Azure AD.</span></span> <span data-ttu-id="7d2ea-458">(More details follow.)</span><span class="sxs-lookup"><span data-stu-id="7d2ea-458">(More details follow.)</span></span> 
* <span data-ttu-id="7d2ea-459">When a JTW token is generated, a security key is specified instead of the private key of the current X509 certificate in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-459">When a JTW token is generated, a security key is specified instead of the private key of the current X509 certificate in Azure AD.</span></span>

<span data-ttu-id="7d2ea-460">There are two types of security keys:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-460">There are two types of security keys:</span></span>

* <span data-ttu-id="7d2ea-461">Symmetric key: The same key is used to generate and to verify a JWT.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-461">Symmetric key: The same key is used to generate and to verify a JWT.</span></span>
* <span data-ttu-id="7d2ea-462">Asymmetric key: A public-private key pair in an X509 certificate is used with a private key to encrypt/generate a JWT and with the public key to verify the token.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-462">Asymmetric key: A public-private key pair in an X509 certificate is used with a private key to encrypt/generate a JWT and with the public key to verify the token.</span></span>

> [!NOTE]
> <span data-ttu-id="7d2ea-463">If you use .NET Framework/C# as your development platform, the X509 certificate used for an asymmetric security key must have a key length of at least 2048.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-463">If you use .NET Framework/C# as your development platform, the X509 certificate used for an asymmetric security key must have a key length of at least 2048.</span></span> <span data-ttu-id="7d2ea-464">This is a requirement of the class System.IdentityModel.Tokens.X509AsymmetricSecurityKey in .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-464">This is a requirement of the class System.IdentityModel.Tokens.X509AsymmetricSecurityKey in .NET Framework.</span></span> <span data-ttu-id="7d2ea-465">Otherwise, the following exception is thrown:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-465">Otherwise, the following exception is thrown:</span></span>

> <span data-ttu-id="7d2ea-466">IDX10630: The 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' for signing cannot be smaller than '2048' bits.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-466">IDX10630: The 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' for signing cannot be smaller than '2048' bits.</span></span>

## <a name="the-completed-system-and-test"></a><span data-ttu-id="7d2ea-467">The completed system and test</span><span class="sxs-lookup"><span data-stu-id="7d2ea-467">The completed system and test</span></span>
<span data-ttu-id="7d2ea-468">This section walks you through the following scenarios in the completed end-to-end system so that you can have a basic picture of the behavior before you get a sign-in account:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-468">This section walks you through the following scenarios in the completed end-to-end system so that you can have a basic picture of the behavior before you get a sign-in account:</span></span>

* <span data-ttu-id="7d2ea-469">If you need a non-integrated scenario:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-469">If you need a non-integrated scenario:</span></span>

    * <span data-ttu-id="7d2ea-470">For video assets hosted in Media Services that are either unprotected or DRM protected but without token authentication (issuing a license to whoever requested it), you can test it without signing in.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-470">For video assets hosted in Media Services that are either unprotected or DRM protected but without token authentication (issuing a license to whoever requested it), you can test it without signing in.</span></span> <span data-ttu-id="7d2ea-471">Switch to HTTP if your video streaming is over HTTP.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-471">Switch to HTTP if your video streaming is over HTTP.</span></span>

* <span data-ttu-id="7d2ea-472">If you need an end-to-end integrated scenario:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-472">If you need an end-to-end integrated scenario:</span></span>

    * <span data-ttu-id="7d2ea-473">For video assets under dynamic DRM protection in Media Services, with the token authentication and JWT generated by Azure AD, you need to sign in.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-473">For video assets under dynamic DRM protection in Media Services, with the token authentication and JWT generated by Azure AD, you need to sign in.</span></span>

<span data-ttu-id="7d2ea-474">For the player web application and its sign-in, see [this website](https://openidconnectweb.azurewebsites.net/).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-474">For the player web application and its sign-in, see [this website](https://openidconnectweb.azurewebsites.net/).</span></span>

### <a name="user-sign-in"></a><span data-ttu-id="7d2ea-475">User sign-in</span><span class="sxs-lookup"><span data-stu-id="7d2ea-475">User sign-in</span></span>
<span data-ttu-id="7d2ea-476">To test the end-to-end integrated DRM system, you need to have an account created or added.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-476">To test the end-to-end integrated DRM system, you need to have an account created or added.</span></span>

<span data-ttu-id="7d2ea-477">What account?</span><span class="sxs-lookup"><span data-stu-id="7d2ea-477">What account?</span></span>

<span data-ttu-id="7d2ea-478">Although Azure originally allowed access only by Microsoft account users, access is now allowed by users from both systems.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-478">Although Azure originally allowed access only by Microsoft account users, access is now allowed by users from both systems.</span></span> <span data-ttu-id="7d2ea-479">All Azure properties now trust Azure AD for authentication, and Azure AD authenticates organizational users.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-479">All Azure properties now trust Azure AD for authentication, and Azure AD authenticates organizational users.</span></span> <span data-ttu-id="7d2ea-480">A federation relationship was created where Azure AD trusts the Microsoft account consumer identity system to authenticate consumer users.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-480">A federation relationship was created where Azure AD trusts the Microsoft account consumer identity system to authenticate consumer users.</span></span> <span data-ttu-id="7d2ea-481">As a result, Azure AD can authenticate guest Microsoft accounts as well as native Azure AD accounts.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-481">As a result, Azure AD can authenticate guest Microsoft accounts as well as native Azure AD accounts.</span></span>

<span data-ttu-id="7d2ea-482">Because Azure AD trusts the Microsoft account domain, you can add any accounts from any of the following domains to the custom Azure AD tenant and use the account to sign in:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-482">Because Azure AD trusts the Microsoft account domain, you can add any accounts from any of the following domains to the custom Azure AD tenant and use the account to sign in:</span></span>

| <span data-ttu-id="7d2ea-483">**Domain name**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-483">**Domain name**</span></span> | <span data-ttu-id="7d2ea-484">**Domain**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-484">**Domain**</span></span> |
| --- | --- |
| <span data-ttu-id="7d2ea-485">**Custom Azure AD tenant domain**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-485">**Custom Azure AD tenant domain**</span></span> |<span data-ttu-id="7d2ea-486">somename.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="7d2ea-486">somename.onmicrosoft.com</span></span> |
| <span data-ttu-id="7d2ea-487">**Corporate domain**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-487">**Corporate domain**</span></span> |<span data-ttu-id="7d2ea-488">microsoft.com</span><span class="sxs-lookup"><span data-stu-id="7d2ea-488">microsoft.com</span></span> |
| <span data-ttu-id="7d2ea-489">**Microsoft account domain**</span><span class="sxs-lookup"><span data-stu-id="7d2ea-489">**Microsoft account domain**</span></span> |<span data-ttu-id="7d2ea-490">outlook.com, live.com, hotmail.com</span><span class="sxs-lookup"><span data-stu-id="7d2ea-490">outlook.com, live.com, hotmail.com</span></span> |

<span data-ttu-id="7d2ea-491">You can contact any of the authors to have an account created or added for you.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-491">You can contact any of the authors to have an account created or added for you.</span></span>

<span data-ttu-id="7d2ea-492">The following screenshots show different sign-in pages used by different domain accounts:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-492">The following screenshots show different sign-in pages used by different domain accounts:</span></span>

<span data-ttu-id="7d2ea-493">**Custom Azure AD tenant domain account**: The customized sign-in page of the custom Azure AD tenant domain.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-493">**Custom Azure AD tenant domain account**: The customized sign-in page of the custom Azure AD tenant domain.</span></span>

![Custom Azure AD tenant domain account](./media/design-multi-drm-system-with-access-control/media-services-ad-tenant-domain1.png)

<span data-ttu-id="7d2ea-495">**Microsoft domain account with smart card**: The sign-in page customized by Microsoft corporate IT with two-factor authentication.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-495">**Microsoft domain account with smart card**: The sign-in page customized by Microsoft corporate IT with two-factor authentication.</span></span>

![Custom Azure AD tenant domain account](./media/design-multi-drm-system-with-access-control/media-services-ad-tenant-domain2.png)

<span data-ttu-id="7d2ea-497">**Microsoft account**: The sign-in page of the Microsoft account for consumers.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-497">**Microsoft account**: The sign-in page of the Microsoft account for consumers.</span></span>

![Custom Azure AD tenant domain account](./media/design-multi-drm-system-with-access-control/media-services-ad-tenant-domain3.png)

### <a name="use-encrypted-media-extensions-for-playready"></a><span data-ttu-id="7d2ea-499">Use Encrypted Media Extensions for PlayReady</span><span class="sxs-lookup"><span data-stu-id="7d2ea-499">Use Encrypted Media Extensions for PlayReady</span></span>
<span data-ttu-id="7d2ea-500">On a modern browser with Encrypted Media Extensions (EME) for PlayReady support, such as Internet Explorer 11 on Windows 8.1 or later and Microsoft Edge browser on Windows 10, PlayReady is the underlying DRM for EME.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-500">On a modern browser with Encrypted Media Extensions (EME) for PlayReady support, such as Internet Explorer 11 on Windows 8.1 or later and Microsoft Edge browser on Windows 10, PlayReady is the underlying DRM for EME.</span></span>

![Use EME for PlayReady](./media/design-multi-drm-system-with-access-control/media-services-eme-for-playready1.png)

<span data-ttu-id="7d2ea-502">The dark player area is because PlayReady protection prevents you from making a screen capture of protected video.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-502">The dark player area is because PlayReady protection prevents you from making a screen capture of protected video.</span></span>

<span data-ttu-id="7d2ea-503">The following screenshot shows the player plug-ins and Microsoft Security Essentials (MSE)/EME support:</span><span class="sxs-lookup"><span data-stu-id="7d2ea-503">The following screenshot shows the player plug-ins and Microsoft Security Essentials (MSE)/EME support:</span></span>

![Player plug-ins for PlayReady](./media/design-multi-drm-system-with-access-control/media-services-eme-for-playready2.png)

<span data-ttu-id="7d2ea-505">EME in Microsoft Edge and Internet Explorer 11 on Windows 10 allows [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) to be invoked on Windows 10 devices that support it.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-505">EME in Microsoft Edge and Internet Explorer 11 on Windows 10 allows [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) to be invoked on Windows 10 devices that support it.</span></span> <span data-ttu-id="7d2ea-506">PlayReady SL3000 unlocks the flow of enhanced premium content (4K, HDR) and new content delivery models (for enhanced content).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-506">PlayReady SL3000 unlocks the flow of enhanced premium content (4K, HDR) and new content delivery models (for enhanced content).</span></span>

<span data-ttu-id="7d2ea-507">To focus on the Windows devices, PlayReady is the only DRM in the hardware available on Windows devices (PlayReady SL3000).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-507">To focus on the Windows devices, PlayReady is the only DRM in the hardware available on Windows devices (PlayReady SL3000).</span></span> <span data-ttu-id="7d2ea-508">A streaming service can use PlayReady through EME or through a Universal Windows Platform application and offer a higher video quality by using PlayReady SL3000 than another DRM.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-508">A streaming service can use PlayReady through EME or through a Universal Windows Platform application and offer a higher video quality by using PlayReady SL3000 than another DRM.</span></span> <span data-ttu-id="7d2ea-509">Typically, content up to 2K flows through Chrome or Firefox, and content up to 4K flows through Microsoft Edge/Internet Explorer 11 or a Universal Windows Platform application on the same device.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-509">Typically, content up to 2K flows through Chrome or Firefox, and content up to 4K flows through Microsoft Edge/Internet Explorer 11 or a Universal Windows Platform application on the same device.</span></span> <span data-ttu-id="7d2ea-510">The amount depends on service settings and implementation.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-510">The amount depends on service settings and implementation.</span></span>

#### <a name="use-eme-for-widevine"></a><span data-ttu-id="7d2ea-511">Use EME for Widevine</span><span class="sxs-lookup"><span data-stu-id="7d2ea-511">Use EME for Widevine</span></span>
<span data-ttu-id="7d2ea-512">On a modern browser with EME/Widevine support, such as Chrome 41+ on Windows 10, Windows 8.1, Mac OSX Yosemite, and Chrome on Android 4.4.4, Google Widevine is the DRM behind EME.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-512">On a modern browser with EME/Widevine support, such as Chrome 41+ on Windows 10, Windows 8.1, Mac OSX Yosemite, and Chrome on Android 4.4.4, Google Widevine is the DRM behind EME.</span></span>

![Use EME for Widevine](./media/design-multi-drm-system-with-access-control/media-services-eme-for-widevine1.png)

<span data-ttu-id="7d2ea-514">Widevine doesn't prevent you from making a screen capture of protected video.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-514">Widevine doesn't prevent you from making a screen capture of protected video.</span></span>

![Player plug-ins for Widevine](./media/design-multi-drm-system-with-access-control/media-services-eme-for-widevine2.png)

#### <a name="use-eme-for-fairplay"></a><span data-ttu-id="7d2ea-516">Use EME for FairPlay</span><span class="sxs-lookup"><span data-stu-id="7d2ea-516">Use EME for FairPlay</span></span>
<span data-ttu-id="7d2ea-517">Similarly, you can test FairPlay protected content in this test player in Safari on macOS or iOS 11.2 and later.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-517">Similarly, you can test FairPlay protected content in this test player in Safari on macOS or iOS 11.2 and later.</span></span>

<span data-ttu-id="7d2ea-518">Make sure you put "FairPlay" as protectionInfo.type and put in the right URL for your Application Certificate in FPS AC Path (FairPlay Streaming Application Certificate Path).</span><span class="sxs-lookup"><span data-stu-id="7d2ea-518">Make sure you put "FairPlay" as protectionInfo.type and put in the right URL for your Application Certificate in FPS AC Path (FairPlay Streaming Application Certificate Path).</span></span>

### <a name="unentitled-users"></a><span data-ttu-id="7d2ea-519">Unentitled users</span><span class="sxs-lookup"><span data-stu-id="7d2ea-519">Unentitled users</span></span>
<span data-ttu-id="7d2ea-520">If a user isn't a member of the "Entitled Users" group, the user doesn't pass the entitlement check.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-520">If a user isn't a member of the "Entitled Users" group, the user doesn't pass the entitlement check.</span></span> <span data-ttu-id="7d2ea-521">The multi-DRM license service then refuses to issue the requested license as shown.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-521">The multi-DRM license service then refuses to issue the requested license as shown.</span></span> <span data-ttu-id="7d2ea-522">The detailed description is "License acquire failed," which is as designed.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-522">The detailed description is "License acquire failed," which is as designed.</span></span>

![Unentitled users](./media/design-multi-drm-system-with-access-control/media-services-unentitledusers.png)

### <a name="run-a-custom-security-token-service"></a><span data-ttu-id="7d2ea-524">Run a custom security token service</span><span class="sxs-lookup"><span data-stu-id="7d2ea-524">Run a custom security token service</span></span>
<span data-ttu-id="7d2ea-525">If you run a custom STS, the JWT is issued by the custom STS by using either a symmetric or an asymmetric key.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-525">If you run a custom STS, the JWT is issued by the custom STS by using either a symmetric or an asymmetric key.</span></span>

<span data-ttu-id="7d2ea-526">The following screenshot shows a scenario that uses a symmetric key (using Chrome):</span><span class="sxs-lookup"><span data-stu-id="7d2ea-526">The following screenshot shows a scenario that uses a symmetric key (using Chrome):</span></span>

![Custom STS with a symmetric key](./media/design-multi-drm-system-with-access-control/media-services-running-sts1.png)

<span data-ttu-id="7d2ea-528">The following screenshot shows a scenario that uses an asymmetric key via an X509 certificate (using a Microsoft modern browser):</span><span class="sxs-lookup"><span data-stu-id="7d2ea-528">The following screenshot shows a scenario that uses an asymmetric key via an X509 certificate (using a Microsoft modern browser):</span></span>

![Custom STS with an asymmetric key](./media/design-multi-drm-system-with-access-control/media-services-running-sts2.png)

<span data-ttu-id="7d2ea-530">In both of the previous cases, user authentication stays the same.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-530">In both of the previous cases, user authentication stays the same.</span></span> <span data-ttu-id="7d2ea-531">It takes place through Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-531">It takes place through Azure AD.</span></span> <span data-ttu-id="7d2ea-532">The only difference is that JWTs are issued by the custom STS instead of Azure AD.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-532">The only difference is that JWTs are issued by the custom STS instead of Azure AD.</span></span> <span data-ttu-id="7d2ea-533">When you configure dynamic CENC protection, the license delivery service restriction specifies the type of JWT, either a symmetric or an asymmetric key.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-533">When you configure dynamic CENC protection, the license delivery service restriction specifies the type of JWT, either a symmetric or an asymmetric key.</span></span>

## <a name="summary"></a><span data-ttu-id="7d2ea-534">Summary</span><span class="sxs-lookup"><span data-stu-id="7d2ea-534">Summary</span></span>
<span data-ttu-id="7d2ea-535">This document discussed content protection using 3 DRMs and access control via token authentication, its design, and its implementation by using Azure, Azure Media Services, and Azure Media Player.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-535">This document discussed content protection using 3 DRMs and access control via token authentication, its design, and its implementation by using Azure, Azure Media Services, and Azure Media Player.</span></span>

* <span data-ttu-id="7d2ea-536">A reference design was presented that contains all the necessary components in a DRM subsystem.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-536">A reference design was presented that contains all the necessary components in a DRM subsystem.</span></span>
* <span data-ttu-id="7d2ea-537">A reference implementation was presented on Azure, Azure Media Services, and Azure Media Player.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-537">A reference implementation was presented on Azure, Azure Media Services, and Azure Media Player.</span></span>
* <span data-ttu-id="7d2ea-538">Some topics directly involved in the design and implementation were also discussed.</span><span class="sxs-lookup"><span data-stu-id="7d2ea-538">Some topics directly involved in the design and implementation were also discussed.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7d2ea-539">Next steps</span><span class="sxs-lookup"><span data-stu-id="7d2ea-539">Next steps</span></span>

[<span data-ttu-id="7d2ea-540">Protect your content with DRM</span><span class="sxs-lookup"><span data-stu-id="7d2ea-540">Protect your content with DRM</span></span>](protect-with-drm.md)
