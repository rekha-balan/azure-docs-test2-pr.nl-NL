---
title: Configure Content Key Authorization Policy using the Azure portal | Microsoft Docs
description: Learn how to configure an authorization policy for a content key.
services: media-services
documentationcenter: ''
author: juliako
manager: erikre
editor: ''
ms.assetid: ee82a3fa-c34b-48f2-a108-8ba321f1691e
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/05/2017
ms.author: juliako
ms.openlocfilehash: b9a483cafc9b8106b7ef32805bd8d86e4e41c329
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44669794"
---
# <a name="configure-content-key-authorization-policy"></a><span data-ttu-id="ab94a-103">Configure Content Key Authorization Policy</span><span class="sxs-lookup"><span data-stu-id="ab94a-103">Configure Content Key Authorization Policy</span></span>
[!INCLUDE [media-services-selector-content-key-auth-policy](../../includes/media-services-selector-content-key-auth-policy.md)]

## <a name="overview"></a><span data-ttu-id="ab94a-104">Overview</span><span class="sxs-lookup"><span data-stu-id="ab94a-104">Overview</span></span>
<span data-ttu-id="ab94a-105">Microsoft Azure Media Services enables you to deliver MPEG-DASH, Smooth Streaming, and HTTP-Live-Streaming (HLS) streams protected with Advanced Encryption Standard (AES) (using 128-bit encryption keys) or [Microsoft PlayReady DRM](https://www.microsoft.com/playready/overview/).</span><span class="sxs-lookup"><span data-stu-id="ab94a-105">Microsoft Azure Media Services enables you to deliver MPEG-DASH, Smooth Streaming, and HTTP-Live-Streaming (HLS) streams protected with Advanced Encryption Standard (AES) (using 128-bit encryption keys) or [Microsoft PlayReady DRM](https://www.microsoft.com/playready/overview/).</span></span> <span data-ttu-id="ab94a-106">AMS also enables you to deliver DASH streams encrypted with Widevine DRM.</span><span class="sxs-lookup"><span data-stu-id="ab94a-106">AMS also enables you to deliver DASH streams encrypted with Widevine DRM.</span></span> <span data-ttu-id="ab94a-107">Both PlayReady and Widevine are encrypted per the Common Encryption (ISO/IEC 23001-7 CENC) specification.</span><span class="sxs-lookup"><span data-stu-id="ab94a-107">Both PlayReady and Widevine are encrypted per the Common Encryption (ISO/IEC 23001-7 CENC) specification.</span></span>

<span data-ttu-id="ab94a-108">Media Services also provides a **Key/License Delivery Service** from which clients can obtain AES keys or PlayReady/Widevine licenses to play the encrypted content.</span><span class="sxs-lookup"><span data-stu-id="ab94a-108">Media Services also provides a **Key/License Delivery Service** from which clients can obtain AES keys or PlayReady/Widevine licenses to play the encrypted content.</span></span>

<span data-ttu-id="ab94a-109">This topic shows how to use the Azure portal to configure the content key authorization policy.</span><span class="sxs-lookup"><span data-stu-id="ab94a-109">This topic shows how to use the Azure portal to configure the content key authorization policy.</span></span> <span data-ttu-id="ab94a-110">The key can later be used to dynamically encrypt your content.</span><span class="sxs-lookup"><span data-stu-id="ab94a-110">The key can later be used to dynamically encrypt your content.</span></span> <span data-ttu-id="ab94a-111">Note that currently you can encrypt the following streaming formats: HLS, MPEG DASH, and Smooth Streaming.</span><span class="sxs-lookup"><span data-stu-id="ab94a-111">Note that currently you can encrypt the following streaming formats: HLS, MPEG DASH, and Smooth Streaming.</span></span> <span data-ttu-id="ab94a-112">You cannot encrypt progressive downloads.</span><span class="sxs-lookup"><span data-stu-id="ab94a-112">You cannot encrypt progressive downloads.</span></span>

<span data-ttu-id="ab94a-113">When a player requests a stream that is set to be dynamically encrypted, Media Services uses the configured key to dynamically encrypt your content using AES or DRM encryption.</span><span class="sxs-lookup"><span data-stu-id="ab94a-113">When a player requests a stream that is set to be dynamically encrypted, Media Services uses the configured key to dynamically encrypt your content using AES or DRM encryption.</span></span> <span data-ttu-id="ab94a-114">To decrypt the stream, the player will request the key from the key delivery service.</span><span class="sxs-lookup"><span data-stu-id="ab94a-114">To decrypt the stream, the player will request the key from the key delivery service.</span></span> <span data-ttu-id="ab94a-115">To decide whether or not the user is authorized to get the key, the service evaluates the authorization policies that you specified for the key.</span><span class="sxs-lookup"><span data-stu-id="ab94a-115">To decide whether or not the user is authorized to get the key, the service evaluates the authorization policies that you specified for the key.</span></span>

<span data-ttu-id="ab94a-116">If you plan to have multiple content keys or want to specify a **Key/License Delivery Service** URL other than the Media Services key delivery service, use Media Services .NET SDK or REST APIs.</span><span class="sxs-lookup"><span data-stu-id="ab94a-116">If you plan to have multiple content keys or want to specify a **Key/License Delivery Service** URL other than the Media Services key delivery service, use Media Services .NET SDK or REST APIs.</span></span>

[<span data-ttu-id="ab94a-117">Configure Content Key Authorization Policy using Media Services .NET SDK</span><span class="sxs-lookup"><span data-stu-id="ab94a-117">Configure Content Key Authorization Policy using Media Services .NET SDK</span></span>](media-services-dotnet-configure-content-key-auth-policy.md)

[<span data-ttu-id="ab94a-118">Configure Content Key Authorization Policy using Media Services REST API</span><span class="sxs-lookup"><span data-stu-id="ab94a-118">Configure Content Key Authorization Policy using Media Services REST API</span></span>](media-services-rest-configure-content-key-auth-policy.md)

### <a name="some-considerations-apply"></a><span data-ttu-id="ab94a-119">Some considerations apply:</span><span class="sxs-lookup"><span data-stu-id="ab94a-119">Some considerations apply:</span></span>
* <span data-ttu-id="ab94a-120">When your AMS account is created a **default** streaming endpoint is added  to your account in the **Stopped** state.</span><span class="sxs-lookup"><span data-stu-id="ab94a-120">When your AMS account is created a **default** streaming endpoint is added  to your account in the **Stopped** state.</span></span> <span data-ttu-id="ab94a-121">To start streaming your content and take advantage of dynamic packaging and dynamic encryption, your streaming endpoint has to be in the **Running** state.</span><span class="sxs-lookup"><span data-stu-id="ab94a-121">To start streaming your content and take advantage of dynamic packaging and dynamic encryption, your streaming endpoint has to be in the **Running** state.</span></span> 
* <span data-ttu-id="ab94a-122">Your asset must contain a set of adaptive bitrate MP4s or adaptive bitrate Smooth Streaming files.</span><span class="sxs-lookup"><span data-stu-id="ab94a-122">Your asset must contain a set of adaptive bitrate MP4s or adaptive bitrate Smooth Streaming files.</span></span> <span data-ttu-id="ab94a-123">For more information, see [Encode an asset](media-services-encode-asset.md).</span><span class="sxs-lookup"><span data-stu-id="ab94a-123">For more information, see [Encode an asset](media-services-encode-asset.md).</span></span>
* <span data-ttu-id="ab94a-124">The Key Delivery service caches ContentKeyAuthorizationPolicy and its related objects (policy options and restrictions) for 15 minutes.</span><span class="sxs-lookup"><span data-stu-id="ab94a-124">The Key Delivery service caches ContentKeyAuthorizationPolicy and its related objects (policy options and restrictions) for 15 minutes.</span></span>  <span data-ttu-id="ab94a-125">If you create a ContentKeyAuthorizationPolicy and specify to use a “Token” restriction, then test it, and then update the policy to “Open” restriction, it will take roughly 15 minutes before the policy switches to the “Open” version of the policy.</span><span class="sxs-lookup"><span data-stu-id="ab94a-125">If you create a ContentKeyAuthorizationPolicy and specify to use a “Token” restriction, then test it, and then update the policy to “Open” restriction, it will take roughly 15 minutes before the policy switches to the “Open” version of the policy.</span></span>

## <a name="how-to-configure-the-key-authorization-policy"></a><span data-ttu-id="ab94a-126">How to: configure the key authorization policy</span><span class="sxs-lookup"><span data-stu-id="ab94a-126">How to: configure the key authorization policy</span></span>
<span data-ttu-id="ab94a-127">To configure the key authorization policy, select the **CONTENT PROTECTION** page.</span><span class="sxs-lookup"><span data-stu-id="ab94a-127">To configure the key authorization policy, select the **CONTENT PROTECTION** page.</span></span>

<span data-ttu-id="ab94a-128">Media Services supports multiple ways of authenticating users who make key requests.</span><span class="sxs-lookup"><span data-stu-id="ab94a-128">Media Services supports multiple ways of authenticating users who make key requests.</span></span> <span data-ttu-id="ab94a-129">The content key authorization policy can have **open**, **token**, or **IP** authorization restrictions (**IP** can be configured with REST or .NET SDK).</span><span class="sxs-lookup"><span data-stu-id="ab94a-129">The content key authorization policy can have **open**, **token**, or **IP** authorization restrictions (**IP** can be configured with REST or .NET SDK).</span></span>

### <a name="open-restriction"></a><span data-ttu-id="ab94a-130">Open restriction</span><span class="sxs-lookup"><span data-stu-id="ab94a-130">Open restriction</span></span>
<span data-ttu-id="ab94a-131">The **open** restriction means the system will deliver the key to anyone who makes a key request.</span><span class="sxs-lookup"><span data-stu-id="ab94a-131">The **open** restriction means the system will deliver the key to anyone who makes a key request.</span></span> <span data-ttu-id="ab94a-132">This restriction might be useful for testing purposes.</span><span class="sxs-lookup"><span data-stu-id="ab94a-132">This restriction might be useful for testing purposes.</span></span>

![OpenPolicy][open_policy]

### <a name="token-restriction"></a><span data-ttu-id="ab94a-134">Token restriction</span><span class="sxs-lookup"><span data-stu-id="ab94a-134">Token restriction</span></span>
<span data-ttu-id="ab94a-135">To choose the token restricted policy, press the **TOKEN** button.</span><span class="sxs-lookup"><span data-stu-id="ab94a-135">To choose the token restricted policy, press the **TOKEN** button.</span></span>

<span data-ttu-id="ab94a-136">The **token** restricted policy must be accompanied by a token issued by a **Secure Token Service** (STS).</span><span class="sxs-lookup"><span data-stu-id="ab94a-136">The **token** restricted policy must be accompanied by a token issued by a **Secure Token Service** (STS).</span></span> <span data-ttu-id="ab94a-137">Media Services supports tokens in the **Simple Web Tokens** ([SWT](https://msdn.microsoft.com/library/gg185950.aspx#BKMK_2)) format and **JSON Web Token** (JWT) format.</span><span class="sxs-lookup"><span data-stu-id="ab94a-137">Media Services supports tokens in the **Simple Web Tokens** ([SWT](https://msdn.microsoft.com/library/gg185950.aspx#BKMK_2)) format and **JSON Web Token** (JWT) format.</span></span> <span data-ttu-id="ab94a-138">For information, see [JWT token authentication](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span><span class="sxs-lookup"><span data-stu-id="ab94a-138">For information, see [JWT token authentication](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span>

<span data-ttu-id="ab94a-139">Media Services does not provide **Secure Token Services**.</span><span class="sxs-lookup"><span data-stu-id="ab94a-139">Media Services does not provide **Secure Token Services**.</span></span> <span data-ttu-id="ab94a-140">You can create a custom STS or leverage Microsoft Azure ACS to issue tokens.</span><span class="sxs-lookup"><span data-stu-id="ab94a-140">You can create a custom STS or leverage Microsoft Azure ACS to issue tokens.</span></span> <span data-ttu-id="ab94a-141">The STS must be configured to create a token signed with the specified key and issue claims that you specified in the token restriction configuration.</span><span class="sxs-lookup"><span data-stu-id="ab94a-141">The STS must be configured to create a token signed with the specified key and issue claims that you specified in the token restriction configuration.</span></span> <span data-ttu-id="ab94a-142">The Media Services key delivery service will return the encryption key to the client if the token is valid and the claims in the token match those configured for the content key.</span><span class="sxs-lookup"><span data-stu-id="ab94a-142">The Media Services key delivery service will return the encryption key to the client if the token is valid and the claims in the token match those configured for the content key.</span></span> <span data-ttu-id="ab94a-143">For more information, see [Use Azure ACS to issue tokens](http://mingfeiy.com/acs-with-key-services).</span><span class="sxs-lookup"><span data-stu-id="ab94a-143">For more information, see [Use Azure ACS to issue tokens](http://mingfeiy.com/acs-with-key-services).</span></span>

<span data-ttu-id="ab94a-144">When configuring the **TOKEN** restricted policy, you must set values for **verification key**, **issuer** and **audience**.</span><span class="sxs-lookup"><span data-stu-id="ab94a-144">When configuring the **TOKEN** restricted policy, you must set values for **verification key**, **issuer** and **audience**.</span></span> <span data-ttu-id="ab94a-145">The primary verification key contains the key that the token was signed with, issuer is the secure token service that issues the token.</span><span class="sxs-lookup"><span data-stu-id="ab94a-145">The primary verification key contains the key that the token was signed with, issuer is the secure token service that issues the token.</span></span> <span data-ttu-id="ab94a-146">The audience (sometimes called scope) describes the intent of the token or the resource the token authorizes access to.</span><span class="sxs-lookup"><span data-stu-id="ab94a-146">The audience (sometimes called scope) describes the intent of the token or the resource the token authorizes access to.</span></span> <span data-ttu-id="ab94a-147">The Media Services key delivery service validates that these values in the token match the values in the template.</span><span class="sxs-lookup"><span data-stu-id="ab94a-147">The Media Services key delivery service validates that these values in the token match the values in the template.</span></span>

### <a name="playready"></a><span data-ttu-id="ab94a-148">PlayReady</span><span class="sxs-lookup"><span data-stu-id="ab94a-148">PlayReady</span></span>
<span data-ttu-id="ab94a-149">When protecting your content with **PlayReady**, one of the things you need to specify in your authorization policy is an XML string that defines the PlayReady license template.</span><span class="sxs-lookup"><span data-stu-id="ab94a-149">When protecting your content with **PlayReady**, one of the things you need to specify in your authorization policy is an XML string that defines the PlayReady license template.</span></span> <span data-ttu-id="ab94a-150">By default, the following policy is set:</span><span class="sxs-lookup"><span data-stu-id="ab94a-150">By default, the following policy is set:</span></span>

<span data-ttu-id="ab94a-151"><PlayReadyLicenseResponseTemplate xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1"> <LicenseTemplates> <PlayReadyLicenseTemplate><AllowTestDevices>true</AllowTestDevices> <ContentKey i:type="ContentEncryptionKeyFromHeader" /> <LicenseType>Nonpersistent</LicenseType> <PlayRight> <AllowPassingVideoContentToUnknownOutput>Allowed</AllowPassingVideoContentToUnknownOutput> </PlayRight> </PlayReadyLicenseTemplate> </LicenseTemplates> </PlayReadyLicenseResponseTemplate></span><span class="sxs-lookup"><span data-stu-id="ab94a-151"><PlayReadyLicenseResponseTemplate xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1"> <LicenseTemplates> <PlayReadyLicenseTemplate><AllowTestDevices>true</AllowTestDevices> <ContentKey i:type="ContentEncryptionKeyFromHeader" /> <LicenseType>Nonpersistent</LicenseType> <PlayRight> <AllowPassingVideoContentToUnknownOutput>Allowed</AllowPassingVideoContentToUnknownOutput> </PlayRight> </PlayReadyLicenseTemplate> </LicenseTemplates> </PlayReadyLicenseResponseTemplate></span></span>

<span data-ttu-id="ab94a-152">You can click the **import policy xml** button and provide a different XML which conforms to the  XML Schema defined [here](media-services-playready-license-template-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ab94a-152">You can click the **import policy xml** button and provide a different XML which conforms to the  XML Schema defined [here](media-services-playready-license-template-overview.md).</span></span>

## <a name="next-step"></a><span data-ttu-id="ab94a-153">Next step</span><span class="sxs-lookup"><span data-stu-id="ab94a-153">Next step</span></span>
<span data-ttu-id="ab94a-154">Review Media Services learning paths.</span><span class="sxs-lookup"><span data-stu-id="ab94a-154">Review Media Services learning paths.</span></span>

[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="ab94a-155">Provide feedback</span><span class="sxs-lookup"><span data-stu-id="ab94a-155">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[open_policy]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/media-services/media/media-services-portal-configure-content-key-auth-policy/media-services-protect-content-with-open-restriction.png
[token_policy]: ./media/media-services-key-authorization-policy/media-services-protect-content-with-token-restriction.png


