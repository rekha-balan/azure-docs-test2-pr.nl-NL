---
title: Configure a content key authorization policy by using the Azure portal | Microsoft Docs
description: Learn how to configure an authorization policy for a content key.
services: media-services
documentationcenter: ''
author: juliako
manager: cfowler
editor: ''
ms.assetid: ee82a3fa-c34b-48f2-a108-8ba321f1691e
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/09/2018
ms.author: juliako
ms.openlocfilehash: db0117b0b4ddee002fc69d71e78eca2b9008e4f6
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44966521"
---
# <a name="configure-a-content-key-authorization-policy"></a><span data-ttu-id="70791-103">Configure a content key authorization policy</span><span class="sxs-lookup"><span data-stu-id="70791-103">Configure a content key authorization policy</span></span>
[!INCLUDE [media-services-selector-content-key-auth-policy](../../../includes/media-services-selector-content-key-auth-policy.md)]

## <a name="overview"></a><span data-ttu-id="70791-104">Overview</span><span class="sxs-lookup"><span data-stu-id="70791-104">Overview</span></span>
 <span data-ttu-id="70791-105">You can use Azure Media Services to deliver MPEG-DASH, Smooth Streaming, and HTTP Live Streaming (HLS) streams protected with Advanced Encryption Standard (AES) by using 128-bit encryption keys or [PlayReady digital rights management (DRM)](https://www.microsoft.com/playready/overview/).</span><span class="sxs-lookup"><span data-stu-id="70791-105">You can use Azure Media Services to deliver MPEG-DASH, Smooth Streaming, and HTTP Live Streaming (HLS) streams protected with Advanced Encryption Standard (AES) by using 128-bit encryption keys or [PlayReady digital rights management (DRM)](https://www.microsoft.com/playready/overview/).</span></span> <span data-ttu-id="70791-106">With Media Services, you also can deliver DASH streams encrypted with Widevine DRM.</span><span class="sxs-lookup"><span data-stu-id="70791-106">With Media Services, you also can deliver DASH streams encrypted with Widevine DRM.</span></span> <span data-ttu-id="70791-107">Both PlayReady and Widevine are encrypted per the common encryption (ISO/IEC 23001-7 CENC) specification.</span><span class="sxs-lookup"><span data-stu-id="70791-107">Both PlayReady and Widevine are encrypted per the common encryption (ISO/IEC 23001-7 CENC) specification.</span></span>

<span data-ttu-id="70791-108">Media Services also provides a key/license delivery Service from which clients can obtain AES keys or PlayReady/Widevine licenses to play the encrypted content.</span><span class="sxs-lookup"><span data-stu-id="70791-108">Media Services also provides a key/license delivery Service from which clients can obtain AES keys or PlayReady/Widevine licenses to play the encrypted content.</span></span>

<span data-ttu-id="70791-109">This article shows how to use the Azure portal to configure the content key authorization policy.</span><span class="sxs-lookup"><span data-stu-id="70791-109">This article shows how to use the Azure portal to configure the content key authorization policy.</span></span> <span data-ttu-id="70791-110">The key can later be used to dynamically encrypt your content.</span><span class="sxs-lookup"><span data-stu-id="70791-110">The key can later be used to dynamically encrypt your content.</span></span> <span data-ttu-id="70791-111">Currently, you can encrypt HLS, MPEG-DASH, and Smooth Streaming formats.</span><span class="sxs-lookup"><span data-stu-id="70791-111">Currently, you can encrypt HLS, MPEG-DASH, and Smooth Streaming formats.</span></span> <span data-ttu-id="70791-112">You can't encrypt progressive downloads.</span><span class="sxs-lookup"><span data-stu-id="70791-112">You can't encrypt progressive downloads.</span></span>

<span data-ttu-id="70791-113">When a player requests a stream that is set to be dynamically encrypted, Media Services uses the configured key to dynamically encrypt your content by using AES or DRM encryption.</span><span class="sxs-lookup"><span data-stu-id="70791-113">When a player requests a stream that is set to be dynamically encrypted, Media Services uses the configured key to dynamically encrypt your content by using AES or DRM encryption.</span></span> <span data-ttu-id="70791-114">To decrypt the stream, the player requests the key from the key delivery service.</span><span class="sxs-lookup"><span data-stu-id="70791-114">To decrypt the stream, the player requests the key from the key delivery service.</span></span> <span data-ttu-id="70791-115">To determine whether the user is authorized to get the key, the service evaluates the authorization policies that you specified for the key.</span><span class="sxs-lookup"><span data-stu-id="70791-115">To determine whether the user is authorized to get the key, the service evaluates the authorization policies that you specified for the key.</span></span>

<span data-ttu-id="70791-116">If you plan to have multiple content keys or want to specify a key/license delivery service URL other than the Media Services key delivery service, use the Media Services .NET SDK or REST APIs.</span><span class="sxs-lookup"><span data-stu-id="70791-116">If you plan to have multiple content keys or want to specify a key/license delivery service URL other than the Media Services key delivery service, use the Media Services .NET SDK or REST APIs.</span></span> <span data-ttu-id="70791-117">For more information, see:</span><span class="sxs-lookup"><span data-stu-id="70791-117">For more information, see:</span></span>

* [<span data-ttu-id="70791-118">Configure a content key authorization policy by using the Media Services .NET SDK</span><span class="sxs-lookup"><span data-stu-id="70791-118">Configure a content key authorization policy by using the Media Services .NET SDK</span></span>](media-services-dotnet-configure-content-key-auth-policy.md)
* [<span data-ttu-id="70791-119">Configure a content key authorization policy by using the Media Services REST API</span><span class="sxs-lookup"><span data-stu-id="70791-119">Configure a content key authorization policy by using the Media Services REST API</span></span>](media-services-rest-configure-content-key-auth-policy.md)

### <a name="some-considerations-apply"></a><span data-ttu-id="70791-120">Some considerations apply</span><span class="sxs-lookup"><span data-stu-id="70791-120">Some considerations apply</span></span>
* <span data-ttu-id="70791-121">When your Media Services account is created, a default streaming endpoint is added to your account in the "Stopped" state.</span><span class="sxs-lookup"><span data-stu-id="70791-121">When your Media Services account is created, a default streaming endpoint is added to your account in the "Stopped" state.</span></span> <span data-ttu-id="70791-122">To start streaming your content and take advantage of dynamic packaging and dynamic encryption, your streaming endpoint must be in the "Running" state.</span><span class="sxs-lookup"><span data-stu-id="70791-122">To start streaming your content and take advantage of dynamic packaging and dynamic encryption, your streaming endpoint must be in the "Running" state.</span></span> 
* <span data-ttu-id="70791-123">Your asset must contain a set of adaptive bitrate MP4s or adaptive bitrate Smooth Streaming files.</span><span class="sxs-lookup"><span data-stu-id="70791-123">Your asset must contain a set of adaptive bitrate MP4s or adaptive bitrate Smooth Streaming files.</span></span> <span data-ttu-id="70791-124">For more information, see [Encode an asset](media-services-encode-asset.md).</span><span class="sxs-lookup"><span data-stu-id="70791-124">For more information, see [Encode an asset](media-services-encode-asset.md).</span></span>
* <span data-ttu-id="70791-125">The key delivery service caches ContentKeyAuthorizationPolicy and its related objects (policy options and restrictions) for 15 minutes.</span><span class="sxs-lookup"><span data-stu-id="70791-125">The key delivery service caches ContentKeyAuthorizationPolicy and its related objects (policy options and restrictions) for 15 minutes.</span></span> <span data-ttu-id="70791-126">You can create a ContentKeyAuthorizationPolicy and specify to use a token restriction, test it, and then update the policy to the open restriction.</span><span class="sxs-lookup"><span data-stu-id="70791-126">You can create a ContentKeyAuthorizationPolicy and specify to use a token restriction, test it, and then update the policy to the open restriction.</span></span> <span data-ttu-id="70791-127">This process takes roughly 15 minutes before the policy switches to the open version.</span><span class="sxs-lookup"><span data-stu-id="70791-127">This process takes roughly 15 minutes before the policy switches to the open version.</span></span>
* <span data-ttu-id="70791-128">A Media Services streaming endpoint sets the value of the CORS Access-Control-Allow-Origin header in preflight response as the wildcard "\*".</span><span class="sxs-lookup"><span data-stu-id="70791-128">A Media Services streaming endpoint sets the value of the CORS Access-Control-Allow-Origin header in preflight response as the wildcard "\*".</span></span> <span data-ttu-id="70791-129">This value works well with most players, including Azure Media Player, Roku and JWPlayer, and others.</span><span class="sxs-lookup"><span data-stu-id="70791-129">This value works well with most players, including Azure Media Player, Roku and JWPlayer, and others.</span></span> <span data-ttu-id="70791-130">However, some players that use dash.js don't work because, with credentials mode set to "include," XMLHttpRequest in their dash.js doesn't allow the wildcard "\*" as the value of Access-Control-Allow-Origin.</span><span class="sxs-lookup"><span data-stu-id="70791-130">However, some players that use dash.js don't work because, with credentials mode set to "include," XMLHttpRequest in their dash.js doesn't allow the wildcard "\*" as the value of Access-Control-Allow-Origin.</span></span> <span data-ttu-id="70791-131">As a workaround to this limitation in dash.js, if you host your client from a single domain, Media Services can specify that domain in the preflight response header.</span><span class="sxs-lookup"><span data-stu-id="70791-131">As a workaround to this limitation in dash.js, if you host your client from a single domain, Media Services can specify that domain in the preflight response header.</span></span> <span data-ttu-id="70791-132">For assistance, open a support ticket through the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="70791-132">For assistance, open a support ticket through the Azure portal.</span></span>

## <a name="configure-the-key-authorization-policy"></a><span data-ttu-id="70791-133">Configure the key authorization policy</span><span class="sxs-lookup"><span data-stu-id="70791-133">Configure the key authorization policy</span></span>
<span data-ttu-id="70791-134">To configure the key authorization policy, select the **CONTENT PROTECTION** page.</span><span class="sxs-lookup"><span data-stu-id="70791-134">To configure the key authorization policy, select the **CONTENT PROTECTION** page.</span></span>

<span data-ttu-id="70791-135">Media Services supports multiple ways to authenticate users who make key requests.</span><span class="sxs-lookup"><span data-stu-id="70791-135">Media Services supports multiple ways to authenticate users who make key requests.</span></span> <span data-ttu-id="70791-136">The content key authorization policy can have open, token, or IP authorization restrictions.</span><span class="sxs-lookup"><span data-stu-id="70791-136">The content key authorization policy can have open, token, or IP authorization restrictions.</span></span> <span data-ttu-id="70791-137">(IP can be configured with REST or the .NET SDK.)</span><span class="sxs-lookup"><span data-stu-id="70791-137">(IP can be configured with REST or the .NET SDK.)</span></span>

### <a name="open-restriction"></a><span data-ttu-id="70791-138">Open restriction</span><span class="sxs-lookup"><span data-stu-id="70791-138">Open restriction</span></span>
<span data-ttu-id="70791-139">The open restriction means the system delivers the key to anyone who makes a key request.</span><span class="sxs-lookup"><span data-stu-id="70791-139">The open restriction means the system delivers the key to anyone who makes a key request.</span></span> <span data-ttu-id="70791-140">This restriction might be useful for testing purposes.</span><span class="sxs-lookup"><span data-stu-id="70791-140">This restriction might be useful for testing purposes.</span></span>

![OpenPolicy][open_policy]

### <a name="token-restriction"></a><span data-ttu-id="70791-142">Token restriction</span><span class="sxs-lookup"><span data-stu-id="70791-142">Token restriction</span></span>
<span data-ttu-id="70791-143">To choose the token restricted policy, select the **TOKEN** button.</span><span class="sxs-lookup"><span data-stu-id="70791-143">To choose the token restricted policy, select the **TOKEN** button.</span></span>

<span data-ttu-id="70791-144">The token restricted policy must be accompanied by a token issued by a security token service (STS).</span><span class="sxs-lookup"><span data-stu-id="70791-144">The token restricted policy must be accompanied by a token issued by a security token service (STS).</span></span> <span data-ttu-id="70791-145">Media Services supports tokens in the simple web token ([SWT](https://msdn.microsoft.com/library/gg185950.aspx#BKMK_2)) and JSON Web Token (JWT) formats.</span><span class="sxs-lookup"><span data-stu-id="70791-145">Media Services supports tokens in the simple web token ([SWT](https://msdn.microsoft.com/library/gg185950.aspx#BKMK_2)) and JSON Web Token (JWT) formats.</span></span> <span data-ttu-id="70791-146">For more information, see [JWT authentication](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span><span class="sxs-lookup"><span data-stu-id="70791-146">For more information, see [JWT authentication](http://www.gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span>

<span data-ttu-id="70791-147">Media Services doesn't provide STS.</span><span class="sxs-lookup"><span data-stu-id="70791-147">Media Services doesn't provide STS.</span></span> <span data-ttu-id="70791-148">You can create a custom STS to issue tokens.</span><span class="sxs-lookup"><span data-stu-id="70791-148">You can create a custom STS to issue tokens.</span></span> <span data-ttu-id="70791-149">The STS must be configured to create a token signed with the specified key and issue claims that you specified in the token restriction configuration.</span><span class="sxs-lookup"><span data-stu-id="70791-149">The STS must be configured to create a token signed with the specified key and issue claims that you specified in the token restriction configuration.</span></span> <span data-ttu-id="70791-150">If the token is valid and the claims in the token match those configured for the content key, the Media Services key delivery service returns the encryption key to the client.</span><span class="sxs-lookup"><span data-stu-id="70791-150">If the token is valid and the claims in the token match those configured for the content key, the Media Services key delivery service returns the encryption key to the client.</span></span>

<span data-ttu-id="70791-151">When you configure the token-restricted policy, you must specify the primary verification key, issuer, and audience parameters.</span><span class="sxs-lookup"><span data-stu-id="70791-151">When you configure the token-restricted policy, you must specify the primary verification key, issuer, and audience parameters.</span></span> <span data-ttu-id="70791-152">The primary verification key contains the key that the token was signed with.</span><span class="sxs-lookup"><span data-stu-id="70791-152">The primary verification key contains the key that the token was signed with.</span></span> <span data-ttu-id="70791-153">The issuer is the STS that issues the token.</span><span class="sxs-lookup"><span data-stu-id="70791-153">The issuer is the STS that issues the token.</span></span> <span data-ttu-id="70791-154">The audience (sometimes called scope) describes the intent of the token or the resource the token authorizes access to.</span><span class="sxs-lookup"><span data-stu-id="70791-154">The audience (sometimes called scope) describes the intent of the token or the resource the token authorizes access to.</span></span> <span data-ttu-id="70791-155">The Media Services key delivery service validates that these values in the token match the values in the template.</span><span class="sxs-lookup"><span data-stu-id="70791-155">The Media Services key delivery service validates that these values in the token match the values in the template.</span></span>

### <a name="playready"></a><span data-ttu-id="70791-156">PlayReady</span><span class="sxs-lookup"><span data-stu-id="70791-156">PlayReady</span></span>
<span data-ttu-id="70791-157">When you protect your content with PlayReady, one of the things you need to specify in your authorization policy is an XML string that defines the PlayReady license template.</span><span class="sxs-lookup"><span data-stu-id="70791-157">When you protect your content with PlayReady, one of the things you need to specify in your authorization policy is an XML string that defines the PlayReady license template.</span></span> <span data-ttu-id="70791-158">By default, the following policy is set:</span><span class="sxs-lookup"><span data-stu-id="70791-158">By default, the following policy is set:</span></span>

    <PlayReadyLicenseResponseTemplate xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/Azure/MediaServices/KeyDelivery/PlayReadyTemplate/v1">
          <LicenseTemplates>
            <PlayReadyLicenseTemplate><AllowTestDevices>true</AllowTestDevices>
              <ContentKey i:type="ContentEncryptionKeyFromHeader" />
              <LicenseType>Nonpersistent</LicenseType>
              <PlayRight>
                <AllowPassingVideoContentToUnknownOutput>Allowed</AllowPassingVideoContentToUnknownOutput>
              </PlayRight>
            </PlayReadyLicenseTemplate>
          </LicenseTemplates>
        </PlayReadyLicenseResponseTemplate>

<span data-ttu-id="70791-159">You can select the **import policy xml** button and provide a different XML that conforms to the XML schema defined in the [Media Services PlayReady license template overview](media-services-playready-license-template-overview.md).</span><span class="sxs-lookup"><span data-stu-id="70791-159">You can select the **import policy xml** button and provide a different XML that conforms to the XML schema defined in the [Media Services PlayReady license template overview](media-services-playready-license-template-overview.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="70791-160">Next steps</span><span class="sxs-lookup"><span data-stu-id="70791-160">Next steps</span></span>
[!INCLUDE [media-services-learning-paths-include](../../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="70791-161">Provide feedback</span><span class="sxs-lookup"><span data-stu-id="70791-161">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../../includes/media-services-user-voice-include.md)]

[open_policy]: ./media/media-services-portal-configure-content-key-auth-policy/media-services-protect-content-with-open-restriction.png
[token_policy]: ./media/media-services-key-authorization-policy/media-services-protect-content-with-token-restriction.png

