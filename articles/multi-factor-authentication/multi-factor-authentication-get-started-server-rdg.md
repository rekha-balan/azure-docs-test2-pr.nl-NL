---
title: RDG and Azure MFA Server using RADIUS | Microsoft Docs
description: This is the Azure Multi-factor authentication page that will assist in deploying Remote Desktop (RD) Gateway and Azure Multi-Factor Authentication Server using RADIUS.
services: multi-factor-authentication
documentationcenter: ''
author: kgremban
manager: femila
editor: yossib
ms.assetid: f2354ac4-a3a7-48e5-a86d-84a9e5682b42
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/06/2017
ms.author: kgremban
ms.openlocfilehash: 6b52eaaa7fa7f3e57e1e679a5ea07231963ea9dc
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44662907"
---
# <a name="remote-desktop-gateway-and-azure-multi-factor-authentication-server-using-radius"></a><span data-ttu-id="e0232-103">Remote Desktop Gateway and Azure Multi-Factor Authentication Server using RADIUS</span><span class="sxs-lookup"><span data-stu-id="e0232-103">Remote Desktop Gateway and Azure Multi-Factor Authentication Server using RADIUS</span></span>
<span data-ttu-id="e0232-104">Often, Remote Desktop (RD) Gateway uses the local Network Policy Services (NPS) to authenticate users.</span><span class="sxs-lookup"><span data-stu-id="e0232-104">Often, Remote Desktop (RD) Gateway uses the local Network Policy Services (NPS) to authenticate users.</span></span> <span data-ttu-id="e0232-105">This article describes how to route RADIUS requests out from the Remote Desktop Gateway (through the local NPS) to the Multi-Factor Authentication Server.</span><span class="sxs-lookup"><span data-stu-id="e0232-105">This article describes how to route RADIUS requests out from the Remote Desktop Gateway (through the local NPS) to the Multi-Factor Authentication Server.</span></span> <span data-ttu-id="e0232-106">The combination of Azure MFA and RD Gateway means that your users can access their work environments from anywhere while keeping you in control of corporate assets by requiring strong authentication.</span><span class="sxs-lookup"><span data-stu-id="e0232-106">The combination of Azure MFA and RD Gateway means that your users can access their work environments from anywhere while keeping you in control of corporate assets by requiring strong authentication.</span></span> 

<span data-ttu-id="e0232-107">Since Windows Authentication for terminal services is not supported for Server 2012 R2, use RD Gateway and RADIUS to integrate with MFA Server.</span><span class="sxs-lookup"><span data-stu-id="e0232-107">Since Windows Authentication for terminal services is not supported for Server 2012 R2, use RD Gateway and RADIUS to integrate with MFA Server.</span></span> 

<span data-ttu-id="e0232-108">The Multi-Factor Authentication Server should be installed on a separate server, which proxies the RADIUS request back to the NPS on the Remote Desktop Gateway Server.</span><span class="sxs-lookup"><span data-stu-id="e0232-108">The Multi-Factor Authentication Server should be installed on a separate server, which proxies the RADIUS request back to the NPS on the Remote Desktop Gateway Server.</span></span> <span data-ttu-id="e0232-109">After NPS validates the username and password, it returns a response to the Multi-Factor Authentication Server, which performs the second factor of authentication before returning a result to the gateway.</span><span class="sxs-lookup"><span data-stu-id="e0232-109">After NPS validates the username and password, it returns a response to the Multi-Factor Authentication Server, which performs the second factor of authentication before returning a result to the gateway.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="e0232-110">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="e0232-110">Prerequisites</span></span>

- <span data-ttu-id="e0232-111">A domain-joined Azure MFA Server.</span><span class="sxs-lookup"><span data-stu-id="e0232-111">A domain-joined Azure MFA Server.</span></span> <span data-ttu-id="e0232-112">If you don't have one installed already, follow the steps in [Getting started with the Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="e0232-112">If you don't have one installed already, follow the steps in [Getting started with the Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
- <span data-ttu-id="e0232-113">A Remote Desktop Gateway that authenticates with Network Policy Services.</span><span class="sxs-lookup"><span data-stu-id="e0232-113">A Remote Desktop Gateway that authenticates with Network Policy Services.</span></span>

## <a name="configure-the-remote-desktop-gateway"></a><span data-ttu-id="e0232-114">Configure the Remote Desktop Gateway</span><span class="sxs-lookup"><span data-stu-id="e0232-114">Configure the Remote Desktop Gateway</span></span>
<span data-ttu-id="e0232-115">Configure the RD Gateway to send RADIUS authentication to an Azure Multi-Factor Authentication Server.</span><span class="sxs-lookup"><span data-stu-id="e0232-115">Configure the RD Gateway to send RADIUS authentication to an Azure Multi-Factor Authentication Server.</span></span> 

1. <span data-ttu-id="e0232-116">In RD Gateway Manager, right-click the server name and select **Properties**.</span><span class="sxs-lookup"><span data-stu-id="e0232-116">In RD Gateway Manager, right-click the server name and select **Properties**.</span></span>
2. <span data-ttu-id="e0232-117">Go to the **RD CAP Store** tab and select **Central server running NPS**.</span><span class="sxs-lookup"><span data-stu-id="e0232-117">Go to the **RD CAP Store** tab and select **Central server running NPS**.</span></span> 
3. <span data-ttu-id="e0232-118">Add one or more Azure Multi-Factor Authentication Servers as RADIUS servers by entering the name or IP address of each server.</span><span class="sxs-lookup"><span data-stu-id="e0232-118">Add one or more Azure Multi-Factor Authentication Servers as RADIUS servers by entering the name or IP address of each server.</span></span> 
4. <span data-ttu-id="e0232-119">Create a shared secret for each server.</span><span class="sxs-lookup"><span data-stu-id="e0232-119">Create a shared secret for each server.</span></span>

## <a name="configure-nps"></a><span data-ttu-id="e0232-120">Configure NPS</span><span class="sxs-lookup"><span data-stu-id="e0232-120">Configure NPS</span></span>
<span data-ttu-id="e0232-121">The RD Gateway uses NPS to send the RADIUS request to Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="e0232-121">The RD Gateway uses NPS to send the RADIUS request to Azure Multi-Factor Authentication.</span></span> <span data-ttu-id="e0232-122">To configure NPS, first you change the timeout settings to prevent the RD Gateway from timing out before the two-step verification has completed.</span><span class="sxs-lookup"><span data-stu-id="e0232-122">To configure NPS, first you change the timeout settings to prevent the RD Gateway from timing out before the two-step verification has completed.</span></span> <span data-ttu-id="e0232-123">Then, you update NPS to receive RADIUS authentications from your MFA Server.</span><span class="sxs-lookup"><span data-stu-id="e0232-123">Then, you update NPS to receive RADIUS authentications from your MFA Server.</span></span> <span data-ttu-id="e0232-124">Use the following procedure to configure NPS:</span><span class="sxs-lookup"><span data-stu-id="e0232-124">Use the following procedure to configure NPS:</span></span>

### <a name="modify-the-timeout-policy"></a><span data-ttu-id="e0232-125">Modify the timeout policy</span><span class="sxs-lookup"><span data-stu-id="e0232-125">Modify the timeout policy</span></span>

1. <span data-ttu-id="e0232-126">In NPS, open the **RADIUS Clients and Server** menu in the left column and select **Remote RADIUS Server Groups**.</span><span class="sxs-lookup"><span data-stu-id="e0232-126">In NPS, open the **RADIUS Clients and Server** menu in the left column and select **Remote RADIUS Server Groups**.</span></span> 
2. <span data-ttu-id="e0232-127">Select the **TS GATEWAY SERVER GROUP**.</span><span class="sxs-lookup"><span data-stu-id="e0232-127">Select the **TS GATEWAY SERVER GROUP**.</span></span> 
3. <span data-ttu-id="e0232-128">Go to the **Load Balancing** tab.</span><span class="sxs-lookup"><span data-stu-id="e0232-128">Go to the **Load Balancing** tab.</span></span> 
4. <span data-ttu-id="e0232-129">Change both the "Number of seconds without response before request is considered dropped” and the “Number of seconds between requests when server is identified as unavailable” to between 30 and 60 seconds.</span><span class="sxs-lookup"><span data-stu-id="e0232-129">Change both the "Number of seconds without response before request is considered dropped” and the “Number of seconds between requests when server is identified as unavailable” to between 30 and 60 seconds.</span></span> <span data-ttu-id="e0232-130">(If you find that the server still times out during authentication, you can come back here and increase the number of seconds.)</span><span class="sxs-lookup"><span data-stu-id="e0232-130">(If you find that the server still times out during authentication, you can come back here and increase the number of seconds.)</span></span>
5. <span data-ttu-id="e0232-131">Go to the **Authentication/Account** tab and check that the RADIUS ports specified match the ports that the Multi-Factor Authentication Server is listening on.</span><span class="sxs-lookup"><span data-stu-id="e0232-131">Go to the **Authentication/Account** tab and check that the RADIUS ports specified match the ports that the Multi-Factor Authentication Server is listening on.</span></span>

### <a name="prepare-nps-to-receive-authentications-from-the-mfa-server"></a><span data-ttu-id="e0232-132">Prepare NPS to receive authentications from the MFA Server</span><span class="sxs-lookup"><span data-stu-id="e0232-132">Prepare NPS to receive authentications from the MFA Server</span></span>

1. <span data-ttu-id="e0232-133">Right-click **RADIUS Clients** under RADIUS Clients and Servers in the left column and select **New**.</span><span class="sxs-lookup"><span data-stu-id="e0232-133">Right-click **RADIUS Clients** under RADIUS Clients and Servers in the left column and select **New**.</span></span>
2. <span data-ttu-id="e0232-134">Add the Azure Multi-Factor Authentication Server as a RADIUS client.</span><span class="sxs-lookup"><span data-stu-id="e0232-134">Add the Azure Multi-Factor Authentication Server as a RADIUS client.</span></span> <span data-ttu-id="e0232-135">Choose a Friendly name and specify a shared secret.</span><span class="sxs-lookup"><span data-stu-id="e0232-135">Choose a Friendly name and specify a shared secret.</span></span>
3. <span data-ttu-id="e0232-136">Open the **Policies** menu in the left column and select **Connection Request Policies**.</span><span class="sxs-lookup"><span data-stu-id="e0232-136">Open the **Policies** menu in the left column and select **Connection Request Policies**.</span></span> <span data-ttu-id="e0232-137">You should see a policy called TS GATEWAY AUTHORIZATION POLICY that was created when RD Gateway was configured.</span><span class="sxs-lookup"><span data-stu-id="e0232-137">You should see a policy called TS GATEWAY AUTHORIZATION POLICY that was created when RD Gateway was configured.</span></span> <span data-ttu-id="e0232-138">This policy forwards RADIUS requests to the Multi-Factor Authentication Server.</span><span class="sxs-lookup"><span data-stu-id="e0232-138">This policy forwards RADIUS requests to the Multi-Factor Authentication Server.</span></span>
4. <span data-ttu-id="e0232-139">Right-click **TS GATEWAY AUTHORIZATION POLICY** and select **Duplicate Policy**.</span><span class="sxs-lookup"><span data-stu-id="e0232-139">Right-click **TS GATEWAY AUTHORIZATION POLICY** and select **Duplicate Policy**.</span></span> 
5. <span data-ttu-id="e0232-140">Open the new policy and go to the **Conditions** tab.</span><span class="sxs-lookup"><span data-stu-id="e0232-140">Open the new policy and go to the **Conditions** tab.</span></span>
6. <span data-ttu-id="e0232-141">Add a condition that matches the Client Friendly Name with the Friendly name set in step 2 for the Azure Multi-Factor Authentication Server RADIUS client.</span><span class="sxs-lookup"><span data-stu-id="e0232-141">Add a condition that matches the Client Friendly Name with the Friendly name set in step 2 for the Azure Multi-Factor Authentication Server RADIUS client.</span></span> 
7. <span data-ttu-id="e0232-142">Go to the **Settings** tab and select **Authentication**.</span><span class="sxs-lookup"><span data-stu-id="e0232-142">Go to the **Settings** tab and select **Authentication**.</span></span>
8. <span data-ttu-id="e0232-143">Change the Authentication Provider to **Authenticate requests on this server**.</span><span class="sxs-lookup"><span data-stu-id="e0232-143">Change the Authentication Provider to **Authenticate requests on this server**.</span></span> <span data-ttu-id="e0232-144">This policy ensures that when NPS receives a RADIUS request from the Azure MFA Server, the authentication occurs locally instead of sending a RADIUS request back to the Azure Multi-Factor Authentication Server, which would result in a loop condition.</span><span class="sxs-lookup"><span data-stu-id="e0232-144">This policy ensures that when NPS receives a RADIUS request from the Azure MFA Server, the authentication occurs locally instead of sending a RADIUS request back to the Azure Multi-Factor Authentication Server, which would result in a loop condition.</span></span> 
9. <span data-ttu-id="e0232-145">To prevent a loop condition, make sure that the new policy is ordered ABOVE the original policy in the **Connection Request Policies** pane.</span><span class="sxs-lookup"><span data-stu-id="e0232-145">To prevent a loop condition, make sure that the new policy is ordered ABOVE the original policy in the **Connection Request Policies** pane.</span></span>

## <a name="configure-azure-multi-factor-authentication"></a><span data-ttu-id="e0232-146">Configure Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="e0232-146">Configure Azure Multi-Factor Authentication</span></span>

<span data-ttu-id="e0232-147">The Azure Multi-Factor Authentication Server is configured as a RADIUS proxy between RD Gateway and NPS.</span><span class="sxs-lookup"><span data-stu-id="e0232-147">The Azure Multi-Factor Authentication Server is configured as a RADIUS proxy between RD Gateway and NPS.</span></span>  <span data-ttu-id="e0232-148">It should be installed on a domain-joined server that is separate from the RD Gateway server.</span><span class="sxs-lookup"><span data-stu-id="e0232-148">It should be installed on a domain-joined server that is separate from the RD Gateway server.</span></span> <span data-ttu-id="e0232-149">Use the following procedure to configure the Azure Multi-Factor Authentication Server.</span><span class="sxs-lookup"><span data-stu-id="e0232-149">Use the following procedure to configure the Azure Multi-Factor Authentication Server.</span></span>

1. <span data-ttu-id="e0232-150">Open the Azure Multi-Factor Authentication Server and select the RADIUS Authentication icon.</span><span class="sxs-lookup"><span data-stu-id="e0232-150">Open the Azure Multi-Factor Authentication Server and select the RADIUS Authentication icon.</span></span> 
2. <span data-ttu-id="e0232-151">Check the **Enable RADIUS authentication** checkbox.</span><span class="sxs-lookup"><span data-stu-id="e0232-151">Check the **Enable RADIUS authentication** checkbox.</span></span>
3. <span data-ttu-id="e0232-152">On the Clients tab, ensure the ports match what is configured in NPS then select **Add**.</span><span class="sxs-lookup"><span data-stu-id="e0232-152">On the Clients tab, ensure the ports match what is configured in NPS then select **Add**.</span></span>
4. <span data-ttu-id="e0232-153">Add the RD Gateway server IP address, application name (optional), and a shared secret.</span><span class="sxs-lookup"><span data-stu-id="e0232-153">Add the RD Gateway server IP address, application name (optional), and a shared secret.</span></span> <span data-ttu-id="e0232-154">The shared secret needs to be the same on both the Azure Multi-Factor Authentication Server and RD Gateway.</span><span class="sxs-lookup"><span data-stu-id="e0232-154">The shared secret needs to be the same on both the Azure Multi-Factor Authentication Server and RD Gateway.</span></span>
3. <span data-ttu-id="e0232-155">Go to the **Target** tab and select the **RADIUS server(s)** radio button.</span><span class="sxs-lookup"><span data-stu-id="e0232-155">Go to the **Target** tab and select the **RADIUS server(s)** radio button.</span></span>
4. <span data-ttu-id="e0232-156">Select **Add** and enter the IP address, shared secret, and ports of the NPS server.</span><span class="sxs-lookup"><span data-stu-id="e0232-156">Select **Add** and enter the IP address, shared secret, and ports of the NPS server.</span></span> <span data-ttu-id="e0232-157">Unless using a central NPS, the RADIUS client and RADIUS target are the same.</span><span class="sxs-lookup"><span data-stu-id="e0232-157">Unless using a central NPS, the RADIUS client and RADIUS target are the same.</span></span> <span data-ttu-id="e0232-158">The shared secret must match the one setup in the RADIUS client section of the NPS server.</span><span class="sxs-lookup"><span data-stu-id="e0232-158">The shared secret must match the one setup in the RADIUS client section of the NPS server.</span></span>

![Radius Authentication](https://docstestmedia1.blob.core.windows.net/azure-media/articles/multi-factor-authentication/media/multi-factor-authentication-get-started-server-rdg/radius.png)

## <a name="next-steps"></a><span data-ttu-id="e0232-160">Next steps</span><span class="sxs-lookup"><span data-stu-id="e0232-160">Next steps</span></span>

- <span data-ttu-id="e0232-161">Integrate Azure MFA and [IIS web apps](multi-factor-authentication-get-started-server-iis.md)</span><span class="sxs-lookup"><span data-stu-id="e0232-161">Integrate Azure MFA and [IIS web apps](multi-factor-authentication-get-started-server-iis.md)</span></span>

- <span data-ttu-id="e0232-162">Get answers in the [Azure Multi-Factor Authentication FAQ](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="e0232-162">Get answers in the [Azure Multi-Factor Authentication FAQ](multi-factor-authentication-faq.md)</span></span>

