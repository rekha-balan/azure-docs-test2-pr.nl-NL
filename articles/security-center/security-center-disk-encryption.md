---
title: Encrypt an Azure Virtual Machine | Microsoft Docs
description: This document helps you to encrypt an Azure Virtual Machine after receiving an alert from Azure Security Center.
services: security, security-center
documentationcenter: na
author: TomShinder
manager: swadhwa
editor: ''
ms.assetid: f6c28bc4-1f79-4352-89d0-03659b2fa2f5
ms.service: security
ms.devlang: na
ms.topic: hero-article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/15/2017
ms.author: tomsh
ms.openlocfilehash: ddbd4c6395239adedb3a744dd636f90a95292706
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44552666"
---
# <a name="encrypt-an-azure-virtual-machine"></a><span data-ttu-id="8a856-103">Encrypt an Azure Virtual Machine</span><span class="sxs-lookup"><span data-stu-id="8a856-103">Encrypt an Azure Virtual Machine</span></span>
<span data-ttu-id="8a856-104">Azure Security Center will alert you if you have virtual machines that are not encrypted.</span><span class="sxs-lookup"><span data-stu-id="8a856-104">Azure Security Center will alert you if you have virtual machines that are not encrypted.</span></span> <span data-ttu-id="8a856-105">These alerts will show as High Severity and the recommendation is to encrypt these virtual machines.</span><span class="sxs-lookup"><span data-stu-id="8a856-105">These alerts will show as High Severity and the recommendation is to encrypt these virtual machines.</span></span>

![Disk encryption recommendation](https://docstestmedia1.blob.core.windows.net/azure-media/articles/security-center/media/security-center-disk-encryption/security-center-disk-encryption-fig1.png)

> [!NOTE]
> <span data-ttu-id="8a856-107">The information in this document applies to encrypting virtual machines without using a Key Encryption Key (which is required for backing up virtual machines using Azure Backup).</span><span class="sxs-lookup"><span data-stu-id="8a856-107">The information in this document applies to encrypting virtual machines without using a Key Encryption Key (which is required for backing up virtual machines using Azure Backup).</span></span> <span data-ttu-id="8a856-108">Please see the article [Azure Disk Encryption for Windows and Linux Azure Virtual Machines](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) for information on how to use a Key Encryption Key to support Azure Backup for encrypted Azure Virtual Machines.</span><span class="sxs-lookup"><span data-stu-id="8a856-108">Please see the article [Azure Disk Encryption for Windows and Linux Azure Virtual Machines](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) for information on how to use a Key Encryption Key to support Azure Backup for encrypted Azure Virtual Machines.</span></span>
>
>

<span data-ttu-id="8a856-109">To encrypt Azure Virtual Machines that have been identified by Azure Security Center as needing encryption, we recommend the following steps:</span><span class="sxs-lookup"><span data-stu-id="8a856-109">To encrypt Azure Virtual Machines that have been identified by Azure Security Center as needing encryption, we recommend the following steps:</span></span>

* <span data-ttu-id="8a856-110">Install and configure Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8a856-110">Install and configure Azure PowerShell.</span></span> <span data-ttu-id="8a856-111">This will enable you to run the PowerShell commands required to set up the prerequisites required to encrypt Azure Virtual Machines.</span><span class="sxs-lookup"><span data-stu-id="8a856-111">This will enable you to run the PowerShell commands required to set up the prerequisites required to encrypt Azure Virtual Machines.</span></span>
* <span data-ttu-id="8a856-112">Obtain and run the Azure Disk Encryption Prerequisites Azure PowerShell script</span><span class="sxs-lookup"><span data-stu-id="8a856-112">Obtain and run the Azure Disk Encryption Prerequisites Azure PowerShell script</span></span>
* <span data-ttu-id="8a856-113">Encrypt your virtual machines</span><span class="sxs-lookup"><span data-stu-id="8a856-113">Encrypt your virtual machines</span></span>

<span data-ttu-id="8a856-114">The goal of this document is to enable you to encrypt your virtual machines, even if you have little or no background in Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8a856-114">The goal of this document is to enable you to encrypt your virtual machines, even if you have little or no background in Azure PowerShell.</span></span>
<span data-ttu-id="8a856-115">This document assumes you are using Windows 10 as the client machine from which you will configure Azure Disk Encryption.</span><span class="sxs-lookup"><span data-stu-id="8a856-115">This document assumes you are using Windows 10 as the client machine from which you will configure Azure Disk Encryption.</span></span>

<span data-ttu-id="8a856-116">There are many approaches that can be used to setup the prerequisites and to configure encryption for Azure Virtual Machines.</span><span class="sxs-lookup"><span data-stu-id="8a856-116">There are many approaches that can be used to setup the prerequisites and to configure encryption for Azure Virtual Machines.</span></span> <span data-ttu-id="8a856-117">If you are already well-versed in Azure PowerShell or Azure CLI, then you may prefer to use alternate approaches.</span><span class="sxs-lookup"><span data-stu-id="8a856-117">If you are already well-versed in Azure PowerShell or Azure CLI, then you may prefer to use alternate approaches.</span></span>

> [!NOTE]
> <span data-ttu-id="8a856-118">To learn more about alternate approaches to configuring encryption for Azure virtual machines, please see [Azure Disk Encryption for Windows and Linux Azure Virtual Machines](https://gallery.technet.microsoft.com/Azure-Disk-Encryption-for-a0018eb0).</span><span class="sxs-lookup"><span data-stu-id="8a856-118">To learn more about alternate approaches to configuring encryption for Azure virtual machines, please see [Azure Disk Encryption for Windows and Linux Azure Virtual Machines](https://gallery.technet.microsoft.com/Azure-Disk-Encryption-for-a0018eb0).</span></span>
>
>

## <a name="install-and-configure-azure-powershell"></a><span data-ttu-id="8a856-119">Install and configure Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="8a856-119">Install and configure Azure PowerShell</span></span>
<span data-ttu-id="8a856-120">You need Azure PowerShell version 1.2.1 or above installed on your computer.</span><span class="sxs-lookup"><span data-stu-id="8a856-120">You need Azure PowerShell version 1.2.1 or above installed on your computer.</span></span> <span data-ttu-id="8a856-121">The article [How to install and configure Azure PowerShell](/powershell/azureps-cmdlets-docs) contains all the steps you need to provision your computer to work with Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8a856-121">The article [How to install and configure Azure PowerShell](/powershell/azureps-cmdlets-docs) contains all the steps you need to provision your computer to work with Azure PowerShell.</span></span> <span data-ttu-id="8a856-122">The most straightforward approach is to use the Web PI installation approach mentioned in that article.</span><span class="sxs-lookup"><span data-stu-id="8a856-122">The most straightforward approach is to use the Web PI installation approach mentioned in that article.</span></span> <span data-ttu-id="8a856-123">Even if you already have Azure PowerShell installed, install again using the Web PI approach so that you have the latest version of Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="8a856-123">Even if you already have Azure PowerShell installed, install again using the Web PI approach so that you have the latest version of Azure PowerShell.</span></span>

## <a name="obtain-and-run-the-azure-disk-encryption-prerequisites-configuration-script"></a><span data-ttu-id="8a856-124">Obtain and run the Azure disk encryption prerequisites configuration script</span><span class="sxs-lookup"><span data-stu-id="8a856-124">Obtain and run the Azure disk encryption prerequisites configuration script</span></span>
<span data-ttu-id="8a856-125">The Azure Disk Encryption Prerequisites Configuration Script will set up all the prerequisites required for encrypting your Azure Virtual Machines.</span><span class="sxs-lookup"><span data-stu-id="8a856-125">The Azure Disk Encryption Prerequisites Configuration Script will set up all the prerequisites required for encrypting your Azure Virtual Machines.</span></span>

1. <span data-ttu-id="8a856-126">Go to the GitHub page that has the [Azure Disk Encryption Prerequisite Setup Script](https://github.com/Azure/azure-powershell/blob/dev/src/ResourceManager/Compute/Commands.Compute/Extension/AzureDiskEncryption/Scripts/AzureDiskEncryptionPreRequisiteSetup.ps1).</span><span class="sxs-lookup"><span data-stu-id="8a856-126">Go to the GitHub page that has the [Azure Disk Encryption Prerequisite Setup Script](https://github.com/Azure/azure-powershell/blob/dev/src/ResourceManager/Compute/Commands.Compute/Extension/AzureDiskEncryption/Scripts/AzureDiskEncryptionPreRequisiteSetup.ps1).</span></span>
2. <span data-ttu-id="8a856-127">On the GibHub page, click the **Raw** button.</span><span class="sxs-lookup"><span data-stu-id="8a856-127">On the GibHub page, click the **Raw** button.</span></span>
3. <span data-ttu-id="8a856-128">Use **CTRL-A** to select all the text on the page and then use **CTRL-C** to copy all the text on the page to the clipboard.</span><span class="sxs-lookup"><span data-stu-id="8a856-128">Use **CTRL-A** to select all the text on the page and then use **CTRL-C** to copy all the text on the page to the clipboard.</span></span>
4. <span data-ttu-id="8a856-129">Open **Notepad** and paste the copied text into Notepad.</span><span class="sxs-lookup"><span data-stu-id="8a856-129">Open **Notepad** and paste the copied text into Notepad.</span></span>
5. <span data-ttu-id="8a856-130">Create a new folder on your C: drive named **AzureADEScript**.</span><span class="sxs-lookup"><span data-stu-id="8a856-130">Create a new folder on your C: drive named **AzureADEScript**.</span></span>
6. <span data-ttu-id="8a856-131">Save the Notepad file – click **File**, then click **Save As**.</span><span class="sxs-lookup"><span data-stu-id="8a856-131">Save the Notepad file – click **File**, then click **Save As**.</span></span> <span data-ttu-id="8a856-132">In the File name textbox, enter **“ADEPrereqScript.ps1”** and click **Save**.</span><span class="sxs-lookup"><span data-stu-id="8a856-132">In the File name textbox, enter **“ADEPrereqScript.ps1”** and click **Save**.</span></span> <span data-ttu-id="8a856-133">(make sure you put the quotation marks around the name, otherwise it will save the file with a .txt file extension).</span><span class="sxs-lookup"><span data-stu-id="8a856-133">(make sure you put the quotation marks around the name, otherwise it will save the file with a .txt file extension).</span></span>

<span data-ttu-id="8a856-134">Now that the script content is saved, open the script in the PowerShell ISE:</span><span class="sxs-lookup"><span data-stu-id="8a856-134">Now that the script content is saved, open the script in the PowerShell ISE:</span></span>

1. <span data-ttu-id="8a856-135">In the Start Menu, click **Cortana**.</span><span class="sxs-lookup"><span data-stu-id="8a856-135">In the Start Menu, click **Cortana**.</span></span> <span data-ttu-id="8a856-136">Ask **Cortana** “PowerShell” by typing **PowerShell** in the Cortana search text box.</span><span class="sxs-lookup"><span data-stu-id="8a856-136">Ask **Cortana** “PowerShell” by typing **PowerShell** in the Cortana search text box.</span></span>
2. <span data-ttu-id="8a856-137">Right click **Windows PowerShell ISE** and click **Run as administrator**.</span><span class="sxs-lookup"><span data-stu-id="8a856-137">Right click **Windows PowerShell ISE** and click **Run as administrator**.</span></span>
3. <span data-ttu-id="8a856-138">In the **Administrator: Windows PowerShell ISE** window, click **View** and then click **Show Script Pane**.</span><span class="sxs-lookup"><span data-stu-id="8a856-138">In the **Administrator: Windows PowerShell ISE** window, click **View** and then click **Show Script Pane**.</span></span>
4. <span data-ttu-id="8a856-139">If you see the **Commands** pane on the right side of the window, click the **“x”** in the top right corner of the pane to close it.</span><span class="sxs-lookup"><span data-stu-id="8a856-139">If you see the **Commands** pane on the right side of the window, click the **“x”** in the top right corner of the pane to close it.</span></span> <span data-ttu-id="8a856-140">If the text is too small for you to see, use **CTRL+Add** (“Add” is the “+” sign).</span><span class="sxs-lookup"><span data-stu-id="8a856-140">If the text is too small for you to see, use **CTRL+Add** (“Add” is the “+” sign).</span></span> <span data-ttu-id="8a856-141">If the text is too large, use **CTRL+Subtract** (Subtract is the “-“ sign).</span><span class="sxs-lookup"><span data-stu-id="8a856-141">If the text is too large, use **CTRL+Subtract** (Subtract is the “-“ sign).</span></span>
5. <span data-ttu-id="8a856-142">Click **File** and then click **Open**.</span><span class="sxs-lookup"><span data-stu-id="8a856-142">Click **File** and then click **Open**.</span></span> <span data-ttu-id="8a856-143">Navigate to the **C:\AzureADEScript** folder and the double-click on the **ADEPrereqScript**.</span><span class="sxs-lookup"><span data-stu-id="8a856-143">Navigate to the **C:\AzureADEScript** folder and the double-click on the **ADEPrereqScript**.</span></span>
6. <span data-ttu-id="8a856-144">The **ADEPrereqScript** contents should now appear in the PowerShell ISE and is color-coded to help you see various components, such as commands, parameters and variables more easily.</span><span class="sxs-lookup"><span data-stu-id="8a856-144">The **ADEPrereqScript** contents should now appear in the PowerShell ISE and is color-coded to help you see various components, such as commands, parameters and variables more easily.</span></span>

<span data-ttu-id="8a856-145">You should now see something like the figure below.</span><span class="sxs-lookup"><span data-stu-id="8a856-145">You should now see something like the figure below.</span></span>

![PowerShell ISE window](https://docstestmedia1.blob.core.windows.net/azure-media/articles/security-center/media/security-center-disk-encryption/security-center-disk-encryption-fig2.png)

<span data-ttu-id="8a856-147">The top pane is referred to as the “script pane” and the bottom pane is referred to as the “console”.</span><span class="sxs-lookup"><span data-stu-id="8a856-147">The top pane is referred to as the “script pane” and the bottom pane is referred to as the “console”.</span></span> <span data-ttu-id="8a856-148">We will use these terms later in this article.</span><span class="sxs-lookup"><span data-stu-id="8a856-148">We will use these terms later in this article.</span></span>

## <a name="run-the-azure-disk-encryption-prerequisites-powershell-command"></a><span data-ttu-id="8a856-149">Run the Azure disk encryption prerequisites PowerShell command</span><span class="sxs-lookup"><span data-stu-id="8a856-149">Run the Azure disk encryption prerequisites PowerShell command</span></span>
<span data-ttu-id="8a856-150">The Azure Disk Encryption Prerequisites script will ask you for the following information after you start the script:</span><span class="sxs-lookup"><span data-stu-id="8a856-150">The Azure Disk Encryption Prerequisites script will ask you for the following information after you start the script:</span></span>

* <span data-ttu-id="8a856-151">**Resource Group Name** - Name of the Resource Group that you want to put the Key Vault into.</span><span class="sxs-lookup"><span data-stu-id="8a856-151">**Resource Group Name** - Name of the Resource Group that you want to put the Key Vault into.</span></span>  <span data-ttu-id="8a856-152">A new Resource Group with the name you enter will be created if there isn’t already one with that name created.</span><span class="sxs-lookup"><span data-stu-id="8a856-152">A new Resource Group with the name you enter will be created if there isn’t already one with that name created.</span></span> <span data-ttu-id="8a856-153">If you already have a Resource Group that you want to use in this subscription, then enter the name of that Resource Group.</span><span class="sxs-lookup"><span data-stu-id="8a856-153">If you already have a Resource Group that you want to use in this subscription, then enter the name of that Resource Group.</span></span>
* <span data-ttu-id="8a856-154">**Key Vault Name** - Name of the Key Vault in which encryption keys are to be placed.</span><span class="sxs-lookup"><span data-stu-id="8a856-154">**Key Vault Name** - Name of the Key Vault in which encryption keys are to be placed.</span></span> <span data-ttu-id="8a856-155">A new Key Vault with this name will be created if you don’t already have a Key Vault with this name.</span><span class="sxs-lookup"><span data-stu-id="8a856-155">A new Key Vault with this name will be created if you don’t already have a Key Vault with this name.</span></span> <span data-ttu-id="8a856-156">If you already have a Key Vault that you want to use, enter the name of the existing Key Vault.</span><span class="sxs-lookup"><span data-stu-id="8a856-156">If you already have a Key Vault that you want to use, enter the name of the existing Key Vault.</span></span>
* <span data-ttu-id="8a856-157">**Location** - Location of the Key Vault.</span><span class="sxs-lookup"><span data-stu-id="8a856-157">**Location** - Location of the Key Vault.</span></span> <span data-ttu-id="8a856-158">Make sure the Key Vault and VMs to be encrypted are in the same location.</span><span class="sxs-lookup"><span data-stu-id="8a856-158">Make sure the Key Vault and VMs to be encrypted are in the same location.</span></span> <span data-ttu-id="8a856-159">If you don’t know the location, there are steps later in this article that will show you how to find out.</span><span class="sxs-lookup"><span data-stu-id="8a856-159">If you don’t know the location, there are steps later in this article that will show you how to find out.</span></span>
* <span data-ttu-id="8a856-160">**Azure Active Directory Application Name** - Name of the Azure Active Directory application that will be used to write secrets to the Key Vault.</span><span class="sxs-lookup"><span data-stu-id="8a856-160">**Azure Active Directory Application Name** - Name of the Azure Active Directory application that will be used to write secrets to the Key Vault.</span></span> <span data-ttu-id="8a856-161">A new application with this name will be created if one doesn't exist.</span><span class="sxs-lookup"><span data-stu-id="8a856-161">A new application with this name will be created if one doesn't exist.</span></span> <span data-ttu-id="8a856-162">If you already have an Azure Active Directory application that you want to use, enter the name of that Azure Active Directory application.</span><span class="sxs-lookup"><span data-stu-id="8a856-162">If you already have an Azure Active Directory application that you want to use, enter the name of that Azure Active Directory application.</span></span>

> [!NOTE]
> <span data-ttu-id="8a856-163">If you’re curious as to why you need to create an Azure Active Directory application, please see *Register an application with Azure Active Directory* section in the article [Getting Started with Azure Key Vault](../key-vault/key-vault-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="8a856-163">If you’re curious as to why you need to create an Azure Active Directory application, please see *Register an application with Azure Active Directory* section in the article [Getting Started with Azure Key Vault](../key-vault/key-vault-get-started.md).</span></span>
>
>

<span data-ttu-id="8a856-164">Perform the following steps to encrypt an Azure Virtual Machine:</span><span class="sxs-lookup"><span data-stu-id="8a856-164">Perform the following steps to encrypt an Azure Virtual Machine:</span></span>

1. <span data-ttu-id="8a856-165">If you closed the PowerShell ISE, open an elevated instance of the PowerShell ISE.</span><span class="sxs-lookup"><span data-stu-id="8a856-165">If you closed the PowerShell ISE, open an elevated instance of the PowerShell ISE.</span></span> <span data-ttu-id="8a856-166">Follow the instructions earlier in this article if the PowerShell ISE is not already open.</span><span class="sxs-lookup"><span data-stu-id="8a856-166">Follow the instructions earlier in this article if the PowerShell ISE is not already open.</span></span> <span data-ttu-id="8a856-167">If you closed the script, then open the **ADEPrereqScript.ps1** clicking **File**, then **Open** and selecting the script from the **c:\AzureADEScript** folder.</span><span class="sxs-lookup"><span data-stu-id="8a856-167">If you closed the script, then open the **ADEPrereqScript.ps1** clicking **File**, then **Open** and selecting the script from the **c:\AzureADEScript** folder.</span></span> <span data-ttu-id="8a856-168">If you have followed this article from the start, then just move on to the next step.</span><span class="sxs-lookup"><span data-stu-id="8a856-168">If you have followed this article from the start, then just move on to the next step.</span></span>
2. <span data-ttu-id="8a856-169">In the console of the PowerShell ISE (the bottom pane of the PowerShell ISE), change the focus to the local of the script by typing **cd c:\AzureADEScript** and press **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="8a856-169">In the console of the PowerShell ISE (the bottom pane of the PowerShell ISE), change the focus to the local of the script by typing **cd c:\AzureADEScript** and press **ENTER**.</span></span>
3. <span data-ttu-id="8a856-170">Set the execution policy on your machine so that you can run the script.</span><span class="sxs-lookup"><span data-stu-id="8a856-170">Set the execution policy on your machine so that you can run the script.</span></span> <span data-ttu-id="8a856-171">Type **Set-ExecutionPolicy Unrestricted** in the console and then press ENTER.</span><span class="sxs-lookup"><span data-stu-id="8a856-171">Type **Set-ExecutionPolicy Unrestricted** in the console and then press ENTER.</span></span> <span data-ttu-id="8a856-172">If you see a dialog box telling about the effects of the change to execution policy, click either **Yes to all** or **Yes** (if you see **Yes to all**, select that option – if you do not see **Yes to all**, then click **Yes**).</span><span class="sxs-lookup"><span data-stu-id="8a856-172">If you see a dialog box telling about the effects of the change to execution policy, click either **Yes to all** or **Yes** (if you see **Yes to all**, select that option – if you do not see **Yes to all**, then click **Yes**).</span></span>
4. <span data-ttu-id="8a856-173">Log into your Azure account.</span><span class="sxs-lookup"><span data-stu-id="8a856-173">Log into your Azure account.</span></span> <span data-ttu-id="8a856-174">In the console, type **Login-AzureRmAccount** and press **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="8a856-174">In the console, type **Login-AzureRmAccount** and press **ENTER**.</span></span> <span data-ttu-id="8a856-175">A dialog box will appear in which you enter your credentials (make sure you have rights to change the virtual machines – if you do not have rights, you will not be able to encrypt them.</span><span class="sxs-lookup"><span data-stu-id="8a856-175">A dialog box will appear in which you enter your credentials (make sure you have rights to change the virtual machines – if you do not have rights, you will not be able to encrypt them.</span></span> <span data-ttu-id="8a856-176">If you are not sure, ask your subscription owner or administrator).</span><span class="sxs-lookup"><span data-stu-id="8a856-176">If you are not sure, ask your subscription owner or administrator).</span></span> <span data-ttu-id="8a856-177">You should see information about your **Environment**, **Account**, **TenantId**, **SubscriptionId** and **CurrentStorageAccount**.</span><span class="sxs-lookup"><span data-stu-id="8a856-177">You should see information about your **Environment**, **Account**, **TenantId**, **SubscriptionId** and **CurrentStorageAccount**.</span></span> <span data-ttu-id="8a856-178">Copy the **SubscriptionId** to Notepad.</span><span class="sxs-lookup"><span data-stu-id="8a856-178">Copy the **SubscriptionId** to Notepad.</span></span> <span data-ttu-id="8a856-179">You will need to use this in step #6.</span><span class="sxs-lookup"><span data-stu-id="8a856-179">You will need to use this in step #6.</span></span>
5. <span data-ttu-id="8a856-180">Find what subscription your virtual machine belongs to and its location.</span><span class="sxs-lookup"><span data-stu-id="8a856-180">Find what subscription your virtual machine belongs to and its location.</span></span> <span data-ttu-id="8a856-181">Go to [https://portal.azure.com](ttps://portal.azure.com) and log in.</span><span class="sxs-lookup"><span data-stu-id="8a856-181">Go to [https://portal.azure.com](ttps://portal.azure.com) and log in.</span></span>  <span data-ttu-id="8a856-182">On the left side of the page, click **Virtual Machines**.</span><span class="sxs-lookup"><span data-stu-id="8a856-182">On the left side of the page, click **Virtual Machines**.</span></span> <span data-ttu-id="8a856-183">You will see a list of your virtual machines and the subscriptions they belong to.</span><span class="sxs-lookup"><span data-stu-id="8a856-183">You will see a list of your virtual machines and the subscriptions they belong to.</span></span>

   ![Virtual Machines](https://docstestmedia1.blob.core.windows.net/azure-media/articles/security-center/media/security-center-disk-encryption/security-center-disk-encryption-fig3.png)
6. <span data-ttu-id="8a856-185">Return to the PowerShell ISE.</span><span class="sxs-lookup"><span data-stu-id="8a856-185">Return to the PowerShell ISE.</span></span> <span data-ttu-id="8a856-186">Set the subscription context in which the script will be run.</span><span class="sxs-lookup"><span data-stu-id="8a856-186">Set the subscription context in which the script will be run.</span></span> <span data-ttu-id="8a856-187">In the console, type **Select-AzureRmSubscription –SubscriptionId <your_subscription_Id>** (replace **< your_subscription_Id >** with your actual Subscription ID) and press **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="8a856-187">In the console, type **Select-AzureRmSubscription –SubscriptionId <your_subscription_Id>** (replace **< your_subscription_Id >** with your actual Subscription ID) and press **ENTER**.</span></span> <span data-ttu-id="8a856-188">You will see information about the Environment, **Account**, **TenantId**, **SubscriptionId** and **CurrentStorageAccount**.</span><span class="sxs-lookup"><span data-stu-id="8a856-188">You will see information about the Environment, **Account**, **TenantId**, **SubscriptionId** and **CurrentStorageAccount**.</span></span>
7. <span data-ttu-id="8a856-189">You are now ready to run the script.</span><span class="sxs-lookup"><span data-stu-id="8a856-189">You are now ready to run the script.</span></span> <span data-ttu-id="8a856-190">Click the **Run Script** button or press **F5** on the keyboard.</span><span class="sxs-lookup"><span data-stu-id="8a856-190">Click the **Run Script** button or press **F5** on the keyboard.</span></span>

   ![Executing PowerShell Script](https://docstestmedia1.blob.core.windows.net/azure-media/articles/security-center/media/security-center-disk-encryption/security-center-disk-encryption-fig4.png)
8. <span data-ttu-id="8a856-192">The script asks for **resourceGroupName:** - enter the name of *Resource Group* you want to use, then press **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="8a856-192">The script asks for **resourceGroupName:** - enter the name of *Resource Group* you want to use, then press **ENTER**.</span></span> <span data-ttu-id="8a856-193">If you don’t have one, enter a name you want to use for a new one.</span><span class="sxs-lookup"><span data-stu-id="8a856-193">If you don’t have one, enter a name you want to use for a new one.</span></span> <span data-ttu-id="8a856-194">If you already have a *Resource Group* that you want to use (such as the one that your virtual machine is in), enter the name of the existing Resource Group.</span><span class="sxs-lookup"><span data-stu-id="8a856-194">If you already have a *Resource Group* that you want to use (such as the one that your virtual machine is in), enter the name of the existing Resource Group.</span></span>
9. <span data-ttu-id="8a856-195">The script asks for **keyVaultName:** - enter the name of the *Key Vault* you want to use, then press ENTER.</span><span class="sxs-lookup"><span data-stu-id="8a856-195">The script asks for **keyVaultName:** - enter the name of the *Key Vault* you want to use, then press ENTER.</span></span> <span data-ttu-id="8a856-196">If you don’t have one, enter a name you want to use for a new one.</span><span class="sxs-lookup"><span data-stu-id="8a856-196">If you don’t have one, enter a name you want to use for a new one.</span></span> <span data-ttu-id="8a856-197">If you already have a Key Vault that you want to use, enter the name of the existing *Key Vault*.</span><span class="sxs-lookup"><span data-stu-id="8a856-197">If you already have a Key Vault that you want to use, enter the name of the existing *Key Vault*.</span></span>
10. <span data-ttu-id="8a856-198">The script asks for **location:** - enter the name of the location in which the VM you want to encrypt is located, then press **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="8a856-198">The script asks for **location:** - enter the name of the location in which the VM you want to encrypt is located, then press **ENTER**.</span></span> <span data-ttu-id="8a856-199">If you don’t remember the location, go back to step #5.</span><span class="sxs-lookup"><span data-stu-id="8a856-199">If you don’t remember the location, go back to step #5.</span></span>
11. <span data-ttu-id="8a856-200">The script asks for **aadAppName:** - enter the name of the *Azure Active Directory* application you want to use, then press **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="8a856-200">The script asks for **aadAppName:** - enter the name of the *Azure Active Directory* application you want to use, then press **ENTER**.</span></span> <span data-ttu-id="8a856-201">If you don’t have one, enter a name you want to use for a new one.</span><span class="sxs-lookup"><span data-stu-id="8a856-201">If you don’t have one, enter a name you want to use for a new one.</span></span> <span data-ttu-id="8a856-202">If you already have an *Azure Active Directory application* that you want to use, enter the name of the existing *Azure Active Directory application*.</span><span class="sxs-lookup"><span data-stu-id="8a856-202">If you already have an *Azure Active Directory application* that you want to use, enter the name of the existing *Azure Active Directory application*.</span></span>
12. <span data-ttu-id="8a856-203">A log in dialog box will appear.</span><span class="sxs-lookup"><span data-stu-id="8a856-203">A log in dialog box will appear.</span></span> <span data-ttu-id="8a856-204">Provide your credentials (yes, you have logged in once, but now you need to do it again).</span><span class="sxs-lookup"><span data-stu-id="8a856-204">Provide your credentials (yes, you have logged in once, but now you need to do it again).</span></span>
13. <span data-ttu-id="8a856-205">The script runs and when complete it will ask you to copy the values of the **aadClientID**, **aadClientSecret**, **diskEncryptionKeyVaultUrl**, and **keyVaultResourceId**.</span><span class="sxs-lookup"><span data-stu-id="8a856-205">The script runs and when complete it will ask you to copy the values of the **aadClientID**, **aadClientSecret**, **diskEncryptionKeyVaultUrl**, and **keyVaultResourceId**.</span></span> <span data-ttu-id="8a856-206">Copy each of these values to the clipboard and paste them into Notepad.</span><span class="sxs-lookup"><span data-stu-id="8a856-206">Copy each of these values to the clipboard and paste them into Notepad.</span></span>
14. <span data-ttu-id="8a856-207">Return to the PowerShell ISE and place the cursor at the end of the last line, and press **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="8a856-207">Return to the PowerShell ISE and place the cursor at the end of the last line, and press **ENTER**.</span></span>

<span data-ttu-id="8a856-208">The output of the script should look something like the screen below:</span><span class="sxs-lookup"><span data-stu-id="8a856-208">The output of the script should look something like the screen below:</span></span>

![PowerShell output](https://docstestmedia1.blob.core.windows.net/azure-media/articles/security-center/media/security-center-disk-encryption/security-center-disk-encryption-fig5.png)

## <a name="encrypt-the-azure-virtual-machine"></a><span data-ttu-id="8a856-210">Encrypt the Azure virtual machine</span><span class="sxs-lookup"><span data-stu-id="8a856-210">Encrypt the Azure virtual machine</span></span>
<span data-ttu-id="8a856-211">You are now ready to encrypt your virtual machine.</span><span class="sxs-lookup"><span data-stu-id="8a856-211">You are now ready to encrypt your virtual machine.</span></span> <span data-ttu-id="8a856-212">If your virtual machine is located in the same Resource Group as your Key Vault, you can move on to the encryption steps section.</span><span class="sxs-lookup"><span data-stu-id="8a856-212">If your virtual machine is located in the same Resource Group as your Key Vault, you can move on to the encryption steps section.</span></span> <span data-ttu-id="8a856-213">However, if your virtual machine is not in the same Resource Group as your Key Vault, you will need to enter the following in the console in the PowerShell ISE:</span><span class="sxs-lookup"><span data-stu-id="8a856-213">However, if your virtual machine is not in the same Resource Group as your Key Vault, you will need to enter the following in the console in the PowerShell ISE:</span></span>

<span data-ttu-id="8a856-214">**$resourceGroupName = <’Virtual_Machine_RG’>**</span><span class="sxs-lookup"><span data-stu-id="8a856-214">**$resourceGroupName = <’Virtual_Machine_RG’>**</span></span>

<span data-ttu-id="8a856-215">Replace **< Virtual_Machine_RG >** with the name of the Resource Group in which your virtual machines are contained, surrounded by a single quote.</span><span class="sxs-lookup"><span data-stu-id="8a856-215">Replace **< Virtual_Machine_RG >** with the name of the Resource Group in which your virtual machines are contained, surrounded by a single quote.</span></span> <span data-ttu-id="8a856-216">Then press **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="8a856-216">Then press **ENTER**.</span></span>
<span data-ttu-id="8a856-217">To confirm that the correct Resource Group name was entered, type the following in the PowerShell ISE console:</span><span class="sxs-lookup"><span data-stu-id="8a856-217">To confirm that the correct Resource Group name was entered, type the following in the PowerShell ISE console:</span></span>

<span data-ttu-id="8a856-218">**$resourceGroupName**</span><span class="sxs-lookup"><span data-stu-id="8a856-218">**$resourceGroupName**</span></span>

<span data-ttu-id="8a856-219">Press **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="8a856-219">Press **ENTER**.</span></span> <span data-ttu-id="8a856-220">You should see the name of Resource Group that your virtual machines are located in.</span><span class="sxs-lookup"><span data-stu-id="8a856-220">You should see the name of Resource Group that your virtual machines are located in.</span></span> <span data-ttu-id="8a856-221">For example:</span><span class="sxs-lookup"><span data-stu-id="8a856-221">For example:</span></span>

![PowerShell output](https://docstestmedia1.blob.core.windows.net/azure-media/articles/security-center/media/security-center-disk-encryption/security-center-disk-encryption-fig6.png)

### <a name="encryption-steps"></a><span data-ttu-id="8a856-223">Encryption steps</span><span class="sxs-lookup"><span data-stu-id="8a856-223">Encryption steps</span></span>
<span data-ttu-id="8a856-224">First, you need to tell PowerShell the name of the virtual machine you want to encrypt.</span><span class="sxs-lookup"><span data-stu-id="8a856-224">First, you need to tell PowerShell the name of the virtual machine you want to encrypt.</span></span> <span data-ttu-id="8a856-225">In the console, type:</span><span class="sxs-lookup"><span data-stu-id="8a856-225">In the console, type:</span></span>

<span data-ttu-id="8a856-226">**$vmName = <’your_vm_name’>**</span><span class="sxs-lookup"><span data-stu-id="8a856-226">**$vmName = <’your_vm_name’>**</span></span>

<span data-ttu-id="8a856-227">Replace **<’your_vm_name’>** with the name of your VM (make sure the name is surrounded by a single quote) and then press **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="8a856-227">Replace **<’your_vm_name’>** with the name of your VM (make sure the name is surrounded by a single quote) and then press **ENTER**.</span></span>

<span data-ttu-id="8a856-228">To confirm that the correct VM name was entered, type:</span><span class="sxs-lookup"><span data-stu-id="8a856-228">To confirm that the correct VM name was entered, type:</span></span>

<span data-ttu-id="8a856-229">**$vmName**</span><span class="sxs-lookup"><span data-stu-id="8a856-229">**$vmName**</span></span>

<span data-ttu-id="8a856-230">Press **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="8a856-230">Press **ENTER**.</span></span> <span data-ttu-id="8a856-231">You should see the name of the virtual machine you want to encrypt.</span><span class="sxs-lookup"><span data-stu-id="8a856-231">You should see the name of the virtual machine you want to encrypt.</span></span> <span data-ttu-id="8a856-232">For example:</span><span class="sxs-lookup"><span data-stu-id="8a856-232">For example:</span></span>

![PowerShell output](https://docstestmedia1.blob.core.windows.net/azure-media/articles/security-center/media/security-center-disk-encryption/security-center-disk-encryption-fig7.png)

<span data-ttu-id="8a856-234">There are two methods to run the encryption command to encrypt all drives on the virtual machine.</span><span class="sxs-lookup"><span data-stu-id="8a856-234">There are two methods to run the encryption command to encrypt all drives on the virtual machine.</span></span> <span data-ttu-id="8a856-235">The first method is to type the following command in the PowerShell ISE console:</span><span class="sxs-lookup"><span data-stu-id="8a856-235">The first method is to type the following command in the PowerShell ISE console:</span></span>

~~~
Set-AzureRmVMDiskEncryptionExtension -ResourceGroupName $resourceGroupName -VMName $vmName -AadClientID $aadClientID -AadClientSecret $aadClientSecret -DiskEncryptionKeyVaultUrl $diskEncryptionKeyVaultUrl -DiskEncryptionKeyVaultId $keyVaultResourceId -VolumeType All
~~~

<span data-ttu-id="8a856-236">After typing this command press **ENTER**.</span><span class="sxs-lookup"><span data-stu-id="8a856-236">After typing this command press **ENTER**.</span></span>

<span data-ttu-id="8a856-237">The second method is to click in the script pane (the top pane of the PowerShell ISE) and scroll down to the bottom of the script.</span><span class="sxs-lookup"><span data-stu-id="8a856-237">The second method is to click in the script pane (the top pane of the PowerShell ISE) and scroll down to the bottom of the script.</span></span> <span data-ttu-id="8a856-238">Highlight the command listed above, and then right click it and then click **Run Selection** or press **F8** on the keyboard.</span><span class="sxs-lookup"><span data-stu-id="8a856-238">Highlight the command listed above, and then right click it and then click **Run Selection** or press **F8** on the keyboard.</span></span>

![PowerShell ISE](https://docstestmedia1.blob.core.windows.net/azure-media/articles/security-center/media/security-center-disk-encryption/security-center-disk-encryption-fig8.png)

<span data-ttu-id="8a856-240">Regardless of the method you use, a dialog box will appear informing you that it will take 10-15 minutes for the operation to complete.</span><span class="sxs-lookup"><span data-stu-id="8a856-240">Regardless of the method you use, a dialog box will appear informing you that it will take 10-15 minutes for the operation to complete.</span></span> <span data-ttu-id="8a856-241">Click **Yes**.</span><span class="sxs-lookup"><span data-stu-id="8a856-241">Click **Yes**.</span></span>

<span data-ttu-id="8a856-242">While the encryption process is taking place, you can return to the Azure Portal and see the status of the virtual machine.</span><span class="sxs-lookup"><span data-stu-id="8a856-242">While the encryption process is taking place, you can return to the Azure Portal and see the status of the virtual machine.</span></span> <span data-ttu-id="8a856-243">On the left side of the page, click **Virtual Machines**, then in the **Virtual Machines** blade, click the name of the virtual machine you’re encrypting.</span><span class="sxs-lookup"><span data-stu-id="8a856-243">On the left side of the page, click **Virtual Machines**, then in the **Virtual Machines** blade, click the name of the virtual machine you’re encrypting.</span></span> <span data-ttu-id="8a856-244">In the blade that appears, you’ll notice that the **Status** says that it’s **Updating**.</span><span class="sxs-lookup"><span data-stu-id="8a856-244">In the blade that appears, you’ll notice that the **Status** says that it’s **Updating**.</span></span> <span data-ttu-id="8a856-245">This demonstrates that encryption is in process.</span><span class="sxs-lookup"><span data-stu-id="8a856-245">This demonstrates that encryption is in process.</span></span>

![More details about the VM](https://docstestmedia1.blob.core.windows.net/azure-media/articles/security-center/media/security-center-disk-encryption/security-center-disk-encryption-fig9.png)

<span data-ttu-id="8a856-247">Return to the PowerShell ISE.</span><span class="sxs-lookup"><span data-stu-id="8a856-247">Return to the PowerShell ISE.</span></span> <span data-ttu-id="8a856-248">When the script completes, you’ll see what appears in the figure below.</span><span class="sxs-lookup"><span data-stu-id="8a856-248">When the script completes, you’ll see what appears in the figure below.</span></span>

![PowerShell output](https://docstestmedia1.blob.core.windows.net/azure-media/articles/security-center/media/security-center-disk-encryption/security-center-disk-encryption-fig10.png)

<span data-ttu-id="8a856-250">To demonstrate that the virtual machine is now encrypted, return to the Azure Portal and click **Virtual Machines** on the left side of the page.</span><span class="sxs-lookup"><span data-stu-id="8a856-250">To demonstrate that the virtual machine is now encrypted, return to the Azure Portal and click **Virtual Machines** on the left side of the page.</span></span> <span data-ttu-id="8a856-251">Click the name of the virtual machine you encrypted.</span><span class="sxs-lookup"><span data-stu-id="8a856-251">Click the name of the virtual machine you encrypted.</span></span> <span data-ttu-id="8a856-252">In the **Settings** blade, click **Disks**.</span><span class="sxs-lookup"><span data-stu-id="8a856-252">In the **Settings** blade, click **Disks**.</span></span>

![Settings options](https://docstestmedia1.blob.core.windows.net/azure-media/articles/security-center/media/security-center-disk-encryption/security-center-disk-encryption-fig11.png)

<span data-ttu-id="8a856-254">On the **Disks** blade, you will see that **Encryption** is **Enabled**.</span><span class="sxs-lookup"><span data-stu-id="8a856-254">On the **Disks** blade, you will see that **Encryption** is **Enabled**.</span></span>

![Disks properties](https://docstestmedia1.blob.core.windows.net/azure-media/articles/security-center/media/security-center-disk-encryption/security-center-disk-encryption-fig12.png)

## <a name="next-steps"></a><span data-ttu-id="8a856-256">Next steps</span><span class="sxs-lookup"><span data-stu-id="8a856-256">Next steps</span></span>
<span data-ttu-id="8a856-257">In this document, you learned how to encrypt an Azure Virtual Machine.</span><span class="sxs-lookup"><span data-stu-id="8a856-257">In this document, you learned how to encrypt an Azure Virtual Machine.</span></span> <span data-ttu-id="8a856-258">To learn more about Azure Security Center, see the following:</span><span class="sxs-lookup"><span data-stu-id="8a856-258">To learn more about Azure Security Center, see the following:</span></span>

* <span data-ttu-id="8a856-259">[Security health monitoring in Azure Security Center](security-center-monitoring.md) – Learn how to monitor the health of your Azure resources</span><span class="sxs-lookup"><span data-stu-id="8a856-259">[Security health monitoring in Azure Security Center](security-center-monitoring.md) – Learn how to monitor the health of your Azure resources</span></span>
* <span data-ttu-id="8a856-260">[Managing and responding to security alerts in Azure Security Center](security-center-managing-and-responding-alerts.md) - Learn how to manage and respond to security alerts</span><span class="sxs-lookup"><span data-stu-id="8a856-260">[Managing and responding to security alerts in Azure Security Center](security-center-managing-and-responding-alerts.md) - Learn how to manage and respond to security alerts</span></span>
* <span data-ttu-id="8a856-261">[Azure Security Center FAQ](security-center-faq.md) – Find frequently asked questions about using the service</span><span class="sxs-lookup"><span data-stu-id="8a856-261">[Azure Security Center FAQ](security-center-faq.md) – Find frequently asked questions about using the service</span></span>
* <span data-ttu-id="8a856-262">[Azure Security Blog](http://blogs.msdn.com/b/azuresecurity/) – Find blog posts about Azure security and compliance</span><span class="sxs-lookup"><span data-stu-id="8a856-262">[Azure Security Blog](http://blogs.msdn.com/b/azuresecurity/) – Find blog posts about Azure security and compliance</span></span>












