---
title: Managed Service Identity with Azure Event Hubs preview | Microsoft Docs
description: Use Managed Service Identities with Azure Event Hubs
services: event-hubs
documentationcenter: na
author: ShubhaVijayasarathy
manager: timlt
ms.service: event-hubs
ms.devlang: na
ms.topic: article
ms.date: 07/05/2018
ms.author: shvija
ms.openlocfilehash: f87a04b3b78bab124ca1b75006ed2c93a74f9198
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44870877"
---
# <a name="managed-service-identity-preview"></a><span data-ttu-id="95a7d-103">Managed Service Identity (preview)</span><span class="sxs-lookup"><span data-stu-id="95a7d-103">Managed Service Identity (preview)</span></span>

<span data-ttu-id="95a7d-104">A Managed Service Identity (MSI) is a cross-Azure feature that enables you to create a secure identity associated with the deployment under which your application code runs.</span><span class="sxs-lookup"><span data-stu-id="95a7d-104">A Managed Service Identity (MSI) is a cross-Azure feature that enables you to create a secure identity associated with the deployment under which your application code runs.</span></span> <span data-ttu-id="95a7d-105">You can then associate that identity with access-control roles that grant custom permissions for accessing specific Azure resources that your application needs.</span><span class="sxs-lookup"><span data-stu-id="95a7d-105">You can then associate that identity with access-control roles that grant custom permissions for accessing specific Azure resources that your application needs.</span></span> 

<span data-ttu-id="95a7d-106">With MSI, the Azure platform manages this runtime identity.</span><span class="sxs-lookup"><span data-stu-id="95a7d-106">With MSI, the Azure platform manages this runtime identity.</span></span> <span data-ttu-id="95a7d-107">You do not need to store and protect access keys in your application code or configuration, either for the identity itself, or for the resources you need to access.</span><span class="sxs-lookup"><span data-stu-id="95a7d-107">You do not need to store and protect access keys in your application code or configuration, either for the identity itself, or for the resources you need to access.</span></span> <span data-ttu-id="95a7d-108">An Event Hubs client app running inside an Azure App Service application or in a virtual machine with enabled MSI support does not need to handle SAS rules and keys, or any other access tokens.</span><span class="sxs-lookup"><span data-stu-id="95a7d-108">An Event Hubs client app running inside an Azure App Service application or in a virtual machine with enabled MSI support does not need to handle SAS rules and keys, or any other access tokens.</span></span> <span data-ttu-id="95a7d-109">The client app only needs the endpoint address of the Event Hubs namespace.</span><span class="sxs-lookup"><span data-stu-id="95a7d-109">The client app only needs the endpoint address of the Event Hubs namespace.</span></span> <span data-ttu-id="95a7d-110">When the app connects, Event Hubs binds the MSI context to the client in an operation that is shown in an example later in this article.</span><span class="sxs-lookup"><span data-stu-id="95a7d-110">When the app connects, Event Hubs binds the MSI context to the client in an operation that is shown in an example later in this article.</span></span>

<span data-ttu-id="95a7d-111">Once it is associated with a managed service identity, an Event Hubs client can perform all authorized operations.</span><span class="sxs-lookup"><span data-stu-id="95a7d-111">Once it is associated with a managed service identity, an Event Hubs client can perform all authorized operations.</span></span> <span data-ttu-id="95a7d-112">Authorization is granted by associating an MSI with Event Hubs roles.</span><span class="sxs-lookup"><span data-stu-id="95a7d-112">Authorization is granted by associating an MSI with Event Hubs roles.</span></span> 

## <a name="event-hubs-roles-and-permissions"></a><span data-ttu-id="95a7d-113">Event Hubs roles and permissions</span><span class="sxs-lookup"><span data-stu-id="95a7d-113">Event Hubs roles and permissions</span></span>

<span data-ttu-id="95a7d-114">For the initial public preview release, you can only add a managed service identity to the "Owner" or "Contributor" roles of an Event Hubs namespace, which grants the identity full control on all entities in the namespace.</span><span class="sxs-lookup"><span data-stu-id="95a7d-114">For the initial public preview release, you can only add a managed service identity to the "Owner" or "Contributor" roles of an Event Hubs namespace, which grants the identity full control on all entities in the namespace.</span></span> <span data-ttu-id="95a7d-115">However, management operations that change the namespace topology are initially supported only though Azure Resource Manager and not through the native Event Hubs REST management interface.</span><span class="sxs-lookup"><span data-stu-id="95a7d-115">However, management operations that change the namespace topology are initially supported only though Azure Resource Manager and not through the native Event Hubs REST management interface.</span></span> <span data-ttu-id="95a7d-116">This support also means that you cannot use the .NET Framework client [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) object within a managed service identity.</span><span class="sxs-lookup"><span data-stu-id="95a7d-116">This support also means that you cannot use the .NET Framework client [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager) object within a managed service identity.</span></span> 
 
## <a name="use-event-hubs-with-a-managed-service-identity"></a><span data-ttu-id="95a7d-117">Use Event Hubs with a Managed Service Identity</span><span class="sxs-lookup"><span data-stu-id="95a7d-117">Use Event Hubs with a Managed Service Identity</span></span>

<span data-ttu-id="95a7d-118">The following section describes the steps required to create and deploy a sample application that runs under a managed service identity, how to grant that identity access to an Event Hubs namespace, and how the application interacts with event hubs using that identity.</span><span class="sxs-lookup"><span data-stu-id="95a7d-118">The following section describes the steps required to create and deploy a sample application that runs under a managed service identity, how to grant that identity access to an Event Hubs namespace, and how the application interacts with event hubs using that identity.</span></span>

<span data-ttu-id="95a7d-119">This introduction describes a web application hosted in [Azure App Service](https://azure.microsoft.com/services/app-service/).</span><span class="sxs-lookup"><span data-stu-id="95a7d-119">This introduction describes a web application hosted in [Azure App Service](https://azure.microsoft.com/services/app-service/).</span></span> <span data-ttu-id="95a7d-120">The steps required for a VM-hosted application are similar.</span><span class="sxs-lookup"><span data-stu-id="95a7d-120">The steps required for a VM-hosted application are similar.</span></span>

### <a name="create-an-app-service-web-application"></a><span data-ttu-id="95a7d-121">Create an App Service web application</span><span class="sxs-lookup"><span data-stu-id="95a7d-121">Create an App Service web application</span></span>

<span data-ttu-id="95a7d-122">The first step is to create an App Service ASP.NET application.</span><span class="sxs-lookup"><span data-stu-id="95a7d-122">The first step is to create an App Service ASP.NET application.</span></span> <span data-ttu-id="95a7d-123">If you're not familiar with how to do this in Azure, follow [this how-to guide](../app-service/app-service-web-get-started-dotnet-framework.md).</span><span class="sxs-lookup"><span data-stu-id="95a7d-123">If you're not familiar with how to do this in Azure, follow [this how-to guide](../app-service/app-service-web-get-started-dotnet-framework.md).</span></span> <span data-ttu-id="95a7d-124">However, instead of creating an MVC application as shown in the tutorial, create a Web Forms application.</span><span class="sxs-lookup"><span data-stu-id="95a7d-124">However, instead of creating an MVC application as shown in the tutorial, create a Web Forms application.</span></span>

### <a name="set-up-the-managed-service-identity"></a><span data-ttu-id="95a7d-125">Set up the managed service identity</span><span class="sxs-lookup"><span data-stu-id="95a7d-125">Set up the managed service identity</span></span>

<span data-ttu-id="95a7d-126">Once you create the application, navigate to the newly created web app in the Azure portal (also shown in the how-to), then navigate to the **Managed Service Identity** page, and enable the feature:</span><span class="sxs-lookup"><span data-stu-id="95a7d-126">Once you create the application, navigate to the newly created web app in the Azure portal (also shown in the how-to), then navigate to the **Managed Service Identity** page, and enable the feature:</span></span> 

![](./media/event-hubs-managed-service-identity/msi1.png)
 
<span data-ttu-id="95a7d-127">Once you've enabled the feature, a new service identity is created in your Azure Active Directory, and configured into the App Service host.</span><span class="sxs-lookup"><span data-stu-id="95a7d-127">Once you've enabled the feature, a new service identity is created in your Azure Active Directory, and configured into the App Service host.</span></span>

### <a name="create-a-new-event-hubs-namespace"></a><span data-ttu-id="95a7d-128">Create a new Event Hubs namespace</span><span class="sxs-lookup"><span data-stu-id="95a7d-128">Create a new Event Hubs namespace</span></span>

<span data-ttu-id="95a7d-129">Next, [create an Event Hubs namespace](event-hubs-create.md) in one of the Azure regions that has preview support for MSI: **US East**, **US East 2**, or **West Europe**.</span><span class="sxs-lookup"><span data-stu-id="95a7d-129">Next, [create an Event Hubs namespace](event-hubs-create.md) in one of the Azure regions that has preview support for MSI: **US East**, **US East 2**, or **West Europe**.</span></span> 

<span data-ttu-id="95a7d-130">Navigate to the namespace **Access Control (IAM)** page on the portal, and then click **Add** to add the managed service identity to the **Owner** role.</span><span class="sxs-lookup"><span data-stu-id="95a7d-130">Navigate to the namespace **Access Control (IAM)** page on the portal, and then click **Add** to add the managed service identity to the **Owner** role.</span></span> <span data-ttu-id="95a7d-131">To do so, search for the name of the web application in the **Add permissions** panel **Select** field, and then click the entry.</span><span class="sxs-lookup"><span data-stu-id="95a7d-131">To do so, search for the name of the web application in the **Add permissions** panel **Select** field, and then click the entry.</span></span> <span data-ttu-id="95a7d-132">Then click **Save**.</span><span class="sxs-lookup"><span data-stu-id="95a7d-132">Then click **Save**.</span></span>

![](./media/event-hubs-managed-service-identity/msi2.png)
 
<span data-ttu-id="95a7d-133">The managed service identity for the web application now has access to the Event Hubs namespace, and to the event hub you previously created.</span><span class="sxs-lookup"><span data-stu-id="95a7d-133">The managed service identity for the web application now has access to the Event Hubs namespace, and to the event hub you previously created.</span></span> 

### <a name="run-the-app"></a><span data-ttu-id="95a7d-134">Run the app</span><span class="sxs-lookup"><span data-stu-id="95a7d-134">Run the app</span></span>

<span data-ttu-id="95a7d-135">Now modify the default page of the ASP.NET application you created.</span><span class="sxs-lookup"><span data-stu-id="95a7d-135">Now modify the default page of the ASP.NET application you created.</span></span> <span data-ttu-id="95a7d-136">You can also use the web application code from [this GitHub repository](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/MSI/EventHubsMSIDemoWebApp).</span><span class="sxs-lookup"><span data-stu-id="95a7d-136">You can also use the web application code from [this GitHub repository](https://github.com/Azure/azure-event-hubs/tree/master/samples/DotNet/MSI/EventHubsMSIDemoWebApp).</span></span> 

>[!NOTE] 
> <span data-ttu-id="95a7d-137">While the MSI feature is in preview, be sure to use the [preview version of the Service Bus library](https://www.nuget.org/packages/WindowsAzure.ServiceBus/4.2.2-preview) in order to access the new APIs.</span><span class="sxs-lookup"><span data-stu-id="95a7d-137">While the MSI feature is in preview, be sure to use the [preview version of the Service Bus library](https://www.nuget.org/packages/WindowsAzure.ServiceBus/4.2.2-preview) in order to access the new APIs.</span></span> 

<span data-ttu-id="95a7d-138">Once you start the app, point your browser to EventHubsMSIDemo.aspx.</span><span class="sxs-lookup"><span data-stu-id="95a7d-138">Once you start the app, point your browser to EventHubsMSIDemo.aspx.</span></span> <span data-ttu-id="95a7d-139">Alternatively, set it as your start page.</span><span class="sxs-lookup"><span data-stu-id="95a7d-139">Alternatively, set it as your start page.</span></span> <span data-ttu-id="95a7d-140">The code can be found in the EventHubsMSIDemo.aspx.cs file.</span><span class="sxs-lookup"><span data-stu-id="95a7d-140">The code can be found in the EventHubsMSIDemo.aspx.cs file.</span></span> <span data-ttu-id="95a7d-141">The result is a minimal web application with a few entry fields, and with **send** and **receive** buttons that connect to Event Hubs to either send or receive events.</span><span class="sxs-lookup"><span data-stu-id="95a7d-141">The result is a minimal web application with a few entry fields, and with **send** and **receive** buttons that connect to Event Hubs to either send or receive events.</span></span> 

<span data-ttu-id="95a7d-142">Note how the [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) object is initialized.</span><span class="sxs-lookup"><span data-stu-id="95a7d-142">Note how the [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) object is initialized.</span></span> <span data-ttu-id="95a7d-143">Instead of using the Shared Access Token (SAS) token provider, the code creates a token provider for the managed service identity with the `TokenProvider.CreateManagedServiceIdentityTokenProvider(ServiceAudience.EventHubAudience)` call.</span><span class="sxs-lookup"><span data-stu-id="95a7d-143">Instead of using the Shared Access Token (SAS) token provider, the code creates a token provider for the managed service identity with the `TokenProvider.CreateManagedServiceIdentityTokenProvider(ServiceAudience.EventHubAudience)` call.</span></span> <span data-ttu-id="95a7d-144">As such, there are no secrets to retain and use.</span><span class="sxs-lookup"><span data-stu-id="95a7d-144">As such, there are no secrets to retain and use.</span></span> <span data-ttu-id="95a7d-145">The flow of the managed service identity context to Event Hubs and the authorization handshake are automatically handled by the token provider, which is a simpler model than using SAS.</span><span class="sxs-lookup"><span data-stu-id="95a7d-145">The flow of the managed service identity context to Event Hubs and the authorization handshake are automatically handled by the token provider, which is a simpler model than using SAS.</span></span>

<span data-ttu-id="95a7d-146">Once you have made these changes, publish and run the application.</span><span class="sxs-lookup"><span data-stu-id="95a7d-146">Once you have made these changes, publish and run the application.</span></span> <span data-ttu-id="95a7d-147">An easy way to obtain the correct publishing data is to download and then import a publishing profile in Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="95a7d-147">An easy way to obtain the correct publishing data is to download and then import a publishing profile in Visual Studio:</span></span>

![](./media/event-hubs-managed-service-identity/msi3.png)
 
<span data-ttu-id="95a7d-148">To send or receive messages, enter the name of the namespace and the name of the entity you created, then click either **send** or **receive**.</span><span class="sxs-lookup"><span data-stu-id="95a7d-148">To send or receive messages, enter the name of the namespace and the name of the entity you created, then click either **send** or **receive**.</span></span> 
 
<span data-ttu-id="95a7d-149">Note that the managed service identity only works inside the Azure environment, and only in the App Service deployment in which you configured it.</span><span class="sxs-lookup"><span data-stu-id="95a7d-149">Note that the managed service identity only works inside the Azure environment, and only in the App Service deployment in which you configured it.</span></span> <span data-ttu-id="95a7d-150">Also note that managed service identities do not work with App Service deployment slots at this time.</span><span class="sxs-lookup"><span data-stu-id="95a7d-150">Also note that managed service identities do not work with App Service deployment slots at this time.</span></span>

## <a name="next-steps"></a><span data-ttu-id="95a7d-151">Next steps</span><span class="sxs-lookup"><span data-stu-id="95a7d-151">Next steps</span></span>

<span data-ttu-id="95a7d-152">For more information about Event Hubs, visit the following links:</span><span class="sxs-lookup"><span data-stu-id="95a7d-152">For more information about Event Hubs, visit the following links:</span></span>

* <span data-ttu-id="95a7d-153">Get started with an [Event Hubs tutorial](event-hubs-dotnet-standard-getstarted-send.md)</span><span class="sxs-lookup"><span data-stu-id="95a7d-153">Get started with an [Event Hubs tutorial](event-hubs-dotnet-standard-getstarted-send.md)</span></span>
* [<span data-ttu-id="95a7d-154">Event Hubs FAQ</span><span class="sxs-lookup"><span data-stu-id="95a7d-154">Event Hubs FAQ</span></span>](event-hubs-faq.md)
* [<span data-ttu-id="95a7d-155">Event Hubs pricing details</span><span class="sxs-lookup"><span data-stu-id="95a7d-155">Event Hubs pricing details</span></span>](https://azure.microsoft.com/pricing/details/event-hubs/)
* [<span data-ttu-id="95a7d-156">Sample applications that use Event Hubs</span><span class="sxs-lookup"><span data-stu-id="95a7d-156">Sample applications that use Event Hubs</span></span>](https://github.com/Azure/azure-event-hubs/tree/master/samples)