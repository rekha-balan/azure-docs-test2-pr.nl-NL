---
title: Azure Traffic Manager - traffic routing methods | Microsoft Docs
description: This articles will help you understand the different traffic routing methods used by Traffic Manager
services: traffic-manager
documentationcenter: ''
author: kumudd
manager: timlt
editor: ''
ms.assetid: db1efbf6-6762-4c7a-ac99-675d4eeb54d0
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/22/2017
ms.author: kumud
ms.openlocfilehash: 610b6c51a05901982d3b7c2ca6d67368e9775a6f
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44540985"
---
# <a name="traffic-manager-routing-methods"></a><span data-ttu-id="61111-103">Traffic Manager routing methods</span><span class="sxs-lookup"><span data-stu-id="61111-103">Traffic Manager routing methods</span></span>

<span data-ttu-id="61111-104">Azure Traffic Manager supports three traffic-routing methods to determine how to route network traffic to the various service endpoints.</span><span class="sxs-lookup"><span data-stu-id="61111-104">Azure Traffic Manager supports three traffic-routing methods to determine how to route network traffic to the various service endpoints.</span></span> <span data-ttu-id="61111-105">Traffic Manager applies the traffic-routing method to each DNS query it receives.</span><span class="sxs-lookup"><span data-stu-id="61111-105">Traffic Manager applies the traffic-routing method to each DNS query it receives.</span></span> <span data-ttu-id="61111-106">The traffic-routing method determines which endpoint returned in the DNS response.</span><span class="sxs-lookup"><span data-stu-id="61111-106">The traffic-routing method determines which endpoint returned in the DNS response.</span></span>

<span data-ttu-id="61111-107">There are four traffic routing methods available in Traffic Manager:</span><span class="sxs-lookup"><span data-stu-id="61111-107">There are four traffic routing methods available in Traffic Manager:</span></span>

* <span data-ttu-id="61111-108">**Priority:** Select 'Priority' when you want to use a primary service endpoint for all traffic, and provide backups in case the primary or the backup endpoints are unavailable.</span><span class="sxs-lookup"><span data-stu-id="61111-108">**Priority:** Select 'Priority' when you want to use a primary service endpoint for all traffic, and provide backups in case the primary or the backup endpoints are unavailable.</span></span>
* <span data-ttu-id="61111-109">**Weighted:** Select 'Weighted' when you want to distribute traffic across a set of endpoints, either evenly or according to weights, which you define.</span><span class="sxs-lookup"><span data-stu-id="61111-109">**Weighted:** Select 'Weighted' when you want to distribute traffic across a set of endpoints, either evenly or according to weights, which you define.</span></span>
* <span data-ttu-id="61111-110">**Performance:** Select 'Performance' when you have endpoints in different geographic locations and you want end users to use the "closest" endpoint in terms of the lowest network latency.</span><span class="sxs-lookup"><span data-stu-id="61111-110">**Performance:** Select 'Performance' when you have endpoints in different geographic locations and you want end users to use the "closest" endpoint in terms of the lowest network latency.</span></span>
* <span data-ttu-id="61111-111">**Geographic:** Select 'Geographic' so that users are directed to specific endpoints (Azure, External or Nested) based on which geographic location their DNS query originates from.</span><span class="sxs-lookup"><span data-stu-id="61111-111">**Geographic:** Select 'Geographic' so that users are directed to specific endpoints (Azure, External or Nested) based on which geographic location their DNS query originates from.</span></span> <span data-ttu-id="61111-112">This empowers Traffic Manager customers to enable scenarios where knowing a user’s geographic region and routing them based on that is important.</span><span class="sxs-lookup"><span data-stu-id="61111-112">This empowers Traffic Manager customers to enable scenarios where knowing a user’s geographic region and routing them based on that is important.</span></span> <span data-ttu-id="61111-113">Examples include complying with data sovereignty mandates, localization of content & user experience and measuring traffic from different regions.</span><span class="sxs-lookup"><span data-stu-id="61111-113">Examples include complying with data sovereignty mandates, localization of content & user experience and measuring traffic from different regions.</span></span>

<span data-ttu-id="61111-114">All Traffic Manager profiles include monitoring of endpoint health and automatic endpoint failover.</span><span class="sxs-lookup"><span data-stu-id="61111-114">All Traffic Manager profiles include monitoring of endpoint health and automatic endpoint failover.</span></span> <span data-ttu-id="61111-115">For more information, see [Traffic Manager Endpoint Monitoring](traffic-manager-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="61111-115">For more information, see [Traffic Manager Endpoint Monitoring](traffic-manager-monitoring.md).</span></span> <span data-ttu-id="61111-116">A single Traffic Manager profile can use only one traffic routing method.</span><span class="sxs-lookup"><span data-stu-id="61111-116">A single Traffic Manager profile can use only one traffic routing method.</span></span> <span data-ttu-id="61111-117">You can select a different traffic routing method for your profile at any time.</span><span class="sxs-lookup"><span data-stu-id="61111-117">You can select a different traffic routing method for your profile at any time.</span></span> <span data-ttu-id="61111-118">Changes are applied within one minute, and no downtime is incurred.</span><span class="sxs-lookup"><span data-stu-id="61111-118">Changes are applied within one minute, and no downtime is incurred.</span></span> <span data-ttu-id="61111-119">Traffic-routing methods can be combined by using nested Traffic Manager profiles.</span><span class="sxs-lookup"><span data-stu-id="61111-119">Traffic-routing methods can be combined by using nested Traffic Manager profiles.</span></span> <span data-ttu-id="61111-120">Nesting enables sophisticated and flexible traffic-routing configurations that meet the needs of larger, complex applications.</span><span class="sxs-lookup"><span data-stu-id="61111-120">Nesting enables sophisticated and flexible traffic-routing configurations that meet the needs of larger, complex applications.</span></span> <span data-ttu-id="61111-121">For more information, see [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="61111-121">For more information, see [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>

## <a name="priority-traffic-routing-method"></a><span data-ttu-id="61111-122">Priority traffic-routing method</span><span class="sxs-lookup"><span data-stu-id="61111-122">Priority traffic-routing method</span></span>

<span data-ttu-id="61111-123">Often an organization wants to provide reliability for its services by deploying one or more backup services in case their primary service goes down.</span><span class="sxs-lookup"><span data-stu-id="61111-123">Often an organization wants to provide reliability for its services by deploying one or more backup services in case their primary service goes down.</span></span> <span data-ttu-id="61111-124">The 'Priority' traffic-routing method allows Azure customers to easily implement this failover pattern.</span><span class="sxs-lookup"><span data-stu-id="61111-124">The 'Priority' traffic-routing method allows Azure customers to easily implement this failover pattern.</span></span>

![Azure Traffic Manager 'Priority' traffic-routing method][1]

<span data-ttu-id="61111-126">The Traffic Manager profile contains a prioritized list of service endpoints.</span><span class="sxs-lookup"><span data-stu-id="61111-126">The Traffic Manager profile contains a prioritized list of service endpoints.</span></span> <span data-ttu-id="61111-127">By default, Traffic Manager sends all traffic to the primary (highest-priority) endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-127">By default, Traffic Manager sends all traffic to the primary (highest-priority) endpoint.</span></span> <span data-ttu-id="61111-128">If the primary endpoint is not available, Traffic Manager routes the traffic to the second endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-128">If the primary endpoint is not available, Traffic Manager routes the traffic to the second endpoint.</span></span> <span data-ttu-id="61111-129">If both the primary and secondary endpoints are not available, the traffic goes to the third, and so on.</span><span class="sxs-lookup"><span data-stu-id="61111-129">If both the primary and secondary endpoints are not available, the traffic goes to the third, and so on.</span></span> <span data-ttu-id="61111-130">Availability of the endpoint is based on the configured status (enabled or disabled) and the ongoing endpoint monitoring.</span><span class="sxs-lookup"><span data-stu-id="61111-130">Availability of the endpoint is based on the configured status (enabled or disabled) and the ongoing endpoint monitoring.</span></span>

### <a name="configuring-endpoints"></a><span data-ttu-id="61111-131">Configuring endpoints</span><span class="sxs-lookup"><span data-stu-id="61111-131">Configuring endpoints</span></span>

<span data-ttu-id="61111-132">With Azure Resource Manager, you configure the endpoint priority explicitly using the 'priority' property for each endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-132">With Azure Resource Manager, you configure the endpoint priority explicitly using the 'priority' property for each endpoint.</span></span> <span data-ttu-id="61111-133">This property is a value between 1 and 1000.</span><span class="sxs-lookup"><span data-stu-id="61111-133">This property is a value between 1 and 1000.</span></span> <span data-ttu-id="61111-134">Lower values represent a higher priority.</span><span class="sxs-lookup"><span data-stu-id="61111-134">Lower values represent a higher priority.</span></span> <span data-ttu-id="61111-135">Endpoints cannot share priority values.</span><span class="sxs-lookup"><span data-stu-id="61111-135">Endpoints cannot share priority values.</span></span> <span data-ttu-id="61111-136">Setting the property is optional.</span><span class="sxs-lookup"><span data-stu-id="61111-136">Setting the property is optional.</span></span> <span data-ttu-id="61111-137">When omitted, a default priority based on the endpoint order is used.</span><span class="sxs-lookup"><span data-stu-id="61111-137">When omitted, a default priority based on the endpoint order is used.</span></span>

## <a name="weighted-traffic-routing-method"></a><span data-ttu-id="61111-138">Weighted traffic-routing method</span><span class="sxs-lookup"><span data-stu-id="61111-138">Weighted traffic-routing method</span></span>
<span data-ttu-id="61111-139">The 'Weighted' traffic-routing method allows you to distribute traffic evenly or to use a pre-defined weighting.</span><span class="sxs-lookup"><span data-stu-id="61111-139">The 'Weighted' traffic-routing method allows you to distribute traffic evenly or to use a pre-defined weighting.</span></span>

![Azure Traffic Manager 'Weighted' traffic-routing method][2]

<span data-ttu-id="61111-141">In the Weighted traffic-routing method, you assign a weight to each endpoint in the Traffic Manager profile configuration.</span><span class="sxs-lookup"><span data-stu-id="61111-141">In the Weighted traffic-routing method, you assign a weight to each endpoint in the Traffic Manager profile configuration.</span></span> <span data-ttu-id="61111-142">The weight is an integer from 1 to 1000.</span><span class="sxs-lookup"><span data-stu-id="61111-142">The weight is an integer from 1 to 1000.</span></span> <span data-ttu-id="61111-143">This parameter is optional.</span><span class="sxs-lookup"><span data-stu-id="61111-143">This parameter is optional.</span></span> <span data-ttu-id="61111-144">If omitted, Traffic Managers uses a default weight of '1'.</span><span class="sxs-lookup"><span data-stu-id="61111-144">If omitted, Traffic Managers uses a default weight of '1'.</span></span>

<span data-ttu-id="61111-145">For each DNS query received, Traffic Manager randomly chooses an available endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-145">For each DNS query received, Traffic Manager randomly chooses an available endpoint.</span></span> <span data-ttu-id="61111-146">The probability of choosing an endpoint is based on the weights assigned to all available endpoints.</span><span class="sxs-lookup"><span data-stu-id="61111-146">The probability of choosing an endpoint is based on the weights assigned to all available endpoints.</span></span> <span data-ttu-id="61111-147">Using the same weight across all endpoints results in an even traffic distribution.</span><span class="sxs-lookup"><span data-stu-id="61111-147">Using the same weight across all endpoints results in an even traffic distribution.</span></span> <span data-ttu-id="61111-148">Using higher or lower weights on specific endpoints causes those endpoints to be returned more or less frequently in the DNS responses.</span><span class="sxs-lookup"><span data-stu-id="61111-148">Using higher or lower weights on specific endpoints causes those endpoints to be returned more or less frequently in the DNS responses.</span></span>

<span data-ttu-id="61111-149">The weighted method enables some useful scenarios:</span><span class="sxs-lookup"><span data-stu-id="61111-149">The weighted method enables some useful scenarios:</span></span>

* <span data-ttu-id="61111-150">Gradual application upgrade: Allocate a percentage of traffic to route to a new endpoint, and gradually increase the traffic over time to 100%.</span><span class="sxs-lookup"><span data-stu-id="61111-150">Gradual application upgrade: Allocate a percentage of traffic to route to a new endpoint, and gradually increase the traffic over time to 100%.</span></span>
* <span data-ttu-id="61111-151">Application migration to Azure: Create a profile with both Azure and external endpoints.</span><span class="sxs-lookup"><span data-stu-id="61111-151">Application migration to Azure: Create a profile with both Azure and external endpoints.</span></span> <span data-ttu-id="61111-152">Adjust the weight of the endpoints to prefer the new endpoints.</span><span class="sxs-lookup"><span data-stu-id="61111-152">Adjust the weight of the endpoints to prefer the new endpoints.</span></span>
* <span data-ttu-id="61111-153">Cloud-bursting for additional capacity: Quickly expand an on-premises deployment into the cloud by putting it behind a Traffic Manager profile.</span><span class="sxs-lookup"><span data-stu-id="61111-153">Cloud-bursting for additional capacity: Quickly expand an on-premises deployment into the cloud by putting it behind a Traffic Manager profile.</span></span> <span data-ttu-id="61111-154">When you need extra capacity in the cloud, you can add or enable more endpoints and specify what portion of traffic goes to each endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-154">When you need extra capacity in the cloud, you can add or enable more endpoints and specify what portion of traffic goes to each endpoint.</span></span>

<span data-ttu-id="61111-155">The Resource Manager Azure portal supports the configuration of weighted traffic routing.</span><span class="sxs-lookup"><span data-stu-id="61111-155">The Resource Manager Azure portal supports the configuration of weighted traffic routing.</span></span>  <span data-ttu-id="61111-156">You can configure weights using the Resource Manager versions of Azure PowerShell, CLI, and the REST APIs.</span><span class="sxs-lookup"><span data-stu-id="61111-156">You can configure weights using the Resource Manager versions of Azure PowerShell, CLI, and the REST APIs.</span></span>

<span data-ttu-id="61111-157">It is important to understand that DNS responses are cached by clients and by the recursive DNS servers that the clients use to resolve DNS names.</span><span class="sxs-lookup"><span data-stu-id="61111-157">It is important to understand that DNS responses are cached by clients and by the recursive DNS servers that the clients use to resolve DNS names.</span></span> <span data-ttu-id="61111-158">This caching can have an impact on weighted traffic distributions.</span><span class="sxs-lookup"><span data-stu-id="61111-158">This caching can have an impact on weighted traffic distributions.</span></span> <span data-ttu-id="61111-159">When the number of clients and recursive DNS servers is large, traffic distribution works as expected.</span><span class="sxs-lookup"><span data-stu-id="61111-159">When the number of clients and recursive DNS servers is large, traffic distribution works as expected.</span></span> <span data-ttu-id="61111-160">However, when the number of clients or recursive DNS servers is small, caching can significantly skew the traffic distribution.</span><span class="sxs-lookup"><span data-stu-id="61111-160">However, when the number of clients or recursive DNS servers is small, caching can significantly skew the traffic distribution.</span></span>

<span data-ttu-id="61111-161">Common use cases include:</span><span class="sxs-lookup"><span data-stu-id="61111-161">Common use cases include:</span></span>

* <span data-ttu-id="61111-162">Development and testing environments</span><span class="sxs-lookup"><span data-stu-id="61111-162">Development and testing environments</span></span>
* <span data-ttu-id="61111-163">Application-to-application communications</span><span class="sxs-lookup"><span data-stu-id="61111-163">Application-to-application communications</span></span>
* <span data-ttu-id="61111-164">Applications aimed at a narrow user-base that share a common recursive DNS infrastructure (for example, employees of company connecting through a proxy)</span><span class="sxs-lookup"><span data-stu-id="61111-164">Applications aimed at a narrow user-base that share a common recursive DNS infrastructure (for example, employees of company connecting through a proxy)</span></span>

<span data-ttu-id="61111-165">These DNS caching effects are common to all DNS-based traffic routing systems, not just Azure Traffic Manager.</span><span class="sxs-lookup"><span data-stu-id="61111-165">These DNS caching effects are common to all DNS-based traffic routing systems, not just Azure Traffic Manager.</span></span> <span data-ttu-id="61111-166">In some cases, explicitly clearing the DNS cache may provide a workaround.</span><span class="sxs-lookup"><span data-stu-id="61111-166">In some cases, explicitly clearing the DNS cache may provide a workaround.</span></span> <span data-ttu-id="61111-167">In other cases, an alternative traffic-routing method may be more appropriate.</span><span class="sxs-lookup"><span data-stu-id="61111-167">In other cases, an alternative traffic-routing method may be more appropriate.</span></span>

## <a name="performance-traffic-routing-method"></a><span data-ttu-id="61111-168">Performance traffic-routing method</span><span class="sxs-lookup"><span data-stu-id="61111-168">Performance traffic-routing method</span></span>

<span data-ttu-id="61111-169">Deploying endpoints in two or more locations across the globe can improve the responsiveness of many applications by routing traffic to the location that is 'closest' to you.</span><span class="sxs-lookup"><span data-stu-id="61111-169">Deploying endpoints in two or more locations across the globe can improve the responsiveness of many applications by routing traffic to the location that is 'closest' to you.</span></span> <span data-ttu-id="61111-170">The 'Performance' traffic-routing method provides this capability.</span><span class="sxs-lookup"><span data-stu-id="61111-170">The 'Performance' traffic-routing method provides this capability.</span></span>

![Azure Traffic Manager 'Performance' traffic-routing method][3]

<span data-ttu-id="61111-172">The 'closest' endpoint is not necessarily closest as measured by geographic distance.</span><span class="sxs-lookup"><span data-stu-id="61111-172">The 'closest' endpoint is not necessarily closest as measured by geographic distance.</span></span> <span data-ttu-id="61111-173">Instead, the 'Performance' traffic-routing method determines the closest endpoint by measuring network latency.</span><span class="sxs-lookup"><span data-stu-id="61111-173">Instead, the 'Performance' traffic-routing method determines the closest endpoint by measuring network latency.</span></span> <span data-ttu-id="61111-174">Traffic Manager maintains an Internet Latency Table to track the round-trip time between IP address ranges and each Azure datacenter.</span><span class="sxs-lookup"><span data-stu-id="61111-174">Traffic Manager maintains an Internet Latency Table to track the round-trip time between IP address ranges and each Azure datacenter.</span></span>

<span data-ttu-id="61111-175">Traffic Manager looks up the source IP address of the incoming DNS request in the Internet Latency Table.</span><span class="sxs-lookup"><span data-stu-id="61111-175">Traffic Manager looks up the source IP address of the incoming DNS request in the Internet Latency Table.</span></span> <span data-ttu-id="61111-176">Traffic Manager chooses an available endpoint in the Azure datacenter that has the lowest latency for that IP address range, then returns that endpoint in the DNS response.</span><span class="sxs-lookup"><span data-stu-id="61111-176">Traffic Manager chooses an available endpoint in the Azure datacenter that has the lowest latency for that IP address range, then returns that endpoint in the DNS response.</span></span>

<span data-ttu-id="61111-177">As explained in [How Traffic Manager Works](traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager does not receive DNS queries directly from clients.</span><span class="sxs-lookup"><span data-stu-id="61111-177">As explained in [How Traffic Manager Works](traffic-manager-overview.md#how-traffic-manager-works), Traffic Manager does not receive DNS queries directly from clients.</span></span> <span data-ttu-id="61111-178">Rather, DNS queries come from the recursive DNS service that the clients are configured to use.</span><span class="sxs-lookup"><span data-stu-id="61111-178">Rather, DNS queries come from the recursive DNS service that the clients are configured to use.</span></span> <span data-ttu-id="61111-179">Therefore, the IP address used to determine the 'closest' endpoint is not the client's IP address, but it is the IP address of the recursive DNS service.</span><span class="sxs-lookup"><span data-stu-id="61111-179">Therefore, the IP address used to determine the 'closest' endpoint is not the client's IP address, but it is the IP address of the recursive DNS service.</span></span> <span data-ttu-id="61111-180">In practice, this IP address is a good proxy for the client.</span><span class="sxs-lookup"><span data-stu-id="61111-180">In practice, this IP address is a good proxy for the client.</span></span>


<span data-ttu-id="61111-181">Traffic Manager regularly updates the Internet Latency Table to account for changes in the global Internet and new Azure regions.</span><span class="sxs-lookup"><span data-stu-id="61111-181">Traffic Manager regularly updates the Internet Latency Table to account for changes in the global Internet and new Azure regions.</span></span> <span data-ttu-id="61111-182">However, application performance varies based on real-time variations in load across the Internet.</span><span class="sxs-lookup"><span data-stu-id="61111-182">However, application performance varies based on real-time variations in load across the Internet.</span></span> <span data-ttu-id="61111-183">Performance traffic-routing does not monitor load on a given service endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-183">Performance traffic-routing does not monitor load on a given service endpoint.</span></span> <span data-ttu-id="61111-184">However, if an endpoint becomes unavailable, Traffic Manager does not include it in DNS query responses.</span><span class="sxs-lookup"><span data-stu-id="61111-184">However, if an endpoint becomes unavailable, Traffic Manager does not include it in DNS query responses.</span></span>


<span data-ttu-id="61111-185">Points to note:</span><span class="sxs-lookup"><span data-stu-id="61111-185">Points to note:</span></span>

* <span data-ttu-id="61111-186">If your profile contains multiple endpoints in the same Azure region, then Traffic Manager distributes traffic evenly across the available endpoints in that region.</span><span class="sxs-lookup"><span data-stu-id="61111-186">If your profile contains multiple endpoints in the same Azure region, then Traffic Manager distributes traffic evenly across the available endpoints in that region.</span></span> <span data-ttu-id="61111-187">If you prefer a different traffic distribution within a region, you can use [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="61111-187">If you prefer a different traffic distribution within a region, you can use [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>
* <span data-ttu-id="61111-188">If all enabled endpoints in a given Azure region are degraded, Traffic Manager distributes traffic across all other available endpoints instead of the next-closest endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-188">If all enabled endpoints in a given Azure region are degraded, Traffic Manager distributes traffic across all other available endpoints instead of the next-closest endpoint.</span></span> <span data-ttu-id="61111-189">This logic prevents a cascading failure from occurring by not overloading the next-closest endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-189">This logic prevents a cascading failure from occurring by not overloading the next-closest endpoint.</span></span> <span data-ttu-id="61111-190">If you want to define a preferred failover sequence, use [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span><span class="sxs-lookup"><span data-stu-id="61111-190">If you want to define a preferred failover sequence, use [nested Traffic Manager profiles](traffic-manager-nested-profiles.md).</span></span>
* <span data-ttu-id="61111-191">When using the Performance traffic routing method with external endpoints or nested endpoints, you need to specify the location of those endpoints.</span><span class="sxs-lookup"><span data-stu-id="61111-191">When using the Performance traffic routing method with external endpoints or nested endpoints, you need to specify the location of those endpoints.</span></span> <span data-ttu-id="61111-192">Choose the Azure region closest to your deployment.</span><span class="sxs-lookup"><span data-stu-id="61111-192">Choose the Azure region closest to your deployment.</span></span> <span data-ttu-id="61111-193">Those locations are the values supported by the Internet Latency Table.</span><span class="sxs-lookup"><span data-stu-id="61111-193">Those locations are the values supported by the Internet Latency Table.</span></span>
* <span data-ttu-id="61111-194">The algorithm that chooses the endpoint is deterministic.</span><span class="sxs-lookup"><span data-stu-id="61111-194">The algorithm that chooses the endpoint is deterministic.</span></span> <span data-ttu-id="61111-195">Repeated DNS queries from the same client are directed to the same endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-195">Repeated DNS queries from the same client are directed to the same endpoint.</span></span> <span data-ttu-id="61111-196">Typically, clients use different recursive DNS servers when traveling.</span><span class="sxs-lookup"><span data-stu-id="61111-196">Typically, clients use different recursive DNS servers when traveling.</span></span> <span data-ttu-id="61111-197">The client may be routed to a different endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-197">The client may be routed to a different endpoint.</span></span> <span data-ttu-id="61111-198">Routing can also be affected by updates to the Internet Latency Table.</span><span class="sxs-lookup"><span data-stu-id="61111-198">Routing can also be affected by updates to the Internet Latency Table.</span></span> <span data-ttu-id="61111-199">Therefore, the Performance traffic-routing method does not guarantee that a client is always routed to the same endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-199">Therefore, the Performance traffic-routing method does not guarantee that a client is always routed to the same endpoint.</span></span>
* <span data-ttu-id="61111-200">When the Internet Latency Table changes, you may notice that some clients are directed to a different endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-200">When the Internet Latency Table changes, you may notice that some clients are directed to a different endpoint.</span></span> <span data-ttu-id="61111-201">This routing change is more accurate based on current latency data.</span><span class="sxs-lookup"><span data-stu-id="61111-201">This routing change is more accurate based on current latency data.</span></span> <span data-ttu-id="61111-202">These updates are essential to maintain the accuracy of Performance traffic-routing as the Internet continually evolves.</span><span class="sxs-lookup"><span data-stu-id="61111-202">These updates are essential to maintain the accuracy of Performance traffic-routing as the Internet continually evolves.</span></span>

## <a name="geographic-traffic-routing-method"></a><span data-ttu-id="61111-203">Geographic traffic routing method</span><span class="sxs-lookup"><span data-stu-id="61111-203">Geographic traffic routing method</span></span>

<span data-ttu-id="61111-204">Traffic Manager profiles can be configured to use the Geographic routing method so that users are directed to specific endpoints (Azure, External or Nested) based on which geographic location their DNS query originates from.</span><span class="sxs-lookup"><span data-stu-id="61111-204">Traffic Manager profiles can be configured to use the Geographic routing method so that users are directed to specific endpoints (Azure, External or Nested) based on which geographic location their DNS query originates from.</span></span> <span data-ttu-id="61111-205">This empowers Traffic Manager customers to enable scenarios where knowing a user’s geographic region and routing them based on that is important.</span><span class="sxs-lookup"><span data-stu-id="61111-205">This empowers Traffic Manager customers to enable scenarios where knowing a user’s geographic region and routing them based on that is important.</span></span> <span data-ttu-id="61111-206">Examples include complying with data sovereignty mandates, localization of content & user experience and measuring traffic from different regions.</span><span class="sxs-lookup"><span data-stu-id="61111-206">Examples include complying with data sovereignty mandates, localization of content & user experience and measuring traffic from different regions.</span></span>
<span data-ttu-id="61111-207">When a profile is configured for geographic routing, each endpoint associated with that profile needs to have a set of geographic regions assigned to it.</span><span class="sxs-lookup"><span data-stu-id="61111-207">When a profile is configured for geographic routing, each endpoint associated with that profile needs to have a set of geographic regions assigned to it.</span></span> <span data-ttu-id="61111-208">A geographic region can be at following levels of granularity</span><span class="sxs-lookup"><span data-stu-id="61111-208">A geographic region can be at following levels of granularity</span></span> 
- <span data-ttu-id="61111-209">World– any region</span><span class="sxs-lookup"><span data-stu-id="61111-209">World– any region</span></span>
- <span data-ttu-id="61111-210">Regional Grouping – e.g. Africa, Middle East, Australia/Pacific etc.</span><span class="sxs-lookup"><span data-stu-id="61111-210">Regional Grouping – e.g. Africa, Middle East, Australia/Pacific etc.</span></span> 
- <span data-ttu-id="61111-211">Country/Region – e.g. Ireland, Peru, Hong Kong SAR etc.</span><span class="sxs-lookup"><span data-stu-id="61111-211">Country/Region – e.g. Ireland, Peru, Hong Kong SAR etc.</span></span> 
- <span data-ttu-id="61111-212">State/Province – e.g. USA-California, Australia-Queensland, Canada-Alberta etc. (note: this granularity level is supported only for states / provinces in Australia, Canada, UK and USA).</span><span class="sxs-lookup"><span data-stu-id="61111-212">State/Province – e.g. USA-California, Australia-Queensland, Canada-Alberta etc. (note: this granularity level is supported only for states / provinces in Australia, Canada, UK and USA).</span></span>

<span data-ttu-id="61111-213">When a region or a set of regions is assigned to an endpoint, any requests from those regions will get routed only to that endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-213">When a region or a set of regions is assigned to an endpoint, any requests from those regions will get routed only to that endpoint.</span></span> <span data-ttu-id="61111-214">Traffic Manager uses the source IP address of the DNS query to determine the region from which a user is querying from – in most cases this will be the IP address of the local DNS resolver doing the query on behalf of the user.</span><span class="sxs-lookup"><span data-stu-id="61111-214">Traffic Manager uses the source IP address of the DNS query to determine the region from which a user is querying from – in most cases this will be the IP address of the local DNS resolver doing the query on behalf of the user.</span></span>  

![Azure Traffic Manager 'Geographic' traffic-routing method](https://docstestmedia1.blob.core.windows.net/azure-media/articles/traffic-manager/media/traffic-manager-routing-methods/geographic.png)

<span data-ttu-id="61111-216">Traffic Manager reads the source IP address of the DNS query and decides which geographic region it is originating from.</span><span class="sxs-lookup"><span data-stu-id="61111-216">Traffic Manager reads the source IP address of the DNS query and decides which geographic region it is originating from.</span></span> <span data-ttu-id="61111-217">It will then look to see if there is an endpoint that has this geographic region mapped to it.</span><span class="sxs-lookup"><span data-stu-id="61111-217">It will then look to see if there is an endpoint that has this geographic region mapped to it.</span></span> <span data-ttu-id="61111-218">This lookup starts at the lowest granularity level (State/Province where it is supported, else at the Country/Region level) and goes all the way up to the highest level which is World.</span><span class="sxs-lookup"><span data-stu-id="61111-218">This lookup starts at the lowest granularity level (State/Province where it is supported, else at the Country/Region level) and goes all the way up to the highest level which is World.</span></span> <span data-ttu-id="61111-219">The first match found using this traversal will be designated as the endpoint to return in the query response.</span><span class="sxs-lookup"><span data-stu-id="61111-219">The first match found using this traversal will be designated as the endpoint to return in the query response.</span></span> <span data-ttu-id="61111-220">In the case of matching with a Nested type endpoint, an endpoint within that child profile will be returned, based on its routing method.</span><span class="sxs-lookup"><span data-stu-id="61111-220">In the case of matching with a Nested type endpoint, an endpoint within that child profile will be returned, based on its routing method.</span></span> <span data-ttu-id="61111-221">The following points are applicable to this behavior:</span><span class="sxs-lookup"><span data-stu-id="61111-221">The following points are applicable to this behavior:</span></span>

1. <span data-ttu-id="61111-222">A geographic region can be mapped only to one endpoint in a Traffic Manager profile when the routing type is Geographic Routing.</span><span class="sxs-lookup"><span data-stu-id="61111-222">A geographic region can be mapped only to one endpoint in a Traffic Manager profile when the routing type is Geographic Routing.</span></span> <span data-ttu-id="61111-223">This ensures that routing of users is deterministic, and customers can enable scenarios which require unambiguous geographic boundaries.</span><span class="sxs-lookup"><span data-stu-id="61111-223">This ensures that routing of users is deterministic, and customers can enable scenarios which require unambiguous geographic boundaries.</span></span>
2. <span data-ttu-id="61111-224">If a user’s region comes under two different endpoints’ geographic mapping Traffic Manager will select the endpoint with the lowest granularity and will not consider routing requests from that region to the other endpoint.</span><span class="sxs-lookup"><span data-stu-id="61111-224">If a user’s region comes under two different endpoints’ geographic mapping Traffic Manager will select the endpoint with the lowest granularity and will not consider routing requests from that region to the other endpoint.</span></span> <span data-ttu-id="61111-225">Example: consider a Geographic Routing type profile with two endpoints - Endpoint 1 and Endpoint 2.</span><span class="sxs-lookup"><span data-stu-id="61111-225">Example: consider a Geographic Routing type profile with two endpoints - Endpoint 1 and Endpoint 2.</span></span> <span data-ttu-id="61111-226">Endpoint1 is configured to receive traffic from Ireland and Endpoint2 is configured to receive traffic from Europe.</span><span class="sxs-lookup"><span data-stu-id="61111-226">Endpoint1 is configured to receive traffic from Ireland and Endpoint2 is configured to receive traffic from Europe.</span></span> <span data-ttu-id="61111-227">If a request originates from Ireland, it will always be routed to Endpoint1.</span><span class="sxs-lookup"><span data-stu-id="61111-227">If a request originates from Ireland, it will always be routed to Endpoint1.</span></span>
3. <span data-ttu-id="61111-228">Since a region can be mapped only to one endpoint, Traffic Manager will return it regardless of whether the endpoint is healthy or not.</span><span class="sxs-lookup"><span data-stu-id="61111-228">Since a region can be mapped only to one endpoint, Traffic Manager will return it regardless of whether the endpoint is healthy or not.</span></span> <span data-ttu-id="61111-229">Therefore, it is strongly suggested that customers should using the geographic routing method associate it with Nested type endpoints that has child profiles containing at least two endpoints within each.</span><span class="sxs-lookup"><span data-stu-id="61111-229">Therefore, it is strongly suggested that customers should using the geographic routing method associate it with Nested type endpoints that has child profiles containing at least two endpoints within each.</span></span>
4. <span data-ttu-id="61111-230">If an endpoint match is found and that endpoint is in the **Stopped** state, Traffic Manager will return a NODATA response.</span><span class="sxs-lookup"><span data-stu-id="61111-230">If an endpoint match is found and that endpoint is in the **Stopped** state, Traffic Manager will return a NODATA response.</span></span> <span data-ttu-id="61111-231">In this case, no further lookups will be made higher up in the geographic region hierarchy.</span><span class="sxs-lookup"><span data-stu-id="61111-231">In this case, no further lookups will be made higher up in the geographic region hierarchy.</span></span> <span data-ttu-id="61111-232">This behavior is also applicable for nested endpoint types when the child profile is in the **Stopped** or **Disabled** state.</span><span class="sxs-lookup"><span data-stu-id="61111-232">This behavior is also applicable for nested endpoint types when the child profile is in the **Stopped** or **Disabled** state.</span></span>
5. <span data-ttu-id="61111-233">If an endpoint is in the **Disabled** status, it won’t be included in the region matching process.</span><span class="sxs-lookup"><span data-stu-id="61111-233">If an endpoint is in the **Disabled** status, it won’t be included in the region matching process.</span></span> <span data-ttu-id="61111-234">This behavior is also applicable for nested endpoint types when the endpoint is in the **Disabled** state.</span><span class="sxs-lookup"><span data-stu-id="61111-234">This behavior is also applicable for nested endpoint types when the endpoint is in the **Disabled** state.</span></span>
6. <span data-ttu-id="61111-235">If a query is coming from a geographic region which has no mapping in that profile, Traffic Manager will return a NODATA response.</span><span class="sxs-lookup"><span data-stu-id="61111-235">If a query is coming from a geographic region which has no mapping in that profile, Traffic Manager will return a NODATA response.</span></span> <span data-ttu-id="61111-236">Therefore, it is strongly recommended that customers should use geographic routing with one endpoint, ideally of type Nested with at least two endpoints within the child profile, with the region **World** assigned to it.</span><span class="sxs-lookup"><span data-stu-id="61111-236">Therefore, it is strongly recommended that customers should use geographic routing with one endpoint, ideally of type Nested with at least two endpoints within the child profile, with the region **World** assigned to it.</span></span> <span data-ttu-id="61111-237">This will also ensure that any IP addresses which do not map to a region will be handled.</span><span class="sxs-lookup"><span data-stu-id="61111-237">This will also ensure that any IP addresses which do not map to a region will be handled.</span></span>

<span data-ttu-id="61111-238">As explained in [How Traffic Manager Works](traffic-manager-how-traffic-manager-works.md), Traffic Manager does not receive DNS queries directly from clients.</span><span class="sxs-lookup"><span data-stu-id="61111-238">As explained in [How Traffic Manager Works](traffic-manager-how-traffic-manager-works.md), Traffic Manager does not receive DNS queries directly from clients.</span></span> <span data-ttu-id="61111-239">Rather, DNS queries come from the recursive DNS service that the clients are configured to use.</span><span class="sxs-lookup"><span data-stu-id="61111-239">Rather, DNS queries come from the recursive DNS service that the clients are configured to use.</span></span> <span data-ttu-id="61111-240">Therefore, the IP address used to determine the region is not the client's IP address, but it is the IP address of the recursive DNS service.</span><span class="sxs-lookup"><span data-stu-id="61111-240">Therefore, the IP address used to determine the region is not the client's IP address, but it is the IP address of the recursive DNS service.</span></span> <span data-ttu-id="61111-241">In practice, this IP address is a good proxy for the client.</span><span class="sxs-lookup"><span data-stu-id="61111-241">In practice, this IP address is a good proxy for the client.</span></span>


## <a name="next-steps"></a><span data-ttu-id="61111-242">Next steps</span><span class="sxs-lookup"><span data-stu-id="61111-242">Next steps</span></span>

<span data-ttu-id="61111-243">Learn how to develop high-availability applications using [Traffic Manager endpoint monitoring](traffic-manager-monitoring.md)</span><span class="sxs-lookup"><span data-stu-id="61111-243">Learn how to develop high-availability applications using [Traffic Manager endpoint monitoring](traffic-manager-monitoring.md)</span></span>

<span data-ttu-id="61111-244">Learn how to [create a Traffic Manager profile](traffic-manager-create-profile.md)</span><span class="sxs-lookup"><span data-stu-id="61111-244">Learn how to [create a Traffic Manager profile](traffic-manager-create-profile.md)</span></span>

<!--Image references-->
[1]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/traffic-manager/media/traffic-manager-routing-methods/priority.png
[2]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/traffic-manager/media/traffic-manager-routing-methods/weighted.png
[3]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/traffic-manager/media/traffic-manager-routing-methods/performance.png







