---
title: Nested Traffic Manager Profiles | Microsoft Docs
description: This article explains the 'Nested Profiles' feature of Azure Traffic Manager
services: traffic-manager
documentationcenter: ''
author: kumudd
manager: timlt
editor: ''
ms.assetid: f1b112c4-a3b1-496e-90eb-41e235a49609
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/22/2017
ms.author: kumud
ms.openlocfilehash: 1ac4ec2775ca9f690f5adf4f939908f8cee3f715
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44825149"
---
# <a name="nested-traffic-manager-profiles"></a><span data-ttu-id="ed831-103">Nested Traffic Manager profiles</span><span class="sxs-lookup"><span data-stu-id="ed831-103">Nested Traffic Manager profiles</span></span>

<span data-ttu-id="ed831-104">Traffic Manager includes a range of traffic-routing methods that allow you to control how Traffic Manager chooses which endpoint should receive traffic from each end user.</span><span class="sxs-lookup"><span data-stu-id="ed831-104">Traffic Manager includes a range of traffic-routing methods that allow you to control how Traffic Manager chooses which endpoint should receive traffic from each end user.</span></span> <span data-ttu-id="ed831-105">For more information, see [Traffic Manager traffic-routing methods](traffic-manager-routing-methods.md).</span><span class="sxs-lookup"><span data-stu-id="ed831-105">For more information, see [Traffic Manager traffic-routing methods](traffic-manager-routing-methods.md).</span></span>

<span data-ttu-id="ed831-106">Each Traffic Manager profile specifies a single traffic-routing method.</span><span class="sxs-lookup"><span data-stu-id="ed831-106">Each Traffic Manager profile specifies a single traffic-routing method.</span></span> <span data-ttu-id="ed831-107">However, there are scenarios that require more sophisticated traffic routing than the routing provided by a single Traffic Manager profile.</span><span class="sxs-lookup"><span data-stu-id="ed831-107">However, there are scenarios that require more sophisticated traffic routing than the routing provided by a single Traffic Manager profile.</span></span> <span data-ttu-id="ed831-108">You can nest Traffic Manager profiles to combine the benefits of more than one traffic-routing method.</span><span class="sxs-lookup"><span data-stu-id="ed831-108">You can nest Traffic Manager profiles to combine the benefits of more than one traffic-routing method.</span></span> <span data-ttu-id="ed831-109">Nested profiles allow you to override the default Traffic Manager behavior to support larger and more complex application deployments.</span><span class="sxs-lookup"><span data-stu-id="ed831-109">Nested profiles allow you to override the default Traffic Manager behavior to support larger and more complex application deployments.</span></span>

<span data-ttu-id="ed831-110">The following examples illustrate how to use nested Traffic Manager profiles in various scenarios.</span><span class="sxs-lookup"><span data-stu-id="ed831-110">The following examples illustrate how to use nested Traffic Manager profiles in various scenarios.</span></span>

## <a name="example-1-combining-performance-and-weighted-traffic-routing"></a><span data-ttu-id="ed831-111">Example 1: Combining 'Performance' and 'Weighted' traffic routing</span><span class="sxs-lookup"><span data-stu-id="ed831-111">Example 1: Combining 'Performance' and 'Weighted' traffic routing</span></span>

<span data-ttu-id="ed831-112">Suppose that you deployed an application in the following Azure regions: West US, West Europe, and East Asia.</span><span class="sxs-lookup"><span data-stu-id="ed831-112">Suppose that you deployed an application in the following Azure regions: West US, West Europe, and East Asia.</span></span> <span data-ttu-id="ed831-113">You use Traffic Manager's 'Performance' traffic-routing method to distribute traffic to the region closest to the user.</span><span class="sxs-lookup"><span data-stu-id="ed831-113">You use Traffic Manager's 'Performance' traffic-routing method to distribute traffic to the region closest to the user.</span></span>

![Single Traffic Manager profile][4]

<span data-ttu-id="ed831-115">Now, suppose you wish to test an update to your service before rolling it out more widely.</span><span class="sxs-lookup"><span data-stu-id="ed831-115">Now, suppose you wish to test an update to your service before rolling it out more widely.</span></span> <span data-ttu-id="ed831-116">You want to use the 'weighted' traffic-routing method to direct a small percentage of traffic to your test deployment.</span><span class="sxs-lookup"><span data-stu-id="ed831-116">You want to use the 'weighted' traffic-routing method to direct a small percentage of traffic to your test deployment.</span></span> <span data-ttu-id="ed831-117">You set up the test deployment alongside the existing production deployment in West Europe.</span><span class="sxs-lookup"><span data-stu-id="ed831-117">You set up the test deployment alongside the existing production deployment in West Europe.</span></span>

<span data-ttu-id="ed831-118">You cannot combine both 'Weighted' and 'Performance traffic-routing in a single profile.</span><span class="sxs-lookup"><span data-stu-id="ed831-118">You cannot combine both 'Weighted' and 'Performance traffic-routing in a single profile.</span></span> <span data-ttu-id="ed831-119">To support this scenario, you create a Traffic Manager profile using the two West Europe endpoints and the 'Weighted' traffic-routing method.</span><span class="sxs-lookup"><span data-stu-id="ed831-119">To support this scenario, you create a Traffic Manager profile using the two West Europe endpoints and the 'Weighted' traffic-routing method.</span></span> <span data-ttu-id="ed831-120">Next, you add this 'child' profile as an endpoint to the 'parent' profile.</span><span class="sxs-lookup"><span data-stu-id="ed831-120">Next, you add this 'child' profile as an endpoint to the 'parent' profile.</span></span> <span data-ttu-id="ed831-121">The parent profile still uses the Performance traffic-routing method and contains the other global deployments as endpoints.</span><span class="sxs-lookup"><span data-stu-id="ed831-121">The parent profile still uses the Performance traffic-routing method and contains the other global deployments as endpoints.</span></span>

<span data-ttu-id="ed831-122">The following diagram illustrates this example:</span><span class="sxs-lookup"><span data-stu-id="ed831-122">The following diagram illustrates this example:</span></span>

![Nested Traffic Manager profiles][2]

<span data-ttu-id="ed831-124">In this configuration, traffic directed via the parent profile distributes traffic across regions normally.</span><span class="sxs-lookup"><span data-stu-id="ed831-124">In this configuration, traffic directed via the parent profile distributes traffic across regions normally.</span></span> <span data-ttu-id="ed831-125">Within West Europe, the nested profile distributes traffic to the production and test endpoints according to the weights assigned.</span><span class="sxs-lookup"><span data-stu-id="ed831-125">Within West Europe, the nested profile distributes traffic to the production and test endpoints according to the weights assigned.</span></span>

<span data-ttu-id="ed831-126">When the parent profile uses the 'Performance' traffic-routing method, each endpoint must be assigned a location.</span><span class="sxs-lookup"><span data-stu-id="ed831-126">When the parent profile uses the 'Performance' traffic-routing method, each endpoint must be assigned a location.</span></span> <span data-ttu-id="ed831-127">The location is assigned when you configure the endpoint.</span><span class="sxs-lookup"><span data-stu-id="ed831-127">The location is assigned when you configure the endpoint.</span></span> <span data-ttu-id="ed831-128">Choose the Azure region closest to your deployment.</span><span class="sxs-lookup"><span data-stu-id="ed831-128">Choose the Azure region closest to your deployment.</span></span> <span data-ttu-id="ed831-129">The Azure regions are the location values supported by the Internet Latency Table.</span><span class="sxs-lookup"><span data-stu-id="ed831-129">The Azure regions are the location values supported by the Internet Latency Table.</span></span> <span data-ttu-id="ed831-130">For more information, see [Traffic Manager 'Performance' traffic-routing method](traffic-manager-routing-methods.md#performance).</span><span class="sxs-lookup"><span data-stu-id="ed831-130">For more information, see [Traffic Manager 'Performance' traffic-routing method](traffic-manager-routing-methods.md#performance).</span></span>

## <a name="example-2-endpoint-monitoring-in-nested-profiles"></a><span data-ttu-id="ed831-131">Example 2: Endpoint monitoring in Nested Profiles</span><span class="sxs-lookup"><span data-stu-id="ed831-131">Example 2: Endpoint monitoring in Nested Profiles</span></span>

<span data-ttu-id="ed831-132">Traffic Manager actively monitors the health of each service endpoint.</span><span class="sxs-lookup"><span data-stu-id="ed831-132">Traffic Manager actively monitors the health of each service endpoint.</span></span> <span data-ttu-id="ed831-133">If an endpoint is unhealthy, Traffic Manager directs users to alternative endpoints to preserve the availability of your service.</span><span class="sxs-lookup"><span data-stu-id="ed831-133">If an endpoint is unhealthy, Traffic Manager directs users to alternative endpoints to preserve the availability of your service.</span></span> <span data-ttu-id="ed831-134">This endpoint monitoring and failover behavior applies to all traffic-routing methods.</span><span class="sxs-lookup"><span data-stu-id="ed831-134">This endpoint monitoring and failover behavior applies to all traffic-routing methods.</span></span> <span data-ttu-id="ed831-135">For more information, see [Traffic Manager Endpoint Monitoring](traffic-manager-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="ed831-135">For more information, see [Traffic Manager Endpoint Monitoring](traffic-manager-monitoring.md).</span></span> <span data-ttu-id="ed831-136">Endpoint monitoring works differently for nested profiles.</span><span class="sxs-lookup"><span data-stu-id="ed831-136">Endpoint monitoring works differently for nested profiles.</span></span> <span data-ttu-id="ed831-137">With nested profiles, the parent profile doesn't perform health checks on the child directly.</span><span class="sxs-lookup"><span data-stu-id="ed831-137">With nested profiles, the parent profile doesn't perform health checks on the child directly.</span></span> <span data-ttu-id="ed831-138">Instead, the health of the child profile's endpoints is used to calculate the overall health of the child profile.</span><span class="sxs-lookup"><span data-stu-id="ed831-138">Instead, the health of the child profile's endpoints is used to calculate the overall health of the child profile.</span></span> <span data-ttu-id="ed831-139">This health information is propagated up the nested profile hierarchy.</span><span class="sxs-lookup"><span data-stu-id="ed831-139">This health information is propagated up the nested profile hierarchy.</span></span> <span data-ttu-id="ed831-140">The parent profile uses this aggregated health to determine whether to direct traffic to the child profile.</span><span class="sxs-lookup"><span data-stu-id="ed831-140">The parent profile uses this aggregated health to determine whether to direct traffic to the child profile.</span></span> <span data-ttu-id="ed831-141">See the [FAQ](traffic-manager-FAQs.md#traffic-manager-nested-profiles) for full details on health monitoring of nested profiles.</span><span class="sxs-lookup"><span data-stu-id="ed831-141">See the [FAQ](traffic-manager-FAQs.md#traffic-manager-nested-profiles) for full details on health monitoring of nested profiles.</span></span>

<span data-ttu-id="ed831-142">Returning to the previous example, suppose the production deployment in West Europe fails.</span><span class="sxs-lookup"><span data-stu-id="ed831-142">Returning to the previous example, suppose the production deployment in West Europe fails.</span></span> <span data-ttu-id="ed831-143">By default, the 'child' profile directs all traffic to the test deployment.</span><span class="sxs-lookup"><span data-stu-id="ed831-143">By default, the 'child' profile directs all traffic to the test deployment.</span></span> <span data-ttu-id="ed831-144">If the test deployment also fails, the parent profile determines that the child profile should not receive traffic since all child endpoints are unhealthy.</span><span class="sxs-lookup"><span data-stu-id="ed831-144">If the test deployment also fails, the parent profile determines that the child profile should not receive traffic since all child endpoints are unhealthy.</span></span> <span data-ttu-id="ed831-145">Then, the parent profile distributes traffic to the other regions.</span><span class="sxs-lookup"><span data-stu-id="ed831-145">Then, the parent profile distributes traffic to the other regions.</span></span>

![Nested Profile failover (default behavior)][3]

<span data-ttu-id="ed831-147">You might be happy with this arrangement.</span><span class="sxs-lookup"><span data-stu-id="ed831-147">You might be happy with this arrangement.</span></span> <span data-ttu-id="ed831-148">Or you might be concerned that all traffic for West Europe is now going to the test deployment instead of a limited subset traffic.</span><span class="sxs-lookup"><span data-stu-id="ed831-148">Or you might be concerned that all traffic for West Europe is now going to the test deployment instead of a limited subset traffic.</span></span> <span data-ttu-id="ed831-149">Regardless of the health of the test deployment, you want to fail over to the other regions when the production deployment in West Europe fails.</span><span class="sxs-lookup"><span data-stu-id="ed831-149">Regardless of the health of the test deployment, you want to fail over to the other regions when the production deployment in West Europe fails.</span></span> <span data-ttu-id="ed831-150">To enable this failover, you can specify the 'MinChildEndpoints' parameter when configuring the child profile as an endpoint in the parent profile.</span><span class="sxs-lookup"><span data-stu-id="ed831-150">To enable this failover, you can specify the 'MinChildEndpoints' parameter when configuring the child profile as an endpoint in the parent profile.</span></span> <span data-ttu-id="ed831-151">The parameter determines the minimum number of available endpoints in the child profile.</span><span class="sxs-lookup"><span data-stu-id="ed831-151">The parameter determines the minimum number of available endpoints in the child profile.</span></span> <span data-ttu-id="ed831-152">The default value is '1'.</span><span class="sxs-lookup"><span data-stu-id="ed831-152">The default value is '1'.</span></span> <span data-ttu-id="ed831-153">For this scenario, you set the MinChildEndpoints value to 2.</span><span class="sxs-lookup"><span data-stu-id="ed831-153">For this scenario, you set the MinChildEndpoints value to 2.</span></span> <span data-ttu-id="ed831-154">Below this threshold, the parent profile considers the entire child profile to be unavailable and directs traffic to the other endpoints.</span><span class="sxs-lookup"><span data-stu-id="ed831-154">Below this threshold, the parent profile considers the entire child profile to be unavailable and directs traffic to the other endpoints.</span></span>

<span data-ttu-id="ed831-155">The following figure illustrates this configuration:</span><span class="sxs-lookup"><span data-stu-id="ed831-155">The following figure illustrates this configuration:</span></span>

![Nested Profile failover with 'MinChildEndpoints' = 2][4]

> [!NOTE]
> <span data-ttu-id="ed831-157">The 'Priority' traffic-routing method distributes all traffic to a single endpoint.</span><span class="sxs-lookup"><span data-stu-id="ed831-157">The 'Priority' traffic-routing method distributes all traffic to a single endpoint.</span></span> <span data-ttu-id="ed831-158">Thus there is little purpose in a MinChildEndpoints setting other than '1' for a child profile.</span><span class="sxs-lookup"><span data-stu-id="ed831-158">Thus there is little purpose in a MinChildEndpoints setting other than '1' for a child profile.</span></span>

## <a name="example-3-prioritized-failover-regions-in-performance-traffic-routing"></a><span data-ttu-id="ed831-159">Example 3: Prioritized failover regions in 'Performance' traffic routing</span><span class="sxs-lookup"><span data-stu-id="ed831-159">Example 3: Prioritized failover regions in 'Performance' traffic routing</span></span>

<span data-ttu-id="ed831-160">The default behavior for the 'Performance' traffic-routing method is designed to avoid over-loading the next nearest endpoint and causing a cascading series of failures.</span><span class="sxs-lookup"><span data-stu-id="ed831-160">The default behavior for the 'Performance' traffic-routing method is designed to avoid over-loading the next nearest endpoint and causing a cascading series of failures.</span></span> <span data-ttu-id="ed831-161">When an endpoint fails, all traffic that would have been directed to that endpoint is evenly distributed to the other endpoints across all regions.</span><span class="sxs-lookup"><span data-stu-id="ed831-161">When an endpoint fails, all traffic that would have been directed to that endpoint is evenly distributed to the other endpoints across all regions.</span></span>

!['Performance' traffic routing with default failover][5]

<span data-ttu-id="ed831-163">However, suppose you prefer the West Europe traffic failover to West US, and only direct traffic to other regions when both endpoints are unavailable.</span><span class="sxs-lookup"><span data-stu-id="ed831-163">However, suppose you prefer the West Europe traffic failover to West US, and only direct traffic to other regions when both endpoints are unavailable.</span></span> <span data-ttu-id="ed831-164">You can create this solution using a child profile with the 'Priority' traffic-routing method.</span><span class="sxs-lookup"><span data-stu-id="ed831-164">You can create this solution using a child profile with the 'Priority' traffic-routing method.</span></span>

!['Performance' traffic routing with preferential failover][6]

<span data-ttu-id="ed831-166">Since the West Europe endpoint has higher priority than the West US endpoint, all traffic is sent to the West Europe endpoint when both endpoints are online.</span><span class="sxs-lookup"><span data-stu-id="ed831-166">Since the West Europe endpoint has higher priority than the West US endpoint, all traffic is sent to the West Europe endpoint when both endpoints are online.</span></span> <span data-ttu-id="ed831-167">If West Europe fails, its traffic is directed to West US.</span><span class="sxs-lookup"><span data-stu-id="ed831-167">If West Europe fails, its traffic is directed to West US.</span></span> <span data-ttu-id="ed831-168">With the nested profile, traffic is directed to East Asia only when both West Europe and West US fail.</span><span class="sxs-lookup"><span data-stu-id="ed831-168">With the nested profile, traffic is directed to East Asia only when both West Europe and West US fail.</span></span>

<span data-ttu-id="ed831-169">You can repeat this pattern for all regions.</span><span class="sxs-lookup"><span data-stu-id="ed831-169">You can repeat this pattern for all regions.</span></span> <span data-ttu-id="ed831-170">Replace all three endpoints in the parent profile with three child profiles, each providing a prioritized failover sequence.</span><span class="sxs-lookup"><span data-stu-id="ed831-170">Replace all three endpoints in the parent profile with three child profiles, each providing a prioritized failover sequence.</span></span>

## <a name="example-4-controlling-performance-traffic-routing-between-multiple-endpoints-in-the-same-region"></a><span data-ttu-id="ed831-171">Example 4: Controlling 'Performance' traffic routing between multiple endpoints in the same region</span><span class="sxs-lookup"><span data-stu-id="ed831-171">Example 4: Controlling 'Performance' traffic routing between multiple endpoints in the same region</span></span>

<span data-ttu-id="ed831-172">Suppose the 'Performance' traffic-routing method is used in a profile that has more than one endpoint in a particular region.</span><span class="sxs-lookup"><span data-stu-id="ed831-172">Suppose the 'Performance' traffic-routing method is used in a profile that has more than one endpoint in a particular region.</span></span> <span data-ttu-id="ed831-173">By default, traffic directed to that region is distributed evenly across all available endpoints in that region.</span><span class="sxs-lookup"><span data-stu-id="ed831-173">By default, traffic directed to that region is distributed evenly across all available endpoints in that region.</span></span>

!['Performance' traffic routing in-region traffic distribution (default behavior)][7]

<span data-ttu-id="ed831-175">Instead of adding multiple endpoints in West Europe, those endpoints are enclosed in a separate child profile.</span><span class="sxs-lookup"><span data-stu-id="ed831-175">Instead of adding multiple endpoints in West Europe, those endpoints are enclosed in a separate child profile.</span></span> <span data-ttu-id="ed831-176">The child profile is added to the parent as the only endpoint in West Europe.</span><span class="sxs-lookup"><span data-stu-id="ed831-176">The child profile is added to the parent as the only endpoint in West Europe.</span></span> <span data-ttu-id="ed831-177">The settings on the child profile can control the traffic distribution with West Europe by enabling priority-based or weighted traffic routing within that region.</span><span class="sxs-lookup"><span data-stu-id="ed831-177">The settings on the child profile can control the traffic distribution with West Europe by enabling priority-based or weighted traffic routing within that region.</span></span>

!['Performance' traffic routing with custom in-region traffic distribution][8]

## <a name="example-5-per-endpoint-monitoring-settings"></a><span data-ttu-id="ed831-179">Example 5: Per-endpoint monitoring settings</span><span class="sxs-lookup"><span data-stu-id="ed831-179">Example 5: Per-endpoint monitoring settings</span></span>

<span data-ttu-id="ed831-180">Suppose you are using Traffic Manager to smoothly migrate traffic from a legacy on-premises web site to a new Cloud-based version hosted in Azure.</span><span class="sxs-lookup"><span data-stu-id="ed831-180">Suppose you are using Traffic Manager to smoothly migrate traffic from a legacy on-premises web site to a new Cloud-based version hosted in Azure.</span></span> <span data-ttu-id="ed831-181">For the legacy site, you want to use the home page URI to monitor site health.</span><span class="sxs-lookup"><span data-stu-id="ed831-181">For the legacy site, you want to use the home page URI to monitor site health.</span></span> <span data-ttu-id="ed831-182">But for the new Cloud-based version, you are implementing a custom monitoring page (path '/monitor.aspx') that includes additional checks.</span><span class="sxs-lookup"><span data-stu-id="ed831-182">But for the new Cloud-based version, you are implementing a custom monitoring page (path '/monitor.aspx') that includes additional checks.</span></span>

![Traffic Manager endpoint monitoring (default behavior)][9]

<span data-ttu-id="ed831-184">The monitoring settings in a Traffic Manager profile apply to all endpoints within a single profile.</span><span class="sxs-lookup"><span data-stu-id="ed831-184">The monitoring settings in a Traffic Manager profile apply to all endpoints within a single profile.</span></span> <span data-ttu-id="ed831-185">With nested profiles, you use a different child profile per site to define different monitoring settings.</span><span class="sxs-lookup"><span data-stu-id="ed831-185">With nested profiles, you use a different child profile per site to define different monitoring settings.</span></span>

![Traffic Manager endpoint monitoring with per-endpoint settings][10]

## <a name="next-steps"></a><span data-ttu-id="ed831-187">Next steps</span><span class="sxs-lookup"><span data-stu-id="ed831-187">Next steps</span></span>

<span data-ttu-id="ed831-188">Learn more about [Traffic Manager profiles](traffic-manager-overview.md)</span><span class="sxs-lookup"><span data-stu-id="ed831-188">Learn more about [Traffic Manager profiles](traffic-manager-overview.md)</span></span>

<span data-ttu-id="ed831-189">Learn how to [create a Traffic Manager profile](traffic-manager-create-profile.md)</span><span class="sxs-lookup"><span data-stu-id="ed831-189">Learn how to [create a Traffic Manager profile](traffic-manager-create-profile.md)</span></span>

<!--Image references-->
[1]: ./media/traffic-manager-nested-profiles/figure-1.png
[2]: ./media/traffic-manager-nested-profiles/figure-2.png
[3]: ./media/traffic-manager-nested-profiles/figure-3.png
[4]: ./media/traffic-manager-nested-profiles/figure-4.png
[5]: ./media/traffic-manager-nested-profiles/figure-5.png
[6]: ./media/traffic-manager-nested-profiles/figure-6.png
[7]: ./media/traffic-manager-nested-profiles/figure-7.png
[8]: ./media/traffic-manager-nested-profiles/figure-8.png
[9]: ./media/traffic-manager-nested-profiles/figure-9.png
[10]: ./media/traffic-manager-nested-profiles/figure-10.png
