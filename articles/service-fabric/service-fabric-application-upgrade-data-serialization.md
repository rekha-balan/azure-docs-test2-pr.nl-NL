---
title: 'Application upgrade: data serialization | Microsoft Docs'
description: Best practices for data serialization and how it affects rolling application upgrades.
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: ''
ms.assetid: a5f36366-a2ab-4ae3-bb08-bc2f9533bc5a
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 02/10/2017
ms.author: vturecek
ms.openlocfilehash: a43aabc5d93f6e4c1bc0b0d3dadc64b0c42500d9
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44556342"
---
# <a name="how-data-serialization-affects-an-application-upgrade"></a><span data-ttu-id="dc4e4-103">How data serialization affects an application upgrade</span><span class="sxs-lookup"><span data-stu-id="dc4e4-103">How data serialization affects an application upgrade</span></span>
<span data-ttu-id="dc4e4-104">In a [rolling application upgrade](service-fabric-application-upgrade.md), the upgrade is applied to a subset of nodes, one upgrade domain at a time.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-104">In a [rolling application upgrade](service-fabric-application-upgrade.md), the upgrade is applied to a subset of nodes, one upgrade domain at a time.</span></span> <span data-ttu-id="dc4e4-105">During this process, some upgrade domains will be on the newer version of your application, and some upgrade domains will be on the older version of your application.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-105">During this process, some upgrade domains will be on the newer version of your application, and some upgrade domains will be on the older version of your application.</span></span> <span data-ttu-id="dc4e4-106">During the rollout, the new version of your application must be able to read the old version of your data, and the old version of your application must be able to read the new version of your data.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-106">During the rollout, the new version of your application must be able to read the old version of your data, and the old version of your application must be able to read the new version of your data.</span></span> <span data-ttu-id="dc4e4-107">If the data format is not forward and backward compatible, the upgrade may fail, or worse, data may be lost or corrupted.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-107">If the data format is not forward and backward compatible, the upgrade may fail, or worse, data may be lost or corrupted.</span></span> <span data-ttu-id="dc4e4-108">This article discusses what constitutes your data format and offers best practices for ensuring that your data is forward and backward compatible.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-108">This article discusses what constitutes your data format and offers best practices for ensuring that your data is forward and backward compatible.</span></span>

## <a name="what-makes-up-your-data-format"></a><span data-ttu-id="dc4e4-109">What makes up your data format?</span><span class="sxs-lookup"><span data-stu-id="dc4e4-109">What makes up your data format?</span></span>
<span data-ttu-id="dc4e4-110">In Azure Service Fabric, the data that is persisted and replicated comes from your C# classes.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-110">In Azure Service Fabric, the data that is persisted and replicated comes from your C# classes.</span></span> <span data-ttu-id="dc4e4-111">For applications that use [Reliable Collections](service-fabric-reliable-services-reliable-collections.md), that is the objects in the reliable dictionaries and queues.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-111">For applications that use [Reliable Collections](service-fabric-reliable-services-reliable-collections.md), that is the objects in the reliable dictionaries and queues.</span></span> <span data-ttu-id="dc4e4-112">For applications that use [Reliable Actors](service-fabric-reliable-actors-introduction.md), that is the backing state for the actor.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-112">For applications that use [Reliable Actors](service-fabric-reliable-actors-introduction.md), that is the backing state for the actor.</span></span> <span data-ttu-id="dc4e4-113">These C# classes must be serializable to be persisted and replicated.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-113">These C# classes must be serializable to be persisted and replicated.</span></span> <span data-ttu-id="dc4e4-114">Therefore, the data format is defined by the fields and properties that are serialized, as well as how they are serialized.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-114">Therefore, the data format is defined by the fields and properties that are serialized, as well as how they are serialized.</span></span> <span data-ttu-id="dc4e4-115">For example, in an `IReliableDictionary<int, MyClass>` the data is a serialized `int` and a serialized `MyClass`.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-115">For example, in an `IReliableDictionary<int, MyClass>` the data is a serialized `int` and a serialized `MyClass`.</span></span>

### <a name="code-changes-that-result-in-a-data-format-change"></a><span data-ttu-id="dc4e4-116">Code changes that result in a data format change</span><span class="sxs-lookup"><span data-stu-id="dc4e4-116">Code changes that result in a data format change</span></span>
<span data-ttu-id="dc4e4-117">Since the data format is determined by C# classes, changes to the classes may cause a data format change.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-117">Since the data format is determined by C# classes, changes to the classes may cause a data format change.</span></span> <span data-ttu-id="dc4e4-118">Care must be taken to ensure that a rolling upgrade can handle the data format change.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-118">Care must be taken to ensure that a rolling upgrade can handle the data format change.</span></span> <span data-ttu-id="dc4e4-119">Examples that may cause data format changes:</span><span class="sxs-lookup"><span data-stu-id="dc4e4-119">Examples that may cause data format changes:</span></span>

* <span data-ttu-id="dc4e4-120">Adding or removing fields or properties</span><span class="sxs-lookup"><span data-stu-id="dc4e4-120">Adding or removing fields or properties</span></span>
* <span data-ttu-id="dc4e4-121">Renaming fields or properties</span><span class="sxs-lookup"><span data-stu-id="dc4e4-121">Renaming fields or properties</span></span>
* <span data-ttu-id="dc4e4-122">Changing the types of fields or properties</span><span class="sxs-lookup"><span data-stu-id="dc4e4-122">Changing the types of fields or properties</span></span>
* <span data-ttu-id="dc4e4-123">Changing the class name or namespace</span><span class="sxs-lookup"><span data-stu-id="dc4e4-123">Changing the class name or namespace</span></span>

### <a name="data-contract-as-the-default-serializer"></a><span data-ttu-id="dc4e4-124">Data Contract as the default serializer</span><span class="sxs-lookup"><span data-stu-id="dc4e4-124">Data Contract as the default serializer</span></span>
<span data-ttu-id="dc4e4-125">The serializer is generally responsible for reading the data and deserializing it into the current version, even if the data is in an older or *newer* version.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-125">The serializer is generally responsible for reading the data and deserializing it into the current version, even if the data is in an older or *newer* version.</span></span> <span data-ttu-id="dc4e4-126">The default serializer is the [Data Contract serializer](https://msdn.microsoft.com/library/ms733127.aspx), which has well-defined versioning rules.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-126">The default serializer is the [Data Contract serializer](https://msdn.microsoft.com/library/ms733127.aspx), which has well-defined versioning rules.</span></span> <span data-ttu-id="dc4e4-127">Reliable Collections allow the serializer to be overridden, but Reliable Actors currently do not.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-127">Reliable Collections allow the serializer to be overridden, but Reliable Actors currently do not.</span></span> <span data-ttu-id="dc4e4-128">The data serializer plays an important role in enabling rolling upgrades.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-128">The data serializer plays an important role in enabling rolling upgrades.</span></span> <span data-ttu-id="dc4e4-129">The Data Contract serializer is the serializer that we recommend for Service Fabric applications.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-129">The Data Contract serializer is the serializer that we recommend for Service Fabric applications.</span></span>

## <a name="how-the-data-format-affects-a-rolling-upgrade"></a><span data-ttu-id="dc4e4-130">How the data format affects a rolling upgrade</span><span class="sxs-lookup"><span data-stu-id="dc4e4-130">How the data format affects a rolling upgrade</span></span>
<span data-ttu-id="dc4e4-131">During a rolling upgrade, there are two main scenarios where the serializer may encounter an older or *newer* version of your data:</span><span class="sxs-lookup"><span data-stu-id="dc4e4-131">During a rolling upgrade, there are two main scenarios where the serializer may encounter an older or *newer* version of your data:</span></span>

1. <span data-ttu-id="dc4e4-132">After a node is upgraded and starts back up, the new serializer will load the data that was persisted to disk by the old version.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-132">After a node is upgraded and starts back up, the new serializer will load the data that was persisted to disk by the old version.</span></span>
2. <span data-ttu-id="dc4e4-133">During the rolling upgrade, the cluster will contain a mix of the old and new versions of your code.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-133">During the rolling upgrade, the cluster will contain a mix of the old and new versions of your code.</span></span> <span data-ttu-id="dc4e4-134">Since replicas may be placed in different upgrade domains, and replicas send data to each other, the new and/or old version of your data may be encountered by the new and/or old version of your serializer.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-134">Since replicas may be placed in different upgrade domains, and replicas send data to each other, the new and/or old version of your data may be encountered by the new and/or old version of your serializer.</span></span>

> [!NOTE]
> <span data-ttu-id="dc4e4-135">The "new version" and "old version" here refer to the version of your code that is running.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-135">The "new version" and "old version" here refer to the version of your code that is running.</span></span> <span data-ttu-id="dc4e4-136">The "new serializer" refers to the serializer code that is executing in the new version of your application.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-136">The "new serializer" refers to the serializer code that is executing in the new version of your application.</span></span> <span data-ttu-id="dc4e4-137">The "new data" refers to the serialized C# class from the new version of your application.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-137">The "new data" refers to the serialized C# class from the new version of your application.</span></span>
> 
> 

<span data-ttu-id="dc4e4-138">The two versions of code and data format must be both forward and backward compatible.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-138">The two versions of code and data format must be both forward and backward compatible.</span></span> <span data-ttu-id="dc4e4-139">If they are not compatible, the rolling upgrade may fail or data may be lost.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-139">If they are not compatible, the rolling upgrade may fail or data may be lost.</span></span> <span data-ttu-id="dc4e4-140">The rolling upgrade may fail because the code or serializer may throw exceptions or a fault when it encounters the other version.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-140">The rolling upgrade may fail because the code or serializer may throw exceptions or a fault when it encounters the other version.</span></span> <span data-ttu-id="dc4e4-141">Data may be lost if, for example, a new property was added but the old serializer discards it during deserialization.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-141">Data may be lost if, for example, a new property was added but the old serializer discards it during deserialization.</span></span>

<span data-ttu-id="dc4e4-142">Data Contract is the recommended solution for ensuring that your data is compatible.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-142">Data Contract is the recommended solution for ensuring that your data is compatible.</span></span> <span data-ttu-id="dc4e4-143">It has well-defined versioning rules for adding, removing, and changing fields.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-143">It has well-defined versioning rules for adding, removing, and changing fields.</span></span> <span data-ttu-id="dc4e4-144">It also has support for dealing with unknown fields, hooking into the serialization and deserialization process, and dealing with class inheritance.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-144">It also has support for dealing with unknown fields, hooking into the serialization and deserialization process, and dealing with class inheritance.</span></span> <span data-ttu-id="dc4e4-145">For more information, see [Using Data Contract](https://msdn.microsoft.com/library/ms733127.aspx).</span><span class="sxs-lookup"><span data-stu-id="dc4e4-145">For more information, see [Using Data Contract](https://msdn.microsoft.com/library/ms733127.aspx).</span></span>

## <a name="next-steps"></a><span data-ttu-id="dc4e4-146">Next steps</span><span class="sxs-lookup"><span data-stu-id="dc4e4-146">Next steps</span></span>
<span data-ttu-id="dc4e4-147">[Uprading your Application Using Visual Studio](service-fabric-application-upgrade-tutorial.md) walks you through an application upgrade using Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-147">[Uprading your Application Using Visual Studio](service-fabric-application-upgrade-tutorial.md) walks you through an application upgrade using Visual Studio.</span></span>

<span data-ttu-id="dc4e4-148">[Uprading your Application Using Powershell](service-fabric-application-upgrade-tutorial-powershell.md) walks you through an application upgrade using PowerShell.</span><span class="sxs-lookup"><span data-stu-id="dc4e4-148">[Uprading your Application Using Powershell](service-fabric-application-upgrade-tutorial-powershell.md) walks you through an application upgrade using PowerShell.</span></span>

<span data-ttu-id="dc4e4-149">Control how your application upgrades by using [Upgrade Parameters](service-fabric-application-upgrade-parameters.md).</span><span class="sxs-lookup"><span data-stu-id="dc4e4-149">Control how your application upgrades by using [Upgrade Parameters](service-fabric-application-upgrade-parameters.md).</span></span>

<span data-ttu-id="dc4e4-150">Learn how to use advanced functionality while upgrading your application by referring to [Advanced Topics](service-fabric-application-upgrade-advanced.md).</span><span class="sxs-lookup"><span data-stu-id="dc4e4-150">Learn how to use advanced functionality while upgrading your application by referring to [Advanced Topics](service-fabric-application-upgrade-advanced.md).</span></span>

<span data-ttu-id="dc4e4-151">Fix common problems in application upgrades by referring to the steps in [Troubleshooting Application Upgrades ](service-fabric-application-upgrade-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="dc4e4-151">Fix common problems in application upgrades by referring to the steps in [Troubleshooting Application Upgrades ](service-fabric-application-upgrade-troubleshooting.md).</span></span>

