---
title: Fault Analysis Service overview | Microsoft Docs
description: This article describes the Fault Analysis Service in Service Fabric for inducing faults and running test scenarios against your services.
services: service-fabric
documentationcenter: .net
author: anmolah
manager: timlt
editor: vturecek
ms.assetid: 1f064276-293a-4989-a513-e0d0b9fdf703
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: conceptual
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/15/2017
ms.author: anmola
ms.openlocfilehash: dea8c967f91d828264f8a3def5874cfeec26bd7e
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44803184"
---
# <a name="introduction-to-the-fault-analysis-service"></a><span data-ttu-id="3c4cc-103">Introduction to the Fault Analysis Service</span><span class="sxs-lookup"><span data-stu-id="3c4cc-103">Introduction to the Fault Analysis Service</span></span>
<span data-ttu-id="3c4cc-104">The Fault Analysis Service is designed for testing services that are built on Microsoft Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-104">The Fault Analysis Service is designed for testing services that are built on Microsoft Azure Service Fabric.</span></span> <span data-ttu-id="3c4cc-105">With the Fault Analysis Service you can induce meaningful faults and run complete test scenarios against your applications.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-105">With the Fault Analysis Service you can induce meaningful faults and run complete test scenarios against your applications.</span></span> <span data-ttu-id="3c4cc-106">These faults and scenarios exercise and validate the numerous states and transitions that a service will experience throughout its lifetime, all in a controlled, safe, and consistent manner.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-106">These faults and scenarios exercise and validate the numerous states and transitions that a service will experience throughout its lifetime, all in a controlled, safe, and consistent manner.</span></span>

<span data-ttu-id="3c4cc-107">Actions are the individual faults targeting a service for testing it.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-107">Actions are the individual faults targeting a service for testing it.</span></span> <span data-ttu-id="3c4cc-108">A service developer can use these as building blocks to write complicated scenarios.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-108">A service developer can use these as building blocks to write complicated scenarios.</span></span> <span data-ttu-id="3c4cc-109">For example:</span><span class="sxs-lookup"><span data-stu-id="3c4cc-109">For example:</span></span>

* <span data-ttu-id="3c4cc-110">Restart a node to simulate any number of situations where a machine or VM is rebooted.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-110">Restart a node to simulate any number of situations where a machine or VM is rebooted.</span></span>
* <span data-ttu-id="3c4cc-111">Move a replica of your stateful service to simulate load balancing, failover, or application upgrade.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-111">Move a replica of your stateful service to simulate load balancing, failover, or application upgrade.</span></span>
* <span data-ttu-id="3c4cc-112">Invoke quorum loss on a stateful service to create a situation where write operations can't proceed because there aren't enough "back-up" or "secondary" replicas to accept new data.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-112">Invoke quorum loss on a stateful service to create a situation where write operations can't proceed because there aren't enough "back-up" or "secondary" replicas to accept new data.</span></span>
* <span data-ttu-id="3c4cc-113">Invoke data loss on a stateful service to create a situation where all in-memory state is completely wiped out.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-113">Invoke data loss on a stateful service to create a situation where all in-memory state is completely wiped out.</span></span>

<span data-ttu-id="3c4cc-114">Scenarios are complex operations composed of one or more actions.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-114">Scenarios are complex operations composed of one or more actions.</span></span> <span data-ttu-id="3c4cc-115">The Fault Analysis Service provides two built-in complete scenarios:</span><span class="sxs-lookup"><span data-stu-id="3c4cc-115">The Fault Analysis Service provides two built-in complete scenarios:</span></span>

* <span data-ttu-id="3c4cc-116">Chaos Scenario</span><span class="sxs-lookup"><span data-stu-id="3c4cc-116">Chaos Scenario</span></span>
* <span data-ttu-id="3c4cc-117">Failover Scenario</span><span class="sxs-lookup"><span data-stu-id="3c4cc-117">Failover Scenario</span></span>

## <a name="testing-as-a-service"></a><span data-ttu-id="3c4cc-118">Testing as a service</span><span class="sxs-lookup"><span data-stu-id="3c4cc-118">Testing as a service</span></span>
<span data-ttu-id="3c4cc-119">The Fault Analysis Service is a Service Fabric system service that is automatically started with a Service Fabric cluster.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-119">The Fault Analysis Service is a Service Fabric system service that is automatically started with a Service Fabric cluster.</span></span> <span data-ttu-id="3c4cc-120">This service acts as the host for fault injection, test scenario execution, and health analysis.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-120">This service acts as the host for fault injection, test scenario execution, and health analysis.</span></span> 

![Fault Analysis Service][0]

<span data-ttu-id="3c4cc-122">When a fault action or test scenario is initiated, a command is sent to the Fault Analysis Service to run the fault action or test scenario.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-122">When a fault action or test scenario is initiated, a command is sent to the Fault Analysis Service to run the fault action or test scenario.</span></span> <span data-ttu-id="3c4cc-123">The Fault Analysis Service is stateful so that it can reliably run faults and scenarios and validate results.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-123">The Fault Analysis Service is stateful so that it can reliably run faults and scenarios and validate results.</span></span> <span data-ttu-id="3c4cc-124">For example, a long-running test scenario can be reliably executed by the Fault Analysis Service.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-124">For example, a long-running test scenario can be reliably executed by the Fault Analysis Service.</span></span> <span data-ttu-id="3c4cc-125">And because tests are being executed inside the cluster, the service can examine the state of the cluster and your services to provide more in-depth information about failures.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-125">And because tests are being executed inside the cluster, the service can examine the state of the cluster and your services to provide more in-depth information about failures.</span></span>

## <a name="testing-distributed-systems"></a><span data-ttu-id="3c4cc-126">Testing distributed systems</span><span class="sxs-lookup"><span data-stu-id="3c4cc-126">Testing distributed systems</span></span>
<span data-ttu-id="3c4cc-127">Service Fabric makes the job of writing and managing distributed scalable applications significantly easier.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-127">Service Fabric makes the job of writing and managing distributed scalable applications significantly easier.</span></span> <span data-ttu-id="3c4cc-128">The Fault Analysis Service makes testing a distributed application similarly easier.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-128">The Fault Analysis Service makes testing a distributed application similarly easier.</span></span> <span data-ttu-id="3c4cc-129">There are three main issues that need to be solved while testing:</span><span class="sxs-lookup"><span data-stu-id="3c4cc-129">There are three main issues that need to be solved while testing:</span></span>

1. <span data-ttu-id="3c4cc-130">Simulating/generating failures that might occur in real-world scenarios: One of the important aspects of Service Fabric is that it enables distributed applications to recover from various failures.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-130">Simulating/generating failures that might occur in real-world scenarios: One of the important aspects of Service Fabric is that it enables distributed applications to recover from various failures.</span></span> <span data-ttu-id="3c4cc-131">However, to test that the application is able to recover from these failures, we need a mechanism to simulate/generate these real-world failures in a controlled test environment.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-131">However, to test that the application is able to recover from these failures, we need a mechanism to simulate/generate these real-world failures in a controlled test environment.</span></span>
1. <span data-ttu-id="3c4cc-132">The ability to generate correlated failures: Basic failures in the system, such as network failures and machine failures, are easy to produce individually.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-132">The ability to generate correlated failures: Basic failures in the system, such as network failures and machine failures, are easy to produce individually.</span></span> <span data-ttu-id="3c4cc-133">Generating a significant number of scenarios that can happen in the real world as a result of the interactions of these individual failures is non-trivial.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-133">Generating a significant number of scenarios that can happen in the real world as a result of the interactions of these individual failures is non-trivial.</span></span>
1. <span data-ttu-id="3c4cc-134">Unified experience across various levels of development and deployment: There are many fault injection systems that can do various types of failures.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-134">Unified experience across various levels of development and deployment: There are many fault injection systems that can do various types of failures.</span></span> <span data-ttu-id="3c4cc-135">However, the experience in all of these is poor when moving from one-box developer scenarios, to running the same tests in large test environments, to using them for tests in production.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-135">However, the experience in all of these is poor when moving from one-box developer scenarios, to running the same tests in large test environments, to using them for tests in production.</span></span>

<span data-ttu-id="3c4cc-136">While there are many mechanisms to solve these problems, a system that does the same with required guarantees--all the way from a one-box developer environment, to test in production clusters--is missing.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-136">While there are many mechanisms to solve these problems, a system that does the same with required guarantees--all the way from a one-box developer environment, to test in production clusters--is missing.</span></span> <span data-ttu-id="3c4cc-137">The Fault Analysis Service helps the application developers concentrate on testing their business logic.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-137">The Fault Analysis Service helps the application developers concentrate on testing their business logic.</span></span> <span data-ttu-id="3c4cc-138">The Fault Analysis Service provides all the capabilities needed to test the interaction of the service with the underlying distributed system.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-138">The Fault Analysis Service provides all the capabilities needed to test the interaction of the service with the underlying distributed system.</span></span>

### <a name="simulatinggenerating-real-world-failure-scenarios"></a><span data-ttu-id="3c4cc-139">Simulating/generating real-world failure scenarios</span><span class="sxs-lookup"><span data-stu-id="3c4cc-139">Simulating/generating real-world failure scenarios</span></span>
<span data-ttu-id="3c4cc-140">To test the robustness of a distributed system against failures, we need a mechanism to generate failures.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-140">To test the robustness of a distributed system against failures, we need a mechanism to generate failures.</span></span> <span data-ttu-id="3c4cc-141">While in theory, generating a failure like a node down seems easy, it starts hitting the same set of consistency problems that Service Fabric is trying to solve.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-141">While in theory, generating a failure like a node down seems easy, it starts hitting the same set of consistency problems that Service Fabric is trying to solve.</span></span> <span data-ttu-id="3c4cc-142">As an example, if we want to shut down a node, the required workflow is the following:</span><span class="sxs-lookup"><span data-stu-id="3c4cc-142">As an example, if we want to shut down a node, the required workflow is the following:</span></span>

1. <span data-ttu-id="3c4cc-143">From the client, issue a shutdown node request.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-143">From the client, issue a shutdown node request.</span></span>
1. <span data-ttu-id="3c4cc-144">Send the request to the right node.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-144">Send the request to the right node.</span></span>
   
    <span data-ttu-id="3c4cc-145">a.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-145">a.</span></span> <span data-ttu-id="3c4cc-146">If the node is not found, it should fail.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-146">If the node is not found, it should fail.</span></span>
   
    <span data-ttu-id="3c4cc-147">b.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-147">b.</span></span> <span data-ttu-id="3c4cc-148">If the node is found, it should return only if the node is shut down.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-148">If the node is found, it should return only if the node is shut down.</span></span>

<span data-ttu-id="3c4cc-149">To verify the failure from a test perspective, the test needs to know that when this failure is induced, the failure actually happens.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-149">To verify the failure from a test perspective, the test needs to know that when this failure is induced, the failure actually happens.</span></span> <span data-ttu-id="3c4cc-150">The guarantee that Service Fabric provides is that either the node will go down or was already down when the command reached the node.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-150">The guarantee that Service Fabric provides is that either the node will go down or was already down when the command reached the node.</span></span> <span data-ttu-id="3c4cc-151">In either case the test should be able to correctly reason about the state and succeed or fail correctly in its validation.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-151">In either case the test should be able to correctly reason about the state and succeed or fail correctly in its validation.</span></span> <span data-ttu-id="3c4cc-152">A system implemented outside of Service Fabric to do the same set of failures could hit many network, hardware, and software issues, which would prevent it from providing the preceding guarantees.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-152">A system implemented outside of Service Fabric to do the same set of failures could hit many network, hardware, and software issues, which would prevent it from providing the preceding guarantees.</span></span> <span data-ttu-id="3c4cc-153">In the presence of the issues stated before, Service Fabric will reconfigure the cluster state to work around the issues, and hence the Fault Analysis Service will still be able to give the right set of guarantees.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-153">In the presence of the issues stated before, Service Fabric will reconfigure the cluster state to work around the issues, and hence the Fault Analysis Service will still be able to give the right set of guarantees.</span></span>

### <a name="generating-required-events-and-scenarios"></a><span data-ttu-id="3c4cc-154">Generating required events and scenarios</span><span class="sxs-lookup"><span data-stu-id="3c4cc-154">Generating required events and scenarios</span></span>
<span data-ttu-id="3c4cc-155">While simulating a real-world failure consistently is tough to start with, the ability to generate correlated failures is even tougher.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-155">While simulating a real-world failure consistently is tough to start with, the ability to generate correlated failures is even tougher.</span></span> <span data-ttu-id="3c4cc-156">For example, a data loss happens in a stateful persisted service when the following things happen:</span><span class="sxs-lookup"><span data-stu-id="3c4cc-156">For example, a data loss happens in a stateful persisted service when the following things happen:</span></span>

1. <span data-ttu-id="3c4cc-157">Only a write quorum of the replicas are caught up on replication.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-157">Only a write quorum of the replicas are caught up on replication.</span></span> <span data-ttu-id="3c4cc-158">All the secondary replicas lag behind the primary.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-158">All the secondary replicas lag behind the primary.</span></span>
1. <span data-ttu-id="3c4cc-159">The write quorum goes down because of the replicas going down (due to a code package or node going down).</span><span class="sxs-lookup"><span data-stu-id="3c4cc-159">The write quorum goes down because of the replicas going down (due to a code package or node going down).</span></span>
1. <span data-ttu-id="3c4cc-160">The write quorum cannot come back up because the data for the replicas is lost (due to disk corruption or machine reimaging).</span><span class="sxs-lookup"><span data-stu-id="3c4cc-160">The write quorum cannot come back up because the data for the replicas is lost (due to disk corruption or machine reimaging).</span></span>

<span data-ttu-id="3c4cc-161">These correlated failures do happen in the real world but not as frequently as individual failures.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-161">These correlated failures do happen in the real world but not as frequently as individual failures.</span></span> <span data-ttu-id="3c4cc-162">The ability to test for these scenarios before they happen in production is critical.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-162">The ability to test for these scenarios before they happen in production is critical.</span></span> <span data-ttu-id="3c4cc-163">Even more important is the ability to simulate these scenarios with production workloads in controlled circumstances (in the middle of the day with all engineers on deck).</span><span class="sxs-lookup"><span data-stu-id="3c4cc-163">Even more important is the ability to simulate these scenarios with production workloads in controlled circumstances (in the middle of the day with all engineers on deck).</span></span> <span data-ttu-id="3c4cc-164">That is much better than having it happen for the first time in production at 2:00 A.M.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-164">That is much better than having it happen for the first time in production at 2:00 A.M.</span></span>

### <a name="unified-experience-across-different-environments"></a><span data-ttu-id="3c4cc-165">Unified experience across different environments</span><span class="sxs-lookup"><span data-stu-id="3c4cc-165">Unified experience across different environments</span></span>
<span data-ttu-id="3c4cc-166">The practice traditionally has been to create three different sets of experiences, one for the development environment, one for tests, and one for production.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-166">The practice traditionally has been to create three different sets of experiences, one for the development environment, one for tests, and one for production.</span></span> <span data-ttu-id="3c4cc-167">The model was:</span><span class="sxs-lookup"><span data-stu-id="3c4cc-167">The model was:</span></span>

1. <span data-ttu-id="3c4cc-168">In the development environment, produce state transitions that allow unit tests of individual methods.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-168">In the development environment, produce state transitions that allow unit tests of individual methods.</span></span>
1. <span data-ttu-id="3c4cc-169">In the test environment, produce failures to allow end-to-end tests that exercise various failure scenarios.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-169">In the test environment, produce failures to allow end-to-end tests that exercise various failure scenarios.</span></span>
1. <span data-ttu-id="3c4cc-170">Keep the production environment pristine to prevent any non-natural failures and to ensure that there is extremely quick human response to failure.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-170">Keep the production environment pristine to prevent any non-natural failures and to ensure that there is extremely quick human response to failure.</span></span>

<span data-ttu-id="3c4cc-171">In Service Fabric, through the Fault Analysis Service, we are proposing to turn this around and use the same methodology from developer environment to production.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-171">In Service Fabric, through the Fault Analysis Service, we are proposing to turn this around and use the same methodology from developer environment to production.</span></span> <span data-ttu-id="3c4cc-172">There are two ways to achieve this:</span><span class="sxs-lookup"><span data-stu-id="3c4cc-172">There are two ways to achieve this:</span></span>

1. <span data-ttu-id="3c4cc-173">To induce controlled failures, use the Fault Analysis Service APIs from a one-box environment all the way to production clusters.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-173">To induce controlled failures, use the Fault Analysis Service APIs from a one-box environment all the way to production clusters.</span></span>
1. <span data-ttu-id="3c4cc-174">To give the cluster a fever that causes automatic induction of failures, use the Fault Analysis Service to generate automatic failures.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-174">To give the cluster a fever that causes automatic induction of failures, use the Fault Analysis Service to generate automatic failures.</span></span> <span data-ttu-id="3c4cc-175">Controlling the rate of failures through configuration enables the same service to be tested differently in different environments.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-175">Controlling the rate of failures through configuration enables the same service to be tested differently in different environments.</span></span>

<span data-ttu-id="3c4cc-176">With Service Fabric, though the scale of failures would be different in the different environments, the actual mechanisms would be identical.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-176">With Service Fabric, though the scale of failures would be different in the different environments, the actual mechanisms would be identical.</span></span> <span data-ttu-id="3c4cc-177">This allows for a much quicker code-to-deployment pipeline and the ability to test the services under real-world loads.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-177">This allows for a much quicker code-to-deployment pipeline and the ability to test the services under real-world loads.</span></span>

## <a name="using-the-fault-analysis-service"></a><span data-ttu-id="3c4cc-178">Using the Fault Analysis Service</span><span class="sxs-lookup"><span data-stu-id="3c4cc-178">Using the Fault Analysis Service</span></span>
<span data-ttu-id="3c4cc-179">**C#**</span><span class="sxs-lookup"><span data-stu-id="3c4cc-179">**C#**</span></span>

<span data-ttu-id="3c4cc-180">Fault Analysis Service features are in the System.Fabric namespace in the Microsoft.ServiceFabric NuGet package.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-180">Fault Analysis Service features are in the System.Fabric namespace in the Microsoft.ServiceFabric NuGet package.</span></span> <span data-ttu-id="3c4cc-181">To use the Fault Analysis Service features, include the nuget package as a reference in your project.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-181">To use the Fault Analysis Service features, include the nuget package as a reference in your project.</span></span>

<span data-ttu-id="3c4cc-182">**PowerShell**</span><span class="sxs-lookup"><span data-stu-id="3c4cc-182">**PowerShell**</span></span>

<span data-ttu-id="3c4cc-183">To use PowerShell, you must install the Service Fabric SDK.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-183">To use PowerShell, you must install the Service Fabric SDK.</span></span> <span data-ttu-id="3c4cc-184">After the SDK is installed, the ServiceFabric PowerShell module is auto loaded for you to use.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-184">After the SDK is installed, the ServiceFabric PowerShell module is auto loaded for you to use.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3c4cc-185">Next steps</span><span class="sxs-lookup"><span data-stu-id="3c4cc-185">Next steps</span></span>
<span data-ttu-id="3c4cc-186">To create truly cloud-scale services, it is critical to ensure, both before and after deployment, that services can withstand real world failures.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-186">To create truly cloud-scale services, it is critical to ensure, both before and after deployment, that services can withstand real world failures.</span></span> <span data-ttu-id="3c4cc-187">In the services world today, the ability to innovate quickly and move code to production quickly is very important.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-187">In the services world today, the ability to innovate quickly and move code to production quickly is very important.</span></span> <span data-ttu-id="3c4cc-188">The Fault Analysis Service helps service developers to do precisely that.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-188">The Fault Analysis Service helps service developers to do precisely that.</span></span>

<span data-ttu-id="3c4cc-189">Begin testing your applications and services using the built-in [test scenarios](service-fabric-testability-scenarios.md), or author your own test scenarios using the [fault actions](service-fabric-testability-actions.md) provided by the Fault Analysis Service.</span><span class="sxs-lookup"><span data-stu-id="3c4cc-189">Begin testing your applications and services using the built-in [test scenarios](service-fabric-testability-scenarios.md), or author your own test scenarios using the [fault actions](service-fabric-testability-actions.md) provided by the Fault Analysis Service.</span></span>

<!--Image references-->
[0]: ./media/service-fabric-testability-overview/faultanalysisservice.png
