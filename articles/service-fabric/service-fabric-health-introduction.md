---
title: Health monitoring in Service Fabric | Microsoft Docs
description: An introduction to the Azure Service Fabric health monitoring model, which provides monitoring of the cluster and its applications and services.
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: ''
ms.assetid: 1d979210-b1eb-4022-be24-799fd9d8e003
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/12/2017
ms.author: oanapl
ms.openlocfilehash: f14d72fa7433c6473c98c64242cc70210213ff2c
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44556327"
---
# <a name="introduction-to-service-fabric-health-monitoring"></a><span data-ttu-id="9ceb8-103">Introduction to Service Fabric health monitoring</span><span class="sxs-lookup"><span data-stu-id="9ceb8-103">Introduction to Service Fabric health monitoring</span></span>
<span data-ttu-id="9ceb8-104">Azure Service Fabric introduces a health model that provides rich, flexible, and extensible health evaluation and reporting.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-104">Azure Service Fabric introduces a health model that provides rich, flexible, and extensible health evaluation and reporting.</span></span> <span data-ttu-id="9ceb8-105">The model allows near-real-time monitoring of the state of the cluster and the services running in it.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-105">The model allows near-real-time monitoring of the state of the cluster and the services running in it.</span></span> <span data-ttu-id="9ceb8-106">You can easily obtain health information and correct potential issues before they cascade and cause massive outages.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-106">You can easily obtain health information and correct potential issues before they cascade and cause massive outages.</span></span> <span data-ttu-id="9ceb8-107">In the typical model, services send reports based on their local views, and that information is aggregated to provide an overall cluster-level view.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-107">In the typical model, services send reports based on their local views, and that information is aggregated to provide an overall cluster-level view.</span></span>

<span data-ttu-id="9ceb8-108">Service Fabric components use this rich health model to report their current state.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-108">Service Fabric components use this rich health model to report their current state.</span></span> <span data-ttu-id="9ceb8-109">You can use the same mechanism to report health from your applications.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-109">You can use the same mechanism to report health from your applications.</span></span> <span data-ttu-id="9ceb8-110">If you invest in high-quality health reporting that captures your custom conditions, you can detect and fix issues for your running application much more easily.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-110">If you invest in high-quality health reporting that captures your custom conditions, you can detect and fix issues for your running application much more easily.</span></span>

<span data-ttu-id="9ceb8-111">The following Microsoft Virtual Academy video also describes the Service Fabric health model and how it's used: <center><a target="_blank" href="https://mva.microsoft.com/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=tevZw56yC_1906218965"></span><span class="sxs-lookup"><span data-stu-id="9ceb8-111">The following Microsoft Virtual Academy video also describes the Service Fabric health model and how it's used: <center><a target="_blank" href="https://mva.microsoft.com/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=tevZw56yC_1906218965"></span></span>
<img src="https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-fabric/media/service-fabric-health-introduction/HealthIntroVid.png" WIDTH="360" HEIGHT="244">
</a></center>

> [!NOTE]
> <span data-ttu-id="9ceb8-112">We started the health subsystem to address a need for monitored upgrades.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-112">We started the health subsystem to address a need for monitored upgrades.</span></span> <span data-ttu-id="9ceb8-113">Service Fabric provides monitored application and cluster upgrades that ensure full availability, no downtime and minimal to no user intervention.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-113">Service Fabric provides monitored application and cluster upgrades that ensure full availability, no downtime and minimal to no user intervention.</span></span> <span data-ttu-id="9ceb8-114">To achieve these goals, the upgrade checks health based on configured upgrade policies and allows an upgrade to proceed only when health respects desired thresholds.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-114">To achieve these goals, the upgrade checks health based on configured upgrade policies and allows an upgrade to proceed only when health respects desired thresholds.</span></span> <span data-ttu-id="9ceb8-115">Otherwise, the upgrade is either automatically rolled back or paused to give administrators a chance to fix the issues.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-115">Otherwise, the upgrade is either automatically rolled back or paused to give administrators a chance to fix the issues.</span></span> <span data-ttu-id="9ceb8-116">To learn more about application upgrades, see [this article](service-fabric-application-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-116">To learn more about application upgrades, see [this article](service-fabric-application-upgrade.md).</span></span>
> 
> 

## <a name="health-store"></a><span data-ttu-id="9ceb8-117">Health store</span><span class="sxs-lookup"><span data-stu-id="9ceb8-117">Health store</span></span>
<span data-ttu-id="9ceb8-118">The health store keeps health-related information about entities in the cluster for easy retrieval and evaluation.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-118">The health store keeps health-related information about entities in the cluster for easy retrieval and evaluation.</span></span> <span data-ttu-id="9ceb8-119">It is implemented as a Service Fabric persisted stateful service to ensure high availability and scalability.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-119">It is implemented as a Service Fabric persisted stateful service to ensure high availability and scalability.</span></span> <span data-ttu-id="9ceb8-120">The health store is part of the **fabric:/System** application, and it is available when the cluster is up and running.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-120">The health store is part of the **fabric:/System** application, and it is available when the cluster is up and running.</span></span>

## <a name="health-entities-and-hierarchy"></a><span data-ttu-id="9ceb8-121">Health entities and hierarchy</span><span class="sxs-lookup"><span data-stu-id="9ceb8-121">Health entities and hierarchy</span></span>
<span data-ttu-id="9ceb8-122">The health entities are organized in a logical hierarchy that captures interactions and dependencies among different entities.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-122">The health entities are organized in a logical hierarchy that captures interactions and dependencies among different entities.</span></span> <span data-ttu-id="9ceb8-123">The entities and hierarchy are automatically built by the health store based on reports received from Service Fabric components.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-123">The entities and hierarchy are automatically built by the health store based on reports received from Service Fabric components.</span></span>

<span data-ttu-id="9ceb8-124">The health entities mirror the Service Fabric entities.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-124">The health entities mirror the Service Fabric entities.</span></span> <span data-ttu-id="9ceb8-125">(For example, **health application entity** matches an application instance deployed in the cluster, while **health node entity** matches a Service Fabric cluster node.) The health hierarchy captures the interactions of the system entities, and it is the basis for advanced health evaluation.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-125">(For example, **health application entity** matches an application instance deployed in the cluster, while **health node entity** matches a Service Fabric cluster node.) The health hierarchy captures the interactions of the system entities, and it is the basis for advanced health evaluation.</span></span> <span data-ttu-id="9ceb8-126">You can learn about key Service Fabric concepts in [Service Fabric technical overview](service-fabric-technical-overview.md).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-126">You can learn about key Service Fabric concepts in [Service Fabric technical overview](service-fabric-technical-overview.md).</span></span> <span data-ttu-id="9ceb8-127">For more on application, see [Service Fabric application model](service-fabric-application-model.md).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-127">For more on application, see [Service Fabric application model](service-fabric-application-model.md).</span></span>

<span data-ttu-id="9ceb8-128">The health entities and hierarchy allow the cluster and applications to be effectively reported, debugged, and monitored.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-128">The health entities and hierarchy allow the cluster and applications to be effectively reported, debugged, and monitored.</span></span> <span data-ttu-id="9ceb8-129">The health model provides an accurate, *granular* representation of the health of the many moving pieces in the cluster.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-129">The health model provides an accurate, *granular* representation of the health of the many moving pieces in the cluster.</span></span>

<span data-ttu-id="9ceb8-130">![Health entities.][1]</span><span class="sxs-lookup"><span data-stu-id="9ceb8-130">![Health entities.][1]</span></span>
<span data-ttu-id="9ceb8-131">The health entities, organized in a hierarchy based on parent-child relationships.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-131">The health entities, organized in a hierarchy based on parent-child relationships.</span></span>

[1]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-fabric/media/service-fabric-health-introduction/servicefabric-health-hierarchy.png

<span data-ttu-id="9ceb8-132">The health entities are:</span><span class="sxs-lookup"><span data-stu-id="9ceb8-132">The health entities are:</span></span>

* <span data-ttu-id="9ceb8-133">**Cluster**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-133">**Cluster**.</span></span> <span data-ttu-id="9ceb8-134">Represents the health of a Service Fabric cluster.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-134">Represents the health of a Service Fabric cluster.</span></span> <span data-ttu-id="9ceb8-135">Cluster health reports describe conditions that affect the entire cluster and can't be narrowed down to one or more unhealthy children.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-135">Cluster health reports describe conditions that affect the entire cluster and can't be narrowed down to one or more unhealthy children.</span></span> <span data-ttu-id="9ceb8-136">Examples include the brain of the cluster splitting due to network partitioning or communication issues.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-136">Examples include the brain of the cluster splitting due to network partitioning or communication issues.</span></span>
* <span data-ttu-id="9ceb8-137">**Node**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-137">**Node**.</span></span> <span data-ttu-id="9ceb8-138">Represents the health of a Service Fabric node.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-138">Represents the health of a Service Fabric node.</span></span> <span data-ttu-id="9ceb8-139">Node health reports describe conditions that affect the node functionality.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-139">Node health reports describe conditions that affect the node functionality.</span></span> <span data-ttu-id="9ceb8-140">They typically affect all the deployed entities running on it.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-140">They typically affect all the deployed entities running on it.</span></span> <span data-ttu-id="9ceb8-141">Examples include when a node is out of disk space (or another machine-wide property, such as memory, connections) and when a node is down.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-141">Examples include when a node is out of disk space (or another machine-wide property, such as memory, connections) and when a node is down.</span></span> <span data-ttu-id="9ceb8-142">The node entity is identified by the node name (string).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-142">The node entity is identified by the node name (string).</span></span>
* <span data-ttu-id="9ceb8-143">**Application**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-143">**Application**.</span></span> <span data-ttu-id="9ceb8-144">Represents the health of an application instance running in the cluster.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-144">Represents the health of an application instance running in the cluster.</span></span> <span data-ttu-id="9ceb8-145">Application health reports describe conditions that affect the overall health of the application.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-145">Application health reports describe conditions that affect the overall health of the application.</span></span> <span data-ttu-id="9ceb8-146">They can't be narrowed down to individual children (services or deployed applications).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-146">They can't be narrowed down to individual children (services or deployed applications).</span></span> <span data-ttu-id="9ceb8-147">Examples include the end-to-end interaction among different services in the application.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-147">Examples include the end-to-end interaction among different services in the application.</span></span> <span data-ttu-id="9ceb8-148">The application entity is identified by the application name (URI).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-148">The application entity is identified by the application name (URI).</span></span>
* <span data-ttu-id="9ceb8-149">**Service**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-149">**Service**.</span></span> <span data-ttu-id="9ceb8-150">Represents the health of a service running in the cluster.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-150">Represents the health of a service running in the cluster.</span></span> <span data-ttu-id="9ceb8-151">Service health reports describe conditions that affect the overall health of the service, and they can't be narrowed down to a partition or a replica.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-151">Service health reports describe conditions that affect the overall health of the service, and they can't be narrowed down to a partition or a replica.</span></span> <span data-ttu-id="9ceb8-152">Examples include a service configuration (such as port or external file share) that is causing issues for all partitions.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-152">Examples include a service configuration (such as port or external file share) that is causing issues for all partitions.</span></span> <span data-ttu-id="9ceb8-153">The service entity is identified by the service name (URI).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-153">The service entity is identified by the service name (URI).</span></span>
* <span data-ttu-id="9ceb8-154">**Partition**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-154">**Partition**.</span></span> <span data-ttu-id="9ceb8-155">Represents the health of a service partition.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-155">Represents the health of a service partition.</span></span> <span data-ttu-id="9ceb8-156">Partition health reports describe conditions that affect the entire replica set.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-156">Partition health reports describe conditions that affect the entire replica set.</span></span> <span data-ttu-id="9ceb8-157">Examples include when the number of replicas is below target count and when a partition is in quorum loss.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-157">Examples include when the number of replicas is below target count and when a partition is in quorum loss.</span></span> <span data-ttu-id="9ceb8-158">The partition entity is identified by the partition ID (GUID).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-158">The partition entity is identified by the partition ID (GUID).</span></span>
* <span data-ttu-id="9ceb8-159">**Replica**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-159">**Replica**.</span></span> <span data-ttu-id="9ceb8-160">Represents the health of a stateful service replica or a stateless service instance.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-160">Represents the health of a stateful service replica or a stateless service instance.</span></span> <span data-ttu-id="9ceb8-161">The smallest unit that watchdogs and system components can report on for an application.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-161">The smallest unit that watchdogs and system components can report on for an application.</span></span> <span data-ttu-id="9ceb8-162">For stateful services, examples include a primary replica reporting when it can't replicate operations to secondaries and when replication is not proceeding at the expected pace.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-162">For stateful services, examples include a primary replica reporting when it can't replicate operations to secondaries and when replication is not proceeding at the expected pace.</span></span> <span data-ttu-id="9ceb8-163">Also, a stateless instance can report when it is running out of resources or has connectivity issues.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-163">Also, a stateless instance can report when it is running out of resources or has connectivity issues.</span></span> <span data-ttu-id="9ceb8-164">The replica entity is identified by the partition ID (GUID) and the replica or instance ID (long).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-164">The replica entity is identified by the partition ID (GUID) and the replica or instance ID (long).</span></span>
* <span data-ttu-id="9ceb8-165">**DeployedApplication**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-165">**DeployedApplication**.</span></span> <span data-ttu-id="9ceb8-166">Represents the health of an *application running on a node*.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-166">Represents the health of an *application running on a node*.</span></span> <span data-ttu-id="9ceb8-167">Deployed application health reports describe conditions specific to the application on the node that can't be narrowed down to service packages deployed on the same node.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-167">Deployed application health reports describe conditions specific to the application on the node that can't be narrowed down to service packages deployed on the same node.</span></span> <span data-ttu-id="9ceb8-168">Examples include when the application package can't be downloaded on that node and when there is an issue setting up application security principals on the node.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-168">Examples include when the application package can't be downloaded on that node and when there is an issue setting up application security principals on the node.</span></span> <span data-ttu-id="9ceb8-169">The deployed application is identified by application name (URI) and node name (string).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-169">The deployed application is identified by application name (URI) and node name (string).</span></span>
* <span data-ttu-id="9ceb8-170">**DeployedServicePackage**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-170">**DeployedServicePackage**.</span></span> <span data-ttu-id="9ceb8-171">Represents the health of a service package running on a node in the cluster.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-171">Represents the health of a service package running on a node in the cluster.</span></span> <span data-ttu-id="9ceb8-172">It describes conditions specific to a service package that do not affect the other service packages on the same node for the same application.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-172">It describes conditions specific to a service package that do not affect the other service packages on the same node for the same application.</span></span> <span data-ttu-id="9ceb8-173">Examples include a code package in the service package that cannot be started and a configuration package that cannot be read.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-173">Examples include a code package in the service package that cannot be started and a configuration package that cannot be read.</span></span> <span data-ttu-id="9ceb8-174">The deployed service package is identified by application name (URI), node name (string), and service manifest name (string).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-174">The deployed service package is identified by application name (URI), node name (string), and service manifest name (string).</span></span>

<span data-ttu-id="9ceb8-175">The granularity of the health model makes it easy to detect and correct issues.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-175">The granularity of the health model makes it easy to detect and correct issues.</span></span> <span data-ttu-id="9ceb8-176">For example, if a service is not responding, it is feasible to report that the application instance is unhealthy.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-176">For example, if a service is not responding, it is feasible to report that the application instance is unhealthy.</span></span> <span data-ttu-id="9ceb8-177">Reporting at that level is not ideal, however, because the issue might not be affecting all the services within that application.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-177">Reporting at that level is not ideal, however, because the issue might not be affecting all the services within that application.</span></span> <span data-ttu-id="9ceb8-178">The report should be applied to the unhealthy service or to a specific child partition, if more information points to that partition.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-178">The report should be applied to the unhealthy service or to a specific child partition, if more information points to that partition.</span></span> <span data-ttu-id="9ceb8-179">The data automatically surfaces through the hierarchy, and an unhealthy partition is made visible at service and application levels.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-179">The data automatically surfaces through the hierarchy, and an unhealthy partition is made visible at service and application levels.</span></span> <span data-ttu-id="9ceb8-180">This aggregation helps to pinpoint and resolve the root cause of the issue more quickly.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-180">This aggregation helps to pinpoint and resolve the root cause of the issue more quickly.</span></span>

<span data-ttu-id="9ceb8-181">The health hierarchy is composed of parent-child relationships.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-181">The health hierarchy is composed of parent-child relationships.</span></span> <span data-ttu-id="9ceb8-182">A cluster is composed of nodes and applications.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-182">A cluster is composed of nodes and applications.</span></span> <span data-ttu-id="9ceb8-183">Applications have services and deployed applications.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-183">Applications have services and deployed applications.</span></span> <span data-ttu-id="9ceb8-184">Deployed applications have deployed service packages.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-184">Deployed applications have deployed service packages.</span></span> <span data-ttu-id="9ceb8-185">Services have partitions, and each partition has one or more replicas.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-185">Services have partitions, and each partition has one or more replicas.</span></span> <span data-ttu-id="9ceb8-186">There is a special relationship between nodes and deployed entities.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-186">There is a special relationship between nodes and deployed entities.</span></span> <span data-ttu-id="9ceb8-187">If a node is unhealthy as reported by its authority system component (Failover Manager service), it affects the deployed applications, service packages, and replicas deployed on it.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-187">If a node is unhealthy as reported by its authority system component (Failover Manager service), it affects the deployed applications, service packages, and replicas deployed on it.</span></span>

<span data-ttu-id="9ceb8-188">The health hierarchy represents the latest state of the system based on the latest health reports, which is almost real-time information.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-188">The health hierarchy represents the latest state of the system based on the latest health reports, which is almost real-time information.</span></span>
<span data-ttu-id="9ceb8-189">Internal and external watchdogs can report on the same entities based on application-specific logic or custom monitored conditions.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-189">Internal and external watchdogs can report on the same entities based on application-specific logic or custom monitored conditions.</span></span> <span data-ttu-id="9ceb8-190">User reports coexist with the system reports.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-190">User reports coexist with the system reports.</span></span>

<span data-ttu-id="9ceb8-191">Plan to invest in how to report and respond to health during the design of a large cloud service, to make the service easier to debug, monitor, and operate.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-191">Plan to invest in how to report and respond to health during the design of a large cloud service, to make the service easier to debug, monitor, and operate.</span></span>

## <a name="health-states"></a><span data-ttu-id="9ceb8-192">Health states</span><span class="sxs-lookup"><span data-stu-id="9ceb8-192">Health states</span></span>
<span data-ttu-id="9ceb8-193">Service Fabric uses three health states to describe whether an entity is healthy or not: OK, warning, and error.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-193">Service Fabric uses three health states to describe whether an entity is healthy or not: OK, warning, and error.</span></span> <span data-ttu-id="9ceb8-194">Any report sent to the health store must specify one of these states.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-194">Any report sent to the health store must specify one of these states.</span></span> <span data-ttu-id="9ceb8-195">The health evaluation result is one of these states.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-195">The health evaluation result is one of these states.</span></span>

<span data-ttu-id="9ceb8-196">The possible [health states](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthstate) are:</span><span class="sxs-lookup"><span data-stu-id="9ceb8-196">The possible [health states](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthstate) are:</span></span>

* <span data-ttu-id="9ceb8-197">**OK**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-197">**OK**.</span></span> <span data-ttu-id="9ceb8-198">The entity is healthy.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-198">The entity is healthy.</span></span> <span data-ttu-id="9ceb8-199">There are no known issues reported on it or its children (when applicable).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-199">There are no known issues reported on it or its children (when applicable).</span></span>
* <span data-ttu-id="9ceb8-200">**Warning**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-200">**Warning**.</span></span> <span data-ttu-id="9ceb8-201">The entity experiences some issues, but it is not yet unhealthy (for example, there are delays, but they do not cause any functional issues yet).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-201">The entity experiences some issues, but it is not yet unhealthy (for example, there are delays, but they do not cause any functional issues yet).</span></span> <span data-ttu-id="9ceb8-202">In some cases, the warning condition may fix itself without any special intervention, and it is useful to provide visibility into what is going on.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-202">In some cases, the warning condition may fix itself without any special intervention, and it is useful to provide visibility into what is going on.</span></span> <span data-ttu-id="9ceb8-203">In other cases, the warning condition may degrade into a severe problem without user intervention.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-203">In other cases, the warning condition may degrade into a severe problem without user intervention.</span></span>
* <span data-ttu-id="9ceb8-204">**Error**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-204">**Error**.</span></span> <span data-ttu-id="9ceb8-205">The entity is unhealthy.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-205">The entity is unhealthy.</span></span> <span data-ttu-id="9ceb8-206">Action should be taken to fix the state of the entity, because it can't function properly.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-206">Action should be taken to fix the state of the entity, because it can't function properly.</span></span>
* <span data-ttu-id="9ceb8-207">**Unknown**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-207">**Unknown**.</span></span> <span data-ttu-id="9ceb8-208">The entity doesn't exist in the health store.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-208">The entity doesn't exist in the health store.</span></span> <span data-ttu-id="9ceb8-209">This result can be obtained from the distributed queries that merge results from multiple components.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-209">This result can be obtained from the distributed queries that merge results from multiple components.</span></span> <span data-ttu-id="9ceb8-210">For example, get node list query goes to **FailoverManager** and **HealthManager**, get application list query goes to **ClusterManager** and **HealthManager**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-210">For example, get node list query goes to **FailoverManager** and **HealthManager**, get application list query goes to **ClusterManager** and **HealthManager**.</span></span> <span data-ttu-id="9ceb8-211">These queries merge results from multiple system components.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-211">These queries merge results from multiple system components.</span></span> <span data-ttu-id="9ceb8-212">If another system component returns an entity that has not reached or has been cleaned up from the health store, the merged result has unknown health state.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-212">If another system component returns an entity that has not reached or has been cleaned up from the health store, the merged result has unknown health state.</span></span>

## <a name="health-policies"></a><span data-ttu-id="9ceb8-213">Health policies</span><span class="sxs-lookup"><span data-stu-id="9ceb8-213">Health policies</span></span>
<span data-ttu-id="9ceb8-214">The health store applies health policies to determine whether an entity is healthy based on its reports and its children.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-214">The health store applies health policies to determine whether an entity is healthy based on its reports and its children.</span></span>

> [!NOTE]
> <span data-ttu-id="9ceb8-215">Health policies can be specified in the cluster manifest (for cluster and node health evaluation) or in the application manifest (for application evaluation and any of its children).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-215">Health policies can be specified in the cluster manifest (for cluster and node health evaluation) or in the application manifest (for application evaluation and any of its children).</span></span> <span data-ttu-id="9ceb8-216">Health evaluation requests can also pass in custom health evaluation policies, which is used only for that evaluation.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-216">Health evaluation requests can also pass in custom health evaluation policies, which is used only for that evaluation.</span></span>
> 
> 

<span data-ttu-id="9ceb8-217">By default, Service Fabric applies strict rules (everything must be healthy) for the parent-child hierarchical relationship.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-217">By default, Service Fabric applies strict rules (everything must be healthy) for the parent-child hierarchical relationship.</span></span> <span data-ttu-id="9ceb8-218">If even one of the children has one unhealthy event, the parent is considered unhealthy.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-218">If even one of the children has one unhealthy event, the parent is considered unhealthy.</span></span>

### <a name="cluster-health-policy"></a><span data-ttu-id="9ceb8-219">Cluster health policy</span><span class="sxs-lookup"><span data-stu-id="9ceb8-219">Cluster health policy</span></span>
<span data-ttu-id="9ceb8-220">The [cluster health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy) is used to evaluate the cluster health state and node health states.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-220">The [cluster health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy) is used to evaluate the cluster health state and node health states.</span></span> <span data-ttu-id="9ceb8-221">The policy can be defined in the cluster manifest.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-221">The policy can be defined in the cluster manifest.</span></span> <span data-ttu-id="9ceb8-222">If it is not present, the default policy (zero tolerated failures) is used.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-222">If it is not present, the default policy (zero tolerated failures) is used.</span></span>
<span data-ttu-id="9ceb8-223">The cluster health policy contains:</span><span class="sxs-lookup"><span data-stu-id="9ceb8-223">The cluster health policy contains:</span></span>

* <span data-ttu-id="9ceb8-224">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.considerwarningaserror).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-224">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.considerwarningaserror).</span></span> <span data-ttu-id="9ceb8-225">Specifies whether to treat warning health reports as errors during health evaluation.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-225">Specifies whether to treat warning health reports as errors during health evaluation.</span></span> <span data-ttu-id="9ceb8-226">Default: false.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-226">Default: false.</span></span>
* <span data-ttu-id="9ceb8-227">[MaxPercentUnhealthyApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthyapplications).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-227">[MaxPercentUnhealthyApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthyapplications).</span></span> <span data-ttu-id="9ceb8-228">Specifies the maximum tolerated percentage of applications that can be unhealthy before the cluster is considered in error.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-228">Specifies the maximum tolerated percentage of applications that can be unhealthy before the cluster is considered in error.</span></span>
* <span data-ttu-id="9ceb8-229">[MaxPercentUnhealthyNodes](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthynodes).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-229">[MaxPercentUnhealthyNodes](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthynodes).</span></span> <span data-ttu-id="9ceb8-230">Specifies the maximum tolerated percentage of nodes that can be unhealthy before the cluster is considered in error.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-230">Specifies the maximum tolerated percentage of nodes that can be unhealthy before the cluster is considered in error.</span></span> <span data-ttu-id="9ceb8-231">In large clusters, some nodes are always down or out for repairs, so this percentage should be configured to tolerate that.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-231">In large clusters, some nodes are always down or out for repairs, so this percentage should be configured to tolerate that.</span></span>
* <span data-ttu-id="9ceb8-232">[ApplicationTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.applicationtypehealthpolicymap).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-232">[ApplicationTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.applicationtypehealthpolicymap).</span></span> <span data-ttu-id="9ceb8-233">The application type health policy map can be used during cluster health evaluation to describe special application types.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-233">The application type health policy map can be used during cluster health evaluation to describe special application types.</span></span> <span data-ttu-id="9ceb8-234">By default, all applications are put into a pool and evaluated with MaxPercentUnhealthyApplications.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-234">By default, all applications are put into a pool and evaluated with MaxPercentUnhealthyApplications.</span></span> <span data-ttu-id="9ceb8-235">If some application types should be treated differently, they can be taken out of the global pool.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-235">If some application types should be treated differently, they can be taken out of the global pool.</span></span> <span data-ttu-id="9ceb8-236">Instead, they are evaluated against the percentages associated with their application type name in the map.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-236">Instead, they are evaluated against the percentages associated with their application type name in the map.</span></span> <span data-ttu-id="9ceb8-237">For example, in a cluster there are thousands of applications of different types, and a few control application instances of a special application type.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-237">For example, in a cluster there are thousands of applications of different types, and a few control application instances of a special application type.</span></span> <span data-ttu-id="9ceb8-238">The control applications should never be in error.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-238">The control applications should never be in error.</span></span> <span data-ttu-id="9ceb8-239">You can specify global MaxPercentUnhealthyApplications to 20% to tolerate some failures, but for the application type "ControlApplicationType" set the MaxPercentUnhealthyApplications to 0.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-239">You can specify global MaxPercentUnhealthyApplications to 20% to tolerate some failures, but for the application type "ControlApplicationType" set the MaxPercentUnhealthyApplications to 0.</span></span> <span data-ttu-id="9ceb8-240">This way, if some of the many applications are unhealthy, but below the global unhealthy percentage, the cluster would be evaluated to Warning.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-240">This way, if some of the many applications are unhealthy, but below the global unhealthy percentage, the cluster would be evaluated to Warning.</span></span> <span data-ttu-id="9ceb8-241">A warning health state does not impact cluster upgrade or other monitoring triggered by Error health state.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-241">A warning health state does not impact cluster upgrade or other monitoring triggered by Error health state.</span></span> <span data-ttu-id="9ceb8-242">But even one control application in error would make cluster unhealthy, which triggers roll back or pauses the cluster upgrade, depending on the upgrade configuration.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-242">But even one control application in error would make cluster unhealthy, which triggers roll back or pauses the cluster upgrade, depending on the upgrade configuration.</span></span>
  <span data-ttu-id="9ceb8-243">For the application types defined in the map, all application instances are taken out of the global pool of applications.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-243">For the application types defined in the map, all application instances are taken out of the global pool of applications.</span></span> <span data-ttu-id="9ceb8-244">They are evaluated based on the total number of applications of the application type, using the specific MaxPercentUnhealthyApplications from the map.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-244">They are evaluated based on the total number of applications of the application type, using the specific MaxPercentUnhealthyApplications from the map.</span></span> <span data-ttu-id="9ceb8-245">All the rest of the applications remain in the global pool and are evaluated with MaxPercentUnhealthyApplications.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-245">All the rest of the applications remain in the global pool and are evaluated with MaxPercentUnhealthyApplications.</span></span>

<span data-ttu-id="9ceb8-246">The following example is an excerpt from a cluster manifest.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-246">The following example is an excerpt from a cluster manifest.</span></span> <span data-ttu-id="9ceb8-247">To define entries in the application type map, prefix the parameter name with "ApplicationTypeMaxPercentUnhealthyApplications-", followed by the application type name.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-247">To define entries in the application type map, prefix the parameter name with "ApplicationTypeMaxPercentUnhealthyApplications-", followed by the application type name.</span></span>

```xml
<FabricSettings>
  <Section Name="HealthManager/ClusterHealthPolicy">
    <Parameter Name="ConsiderWarningAsError" Value="False" />
    <Parameter Name="MaxPercentUnhealthyApplications" Value="20" />
    <Parameter Name="MaxPercentUnhealthyNodes" Value="20" />
    <Parameter Name="ApplicationTypeMaxPercentUnhealthyApplications-ControlApplicationType" Value="0" />
  </Section>
</FabricSettings>
```

### <a name="application-health-policy"></a><span data-ttu-id="9ceb8-248">Application health policy</span><span class="sxs-lookup"><span data-stu-id="9ceb8-248">Application health policy</span></span>
<span data-ttu-id="9ceb8-249">The [application health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy) describes how the evaluation of events and child-states aggregation is done for applications and their children.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-249">The [application health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy) describes how the evaluation of events and child-states aggregation is done for applications and their children.</span></span> <span data-ttu-id="9ceb8-250">It can be defined in the application manifest, **ApplicationManifest.xml**, in the application package.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-250">It can be defined in the application manifest, **ApplicationManifest.xml**, in the application package.</span></span> <span data-ttu-id="9ceb8-251">If no policies are specified, Service Fabric assumes that the entity is unhealthy if it has a health report or a child at the warning or error health state.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-251">If no policies are specified, Service Fabric assumes that the entity is unhealthy if it has a health report or a child at the warning or error health state.</span></span>
<span data-ttu-id="9ceb8-252">The configurable policies are:</span><span class="sxs-lookup"><span data-stu-id="9ceb8-252">The configurable policies are:</span></span>

* <span data-ttu-id="9ceb8-253">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.considerwarningaserror.aspx).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-253">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.considerwarningaserror.aspx).</span></span> <span data-ttu-id="9ceb8-254">Specifies whether to treat warning health reports as errors during health evaluation.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-254">Specifies whether to treat warning health reports as errors during health evaluation.</span></span> <span data-ttu-id="9ceb8-255">Default: false.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-255">Default: false.</span></span>
* <span data-ttu-id="9ceb8-256">[MaxPercentUnhealthyDeployedApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.maxpercentunhealthydeployedapplications).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-256">[MaxPercentUnhealthyDeployedApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.maxpercentunhealthydeployedapplications).</span></span> <span data-ttu-id="9ceb8-257">Specifies the maximum tolerated percentage of deployed applications that can be unhealthy before the application is considered in error.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-257">Specifies the maximum tolerated percentage of deployed applications that can be unhealthy before the application is considered in error.</span></span> <span data-ttu-id="9ceb8-258">This percentage is calculated by dividing the number of unhealthy deployed applications over the number of nodes that the applications are currently deployed on in the cluster.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-258">This percentage is calculated by dividing the number of unhealthy deployed applications over the number of nodes that the applications are currently deployed on in the cluster.</span></span> <span data-ttu-id="9ceb8-259">The computation rounds up to tolerate one failure on small numbers of nodes.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-259">The computation rounds up to tolerate one failure on small numbers of nodes.</span></span> <span data-ttu-id="9ceb8-260">Default percentage: zero.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-260">Default percentage: zero.</span></span>
* <span data-ttu-id="9ceb8-261">[DefaultServiceTypeHealthPolicy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.defaultservicetypehealthpolicy).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-261">[DefaultServiceTypeHealthPolicy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.defaultservicetypehealthpolicy).</span></span> <span data-ttu-id="9ceb8-262">Specifies the default service type health policy, which replaces the default health policy for all service types in the application.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-262">Specifies the default service type health policy, which replaces the default health policy for all service types in the application.</span></span>
* <span data-ttu-id="9ceb8-263">[ServiceTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.servicetypehealthpolicymap).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-263">[ServiceTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.servicetypehealthpolicymap).</span></span> <span data-ttu-id="9ceb8-264">Provides a map of service health policies per service type.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-264">Provides a map of service health policies per service type.</span></span> <span data-ttu-id="9ceb8-265">These policies replace the default service type health policies for each specified service type.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-265">These policies replace the default service type health policies for each specified service type.</span></span> <span data-ttu-id="9ceb8-266">For example, if an application has a stateless gateway service type and a stateful engine service type, you can configure the health policies for their evaluation differently.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-266">For example, if an application has a stateless gateway service type and a stateful engine service type, you can configure the health policies for their evaluation differently.</span></span> <span data-ttu-id="9ceb8-267">When you specify policy per service type, you can gain more granular control of the health of the service.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-267">When you specify policy per service type, you can gain more granular control of the health of the service.</span></span>

### <a name="service-type-health-policy"></a><span data-ttu-id="9ceb8-268">Service type health policy</span><span class="sxs-lookup"><span data-stu-id="9ceb8-268">Service type health policy</span></span>
<span data-ttu-id="9ceb8-269">The [service type health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy) specifies how to evaluate and aggregate the services and the children of services.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-269">The [service type health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy) specifies how to evaluate and aggregate the services and the children of services.</span></span> <span data-ttu-id="9ceb8-270">The policy contains:</span><span class="sxs-lookup"><span data-stu-id="9ceb8-270">The policy contains:</span></span>

* <span data-ttu-id="9ceb8-271">[MaxPercentUnhealthyPartitionsPerService](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthypartitionsperservice).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-271">[MaxPercentUnhealthyPartitionsPerService](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthypartitionsperservice).</span></span> <span data-ttu-id="9ceb8-272">Specifies the maximum tolerated percentage of unhealthy partitions before a service is considered unhealthy.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-272">Specifies the maximum tolerated percentage of unhealthy partitions before a service is considered unhealthy.</span></span> <span data-ttu-id="9ceb8-273">Default percentage: zero.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-273">Default percentage: zero.</span></span>
* <span data-ttu-id="9ceb8-274">[MaxPercentUnhealthyReplicasPerPartition](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyreplicasperpartition).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-274">[MaxPercentUnhealthyReplicasPerPartition](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyreplicasperpartition).</span></span> <span data-ttu-id="9ceb8-275">Specifies the maximum tolerated percentage of unhealthy replicas before a partition is considered unhealthy.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-275">Specifies the maximum tolerated percentage of unhealthy replicas before a partition is considered unhealthy.</span></span> <span data-ttu-id="9ceb8-276">Default percentage: zero.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-276">Default percentage: zero.</span></span>
* <span data-ttu-id="9ceb8-277">[MaxPercentUnhealthyServices](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyservices).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-277">[MaxPercentUnhealthyServices](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyservices).</span></span> <span data-ttu-id="9ceb8-278">Specifies the maximum tolerated percentage of unhealthy services before the application is considered unhealthy.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-278">Specifies the maximum tolerated percentage of unhealthy services before the application is considered unhealthy.</span></span> <span data-ttu-id="9ceb8-279">Default percentage: zero.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-279">Default percentage: zero.</span></span>

<span data-ttu-id="9ceb8-280">The following example is an excerpt from an application manifest:</span><span class="sxs-lookup"><span data-stu-id="9ceb8-280">The following example is an excerpt from an application manifest:</span></span>

```xml
    <Policies>
        <HealthPolicy ConsiderWarningAsError="true" MaxPercentUnhealthyDeployedApplications="20">
            <DefaultServiceTypeHealthPolicy
                   MaxPercentUnhealthyServices="0"
                   MaxPercentUnhealthyPartitionsPerService="10"
                   MaxPercentUnhealthyReplicasPerPartition="0"/>
            <ServiceTypeHealthPolicy ServiceTypeName="FrontEndServiceType"
                   MaxPercentUnhealthyServices="0"
                   MaxPercentUnhealthyPartitionsPerService="20"
                   MaxPercentUnhealthyReplicasPerPartition="0"/>
            <ServiceTypeHealthPolicy ServiceTypeName="BackEndServiceType"
                   MaxPercentUnhealthyServices="20"
                   MaxPercentUnhealthyPartitionsPerService="0"
                   MaxPercentUnhealthyReplicasPerPartition="0">
            </ServiceTypeHealthPolicy>
        </HealthPolicy>
    </Policies>
```

## <a name="health-evaluation"></a><span data-ttu-id="9ceb8-281">Health evaluation</span><span class="sxs-lookup"><span data-stu-id="9ceb8-281">Health evaluation</span></span>
<span data-ttu-id="9ceb8-282">Users and automated services can evaluate health for any entity at any time.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-282">Users and automated services can evaluate health for any entity at any time.</span></span> <span data-ttu-id="9ceb8-283">To evaluate an entity's health, the health store aggregates all health reports on the entity and evaluates all its children (when applicable).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-283">To evaluate an entity's health, the health store aggregates all health reports on the entity and evaluates all its children (when applicable).</span></span> <span data-ttu-id="9ceb8-284">The health aggregation algorithm uses health policies that specify how to evaluate health reports and how to aggregate child health states (when applicable).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-284">The health aggregation algorithm uses health policies that specify how to evaluate health reports and how to aggregate child health states (when applicable).</span></span>

### <a name="health-report-aggregation"></a><span data-ttu-id="9ceb8-285">Health report aggregation</span><span class="sxs-lookup"><span data-stu-id="9ceb8-285">Health report aggregation</span></span>
<span data-ttu-id="9ceb8-286">One entity can have multiple health reports sent by different reporters (system components or watchdogs) on different properties.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-286">One entity can have multiple health reports sent by different reporters (system components or watchdogs) on different properties.</span></span> <span data-ttu-id="9ceb8-287">The aggregation uses the associated health policies, in particular the ConsiderWarningAsError member of application or cluster health policy.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-287">The aggregation uses the associated health policies, in particular the ConsiderWarningAsError member of application or cluster health policy.</span></span> <span data-ttu-id="9ceb8-288">ConsiderWarningAsError specifies how to evaluate warnings.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-288">ConsiderWarningAsError specifies how to evaluate warnings.</span></span>

<span data-ttu-id="9ceb8-289">The aggregated health state is triggered by the *worst* health reports on the entity.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-289">The aggregated health state is triggered by the *worst* health reports on the entity.</span></span> <span data-ttu-id="9ceb8-290">If there is at least one error health report, the aggregated health state is an error.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-290">If there is at least one error health report, the aggregated health state is an error.</span></span>

![Health report aggregation with error report.][2]

<span data-ttu-id="9ceb8-292">A health entity that has one or more error health reports is evaluated as Error.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-292">A health entity that has one or more error health reports is evaluated as Error.</span></span> <span data-ttu-id="9ceb8-293">The same is true for an expired health report, regardless of its health state.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-293">The same is true for an expired health report, regardless of its health state.</span></span>

[2]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-fabric/media/service-fabric-health-introduction/servicefabric-health-report-eval-error.png

<span data-ttu-id="9ceb8-294">If there are no error reports and one or more warnings, the aggregated health state is either warning or error, depending on the ConsiderWarningAsError policy flag.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-294">If there are no error reports and one or more warnings, the aggregated health state is either warning or error, depending on the ConsiderWarningAsError policy flag.</span></span>

![Health report aggregation with warning report and ConsiderWarningAsError false.][3]

<span data-ttu-id="9ceb8-296">Health report aggregation with warning report and ConsiderWarningAsError set to false (default).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-296">Health report aggregation with warning report and ConsiderWarningAsError set to false (default).</span></span>

[3]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-fabric/media/service-fabric-health-introduction/servicefabric-health-report-eval-warning.png

### <a name="child-health-aggregation"></a><span data-ttu-id="9ceb8-297">Child health aggregation</span><span class="sxs-lookup"><span data-stu-id="9ceb8-297">Child health aggregation</span></span>
<span data-ttu-id="9ceb8-298">The aggregated health state of an entity reflects the child health states (when applicable).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-298">The aggregated health state of an entity reflects the child health states (when applicable).</span></span> <span data-ttu-id="9ceb8-299">The algorithm for aggregating child health states uses the health policies applicable based on the entity type.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-299">The algorithm for aggregating child health states uses the health policies applicable based on the entity type.</span></span>

![Child entities health aggregation.][4]

<span data-ttu-id="9ceb8-301">Child aggregation based on health policies.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-301">Child aggregation based on health policies.</span></span>

[4]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-fabric/media/service-fabric-health-introduction/servicefabric-health-hierarchy-eval.png

<span data-ttu-id="9ceb8-302">After the health store has evaluated all the children, it aggregates their health states based on the configured maximum percentage of unhealthy children.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-302">After the health store has evaluated all the children, it aggregates their health states based on the configured maximum percentage of unhealthy children.</span></span> <span data-ttu-id="9ceb8-303">This percentage is taken from the policy based on the entity and child type.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-303">This percentage is taken from the policy based on the entity and child type.</span></span>

* <span data-ttu-id="9ceb8-304">If all children have OK states, the child aggregated health state is OK.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-304">If all children have OK states, the child aggregated health state is OK.</span></span>
* <span data-ttu-id="9ceb8-305">If children have both OK and warning states, the child aggregated health state is warning.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-305">If children have both OK and warning states, the child aggregated health state is warning.</span></span>
* <span data-ttu-id="9ceb8-306">If there are children with error states that do not respect the maximum allowed percentage of unhealthy children, the aggregated health state is an error.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-306">If there are children with error states that do not respect the maximum allowed percentage of unhealthy children, the aggregated health state is an error.</span></span>
* <span data-ttu-id="9ceb8-307">If the children with error states respect the maximum allowed percentage of unhealthy children, the aggregated health state is warning.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-307">If the children with error states respect the maximum allowed percentage of unhealthy children, the aggregated health state is warning.</span></span>

## <a name="health-reporting"></a><span data-ttu-id="9ceb8-308">Health reporting</span><span class="sxs-lookup"><span data-stu-id="9ceb8-308">Health reporting</span></span>
<span data-ttu-id="9ceb8-309">System components, System Fabric applications, and internal/external watchdogs can report against Service Fabric entities.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-309">System components, System Fabric applications, and internal/external watchdogs can report against Service Fabric entities.</span></span> <span data-ttu-id="9ceb8-310">The reporters make *local* determinations of the health of the monitored entities, based on the conditions they are monitoring.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-310">The reporters make *local* determinations of the health of the monitored entities, based on the conditions they are monitoring.</span></span> <span data-ttu-id="9ceb8-311">They don't need to look at any global state or aggregate data.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-311">They don't need to look at any global state or aggregate data.</span></span> <span data-ttu-id="9ceb8-312">The desired behavior is to have simple reporters, and not complex organisms that need to look at many things to infer what information to send.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-312">The desired behavior is to have simple reporters, and not complex organisms that need to look at many things to infer what information to send.</span></span>

<span data-ttu-id="9ceb8-313">To send health data to the health store, a reporter needs to identify the affected entity and create a health report.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-313">To send health data to the health store, a reporter needs to identify the affected entity and create a health report.</span></span> <span data-ttu-id="9ceb8-314">The report can then be sent through the API by using [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-314">The report can then be sent through the API by using [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span></span>

### <a name="health-reports"></a><span data-ttu-id="9ceb8-315">Health reports</span><span class="sxs-lookup"><span data-stu-id="9ceb8-315">Health reports</span></span>
<span data-ttu-id="9ceb8-316">The [health reports](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthreport) for each of the entities in the cluster contain the following information:</span><span class="sxs-lookup"><span data-stu-id="9ceb8-316">The [health reports](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthreport) for each of the entities in the cluster contain the following information:</span></span>

* <span data-ttu-id="9ceb8-317">**SourceId**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-317">**SourceId**.</span></span> <span data-ttu-id="9ceb8-318">A string that uniquely identifies the reporter of the health event.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-318">A string that uniquely identifies the reporter of the health event.</span></span>
* <span data-ttu-id="9ceb8-319">**Entity identifier**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-319">**Entity identifier**.</span></span> <span data-ttu-id="9ceb8-320">Identifies the entity where the report is applied.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-320">Identifies the entity where the report is applied.</span></span> <span data-ttu-id="9ceb8-321">It differs based on the [entity type](service-fabric-health-introduction.md#health-entities-and-hierarchy):</span><span class="sxs-lookup"><span data-stu-id="9ceb8-321">It differs based on the [entity type](service-fabric-health-introduction.md#health-entities-and-hierarchy):</span></span>
  
  * <span data-ttu-id="9ceb8-322">Cluster.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-322">Cluster.</span></span> <span data-ttu-id="9ceb8-323">None.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-323">None.</span></span>
  * <span data-ttu-id="9ceb8-324">Node.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-324">Node.</span></span> <span data-ttu-id="9ceb8-325">Node name  (string).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-325">Node name  (string).</span></span>
  * <span data-ttu-id="9ceb8-326">Application.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-326">Application.</span></span> <span data-ttu-id="9ceb8-327">Application name (URI).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-327">Application name (URI).</span></span> <span data-ttu-id="9ceb8-328">Represents the name of the application instance deployed in the cluster.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-328">Represents the name of the application instance deployed in the cluster.</span></span>
  * <span data-ttu-id="9ceb8-329">Service.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-329">Service.</span></span> <span data-ttu-id="9ceb8-330">Service name (URI).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-330">Service name (URI).</span></span> <span data-ttu-id="9ceb8-331">Represents the name of the service instance deployed in the cluster.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-331">Represents the name of the service instance deployed in the cluster.</span></span>
  * <span data-ttu-id="9ceb8-332">Partition.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-332">Partition.</span></span> <span data-ttu-id="9ceb8-333">Partition ID (GUID).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-333">Partition ID (GUID).</span></span> <span data-ttu-id="9ceb8-334">Represents the partition unique identifier.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-334">Represents the partition unique identifier.</span></span>
  * <span data-ttu-id="9ceb8-335">Replica.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-335">Replica.</span></span> <span data-ttu-id="9ceb8-336">The stateful service replica ID or the stateless service instance ID (INT64).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-336">The stateful service replica ID or the stateless service instance ID (INT64).</span></span>
  * <span data-ttu-id="9ceb8-337">DeployedApplication.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-337">DeployedApplication.</span></span> <span data-ttu-id="9ceb8-338">Application name (URI) and node name (string).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-338">Application name (URI) and node name (string).</span></span>
  * <span data-ttu-id="9ceb8-339">DeployedServicePackage.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-339">DeployedServicePackage.</span></span> <span data-ttu-id="9ceb8-340">Application name (URI), node name (string), and service manifest name (string).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-340">Application name (URI), node name (string), and service manifest name (string).</span></span>
* <span data-ttu-id="9ceb8-341">**Property**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-341">**Property**.</span></span> <span data-ttu-id="9ceb8-342">A *string* (not a fixed enumeration) that allows the reporter to categorize the health event for a specific property of the entity.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-342">A *string* (not a fixed enumeration) that allows the reporter to categorize the health event for a specific property of the entity.</span></span> <span data-ttu-id="9ceb8-343">For example, reporter A can report the health of the Node01 "storage" property and reporter B can report the health of the Node01 "connectivity" property.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-343">For example, reporter A can report the health of the Node01 "storage" property and reporter B can report the health of the Node01 "connectivity" property.</span></span> <span data-ttu-id="9ceb8-344">In the health store, these reports are treated as separate health events for the Node01 entity.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-344">In the health store, these reports are treated as separate health events for the Node01 entity.</span></span>
* <span data-ttu-id="9ceb8-345">**Description**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-345">**Description**.</span></span> <span data-ttu-id="9ceb8-346">A string that allows a reporter to provide detailed information about the health event.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-346">A string that allows a reporter to provide detailed information about the health event.</span></span> <span data-ttu-id="9ceb8-347">**SourceId**, **Property**, and **HealthState** should fully describe the report.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-347">**SourceId**, **Property**, and **HealthState** should fully describe the report.</span></span> <span data-ttu-id="9ceb8-348">The description adds human-readable information about the report.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-348">The description adds human-readable information about the report.</span></span> <span data-ttu-id="9ceb8-349">The text makes it easier for administrators and users to understand the health report.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-349">The text makes it easier for administrators and users to understand the health report.</span></span>
* <span data-ttu-id="9ceb8-350">**HealthState**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-350">**HealthState**.</span></span> <span data-ttu-id="9ceb8-351">An [enumeration](service-fabric-health-introduction.md#health-states) that describes the health state of the report.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-351">An [enumeration](service-fabric-health-introduction.md#health-states) that describes the health state of the report.</span></span> <span data-ttu-id="9ceb8-352">The accepted values are OK, Warning, and Error.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-352">The accepted values are OK, Warning, and Error.</span></span>
* <span data-ttu-id="9ceb8-353">**TimeToLive**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-353">**TimeToLive**.</span></span> <span data-ttu-id="9ceb8-354">A timespan that indicates how long the health report is valid.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-354">A timespan that indicates how long the health report is valid.</span></span> <span data-ttu-id="9ceb8-355">Coupled with **RemoveWhenExpired**, it lets the health store know how to evaluate expired events.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-355">Coupled with **RemoveWhenExpired**, it lets the health store know how to evaluate expired events.</span></span> <span data-ttu-id="9ceb8-356">By default, the value is infinite, and the report is valid forever.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-356">By default, the value is infinite, and the report is valid forever.</span></span>
* <span data-ttu-id="9ceb8-357">**RemoveWhenExpired**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-357">**RemoveWhenExpired**.</span></span> <span data-ttu-id="9ceb8-358">A Boolean.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-358">A Boolean.</span></span> <span data-ttu-id="9ceb8-359">If set to true, the expired health report is automatically removed from the health store, and the report doesn't impact entity health evaluation.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-359">If set to true, the expired health report is automatically removed from the health store, and the report doesn't impact entity health evaluation.</span></span> <span data-ttu-id="9ceb8-360">Used when the report is valid for a specified period of time only, and the reporter doesn't need to explicitly clear it out. It's also used to delete reports from the health store (for example, a watchdog is changed and stops sending reports with previous source and property).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-360">Used when the report is valid for a specified period of time only, and the reporter doesn't need to explicitly clear it out. It's also used to delete reports from the health store (for example, a watchdog is changed and stops sending reports with previous source and property).</span></span> <span data-ttu-id="9ceb8-361">It can send a report with a brief TimeToLive along with RemoveWhenExpired to clear up any previous state from the health store.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-361">It can send a report with a brief TimeToLive along with RemoveWhenExpired to clear up any previous state from the health store.</span></span> <span data-ttu-id="9ceb8-362">If the value is set to false, the expired report is treated as an error on the health evaluation.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-362">If the value is set to false, the expired report is treated as an error on the health evaluation.</span></span> <span data-ttu-id="9ceb8-363">The false value signals to the health store that the source should report periodically on this property.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-363">The false value signals to the health store that the source should report periodically on this property.</span></span> <span data-ttu-id="9ceb8-364">If it doesn't, then there must be something wrong with the watchdog.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-364">If it doesn't, then there must be something wrong with the watchdog.</span></span> <span data-ttu-id="9ceb8-365">The watchdog's health is captured by considering the event as an error.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-365">The watchdog's health is captured by considering the event as an error.</span></span>
* <span data-ttu-id="9ceb8-366">**SequenceNumber**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-366">**SequenceNumber**.</span></span> <span data-ttu-id="9ceb8-367">A positive integer that needs to be ever-increasing, it represents the order of the reports.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-367">A positive integer that needs to be ever-increasing, it represents the order of the reports.</span></span> <span data-ttu-id="9ceb8-368">It is used by the health store to detect stale reports that are received late because of network delays or other issues.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-368">It is used by the health store to detect stale reports that are received late because of network delays or other issues.</span></span> <span data-ttu-id="9ceb8-369">A report is rejected if the sequence number is less than or equal to the most recently applied number for the same entity, source, and property.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-369">A report is rejected if the sequence number is less than or equal to the most recently applied number for the same entity, source, and property.</span></span> <span data-ttu-id="9ceb8-370">If it is not specified, the sequence number is generated automatically.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-370">If it is not specified, the sequence number is generated automatically.</span></span> <span data-ttu-id="9ceb8-371">It is necessary to put in the sequence number only when reporting on state transitions.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-371">It is necessary to put in the sequence number only when reporting on state transitions.</span></span> <span data-ttu-id="9ceb8-372">In this situation, the source needs to remember which reports it sent and keep the information for recovery on failover.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-372">In this situation, the source needs to remember which reports it sent and keep the information for recovery on failover.</span></span>

<span data-ttu-id="9ceb8-373">These four pieces of information--SourceId, entity identifier, Property, and HealthState--are required for every health report.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-373">These four pieces of information--SourceId, entity identifier, Property, and HealthState--are required for every health report.</span></span> <span data-ttu-id="9ceb8-374">The SourceId string is not allowed to start with the prefix "**System.**", which is reserved for system reports.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-374">The SourceId string is not allowed to start with the prefix "**System.**", which is reserved for system reports.</span></span> <span data-ttu-id="9ceb8-375">For the same entity, there is only one report for the same source and property.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-375">For the same entity, there is only one report for the same source and property.</span></span> <span data-ttu-id="9ceb8-376">Multiple reports for the same source and property override each other, either on the health client side (if they are batched) or on the health store side.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-376">Multiple reports for the same source and property override each other, either on the health client side (if they are batched) or on the health store side.</span></span> <span data-ttu-id="9ceb8-377">The replacement is based on sequence numbers; newer reports (with higher sequence numbers) replace older reports.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-377">The replacement is based on sequence numbers; newer reports (with higher sequence numbers) replace older reports.</span></span>

### <a name="health-events"></a><span data-ttu-id="9ceb8-378">Health events</span><span class="sxs-lookup"><span data-stu-id="9ceb8-378">Health events</span></span>
<span data-ttu-id="9ceb8-379">Internally, the health store keeps [health events](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthevent), which contain all the information from the reports, and additional metadata.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-379">Internally, the health store keeps [health events](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthevent), which contain all the information from the reports, and additional metadata.</span></span> <span data-ttu-id="9ceb8-380">The metadata includes the time the report was given to the health client and the time it was modified on the server side.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-380">The metadata includes the time the report was given to the health client and the time it was modified on the server side.</span></span> <span data-ttu-id="9ceb8-381">The health events are returned by [health queries](service-fabric-view-entities-aggregated-health.md#health-queries).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-381">The health events are returned by [health queries](service-fabric-view-entities-aggregated-health.md#health-queries).</span></span>

<span data-ttu-id="9ceb8-382">The added metadata contains:</span><span class="sxs-lookup"><span data-stu-id="9ceb8-382">The added metadata contains:</span></span>

* <span data-ttu-id="9ceb8-383">**SourceUtcTimestamp**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-383">**SourceUtcTimestamp**.</span></span> <span data-ttu-id="9ceb8-384">The time the report was given to the health client (Coordinated Universal Time).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-384">The time the report was given to the health client (Coordinated Universal Time).</span></span>
* <span data-ttu-id="9ceb8-385">**LastModifiedUtcTimestamp**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-385">**LastModifiedUtcTimestamp**.</span></span> <span data-ttu-id="9ceb8-386">The time the report was last modified on the server side (Coordinated Universal Time).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-386">The time the report was last modified on the server side (Coordinated Universal Time).</span></span>
* <span data-ttu-id="9ceb8-387">**IsExpired**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-387">**IsExpired**.</span></span> <span data-ttu-id="9ceb8-388">A flag to indicate whether the report was expired when the query was executed by the health store.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-388">A flag to indicate whether the report was expired when the query was executed by the health store.</span></span> <span data-ttu-id="9ceb8-389">An event can be expired only if RemoveWhenExpired is false.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-389">An event can be expired only if RemoveWhenExpired is false.</span></span> <span data-ttu-id="9ceb8-390">Otherwise, the event is not returned by query and is removed from the store.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-390">Otherwise, the event is not returned by query and is removed from the store.</span></span>
* <span data-ttu-id="9ceb8-391">**LastOkTransitionAt**, **LastWarningTransitionAt**, **LastErrorTransitionAt**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-391">**LastOkTransitionAt**, **LastWarningTransitionAt**, **LastErrorTransitionAt**.</span></span> <span data-ttu-id="9ceb8-392">The last time for OK/warning/error transitions.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-392">The last time for OK/warning/error transitions.</span></span> <span data-ttu-id="9ceb8-393">These fields give the history of the health state transitions for the event.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-393">These fields give the history of the health state transitions for the event.</span></span>

<span data-ttu-id="9ceb8-394">The state transition fields can be used for smarter alerts or "historical" health event information.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-394">The state transition fields can be used for smarter alerts or "historical" health event information.</span></span> <span data-ttu-id="9ceb8-395">They enable scenarios such as:</span><span class="sxs-lookup"><span data-stu-id="9ceb8-395">They enable scenarios such as:</span></span>

* <span data-ttu-id="9ceb8-396">Alert when a property has been at warning/error for more than X minutes.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-396">Alert when a property has been at warning/error for more than X minutes.</span></span> <span data-ttu-id="9ceb8-397">Checking the condition for a period of time avoids alerts on temporary conditions.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-397">Checking the condition for a period of time avoids alerts on temporary conditions.</span></span> <span data-ttu-id="9ceb8-398">For example, an alert if the health state has been warning for more than five minutes can be translated into (HealthState == Warning and Now - LastWarningTransitionTime > 5 minutes).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-398">For example, an alert if the health state has been warning for more than five minutes can be translated into (HealthState == Warning and Now - LastWarningTransitionTime > 5 minutes).</span></span>
* <span data-ttu-id="9ceb8-399">Alert only on conditions that have changed in the last X minutes.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-399">Alert only on conditions that have changed in the last X minutes.</span></span> <span data-ttu-id="9ceb8-400">If a report was already at error before the specified time, it can be ignored because it was already signaled previously.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-400">If a report was already at error before the specified time, it can be ignored because it was already signaled previously.</span></span>
* <span data-ttu-id="9ceb8-401">If a property is toggling between warning and error, determine how long it has been unhealthy (that is, not OK).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-401">If a property is toggling between warning and error, determine how long it has been unhealthy (that is, not OK).</span></span> <span data-ttu-id="9ceb8-402">For example, an alert if the property hasn't been healthy for more than five minutes can be translated into (HealthState != Ok and Now - LastOkTransitionTime > 5 minutes).</span><span class="sxs-lookup"><span data-stu-id="9ceb8-402">For example, an alert if the property hasn't been healthy for more than five minutes can be translated into (HealthState != Ok and Now - LastOkTransitionTime > 5 minutes).</span></span>

## <a name="example-report-and-evaluate-application-health"></a><span data-ttu-id="9ceb8-403">Example: Report and evaluate application health</span><span class="sxs-lookup"><span data-stu-id="9ceb8-403">Example: Report and evaluate application health</span></span>
<span data-ttu-id="9ceb8-404">The following example sends a health report through PowerShell on the application **fabric:/WordCount** from the source **MyWatchdog**.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-404">The following example sends a health report through PowerShell on the application **fabric:/WordCount** from the source **MyWatchdog**.</span></span> <span data-ttu-id="9ceb8-405">The health report contains information about the health property "availability" in an error health state, with infinite TimeToLive.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-405">The health report contains information about the health property "availability" in an error health state, with infinite TimeToLive.</span></span> <span data-ttu-id="9ceb8-406">Then it queries the application health, which returns aggregated health state errors and the reported health events in the list of health events.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-406">Then it queries the application health, which returns aggregated health state errors and the reported health events in the list of health events.</span></span>

```powershell
PS C:\> Send-ServiceFabricApplicationHealthReport ApplicationName fabric:/WordCount SourceId "MyWatchdog" HealthProperty "Availability" HealthState Error

PS C:\> Get-ServiceFabricApplicationHealth fabric:/WordCount


ApplicationName                 : fabric:/WordCount
AggregatedHealthState           : Error
UnhealthyEvaluations            :
                                  Error event: SourceId='MyWatchdog', Property='Availability'.

ServiceHealthStates             :
                                  ServiceName           : fabric:/WordCount/WordCountService
                                  AggregatedHealthState : Error

                                  ServiceName           : fabric:/WordCount/WordCountWebService
                                  AggregatedHealthState : Ok

DeployedApplicationHealthStates :
                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_0
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_2
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_3
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_4
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_1
                                  AggregatedHealthState : Ok

HealthEvents                    :
                                  SourceId              : System.CM
                                  Property              : State
                                  HealthState           : Ok
                                  SequenceNumber        : 360
                                  SentAt                : 3/22/2016 7:56:53 PM
                                  ReceivedAt            : 3/22/2016 7:56:53 PM
                                  TTL                   : Infinite
                                  Description           : Application has been created.
                                  RemoveWhenExpired     : False
                                  IsExpired             : False
                                  Transitions           : Error->Ok = 3/22/2016 7:56:53 PM, LastWarning = 1/1/0001 12:00:00 AM

                                  SourceId              : MyWatchdog
                                  Property              : Availability
                                  HealthState           : Error
                                  SequenceNumber        : 131032204762818013
                                  SentAt                : 3/23/2016 3:27:56 PM
                                  ReceivedAt            : 3/23/2016 3:27:56 PM
                                  TTL                   : Infinite
                                  Description           :
                                  RemoveWhenExpired     : False
                                  IsExpired             : False
                                  Transitions           : Ok->Error = 3/23/2016 3:27:56 PM, LastWarning = 1/1/0001 12:00:00 AM
```

## <a name="health-model-usage"></a><span data-ttu-id="9ceb8-407">Health model usage</span><span class="sxs-lookup"><span data-stu-id="9ceb8-407">Health model usage</span></span>
<span data-ttu-id="9ceb8-408">The health model allows cloud services and the underlying Service Fabric platform to scale, because monitoring and health determinations are distributed among the different monitors within the cluster.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-408">The health model allows cloud services and the underlying Service Fabric platform to scale, because monitoring and health determinations are distributed among the different monitors within the cluster.</span></span>
<span data-ttu-id="9ceb8-409">Other systems have a single, centralized service at the cluster level that parses all the *potentially* useful information emitted by services.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-409">Other systems have a single, centralized service at the cluster level that parses all the *potentially* useful information emitted by services.</span></span> <span data-ttu-id="9ceb8-410">This approach hinders their scalability.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-410">This approach hinders their scalability.</span></span> <span data-ttu-id="9ceb8-411">It also doesn't allow them to collect very specific information to help identify issues and potential issues as close to the root cause as possible.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-411">It also doesn't allow them to collect very specific information to help identify issues and potential issues as close to the root cause as possible.</span></span>

<span data-ttu-id="9ceb8-412">The health model is used heavily for monitoring and diagnosis, for evaluating cluster and application health, and for monitored upgrades.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-412">The health model is used heavily for monitoring and diagnosis, for evaluating cluster and application health, and for monitored upgrades.</span></span> <span data-ttu-id="9ceb8-413">Other services use health data to perform automatic repairs, build cluster health history, and issue alerts on certain conditions.</span><span class="sxs-lookup"><span data-stu-id="9ceb8-413">Other services use health data to perform automatic repairs, build cluster health history, and issue alerts on certain conditions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9ceb8-414">Next steps</span><span class="sxs-lookup"><span data-stu-id="9ceb8-414">Next steps</span></span>
[<span data-ttu-id="9ceb8-415">View Service Fabric health reports</span><span class="sxs-lookup"><span data-stu-id="9ceb8-415">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="9ceb8-416">Use system health reports for troubleshooting</span><span class="sxs-lookup"><span data-stu-id="9ceb8-416">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="9ceb8-417">How to report and check service health</span><span class="sxs-lookup"><span data-stu-id="9ceb8-417">How to report and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="9ceb8-418">Add custom Service Fabric health reports</span><span class="sxs-lookup"><span data-stu-id="9ceb8-418">Add custom Service Fabric health reports</span></span>](service-fabric-report-health.md)

[<span data-ttu-id="9ceb8-419">Monitor and diagnose services locally</span><span class="sxs-lookup"><span data-stu-id="9ceb8-419">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="9ceb8-420">Service Fabric application upgrade</span><span class="sxs-lookup"><span data-stu-id="9ceb8-420">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)






