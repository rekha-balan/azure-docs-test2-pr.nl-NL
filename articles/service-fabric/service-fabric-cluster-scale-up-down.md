---
title: Scale a Service Fabric cluster in or out | Microsoft Docs
description: Scale a Service Fabric cluster in or out to match demand by setting auto-scale rules for each node type/Virtual Machine scale set. Add or remove nodes to a Service Fabric cluster
services: service-fabric
documentationcenter: .net
author: aljo-microsoft
manager: timlt
editor: ''
ms.assetid: aeb76f63-7303-4753-9c64-46146340b83d
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: conceptual
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 06/22/2017
ms.author: aljo
ms.openlocfilehash: d820898b1a0cc26d6832be9d302c74306fa4882f
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44811641"
---
# <a name="read-before-you-scale"></a><span data-ttu-id="0b831-104">Read before you scale</span><span class="sxs-lookup"><span data-stu-id="0b831-104">Read before you scale</span></span>
<span data-ttu-id="0b831-105">Scaling compute resources to source your application work load requires intentional planning, will nearly always take longer than an hour to complete for a production environment, and does require you to understand your workload and business context; in fact if you have never done this activity before, it's recommended you start by reading and understanding [Service Fabric cluster capacity planning considerations](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-cluster-capacity), before continuing the remainder of this document.</span><span class="sxs-lookup"><span data-stu-id="0b831-105">Scaling compute resources to source your application work load requires intentional planning, will nearly always take longer than an hour to complete for a production environment, and does require you to understand your workload and business context; in fact if you have never done this activity before, it's recommended you start by reading and understanding [Service Fabric cluster capacity planning considerations](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-cluster-capacity), before continuing the remainder of this document.</span></span> <span data-ttu-id="0b831-106">This recommendation is to avoid unintended LiveSite issues, and it's also recommended you successfully test the operations you decide to perform against a non-production environment.</span><span class="sxs-lookup"><span data-stu-id="0b831-106">This recommendation is to avoid unintended LiveSite issues, and it's also recommended you successfully test the operations you decide to perform against a non-production environment.</span></span> <span data-ttu-id="0b831-107">At any time you can [report production issues or request paid support for Azure](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-support#report-production-issues-or-request-paid-support-for-azure).</span><span class="sxs-lookup"><span data-stu-id="0b831-107">At any time you can [report production issues or request paid support for Azure](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-support#report-production-issues-or-request-paid-support-for-azure).</span></span> <span data-ttu-id="0b831-108">For engineers allocated to perform these operations that possess appropriate context, this article will describe scaling operations, but you must decide and understand which operations are appropriate for your use case; such as what resources to scale (CPU, Storage, Memory), what direction to scale (Vertically or Horizontally), and what operations to perform (Resource Template deployment, Portal, PowerShell/CLI).</span><span class="sxs-lookup"><span data-stu-id="0b831-108">For engineers allocated to perform these operations that possess appropriate context, this article will describe scaling operations, but you must decide and understand which operations are appropriate for your use case; such as what resources to scale (CPU, Storage, Memory), what direction to scale (Vertically or Horizontally), and what operations to perform (Resource Template deployment, Portal, PowerShell/CLI).</span></span>

# <a name="scale-a-service-fabric-cluster-in-or-out-using-auto-scale-rules-or-manually"></a><span data-ttu-id="0b831-109">Scale a Service Fabric cluster in or out using auto-scale rules or manually</span><span class="sxs-lookup"><span data-stu-id="0b831-109">Scale a Service Fabric cluster in or out using auto-scale rules or manually</span></span>
<span data-ttu-id="0b831-110">Virtual machine scale sets are an Azure compute resource that you can use to deploy and manage a collection of virtual machines as a set.</span><span class="sxs-lookup"><span data-stu-id="0b831-110">Virtual machine scale sets are an Azure compute resource that you can use to deploy and manage a collection of virtual machines as a set.</span></span> <span data-ttu-id="0b831-111">Every node type that is defined in a Service Fabric cluster is set up as a separate virtual machine scale set.</span><span class="sxs-lookup"><span data-stu-id="0b831-111">Every node type that is defined in a Service Fabric cluster is set up as a separate virtual machine scale set.</span></span> <span data-ttu-id="0b831-112">Each node type can then be scaled in or out independently, have different sets of ports open, and can have different capacity metrics.</span><span class="sxs-lookup"><span data-stu-id="0b831-112">Each node type can then be scaled in or out independently, have different sets of ports open, and can have different capacity metrics.</span></span> <span data-ttu-id="0b831-113">Read more about it in the [Service Fabric nodetypes](service-fabric-cluster-nodetypes.md) document.</span><span class="sxs-lookup"><span data-stu-id="0b831-113">Read more about it in the [Service Fabric nodetypes](service-fabric-cluster-nodetypes.md) document.</span></span> <span data-ttu-id="0b831-114">Since the Service Fabric node types in your cluster are made of virtual machine scale sets at the backend, you need to set up auto-scale rules for each node type/Virtual Machine scale set.</span><span class="sxs-lookup"><span data-stu-id="0b831-114">Since the Service Fabric node types in your cluster are made of virtual machine scale sets at the backend, you need to set up auto-scale rules for each node type/Virtual Machine scale set.</span></span>

> [!NOTE]
> <span data-ttu-id="0b831-115">Your subscription must have enough cores to add the new VMs that make up this cluster.</span><span class="sxs-lookup"><span data-stu-id="0b831-115">Your subscription must have enough cores to add the new VMs that make up this cluster.</span></span> <span data-ttu-id="0b831-116">There is no model validation currently, so you get a deployment time failure, if any of the quota limits are hit.</span><span class="sxs-lookup"><span data-stu-id="0b831-116">There is no model validation currently, so you get a deployment time failure, if any of the quota limits are hit.</span></span> <span data-ttu-id="0b831-117">Also a single node type can not simply exceed 100 nodes per VMSS.</span><span class="sxs-lookup"><span data-stu-id="0b831-117">Also a single node type can not simply exceed 100 nodes per VMSS.</span></span> <span data-ttu-id="0b831-118">You may need to add VMSS's to achieve the targeted scale, and auto-scaling can not automagically add VMSS's.</span><span class="sxs-lookup"><span data-stu-id="0b831-118">You may need to add VMSS's to achieve the targeted scale, and auto-scaling can not automagically add VMSS's.</span></span> <span data-ttu-id="0b831-119">Adding VMSS's in-place to a live cluster is a challenging task, and commonly this results in users provisioning new clusters with the appropriate node types provisioned at creation time; [plan cluster capacity](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-cluster-capacity) accordingly.</span><span class="sxs-lookup"><span data-stu-id="0b831-119">Adding VMSS's in-place to a live cluster is a challenging task, and commonly this results in users provisioning new clusters with the appropriate node types provisioned at creation time; [plan cluster capacity](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-cluster-capacity) accordingly.</span></span> 
> 
> 

## <a name="choose-the-node-typevirtual-machine-scale-set-to-scale"></a><span data-ttu-id="0b831-120">Choose the node type/Virtual Machine scale set to scale</span><span class="sxs-lookup"><span data-stu-id="0b831-120">Choose the node type/Virtual Machine scale set to scale</span></span>
<span data-ttu-id="0b831-121">Currently, you are not able to specify the auto-scale rules for virtual machine scale sets using the portal, so let us use Azure PowerShell (1.0+) to list the node types and then add auto-scale rules to them.</span><span class="sxs-lookup"><span data-stu-id="0b831-121">Currently, you are not able to specify the auto-scale rules for virtual machine scale sets using the portal, so let us use Azure PowerShell (1.0+) to list the node types and then add auto-scale rules to them.</span></span>

<span data-ttu-id="0b831-122">To get the list of virtual machine scale set that make up your cluster, run the following cmdlets:</span><span class="sxs-lookup"><span data-stu-id="0b831-122">To get the list of virtual machine scale set that make up your cluster, run the following cmdlets:</span></span>

```powershell
Get-AzureRmResource -ResourceGroupName <RGname> -ResourceType Microsoft.Compute/VirtualMachineScaleSets

Get-AzureRmVmss -ResourceGroupName <RGname> -VMScaleSetName <Virtual Machine scale set name>
```

## <a name="set-auto-scale-rules-for-the-node-typevirtual-machine-scale-set"></a><span data-ttu-id="0b831-123">Set auto-scale rules for the node type/Virtual Machine scale set</span><span class="sxs-lookup"><span data-stu-id="0b831-123">Set auto-scale rules for the node type/Virtual Machine scale set</span></span>
<span data-ttu-id="0b831-124">If your cluster has multiple node types, then repeat this for each node types/Virtual Machine scale sets that you want to scale (in or out).</span><span class="sxs-lookup"><span data-stu-id="0b831-124">If your cluster has multiple node types, then repeat this for each node types/Virtual Machine scale sets that you want to scale (in or out).</span></span> <span data-ttu-id="0b831-125">Take into account the number of nodes that you must have before you set up auto-scaling.</span><span class="sxs-lookup"><span data-stu-id="0b831-125">Take into account the number of nodes that you must have before you set up auto-scaling.</span></span> <span data-ttu-id="0b831-126">The minimum number of nodes that you must have for the primary node type is driven by the reliability level you have chosen.</span><span class="sxs-lookup"><span data-stu-id="0b831-126">The minimum number of nodes that you must have for the primary node type is driven by the reliability level you have chosen.</span></span> <span data-ttu-id="0b831-127">Read more about [reliability levels](service-fabric-cluster-capacity.md).</span><span class="sxs-lookup"><span data-stu-id="0b831-127">Read more about [reliability levels](service-fabric-cluster-capacity.md).</span></span>

> [!NOTE]
> <span data-ttu-id="0b831-128">Scaling down the primary node type to less than the minimum number make the cluster unstable or bring it down.</span><span class="sxs-lookup"><span data-stu-id="0b831-128">Scaling down the primary node type to less than the minimum number make the cluster unstable or bring it down.</span></span> <span data-ttu-id="0b831-129">This could result in data loss for your applications and for the system services.</span><span class="sxs-lookup"><span data-stu-id="0b831-129">This could result in data loss for your applications and for the system services.</span></span>
> 
> 

<span data-ttu-id="0b831-130">Currently the auto-scale feature is not driven by the loads that your applications may be reporting to Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="0b831-130">Currently the auto-scale feature is not driven by the loads that your applications may be reporting to Service Fabric.</span></span> <span data-ttu-id="0b831-131">So at this time the auto-scale you get is purely driven by the performance counters that are emitted by each of the virtual machine scale set instances.</span><span class="sxs-lookup"><span data-stu-id="0b831-131">So at this time the auto-scale you get is purely driven by the performance counters that are emitted by each of the virtual machine scale set instances.</span></span>  

<span data-ttu-id="0b831-132">Follow these instructions [to set up auto-scale for each Virtual Machine scale set](../virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview.md).</span><span class="sxs-lookup"><span data-stu-id="0b831-132">Follow these instructions [to set up auto-scale for each Virtual Machine scale set](../virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview.md).</span></span>

> [!NOTE]
> <span data-ttu-id="0b831-133">In a scale down scenario, unless your node type has a durability level of Gold or Silver you need to call the [Remove-ServiceFabricNodeState cmdlet](https://docs.microsoft.com/powershell/module/servicefabric/remove-servicefabricnodestate) with the appropriate node name.For the Bronze durability, it’s not recommended to scale down more than one node at a time.</span><span class="sxs-lookup"><span data-stu-id="0b831-133">In a scale down scenario, unless your node type has a durability level of Gold or Silver you need to call the [Remove-ServiceFabricNodeState cmdlet](https://docs.microsoft.com/powershell/module/servicefabric/remove-servicefabricnodestate) with the appropriate node name.For the Bronze durability, it’s not recommended to scale down more than one node at a time.</span></span>
> 
> 

## <a name="manually-add-vms-to-a-node-typevirtual-machine-scale-set"></a><span data-ttu-id="0b831-134">Manually add VMs to a node type/Virtual Machine scale set</span><span class="sxs-lookup"><span data-stu-id="0b831-134">Manually add VMs to a node type/Virtual Machine scale set</span></span>
<span data-ttu-id="0b831-135">Follow the sample/instructions in the [quick start template gallery](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing) to change the number of VMs in each Nodetype.</span><span class="sxs-lookup"><span data-stu-id="0b831-135">Follow the sample/instructions in the [quick start template gallery](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing) to change the number of VMs in each Nodetype.</span></span> 

> [!NOTE]
> <span data-ttu-id="0b831-136">Adding of VMs takes time, so do not expect the additions to be instantaneous.</span><span class="sxs-lookup"><span data-stu-id="0b831-136">Adding of VMs takes time, so do not expect the additions to be instantaneous.</span></span> <span data-ttu-id="0b831-137">So plan to add capacity well in time, to allow for over 10 minutes before the VM capacity is available for the replicas/ service instances to get placed.</span><span class="sxs-lookup"><span data-stu-id="0b831-137">So plan to add capacity well in time, to allow for over 10 minutes before the VM capacity is available for the replicas/ service instances to get placed.</span></span>
> 
> 

## <a name="manually-remove-vms-from-the-primary-node-typevirtual-machine-scale-set"></a><span data-ttu-id="0b831-138">Manually remove VMs from the primary node type/Virtual Machine scale set</span><span class="sxs-lookup"><span data-stu-id="0b831-138">Manually remove VMs from the primary node type/Virtual Machine scale set</span></span>
> [!NOTE]
> <span data-ttu-id="0b831-139">The service fabric system services run in the Primary node type in your cluster.</span><span class="sxs-lookup"><span data-stu-id="0b831-139">The service fabric system services run in the Primary node type in your cluster.</span></span> <span data-ttu-id="0b831-140">So should never shut down or scale down the number of instances in that node types less than what the reliability tier warrants.</span><span class="sxs-lookup"><span data-stu-id="0b831-140">So should never shut down or scale down the number of instances in that node types less than what the reliability tier warrants.</span></span> <span data-ttu-id="0b831-141">Refer to [the details on reliability tiers here](service-fabric-cluster-capacity.md).</span><span class="sxs-lookup"><span data-stu-id="0b831-141">Refer to [the details on reliability tiers here](service-fabric-cluster-capacity.md).</span></span> 
> 
> 

<span data-ttu-id="0b831-142">You need to execute the following steps one VM instance at a time.</span><span class="sxs-lookup"><span data-stu-id="0b831-142">You need to execute the following steps one VM instance at a time.</span></span> <span data-ttu-id="0b831-143">This allows for the system services (and your stateful services) to be shut down gracefully on the VM instance you are removing and new replicas created on other nodes.</span><span class="sxs-lookup"><span data-stu-id="0b831-143">This allows for the system services (and your stateful services) to be shut down gracefully on the VM instance you are removing and new replicas created on other nodes.</span></span>

1. <span data-ttu-id="0b831-144">Run [Disable-ServiceFabricNode](https://docs.microsoft.com/powershell/module/servicefabric/disable-servicefabricnode?view=azureservicefabricps) with intent ‘RemoveNode’ to disable the node you’re going to remove (the highest instance in that node type).</span><span class="sxs-lookup"><span data-stu-id="0b831-144">Run [Disable-ServiceFabricNode](https://docs.microsoft.com/powershell/module/servicefabric/disable-servicefabricnode?view=azureservicefabricps) with intent ‘RemoveNode’ to disable the node you’re going to remove (the highest instance in that node type).</span></span>
2. <span data-ttu-id="0b831-145">Run [Get-ServiceFabricNode](https://docs.microsoft.com/powershell/module/servicefabric/get-servicefabricnode?view=azureservicefabricps) to make sure that the node has indeed transitioned to disabled.</span><span class="sxs-lookup"><span data-stu-id="0b831-145">Run [Get-ServiceFabricNode](https://docs.microsoft.com/powershell/module/servicefabric/get-servicefabricnode?view=azureservicefabricps) to make sure that the node has indeed transitioned to disabled.</span></span> <span data-ttu-id="0b831-146">If not, wait until the node is disabled.</span><span class="sxs-lookup"><span data-stu-id="0b831-146">If not, wait until the node is disabled.</span></span> <span data-ttu-id="0b831-147">You cannot hurry this step.</span><span class="sxs-lookup"><span data-stu-id="0b831-147">You cannot hurry this step.</span></span>
3. <span data-ttu-id="0b831-148">Follow the sample/instructions in the [quick start template gallery](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing) to change the number of VMs by one in that Node type.</span><span class="sxs-lookup"><span data-stu-id="0b831-148">Follow the sample/instructions in the [quick start template gallery](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing) to change the number of VMs by one in that Node type.</span></span> <span data-ttu-id="0b831-149">The instance removed is the highest VM instance.</span><span class="sxs-lookup"><span data-stu-id="0b831-149">The instance removed is the highest VM instance.</span></span> 
4. <span data-ttu-id="0b831-150">Repeat steps 1 through 3 as needed, but never scale down the number of instances in the primary node types less than what the reliability tier warrants.</span><span class="sxs-lookup"><span data-stu-id="0b831-150">Repeat steps 1 through 3 as needed, but never scale down the number of instances in the primary node types less than what the reliability tier warrants.</span></span> <span data-ttu-id="0b831-151">Refer to [the details on reliability tiers here](service-fabric-cluster-capacity.md).</span><span class="sxs-lookup"><span data-stu-id="0b831-151">Refer to [the details on reliability tiers here](service-fabric-cluster-capacity.md).</span></span> 

## <a name="manually-remove-vms-from-the-non-primary-node-typevirtual-machine-scale-set"></a><span data-ttu-id="0b831-152">Manually remove VMs from the non-primary node type/Virtual Machine scale set</span><span class="sxs-lookup"><span data-stu-id="0b831-152">Manually remove VMs from the non-primary node type/Virtual Machine scale set</span></span>
> [!NOTE]
> <span data-ttu-id="0b831-153">For a stateful service, you need a certain number of nodes to be always up to maintain availability and preserve state of your service.</span><span class="sxs-lookup"><span data-stu-id="0b831-153">For a stateful service, you need a certain number of nodes to be always up to maintain availability and preserve state of your service.</span></span> <span data-ttu-id="0b831-154">At the very minimum, you need the number of nodes equal to the target replica set count of the partition/service.</span><span class="sxs-lookup"><span data-stu-id="0b831-154">At the very minimum, you need the number of nodes equal to the target replica set count of the partition/service.</span></span> 
> 
> 

<span data-ttu-id="0b831-155">You need the execute the following steps one VM instance at a time.</span><span class="sxs-lookup"><span data-stu-id="0b831-155">You need the execute the following steps one VM instance at a time.</span></span> <span data-ttu-id="0b831-156">This allows for the system services (and your stateful services) to be shut down gracefully on the VM instance you are removing and new replicas created else where.</span><span class="sxs-lookup"><span data-stu-id="0b831-156">This allows for the system services (and your stateful services) to be shut down gracefully on the VM instance you are removing and new replicas created else where.</span></span>

1. <span data-ttu-id="0b831-157">Run [Disable-ServiceFabricNode](https://docs.microsoft.com/powershell/module/servicefabric/disable-servicefabricnode?view=azureservicefabricps) with intent ‘RemoveNode’ to disable the node you’re going to remove (the highest instance in that node type).</span><span class="sxs-lookup"><span data-stu-id="0b831-157">Run [Disable-ServiceFabricNode](https://docs.microsoft.com/powershell/module/servicefabric/disable-servicefabricnode?view=azureservicefabricps) with intent ‘RemoveNode’ to disable the node you’re going to remove (the highest instance in that node type).</span></span>
2. <span data-ttu-id="0b831-158">Run [Get-ServiceFabricNode](https://docs.microsoft.com/powershell/module/servicefabric/get-servicefabricnode?view=azureservicefabricps) to make sure that the node has indeed transitioned to disabled.</span><span class="sxs-lookup"><span data-stu-id="0b831-158">Run [Get-ServiceFabricNode](https://docs.microsoft.com/powershell/module/servicefabric/get-servicefabricnode?view=azureservicefabricps) to make sure that the node has indeed transitioned to disabled.</span></span> <span data-ttu-id="0b831-159">If not, wait until the node is disabled.</span><span class="sxs-lookup"><span data-stu-id="0b831-159">If not, wait until the node is disabled.</span></span> <span data-ttu-id="0b831-160">You cannot hurry this step.</span><span class="sxs-lookup"><span data-stu-id="0b831-160">You cannot hurry this step.</span></span>
3. <span data-ttu-id="0b831-161">Follow the sample/instructions in the [quick start template gallery](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing) to change the number of VMs by one in that Node type.</span><span class="sxs-lookup"><span data-stu-id="0b831-161">Follow the sample/instructions in the [quick start template gallery](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing) to change the number of VMs by one in that Node type.</span></span> <span data-ttu-id="0b831-162">This will now remove the highest VM instance.</span><span class="sxs-lookup"><span data-stu-id="0b831-162">This will now remove the highest VM instance.</span></span> 
4. <span data-ttu-id="0b831-163">Repeat steps 1 through 3 as needed, but never scale down the number of instances in the primary node types less than what the reliability tier warrants.</span><span class="sxs-lookup"><span data-stu-id="0b831-163">Repeat steps 1 through 3 as needed, but never scale down the number of instances in the primary node types less than what the reliability tier warrants.</span></span> <span data-ttu-id="0b831-164">Refer to [the details on reliability tiers here](service-fabric-cluster-capacity.md).</span><span class="sxs-lookup"><span data-stu-id="0b831-164">Refer to [the details on reliability tiers here](service-fabric-cluster-capacity.md).</span></span>

## <a name="behaviors-you-may-observe-in-service-fabric-explorer"></a><span data-ttu-id="0b831-165">Behaviors you may observe in Service Fabric Explorer</span><span class="sxs-lookup"><span data-stu-id="0b831-165">Behaviors you may observe in Service Fabric Explorer</span></span>
<span data-ttu-id="0b831-166">When you scale up a cluster the Service Fabric Explorer will reflect the number of nodes (virtual machine scale set instances) that are part of the cluster.</span><span class="sxs-lookup"><span data-stu-id="0b831-166">When you scale up a cluster the Service Fabric Explorer will reflect the number of nodes (virtual machine scale set instances) that are part of the cluster.</span></span>  <span data-ttu-id="0b831-167">However, when you scale a cluster down you will see the removed node/VM instance displayed in an unhealthy state unless you call [Remove-ServiceFabricNodeState cmd](https://docs.microsoft.com/powershell/module/servicefabric/remove-servicefabricnodestate) with the appropriate node name.</span><span class="sxs-lookup"><span data-stu-id="0b831-167">However, when you scale a cluster down you will see the removed node/VM instance displayed in an unhealthy state unless you call [Remove-ServiceFabricNodeState cmd](https://docs.microsoft.com/powershell/module/servicefabric/remove-servicefabricnodestate) with the appropriate node name.</span></span>   

<span data-ttu-id="0b831-168">Here is the explanation for this behavior.</span><span class="sxs-lookup"><span data-stu-id="0b831-168">Here is the explanation for this behavior.</span></span>

<span data-ttu-id="0b831-169">The nodes listed in Service Fabric Explorer are a reflection of what the Service Fabric system services (FM specifically) knows about the number of nodes the cluster had/has.</span><span class="sxs-lookup"><span data-stu-id="0b831-169">The nodes listed in Service Fabric Explorer are a reflection of what the Service Fabric system services (FM specifically) knows about the number of nodes the cluster had/has.</span></span> <span data-ttu-id="0b831-170">When you scale the virtual machine scale set down, the VM was deleted but FM system service still thinks that the node (that was mapped to the VM that was deleted) will come back.</span><span class="sxs-lookup"><span data-stu-id="0b831-170">When you scale the virtual machine scale set down, the VM was deleted but FM system service still thinks that the node (that was mapped to the VM that was deleted) will come back.</span></span> <span data-ttu-id="0b831-171">So Service Fabric Explorer continues to display that node (though the health state may be error or unknown).</span><span class="sxs-lookup"><span data-stu-id="0b831-171">So Service Fabric Explorer continues to display that node (though the health state may be error or unknown).</span></span>

<span data-ttu-id="0b831-172">In order to make sure that a node is removed when a VM is removed, you have two options:</span><span class="sxs-lookup"><span data-stu-id="0b831-172">In order to make sure that a node is removed when a VM is removed, you have two options:</span></span>

1) <span data-ttu-id="0b831-173">Choose a durability level of Gold or Silver for the node types in your cluster, which gives you the infrastructure integration.</span><span class="sxs-lookup"><span data-stu-id="0b831-173">Choose a durability level of Gold or Silver for the node types in your cluster, which gives you the infrastructure integration.</span></span> <span data-ttu-id="0b831-174">Which will then automatically remove the nodes from our system services (FM) state when you scale down.</span><span class="sxs-lookup"><span data-stu-id="0b831-174">Which will then automatically remove the nodes from our system services (FM) state when you scale down.</span></span>
<span data-ttu-id="0b831-175">Refer to [the details on durability levels here](service-fabric-cluster-capacity.md)</span><span class="sxs-lookup"><span data-stu-id="0b831-175">Refer to [the details on durability levels here](service-fabric-cluster-capacity.md)</span></span>

2) <span data-ttu-id="0b831-176">Once the VM instance has been scaled down, you need to call the [Remove-ServiceFabricNodeState cmdlet](https://docs.microsoft.com/powershell/module/servicefabric/remove-servicefabricnodestate).</span><span class="sxs-lookup"><span data-stu-id="0b831-176">Once the VM instance has been scaled down, you need to call the [Remove-ServiceFabricNodeState cmdlet](https://docs.microsoft.com/powershell/module/servicefabric/remove-servicefabricnodestate).</span></span>

> [!NOTE]
> <span data-ttu-id="0b831-177">Service Fabric clusters require a certain number of nodes to be up at all the time in order to maintain availability and preserve state - referred to as "maintaining quorum."</span><span class="sxs-lookup"><span data-stu-id="0b831-177">Service Fabric clusters require a certain number of nodes to be up at all the time in order to maintain availability and preserve state - referred to as "maintaining quorum."</span></span> <span data-ttu-id="0b831-178">So, it is typically unsafe to shut down all the machines in the cluster unless you have first performed a [full backup of your state](service-fabric-reliable-services-backup-restore.md).</span><span class="sxs-lookup"><span data-stu-id="0b831-178">So, it is typically unsafe to shut down all the machines in the cluster unless you have first performed a [full backup of your state](service-fabric-reliable-services-backup-restore.md).</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="0b831-179">Next steps</span><span class="sxs-lookup"><span data-stu-id="0b831-179">Next steps</span></span>
<span data-ttu-id="0b831-180">Read the following to also learn about planning cluster capacity, upgrading a cluster, and partitioning services:</span><span class="sxs-lookup"><span data-stu-id="0b831-180">Read the following to also learn about planning cluster capacity, upgrading a cluster, and partitioning services:</span></span>

* [<span data-ttu-id="0b831-181">Plan your cluster capacity</span><span class="sxs-lookup"><span data-stu-id="0b831-181">Plan your cluster capacity</span></span>](service-fabric-cluster-capacity.md)
* [<span data-ttu-id="0b831-182">Cluster upgrades</span><span class="sxs-lookup"><span data-stu-id="0b831-182">Cluster upgrades</span></span>](service-fabric-cluster-upgrade.md)
* [<span data-ttu-id="0b831-183">Partition stateful services for maximum scale</span><span class="sxs-lookup"><span data-stu-id="0b831-183">Partition stateful services for maximum scale</span></span>](service-fabric-concepts-partitioning.md)

<!--Image references-->
[BrowseServiceFabricClusterResource]: ./media/service-fabric-cluster-scale-up-down/BrowseServiceFabricClusterResource.png
[ClusterResources]: ./media/service-fabric-cluster-scale-up-down/ClusterResources.png
