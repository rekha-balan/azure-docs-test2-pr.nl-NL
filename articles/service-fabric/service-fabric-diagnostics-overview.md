---
title: Azure Service Fabric monitoring and diagnostics overview | Microsoft Docs
description: Learn how to monitor and diagnose Microsoft Azure Service Fabric applications that are hosted in Azure, development, or on-premises.
services: service-fabric
documentationcenter: .net
author: dkkapur
manager: mfussell
editor: ''
ms.assetid: edcc0631-ed2d-45a3-851d-2c4fa0f4a326
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 02/9/2017
ms.author: dekapur
ms.openlocfilehash: 8ecdeec319c0fff11c603351e0bb9cd0459cac05
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44555151"
---
# <a name="monitor-and-diagnose-azure-service-fabric-applications"></a><span data-ttu-id="4df34-103">Monitor and diagnose Azure Service Fabric applications</span><span class="sxs-lookup"><span data-stu-id="4df34-103">Monitor and diagnose Azure Service Fabric applications</span></span>

<span data-ttu-id="4df34-104">Monitoring and diagnostics are critical in a live production environment.</span><span class="sxs-lookup"><span data-stu-id="4df34-104">Monitoring and diagnostics are critical in a live production environment.</span></span> <span data-ttu-id="4df34-105">Azure Service Fabric can help you implement monitoring and diagnostics as you develop your service, to ensure that the service works seamlessly both in a single-machine, local development environment, and in a real-world, production cluster setup.</span><span class="sxs-lookup"><span data-stu-id="4df34-105">Azure Service Fabric can help you implement monitoring and diagnostics as you develop your service, to ensure that the service works seamlessly both in a single-machine, local development environment, and in a real-world, production cluster setup.</span></span>

<span data-ttu-id="4df34-106">Monitoring and diagnostics can help you as you develop your services to:</span><span class="sxs-lookup"><span data-stu-id="4df34-106">Monitoring and diagnostics can help you as you develop your services to:</span></span>
* <span data-ttu-id="4df34-107">Minimize disruption to your customers.</span><span class="sxs-lookup"><span data-stu-id="4df34-107">Minimize disruption to your customers.</span></span>
* <span data-ttu-id="4df34-108">Provide business insights.</span><span class="sxs-lookup"><span data-stu-id="4df34-108">Provide business insights.</span></span>
* <span data-ttu-id="4df34-109">Monitor resource usage.</span><span class="sxs-lookup"><span data-stu-id="4df34-109">Monitor resource usage.</span></span>
* <span data-ttu-id="4df34-110">Detect hardware and software failures or performance issues.</span><span class="sxs-lookup"><span data-stu-id="4df34-110">Detect hardware and software failures or performance issues.</span></span>
* <span data-ttu-id="4df34-111">Diagnose potential service issues.</span><span class="sxs-lookup"><span data-stu-id="4df34-111">Diagnose potential service issues.</span></span>

<span data-ttu-id="4df34-112">Monitoring is a broad term that includes the following tasks:</span><span class="sxs-lookup"><span data-stu-id="4df34-112">Monitoring is a broad term that includes the following tasks:</span></span>
* <span data-ttu-id="4df34-113">Instrumenting the code</span><span class="sxs-lookup"><span data-stu-id="4df34-113">Instrumenting the code</span></span>
* <span data-ttu-id="4df34-114">Collecting instrumentation logs</span><span class="sxs-lookup"><span data-stu-id="4df34-114">Collecting instrumentation logs</span></span>
* <span data-ttu-id="4df34-115">Analyzing logs</span><span class="sxs-lookup"><span data-stu-id="4df34-115">Analyzing logs</span></span>
* <span data-ttu-id="4df34-116">Visualizing insights based on the log data</span><span class="sxs-lookup"><span data-stu-id="4df34-116">Visualizing insights based on the log data</span></span>
* <span data-ttu-id="4df34-117">Setting up alerts based on log values and insights</span><span class="sxs-lookup"><span data-stu-id="4df34-117">Setting up alerts based on log values and insights</span></span>
* <span data-ttu-id="4df34-118">Monitoring the infrastructure</span><span class="sxs-lookup"><span data-stu-id="4df34-118">Monitoring the infrastructure</span></span>
* <span data-ttu-id="4df34-119">Detecting and diagnosing issues that affect your customers</span><span class="sxs-lookup"><span data-stu-id="4df34-119">Detecting and diagnosing issues that affect your customers</span></span>

<span data-ttu-id="4df34-120">This article gives an overview of monitoring for Service Fabric clusters hosted either in Azure, on-premises, deployed on Windows or Linux, or using the Microsoft .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="4df34-120">This article gives an overview of monitoring for Service Fabric clusters hosted either in Azure, on-premises, deployed on Windows or Linux, or using the Microsoft .NET Framework.</span></span> <span data-ttu-id="4df34-121">We look at three important aspects of monitoring and diagnostics:</span><span class="sxs-lookup"><span data-stu-id="4df34-121">We look at three important aspects of monitoring and diagnostics:</span></span>
- <span data-ttu-id="4df34-122">Instrumenting the code or infrastructure</span><span class="sxs-lookup"><span data-stu-id="4df34-122">Instrumenting the code or infrastructure</span></span>
- <span data-ttu-id="4df34-123">Collecting generated events</span><span class="sxs-lookup"><span data-stu-id="4df34-123">Collecting generated events</span></span>
- <span data-ttu-id="4df34-124">Storage, aggregation, visualization, and analysis</span><span class="sxs-lookup"><span data-stu-id="4df34-124">Storage, aggregation, visualization, and analysis</span></span>

<span data-ttu-id="4df34-125">Although multiple products are available that cover all of these three areas, many customers choose different technologies for each aspect of monitoring.</span><span class="sxs-lookup"><span data-stu-id="4df34-125">Although multiple products are available that cover all of these three areas, many customers choose different technologies for each aspect of monitoring.</span></span> <span data-ttu-id="4df34-126">It is important that each piece works together to deliver an end-to-end monitoring solution for the application.</span><span class="sxs-lookup"><span data-stu-id="4df34-126">It is important that each piece works together to deliver an end-to-end monitoring solution for the application.</span></span>

## <a name="monitoring-infrastructure"></a><span data-ttu-id="4df34-127">Monitoring infrastructure</span><span class="sxs-lookup"><span data-stu-id="4df34-127">Monitoring infrastructure</span></span>

<span data-ttu-id="4df34-128">Service Fabric can help keep an application running during infrastructure failures, but you need to understand whether an error is occurring in the application or in the underlying infrastructure.</span><span class="sxs-lookup"><span data-stu-id="4df34-128">Service Fabric can help keep an application running during infrastructure failures, but you need to understand whether an error is occurring in the application or in the underlying infrastructure.</span></span> <span data-ttu-id="4df34-129">You also need to monitor the infrastructure for capacity planning, so you know when to add or remove infrastructure.</span><span class="sxs-lookup"><span data-stu-id="4df34-129">You also need to monitor the infrastructure for capacity planning, so you know when to add or remove infrastructure.</span></span> <span data-ttu-id="4df34-130">It's important to monitor and troubleshoot both the infrastructure and the application that make up a Service Fabric deployment.</span><span class="sxs-lookup"><span data-stu-id="4df34-130">It's important to monitor and troubleshoot both the infrastructure and the application that make up a Service Fabric deployment.</span></span> <span data-ttu-id="4df34-131">Even if an application is available to customers, the infrastructure might still be experiencing problems.</span><span class="sxs-lookup"><span data-stu-id="4df34-131">Even if an application is available to customers, the infrastructure might still be experiencing problems.</span></span>

### <a name="azure-monitor"></a><span data-ttu-id="4df34-132">Azure Monitor</span><span class="sxs-lookup"><span data-stu-id="4df34-132">Azure Monitor</span></span>

<span data-ttu-id="4df34-133">You can use [Azure Monitor](../monitoring-and-diagnostics/monitoring-overview.md) to monitor many of the Azure resources on which a Service Fabric cluster is built.</span><span class="sxs-lookup"><span data-stu-id="4df34-133">You can use [Azure Monitor](../monitoring-and-diagnostics/monitoring-overview.md) to monitor many of the Azure resources on which a Service Fabric cluster is built.</span></span> <span data-ttu-id="4df34-134">A set of metrics for the [virtual machine scale set](../monitoring-and-diagnostics/monitoring-supported-metrics.md#microsoftcomputevirtualmachinescalesets) and individual [virtual machines](../monitoring-and-diagnostics/monitoring-supported-metrics.md#microsoftcomputevirtualmachinescalesetsvirtualmachines) is automatically collected and displayed in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="4df34-134">A set of metrics for the [virtual machine scale set](../monitoring-and-diagnostics/monitoring-supported-metrics.md#microsoftcomputevirtualmachinescalesets) and individual [virtual machines](../monitoring-and-diagnostics/monitoring-supported-metrics.md#microsoftcomputevirtualmachinescalesetsvirtualmachines) is automatically collected and displayed in the Azure portal.</span></span> <span data-ttu-id="4df34-135">To view the collected information, in the Azure portal, select the resource group that contains the Service Fabric cluster.</span><span class="sxs-lookup"><span data-stu-id="4df34-135">To view the collected information, in the Azure portal, select the resource group that contains the Service Fabric cluster.</span></span> <span data-ttu-id="4df34-136">Then, select the virtual machine scale set that you want to view.</span><span class="sxs-lookup"><span data-stu-id="4df34-136">Then, select the virtual machine scale set that you want to view.</span></span> <span data-ttu-id="4df34-137">In the **Monitoring** section, select **Metrics** to view a graph of the values.</span><span class="sxs-lookup"><span data-stu-id="4df34-137">In the **Monitoring** section, select **Metrics** to view a graph of the values.</span></span>

![Azure portal view of collected metric information](https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-fabric/media/service-fabric-diagnostics-overview/azure-monitoring-metrics.PNG)

<span data-ttu-id="4df34-139">To customize the charts, follow the instructions in [Metrics in Microsoft Azure](../monitoring-and-diagnostics/insights-how-to-customize-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="4df34-139">To customize the charts, follow the instructions in [Metrics in Microsoft Azure](../monitoring-and-diagnostics/insights-how-to-customize-monitoring.md).</span></span> <span data-ttu-id="4df34-140">You also can create alerts based on these metrics, as described in [Create alerts in Azure Monitor for Azure services](../monitoring-and-diagnostics/insights-alerts-portal.md).</span><span class="sxs-lookup"><span data-stu-id="4df34-140">You also can create alerts based on these metrics, as described in [Create alerts in Azure Monitor for Azure services](../monitoring-and-diagnostics/insights-alerts-portal.md).</span></span> <span data-ttu-id="4df34-141">You can send alerts to a notification service by using web hooks, as described in [Configure a web hook on an Azure metric alert](../monitoring-and-diagnostics/insights-webhooks-alerts.md).</span><span class="sxs-lookup"><span data-stu-id="4df34-141">You can send alerts to a notification service by using web hooks, as described in [Configure a web hook on an Azure metric alert](../monitoring-and-diagnostics/insights-webhooks-alerts.md).</span></span> <span data-ttu-id="4df34-142">Azure Monitor supports only one subscription.</span><span class="sxs-lookup"><span data-stu-id="4df34-142">Azure Monitor supports only one subscription.</span></span> <span data-ttu-id="4df34-143">If you need to monitor multiple subscriptions, or if you need additional features, [Log Analytics](https://azure.microsoft.com/documentation/services/log-analytics/), part of Microsoft Operations Management Suite, provides a holistic IT management solution both for on-premises and cloud-based infrastructures.</span><span class="sxs-lookup"><span data-stu-id="4df34-143">If you need to monitor multiple subscriptions, or if you need additional features, [Log Analytics](https://azure.microsoft.com/documentation/services/log-analytics/), part of Microsoft Operations Management Suite, provides a holistic IT management solution both for on-premises and cloud-based infrastructures.</span></span> <span data-ttu-id="4df34-144">You can route data from Azure Monitor directly to Log Analytics, so you can see metrics and logs for your entire environment in a single place.</span><span class="sxs-lookup"><span data-stu-id="4df34-144">You can route data from Azure Monitor directly to Log Analytics, so you can see metrics and logs for your entire environment in a single place.</span></span>

<span data-ttu-id="4df34-145">We recommend using Operations Management Suite to monitor your on-premises infrastructure, but you can use any existing solution that your organization uses for infrastructure monitoring.</span><span class="sxs-lookup"><span data-stu-id="4df34-145">We recommend using Operations Management Suite to monitor your on-premises infrastructure, but you can use any existing solution that your organization uses for infrastructure monitoring.</span></span>

### <a name="service-fabric-support-logs"></a><span data-ttu-id="4df34-146">Service Fabric support logs</span><span class="sxs-lookup"><span data-stu-id="4df34-146">Service Fabric support logs</span></span>

<span data-ttu-id="4df34-147">If you need to contact Microsoft support for help with your Azure Service Fabric cluster, support logs are almost always required.</span><span class="sxs-lookup"><span data-stu-id="4df34-147">If you need to contact Microsoft support for help with your Azure Service Fabric cluster, support logs are almost always required.</span></span> <span data-ttu-id="4df34-148">If your cluster is hosted in Azure, support logs are automatically configured and collected as part of creating a cluster.</span><span class="sxs-lookup"><span data-stu-id="4df34-148">If your cluster is hosted in Azure, support logs are automatically configured and collected as part of creating a cluster.</span></span> <span data-ttu-id="4df34-149">The logs are stored in a dedicated storage account in your cluster's resource group.</span><span class="sxs-lookup"><span data-stu-id="4df34-149">The logs are stored in a dedicated storage account in your cluster's resource group.</span></span> <span data-ttu-id="4df34-150">The storage account doesn't have a fixed name, but in the account, you see blob containers and tables with names that start with *fabric*.</span><span class="sxs-lookup"><span data-stu-id="4df34-150">The storage account doesn't have a fixed name, but in the account, you see blob containers and tables with names that start with *fabric*.</span></span> <span data-ttu-id="4df34-151">For information about setting up log collections for a standalone cluster, see [Create and manage a standalone Azure Service Fabric cluster](service-fabric-cluster-creation-for-windows-server.md) and [Configuration settings for a standalone Windows cluster](service-fabric-cluster-manifest.md).</span><span class="sxs-lookup"><span data-stu-id="4df34-151">For information about setting up log collections for a standalone cluster, see [Create and manage a standalone Azure Service Fabric cluster](service-fabric-cluster-creation-for-windows-server.md) and [Configuration settings for a standalone Windows cluster](service-fabric-cluster-manifest.md).</span></span> <span data-ttu-id="4df34-152">For standalone Service Fabric instances, the logs should be sent to a local file share.</span><span class="sxs-lookup"><span data-stu-id="4df34-152">For standalone Service Fabric instances, the logs should be sent to a local file share.</span></span> <span data-ttu-id="4df34-153">You are **required** to have these logs for support, but they are not intended to be usable by anyone outside of the Microsoft customer support team.</span><span class="sxs-lookup"><span data-stu-id="4df34-153">You are **required** to have these logs for support, but they are not intended to be usable by anyone outside of the Microsoft customer support team.</span></span>

## <a name="instrument-your-code"></a><span data-ttu-id="4df34-154">Instrument your code</span><span class="sxs-lookup"><span data-stu-id="4df34-154">Instrument your code</span></span>

<span data-ttu-id="4df34-155">Instrumenting the code is the basis for most other aspects of monitoring your services.</span><span class="sxs-lookup"><span data-stu-id="4df34-155">Instrumenting the code is the basis for most other aspects of monitoring your services.</span></span> <span data-ttu-id="4df34-156">Instrumentation is the only way you can know that something is wrong, and to diagnose what needs to be fixed.</span><span class="sxs-lookup"><span data-stu-id="4df34-156">Instrumentation is the only way you can know that something is wrong, and to diagnose what needs to be fixed.</span></span> <span data-ttu-id="4df34-157">Although technically it's possible to connect a debugger to a production service, it's not a common practice.</span><span class="sxs-lookup"><span data-stu-id="4df34-157">Although technically it's possible to connect a debugger to a production service, it's not a common practice.</span></span> <span data-ttu-id="4df34-158">So, having detailed instrumentation data is important.</span><span class="sxs-lookup"><span data-stu-id="4df34-158">So, having detailed instrumentation data is important.</span></span> <span data-ttu-id="4df34-159">When you're producing this volume of information, shipping all events off the local node can be expensive.</span><span class="sxs-lookup"><span data-stu-id="4df34-159">When you're producing this volume of information, shipping all events off the local node can be expensive.</span></span> <span data-ttu-id="4df34-160">Many services use a two-part strategy for dealing with the volume of instrumentation data:</span><span class="sxs-lookup"><span data-stu-id="4df34-160">Many services use a two-part strategy for dealing with the volume of instrumentation data:</span></span>
1.  <span data-ttu-id="4df34-161">All events are kept in a local rolling log file for a short interval, and are collected only when needed for debugging.</span><span class="sxs-lookup"><span data-stu-id="4df34-161">All events are kept in a local rolling log file for a short interval, and are collected only when needed for debugging.</span></span> <span data-ttu-id="4df34-162">Usually, the events needed for detailed diagnosis are left on the node to reduce costs and resource utilization.</span><span class="sxs-lookup"><span data-stu-id="4df34-162">Usually, the events needed for detailed diagnosis are left on the node to reduce costs and resource utilization.</span></span>
2.  <span data-ttu-id="4df34-163">Any events that indicate service health are sent to a central repository, where they can be used to raise alerts of an unhealthy service.</span><span class="sxs-lookup"><span data-stu-id="4df34-163">Any events that indicate service health are sent to a central repository, where they can be used to raise alerts of an unhealthy service.</span></span> <span data-ttu-id="4df34-164">Service-health events include error events, heartbeat events, and performance events.</span><span class="sxs-lookup"><span data-stu-id="4df34-164">Service-health events include error events, heartbeat events, and performance events.</span></span>

<span data-ttu-id="4df34-165">Some products automatically instrument your code.</span><span class="sxs-lookup"><span data-stu-id="4df34-165">Some products automatically instrument your code.</span></span> <span data-ttu-id="4df34-166">Although these solutions can work well, manual instrumentation is almost always required.</span><span class="sxs-lookup"><span data-stu-id="4df34-166">Although these solutions can work well, manual instrumentation is almost always required.</span></span> <span data-ttu-id="4df34-167">In the end, you must have enough information to forensically debug the application.</span><span class="sxs-lookup"><span data-stu-id="4df34-167">In the end, you must have enough information to forensically debug the application.</span></span> <span data-ttu-id="4df34-168">The next sections describe different approaches to instrumenting your code, and when to choose one approach over another.</span><span class="sxs-lookup"><span data-stu-id="4df34-168">The next sections describe different approaches to instrumenting your code, and when to choose one approach over another.</span></span>

### <a name="eventsource"></a><span data-ttu-id="4df34-169">EventSource</span><span class="sxs-lookup"><span data-stu-id="4df34-169">EventSource</span></span>

<span data-ttu-id="4df34-170">When you create a Service Fabric solution from a template in Visual Studio, an **EventSource**-derived class (**ServiceEventSource** or **ActorEventSource**) is generated.</span><span class="sxs-lookup"><span data-stu-id="4df34-170">When you create a Service Fabric solution from a template in Visual Studio, an **EventSource**-derived class (**ServiceEventSource** or **ActorEventSource**) is generated.</span></span> <span data-ttu-id="4df34-171">A template is created, in which you can add events for your application or service.</span><span class="sxs-lookup"><span data-stu-id="4df34-171">A template is created, in which you can add events for your application or service.</span></span> <span data-ttu-id="4df34-172">The **EventSource** name **must** be unique, and should be renamed from the default template string MyCompany-&lt;solution&gt;-&lt;project&gt;.</span><span class="sxs-lookup"><span data-stu-id="4df34-172">The **EventSource** name **must** be unique, and should be renamed from the default template string MyCompany-&lt;solution&gt;-&lt;project&gt;.</span></span> <span data-ttu-id="4df34-173">Having multiple **EventSource** definitions that use the same name causes an issue at run time.</span><span class="sxs-lookup"><span data-stu-id="4df34-173">Having multiple **EventSource** definitions that use the same name causes an issue at run time.</span></span> <span data-ttu-id="4df34-174">Each defined event must have a unique identifier.</span><span class="sxs-lookup"><span data-stu-id="4df34-174">Each defined event must have a unique identifier.</span></span> <span data-ttu-id="4df34-175">If an identifier is not unique, a runtime failure occurs.</span><span class="sxs-lookup"><span data-stu-id="4df34-175">If an identifier is not unique, a runtime failure occurs.</span></span> <span data-ttu-id="4df34-176">Some organizations preassign ranges of values for identifiers to avoid conflicts between separate development teams.</span><span class="sxs-lookup"><span data-stu-id="4df34-176">Some organizations preassign ranges of values for identifiers to avoid conflicts between separate development teams.</span></span> <span data-ttu-id="4df34-177">For more information, see [Vance's blog](https://blogs.msdn.microsoft.com/vancem/2012/07/09/introduction-tutorial-logging-etw-events-in-c-system-diagnostics-tracing-eventsource/) or the [MSDN documentation](https://msdn.microsoft.com/library/dn774985(v=pandp.20).aspx).</span><span class="sxs-lookup"><span data-stu-id="4df34-177">For more information, see [Vance's blog](https://blogs.msdn.microsoft.com/vancem/2012/07/09/introduction-tutorial-logging-etw-events-in-c-system-diagnostics-tracing-eventsource/) or the [MSDN documentation](https://msdn.microsoft.com/library/dn774985(v=pandp.20).aspx).</span></span>

#### <a name="using-structured-eventsource-events"></a><span data-ttu-id="4df34-178">Using structured EventSource events</span><span class="sxs-lookup"><span data-stu-id="4df34-178">Using structured EventSource events</span></span>

<span data-ttu-id="4df34-179">Each of the events in the code examples in this section are defined for a specific case, for example, when a service type is registered.</span><span class="sxs-lookup"><span data-stu-id="4df34-179">Each of the events in the code examples in this section are defined for a specific case, for example, when a service type is registered.</span></span> <span data-ttu-id="4df34-180">When you define messages by use case, data can be packaged with the text of the error, and you can more easily search and filter based on the names or values of the specified properties.</span><span class="sxs-lookup"><span data-stu-id="4df34-180">When you define messages by use case, data can be packaged with the text of the error, and you can more easily search and filter based on the names or values of the specified properties.</span></span> <span data-ttu-id="4df34-181">Structuring the instrumentation output makes it easier to consume, but requires more thought and time to define a new event for each use case.</span><span class="sxs-lookup"><span data-stu-id="4df34-181">Structuring the instrumentation output makes it easier to consume, but requires more thought and time to define a new event for each use case.</span></span> <span data-ttu-id="4df34-182">Some event definitions can be shared across the entire application.</span><span class="sxs-lookup"><span data-stu-id="4df34-182">Some event definitions can be shared across the entire application.</span></span> <span data-ttu-id="4df34-183">For example, a method start or stop event would be reused across many services within an application.</span><span class="sxs-lookup"><span data-stu-id="4df34-183">For example, a method start or stop event would be reused across many services within an application.</span></span> <span data-ttu-id="4df34-184">A domain-specific service, like an order system, might have a **CreateOrder** event, which has its own unique event.</span><span class="sxs-lookup"><span data-stu-id="4df34-184">A domain-specific service, like an order system, might have a **CreateOrder** event, which has its own unique event.</span></span> <span data-ttu-id="4df34-185">This approach might generate many events, and potentially require coordination of identifiers across project teams.</span><span class="sxs-lookup"><span data-stu-id="4df34-185">This approach might generate many events, and potentially require coordination of identifiers across project teams.</span></span> <span data-ttu-id="4df34-186">For a complete example of structure **EventSource** events in Service Fabric, see the **PartyCluster.ApplicationDeployService** event in the Party Cluster sample.</span><span class="sxs-lookup"><span data-stu-id="4df34-186">For a complete example of structure **EventSource** events in Service Fabric, see the **PartyCluster.ApplicationDeployService** event in the Party Cluster sample.</span></span>

```csharp
    [EventSource(Name = "MyCompany-VotingState-VotingStateService")]
    internal sealed class ServiceEventSource : EventSource
    {
        public static readonly ServiceEventSource Current = new ServiceEventSource();

        // The instance constructor is private to enforce singleton semantics.
        private ServiceEventSource() : base() { }

        ...

        // The ServiceTypeRegistered event contains a unique identifier, an event attribute that defined the event, and the code implementation of the event.
        private const int ServiceTypeRegisteredEventId = 3;
        [Event(ServiceTypeRegisteredEventId, Level = EventLevel.Informational, Message = "Service host process {0} registered service type {1}", Keywords = Keywords.ServiceInitialization)]
        public void ServiceTypeRegistered(int hostProcessId, string serviceType)
        {
            WriteEvent(ServiceTypeRegisteredEventId, hostProcessId, serviceType);
        }

        // The ServiceHostInitializationFailed event contains a unique identifier, an event attribute that defined the event, and the code implementation of the event.
        private const int ServiceHostInitializationFailedEventId = 4;
        [Event(ServiceHostInitializationFailedEventId, Level = EventLevel.Error, Message = "Service host initialization failed", Keywords = Keywords.ServiceInitialization)]
        public void ServiceHostInitializationFailed(string exception)
        {
            WriteEvent(ServiceHostInitializationFailedEventId, exception);
        }
```

#### <a name="using-eventsource-generically"></a><span data-ttu-id="4df34-187">Using EventSource generically</span><span class="sxs-lookup"><span data-stu-id="4df34-187">Using EventSource generically</span></span>

<span data-ttu-id="4df34-188">Because defining specific events can be difficult, many people define a few events with a common set of parameters that generally output their information as a string.</span><span class="sxs-lookup"><span data-stu-id="4df34-188">Because defining specific events can be difficult, many people define a few events with a common set of parameters that generally output their information as a string.</span></span> <span data-ttu-id="4df34-189">Much of the structured aspect is lost, and it's more difficult to search and filter the results.</span><span class="sxs-lookup"><span data-stu-id="4df34-189">Much of the structured aspect is lost, and it's more difficult to search and filter the results.</span></span> <span data-ttu-id="4df34-190">In this approach, a few events that usually correspond to the logging levels are defined.</span><span class="sxs-lookup"><span data-stu-id="4df34-190">In this approach, a few events that usually correspond to the logging levels are defined.</span></span> <span data-ttu-id="4df34-191">The following snippet defines a debug and error message:</span><span class="sxs-lookup"><span data-stu-id="4df34-191">The following snippet defines a debug and error message:</span></span>

```csharp
    [EventSource(Name = "MyCompany-VotingState-VotingStateService")]
    internal sealed class ServiceEventSource : EventSource
    {
        public static readonly ServiceEventSource Current = new ServiceEventSource();

        // The Instance constructor is private, to enforce singleton semantics.
        private ServiceEventSource() : base() { }

        ...

        private const int DebugEventId = 10;
        [Event(DebugEventId, Level = EventLevel.Verbose, Message = "{0}")]
        public void Debug(string msg)
        {
            WriteEvent(DebugEventId, msg);
        }

        private const int ErrorEventId = 11;
        [Event(ErrorEventId, Level = EventLevel.Error, Message = "Error: {0} - {1}")]
        public void Error(string error, string msg)
        {
            WriteEvent(ErrorEventId, error, msg);
        }
```

<span data-ttu-id="4df34-192">Using a hybrid of structured and generic instrumentation also can work well.</span><span class="sxs-lookup"><span data-stu-id="4df34-192">Using a hybrid of structured and generic instrumentation also can work well.</span></span> <span data-ttu-id="4df34-193">Structured instrumentation is used for reporting errors and metrics.</span><span class="sxs-lookup"><span data-stu-id="4df34-193">Structured instrumentation is used for reporting errors and metrics.</span></span> <span data-ttu-id="4df34-194">Generic events can be used for the detailed logging that is consumed by engineers for troubleshooting.</span><span class="sxs-lookup"><span data-stu-id="4df34-194">Generic events can be used for the detailed logging that is consumed by engineers for troubleshooting.</span></span>

### <a name="aspnet-core-logging"></a><span data-ttu-id="4df34-195">ASP.NET Core logging</span><span class="sxs-lookup"><span data-stu-id="4df34-195">ASP.NET Core logging</span></span>

<span data-ttu-id="4df34-196">It's important to carefully plan how you will instrument your code.</span><span class="sxs-lookup"><span data-stu-id="4df34-196">It's important to carefully plan how you will instrument your code.</span></span> <span data-ttu-id="4df34-197">The right instrumentation plan can help you avoid potentially destabilizing your code base, and then needing to reinstrument the code.</span><span class="sxs-lookup"><span data-stu-id="4df34-197">The right instrumentation plan can help you avoid potentially destabilizing your code base, and then needing to reinstrument the code.</span></span> <span data-ttu-id="4df34-198">To reduce risk, you can choose an instrumentation library like [Microsoft.Extensions.Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging/), which is part of Microsoft ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="4df34-198">To reduce risk, you can choose an instrumentation library like [Microsoft.Extensions.Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging/), which is part of Microsoft ASP.NET Core.</span></span> <span data-ttu-id="4df34-199">ASP.NET Core has an [ILogger](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.logging.ilogger) interface that you can use with the provider of your choice, while minimizing the effect on existing code.</span><span class="sxs-lookup"><span data-stu-id="4df34-199">ASP.NET Core has an [ILogger](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.logging.ilogger) interface that you can use with the provider of your choice, while minimizing the effect on existing code.</span></span> <span data-ttu-id="4df34-200">You can use the code in ASP.NET Core on Windows and Linux, and in the full .NET Framework, so your instrumentation code is standardized.</span><span class="sxs-lookup"><span data-stu-id="4df34-200">You can use the code in ASP.NET Core on Windows and Linux, and in the full .NET Framework, so your instrumentation code is standardized.</span></span>

#### <a name="using-microsoftextensionslogging-in-service-fabric"></a><span data-ttu-id="4df34-201">Using Microsoft.Extensions.Logging in Service Fabric</span><span class="sxs-lookup"><span data-stu-id="4df34-201">Using Microsoft.Extensions.Logging in Service Fabric</span></span>

1. <span data-ttu-id="4df34-202">Add the Microsoft.Extensions.Logging NuGet package to the project you want to instrument.</span><span class="sxs-lookup"><span data-stu-id="4df34-202">Add the Microsoft.Extensions.Logging NuGet package to the project you want to instrument.</span></span> <span data-ttu-id="4df34-203">Also, add any provider packages (for a third-party package, see the following example).</span><span class="sxs-lookup"><span data-stu-id="4df34-203">Also, add any provider packages (for a third-party package, see the following example).</span></span> <span data-ttu-id="4df34-204">For more information, see [Logging in ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/logging).</span><span class="sxs-lookup"><span data-stu-id="4df34-204">For more information, see [Logging in ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/logging).</span></span>
2. <span data-ttu-id="4df34-205">Add a **using** directive for Microsoft.Extensions.Logging to your service file.</span><span class="sxs-lookup"><span data-stu-id="4df34-205">Add a **using** directive for Microsoft.Extensions.Logging to your service file.</span></span>
3. <span data-ttu-id="4df34-206">Define a private variable within your service class.</span><span class="sxs-lookup"><span data-stu-id="4df34-206">Define a private variable within your service class.</span></span>

  ```csharp
  private ILogger _logger = null;

  ```
4. <span data-ttu-id="4df34-207">In the constructor of your service class, add this code.</span><span class="sxs-lookup"><span data-stu-id="4df34-207">In the constructor of your service class, add this code.</span></span>

  ```csharp
  _logger = new LoggerFactory().CreateLogger<Stateless>();

  ```
5. <span data-ttu-id="4df34-208">Start instrumenting your code in your methods.</span><span class="sxs-lookup"><span data-stu-id="4df34-208">Start instrumenting your code in your methods.</span></span> <span data-ttu-id="4df34-209">Here are a few samples:</span><span class="sxs-lookup"><span data-stu-id="4df34-209">Here are a few samples:</span></span>

  ```csharp
  _logger.LogDebug("Debug-level event from Microsoft.Logging");
  _logger.LogInformation("Informational-level event from Microsoft.Logging");

  // In this variant, we're adding structured properties RequestName and Duration, which have values MyRequest and the duration of the request.
  // Later in the article, we discuss why this step is useful.
  _logger.LogInformation("{RequestName} {Duration}", "MyRequest", requestDuration);

  ```

#### <a name="using-other-logging-providers"></a><span data-ttu-id="4df34-210">Using other logging providers</span><span class="sxs-lookup"><span data-stu-id="4df34-210">Using other logging providers</span></span>

<span data-ttu-id="4df34-211">Some third-party providers use the approach described in the preceding section, including [Serilog](https://serilog.net/), [NLog](http://nlog-project.org/), and [Loggr](https://github.com/imobile3/Loggr.Extensions.Logging).</span><span class="sxs-lookup"><span data-stu-id="4df34-211">Some third-party providers use the approach described in the preceding section, including [Serilog](https://serilog.net/), [NLog](http://nlog-project.org/), and [Loggr](https://github.com/imobile3/Loggr.Extensions.Logging).</span></span> <span data-ttu-id="4df34-212">You can plug each of these into ASP.NET Core logging, or you can use them separately.</span><span class="sxs-lookup"><span data-stu-id="4df34-212">You can plug each of these into ASP.NET Core logging, or you can use them separately.</span></span> <span data-ttu-id="4df34-213">Serilog has a feature that enriches all messages sent from a logger.</span><span class="sxs-lookup"><span data-stu-id="4df34-213">Serilog has a feature that enriches all messages sent from a logger.</span></span> <span data-ttu-id="4df34-214">This feature can be useful to output the service name, type, and partition information.</span><span class="sxs-lookup"><span data-stu-id="4df34-214">This feature can be useful to output the service name, type, and partition information.</span></span> <span data-ttu-id="4df34-215">To use this capability in the ASP.NET Core infrastructure, do these steps:</span><span class="sxs-lookup"><span data-stu-id="4df34-215">To use this capability in the ASP.NET Core infrastructure, do these steps:</span></span>

1. <span data-ttu-id="4df34-216">Add the Serilog, Serilog.Extensions.Logging, and Serilog.Sinks.Observable NuGet packages to the project.</span><span class="sxs-lookup"><span data-stu-id="4df34-216">Add the Serilog, Serilog.Extensions.Logging, and Serilog.Sinks.Observable NuGet packages to the project.</span></span> <span data-ttu-id="4df34-217">For the next example, also add Serilog.Sinks.Literate.</span><span class="sxs-lookup"><span data-stu-id="4df34-217">For the next example, also add Serilog.Sinks.Literate.</span></span> <span data-ttu-id="4df34-218">A better approach is shown later in this article.</span><span class="sxs-lookup"><span data-stu-id="4df34-218">A better approach is shown later in this article.</span></span>
2. <span data-ttu-id="4df34-219">In Serilog, create a LoggerConfiguration and the logger instance.</span><span class="sxs-lookup"><span data-stu-id="4df34-219">In Serilog, create a LoggerConfiguration and the logger instance.</span></span>

  ```csharp
  Log.Logger = new LoggerConfiguration().WriteTo.LiterateConsole().CreateLogger();
  ```

3. <span data-ttu-id="4df34-220">Add a Serilog.ILogger argument to the service constructor, and pass the newly created logger.</span><span class="sxs-lookup"><span data-stu-id="4df34-220">Add a Serilog.ILogger argument to the service constructor, and pass the newly created logger.</span></span>

  ```csharp
  ServiceRuntime.RegisterServiceAsync("StatelessType", context => new Stateless(context, Log.Logger)).GetAwaiter().GetResult();
  ```

4. <span data-ttu-id="4df34-221">In the service constructor, add the following code.</span><span class="sxs-lookup"><span data-stu-id="4df34-221">In the service constructor, add the following code.</span></span> <span data-ttu-id="4df34-222">The code creates the property enrichers for the **ServiceTypeName**, **ServiceName**, **PartitionId**, and **InstanceId** properties of the service.</span><span class="sxs-lookup"><span data-stu-id="4df34-222">The code creates the property enrichers for the **ServiceTypeName**, **ServiceName**, **PartitionId**, and **InstanceId** properties of the service.</span></span> <span data-ttu-id="4df34-223">It also adds a property enricher to the ASP.NET Core logging factory, so you can use Microsoft.Extensions.Logging.ILogger in your code.</span><span class="sxs-lookup"><span data-stu-id="4df34-223">It also adds a property enricher to the ASP.NET Core logging factory, so you can use Microsoft.Extensions.Logging.ILogger in your code.</span></span>

  ```csharp
  public Stateless(StatelessServiceContext context, Serilog.ILogger serilog)
      : base(context)
  {
      PropertyEnricher[] properties = new PropertyEnricher[]
      {
          new PropertyEnricher("ServiceTypeName", context.ServiceTypeName),
          new PropertyEnricher("ServiceName", context.ServiceName),
          new PropertyEnricher("PartitionId", context.PartitionId),
          new PropertyEnricher("InstanceId", context.ReplicaOrInstanceId),
      };

      serilog.ForContext(properties);

      _logger = new LoggerFactory().AddSerilog(serilog.ForContext(properties)).CreateLogger<Stateless>();
  }
  ```

5. <span data-ttu-id="4df34-224">Instrument the code the same as if you were using ASP.NET Core without Serilog.</span><span class="sxs-lookup"><span data-stu-id="4df34-224">Instrument the code the same as if you were using ASP.NET Core without Serilog.</span></span>

  > [!NOTE]
  > <span data-ttu-id="4df34-225">We recommend that you don't use the static Log.Logger with the preceding example.</span><span class="sxs-lookup"><span data-stu-id="4df34-225">We recommend that you don't use the static Log.Logger with the preceding example.</span></span> <span data-ttu-id="4df34-226">Service Fabric can host multiple instances of the same service type within a single process.</span><span class="sxs-lookup"><span data-stu-id="4df34-226">Service Fabric can host multiple instances of the same service type within a single process.</span></span> <span data-ttu-id="4df34-227">If you use the static Log.Logger, the last writer of the property enrichers will show values for all instances that are running.</span><span class="sxs-lookup"><span data-stu-id="4df34-227">If you use the static Log.Logger, the last writer of the property enrichers will show values for all instances that are running.</span></span> <span data-ttu-id="4df34-228">This is one reason why the _logger variable is a private member variable of the service class.</span><span class="sxs-lookup"><span data-stu-id="4df34-228">This is one reason why the _logger variable is a private member variable of the service class.</span></span> <span data-ttu-id="4df34-229">Also, you must make the _logger available to common code, which might be used across services.</span><span class="sxs-lookup"><span data-stu-id="4df34-229">Also, you must make the _logger available to common code, which might be used across services.</span></span>

### <a name="choosing-a-logging-provider"></a><span data-ttu-id="4df34-230">Choosing a logging provider</span><span class="sxs-lookup"><span data-stu-id="4df34-230">Choosing a logging provider</span></span>

<span data-ttu-id="4df34-231">If your application relies on high performance, **EventSource** is the best approach to use.</span><span class="sxs-lookup"><span data-stu-id="4df34-231">If your application relies on high performance, **EventSource** is the best approach to use.</span></span> <span data-ttu-id="4df34-232">**EventSource** *generally* uses fewer resources and performs better than ASP.NET Core logging or any of the available third-party solutions.</span><span class="sxs-lookup"><span data-stu-id="4df34-232">**EventSource** *generally* uses fewer resources and performs better than ASP.NET Core logging or any of the available third-party solutions.</span></span>  <span data-ttu-id="4df34-233">This isn't an issue for many services, but if your service is performance-oriented, using **EventSource** might be a better choice.</span><span class="sxs-lookup"><span data-stu-id="4df34-233">This isn't an issue for many services, but if your service is performance-oriented, using **EventSource** might be a better choice.</span></span> <span data-ttu-id="4df34-234">To get the same benefits of structured logging, **EventSource** requires a large investment from your engineering team.</span><span class="sxs-lookup"><span data-stu-id="4df34-234">To get the same benefits of structured logging, **EventSource** requires a large investment from your engineering team.</span></span> <span data-ttu-id="4df34-235">To determine the approach to use for your project, do a quick prototype of what each option entails, and then choose the one that best meets your needs.</span><span class="sxs-lookup"><span data-stu-id="4df34-235">To determine the approach to use for your project, do a quick prototype of what each option entails, and then choose the one that best meets your needs.</span></span>

## <a name="event-and-log-collection"></a><span data-ttu-id="4df34-236">Event and log collection</span><span class="sxs-lookup"><span data-stu-id="4df34-236">Event and log collection</span></span>

### <a name="azure-diagnostics"></a><span data-ttu-id="4df34-237">Azure Diagnostics</span><span class="sxs-lookup"><span data-stu-id="4df34-237">Azure Diagnostics</span></span>

<span data-ttu-id="4df34-238">In addition to the information that Azure Monitor provides, Azure collects events from each of the services at a central location.</span><span class="sxs-lookup"><span data-stu-id="4df34-238">In addition to the information that Azure Monitor provides, Azure collects events from each of the services at a central location.</span></span> <span data-ttu-id="4df34-239">For more information, learn how to configure event collection for [Windows](service-fabric-diagnostics-how-to-setup-wad.md) and [Linux](service-fabric-diagnostics-how-to-setup-lad.md).</span><span class="sxs-lookup"><span data-stu-id="4df34-239">For more information, learn how to configure event collection for [Windows](service-fabric-diagnostics-how-to-setup-wad.md) and [Linux](service-fabric-diagnostics-how-to-setup-lad.md).</span></span> <span data-ttu-id="4df34-240">These articles show how you can collect the event data and send it to Azure storage.</span><span class="sxs-lookup"><span data-stu-id="4df34-240">These articles show how you can collect the event data and send it to Azure storage.</span></span> <span data-ttu-id="4df34-241">You can do this in the Azure portal or in your Azure Resource Manager template by enabling diagnostics.</span><span class="sxs-lookup"><span data-stu-id="4df34-241">You can do this in the Azure portal or in your Azure Resource Manager template by enabling diagnostics.</span></span> <span data-ttu-id="4df34-242">Azure Diagnostics collects a few event sources that Service Fabric automatically produces:</span><span class="sxs-lookup"><span data-stu-id="4df34-242">Azure Diagnostics collects a few event sources that Service Fabric automatically produces:</span></span>

- <span data-ttu-id="4df34-243">**EventSource** events and performance counters when you use the Reliable Actor programming model.</span><span class="sxs-lookup"><span data-stu-id="4df34-243">**EventSource** events and performance counters when you use the Reliable Actor programming model.</span></span> <span data-ttu-id="4df34-244">The events are enumerated in [Diagnostics and performance monitoring for Reliable Actors](service-fabric-reliable-actors-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="4df34-244">The events are enumerated in [Diagnostics and performance monitoring for Reliable Actors](service-fabric-reliable-actors-diagnostics.md).</span></span>
- <span data-ttu-id="4df34-245">**EventSource** events when you use the Reliable Services programming model.</span><span class="sxs-lookup"><span data-stu-id="4df34-245">**EventSource** events when you use the Reliable Services programming model.</span></span> <span data-ttu-id="4df34-246">The events are enumerated in [Diagnostic functionality for stateful Reliable Services](service-fabric-reliable-services-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="4df34-246">The events are enumerated in [Diagnostic functionality for stateful Reliable Services](service-fabric-reliable-services-diagnostics.md).</span></span>
- <span data-ttu-id="4df34-247">System events are emitted as Event Tracing for Windows (ETW) events.</span><span class="sxs-lookup"><span data-stu-id="4df34-247">System events are emitted as Event Tracing for Windows (ETW) events.</span></span> <span data-ttu-id="4df34-248">Many events are emitted from Service Fabric as part of this category, including service placement and start/stop events.</span><span class="sxs-lookup"><span data-stu-id="4df34-248">Many events are emitted from Service Fabric as part of this category, including service placement and start/stop events.</span></span> <span data-ttu-id="4df34-249">The best way to see the events that are emitted is to use the [Visual Studio Diagnostic Events Viewer](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md) on your local machine.</span><span class="sxs-lookup"><span data-stu-id="4df34-249">The best way to see the events that are emitted is to use the [Visual Studio Diagnostic Events Viewer](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md) on your local machine.</span></span> <span data-ttu-id="4df34-250">Because these events are native ETW events, there are some limitations on how they can be collected.</span><span class="sxs-lookup"><span data-stu-id="4df34-250">Because these events are native ETW events, there are some limitations on how they can be collected.</span></span>
- <span data-ttu-id="4df34-251">As of the 5.4 release of Service Fabric, health and load metric events are exposed.</span><span class="sxs-lookup"><span data-stu-id="4df34-251">As of the 5.4 release of Service Fabric, health and load metric events are exposed.</span></span> <span data-ttu-id="4df34-252">This way, you can use event collection for historical reporting and alerting.</span><span class="sxs-lookup"><span data-stu-id="4df34-252">This way, you can use event collection for historical reporting and alerting.</span></span> <span data-ttu-id="4df34-253">These events also are native ETW events, and have some limitations on how they can be collected.</span><span class="sxs-lookup"><span data-stu-id="4df34-253">These events also are native ETW events, and have some limitations on how they can be collected.</span></span>

<span data-ttu-id="4df34-254">When configured, events appear in an Azure storage account that was created when you created the cluster, assuming that you enabled diagnostics.</span><span class="sxs-lookup"><span data-stu-id="4df34-254">When configured, events appear in an Azure storage account that was created when you created the cluster, assuming that you enabled diagnostics.</span></span> <span data-ttu-id="4df34-255">The tables are named WADServiceFabricReliableActorEventTable, WADServiceFabricReliableServiceEventTable, and WADServiceFabricSystemEventTable.</span><span class="sxs-lookup"><span data-stu-id="4df34-255">The tables are named WADServiceFabricReliableActorEventTable, WADServiceFabricReliableServiceEventTable, and WADServiceFabricSystemEventTable.</span></span> <span data-ttu-id="4df34-256">Health events are not added by default; you must modify the Resource Manager template to add them.</span><span class="sxs-lookup"><span data-stu-id="4df34-256">Health events are not added by default; you must modify the Resource Manager template to add them.</span></span> <span data-ttu-id="4df34-257">For more information, see [Collect logs by using Azure Diagnostics](service-fabric-diagnostics-how-to-setup-wad.md).</span><span class="sxs-lookup"><span data-stu-id="4df34-257">For more information, see [Collect logs by using Azure Diagnostics](service-fabric-diagnostics-how-to-setup-wad.md).</span></span>

<span data-ttu-id="4df34-258">These articles listed in this section also can show you how to get custom events into Azure storage.</span><span class="sxs-lookup"><span data-stu-id="4df34-258">These articles listed in this section also can show you how to get custom events into Azure storage.</span></span> <span data-ttu-id="4df34-259">Other Azure Diagnostics articles about configuring performance counters, or articles that have other monitoring information from virtual machines to Azure Diagnostics also apply to a Service Fabric cluster.</span><span class="sxs-lookup"><span data-stu-id="4df34-259">Other Azure Diagnostics articles about configuring performance counters, or articles that have other monitoring information from virtual machines to Azure Diagnostics also apply to a Service Fabric cluster.</span></span> <span data-ttu-id="4df34-260">For instance, if you don't want to use Azure Table storage as a destination, see [Streaming Azure Diagnostics data in the hot path by using Event Hubs](../event-hubs/event-hubs-streaming-azure-diags-data.md).</span><span class="sxs-lookup"><span data-stu-id="4df34-260">For instance, if you don't want to use Azure Table storage as a destination, see [Streaming Azure Diagnostics data in the hot path by using Event Hubs](../event-hubs/event-hubs-streaming-azure-diags-data.md).</span></span> <span data-ttu-id="4df34-261">When the events are in Azure Event Hubs, you can read them and send them to the location you choose.</span><span class="sxs-lookup"><span data-stu-id="4df34-261">When the events are in Azure Event Hubs, you can read them and send them to the location you choose.</span></span> <span data-ttu-id="4df34-262">You can get more information about integrating [Azure diagnostic information with Application Insights](https://azure.microsoft.com/blog/azure-diagnostics-integration-with-application-insights/).</span><span class="sxs-lookup"><span data-stu-id="4df34-262">You can get more information about integrating [Azure diagnostic information with Application Insights](https://azure.microsoft.com/blog/azure-diagnostics-integration-with-application-insights/).</span></span>

<span data-ttu-id="4df34-263">A disadvantage of using Azure Diagnostics is that you set it up by using a Resource Manager template.</span><span class="sxs-lookup"><span data-stu-id="4df34-263">A disadvantage of using Azure Diagnostics is that you set it up by using a Resource Manager template.</span></span> <span data-ttu-id="4df34-264">Diagnostics, then, occurs only at the virtual machine scale set level.</span><span class="sxs-lookup"><span data-stu-id="4df34-264">Diagnostics, then, occurs only at the virtual machine scale set level.</span></span> <span data-ttu-id="4df34-265">A virtual machine scale set corresponds to a node type in Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="4df34-265">A virtual machine scale set corresponds to a node type in Service Fabric.</span></span> <span data-ttu-id="4df34-266">You configure each node type for all the applications and services that might run on a node of that type.</span><span class="sxs-lookup"><span data-stu-id="4df34-266">You configure each node type for all the applications and services that might run on a node of that type.</span></span> <span data-ttu-id="4df34-267">This might be many **EventSource** events, depending on the number of applications and services you configure.</span><span class="sxs-lookup"><span data-stu-id="4df34-267">This might be many **EventSource** events, depending on the number of applications and services you configure.</span></span> <span data-ttu-id="4df34-268">You also must deploy Resource Manager any time an application configuration changes.</span><span class="sxs-lookup"><span data-stu-id="4df34-268">You also must deploy Resource Manager any time an application configuration changes.</span></span> <span data-ttu-id="4df34-269">Ideally, the monitoring configuration would travel with the service configuration.</span><span class="sxs-lookup"><span data-stu-id="4df34-269">Ideally, the monitoring configuration would travel with the service configuration.</span></span>

<span data-ttu-id="4df34-270">Azure Diagnostics works only for Service Fabric clusters deployed to Azure.</span><span class="sxs-lookup"><span data-stu-id="4df34-270">Azure Diagnostics works only for Service Fabric clusters deployed to Azure.</span></span> <span data-ttu-id="4df34-271">It works both for Windows and Linux clusters.</span><span class="sxs-lookup"><span data-stu-id="4df34-271">It works both for Windows and Linux clusters.</span></span>

### <a name="eventflow"></a><span data-ttu-id="4df34-272">EventFlow</span><span class="sxs-lookup"><span data-stu-id="4df34-272">EventFlow</span></span>

<span data-ttu-id="4df34-273">[Microsoft Diagnostics EventFlow](https://github.com/Azure/diagnostics-eventflow) can route events from a node to one or more monitoring destinations.</span><span class="sxs-lookup"><span data-stu-id="4df34-273">[Microsoft Diagnostics EventFlow](https://github.com/Azure/diagnostics-eventflow) can route events from a node to one or more monitoring destinations.</span></span> <span data-ttu-id="4df34-274">Because it is included as a NuGet package in your service project, EventFlow code and configuration travel with the service, eliminating the per-node configuration issue mentioned earlier about Azure Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="4df34-274">Because it is included as a NuGet package in your service project, EventFlow code and configuration travel with the service, eliminating the per-node configuration issue mentioned earlier about Azure Diagnostics.</span></span> <span data-ttu-id="4df34-275">EventFlow runs within your service process, and connects directly to the configured outputs.</span><span class="sxs-lookup"><span data-stu-id="4df34-275">EventFlow runs within your service process, and connects directly to the configured outputs.</span></span> <span data-ttu-id="4df34-276">Because of the direct connection, EventFlow works for Azure, container, and on-premises service deployments.</span><span class="sxs-lookup"><span data-stu-id="4df34-276">Because of the direct connection, EventFlow works for Azure, container, and on-premises service deployments.</span></span> <span data-ttu-id="4df34-277">Be careful if you run EventFlow in high-density scenarios, such as in a container, because each EventFlow pipeline makes an external connection.</span><span class="sxs-lookup"><span data-stu-id="4df34-277">Be careful if you run EventFlow in high-density scenarios, such as in a container, because each EventFlow pipeline makes an external connection.</span></span> <span data-ttu-id="4df34-278">If you host a lot of processes, you get a lot of outbound connections!</span><span class="sxs-lookup"><span data-stu-id="4df34-278">If you host a lot of processes, you get a lot of outbound connections!</span></span> <span data-ttu-id="4df34-279">This isn't as much a concern for Service Fabric applications, because all replicas of a `ServiceType` run in the same process, anf this limits the number of outbound connections.</span><span class="sxs-lookup"><span data-stu-id="4df34-279">This isn't as much a concern for Service Fabric applications, because all replicas of a `ServiceType` run in the same process, anf this limits the number of outbound connections.</span></span> <span data-ttu-id="4df34-280">EventFlow also offers event filtering, so that only the events that match the specified filter are sent.</span><span class="sxs-lookup"><span data-stu-id="4df34-280">EventFlow also offers event filtering, so that only the events that match the specified filter are sent.</span></span> <span data-ttu-id="4df34-281">For detailed information about how to use EventFlow with Service Fabric, see [Collect logs directly from an Azure Service Fabric service process](service-fabric-diagnostic-collect-logs-without-an-agent.md).</span><span class="sxs-lookup"><span data-stu-id="4df34-281">For detailed information about how to use EventFlow with Service Fabric, see [Collect logs directly from an Azure Service Fabric service process](service-fabric-diagnostic-collect-logs-without-an-agent.md).</span></span>

<span data-ttu-id="4df34-282">To use EventFlow:</span><span class="sxs-lookup"><span data-stu-id="4df34-282">To use EventFlow:</span></span>

1. <span data-ttu-id="4df34-283">Add the NuGet package to your service project.</span><span class="sxs-lookup"><span data-stu-id="4df34-283">Add the NuGet package to your service project.</span></span>
2. <span data-ttu-id="4df34-284">In the service's **Main** function, create the EventFlow pipeline, and then configure the outputs.</span><span class="sxs-lookup"><span data-stu-id="4df34-284">In the service's **Main** function, create the EventFlow pipeline, and then configure the outputs.</span></span> <span data-ttu-id="4df34-285">In the following example, we use Serilog as an output.</span><span class="sxs-lookup"><span data-stu-id="4df34-285">In the following example, we use Serilog as an output.</span></span>

  ```csharp
  internal static class Program
  {
      /// <summary>
      /// This is the entry point of the service host process.
      /// </summary>
      private static void Main()
      {
          try
          {
              using (var pipeline = ServiceFabricDiagnosticPipelineFactory.CreatePipeline("MonitoringE2E-Stateless-Pipeline"))
              {
                  Log.Logger = new LoggerConfiguration().WriteTo.EventFlow(pipeline).CreateLogger();

                  // The ServiceManifest.xml file defines one or more service type names.
                  // Registering a service maps a service type name to a .NET type.
                  // When Service Fabric creates an instance of this service type,
                  // an instance of the class is created in this host process.

                  ServiceRuntime.RegisterServiceAsync("StatelessType", context => new Stateless(context, Log.Logger)).GetAwaiter().GetResult();
                  ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless).Name);

                  // Prevents this host process from terminating, so services keep running.
                  Thread.Sleep(Timeout.Infinite);
              }
          }
          catch (Exception e)
          {
              ServiceEventSource.Current.ServiceHostInitializationFailed(e.ToString());
              throw;
          }
      }
  }
  ```

3. <span data-ttu-id="4df34-286">Create a file named eventFlowConfig.json in the service's \\PackageRoot\\Config folder.</span><span class="sxs-lookup"><span data-stu-id="4df34-286">Create a file named eventFlowConfig.json in the service's \\PackageRoot\\Config folder.</span></span> <span data-ttu-id="4df34-287">Inside the file, the configuration looks like this:</span><span class="sxs-lookup"><span data-stu-id="4df34-287">Inside the file, the configuration looks like this:</span></span>

  ```json
      {
      "inputs": [
          {
          "type": "EventSource",
          "sources": [
              { "providerName": "Microsoft-ServiceFabric-Services" },
              { "providerName": "Microsoft-ServiceFabric-Actors" },
              { "providerName": "MyCompany-MonitoringE2E-Stateless" }
          ]
          },
          {
          "type": "Serilog"
          }
      ],
      "filters": [
          {
          "type": "drop",
          "include": "Level == Verbose"
          },
          {
          "type": "metadata",
          "metadata": "request",
          "requestNameProperty": "RequestName",
          "include":  "RequestName==MyRequest",
          "durationProperty": "Duration",
          "durationUnit": "milliseconds"
          }
      ],
      "outputs": [
          {
          "type": "StdOutput"
          },
          {
          "type": "ApplicationInsights",
          "instrumentationKey": "== instrumentation key here =="
          }
      ],
      "schemaVersion": "2016-08-11",
      "extensions": []
      }
  ```
    <span data-ttu-id="4df34-288">In the configuration, two inputs are defined: the two **EventSource**-based sources that Service Fabric creates, and the **EventSource** for the service.</span><span class="sxs-lookup"><span data-stu-id="4df34-288">In the configuration, two inputs are defined: the two **EventSource**-based sources that Service Fabric creates, and the **EventSource** for the service.</span></span> <span data-ttu-id="4df34-289">The system-level and health events that use ETW are not available to EventFlow.</span><span class="sxs-lookup"><span data-stu-id="4df34-289">The system-level and health events that use ETW are not available to EventFlow.</span></span> <span data-ttu-id="4df34-290">This is because a high-level privilege is required to listen to an ETW source, and services should never run with high privileges.</span><span class="sxs-lookup"><span data-stu-id="4df34-290">This is because a high-level privilege is required to listen to an ETW source, and services should never run with high privileges.</span></span> <span data-ttu-id="4df34-291">The other input is Serilog.</span><span class="sxs-lookup"><span data-stu-id="4df34-291">The other input is Serilog.</span></span> <span data-ttu-id="4df34-292">Serilog configuration occurred in the **Main** method.</span><span class="sxs-lookup"><span data-stu-id="4df34-292">Serilog configuration occurred in the **Main** method.</span></span>  <span data-ttu-id="4df34-293">Some filters are applied.</span><span class="sxs-lookup"><span data-stu-id="4df34-293">Some filters are applied.</span></span> <span data-ttu-id="4df34-294">The first filter tells EventFlow to drop all events that have an event level of verbose.</span><span class="sxs-lookup"><span data-stu-id="4df34-294">The first filter tells EventFlow to drop all events that have an event level of verbose.</span></span> <span data-ttu-id="4df34-295">Two outputs are configured: standard output, which writes to the output window in Visual Studio, and ApplicationInsights.</span><span class="sxs-lookup"><span data-stu-id="4df34-295">Two outputs are configured: standard output, which writes to the output window in Visual Studio, and ApplicationInsights.</span></span> <span data-ttu-id="4df34-296">Make sure you add your instrumentation key.</span><span class="sxs-lookup"><span data-stu-id="4df34-296">Make sure you add your instrumentation key.</span></span>

4. <span data-ttu-id="4df34-297">Instrument the code.</span><span class="sxs-lookup"><span data-stu-id="4df34-297">Instrument the code.</span></span> <span data-ttu-id="4df34-298">In the next example, we instrument `RunAsync` a few different ways, to show examples.</span><span class="sxs-lookup"><span data-stu-id="4df34-298">In the next example, we instrument `RunAsync` a few different ways, to show examples.</span></span> <span data-ttu-id="4df34-299">In the following code, we're still using Serilog.</span><span class="sxs-lookup"><span data-stu-id="4df34-299">In the following code, we're still using Serilog.</span></span> <span data-ttu-id="4df34-300">Some of the syntax we use is specific to Serilog.</span><span class="sxs-lookup"><span data-stu-id="4df34-300">Some of the syntax we use is specific to Serilog.</span></span> <span data-ttu-id="4df34-301">Note the specific capabilities for the logging solution you choose.</span><span class="sxs-lookup"><span data-stu-id="4df34-301">Note the specific capabilities for the logging solution you choose.</span></span> <span data-ttu-id="4df34-302">Three events are generated: a debug-level event, and two informational events.</span><span class="sxs-lookup"><span data-stu-id="4df34-302">Three events are generated: a debug-level event, and two informational events.</span></span> <span data-ttu-id="4df34-303">The second informational event tracks the request duration.</span><span class="sxs-lookup"><span data-stu-id="4df34-303">The second informational event tracks the request duration.</span></span> <span data-ttu-id="4df34-304">In the configuration of EventFlow described earlier, the debug-level event should not flow to the output.</span><span class="sxs-lookup"><span data-stu-id="4df34-304">In the configuration of EventFlow described earlier, the debug-level event should not flow to the output.</span></span>

  ```csharp
      Stopwatch sw = Stopwatch.StartNew();

      while (true)
      {
          cancellationToken.ThrowIfCancellationRequested();

          sw.Restart();

          // Delay a random interval, to provide a more interesting request duration.
          await Task.Delay(TimeSpan.FromMilliseconds(DateTime.Now.Millisecond), cancellationToken);

          ServiceEventSource.Current.ServiceMessage(this.Context, "Working-{0}", ++iterations);
          _logger.LogDebug("Debug level event from Microsoft.Logging");
          _logger.LogInformation("Informational level event from Microsoft.Logging");
          _logger.LogInformation("{RequestName} {Duration}", "MyRequest", sw.ElapsedMilliseconds);
      }
  ```

<span data-ttu-id="4df34-305">To view the events in Azure Application Insights, in the Azure portal, go to your Application Insights resource.</span><span class="sxs-lookup"><span data-stu-id="4df34-305">To view the events in Azure Application Insights, in the Azure portal, go to your Application Insights resource.</span></span> <span data-ttu-id="4df34-306">To see the events, select the **Search** box.</span><span class="sxs-lookup"><span data-stu-id="4df34-306">To see the events, select the **Search** box.</span></span>

![Application Insights Search view of events](https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-fabric/media/service-fabric-diagnostics-overview/ai-search-events.PNG)

<span data-ttu-id="4df34-308">You can see the traces at the bottom of the preceding screenshot.</span><span class="sxs-lookup"><span data-stu-id="4df34-308">You can see the traces at the bottom of the preceding screenshot.</span></span> <span data-ttu-id="4df34-309">It shows only two events, and that the debug-level event was dropped by EventFlow.</span><span class="sxs-lookup"><span data-stu-id="4df34-309">It shows only two events, and that the debug-level event was dropped by EventFlow.</span></span> <span data-ttu-id="4df34-310">The request entry preceding the trace is the third `_logger` instrumentation line.</span><span class="sxs-lookup"><span data-stu-id="4df34-310">The request entry preceding the trace is the third `_logger` instrumentation line.</span></span> <span data-ttu-id="4df34-311">The line shows that the event was translated into a request metric in Application Insights.</span><span class="sxs-lookup"><span data-stu-id="4df34-311">The line shows that the event was translated into a request metric in Application Insights.</span></span>

<span data-ttu-id="4df34-312">In the filter definition, the type is **metadata**.</span><span class="sxs-lookup"><span data-stu-id="4df34-312">In the filter definition, the type is **metadata**.</span></span> <span data-ttu-id="4df34-313">This declares that an event that has a property of `RequestName` with the value `MyRequest`, and another property, `Duration`, contain the duration of the request, in milliseconds.</span><span class="sxs-lookup"><span data-stu-id="4df34-313">This declares that an event that has a property of `RequestName` with the value `MyRequest`, and another property, `Duration`, contain the duration of the request, in milliseconds.</span></span> <span data-ttu-id="4df34-314">This is what you see in the request event in Application Insights.</span><span class="sxs-lookup"><span data-stu-id="4df34-314">This is what you see in the request event in Application Insights.</span></span> <span data-ttu-id="4df34-315">The same approach works with any of the supported EventFlow inputs, including **EventSource**.</span><span class="sxs-lookup"><span data-stu-id="4df34-315">The same approach works with any of the supported EventFlow inputs, including **EventSource**.</span></span>

<span data-ttu-id="4df34-316">If you have a standalone cluster that cannot be connected to a cloud-based solution for policy reasons, you can use Elasticsearch as an output.</span><span class="sxs-lookup"><span data-stu-id="4df34-316">If you have a standalone cluster that cannot be connected to a cloud-based solution for policy reasons, you can use Elasticsearch as an output.</span></span> <span data-ttu-id="4df34-317">However, other outputs can be written, and pull requests are encouraged.</span><span class="sxs-lookup"><span data-stu-id="4df34-317">However, other outputs can be written, and pull requests are encouraged.</span></span> <span data-ttu-id="4df34-318">Some third-party providers for ASP.NET Core logging also have solutions that support on-premises installations.</span><span class="sxs-lookup"><span data-stu-id="4df34-318">Some third-party providers for ASP.NET Core logging also have solutions that support on-premises installations.</span></span>

## <a name="azure-service-fabric-health-and-load-reporting"></a><span data-ttu-id="4df34-319">Azure Service Fabric health and load reporting</span><span class="sxs-lookup"><span data-stu-id="4df34-319">Azure Service Fabric health and load reporting</span></span>

<span data-ttu-id="4df34-320">Service Fabric has its own health model, which is described in detail in these articles:</span><span class="sxs-lookup"><span data-stu-id="4df34-320">Service Fabric has its own health model, which is described in detail in these articles:</span></span>
- [<span data-ttu-id="4df34-321">Introduction to Service Fabric health monitoring</span><span class="sxs-lookup"><span data-stu-id="4df34-321">Introduction to Service Fabric health monitoring</span></span>](service-fabric-health-introduction.md)
- [<span data-ttu-id="4df34-322">Report and check service health</span><span class="sxs-lookup"><span data-stu-id="4df34-322">Report and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)
- [<span data-ttu-id="4df34-323">Add custom Service Fabric health reports</span><span class="sxs-lookup"><span data-stu-id="4df34-323">Add custom Service Fabric health reports</span></span>](service-fabric-report-health.md)
- [<span data-ttu-id="4df34-324">View Service Fabric health reports</span><span class="sxs-lookup"><span data-stu-id="4df34-324">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

<span data-ttu-id="4df34-325">Health monitoring is critical to multiple aspects of operating a service.</span><span class="sxs-lookup"><span data-stu-id="4df34-325">Health monitoring is critical to multiple aspects of operating a service.</span></span> <span data-ttu-id="4df34-326">Health monitoring is especially important when Service Fabric performs a named application upgrade.</span><span class="sxs-lookup"><span data-stu-id="4df34-326">Health monitoring is especially important when Service Fabric performs a named application upgrade.</span></span> <span data-ttu-id="4df34-327">After each upgrade domain of the service is upgraded and is available to your customers, the upgrade domain must pass health checks before the deployment moves to the next upgrade domain.</span><span class="sxs-lookup"><span data-stu-id="4df34-327">After each upgrade domain of the service is upgraded and is available to your customers, the upgrade domain must pass health checks before the deployment moves to the next upgrade domain.</span></span> <span data-ttu-id="4df34-328">If good health status cannot be achieved, the deployment is rolled back, so that the application is in a known, good state.</span><span class="sxs-lookup"><span data-stu-id="4df34-328">If good health status cannot be achieved, the deployment is rolled back, so that the application is in a known, good state.</span></span> <span data-ttu-id="4df34-329">Although some customers might be affected before the services are rolled back, most customers won't experience an issue.</span><span class="sxs-lookup"><span data-stu-id="4df34-329">Although some customers might be affected before the services are rolled back, most customers won't experience an issue.</span></span> <span data-ttu-id="4df34-330">Also, a resolution occurs relatively quickly, and without having to wait for action from a human operator.</span><span class="sxs-lookup"><span data-stu-id="4df34-330">Also, a resolution occurs relatively quickly, and without having to wait for action from a human operator.</span></span> <span data-ttu-id="4df34-331">The more health checks that are incorporated into your code, the more resilient your service is to deployment issues.</span><span class="sxs-lookup"><span data-stu-id="4df34-331">The more health checks that are incorporated into your code, the more resilient your service is to deployment issues.</span></span>

<span data-ttu-id="4df34-332">Another aspect of service health is reporting metrics from the service.</span><span class="sxs-lookup"><span data-stu-id="4df34-332">Another aspect of service health is reporting metrics from the service.</span></span> <span data-ttu-id="4df34-333">Metrics are important in Service Fabric because they are used to balance resource usage.</span><span class="sxs-lookup"><span data-stu-id="4df34-333">Metrics are important in Service Fabric because they are used to balance resource usage.</span></span> <span data-ttu-id="4df34-334">Metrics also can be an indicator of system health.</span><span class="sxs-lookup"><span data-stu-id="4df34-334">Metrics also can be an indicator of system health.</span></span> <span data-ttu-id="4df34-335">For example, you might have an application that has many services, and each instance reports a requests per second (RPS) metric.</span><span class="sxs-lookup"><span data-stu-id="4df34-335">For example, you might have an application that has many services, and each instance reports a requests per second (RPS) metric.</span></span> <span data-ttu-id="4df34-336">If one service is using more resources than another service, Service Fabric moves service instances around the cluster, to try to maintain even resource utilization.</span><span class="sxs-lookup"><span data-stu-id="4df34-336">If one service is using more resources than another service, Service Fabric moves service instances around the cluster, to try to maintain even resource utilization.</span></span> <span data-ttu-id="4df34-337">For a more detailed explanation of how resource utilization works, see [Manage resource consumption and load in Service Fabric with metrics](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="4df34-337">For a more detailed explanation of how resource utilization works, see [Manage resource consumption and load in Service Fabric with metrics](service-fabric-cluster-resource-manager-metrics.md).</span></span>

<span data-ttu-id="4df34-338">Metrics also can help give you insight into how your service is performing.</span><span class="sxs-lookup"><span data-stu-id="4df34-338">Metrics also can help give you insight into how your service is performing.</span></span> <span data-ttu-id="4df34-339">Over time, you can use metrics to check that the service is operating within expected parameters.</span><span class="sxs-lookup"><span data-stu-id="4df34-339">Over time, you can use metrics to check that the service is operating within expected parameters.</span></span> <span data-ttu-id="4df34-340">For example, if trends show that at 9 AM on Monday morning the average RPS is 1,000, then you might set up a health report that alerts you if the RPS is below 500 or above 1,500.</span><span class="sxs-lookup"><span data-stu-id="4df34-340">For example, if trends show that at 9 AM on Monday morning the average RPS is 1,000, then you might set up a health report that alerts you if the RPS is below 500 or above 1,500.</span></span> <span data-ttu-id="4df34-341">Everything might be perfectly fine, but it might be worth a look to be sure that your customers are having a great experience.</span><span class="sxs-lookup"><span data-stu-id="4df34-341">Everything might be perfectly fine, but it might be worth a look to be sure that your customers are having a great experience.</span></span> <span data-ttu-id="4df34-342">Your service can define a set of metrics that can be reported for health check purposes, but that don't affect the resource balancing of the cluster.</span><span class="sxs-lookup"><span data-stu-id="4df34-342">Your service can define a set of metrics that can be reported for health check purposes, but that don't affect the resource balancing of the cluster.</span></span> <span data-ttu-id="4df34-343">To do this, set the metric weight to zero.</span><span class="sxs-lookup"><span data-stu-id="4df34-343">To do this, set the metric weight to zero.</span></span> <span data-ttu-id="4df34-344">We recommend that you start all metrics with a weight of zero, and not increase the weight until you are sure that you understand how weighting the metrics affects resource balancing for your cluster.</span><span class="sxs-lookup"><span data-stu-id="4df34-344">We recommend that you start all metrics with a weight of zero, and not increase the weight until you are sure that you understand how weighting the metrics affects resource balancing for your cluster.</span></span>

> [!TIP]
> <span data-ttu-id="4df34-345">Don't use too many weighted metrics.</span><span class="sxs-lookup"><span data-stu-id="4df34-345">Don't use too many weighted metrics.</span></span> <span data-ttu-id="4df34-346">It can be difficult to understand why service instances are being moved around for balancing.</span><span class="sxs-lookup"><span data-stu-id="4df34-346">It can be difficult to understand why service instances are being moved around for balancing.</span></span> <span data-ttu-id="4df34-347">A few metrics can go a long way!</span><span class="sxs-lookup"><span data-stu-id="4df34-347">A few metrics can go a long way!</span></span>

<span data-ttu-id="4df34-348">Any information that can indicate the health and performance of your application is a candidate for metrics and health reports.</span><span class="sxs-lookup"><span data-stu-id="4df34-348">Any information that can indicate the health and performance of your application is a candidate for metrics and health reports.</span></span> <span data-ttu-id="4df34-349">A CPU performance counter can tell you how your node is utilized, but it doesn't tell you whether a particular service is healthy, because multiple services might be running on a single node.</span><span class="sxs-lookup"><span data-stu-id="4df34-349">A CPU performance counter can tell you how your node is utilized, but it doesn't tell you whether a particular service is healthy, because multiple services might be running on a single node.</span></span> <span data-ttu-id="4df34-350">But, metrics like RPS, items processed, and request latency all can indicate the health of a specific service.</span><span class="sxs-lookup"><span data-stu-id="4df34-350">But, metrics like RPS, items processed, and request latency all can indicate the health of a specific service.</span></span>

<span data-ttu-id="4df34-351">To report health, use code similar to this:</span><span class="sxs-lookup"><span data-stu-id="4df34-351">To report health, use code similar to this:</span></span>

  ```csharp
    if (!result.HasValue)
    {
        HealthInformation healthInformation = new HealthInformation("ServiceCode", "StateDictionary", HealthState.Error);
        this.Partition.ReportInstanceHealth(healthInformation);
    }
  ```

<span data-ttu-id="4df34-352">To report a metric, use code similar to this:</span><span class="sxs-lookup"><span data-stu-id="4df34-352">To report a metric, use code similar to this:</span></span>

  ```csharp
    this.ServicePartition.ReportLoad(new List<LoadMetric> { new LoadMetric("MemoryInMb", 1234), new LoadMetric("metric1", 42) });
  ```

## <a name="watchdogs"></a><span data-ttu-id="4df34-353">Watchdogs</span><span class="sxs-lookup"><span data-stu-id="4df34-353">Watchdogs</span></span>

<span data-ttu-id="4df34-354">A watchdog is a separate service that can watch health and load across services, and report health for anything in the health model hierarchy.</span><span class="sxs-lookup"><span data-stu-id="4df34-354">A watchdog is a separate service that can watch health and load across services, and report health for anything in the health model hierarchy.</span></span> <span data-ttu-id="4df34-355">This can help prevent errors that would not be detected based on the view of a single service.</span><span class="sxs-lookup"><span data-stu-id="4df34-355">This can help prevent errors that would not be detected based on the view of a single service.</span></span> <span data-ttu-id="4df34-356">Watchdogs also are a good place to host code that can perform remediation actions for known conditions without user interaction.</span><span class="sxs-lookup"><span data-stu-id="4df34-356">Watchdogs also are a good place to host code that can perform remediation actions for known conditions without user interaction.</span></span>

## <a name="visualization-analysis-and-alerts"></a><span data-ttu-id="4df34-357">Visualization, analysis, and alerts</span><span class="sxs-lookup"><span data-stu-id="4df34-357">Visualization, analysis, and alerts</span></span>

<span data-ttu-id="4df34-358">The final part of monitoring is visualizing the event stream, reporting on service performance, and alerting when an issue is detected.</span><span class="sxs-lookup"><span data-stu-id="4df34-358">The final part of monitoring is visualizing the event stream, reporting on service performance, and alerting when an issue is detected.</span></span> <span data-ttu-id="4df34-359">You can use different solutions for this aspect of monitoring.</span><span class="sxs-lookup"><span data-stu-id="4df34-359">You can use different solutions for this aspect of monitoring.</span></span> <span data-ttu-id="4df34-360">You can use Azure Application Insights and Operations Management Suite to alert based on the stream of events.</span><span class="sxs-lookup"><span data-stu-id="4df34-360">You can use Azure Application Insights and Operations Management Suite to alert based on the stream of events.</span></span> <span data-ttu-id="4df34-361">You can use Microsoft Power BI or a third-party solution like [Kibana](https://www.elastic.co/products/kibana) or [Splunk](https://www.splunk.com/) to visualize the data.</span><span class="sxs-lookup"><span data-stu-id="4df34-361">You can use Microsoft Power BI or a third-party solution like [Kibana](https://www.elastic.co/products/kibana) or [Splunk](https://www.splunk.com/) to visualize the data.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4df34-362">Next steps</span><span class="sxs-lookup"><span data-stu-id="4df34-362">Next steps</span></span>

* [<span data-ttu-id="4df34-363">Collect logs with Azure Diagnostics</span><span class="sxs-lookup"><span data-stu-id="4df34-363">Collect logs with Azure Diagnostics</span></span>](service-fabric-diagnostics-how-to-setup-wad.md)
* [<span data-ttu-id="4df34-364">Collect logs directly from an Azure Service Fabric service process</span><span class="sxs-lookup"><span data-stu-id="4df34-364">Collect logs directly from an Azure Service Fabric service process</span></span>](service-fabric-diagnostic-collect-logs-without-an-agent.md)
*  [<span data-ttu-id="4df34-365">Manage resource consumption and load in Service Fabric with metrics</span><span class="sxs-lookup"><span data-stu-id="4df34-365">Manage resource consumption and load in Service Fabric with metrics</span></span>](service-fabric-cluster-resource-manager-metrics.md)


