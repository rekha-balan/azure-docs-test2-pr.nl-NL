---
title: User-defined routes and IP Forwarding in Azure | Microsoft Docs
description: Learn how to configure user-defined routes (UDR) and IP Forwarding to forward traffic to network virtual appliances in Azure.
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: c9e3c280e7b7881ce35febdb810428a511e270bb
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44551502"
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="cf310-103">User-defined routes and IP forwarding</span><span class="sxs-lookup"><span data-stu-id="cf310-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="cf310-104">When you add virtual machines (VMs) to a virtual network (VNet) in Azure, you will notice that the VMs are able to communicate with each other over the network, automatically.</span><span class="sxs-lookup"><span data-stu-id="cf310-104">When you add virtual machines (VMs) to a virtual network (VNet) in Azure, you will notice that the VMs are able to communicate with each other over the network, automatically.</span></span> <span data-ttu-id="cf310-105">You do not need to specify a gateway, even though the VMs are in different subnets.</span><span class="sxs-lookup"><span data-stu-id="cf310-105">You do not need to specify a gateway, even though the VMs are in different subnets.</span></span> <span data-ttu-id="cf310-106">The same is true for communication from the VMs to the public Internet, and even to your on-premises network when a hybrid connection from Azure to your own datacenter is present.</span><span class="sxs-lookup"><span data-stu-id="cf310-106">The same is true for communication from the VMs to the public Internet, and even to your on-premises network when a hybrid connection from Azure to your own datacenter is present.</span></span>

<span data-ttu-id="cf310-107">This flow of communication is possible because Azure uses a series of system routes to define how IP traffic flows.</span><span class="sxs-lookup"><span data-stu-id="cf310-107">This flow of communication is possible because Azure uses a series of system routes to define how IP traffic flows.</span></span> <span data-ttu-id="cf310-108">System routes control the flow of communication in the following scenarios:</span><span class="sxs-lookup"><span data-stu-id="cf310-108">System routes control the flow of communication in the following scenarios:</span></span>

* <span data-ttu-id="cf310-109">From within the same subnet.</span><span class="sxs-lookup"><span data-stu-id="cf310-109">From within the same subnet.</span></span>
* <span data-ttu-id="cf310-110">From a subnet to another within a VNet.</span><span class="sxs-lookup"><span data-stu-id="cf310-110">From a subnet to another within a VNet.</span></span>
* <span data-ttu-id="cf310-111">From VMs to the Internet.</span><span class="sxs-lookup"><span data-stu-id="cf310-111">From VMs to the Internet.</span></span>
* <span data-ttu-id="cf310-112">From a VNet to another VNet through a VPN gateway.</span><span class="sxs-lookup"><span data-stu-id="cf310-112">From a VNet to another VNet through a VPN gateway.</span></span>
* <span data-ttu-id="cf310-113">From a VNet to another VNet through VNet Peering (Service Chaining).</span><span class="sxs-lookup"><span data-stu-id="cf310-113">From a VNet to another VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="cf310-114">From a VNet to your on-premises network through a VPN gateway.</span><span class="sxs-lookup"><span data-stu-id="cf310-114">From a VNet to your on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="cf310-115">The figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with the system routes that allow IP traffic to flow.</span><span class="sxs-lookup"><span data-stu-id="cf310-115">The figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with the system routes that allow IP traffic to flow.</span></span>

![System routes in Azure](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-network/media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="cf310-117">Although the use of system routes facilitates traffic automatically for your deployment, there are cases in which you want to control the routing of packets through a virtual appliance.</span><span class="sxs-lookup"><span data-stu-id="cf310-117">Although the use of system routes facilitates traffic automatically for your deployment, there are cases in which you want to control the routing of packets through a virtual appliance.</span></span> <span data-ttu-id="cf310-118">You can do so by creating user defined routes that specify the next hop for packets flowing to a specific subnet to go to your virtual appliance instead, and enabling IP forwarding for the VM running as the virtual appliance.</span><span class="sxs-lookup"><span data-stu-id="cf310-118">You can do so by creating user defined routes that specify the next hop for packets flowing to a specific subnet to go to your virtual appliance instead, and enabling IP forwarding for the VM running as the virtual appliance.</span></span>

<span data-ttu-id="cf310-119">The figure below shows an example of user defined routes and IP forwarding to force packets sent to one subnet from another to go through a virtual appliance on a third subnet.</span><span class="sxs-lookup"><span data-stu-id="cf310-119">The figure below shows an example of user defined routes and IP forwarding to force packets sent to one subnet from another to go through a virtual appliance on a third subnet.</span></span>

![System routes in Azure](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-network/media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="cf310-121">User defined routes are only applied to traffic leaving a subnet.</span><span class="sxs-lookup"><span data-stu-id="cf310-121">User defined routes are only applied to traffic leaving a subnet.</span></span> <span data-ttu-id="cf310-122">you cannot create routes to specify how traffic comes into a subnet from the Internet, for instance.</span><span class="sxs-lookup"><span data-stu-id="cf310-122">you cannot create routes to specify how traffic comes into a subnet from the Internet, for instance.</span></span> <span data-ttu-id="cf310-123">Also, the appliance you are forwarding traffic to cannot be in the same subnet where the traffic originates.</span><span class="sxs-lookup"><span data-stu-id="cf310-123">Also, the appliance you are forwarding traffic to cannot be in the same subnet where the traffic originates.</span></span> <span data-ttu-id="cf310-124">Always create a separate subnet for your appliances.</span><span class="sxs-lookup"><span data-stu-id="cf310-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="cf310-125">Route resource</span><span class="sxs-lookup"><span data-stu-id="cf310-125">Route resource</span></span>
<span data-ttu-id="cf310-126">Packets are routed over a TCP/IP network based on a route table defined at each node on the physical network.</span><span class="sxs-lookup"><span data-stu-id="cf310-126">Packets are routed over a TCP/IP network based on a route table defined at each node on the physical network.</span></span> <span data-ttu-id="cf310-127">A route table is a collection of individual routes used to decide where to forward packets based on the destination IP address.</span><span class="sxs-lookup"><span data-stu-id="cf310-127">A route table is a collection of individual routes used to decide where to forward packets based on the destination IP address.</span></span> <span data-ttu-id="cf310-128">A route consists of the following:</span><span class="sxs-lookup"><span data-stu-id="cf310-128">A route consists of the following:</span></span>

| <span data-ttu-id="cf310-129">Property</span><span class="sxs-lookup"><span data-stu-id="cf310-129">Property</span></span> | <span data-ttu-id="cf310-130">Description</span><span class="sxs-lookup"><span data-stu-id="cf310-130">Description</span></span> | <span data-ttu-id="cf310-131">Constraints</span><span class="sxs-lookup"><span data-stu-id="cf310-131">Constraints</span></span> | <span data-ttu-id="cf310-132">Considerations</span><span class="sxs-lookup"><span data-stu-id="cf310-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="cf310-133">Address Prefix</span><span class="sxs-lookup"><span data-stu-id="cf310-133">Address Prefix</span></span> |<span data-ttu-id="cf310-134">The destination CIDR to which the route applies, such as 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="cf310-134">The destination CIDR to which the route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="cf310-135">Must be a valid CIDR range representing addresses on the public Internet, Azure virtual network, or on-premises datacenter.</span><span class="sxs-lookup"><span data-stu-id="cf310-135">Must be a valid CIDR range representing addresses on the public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="cf310-136">Make sure the **Address prefix** does not contain the address for the **Next hop address**, otherwise your packets will enter in a loop going from the source to the next hop without ever reaching the destination.</span><span class="sxs-lookup"><span data-stu-id="cf310-136">Make sure the **Address prefix** does not contain the address for the **Next hop address**, otherwise your packets will enter in a loop going from the source to the next hop without ever reaching the destination.</span></span> |
| <span data-ttu-id="cf310-137">Next hop type</span><span class="sxs-lookup"><span data-stu-id="cf310-137">Next hop type</span></span> |<span data-ttu-id="cf310-138">The type of Azure hop the packet should be sent to.</span><span class="sxs-lookup"><span data-stu-id="cf310-138">The type of Azure hop the packet should be sent to.</span></span> |<span data-ttu-id="cf310-139">Must be one of the following values:</span><span class="sxs-lookup"><span data-stu-id="cf310-139">Must be one of the following values:</span></span> <br/> <span data-ttu-id="cf310-140">**Virtual Network**.</span><span class="sxs-lookup"><span data-stu-id="cf310-140">**Virtual Network**.</span></span> <span data-ttu-id="cf310-141">Represents the local virtual network.</span><span class="sxs-lookup"><span data-stu-id="cf310-141">Represents the local virtual network.</span></span> <span data-ttu-id="cf310-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in the same virtual network, the route for each subnet in the route table will have a next hop value of *Virtual Network*.</span><span class="sxs-lookup"><span data-stu-id="cf310-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in the same virtual network, the route for each subnet in the route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="cf310-143">**Virtual Network Gateway**.</span><span class="sxs-lookup"><span data-stu-id="cf310-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="cf310-144">Represents an Azure S2S VPN Gateway.</span><span class="sxs-lookup"><span data-stu-id="cf310-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="cf310-145">**Internet**.</span><span class="sxs-lookup"><span data-stu-id="cf310-145">**Internet**.</span></span> <span data-ttu-id="cf310-146">Represents the default Internet gateway provided by the Azure Infrastructure.</span><span class="sxs-lookup"><span data-stu-id="cf310-146">Represents the default Internet gateway provided by the Azure Infrastructure.</span></span> <br/> <span data-ttu-id="cf310-147">**Virtual Appliance**.</span><span class="sxs-lookup"><span data-stu-id="cf310-147">**Virtual Appliance**.</span></span> <span data-ttu-id="cf310-148">Represents a virtual appliance you added to your Azure virtual network.</span><span class="sxs-lookup"><span data-stu-id="cf310-148">Represents a virtual appliance you added to your Azure virtual network.</span></span> <br/> <span data-ttu-id="cf310-149">**None**.</span><span class="sxs-lookup"><span data-stu-id="cf310-149">**None**.</span></span> <span data-ttu-id="cf310-150">Represents a black hole.</span><span class="sxs-lookup"><span data-stu-id="cf310-150">Represents a black hole.</span></span> <span data-ttu-id="cf310-151">Packets forwarded to a black hole will not be forwarded at all.</span><span class="sxs-lookup"><span data-stu-id="cf310-151">Packets forwarded to a black hole will not be forwarded at all.</span></span> |<span data-ttu-id="cf310-152">Consider using **Virtual Appliance** to direct traffic to a VM or Azure Load Balancer internal IP address.</span><span class="sxs-lookup"><span data-stu-id="cf310-152">Consider using **Virtual Appliance** to direct traffic to a VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="cf310-153">This type allows the specification of an IP address as described below.</span><span class="sxs-lookup"><span data-stu-id="cf310-153">This type allows the specification of an IP address as described below.</span></span> <span data-ttu-id="cf310-154">Consider using a **None** type to stop packets from flowing to a given destination.</span><span class="sxs-lookup"><span data-stu-id="cf310-154">Consider using a **None** type to stop packets from flowing to a given destination.</span></span> |
| <span data-ttu-id="cf310-155">Next hop address</span><span class="sxs-lookup"><span data-stu-id="cf310-155">Next hop address</span></span> |<span data-ttu-id="cf310-156">The next hop address contains the IP address packets should be forwarded to.</span><span class="sxs-lookup"><span data-stu-id="cf310-156">The next hop address contains the IP address packets should be forwarded to.</span></span> <span data-ttu-id="cf310-157">Next hop values are only allowed in routes where the next hop type is *Virtual Appliance*.</span><span class="sxs-lookup"><span data-stu-id="cf310-157">Next hop values are only allowed in routes where the next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="cf310-158">Must be an IP address that is reachable within the Virtual Network where the User Defined Route is applied, without going through a **Virtual Network Gateway**.</span><span class="sxs-lookup"><span data-stu-id="cf310-158">Must be an IP address that is reachable within the Virtual Network where the User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="cf310-159">The IP address has to be on the same Virtual Network where it is applied, or on a peered Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="cf310-159">The IP address has to be on the same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="cf310-160">If the IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for the VM.</span><span class="sxs-lookup"><span data-stu-id="cf310-160">If the IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for the VM.</span></span> <span data-ttu-id="cf310-161">If the IP address represents the internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish to load balance.</span><span class="sxs-lookup"><span data-stu-id="cf310-161">If the IP address represents the internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish to load balance.</span></span>|

<span data-ttu-id="cf310-162">In Azure PowerShell some of the "NextHopType" values have different names:</span><span class="sxs-lookup"><span data-stu-id="cf310-162">In Azure PowerShell some of the "NextHopType" values have different names:</span></span>

* <span data-ttu-id="cf310-163">Virtual Network is VnetLocal</span><span class="sxs-lookup"><span data-stu-id="cf310-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="cf310-164">Virtual Network Gateway is VirtualNetworkGateway</span><span class="sxs-lookup"><span data-stu-id="cf310-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="cf310-165">Virtual Appliance is VirtualAppliance</span><span class="sxs-lookup"><span data-stu-id="cf310-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="cf310-166">Internet is Internet</span><span class="sxs-lookup"><span data-stu-id="cf310-166">Internet is Internet</span></span>
* <span data-ttu-id="cf310-167">None is None</span><span class="sxs-lookup"><span data-stu-id="cf310-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="cf310-168">System routes</span><span class="sxs-lookup"><span data-stu-id="cf310-168">System routes</span></span>
<span data-ttu-id="cf310-169">Every subnet created in a virtual network is automatically associated with a route table that contains the following system route rules:</span><span class="sxs-lookup"><span data-stu-id="cf310-169">Every subnet created in a virtual network is automatically associated with a route table that contains the following system route rules:</span></span>

* <span data-ttu-id="cf310-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span><span class="sxs-lookup"><span data-stu-id="cf310-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="cf310-171">It specifies that there is a direct link between the VMs in the VNet and there is no intermediate next hop.</span><span class="sxs-lookup"><span data-stu-id="cf310-171">It specifies that there is a direct link between the VMs in the VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="cf310-172">**On-premises Rule**: This rule applies to all traffic destined to the on-premises address range and uses VPN gateway as the next hop destination.</span><span class="sxs-lookup"><span data-stu-id="cf310-172">**On-premises Rule**: This rule applies to all traffic destined to the on-premises address range and uses VPN gateway as the next hop destination.</span></span>
* <span data-ttu-id="cf310-173">**Internet Rule**: This rule handles all traffic destined to the public Internet (address prefix 0.0.0.0/0) and uses the infrastructure internet gateway as the next hop for all traffic destined to the Internet.</span><span class="sxs-lookup"><span data-stu-id="cf310-173">**Internet Rule**: This rule handles all traffic destined to the public Internet (address prefix 0.0.0.0/0) and uses the infrastructure internet gateway as the next hop for all traffic destined to the Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="cf310-174">User-defined routes</span><span class="sxs-lookup"><span data-stu-id="cf310-174">User-defined routes</span></span>
<span data-ttu-id="cf310-175">For most environments you will only need the system routes already defined by Azure.</span><span class="sxs-lookup"><span data-stu-id="cf310-175">For most environments you will only need the system routes already defined by Azure.</span></span> <span data-ttu-id="cf310-176">However, you may need to create a route table and add one or more routes in specific cases, such as:</span><span class="sxs-lookup"><span data-stu-id="cf310-176">However, you may need to create a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="cf310-177">Force tunneling to the Internet via your on-premises network.</span><span class="sxs-lookup"><span data-stu-id="cf310-177">Force tunneling to the Internet via your on-premises network.</span></span>
* <span data-ttu-id="cf310-178">Use of virtual appliances in your Azure environment.</span><span class="sxs-lookup"><span data-stu-id="cf310-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="cf310-179">In the scenarios above, you will have to create a route table and add user defined routes to it.</span><span class="sxs-lookup"><span data-stu-id="cf310-179">In the scenarios above, you will have to create a route table and add user defined routes to it.</span></span> <span data-ttu-id="cf310-180">You can have multiple route tables, and the same route table can be associated to one or more subnets.</span><span class="sxs-lookup"><span data-stu-id="cf310-180">You can have multiple route tables, and the same route table can be associated to one or more subnets.</span></span> <span data-ttu-id="cf310-181">And each subnet can only be associated to a single route table.</span><span class="sxs-lookup"><span data-stu-id="cf310-181">And each subnet can only be associated to a single route table.</span></span> <span data-ttu-id="cf310-182">All VMs and cloud services in a subnet use the route table associated to that subnet.</span><span class="sxs-lookup"><span data-stu-id="cf310-182">All VMs and cloud services in a subnet use the route table associated to that subnet.</span></span>

<span data-ttu-id="cf310-183">Subnets rely on system routes until a route table is associated to the subnet.</span><span class="sxs-lookup"><span data-stu-id="cf310-183">Subnets rely on system routes until a route table is associated to the subnet.</span></span> <span data-ttu-id="cf310-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span><span class="sxs-lookup"><span data-stu-id="cf310-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="cf310-185">If there is more than one route with the same LPM match then a route is selected based on its origin in the following order:</span><span class="sxs-lookup"><span data-stu-id="cf310-185">If there is more than one route with the same LPM match then a route is selected based on its origin in the following order:</span></span>

1. <span data-ttu-id="cf310-186">User defined route</span><span class="sxs-lookup"><span data-stu-id="cf310-186">User defined route</span></span>
2. <span data-ttu-id="cf310-187">BGP route (when ExpressRoute is used)</span><span class="sxs-lookup"><span data-stu-id="cf310-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="cf310-188">System route</span><span class="sxs-lookup"><span data-stu-id="cf310-188">System route</span></span>

<span data-ttu-id="cf310-189">To learn how to create user defined routes, see [How to Create Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span><span class="sxs-lookup"><span data-stu-id="cf310-189">To learn how to create user defined routes, see [How to Create Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="cf310-190">User defined routes are only applied to Azure VMs and cloud services.</span><span class="sxs-lookup"><span data-stu-id="cf310-190">User defined routes are only applied to Azure VMs and cloud services.</span></span> <span data-ttu-id="cf310-191">For instance, if you want to add a firewall virtual appliance between your on-premises network and Azure, you will have to create a user defined route for your Azure route tables that forwards all traffic going to the on-premises address space to the virtual appliance.</span><span class="sxs-lookup"><span data-stu-id="cf310-191">For instance, if you want to add a firewall virtual appliance between your on-premises network and Azure, you will have to create a user defined route for your Azure route tables that forwards all traffic going to the on-premises address space to the virtual appliance.</span></span> <span data-ttu-id="cf310-192">You can also add a user defined route (UDR) to the GatewaySubnet to forward all traffic from on-premises to Azure through the virtual appliance.</span><span class="sxs-lookup"><span data-stu-id="cf310-192">You can also add a user defined route (UDR) to the GatewaySubnet to forward all traffic from on-premises to Azure through the virtual appliance.</span></span> <span data-ttu-id="cf310-193">This is a recent addition.</span><span class="sxs-lookup"><span data-stu-id="cf310-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="cf310-194">BGP routes</span><span class="sxs-lookup"><span data-stu-id="cf310-194">BGP routes</span></span>
<span data-ttu-id="cf310-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP to propagate routes from your on-premises network to Azure.</span><span class="sxs-lookup"><span data-stu-id="cf310-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP to propagate routes from your on-premises network to Azure.</span></span> <span data-ttu-id="cf310-196">These BGP routes are used in the same way as system routes and user defined routes in each Azure subnet.</span><span class="sxs-lookup"><span data-stu-id="cf310-196">These BGP routes are used in the same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="cf310-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="cf310-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="cf310-198">You can configure your Azure environment to use force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses the VPN gateway as the next hop.</span><span class="sxs-lookup"><span data-stu-id="cf310-198">You can configure your Azure environment to use force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses the VPN gateway as the next hop.</span></span> <span data-ttu-id="cf310-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="cf310-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="cf310-200">For ExpressRoute, forced tunneling is configured through BGP.</span><span class="sxs-lookup"><span data-stu-id="cf310-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="cf310-201">IP forwarding</span><span class="sxs-lookup"><span data-stu-id="cf310-201">IP forwarding</span></span>
<span data-ttu-id="cf310-202">As describe above, one of the main reasons to create a user defined route is to forward traffic to a virtual appliance.</span><span class="sxs-lookup"><span data-stu-id="cf310-202">As describe above, one of the main reasons to create a user defined route is to forward traffic to a virtual appliance.</span></span> <span data-ttu-id="cf310-203">A virtual appliance is nothing more than a VM that runs an application used to handle network traffic in some way, such as a firewall or a NAT device.</span><span class="sxs-lookup"><span data-stu-id="cf310-203">A virtual appliance is nothing more than a VM that runs an application used to handle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="cf310-204">This virtual appliance VM must be able to receive incoming traffic that is not addressed to itself.</span><span class="sxs-lookup"><span data-stu-id="cf310-204">This virtual appliance VM must be able to receive incoming traffic that is not addressed to itself.</span></span> <span data-ttu-id="cf310-205">To allow a VM to receive traffic addressed to other destinations, you must enable IP Forwarding for the VM.</span><span class="sxs-lookup"><span data-stu-id="cf310-205">To allow a VM to receive traffic addressed to other destinations, you must enable IP Forwarding for the VM.</span></span> <span data-ttu-id="cf310-206">This is an Azure setting, not a setting in the guest operating system.</span><span class="sxs-lookup"><span data-stu-id="cf310-206">This is an Azure setting, not a setting in the guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="cf310-207">Next steps</span><span class="sxs-lookup"><span data-stu-id="cf310-207">Next steps</span></span>
* <span data-ttu-id="cf310-208">Learn how to [create routes in the Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them to subnets.</span><span class="sxs-lookup"><span data-stu-id="cf310-208">Learn how to [create routes in the Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them to subnets.</span></span> 
* <span data-ttu-id="cf310-209">Learn how to [create routes in the classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them to subnets.</span><span class="sxs-lookup"><span data-stu-id="cf310-209">Learn how to [create routes in the classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them to subnets.</span></span>



