---
title: Design Azure templates for complex solutions | Microsoft Docs
description: Shows best practices for designing Azure Resource Manager templates for complex scenarios
services: azure-resource-manager
documentationcenter: ''
author: tfitzmac
manager: timlt
editor: tysonn
ms.assetid: ce1141d6-ece7-4976-acea-1db1f775409e
ms.service: azure-resource-manager
ms.workload: multiple
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/19/2016
ms.author: tomfitz
ms.openlocfilehash: acabc2d1577e63f09bf6eb684972e12e8b89edf7
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44554439"
---
# <a name="design-patterns-for-azure-resource-manager-templates-when-deploying-complex-solutions"></a><span data-ttu-id="2d887-103">Design patterns for Azure Resource Manager templates when deploying complex solutions</span><span class="sxs-lookup"><span data-stu-id="2d887-103">Design patterns for Azure Resource Manager templates when deploying complex solutions</span></span>
<span data-ttu-id="2d887-104">Using a flexible approach based on Azure Resource Manager templates, you can deploy complex topologies quickly and consistently.</span><span class="sxs-lookup"><span data-stu-id="2d887-104">Using a flexible approach based on Azure Resource Manager templates, you can deploy complex topologies quickly and consistently.</span></span> <span data-ttu-id="2d887-105">You can adapt these deployments easily as core offerings evolve or to accommodate variants for outlier scenarios or customers.</span><span class="sxs-lookup"><span data-stu-id="2d887-105">You can adapt these deployments easily as core offerings evolve or to accommodate variants for outlier scenarios or customers.</span></span>

<span data-ttu-id="2d887-106">This topic is part of a larger whitepaper.</span><span class="sxs-lookup"><span data-stu-id="2d887-106">This topic is part of a larger whitepaper.</span></span> <span data-ttu-id="2d887-107">To read the full paper, download [World Class Azure Resource Manager Templates Considerations and Proven Practices](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf).</span><span class="sxs-lookup"><span data-stu-id="2d887-107">To read the full paper, download [World Class Azure Resource Manager Templates Considerations and Proven Practices](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf).</span></span>

<span data-ttu-id="2d887-108">Templates combine the benefits of the underlying Azure Resource Manager with the adaptability and readability of JavaScript Object Notation (JSON).</span><span class="sxs-lookup"><span data-stu-id="2d887-108">Templates combine the benefits of the underlying Azure Resource Manager with the adaptability and readability of JavaScript Object Notation (JSON).</span></span> <span data-ttu-id="2d887-109">Using templates, you can:</span><span class="sxs-lookup"><span data-stu-id="2d887-109">Using templates, you can:</span></span>

* <span data-ttu-id="2d887-110">Deploy topologies and their workloads consistently.</span><span class="sxs-lookup"><span data-stu-id="2d887-110">Deploy topologies and their workloads consistently.</span></span>
* <span data-ttu-id="2d887-111">Manage all your resources in an application together using resource groups.</span><span class="sxs-lookup"><span data-stu-id="2d887-111">Manage all your resources in an application together using resource groups.</span></span>
* <span data-ttu-id="2d887-112">Apply role-based access control (RBAC) to grant appropriate access to users, groups, and services.</span><span class="sxs-lookup"><span data-stu-id="2d887-112">Apply role-based access control (RBAC) to grant appropriate access to users, groups, and services.</span></span>
* <span data-ttu-id="2d887-113">Use tagging associations to streamline tasks such as billing rollups.</span><span class="sxs-lookup"><span data-stu-id="2d887-113">Use tagging associations to streamline tasks such as billing rollups.</span></span>

<span data-ttu-id="2d887-114">This article provides details on consumption scenarios, architecture, and implementation patterns identified during our design sessions and real-world template implementations with Azure Customer Advisory Team (AzureCAT) customers.</span><span class="sxs-lookup"><span data-stu-id="2d887-114">This article provides details on consumption scenarios, architecture, and implementation patterns identified during our design sessions and real-world template implementations with Azure Customer Advisory Team (AzureCAT) customers.</span></span> <span data-ttu-id="2d887-115">Far from academic, these approaches are proven practices informed by the development of templates for 12 of the top Linux-based OSS technologies, including: Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, DataStax Enterprise powered by Apache Cassandra, Elasticsearch, Jenkins, MongoDB, Nagios, PostgreSQL, Redis, and Nagios.</span><span class="sxs-lookup"><span data-stu-id="2d887-115">Far from academic, these approaches are proven practices informed by the development of templates for 12 of the top Linux-based OSS technologies, including: Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, DataStax Enterprise powered by Apache Cassandra, Elasticsearch, Jenkins, MongoDB, Nagios, PostgreSQL, Redis, and Nagios.</span></span> 

<span data-ttu-id="2d887-116">This article shares these proven practices to help you architect world class Azure Resource Manager templates.</span><span class="sxs-lookup"><span data-stu-id="2d887-116">This article shares these proven practices to help you architect world class Azure Resource Manager templates.</span></span>  

<span data-ttu-id="2d887-117">In our work with customers, we have identified several Resource Manager template consumption experiences across enterprises, System Integrators (SI)s, and CSVs.</span><span class="sxs-lookup"><span data-stu-id="2d887-117">In our work with customers, we have identified several Resource Manager template consumption experiences across enterprises, System Integrators (SI)s, and CSVs.</span></span> <span data-ttu-id="2d887-118">The following sections provide a high-level overview of common scenarios and patterns for different customer types.</span><span class="sxs-lookup"><span data-stu-id="2d887-118">The following sections provide a high-level overview of common scenarios and patterns for different customer types.</span></span>

## <a name="enterprises-and-system-integrators"></a><span data-ttu-id="2d887-119">Enterprises and system integrators</span><span class="sxs-lookup"><span data-stu-id="2d887-119">Enterprises and system integrators</span></span>
<span data-ttu-id="2d887-120">Within large organizations, we commonly see two consumers of Resource Manager templates: internal software development teams and corporate IT.</span><span class="sxs-lookup"><span data-stu-id="2d887-120">Within large organizations, we commonly see two consumers of Resource Manager templates: internal software development teams and corporate IT.</span></span> <span data-ttu-id="2d887-121">We've found that the scenarios for the SIs map to the scenarios for Enterprises, so the same considerations apply.</span><span class="sxs-lookup"><span data-stu-id="2d887-121">We've found that the scenarios for the SIs map to the scenarios for Enterprises, so the same considerations apply.</span></span>

### <a name="internal-software-development-teams"></a><span data-ttu-id="2d887-122">Internal software development teams</span><span class="sxs-lookup"><span data-stu-id="2d887-122">Internal software development teams</span></span>
<span data-ttu-id="2d887-123">If your team develops software to support your business, templates provide an easy way to quickly deploy technologies for use in business-specific solutions.</span><span class="sxs-lookup"><span data-stu-id="2d887-123">If your team develops software to support your business, templates provide an easy way to quickly deploy technologies for use in business-specific solutions.</span></span> <span data-ttu-id="2d887-124">You can also use templates to rapidly create training environments that enable team members to gain necessary skills.</span><span class="sxs-lookup"><span data-stu-id="2d887-124">You can also use templates to rapidly create training environments that enable team members to gain necessary skills.</span></span>

<span data-ttu-id="2d887-125">You can use templates as-is or extend or compose them to accommodate your needs.</span><span class="sxs-lookup"><span data-stu-id="2d887-125">You can use templates as-is or extend or compose them to accommodate your needs.</span></span> <span data-ttu-id="2d887-126">Using tagging within templates, you can provide a billing summary with various views such as team, project, individual, and education.</span><span class="sxs-lookup"><span data-stu-id="2d887-126">Using tagging within templates, you can provide a billing summary with various views such as team, project, individual, and education.</span></span>

<span data-ttu-id="2d887-127">Businesses often want software development teams to create a template for consistent deployment of a solution.</span><span class="sxs-lookup"><span data-stu-id="2d887-127">Businesses often want software development teams to create a template for consistent deployment of a solution.</span></span> <span data-ttu-id="2d887-128">The template facilitates constraints so certain items within that environment remain fixed and can't be overridden.</span><span class="sxs-lookup"><span data-stu-id="2d887-128">The template facilitates constraints so certain items within that environment remain fixed and can't be overridden.</span></span> <span data-ttu-id="2d887-129">For example, a bank might require a template to include RBAC so a programmer can’t revise a banking solution to send data to a personal storage account.</span><span class="sxs-lookup"><span data-stu-id="2d887-129">For example, a bank might require a template to include RBAC so a programmer can’t revise a banking solution to send data to a personal storage account.</span></span>

### <a name="corporate-it"></a><span data-ttu-id="2d887-130">Corporate IT</span><span class="sxs-lookup"><span data-stu-id="2d887-130">Corporate IT</span></span>
<span data-ttu-id="2d887-131">Corporate IT organizations typically use templates for delivering cloud capacity and cloud-hosted capabilities.</span><span class="sxs-lookup"><span data-stu-id="2d887-131">Corporate IT organizations typically use templates for delivering cloud capacity and cloud-hosted capabilities.</span></span>

#### <a name="cloud-capacity"></a><span data-ttu-id="2d887-132">Cloud capacity</span><span class="sxs-lookup"><span data-stu-id="2d887-132">Cloud capacity</span></span>
<span data-ttu-id="2d887-133">A common way for corporate IT groups to provide cloud capacity for teams is with "t-shirt sizes", which are standard offering sizes such as small, medium, and large.</span><span class="sxs-lookup"><span data-stu-id="2d887-133">A common way for corporate IT groups to provide cloud capacity for teams is with "t-shirt sizes", which are standard offering sizes such as small, medium, and large.</span></span> <span data-ttu-id="2d887-134">The t-shirt sized offerings can mix different resource types and quantities while providing a level of standardization that makes it possible to use templates.</span><span class="sxs-lookup"><span data-stu-id="2d887-134">The t-shirt sized offerings can mix different resource types and quantities while providing a level of standardization that makes it possible to use templates.</span></span> <span data-ttu-id="2d887-135">The templates deliver capacity in a consistent way that enforces corporate policies and uses tagging to provide chargeback to consuming organizations.</span><span class="sxs-lookup"><span data-stu-id="2d887-135">The templates deliver capacity in a consistent way that enforces corporate policies and uses tagging to provide chargeback to consuming organizations.</span></span>

<span data-ttu-id="2d887-136">For example, you may need to provide development, test, or production environments within which the software development teams can deploy their solutions.</span><span class="sxs-lookup"><span data-stu-id="2d887-136">For example, you may need to provide development, test, or production environments within which the software development teams can deploy their solutions.</span></span> <span data-ttu-id="2d887-137">The environment has a predefined network topology and elements that the software development teams cannot change, such as rules governing access to the public internet and packet inspection.</span><span class="sxs-lookup"><span data-stu-id="2d887-137">The environment has a predefined network topology and elements that the software development teams cannot change, such as rules governing access to the public internet and packet inspection.</span></span> <span data-ttu-id="2d887-138">You may also have organization-specific roles for these environments with distinct access rights for the environment.</span><span class="sxs-lookup"><span data-stu-id="2d887-138">You may also have organization-specific roles for these environments with distinct access rights for the environment.</span></span>

#### <a name="cloud-hosted-capabilities"></a><span data-ttu-id="2d887-139">Cloud-hosted capabilities</span><span class="sxs-lookup"><span data-stu-id="2d887-139">Cloud-hosted capabilities</span></span>
<span data-ttu-id="2d887-140">You can use templates to support cloud-hosted capabilities, including individual software packages or composite offerings that are offered to internal lines of business.</span><span class="sxs-lookup"><span data-stu-id="2d887-140">You can use templates to support cloud-hosted capabilities, including individual software packages or composite offerings that are offered to internal lines of business.</span></span> <span data-ttu-id="2d887-141">An example of a composite offering would be analytics-as-a-service—analytics, visualization, and other technologies—delivered in an optimized, connected configuration on a predefined network topology.</span><span class="sxs-lookup"><span data-stu-id="2d887-141">An example of a composite offering would be analytics-as-a-service—analytics, visualization, and other technologies—delivered in an optimized, connected configuration on a predefined network topology.</span></span>

<span data-ttu-id="2d887-142">Cloud-hosted capabilities are affected by the security and role considerations established by the cloud capacity offering on which they’re built.</span><span class="sxs-lookup"><span data-stu-id="2d887-142">Cloud-hosted capabilities are affected by the security and role considerations established by the cloud capacity offering on which they’re built.</span></span> <span data-ttu-id="2d887-143">These capabilities are offered as is or as a managed service.</span><span class="sxs-lookup"><span data-stu-id="2d887-143">These capabilities are offered as is or as a managed service.</span></span> <span data-ttu-id="2d887-144">For the latter, access-constrained roles are required to enable access into the environment for management purposes.</span><span class="sxs-lookup"><span data-stu-id="2d887-144">For the latter, access-constrained roles are required to enable access into the environment for management purposes.</span></span>

## <a name="cloud-service-vendors"></a><span data-ttu-id="2d887-145">Cloud service vendors</span><span class="sxs-lookup"><span data-stu-id="2d887-145">Cloud service vendors</span></span>
<span data-ttu-id="2d887-146">After talking to many CSVs, we identified multiple approaches you can take to deploy services for your customers and associated requirements.</span><span class="sxs-lookup"><span data-stu-id="2d887-146">After talking to many CSVs, we identified multiple approaches you can take to deploy services for your customers and associated requirements.</span></span>

### <a name="csv-hosted-offering"></a><span data-ttu-id="2d887-147">CSV-hosted offering</span><span class="sxs-lookup"><span data-stu-id="2d887-147">CSV-hosted offering</span></span>
<span data-ttu-id="2d887-148">If you host your offering in your own Azure subscription, two hosting approaches are common: deploying a distinct deployment for every customer or deploying scale units that underpin a shared infrastructure used for all customers.</span><span class="sxs-lookup"><span data-stu-id="2d887-148">If you host your offering in your own Azure subscription, two hosting approaches are common: deploying a distinct deployment for every customer or deploying scale units that underpin a shared infrastructure used for all customers.</span></span>

* <span data-ttu-id="2d887-149">**Distinct deployments for each customer.**</span><span class="sxs-lookup"><span data-stu-id="2d887-149">**Distinct deployments for each customer.**</span></span> <span data-ttu-id="2d887-150">Distinct deployments per customer require fixed topologies of different known configurations.</span><span class="sxs-lookup"><span data-stu-id="2d887-150">Distinct deployments per customer require fixed topologies of different known configurations.</span></span> <span data-ttu-id="2d887-151">These deployments may have different virtual machine (VM) sizes, varying numbers of nodes, and different amounts of associated storage.</span><span class="sxs-lookup"><span data-stu-id="2d887-151">These deployments may have different virtual machine (VM) sizes, varying numbers of nodes, and different amounts of associated storage.</span></span> <span data-ttu-id="2d887-152">Tagging of deployments is used for roll-up billing of each customer.</span><span class="sxs-lookup"><span data-stu-id="2d887-152">Tagging of deployments is used for roll-up billing of each customer.</span></span> <span data-ttu-id="2d887-153">RBAC may be enabled to allow customers access to aspects of their cloud environment.</span><span class="sxs-lookup"><span data-stu-id="2d887-153">RBAC may be enabled to allow customers access to aspects of their cloud environment.</span></span>
* <span data-ttu-id="2d887-154">**Scale units in shared multi-tenant environments.**</span><span class="sxs-lookup"><span data-stu-id="2d887-154">**Scale units in shared multi-tenant environments.**</span></span> <span data-ttu-id="2d887-155">A template can represent a scale unit for multi-tenant environments.</span><span class="sxs-lookup"><span data-stu-id="2d887-155">A template can represent a scale unit for multi-tenant environments.</span></span> <span data-ttu-id="2d887-156">In this case, the same infrastructure is used to support all customers.</span><span class="sxs-lookup"><span data-stu-id="2d887-156">In this case, the same infrastructure is used to support all customers.</span></span> <span data-ttu-id="2d887-157">The deployments represent a group of resources that deliver a level of capacity for the hosted offering, such as number of users and number of transactions.</span><span class="sxs-lookup"><span data-stu-id="2d887-157">The deployments represent a group of resources that deliver a level of capacity for the hosted offering, such as number of users and number of transactions.</span></span> <span data-ttu-id="2d887-158">These scale units are increased or decreased as demand requires.</span><span class="sxs-lookup"><span data-stu-id="2d887-158">These scale units are increased or decreased as demand requires.</span></span>

### <a name="csv-offering-injected-into-customer-subscription"></a><span data-ttu-id="2d887-159">CSV offering injected into customer subscription</span><span class="sxs-lookup"><span data-stu-id="2d887-159">CSV offering injected into customer subscription</span></span>
<span data-ttu-id="2d887-160">You may want to deploy your software into subscriptions owned by end customers.</span><span class="sxs-lookup"><span data-stu-id="2d887-160">You may want to deploy your software into subscriptions owned by end customers.</span></span> <span data-ttu-id="2d887-161">You can use templates to deploy distinct deployments into a customer’s Azure account.</span><span class="sxs-lookup"><span data-stu-id="2d887-161">You can use templates to deploy distinct deployments into a customer’s Azure account.</span></span>

<span data-ttu-id="2d887-162">These deployments use RBAC so you can update and manage the deployment within the customer’s account.</span><span class="sxs-lookup"><span data-stu-id="2d887-162">These deployments use RBAC so you can update and manage the deployment within the customer’s account.</span></span>

### <a name="azure-marketplace"></a><span data-ttu-id="2d887-163">Azure Marketplace</span><span class="sxs-lookup"><span data-stu-id="2d887-163">Azure Marketplace</span></span>
<span data-ttu-id="2d887-164">To advertise and sell your offerings through a marketplace, such as Azure Marketplace, you can develop templates to deliver distinct types of deployments that run in a customer’s Azure account.</span><span class="sxs-lookup"><span data-stu-id="2d887-164">To advertise and sell your offerings through a marketplace, such as Azure Marketplace, you can develop templates to deliver distinct types of deployments that run in a customer’s Azure account.</span></span> <span data-ttu-id="2d887-165">These distinct deployments can be typically described as a t-shirt size (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span><span class="sxs-lookup"><span data-stu-id="2d887-165">These distinct deployments can be typically described as a t-shirt size (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span></span>  <span data-ttu-id="2d887-166">In some cases, these types allow you to specify certain attributes of the deployment, such as VM type or number of disks.</span><span class="sxs-lookup"><span data-stu-id="2d887-166">In some cases, these types allow you to specify certain attributes of the deployment, such as VM type or number of disks.</span></span>

## <a name="oss-projects"></a><span data-ttu-id="2d887-167">OSS projects</span><span class="sxs-lookup"><span data-stu-id="2d887-167">OSS projects</span></span>
<span data-ttu-id="2d887-168">Within open source projects, Resource Manager templates enable a community to deploy a solution quickly using proven practices.</span><span class="sxs-lookup"><span data-stu-id="2d887-168">Within open source projects, Resource Manager templates enable a community to deploy a solution quickly using proven practices.</span></span> <span data-ttu-id="2d887-169">You can store templates in a GitHub repository so the community can revise them over time.</span><span class="sxs-lookup"><span data-stu-id="2d887-169">You can store templates in a GitHub repository so the community can revise them over time.</span></span> <span data-ttu-id="2d887-170">Users deploy these templates in their own Azure subscriptions.</span><span class="sxs-lookup"><span data-stu-id="2d887-170">Users deploy these templates in their own Azure subscriptions.</span></span>

<span data-ttu-id="2d887-171">The following sections identify the things you need to consider before designing your solution.</span><span class="sxs-lookup"><span data-stu-id="2d887-171">The following sections identify the things you need to consider before designing your solution.</span></span>

## <a name="identifying-what-is-outside-and-inside-a-vm"></a><span data-ttu-id="2d887-172">Identifying what is outside and inside a VM</span><span class="sxs-lookup"><span data-stu-id="2d887-172">Identifying what is outside and inside a VM</span></span>
<span data-ttu-id="2d887-173">As you design your template, it’s helpful to look at the requirements in terms of what's outside and inside the virtual machines (VMs):</span><span class="sxs-lookup"><span data-stu-id="2d887-173">As you design your template, it’s helpful to look at the requirements in terms of what's outside and inside the virtual machines (VMs):</span></span>

* <span data-ttu-id="2d887-174">Outside means the VMs and other resources of your deployment, such as the network topology, tagging, references to the certs/secrets, and role-based access control.</span><span class="sxs-lookup"><span data-stu-id="2d887-174">Outside means the VMs and other resources of your deployment, such as the network topology, tagging, references to the certs/secrets, and role-based access control.</span></span> <span data-ttu-id="2d887-175">All these resources are part of your template.</span><span class="sxs-lookup"><span data-stu-id="2d887-175">All these resources are part of your template.</span></span>
* <span data-ttu-id="2d887-176">Inside means the installed software and overall desired state configuration.</span><span class="sxs-lookup"><span data-stu-id="2d887-176">Inside means the installed software and overall desired state configuration.</span></span> <span data-ttu-id="2d887-177">Other mechanisms, such as VM extensions or scripts, are used in whole or in part.</span><span class="sxs-lookup"><span data-stu-id="2d887-177">Other mechanisms, such as VM extensions or scripts, are used in whole or in part.</span></span> <span data-ttu-id="2d887-178">These mechanisms may be identified and executed by the template but aren’t in it.</span><span class="sxs-lookup"><span data-stu-id="2d887-178">These mechanisms may be identified and executed by the template but aren’t in it.</span></span>

<span data-ttu-id="2d887-179">Common examples of activities you would do “inside the box” include -</span><span class="sxs-lookup"><span data-stu-id="2d887-179">Common examples of activities you would do “inside the box” include -</span></span>  

* <span data-ttu-id="2d887-180">Install or remove server roles and features</span><span class="sxs-lookup"><span data-stu-id="2d887-180">Install or remove server roles and features</span></span>
* <span data-ttu-id="2d887-181">Install and configure software at the node or cluster level</span><span class="sxs-lookup"><span data-stu-id="2d887-181">Install and configure software at the node or cluster level</span></span>
* <span data-ttu-id="2d887-182">Deploy websites on a web server</span><span class="sxs-lookup"><span data-stu-id="2d887-182">Deploy websites on a web server</span></span>
* <span data-ttu-id="2d887-183">Deploy database schemas</span><span class="sxs-lookup"><span data-stu-id="2d887-183">Deploy database schemas</span></span>
* <span data-ttu-id="2d887-184">Manage registry or other types of configuration settings</span><span class="sxs-lookup"><span data-stu-id="2d887-184">Manage registry or other types of configuration settings</span></span>
* <span data-ttu-id="2d887-185">Manage files and directories</span><span class="sxs-lookup"><span data-stu-id="2d887-185">Manage files and directories</span></span>
* <span data-ttu-id="2d887-186">Start, stop, and manage processes and services</span><span class="sxs-lookup"><span data-stu-id="2d887-186">Start, stop, and manage processes and services</span></span>
* <span data-ttu-id="2d887-187">Manage local groups and user accounts</span><span class="sxs-lookup"><span data-stu-id="2d887-187">Manage local groups and user accounts</span></span>
* <span data-ttu-id="2d887-188">Install and manage packages (.msi, .exe, yum, etc.)</span><span class="sxs-lookup"><span data-stu-id="2d887-188">Install and manage packages (.msi, .exe, yum, etc.)</span></span>
* <span data-ttu-id="2d887-189">Manage environment variables</span><span class="sxs-lookup"><span data-stu-id="2d887-189">Manage environment variables</span></span>
* <span data-ttu-id="2d887-190">Run native scripts (Windows PowerShell, bash, etc.)</span><span class="sxs-lookup"><span data-stu-id="2d887-190">Run native scripts (Windows PowerShell, bash, etc.)</span></span>

### <a name="desired-state-configuration-dsc"></a><span data-ttu-id="2d887-191">Desired state configuration (DSC)</span><span class="sxs-lookup"><span data-stu-id="2d887-191">Desired state configuration (DSC)</span></span>
<span data-ttu-id="2d887-192">Thinking about the internal state of your VMs beyond deployment, you want to make sure this deployment doesn’t "drift" from the configuration that you have defined and checked into source control.</span><span class="sxs-lookup"><span data-stu-id="2d887-192">Thinking about the internal state of your VMs beyond deployment, you want to make sure this deployment doesn’t "drift" from the configuration that you have defined and checked into source control.</span></span> <span data-ttu-id="2d887-193">This approach ensures your developers or operations staff don’t make ad-hoc changes to an environment that are not vetted, tested, or recorded in source control.</span><span class="sxs-lookup"><span data-stu-id="2d887-193">This approach ensures your developers or operations staff don’t make ad-hoc changes to an environment that are not vetted, tested, or recorded in source control.</span></span> <span data-ttu-id="2d887-194">This control is important, because the manual changes are not in source control.</span><span class="sxs-lookup"><span data-stu-id="2d887-194">This control is important, because the manual changes are not in source control.</span></span> <span data-ttu-id="2d887-195">They are also not part of the standard deployment and will impact future automated deployments of the software.</span><span class="sxs-lookup"><span data-stu-id="2d887-195">They are also not part of the standard deployment and will impact future automated deployments of the software.</span></span>

<span data-ttu-id="2d887-196">Beyond your internal employees, desired state configuration is also important from a security perspective.</span><span class="sxs-lookup"><span data-stu-id="2d887-196">Beyond your internal employees, desired state configuration is also important from a security perspective.</span></span> <span data-ttu-id="2d887-197">Hackers are regularly trying to compromise and exploit software systems.</span><span class="sxs-lookup"><span data-stu-id="2d887-197">Hackers are regularly trying to compromise and exploit software systems.</span></span> <span data-ttu-id="2d887-198">When successful, it's common to install files and otherwise change the state of a compromised system.</span><span class="sxs-lookup"><span data-stu-id="2d887-198">When successful, it's common to install files and otherwise change the state of a compromised system.</span></span> <span data-ttu-id="2d887-199">Using desired state configuration, you can identify deltas between the desired and actual state and restore a known configuration.</span><span class="sxs-lookup"><span data-stu-id="2d887-199">Using desired state configuration, you can identify deltas between the desired and actual state and restore a known configuration.</span></span>

<span data-ttu-id="2d887-200">There are resource extensions for the most popular mechanisms for DSC - PowerShell DSC, Chef, and Puppet.</span><span class="sxs-lookup"><span data-stu-id="2d887-200">There are resource extensions for the most popular mechanisms for DSC - PowerShell DSC, Chef, and Puppet.</span></span> <span data-ttu-id="2d887-201">Each of these extensions can deploy the initial state of your VM and also be used to make sure the desired state is maintained.</span><span class="sxs-lookup"><span data-stu-id="2d887-201">Each of these extensions can deploy the initial state of your VM and also be used to make sure the desired state is maintained.</span></span>

## <a name="common-template-scopes"></a><span data-ttu-id="2d887-202">Common template scopes</span><span class="sxs-lookup"><span data-stu-id="2d887-202">Common template scopes</span></span>
<span data-ttu-id="2d887-203">In our experience, we’ve seen three key solution templates scopes emerge.</span><span class="sxs-lookup"><span data-stu-id="2d887-203">In our experience, we’ve seen three key solution templates scopes emerge.</span></span> <span data-ttu-id="2d887-204">These three scopes – capacity, capability, and end-to-end solution – are described in the following sections.</span><span class="sxs-lookup"><span data-stu-id="2d887-204">These three scopes – capacity, capability, and end-to-end solution – are described in the following sections.</span></span>

### <a name="capacity-scope"></a><span data-ttu-id="2d887-205">Capacity scope</span><span class="sxs-lookup"><span data-stu-id="2d887-205">Capacity scope</span></span>
<span data-ttu-id="2d887-206">A capacity scope delivers a set of resources in a standard topology that is pre-configured to be in compliance with regulations and policies.</span><span class="sxs-lookup"><span data-stu-id="2d887-206">A capacity scope delivers a set of resources in a standard topology that is pre-configured to be in compliance with regulations and policies.</span></span> <span data-ttu-id="2d887-207">The most common example is deploying a standard development environment in an Enterprise IT or SI scenario.</span><span class="sxs-lookup"><span data-stu-id="2d887-207">The most common example is deploying a standard development environment in an Enterprise IT or SI scenario.</span></span>

### <a name="capability-scope"></a><span data-ttu-id="2d887-208">Capability scope</span><span class="sxs-lookup"><span data-stu-id="2d887-208">Capability scope</span></span>
<span data-ttu-id="2d887-209">A capability scope is focused on deploying and configuring a topology for a given technology.</span><span class="sxs-lookup"><span data-stu-id="2d887-209">A capability scope is focused on deploying and configuring a topology for a given technology.</span></span> <span data-ttu-id="2d887-210">Common scenarios including technologies such as SQL Server, Cassandra, Hadoop.</span><span class="sxs-lookup"><span data-stu-id="2d887-210">Common scenarios including technologies such as SQL Server, Cassandra, Hadoop.</span></span>

### <a name="end-to-end-solution-scope"></a><span data-ttu-id="2d887-211">End-to-end solution scope</span><span class="sxs-lookup"><span data-stu-id="2d887-211">End-to-end solution scope</span></span>
<span data-ttu-id="2d887-212">An End-to-End Solution Scope is targeted beyond a single capability, and instead focused on delivering an end to end solution comprised of multiple capabilities.</span><span class="sxs-lookup"><span data-stu-id="2d887-212">An End-to-End Solution Scope is targeted beyond a single capability, and instead focused on delivering an end to end solution comprised of multiple capabilities.</span></span>  

<span data-ttu-id="2d887-213">A solution-scoped template scope manifests itself as a set of one or more capability-scoped templates with solution-specific resources, logic, and desired state.</span><span class="sxs-lookup"><span data-stu-id="2d887-213">A solution-scoped template scope manifests itself as a set of one or more capability-scoped templates with solution-specific resources, logic, and desired state.</span></span> <span data-ttu-id="2d887-214">An example of a solution-scoped template is an end to end data pipeline solution template.</span><span class="sxs-lookup"><span data-stu-id="2d887-214">An example of a solution-scoped template is an end to end data pipeline solution template.</span></span> <span data-ttu-id="2d887-215">The template might mix solution-specific topology and state with multiple capability-scoped solution templates such as Kafka, Storm, and Hadoop.</span><span class="sxs-lookup"><span data-stu-id="2d887-215">The template might mix solution-specific topology and state with multiple capability-scoped solution templates such as Kafka, Storm, and Hadoop.</span></span>

## <a name="choosing-free-form-vs-known-configurations"></a><span data-ttu-id="2d887-216">Choosing free-form vs. known configurations</span><span class="sxs-lookup"><span data-stu-id="2d887-216">Choosing free-form vs. known configurations</span></span>
<span data-ttu-id="2d887-217">You might initially think a template should give consumers the utmost flexibility, but many considerations affect the choice of whether to use free-form configurations vs. known configurations.</span><span class="sxs-lookup"><span data-stu-id="2d887-217">You might initially think a template should give consumers the utmost flexibility, but many considerations affect the choice of whether to use free-form configurations vs. known configurations.</span></span> <span data-ttu-id="2d887-218">This section identifies the key customer requirements and technical considerations that shaped the approach shared in this document.</span><span class="sxs-lookup"><span data-stu-id="2d887-218">This section identifies the key customer requirements and technical considerations that shaped the approach shared in this document.</span></span>

### <a name="free-form-configurations"></a><span data-ttu-id="2d887-219">Free-form configurations</span><span class="sxs-lookup"><span data-stu-id="2d887-219">Free-form configurations</span></span>
<span data-ttu-id="2d887-220">On the surface, free-form configurations sound ideal.</span><span class="sxs-lookup"><span data-stu-id="2d887-220">On the surface, free-form configurations sound ideal.</span></span> <span data-ttu-id="2d887-221">They allow you to select a VM type and provide an arbitrary number of nodes and attached disks for those nodes — and do so as parameters to a template.</span><span class="sxs-lookup"><span data-stu-id="2d887-221">They allow you to select a VM type and provide an arbitrary number of nodes and attached disks for those nodes — and do so as parameters to a template.</span></span> <span data-ttu-id="2d887-222">However, this approach is not ideal for some scenarios.</span><span class="sxs-lookup"><span data-stu-id="2d887-222">However, this approach is not ideal for some scenarios.</span></span>

<span data-ttu-id="2d887-223">In [Sizes for virtual machines](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), the different VM types and available sizes are identified, and each of the number of durable disks (2, 4, 8, 16, or 32) that can be attached.</span><span class="sxs-lookup"><span data-stu-id="2d887-223">In [Sizes for virtual machines](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), the different VM types and available sizes are identified, and each of the number of durable disks (2, 4, 8, 16, or 32) that can be attached.</span></span> <span data-ttu-id="2d887-224">Each attached disk provides 500 IOPS and multiples of these disks can be pooled for a multiplier of that number of IOPS.</span><span class="sxs-lookup"><span data-stu-id="2d887-224">Each attached disk provides 500 IOPS and multiples of these disks can be pooled for a multiplier of that number of IOPS.</span></span> <span data-ttu-id="2d887-225">For example, 16 disks can be pooled to provide 8,000 IOPS.</span><span class="sxs-lookup"><span data-stu-id="2d887-225">For example, 16 disks can be pooled to provide 8,000 IOPS.</span></span> <span data-ttu-id="2d887-226">Pooling is done with configuration in the operating system, using Microsoft Windows Storage Spaces or redundant array of inexpensive disks (RAID) in Linux.</span><span class="sxs-lookup"><span data-stu-id="2d887-226">Pooling is done with configuration in the operating system, using Microsoft Windows Storage Spaces or redundant array of inexpensive disks (RAID) in Linux.</span></span>

<span data-ttu-id="2d887-227">A free-form configuration enables the selection several VM instances, various VM types and sizes for those instances, various disks for the VM type, and one or more scripts to configure the VM contents.</span><span class="sxs-lookup"><span data-stu-id="2d887-227">A free-form configuration enables the selection several VM instances, various VM types and sizes for those instances, various disks for the VM type, and one or more scripts to configure the VM contents.</span></span>

<span data-ttu-id="2d887-228">It is common that a deployment may have multiple types of nodes, such as master and data nodes, so this flexibility is often provided for every node type.</span><span class="sxs-lookup"><span data-stu-id="2d887-228">It is common that a deployment may have multiple types of nodes, such as master and data nodes, so this flexibility is often provided for every node type.</span></span>

<span data-ttu-id="2d887-229">As you start to deploy clusters of any significance, you begin to work with these complex scenarios.</span><span class="sxs-lookup"><span data-stu-id="2d887-229">As you start to deploy clusters of any significance, you begin to work with these complex scenarios.</span></span> <span data-ttu-id="2d887-230">If you were deploying a Hadoop cluster, for example, with 8 master nodes and 200 data nodes, and pooled 4 attached disks on each master node and pooled 16 attached disks per data node, you would have 208 VMs and 3,232 disks to manage.</span><span class="sxs-lookup"><span data-stu-id="2d887-230">If you were deploying a Hadoop cluster, for example, with 8 master nodes and 200 data nodes, and pooled 4 attached disks on each master node and pooled 16 attached disks per data node, you would have 208 VMs and 3,232 disks to manage.</span></span>

<span data-ttu-id="2d887-231">A storage account will throttle requests above its identified 20,000 transactions/second limit, so you should look at storage account partitioning and use calculations to determine the appropriate number of storage accounts to accommodate this topology.</span><span class="sxs-lookup"><span data-stu-id="2d887-231">A storage account will throttle requests above its identified 20,000 transactions/second limit, so you should look at storage account partitioning and use calculations to determine the appropriate number of storage accounts to accommodate this topology.</span></span> <span data-ttu-id="2d887-232">Given the multitude of combinations supported by the free-form approach, dynamic calculations are required to determine the appropriate partitioning.</span><span class="sxs-lookup"><span data-stu-id="2d887-232">Given the multitude of combinations supported by the free-form approach, dynamic calculations are required to determine the appropriate partitioning.</span></span> <span data-ttu-id="2d887-233">The Azure Resource Manager Template Language does not presently provide mathematical functions, so you must perform these calculations in code, generating a unique, hard-coded template with the appropriate details.</span><span class="sxs-lookup"><span data-stu-id="2d887-233">The Azure Resource Manager Template Language does not presently provide mathematical functions, so you must perform these calculations in code, generating a unique, hard-coded template with the appropriate details.</span></span>

<span data-ttu-id="2d887-234">In enterprise IT and SI scenarios, someone must maintain the templates and support the deployed topologies for one or more organizations.</span><span class="sxs-lookup"><span data-stu-id="2d887-234">In enterprise IT and SI scenarios, someone must maintain the templates and support the deployed topologies for one or more organizations.</span></span> <span data-ttu-id="2d887-235">This additional overhead — different configurations and templates for each customer — is far from desirable.</span><span class="sxs-lookup"><span data-stu-id="2d887-235">This additional overhead — different configurations and templates for each customer — is far from desirable.</span></span>

<span data-ttu-id="2d887-236">You can use these templates to deploy environments in your customer’s Azure subscription, but both corporate IT teams and CSVs typically deploy them into their own subscriptions, using a chargeback function to bill their customers.</span><span class="sxs-lookup"><span data-stu-id="2d887-236">You can use these templates to deploy environments in your customer’s Azure subscription, but both corporate IT teams and CSVs typically deploy them into their own subscriptions, using a chargeback function to bill their customers.</span></span> <span data-ttu-id="2d887-237">In these scenarios, the goal is to deploy capacity for multiple customers across a pool of subscriptions and keep deployments densely populated into the subscriptions to minimize subscription sprawl—that is, more subscriptions to manage.</span><span class="sxs-lookup"><span data-stu-id="2d887-237">In these scenarios, the goal is to deploy capacity for multiple customers across a pool of subscriptions and keep deployments densely populated into the subscriptions to minimize subscription sprawl—that is, more subscriptions to manage.</span></span> <span data-ttu-id="2d887-238">With truly dynamic deployment sizes, achieving this type of density requires careful planning and additional development for scaffolding work on behalf of the organization.</span><span class="sxs-lookup"><span data-stu-id="2d887-238">With truly dynamic deployment sizes, achieving this type of density requires careful planning and additional development for scaffolding work on behalf of the organization.</span></span>

<span data-ttu-id="2d887-239">In addition, you can’t create subscriptions via an API call but must do so manually through the portal.</span><span class="sxs-lookup"><span data-stu-id="2d887-239">In addition, you can’t create subscriptions via an API call but must do so manually through the portal.</span></span> <span data-ttu-id="2d887-240">As the number of subscriptions increases, any resulting subscription sprawl requires human intervention—it can’t be automated.</span><span class="sxs-lookup"><span data-stu-id="2d887-240">As the number of subscriptions increases, any resulting subscription sprawl requires human intervention—it can’t be automated.</span></span> <span data-ttu-id="2d887-241">With so much variability in the sizes of deployments, you would have to pre-provision a number of subscriptions manually to ensure subscriptions are available.</span><span class="sxs-lookup"><span data-stu-id="2d887-241">With so much variability in the sizes of deployments, you would have to pre-provision a number of subscriptions manually to ensure subscriptions are available.</span></span>

<span data-ttu-id="2d887-242">Considering all these factors, a truly free-form configuration is less appealing than at first blush.</span><span class="sxs-lookup"><span data-stu-id="2d887-242">Considering all these factors, a truly free-form configuration is less appealing than at first blush.</span></span>

### <a name="known-configurations--the-t-shirt-sizing-approach"></a><span data-ttu-id="2d887-243">Known configurations — the t-shirt sizing approach</span><span class="sxs-lookup"><span data-stu-id="2d887-243">Known configurations — the t-shirt sizing approach</span></span>
<span data-ttu-id="2d887-244">Rather than offer a template that provides total flexibility and countless variations, in our experience a common pattern is to provide the ability to select known configurations — in effect, standard t-shirt sizes such as sandbox, small, medium, and large.</span><span class="sxs-lookup"><span data-stu-id="2d887-244">Rather than offer a template that provides total flexibility and countless variations, in our experience a common pattern is to provide the ability to select known configurations — in effect, standard t-shirt sizes such as sandbox, small, medium, and large.</span></span> <span data-ttu-id="2d887-245">Other examples of t-shirt sizes are product offerings, such as community edition or enterprise edition.</span><span class="sxs-lookup"><span data-stu-id="2d887-245">Other examples of t-shirt sizes are product offerings, such as community edition or enterprise edition.</span></span>  <span data-ttu-id="2d887-246">In other cases, it may be workload-specific configurations of a technology – such as map reduce or no sql.</span><span class="sxs-lookup"><span data-stu-id="2d887-246">In other cases, it may be workload-specific configurations of a technology – such as map reduce or no sql.</span></span>

<span data-ttu-id="2d887-247">Many enterprise IT organizations, OSS vendors, and SIs make their offerings available today in this way in on-premises, virtualized environments (enterprises) or as software-as-a-service (SaaS) offerings (CSVs and OSVs).</span><span class="sxs-lookup"><span data-stu-id="2d887-247">Many enterprise IT organizations, OSS vendors, and SIs make their offerings available today in this way in on-premises, virtualized environments (enterprises) or as software-as-a-service (SaaS) offerings (CSVs and OSVs).</span></span>

<span data-ttu-id="2d887-248">This approach provides good, known configurations of varying sizes that are preconfigured for customers.</span><span class="sxs-lookup"><span data-stu-id="2d887-248">This approach provides good, known configurations of varying sizes that are preconfigured for customers.</span></span> <span data-ttu-id="2d887-249">Without known configurations, end customers must determine cluster sizing on their own, factor in platform resource constraints, and do math to identify the resulting partitioning of storage accounts and other resources (due to cluster size and resource constraints).</span><span class="sxs-lookup"><span data-stu-id="2d887-249">Without known configurations, end customers must determine cluster sizing on their own, factor in platform resource constraints, and do math to identify the resulting partitioning of storage accounts and other resources (due to cluster size and resource constraints).</span></span> <span data-ttu-id="2d887-250">Known configurations enable customers to easily select the right t-shirt size—that is, a given deployment.</span><span class="sxs-lookup"><span data-stu-id="2d887-250">Known configurations enable customers to easily select the right t-shirt size—that is, a given deployment.</span></span> <span data-ttu-id="2d887-251">In addition to making a better experience for the customer, a small number of known configurations is easier to support and can help you deliver a higher level of density.</span><span class="sxs-lookup"><span data-stu-id="2d887-251">In addition to making a better experience for the customer, a small number of known configurations is easier to support and can help you deliver a higher level of density.</span></span>

<span data-ttu-id="2d887-252">A known configuration approach focused on t-shirt sizes may also have varying number of nodes within a size.</span><span class="sxs-lookup"><span data-stu-id="2d887-252">A known configuration approach focused on t-shirt sizes may also have varying number of nodes within a size.</span></span> <span data-ttu-id="2d887-253">For example, a small t-shirt size may be between 3 and 10 nodes.</span><span class="sxs-lookup"><span data-stu-id="2d887-253">For example, a small t-shirt size may be between 3 and 10 nodes.</span></span>  <span data-ttu-id="2d887-254">The t-shirt size would be designed to accommodate up to 10 nodes and provide the consumer the ability to make free form selections up to the maximum size identified.</span><span class="sxs-lookup"><span data-stu-id="2d887-254">The t-shirt size would be designed to accommodate up to 10 nodes and provide the consumer the ability to make free form selections up to the maximum size identified.</span></span>  

<span data-ttu-id="2d887-255">A t-shirt size based on workload type, may be more free form in nature in terms of the number of nodes that can be deployed but will have workload distinct node size and configuration of the software on the node.</span><span class="sxs-lookup"><span data-stu-id="2d887-255">A t-shirt size based on workload type, may be more free form in nature in terms of the number of nodes that can be deployed but will have workload distinct node size and configuration of the software on the node.</span></span>

<span data-ttu-id="2d887-256">T-shirt sizes based on product offerings, such as community or Enterprise, may have distinct resource types and maximum number of nodes that can be deployed, typically tied to licensing considerations or feature availability across the different offerings.</span><span class="sxs-lookup"><span data-stu-id="2d887-256">T-shirt sizes based on product offerings, such as community or Enterprise, may have distinct resource types and maximum number of nodes that can be deployed, typically tied to licensing considerations or feature availability across the different offerings.</span></span>

<span data-ttu-id="2d887-257">You can also accommodate customers with unique variants using the JSON-based templates.</span><span class="sxs-lookup"><span data-stu-id="2d887-257">You can also accommodate customers with unique variants using the JSON-based templates.</span></span> <span data-ttu-id="2d887-258">When dealing with outliers, you can incorporate the appropriate planning and considerations for development, support, and costing.</span><span class="sxs-lookup"><span data-stu-id="2d887-258">When dealing with outliers, you can incorporate the appropriate planning and considerations for development, support, and costing.</span></span>

<span data-ttu-id="2d887-259">Based on the customer template consumption scenarios, and requirements identified at the start of this document, we identified a pattern for template decomposition.</span><span class="sxs-lookup"><span data-stu-id="2d887-259">Based on the customer template consumption scenarios, and requirements identified at the start of this document, we identified a pattern for template decomposition.</span></span>

## <a name="capacity-and-capability-scoped-solution-templates"></a><span data-ttu-id="2d887-260">Capacity and capability-scoped solution templates</span><span class="sxs-lookup"><span data-stu-id="2d887-260">Capacity and capability-scoped solution templates</span></span>
<span data-ttu-id="2d887-261">Decomposition provides a modular approach to template development that supports reuse, extensibility, testing, and tooling.</span><span class="sxs-lookup"><span data-stu-id="2d887-261">Decomposition provides a modular approach to template development that supports reuse, extensibility, testing, and tooling.</span></span> <span data-ttu-id="2d887-262">This section provides detail on how a decomposition approach can be applied to templates with a Capacity or Capability scope.</span><span class="sxs-lookup"><span data-stu-id="2d887-262">This section provides detail on how a decomposition approach can be applied to templates with a Capacity or Capability scope.</span></span>

<span data-ttu-id="2d887-263">In this approach, a main template receives parameter values from a template consumer, then links to several types of templates and scripts downstream as shown below.</span><span class="sxs-lookup"><span data-stu-id="2d887-263">In this approach, a main template receives parameter values from a template consumer, then links to several types of templates and scripts downstream as shown below.</span></span> <span data-ttu-id="2d887-264">Parameters, static variables, and generated variables are used to provide values in and out of the linked templates.</span><span class="sxs-lookup"><span data-stu-id="2d887-264">Parameters, static variables, and generated variables are used to provide values in and out of the linked templates.</span></span>

![Template parameters](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-design-templates/template-parameters.png)

<span data-ttu-id="2d887-266">**Parameters are passed to a main template then to linked templates**</span><span class="sxs-lookup"><span data-stu-id="2d887-266">**Parameters are passed to a main template then to linked templates**</span></span>

<span data-ttu-id="2d887-267">The following sections focus on the types of templates and scripts that a single template is decomposed into.</span><span class="sxs-lookup"><span data-stu-id="2d887-267">The following sections focus on the types of templates and scripts that a single template is decomposed into.</span></span> <span data-ttu-id="2d887-268">The sections present approaches for passing state information among the templates.</span><span class="sxs-lookup"><span data-stu-id="2d887-268">The sections present approaches for passing state information among the templates.</span></span> <span data-ttu-id="2d887-269">Each template and the script types in the image are described along with examples.</span><span class="sxs-lookup"><span data-stu-id="2d887-269">Each template and the script types in the image are described along with examples.</span></span> <span data-ttu-id="2d887-270">For a contextual example, see "Putting it together: a sample implementation" later in this document.</span><span class="sxs-lookup"><span data-stu-id="2d887-270">For a contextual example, see "Putting it together: a sample implementation" later in this document.</span></span>

### <a name="template-metadata"></a><span data-ttu-id="2d887-271">Template metadata</span><span class="sxs-lookup"><span data-stu-id="2d887-271">Template metadata</span></span>
<span data-ttu-id="2d887-272">Template metadata (the metadata.json file) contains key/value pairs that describe a template in JSON, which can be read by humans and software systems.</span><span class="sxs-lookup"><span data-stu-id="2d887-272">Template metadata (the metadata.json file) contains key/value pairs that describe a template in JSON, which can be read by humans and software systems.</span></span>

![Template metadata](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-design-templates/template-metadata.png)

<span data-ttu-id="2d887-274">**Template metadata is described in the metadata.json file**</span><span class="sxs-lookup"><span data-stu-id="2d887-274">**Template metadata is described in the metadata.json file**</span></span>

<span data-ttu-id="2d887-275">Software agents can retrieve the metadata.json file and publish the information and a link to the template in a web page or directory.</span><span class="sxs-lookup"><span data-stu-id="2d887-275">Software agents can retrieve the metadata.json file and publish the information and a link to the template in a web page or directory.</span></span> <span data-ttu-id="2d887-276">Elements include *itemDisplayName*, *description*, *summary*, *githubUsername*, and *dateUpdated*.</span><span class="sxs-lookup"><span data-stu-id="2d887-276">Elements include *itemDisplayName*, *description*, *summary*, *githubUsername*, and *dateUpdated*.</span></span>

<span data-ttu-id="2d887-277">An example file is shown below in its entirety.</span><span class="sxs-lookup"><span data-stu-id="2d887-277">An example file is shown below in its entirety.</span></span>

    {
        "itemDisplayName": "PostgreSQL 9.3 on Ubuntu VMs",
        "description": "This template creates a PostgreSQL streaming-replication between a master and one or more slave servers each with 2 striped data disks. The database servers are deployed into a private-only subnet with one publicly accessible jumpbox VM in a DMZ subnet with public IP.",
        "summary": "PostgreSQL stream-replication with multiple slave servers and a publicly accessible jumpbox VM",
        "githubUsername": "arsenvlad",
        "dateUpdated": "2015-04-24"
    }

### <a name="main-template"></a><span data-ttu-id="2d887-278">Main template</span><span class="sxs-lookup"><span data-stu-id="2d887-278">Main template</span></span>
<span data-ttu-id="2d887-279">The main template receives parameters from a user, uses that information to populate complex object variables, and executes the linked templates.</span><span class="sxs-lookup"><span data-stu-id="2d887-279">The main template receives parameters from a user, uses that information to populate complex object variables, and executes the linked templates.</span></span>

![Main template](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-design-templates/main-template.png)

<span data-ttu-id="2d887-281">**The main template receives parameters from a user**</span><span class="sxs-lookup"><span data-stu-id="2d887-281">**The main template receives parameters from a user**</span></span>

<span data-ttu-id="2d887-282">One parameter that is provided is a known configuration type also known as the t-shirt size parameter because of its standardized values such as small, medium, or large.</span><span class="sxs-lookup"><span data-stu-id="2d887-282">One parameter that is provided is a known configuration type also known as the t-shirt size parameter because of its standardized values such as small, medium, or large.</span></span> <span data-ttu-id="2d887-283">In practice, you can use this parameter in multiple ways.</span><span class="sxs-lookup"><span data-stu-id="2d887-283">In practice, you can use this parameter in multiple ways.</span></span> <span data-ttu-id="2d887-284">For details, see "Known configuration resources template" later in this document.</span><span class="sxs-lookup"><span data-stu-id="2d887-284">For details, see "Known configuration resources template" later in this document.</span></span>

<span data-ttu-id="2d887-285">Some resources are deployed regardless of the known configuration specified by a user parameter.</span><span class="sxs-lookup"><span data-stu-id="2d887-285">Some resources are deployed regardless of the known configuration specified by a user parameter.</span></span> <span data-ttu-id="2d887-286">These resources are provisioned using a single shared resource template and are shared by other templates, so the shared resource template is run first.</span><span class="sxs-lookup"><span data-stu-id="2d887-286">These resources are provisioned using a single shared resource template and are shared by other templates, so the shared resource template is run first.</span></span>

<span data-ttu-id="2d887-287">Some resources are deployed optionally regardless of the specified known configuration.</span><span class="sxs-lookup"><span data-stu-id="2d887-287">Some resources are deployed optionally regardless of the specified known configuration.</span></span>

### <a name="shared-resources-template"></a><span data-ttu-id="2d887-288">Shared resources template</span><span class="sxs-lookup"><span data-stu-id="2d887-288">Shared resources template</span></span>
<span data-ttu-id="2d887-289">This template delivers resources that are common across all known configurations.</span><span class="sxs-lookup"><span data-stu-id="2d887-289">This template delivers resources that are common across all known configurations.</span></span> <span data-ttu-id="2d887-290">It contains the virtual network, availability sets, and other resources that are required regardless of the known configuration template that is deployed.</span><span class="sxs-lookup"><span data-stu-id="2d887-290">It contains the virtual network, availability sets, and other resources that are required regardless of the known configuration template that is deployed.</span></span>

![Template resources](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-design-templates/template-resources.png)

<span data-ttu-id="2d887-292">**Shared resources template**</span><span class="sxs-lookup"><span data-stu-id="2d887-292">**Shared resources template**</span></span>

<span data-ttu-id="2d887-293">Resource names, such as the virtual network name, are based on the main template.</span><span class="sxs-lookup"><span data-stu-id="2d887-293">Resource names, such as the virtual network name, are based on the main template.</span></span> <span data-ttu-id="2d887-294">You can specify them as a variable within that template or receive them as a parameter from the user, as required by your organization.</span><span class="sxs-lookup"><span data-stu-id="2d887-294">You can specify them as a variable within that template or receive them as a parameter from the user, as required by your organization.</span></span>

### <a name="optional-resources-template"></a><span data-ttu-id="2d887-295">Optional resources template</span><span class="sxs-lookup"><span data-stu-id="2d887-295">Optional resources template</span></span>
<span data-ttu-id="2d887-296">The optional resources template contains resources that are programmatically deployed based on the value of a parameter or variable.</span><span class="sxs-lookup"><span data-stu-id="2d887-296">The optional resources template contains resources that are programmatically deployed based on the value of a parameter or variable.</span></span>

![Optional resources](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-design-templates/optional-resources.png)

<span data-ttu-id="2d887-298">**Optional resources template**</span><span class="sxs-lookup"><span data-stu-id="2d887-298">**Optional resources template**</span></span>

<span data-ttu-id="2d887-299">For example, you can use an optional resources template to configure a jumpbox that enables indirect access to a deployed environment from the public Internet.</span><span class="sxs-lookup"><span data-stu-id="2d887-299">For example, you can use an optional resources template to configure a jumpbox that enables indirect access to a deployed environment from the public Internet.</span></span> <span data-ttu-id="2d887-300">You would use a parameter or variable to identify whether the jumpbox should be enabled and the *concat* function to build the target name for the template, such as *jumpbox_enabled.json*.</span><span class="sxs-lookup"><span data-stu-id="2d887-300">You would use a parameter or variable to identify whether the jumpbox should be enabled and the *concat* function to build the target name for the template, such as *jumpbox_enabled.json*.</span></span> <span data-ttu-id="2d887-301">Template linking would use the resulting variable to install the jumpbox.</span><span class="sxs-lookup"><span data-stu-id="2d887-301">Template linking would use the resulting variable to install the jumpbox.</span></span>

<span data-ttu-id="2d887-302">You can link the optional resources template from multiple places:</span><span class="sxs-lookup"><span data-stu-id="2d887-302">You can link the optional resources template from multiple places:</span></span>

* <span data-ttu-id="2d887-303">When applicable to every deployment, create a parameter-driven link from the shared resources template.</span><span class="sxs-lookup"><span data-stu-id="2d887-303">When applicable to every deployment, create a parameter-driven link from the shared resources template.</span></span>
* <span data-ttu-id="2d887-304">When applicable to select known configurations—for example, only install on large deployments—create a parameter-driven or variable-driven link from the known configuration template.</span><span class="sxs-lookup"><span data-stu-id="2d887-304">When applicable to select known configurations—for example, only install on large deployments—create a parameter-driven or variable-driven link from the known configuration template.</span></span>

<span data-ttu-id="2d887-305">Whether a given resource is optional may not be driven by the template consumer but instead by the template provider.</span><span class="sxs-lookup"><span data-stu-id="2d887-305">Whether a given resource is optional may not be driven by the template consumer but instead by the template provider.</span></span> <span data-ttu-id="2d887-306">For example, you may need to satisfy a particular product requirement or product add-on (common for CSVs) or to enforce policies (common for SIs and enterprise IT groups).</span><span class="sxs-lookup"><span data-stu-id="2d887-306">For example, you may need to satisfy a particular product requirement or product add-on (common for CSVs) or to enforce policies (common for SIs and enterprise IT groups).</span></span> <span data-ttu-id="2d887-307">In these cases, you can use a variable to identify whether the resource should be deployed.</span><span class="sxs-lookup"><span data-stu-id="2d887-307">In these cases, you can use a variable to identify whether the resource should be deployed.</span></span>

### <a name="known-configuration-resources-template"></a><span data-ttu-id="2d887-308">Known configuration resources template</span><span class="sxs-lookup"><span data-stu-id="2d887-308">Known configuration resources template</span></span>
<span data-ttu-id="2d887-309">In the main template, a parameter can be exposed to allow the template consumer to specify a desired known configuration to deploy.</span><span class="sxs-lookup"><span data-stu-id="2d887-309">In the main template, a parameter can be exposed to allow the template consumer to specify a desired known configuration to deploy.</span></span> <span data-ttu-id="2d887-310">Often, this known configuration uses a t-shirt size approach with a set of fixed configuration sizes such as sandbox, small, medium, and large.</span><span class="sxs-lookup"><span data-stu-id="2d887-310">Often, this known configuration uses a t-shirt size approach with a set of fixed configuration sizes such as sandbox, small, medium, and large.</span></span>

![Known configuration resources](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-design-templates/known-config.png)

<span data-ttu-id="2d887-312">**Known configuration resources template**</span><span class="sxs-lookup"><span data-stu-id="2d887-312">**Known configuration resources template**</span></span>

<span data-ttu-id="2d887-313">The t-shirt size approach is commonly used, but the parameters can represent any set of known configurations.</span><span class="sxs-lookup"><span data-stu-id="2d887-313">The t-shirt size approach is commonly used, but the parameters can represent any set of known configurations.</span></span> <span data-ttu-id="2d887-314">For example, you can specify a set of environments for an enterprise application such as Development, Test, and Product.</span><span class="sxs-lookup"><span data-stu-id="2d887-314">For example, you can specify a set of environments for an enterprise application such as Development, Test, and Product.</span></span> <span data-ttu-id="2d887-315">Or you could use it for a cloud service to represent different scale units, product versions, or product configurations such as Community, Developer, or Enterprise.</span><span class="sxs-lookup"><span data-stu-id="2d887-315">Or you could use it for a cloud service to represent different scale units, product versions, or product configurations such as Community, Developer, or Enterprise.</span></span>

<span data-ttu-id="2d887-316">As with the shared resource template, variables are passed to the known configurations template from either:</span><span class="sxs-lookup"><span data-stu-id="2d887-316">As with the shared resource template, variables are passed to the known configurations template from either:</span></span>

* <span data-ttu-id="2d887-317">An end user—that is, the parameters sent to the main template.</span><span class="sxs-lookup"><span data-stu-id="2d887-317">An end user—that is, the parameters sent to the main template.</span></span>
* <span data-ttu-id="2d887-318">An organization—that is, the variables in the main template that represent internal requirements or policies.</span><span class="sxs-lookup"><span data-stu-id="2d887-318">An organization—that is, the variables in the main template that represent internal requirements or policies.</span></span>

### <a name="member-resources-template"></a><span data-ttu-id="2d887-319">Member resources template</span><span class="sxs-lookup"><span data-stu-id="2d887-319">Member resources template</span></span>
<span data-ttu-id="2d887-320">Within a known configuration, one or more member node types are often included.</span><span class="sxs-lookup"><span data-stu-id="2d887-320">Within a known configuration, one or more member node types are often included.</span></span> <span data-ttu-id="2d887-321">For example, with Hadoop you have master nodes and data nodes.</span><span class="sxs-lookup"><span data-stu-id="2d887-321">For example, with Hadoop you have master nodes and data nodes.</span></span> <span data-ttu-id="2d887-322">If you are installing MongoDB, you have data nodes and an arbiter.</span><span class="sxs-lookup"><span data-stu-id="2d887-322">If you are installing MongoDB, you have data nodes and an arbiter.</span></span> <span data-ttu-id="2d887-323">If you are deploying DataStax, you have data nodes and a VM with OpsCenter installed.</span><span class="sxs-lookup"><span data-stu-id="2d887-323">If you are deploying DataStax, you have data nodes and a VM with OpsCenter installed.</span></span>

![Members resources](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-design-templates/member-resources.png)

<span data-ttu-id="2d887-325">**Member resources template**</span><span class="sxs-lookup"><span data-stu-id="2d887-325">**Member resources template**</span></span>

<span data-ttu-id="2d887-326">Each type of nodes can have different sizes of VMs, numbers of attached disks, scripts to install and set up the nodes, port configurations for the VMs, number of instances, and other details.</span><span class="sxs-lookup"><span data-stu-id="2d887-326">Each type of nodes can have different sizes of VMs, numbers of attached disks, scripts to install and set up the nodes, port configurations for the VMs, number of instances, and other details.</span></span> <span data-ttu-id="2d887-327">So each node type gets its own member resource template, which contains the details for deploying and configuring an infrastructure as well as executing scripts to deploy and configure software within the VM.</span><span class="sxs-lookup"><span data-stu-id="2d887-327">So each node type gets its own member resource template, which contains the details for deploying and configuring an infrastructure as well as executing scripts to deploy and configure software within the VM.</span></span>

<span data-ttu-id="2d887-328">For VMs, typically two types of scripts are used, widely reusable and custom scripts.</span><span class="sxs-lookup"><span data-stu-id="2d887-328">For VMs, typically two types of scripts are used, widely reusable and custom scripts.</span></span>

### <a name="widely-reusable-scripts"></a><span data-ttu-id="2d887-329">Widely reusable scripts</span><span class="sxs-lookup"><span data-stu-id="2d887-329">Widely reusable scripts</span></span>
<span data-ttu-id="2d887-330">Widely reusable scripts can be used across multiple types of templates.</span><span class="sxs-lookup"><span data-stu-id="2d887-330">Widely reusable scripts can be used across multiple types of templates.</span></span> <span data-ttu-id="2d887-331">One of the better examples of these widely reusable scripts sets up RAID on Linux to pool disks and gain a greater number of IOPS.</span><span class="sxs-lookup"><span data-stu-id="2d887-331">One of the better examples of these widely reusable scripts sets up RAID on Linux to pool disks and gain a greater number of IOPS.</span></span> <span data-ttu-id="2d887-332">Regardless of the software being installed in the VM, this script provides reuse of proven practices for common scenarios.</span><span class="sxs-lookup"><span data-stu-id="2d887-332">Regardless of the software being installed in the VM, this script provides reuse of proven practices for common scenarios.</span></span>

![Reusable scripts](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-design-templates/reusable-scripts.png)

<span data-ttu-id="2d887-334">**Member resources templates can call widely reusable scripts**</span><span class="sxs-lookup"><span data-stu-id="2d887-334">**Member resources templates can call widely reusable scripts**</span></span>

### <a name="custom-scripts"></a><span data-ttu-id="2d887-335">Custom scripts</span><span class="sxs-lookup"><span data-stu-id="2d887-335">Custom scripts</span></span>
<span data-ttu-id="2d887-336">Templates commonly call one or more scripts that install and configure software within VMs.</span><span class="sxs-lookup"><span data-stu-id="2d887-336">Templates commonly call one or more scripts that install and configure software within VMs.</span></span> <span data-ttu-id="2d887-337">A common pattern is seen with large topologies where multiple instances of one or more member types are deployed.</span><span class="sxs-lookup"><span data-stu-id="2d887-337">A common pattern is seen with large topologies where multiple instances of one or more member types are deployed.</span></span> <span data-ttu-id="2d887-338">An installation script is initiated for every VM that can be run in parallel, followed by a setup script that is called after all VMs (or all VMs of a given member type) are deployed.</span><span class="sxs-lookup"><span data-stu-id="2d887-338">An installation script is initiated for every VM that can be run in parallel, followed by a setup script that is called after all VMs (or all VMs of a given member type) are deployed.</span></span>

![Custom scripts](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-design-templates/custom-scripts.png)

<span data-ttu-id="2d887-340">**Member resources templates can call scripts for a specific purpose such as VM configuration**</span><span class="sxs-lookup"><span data-stu-id="2d887-340">**Member resources templates can call scripts for a specific purpose such as VM configuration**</span></span>

## <a name="capability-scoped-solution-template-example---redis"></a><span data-ttu-id="2d887-341">Capability-scoped solution template example - Redis</span><span class="sxs-lookup"><span data-stu-id="2d887-341">Capability-scoped solution template example - Redis</span></span>
<span data-ttu-id="2d887-342">To show how an implementation might work, let's look at a practical example of building a template that facilitates the deployment and configuration of Redis in standard t-shirt sizes.</span><span class="sxs-lookup"><span data-stu-id="2d887-342">To show how an implementation might work, let's look at a practical example of building a template that facilitates the deployment and configuration of Redis in standard t-shirt sizes.</span></span>  

<span data-ttu-id="2d887-343">For the deployment, there are a set of shared resources (virtual network, storage account, availability sets) and an optional resource (jumpbox).</span><span class="sxs-lookup"><span data-stu-id="2d887-343">For the deployment, there are a set of shared resources (virtual network, storage account, availability sets) and an optional resource (jumpbox).</span></span> <span data-ttu-id="2d887-344">There are multiple known configurations represented as t-shirt sizes (small, medium, large) but each with a single node type.</span><span class="sxs-lookup"><span data-stu-id="2d887-344">There are multiple known configurations represented as t-shirt sizes (small, medium, large) but each with a single node type.</span></span> <span data-ttu-id="2d887-345">There are also two purpose-specific scripts (installation, configuration).</span><span class="sxs-lookup"><span data-stu-id="2d887-345">There are also two purpose-specific scripts (installation, configuration).</span></span>

### <a name="creating-the-template-files"></a><span data-ttu-id="2d887-346">Creating the template files</span><span class="sxs-lookup"><span data-stu-id="2d887-346">Creating the template files</span></span>
<span data-ttu-id="2d887-347">You would create a Main Template named azuredeploy.json.</span><span class="sxs-lookup"><span data-stu-id="2d887-347">You would create a Main Template named azuredeploy.json.</span></span>

<span data-ttu-id="2d887-348">You create Shared Resources Template named shared-resources.json</span><span class="sxs-lookup"><span data-stu-id="2d887-348">You create Shared Resources Template named shared-resources.json</span></span>

<span data-ttu-id="2d887-349">You create an Optional Resource Template to enable the deployment of a jumpbox, named jumpbox_enabled.json</span><span class="sxs-lookup"><span data-stu-id="2d887-349">You create an Optional Resource Template to enable the deployment of a jumpbox, named jumpbox_enabled.json</span></span>

<span data-ttu-id="2d887-350">Redis uses just a single node type, so you create a single Member Resource Template named node-resources.json.</span><span class="sxs-lookup"><span data-stu-id="2d887-350">Redis uses just a single node type, so you create a single Member Resource Template named node-resources.json.</span></span>

<span data-ttu-id="2d887-351">With Redis, you want to install each individual node, and then set up the cluster.</span><span class="sxs-lookup"><span data-stu-id="2d887-351">With Redis, you want to install each individual node, and then set up the cluster.</span></span>  <span data-ttu-id="2d887-352">You have scripts to accommodate the installation and set up, redis-cluster-install.sh and redis-cluster-setup.sh.</span><span class="sxs-lookup"><span data-stu-id="2d887-352">You have scripts to accommodate the installation and set up, redis-cluster-install.sh and redis-cluster-setup.sh.</span></span>

### <a name="linking-the-templates"></a><span data-ttu-id="2d887-353">Linking the templates</span><span class="sxs-lookup"><span data-stu-id="2d887-353">Linking the templates</span></span>
<span data-ttu-id="2d887-354">Using template linking, the main template links out to the shared resources template, which establishes the virtual network.</span><span class="sxs-lookup"><span data-stu-id="2d887-354">Using template linking, the main template links out to the shared resources template, which establishes the virtual network.</span></span>

<span data-ttu-id="2d887-355">Logic is added within the main template to enable consumers of the template to specify whether a jumpbox should be deployed.</span><span class="sxs-lookup"><span data-stu-id="2d887-355">Logic is added within the main template to enable consumers of the template to specify whether a jumpbox should be deployed.</span></span> <span data-ttu-id="2d887-356">An *enabled* value for the *EnableJumpbox* parameter indicates that the customer wants to deploy a jumpbox.</span><span class="sxs-lookup"><span data-stu-id="2d887-356">An *enabled* value for the *EnableJumpbox* parameter indicates that the customer wants to deploy a jumpbox.</span></span> <span data-ttu-id="2d887-357">When this value is provided, the template concatenates *_enabled* as a suffix to a base template name for the jumpbox capability.</span><span class="sxs-lookup"><span data-stu-id="2d887-357">When this value is provided, the template concatenates *_enabled* as a suffix to a base template name for the jumpbox capability.</span></span>

<span data-ttu-id="2d887-358">The main template applies the *large* parameter value as a suffix to a base template name for t-shirt sizes, and then uses that value in a template link out to *technology_on_os_large.json*.</span><span class="sxs-lookup"><span data-stu-id="2d887-358">The main template applies the *large* parameter value as a suffix to a base template name for t-shirt sizes, and then uses that value in a template link out to *technology_on_os_large.json*.</span></span>

<span data-ttu-id="2d887-359">The topology would resemble this illustration.</span><span class="sxs-lookup"><span data-stu-id="2d887-359">The topology would resemble this illustration.</span></span>

![Redis template](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-design-templates/redis-template.png)

<span data-ttu-id="2d887-361">**Template structure for a Redis template**</span><span class="sxs-lookup"><span data-stu-id="2d887-361">**Template structure for a Redis template**</span></span>

### <a name="configuring-state"></a><span data-ttu-id="2d887-362">Configuring state</span><span class="sxs-lookup"><span data-stu-id="2d887-362">Configuring state</span></span>
<span data-ttu-id="2d887-363">For the nodes in the cluster, there are two steps to configuring the state, both represented by Purpose Specific Scripts.</span><span class="sxs-lookup"><span data-stu-id="2d887-363">For the nodes in the cluster, there are two steps to configuring the state, both represented by Purpose Specific Scripts.</span></span>  <span data-ttu-id="2d887-364">"redis-cluster-install.sh" installs Redis and "redis-cluster-setup.sh" sets up the cluster.</span><span class="sxs-lookup"><span data-stu-id="2d887-364">"redis-cluster-install.sh" installs Redis and "redis-cluster-setup.sh" sets up the cluster.</span></span>

### <a name="supporting-different-size-deployments"></a><span data-ttu-id="2d887-365">Supporting Different Size Deployments</span><span class="sxs-lookup"><span data-stu-id="2d887-365">Supporting Different Size Deployments</span></span>
<span data-ttu-id="2d887-366">Inside variables, the t-shirt size template specifies the number of nodes of each type to deploy for the specified size (*large*).</span><span class="sxs-lookup"><span data-stu-id="2d887-366">Inside variables, the t-shirt size template specifies the number of nodes of each type to deploy for the specified size (*large*).</span></span> <span data-ttu-id="2d887-367">It then deploys that number of VM instances using resource loops, providing unique names to resources by appending a node name with a numeric sequence number from *copyIndex()*.</span><span class="sxs-lookup"><span data-stu-id="2d887-367">It then deploys that number of VM instances using resource loops, providing unique names to resources by appending a node name with a numeric sequence number from *copyIndex()*.</span></span> <span data-ttu-id="2d887-368">It does these steps for both hot and warm zone VMs, as defined in the t-shirt name template</span><span class="sxs-lookup"><span data-stu-id="2d887-368">It does these steps for both hot and warm zone VMs, as defined in the t-shirt name template</span></span>

## <a name="decomposition-and-end-to-end-solution-scoped-templates"></a><span data-ttu-id="2d887-369">Decomposition and end-to-end solution scoped templates</span><span class="sxs-lookup"><span data-stu-id="2d887-369">Decomposition and end-to-end solution scoped templates</span></span>
<span data-ttu-id="2d887-370">A solution template with an end-to-end solution scope is focused on delivering an end-to-end solution.</span><span class="sxs-lookup"><span data-stu-id="2d887-370">A solution template with an end-to-end solution scope is focused on delivering an end-to-end solution.</span></span>  <span data-ttu-id="2d887-371">This approach is typically a composition of multiple capability-scoped templates with additional resources, logic, and state.</span><span class="sxs-lookup"><span data-stu-id="2d887-371">This approach is typically a composition of multiple capability-scoped templates with additional resources, logic, and state.</span></span>

<span data-ttu-id="2d887-372">As highlighted in the image below, the same model used for capability scoped templates is extended for templates with an End-to-End Solution Scope.</span><span class="sxs-lookup"><span data-stu-id="2d887-372">As highlighted in the image below, the same model used for capability scoped templates is extended for templates with an End-to-End Solution Scope.</span></span>

<span data-ttu-id="2d887-373">A Shared Resources Template and Optional Resources Templates serve the same function as in the capacity and capability scoped template approaches, but are scoped for the end to end solution.</span><span class="sxs-lookup"><span data-stu-id="2d887-373">A Shared Resources Template and Optional Resources Templates serve the same function as in the capacity and capability scoped template approaches, but are scoped for the end to end solution.</span></span>

<span data-ttu-id="2d887-374">As end to end solution scoped templates also can typically have t-shirt sizes, the Known Configuration Resources template reflects what is required for a given known configuration of the solution.</span><span class="sxs-lookup"><span data-stu-id="2d887-374">As end to end solution scoped templates also can typically have t-shirt sizes, the Known Configuration Resources template reflects what is required for a given known configuration of the solution.</span></span>

<span data-ttu-id="2d887-375">The Known Configuration Resources Template links to one or more capability scoped solution templates that are relevant to the end to end solution as well as the Member Resource Templates that are required for the end to end solution.</span><span class="sxs-lookup"><span data-stu-id="2d887-375">The Known Configuration Resources Template links to one or more capability scoped solution templates that are relevant to the end to end solution as well as the Member Resource Templates that are required for the end to end solution.</span></span>

<span data-ttu-id="2d887-376">As the t-shirt size of the solution may be different than the individual capability-scoped template, variables within the Known Configuration Resources Template are used to provide the appropriate values for downstream capability scoped solution templates to deploy the appropriate t-shirt size.</span><span class="sxs-lookup"><span data-stu-id="2d887-376">As the t-shirt size of the solution may be different than the individual capability-scoped template, variables within the Known Configuration Resources Template are used to provide the appropriate values for downstream capability scoped solution templates to deploy the appropriate t-shirt size.</span></span>

![End-to-end](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-design-templates/end-to-end.png)

<span data-ttu-id="2d887-378">**The model used for capacity or capability scoped solution templates can be readily extended for end to end solution template scopes**</span><span class="sxs-lookup"><span data-stu-id="2d887-378">**The model used for capacity or capability scoped solution templates can be readily extended for end to end solution template scopes**</span></span>

## <a name="preparing-templates-for-the-marketplace"></a><span data-ttu-id="2d887-379">Preparing templates for the Marketplace</span><span class="sxs-lookup"><span data-stu-id="2d887-379">Preparing templates for the Marketplace</span></span>
<span data-ttu-id="2d887-380">The preceding approach readily accommodates scenarios where Enterprises, SIs, and CSVs want to either deploy the templates themselves or enable their customers to deploy on their own.</span><span class="sxs-lookup"><span data-stu-id="2d887-380">The preceding approach readily accommodates scenarios where Enterprises, SIs, and CSVs want to either deploy the templates themselves or enable their customers to deploy on their own.</span></span>

<span data-ttu-id="2d887-381">Another desired scenario is deploying a template via the marketplace.</span><span class="sxs-lookup"><span data-stu-id="2d887-381">Another desired scenario is deploying a template via the marketplace.</span></span>  <span data-ttu-id="2d887-382">This decomposition approach works for the marketplace as well, with some minor changes.</span><span class="sxs-lookup"><span data-stu-id="2d887-382">This decomposition approach works for the marketplace as well, with some minor changes.</span></span>

<span data-ttu-id="2d887-383">As mentioned previously, templates can be used to offer distinct deployment types for sale in the marketplace.</span><span class="sxs-lookup"><span data-stu-id="2d887-383">As mentioned previously, templates can be used to offer distinct deployment types for sale in the marketplace.</span></span> <span data-ttu-id="2d887-384">Distinct deployment types may be t-shirt sizes (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span><span class="sxs-lookup"><span data-stu-id="2d887-384">Distinct deployment types may be t-shirt sizes (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span></span>

<span data-ttu-id="2d887-385">As shown below, the existing end to end solution or capability scoped templates can be readily utilized to list the different known configurations in the marketplace.</span><span class="sxs-lookup"><span data-stu-id="2d887-385">As shown below, the existing end to end solution or capability scoped templates can be readily utilized to list the different known configurations in the marketplace.</span></span>

<span data-ttu-id="2d887-386">The parameters to the main template are first modified to remove the inbound parameter named tshirtSize.</span><span class="sxs-lookup"><span data-stu-id="2d887-386">The parameters to the main template are first modified to remove the inbound parameter named tshirtSize.</span></span>

<span data-ttu-id="2d887-387">While the distinct deployment types map to the Known Configuration Resources Template, they also need the common resources and configuration found in the Shared Resources Template and potentially those in Optional Resource Templates.</span><span class="sxs-lookup"><span data-stu-id="2d887-387">While the distinct deployment types map to the Known Configuration Resources Template, they also need the common resources and configuration found in the Shared Resources Template and potentially those in Optional Resource Templates.</span></span>

<span data-ttu-id="2d887-388">If you want to publish your template to the marketplace, you establish distinct copies of your Main template that replaces the previously available inbound parameter of tshirtSize to a variable embedded within the template.</span><span class="sxs-lookup"><span data-stu-id="2d887-388">If you want to publish your template to the marketplace, you establish distinct copies of your Main template that replaces the previously available inbound parameter of tshirtSize to a variable embedded within the template.</span></span>

![Marketplace](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-design-templates/marketplace.png)

<span data-ttu-id="2d887-390">**Adapting a solution scoped template for the marketplace**</span><span class="sxs-lookup"><span data-stu-id="2d887-390">**Adapting a solution scoped template for the marketplace**</span></span>

## <a name="next-steps"></a><span data-ttu-id="2d887-391">Next steps</span><span class="sxs-lookup"><span data-stu-id="2d887-391">Next steps</span></span>
* <span data-ttu-id="2d887-392">For recommendations about how to handle security in Azure Resource Manager, see [Security considerations for Azure Resource Manager](best-practices-resource-manager-security.md)</span><span class="sxs-lookup"><span data-stu-id="2d887-392">For recommendations about how to handle security in Azure Resource Manager, see [Security considerations for Azure Resource Manager](best-practices-resource-manager-security.md)</span></span>
* <span data-ttu-id="2d887-393">To learn about sharing state into and out of templates, see [Sharing state in Azure Resource Manager templates](best-practices-resource-manager-state.md).</span><span class="sxs-lookup"><span data-stu-id="2d887-393">To learn about sharing state into and out of templates, see [Sharing state in Azure Resource Manager templates](best-practices-resource-manager-state.md).</span></span>
* <span data-ttu-id="2d887-394">For guidance on how enterprises can use Resource Manager to effectively manage subscriptions, see [Azure enterprise scaffold - prescriptive subscription governance](resource-manager-subscription-governance.md).</span><span class="sxs-lookup"><span data-stu-id="2d887-394">For guidance on how enterprises can use Resource Manager to effectively manage subscriptions, see [Azure enterprise scaffold - prescriptive subscription governance](resource-manager-subscription-governance.md).</span></span>













