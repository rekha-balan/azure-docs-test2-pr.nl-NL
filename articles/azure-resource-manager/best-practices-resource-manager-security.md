---
title: Security considerations for Resource Manager | Microsoft Docs
description: Shows recommended approaches in Azure Resource Manager for securing resources with keys and secrets, role-based access control and network security groups.
services: azure-resource-manager
documentationcenter: ''
author: george-moore
manager: georgem
editor: tysonn
ms.assetid: c862e9c7-276b-46bf-bc0a-11868ac11459
ms.service: azure-resource-manager
ms.workload: multiple
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/01/2016
ms.author: georgem;tomfitz
ms.openlocfilehash: d40cbc9e62beed5bee6f8166c04d876ee6ed9029
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44564191"
---
# <a name="security-considerations-for-azure-resource-manager"></a><span data-ttu-id="eb215-103">Security considerations for Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="eb215-103">Security considerations for Azure Resource Manager</span></span>
<span data-ttu-id="eb215-104">When looking at aspects of security for your Azure Resource Manager templates, there are several areas to consider – keys and secrets, role-based access control, and network security groups.</span><span class="sxs-lookup"><span data-stu-id="eb215-104">When looking at aspects of security for your Azure Resource Manager templates, there are several areas to consider – keys and secrets, role-based access control, and network security groups.</span></span>

<span data-ttu-id="eb215-105">This topic assumes you are familiar with Role-Based Access Control (RBAC) in Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="eb215-105">This topic assumes you are familiar with Role-Based Access Control (RBAC) in Azure Resource Manager.</span></span> <span data-ttu-id="eb215-106">For more information, see [Azure Role-based Access Control](../active-directory/role-based-access-control-configure.md).</span><span class="sxs-lookup"><span data-stu-id="eb215-106">For more information, see [Azure Role-based Access Control](../active-directory/role-based-access-control-configure.md).</span></span>

<span data-ttu-id="eb215-107">This topic is part of a larger whitepaper.</span><span class="sxs-lookup"><span data-stu-id="eb215-107">This topic is part of a larger whitepaper.</span></span> <span data-ttu-id="eb215-108">To read the full paper, download [World Class ARM Templates Considerations and Proven Practices](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf).</span><span class="sxs-lookup"><span data-stu-id="eb215-108">To read the full paper, download [World Class ARM Templates Considerations and Proven Practices](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf).</span></span>

## <a name="secrets-and-certificates"></a><span data-ttu-id="eb215-109">Secrets and certificates</span><span class="sxs-lookup"><span data-stu-id="eb215-109">Secrets and certificates</span></span>
<span data-ttu-id="eb215-110">Azure Virtual Machines, Azure Resource Manager and Azure Key Vault are fully integrated to provide support for the secure handling of certificates which are to be deployed in the VM.</span><span class="sxs-lookup"><span data-stu-id="eb215-110">Azure Virtual Machines, Azure Resource Manager and Azure Key Vault are fully integrated to provide support for the secure handling of certificates which are to be deployed in the VM.</span></span>  <span data-ttu-id="eb215-111">Utilizing Azure Key Vault with Resource Manager to orchestrate and store VM secrets and certificates is a best practice and provides the following advantages:</span><span class="sxs-lookup"><span data-stu-id="eb215-111">Utilizing Azure Key Vault with Resource Manager to orchestrate and store VM secrets and certificates is a best practice and provides the following advantages:</span></span>

* <span data-ttu-id="eb215-112">The templates only contain URI references to the secrets, which means the actual secrets are not in code, configuration or source code repositories.</span><span class="sxs-lookup"><span data-stu-id="eb215-112">The templates only contain URI references to the secrets, which means the actual secrets are not in code, configuration or source code repositories.</span></span> <span data-ttu-id="eb215-113">This prevents key phishing attacks on internal or external repos, such as harvest-bots in GitHub.</span><span class="sxs-lookup"><span data-stu-id="eb215-113">This prevents key phishing attacks on internal or external repos, such as harvest-bots in GitHub.</span></span>
* <span data-ttu-id="eb215-114">Secrets stored in the Key Vault are under full RBAC control of a trusted operator.</span><span class="sxs-lookup"><span data-stu-id="eb215-114">Secrets stored in the Key Vault are under full RBAC control of a trusted operator.</span></span>  <span data-ttu-id="eb215-115">If the trusted operator leaves the company or transfers within the company to a new group, they no longer have access to the keys they created in the Vault.</span><span class="sxs-lookup"><span data-stu-id="eb215-115">If the trusted operator leaves the company or transfers within the company to a new group, they no longer have access to the keys they created in the Vault.</span></span>
* <span data-ttu-id="eb215-116">Full compartmentalization of all assets:</span><span class="sxs-lookup"><span data-stu-id="eb215-116">Full compartmentalization of all assets:</span></span>
  * <span data-ttu-id="eb215-117">the templates to deploy the keys</span><span class="sxs-lookup"><span data-stu-id="eb215-117">the templates to deploy the keys</span></span>
  * <span data-ttu-id="eb215-118">the templates to deploy a VM with references to the keys</span><span class="sxs-lookup"><span data-stu-id="eb215-118">the templates to deploy a VM with references to the keys</span></span>
  * <span data-ttu-id="eb215-119">the actual key materials in the Vault.</span><span class="sxs-lookup"><span data-stu-id="eb215-119">the actual key materials in the Vault.</span></span>  
    <span data-ttu-id="eb215-120">Each template (and action) can be under different RBAC roles for full separation of duties.</span><span class="sxs-lookup"><span data-stu-id="eb215-120">Each template (and action) can be under different RBAC roles for full separation of duties.</span></span>
* <span data-ttu-id="eb215-121">The loading of secrets into a VM at deployment time occurs via direct channel between the Azure Fabric and the Key Vault within the confines of the Microsoft datacenter.</span><span class="sxs-lookup"><span data-stu-id="eb215-121">The loading of secrets into a VM at deployment time occurs via direct channel between the Azure Fabric and the Key Vault within the confines of the Microsoft datacenter.</span></span>  <span data-ttu-id="eb215-122">Once the keys are in the Key Vault, they never see 'daylight' over an untrusted channel outside of the datacenter.</span><span class="sxs-lookup"><span data-stu-id="eb215-122">Once the keys are in the Key Vault, they never see 'daylight' over an untrusted channel outside of the datacenter.</span></span>  
* <span data-ttu-id="eb215-123">Key Vaults are always regional, so the secrets always have locality (and sovereignty) with the VMs.</span><span class="sxs-lookup"><span data-stu-id="eb215-123">Key Vaults are always regional, so the secrets always have locality (and sovereignty) with the VMs.</span></span> <span data-ttu-id="eb215-124">There are no global Key Vaults.</span><span class="sxs-lookup"><span data-stu-id="eb215-124">There are no global Key Vaults.</span></span>

### <a name="separation-of-keys-from-deployments"></a><span data-ttu-id="eb215-125">Separation of keys from deployments</span><span class="sxs-lookup"><span data-stu-id="eb215-125">Separation of keys from deployments</span></span>
<span data-ttu-id="eb215-126">A best practice is to maintain separate templates for:</span><span class="sxs-lookup"><span data-stu-id="eb215-126">A best practice is to maintain separate templates for:</span></span>

1. <span data-ttu-id="eb215-127">Creation of vaults (which will contain the key material)</span><span class="sxs-lookup"><span data-stu-id="eb215-127">Creation of vaults (which will contain the key material)</span></span>
2. <span data-ttu-id="eb215-128">Deployment of the VMs (with URI references to the keys contained in the vaults)</span><span class="sxs-lookup"><span data-stu-id="eb215-128">Deployment of the VMs (with URI references to the keys contained in the vaults)</span></span>

<span data-ttu-id="eb215-129">A typical enterprise scenario is to have a small group of Trusted Operators who have access to critical secrets within the deployed workloads, with a broader group of dev/ops personnel who can create or update VM deployments.</span><span class="sxs-lookup"><span data-stu-id="eb215-129">A typical enterprise scenario is to have a small group of Trusted Operators who have access to critical secrets within the deployed workloads, with a broader group of dev/ops personnel who can create or update VM deployments.</span></span>  <span data-ttu-id="eb215-130">Below is an example ARM template which creates and configures a new vault in the context of the currently authenticated user's identity in Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="eb215-130">Below is an example ARM template which creates and configures a new vault in the context of the currently authenticated user's identity in Azure Active Directory.</span></span>  <span data-ttu-id="eb215-131">This user would have the default permission to create, delete, list, update, backup, restore, and get the public half of keys in this new key vault.</span><span class="sxs-lookup"><span data-stu-id="eb215-131">This user would have the default permission to create, delete, list, update, backup, restore, and get the public half of keys in this new key vault.</span></span>

<span data-ttu-id="eb215-132">While most of the fields in this template should be self-explanatory, the **enableVaultForDeployment** setting deserves more background: vaults do not have any default standing access by any other Azure infrastructure component.</span><span class="sxs-lookup"><span data-stu-id="eb215-132">While most of the fields in this template should be self-explanatory, the **enableVaultForDeployment** setting deserves more background: vaults do not have any default standing access by any other Azure infrastructure component.</span></span> <span data-ttu-id="eb215-133">By setting this value, it allows the Azure Compute infrastructure components read-only access to this specific named vault.</span><span class="sxs-lookup"><span data-stu-id="eb215-133">By setting this value, it allows the Azure Compute infrastructure components read-only access to this specific named vault.</span></span> <span data-ttu-id="eb215-134">Therefore, a further best practice is to not comingle corporate sensitive data in the same vault as virtual machine secrets.</span><span class="sxs-lookup"><span data-stu-id="eb215-134">Therefore, a further best practice is to not comingle corporate sensitive data in the same vault as virtual machine secrets.</span></span>

    {
        "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
        "contentVersion": "1.0.0.0",
        "parameters": {
            "keyVaultName": {
                "type": "string",
                "metadata": {
                    "description": "Name of the Vault"
                }
            },
            "location": {
                "type": "string",
                "allowedValues": ["East US", "West US", "West Europe", "East Asia", "South East Asia"],
                "metadata": {
                    "description": "Location of the Vault"
                }
            },
            "tenantId": {
                "type": "string",
                "metadata": {
                    "description": "Tenant Id of the subscription. Get using Get-AzureSubscription cmdlet or Get Subscription API"
                }
            },
            "objectId": {
                "type": "string",
                "metadata": {
                    "description": "Object Id of the AD user. Get using Get-AzureADUser cmdlet"
                }
            },
            "skuName": {
                "type": "string",
                "allowedValues": ["Standard", "Premium"],
                "metadata": {
                    "description": "SKU for the vault"
                }
            },
            "enableVaultForDeployment": {
                "type": "bool",
                "allowedValues": [true, false],
                "metadata": {
                    "description": "Specifies if the vault is enabled for a VM deployment"
                }
            }
        },
        "resources": [{
            "type": "Microsoft.KeyVault/vaults",
            "name": "[parameters('keyVaultName')]",
            "apiVersion": "2014-12-19-preview",
            "location": "[parameters('location')]",
            "properties": {
                "enabledForDeployment": "[parameters('enableVaultForDeployment')]",
                "tenantid": "[parameters('tenantId')]",
                "accessPolicies": [{
                    "tenantId": "[parameters('tenantId')]",
                    "objectId": "[parameters('objectId')]",
                    "permissions": {
                        "secrets": ["all"],
                        "keys": ["all"]
                    }
                }],
                "sku": {
                    "name": "[parameters('skuName')]",
                    "family": "A"
                }
            }
        }]
    }

<span data-ttu-id="eb215-135">Once the vault is created, the next step is to reference that vault in the deployment template of a new VM.</span><span class="sxs-lookup"><span data-stu-id="eb215-135">Once the vault is created, the next step is to reference that vault in the deployment template of a new VM.</span></span>  <span data-ttu-id="eb215-136">As mentioned above, a best practice is to have a different dev/ops group manage VM deployments, with that group having no direct access to the keys as stored in the vault.</span><span class="sxs-lookup"><span data-stu-id="eb215-136">As mentioned above, a best practice is to have a different dev/ops group manage VM deployments, with that group having no direct access to the keys as stored in the vault.</span></span>

<span data-ttu-id="eb215-137">The below template fragment would be composed into higher order deployment constructs, each safely and securely referencing highly-sensitive secrets which are not under the direct control of the operator.</span><span class="sxs-lookup"><span data-stu-id="eb215-137">The below template fragment would be composed into higher order deployment constructs, each safely and securely referencing highly-sensitive secrets which are not under the direct control of the operator.</span></span>

    "vaultName": {
        "type": "string",
        "metadata": {
            "description": "Name of Key Vault that has a secret"
        }
    },
    {
        "apiVersion": "2015-05-01-preview",
        "type": "Microsoft.Compute/virtualMachines",
        "name": "[parameters('vmName')]",
        "location": "[parameters('location')]",
        "properties": {
            "osProfile": {
                "secrets": [{
                    "sourceVault": {
                        "id": "[resourceId('vaultrg', 'Microsoft.KeyVault/vaults', 'kayvault')]"
                    },
                    "vaultCertificates": [{
                        "certificateUrl": "[parameters('secretUrlWithVersion')]",
                        "certificateStore": "My"
                    }]
                }]
            }
        }
    }

<span data-ttu-id="eb215-138">To pass a value from a key vault as a parameter during deployment of a template, see [Pass secure values during deployment](resource-manager-keyvault-parameter.md).</span><span class="sxs-lookup"><span data-stu-id="eb215-138">To pass a value from a key vault as a parameter during deployment of a template, see [Pass secure values during deployment](resource-manager-keyvault-parameter.md).</span></span>

## <a name="service-principals-for-cross-subscription-interactions"></a><span data-ttu-id="eb215-139">Service principals for cross-subscription interactions</span><span class="sxs-lookup"><span data-stu-id="eb215-139">Service principals for cross-subscription interactions</span></span>
<span data-ttu-id="eb215-140">Service identities are represented by service principals in Active Directory.</span><span class="sxs-lookup"><span data-stu-id="eb215-140">Service identities are represented by service principals in Active Directory.</span></span> <span data-ttu-id="eb215-141">Service principals will be at the center of enabling key scenarios for Enterprise IT organizations, System Integrators (SI), and Cloud Service Vendors (CSV).</span><span class="sxs-lookup"><span data-stu-id="eb215-141">Service principals will be at the center of enabling key scenarios for Enterprise IT organizations, System Integrators (SI), and Cloud Service Vendors (CSV).</span></span> <span data-ttu-id="eb215-142">Specifically, there will be use cases where one of these organizations will need to interact with the subscription of one of their customers.</span><span class="sxs-lookup"><span data-stu-id="eb215-142">Specifically, there will be use cases where one of these organizations will need to interact with the subscription of one of their customers.</span></span>  

<span data-ttu-id="eb215-143">Your organization could provide an offering that will monitor a solution deployed in your customers environment and subscription.</span><span class="sxs-lookup"><span data-stu-id="eb215-143">Your organization could provide an offering that will monitor a solution deployed in your customers environment and subscription.</span></span> <span data-ttu-id="eb215-144">In this case, you will need to get access to logs and other data within a customers account so that you can utilize it in your monitoring solution.</span><span class="sxs-lookup"><span data-stu-id="eb215-144">In this case, you will need to get access to logs and other data within a customers account so that you can utilize it in your monitoring solution.</span></span> <span data-ttu-id="eb215-145">If you're a corporate IT organization, a systems integrator, you may provide an offering to a customer where you will deploy and manage a capability for them, such as a data analytics platform, where the offering resides in the customers own subscription.</span><span class="sxs-lookup"><span data-stu-id="eb215-145">If you're a corporate IT organization, a systems integrator, you may provide an offering to a customer where you will deploy and manage a capability for them, such as a data analytics platform, where the offering resides in the customers own subscription.</span></span>

<span data-ttu-id="eb215-146">In these use cases, your organization would require an identity that could be given access to perform these actions within the context of a customer subscription.</span><span class="sxs-lookup"><span data-stu-id="eb215-146">In these use cases, your organization would require an identity that could be given access to perform these actions within the context of a customer subscription.</span></span>  

<span data-ttu-id="eb215-147">These scenarios bring with them a certain set of considerations for your customer:</span><span class="sxs-lookup"><span data-stu-id="eb215-147">These scenarios bring with them a certain set of considerations for your customer:</span></span>

* <span data-ttu-id="eb215-148">For security reasons, access may need to be scoped to certain types of actions, e.g. read only access.</span><span class="sxs-lookup"><span data-stu-id="eb215-148">For security reasons, access may need to be scoped to certain types of actions, e.g. read only access.</span></span>
* <span data-ttu-id="eb215-149">As deployed resources are provided at a cost, there may be similar constraints on access required for financial reasons.</span><span class="sxs-lookup"><span data-stu-id="eb215-149">As deployed resources are provided at a cost, there may be similar constraints on access required for financial reasons.</span></span>
* <span data-ttu-id="eb215-150">For security reasons, access may need to be scoped only to a specific resource (storage accounts) or resources (resource group containing an environment or solution)</span><span class="sxs-lookup"><span data-stu-id="eb215-150">For security reasons, access may need to be scoped only to a specific resource (storage accounts) or resources (resource group containing an environment or solution)</span></span>
* <span data-ttu-id="eb215-151">As a relationship with a vendor may change, the customer will want to have the ability to enable/disable access to SI or CSV</span><span class="sxs-lookup"><span data-stu-id="eb215-151">As a relationship with a vendor may change, the customer will want to have the ability to enable/disable access to SI or CSV</span></span>
* <span data-ttu-id="eb215-152">As actions against this account having billing implications, the customer desires support for auditability and accountability for billing.</span><span class="sxs-lookup"><span data-stu-id="eb215-152">As actions against this account having billing implications, the customer desires support for auditability and accountability for billing.</span></span>
* <span data-ttu-id="eb215-153">From a compliance perspective, the customer will want to be able to audit your behavior within their environment</span><span class="sxs-lookup"><span data-stu-id="eb215-153">From a compliance perspective, the customer will want to be able to audit your behavior within their environment</span></span>

<span data-ttu-id="eb215-154">A combination of a service principal and RBAC can be used to address these requirements.</span><span class="sxs-lookup"><span data-stu-id="eb215-154">A combination of a service principal and RBAC can be used to address these requirements.</span></span>

## <a name="network-security-groups"></a><span data-ttu-id="eb215-155">Network security groups</span><span class="sxs-lookup"><span data-stu-id="eb215-155">Network security groups</span></span>
<span data-ttu-id="eb215-156">Many scenarios will have requirements that specify how traffic to one or more VM instances in your virtual network is controlled.</span><span class="sxs-lookup"><span data-stu-id="eb215-156">Many scenarios will have requirements that specify how traffic to one or more VM instances in your virtual network is controlled.</span></span> <span data-ttu-id="eb215-157">You can use a Network Security Group (NSG) to do this as part of an ARM template deployment.</span><span class="sxs-lookup"><span data-stu-id="eb215-157">You can use a Network Security Group (NSG) to do this as part of an ARM template deployment.</span></span>

<span data-ttu-id="eb215-158">A network security group is a top-level object that is associated with your subscription.</span><span class="sxs-lookup"><span data-stu-id="eb215-158">A network security group is a top-level object that is associated with your subscription.</span></span> <span data-ttu-id="eb215-159">An NSG contains access control rules that allow or deny traffic to VM instances.</span><span class="sxs-lookup"><span data-stu-id="eb215-159">An NSG contains access control rules that allow or deny traffic to VM instances.</span></span> <span data-ttu-id="eb215-160">The rules of an NSG can be changed at any time, and changes are applied to all associated instances.</span><span class="sxs-lookup"><span data-stu-id="eb215-160">The rules of an NSG can be changed at any time, and changes are applied to all associated instances.</span></span> <span data-ttu-id="eb215-161">To use an NSG, you must have a virtual network that is associated with a region (location).</span><span class="sxs-lookup"><span data-stu-id="eb215-161">To use an NSG, you must have a virtual network that is associated with a region (location).</span></span> <span data-ttu-id="eb215-162">NSGs are not compatible with virtual networks that are associated with an affinity group.</span><span class="sxs-lookup"><span data-stu-id="eb215-162">NSGs are not compatible with virtual networks that are associated with an affinity group.</span></span> <span data-ttu-id="eb215-163">If you don’t have a regional virtual network and you want to control traffic to your endpoints, please see [About Network Access Control Lists (ACLs)](../virtual-network/virtual-networks-acl.md).</span><span class="sxs-lookup"><span data-stu-id="eb215-163">If you don’t have a regional virtual network and you want to control traffic to your endpoints, please see [About Network Access Control Lists (ACLs)](../virtual-network/virtual-networks-acl.md).</span></span>

<span data-ttu-id="eb215-164">You can associate an NSG with a VM, or to a subnet within a virtual network.</span><span class="sxs-lookup"><span data-stu-id="eb215-164">You can associate an NSG with a VM, or to a subnet within a virtual network.</span></span> <span data-ttu-id="eb215-165">When associated with a VM, the NSG applies to all the traffic that is sent and received by the VM instance.</span><span class="sxs-lookup"><span data-stu-id="eb215-165">When associated with a VM, the NSG applies to all the traffic that is sent and received by the VM instance.</span></span> <span data-ttu-id="eb215-166">When applied to a subnet within your virtual network, it applies to all the traffic that is sent and received by all the VM instances in the subnet.</span><span class="sxs-lookup"><span data-stu-id="eb215-166">When applied to a subnet within your virtual network, it applies to all the traffic that is sent and received by all the VM instances in the subnet.</span></span> <span data-ttu-id="eb215-167">A VM or subnet can be associated with only 1 NSG, but each NSG can contain up to 200 rules.</span><span class="sxs-lookup"><span data-stu-id="eb215-167">A VM or subnet can be associated with only 1 NSG, but each NSG can contain up to 200 rules.</span></span> <span data-ttu-id="eb215-168">You can have 100 NSGs per subscription.</span><span class="sxs-lookup"><span data-stu-id="eb215-168">You can have 100 NSGs per subscription.</span></span>

> [!NOTE]
> <span data-ttu-id="eb215-169">Endpoint-based ACLs and network security groups are not supported on the same VM instance.</span><span class="sxs-lookup"><span data-stu-id="eb215-169">Endpoint-based ACLs and network security groups are not supported on the same VM instance.</span></span> <span data-ttu-id="eb215-170">If you want to use an NSG and have an endpoint ACL already in place, first remove the endpoint ACL.</span><span class="sxs-lookup"><span data-stu-id="eb215-170">If you want to use an NSG and have an endpoint ACL already in place, first remove the endpoint ACL.</span></span> <span data-ttu-id="eb215-171">For information about how to do this, see [Managing Access Control Lists (ACLs) for Endpoints by using PowerShell](../virtual-network/virtual-networks-acl-powershell.md).</span><span class="sxs-lookup"><span data-stu-id="eb215-171">For information about how to do this, see [Managing Access Control Lists (ACLs) for Endpoints by using PowerShell](../virtual-network/virtual-networks-acl-powershell.md).</span></span>
> 
> 

### <a name="how-network-security-groups-work"></a><span data-ttu-id="eb215-172">How network security groups work</span><span class="sxs-lookup"><span data-stu-id="eb215-172">How network security groups work</span></span>
<span data-ttu-id="eb215-173">Network security groups are different than endpoint-based ACLs.</span><span class="sxs-lookup"><span data-stu-id="eb215-173">Network security groups are different than endpoint-based ACLs.</span></span> <span data-ttu-id="eb215-174">Endpoint ACLs work only on the public port that is exposed through the Input endpoint.</span><span class="sxs-lookup"><span data-stu-id="eb215-174">Endpoint ACLs work only on the public port that is exposed through the Input endpoint.</span></span> <span data-ttu-id="eb215-175">An NSG works on one or more VM instances and controls all the traffic that is inbound and outbound on the VM.</span><span class="sxs-lookup"><span data-stu-id="eb215-175">An NSG works on one or more VM instances and controls all the traffic that is inbound and outbound on the VM.</span></span>

<span data-ttu-id="eb215-176">A network security group has a *Name*, is associated with a *Region* (one of the supported Azure locations), and has a descriptive label.</span><span class="sxs-lookup"><span data-stu-id="eb215-176">A network security group has a *Name*, is associated with a *Region* (one of the supported Azure locations), and has a descriptive label.</span></span> <span data-ttu-id="eb215-177">It contains two types of rules, Inbound and Outbound.</span><span class="sxs-lookup"><span data-stu-id="eb215-177">It contains two types of rules, Inbound and Outbound.</span></span> <span data-ttu-id="eb215-178">The Inbound rules are applied on the incoming packets to a VM and the Outbound rules are applied to the outgoing packets from the VM.</span><span class="sxs-lookup"><span data-stu-id="eb215-178">The Inbound rules are applied on the incoming packets to a VM and the Outbound rules are applied to the outgoing packets from the VM.</span></span>
<span data-ttu-id="eb215-179">The rules are applied at the server machine where the VM is located.</span><span class="sxs-lookup"><span data-stu-id="eb215-179">The rules are applied at the server machine where the VM is located.</span></span> <span data-ttu-id="eb215-180">An incoming or outgoing packet must match an Allow rule to be permitted; otherwise, it’s dropped.</span><span class="sxs-lookup"><span data-stu-id="eb215-180">An incoming or outgoing packet must match an Allow rule to be permitted; otherwise, it’s dropped.</span></span>

<span data-ttu-id="eb215-181">Rules are processed in the order of priority.</span><span class="sxs-lookup"><span data-stu-id="eb215-181">Rules are processed in the order of priority.</span></span> <span data-ttu-id="eb215-182">For example, a rule with a lower priority number such as 100 is processed before rules with a higher priority numbers such as 200.</span><span class="sxs-lookup"><span data-stu-id="eb215-182">For example, a rule with a lower priority number such as 100 is processed before rules with a higher priority numbers such as 200.</span></span> <span data-ttu-id="eb215-183">Once a match is found, no more rules are processed.</span><span class="sxs-lookup"><span data-stu-id="eb215-183">Once a match is found, no more rules are processed.</span></span>

<span data-ttu-id="eb215-184">A rule specifies the following:</span><span class="sxs-lookup"><span data-stu-id="eb215-184">A rule specifies the following:</span></span>

* <span data-ttu-id="eb215-185">Name: A unique identifier for the rule</span><span class="sxs-lookup"><span data-stu-id="eb215-185">Name: A unique identifier for the rule</span></span>
* <span data-ttu-id="eb215-186">Type: Inbound/Outbound</span><span class="sxs-lookup"><span data-stu-id="eb215-186">Type: Inbound/Outbound</span></span>
* <span data-ttu-id="eb215-187">Priority: An integer between 100 and 4096 (rules processed from low to high)</span><span class="sxs-lookup"><span data-stu-id="eb215-187">Priority: An integer between 100 and 4096 (rules processed from low to high)</span></span>
* <span data-ttu-id="eb215-188">Source IP Address: CIDR of source IP range</span><span class="sxs-lookup"><span data-stu-id="eb215-188">Source IP Address: CIDR of source IP range</span></span>
* <span data-ttu-id="eb215-189">Source Port Range: An integer or range between 0 and 65536</span><span class="sxs-lookup"><span data-stu-id="eb215-189">Source Port Range: An integer or range between 0 and 65536</span></span>
* <span data-ttu-id="eb215-190">Destination IP Range: CIDR of the destination IP Range</span><span class="sxs-lookup"><span data-stu-id="eb215-190">Destination IP Range: CIDR of the destination IP Range</span></span>
* <span data-ttu-id="eb215-191">Destination Port Range: An integer or range between 0 and 65536</span><span class="sxs-lookup"><span data-stu-id="eb215-191">Destination Port Range: An integer or range between 0 and 65536</span></span>
* <span data-ttu-id="eb215-192">Protocol: TCP, UDP or ‘\*’</span><span class="sxs-lookup"><span data-stu-id="eb215-192">Protocol: TCP, UDP or ‘\*’</span></span>
* <span data-ttu-id="eb215-193">Access: Allow/Deny</span><span class="sxs-lookup"><span data-stu-id="eb215-193">Access: Allow/Deny</span></span>

### <a name="default-rules"></a><span data-ttu-id="eb215-194">Default rules</span><span class="sxs-lookup"><span data-stu-id="eb215-194">Default rules</span></span>
<span data-ttu-id="eb215-195">An NSG contains default rules.</span><span class="sxs-lookup"><span data-stu-id="eb215-195">An NSG contains default rules.</span></span> <span data-ttu-id="eb215-196">The default rules can't be deleted, but because they are assigned the lowest priority, they can be overridden by the rules that you create.</span><span class="sxs-lookup"><span data-stu-id="eb215-196">The default rules can't be deleted, but because they are assigned the lowest priority, they can be overridden by the rules that you create.</span></span> <span data-ttu-id="eb215-197">The default rules describe the default settings recommended by the platform.</span><span class="sxs-lookup"><span data-stu-id="eb215-197">The default rules describe the default settings recommended by the platform.</span></span> <span data-ttu-id="eb215-198">As illustrated by the default rules below, traffic originating and ending in a virtual network is allowed both in Inbound and Outbound directions.</span><span class="sxs-lookup"><span data-stu-id="eb215-198">As illustrated by the default rules below, traffic originating and ending in a virtual network is allowed both in Inbound and Outbound directions.</span></span>

<span data-ttu-id="eb215-199">While connectivity to the Internet is allowed for outbound direction, it is by default blocked for inbound direction.</span><span class="sxs-lookup"><span data-stu-id="eb215-199">While connectivity to the Internet is allowed for outbound direction, it is by default blocked for inbound direction.</span></span> <span data-ttu-id="eb215-200">A default rule allows the Azure load balancer to probe the health of a VM.</span><span class="sxs-lookup"><span data-stu-id="eb215-200">A default rule allows the Azure load balancer to probe the health of a VM.</span></span> <span data-ttu-id="eb215-201">You can override this rule if the VM or set of VMs under the NSG does not participate in the load balanced set.</span><span class="sxs-lookup"><span data-stu-id="eb215-201">You can override this rule if the VM or set of VMs under the NSG does not participate in the load balanced set.</span></span>

<span data-ttu-id="eb215-202">The default rules are shown in the tables below.</span><span class="sxs-lookup"><span data-stu-id="eb215-202">The default rules are shown in the tables below.</span></span>

<span data-ttu-id="eb215-203">**Inbound default rules**</span><span class="sxs-lookup"><span data-stu-id="eb215-203">**Inbound default rules**</span></span>

| <span data-ttu-id="eb215-204">Name</span><span class="sxs-lookup"><span data-stu-id="eb215-204">Name</span></span> | <span data-ttu-id="eb215-205">Priority</span><span class="sxs-lookup"><span data-stu-id="eb215-205">Priority</span></span> | <span data-ttu-id="eb215-206">Source IP</span><span class="sxs-lookup"><span data-stu-id="eb215-206">Source IP</span></span> | <span data-ttu-id="eb215-207">Source Port</span><span class="sxs-lookup"><span data-stu-id="eb215-207">Source Port</span></span> | <span data-ttu-id="eb215-208">Destination IP</span><span class="sxs-lookup"><span data-stu-id="eb215-208">Destination IP</span></span> | <span data-ttu-id="eb215-209">Destination Port</span><span class="sxs-lookup"><span data-stu-id="eb215-209">Destination Port</span></span> | <span data-ttu-id="eb215-210">Protocol</span><span class="sxs-lookup"><span data-stu-id="eb215-210">Protocol</span></span> | <span data-ttu-id="eb215-211">Access</span><span class="sxs-lookup"><span data-stu-id="eb215-211">Access</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="eb215-212">ALLOW VNET INBOUND</span><span class="sxs-lookup"><span data-stu-id="eb215-212">ALLOW VNET INBOUND</span></span> |<span data-ttu-id="eb215-213">65000</span><span class="sxs-lookup"><span data-stu-id="eb215-213">65000</span></span> |<span data-ttu-id="eb215-214">VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="eb215-214">VIRTUAL_NETWORK</span></span> |\* |<span data-ttu-id="eb215-215">VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="eb215-215">VIRTUAL_NETWORK</span></span> |\* |\* |<span data-ttu-id="eb215-216">ALLOW</span><span class="sxs-lookup"><span data-stu-id="eb215-216">ALLOW</span></span> |
| <span data-ttu-id="eb215-217">ALLOW AZURE LOAD BALANCER INBOUND</span><span class="sxs-lookup"><span data-stu-id="eb215-217">ALLOW AZURE LOAD BALANCER INBOUND</span></span> |<span data-ttu-id="eb215-218">65001</span><span class="sxs-lookup"><span data-stu-id="eb215-218">65001</span></span> |<span data-ttu-id="eb215-219">AZURE_LOADBALANCER</span><span class="sxs-lookup"><span data-stu-id="eb215-219">AZURE_LOADBALANCER</span></span> |\* |\* |\* |\* |<span data-ttu-id="eb215-220">ALLOW</span><span class="sxs-lookup"><span data-stu-id="eb215-220">ALLOW</span></span> |
| <span data-ttu-id="eb215-221">DENY ALL INBOUND</span><span class="sxs-lookup"><span data-stu-id="eb215-221">DENY ALL INBOUND</span></span> |<span data-ttu-id="eb215-222">65500</span><span class="sxs-lookup"><span data-stu-id="eb215-222">65500</span></span> |\* |\* |\* |\* |\* |<span data-ttu-id="eb215-223">DENY</span><span class="sxs-lookup"><span data-stu-id="eb215-223">DENY</span></span> |

<span data-ttu-id="eb215-224">**Outbound default rules**</span><span class="sxs-lookup"><span data-stu-id="eb215-224">**Outbound default rules**</span></span>

| <span data-ttu-id="eb215-225">Name</span><span class="sxs-lookup"><span data-stu-id="eb215-225">Name</span></span> | <span data-ttu-id="eb215-226">Priority</span><span class="sxs-lookup"><span data-stu-id="eb215-226">Priority</span></span> | <span data-ttu-id="eb215-227">Source IP</span><span class="sxs-lookup"><span data-stu-id="eb215-227">Source IP</span></span> | <span data-ttu-id="eb215-228">Source Port</span><span class="sxs-lookup"><span data-stu-id="eb215-228">Source Port</span></span> | <span data-ttu-id="eb215-229">Destination IP</span><span class="sxs-lookup"><span data-stu-id="eb215-229">Destination IP</span></span> | <span data-ttu-id="eb215-230">Destination Port</span><span class="sxs-lookup"><span data-stu-id="eb215-230">Destination Port</span></span> | <span data-ttu-id="eb215-231">Protocol</span><span class="sxs-lookup"><span data-stu-id="eb215-231">Protocol</span></span> | <span data-ttu-id="eb215-232">Access</span><span class="sxs-lookup"><span data-stu-id="eb215-232">Access</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="eb215-233">ALLOW VNET OUTBOUND</span><span class="sxs-lookup"><span data-stu-id="eb215-233">ALLOW VNET OUTBOUND</span></span> |<span data-ttu-id="eb215-234">65000</span><span class="sxs-lookup"><span data-stu-id="eb215-234">65000</span></span> |<span data-ttu-id="eb215-235">VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="eb215-235">VIRTUAL_NETWORK</span></span> |\* |<span data-ttu-id="eb215-236">VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="eb215-236">VIRTUAL_NETWORK</span></span> |\* |\* |<span data-ttu-id="eb215-237">ALLOW</span><span class="sxs-lookup"><span data-stu-id="eb215-237">ALLOW</span></span> |
| <span data-ttu-id="eb215-238">ALLOW INTERNET OUTBOUND</span><span class="sxs-lookup"><span data-stu-id="eb215-238">ALLOW INTERNET OUTBOUND</span></span> |<span data-ttu-id="eb215-239">65001</span><span class="sxs-lookup"><span data-stu-id="eb215-239">65001</span></span> |\* |\* |<span data-ttu-id="eb215-240">INTERNET</span><span class="sxs-lookup"><span data-stu-id="eb215-240">INTERNET</span></span> |\* |\* |<span data-ttu-id="eb215-241">ALLOW</span><span class="sxs-lookup"><span data-stu-id="eb215-241">ALLOW</span></span> |
| <span data-ttu-id="eb215-242">DENY ALL OUTBOUND</span><span class="sxs-lookup"><span data-stu-id="eb215-242">DENY ALL OUTBOUND</span></span> |<span data-ttu-id="eb215-243">65500</span><span class="sxs-lookup"><span data-stu-id="eb215-243">65500</span></span> |\* |\* |\* |\* |\* |<span data-ttu-id="eb215-244">DENY</span><span class="sxs-lookup"><span data-stu-id="eb215-244">DENY</span></span> |

### <a name="special-infrastructure-rules"></a><span data-ttu-id="eb215-245">Special infrastructure rules</span><span class="sxs-lookup"><span data-stu-id="eb215-245">Special infrastructure rules</span></span>
<span data-ttu-id="eb215-246">NSG rules are explicit.</span><span class="sxs-lookup"><span data-stu-id="eb215-246">NSG rules are explicit.</span></span> <span data-ttu-id="eb215-247">No traffic is allowed or denied beyond what is specified in the NSG rules.</span><span class="sxs-lookup"><span data-stu-id="eb215-247">No traffic is allowed or denied beyond what is specified in the NSG rules.</span></span> <span data-ttu-id="eb215-248">However, two types of traffic are always allowed regardless of the Network Security group specification.</span><span class="sxs-lookup"><span data-stu-id="eb215-248">However, two types of traffic are always allowed regardless of the Network Security group specification.</span></span> <span data-ttu-id="eb215-249">These provisions are made to support the infrastructure:</span><span class="sxs-lookup"><span data-stu-id="eb215-249">These provisions are made to support the infrastructure:</span></span>

* <span data-ttu-id="eb215-250">**Virtual IP of the Host Node**: Basic infrastructure services such as DHCP, DNS, and Health monitoring are provided through the virtualized host IP address 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="eb215-250">**Virtual IP of the Host Node**: Basic infrastructure services such as DHCP, DNS, and Health monitoring are provided through the virtualized host IP address 168.63.129.16.</span></span> <span data-ttu-id="eb215-251">This public IP address belongs to Microsoft and will be the only virtualized IP address used in all regions for this purpose.</span><span class="sxs-lookup"><span data-stu-id="eb215-251">This public IP address belongs to Microsoft and will be the only virtualized IP address used in all regions for this purpose.</span></span> <span data-ttu-id="eb215-252">This IP address maps to the physical IP address of the server machine (host node) hosting the VM.</span><span class="sxs-lookup"><span data-stu-id="eb215-252">This IP address maps to the physical IP address of the server machine (host node) hosting the VM.</span></span> <span data-ttu-id="eb215-253">The host node acts as the DHCP relay, the DNS recursive resolver, and the probe source for the load balancer health probe and the machine health probe.</span><span class="sxs-lookup"><span data-stu-id="eb215-253">The host node acts as the DHCP relay, the DNS recursive resolver, and the probe source for the load balancer health probe and the machine health probe.</span></span> <span data-ttu-id="eb215-254">Communication to this IP address should not be considered as an attack.</span><span class="sxs-lookup"><span data-stu-id="eb215-254">Communication to this IP address should not be considered as an attack.</span></span>
* <span data-ttu-id="eb215-255">**Licensing (Key Management Service)**: Windows images running in the VMs should be licensed.</span><span class="sxs-lookup"><span data-stu-id="eb215-255">**Licensing (Key Management Service)**: Windows images running in the VMs should be licensed.</span></span> <span data-ttu-id="eb215-256">To do this, a licensing request is sent to the Key Management Service host servers that handle such queries.</span><span class="sxs-lookup"><span data-stu-id="eb215-256">To do this, a licensing request is sent to the Key Management Service host servers that handle such queries.</span></span> <span data-ttu-id="eb215-257">This will always be on outbound port 1688.</span><span class="sxs-lookup"><span data-stu-id="eb215-257">This will always be on outbound port 1688.</span></span>

### <a name="default-tags"></a><span data-ttu-id="eb215-258">Default tags</span><span class="sxs-lookup"><span data-stu-id="eb215-258">Default tags</span></span>
<span data-ttu-id="eb215-259">Default tags are system-provided identifiers to address a category of IP addresses.</span><span class="sxs-lookup"><span data-stu-id="eb215-259">Default tags are system-provided identifiers to address a category of IP addresses.</span></span> <span data-ttu-id="eb215-260">Default tags can be specified in user-defined rules.</span><span class="sxs-lookup"><span data-stu-id="eb215-260">Default tags can be specified in user-defined rules.</span></span>

<span data-ttu-id="eb215-261">**Default tags for NSGs**</span><span class="sxs-lookup"><span data-stu-id="eb215-261">**Default tags for NSGs**</span></span>

| <span data-ttu-id="eb215-262">Tag</span><span class="sxs-lookup"><span data-stu-id="eb215-262">Tag</span></span> | <span data-ttu-id="eb215-263">Description</span><span class="sxs-lookup"><span data-stu-id="eb215-263">Description</span></span> |
| --- | --- |
| <span data-ttu-id="eb215-264">VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="eb215-264">VIRTUAL_NETWORK</span></span> |<span data-ttu-id="eb215-265">Denotes all of your network address space.</span><span class="sxs-lookup"><span data-stu-id="eb215-265">Denotes all of your network address space.</span></span> <span data-ttu-id="eb215-266">It includes the virtual network address space (IP CIDR in Azure) as well as all connected on-premises address space (Local Networks).</span><span class="sxs-lookup"><span data-stu-id="eb215-266">It includes the virtual network address space (IP CIDR in Azure) as well as all connected on-premises address space (Local Networks).</span></span> <span data-ttu-id="eb215-267">This also includes virtual network-to-virtual network address spaces.</span><span class="sxs-lookup"><span data-stu-id="eb215-267">This also includes virtual network-to-virtual network address spaces.</span></span> |
| <span data-ttu-id="eb215-268">AZURE_LOADBALANCER</span><span class="sxs-lookup"><span data-stu-id="eb215-268">AZURE_LOADBALANCER</span></span> |<span data-ttu-id="eb215-269">Denotes the Azure Infrastructure load balancer and will translate to an Azure datacenter IP where Azure’s health probes will originate.</span><span class="sxs-lookup"><span data-stu-id="eb215-269">Denotes the Azure Infrastructure load balancer and will translate to an Azure datacenter IP where Azure’s health probes will originate.</span></span> <span data-ttu-id="eb215-270">This is needed only if the VM or set of VMs associated with the NSG is participating in a load balanced set.</span><span class="sxs-lookup"><span data-stu-id="eb215-270">This is needed only if the VM or set of VMs associated with the NSG is participating in a load balanced set.</span></span> |
| <span data-ttu-id="eb215-271">INTERNET</span><span class="sxs-lookup"><span data-stu-id="eb215-271">INTERNET</span></span> |<span data-ttu-id="eb215-272">Denotes the IP address space that is outside the virtual network and can be reached by public Internet.</span><span class="sxs-lookup"><span data-stu-id="eb215-272">Denotes the IP address space that is outside the virtual network and can be reached by public Internet.</span></span> <span data-ttu-id="eb215-273">This range includes Azure-owned public IP space as well.</span><span class="sxs-lookup"><span data-stu-id="eb215-273">This range includes Azure-owned public IP space as well.</span></span> |

### <a name="ports-and-port-ranges"></a><span data-ttu-id="eb215-274">Ports and port ranges</span><span class="sxs-lookup"><span data-stu-id="eb215-274">Ports and port ranges</span></span>
<span data-ttu-id="eb215-275">NSG rules can be specified on a single source or destination port, or on a port range.</span><span class="sxs-lookup"><span data-stu-id="eb215-275">NSG rules can be specified on a single source or destination port, or on a port range.</span></span> <span data-ttu-id="eb215-276">This approach is particularly useful when you want to open a wide range of ports for an application, such as FTP.</span><span class="sxs-lookup"><span data-stu-id="eb215-276">This approach is particularly useful when you want to open a wide range of ports for an application, such as FTP.</span></span> <span data-ttu-id="eb215-277">The range must be sequential and can't be mixed with individual port specifications.</span><span class="sxs-lookup"><span data-stu-id="eb215-277">The range must be sequential and can't be mixed with individual port specifications.</span></span>
<span data-ttu-id="eb215-278">To specify a range of ports, use the hyphen (–) character.</span><span class="sxs-lookup"><span data-stu-id="eb215-278">To specify a range of ports, use the hyphen (–) character.</span></span> <span data-ttu-id="eb215-279">For example, **100-500**.</span><span class="sxs-lookup"><span data-stu-id="eb215-279">For example, **100-500**.</span></span>

### <a name="icmp-traffic"></a><span data-ttu-id="eb215-280">ICMP traffic</span><span class="sxs-lookup"><span data-stu-id="eb215-280">ICMP traffic</span></span>
<span data-ttu-id="eb215-281">With the current NSG rules, you can specify TCP or UDP as protocols but not ICMP.</span><span class="sxs-lookup"><span data-stu-id="eb215-281">With the current NSG rules, you can specify TCP or UDP as protocols but not ICMP.</span></span> <span data-ttu-id="eb215-282">However, ICMP traffic is allowed within a virtual network by default through the Inbound rules that support traffic from and to any port and protocol (\*) within the virtual network.</span><span class="sxs-lookup"><span data-stu-id="eb215-282">However, ICMP traffic is allowed within a virtual network by default through the Inbound rules that support traffic from and to any port and protocol (\*) within the virtual network.</span></span>

### <a name="associating-an-nsg-with-a-vm"></a><span data-ttu-id="eb215-283">Associating an NSG with a VM</span><span class="sxs-lookup"><span data-stu-id="eb215-283">Associating an NSG with a VM</span></span>
<span data-ttu-id="eb215-284">When an NSG is directly associated with a VM, the network access rules in the NSG are directly applied to all traffic that is destined to the VM.</span><span class="sxs-lookup"><span data-stu-id="eb215-284">When an NSG is directly associated with a VM, the network access rules in the NSG are directly applied to all traffic that is destined to the VM.</span></span> <span data-ttu-id="eb215-285">Whenever the NSG is updated for rule changes, the traffic handling reflects the updates within minutes.</span><span class="sxs-lookup"><span data-stu-id="eb215-285">Whenever the NSG is updated for rule changes, the traffic handling reflects the updates within minutes.</span></span> <span data-ttu-id="eb215-286">When the NSG is disassociated from the VM, the state reverts to its pre-NSG condition—that is, to the system defaults before the NSG was introduced.</span><span class="sxs-lookup"><span data-stu-id="eb215-286">When the NSG is disassociated from the VM, the state reverts to its pre-NSG condition—that is, to the system defaults before the NSG was introduced.</span></span>

### <a name="associating-an-nsg-with-a-subnet"></a><span data-ttu-id="eb215-287">Associating an NSG with a subnet</span><span class="sxs-lookup"><span data-stu-id="eb215-287">Associating an NSG with a subnet</span></span>
<span data-ttu-id="eb215-288">When an NSG is associated with a subnet, the network access rules in the NSG are applied to all the VMs in the subnet.</span><span class="sxs-lookup"><span data-stu-id="eb215-288">When an NSG is associated with a subnet, the network access rules in the NSG are applied to all the VMs in the subnet.</span></span> <span data-ttu-id="eb215-289">Whenever the access rules in the NSG are updated, the changes are applied to all VMs in the subnet within minutes.</span><span class="sxs-lookup"><span data-stu-id="eb215-289">Whenever the access rules in the NSG are updated, the changes are applied to all VMs in the subnet within minutes.</span></span>

### <a name="associating-an-nsg-with-a-subnet-and-a-vm"></a><span data-ttu-id="eb215-290">Associating an NSG with a subnet and a VM</span><span class="sxs-lookup"><span data-stu-id="eb215-290">Associating an NSG with a subnet and a VM</span></span>
<span data-ttu-id="eb215-291">You can associate one NSG with a VM and another NSG with the subnet where the VM resides.</span><span class="sxs-lookup"><span data-stu-id="eb215-291">You can associate one NSG with a VM and another NSG with the subnet where the VM resides.</span></span> <span data-ttu-id="eb215-292">This scenario is supported to provide the VM with two layers of protection.</span><span class="sxs-lookup"><span data-stu-id="eb215-292">This scenario is supported to provide the VM with two layers of protection.</span></span>
<span data-ttu-id="eb215-293">On the inbound traffic, the packet follows the access rules specified in the subnet, followed by rules in the VM.</span><span class="sxs-lookup"><span data-stu-id="eb215-293">On the inbound traffic, the packet follows the access rules specified in the subnet, followed by rules in the VM.</span></span> <span data-ttu-id="eb215-294">When outbound, the packet follows the rules specified in the VM first, then follows the rules specified in the subnet as shown below.</span><span class="sxs-lookup"><span data-stu-id="eb215-294">When outbound, the packet follows the rules specified in the VM first, then follows the rules specified in the subnet as shown below.</span></span>

![Associating an NSG to a subnet and a VM](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-security/nsg-subnet-vm.png)

<span data-ttu-id="eb215-296">When an NSG is associated with a VM or subnet, the network access control rules become very explicit.</span><span class="sxs-lookup"><span data-stu-id="eb215-296">When an NSG is associated with a VM or subnet, the network access control rules become very explicit.</span></span> <span data-ttu-id="eb215-297">The platform will not insert any implicit rule to allow traffic to a particular port.</span><span class="sxs-lookup"><span data-stu-id="eb215-297">The platform will not insert any implicit rule to allow traffic to a particular port.</span></span> <span data-ttu-id="eb215-298">In this case, if you create an endpoint in the VM, you must also create a rule to allow traffic from the Internet.</span><span class="sxs-lookup"><span data-stu-id="eb215-298">In this case, if you create an endpoint in the VM, you must also create a rule to allow traffic from the Internet.</span></span> <span data-ttu-id="eb215-299">If you don't do this, the *VIP:{Port}* can't be accessed from outside.</span><span class="sxs-lookup"><span data-stu-id="eb215-299">If you don't do this, the *VIP:{Port}* can't be accessed from outside.</span></span>

<span data-ttu-id="eb215-300">For example, you can create a new VM and a new NSG.</span><span class="sxs-lookup"><span data-stu-id="eb215-300">For example, you can create a new VM and a new NSG.</span></span> <span data-ttu-id="eb215-301">You associate the NSG with the VM.</span><span class="sxs-lookup"><span data-stu-id="eb215-301">You associate the NSG with the VM.</span></span> <span data-ttu-id="eb215-302">The VM can communicate with other VMs in the virtual network through the ALLOW VNET INBOUND rule.</span><span class="sxs-lookup"><span data-stu-id="eb215-302">The VM can communicate with other VMs in the virtual network through the ALLOW VNET INBOUND rule.</span></span> <span data-ttu-id="eb215-303">The VM can also make outbound connections to the Internet using the ALLOW INTERNET OUTBOUND rule.</span><span class="sxs-lookup"><span data-stu-id="eb215-303">The VM can also make outbound connections to the Internet using the ALLOW INTERNET OUTBOUND rule.</span></span> <span data-ttu-id="eb215-304">Later, you create an endpoint on port 80 to receive traffic to your website running in the VM.</span><span class="sxs-lookup"><span data-stu-id="eb215-304">Later, you create an endpoint on port 80 to receive traffic to your website running in the VM.</span></span> <span data-ttu-id="eb215-305">Packets destined to port 80 on the VIP (public Virtual IP address) from the Internet will not reach the VM until you add a rule similar to the following table to the NSG.</span><span class="sxs-lookup"><span data-stu-id="eb215-305">Packets destined to port 80 on the VIP (public Virtual IP address) from the Internet will not reach the VM until you add a rule similar to the following table to the NSG.</span></span>

<span data-ttu-id="eb215-306">**Explicit rule allowing traffic to a particular port**</span><span class="sxs-lookup"><span data-stu-id="eb215-306">**Explicit rule allowing traffic to a particular port**</span></span>

| <span data-ttu-id="eb215-307">Name</span><span class="sxs-lookup"><span data-stu-id="eb215-307">Name</span></span> | <span data-ttu-id="eb215-308">Priority</span><span class="sxs-lookup"><span data-stu-id="eb215-308">Priority</span></span> | <span data-ttu-id="eb215-309">Source IP</span><span class="sxs-lookup"><span data-stu-id="eb215-309">Source IP</span></span> | <span data-ttu-id="eb215-310">Source Port</span><span class="sxs-lookup"><span data-stu-id="eb215-310">Source Port</span></span> | <span data-ttu-id="eb215-311">Destination IP</span><span class="sxs-lookup"><span data-stu-id="eb215-311">Destination IP</span></span> | <span data-ttu-id="eb215-312">Destination Port</span><span class="sxs-lookup"><span data-stu-id="eb215-312">Destination Port</span></span> | <span data-ttu-id="eb215-313">Protocol</span><span class="sxs-lookup"><span data-stu-id="eb215-313">Protocol</span></span> | <span data-ttu-id="eb215-314">Access</span><span class="sxs-lookup"><span data-stu-id="eb215-314">Access</span></span> |
| --- | --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="eb215-315">WEB</span><span class="sxs-lookup"><span data-stu-id="eb215-315">WEB</span></span> |<span data-ttu-id="eb215-316">100</span><span class="sxs-lookup"><span data-stu-id="eb215-316">100</span></span> |<span data-ttu-id="eb215-317">INTERNET</span><span class="sxs-lookup"><span data-stu-id="eb215-317">INTERNET</span></span> |* |* |<span data-ttu-id="eb215-318">80</span><span class="sxs-lookup"><span data-stu-id="eb215-318">80</span></span> |<span data-ttu-id="eb215-319">TCP</span><span class="sxs-lookup"><span data-stu-id="eb215-319">TCP</span></span> |<span data-ttu-id="eb215-320">ALLOW</span><span class="sxs-lookup"><span data-stu-id="eb215-320">ALLOW</span></span> |

## <a name="user-defined-routes"></a><span data-ttu-id="eb215-321">User-defined routes</span><span class="sxs-lookup"><span data-stu-id="eb215-321">User-defined routes</span></span>
<span data-ttu-id="eb215-322">Azure uses a route table to decide how to forward IP traffic based on the destination of each packet.</span><span class="sxs-lookup"><span data-stu-id="eb215-322">Azure uses a route table to decide how to forward IP traffic based on the destination of each packet.</span></span> <span data-ttu-id="eb215-323">Although Azure provides a default route table based on your virtual network settings, you may need to add custom routes to that table.</span><span class="sxs-lookup"><span data-stu-id="eb215-323">Although Azure provides a default route table based on your virtual network settings, you may need to add custom routes to that table.</span></span>

<span data-ttu-id="eb215-324">The most common need for a custom entry in the route table is the use of a virtual appliance in your Azure environment.</span><span class="sxs-lookup"><span data-stu-id="eb215-324">The most common need for a custom entry in the route table is the use of a virtual appliance in your Azure environment.</span></span> <span data-ttu-id="eb215-325">Take into account the scenario shown in the Figure below.</span><span class="sxs-lookup"><span data-stu-id="eb215-325">Take into account the scenario shown in the Figure below.</span></span> <span data-ttu-id="eb215-326">Suppose you want to ensure that all traffic directed to the mid-tier and backed subnets initiated from the front end subnet go through a virtual firewall appliance.</span><span class="sxs-lookup"><span data-stu-id="eb215-326">Suppose you want to ensure that all traffic directed to the mid-tier and backed subnets initiated from the front end subnet go through a virtual firewall appliance.</span></span> <span data-ttu-id="eb215-327">Simply adding the appliance to your virtual network and connecting it to the different subnets will not provide this functionality.</span><span class="sxs-lookup"><span data-stu-id="eb215-327">Simply adding the appliance to your virtual network and connecting it to the different subnets will not provide this functionality.</span></span>
<span data-ttu-id="eb215-328">You must also change the routing table applied to your subnet to ensure packets are forwarded to the virtual firewall appliance.</span><span class="sxs-lookup"><span data-stu-id="eb215-328">You must also change the routing table applied to your subnet to ensure packets are forwarded to the virtual firewall appliance.</span></span>

<span data-ttu-id="eb215-329">The same would be true if you implemented a virtual NAT appliance to control traffic between your Azure virtual network and the Internet.</span><span class="sxs-lookup"><span data-stu-id="eb215-329">The same would be true if you implemented a virtual NAT appliance to control traffic between your Azure virtual network and the Internet.</span></span> <span data-ttu-id="eb215-330">To ensure the virtual appliance is used you have to create a route specifying that all traffic destined to the Internet must be forwarded to the virtual appliance.</span><span class="sxs-lookup"><span data-stu-id="eb215-330">To ensure the virtual appliance is used you have to create a route specifying that all traffic destined to the Internet must be forwarded to the virtual appliance.</span></span>

### <a name="routing"></a><span data-ttu-id="eb215-331">Routing</span><span class="sxs-lookup"><span data-stu-id="eb215-331">Routing</span></span>
<span data-ttu-id="eb215-332">Packets are routed over a TCP/IP network based on a route table defined at each node on the physical network.</span><span class="sxs-lookup"><span data-stu-id="eb215-332">Packets are routed over a TCP/IP network based on a route table defined at each node on the physical network.</span></span> <span data-ttu-id="eb215-333">A route table is a collection of individual routes used to decide where to forward packets based on the destination IP address.</span><span class="sxs-lookup"><span data-stu-id="eb215-333">A route table is a collection of individual routes used to decide where to forward packets based on the destination IP address.</span></span> <span data-ttu-id="eb215-334">A route consists of the following:</span><span class="sxs-lookup"><span data-stu-id="eb215-334">A route consists of the following:</span></span>

* <span data-ttu-id="eb215-335">Address Prefix.</span><span class="sxs-lookup"><span data-stu-id="eb215-335">Address Prefix.</span></span> <span data-ttu-id="eb215-336">The destination CIDR to which the route applies, such as 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="eb215-336">The destination CIDR to which the route applies, such as 10.1.0.0/16.</span></span>
* <span data-ttu-id="eb215-337">Next hop type.</span><span class="sxs-lookup"><span data-stu-id="eb215-337">Next hop type.</span></span> <span data-ttu-id="eb215-338">The type of Azure hop the packet should be sent to.</span><span class="sxs-lookup"><span data-stu-id="eb215-338">The type of Azure hop the packet should be sent to.</span></span> <span data-ttu-id="eb215-339">Possible values are:</span><span class="sxs-lookup"><span data-stu-id="eb215-339">Possible values are:</span></span>
  * <span data-ttu-id="eb215-340">Local.</span><span class="sxs-lookup"><span data-stu-id="eb215-340">Local.</span></span> <span data-ttu-id="eb215-341">Represents the local virtual network.</span><span class="sxs-lookup"><span data-stu-id="eb215-341">Represents the local virtual network.</span></span> <span data-ttu-id="eb215-342">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in the same virtual network, the route for each subnet in the route table will have a next hop value of Local.</span><span class="sxs-lookup"><span data-stu-id="eb215-342">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in the same virtual network, the route for each subnet in the route table will have a next hop value of Local.</span></span>
  * <span data-ttu-id="eb215-343">VPN Gateway.</span><span class="sxs-lookup"><span data-stu-id="eb215-343">VPN Gateway.</span></span> <span data-ttu-id="eb215-344">Represents an Azure S2S VPN Gateway.</span><span class="sxs-lookup"><span data-stu-id="eb215-344">Represents an Azure S2S VPN Gateway.</span></span>
  * <span data-ttu-id="eb215-345">Internet.</span><span class="sxs-lookup"><span data-stu-id="eb215-345">Internet.</span></span> <span data-ttu-id="eb215-346">Represents the default Internet gateway provided by the Azure Infrastructure</span><span class="sxs-lookup"><span data-stu-id="eb215-346">Represents the default Internet gateway provided by the Azure Infrastructure</span></span>
  * <span data-ttu-id="eb215-347">Virtual Appliance.</span><span class="sxs-lookup"><span data-stu-id="eb215-347">Virtual Appliance.</span></span> <span data-ttu-id="eb215-348">Represents a virtual appliance you added to your Azure virtual network.</span><span class="sxs-lookup"><span data-stu-id="eb215-348">Represents a virtual appliance you added to your Azure virtual network.</span></span>
  * <span data-ttu-id="eb215-349">NULL.</span><span class="sxs-lookup"><span data-stu-id="eb215-349">NULL.</span></span> <span data-ttu-id="eb215-350">Represents a black hole.</span><span class="sxs-lookup"><span data-stu-id="eb215-350">Represents a black hole.</span></span> <span data-ttu-id="eb215-351">Packets forwarded to a black hole will not be forwarded at all.</span><span class="sxs-lookup"><span data-stu-id="eb215-351">Packets forwarded to a black hole will not be forwarded at all.</span></span>
* <span data-ttu-id="eb215-352">Nexthop Value.</span><span class="sxs-lookup"><span data-stu-id="eb215-352">Nexthop Value.</span></span> <span data-ttu-id="eb215-353">The next hop value contains the IP address packets should be forwarded to.</span><span class="sxs-lookup"><span data-stu-id="eb215-353">The next hop value contains the IP address packets should be forwarded to.</span></span> <span data-ttu-id="eb215-354">Next hop values are only allowed in routes where the next hop type is *Virtual Appliance*.</span><span class="sxs-lookup"><span data-stu-id="eb215-354">Next hop values are only allowed in routes where the next hop type is *Virtual Appliance*.</span></span> <span data-ttu-id="eb215-355">The next hop needs to be on the subnet (the local interface of the virtual appliance according to the network ID), not a remote subnet.</span><span class="sxs-lookup"><span data-stu-id="eb215-355">The next hop needs to be on the subnet (the local interface of the virtual appliance according to the network ID), not a remote subnet.</span></span>

![Routing](https://docstestmedia1.blob.core.windows.net/azure-media/articles/azure-resource-manager/media/best-practices-resource-manager-security/routing.png)

### <a name="default-routes"></a><span data-ttu-id="eb215-357">Default routes</span><span class="sxs-lookup"><span data-stu-id="eb215-357">Default routes</span></span>
<span data-ttu-id="eb215-358">Every subnet created in a virtual network is automatically associated with a route table that contains the following default route rules:</span><span class="sxs-lookup"><span data-stu-id="eb215-358">Every subnet created in a virtual network is automatically associated with a route table that contains the following default route rules:</span></span>

* <span data-ttu-id="eb215-359">Local VNet Rule: This rule is automatically created for every subnet in a virtual network.</span><span class="sxs-lookup"><span data-stu-id="eb215-359">Local VNet Rule: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="eb215-360">It specifies that there is a direct link between the VMs in the VNet and there is no intermediate next hop.</span><span class="sxs-lookup"><span data-stu-id="eb215-360">It specifies that there is a direct link between the VMs in the VNet and there is no intermediate next hop.</span></span> <span data-ttu-id="eb215-361">This enables the VMs on the same subnet, regardless of the network ID that the VMs exist in, to communicate with each other without requiring a default gateway address.</span><span class="sxs-lookup"><span data-stu-id="eb215-361">This enables the VMs on the same subnet, regardless of the network ID that the VMs exist in, to communicate with each other without requiring a default gateway address.</span></span>
* <span data-ttu-id="eb215-362">On-premises Rule: This rule applies to all traffic destined to the on-premises address range and uses VPN gateway as the next hop destination.</span><span class="sxs-lookup"><span data-stu-id="eb215-362">On-premises Rule: This rule applies to all traffic destined to the on-premises address range and uses VPN gateway as the next hop destination.</span></span>
* <span data-ttu-id="eb215-363">Internet Rule: This rule handles all traffic destined to the public Internet and uses the infrastructure internet gateway as the next hop for all traffic destined to the Internet.</span><span class="sxs-lookup"><span data-stu-id="eb215-363">Internet Rule: This rule handles all traffic destined to the public Internet and uses the infrastructure internet gateway as the next hop for all traffic destined to the Internet.</span></span>

### <a name="bgp-routes"></a><span data-ttu-id="eb215-364">BGP routes</span><span class="sxs-lookup"><span data-stu-id="eb215-364">BGP routes</span></span>
<span data-ttu-id="eb215-365">At the time of this writing, [ExpressRoute](../expressroute/expressroute-introduction.md) is not yet supported in the [Network Resource Provider](../virtual-network/resource-groups-networking.md) for Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="eb215-365">At the time of this writing, [ExpressRoute](../expressroute/expressroute-introduction.md) is not yet supported in the [Network Resource Provider](../virtual-network/resource-groups-networking.md) for Azure Resource Manager.</span></span>  <span data-ttu-id="eb215-366">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP to propagate routes from your on-premises network to Azure once ExpressRoute is supported in the NRP.</span><span class="sxs-lookup"><span data-stu-id="eb215-366">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP to propagate routes from your on-premises network to Azure once ExpressRoute is supported in the NRP.</span></span> <span data-ttu-id="eb215-367">These BGP routes are used in the same way as default routes and user defined routes in each Azure subnet.</span><span class="sxs-lookup"><span data-stu-id="eb215-367">These BGP routes are used in the same way as default routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="eb215-368">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="eb215-368">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!NOTE]
> <span data-ttu-id="eb215-369">When ExpressRoute on NRP is supported, you will be able to configure your Azure environment to use forced tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses the VPN gateway as the next hop.</span><span class="sxs-lookup"><span data-stu-id="eb215-369">When ExpressRoute on NRP is supported, you will be able to configure your Azure environment to use forced tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses the VPN gateway as the next hop.</span></span> <span data-ttu-id="eb215-370">However, this only works if you are using a VPN gateway, not ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="eb215-370">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="eb215-371">For ExpressRoute, forced tunneling is configured through BGP.</span><span class="sxs-lookup"><span data-stu-id="eb215-371">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

### <a name="user-defined-routes"></a><span data-ttu-id="eb215-372">User-defined routes</span><span class="sxs-lookup"><span data-stu-id="eb215-372">User-defined routes</span></span>
<span data-ttu-id="eb215-373">You cannot view the default routes specified above in your Azure environment, and for most environments, those are the only routes you will need.</span><span class="sxs-lookup"><span data-stu-id="eb215-373">You cannot view the default routes specified above in your Azure environment, and for most environments, those are the only routes you will need.</span></span>
<span data-ttu-id="eb215-374">However, you may need to create a route table and add one or more routes in specific cases, such as:</span><span class="sxs-lookup"><span data-stu-id="eb215-374">However, you may need to create a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="eb215-375">Forced tunneling to the Internet via your on-premises network.</span><span class="sxs-lookup"><span data-stu-id="eb215-375">Forced tunneling to the Internet via your on-premises network.</span></span>
* <span data-ttu-id="eb215-376">Use of virtual appliances in your Azure environment.</span><span class="sxs-lookup"><span data-stu-id="eb215-376">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="eb215-377">In the scenarios above, you will have to create a route table and add user defined routes to it.</span><span class="sxs-lookup"><span data-stu-id="eb215-377">In the scenarios above, you will have to create a route table and add user defined routes to it.</span></span> <span data-ttu-id="eb215-378">You can have multiple route tables, and the same route table can be associated to one or more subnets.</span><span class="sxs-lookup"><span data-stu-id="eb215-378">You can have multiple route tables, and the same route table can be associated to one or more subnets.</span></span> <span data-ttu-id="eb215-379">And each subnet can only be associated to a single route table.</span><span class="sxs-lookup"><span data-stu-id="eb215-379">And each subnet can only be associated to a single route table.</span></span> <span data-ttu-id="eb215-380">All VMs and cloud services in a subnet use the route table associated to that subnet.</span><span class="sxs-lookup"><span data-stu-id="eb215-380">All VMs and cloud services in a subnet use the route table associated to that subnet.</span></span>

<span data-ttu-id="eb215-381">Subnets rely on default routes until a route table is associated to the subnet.</span><span class="sxs-lookup"><span data-stu-id="eb215-381">Subnets rely on default routes until a route table is associated to the subnet.</span></span> <span data-ttu-id="eb215-382">Once an association exists, routing is done based on [Longest Prefix Match (LPM)](https://en.wikipedia.org/wiki/Longest_prefix_match) among both user defined routes and default routes.</span><span class="sxs-lookup"><span data-stu-id="eb215-382">Once an association exists, routing is done based on [Longest Prefix Match (LPM)](https://en.wikipedia.org/wiki/Longest_prefix_match) among both user defined routes and default routes.</span></span> <span data-ttu-id="eb215-383">If there is more than one route with the same LPM match then a route is selected based on its origin in the following order:</span><span class="sxs-lookup"><span data-stu-id="eb215-383">If there is more than one route with the same LPM match then a route is selected based on its origin in the following order:</span></span>

1. <span data-ttu-id="eb215-384">User defined route</span><span class="sxs-lookup"><span data-stu-id="eb215-384">User defined route</span></span>
2. <span data-ttu-id="eb215-385">BGP route (when ExpressRoute is used)</span><span class="sxs-lookup"><span data-stu-id="eb215-385">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="eb215-386">Default route</span><span class="sxs-lookup"><span data-stu-id="eb215-386">Default route</span></span>

> [!NOTE]
> <span data-ttu-id="eb215-387">User defined routes are only applied to Azure VMs and cloud services.</span><span class="sxs-lookup"><span data-stu-id="eb215-387">User defined routes are only applied to Azure VMs and cloud services.</span></span> <span data-ttu-id="eb215-388">For instance, if you want to add a firewall virtual appliance between your on-premises network and Azure, you will have to create a user defined route for your Azure route tables that forwards all traffic going to the on-premises address space to the virtual appliance.</span><span class="sxs-lookup"><span data-stu-id="eb215-388">For instance, if you want to add a firewall virtual appliance between your on-premises network and Azure, you will have to create a user defined route for your Azure route tables that forwards all traffic going to the on-premises address space to the virtual appliance.</span></span> <span data-ttu-id="eb215-389">However, incoming traffic from the on-premises address space will flow through your VPN gateway or ExpressRoute circuit straight to the Azure environment, bypassing the virtual appliance.</span><span class="sxs-lookup"><span data-stu-id="eb215-389">However, incoming traffic from the on-premises address space will flow through your VPN gateway or ExpressRoute circuit straight to the Azure environment, bypassing the virtual appliance.</span></span>
> 
> 

### <a name="ip-forwarding"></a><span data-ttu-id="eb215-390">IP forwarding</span><span class="sxs-lookup"><span data-stu-id="eb215-390">IP forwarding</span></span>
<span data-ttu-id="eb215-391">As described above, one of the main reasons to create a user defined route is to forward traffic to a virtual appliance.</span><span class="sxs-lookup"><span data-stu-id="eb215-391">As described above, one of the main reasons to create a user defined route is to forward traffic to a virtual appliance.</span></span> <span data-ttu-id="eb215-392">A virtual appliance is nothing more than a VM that runs an application used to handle network traffic in some way, such as a firewall or a NAT device.</span><span class="sxs-lookup"><span data-stu-id="eb215-392">A virtual appliance is nothing more than a VM that runs an application used to handle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="eb215-393">This virtual appliance VM must be able to receive incoming traffic that is not addressed to itself.</span><span class="sxs-lookup"><span data-stu-id="eb215-393">This virtual appliance VM must be able to receive incoming traffic that is not addressed to itself.</span></span> <span data-ttu-id="eb215-394">To allow a VM to receive traffic addressed to other destinations, you must enable IP Forwarding in the VM.</span><span class="sxs-lookup"><span data-stu-id="eb215-394">To allow a VM to receive traffic addressed to other destinations, you must enable IP Forwarding in the VM.</span></span>

## <a name="next-steps"></a><span data-ttu-id="eb215-395">Next steps</span><span class="sxs-lookup"><span data-stu-id="eb215-395">Next steps</span></span>
* <span data-ttu-id="eb215-396">To understand how to set up security principals with the correct access to work with resources in your organization, see [Authenticating a Service Principal with Azure Resource Manager](resource-group-authenticate-service-principal.md)</span><span class="sxs-lookup"><span data-stu-id="eb215-396">To understand how to set up security principals with the correct access to work with resources in your organization, see [Authenticating a Service Principal with Azure Resource Manager](resource-group-authenticate-service-principal.md)</span></span>
* <span data-ttu-id="eb215-397">If you need to lock access to a resource, you can use management locks.</span><span class="sxs-lookup"><span data-stu-id="eb215-397">If you need to lock access to a resource, you can use management locks.</span></span> <span data-ttu-id="eb215-398">See [Lock Resources with Azure Resource Manager](resource-group-lock-resources.md)</span><span class="sxs-lookup"><span data-stu-id="eb215-398">See [Lock Resources with Azure Resource Manager](resource-group-lock-resources.md)</span></span>
* <span data-ttu-id="eb215-399">To configure routing and IP forwarding, see [Create User Defined Routes (UDR) in Resource Manager by using a template](../virtual-network/virtual-network-create-udr-arm-template.md)</span><span class="sxs-lookup"><span data-stu-id="eb215-399">To configure routing and IP forwarding, see [Create User Defined Routes (UDR) in Resource Manager by using a template](../virtual-network/virtual-network-create-udr-arm-template.md)</span></span>
* <span data-ttu-id="eb215-400">For an overview of role-based access control, see [Role-based access control in the Microsoft Azure portal](../active-directory/role-based-access-control-configure.md)</span><span class="sxs-lookup"><span data-stu-id="eb215-400">For an overview of role-based access control, see [Role-based access control in the Microsoft Azure portal](../active-directory/role-based-access-control-configure.md)</span></span>



