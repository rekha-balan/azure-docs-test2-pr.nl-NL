---
title: Troubleshoot Cloud Services using Application Insights | Microsoft Docs
description: Learn how to troubleshoot cloud service issues by using Application Insights to process data from Azure Diagnostics.
services: cloud-services
documentationcenter: .net
author: sbtron
manager: timlt
editor: tysonn
ms.assetid: e93f387b-ef29-4731-ae41-0676722accb6
ms.service: cloud-services
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/15/2015
ms.author: saurabh
ms.openlocfilehash: a16eb95cf4b7e72ee9cf94deb2412483be5eb269
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44563547"
---
# <a name="troubleshoot-cloud-services-using-application-insights"></a><span data-ttu-id="0db45-103">Troubleshoot Cloud Services using Application Insights</span><span class="sxs-lookup"><span data-stu-id="0db45-103">Troubleshoot Cloud Services using Application Insights</span></span>
<span data-ttu-id="0db45-104">With [Azure SDK 2.8](https://azure.microsoft.com/downloads/) and Azure diagnostics extension 1.5 you can now send your Azure Diagnostics data for your Cloud Service directly to Application Insights.</span><span class="sxs-lookup"><span data-stu-id="0db45-104">With [Azure SDK 2.8](https://azure.microsoft.com/downloads/) and Azure diagnostics extension 1.5 you can now send your Azure Diagnostics data for your Cloud Service directly to Application Insights.</span></span> <span data-ttu-id="0db45-105">The various types of logs collected by Azure Diagnostics including application logs, windows event logs, ETW logs and performance counters can now be sent to Application Insights and visualized in the Application Insights portal UI.</span><span class="sxs-lookup"><span data-stu-id="0db45-105">The various types of logs collected by Azure Diagnostics including application logs, windows event logs, ETW logs and performance counters can now be sent to Application Insights and visualized in the Application Insights portal UI.</span></span> <span data-ttu-id="0db45-106">When used along with the Application Insights SDK you can now get insights into metrics and logs coming from your application as well as the system and infrastructure level data coming from Azure Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="0db45-106">When used along with the Application Insights SDK you can now get insights into metrics and logs coming from your application as well as the system and infrastructure level data coming from Azure Diagnostics.</span></span>

## <a name="configure-azure-diagnostics-to-send-data-to-application-insights"></a><span data-ttu-id="0db45-107">Configure Azure Diagnostics to send data to Application Insights</span><span class="sxs-lookup"><span data-stu-id="0db45-107">Configure Azure Diagnostics to send data to Application Insights</span></span>
<span data-ttu-id="0db45-108">Follow these steps to setup your cloud service project to send Azure Diagnostics data to Application Insights.</span><span class="sxs-lookup"><span data-stu-id="0db45-108">Follow these steps to setup your cloud service project to send Azure Diagnostics data to Application Insights.</span></span>

1) <span data-ttu-id="0db45-109">In Visual Studio Solution Explorer right-click on a role and select **properties** to open the Role designer</span><span class="sxs-lookup"><span data-stu-id="0db45-109">In Visual Studio Solution Explorer right-click on a role and select **properties** to open the Role designer</span></span>

![Solution Explorer Role Properties][1]

2) <span data-ttu-id="0db45-111">In Role designer under the diagnostics section select the check box to **Send diagnostics data to Application Insights**</span><span class="sxs-lookup"><span data-stu-id="0db45-111">In Role designer under the diagnostics section select the check box to **Send diagnostics data to Application Insights**</span></span>

![Role designer send diagnostics data to application insights][2]

3) <span data-ttu-id="0db45-113">In the dialog that pops up select the Application Insights Resource that you would like to send the Azure diagnostics data to.</span><span class="sxs-lookup"><span data-stu-id="0db45-113">In the dialog that pops up select the Application Insights Resource that you would like to send the Azure diagnostics data to.</span></span> <span data-ttu-id="0db45-114">The dialog allows you to select an existing Application Insights resource from your subscription or manually specify an instrumentation key for an Application Insights resource.</span><span class="sxs-lookup"><span data-stu-id="0db45-114">The dialog allows you to select an existing Application Insights resource from your subscription or manually specify an instrumentation key for an Application Insights resource.</span></span> <span data-ttu-id="0db45-115">If you don't have an existing Application Insights resource then you can create on by clicking on the **Create a new resource** link which will open a browser window to the Azure classic portal where you can create an Application Insights Resource.</span><span class="sxs-lookup"><span data-stu-id="0db45-115">If you don't have an existing Application Insights resource then you can create on by clicking on the **Create a new resource** link which will open a browser window to the Azure classic portal where you can create an Application Insights Resource.</span></span> <span data-ttu-id="0db45-116">For more information on creating an Application Insights resource see [Create a new Application Insights resource](../application-insights/app-insights-create-new-resource.md)</span><span class="sxs-lookup"><span data-stu-id="0db45-116">For more information on creating an Application Insights resource see [Create a new Application Insights resource](../application-insights/app-insights-create-new-resource.md)</span></span>

![select application insights resource][3]

4) <span data-ttu-id="0db45-118">Once you have added the Application Insights resource, the instrumentation key for that resource is stored as a service configuration setting with the name **APPINSIGHTS_INSTRUMENTATIONKEY**.</span><span class="sxs-lookup"><span data-stu-id="0db45-118">Once you have added the Application Insights resource, the instrumentation key for that resource is stored as a service configuration setting with the name **APPINSIGHTS_INSTRUMENTATIONKEY**.</span></span> <span data-ttu-id="0db45-119">You can change this configuration setting for each service configuration or environment by selecting a different configuration from the Service configuration drop down and specifying a new instrumentation key for that configuration.</span><span class="sxs-lookup"><span data-stu-id="0db45-119">You can change this configuration setting for each service configuration or environment by selecting a different configuration from the Service configuration drop down and specifying a new instrumentation key for that configuration.</span></span>

![select service configuration][4]

<span data-ttu-id="0db45-121">The **APPINSIGHTS_INSTRUMENTATIONKEY** configuration setting is used by Visual Studio to configure the diagnostics extension with the appropriate Application Insights resource information during publishing.</span><span class="sxs-lookup"><span data-stu-id="0db45-121">The **APPINSIGHTS_INSTRUMENTATIONKEY** configuration setting is used by Visual Studio to configure the diagnostics extension with the appropriate Application Insights resource information during publishing.</span></span> <span data-ttu-id="0db45-122">The configuration setting is a convenient way of defining different instrumentation keys for different service configurations.</span><span class="sxs-lookup"><span data-stu-id="0db45-122">The configuration setting is a convenient way of defining different instrumentation keys for different service configurations.</span></span> <span data-ttu-id="0db45-123">Visual Studio will translate that setting and insert it into the diagnostics extension public configuration when publishing.</span><span class="sxs-lookup"><span data-stu-id="0db45-123">Visual Studio will translate that setting and insert it into the diagnostics extension public configuration when publishing.</span></span> <span data-ttu-id="0db45-124">To simplify the process of configuring the diagnostics extension with PowerShell, the package output from Visual Studio also contains the public configuration XML with the appropriate Application Insights instrumentation key included.</span><span class="sxs-lookup"><span data-stu-id="0db45-124">To simplify the process of configuring the diagnostics extension with PowerShell, the package output from Visual Studio also contains the public configuration XML with the appropriate Application Insights instrumentation key included.</span></span> <span data-ttu-id="0db45-125">The public config files are created in the Extensions folder and follow the pattern PaaSDiagnostics.<RoleName>.PubConfig.xml.</span><span class="sxs-lookup"><span data-stu-id="0db45-125">The public config files are created in the Extensions folder and follow the pattern PaaSDiagnostics.<RoleName>.PubConfig.xml.</span></span> <span data-ttu-id="0db45-126">Any PowerShell based deployments can use this pattern to map each configuration to a Role.</span><span class="sxs-lookup"><span data-stu-id="0db45-126">Any PowerShell based deployments can use this pattern to map each configuration to a Role.</span></span>

5) <span data-ttu-id="0db45-127">Enabling the **Send diagnostics data to Application Insights** will automatically configure Azure diagnostics to send all performance counters and error level logs that are being collected by the Azure diagnostics agent to Application Insights.</span><span class="sxs-lookup"><span data-stu-id="0db45-127">Enabling the **Send diagnostics data to Application Insights** will automatically configure Azure diagnostics to send all performance counters and error level logs that are being collected by the Azure diagnostics agent to Application Insights.</span></span> <span data-ttu-id="0db45-128">If you want to further configure what data is sent to Application Insights then you need to manually edit the *diagnostics.wadcfgx* file for each role.</span><span class="sxs-lookup"><span data-stu-id="0db45-128">If you want to further configure what data is sent to Application Insights then you need to manually edit the *diagnostics.wadcfgx* file for each role.</span></span> <span data-ttu-id="0db45-129">See [Configure Azure Diagnostics to send data to Application Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) to learn more about manually updating the configuration.</span><span class="sxs-lookup"><span data-stu-id="0db45-129">See [Configure Azure Diagnostics to send data to Application Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) to learn more about manually updating the configuration.</span></span>

<span data-ttu-id="0db45-130">Once the Cloud Service is configured to send Azure diagnostics data to application insights you can deploy it to Azure like you normally would making sure the Azure diagnostics extension is enabled.</span><span class="sxs-lookup"><span data-stu-id="0db45-130">Once the Cloud Service is configured to send Azure diagnostics data to application insights you can deploy it to Azure like you normally would making sure the Azure diagnostics extension is enabled.</span></span> <span data-ttu-id="0db45-131">See [Publishing a Cloud Service using Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span><span class="sxs-lookup"><span data-stu-id="0db45-131">See [Publishing a Cloud Service using Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span></span>  

## <a name="viewing-azure-diagnostics-data-in-application-insights"></a><span data-ttu-id="0db45-132">Viewing Azure diagnostics data in Application Insights</span><span class="sxs-lookup"><span data-stu-id="0db45-132">Viewing Azure diagnostics data in Application Insights</span></span>
<span data-ttu-id="0db45-133">The Azure diagnostic telemetry will show up in the Application Insights resource configured for your cloud service.</span><span class="sxs-lookup"><span data-stu-id="0db45-133">The Azure diagnostic telemetry will show up in the Application Insights resource configured for your cloud service.</span></span>

<span data-ttu-id="0db45-134">The following is how the various Azure diagnostics log types map to Application Insights concepts:</span><span class="sxs-lookup"><span data-stu-id="0db45-134">The following is how the various Azure diagnostics log types map to Application Insights concepts:</span></span>  

* <span data-ttu-id="0db45-135">Performance Counters are displayed as Custom Metrics in Application Insights</span><span class="sxs-lookup"><span data-stu-id="0db45-135">Performance Counters are displayed as Custom Metrics in Application Insights</span></span>
* <span data-ttu-id="0db45-136">Windows Event Logs are shown as Traces and Custom Events in Application Insights</span><span class="sxs-lookup"><span data-stu-id="0db45-136">Windows Event Logs are shown as Traces and Custom Events in Application Insights</span></span>
* <span data-ttu-id="0db45-137">Application Logs, ETW Logs and any Diagnostics Infrastructure logs are shown as Traces in Application Insights.</span><span class="sxs-lookup"><span data-stu-id="0db45-137">Application Logs, ETW Logs and any Diagnostics Infrastructure logs are shown as Traces in Application Insights.</span></span>

<span data-ttu-id="0db45-138">To view Azure diagnostics data in Application Insights:</span><span class="sxs-lookup"><span data-stu-id="0db45-138">To view Azure diagnostics data in Application Insights:</span></span>

* <span data-ttu-id="0db45-139">Use [Metrics explorer](../application-insights/app-insights-metrics-explorer.md) to visualize any custom performance counters or counts of different types of windows event log events.</span><span class="sxs-lookup"><span data-stu-id="0db45-139">Use [Metrics explorer](../application-insights/app-insights-metrics-explorer.md) to visualize any custom performance counters or counts of different types of windows event log events.</span></span>

![Custom Metrics in Metrics Explorer][5]

* <span data-ttu-id="0db45-141">Use [Search](../application-insights/app-insights-diagnostic-search.md) to search across the various trace logs sent by Azure Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="0db45-141">Use [Search](../application-insights/app-insights-diagnostic-search.md) to search across the various trace logs sent by Azure Diagnostics.</span></span> <span data-ttu-id="0db45-142">For example if you had an unhandled exception in a Role which caused the Role to crash and recycle that information would show up in the *Application* channel of *Windows Event Log*.</span><span class="sxs-lookup"><span data-stu-id="0db45-142">For example if you had an unhandled exception in a Role which caused the Role to crash and recycle that information would show up in the *Application* channel of *Windows Event Log*.</span></span> <span data-ttu-id="0db45-143">You can use the Search functionality to look at the Windows Event Log error and get the full stack trace for the exception enabling you to find the root cause of the issue.</span><span class="sxs-lookup"><span data-stu-id="0db45-143">You can use the Search functionality to look at the Windows Event Log error and get the full stack trace for the exception enabling you to find the root cause of the issue.</span></span>

![Search Traces][6]

## <a name="next-steps"></a><span data-ttu-id="0db45-145">Next Steps</span><span class="sxs-lookup"><span data-stu-id="0db45-145">Next Steps</span></span>
* <span data-ttu-id="0db45-146">[Add the Application Insights SDK to your cloud service](../application-insights/app-insights-cloudservices.md) to send data about requests, exceptions, dependencies, and any custom telemetry from your application.</span><span class="sxs-lookup"><span data-stu-id="0db45-146">[Add the Application Insights SDK to your cloud service](../application-insights/app-insights-cloudservices.md) to send data about requests, exceptions, dependencies, and any custom telemetry from your application.</span></span> <span data-ttu-id="0db45-147">Combined with the Azure Diagnostics data you can get a complete view of your application and system all in the same Application Insight resource.</span><span class="sxs-lookup"><span data-stu-id="0db45-147">Combined with the Azure Diagnostics data you can get a complete view of your application and system all in the same Application Insight resource.</span></span>  

<!--Image references-->
[1]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/cloud-services/media/cloud-services-dotnet-diagnostics-applicationinsights/solution-explorer-properties.png
[2]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/cloud-services/media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-sendtoappinsights.png
[3]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/cloud-services/media/cloud-services-dotnet-diagnostics-applicationinsights/select-appinsights-resource.png
[4]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/cloud-services/media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-appinsights-serviceconfig.png
[5]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/cloud-services/media/cloud-services-dotnet-diagnostics-applicationinsights/metrics-explorer-custom-metrics.png
[6]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/cloud-services/media/cloud-services-dotnet-diagnostics-applicationinsights/search-windowseventlog-error.png






