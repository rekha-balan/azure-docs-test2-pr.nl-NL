---
title: Azure Cloud Services Def. LoadBalancerProbe Schema | Microsoft Docs
ms.custom: ''
ms.date: 04/14/2015
services: cloud-services
ms.reviewer: ''
ms.service: cloud-services
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: reference
ms.assetid: 113374a8-8072-4994-9d99-de391a91e6ea
caps.latest.revision: 14
author: jpconnock
ms.author: jeconnoc
manager: timlt
ms.openlocfilehash: f7b0ba3b4797149798037dee0188850eff6baf1d
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44865782"
---
# <a name="azure-cloud-services-definition-loadbalancerprobe-schema"></a><span data-ttu-id="3cd23-102">Azure Cloud Services Definition LoadBalancerProbe Schema</span><span class="sxs-lookup"><span data-stu-id="3cd23-102">Azure Cloud Services Definition LoadBalancerProbe Schema</span></span>
<span data-ttu-id="3cd23-103">The load balancer probe is a customer defined health probe of UDP endpoints and endpoints in role instances.</span><span class="sxs-lookup"><span data-stu-id="3cd23-103">The load balancer probe is a customer defined health probe of UDP endpoints and endpoints in role instances.</span></span> <span data-ttu-id="3cd23-104">The `LoadBalancerProbe` is not a standalone element; it is combined with the web role or worker role in a service definition file.</span><span class="sxs-lookup"><span data-stu-id="3cd23-104">The `LoadBalancerProbe` is not a standalone element; it is combined with the web role or worker role in a service definition file.</span></span> <span data-ttu-id="3cd23-105">A `LoadBalancerProbe` can be used by more than one role.</span><span class="sxs-lookup"><span data-stu-id="3cd23-105">A `LoadBalancerProbe` can be used by more than one role.</span></span>

<span data-ttu-id="3cd23-106">The default extension for the service definition file is .csdef.</span><span class="sxs-lookup"><span data-stu-id="3cd23-106">The default extension for the service definition file is .csdef.</span></span>

## <a name="the-function-of-a-load-balancer-probe"></a><span data-ttu-id="3cd23-107">The function of a load balancer probe</span><span class="sxs-lookup"><span data-stu-id="3cd23-107">The function of a load balancer probe</span></span>
<span data-ttu-id="3cd23-108">The Azure Load Balancer is responsible for routing incoming traffic to your role instances.</span><span class="sxs-lookup"><span data-stu-id="3cd23-108">The Azure Load Balancer is responsible for routing incoming traffic to your role instances.</span></span> <span data-ttu-id="3cd23-109">The load balancer determines which instances can receive traffic by regularly probing each instance in order to determine the health of that instance.</span><span class="sxs-lookup"><span data-stu-id="3cd23-109">The load balancer determines which instances can receive traffic by regularly probing each instance in order to determine the health of that instance.</span></span> <span data-ttu-id="3cd23-110">The load balancer probes every instance multiple times per minute.</span><span class="sxs-lookup"><span data-stu-id="3cd23-110">The load balancer probes every instance multiple times per minute.</span></span> <span data-ttu-id="3cd23-111">There are two different options for providing instance health to the load balancer – the default load balancer probe, or a custom load balancer probe, which is implemented by defining the LoadBalancerProbe in the .csdef file.</span><span class="sxs-lookup"><span data-stu-id="3cd23-111">There are two different options for providing instance health to the load balancer – the default load balancer probe, or a custom load balancer probe, which is implemented by defining the LoadBalancerProbe in the .csdef file.</span></span>

<span data-ttu-id="3cd23-112">The default load balancer probe utilizes the Guest Agent inside the virtual machine, which listens and responds with an HTTP 200 OK response only when the instance is in the Ready state (like when the instance is not in the Busy, Recycling, Stopping, etc. states).</span><span class="sxs-lookup"><span data-stu-id="3cd23-112">The default load balancer probe utilizes the Guest Agent inside the virtual machine, which listens and responds with an HTTP 200 OK response only when the instance is in the Ready state (like when the instance is not in the Busy, Recycling, Stopping, etc. states).</span></span> <span data-ttu-id="3cd23-113">If the Guest Agent fails to respond with HTTP 200 OK, the Azure Load Balancer marks the instance as unresponsive and stops sending traffic to that instance.</span><span class="sxs-lookup"><span data-stu-id="3cd23-113">If the Guest Agent fails to respond with HTTP 200 OK, the Azure Load Balancer marks the instance as unresponsive and stops sending traffic to that instance.</span></span> <span data-ttu-id="3cd23-114">The Azure Load Balancer continues to ping the instance, and if the Guest Agent responds with an HTTP 200, the Azure Load Balancer sends traffic to that instance again.</span><span class="sxs-lookup"><span data-stu-id="3cd23-114">The Azure Load Balancer continues to ping the instance, and if the Guest Agent responds with an HTTP 200, the Azure Load Balancer sends traffic to that instance again.</span></span> <span data-ttu-id="3cd23-115">When using a web role your website code typically runs in w3wp.exe which is not monitored by the Azure fabric or guest agent, which means failures in w3wp.exe (eg.</span><span class="sxs-lookup"><span data-stu-id="3cd23-115">When using a web role your website code typically runs in w3wp.exe which is not monitored by the Azure fabric or guest agent, which means failures in w3wp.exe (eg.</span></span> <span data-ttu-id="3cd23-116">HTTP 500 responses) is not be reported to the guest agent and the load balancer does not know to take that instance out of rotation.</span><span class="sxs-lookup"><span data-stu-id="3cd23-116">HTTP 500 responses) is not be reported to the guest agent and the load balancer does not know to take that instance out of rotation.</span></span>

<span data-ttu-id="3cd23-117">The custom load balancer probe overrides the default guest agent probe and allows you to create your own custom logic to determine the health of the role instance.</span><span class="sxs-lookup"><span data-stu-id="3cd23-117">The custom load balancer probe overrides the default guest agent probe and allows you to create your own custom logic to determine the health of the role instance.</span></span> <span data-ttu-id="3cd23-118">The load balancer regularly probes your endpoint (every 15 seconds, by default) and the instance is be considered in rotation if it responds with a TCP ACK or HTTP 200 within the timeout period (default of 31 seconds).</span><span class="sxs-lookup"><span data-stu-id="3cd23-118">The load balancer regularly probes your endpoint (every 15 seconds, by default) and the instance is be considered in rotation if it responds with a TCP ACK or HTTP 200 within the timeout period (default of 31 seconds).</span></span> <span data-ttu-id="3cd23-119">This can be useful to implement your own logic to remove instances from load balancer rotation, for example returning a non-200 status if the instance is above 90% CPU.</span><span class="sxs-lookup"><span data-stu-id="3cd23-119">This can be useful to implement your own logic to remove instances from load balancer rotation, for example returning a non-200 status if the instance is above 90% CPU.</span></span> <span data-ttu-id="3cd23-120">For web roles using w3wp.exe, this also means you get automatic monitoring of your website, since failures in your website code return a non-200 status to the load balancer probe.</span><span class="sxs-lookup"><span data-stu-id="3cd23-120">For web roles using w3wp.exe, this also means you get automatic monitoring of your website, since failures in your website code return a non-200 status to the load balancer probe.</span></span> <span data-ttu-id="3cd23-121">If you do not define a LoadBalancerProbe in the .csdef file, then the default load balancer behavior (as previously described) is be used.</span><span class="sxs-lookup"><span data-stu-id="3cd23-121">If you do not define a LoadBalancerProbe in the .csdef file, then the default load balancer behavior (as previously described) is be used.</span></span>

<span data-ttu-id="3cd23-122">If you use a custom load balancer probe, you must ensure that your logic takes into consideration the RoleEnvironment.OnStop method.</span><span class="sxs-lookup"><span data-stu-id="3cd23-122">If you use a custom load balancer probe, you must ensure that your logic takes into consideration the RoleEnvironment.OnStop method.</span></span> <span data-ttu-id="3cd23-123">When using the default load balancer probe, the instance is taken out of rotation prior to OnStop being called, but a custom load balancer probe can continue to return a 200 OK during the OnStop event.</span><span class="sxs-lookup"><span data-stu-id="3cd23-123">When using the default load balancer probe, the instance is taken out of rotation prior to OnStop being called, but a custom load balancer probe can continue to return a 200 OK during the OnStop event.</span></span> <span data-ttu-id="3cd23-124">If you are using the OnStop event to clean up cache, stop service, or otherwise making changes that can affect the runtime behavior of your service, then you need to ensure that your custom load balancer probe logic removes the instance from rotation.</span><span class="sxs-lookup"><span data-stu-id="3cd23-124">If you are using the OnStop event to clean up cache, stop service, or otherwise making changes that can affect the runtime behavior of your service, then you need to ensure that your custom load balancer probe logic removes the instance from rotation.</span></span>

## <a name="basic-service-definition-schema-for-a-load-balancer-probe"></a><span data-ttu-id="3cd23-125">Basic service definition schema for a load balancer probe</span><span class="sxs-lookup"><span data-stu-id="3cd23-125">Basic service definition schema for a load balancer probe</span></span>
 <span data-ttu-id="3cd23-126">The basic format of a service definition file containing a load balancer probe is as follows.</span><span class="sxs-lookup"><span data-stu-id="3cd23-126">The basic format of a service definition file containing a load balancer probe is as follows.</span></span>

```xml
<ServiceDefinition …>
   <LoadBalancerProbes>
      <LoadBalancerProbe name="<load-balancer-probe-name>" protocol="[http|tcp]" path="<uri-for-checking-health-status-of-vm>" port="<port-number>" intervalInSeconds="<interval-in-seconds>" timeoutInSeconds="<timeout-in-seconds>"/>
   </LoadBalancerProbes>
</ServiceDefinition>
```

## <a name="schema-elements"></a><span data-ttu-id="3cd23-127">Schema elements</span><span class="sxs-lookup"><span data-stu-id="3cd23-127">Schema elements</span></span>
<span data-ttu-id="3cd23-128">The `LoadBalancerProbes` element of the service definition file includes the following elements:</span><span class="sxs-lookup"><span data-stu-id="3cd23-128">The `LoadBalancerProbes` element of the service definition file includes the following elements:</span></span>

- [<span data-ttu-id="3cd23-129">LoadBalancerProbes Element</span><span class="sxs-lookup"><span data-stu-id="3cd23-129">LoadBalancerProbes Element</span></span>](#LoadBalancerProbes)
- [<span data-ttu-id="3cd23-130">LoadBalancerProbe Element</span><span class="sxs-lookup"><span data-stu-id="3cd23-130">LoadBalancerProbe Element</span></span>](#LoadBalancerProbe)

##  <a name="LoadBalancerProbes"></a> <span data-ttu-id="3cd23-131">LoadBalancerProbes Element</span><span class="sxs-lookup"><span data-stu-id="3cd23-131">LoadBalancerProbes Element</span></span>
<span data-ttu-id="3cd23-132">The `LoadBalancerProbes` element describes the collection of load balancer probes.</span><span class="sxs-lookup"><span data-stu-id="3cd23-132">The `LoadBalancerProbes` element describes the collection of load balancer probes.</span></span> <span data-ttu-id="3cd23-133">This element is the parent element of the [LoadBalancerProbe Element](#LoadBalancerProbe).</span><span class="sxs-lookup"><span data-stu-id="3cd23-133">This element is the parent element of the [LoadBalancerProbe Element](#LoadBalancerProbe).</span></span> 

##  <a name="LoadBalancerProbe"></a> <span data-ttu-id="3cd23-134">LoadBalancerProbe Element</span><span class="sxs-lookup"><span data-stu-id="3cd23-134">LoadBalancerProbe Element</span></span>
<span data-ttu-id="3cd23-135">The `LoadBalancerProbe` element defines the health probe for a model.</span><span class="sxs-lookup"><span data-stu-id="3cd23-135">The `LoadBalancerProbe` element defines the health probe for a model.</span></span> <span data-ttu-id="3cd23-136">You can define multiple load balancer probes.</span><span class="sxs-lookup"><span data-stu-id="3cd23-136">You can define multiple load balancer probes.</span></span> 

<span data-ttu-id="3cd23-137">The following table describes the attributes of the `LoadBalancerProbe` element:</span><span class="sxs-lookup"><span data-stu-id="3cd23-137">The following table describes the attributes of the `LoadBalancerProbe` element:</span></span>

|<span data-ttu-id="3cd23-138">Attribute</span><span class="sxs-lookup"><span data-stu-id="3cd23-138">Attribute</span></span>|<span data-ttu-id="3cd23-139">Type</span><span class="sxs-lookup"><span data-stu-id="3cd23-139">Type</span></span>|<span data-ttu-id="3cd23-140">Description</span><span class="sxs-lookup"><span data-stu-id="3cd23-140">Description</span></span>|
| ------------------- | -------- | -----------------|
| `name`              | `string` | <span data-ttu-id="3cd23-141">Required.</span><span class="sxs-lookup"><span data-stu-id="3cd23-141">Required.</span></span> <span data-ttu-id="3cd23-142">The name of the load balancer probe.</span><span class="sxs-lookup"><span data-stu-id="3cd23-142">The name of the load balancer probe.</span></span> <span data-ttu-id="3cd23-143">The name must be unique.</span><span class="sxs-lookup"><span data-stu-id="3cd23-143">The name must be unique.</span></span>|
| `protocol`          | `string` | <span data-ttu-id="3cd23-144">Required.</span><span class="sxs-lookup"><span data-stu-id="3cd23-144">Required.</span></span> <span data-ttu-id="3cd23-145">Specifies the protocol of the end point.</span><span class="sxs-lookup"><span data-stu-id="3cd23-145">Specifies the protocol of the end point.</span></span> <span data-ttu-id="3cd23-146">Possible values are `http` or `tcp`.</span><span class="sxs-lookup"><span data-stu-id="3cd23-146">Possible values are `http` or `tcp`.</span></span> <span data-ttu-id="3cd23-147">If `tcp` is specified, a received ACK is required for the probe to be successful.</span><span class="sxs-lookup"><span data-stu-id="3cd23-147">If `tcp` is specified, a received ACK is required for the probe to be successful.</span></span> <span data-ttu-id="3cd23-148">If `http` is specified, a 200 OK response from the specified URI is required for the probe to be successful.</span><span class="sxs-lookup"><span data-stu-id="3cd23-148">If `http` is specified, a 200 OK response from the specified URI is required for the probe to be successful.</span></span>|
| `path`              | `string` | <span data-ttu-id="3cd23-149">The URI used for requesting health status from the VM.</span><span class="sxs-lookup"><span data-stu-id="3cd23-149">The URI used for requesting health status from the VM.</span></span> <span data-ttu-id="3cd23-150">`path` is required if `protocol` is set to `http`.</span><span class="sxs-lookup"><span data-stu-id="3cd23-150">`path` is required if `protocol` is set to `http`.</span></span> <span data-ttu-id="3cd23-151">Otherwise, it is not allowed.</span><span class="sxs-lookup"><span data-stu-id="3cd23-151">Otherwise, it is not allowed.</span></span><br /><br /> <span data-ttu-id="3cd23-152">There is no default value.</span><span class="sxs-lookup"><span data-stu-id="3cd23-152">There is no default value.</span></span>|
| `port`              | `integer` | <span data-ttu-id="3cd23-153">Optional.</span><span class="sxs-lookup"><span data-stu-id="3cd23-153">Optional.</span></span> <span data-ttu-id="3cd23-154">The port for communicating the probe.</span><span class="sxs-lookup"><span data-stu-id="3cd23-154">The port for communicating the probe.</span></span> <span data-ttu-id="3cd23-155">This is optional for any endpoint, as the same port will then be used for the probe.</span><span class="sxs-lookup"><span data-stu-id="3cd23-155">This is optional for any endpoint, as the same port will then be used for the probe.</span></span> <span data-ttu-id="3cd23-156">You can configure a different port for their probing, as well.</span><span class="sxs-lookup"><span data-stu-id="3cd23-156">You can configure a different port for their probing, as well.</span></span> <span data-ttu-id="3cd23-157">Possible values range from 1 to 65535, inclusive.</span><span class="sxs-lookup"><span data-stu-id="3cd23-157">Possible values range from 1 to 65535, inclusive.</span></span><br /><br /> <span data-ttu-id="3cd23-158">The default value is set by the endpoint.</span><span class="sxs-lookup"><span data-stu-id="3cd23-158">The default value is set by the endpoint.</span></span>|
| `intervalInSeconds` | `integer` | <span data-ttu-id="3cd23-159">Optional.</span><span class="sxs-lookup"><span data-stu-id="3cd23-159">Optional.</span></span> <span data-ttu-id="3cd23-160">The interval, in seconds, for how frequently to probe the endpoint for health status.</span><span class="sxs-lookup"><span data-stu-id="3cd23-160">The interval, in seconds, for how frequently to probe the endpoint for health status.</span></span> <span data-ttu-id="3cd23-161">Typically, the interval is slightly less than half the allocated timeout period (in seconds) which allows two full probes before taking the instance out of rotation.</span><span class="sxs-lookup"><span data-stu-id="3cd23-161">Typically, the interval is slightly less than half the allocated timeout period (in seconds) which allows two full probes before taking the instance out of rotation.</span></span><br /><br /> <span data-ttu-id="3cd23-162">The default value is 15, the minimum value is 5.</span><span class="sxs-lookup"><span data-stu-id="3cd23-162">The default value is 15, the minimum value is 5.</span></span>|
| `timeoutInSeconds`  | `integer` | <span data-ttu-id="3cd23-163">Optional.</span><span class="sxs-lookup"><span data-stu-id="3cd23-163">Optional.</span></span> <span data-ttu-id="3cd23-164">The timeout period, in seconds, applied to the probe where no response will result in stopping further traffic from being delivered to the endpoint.</span><span class="sxs-lookup"><span data-stu-id="3cd23-164">The timeout period, in seconds, applied to the probe where no response will result in stopping further traffic from being delivered to the endpoint.</span></span> <span data-ttu-id="3cd23-165">This value allows endpoints to be taken out of rotation faster or slower than the typical times used in Azure (which are the defaults).</span><span class="sxs-lookup"><span data-stu-id="3cd23-165">This value allows endpoints to be taken out of rotation faster or slower than the typical times used in Azure (which are the defaults).</span></span><br /><br /> <span data-ttu-id="3cd23-166">The default value is 31, the minimum value is 11.</span><span class="sxs-lookup"><span data-stu-id="3cd23-166">The default value is 31, the minimum value is 11.</span></span>|

## <a name="see-also"></a><span data-ttu-id="3cd23-167">See Also</span><span class="sxs-lookup"><span data-stu-id="3cd23-167">See Also</span></span>
[<span data-ttu-id="3cd23-168">Cloud Service (classic) Definition Schema</span><span class="sxs-lookup"><span data-stu-id="3cd23-168">Cloud Service (classic) Definition Schema</span></span>](schema-csdef-file.md)