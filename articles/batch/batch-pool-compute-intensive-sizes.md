---
title: Use compute-intensive Azure VMs with Batch | Microsoft Docs
description: How to take advantage of RDMA-capable or GPU-enabled VM sizes in Azure Batch pools
services: batch
documentationcenter: ''
author: dlepow
manager: jeconnoc
editor: ''
ms.assetid: ''
ms.service: batch
ms.workload: big-compute
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/01/2018
ms.author: danlep
ms.openlocfilehash: 5a73e926b5979e573ccb0402ff2d23eae2463232
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44856388"
---
# <a name="use-rdma-capable-or-gpu-enabled-instances-in-batch-pools"></a><span data-ttu-id="c5567-103">Use RDMA-capable or GPU-enabled instances in Batch pools</span><span class="sxs-lookup"><span data-stu-id="c5567-103">Use RDMA-capable or GPU-enabled instances in Batch pools</span></span>

<span data-ttu-id="c5567-104">To run certain Batch jobs, you might want to take advantage of Azure VM sizes designed for large-scale computation.</span><span class="sxs-lookup"><span data-stu-id="c5567-104">To run certain Batch jobs, you might want to take advantage of Azure VM sizes designed for large-scale computation.</span></span> <span data-ttu-id="c5567-105">For example, to run multi-instance [MPI workloads](batch-mpi.md), you can choose A8, A9, or H-series sizes that have a network interface for Remote Direct Memory Access (RDMA).</span><span class="sxs-lookup"><span data-stu-id="c5567-105">For example, to run multi-instance [MPI workloads](batch-mpi.md), you can choose A8, A9, or H-series sizes that have a network interface for Remote Direct Memory Access (RDMA).</span></span> <span data-ttu-id="c5567-106">These sizes connect to an InfiniBand network for inter-node communication, which can accelerate MPI applications.</span><span class="sxs-lookup"><span data-stu-id="c5567-106">These sizes connect to an InfiniBand network for inter-node communication, which can accelerate MPI applications.</span></span> <span data-ttu-id="c5567-107">Or for CUDA applications, you can choose N-series sizes that include NVIDIA Tesla graphics processing unit (GPU) cards.</span><span class="sxs-lookup"><span data-stu-id="c5567-107">Or for CUDA applications, you can choose N-series sizes that include NVIDIA Tesla graphics processing unit (GPU) cards.</span></span>

<span data-ttu-id="c5567-108">This article provides guidance and examples to use some of Azure's specialized sizes in Batch pools.</span><span class="sxs-lookup"><span data-stu-id="c5567-108">This article provides guidance and examples to use some of Azure's specialized sizes in Batch pools.</span></span> <span data-ttu-id="c5567-109">For specs and background, see:</span><span class="sxs-lookup"><span data-stu-id="c5567-109">For specs and background, see:</span></span>

* <span data-ttu-id="c5567-110">High performance compute VM sizes ([Linux](../virtual-machines/linux/sizes-hpc.md), [Windows](../virtual-machines/windows/sizes-hpc.md))</span><span class="sxs-lookup"><span data-stu-id="c5567-110">High performance compute VM sizes ([Linux](../virtual-machines/linux/sizes-hpc.md), [Windows](../virtual-machines/windows/sizes-hpc.md))</span></span> 

* <span data-ttu-id="c5567-111">GPU-enabled VM sizes ([Linux](../virtual-machines/linux/sizes-gpu.md), [Windows](../virtual-machines/windows/sizes-gpu.md))</span><span class="sxs-lookup"><span data-stu-id="c5567-111">GPU-enabled VM sizes ([Linux](../virtual-machines/linux/sizes-gpu.md), [Windows](../virtual-machines/windows/sizes-gpu.md))</span></span> 


## <a name="subscription-and-account-limits"></a><span data-ttu-id="c5567-112">Subscription and account limits</span><span class="sxs-lookup"><span data-stu-id="c5567-112">Subscription and account limits</span></span>

* <span data-ttu-id="c5567-113">**Quotas and limits** - The [cores quota per Batch account](batch-quota-limit.md#resource-quotas) can limit the number of nodes of a given size you can add to a Batch pool.</span><span class="sxs-lookup"><span data-stu-id="c5567-113">**Quotas and limits** - The [cores quota per Batch account](batch-quota-limit.md#resource-quotas) can limit the number of nodes of a given size you can add to a Batch pool.</span></span> <span data-ttu-id="c5567-114">You are more likely to reach a quota when you choose RDMA-capable, GPU-enabled, or other multicore VM sizes.</span><span class="sxs-lookup"><span data-stu-id="c5567-114">You are more likely to reach a quota when you choose RDMA-capable, GPU-enabled, or other multicore VM sizes.</span></span> 

  <span data-ttu-id="c5567-115">Additionally, use of certain VM families in your Batch account, such as NCv2, NCv3, and ND, is restricted because of limited capacity.</span><span class="sxs-lookup"><span data-stu-id="c5567-115">Additionally, use of certain VM families in your Batch account, such as NCv2, NCv3, and ND, is restricted because of limited capacity.</span></span> <span data-ttu-id="c5567-116">Use of these families is only available by requesting a quota increase from the default of 0 cores.</span><span class="sxs-lookup"><span data-stu-id="c5567-116">Use of these families is only available by requesting a quota increase from the default of 0 cores.</span></span>  

  <span data-ttu-id="c5567-117">If you need to, [request a quota increase](batch-quota-limit.md#increase-a-quota) at no charge.</span><span class="sxs-lookup"><span data-stu-id="c5567-117">If you need to, [request a quota increase](batch-quota-limit.md#increase-a-quota) at no charge.</span></span>

* <span data-ttu-id="c5567-118">**Region availability** - Compute-intensive VMs might not be available in the regions where you create your Batch accounts.</span><span class="sxs-lookup"><span data-stu-id="c5567-118">**Region availability** - Compute-intensive VMs might not be available in the regions where you create your Batch accounts.</span></span> <span data-ttu-id="c5567-119">To check that a size is available, see [Products available by region](https://azure.microsoft.com/regions/services/).</span><span class="sxs-lookup"><span data-stu-id="c5567-119">To check that a size is available, see [Products available by region](https://azure.microsoft.com/regions/services/).</span></span>


## <a name="dependencies"></a><span data-ttu-id="c5567-120">Dependencies</span><span class="sxs-lookup"><span data-stu-id="c5567-120">Dependencies</span></span>

<span data-ttu-id="c5567-121">The RDMA and GPU capabilities of compute-intensive sizes are supported only in certain operating systems.</span><span class="sxs-lookup"><span data-stu-id="c5567-121">The RDMA and GPU capabilities of compute-intensive sizes are supported only in certain operating systems.</span></span> <span data-ttu-id="c5567-122">Depending on your operating system, you might need to install or configure additional driver or other software.</span><span class="sxs-lookup"><span data-stu-id="c5567-122">Depending on your operating system, you might need to install or configure additional driver or other software.</span></span> <span data-ttu-id="c5567-123">The following tables summarize these dependencies.</span><span class="sxs-lookup"><span data-stu-id="c5567-123">The following tables summarize these dependencies.</span></span> <span data-ttu-id="c5567-124">See linked articles for details.</span><span class="sxs-lookup"><span data-stu-id="c5567-124">See linked articles for details.</span></span> <span data-ttu-id="c5567-125">For options to configure Batch pools, see later in this article.</span><span class="sxs-lookup"><span data-stu-id="c5567-125">For options to configure Batch pools, see later in this article.</span></span>


### <a name="linux-pools---virtual-machine-configuration"></a><span data-ttu-id="c5567-126">Linux pools - Virtual machine configuration</span><span class="sxs-lookup"><span data-stu-id="c5567-126">Linux pools - Virtual machine configuration</span></span>

| <span data-ttu-id="c5567-127">Size</span><span class="sxs-lookup"><span data-stu-id="c5567-127">Size</span></span> | <span data-ttu-id="c5567-128">Capability</span><span class="sxs-lookup"><span data-stu-id="c5567-128">Capability</span></span> | <span data-ttu-id="c5567-129">Operating systems</span><span class="sxs-lookup"><span data-stu-id="c5567-129">Operating systems</span></span> | <span data-ttu-id="c5567-130">Required software</span><span class="sxs-lookup"><span data-stu-id="c5567-130">Required software</span></span> | <span data-ttu-id="c5567-131">Pool settings</span><span class="sxs-lookup"><span data-stu-id="c5567-131">Pool settings</span></span> |
| -------- | -------- | ----- |  -------- | ----- |
| [<span data-ttu-id="c5567-132">H16r, H16mr, A8, A9</span><span class="sxs-lookup"><span data-stu-id="c5567-132">H16r, H16mr, A8, A9</span></span>](../virtual-machines/linux/sizes-hpc.md#rdma-capable-instances) | <span data-ttu-id="c5567-133">RDMA</span><span class="sxs-lookup"><span data-stu-id="c5567-133">RDMA</span></span> | <span data-ttu-id="c5567-134">Ubuntu 16.04 LTS,</span><span class="sxs-lookup"><span data-stu-id="c5567-134">Ubuntu 16.04 LTS,</span></span><br/><span data-ttu-id="c5567-135">SUSE Linux Enterprise Server 12 HPC, or</span><span class="sxs-lookup"><span data-stu-id="c5567-135">SUSE Linux Enterprise Server 12 HPC, or</span></span><br/><span data-ttu-id="c5567-136">CentOS-based HPC</span><span class="sxs-lookup"><span data-stu-id="c5567-136">CentOS-based HPC</span></span><br/><span data-ttu-id="c5567-137">(Azure Marketplace)</span><span class="sxs-lookup"><span data-stu-id="c5567-137">(Azure Marketplace)</span></span> | <span data-ttu-id="c5567-138">Intel MPI 5</span><span class="sxs-lookup"><span data-stu-id="c5567-138">Intel MPI 5</span></span> | <span data-ttu-id="c5567-139">Enable inter-node communication, disable concurrent task execution</span><span class="sxs-lookup"><span data-stu-id="c5567-139">Enable inter-node communication, disable concurrent task execution</span></span> |
| [<span data-ttu-id="c5567-140">NC, NCv2, NCv3, ND series\*</span><span class="sxs-lookup"><span data-stu-id="c5567-140">NC, NCv2, NCv3, ND series\*</span></span>](../virtual-machines/linux/n-series-driver-setup.md) | <span data-ttu-id="c5567-141">NVIDIA Tesla GPU (varies by series)</span><span class="sxs-lookup"><span data-stu-id="c5567-141">NVIDIA Tesla GPU (varies by series)</span></span> | <span data-ttu-id="c5567-142">Ubuntu 16.04 LTS,</span><span class="sxs-lookup"><span data-stu-id="c5567-142">Ubuntu 16.04 LTS,</span></span><br/><span data-ttu-id="c5567-143">Red Hat Enterprise Linux 7.3 or 7.4, or</span><span class="sxs-lookup"><span data-stu-id="c5567-143">Red Hat Enterprise Linux 7.3 or 7.4, or</span></span><br/><span data-ttu-id="c5567-144">CentOS 7.3 or 7.4</span><span class="sxs-lookup"><span data-stu-id="c5567-144">CentOS 7.3 or 7.4</span></span><br/><span data-ttu-id="c5567-145">(Azure Marketplace)</span><span class="sxs-lookup"><span data-stu-id="c5567-145">(Azure Marketplace)</span></span> | <span data-ttu-id="c5567-146">NVIDIA CUDA Toolkit drivers</span><span class="sxs-lookup"><span data-stu-id="c5567-146">NVIDIA CUDA Toolkit drivers</span></span> | <span data-ttu-id="c5567-147">N/A</span><span class="sxs-lookup"><span data-stu-id="c5567-147">N/A</span></span> | 
| [<span data-ttu-id="c5567-148">NV series</span><span class="sxs-lookup"><span data-stu-id="c5567-148">NV series</span></span>](../virtual-machines/linux/n-series-driver-setup.md) | <span data-ttu-id="c5567-149">NVIDIA Tesla M60 GPU</span><span class="sxs-lookup"><span data-stu-id="c5567-149">NVIDIA Tesla M60 GPU</span></span> | <span data-ttu-id="c5567-150">Ubuntu 16.04 LTS,</span><span class="sxs-lookup"><span data-stu-id="c5567-150">Ubuntu 16.04 LTS,</span></span><br/><span data-ttu-id="c5567-151">Red Hat Enterprise Linux 7.3, or</span><span class="sxs-lookup"><span data-stu-id="c5567-151">Red Hat Enterprise Linux 7.3, or</span></span><br/><span data-ttu-id="c5567-152">CentOS 7.3</span><span class="sxs-lookup"><span data-stu-id="c5567-152">CentOS 7.3</span></span><br/><span data-ttu-id="c5567-153">(Azure Marketplace)</span><span class="sxs-lookup"><span data-stu-id="c5567-153">(Azure Marketplace)</span></span> | <span data-ttu-id="c5567-154">NVIDIA GRID drivers</span><span class="sxs-lookup"><span data-stu-id="c5567-154">NVIDIA GRID drivers</span></span> | <span data-ttu-id="c5567-155">N/A</span><span class="sxs-lookup"><span data-stu-id="c5567-155">N/A</span></span> |

<span data-ttu-id="c5567-156">\*RDMA connectivity on RDMA-capable N-series VMs may require [additional configuration](../virtual-machines/linux/n-series-driver-setup.md#rdma-network-connectivity) that varies by distribution.</span><span class="sxs-lookup"><span data-stu-id="c5567-156">\*RDMA connectivity on RDMA-capable N-series VMs may require [additional configuration](../virtual-machines/linux/n-series-driver-setup.md#rdma-network-connectivity) that varies by distribution.</span></span>



### <a name="windows-pools---virtual-machine-configuration"></a><span data-ttu-id="c5567-157">Windows pools - Virtual machine configuration</span><span class="sxs-lookup"><span data-stu-id="c5567-157">Windows pools - Virtual machine configuration</span></span>

| <span data-ttu-id="c5567-158">Size</span><span class="sxs-lookup"><span data-stu-id="c5567-158">Size</span></span> | <span data-ttu-id="c5567-159">Capability</span><span class="sxs-lookup"><span data-stu-id="c5567-159">Capability</span></span> | <span data-ttu-id="c5567-160">Operating systems</span><span class="sxs-lookup"><span data-stu-id="c5567-160">Operating systems</span></span> | <span data-ttu-id="c5567-161">Required software</span><span class="sxs-lookup"><span data-stu-id="c5567-161">Required software</span></span> | <span data-ttu-id="c5567-162">Pool settings</span><span class="sxs-lookup"><span data-stu-id="c5567-162">Pool settings</span></span> |
| -------- | ------ | -------- | -------- | ----- |
| [<span data-ttu-id="c5567-163">H16r, H16mr, A8, A9</span><span class="sxs-lookup"><span data-stu-id="c5567-163">H16r, H16mr, A8, A9</span></span>](../virtual-machines/windows/sizes-hpc.md#rdma-capable-instances) | <span data-ttu-id="c5567-164">RDMA</span><span class="sxs-lookup"><span data-stu-id="c5567-164">RDMA</span></span> | <span data-ttu-id="c5567-165">Windows Server 2016, 2012 R2, or</span><span class="sxs-lookup"><span data-stu-id="c5567-165">Windows Server 2016, 2012 R2, or</span></span><br/><span data-ttu-id="c5567-166">2012 (Azure Marketplace)</span><span class="sxs-lookup"><span data-stu-id="c5567-166">2012 (Azure Marketplace)</span></span> | <span data-ttu-id="c5567-167">Microsoft MPI 2012 R2 or later, or</span><span class="sxs-lookup"><span data-stu-id="c5567-167">Microsoft MPI 2012 R2 or later, or</span></span><br/> <span data-ttu-id="c5567-168">Intel MPI 5</span><span class="sxs-lookup"><span data-stu-id="c5567-168">Intel MPI 5</span></span><br/><br/><span data-ttu-id="c5567-169">HpcVMDrivers Azure VM extension</span><span class="sxs-lookup"><span data-stu-id="c5567-169">HpcVMDrivers Azure VM extension</span></span> | <span data-ttu-id="c5567-170">Enable inter-node communication, disable concurrent task execution</span><span class="sxs-lookup"><span data-stu-id="c5567-170">Enable inter-node communication, disable concurrent task execution</span></span> |
| [<span data-ttu-id="c5567-171">NC, NCv2, NCv3, ND series\*</span><span class="sxs-lookup"><span data-stu-id="c5567-171">NC, NCv2, NCv3, ND series\*</span></span>](../virtual-machines/windows/n-series-driver-setup.md) | <span data-ttu-id="c5567-172">NVIDIA Tesla GPU (varies by series)</span><span class="sxs-lookup"><span data-stu-id="c5567-172">NVIDIA Tesla GPU (varies by series)</span></span> | <span data-ttu-id="c5567-173">Windows Server 2016 or</span><span class="sxs-lookup"><span data-stu-id="c5567-173">Windows Server 2016 or</span></span> <br/><span data-ttu-id="c5567-174">2012 R2 (Azure Marketplace)</span><span class="sxs-lookup"><span data-stu-id="c5567-174">2012 R2 (Azure Marketplace)</span></span> | <span data-ttu-id="c5567-175">NVIDIA Tesla drivers or CUDA Toolkit drivers</span><span class="sxs-lookup"><span data-stu-id="c5567-175">NVIDIA Tesla drivers or CUDA Toolkit drivers</span></span>| <span data-ttu-id="c5567-176">N/A</span><span class="sxs-lookup"><span data-stu-id="c5567-176">N/A</span></span> | 
| [<span data-ttu-id="c5567-177">NV series</span><span class="sxs-lookup"><span data-stu-id="c5567-177">NV series</span></span>](../virtual-machines/windows/n-series-driver-setup.md) | <span data-ttu-id="c5567-178">NVIDIA Tesla M60 GPU</span><span class="sxs-lookup"><span data-stu-id="c5567-178">NVIDIA Tesla M60 GPU</span></span> | <span data-ttu-id="c5567-179">Windows Server 2016 or</span><span class="sxs-lookup"><span data-stu-id="c5567-179">Windows Server 2016 or</span></span><br/><span data-ttu-id="c5567-180">2012 R2 (Azure Marketplace)</span><span class="sxs-lookup"><span data-stu-id="c5567-180">2012 R2 (Azure Marketplace)</span></span> | <span data-ttu-id="c5567-181">NVIDIA GRID drivers</span><span class="sxs-lookup"><span data-stu-id="c5567-181">NVIDIA GRID drivers</span></span> | <span data-ttu-id="c5567-182">N/A</span><span class="sxs-lookup"><span data-stu-id="c5567-182">N/A</span></span> |

<span data-ttu-id="c5567-183">\*RDMA connectivity on RDMA-capable N-series VMs is supported on Windows Server 2016 or Windows Server 2012 R2 (from Azure Marketplace) with HpcVMDrivers extension and Microsoft MPI or Intel MPI.</span><span class="sxs-lookup"><span data-stu-id="c5567-183">\*RDMA connectivity on RDMA-capable N-series VMs is supported on Windows Server 2016 or Windows Server 2012 R2 (from Azure Marketplace) with HpcVMDrivers extension and Microsoft MPI or Intel MPI.</span></span>

### <a name="windows-pools---cloud-services-configuration"></a><span data-ttu-id="c5567-184">Windows pools - Cloud services configuration</span><span class="sxs-lookup"><span data-stu-id="c5567-184">Windows pools - Cloud services configuration</span></span>

> [!NOTE]
> <span data-ttu-id="c5567-185">N-series sizes are not supported in Batch pools with the Cloud Service configuration.</span><span class="sxs-lookup"><span data-stu-id="c5567-185">N-series sizes are not supported in Batch pools with the Cloud Service configuration.</span></span>
>

| <span data-ttu-id="c5567-186">Size</span><span class="sxs-lookup"><span data-stu-id="c5567-186">Size</span></span> | <span data-ttu-id="c5567-187">Capability</span><span class="sxs-lookup"><span data-stu-id="c5567-187">Capability</span></span> | <span data-ttu-id="c5567-188">Operating systems</span><span class="sxs-lookup"><span data-stu-id="c5567-188">Operating systems</span></span> | <span data-ttu-id="c5567-189">Required software</span><span class="sxs-lookup"><span data-stu-id="c5567-189">Required software</span></span> | <span data-ttu-id="c5567-190">Pool settings</span><span class="sxs-lookup"><span data-stu-id="c5567-190">Pool settings</span></span> |
| -------- | ------- | -------- | -------- | ----- |
| [<span data-ttu-id="c5567-191">H16r, H16mr, A8, A9</span><span class="sxs-lookup"><span data-stu-id="c5567-191">H16r, H16mr, A8, A9</span></span>](../virtual-machines/windows/sizes-hpc.md#rdma-capable-instances) | <span data-ttu-id="c5567-192">RDMA</span><span class="sxs-lookup"><span data-stu-id="c5567-192">RDMA</span></span> | <span data-ttu-id="c5567-193">Windows Server 2016, 2012 R2, 2012, or</span><span class="sxs-lookup"><span data-stu-id="c5567-193">Windows Server 2016, 2012 R2, 2012, or</span></span><br/><span data-ttu-id="c5567-194">2008 R2 (Guest OS family)</span><span class="sxs-lookup"><span data-stu-id="c5567-194">2008 R2 (Guest OS family)</span></span> | <span data-ttu-id="c5567-195">Microsoft MPI 2012 R2 or later, or</span><span class="sxs-lookup"><span data-stu-id="c5567-195">Microsoft MPI 2012 R2 or later, or</span></span><br/><span data-ttu-id="c5567-196">Intel MPI 5</span><span class="sxs-lookup"><span data-stu-id="c5567-196">Intel MPI 5</span></span><br/><br/><span data-ttu-id="c5567-197">HpcVMDrivers Azure VM extension</span><span class="sxs-lookup"><span data-stu-id="c5567-197">HpcVMDrivers Azure VM extension</span></span> | <span data-ttu-id="c5567-198">Enable inter-node communication,</span><span class="sxs-lookup"><span data-stu-id="c5567-198">Enable inter-node communication,</span></span><br/> <span data-ttu-id="c5567-199">disable concurrent task execution</span><span class="sxs-lookup"><span data-stu-id="c5567-199">disable concurrent task execution</span></span> |





## <a name="pool-configuration-options"></a><span data-ttu-id="c5567-200">Pool configuration options</span><span class="sxs-lookup"><span data-stu-id="c5567-200">Pool configuration options</span></span>

<span data-ttu-id="c5567-201">To configure a specialized VM size for your Batch pool, the Batch APIs and tools provide several options to install required software or drivers, including:</span><span class="sxs-lookup"><span data-stu-id="c5567-201">To configure a specialized VM size for your Batch pool, the Batch APIs and tools provide several options to install required software or drivers, including:</span></span>

* <span data-ttu-id="c5567-202">[Start task](batch-api-basics.md#start-task) - Upload an installation package as a resource file to an Azure storage account in the same region as the Batch account.</span><span class="sxs-lookup"><span data-stu-id="c5567-202">[Start task](batch-api-basics.md#start-task) - Upload an installation package as a resource file to an Azure storage account in the same region as the Batch account.</span></span> <span data-ttu-id="c5567-203">Create a start task command line to install the resource file silently when the pool starts.</span><span class="sxs-lookup"><span data-stu-id="c5567-203">Create a start task command line to install the resource file silently when the pool starts.</span></span> <span data-ttu-id="c5567-204">For more information, see the [REST API documentation](/rest/api/batchservice/add-a-pool-to-an-account#bk_starttask).</span><span class="sxs-lookup"><span data-stu-id="c5567-204">For more information, see the [REST API documentation](/rest/api/batchservice/add-a-pool-to-an-account#bk_starttask).</span></span>

  > [!NOTE] 
  > <span data-ttu-id="c5567-205">The start task must run with elevated (admin) permissions, and it must wait for success.</span><span class="sxs-lookup"><span data-stu-id="c5567-205">The start task must run with elevated (admin) permissions, and it must wait for success.</span></span>
  >

* <span data-ttu-id="c5567-206">[Application package](batch-application-packages.md) - Add a zipped installation package to your Batch account, and configure a package reference in the pool.</span><span class="sxs-lookup"><span data-stu-id="c5567-206">[Application package](batch-application-packages.md) - Add a zipped installation package to your Batch account, and configure a package reference in the pool.</span></span> <span data-ttu-id="c5567-207">This setting uploads and unzips the package on all nodes in the pool.</span><span class="sxs-lookup"><span data-stu-id="c5567-207">This setting uploads and unzips the package on all nodes in the pool.</span></span> <span data-ttu-id="c5567-208">If the package is an installer, create a start task command line to silently install the app on all pool nodes.</span><span class="sxs-lookup"><span data-stu-id="c5567-208">If the package is an installer, create a start task command line to silently install the app on all pool nodes.</span></span> <span data-ttu-id="c5567-209">Optionally, install the package when a task is scheduled to run on a node.</span><span class="sxs-lookup"><span data-stu-id="c5567-209">Optionally, install the package when a task is scheduled to run on a node.</span></span>

* <span data-ttu-id="c5567-210">[Custom pool image](batch-custom-images.md) - Create a custom Windows or Linux VM image that contains drivers, software, or other settings required for the VM size.</span><span class="sxs-lookup"><span data-stu-id="c5567-210">[Custom pool image](batch-custom-images.md) - Create a custom Windows or Linux VM image that contains drivers, software, or other settings required for the VM size.</span></span> 

* <span data-ttu-id="c5567-211">[Batch Shipyard](https://github.com/Azure/batch-shipyard) automatically configures the GPU and RDMA to work transparently with containerized workloads on Azure Batch.</span><span class="sxs-lookup"><span data-stu-id="c5567-211">[Batch Shipyard](https://github.com/Azure/batch-shipyard) automatically configures the GPU and RDMA to work transparently with containerized workloads on Azure Batch.</span></span> <span data-ttu-id="c5567-212">Batch Shipyard is entirely driven with configuration files.</span><span class="sxs-lookup"><span data-stu-id="c5567-212">Batch Shipyard is entirely driven with configuration files.</span></span> <span data-ttu-id="c5567-213">There are many sample recipe configurations available that enable GPU and RDMA workloads such as the [CNTK GPU Recipe](https://github.com/Azure/batch-shipyard/tree/master/recipes/CNTK-GPU-OpenMPI)  which preconfigures GPU drivers on N-series VMs and loads Microsoft Cognitive Toolkit software as a Docker image.</span><span class="sxs-lookup"><span data-stu-id="c5567-213">There are many sample recipe configurations available that enable GPU and RDMA workloads such as the [CNTK GPU Recipe](https://github.com/Azure/batch-shipyard/tree/master/recipes/CNTK-GPU-OpenMPI)  which preconfigures GPU drivers on N-series VMs and loads Microsoft Cognitive Toolkit software as a Docker image.</span></span>


## <a name="example-microsoft-mpi-on-an-a8-vm-pool"></a><span data-ttu-id="c5567-214">Example: Microsoft MPI on an A8 VM pool</span><span class="sxs-lookup"><span data-stu-id="c5567-214">Example: Microsoft MPI on an A8 VM pool</span></span>

<span data-ttu-id="c5567-215">To run Windows MPI applications on a pool of Azure A8 nodes, you need to install a supported MPI implementation.</span><span class="sxs-lookup"><span data-stu-id="c5567-215">To run Windows MPI applications on a pool of Azure A8 nodes, you need to install a supported MPI implementation.</span></span> <span data-ttu-id="c5567-216">Here are sample steps to install [Microsoft MPI](https://msdn.microsoft.com/library/bb524831(v=vs.85).aspx) on a Windows pool using a Batch application package.</span><span class="sxs-lookup"><span data-stu-id="c5567-216">Here are sample steps to install [Microsoft MPI](https://msdn.microsoft.com/library/bb524831(v=vs.85).aspx) on a Windows pool using a Batch application package.</span></span>

1. <span data-ttu-id="c5567-217">Download the [setup package](http://go.microsoft.com/FWLink/p/?LinkID=389556) (MSMpiSetup.exe) for the latest version of Microsoft MPI.</span><span class="sxs-lookup"><span data-stu-id="c5567-217">Download the [setup package](http://go.microsoft.com/FWLink/p/?LinkID=389556) (MSMpiSetup.exe) for the latest version of Microsoft MPI.</span></span>
2. <span data-ttu-id="c5567-218">Create a zip file of the package.</span><span class="sxs-lookup"><span data-stu-id="c5567-218">Create a zip file of the package.</span></span>
3. <span data-ttu-id="c5567-219">Upload the package to your Batch account.</span><span class="sxs-lookup"><span data-stu-id="c5567-219">Upload the package to your Batch account.</span></span> <span data-ttu-id="c5567-220">For steps, see the [application packages](batch-application-packages.md) guidance.</span><span class="sxs-lookup"><span data-stu-id="c5567-220">For steps, see the [application packages](batch-application-packages.md) guidance.</span></span> <span data-ttu-id="c5567-221">Specify an application id such as *MSMPI*, and a version such as *8.1*.</span><span class="sxs-lookup"><span data-stu-id="c5567-221">Specify an application id such as *MSMPI*, and a version such as *8.1*.</span></span> 
4. <span data-ttu-id="c5567-222">Using the Batch APIs or Azure portal, create a pool in the cloud services configuration with the desired number of nodes and scale.</span><span class="sxs-lookup"><span data-stu-id="c5567-222">Using the Batch APIs or Azure portal, create a pool in the cloud services configuration with the desired number of nodes and scale.</span></span> <span data-ttu-id="c5567-223">The following table shows sample settings to set up MPI in unattended mode using a start task:</span><span class="sxs-lookup"><span data-stu-id="c5567-223">The following table shows sample settings to set up MPI in unattended mode using a start task:</span></span>

| <span data-ttu-id="c5567-224">Setting</span><span class="sxs-lookup"><span data-stu-id="c5567-224">Setting</span></span> | <span data-ttu-id="c5567-225">Value</span><span class="sxs-lookup"><span data-stu-id="c5567-225">Value</span></span> |
| ---- | ----- | 
| <span data-ttu-id="c5567-226">**Image Type**</span><span class="sxs-lookup"><span data-stu-id="c5567-226">**Image Type**</span></span> | <span data-ttu-id="c5567-227">Cloud Services</span><span class="sxs-lookup"><span data-stu-id="c5567-227">Cloud Services</span></span> |
| <span data-ttu-id="c5567-228">**OS family**</span><span class="sxs-lookup"><span data-stu-id="c5567-228">**OS family**</span></span> | <span data-ttu-id="c5567-229">Windows Server 2012 R2 (OS family 4)</span><span class="sxs-lookup"><span data-stu-id="c5567-229">Windows Server 2012 R2 (OS family 4)</span></span> |
| <span data-ttu-id="c5567-230">**Node size**</span><span class="sxs-lookup"><span data-stu-id="c5567-230">**Node size**</span></span> | <span data-ttu-id="c5567-231">A8 Standard</span><span class="sxs-lookup"><span data-stu-id="c5567-231">A8 Standard</span></span> |
| <span data-ttu-id="c5567-232">**Internode communication enabled**</span><span class="sxs-lookup"><span data-stu-id="c5567-232">**Internode communication enabled**</span></span> | <span data-ttu-id="c5567-233">True</span><span class="sxs-lookup"><span data-stu-id="c5567-233">True</span></span> |
| <span data-ttu-id="c5567-234">**Max tasks per node**</span><span class="sxs-lookup"><span data-stu-id="c5567-234">**Max tasks per node**</span></span> | <span data-ttu-id="c5567-235">1</span><span class="sxs-lookup"><span data-stu-id="c5567-235">1</span></span> |
| <span data-ttu-id="c5567-236">**Application package references**</span><span class="sxs-lookup"><span data-stu-id="c5567-236">**Application package references**</span></span> | <span data-ttu-id="c5567-237">MSMPI</span><span class="sxs-lookup"><span data-stu-id="c5567-237">MSMPI</span></span> |
| <span data-ttu-id="c5567-238">**Start task enabled**</span><span class="sxs-lookup"><span data-stu-id="c5567-238">**Start task enabled**</span></span> | <span data-ttu-id="c5567-239">True</span><span class="sxs-lookup"><span data-stu-id="c5567-239">True</span></span><br><span data-ttu-id="c5567-240">**Command line** - `"cmd /c %AZ_BATCH_APP_PACKAGE_MSMPI#8.1%\\MSMpiSetup.exe -unattend -force"`</span><span class="sxs-lookup"><span data-stu-id="c5567-240">**Command line** - `"cmd /c %AZ_BATCH_APP_PACKAGE_MSMPI#8.1%\\MSMpiSetup.exe -unattend -force"`</span></span><br/><span data-ttu-id="c5567-241">**User identity** - Pool autouser, admin</span><span class="sxs-lookup"><span data-stu-id="c5567-241">**User identity** - Pool autouser, admin</span></span><br/><span data-ttu-id="c5567-242">**Wait for success** - True</span><span class="sxs-lookup"><span data-stu-id="c5567-242">**Wait for success** - True</span></span>

## <a name="example-nvidia-tesla-drivers-on-nc-vm-pool"></a><span data-ttu-id="c5567-243">Example: NVIDIA Tesla drivers on NC VM pool</span><span class="sxs-lookup"><span data-stu-id="c5567-243">Example: NVIDIA Tesla drivers on NC VM pool</span></span>

<span data-ttu-id="c5567-244">To run CUDA applications on a pool of Linux NC nodes, you need to install CUDA Toolkit 9.0 on the nodes.</span><span class="sxs-lookup"><span data-stu-id="c5567-244">To run CUDA applications on a pool of Linux NC nodes, you need to install CUDA Toolkit 9.0 on the nodes.</span></span> <span data-ttu-id="c5567-245">The Toolkit installs the necessary NVIDIA Tesla GPU drivers.</span><span class="sxs-lookup"><span data-stu-id="c5567-245">The Toolkit installs the necessary NVIDIA Tesla GPU drivers.</span></span> <span data-ttu-id="c5567-246">Here are sample steps to deploy a custom Ubuntu 16.04 LTS image with the GPU drivers:</span><span class="sxs-lookup"><span data-stu-id="c5567-246">Here are sample steps to deploy a custom Ubuntu 16.04 LTS image with the GPU drivers:</span></span>

1. <span data-ttu-id="c5567-247">Deploy an Azure NC-series VM running Ubuntu 16.04 LTS.</span><span class="sxs-lookup"><span data-stu-id="c5567-247">Deploy an Azure NC-series VM running Ubuntu 16.04 LTS.</span></span> <span data-ttu-id="c5567-248">For example, create the VM in the US South Central region.</span><span class="sxs-lookup"><span data-stu-id="c5567-248">For example, create the VM in the US South Central region.</span></span> <span data-ttu-id="c5567-249">Make sure that you create the VM with a managed disk.</span><span class="sxs-lookup"><span data-stu-id="c5567-249">Make sure that you create the VM with a managed disk.</span></span>
2. <span data-ttu-id="c5567-250">Follow the steps to connect to the VM and [install CUDA drivers](../virtual-machines/linux/n-series-driver-setup.md).</span><span class="sxs-lookup"><span data-stu-id="c5567-250">Follow the steps to connect to the VM and [install CUDA drivers](../virtual-machines/linux/n-series-driver-setup.md).</span></span>
3. <span data-ttu-id="c5567-251">Deprovision the Linux agent, and then [capture the Linux VM image](../virtual-machines/linux/capture-image.md).</span><span class="sxs-lookup"><span data-stu-id="c5567-251">Deprovision the Linux agent, and then [capture the Linux VM image](../virtual-machines/linux/capture-image.md).</span></span>
4. <span data-ttu-id="c5567-252">Create a Batch account in a region that supports NC VMs.</span><span class="sxs-lookup"><span data-stu-id="c5567-252">Create a Batch account in a region that supports NC VMs.</span></span>
5. <span data-ttu-id="c5567-253">Using the Batch APIs or Azure portal, create a pool [using the custom image](batch-custom-images.md) and with the desired number of nodes and scale.</span><span class="sxs-lookup"><span data-stu-id="c5567-253">Using the Batch APIs or Azure portal, create a pool [using the custom image](batch-custom-images.md) and with the desired number of nodes and scale.</span></span> <span data-ttu-id="c5567-254">The following table shows sample pool settings for the image:</span><span class="sxs-lookup"><span data-stu-id="c5567-254">The following table shows sample pool settings for the image:</span></span>

| <span data-ttu-id="c5567-255">Setting</span><span class="sxs-lookup"><span data-stu-id="c5567-255">Setting</span></span> | <span data-ttu-id="c5567-256">Value</span><span class="sxs-lookup"><span data-stu-id="c5567-256">Value</span></span> |
| ---- | ---- |
| <span data-ttu-id="c5567-257">**Image Type**</span><span class="sxs-lookup"><span data-stu-id="c5567-257">**Image Type**</span></span> | <span data-ttu-id="c5567-258">Custom Image</span><span class="sxs-lookup"><span data-stu-id="c5567-258">Custom Image</span></span> |
| <span data-ttu-id="c5567-259">**Custom Image**</span><span class="sxs-lookup"><span data-stu-id="c5567-259">**Custom Image**</span></span> | <span data-ttu-id="c5567-260">Name of the image</span><span class="sxs-lookup"><span data-stu-id="c5567-260">Name of the image</span></span> |
| <span data-ttu-id="c5567-261">**Node agent SKU**</span><span class="sxs-lookup"><span data-stu-id="c5567-261">**Node agent SKU**</span></span> | <span data-ttu-id="c5567-262">batch.node.ubuntu 16.04</span><span class="sxs-lookup"><span data-stu-id="c5567-262">batch.node.ubuntu 16.04</span></span> |
| <span data-ttu-id="c5567-263">**Node size**</span><span class="sxs-lookup"><span data-stu-id="c5567-263">**Node size**</span></span> | <span data-ttu-id="c5567-264">NC6 Standard</span><span class="sxs-lookup"><span data-stu-id="c5567-264">NC6 Standard</span></span> |



## <a name="next-steps"></a><span data-ttu-id="c5567-265">Next steps</span><span class="sxs-lookup"><span data-stu-id="c5567-265">Next steps</span></span>

* <span data-ttu-id="c5567-266">To run MPI jobs on an Azure Batch pool, see the [Windows](batch-mpi.md) or [Linux](https://blogs.technet.microsoft.com/windowshpc/2016/07/20/introducing-mpi-support-for-linux-on-azure-batch/) examples.</span><span class="sxs-lookup"><span data-stu-id="c5567-266">To run MPI jobs on an Azure Batch pool, see the [Windows](batch-mpi.md) or [Linux](https://blogs.technet.microsoft.com/windowshpc/2016/07/20/introducing-mpi-support-for-linux-on-azure-batch/) examples.</span></span>

* <span data-ttu-id="c5567-267">For examples of GPU workloads on Batch, see the [Batch Shipyard](https://github.com/Azure/batch-shipyard/) recipes.</span><span class="sxs-lookup"><span data-stu-id="c5567-267">For examples of GPU workloads on Batch, see the [Batch Shipyard](https://github.com/Azure/batch-shipyard/) recipes.</span></span>