---
title: Azure billing and cost management budget scenario | Microsoft Docs
description: Learn how to use Azure automatation to shut down VMs based on specific budget thresholds.
services: billing
documentationcenter: ''
author: Erikre
manager: dougeby
editor: ''
tags: billing
ms.assetid: db93f546-6b56-4b51-960d-1a5bf0274fc8
ms.service: billing
ms.devlang: na
ms.topic: reference
ms.tgt_pltfrm: na
ms.workload: billing
ms.date: 7/25/2018
ms.author: erikre
ms.openlocfilehash: 19d8fbf82410136fd6a50a2088dd9b774dd6cb27
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44870848"
---
# <a name="manage-costs-with-azure-budgets"></a><span data-ttu-id="e4096-103">Manage costs with Azure Budgets</span><span class="sxs-lookup"><span data-stu-id="e4096-103">Manage costs with Azure Budgets</span></span>

<span data-ttu-id="e4096-104">Cost control is a critical component to maximizing the value of your investment in the cloud.</span><span class="sxs-lookup"><span data-stu-id="e4096-104">Cost control is a critical component to maximizing the value of your investment in the cloud.</span></span> <span data-ttu-id="e4096-105">There are several scenarios where cost visibility, reporting, and cost-based orchestration are critical to continued business operations.</span><span class="sxs-lookup"><span data-stu-id="e4096-105">There are several scenarios where cost visibility, reporting, and cost-based orchestration are critical to continued business operations.</span></span> <span data-ttu-id="e4096-106">[Azure Cost Management APIs](https://docs.microsoft.com/rest/api/consumption/) provide a set of APIs to support each of these scenarios.</span><span class="sxs-lookup"><span data-stu-id="e4096-106">[Azure Cost Management APIs](https://docs.microsoft.com/rest/api/consumption/) provide a set of APIs to support each of these scenarios.</span></span> <span data-ttu-id="e4096-107">The APIs provide usage details, allowing you to view granular instance level costs.</span><span class="sxs-lookup"><span data-stu-id="e4096-107">The APIs provide usage details, allowing you to view granular instance level costs.</span></span>

<span data-ttu-id="e4096-108">Budgets are commonly used as part of cost control.</span><span class="sxs-lookup"><span data-stu-id="e4096-108">Budgets are commonly used as part of cost control.</span></span> <span data-ttu-id="e4096-109">Budgets can be scoped in Azure.</span><span class="sxs-lookup"><span data-stu-id="e4096-109">Budgets can be scoped in Azure.</span></span> <span data-ttu-id="e4096-110">For instance, you could narrow your budget view based on subscription, resource groups, or a collection of resources.</span><span class="sxs-lookup"><span data-stu-id="e4096-110">For instance, you could narrow your budget view based on subscription, resource groups, or a collection of resources.</span></span> <span data-ttu-id="e4096-111">In addition to using the budgets API to notify you via email when a budget threshold is reached, you can use [Azure Monitor action groups](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-action-groups) to trigger an orchestrated set of actions as a result of a budget event.</span><span class="sxs-lookup"><span data-stu-id="e4096-111">In addition to using the budgets API to notify you via email when a budget threshold is reached, you can use [Azure Monitor action groups](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-action-groups) to trigger an orchestrated set of actions as a result of a budget event.</span></span>

<span data-ttu-id="e4096-112">A common budgets scenario for a customer running a non-critical workload could occur when they want to manage against a budget and also get to a predictable cost when looking at the monthly invoice.</span><span class="sxs-lookup"><span data-stu-id="e4096-112">A common budgets scenario for a customer running a non-critical workload could occur when they want to manage against a budget and also get to a predictable cost when looking at the monthly invoice.</span></span> <span data-ttu-id="e4096-113">This scenario requires some cost-based orchestration of resources that are part of the Azure environment.</span><span class="sxs-lookup"><span data-stu-id="e4096-113">This scenario requires some cost-based orchestration of resources that are part of the Azure environment.</span></span> <span data-ttu-id="e4096-114">In this scenario, a monthly budget of $1000 for the subscription is set.</span><span class="sxs-lookup"><span data-stu-id="e4096-114">In this scenario, a monthly budget of $1000 for the subscription is set.</span></span> <span data-ttu-id="e4096-115">Also, notification thresholds are set to trigger a few orchestrations.</span><span class="sxs-lookup"><span data-stu-id="e4096-115">Also, notification thresholds are set to trigger a few orchestrations.</span></span> <span data-ttu-id="e4096-116">This scenario starts with an 80% cost threshold, which will stop all VMs in the resource group **Optional**.</span><span class="sxs-lookup"><span data-stu-id="e4096-116">This scenario starts with an 80% cost threshold, which will stop all VMs in the resource group **Optional**.</span></span> <span data-ttu-id="e4096-117">Then, at the 100% cost threshold, all VM instances will be stopped.</span><span class="sxs-lookup"><span data-stu-id="e4096-117">Then, at the 100% cost threshold, all VM instances will be stopped.</span></span>
<span data-ttu-id="e4096-118">To configure this scenario, you will complete the following actions by following the steps provided in each section of this tutorial.</span><span class="sxs-lookup"><span data-stu-id="e4096-118">To configure this scenario, you will complete the following actions by following the steps provided in each section of this tutorial.</span></span> 

<span data-ttu-id="e4096-119">These actions included in this tutorial allow you to:</span><span class="sxs-lookup"><span data-stu-id="e4096-119">These actions included in this tutorial allow you to:</span></span>

- <span data-ttu-id="e4096-120">Create an Azure Automation Runbook to stop VMs by using webhooks.</span><span class="sxs-lookup"><span data-stu-id="e4096-120">Create an Azure Automation Runbook to stop VMs by using webhooks.</span></span>
- <span data-ttu-id="e4096-121">Create an Azure Logic App to be triggered based on the budget threshold value and call the runbook with the right parameters.</span><span class="sxs-lookup"><span data-stu-id="e4096-121">Create an Azure Logic App to be triggered based on the budget threshold value and call the runbook with the right parameters.</span></span>
- <span data-ttu-id="e4096-122">Create an Azure Monitor Action Group that will be configured to trigger the Azure Logic App when the budget threshold is met.</span><span class="sxs-lookup"><span data-stu-id="e4096-122">Create an Azure Monitor Action Group that will be configured to trigger the Azure Logic App when the budget threshold is met.</span></span>
- <span data-ttu-id="e4096-123">Create the Azure budget with the desired thresholds and wire it to the action group.</span><span class="sxs-lookup"><span data-stu-id="e4096-123">Create the Azure budget with the desired thresholds and wire it to the action group.</span></span>

## <a name="create-an-azure-automation-runbook"></a><span data-ttu-id="e4096-124">Create an Azure Automation Runbook</span><span class="sxs-lookup"><span data-stu-id="e4096-124">Create an Azure Automation Runbook</span></span>

<span data-ttu-id="e4096-125">[Azure Automation](https://docs.microsoft.com/azure/automation/automation-intro) is a service that enables you to script most of your resource management tasks and run those tasks as either scheduled or on-demand.</span><span class="sxs-lookup"><span data-stu-id="e4096-125">[Azure Automation](https://docs.microsoft.com/azure/automation/automation-intro) is a service that enables you to script most of your resource management tasks and run those tasks as either scheduled or on-demand.</span></span> <span data-ttu-id="e4096-126">As part of this scenario, you will create an [Azure Automation runbook](https://docs.microsoft.com/azure/automation/automation-runbook-types) that will be used to stop VMs.</span><span class="sxs-lookup"><span data-stu-id="e4096-126">As part of this scenario, you will create an [Azure Automation runbook](https://docs.microsoft.com/azure/automation/automation-runbook-types) that will be used to stop VMs.</span></span> <span data-ttu-id="e4096-127">You will use the [Stop Azure V2 VMs](https://gallery.technet.microsoft.com/scriptcenter/Stop-Azure-ARM-VMs-1ba96d5b) graphical runbook from the [gallery](https://docs.microsoft.com/azure/automation/automation-runbook-gallery) to build this scenario.</span><span class="sxs-lookup"><span data-stu-id="e4096-127">You will use the [Stop Azure V2 VMs](https://gallery.technet.microsoft.com/scriptcenter/Stop-Azure-ARM-VMs-1ba96d5b) graphical runbook from the [gallery](https://docs.microsoft.com/azure/automation/automation-runbook-gallery) to build this scenario.</span></span> <span data-ttu-id="e4096-128">By importing this runbook into your Azure account and publishing it, you will be able to stop VMs when a budget threshold is reached.</span><span class="sxs-lookup"><span data-stu-id="e4096-128">By importing this runbook into your Azure account and publishing it, you will be able to stop VMs when a budget threshold is reached.</span></span> 

### <a name="create-an-azure-automation-account"></a><span data-ttu-id="e4096-129">Create an Azure Automation account</span><span class="sxs-lookup"><span data-stu-id="e4096-129">Create an Azure Automation account</span></span>

1.  <span data-ttu-id="e4096-130">Sign in to the [Azure portal](https://portal.azure.com/) with your Azure account credentials.</span><span class="sxs-lookup"><span data-stu-id="e4096-130">Sign in to the [Azure portal](https://portal.azure.com/) with your Azure account credentials.</span></span>
2.  <span data-ttu-id="e4096-131">Click the **Create a resource** button found on the upper left corner of Azure.</span><span class="sxs-lookup"><span data-stu-id="e4096-131">Click the **Create a resource** button found on the upper left corner of Azure.</span></span>
3.  <span data-ttu-id="e4096-132">Select **Management Tools** > **Automation**.</span><span class="sxs-lookup"><span data-stu-id="e4096-132">Select **Management Tools** > **Automation**.</span></span>
    > [!NOTE]
    > <span data-ttu-id="e4096-133">If you don’t have an Azure account, you can create a [free account](https://azure.microsoft.com/free/).</span><span class="sxs-lookup"><span data-stu-id="e4096-133">If you don’t have an Azure account, you can create a [free account](https://azure.microsoft.com/free/).</span></span>
4.  <span data-ttu-id="e4096-134">Enter your account information.</span><span class="sxs-lookup"><span data-stu-id="e4096-134">Enter your account information.</span></span> <span data-ttu-id="e4096-135">For **Create Azure Run As account**, choose **Yes** to automatically enable the settings needed to simplify authentication to Azure.</span><span class="sxs-lookup"><span data-stu-id="e4096-135">For **Create Azure Run As account**, choose **Yes** to automatically enable the settings needed to simplify authentication to Azure.</span></span>
5.  <span data-ttu-id="e4096-136">When complete, click **Create**, to start the Automation account deployment.</span><span class="sxs-lookup"><span data-stu-id="e4096-136">When complete, click **Create**, to start the Automation account deployment.</span></span>

### <a name="import-the-stop-azure-v2-vms-runbook"></a><span data-ttu-id="e4096-137">Import the Stop Azure V2 VMs runbook</span><span class="sxs-lookup"><span data-stu-id="e4096-137">Import the Stop Azure V2 VMs runbook</span></span>

<span data-ttu-id="e4096-138">Using an [Azure Automation runbook](https://docs.microsoft.com/azure/automation/automation-runbook-types), import the [Stop Azure V2 VMs](https://gallery.technet.microsoft.com/scriptcenter/Stop-Azure-ARM-VMs-1ba96d5b) graphical runbook from the gallery.</span><span class="sxs-lookup"><span data-stu-id="e4096-138">Using an [Azure Automation runbook](https://docs.microsoft.com/azure/automation/automation-runbook-types), import the [Stop Azure V2 VMs](https://gallery.technet.microsoft.com/scriptcenter/Stop-Azure-ARM-VMs-1ba96d5b) graphical runbook from the gallery.</span></span>

1.  <span data-ttu-id="e4096-139">Sign in to the [Azure portal](https://portal.azure.com/) with your Azure account credentials.</span><span class="sxs-lookup"><span data-stu-id="e4096-139">Sign in to the [Azure portal](https://portal.azure.com/) with your Azure account credentials.</span></span>
2.  <span data-ttu-id="e4096-140">Open your Automation account by selecting **All services** > **Automation Accounts**.</span><span class="sxs-lookup"><span data-stu-id="e4096-140">Open your Automation account by selecting **All services** > **Automation Accounts**.</span></span> <span data-ttu-id="e4096-141">Then, select your Automation Account.</span><span class="sxs-lookup"><span data-stu-id="e4096-141">Then, select your Automation Account.</span></span>
3.  <span data-ttu-id="e4096-142">Click **Runbooks gallery** from the **Process Automation** section.</span><span class="sxs-lookup"><span data-stu-id="e4096-142">Click **Runbooks gallery** from the **Process Automation** section.</span></span>
4.  <span data-ttu-id="e4096-143">Set the **Gallery Source** to **Script Center** and select **OK**.</span><span class="sxs-lookup"><span data-stu-id="e4096-143">Set the **Gallery Source** to **Script Center** and select **OK**.</span></span>
5.  <span data-ttu-id="e4096-144">Locate and select the [Stop Azure V2 VMs](https://gallery.technet.microsoft.com/scriptcenter/Stop-Azure-ARM-VMs-1ba96d5b) gallery item within the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="e4096-144">Locate and select the [Stop Azure V2 VMs](https://gallery.technet.microsoft.com/scriptcenter/Stop-Azure-ARM-VMs-1ba96d5b) gallery item within the Azure portal.</span></span>
6.  <span data-ttu-id="e4096-145">Click the **Import** button to display the **Import** blade and select **OK**.</span><span class="sxs-lookup"><span data-stu-id="e4096-145">Click the **Import** button to display the **Import** blade and select **OK**.</span></span> <span data-ttu-id="e4096-146">The runbook overview blade will be displayed.</span><span class="sxs-lookup"><span data-stu-id="e4096-146">The runbook overview blade will be displayed.</span></span>
7.  <span data-ttu-id="e4096-147">Once the runbook has completed the import process, select **Edit** to display the graphical runbook editor and publishing option.</span><span class="sxs-lookup"><span data-stu-id="e4096-147">Once the runbook has completed the import process, select **Edit** to display the graphical runbook editor and publishing option.</span></span>
    
    ![Azure - Edit graphical runbook](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-01.png)
8.  <span data-ttu-id="e4096-149">Click the **Publish** button to publish the runbook and then select **Yes** when prompted.</span><span class="sxs-lookup"><span data-stu-id="e4096-149">Click the **Publish** button to publish the runbook and then select **Yes** when prompted.</span></span> <span data-ttu-id="e4096-150">When you publish a runbook, you override any existing published version with the draft version.</span><span class="sxs-lookup"><span data-stu-id="e4096-150">When you publish a runbook, you override any existing published version with the draft version.</span></span> <span data-ttu-id="e4096-151">In this case, you have no published version because you have created the runbook.</span><span class="sxs-lookup"><span data-stu-id="e4096-151">In this case, you have no published version because you have created the runbook.</span></span> 

    <span data-ttu-id="e4096-152">For more information about publishing a runbook, see [Create a graphical runbook](https://docs.microsoft.com/azure/automation/automation-first-runbook-graphical).</span><span class="sxs-lookup"><span data-stu-id="e4096-152">For more information about publishing a runbook, see [Create a graphical runbook](https://docs.microsoft.com/azure/automation/automation-first-runbook-graphical).</span></span>

## <a name="create-webhooks-for-the-runbook"></a><span data-ttu-id="e4096-153">Create webhooks for the runbook</span><span class="sxs-lookup"><span data-stu-id="e4096-153">Create webhooks for the runbook</span></span>

<span data-ttu-id="e4096-154">Using the [Stop Azure V2 VMs](https://gallery.technet.microsoft.com/scriptcenter/Stop-Azure-ARM-VMs-1ba96d5b) graphical runbook, you will create two Webhooks to start the runbook in Azure Automation through a single HTTP request.</span><span class="sxs-lookup"><span data-stu-id="e4096-154">Using the [Stop Azure V2 VMs](https://gallery.technet.microsoft.com/scriptcenter/Stop-Azure-ARM-VMs-1ba96d5b) graphical runbook, you will create two Webhooks to start the runbook in Azure Automation through a single HTTP request.</span></span> <span data-ttu-id="e4096-155">The first webhook will invoke the runbook at an 80% budget threshold with the resource group name as a parameter, allowing the optional VMs to be stopped.</span><span class="sxs-lookup"><span data-stu-id="e4096-155">The first webhook will invoke the runbook at an 80% budget threshold with the resource group name as a parameter, allowing the optional VMs to be stopped.</span></span> <span data-ttu-id="e4096-156">Then, second webhook will invoke the runbook with no parameters (at 100%), which will stop all remaining VM instances.</span><span class="sxs-lookup"><span data-stu-id="e4096-156">Then, second webhook will invoke the runbook with no parameters (at 100%), which will stop all remaining VM instances.</span></span>

1.  <span data-ttu-id="e4096-157">From the **Runbooks** page in the [Azure portal](https://portal.azure.com/), click the **StopAzureV2Vm** runbook that displays the runbook’s overview blade.</span><span class="sxs-lookup"><span data-stu-id="e4096-157">From the **Runbooks** page in the [Azure portal](https://portal.azure.com/), click the **StopAzureV2Vm** runbook that displays the runbook’s overview blade.</span></span> 
2.  <span data-ttu-id="e4096-158">Click **Webhook** at the top of the page to open the **Add Webhook** blade.</span><span class="sxs-lookup"><span data-stu-id="e4096-158">Click **Webhook** at the top of the page to open the **Add Webhook** blade.</span></span>
3.  <span data-ttu-id="e4096-159">Click **Create new webhook** to open the **Create a new webhook** blade.</span><span class="sxs-lookup"><span data-stu-id="e4096-159">Click **Create new webhook** to open the **Create a new webhook** blade.</span></span>
4.  <span data-ttu-id="e4096-160">Set the **Name** of the Webhook to **Optional**.</span><span class="sxs-lookup"><span data-stu-id="e4096-160">Set the **Name** of the Webhook to **Optional**.</span></span> <span data-ttu-id="e4096-161">The **Enabled** property must be **Yes**.</span><span class="sxs-lookup"><span data-stu-id="e4096-161">The **Enabled** property must be **Yes**.</span></span> <span data-ttu-id="e4096-162">The **Expires** value does not need to be changed.</span><span class="sxs-lookup"><span data-stu-id="e4096-162">The **Expires** value does not need to be changed.</span></span> <span data-ttu-id="e4096-163">For more information about Webhook properties, see [Details of a webhook](https://docs.microsoft.com/azure/automation/automation-webhooks#details-of-a-webhook).</span><span class="sxs-lookup"><span data-stu-id="e4096-163">For more information about Webhook properties, see [Details of a webhook](https://docs.microsoft.com/azure/automation/automation-webhooks#details-of-a-webhook).</span></span>
5.  <span data-ttu-id="e4096-164">Next to the URL value, click the copy icon to copy the URL of the webhook.</span><span class="sxs-lookup"><span data-stu-id="e4096-164">Next to the URL value, click the copy icon to copy the URL of the webhook.</span></span> 
    > [!IMPORTANT]
    > <span data-ttu-id="e4096-165">Save the URL of the webhook named **Optional** in a safe place.</span><span class="sxs-lookup"><span data-stu-id="e4096-165">Save the URL of the webhook named **Optional** in a safe place.</span></span> <span data-ttu-id="e4096-166">You will use the URL later in this tutorial.</span><span class="sxs-lookup"><span data-stu-id="e4096-166">You will use the URL later in this tutorial.</span></span> <span data-ttu-id="e4096-167">For security reasons, once you create the webhook, you cannot view or retrieve the URL again.</span><span class="sxs-lookup"><span data-stu-id="e4096-167">For security reasons, once you create the webhook, you cannot view or retrieve the URL again.</span></span>
6.  <span data-ttu-id="e4096-168">Click **OK** to create the new webhook.</span><span class="sxs-lookup"><span data-stu-id="e4096-168">Click **OK** to create the new webhook.</span></span>
7.  <span data-ttu-id="e4096-169">Click **Configure parameters and run settings** to view parameter values for the runbook.</span><span class="sxs-lookup"><span data-stu-id="e4096-169">Click **Configure parameters and run settings** to view parameter values for the runbook.</span></span> 
    > [!NOTE]
    > <span data-ttu-id="e4096-170">If the runbook has mandatory parameters, then you are not able to create the webhook unless values are provided.</span><span class="sxs-lookup"><span data-stu-id="e4096-170">If the runbook has mandatory parameters, then you are not able to create the webhook unless values are provided.</span></span>
8.  <span data-ttu-id="e4096-171">Click **OK** to accept the webhook parameter values.</span><span class="sxs-lookup"><span data-stu-id="e4096-171">Click **OK** to accept the webhook parameter values.</span></span>
9.  <span data-ttu-id="e4096-172">Click **Create** to create the webhook.</span><span class="sxs-lookup"><span data-stu-id="e4096-172">Click **Create** to create the webhook.</span></span>
10. <span data-ttu-id="e4096-173">Next, follow the steps above to create a second webhook named **Complete**.</span><span class="sxs-lookup"><span data-stu-id="e4096-173">Next, follow the steps above to create a second webhook named **Complete**.</span></span> 
    > [!IMPORTANT]
    > <span data-ttu-id="e4096-174">Be sure to save both webhook URLs to use later in this tutorial.</span><span class="sxs-lookup"><span data-stu-id="e4096-174">Be sure to save both webhook URLs to use later in this tutorial.</span></span> <span data-ttu-id="e4096-175">For security reasons, once you create the webhook, you cannot view or retrieve the URL again.</span><span class="sxs-lookup"><span data-stu-id="e4096-175">For security reasons, once you create the webhook, you cannot view or retrieve the URL again.</span></span>

<span data-ttu-id="e4096-176">You should now have two configured webhooks that are each available using the URLs that you saved.</span><span class="sxs-lookup"><span data-stu-id="e4096-176">You should now have two configured webhooks that are each available using the URLs that you saved.</span></span> 

![Webhooks - Optional and Complete](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-02.png)

<span data-ttu-id="e4096-178">You’re now done with the Azure Automation setup.</span><span class="sxs-lookup"><span data-stu-id="e4096-178">You’re now done with the Azure Automation setup.</span></span> <span data-ttu-id="e4096-179">You can test the webhooks with a simple Postman test to validate that the webhook works.</span><span class="sxs-lookup"><span data-stu-id="e4096-179">You can test the webhooks with a simple Postman test to validate that the webhook works.</span></span> <span data-ttu-id="e4096-180">Next, you must create the Logic App for orchestration.</span><span class="sxs-lookup"><span data-stu-id="e4096-180">Next, you must create the Logic App for orchestration.</span></span>

## <a name="create-an-azure-logic-app-for-orchestration"></a><span data-ttu-id="e4096-181">Create an Azure Logic App for orchestration</span><span class="sxs-lookup"><span data-stu-id="e4096-181">Create an Azure Logic App for orchestration</span></span>

<span data-ttu-id="e4096-182">Logic Apps help you build, schedule, and automate processes as workflows so you can integrate apps, data, systems, and services across enterprises or organizations.</span><span class="sxs-lookup"><span data-stu-id="e4096-182">Logic Apps help you build, schedule, and automate processes as workflows so you can integrate apps, data, systems, and services across enterprises or organizations.</span></span> <span data-ttu-id="e4096-183">In this scenario, the [Logic App](https://docs.microsoft.com/azure/logic-apps/) you create will do a little more than just call the automation webhook you created.</span><span class="sxs-lookup"><span data-stu-id="e4096-183">In this scenario, the [Logic App](https://docs.microsoft.com/azure/logic-apps/) you create will do a little more than just call the automation webhook you created.</span></span> 

<span data-ttu-id="e4096-184">Budgets can be set up to trigger a notification when a specified threshold is met.</span><span class="sxs-lookup"><span data-stu-id="e4096-184">Budgets can be set up to trigger a notification when a specified threshold is met.</span></span> <span data-ttu-id="e4096-185">You can provide multiple thresholds to be notified at and the Logic App will demonstrate the ability for you to perform different actions based on the threshold met.</span><span class="sxs-lookup"><span data-stu-id="e4096-185">You can provide multiple thresholds to be notified at and the Logic App will demonstrate the ability for you to perform different actions based on the threshold met.</span></span> <span data-ttu-id="e4096-186">In this example, you will set up a scenario where you get a couple of notifications, the first notification is for when 80% of the budget has been reached and the second notification is when 100% of the budget has been reached.</span><span class="sxs-lookup"><span data-stu-id="e4096-186">In this example, you will set up a scenario where you get a couple of notifications, the first notification is for when 80% of the budget has been reached and the second notification is when 100% of the budget has been reached.</span></span> <span data-ttu-id="e4096-187">The logic app will be used to shut down all VMs in the resource group.</span><span class="sxs-lookup"><span data-stu-id="e4096-187">The logic app will be used to shut down all VMs in the resource group.</span></span> <span data-ttu-id="e4096-188">First, the **Optional** threshold will be reached at 80%, then the second threshold will be reached where all VMs in the subscription will be shut down.</span><span class="sxs-lookup"><span data-stu-id="e4096-188">First, the **Optional** threshold will be reached at 80%, then the second threshold will be reached where all VMs in the subscription will be shut down.</span></span>

<span data-ttu-id="e4096-189">Logic apps allow you to provide a sample schema for the HTTP trigger, but require you to set the **Content-Type** header.</span><span class="sxs-lookup"><span data-stu-id="e4096-189">Logic apps allow you to provide a sample schema for the HTTP trigger, but require you to set the **Content-Type** header.</span></span> <span data-ttu-id="e4096-190">Because the action group does not have custom headers for the webhook, you must parse out the payload in a separate step.</span><span class="sxs-lookup"><span data-stu-id="e4096-190">Because the action group does not have custom headers for the webhook, you must parse out the payload in a separate step.</span></span> <span data-ttu-id="e4096-191">You will use the **Parse** action and provide it with a sample payload.</span><span class="sxs-lookup"><span data-stu-id="e4096-191">You will use the **Parse** action and provide it with a sample payload.</span></span>

### <a name="create-the-logic-app"></a><span data-ttu-id="e4096-192">Create the logic app</span><span class="sxs-lookup"><span data-stu-id="e4096-192">Create the logic app</span></span>

<span data-ttu-id="e4096-193">The logic app will perform several actions.</span><span class="sxs-lookup"><span data-stu-id="e4096-193">The logic app will perform several actions.</span></span> <span data-ttu-id="e4096-194">The following list provides a high-level set of actions that the logic app will perform:</span><span class="sxs-lookup"><span data-stu-id="e4096-194">The following list provides a high-level set of actions that the logic app will perform:</span></span>
- <span data-ttu-id="e4096-195">Recognizes when an HTTP request is received</span><span class="sxs-lookup"><span data-stu-id="e4096-195">Recognizes when an HTTP request is received</span></span>
- <span data-ttu-id="e4096-196">Parse the passed in JSON data to determine the threshold value that has been reached</span><span class="sxs-lookup"><span data-stu-id="e4096-196">Parse the passed in JSON data to determine the threshold value that has been reached</span></span>
- <span data-ttu-id="e4096-197">Use a conditional statement to check whether the threshold amount has reached 80% or more of the budget range, but not greater than or equal to 100%.</span><span class="sxs-lookup"><span data-stu-id="e4096-197">Use a conditional statement to check whether the threshold amount has reached 80% or more of the budget range, but not greater than or equal to 100%.</span></span>
    - <span data-ttu-id="e4096-198">If this threshold amount has been reached, send an HTTP POST using the webhook named **Optional**.</span><span class="sxs-lookup"><span data-stu-id="e4096-198">If this threshold amount has been reached, send an HTTP POST using the webhook named **Optional**.</span></span> <span data-ttu-id="e4096-199">This action will shut down the VMs in the "Optional" group.</span><span class="sxs-lookup"><span data-stu-id="e4096-199">This action will shut down the VMs in the "Optional" group.</span></span>
- <span data-ttu-id="e4096-200">Use a conditional statement to check whether the threshold amount has reached or exceeded 100% of the budget value.</span><span class="sxs-lookup"><span data-stu-id="e4096-200">Use a conditional statement to check whether the threshold amount has reached or exceeded 100% of the budget value.</span></span>
    - <span data-ttu-id="e4096-201">If the threshold amount has been reached, send an HTTP POST using the webhook named **Complete**.</span><span class="sxs-lookup"><span data-stu-id="e4096-201">If the threshold amount has been reached, send an HTTP POST using the webhook named **Complete**.</span></span> <span data-ttu-id="e4096-202">This action will shut down all remaining VMs.</span><span class="sxs-lookup"><span data-stu-id="e4096-202">This action will shut down all remaining VMs.</span></span>

<span data-ttu-id="e4096-203">The following steps are needed to create the logic app that will perform the above steps:</span><span class="sxs-lookup"><span data-stu-id="e4096-203">The following steps are needed to create the logic app that will perform the above steps:</span></span>

1.  <span data-ttu-id="e4096-204">In the [Azure portal](https://portal.azure.com/), select **Create a resource** > **Integration** > **Logic App**.</span><span class="sxs-lookup"><span data-stu-id="e4096-204">In the [Azure portal](https://portal.azure.com/), select **Create a resource** > **Integration** > **Logic App**.</span></span>
    
    ![Azure - Select the Logic App resource](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-03.png)
2.  <span data-ttu-id="e4096-206">In the **Create logic app** blade, provide the details need to create your logic app, select **Pin to dashboard**, and click **Create**.</span><span class="sxs-lookup"><span data-stu-id="e4096-206">In the **Create logic app** blade, provide the details need to create your logic app, select **Pin to dashboard**, and click **Create**.</span></span> 
    
    ![Azure - Create a Logic App](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-03a.png)

<span data-ttu-id="e4096-208">After Azure deploys your logic app, the **Logic Apps Designer** opens and shows a blade with an introduction video and commonly used triggers.</span><span class="sxs-lookup"><span data-stu-id="e4096-208">After Azure deploys your logic app, the **Logic Apps Designer** opens and shows a blade with an introduction video and commonly used triggers.</span></span> 

### <a name="add-a-trigger"></a><span data-ttu-id="e4096-209">Add a trigger</span><span class="sxs-lookup"><span data-stu-id="e4096-209">Add a trigger</span></span>

<span data-ttu-id="e4096-210">Every logic app must start with a trigger, which fires when a specific event happens or when a specific condition is met.</span><span class="sxs-lookup"><span data-stu-id="e4096-210">Every logic app must start with a trigger, which fires when a specific event happens or when a specific condition is met.</span></span> <span data-ttu-id="e4096-211">Each time the trigger fires, the Logic Apps engine creates a logic app instance that starts and runs your workflow.</span><span class="sxs-lookup"><span data-stu-id="e4096-211">Each time the trigger fires, the Logic Apps engine creates a logic app instance that starts and runs your workflow.</span></span> <span data-ttu-id="e4096-212">Actions are all the steps that happen after the trigger.</span><span class="sxs-lookup"><span data-stu-id="e4096-212">Actions are all the steps that happen after the trigger.</span></span> 

1.  <span data-ttu-id="e4096-213">Under **Templates** of the **Logic Apps Designer** blade, choose **Blank Logic App**.</span><span class="sxs-lookup"><span data-stu-id="e4096-213">Under **Templates** of the **Logic Apps Designer** blade, choose **Blank Logic App**.</span></span>
2.  <span data-ttu-id="e4096-214">Add a [trigger](https://docs.microsoft.com/azure/logic-apps/logic-apps-overview#logic-app-concepts) by entering "http request" in the **Logic Apps Designer** search box to find and select the trigger named **Request – When an HTTP request is received**.</span><span class="sxs-lookup"><span data-stu-id="e4096-214">Add a [trigger](https://docs.microsoft.com/azure/logic-apps/logic-apps-overview#logic-app-concepts) by entering "http request" in the **Logic Apps Designer** search box to find and select the trigger named **Request – When an HTTP request is received**.</span></span>
    
    ![Azure - Logic app - Http trigger](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-04.png) 
3.  <span data-ttu-id="e4096-216">Select **New step** > **Add an action**.</span><span class="sxs-lookup"><span data-stu-id="e4096-216">Select **New step** > **Add an action**.</span></span> 
    
    ![Azure - New step - Add an action](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-05.png) 
4.  <span data-ttu-id="e4096-218">Search for "parse JSON" in the **Logic Apps Designer** search box to find and select the **Data Operations - Parse JSON** [action](https://docs.microsoft.com/azure/logic-apps/logic-apps-overview#logic-app-concepts).</span><span class="sxs-lookup"><span data-stu-id="e4096-218">Search for "parse JSON" in the **Logic Apps Designer** search box to find and select the **Data Operations - Parse JSON** [action](https://docs.microsoft.com/azure/logic-apps/logic-apps-overview#logic-app-concepts).</span></span> 
    
    ![Azure - Logic app - Add parse JSON action](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-06.png) 
5.  <span data-ttu-id="e4096-220">Enter "Payload" as the **Content** name for the Parse JSON payload.</span><span class="sxs-lookup"><span data-stu-id="e4096-220">Enter "Payload" as the **Content** name for the Parse JSON payload.</span></span>
6.  <span data-ttu-id="e4096-221">Select the **Use sample payload to generate schema** option in the **Parse JSON** box.</span><span class="sxs-lookup"><span data-stu-id="e4096-221">Select the **Use sample payload to generate schema** option in the **Parse JSON** box.</span></span>
    
    ![Azure - Logic app - Use sample JSON data to generate schema](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-07.png) 
7.  <span data-ttu-id="e4096-223">Paste the following JSON sample payload into the textbox: `{"schemaId":"AIP Budget Notification","data":{"SubscriptionName":"CCM - Microsoft Azure Enterprise - 1","SubscriptionId":"<GUID>","SpendingAmount":"100","BudgetStartDate":"6/1/2018","Budget":"50","Unit":"USD","BudgetCreator":"email@contoso.com","BudgetName":"BudgetName","BudgetType":"Cost","ResourceGroup":"","NotificationThresholdAmount":"0.8"}}`</span><span class="sxs-lookup"><span data-stu-id="e4096-223">Paste the following JSON sample payload into the textbox: `{"schemaId":"AIP Budget Notification","data":{"SubscriptionName":"CCM - Microsoft Azure Enterprise - 1","SubscriptionId":"<GUID>","SpendingAmount":"100","BudgetStartDate":"6/1/2018","Budget":"50","Unit":"USD","BudgetCreator":"email@contoso.com","BudgetName":"BudgetName","BudgetType":"Cost","ResourceGroup":"","NotificationThresholdAmount":"0.8"}}`</span></span>
    
    <span data-ttu-id="e4096-224">The textbox will appear as the following:</span><span class="sxs-lookup"><span data-stu-id="e4096-224">The textbox will appear as the following:</span></span>
        
    ![Azure - Logic app - The sample JSON payload](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-08.png) 
8.  <span data-ttu-id="e4096-226">Click **Done**.</span><span class="sxs-lookup"><span data-stu-id="e4096-226">Click **Done**.</span></span>

### <a name="add-the-first-conditional-action"></a><span data-ttu-id="e4096-227">Add the first conditional action</span><span class="sxs-lookup"><span data-stu-id="e4096-227">Add the first conditional action</span></span>

<span data-ttu-id="e4096-228">Use a conditional statement to check whether the threshold amount has reached 80% or more of the budget range, but not greater than or equal to 100%.</span><span class="sxs-lookup"><span data-stu-id="e4096-228">Use a conditional statement to check whether the threshold amount has reached 80% or more of the budget range, but not greater than or equal to 100%.</span></span> <span data-ttu-id="e4096-229">If this threshold amount has been reached, send an HTTP POST using the webhook named **Optional**.</span><span class="sxs-lookup"><span data-stu-id="e4096-229">If this threshold amount has been reached, send an HTTP POST using the webhook named **Optional**.</span></span> <span data-ttu-id="e4096-230">This action will shut down the VMs in the **Optional** group.</span><span class="sxs-lookup"><span data-stu-id="e4096-230">This action will shut down the VMs in the **Optional** group.</span></span>

1.  <span data-ttu-id="e4096-231">Select **New step** > **Add a condition**.</span><span class="sxs-lookup"><span data-stu-id="e4096-231">Select **New step** > **Add a condition**.</span></span>
    
    ![Azure - Logic app - Add a condition](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-09.png) 
2.  <span data-ttu-id="e4096-233">In the **Condition** box, click the textbox containing **Choose a value** to display a list of available values.</span><span class="sxs-lookup"><span data-stu-id="e4096-233">In the **Condition** box, click the textbox containing **Choose a value** to display a list of available values.</span></span>
    
    ![Azure - Logic app - Condition box](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-10.png) 
        
3.  <span data-ttu-id="e4096-235">Click **Expression** at the top of the list and enter the following expression in the expression editor: `float()`</span><span class="sxs-lookup"><span data-stu-id="e4096-235">Click **Expression** at the top of the list and enter the following expression in the expression editor: `float()`</span></span>
    
    ![Azure - Logic app - Float expression](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-11.png) 
        
4.  <span data-ttu-id="e4096-237">Select **Dynamic content**, place the cursor inside the parenthesis (), and select **NotificationThresholdAmount** from the list to populate the complete expression.</span><span class="sxs-lookup"><span data-stu-id="e4096-237">Select **Dynamic content**, place the cursor inside the parenthesis (), and select **NotificationThresholdAmount** from the list to populate the complete expression.</span></span> 
    
    <span data-ttu-id="e4096-238">The expression will be the following:</span><span class="sxs-lookup"><span data-stu-id="e4096-238">The expression will be the following:</span></span><br>
    `float(body('Parse_JSON')?['data']?['NotificationThresholdAmount'])`
    
5.  <span data-ttu-id="e4096-239">Select **OK** to set the expression.</span><span class="sxs-lookup"><span data-stu-id="e4096-239">Select **OK** to set the expression.</span></span> 
6.  <span data-ttu-id="e4096-240">Select **is greater than or equal to** in the dropdown box of the **Condition**.</span><span class="sxs-lookup"><span data-stu-id="e4096-240">Select **is greater than or equal to** in the dropdown box of the **Condition**.</span></span>
7.  <span data-ttu-id="e4096-241">In the **Choose a value** box of the condition enter `.8`.</span><span class="sxs-lookup"><span data-stu-id="e4096-241">In the **Choose a value** box of the condition enter `.8`.</span></span>
    
    ![Azure - Logic app - Float expression with a value](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-12.png) 
        
8.  <span data-ttu-id="e4096-243">Click **Add** > **Add row** within the Condition box to add an additional part of the condition.</span><span class="sxs-lookup"><span data-stu-id="e4096-243">Click **Add** > **Add row** within the Condition box to add an additional part of the condition.</span></span>
9.  <span data-ttu-id="e4096-244">In the **Condition** box, click the textbox containing **Choose a value**.</span><span class="sxs-lookup"><span data-stu-id="e4096-244">In the **Condition** box, click the textbox containing **Choose a value**.</span></span>
10. <span data-ttu-id="e4096-245">Click **Expression** at the top of the list and enter the following expression in the expression editor: `float()`</span><span class="sxs-lookup"><span data-stu-id="e4096-245">Click **Expression** at the top of the list and enter the following expression in the expression editor: `float()`</span></span>
11. <span data-ttu-id="e4096-246">Select **Dynamic content**, place the cursor inside the parenthesis (), and select **NotificationThresholdAmount** from the list to populate the complete expression.</span><span class="sxs-lookup"><span data-stu-id="e4096-246">Select **Dynamic content**, place the cursor inside the parenthesis (), and select **NotificationThresholdAmount** from the list to populate the complete expression.</span></span> 
12. <span data-ttu-id="e4096-247">Select **OK** to set the expression.</span><span class="sxs-lookup"><span data-stu-id="e4096-247">Select **OK** to set the expression.</span></span> 
13. <span data-ttu-id="e4096-248">Select **is less than** in the dropdown box of the **Condition**.</span><span class="sxs-lookup"><span data-stu-id="e4096-248">Select **is less than** in the dropdown box of the **Condition**.</span></span>
14. <span data-ttu-id="e4096-249">In the **Choose a value** box of the condition enter `1`.</span><span class="sxs-lookup"><span data-stu-id="e4096-249">In the **Choose a value** box of the condition enter `1`.</span></span>
    
    ![Azure - Logic app - Float expression with a value](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-13.png) 
        
15. <span data-ttu-id="e4096-251">In the **If true** box, select **Add an action**.</span><span class="sxs-lookup"><span data-stu-id="e4096-251">In the **If true** box, select **Add an action**.</span></span> <span data-ttu-id="e4096-252">You will add an HTTP POST action that will shut down optional VMs.</span><span class="sxs-lookup"><span data-stu-id="e4096-252">You will add an HTTP POST action that will shut down optional VMs.</span></span>
    
    ![Azure - Logic app - Add an action](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-14.png) 
        
16. <span data-ttu-id="e4096-254">Enter **HTTP** to search for the HTTP action and select the **HTTP – HTTP** action.</span><span class="sxs-lookup"><span data-stu-id="e4096-254">Enter **HTTP** to search for the HTTP action and select the **HTTP – HTTP** action.</span></span>
    
    ![Azure - Logic app - Add HTTP action](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-15.png) 
        
17. <span data-ttu-id="e4096-256">Select **Post** as the for the **Method** value.</span><span class="sxs-lookup"><span data-stu-id="e4096-256">Select **Post** as the for the **Method** value.</span></span>
18. <span data-ttu-id="e4096-257">Enter the URL for the webhook named **Optional** that you created earlier in this tutorial as the **Uri** value.</span><span class="sxs-lookup"><span data-stu-id="e4096-257">Enter the URL for the webhook named **Optional** that you created earlier in this tutorial as the **Uri** value.</span></span>
    
    ![Azure - Logic app - HTTP action URI](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-16.png) 
        
19. <span data-ttu-id="e4096-259">Select **Add an action** in the **If true** box.</span><span class="sxs-lookup"><span data-stu-id="e4096-259">Select **Add an action** in the **If true** box.</span></span> <span data-ttu-id="e4096-260">You will add an email action that will send an email notifying the recipient that the optional VMs have been shut down.</span><span class="sxs-lookup"><span data-stu-id="e4096-260">You will add an email action that will send an email notifying the recipient that the optional VMs have been shut down.</span></span>
20. <span data-ttu-id="e4096-261">Search for "send email" and select a *send email* action based on the email service you use.</span><span class="sxs-lookup"><span data-stu-id="e4096-261">Search for "send email" and select a *send email* action based on the email service you use.</span></span>
        
    ![Azure - Logic app - Send email action](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-17.png) 
    
    <span data-ttu-id="e4096-263">For personal Microsoft accounts, select **Outlook.com**.</span><span class="sxs-lookup"><span data-stu-id="e4096-263">For personal Microsoft accounts, select **Outlook.com**.</span></span> <span data-ttu-id="e4096-264">For Azure work or school accounts, select **Office 365 Outlook**.</span><span class="sxs-lookup"><span data-stu-id="e4096-264">For Azure work or school accounts, select **Office 365 Outlook**.</span></span> <span data-ttu-id="e4096-265">If you don't already have a connection, you're asked to sign in to your email account.</span><span class="sxs-lookup"><span data-stu-id="e4096-265">If you don't already have a connection, you're asked to sign in to your email account.</span></span> <span data-ttu-id="e4096-266">Logic Apps creates a connection to your email account.</span><span class="sxs-lookup"><span data-stu-id="e4096-266">Logic Apps creates a connection to your email account.</span></span>
        
    <span data-ttu-id="e4096-267">You will need to allow the Logic App to access your email information.</span><span class="sxs-lookup"><span data-stu-id="e4096-267">You will need to allow the Logic App to access your email information.</span></span>
    
    ![Azure - Logic app - Access notice](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-18.png) 
        
21. <span data-ttu-id="e4096-269">Add the **To**, **Subject**, and **Body** text for the email that notifies the recipient that the optional VMs have been shut down.</span><span class="sxs-lookup"><span data-stu-id="e4096-269">Add the **To**, **Subject**, and **Body** text for the email that notifies the recipient that the optional VMs have been shut down.</span></span> <span data-ttu-id="e4096-270">Use the **BudgetName** and the **NotificationThresholdAmount** dynamic content to populate the subject and body fields.</span><span class="sxs-lookup"><span data-stu-id="e4096-270">Use the **BudgetName** and the **NotificationThresholdAmount** dynamic content to populate the subject and body fields.</span></span>
    
    ![Azure - Logic app - Email details](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-19.png) 
 
### <a name="add-the-second-conditional-action"></a><span data-ttu-id="e4096-272">Add the second conditional action</span><span class="sxs-lookup"><span data-stu-id="e4096-272">Add the second conditional action</span></span>

<span data-ttu-id="e4096-273">Use a conditional statement to check whether the threshold amount has reached or exceeded 100% of the budget value.</span><span class="sxs-lookup"><span data-stu-id="e4096-273">Use a conditional statement to check whether the threshold amount has reached or exceeded 100% of the budget value.</span></span> <span data-ttu-id="e4096-274">If the threshold amount has been reached, send an HTTP POST using the webhook named **Complete**.</span><span class="sxs-lookup"><span data-stu-id="e4096-274">If the threshold amount has been reached, send an HTTP POST using the webhook named **Complete**.</span></span> <span data-ttu-id="e4096-275">This action will shut down all remaining VMs.</span><span class="sxs-lookup"><span data-stu-id="e4096-275">This action will shut down all remaining VMs.</span></span>

1.  <span data-ttu-id="e4096-276">Select **New step** > **Add a Condition**.</span><span class="sxs-lookup"><span data-stu-id="e4096-276">Select **New step** > **Add a Condition**.</span></span>
    
    ![Azure - Logic app - Add action](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-20.png) 
        
2.  <span data-ttu-id="e4096-278">In the **Condition** box, click the textbox containing **Choose a value** to display a list of available values.</span><span class="sxs-lookup"><span data-stu-id="e4096-278">In the **Condition** box, click the textbox containing **Choose a value** to display a list of available values.</span></span>
3.  <span data-ttu-id="e4096-279">Click **Expression** at the top of the list and enter the following expression in the expression editor: `float()`</span><span class="sxs-lookup"><span data-stu-id="e4096-279">Click **Expression** at the top of the list and enter the following expression in the expression editor: `float()`</span></span>
4.  <span data-ttu-id="e4096-280">Select **Dynamic content**, place the cursor inside the parenthesis (), and select **NotificationThresholdAmount** from the list to populate the complete expression.</span><span class="sxs-lookup"><span data-stu-id="e4096-280">Select **Dynamic content**, place the cursor inside the parenthesis (), and select **NotificationThresholdAmount** from the list to populate the complete expression.</span></span> 
    
    <span data-ttu-id="e4096-281">The expression will be the following:</span><span class="sxs-lookup"><span data-stu-id="e4096-281">The expression will be the following:</span></span><br>
    `float(body('Parse_JSON')?['data']?['NotificationThresholdAmount'])`
        
5.  <span data-ttu-id="e4096-282">Select **OK** to set the expression.</span><span class="sxs-lookup"><span data-stu-id="e4096-282">Select **OK** to set the expression.</span></span> 
6.  <span data-ttu-id="e4096-283">Select **is greater than or equal to** in the dropdown box of the **Condition**.</span><span class="sxs-lookup"><span data-stu-id="e4096-283">Select **is greater than or equal to** in the dropdown box of the **Condition**.</span></span>
7.  <span data-ttu-id="e4096-284">In the **Choose a value box** of the condition enter `1`.</span><span class="sxs-lookup"><span data-stu-id="e4096-284">In the **Choose a value box** of the condition enter `1`.</span></span>
    
    ![Azure - Logic app - Set condition value](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-21.png) 
        
8.  <span data-ttu-id="e4096-286">In the **If true** box, select **Add an action**.</span><span class="sxs-lookup"><span data-stu-id="e4096-286">In the **If true** box, select **Add an action**.</span></span> <span data-ttu-id="e4096-287">You will add an HTTP POST action that will shut down all the remaining VMs.</span><span class="sxs-lookup"><span data-stu-id="e4096-287">You will add an HTTP POST action that will shut down all the remaining VMs.</span></span>
    
    ![Azure - Logic app - Add an action](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-22.png) 
    
9.  <span data-ttu-id="e4096-289">Enter **HTTP** to search for the HTTP action and select the **HTTP – HTTP** action.</span><span class="sxs-lookup"><span data-stu-id="e4096-289">Enter **HTTP** to search for the HTTP action and select the **HTTP – HTTP** action.</span></span>
10. <span data-ttu-id="e4096-290">Select **Post** as the for the **Method** value.</span><span class="sxs-lookup"><span data-stu-id="e4096-290">Select **Post** as the for the **Method** value.</span></span>
11. <span data-ttu-id="e4096-291">Enter the URL for the webhook named **Complete** that you created earlier in this tutorial as the **Uri** value.</span><span class="sxs-lookup"><span data-stu-id="e4096-291">Enter the URL for the webhook named **Complete** that you created earlier in this tutorial as the **Uri** value.</span></span>
    
    ![Azure - Logic app - Add an action](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-23.png) 
        
12. <span data-ttu-id="e4096-293">Select **Add an action** in the **If true** box.</span><span class="sxs-lookup"><span data-stu-id="e4096-293">Select **Add an action** in the **If true** box.</span></span> <span data-ttu-id="e4096-294">You will add an email action that will send an email notifying the recipient that the remaining VMs have been shut down.</span><span class="sxs-lookup"><span data-stu-id="e4096-294">You will add an email action that will send an email notifying the recipient that the remaining VMs have been shut down.</span></span>
13. <span data-ttu-id="e4096-295">Search for "send email" and select a *send email* action based on the email service you use.</span><span class="sxs-lookup"><span data-stu-id="e4096-295">Search for "send email" and select a *send email* action based on the email service you use.</span></span>
14. <span data-ttu-id="e4096-296">Add the **To**, **Subject**, and **Body** text for the email that notifies the recipient that the optional VMs have been shut down.</span><span class="sxs-lookup"><span data-stu-id="e4096-296">Add the **To**, **Subject**, and **Body** text for the email that notifies the recipient that the optional VMs have been shut down.</span></span> <span data-ttu-id="e4096-297">Use the **BudgetName** and the **NotificationThresholdAmount** dynamic content to populate the subject and body fields.</span><span class="sxs-lookup"><span data-stu-id="e4096-297">Use the **BudgetName** and the **NotificationThresholdAmount** dynamic content to populate the subject and body fields.</span></span>
    
    ![Azure - Logic app - Send email details](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-24.png) 
        
15. <span data-ttu-id="e4096-299">Click **Save** at the top of the **Logic App Designer** blade.</span><span class="sxs-lookup"><span data-stu-id="e4096-299">Click **Save** at the top of the **Logic App Designer** blade.</span></span>

### <a name="logic-app-summary"></a><span data-ttu-id="e4096-300">Logic App summary</span><span class="sxs-lookup"><span data-stu-id="e4096-300">Logic App summary</span></span>

<span data-ttu-id="e4096-301">Here’s what your Logic App looks like once you’re done.</span><span class="sxs-lookup"><span data-stu-id="e4096-301">Here’s what your Logic App looks like once you’re done.</span></span> <span data-ttu-id="e4096-302">In the most basic of scenarios where you don’t need any threshold-based orchestration, you could directly call the automation script from **Monitor** and skip the **Logic App** step.</span><span class="sxs-lookup"><span data-stu-id="e4096-302">In the most basic of scenarios where you don’t need any threshold-based orchestration, you could directly call the automation script from **Monitor** and skip the **Logic App** step.</span></span>

   ![Azure - Logic app - Complete view](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-25.png) 
 
<span data-ttu-id="e4096-304">When you saved your logic app, a URL was generated that you will be able to call.</span><span class="sxs-lookup"><span data-stu-id="e4096-304">When you saved your logic app, a URL was generated that you will be able to call.</span></span> <span data-ttu-id="e4096-305">You’ll use this URL in the next section of this tutorial.</span><span class="sxs-lookup"><span data-stu-id="e4096-305">You’ll use this URL in the next section of this tutorial.</span></span> 

## <a name="create-an-azure-monitor-action-group"></a><span data-ttu-id="e4096-306">Create an Azure Monitor Action Group</span><span class="sxs-lookup"><span data-stu-id="e4096-306">Create an Azure Monitor Action Group</span></span>

<span data-ttu-id="e4096-307">An action group is a collection of notification preferences that you define.</span><span class="sxs-lookup"><span data-stu-id="e4096-307">An action group is a collection of notification preferences that you define.</span></span> <span data-ttu-id="e4096-308">When an alert is triggered, a specific action group can receive the alert by being notified.</span><span class="sxs-lookup"><span data-stu-id="e4096-308">When an alert is triggered, a specific action group can receive the alert by being notified.</span></span> <span data-ttu-id="e4096-309">An Azure alert proactively raises a notification based on specific conditions and provides the opportunity to take action.</span><span class="sxs-lookup"><span data-stu-id="e4096-309">An Azure alert proactively raises a notification based on specific conditions and provides the opportunity to take action.</span></span> <span data-ttu-id="e4096-310">An alert can use data from multiple sources, including metrics and logs.</span><span class="sxs-lookup"><span data-stu-id="e4096-310">An alert can use data from multiple sources, including metrics and logs.</span></span>

<span data-ttu-id="e4096-311">Action groups are the only endpoint that you will integrate with your budget.</span><span class="sxs-lookup"><span data-stu-id="e4096-311">Action groups are the only endpoint that you will integrate with your budget.</span></span> <span data-ttu-id="e4096-312">You can set up notifications in a number of channels, but for this scenario you will focus on the Logic App you created earlier in this tutorial.</span><span class="sxs-lookup"><span data-stu-id="e4096-312">You can set up notifications in a number of channels, but for this scenario you will focus on the Logic App you created earlier in this tutorial.</span></span> 

### <a name="create-an-action-group-in-azure-monitor"></a><span data-ttu-id="e4096-313">Create an action group in Azure Monitor</span><span class="sxs-lookup"><span data-stu-id="e4096-313">Create an action group in Azure Monitor</span></span>

<span data-ttu-id="e4096-314">When you create the action group, you will point to the Logic App that you created earlier in this tutorial.</span><span class="sxs-lookup"><span data-stu-id="e4096-314">When you create the action group, you will point to the Logic App that you created earlier in this tutorial.</span></span> 

1.  <span data-ttu-id="e4096-315">If you are not already signed-in to the [Azure portal](https://portal.azure.com/), sign-in and select **All services** > **Monitor**.</span><span class="sxs-lookup"><span data-stu-id="e4096-315">If you are not already signed-in to the [Azure portal](https://portal.azure.com/), sign-in and select **All services** > **Monitor**.</span></span> 
2.  <span data-ttu-id="e4096-316">Select **Actions groups** from the **Setting** section.</span><span class="sxs-lookup"><span data-stu-id="e4096-316">Select **Actions groups** from the **Setting** section.</span></span>
3.  <span data-ttu-id="e4096-317">Select **Add an action group** from the **Action groups** blade.</span><span class="sxs-lookup"><span data-stu-id="e4096-317">Select **Add an action group** from the **Action groups** blade.</span></span>
4.  <span data-ttu-id="e4096-318">Add and verify the following items:</span><span class="sxs-lookup"><span data-stu-id="e4096-318">Add and verify the following items:</span></span>
    - <span data-ttu-id="e4096-319">Action group name</span><span class="sxs-lookup"><span data-stu-id="e4096-319">Action group name</span></span>
    - <span data-ttu-id="e4096-320">Short name</span><span class="sxs-lookup"><span data-stu-id="e4096-320">Short name</span></span>
    - <span data-ttu-id="e4096-321">Subscription</span><span class="sxs-lookup"><span data-stu-id="e4096-321">Subscription</span></span>
    - <span data-ttu-id="e4096-322">Resource group</span><span class="sxs-lookup"><span data-stu-id="e4096-322">Resource group</span></span>
    
    ![Azure - Logic app - Add an action group](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-26.png) 
        
5.  <span data-ttu-id="e4096-324">Within the **Add action group** pane, add a LogicApp action.</span><span class="sxs-lookup"><span data-stu-id="e4096-324">Within the **Add action group** pane, add a LogicApp action.</span></span> <span data-ttu-id="e4096-325">Name the action **Budget-BudgetLA**.</span><span class="sxs-lookup"><span data-stu-id="e4096-325">Name the action **Budget-BudgetLA**.</span></span> <span data-ttu-id="e4096-326">In the **Logic App** pane, select the **Subscription** and the **Resource group**.</span><span class="sxs-lookup"><span data-stu-id="e4096-326">In the **Logic App** pane, select the **Subscription** and the **Resource group**.</span></span> <span data-ttu-id="e4096-327">Then, select the **Logic app** that you created earlier in this tutorial.</span><span class="sxs-lookup"><span data-stu-id="e4096-327">Then, select the **Logic app** that you created earlier in this tutorial.</span></span>
6.  <span data-ttu-id="e4096-328">Click **OK** to set the Logic App.</span><span class="sxs-lookup"><span data-stu-id="e4096-328">Click **OK** to set the Logic App.</span></span> <span data-ttu-id="e4096-329">Then, select **OK** in the **Add action group** pane to create the action group.</span><span class="sxs-lookup"><span data-stu-id="e4096-329">Then, select **OK** in the **Add action group** pane to create the action group.</span></span>
    
<span data-ttu-id="e4096-330">You’re done with all the supporting components needed to effectively orchestrate your budget.</span><span class="sxs-lookup"><span data-stu-id="e4096-330">You’re done with all the supporting components needed to effectively orchestrate your budget.</span></span> <span data-ttu-id="e4096-331">Now all you need to do is create the budget and configure it to use the action group you created.</span><span class="sxs-lookup"><span data-stu-id="e4096-331">Now all you need to do is create the budget and configure it to use the action group you created.</span></span>

## <a name="create-the-azure-budget"></a><span data-ttu-id="e4096-332">Create the Azure Budget</span><span class="sxs-lookup"><span data-stu-id="e4096-332">Create the Azure Budget</span></span> 

<span data-ttu-id="e4096-333">Budgets don’t currently have a portal experience in Azure.</span><span class="sxs-lookup"><span data-stu-id="e4096-333">Budgets don’t currently have a portal experience in Azure.</span></span> <span data-ttu-id="e4096-334">However, you are able to call either REST APIs, Powershell cmdlets, or use the CLI.</span><span class="sxs-lookup"><span data-stu-id="e4096-334">However, you are able to call either REST APIs, Powershell cmdlets, or use the CLI.</span></span> <span data-ttu-id="e4096-335">The following procedure uses the REST API.</span><span class="sxs-lookup"><span data-stu-id="e4096-335">The following procedure uses the REST API.</span></span> <span data-ttu-id="e4096-336">Before calling the REST API, you will need an authorization token.</span><span class="sxs-lookup"><span data-stu-id="e4096-336">Before calling the REST API, you will need an authorization token.</span></span> <span data-ttu-id="e4096-337">To create an authorization token, you can use the [ARMClient](https://github.com/projectkudu/ARMClient) project.</span><span class="sxs-lookup"><span data-stu-id="e4096-337">To create an authorization token, you can use the [ARMClient](https://github.com/projectkudu/ARMClient) project.</span></span> <span data-ttu-id="e4096-338">The **ARMClient** allows you to authenticate yourself to the Azure Resource Manager and get a token to call the APIs.</span><span class="sxs-lookup"><span data-stu-id="e4096-338">The **ARMClient** allows you to authenticate yourself to the Azure Resource Manager and get a token to call the APIs.</span></span> 

### <a name="create-an-authentication-token"></a><span data-ttu-id="e4096-339">Create an authentication token</span><span class="sxs-lookup"><span data-stu-id="e4096-339">Create an authentication token</span></span>

1.  <span data-ttu-id="e4096-340">Navigate to the [ARMClient](https://github.com/projectkudu/ARMClient) project on GitHub.</span><span class="sxs-lookup"><span data-stu-id="e4096-340">Navigate to the [ARMClient](https://github.com/projectkudu/ARMClient) project on GitHub.</span></span>
2.  <span data-ttu-id="e4096-341">Clone the repo to get a local copy.</span><span class="sxs-lookup"><span data-stu-id="e4096-341">Clone the repo to get a local copy.</span></span>
3.  <span data-ttu-id="e4096-342">Open the project in Visual Studio and build it.</span><span class="sxs-lookup"><span data-stu-id="e4096-342">Open the project in Visual Studio and build it.</span></span>
4.  <span data-ttu-id="e4096-343">Once the build is successful, the executable should be in the *\bin\debug* folder.</span><span class="sxs-lookup"><span data-stu-id="e4096-343">Once the build is successful, the executable should be in the *\bin\debug* folder.</span></span>
5.  <span data-ttu-id="e4096-344">Run the ARMClient.</span><span class="sxs-lookup"><span data-stu-id="e4096-344">Run the ARMClient.</span></span> <span data-ttu-id="e4096-345">Open a command prompt and navigate to the *\bin\debug* folder from the project root.</span><span class="sxs-lookup"><span data-stu-id="e4096-345">Open a command prompt and navigate to the *\bin\debug* folder from the project root.</span></span>
6.  <span data-ttu-id="e4096-346">To login and authenticate, enter the following command at the command prompt:</span><span class="sxs-lookup"><span data-stu-id="e4096-346">To login and authenticate, enter the following command at the command prompt:</span></span><br>
    `ARMClient login prod`
7.  <span data-ttu-id="e4096-347">Copy the **subscription guid** from the output.</span><span class="sxs-lookup"><span data-stu-id="e4096-347">Copy the **subscription guid** from the output.</span></span>
8.  <span data-ttu-id="e4096-348">To copy an authorization token to your clipboard, enter the following command at the command prompt, but sure to use the copied subscription ID from the step above:</span><span class="sxs-lookup"><span data-stu-id="e4096-348">To copy an authorization token to your clipboard, enter the following command at the command prompt, but sure to use the copied subscription ID from the step above:</span></span> <br>
    `ARMClient token <subscription GUID from previous step>`
    
    <span data-ttu-id="e4096-349">Once you have completed the step above, you will see the following:</span><span class="sxs-lookup"><span data-stu-id="e4096-349">Once you have completed the step above, you will see the following:</span></span><br>
    <span data-ttu-id="e4096-350">**Token copied to clipboard successfully.**</span><span class="sxs-lookup"><span data-stu-id="e4096-350">**Token copied to clipboard successfully.**</span></span>
9.  <span data-ttu-id="e4096-351">Save the token to be used for steps in the next section of this tutorial.</span><span class="sxs-lookup"><span data-stu-id="e4096-351">Save the token to be used for steps in the next section of this tutorial.</span></span>

### <a name="create-the-budget"></a><span data-ttu-id="e4096-352">Create the Budget</span><span class="sxs-lookup"><span data-stu-id="e4096-352">Create the Budget</span></span>

<span data-ttu-id="e4096-353">Next, you will configure **Postman** to create a budget by calling the Azure Consumption REST APIs.</span><span class="sxs-lookup"><span data-stu-id="e4096-353">Next, you will configure **Postman** to create a budget by calling the Azure Consumption REST APIs.</span></span> <span data-ttu-id="e4096-354">Postman is an API Development environment.</span><span class="sxs-lookup"><span data-stu-id="e4096-354">Postman is an API Development environment.</span></span> <span data-ttu-id="e4096-355">You will import environment and collection files into Postman.</span><span class="sxs-lookup"><span data-stu-id="e4096-355">You will import environment and collection files into Postman.</span></span> <span data-ttu-id="e4096-356">The collection contains grouped definitions of HTTP requests that call Azure Consumption REST APIs.</span><span class="sxs-lookup"><span data-stu-id="e4096-356">The collection contains grouped definitions of HTTP requests that call Azure Consumption REST APIs.</span></span> <span data-ttu-id="e4096-357">The environment file contains variables that are used by the collection.</span><span class="sxs-lookup"><span data-stu-id="e4096-357">The environment file contains variables that are used by the collection.</span></span>

1.  <span data-ttu-id="e4096-358">Download and open the [Postman REST client](https://www.getpostman.com/) to execute the REST APIs.</span><span class="sxs-lookup"><span data-stu-id="e4096-358">Download and open the [Postman REST client](https://www.getpostman.com/) to execute the REST APIs.</span></span>
2.  <span data-ttu-id="e4096-359">In Postman, create a new request.</span><span class="sxs-lookup"><span data-stu-id="e4096-359">In Postman, create a new request.</span></span>
    
    ![Postman - Create a new request](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-27.png) 
        
3.  <span data-ttu-id="e4096-361">Save the new request as a collection, so that the new request has nothing on it.</span><span class="sxs-lookup"><span data-stu-id="e4096-361">Save the new request as a collection, so that the new request has nothing on it.</span></span>
    
    ![Postman - Save the new request](./media/billing-cost-management-budget-scenario/billing-cost-management-budget-scenario-28.png) 
        
4.  <span data-ttu-id="e4096-363">Change the request from a `Get` to a `Put` action.</span><span class="sxs-lookup"><span data-stu-id="e4096-363">Change the request from a `Get` to a `Put` action.</span></span>
5.  <span data-ttu-id="e4096-364">Modify the following URL by replacing `{subscriptionId}` with the **Subscription ID** that you used in the previous section of this tutorial.</span><span class="sxs-lookup"><span data-stu-id="e4096-364">Modify the following URL by replacing `{subscriptionId}` with the **Subscription ID** that you used in the previous section of this tutorial.</span></span> <span data-ttu-id="e4096-365">Also, modify the URL to include "SampleBudget" as the value for `{budgetName}`: `https://management.azure.com/subscriptions/{subscriptionId}/providers/Microsoft.Consumption/budgets/{budgetName}?api-version=2018-03-31`</span><span class="sxs-lookup"><span data-stu-id="e4096-365">Also, modify the URL to include "SampleBudget" as the value for `{budgetName}`: `https://management.azure.com/subscriptions/{subscriptionId}/providers/Microsoft.Consumption/budgets/{budgetName}?api-version=2018-03-31`</span></span>
6.  <span data-ttu-id="e4096-366">Select the **Headers** tab within Postman.</span><span class="sxs-lookup"><span data-stu-id="e4096-366">Select the **Headers** tab within Postman.</span></span>
7.  <span data-ttu-id="e4096-367">Add a new **Key** named "Authorization".</span><span class="sxs-lookup"><span data-stu-id="e4096-367">Add a new **Key** named "Authorization".</span></span>
8.  <span data-ttu-id="e4096-368">Set the **Value** to the token that was created using the ArmClient at the end of the last section.</span><span class="sxs-lookup"><span data-stu-id="e4096-368">Set the **Value** to the token that was created using the ArmClient at the end of the last section.</span></span> 
9.  <span data-ttu-id="e4096-369">Select **Body** tab within Postman.</span><span class="sxs-lookup"><span data-stu-id="e4096-369">Select **Body** tab within Postman.</span></span> 
10. <span data-ttu-id="e4096-370">Select the **raw** button option.</span><span class="sxs-lookup"><span data-stu-id="e4096-370">Select the **raw** button option.</span></span>
11. <span data-ttu-id="e4096-371">In the textbox, paste in the below sample budget definition, however you must replace the **subscriptionid**, **budgetname**, and **actiongroupname** parameters with your subscription id, a unique name for your budget, and the action group name you created in both the URL and the request body:</span><span class="sxs-lookup"><span data-stu-id="e4096-371">In the textbox, paste in the below sample budget definition, however you must replace the **subscriptionid**, **budgetname**, and **actiongroupname** parameters with your subscription id, a unique name for your budget, and the action group name you created in both the URL and the request body:</span></span>
    
    ```
        {
            "properties": {
                "category": "Cost",
                "amount": 100.00,
                "timeGrain": "Monthly",
                "timePeriod": {
                "startDate": "2018-06-01T00:00:00Z",
                "endDate": "2018-10-31T00:00:00Z"
                },
                "filters": {
                },
            "notifications": {
                "Actual_GreaterThan_80_Percent": {
                    "enabled": true,
                    "operator": "GreaterThan",
                    "threshold": 80,
                    "contactEmails": [
                    ],
                    "contactRoles": [
                    ],
                    "contactGroups": [
                    "/subscriptions/{subscriptionid}/resourceGroups/{resourcegroupname}/providers/microsoft.insights/actionGroups/{actiongroupname}
                    ]
                }, 
            "Actual_EqualTo_100_Percent": {
                    "operator": "EqualTo",
                    "threshold": 100,
                    "contactGroups": [
                "/subscriptions/{subscriptionid}/resourceGroups/{resourcegroupname}/providers/microsoft.insights/actionGroups/{actiongroupname}"
                    ]
                }
            }
        }
    ```
12. <span data-ttu-id="e4096-372">Press **Send** to send the request.</span><span class="sxs-lookup"><span data-stu-id="e4096-372">Press **Send** to send the request.</span></span>

<span data-ttu-id="e4096-373">You now have all the pieces you need to call the [budgets API](https://docs.microsoft.com/rest/api/consumption/budgets).</span><span class="sxs-lookup"><span data-stu-id="e4096-373">You now have all the pieces you need to call the [budgets API](https://docs.microsoft.com/rest/api/consumption/budgets).</span></span> <span data-ttu-id="e4096-374">The budgets API reference has additional details on the specific requests, including the following:</span><span class="sxs-lookup"><span data-stu-id="e4096-374">The budgets API reference has additional details on the specific requests, including the following:</span></span>
    - <span data-ttu-id="e4096-375">**budgetName** - Multiple budgets are supported.</span><span class="sxs-lookup"><span data-stu-id="e4096-375">**budgetName** - Multiple budgets are supported.</span></span>  <span data-ttu-id="e4096-376">Budget names must be unique.</span><span class="sxs-lookup"><span data-stu-id="e4096-376">Budget names must be unique.</span></span>
    - <span data-ttu-id="e4096-377">**category** - Must be either **Cost** or **Usage**.</span><span class="sxs-lookup"><span data-stu-id="e4096-377">**category** - Must be either **Cost** or **Usage**.</span></span> <span data-ttu-id="e4096-378">The API supports both cost and usage budgets.</span><span class="sxs-lookup"><span data-stu-id="e4096-378">The API supports both cost and usage budgets.</span></span>
    - <span data-ttu-id="e4096-379">**timeGrain** - A monthly, quarterly, or yearly budget.</span><span class="sxs-lookup"><span data-stu-id="e4096-379">**timeGrain** - A monthly, quarterly, or yearly budget.</span></span> <span data-ttu-id="e4096-380">The amount resets at the end of the period.</span><span class="sxs-lookup"><span data-stu-id="e4096-380">The amount resets at the end of the period.</span></span>
    - <span data-ttu-id="e4096-381">**filters** - Filters allow you to narrow the budget to a specific set of resources within the selected scope.</span><span class="sxs-lookup"><span data-stu-id="e4096-381">**filters** - Filters allow you to narrow the budget to a specific set of resources within the selected scope.</span></span> <span data-ttu-id="e4096-382">For example, a filter could be a collection of resource groups for a subscription level budget.</span><span class="sxs-lookup"><span data-stu-id="e4096-382">For example, a filter could be a collection of resource groups for a subscription level budget.</span></span>
    - <span data-ttu-id="e4096-383">**notifications** – Determines the notification details and thresholds.</span><span class="sxs-lookup"><span data-stu-id="e4096-383">**notifications** – Determines the notification details and thresholds.</span></span> <span data-ttu-id="e4096-384">You can set up multiple thresholds and provide an email address or an action group to receive a notification.</span><span class="sxs-lookup"><span data-stu-id="e4096-384">You can set up multiple thresholds and provide an email address or an action group to receive a notification.</span></span>

## <a name="summary"></a><span data-ttu-id="e4096-385">Summary</span><span class="sxs-lookup"><span data-stu-id="e4096-385">Summary</span></span>

<span data-ttu-id="e4096-386">By following this tutorial, you learned:</span><span class="sxs-lookup"><span data-stu-id="e4096-386">By following this tutorial, you learned:</span></span>
- <span data-ttu-id="e4096-387">How to create an Azure Automation Runbook to stop VMs.</span><span class="sxs-lookup"><span data-stu-id="e4096-387">How to create an Azure Automation Runbook to stop VMs.</span></span>
- <span data-ttu-id="e4096-388">How to create an Azure Logic App that is triggered based on the budget threshold values and call the related runbook with the right parameters.</span><span class="sxs-lookup"><span data-stu-id="e4096-388">How to create an Azure Logic App that is triggered based on the budget threshold values and call the related runbook with the right parameters.</span></span>
- <span data-ttu-id="e4096-389">How to create an Azure Monitor Action Group that will was configured to trigger the Azure Logic App when the budget threshold is met.</span><span class="sxs-lookup"><span data-stu-id="e4096-389">How to create an Azure Monitor Action Group that will was configured to trigger the Azure Logic App when the budget threshold is met.</span></span>
- <span data-ttu-id="e4096-390">How to create the Azure budget with the desired thresholds and wire it to the action group.</span><span class="sxs-lookup"><span data-stu-id="e4096-390">How to create the Azure budget with the desired thresholds and wire it to the action group.</span></span>

<span data-ttu-id="e4096-391">You now have a fully functional budget for your subscription that will shut down your VMs when you reach your configured budget thresholds.</span><span class="sxs-lookup"><span data-stu-id="e4096-391">You now have a fully functional budget for your subscription that will shut down your VMs when you reach your configured budget thresholds.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="e4096-392">Next steps</span><span class="sxs-lookup"><span data-stu-id="e4096-392">Next steps</span></span>

- <span data-ttu-id="e4096-393">For more information about Azure billing scenarios, see [Billing and cost management automation scenarios](billing-cost-management-automation-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="e4096-393">For more information about Azure billing scenarios, see [Billing and cost management automation scenarios](billing-cost-management-automation-scenarios.md).</span></span>
