---
title: Azure Service Bus paired namespaces | Microsoft Docs
description: Paired namespace implementation details and cost
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: ''
ms.assetid: 2440c8d3-ed2e-47e0-93cf-ab7fbb855d2e
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 02/16/2017
ms.author: sethm
ms.openlocfilehash: 9ed2b16ba5feb8413e13b77d255c630687d19e05
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44549933"
---
# <a name="paired-namespace-implementation-details-and-cost-implications"></a><span data-ttu-id="28f0e-103">Paired namespace implementation details and cost implications</span><span class="sxs-lookup"><span data-stu-id="28f0e-103">Paired namespace implementation details and cost implications</span></span>
<span data-ttu-id="28f0e-104">The [PairNamespaceAsync][PairNamespaceAsync] method, using a [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance, performs visible tasks on your behalf.</span><span class="sxs-lookup"><span data-stu-id="28f0e-104">The [PairNamespaceAsync][PairNamespaceAsync] method, using a [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance, performs visible tasks on your behalf.</span></span> <span data-ttu-id="28f0e-105">Because there are cost considerations when using the feature, it is useful to understand those tasks so that you expect the behavior when it happens.</span><span class="sxs-lookup"><span data-stu-id="28f0e-105">Because there are cost considerations when using the feature, it is useful to understand those tasks so that you expect the behavior when it happens.</span></span> <span data-ttu-id="28f0e-106">The API engages the following automatic behavior on your behalf:</span><span class="sxs-lookup"><span data-stu-id="28f0e-106">The API engages the following automatic behavior on your behalf:</span></span>

* <span data-ttu-id="28f0e-107">Creation of backlog queues.</span><span class="sxs-lookup"><span data-stu-id="28f0e-107">Creation of backlog queues.</span></span>
* <span data-ttu-id="28f0e-108">Creation of a [MessageSender][MessageSender] object that talks to queues or topics.</span><span class="sxs-lookup"><span data-stu-id="28f0e-108">Creation of a [MessageSender][MessageSender] object that talks to queues or topics.</span></span>
* <span data-ttu-id="28f0e-109">When a messaging entity becomes unavailable, sends ping messages to the entity in an attempt to detect when that entity becomes available again.</span><span class="sxs-lookup"><span data-stu-id="28f0e-109">When a messaging entity becomes unavailable, sends ping messages to the entity in an attempt to detect when that entity becomes available again.</span></span>
* <span data-ttu-id="28f0e-110">Optionally creates of a set of “message pumps” that move messages from the backlog queues to the primary queues.</span><span class="sxs-lookup"><span data-stu-id="28f0e-110">Optionally creates of a set of “message pumps” that move messages from the backlog queues to the primary queues.</span></span>
* <span data-ttu-id="28f0e-111">Coordinates closing/faulting of the primary and secondary [MessagingFactory][MessagingFactory] instances.</span><span class="sxs-lookup"><span data-stu-id="28f0e-111">Coordinates closing/faulting of the primary and secondary [MessagingFactory][MessagingFactory] instances.</span></span>

<span data-ttu-id="28f0e-112">At a high level, the feature works as follows: when the primary entity is healthy, no behavior changes occur.</span><span class="sxs-lookup"><span data-stu-id="28f0e-112">At a high level, the feature works as follows: when the primary entity is healthy, no behavior changes occur.</span></span> <span data-ttu-id="28f0e-113">When the [FailoverInterval][FailoverInterval] duration elapses, and the primary entity sees no successful sends after a non-transient [MessagingException][MessagingException] or a [TimeoutException][TimeoutException], the following behavior occurs:</span><span class="sxs-lookup"><span data-stu-id="28f0e-113">When the [FailoverInterval][FailoverInterval] duration elapses, and the primary entity sees no successful sends after a non-transient [MessagingException][MessagingException] or a [TimeoutException][TimeoutException], the following behavior occurs:</span></span>

1. <span data-ttu-id="28f0e-114">Send operations to the primary entity are disabled and the system pings the primary entity until pings can be successfully delivered.</span><span class="sxs-lookup"><span data-stu-id="28f0e-114">Send operations to the primary entity are disabled and the system pings the primary entity until pings can be successfully delivered.</span></span>
2. <span data-ttu-id="28f0e-115">A random backlog queue is selected.</span><span class="sxs-lookup"><span data-stu-id="28f0e-115">A random backlog queue is selected.</span></span>
3. <span data-ttu-id="28f0e-116">[BrokeredMessage][BrokeredMessage] objects are routed to the chosen backlog queue.</span><span class="sxs-lookup"><span data-stu-id="28f0e-116">[BrokeredMessage][BrokeredMessage] objects are routed to the chosen backlog queue.</span></span>
4. <span data-ttu-id="28f0e-117">If a send operation to the chosen backlog queue fails, that queue is pulled from the rotation and a new queue is selected.</span><span class="sxs-lookup"><span data-stu-id="28f0e-117">If a send operation to the chosen backlog queue fails, that queue is pulled from the rotation and a new queue is selected.</span></span> <span data-ttu-id="28f0e-118">All senders on the [MessagingFactory][MessagingFactory] instance learn of the failure.</span><span class="sxs-lookup"><span data-stu-id="28f0e-118">All senders on the [MessagingFactory][MessagingFactory] instance learn of the failure.</span></span>

<span data-ttu-id="28f0e-119">The following figures depict the sequence.</span><span class="sxs-lookup"><span data-stu-id="28f0e-119">The following figures depict the sequence.</span></span> <span data-ttu-id="28f0e-120">First, the sender sends messages.</span><span class="sxs-lookup"><span data-stu-id="28f0e-120">First, the sender sends messages.</span></span>

![Paired Namespaces][0]

<span data-ttu-id="28f0e-122">Upon failure to send to the primary queue, the sender begins sending messages to a randomly chosen backlog queue.</span><span class="sxs-lookup"><span data-stu-id="28f0e-122">Upon failure to send to the primary queue, the sender begins sending messages to a randomly chosen backlog queue.</span></span> <span data-ttu-id="28f0e-123">Simultaneously, it starts a ping task.</span><span class="sxs-lookup"><span data-stu-id="28f0e-123">Simultaneously, it starts a ping task.</span></span>

![Paired Namespaces][1]

<span data-ttu-id="28f0e-125">At this point the messages are still in the secondary queue and have not been delivered to the primary queue.</span><span class="sxs-lookup"><span data-stu-id="28f0e-125">At this point the messages are still in the secondary queue and have not been delivered to the primary queue.</span></span> <span data-ttu-id="28f0e-126">Once the primary queue is healthy again, at least one process should be running the syphon.</span><span class="sxs-lookup"><span data-stu-id="28f0e-126">Once the primary queue is healthy again, at least one process should be running the syphon.</span></span> <span data-ttu-id="28f0e-127">The syphon delivers the messages from all the various backlog queues to the proper destination entities (queues and topics).</span><span class="sxs-lookup"><span data-stu-id="28f0e-127">The syphon delivers the messages from all the various backlog queues to the proper destination entities (queues and topics).</span></span>

![Paired Namespaces][2]

<span data-ttu-id="28f0e-129">The remainder of this topic discusses the specific details of how these pieces work.</span><span class="sxs-lookup"><span data-stu-id="28f0e-129">The remainder of this topic discusses the specific details of how these pieces work.</span></span>

## <a name="creation-of-backlog-queues"></a><span data-ttu-id="28f0e-130">Creation of backlog queues</span><span class="sxs-lookup"><span data-stu-id="28f0e-130">Creation of backlog queues</span></span>
<span data-ttu-id="28f0e-131">The [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] object passed to the [PairNamespaceAsync][PairNamespaceAsync] method indicates the number of backlog queues you want to use.</span><span class="sxs-lookup"><span data-stu-id="28f0e-131">The [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] object passed to the [PairNamespaceAsync][PairNamespaceAsync] method indicates the number of backlog queues you want to use.</span></span> <span data-ttu-id="28f0e-132">Each backlog queue is then created with the following properties explicitly set (all other values are set to the [QueueDescription][QueueDescription] defaults):</span><span class="sxs-lookup"><span data-stu-id="28f0e-132">Each backlog queue is then created with the following properties explicitly set (all other values are set to the [QueueDescription][QueueDescription] defaults):</span></span>

| <span data-ttu-id="28f0e-133">Path</span><span class="sxs-lookup"><span data-stu-id="28f0e-133">Path</span></span> | <span data-ttu-id="28f0e-134">[primary namespace]/x-servicebus-transfer/[index] where [index] is a value in [0, BacklogQueueCount)</span><span class="sxs-lookup"><span data-stu-id="28f0e-134">[primary namespace]/x-servicebus-transfer/[index] where [index] is a value in [0, BacklogQueueCount)</span></span> |
| --- | --- |
| <span data-ttu-id="28f0e-135">MaxSizeInMegabytes</span><span class="sxs-lookup"><span data-stu-id="28f0e-135">MaxSizeInMegabytes</span></span> |<span data-ttu-id="28f0e-136">5120</span><span class="sxs-lookup"><span data-stu-id="28f0e-136">5120</span></span> |
| <span data-ttu-id="28f0e-137">MaxDeliveryCount</span><span class="sxs-lookup"><span data-stu-id="28f0e-137">MaxDeliveryCount</span></span> |<span data-ttu-id="28f0e-138">int.MaxValue</span><span class="sxs-lookup"><span data-stu-id="28f0e-138">int.MaxValue</span></span> |
| <span data-ttu-id="28f0e-139">DefaultMessageTimeToLive</span><span class="sxs-lookup"><span data-stu-id="28f0e-139">DefaultMessageTimeToLive</span></span> |<span data-ttu-id="28f0e-140">TimeSpan.MaxValue</span><span class="sxs-lookup"><span data-stu-id="28f0e-140">TimeSpan.MaxValue</span></span> |
| <span data-ttu-id="28f0e-141">AutoDeleteOnIdle</span><span class="sxs-lookup"><span data-stu-id="28f0e-141">AutoDeleteOnIdle</span></span> |<span data-ttu-id="28f0e-142">TimeSpan.MaxValue</span><span class="sxs-lookup"><span data-stu-id="28f0e-142">TimeSpan.MaxValue</span></span> |
| <span data-ttu-id="28f0e-143">LockDuration</span><span class="sxs-lookup"><span data-stu-id="28f0e-143">LockDuration</span></span> |<span data-ttu-id="28f0e-144">1 minute</span><span class="sxs-lookup"><span data-stu-id="28f0e-144">1 minute</span></span> |
| <span data-ttu-id="28f0e-145">EnableDeadLetteringOnMessageExpiration</span><span class="sxs-lookup"><span data-stu-id="28f0e-145">EnableDeadLetteringOnMessageExpiration</span></span> |<span data-ttu-id="28f0e-146">true</span><span class="sxs-lookup"><span data-stu-id="28f0e-146">true</span></span> |
| <span data-ttu-id="28f0e-147">EnableBatchedOperations</span><span class="sxs-lookup"><span data-stu-id="28f0e-147">EnableBatchedOperations</span></span> |<span data-ttu-id="28f0e-148">true</span><span class="sxs-lookup"><span data-stu-id="28f0e-148">true</span></span> |

<span data-ttu-id="28f0e-149">For example, the first backlog queue created for namespace **contoso** is named `contoso/x-servicebus-transfer/0`.</span><span class="sxs-lookup"><span data-stu-id="28f0e-149">For example, the first backlog queue created for namespace **contoso** is named `contoso/x-servicebus-transfer/0`.</span></span>

<span data-ttu-id="28f0e-150">When creating the queues, the code first checks to see if such a queue exists.</span><span class="sxs-lookup"><span data-stu-id="28f0e-150">When creating the queues, the code first checks to see if such a queue exists.</span></span> <span data-ttu-id="28f0e-151">If the queue does not exist, then the queue is created.</span><span class="sxs-lookup"><span data-stu-id="28f0e-151">If the queue does not exist, then the queue is created.</span></span> <span data-ttu-id="28f0e-152">The code does not clean up "extra" backlog queues.</span><span class="sxs-lookup"><span data-stu-id="28f0e-152">The code does not clean up "extra" backlog queues.</span></span> <span data-ttu-id="28f0e-153">Specifically, if the application with the primary namespace **contoso** requests five backlog queues but a backlog queue with the path `contoso/x-servicebus-transfer/7` exists, that extra backlog queue is still present but is not used.</span><span class="sxs-lookup"><span data-stu-id="28f0e-153">Specifically, if the application with the primary namespace **contoso** requests five backlog queues but a backlog queue with the path `contoso/x-servicebus-transfer/7` exists, that extra backlog queue is still present but is not used.</span></span> <span data-ttu-id="28f0e-154">The system explicitly allows extra backlog queues to exist that would not be used.</span><span class="sxs-lookup"><span data-stu-id="28f0e-154">The system explicitly allows extra backlog queues to exist that would not be used.</span></span> <span data-ttu-id="28f0e-155">As the namespace owner, you are responsible for cleaning up any unused/unwanted backlog queues.</span><span class="sxs-lookup"><span data-stu-id="28f0e-155">As the namespace owner, you are responsible for cleaning up any unused/unwanted backlog queues.</span></span> <span data-ttu-id="28f0e-156">The reason for this decision is that Service Bus cannot know what purposes exist for all the queues in your namespace.</span><span class="sxs-lookup"><span data-stu-id="28f0e-156">The reason for this decision is that Service Bus cannot know what purposes exist for all the queues in your namespace.</span></span> <span data-ttu-id="28f0e-157">Furthermore, if a queue exists with the given name but does not meet the assumed [QueueDescription][QueueDescription], then your reasons are your own for changing the default behavior.</span><span class="sxs-lookup"><span data-stu-id="28f0e-157">Furthermore, if a queue exists with the given name but does not meet the assumed [QueueDescription][QueueDescription], then your reasons are your own for changing the default behavior.</span></span> <span data-ttu-id="28f0e-158">No guarantees are made for modifications to the backlog queues by your code.</span><span class="sxs-lookup"><span data-stu-id="28f0e-158">No guarantees are made for modifications to the backlog queues by your code.</span></span> <span data-ttu-id="28f0e-159">Make sure to test your changes thoroughly.</span><span class="sxs-lookup"><span data-stu-id="28f0e-159">Make sure to test your changes thoroughly.</span></span>

## <a name="custom-messagesender"></a><span data-ttu-id="28f0e-160">Custom MessageSender</span><span class="sxs-lookup"><span data-stu-id="28f0e-160">Custom MessageSender</span></span>
<span data-ttu-id="28f0e-161">When sending, all messages go through an internal [MessageSender][MessageSender] object that behaves normally when everything works, and redirects to the backlog queues when things "break."</span><span class="sxs-lookup"><span data-stu-id="28f0e-161">When sending, all messages go through an internal [MessageSender][MessageSender] object that behaves normally when everything works, and redirects to the backlog queues when things "break."</span></span> <span data-ttu-id="28f0e-162">Upon receiving a non-transient failure, a timer starts.</span><span class="sxs-lookup"><span data-stu-id="28f0e-162">Upon receiving a non-transient failure, a timer starts.</span></span> <span data-ttu-id="28f0e-163">After a [TimeSpan][TimeSpan] period consisting of the [FailoverInterval][FailoverInterval] property value during which no successful messages are sent, the failover is engaged.</span><span class="sxs-lookup"><span data-stu-id="28f0e-163">After a [TimeSpan][TimeSpan] period consisting of the [FailoverInterval][FailoverInterval] property value during which no successful messages are sent, the failover is engaged.</span></span> <span data-ttu-id="28f0e-164">At this point, the following things happen for each entity:</span><span class="sxs-lookup"><span data-stu-id="28f0e-164">At this point, the following things happen for each entity:</span></span>

* <span data-ttu-id="28f0e-165">A ping task executes every [PingPrimaryInterval][PingPrimaryInterval] to check if the entity is available.</span><span class="sxs-lookup"><span data-stu-id="28f0e-165">A ping task executes every [PingPrimaryInterval][PingPrimaryInterval] to check if the entity is available.</span></span> <span data-ttu-id="28f0e-166">Once this task succeeds, all client code that uses the entity immediately starts sending new messages to the primary namespace.</span><span class="sxs-lookup"><span data-stu-id="28f0e-166">Once this task succeeds, all client code that uses the entity immediately starts sending new messages to the primary namespace.</span></span>
* <span data-ttu-id="28f0e-167">Future requests to send to that same entity from any other senders will result in the [BrokeredMessage][BrokeredMessage] being sent to be modified to sit in the backlog queue.</span><span class="sxs-lookup"><span data-stu-id="28f0e-167">Future requests to send to that same entity from any other senders will result in the [BrokeredMessage][BrokeredMessage] being sent to be modified to sit in the backlog queue.</span></span> <span data-ttu-id="28f0e-168">The modification removes some properties from the [BrokeredMessage][BrokeredMessage] object and stores them elsewhere.</span><span class="sxs-lookup"><span data-stu-id="28f0e-168">The modification removes some properties from the [BrokeredMessage][BrokeredMessage] object and stores them elsewhere.</span></span> <span data-ttu-id="28f0e-169">The following properties are cleared and added under a new alias, allowing Service Bus and the SDK to process messages uniformly:</span><span class="sxs-lookup"><span data-stu-id="28f0e-169">The following properties are cleared and added under a new alias, allowing Service Bus and the SDK to process messages uniformly:</span></span>

| <span data-ttu-id="28f0e-170">Old Property Name</span><span class="sxs-lookup"><span data-stu-id="28f0e-170">Old Property Name</span></span> | <span data-ttu-id="28f0e-171">New Property Name</span><span class="sxs-lookup"><span data-stu-id="28f0e-171">New Property Name</span></span> |
| --- | --- |
| <span data-ttu-id="28f0e-172">SessionId</span><span class="sxs-lookup"><span data-stu-id="28f0e-172">SessionId</span></span> |<span data-ttu-id="28f0e-173">x-ms-sessionid</span><span class="sxs-lookup"><span data-stu-id="28f0e-173">x-ms-sessionid</span></span> |
| <span data-ttu-id="28f0e-174">TimeToLive</span><span class="sxs-lookup"><span data-stu-id="28f0e-174">TimeToLive</span></span> |<span data-ttu-id="28f0e-175">x-ms-timetolive</span><span class="sxs-lookup"><span data-stu-id="28f0e-175">x-ms-timetolive</span></span> |
| <span data-ttu-id="28f0e-176">ScheduledEnqueueTimeUtc</span><span class="sxs-lookup"><span data-stu-id="28f0e-176">ScheduledEnqueueTimeUtc</span></span> |<span data-ttu-id="28f0e-177">x-ms-path</span><span class="sxs-lookup"><span data-stu-id="28f0e-177">x-ms-path</span></span> |

<span data-ttu-id="28f0e-178">The original destination path is also stored within the message as a property named x-ms-path.</span><span class="sxs-lookup"><span data-stu-id="28f0e-178">The original destination path is also stored within the message as a property named x-ms-path.</span></span> <span data-ttu-id="28f0e-179">This design allows messages for many entities to coexist in a single backlog queue.</span><span class="sxs-lookup"><span data-stu-id="28f0e-179">This design allows messages for many entities to coexist in a single backlog queue.</span></span> <span data-ttu-id="28f0e-180">The properties are translated back by the syphon.</span><span class="sxs-lookup"><span data-stu-id="28f0e-180">The properties are translated back by the syphon.</span></span>

<span data-ttu-id="28f0e-181">The custom [MessageSender][MessageSender] object can encounter issues when messages approach the 256-KB limit and failover is engaged.</span><span class="sxs-lookup"><span data-stu-id="28f0e-181">The custom [MessageSender][MessageSender] object can encounter issues when messages approach the 256-KB limit and failover is engaged.</span></span> <span data-ttu-id="28f0e-182">The custom [MessageSender][MessageSender] object stores messages for all queues and topics together in the backlog queues.</span><span class="sxs-lookup"><span data-stu-id="28f0e-182">The custom [MessageSender][MessageSender] object stores messages for all queues and topics together in the backlog queues.</span></span> <span data-ttu-id="28f0e-183">This object mixes messages from many primaries together within the backlog queues.</span><span class="sxs-lookup"><span data-stu-id="28f0e-183">This object mixes messages from many primaries together within the backlog queues.</span></span> <span data-ttu-id="28f0e-184">To handle load balancing among many clients that do not know each other, the SDK randomly picks one backlog queue for each [QueueClient][QueueClient] or [TopicClient][TopicClient] you create in code.</span><span class="sxs-lookup"><span data-stu-id="28f0e-184">To handle load balancing among many clients that do not know each other, the SDK randomly picks one backlog queue for each [QueueClient][QueueClient] or [TopicClient][TopicClient] you create in code.</span></span>

## <a name="pings"></a><span data-ttu-id="28f0e-185">Pings</span><span class="sxs-lookup"><span data-stu-id="28f0e-185">Pings</span></span>
<span data-ttu-id="28f0e-186">A ping message is an empty [BrokeredMessage][BrokeredMessage] with its [ContentType][ContentType] property set to application/vnd.ms-servicebus-ping and a [TimeToLive][TimeToLive] value of 1 second.</span><span class="sxs-lookup"><span data-stu-id="28f0e-186">A ping message is an empty [BrokeredMessage][BrokeredMessage] with its [ContentType][ContentType] property set to application/vnd.ms-servicebus-ping and a [TimeToLive][TimeToLive] value of 1 second.</span></span> <span data-ttu-id="28f0e-187">This ping has one special characteristic in Service Bus: the server never delivers a ping when any caller requests a [BrokeredMessage][BrokeredMessage].</span><span class="sxs-lookup"><span data-stu-id="28f0e-187">This ping has one special characteristic in Service Bus: the server never delivers a ping when any caller requests a [BrokeredMessage][BrokeredMessage].</span></span> <span data-ttu-id="28f0e-188">Thus, you never have to learn how to receive and ignore these messages.</span><span class="sxs-lookup"><span data-stu-id="28f0e-188">Thus, you never have to learn how to receive and ignore these messages.</span></span> <span data-ttu-id="28f0e-189">Each entity (unique queue or topic) per [MessagingFactory][MessagingFactory] instance per client will be pinged when they are considered to be unavailable.</span><span class="sxs-lookup"><span data-stu-id="28f0e-189">Each entity (unique queue or topic) per [MessagingFactory][MessagingFactory] instance per client will be pinged when they are considered to be unavailable.</span></span> <span data-ttu-id="28f0e-190">By default, this happens once per minute.</span><span class="sxs-lookup"><span data-stu-id="28f0e-190">By default, this happens once per minute.</span></span> <span data-ttu-id="28f0e-191">Ping messages are considered to be regular Service Bus messages, and can result in charges for bandwidth and messages.</span><span class="sxs-lookup"><span data-stu-id="28f0e-191">Ping messages are considered to be regular Service Bus messages, and can result in charges for bandwidth and messages.</span></span> <span data-ttu-id="28f0e-192">As soon as the clients detect that the system is available, the messages stop.</span><span class="sxs-lookup"><span data-stu-id="28f0e-192">As soon as the clients detect that the system is available, the messages stop.</span></span>

## <a name="the-syphon"></a><span data-ttu-id="28f0e-193">The syphon</span><span class="sxs-lookup"><span data-stu-id="28f0e-193">The syphon</span></span>
<span data-ttu-id="28f0e-194">At least one executable program in the application should be actively running the syphon.</span><span class="sxs-lookup"><span data-stu-id="28f0e-194">At least one executable program in the application should be actively running the syphon.</span></span> <span data-ttu-id="28f0e-195">The syphon performs a long poll receive that lasts 15 minutes.</span><span class="sxs-lookup"><span data-stu-id="28f0e-195">The syphon performs a long poll receive that lasts 15 minutes.</span></span> <span data-ttu-id="28f0e-196">When all entities are available and you have 10 backlog queues, the application that hosts the syphon calls the receive operation 40 times per hour, 960 times per day, and 28800 times in 30 days.</span><span class="sxs-lookup"><span data-stu-id="28f0e-196">When all entities are available and you have 10 backlog queues, the application that hosts the syphon calls the receive operation 40 times per hour, 960 times per day, and 28800 times in 30 days.</span></span> <span data-ttu-id="28f0e-197">When the syphon is actively moving messages from the backlog to the primary queue, each message experiences the following charges (standard charges for message size and bandwidth apply in all stages):</span><span class="sxs-lookup"><span data-stu-id="28f0e-197">When the syphon is actively moving messages from the backlog to the primary queue, each message experiences the following charges (standard charges for message size and bandwidth apply in all stages):</span></span>

1. <span data-ttu-id="28f0e-198">Send to the backlog.</span><span class="sxs-lookup"><span data-stu-id="28f0e-198">Send to the backlog.</span></span>
2. <span data-ttu-id="28f0e-199">Receive from the backlog.</span><span class="sxs-lookup"><span data-stu-id="28f0e-199">Receive from the backlog.</span></span>
3. <span data-ttu-id="28f0e-200">Send to the primary.</span><span class="sxs-lookup"><span data-stu-id="28f0e-200">Send to the primary.</span></span>
4. <span data-ttu-id="28f0e-201">Receive from the primary.</span><span class="sxs-lookup"><span data-stu-id="28f0e-201">Receive from the primary.</span></span>

## <a name="closefault-behavior"></a><span data-ttu-id="28f0e-202">Close/fault behavior</span><span class="sxs-lookup"><span data-stu-id="28f0e-202">Close/fault behavior</span></span>
<span data-ttu-id="28f0e-203">Within an application that hosts the syphon, once the primary or secondary [MessagingFactory][MessagingFactory] faults or is closed without its partner also being faulted/closed and the syphon detects this state, the syphon acts.</span><span class="sxs-lookup"><span data-stu-id="28f0e-203">Within an application that hosts the syphon, once the primary or secondary [MessagingFactory][MessagingFactory] faults or is closed without its partner also being faulted/closed and the syphon detects this state, the syphon acts.</span></span> <span data-ttu-id="28f0e-204">If the other [MessagingFactory][MessagingFactory] is not closed within 5 seconds, the syphon will fault the still open [MessagingFactory][MessagingFactory].</span><span class="sxs-lookup"><span data-stu-id="28f0e-204">If the other [MessagingFactory][MessagingFactory] is not closed within 5 seconds, the syphon will fault the still open [MessagingFactory][MessagingFactory].</span></span>

## <a name="next-steps"></a><span data-ttu-id="28f0e-205">Next steps</span><span class="sxs-lookup"><span data-stu-id="28f0e-205">Next steps</span></span>
<span data-ttu-id="28f0e-206">See [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability] for a detailed discussion of Service Bus asynchronous messaging.</span><span class="sxs-lookup"><span data-stu-id="28f0e-206">See [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability] for a detailed discussion of Service Bus asynchronous messaging.</span></span> 

[PairNamespaceAsync]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PairNamespaceAsync_Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_
[SendAvailabilityPairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[FailoverInterval]: /dotnet/api/microsoft.servicebus.messaging.pairednamespaceoptions#Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_FailoverInterval
[MessagingException]: /dotnet/api/microsoft.servicebus.messaging.messagingexception
[TimeoutException]: https://msdn.microsoft.com/library/azure/system.timeoutexception.aspx
[BrokeredMessage]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage
[QueueDescription]: /dotnet/api/microsoft.servicebus.messaging.queuedescription
[TimeSpan]: https://msdn.microsoft.com/library/azure/system.timespan.aspx
[PingPrimaryInterval]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_PingPrimaryInterval
[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[TopicClient]: /dotnet/api/microsoft.servicebus.messaging.topicclient
[ContentType]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_ContentType
[TimeToLive]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md
[0]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-bus-messaging/media/service-bus-paired-namespaces/IC673405.png
[1]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-bus-messaging/media/service-bus-paired-namespaces/IC673406.png
[2]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-bus-messaging/media/service-bus-paired-namespaces/IC673407.png



