---
title: Azure Service Bus message processing architecture overview | Microsoft Docs
description: Describes the message and relay processing architecture of Azure Service Bus.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: ''
ms.assetid: baf94c2d-0e58-4d5d-a588-767f996ccf7f
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/22/2017
ms.author: sethm
ms.openlocfilehash: 7509fa2dc6334d5ccb2bb69e38f46782c75a1e6a
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44548761"
---
# <a name="service-bus-architecture"></a><span data-ttu-id="f6010-103">Service Bus architecture</span><span class="sxs-lookup"><span data-stu-id="f6010-103">Service Bus architecture</span></span>
<span data-ttu-id="f6010-104">This article describes the message processing architecture of Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f6010-104">This article describes the message processing architecture of Azure Service Bus.</span></span>

## <a name="service-bus-scale-units"></a><span data-ttu-id="f6010-105">Service Bus scale units</span><span class="sxs-lookup"><span data-stu-id="f6010-105">Service Bus scale units</span></span>
<span data-ttu-id="f6010-106">Service Bus is organized by *scale units*.</span><span class="sxs-lookup"><span data-stu-id="f6010-106">Service Bus is organized by *scale units*.</span></span> <span data-ttu-id="f6010-107">A scale unit is a unit of deployment and contains all components required run the service.</span><span class="sxs-lookup"><span data-stu-id="f6010-107">A scale unit is a unit of deployment and contains all components required run the service.</span></span> <span data-ttu-id="f6010-108">Each region deploys one or more Service Bus scale units.</span><span class="sxs-lookup"><span data-stu-id="f6010-108">Each region deploys one or more Service Bus scale units.</span></span>

<span data-ttu-id="f6010-109">A Service Bus namespace is mapped to a scale unit.</span><span class="sxs-lookup"><span data-stu-id="f6010-109">A Service Bus namespace is mapped to a scale unit.</span></span> <span data-ttu-id="f6010-110">The scale unit handles all types of Service Bus entities: relays and brokered messaging entities (queues, topics, subscriptions).</span><span class="sxs-lookup"><span data-stu-id="f6010-110">The scale unit handles all types of Service Bus entities: relays and brokered messaging entities (queues, topics, subscriptions).</span></span> <span data-ttu-id="f6010-111">A Service Bus scale unit consists of the following components:</span><span class="sxs-lookup"><span data-stu-id="f6010-111">A Service Bus scale unit consists of the following components:</span></span>

* <span data-ttu-id="f6010-112">**A set of gateway nodes.**</span><span class="sxs-lookup"><span data-stu-id="f6010-112">**A set of gateway nodes.**</span></span> <span data-ttu-id="f6010-113">Gateway nodes authenticate incoming requests and handle relay requests.</span><span class="sxs-lookup"><span data-stu-id="f6010-113">Gateway nodes authenticate incoming requests and handle relay requests.</span></span> <span data-ttu-id="f6010-114">Each gateway node has a public IP address.</span><span class="sxs-lookup"><span data-stu-id="f6010-114">Each gateway node has a public IP address.</span></span>
* <span data-ttu-id="f6010-115">**A set of messaging broker nodes.**</span><span class="sxs-lookup"><span data-stu-id="f6010-115">**A set of messaging broker nodes.**</span></span> <span data-ttu-id="f6010-116">Messaging broker nodes process requests concerning messaging entities.</span><span class="sxs-lookup"><span data-stu-id="f6010-116">Messaging broker nodes process requests concerning messaging entities.</span></span>
* <span data-ttu-id="f6010-117">**One gateway store.**</span><span class="sxs-lookup"><span data-stu-id="f6010-117">**One gateway store.**</span></span> <span data-ttu-id="f6010-118">The gateway store holds the data for every entity that is defined in this scale unit.</span><span class="sxs-lookup"><span data-stu-id="f6010-118">The gateway store holds the data for every entity that is defined in this scale unit.</span></span> <span data-ttu-id="f6010-119">The gateway store is implemented on top of a SQL Azure database.</span><span class="sxs-lookup"><span data-stu-id="f6010-119">The gateway store is implemented on top of a SQL Azure database.</span></span>
* <span data-ttu-id="f6010-120">**Multiple messaging stores.**</span><span class="sxs-lookup"><span data-stu-id="f6010-120">**Multiple messaging stores.**</span></span> <span data-ttu-id="f6010-121">Messaging stores hold the messages of all queues, topics and subscriptions that are defined in this scale unit.</span><span class="sxs-lookup"><span data-stu-id="f6010-121">Messaging stores hold the messages of all queues, topics and subscriptions that are defined in this scale unit.</span></span> <span data-ttu-id="f6010-122">It also contains all subscription data.</span><span class="sxs-lookup"><span data-stu-id="f6010-122">It also contains all subscription data.</span></span> <span data-ttu-id="f6010-123">Unless [partitioned messaging entities](service-bus-partitioning.md) is enabled, a queue or topic is mapped to one messaging store.</span><span class="sxs-lookup"><span data-stu-id="f6010-123">Unless [partitioned messaging entities](service-bus-partitioning.md) is enabled, a queue or topic is mapped to one messaging store.</span></span> <span data-ttu-id="f6010-124">Subscriptions are stored in the same messaging store as their parent topic.</span><span class="sxs-lookup"><span data-stu-id="f6010-124">Subscriptions are stored in the same messaging store as their parent topic.</span></span> <span data-ttu-id="f6010-125">Except for Service Bus [Premium Messaging](service-bus-premium-messaging.md), the messaging stores are implemented on top of SQL Azure databases.</span><span class="sxs-lookup"><span data-stu-id="f6010-125">Except for Service Bus [Premium Messaging](service-bus-premium-messaging.md), the messaging stores are implemented on top of SQL Azure databases.</span></span>

## <a name="containers"></a><span data-ttu-id="f6010-126">Containers</span><span class="sxs-lookup"><span data-stu-id="f6010-126">Containers</span></span>
<span data-ttu-id="f6010-127">Each messaging entity is assigned a specific container.</span><span class="sxs-lookup"><span data-stu-id="f6010-127">Each messaging entity is assigned a specific container.</span></span> <span data-ttu-id="f6010-128">A container is a logical construct that uses exactly one messaging store to store all relevant data for this container.</span><span class="sxs-lookup"><span data-stu-id="f6010-128">A container is a logical construct that uses exactly one messaging store to store all relevant data for this container.</span></span> <span data-ttu-id="f6010-129">Each container is assigned to a messaging broker node.</span><span class="sxs-lookup"><span data-stu-id="f6010-129">Each container is assigned to a messaging broker node.</span></span> <span data-ttu-id="f6010-130">Typically, there are more containers than messaging broker nodes.</span><span class="sxs-lookup"><span data-stu-id="f6010-130">Typically, there are more containers than messaging broker nodes.</span></span> <span data-ttu-id="f6010-131">Therefore, each messaging broker node loads multiple containers.</span><span class="sxs-lookup"><span data-stu-id="f6010-131">Therefore, each messaging broker node loads multiple containers.</span></span> <span data-ttu-id="f6010-132">The distribution of containers to a messaging broker node is organized such that all messaging broker nodes are equally loaded.</span><span class="sxs-lookup"><span data-stu-id="f6010-132">The distribution of containers to a messaging broker node is organized such that all messaging broker nodes are equally loaded.</span></span> <span data-ttu-id="f6010-133">If the load pattern changes (for example, one of the containers gets very busy), or if a messaging broker node becomes temporarily unavailable, the containers are redistributed among the messaging broker nodes.</span><span class="sxs-lookup"><span data-stu-id="f6010-133">If the load pattern changes (for example, one of the containers gets very busy), or if a messaging broker node becomes temporarily unavailable, the containers are redistributed among the messaging broker nodes.</span></span>

## <a name="processing-of-incoming-messaging-requests"></a><span data-ttu-id="f6010-134">Processing of incoming messaging requests</span><span class="sxs-lookup"><span data-stu-id="f6010-134">Processing of incoming messaging requests</span></span>
<span data-ttu-id="f6010-135">When a client sends a request to Service Bus, the Azure load balancer routes it to any of the gateway nodes.</span><span class="sxs-lookup"><span data-stu-id="f6010-135">When a client sends a request to Service Bus, the Azure load balancer routes it to any of the gateway nodes.</span></span> <span data-ttu-id="f6010-136">The gateway node authorizes the request.</span><span class="sxs-lookup"><span data-stu-id="f6010-136">The gateway node authorizes the request.</span></span> <span data-ttu-id="f6010-137">If the request concerns a messaging entity (queue, topic, subscription), the gateway node looks up the entity in the gateway store and determines in which messaging store the entity is located.</span><span class="sxs-lookup"><span data-stu-id="f6010-137">If the request concerns a messaging entity (queue, topic, subscription), the gateway node looks up the entity in the gateway store and determines in which messaging store the entity is located.</span></span> <span data-ttu-id="f6010-138">It then looks up which messaging broker node is currently servicing this container, and sends the request to that messaging broker node.</span><span class="sxs-lookup"><span data-stu-id="f6010-138">It then looks up which messaging broker node is currently servicing this container, and sends the request to that messaging broker node.</span></span> <span data-ttu-id="f6010-139">The messaging broker node processes the request and updates the entity state in the container store.</span><span class="sxs-lookup"><span data-stu-id="f6010-139">The messaging broker node processes the request and updates the entity state in the container store.</span></span> <span data-ttu-id="f6010-140">The messaging broker node then sends the response back to the gateway node, which sends an appropriate response back to the client that issued the original request.</span><span class="sxs-lookup"><span data-stu-id="f6010-140">The messaging broker node then sends the response back to the gateway node, which sends an appropriate response back to the client that issued the original request.</span></span>

![Processing of Incoming Messaging Requests](https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-bus-messaging/media/service-bus-architecture/IC690644.png)

## <a name="processing-of-incoming-relay-requests"></a><span data-ttu-id="f6010-142">Processing of incoming relay requests</span><span class="sxs-lookup"><span data-stu-id="f6010-142">Processing of incoming relay requests</span></span>
<span data-ttu-id="f6010-143">When a client sends a request to Service Bus, the Azure load balancer routes it to any of the gateway nodes.</span><span class="sxs-lookup"><span data-stu-id="f6010-143">When a client sends a request to Service Bus, the Azure load balancer routes it to any of the gateway nodes.</span></span> <span data-ttu-id="f6010-144">If the request is a listening request, the gateway node creates a new relay.</span><span class="sxs-lookup"><span data-stu-id="f6010-144">If the request is a listening request, the gateway node creates a new relay.</span></span> <span data-ttu-id="f6010-145">If the request is a connection request to a specific relay, the gateway node forwards the connection request to the gateway node that owns the relay.</span><span class="sxs-lookup"><span data-stu-id="f6010-145">If the request is a connection request to a specific relay, the gateway node forwards the connection request to the gateway node that owns the relay.</span></span> <span data-ttu-id="f6010-146">The gateway node that owns the relay sends a rendezvous request to the listening client, asking the listener to create a temporary channel to the gateway node that received the connection request.</span><span class="sxs-lookup"><span data-stu-id="f6010-146">The gateway node that owns the relay sends a rendezvous request to the listening client, asking the listener to create a temporary channel to the gateway node that received the connection request.</span></span>

<span data-ttu-id="f6010-147">When the relay connection is established, the clients can exchange messages via the gateway node that is used for the rendezvous.</span><span class="sxs-lookup"><span data-stu-id="f6010-147">When the relay connection is established, the clients can exchange messages via the gateway node that is used for the rendezvous.</span></span>

![Processing of Incoming WCF Relay Requests](https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-bus-messaging/media/service-bus-architecture/IC690645.png)

## <a name="next-steps"></a><span data-ttu-id="f6010-149">Next steps</span><span class="sxs-lookup"><span data-stu-id="f6010-149">Next steps</span></span>
<span data-ttu-id="f6010-150">Now that you've read an overview of Service Bus architecture, visit the following links for more information:</span><span class="sxs-lookup"><span data-stu-id="f6010-150">Now that you've read an overview of Service Bus architecture, visit the following links for more information:</span></span>

* [<span data-ttu-id="f6010-151">Service Bus messaging overview</span><span class="sxs-lookup"><span data-stu-id="f6010-151">Service Bus messaging overview</span></span>](service-bus-messaging-overview.md)
* [<span data-ttu-id="f6010-152">Azure Relay overview</span><span class="sxs-lookup"><span data-stu-id="f6010-152">Azure Relay overview</span></span>](../service-bus-relay/relay-what-is-it.md)
* [<span data-ttu-id="f6010-153">Service Bus fundamentals</span><span class="sxs-lookup"><span data-stu-id="f6010-153">Service Bus fundamentals</span></span>](service-bus-fundamentals-hybrid-solutions.md)
* [<span data-ttu-id="f6010-154">A queued messaging solution using Service Bus queues</span><span class="sxs-lookup"><span data-stu-id="f6010-154">A queued messaging solution using Service Bus queues</span></span>](service-bus-dotnet-multi-tier-app-using-service-bus-queues.md)




