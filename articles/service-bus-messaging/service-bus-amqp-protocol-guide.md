---
title: AMQP 1.0 in Azure Service Bus and Event Hubs protocol guide | Microsoft Docs
description: Protocol guide to expressions and description of AMQP 1.0 in Azure Service Bus and Event Hubs
services: service-bus-messaging,event-hubs
documentationcenter: .net
author: clemensv
manager: timlt
editor: ''
ms.assetid: d2d3d540-8760-426a-ad10-d5128ce0ae24
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/12/2017
ms.author: clemensv;jotaub;hillaryc;sethm
ms.openlocfilehash: 3049da8dc0f486cc3bd444bf7adceae11178047e
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44671328"
---
# <a name="amqp-10-in-azure-service-bus-and-event-hubs-protocol-guide"></a><span data-ttu-id="b7f3f-103">AMQP 1.0 in Azure Service Bus and Event Hubs protocol guide</span><span class="sxs-lookup"><span data-stu-id="b7f3f-103">AMQP 1.0 in Azure Service Bus and Event Hubs protocol guide</span></span>

<span data-ttu-id="b7f3f-104">The Advanced Message Queueing Protocol 1.0 is a standardized framing and transfer protocol for asynchronously, securely, and reliably transferring messages between two parties.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-104">The Advanced Message Queueing Protocol 1.0 is a standardized framing and transfer protocol for asynchronously, securely, and reliably transferring messages between two parties.</span></span> <span data-ttu-id="b7f3f-105">It is the primary protocol of Azure Service Bus Messaging and Azure Event Hubs.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-105">It is the primary protocol of Azure Service Bus Messaging and Azure Event Hubs.</span></span> <span data-ttu-id="b7f3f-106">Both services also support HTTPS.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-106">Both services also support HTTPS.</span></span> <span data-ttu-id="b7f3f-107">The proprietary SBMP protocol that is also supported is being phased out in favor of AMQP.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-107">The proprietary SBMP protocol that is also supported is being phased out in favor of AMQP.</span></span>

<span data-ttu-id="b7f3f-108">AMQP 1.0 is the result of broad industry collaboration that brought together middleware vendors, such as Microsoft and Red Hat, with many messaging middleware users such as JP Morgan Chase representing the financial services industry.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-108">AMQP 1.0 is the result of broad industry collaboration that brought together middleware vendors, such as Microsoft and Red Hat, with many messaging middleware users such as JP Morgan Chase representing the financial services industry.</span></span> <span data-ttu-id="b7f3f-109">The technical standardization forum for the AMQP protocol and extension specifications is OASIS, and it has achieved formal approval as an international standard as ISO/IEC 19494.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-109">The technical standardization forum for the AMQP protocol and extension specifications is OASIS, and it has achieved formal approval as an international standard as ISO/IEC 19494.</span></span>

## <a name="goals"></a><span data-ttu-id="b7f3f-110">Goals</span><span class="sxs-lookup"><span data-stu-id="b7f3f-110">Goals</span></span>

<span data-ttu-id="b7f3f-111">This article briefly summarizes the core concepts of the AMQP 1.0 messaging specification along with a small set of draft extension specifications that are currently being finalized in the OASIS AMQP technical committee and explains how Azure Service Bus implements and builds on these specifications.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-111">This article briefly summarizes the core concepts of the AMQP 1.0 messaging specification along with a small set of draft extension specifications that are currently being finalized in the OASIS AMQP technical committee and explains how Azure Service Bus implements and builds on these specifications.</span></span>

<span data-ttu-id="b7f3f-112">The goal is for any developer using any existing AMQP 1.0 client stack on any platform to be able to interact with Azure Service Bus via AMQP 1.0.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-112">The goal is for any developer using any existing AMQP 1.0 client stack on any platform to be able to interact with Azure Service Bus via AMQP 1.0.</span></span>

<span data-ttu-id="b7f3f-113">Common general purpose AMQP 1.0 stacks, such as Apache Proton or AMQP.NET Lite, already implement all core AMQP 1.0 gestures.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-113">Common general purpose AMQP 1.0 stacks, such as Apache Proton or AMQP.NET Lite, already implement all core AMQP 1.0 gestures.</span></span> <span data-ttu-id="b7f3f-114">Those foundational gestures are sometimes wrapped with a higher level API; Apache Proton even offers two, the imperative Messenger API and the reactive Reactor API.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-114">Those foundational gestures are sometimes wrapped with a higher level API; Apache Proton even offers two, the imperative Messenger API and the reactive Reactor API.</span></span>

<span data-ttu-id="b7f3f-115">In the following discussion, we will assume that the management of AMQP connections, sessions, and links and the handling of frame transfers and flow control are handled by the respective stack (such as Apache Proton-C) and do not require much if any specific attention from application developers.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-115">In the following discussion, we will assume that the management of AMQP connections, sessions, and links and the handling of frame transfers and flow control are handled by the respective stack (such as Apache Proton-C) and do not require much if any specific attention from application developers.</span></span> <span data-ttu-id="b7f3f-116">We will abstractly assume the existence of a few API primitives like the ability to connect, and to create some form of *sender* and *receiver* abstraction objects, which then have some shape of `send()` and `receive()` operations, respectively.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-116">We will abstractly assume the existence of a few API primitives like the ability to connect, and to create some form of *sender* and *receiver* abstraction objects, which then have some shape of `send()` and `receive()` operations, respectively.</span></span>

<span data-ttu-id="b7f3f-117">When discussing advanced capabilities of Azure Service Bus, such as message browsing or management of sessions, those are explained in AMQP terms, but also as a layered pseudo-implementation on top of this assumed API abstraction.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-117">When discussing advanced capabilities of Azure Service Bus, such as message browsing or management of sessions, those are explained in AMQP terms, but also as a layered pseudo-implementation on top of this assumed API abstraction.</span></span>

## <a name="what-is-amqp"></a><span data-ttu-id="b7f3f-118">What is AMQP?</span><span class="sxs-lookup"><span data-stu-id="b7f3f-118">What is AMQP?</span></span>

<span data-ttu-id="b7f3f-119">AMQP is a framing and transfer protocol.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-119">AMQP is a framing and transfer protocol.</span></span> <span data-ttu-id="b7f3f-120">Framing means that it provides structure for binary data streams that flow in either direction of a network connection.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-120">Framing means that it provides structure for binary data streams that flow in either direction of a network connection.</span></span> <span data-ttu-id="b7f3f-121">The structure provides delineation for distinct blocks of data, called *frames*, to be exchanged between the connected parties.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-121">The structure provides delineation for distinct blocks of data, called *frames*, to be exchanged between the connected parties.</span></span> <span data-ttu-id="b7f3f-122">The transfer capabilities make sure that both communicating parties can establish a shared understanding about when frames shall be transferred, and when transfers shall be considered complete.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-122">The transfer capabilities make sure that both communicating parties can establish a shared understanding about when frames shall be transferred, and when transfers shall be considered complete.</span></span>

<span data-ttu-id="b7f3f-123">Unlike earlier expired draft versions produced by the AMQP working group that are still in use by a few message brokers, the working group's final, and standardized AMQP 1.0 protocol does not prescribe the presence of a message broker or any particular topology for entities inside a message broker.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-123">Unlike earlier expired draft versions produced by the AMQP working group that are still in use by a few message brokers, the working group's final, and standardized AMQP 1.0 protocol does not prescribe the presence of a message broker or any particular topology for entities inside a message broker.</span></span>

<span data-ttu-id="b7f3f-124">The protocol can be used for symmetric peer-to-peer communication, for interaction with message brokers that support queues and publish/subscribe entities, as Azure Service Bus does.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-124">The protocol can be used for symmetric peer-to-peer communication, for interaction with message brokers that support queues and publish/subscribe entities, as Azure Service Bus does.</span></span> <span data-ttu-id="b7f3f-125">It can also be used for interaction with messaging infrastructure where the interaction patterns are different from regular queues, as is the case with Azure Event Hubs.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-125">It can also be used for interaction with messaging infrastructure where the interaction patterns are different from regular queues, as is the case with Azure Event Hubs.</span></span> <span data-ttu-id="b7f3f-126">An Event Hub acts like a queue when events are sent to it, but acts more like a serial storage service when events are read from it; it somewhat resembles a tape drive.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-126">An Event Hub acts like a queue when events are sent to it, but acts more like a serial storage service when events are read from it; it somewhat resembles a tape drive.</span></span> <span data-ttu-id="b7f3f-127">The client picks an offset into the available data stream and is then served all events from that offset to the latest available.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-127">The client picks an offset into the available data stream and is then served all events from that offset to the latest available.</span></span>

<span data-ttu-id="b7f3f-128">The AMQP 1.0 protocol is designed to be extensible, enabling further specifications to enhance its capabilities.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-128">The AMQP 1.0 protocol is designed to be extensible, enabling further specifications to enhance its capabilities.</span></span> <span data-ttu-id="b7f3f-129">The three extension specifications we will discuss in this document illustrate this.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-129">The three extension specifications we will discuss in this document illustrate this.</span></span> <span data-ttu-id="b7f3f-130">For communication over existing HTTPS/WebSockets infrastructure where configuring the native AMQP TCP ports may be difficult, a binding specification defines how to layer AMQP over WebSockets.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-130">For communication over existing HTTPS/WebSockets infrastructure where configuring the native AMQP TCP ports may be difficult, a binding specification defines how to layer AMQP over WebSockets.</span></span> <span data-ttu-id="b7f3f-131">For interacting with the messaging infrastructure in a request/response fashion for management purposes or to provide advanced functionality, the AMQP management specification defines the required basic interaction primitives.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-131">For interacting with the messaging infrastructure in a request/response fashion for management purposes or to provide advanced functionality, the AMQP management specification defines the required basic interaction primitives.</span></span> <span data-ttu-id="b7f3f-132">For federated authorization model integration, the AMQP claims-based-security specification defines how to associate and renew authorization tokens associated with links.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-132">For federated authorization model integration, the AMQP claims-based-security specification defines how to associate and renew authorization tokens associated with links.</span></span>

## <a name="basic-amqp-scenarios"></a><span data-ttu-id="b7f3f-133">Basic AMQP scenarios</span><span class="sxs-lookup"><span data-stu-id="b7f3f-133">Basic AMQP scenarios</span></span>

<span data-ttu-id="b7f3f-134">This section explains the basic usage of AMQP 1.0 with Azure Service Bus, which includes creating connections, sessions, and links, and transferring messages to and from Service Bus entities such as queues, topics, and subscriptions.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-134">This section explains the basic usage of AMQP 1.0 with Azure Service Bus, which includes creating connections, sessions, and links, and transferring messages to and from Service Bus entities such as queues, topics, and subscriptions.</span></span>

<span data-ttu-id="b7f3f-135">The most authoritative source to learn about how AMQP works is the AMQP 1.0 specification, but the specification was written to precisely guide implementation and not to teach the protocol.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-135">The most authoritative source to learn about how AMQP works is the AMQP 1.0 specification, but the specification was written to precisely guide implementation and not to teach the protocol.</span></span> <span data-ttu-id="b7f3f-136">This section focuses on introducing as much terminology as needed for describing how Service Bus uses AMQP 1.0.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-136">This section focuses on introducing as much terminology as needed for describing how Service Bus uses AMQP 1.0.</span></span> <span data-ttu-id="b7f3f-137">For a more comprehensive introduction to AMQP, as well as a broader discussion of AMQP 1.0, you can review [this video course][this video course].</span><span class="sxs-lookup"><span data-stu-id="b7f3f-137">For a more comprehensive introduction to AMQP, as well as a broader discussion of AMQP 1.0, you can review [this video course][this video course].</span></span>

### <a name="connections-and-sessions"></a><span data-ttu-id="b7f3f-138">Connections and sessions</span><span class="sxs-lookup"><span data-stu-id="b7f3f-138">Connections and sessions</span></span>

<span data-ttu-id="b7f3f-139">AMQP calls the communicating programs *containers*; those contain *nodes*, which are the communicating entities inside of those containers.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-139">AMQP calls the communicating programs *containers*; those contain *nodes*, which are the communicating entities inside of those containers.</span></span> <span data-ttu-id="b7f3f-140">A queue can be such a node.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-140">A queue can be such a node.</span></span> <span data-ttu-id="b7f3f-141">AMQP allows for multiplexing, so a single connection can be used for many communication paths between nodes; for example, an application client can concurrently receive from one queue and send to another queue over the same network connection.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-141">AMQP allows for multiplexing, so a single connection can be used for many communication paths between nodes; for example, an application client can concurrently receive from one queue and send to another queue over the same network connection.</span></span>

![][1]

<span data-ttu-id="b7f3f-142">The network connection is thus anchored on the container.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-142">The network connection is thus anchored on the container.</span></span> <span data-ttu-id="b7f3f-143">It is initiated by the container in the client role making an outbound TCP socket connection to a container in the receiver role which listens for and accepts inbound TCP connections.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-143">It is initiated by the container in the client role making an outbound TCP socket connection to a container in the receiver role which listens for and accepts inbound TCP connections.</span></span> <span data-ttu-id="b7f3f-144">The connection handshake includes negotiating the protocol version, declaring or negotiating the use of Transport Level Security (TLS/SSL), and an authentication/authorization handshake at the connection scope that is based on SASL.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-144">The connection handshake includes negotiating the protocol version, declaring or negotiating the use of Transport Level Security (TLS/SSL), and an authentication/authorization handshake at the connection scope that is based on SASL.</span></span>

<span data-ttu-id="b7f3f-145">Azure Service Bus requires the use of TLS at all times.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-145">Azure Service Bus requires the use of TLS at all times.</span></span> <span data-ttu-id="b7f3f-146">It supports connections over TCP port 5671, whereby the TCP connection is first overlaid with TLS before entering the AMQP protocol handshake, and also supports connections over TCP port 5672 whereby the server immediately offers a mandatory upgrade of connection to TLS using the AMQP-prescribed model.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-146">It supports connections over TCP port 5671, whereby the TCP connection is first overlaid with TLS before entering the AMQP protocol handshake, and also supports connections over TCP port 5672 whereby the server immediately offers a mandatory upgrade of connection to TLS using the AMQP-prescribed model.</span></span> <span data-ttu-id="b7f3f-147">The AMQP WebSockets binding creates a tunnel over TCP port 443 that is then equivalent to AMQP 5671 connections.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-147">The AMQP WebSockets binding creates a tunnel over TCP port 443 that is then equivalent to AMQP 5671 connections.</span></span>

<span data-ttu-id="b7f3f-148">After setting up the connection and TLS, Service Bus offers two SASL mechanism options:</span><span class="sxs-lookup"><span data-stu-id="b7f3f-148">After setting up the connection and TLS, Service Bus offers two SASL mechanism options:</span></span>

* <span data-ttu-id="b7f3f-149">SASL PLAIN is commonly used for passing username and password credentials to a server.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-149">SASL PLAIN is commonly used for passing username and password credentials to a server.</span></span> <span data-ttu-id="b7f3f-150">Service Bus does not have accounts, but named [Shared Access Security rules](service-bus-sas.md), which confer rights and are associated with a key.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-150">Service Bus does not have accounts, but named [Shared Access Security rules](service-bus-sas.md), which confer rights and are associated with a key.</span></span> <span data-ttu-id="b7f3f-151">The name of a rule is used as the user name and the key (as base64 encoded text) is used as the password.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-151">The name of a rule is used as the user name and the key (as base64 encoded text) is used as the password.</span></span> <span data-ttu-id="b7f3f-152">The rights associated with the chosen rule govern the operations allowed on the connection.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-152">The rights associated with the chosen rule govern the operations allowed on the connection.</span></span>
* <span data-ttu-id="b7f3f-153">SASL ANONYMOUS is used for bypassing SASL authorization when the client wants to use the claims-based-security (CBS) model that will be described later.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-153">SASL ANONYMOUS is used for bypassing SASL authorization when the client wants to use the claims-based-security (CBS) model that will be described later.</span></span> <span data-ttu-id="b7f3f-154">With this option, a client connection can be established anonymously for a short time during which the client can only interact with the CBS endpoint and the CBS handshake must complete.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-154">With this option, a client connection can be established anonymously for a short time during which the client can only interact with the CBS endpoint and the CBS handshake must complete.</span></span>

<span data-ttu-id="b7f3f-155">After the transport connection is established, the containers each declare the maximum frame size they are willing to handle, and after an idle timeout they’ll unilaterally disconnect if there is no activity on the connection.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-155">After the transport connection is established, the containers each declare the maximum frame size they are willing to handle, and after an idle timeout they’ll unilaterally disconnect if there is no activity on the connection.</span></span>

<span data-ttu-id="b7f3f-156">They also declare how many concurrent channels are supported.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-156">They also declare how many concurrent channels are supported.</span></span> <span data-ttu-id="b7f3f-157">A channel is a unidirectional, outbound, virtual transfer path on top of the connection.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-157">A channel is a unidirectional, outbound, virtual transfer path on top of the connection.</span></span> <span data-ttu-id="b7f3f-158">A session takes a channel from each of the interconnected containers to form a bi-directional communication path.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-158">A session takes a channel from each of the interconnected containers to form a bi-directional communication path.</span></span>

<span data-ttu-id="b7f3f-159">Sessions have a window-based flow control model; when a session is created, each party declares how many frames it is willing to accept into its receive window.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-159">Sessions have a window-based flow control model; when a session is created, each party declares how many frames it is willing to accept into its receive window.</span></span> <span data-ttu-id="b7f3f-160">As the parties exchange frames, transferred frames fill that window and transfers stop when the window is full and until the window gets reset or expanded using the *flow performative* (*performative* is the AMQP term for protocol-level gestures exchanged between the two parties).</span><span class="sxs-lookup"><span data-stu-id="b7f3f-160">As the parties exchange frames, transferred frames fill that window and transfers stop when the window is full and until the window gets reset or expanded using the *flow performative* (*performative* is the AMQP term for protocol-level gestures exchanged between the two parties).</span></span>

<span data-ttu-id="b7f3f-161">This window-based model is roughly analogous to the TCP concept of window-based flow control, but at the session level inside the socket.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-161">This window-based model is roughly analogous to the TCP concept of window-based flow control, but at the session level inside the socket.</span></span> <span data-ttu-id="b7f3f-162">The protocol’s concept of allowing for multiple concurrent sessions exists so that high priority traffic could be rushed past throttled normal traffic, like on a highway express lane.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-162">The protocol’s concept of allowing for multiple concurrent sessions exists so that high priority traffic could be rushed past throttled normal traffic, like on a highway express lane.</span></span>

<span data-ttu-id="b7f3f-163">Azure Service Bus currently uses exactly one session for each connection.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-163">Azure Service Bus currently uses exactly one session for each connection.</span></span> <span data-ttu-id="b7f3f-164">The Service Bus maximum frame-size is 262,144 bytes (256K bytes) for Service Bus Standard and Event Hubs.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-164">The Service Bus maximum frame-size is 262,144 bytes (256K bytes) for Service Bus Standard and Event Hubs.</span></span> <span data-ttu-id="b7f3f-165">It is 1,048,576 (1 MB) for Service Bus Premium.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-165">It is 1,048,576 (1 MB) for Service Bus Premium.</span></span> <span data-ttu-id="b7f3f-166">Service Bus does not impose any particular session-level throttling windows, but resets the window regularly as part of link-level flow control (see [the next section](#links)).</span><span class="sxs-lookup"><span data-stu-id="b7f3f-166">Service Bus does not impose any particular session-level throttling windows, but resets the window regularly as part of link-level flow control (see [the next section](#links)).</span></span>

<span data-ttu-id="b7f3f-167">Connections, channels, and sessions are ephemeral.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-167">Connections, channels, and sessions are ephemeral.</span></span> <span data-ttu-id="b7f3f-168">If the underlying connection collapses, connections, TLS tunnel, SASL authorization context, and sessions must be reestablished.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-168">If the underlying connection collapses, connections, TLS tunnel, SASL authorization context, and sessions must be reestablished.</span></span>

### <a name="links"></a><span data-ttu-id="b7f3f-169">Links</span><span class="sxs-lookup"><span data-stu-id="b7f3f-169">Links</span></span>

<span data-ttu-id="b7f3f-170">AMQP transfers messages over links.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-170">AMQP transfers messages over links.</span></span> <span data-ttu-id="b7f3f-171">A link is a communication path created over a session that enables transferring messages in one direction; the transfer status negotiation is over the link and bi-directional between the connected parties.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-171">A link is a communication path created over a session that enables transferring messages in one direction; the transfer status negotiation is over the link and bi-directional between the connected parties.</span></span>

![][2]

<span data-ttu-id="b7f3f-172">Links can be created by either container at any time and over an existing session, which makes AMQP different from many other protocols, including HTTP and MQTT, where the initiation of transfers and transfer path is an exclusive privilege of the party creating the socket connection.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-172">Links can be created by either container at any time and over an existing session, which makes AMQP different from many other protocols, including HTTP and MQTT, where the initiation of transfers and transfer path is an exclusive privilege of the party creating the socket connection.</span></span>

<span data-ttu-id="b7f3f-173">The link-initiating container asks the opposite container to accept a link and it chooses a role of either sender or receiver.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-173">The link-initiating container asks the opposite container to accept a link and it chooses a role of either sender or receiver.</span></span> <span data-ttu-id="b7f3f-174">Therefore, either container can initiate creating unidirectional or bi-directional communication paths, with the latter modeled as pairs of links.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-174">Therefore, either container can initiate creating unidirectional or bi-directional communication paths, with the latter modeled as pairs of links.</span></span>

<span data-ttu-id="b7f3f-175">Links are named and associated with nodes.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-175">Links are named and associated with nodes.</span></span> <span data-ttu-id="b7f3f-176">As stated in the beginning, nodes are the communicating entities inside a container.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-176">As stated in the beginning, nodes are the communicating entities inside a container.</span></span>

<span data-ttu-id="b7f3f-177">In Service Bus, a node is directly equivalent to a queue, a topic, a subscription, or a deadletter sub-queue of a queue or subscription.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-177">In Service Bus, a node is directly equivalent to a queue, a topic, a subscription, or a deadletter sub-queue of a queue or subscription.</span></span> <span data-ttu-id="b7f3f-178">The node name used in AMQP is therefore the relative name of the entity inside of the Service Bus namespace.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-178">The node name used in AMQP is therefore the relative name of the entity inside of the Service Bus namespace.</span></span> <span data-ttu-id="b7f3f-179">If a queue is named **myqueue**, that’s also its AMQP node name.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-179">If a queue is named **myqueue**, that’s also its AMQP node name.</span></span> <span data-ttu-id="b7f3f-180">A topic subscription follows the HTTP API convention by being sorted into a "subscriptions" resource collection and thus, a subscription **sub** or a topic **mytopic** has the AMQP node name **mytopic/subscriptions/sub**.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-180">A topic subscription follows the HTTP API convention by being sorted into a "subscriptions" resource collection and thus, a subscription **sub** or a topic **mytopic** has the AMQP node name **mytopic/subscriptions/sub**.</span></span>

<span data-ttu-id="b7f3f-181">The connecting client is also required to use a local node name for creating links; Service Bus is not prescriptive about those node names and will not interpret them.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-181">The connecting client is also required to use a local node name for creating links; Service Bus is not prescriptive about those node names and will not interpret them.</span></span> <span data-ttu-id="b7f3f-182">AMQP 1.0 client stacks generally use a scheme to assure that these ephemeral node names are unique in the scope of the client.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-182">AMQP 1.0 client stacks generally use a scheme to assure that these ephemeral node names are unique in the scope of the client.</span></span>

### <a name="transfers"></a><span data-ttu-id="b7f3f-183">Transfers</span><span class="sxs-lookup"><span data-stu-id="b7f3f-183">Transfers</span></span>

<span data-ttu-id="b7f3f-184">Once a link has been established, messages can be transferred over that link.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-184">Once a link has been established, messages can be transferred over that link.</span></span> <span data-ttu-id="b7f3f-185">In AMQP, a transfer is executed with an explicit protocol gesture (the *transfer* performative) that moves a message from sender to receiver over a link.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-185">In AMQP, a transfer is executed with an explicit protocol gesture (the *transfer* performative) that moves a message from sender to receiver over a link.</span></span> <span data-ttu-id="b7f3f-186">A transfer is complete when it is “settled”, meaning that both parties have established a shared understanding of the outcome of that transfer.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-186">A transfer is complete when it is “settled”, meaning that both parties have established a shared understanding of the outcome of that transfer.</span></span>

![][3]

<span data-ttu-id="b7f3f-187">In the simplest case, the sender can choose to send messages "pre-settled," meaning that the client isn’t interested in the outcome and the receiver will not provide any feedback about the outcome of the operation.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-187">In the simplest case, the sender can choose to send messages "pre-settled," meaning that the client isn’t interested in the outcome and the receiver will not provide any feedback about the outcome of the operation.</span></span> <span data-ttu-id="b7f3f-188">This mode is supported by Service Bus at the AMQP protocol level, but not exposed in any of the client APIs.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-188">This mode is supported by Service Bus at the AMQP protocol level, but not exposed in any of the client APIs.</span></span>

<span data-ttu-id="b7f3f-189">The regular case is that messages are being sent unsettled, and the receiver will then indicate acceptance or rejection using the *disposition* performative.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-189">The regular case is that messages are being sent unsettled, and the receiver will then indicate acceptance or rejection using the *disposition* performative.</span></span> <span data-ttu-id="b7f3f-190">Rejection occurs when the receiver cannot accept the message for any reason, and the rejection message contains information about the reason, which is an error structure defined by AMQP.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-190">Rejection occurs when the receiver cannot accept the message for any reason, and the rejection message contains information about the reason, which is an error structure defined by AMQP.</span></span> <span data-ttu-id="b7f3f-191">If messages are rejected due to internal errors inside of Service Bus, the service returns extra information inside that structure that can be used for providing diagnostics hints to support personnel if you are filing support requests.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-191">If messages are rejected due to internal errors inside of Service Bus, the service returns extra information inside that structure that can be used for providing diagnostics hints to support personnel if you are filing support requests.</span></span> <span data-ttu-id="b7f3f-192">You’ll learn more details about errors later.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-192">You’ll learn more details about errors later.</span></span>

<span data-ttu-id="b7f3f-193">A special form of rejection is the *released* state, which indicates that the receiver has no technical objection to the transfer, but also no interest in settling the transfer.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-193">A special form of rejection is the *released* state, which indicates that the receiver has no technical objection to the transfer, but also no interest in settling the transfer.</span></span> <span data-ttu-id="b7f3f-194">That case exists, for example, when a message is delivered to a Service Bus client, and the client chooses to "abandon" the message because it cannot perform the work resulting from processing the message; the message delivery itself is not at fault.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-194">That case exists, for example, when a message is delivered to a Service Bus client, and the client chooses to "abandon" the message because it cannot perform the work resulting from processing the message; the message delivery itself is not at fault.</span></span> <span data-ttu-id="b7f3f-195">A variation of that state is the *modified* state, which allows changes to the message as it is released.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-195">A variation of that state is the *modified* state, which allows changes to the message as it is released.</span></span> <span data-ttu-id="b7f3f-196">That state is not used by Service Bus at present.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-196">That state is not used by Service Bus at present.</span></span>

<span data-ttu-id="b7f3f-197">The AMQP 1.0 specification defines a further disposition state called *received*, that specifically helps to handle link recovery.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-197">The AMQP 1.0 specification defines a further disposition state called *received*, that specifically helps to handle link recovery.</span></span> <span data-ttu-id="b7f3f-198">Link recovery allows reconstituting the state of a link and any pending deliveries on top of a new connection and session, when the prior connection and session were lost.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-198">Link recovery allows reconstituting the state of a link and any pending deliveries on top of a new connection and session, when the prior connection and session were lost.</span></span>

<span data-ttu-id="b7f3f-199">Service Bus does not support link recovery; if the client loses the connection to Service Bus with an unsettled message transfer pending, that message transfer is lost, and the client must reconnect, reestablish the link, and retry the transfer.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-199">Service Bus does not support link recovery; if the client loses the connection to Service Bus with an unsettled message transfer pending, that message transfer is lost, and the client must reconnect, reestablish the link, and retry the transfer.</span></span>

<span data-ttu-id="b7f3f-200">As such, Service Bus and Event Hubs support "at least once" transfers where the sender can be assured for the message having been stored and accepted, but do not support "exactly once" transfers at the AMQP level, where the system would attempt to recover the link and continue to negotiate the delivery state to avoid duplication of the message transfer.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-200">As such, Service Bus and Event Hubs support "at least once" transfers where the sender can be assured for the message having been stored and accepted, but do not support "exactly once" transfers at the AMQP level, where the system would attempt to recover the link and continue to negotiate the delivery state to avoid duplication of the message transfer.</span></span>

<span data-ttu-id="b7f3f-201">To compensate for possible duplicate sends, Service Bus supports duplicate detection as an optional feature on queues and topics.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-201">To compensate for possible duplicate sends, Service Bus supports duplicate detection as an optional feature on queues and topics.</span></span> <span data-ttu-id="b7f3f-202">Duplicate detection records the message IDs of all incoming messages during a user-defined time window, then silently drops all messages sent with the same message-IDs during that same window.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-202">Duplicate detection records the message IDs of all incoming messages during a user-defined time window, then silently drops all messages sent with the same message-IDs during that same window.</span></span>

### <a name="flow-control"></a><span data-ttu-id="b7f3f-203">Flow control</span><span class="sxs-lookup"><span data-stu-id="b7f3f-203">Flow control</span></span>

<span data-ttu-id="b7f3f-204">In addition to the session-level flow control model that previously discussed, each link has its own flow control model.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-204">In addition to the session-level flow control model that previously discussed, each link has its own flow control model.</span></span> <span data-ttu-id="b7f3f-205">Session-level flow control protects the container from having to handle too many frames at once, link-level flow control puts the application in charge of how many messages it wants to handle from a link and when.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-205">Session-level flow control protects the container from having to handle too many frames at once, link-level flow control puts the application in charge of how many messages it wants to handle from a link and when.</span></span>

![][4]

<span data-ttu-id="b7f3f-206">On a link, transfers can only happen when the sender has enough *link credit*.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-206">On a link, transfers can only happen when the sender has enough *link credit*.</span></span> <span data-ttu-id="b7f3f-207">Link credit is a counter set by the receiver using the *flow* performative, which is scoped to a link.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-207">Link credit is a counter set by the receiver using the *flow* performative, which is scoped to a link.</span></span> <span data-ttu-id="b7f3f-208">When the sender is assigned link credit, it attempts to use up that credit by delivering messages.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-208">When the sender is assigned link credit, it attempts to use up that credit by delivering messages.</span></span> <span data-ttu-id="b7f3f-209">Each message delivery decrements the remaining link credit by 1.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-209">Each message delivery decrements the remaining link credit by 1.</span></span> <span data-ttu-id="b7f3f-210">When the link credit is used up, deliveries stop.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-210">When the link credit is used up, deliveries stop.</span></span>

<span data-ttu-id="b7f3f-211">When Service Bus is in the receiver role, it instantly provides the sender with ample link credit, so that messages can be sent immediately.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-211">When Service Bus is in the receiver role, it instantly provides the sender with ample link credit, so that messages can be sent immediately.</span></span> <span data-ttu-id="b7f3f-212">As link credit is used, Service Bus occasionally sends a *flow* performative to the sender to update the link credit balance.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-212">As link credit is used, Service Bus occasionally sends a *flow* performative to the sender to update the link credit balance.</span></span>

<span data-ttu-id="b7f3f-213">In the sender role, Service Bus will eagerly send messages to use up any outstanding link credit.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-213">In the sender role, Service Bus will eagerly send messages to use up any outstanding link credit.</span></span>

<span data-ttu-id="b7f3f-214">A "receive" call at the API level translates into a *flow* performative being sent to Service Bus by the client, and Service Bus will consume that credit by taking the first available, unlocked message from the queue, locking it, and transferring it.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-214">A "receive" call at the API level translates into a *flow* performative being sent to Service Bus by the client, and Service Bus will consume that credit by taking the first available, unlocked message from the queue, locking it, and transferring it.</span></span> <span data-ttu-id="b7f3f-215">If there is no message readily available for delivery, any outstanding credit by any link established with that particular entity remains recorded in order of arrival, and messages are locked and transferred as they become available, to use any outstanding credit.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-215">If there is no message readily available for delivery, any outstanding credit by any link established with that particular entity remains recorded in order of arrival, and messages are locked and transferred as they become available, to use any outstanding credit.</span></span>

<span data-ttu-id="b7f3f-216">The lock on a message is released when the transfer is settled into one of the terminal states *accepted*, *rejected*, or *released*.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-216">The lock on a message is released when the transfer is settled into one of the terminal states *accepted*, *rejected*, or *released*.</span></span> <span data-ttu-id="b7f3f-217">The message is removed from Service Bus when the terminal state is *accepted*.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-217">The message is removed from Service Bus when the terminal state is *accepted*.</span></span> <span data-ttu-id="b7f3f-218">It remains in Service Bus and is delivered to the next receiver when the transfer reaches any of the other states.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-218">It remains in Service Bus and is delivered to the next receiver when the transfer reaches any of the other states.</span></span> <span data-ttu-id="b7f3f-219">Service Bus will automatically move the message into the entity's deadletter queue when it reaches the maximum delivery count allowed for the entity due to repeated rejections or releases.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-219">Service Bus will automatically move the message into the entity's deadletter queue when it reaches the maximum delivery count allowed for the entity due to repeated rejections or releases.</span></span>

<span data-ttu-id="b7f3f-220">Even though the Service Bus APIs do not directly expose such an option today, a lower-level AMQP protocol client can use the link-credit model to turn the "pull-style" interaction of issuing one unit of credit for each receive request into a "push-style" model by issuing a very large number of link credits and then receive messages as they become available without any further interaction.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-220">Even though the Service Bus APIs do not directly expose such an option today, a lower-level AMQP protocol client can use the link-credit model to turn the "pull-style" interaction of issuing one unit of credit for each receive request into a "push-style" model by issuing a very large number of link credits and then receive messages as they become available without any further interaction.</span></span> <span data-ttu-id="b7f3f-221">Push is supported through the [MessagingFactory.PrefetchCount](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PrefetchCount) or [MessageReceiver.PrefetchCount](/dotnet/api/microsoft.servicebus.messaging.messagereceiver#Microsoft_ServiceBus_Messaging_MessageReceiver_PrefetchCount) property settings.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-221">Push is supported through the [MessagingFactory.PrefetchCount](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PrefetchCount) or [MessageReceiver.PrefetchCount](/dotnet/api/microsoft.servicebus.messaging.messagereceiver#Microsoft_ServiceBus_Messaging_MessageReceiver_PrefetchCount) property settings.</span></span> <span data-ttu-id="b7f3f-222">When they are non-zero, the AMQP client uses it as the link credit.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-222">When they are non-zero, the AMQP client uses it as the link credit.</span></span>

<span data-ttu-id="b7f3f-223">In this context it's important to understand that the clock for the expiration of the lock on the message inside the entity starts when the message is taken from the entity, not when the message is put on the wire.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-223">In this context it's important to understand that the clock for the expiration of the lock on the message inside the entity starts when the message is taken from the entity, not when the message is put on the wire.</span></span> <span data-ttu-id="b7f3f-224">Whenever the client indicates readiness to receive messages by issuing link credit, it is therefore expected to be actively pulling messages across the network and be ready to handle them.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-224">Whenever the client indicates readiness to receive messages by issuing link credit, it is therefore expected to be actively pulling messages across the network and be ready to handle them.</span></span> <span data-ttu-id="b7f3f-225">Otherwise the message lock may have expired before the message is even delivered.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-225">Otherwise the message lock may have expired before the message is even delivered.</span></span> <span data-ttu-id="b7f3f-226">The use of link-credit flow control should directly reflect the immediate readiness to deal with available messages dispatched to the receiver.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-226">The use of link-credit flow control should directly reflect the immediate readiness to deal with available messages dispatched to the receiver.</span></span>

<span data-ttu-id="b7f3f-227">In summary, the following sections provide a schematic overview of the performative flow during different API interactions.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-227">In summary, the following sections provide a schematic overview of the performative flow during different API interactions.</span></span> <span data-ttu-id="b7f3f-228">Each section describes a different logical operation.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-228">Each section describes a different logical operation.</span></span> <span data-ttu-id="b7f3f-229">Some of those interactions may be "lazy," meaning they may only be performed when required.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-229">Some of those interactions may be "lazy," meaning they may only be performed when required.</span></span> <span data-ttu-id="b7f3f-230">Creating a message sender may not cause a network interaction until the first message is sent or requested.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-230">Creating a message sender may not cause a network interaction until the first message is sent or requested.</span></span>

<span data-ttu-id="b7f3f-231">The arrows in the following table show the performative flow direction.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-231">The arrows in the following table show the performative flow direction.</span></span>

#### <a name="create-message-receiver"></a><span data-ttu-id="b7f3f-232">Create message receiver</span><span class="sxs-lookup"><span data-stu-id="b7f3f-232">Create message receiver</span></span>

| <span data-ttu-id="b7f3f-233">Client</span><span class="sxs-lookup"><span data-stu-id="b7f3f-233">Client</span></span> | <span data-ttu-id="b7f3f-234">Service Bus</span><span class="sxs-lookup"><span data-stu-id="b7f3f-234">Service Bus</span></span> |
| --- | --- |
| <span data-ttu-id="b7f3f-235">--> attach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-235">--> attach(</span></span><br/><span data-ttu-id="b7f3f-236">name={link name},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-236">name={link name},</span></span><br/><span data-ttu-id="b7f3f-237">handle={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-237">handle={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-238">role=**receiver**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-238">role=**receiver**,</span></span><br/><span data-ttu-id="b7f3f-239">source={entity name},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-239">source={entity name},</span></span><br/><span data-ttu-id="b7f3f-240">target={client link id}</span><span class="sxs-lookup"><span data-stu-id="b7f3f-240">target={client link id}</span></span><br/><span data-ttu-id="b7f3f-241">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-241">)</span></span> |<span data-ttu-id="b7f3f-242">Client attaches to entity as receiver</span><span class="sxs-lookup"><span data-stu-id="b7f3f-242">Client attaches to entity as receiver</span></span> |
| <span data-ttu-id="b7f3f-243">Service Bus replies attaching its end of the link</span><span class="sxs-lookup"><span data-stu-id="b7f3f-243">Service Bus replies attaching its end of the link</span></span> |<span data-ttu-id="b7f3f-244"><-- attach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-244"><-- attach(</span></span><br/><span data-ttu-id="b7f3f-245">name={link name},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-245">name={link name},</span></span><br/><span data-ttu-id="b7f3f-246">handle={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-246">handle={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-247">role=**sender**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-247">role=**sender**,</span></span><br/><span data-ttu-id="b7f3f-248">source={entity name},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-248">source={entity name},</span></span><br/><span data-ttu-id="b7f3f-249">target={client link id}</span><span class="sxs-lookup"><span data-stu-id="b7f3f-249">target={client link id}</span></span><br/><span data-ttu-id="b7f3f-250">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-250">)</span></span> |

#### <a name="create-message-sender"></a><span data-ttu-id="b7f3f-251">Create message sender</span><span class="sxs-lookup"><span data-stu-id="b7f3f-251">Create message sender</span></span>

| <span data-ttu-id="b7f3f-252">Client</span><span class="sxs-lookup"><span data-stu-id="b7f3f-252">Client</span></span> | <span data-ttu-id="b7f3f-253">Service Bus</span><span class="sxs-lookup"><span data-stu-id="b7f3f-253">Service Bus</span></span> |
| --- | --- |
| <span data-ttu-id="b7f3f-254">--> attach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-254">--> attach(</span></span><br/><span data-ttu-id="b7f3f-255">name={link name},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-255">name={link name},</span></span><br/><span data-ttu-id="b7f3f-256">handle={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-256">handle={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-257">role=**sender**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-257">role=**sender**,</span></span><br/><span data-ttu-id="b7f3f-258">source={client link id},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-258">source={client link id},</span></span><br/><span data-ttu-id="b7f3f-259">target={entity name}</span><span class="sxs-lookup"><span data-stu-id="b7f3f-259">target={entity name}</span></span><br/><span data-ttu-id="b7f3f-260">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-260">)</span></span> |<span data-ttu-id="b7f3f-261">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-261">No action</span></span> |
| <span data-ttu-id="b7f3f-262">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-262">No action</span></span> |<span data-ttu-id="b7f3f-263"><-- attach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-263"><-- attach(</span></span><br/><span data-ttu-id="b7f3f-264">name={link name},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-264">name={link name},</span></span><br/><span data-ttu-id="b7f3f-265">handle={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-265">handle={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-266">role=**receiver**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-266">role=**receiver**,</span></span><br/><span data-ttu-id="b7f3f-267">source={client link id},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-267">source={client link id},</span></span><br/><span data-ttu-id="b7f3f-268">target={entity name}</span><span class="sxs-lookup"><span data-stu-id="b7f3f-268">target={entity name}</span></span><br/><span data-ttu-id="b7f3f-269">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-269">)</span></span> |

#### <a name="create-message-sender-error"></a><span data-ttu-id="b7f3f-270">Create message sender (error)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-270">Create message sender (error)</span></span>

| <span data-ttu-id="b7f3f-271">Client</span><span class="sxs-lookup"><span data-stu-id="b7f3f-271">Client</span></span> | <span data-ttu-id="b7f3f-272">Service Bus</span><span class="sxs-lookup"><span data-stu-id="b7f3f-272">Service Bus</span></span> |
| --- | --- |
| <span data-ttu-id="b7f3f-273">--> attach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-273">--> attach(</span></span><br/><span data-ttu-id="b7f3f-274">name={link name},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-274">name={link name},</span></span><br/><span data-ttu-id="b7f3f-275">handle={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-275">handle={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-276">role=**sender**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-276">role=**sender**,</span></span><br/><span data-ttu-id="b7f3f-277">source={client link id},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-277">source={client link id},</span></span><br/><span data-ttu-id="b7f3f-278">target={entity name}</span><span class="sxs-lookup"><span data-stu-id="b7f3f-278">target={entity name}</span></span><br/><span data-ttu-id="b7f3f-279">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-279">)</span></span> |<span data-ttu-id="b7f3f-280">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-280">No action</span></span> |
| <span data-ttu-id="b7f3f-281">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-281">No action</span></span> |<span data-ttu-id="b7f3f-282"><-- attach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-282"><-- attach(</span></span><br/><span data-ttu-id="b7f3f-283">name={link name},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-283">name={link name},</span></span><br/><span data-ttu-id="b7f3f-284">handle={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-284">handle={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-285">role=**receiver**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-285">role=**receiver**,</span></span><br/><span data-ttu-id="b7f3f-286">source=null,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-286">source=null,</span></span><br/><span data-ttu-id="b7f3f-287">target=null</span><span class="sxs-lookup"><span data-stu-id="b7f3f-287">target=null</span></span><br/><span data-ttu-id="b7f3f-288">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-288">)</span></span><br/><br/><span data-ttu-id="b7f3f-289"><-- detach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-289"><-- detach(</span></span><br/><span data-ttu-id="b7f3f-290">handle={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-290">handle={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-291">closed=**true**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-291">closed=**true**,</span></span><br/><span data-ttu-id="b7f3f-292">error={error info}</span><span class="sxs-lookup"><span data-stu-id="b7f3f-292">error={error info}</span></span><br/><span data-ttu-id="b7f3f-293">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-293">)</span></span> |

#### <a name="close-message-receiversender"></a><span data-ttu-id="b7f3f-294">Close message receiver/sender</span><span class="sxs-lookup"><span data-stu-id="b7f3f-294">Close message receiver/sender</span></span>

| <span data-ttu-id="b7f3f-295">Client</span><span class="sxs-lookup"><span data-stu-id="b7f3f-295">Client</span></span> | <span data-ttu-id="b7f3f-296">Service Bus</span><span class="sxs-lookup"><span data-stu-id="b7f3f-296">Service Bus</span></span> |
| --- | --- |
| <span data-ttu-id="b7f3f-297">--> detach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-297">--> detach(</span></span><br/><span data-ttu-id="b7f3f-298">handle={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-298">handle={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-299">closed=**true**</span><span class="sxs-lookup"><span data-stu-id="b7f3f-299">closed=**true**</span></span><br/><span data-ttu-id="b7f3f-300">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-300">)</span></span> |<span data-ttu-id="b7f3f-301">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-301">No action</span></span> |
| <span data-ttu-id="b7f3f-302">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-302">No action</span></span> |<span data-ttu-id="b7f3f-303"><-- detach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-303"><-- detach(</span></span><br/><span data-ttu-id="b7f3f-304">handle={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-304">handle={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-305">closed=**true**</span><span class="sxs-lookup"><span data-stu-id="b7f3f-305">closed=**true**</span></span><br/><span data-ttu-id="b7f3f-306">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-306">)</span></span> |

#### <a name="send-success"></a><span data-ttu-id="b7f3f-307">Send (success)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-307">Send (success)</span></span>

| <span data-ttu-id="b7f3f-308">Client</span><span class="sxs-lookup"><span data-stu-id="b7f3f-308">Client</span></span> | <span data-ttu-id="b7f3f-309">Service Bus</span><span class="sxs-lookup"><span data-stu-id="b7f3f-309">Service Bus</span></span> |
| --- | --- |
| <span data-ttu-id="b7f3f-310">--> transfer(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-310">--> transfer(</span></span><br/><span data-ttu-id="b7f3f-311">delivery-id={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-311">delivery-id={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-312">delivery-tag={binary handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-312">delivery-tag={binary handle},</span></span><br/><span data-ttu-id="b7f3f-313">settled=**false**,,more=**false**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-313">settled=**false**,,more=**false**,</span></span><br/><span data-ttu-id="b7f3f-314">state=**null**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-314">state=**null**,</span></span><br/><span data-ttu-id="b7f3f-315">resume=**false**</span><span class="sxs-lookup"><span data-stu-id="b7f3f-315">resume=**false**</span></span><br/><span data-ttu-id="b7f3f-316">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-316">)</span></span> |<span data-ttu-id="b7f3f-317">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-317">No action</span></span> |
| <span data-ttu-id="b7f3f-318">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-318">No action</span></span> |<span data-ttu-id="b7f3f-319"><-- disposition(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-319"><-- disposition(</span></span><br/><span data-ttu-id="b7f3f-320">role=receiver,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-320">role=receiver,</span></span><br/><span data-ttu-id="b7f3f-321">first={delivery id},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-321">first={delivery id},</span></span><br/><span data-ttu-id="b7f3f-322">last={delivery id},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-322">last={delivery id},</span></span><br/><span data-ttu-id="b7f3f-323">settled=**true**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-323">settled=**true**,</span></span><br/><span data-ttu-id="b7f3f-324">state=**accepted**</span><span class="sxs-lookup"><span data-stu-id="b7f3f-324">state=**accepted**</span></span><br/><span data-ttu-id="b7f3f-325">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-325">)</span></span> |

#### <a name="send-error"></a><span data-ttu-id="b7f3f-326">Send (error)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-326">Send (error)</span></span>

| <span data-ttu-id="b7f3f-327">Client</span><span class="sxs-lookup"><span data-stu-id="b7f3f-327">Client</span></span> | <span data-ttu-id="b7f3f-328">Service Bus</span><span class="sxs-lookup"><span data-stu-id="b7f3f-328">Service Bus</span></span> |
| --- | --- |
| <span data-ttu-id="b7f3f-329">--> transfer(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-329">--> transfer(</span></span><br/><span data-ttu-id="b7f3f-330">delivery-id={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-330">delivery-id={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-331">delivery-tag={binary handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-331">delivery-tag={binary handle},</span></span><br/><span data-ttu-id="b7f3f-332">settled=**false**,,more=**false**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-332">settled=**false**,,more=**false**,</span></span><br/><span data-ttu-id="b7f3f-333">state=**null**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-333">state=**null**,</span></span><br/><span data-ttu-id="b7f3f-334">resume=**false**</span><span class="sxs-lookup"><span data-stu-id="b7f3f-334">resume=**false**</span></span><br/><span data-ttu-id="b7f3f-335">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-335">)</span></span> |<span data-ttu-id="b7f3f-336">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-336">No action</span></span> |
| <span data-ttu-id="b7f3f-337">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-337">No action</span></span> |<span data-ttu-id="b7f3f-338"><-- disposition(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-338"><-- disposition(</span></span><br/><span data-ttu-id="b7f3f-339">role=receiver,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-339">role=receiver,</span></span><br/><span data-ttu-id="b7f3f-340">first={delivery id},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-340">first={delivery id},</span></span><br/><span data-ttu-id="b7f3f-341">last={delivery id},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-341">last={delivery id},</span></span><br/><span data-ttu-id="b7f3f-342">settled=**true**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-342">settled=**true**,</span></span><br/><span data-ttu-id="b7f3f-343">state=**rejected**(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-343">state=**rejected**(</span></span><br/><span data-ttu-id="b7f3f-344">error={error info}</span><span class="sxs-lookup"><span data-stu-id="b7f3f-344">error={error info}</span></span><br/><span data-ttu-id="b7f3f-345">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-345">)</span></span><br/><span data-ttu-id="b7f3f-346">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-346">)</span></span> |

#### <a name="receive"></a><span data-ttu-id="b7f3f-347">Receive</span><span class="sxs-lookup"><span data-stu-id="b7f3f-347">Receive</span></span>

| <span data-ttu-id="b7f3f-348">Client</span><span class="sxs-lookup"><span data-stu-id="b7f3f-348">Client</span></span> | <span data-ttu-id="b7f3f-349">Service Bus</span><span class="sxs-lookup"><span data-stu-id="b7f3f-349">Service Bus</span></span> |
| --- | --- |
| <span data-ttu-id="b7f3f-350">--> flow(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-350">--> flow(</span></span><br/><span data-ttu-id="b7f3f-351">link-credit=1</span><span class="sxs-lookup"><span data-stu-id="b7f3f-351">link-credit=1</span></span><br/><span data-ttu-id="b7f3f-352">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-352">)</span></span> |<span data-ttu-id="b7f3f-353">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-353">No action</span></span> |
| <span data-ttu-id="b7f3f-354">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-354">No action</span></span> |<span data-ttu-id="b7f3f-355">< transfer(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-355">< transfer(</span></span><br/><span data-ttu-id="b7f3f-356">delivery-id={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-356">delivery-id={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-357">delivery-tag={binary handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-357">delivery-tag={binary handle},</span></span><br/><span data-ttu-id="b7f3f-358">settled=**false**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-358">settled=**false**,</span></span><br/><span data-ttu-id="b7f3f-359">more=**false**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-359">more=**false**,</span></span><br/><span data-ttu-id="b7f3f-360">state=**null**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-360">state=**null**,</span></span><br/><span data-ttu-id="b7f3f-361">resume=**false**</span><span class="sxs-lookup"><span data-stu-id="b7f3f-361">resume=**false**</span></span><br/><span data-ttu-id="b7f3f-362">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-362">)</span></span> |
| <span data-ttu-id="b7f3f-363">--> disposition(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-363">--> disposition(</span></span><br/><span data-ttu-id="b7f3f-364">role=**receiver**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-364">role=**receiver**,</span></span><br/><span data-ttu-id="b7f3f-365">first={delivery id},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-365">first={delivery id},</span></span><br/><span data-ttu-id="b7f3f-366">last={delivery id},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-366">last={delivery id},</span></span><br/><span data-ttu-id="b7f3f-367">settled=**true**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-367">settled=**true**,</span></span><br/><span data-ttu-id="b7f3f-368">state=**accepted**</span><span class="sxs-lookup"><span data-stu-id="b7f3f-368">state=**accepted**</span></span><br/><span data-ttu-id="b7f3f-369">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-369">)</span></span> |<span data-ttu-id="b7f3f-370">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-370">No action</span></span> |

#### <a name="multi-message-receive"></a><span data-ttu-id="b7f3f-371">Multi-message receive</span><span class="sxs-lookup"><span data-stu-id="b7f3f-371">Multi-message receive</span></span>

| <span data-ttu-id="b7f3f-372">Client</span><span class="sxs-lookup"><span data-stu-id="b7f3f-372">Client</span></span> | <span data-ttu-id="b7f3f-373">Service Bus</span><span class="sxs-lookup"><span data-stu-id="b7f3f-373">Service Bus</span></span> |
| --- | --- |
| <span data-ttu-id="b7f3f-374">--> flow(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-374">--> flow(</span></span><br/><span data-ttu-id="b7f3f-375">link-credit=3</span><span class="sxs-lookup"><span data-stu-id="b7f3f-375">link-credit=3</span></span><br/><span data-ttu-id="b7f3f-376">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-376">)</span></span> |<span data-ttu-id="b7f3f-377">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-377">No action</span></span> |
| <span data-ttu-id="b7f3f-378">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-378">No action</span></span> |<span data-ttu-id="b7f3f-379">< transfer(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-379">< transfer(</span></span><br/><span data-ttu-id="b7f3f-380">delivery-id={numeric handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-380">delivery-id={numeric handle},</span></span><br/><span data-ttu-id="b7f3f-381">delivery-tag={binary handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-381">delivery-tag={binary handle},</span></span><br/><span data-ttu-id="b7f3f-382">settled=**false**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-382">settled=**false**,</span></span><br/><span data-ttu-id="b7f3f-383">more=**false**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-383">more=**false**,</span></span><br/><span data-ttu-id="b7f3f-384">state=**null**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-384">state=**null**,</span></span><br/><span data-ttu-id="b7f3f-385">resume=**false**</span><span class="sxs-lookup"><span data-stu-id="b7f3f-385">resume=**false**</span></span><br/><span data-ttu-id="b7f3f-386">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-386">)</span></span> |
| <span data-ttu-id="b7f3f-387">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-387">No action</span></span> |<span data-ttu-id="b7f3f-388">< transfer(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-388">< transfer(</span></span><br/><span data-ttu-id="b7f3f-389">delivery-id={numeric handle+1},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-389">delivery-id={numeric handle+1},</span></span><br/><span data-ttu-id="b7f3f-390">delivery-tag={binary handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-390">delivery-tag={binary handle},</span></span><br/><span data-ttu-id="b7f3f-391">settled=**false**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-391">settled=**false**,</span></span><br/><span data-ttu-id="b7f3f-392">more=**false**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-392">more=**false**,</span></span><br/><span data-ttu-id="b7f3f-393">state=**null**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-393">state=**null**,</span></span><br/><span data-ttu-id="b7f3f-394">resume=**false**</span><span class="sxs-lookup"><span data-stu-id="b7f3f-394">resume=**false**</span></span><br/><span data-ttu-id="b7f3f-395">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-395">)</span></span> |
| <span data-ttu-id="b7f3f-396">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-396">No action</span></span> |<span data-ttu-id="b7f3f-397">< transfer(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-397">< transfer(</span></span><br/><span data-ttu-id="b7f3f-398">delivery-id={numeric handle+2},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-398">delivery-id={numeric handle+2},</span></span><br/><span data-ttu-id="b7f3f-399">delivery-tag={binary handle},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-399">delivery-tag={binary handle},</span></span><br/><span data-ttu-id="b7f3f-400">settled=**false**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-400">settled=**false**,</span></span><br/><span data-ttu-id="b7f3f-401">more=**false**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-401">more=**false**,</span></span><br/><span data-ttu-id="b7f3f-402">state=**null**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-402">state=**null**,</span></span><br/><span data-ttu-id="b7f3f-403">resume=**false**</span><span class="sxs-lookup"><span data-stu-id="b7f3f-403">resume=**false**</span></span><br/><span data-ttu-id="b7f3f-404">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-404">)</span></span> |
| <span data-ttu-id="b7f3f-405">--> disposition(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-405">--> disposition(</span></span><br/><span data-ttu-id="b7f3f-406">role=receiver,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-406">role=receiver,</span></span><br/><span data-ttu-id="b7f3f-407">first={delivery id},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-407">first={delivery id},</span></span><br/><span data-ttu-id="b7f3f-408">last={delivery id+2},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-408">last={delivery id+2},</span></span><br/><span data-ttu-id="b7f3f-409">settled=**true**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-409">settled=**true**,</span></span><br/><span data-ttu-id="b7f3f-410">state=**accepted**</span><span class="sxs-lookup"><span data-stu-id="b7f3f-410">state=**accepted**</span></span><br/><span data-ttu-id="b7f3f-411">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-411">)</span></span> |<span data-ttu-id="b7f3f-412">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-412">No action</span></span> |

### <a name="messages"></a><span data-ttu-id="b7f3f-413">Messages</span><span class="sxs-lookup"><span data-stu-id="b7f3f-413">Messages</span></span>

<span data-ttu-id="b7f3f-414">The following sections explain which properties from the standard AMQP message sections are used by Service Bus and how they map to the Service Bus API set.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-414">The following sections explain which properties from the standard AMQP message sections are used by Service Bus and how they map to the Service Bus API set.</span></span>

#### <a name="header"></a><span data-ttu-id="b7f3f-415">header</span><span class="sxs-lookup"><span data-stu-id="b7f3f-415">header</span></span>

| <span data-ttu-id="b7f3f-416">Field Name</span><span class="sxs-lookup"><span data-stu-id="b7f3f-416">Field Name</span></span> | <span data-ttu-id="b7f3f-417">Usage</span><span class="sxs-lookup"><span data-stu-id="b7f3f-417">Usage</span></span> | <span data-ttu-id="b7f3f-418">API name</span><span class="sxs-lookup"><span data-stu-id="b7f3f-418">API name</span></span> |
| --- | --- | --- |
| <span data-ttu-id="b7f3f-419">durable</span><span class="sxs-lookup"><span data-stu-id="b7f3f-419">durable</span></span> |- |- |
| <span data-ttu-id="b7f3f-420">priority</span><span class="sxs-lookup"><span data-stu-id="b7f3f-420">priority</span></span> |- |- |
| <span data-ttu-id="b7f3f-421">ttl</span><span class="sxs-lookup"><span data-stu-id="b7f3f-421">ttl</span></span> |<span data-ttu-id="b7f3f-422">Time to live for this message</span><span class="sxs-lookup"><span data-stu-id="b7f3f-422">Time to live for this message</span></span> |[<span data-ttu-id="b7f3f-423">TimeToLive</span><span class="sxs-lookup"><span data-stu-id="b7f3f-423">TimeToLive</span></span>](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive) |
| <span data-ttu-id="b7f3f-424">first-acquirer</span><span class="sxs-lookup"><span data-stu-id="b7f3f-424">first-acquirer</span></span> |- |- |
| <span data-ttu-id="b7f3f-425">delivery-count</span><span class="sxs-lookup"><span data-stu-id="b7f3f-425">delivery-count</span></span> |- |[<span data-ttu-id="b7f3f-426">DeliveryCount</span><span class="sxs-lookup"><span data-stu-id="b7f3f-426">DeliveryCount</span></span>](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_DeliveryCount) |

#### <a name="properties"></a><span data-ttu-id="b7f3f-427">properties</span><span class="sxs-lookup"><span data-stu-id="b7f3f-427">properties</span></span>

| <span data-ttu-id="b7f3f-428">Field Name</span><span class="sxs-lookup"><span data-stu-id="b7f3f-428">Field Name</span></span> | <span data-ttu-id="b7f3f-429">Usage</span><span class="sxs-lookup"><span data-stu-id="b7f3f-429">Usage</span></span> | <span data-ttu-id="b7f3f-430">API name</span><span class="sxs-lookup"><span data-stu-id="b7f3f-430">API name</span></span> |
| --- | --- | --- |
| <span data-ttu-id="b7f3f-431">message-id</span><span class="sxs-lookup"><span data-stu-id="b7f3f-431">message-id</span></span> |<span data-ttu-id="b7f3f-432">Application-defined, free-form identifier for this message.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-432">Application-defined, free-form identifier for this message.</span></span> <span data-ttu-id="b7f3f-433">Used for duplicate detection.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-433">Used for duplicate detection.</span></span> |[<span data-ttu-id="b7f3f-434">MessageId</span><span class="sxs-lookup"><span data-stu-id="b7f3f-434">MessageId</span></span>](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId) |
| <span data-ttu-id="b7f3f-435">user-id</span><span class="sxs-lookup"><span data-stu-id="b7f3f-435">user-id</span></span> |<span data-ttu-id="b7f3f-436">Application-defined user identifier, not interpreted by Service Bus.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-436">Application-defined user identifier, not interpreted by Service Bus.</span></span> |<span data-ttu-id="b7f3f-437">Not accessible through the Service Bus API.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-437">Not accessible through the Service Bus API.</span></span> |
| <span data-ttu-id="b7f3f-438">to</span><span class="sxs-lookup"><span data-stu-id="b7f3f-438">to</span></span> |<span data-ttu-id="b7f3f-439">Application-defined destination identifier, not interpreted by Service Bus.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-439">Application-defined destination identifier, not interpreted by Service Bus.</span></span> |[<span data-ttu-id="b7f3f-440">To</span><span class="sxs-lookup"><span data-stu-id="b7f3f-440">To</span></span>](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_To) |
| <span data-ttu-id="b7f3f-441">subject</span><span class="sxs-lookup"><span data-stu-id="b7f3f-441">subject</span></span> |<span data-ttu-id="b7f3f-442">Application-defined message purpose identifier, not interpreted by Service Bus.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-442">Application-defined message purpose identifier, not interpreted by Service Bus.</span></span> |[<span data-ttu-id="b7f3f-443">Label</span><span class="sxs-lookup"><span data-stu-id="b7f3f-443">Label</span></span>](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) |
| <span data-ttu-id="b7f3f-444">reply-to</span><span class="sxs-lookup"><span data-stu-id="b7f3f-444">reply-to</span></span> |<span data-ttu-id="b7f3f-445">Application-defined reply-path indicator, not interpreted by Service Bus.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-445">Application-defined reply-path indicator, not interpreted by Service Bus.</span></span> |[<span data-ttu-id="b7f3f-446">ReplyTo</span><span class="sxs-lookup"><span data-stu-id="b7f3f-446">ReplyTo</span></span>](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_ReplyTo) |
| <span data-ttu-id="b7f3f-447">correlation-id</span><span class="sxs-lookup"><span data-stu-id="b7f3f-447">correlation-id</span></span> |<span data-ttu-id="b7f3f-448">Application-defined correlation identifier, not interpreted by Service Bus.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-448">Application-defined correlation identifier, not interpreted by Service Bus.</span></span> |[<span data-ttu-id="b7f3f-449">CorrelationId</span><span class="sxs-lookup"><span data-stu-id="b7f3f-449">CorrelationId</span></span>](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_CorrelationId) |
| <span data-ttu-id="b7f3f-450">content-type</span><span class="sxs-lookup"><span data-stu-id="b7f3f-450">content-type</span></span> |<span data-ttu-id="b7f3f-451">Application-defined content-type indicator for the body, not interpreted by Service Bus.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-451">Application-defined content-type indicator for the body, not interpreted by Service Bus.</span></span> |[<span data-ttu-id="b7f3f-452">ContentType</span><span class="sxs-lookup"><span data-stu-id="b7f3f-452">ContentType</span></span>](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_ContentType) |
| <span data-ttu-id="b7f3f-453">content-encoding</span><span class="sxs-lookup"><span data-stu-id="b7f3f-453">content-encoding</span></span> |<span data-ttu-id="b7f3f-454">Application-defined content-encoding indicator for the body, not interpreted by Service Bus.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-454">Application-defined content-encoding indicator for the body, not interpreted by Service Bus.</span></span> |<span data-ttu-id="b7f3f-455">Not accessible through the Service Bus API.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-455">Not accessible through the Service Bus API.</span></span> |
| <span data-ttu-id="b7f3f-456">absolute-expiry-time</span><span class="sxs-lookup"><span data-stu-id="b7f3f-456">absolute-expiry-time</span></span> |<span data-ttu-id="b7f3f-457">Declares at which absolute instant the message will expire.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-457">Declares at which absolute instant the message will expire.</span></span> <span data-ttu-id="b7f3f-458">Ignored on input (header TTL is observed), authoritative on output.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-458">Ignored on input (header TTL is observed), authoritative on output.</span></span> |[<span data-ttu-id="b7f3f-459">ExpiresAtUtc</span><span class="sxs-lookup"><span data-stu-id="b7f3f-459">ExpiresAtUtc</span></span>](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_ExpiresAtUtc) |
| <span data-ttu-id="b7f3f-460">creation-time</span><span class="sxs-lookup"><span data-stu-id="b7f3f-460">creation-time</span></span> |<span data-ttu-id="b7f3f-461">Declares at which time the message was created.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-461">Declares at which time the message was created.</span></span> <span data-ttu-id="b7f3f-462">Not used by Service Bus</span><span class="sxs-lookup"><span data-stu-id="b7f3f-462">Not used by Service Bus</span></span> |<span data-ttu-id="b7f3f-463">Not accessible through the Service Bus API.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-463">Not accessible through the Service Bus API.</span></span> |
| <span data-ttu-id="b7f3f-464">group-id</span><span class="sxs-lookup"><span data-stu-id="b7f3f-464">group-id</span></span> |<span data-ttu-id="b7f3f-465">Application-defined identifier for a related set of messages.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-465">Application-defined identifier for a related set of messages.</span></span> <span data-ttu-id="b7f3f-466">Used for Service Bus sessions.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-466">Used for Service Bus sessions.</span></span> |[<span data-ttu-id="b7f3f-467">SessionId</span><span class="sxs-lookup"><span data-stu-id="b7f3f-467">SessionId</span></span>](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_SessionId) |
| <span data-ttu-id="b7f3f-468">group-sequence</span><span class="sxs-lookup"><span data-stu-id="b7f3f-468">group-sequence</span></span> |<span data-ttu-id="b7f3f-469">Counter identifying the relative sequence number of the message inside a session.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-469">Counter identifying the relative sequence number of the message inside a session.</span></span> <span data-ttu-id="b7f3f-470">Ignored by Service Bus.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-470">Ignored by Service Bus.</span></span> |<span data-ttu-id="b7f3f-471">Not accessible through the Service Bus API.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-471">Not accessible through the Service Bus API.</span></span> |
| <span data-ttu-id="b7f3f-472">reply-to-group-id</span><span class="sxs-lookup"><span data-stu-id="b7f3f-472">reply-to-group-id</span></span> |- |[<span data-ttu-id="b7f3f-473">ReplyToSessionId</span><span class="sxs-lookup"><span data-stu-id="b7f3f-473">ReplyToSessionId</span></span>](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_ReplyToSessionId) |

## <a name="advanced-service-bus-capabilities"></a><span data-ttu-id="b7f3f-474">Advanced Service Bus capabilities</span><span class="sxs-lookup"><span data-stu-id="b7f3f-474">Advanced Service Bus capabilities</span></span>

<span data-ttu-id="b7f3f-475">This section covers advanced capabilities of Azure Service Bus that are based on draft extensions to AMQP, currently being developed in the OASIS Technical Committee for AMQP.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-475">This section covers advanced capabilities of Azure Service Bus that are based on draft extensions to AMQP, currently being developed in the OASIS Technical Committee for AMQP.</span></span> <span data-ttu-id="b7f3f-476">Service Bus implements the latest versions of these drafts and will adopt changes introduced as those drafts reach standard status.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-476">Service Bus implements the latest versions of these drafts and will adopt changes introduced as those drafts reach standard status.</span></span>

> [!NOTE]
> <span data-ttu-id="b7f3f-477">Service Bus Messaging advanced operations are supported through a request/response pattern.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-477">Service Bus Messaging advanced operations are supported through a request/response pattern.</span></span> <span data-ttu-id="b7f3f-478">The details of these operations are described in the document [AMQP 1.0 in Service Bus: request-response-based operations](service-bus-amqp-request-response.md).</span><span class="sxs-lookup"><span data-stu-id="b7f3f-478">The details of these operations are described in the document [AMQP 1.0 in Service Bus: request-response-based operations](service-bus-amqp-request-response.md).</span></span>
> 
> 

### <a name="amqp-management"></a><span data-ttu-id="b7f3f-479">AMQP management</span><span class="sxs-lookup"><span data-stu-id="b7f3f-479">AMQP management</span></span>

<span data-ttu-id="b7f3f-480">The AMQP management specification is the first of the draft extensions we’ll discuss here.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-480">The AMQP management specification is the first of the draft extensions we’ll discuss here.</span></span> <span data-ttu-id="b7f3f-481">This specification defines a set of protocol gestures layered on top of the AMQP protocol that allow management interactions with the messaging infrastructure over AMQP.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-481">This specification defines a set of protocol gestures layered on top of the AMQP protocol that allow management interactions with the messaging infrastructure over AMQP.</span></span> <span data-ttu-id="b7f3f-482">The specification defines generic operations such as *create*, *read*, *update*, and *delete* for managing entities inside a messaging infrastructure and a set of query operations.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-482">The specification defines generic operations such as *create*, *read*, *update*, and *delete* for managing entities inside a messaging infrastructure and a set of query operations.</span></span>

<span data-ttu-id="b7f3f-483">All those gestures require a request/response interaction between the client and the messaging infrastructure, and therefore the specification defines how to model that interaction pattern on top of AMQP: the client connects to the messaging infrastructure, initiates a session, and then creates a pair of links.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-483">All those gestures require a request/response interaction between the client and the messaging infrastructure, and therefore the specification defines how to model that interaction pattern on top of AMQP: the client connects to the messaging infrastructure, initiates a session, and then creates a pair of links.</span></span> <span data-ttu-id="b7f3f-484">On one link, the client acts as sender and on the other it acts as receiver, thus creating a pair of links that can act as a bi-directional channel.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-484">On one link, the client acts as sender and on the other it acts as receiver, thus creating a pair of links that can act as a bi-directional channel.</span></span>

| <span data-ttu-id="b7f3f-485">Logical Operation</span><span class="sxs-lookup"><span data-stu-id="b7f3f-485">Logical Operation</span></span> | <span data-ttu-id="b7f3f-486">Client</span><span class="sxs-lookup"><span data-stu-id="b7f3f-486">Client</span></span> | <span data-ttu-id="b7f3f-487">Service Bus</span><span class="sxs-lookup"><span data-stu-id="b7f3f-487">Service Bus</span></span> |
| --- | --- | --- |
| <span data-ttu-id="b7f3f-488">Create Request Response Path</span><span class="sxs-lookup"><span data-stu-id="b7f3f-488">Create Request Response Path</span></span> |<span data-ttu-id="b7f3f-489">--> attach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-489">--> attach(</span></span><br/><span data-ttu-id="b7f3f-490">name={*link name*},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-490">name={*link name*},</span></span><br/><span data-ttu-id="b7f3f-491">handle={*numeric handle*},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-491">handle={*numeric handle*},</span></span><br/><span data-ttu-id="b7f3f-492">role=**sender**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-492">role=**sender**,</span></span><br/><span data-ttu-id="b7f3f-493">source=**null**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-493">source=**null**,</span></span><br/><span data-ttu-id="b7f3f-494">target=”myentity/$management”</span><span class="sxs-lookup"><span data-stu-id="b7f3f-494">target=”myentity/$management”</span></span><br/><span data-ttu-id="b7f3f-495">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-495">)</span></span> |<span data-ttu-id="b7f3f-496">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-496">No action</span></span> |
| <span data-ttu-id="b7f3f-497">Create Request Response Path</span><span class="sxs-lookup"><span data-stu-id="b7f3f-497">Create Request Response Path</span></span> |<span data-ttu-id="b7f3f-498">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-498">No action</span></span> |<span data-ttu-id="b7f3f-499">\<-- attach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-499">\<-- attach(</span></span><br/><span data-ttu-id="b7f3f-500">name={*link name*},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-500">name={*link name*},</span></span><br/><span data-ttu-id="b7f3f-501">handle={*numeric handle*},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-501">handle={*numeric handle*},</span></span><br/><span data-ttu-id="b7f3f-502">role=**receiver**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-502">role=**receiver**,</span></span><br/><span data-ttu-id="b7f3f-503">source=null,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-503">source=null,</span></span><br/><span data-ttu-id="b7f3f-504">target=”myentity”</span><span class="sxs-lookup"><span data-stu-id="b7f3f-504">target=”myentity”</span></span><br/><span data-ttu-id="b7f3f-505">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-505">)</span></span> |
| <span data-ttu-id="b7f3f-506">Create Request Response Path</span><span class="sxs-lookup"><span data-stu-id="b7f3f-506">Create Request Response Path</span></span> |<span data-ttu-id="b7f3f-507">--> attach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-507">--> attach(</span></span><br/><span data-ttu-id="b7f3f-508">name={*link name*},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-508">name={*link name*},</span></span><br/><span data-ttu-id="b7f3f-509">handle={*numeric handle*},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-509">handle={*numeric handle*},</span></span><br/><span data-ttu-id="b7f3f-510">role=**receiver**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-510">role=**receiver**,</span></span><br/><span data-ttu-id="b7f3f-511">source=”myentity/$management”,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-511">source=”myentity/$management”,</span></span><br/><span data-ttu-id="b7f3f-512">target=”myclient$id”</span><span class="sxs-lookup"><span data-stu-id="b7f3f-512">target=”myclient$id”</span></span><br/><span data-ttu-id="b7f3f-513">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-513">)</span></span> | |
| <span data-ttu-id="b7f3f-514">Create Request Response Path</span><span class="sxs-lookup"><span data-stu-id="b7f3f-514">Create Request Response Path</span></span> |<span data-ttu-id="b7f3f-515">No action</span><span class="sxs-lookup"><span data-stu-id="b7f3f-515">No action</span></span> |<span data-ttu-id="b7f3f-516">\<-- attach(</span><span class="sxs-lookup"><span data-stu-id="b7f3f-516">\<-- attach(</span></span><br/><span data-ttu-id="b7f3f-517">name={*link name*},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-517">name={*link name*},</span></span><br/><span data-ttu-id="b7f3f-518">handle={*numeric handle*},</span><span class="sxs-lookup"><span data-stu-id="b7f3f-518">handle={*numeric handle*},</span></span><br/><span data-ttu-id="b7f3f-519">role=**sender**,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-519">role=**sender**,</span></span><br/><span data-ttu-id="b7f3f-520">source=”myentity”,</span><span class="sxs-lookup"><span data-stu-id="b7f3f-520">source=”myentity”,</span></span><br/><span data-ttu-id="b7f3f-521">target=”myclient$id”</span><span class="sxs-lookup"><span data-stu-id="b7f3f-521">target=”myclient$id”</span></span><br/><span data-ttu-id="b7f3f-522">)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-522">)</span></span> |

<span data-ttu-id="b7f3f-523">Having that pair of links in place, the request/response implementation is straightforward: a request is a message sent to an entity inside the messaging infrastructure that understands this pattern.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-523">Having that pair of links in place, the request/response implementation is straightforward: a request is a message sent to an entity inside the messaging infrastructure that understands this pattern.</span></span> <span data-ttu-id="b7f3f-524">In that request-message, the *reply-to* field in the *properties* section is set to the *target* identifier for the link onto which to deliver the response.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-524">In that request-message, the *reply-to* field in the *properties* section is set to the *target* identifier for the link onto which to deliver the response.</span></span> <span data-ttu-id="b7f3f-525">The handling entity will process the request, and then deliver the reply over the link whose *target* identifier matches the indicated *reply-to* identifier.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-525">The handling entity will process the request, and then deliver the reply over the link whose *target* identifier matches the indicated *reply-to* identifier.</span></span>

<span data-ttu-id="b7f3f-526">The pattern obviously requires that the client container and the client-generated identifier for the reply destination are unique across all clients and, for security reasons, also difficult to predict.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-526">The pattern obviously requires that the client container and the client-generated identifier for the reply destination are unique across all clients and, for security reasons, also difficult to predict.</span></span>

<span data-ttu-id="b7f3f-527">The message exchanges used for the management protocol and for all other protocols that use the same pattern happen at the application level; they do not define new AMQP protocol-level gestures.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-527">The message exchanges used for the management protocol and for all other protocols that use the same pattern happen at the application level; they do not define new AMQP protocol-level gestures.</span></span> <span data-ttu-id="b7f3f-528">That's intentional, so that applications can take immediate advantage of these extensions with compliant AMQP 1.0 stacks.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-528">That's intentional, so that applications can take immediate advantage of these extensions with compliant AMQP 1.0 stacks.</span></span>

<span data-ttu-id="b7f3f-529">Service Bus does not currently implement any of the core features of the management specification, but the request/response pattern defined by the management specification is foundational for the claims-based-security feature and for nearly all of the advanced capabilities we will discuss in the following sections.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-529">Service Bus does not currently implement any of the core features of the management specification, but the request/response pattern defined by the management specification is foundational for the claims-based-security feature and for nearly all of the advanced capabilities we will discuss in the following sections.</span></span>

### <a name="claims-based-authorization"></a><span data-ttu-id="b7f3f-530">Claims-based authorization</span><span class="sxs-lookup"><span data-stu-id="b7f3f-530">Claims-based authorization</span></span>

<span data-ttu-id="b7f3f-531">The AMQP Claims-Based-Authorization (CBS) specification draft builds on the management specification request/response pattern, and describes a generalized model for how to use federated security tokens with AMQP.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-531">The AMQP Claims-Based-Authorization (CBS) specification draft builds on the management specification request/response pattern, and describes a generalized model for how to use federated security tokens with AMQP.</span></span>

<span data-ttu-id="b7f3f-532">The default security model of AMQP discussed in the introduction is based on SASL and integrates with the AMQP connection handshake.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-532">The default security model of AMQP discussed in the introduction is based on SASL and integrates with the AMQP connection handshake.</span></span> <span data-ttu-id="b7f3f-533">Using SASL has the advantage that it provides an extensible model for which a set of mechanisms have been defined from which any protocol that formally leans on SASL can benefit.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-533">Using SASL has the advantage that it provides an extensible model for which a set of mechanisms have been defined from which any protocol that formally leans on SASL can benefit.</span></span> <span data-ttu-id="b7f3f-534">Among those mechanisms are “PLAIN” for transfer of usernames and passwords, “EXTERNAL” to bind to TLS-level security, “ANONYMOUS” to express the absence of explicit authentication/authorization, and a broad variety of additional mechanisms that allow passing authentication and/or authorization credentials or tokens.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-534">Among those mechanisms are “PLAIN” for transfer of usernames and passwords, “EXTERNAL” to bind to TLS-level security, “ANONYMOUS” to express the absence of explicit authentication/authorization, and a broad variety of additional mechanisms that allow passing authentication and/or authorization credentials or tokens.</span></span>

<span data-ttu-id="b7f3f-535">AMQP’s SASL integration has two drawbacks:</span><span class="sxs-lookup"><span data-stu-id="b7f3f-535">AMQP’s SASL integration has two drawbacks:</span></span>

* <span data-ttu-id="b7f3f-536">All credentials and tokens are scoped to the connection.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-536">All credentials and tokens are scoped to the connection.</span></span> <span data-ttu-id="b7f3f-537">A messaging infrastructure may want to provide differentiated access control on a per-entity basis; for example, allowing the bearer of a token to send to queue A but not to queue B. With the authorization context anchored on the connection, it’s not possible to use a single connection and yet use different access tokens for queue A and queue B.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-537">A messaging infrastructure may want to provide differentiated access control on a per-entity basis; for example, allowing the bearer of a token to send to queue A but not to queue B. With the authorization context anchored on the connection, it’s not possible to use a single connection and yet use different access tokens for queue A and queue B.</span></span>
* <span data-ttu-id="b7f3f-538">Access tokens are typically only valid for a limited time.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-538">Access tokens are typically only valid for a limited time.</span></span> <span data-ttu-id="b7f3f-539">This requires the user to periodically reacquire tokens and provides an opportunity to the token issuer to refuse issuing a fresh token if the user’s access permissions have changed.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-539">This requires the user to periodically reacquire tokens and provides an opportunity to the token issuer to refuse issuing a fresh token if the user’s access permissions have changed.</span></span> <span data-ttu-id="b7f3f-540">AMQP connections may last for very long periods of time.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-540">AMQP connections may last for very long periods of time.</span></span> <span data-ttu-id="b7f3f-541">The SASL model only provides a chance to set a token at connection time, which means that the messaging infrastructure either has to disconnect the client when the token expires or it needs to accept the risk of allowing continued communication with a client who’s access rights may have been revoked in the interim.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-541">The SASL model only provides a chance to set a token at connection time, which means that the messaging infrastructure either has to disconnect the client when the token expires or it needs to accept the risk of allowing continued communication with a client who’s access rights may have been revoked in the interim.</span></span>

<span data-ttu-id="b7f3f-542">The AMQP CBS specification, implemented by Service Bus, enables an elegant workaround for both of those issues: It allows a client to associate access tokens with each node, and to update those tokens before they expire, without interrupting the message flow.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-542">The AMQP CBS specification, implemented by Service Bus, enables an elegant workaround for both of those issues: It allows a client to associate access tokens with each node, and to update those tokens before they expire, without interrupting the message flow.</span></span>

<span data-ttu-id="b7f3f-543">CBS defines a virtual management node, named *$cbs*, to be provided by the messaging infrastructure.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-543">CBS defines a virtual management node, named *$cbs*, to be provided by the messaging infrastructure.</span></span> <span data-ttu-id="b7f3f-544">The management node accepts tokens on behalf of any other nodes in the messaging infrastructure.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-544">The management node accepts tokens on behalf of any other nodes in the messaging infrastructure.</span></span>

<span data-ttu-id="b7f3f-545">The protocol gesture is a request/reply exchange as defined by the management specification.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-545">The protocol gesture is a request/reply exchange as defined by the management specification.</span></span> <span data-ttu-id="b7f3f-546">That means the client establishes a pair of links with the *$cbs* node and then passes a request on the outbound link, and then waits for the response on the inbound link.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-546">That means the client establishes a pair of links with the *$cbs* node and then passes a request on the outbound link, and then waits for the response on the inbound link.</span></span>

<span data-ttu-id="b7f3f-547">The request message has the following application properties:</span><span class="sxs-lookup"><span data-stu-id="b7f3f-547">The request message has the following application properties:</span></span>

| <span data-ttu-id="b7f3f-548">Key</span><span class="sxs-lookup"><span data-stu-id="b7f3f-548">Key</span></span> | <span data-ttu-id="b7f3f-549">Optional</span><span class="sxs-lookup"><span data-stu-id="b7f3f-549">Optional</span></span> | <span data-ttu-id="b7f3f-550">Value Type</span><span class="sxs-lookup"><span data-stu-id="b7f3f-550">Value Type</span></span> | <span data-ttu-id="b7f3f-551">Value Contents</span><span class="sxs-lookup"><span data-stu-id="b7f3f-551">Value Contents</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="b7f3f-552">operation</span><span class="sxs-lookup"><span data-stu-id="b7f3f-552">operation</span></span> |<span data-ttu-id="b7f3f-553">No</span><span class="sxs-lookup"><span data-stu-id="b7f3f-553">No</span></span> |<span data-ttu-id="b7f3f-554">string</span><span class="sxs-lookup"><span data-stu-id="b7f3f-554">string</span></span> |<span data-ttu-id="b7f3f-555">**put-token**</span><span class="sxs-lookup"><span data-stu-id="b7f3f-555">**put-token**</span></span> |
| <span data-ttu-id="b7f3f-556">type</span><span class="sxs-lookup"><span data-stu-id="b7f3f-556">type</span></span> |<span data-ttu-id="b7f3f-557">No</span><span class="sxs-lookup"><span data-stu-id="b7f3f-557">No</span></span> |<span data-ttu-id="b7f3f-558">string</span><span class="sxs-lookup"><span data-stu-id="b7f3f-558">string</span></span> |<span data-ttu-id="b7f3f-559">The type of the token being put.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-559">The type of the token being put.</span></span> |
| <span data-ttu-id="b7f3f-560">name</span><span class="sxs-lookup"><span data-stu-id="b7f3f-560">name</span></span> |<span data-ttu-id="b7f3f-561">No</span><span class="sxs-lookup"><span data-stu-id="b7f3f-561">No</span></span> |<span data-ttu-id="b7f3f-562">string</span><span class="sxs-lookup"><span data-stu-id="b7f3f-562">string</span></span> |<span data-ttu-id="b7f3f-563">The "audience" to which the token applies.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-563">The "audience" to which the token applies.</span></span> |
| <span data-ttu-id="b7f3f-564">expiration</span><span class="sxs-lookup"><span data-stu-id="b7f3f-564">expiration</span></span> |<span data-ttu-id="b7f3f-565">Yes</span><span class="sxs-lookup"><span data-stu-id="b7f3f-565">Yes</span></span> |<span data-ttu-id="b7f3f-566">timestamp</span><span class="sxs-lookup"><span data-stu-id="b7f3f-566">timestamp</span></span> |<span data-ttu-id="b7f3f-567">The expiry time of the token.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-567">The expiry time of the token.</span></span> |

<span data-ttu-id="b7f3f-568">The *name* property identifies the entity with which the token shall be associated.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-568">The *name* property identifies the entity with which the token shall be associated.</span></span> <span data-ttu-id="b7f3f-569">In Service Bus it's the path to the queue, or topic/subscription.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-569">In Service Bus it's the path to the queue, or topic/subscription.</span></span> <span data-ttu-id="b7f3f-570">The *type* property identifies the token type:</span><span class="sxs-lookup"><span data-stu-id="b7f3f-570">The *type* property identifies the token type:</span></span>

| <span data-ttu-id="b7f3f-571">Token Type</span><span class="sxs-lookup"><span data-stu-id="b7f3f-571">Token Type</span></span> | <span data-ttu-id="b7f3f-572">Token Description</span><span class="sxs-lookup"><span data-stu-id="b7f3f-572">Token Description</span></span> | <span data-ttu-id="b7f3f-573">Body Type</span><span class="sxs-lookup"><span data-stu-id="b7f3f-573">Body Type</span></span> | <span data-ttu-id="b7f3f-574">Notes</span><span class="sxs-lookup"><span data-stu-id="b7f3f-574">Notes</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="b7f3f-575">amqp:jwt</span><span class="sxs-lookup"><span data-stu-id="b7f3f-575">amqp:jwt</span></span> |<span data-ttu-id="b7f3f-576">JSON Web Token (JWT)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-576">JSON Web Token (JWT)</span></span> |<span data-ttu-id="b7f3f-577">AMQP Value (string)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-577">AMQP Value (string)</span></span> |<span data-ttu-id="b7f3f-578">Not yet available.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-578">Not yet available.</span></span> |
| <span data-ttu-id="b7f3f-579">amqp:swt</span><span class="sxs-lookup"><span data-stu-id="b7f3f-579">amqp:swt</span></span> |<span data-ttu-id="b7f3f-580">Simple Web Token (SWT)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-580">Simple Web Token (SWT)</span></span> |<span data-ttu-id="b7f3f-581">AMQP Value (string)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-581">AMQP Value (string)</span></span> |<span data-ttu-id="b7f3f-582">Only supported for SWT tokens issued by AAD/ACS</span><span class="sxs-lookup"><span data-stu-id="b7f3f-582">Only supported for SWT tokens issued by AAD/ACS</span></span> |
| <span data-ttu-id="b7f3f-583">servicebus.windows.net:sastoken</span><span class="sxs-lookup"><span data-stu-id="b7f3f-583">servicebus.windows.net:sastoken</span></span> |<span data-ttu-id="b7f3f-584">Service Bus SAS Token</span><span class="sxs-lookup"><span data-stu-id="b7f3f-584">Service Bus SAS Token</span></span> |<span data-ttu-id="b7f3f-585">AMQP Value (string)</span><span class="sxs-lookup"><span data-stu-id="b7f3f-585">AMQP Value (string)</span></span> |- |

<span data-ttu-id="b7f3f-586">Tokens confer rights.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-586">Tokens confer rights.</span></span> <span data-ttu-id="b7f3f-587">Service Bus knows about three fundamental rights: "Send" enables sending, "Listen" enables receiving, and "Manage" enables manipulating entities.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-587">Service Bus knows about three fundamental rights: "Send" enables sending, "Listen" enables receiving, and "Manage" enables manipulating entities.</span></span> <span data-ttu-id="b7f3f-588">SWT tokens issued by AAD/ACS explicitly include those rights as claims.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-588">SWT tokens issued by AAD/ACS explicitly include those rights as claims.</span></span> <span data-ttu-id="b7f3f-589">Service Bus SAS tokens refer to rules configured on the namespace or entity, and those rules are configured with rights.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-589">Service Bus SAS tokens refer to rules configured on the namespace or entity, and those rules are configured with rights.</span></span> <span data-ttu-id="b7f3f-590">Signing the token with the key associated with that rule thus makes the token express the respective rights.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-590">Signing the token with the key associated with that rule thus makes the token express the respective rights.</span></span> <span data-ttu-id="b7f3f-591">The token associated with an entity using *put-token* permits the connected client to interact with the entity per the token rights.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-591">The token associated with an entity using *put-token* permits the connected client to interact with the entity per the token rights.</span></span> <span data-ttu-id="b7f3f-592">A link where the client takes on the *sender* role requires the "Send" right; taking on the *receiver* role requires the "Listen" right.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-592">A link where the client takes on the *sender* role requires the "Send" right; taking on the *receiver* role requires the "Listen" right.</span></span>

<span data-ttu-id="b7f3f-593">The reply message has the following *application-properties* values</span><span class="sxs-lookup"><span data-stu-id="b7f3f-593">The reply message has the following *application-properties* values</span></span>

| <span data-ttu-id="b7f3f-594">Key</span><span class="sxs-lookup"><span data-stu-id="b7f3f-594">Key</span></span> | <span data-ttu-id="b7f3f-595">Optional</span><span class="sxs-lookup"><span data-stu-id="b7f3f-595">Optional</span></span> | <span data-ttu-id="b7f3f-596">Value Type</span><span class="sxs-lookup"><span data-stu-id="b7f3f-596">Value Type</span></span> | <span data-ttu-id="b7f3f-597">Value Contents</span><span class="sxs-lookup"><span data-stu-id="b7f3f-597">Value Contents</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="b7f3f-598">status-code</span><span class="sxs-lookup"><span data-stu-id="b7f3f-598">status-code</span></span> |<span data-ttu-id="b7f3f-599">No</span><span class="sxs-lookup"><span data-stu-id="b7f3f-599">No</span></span> |<span data-ttu-id="b7f3f-600">int</span><span class="sxs-lookup"><span data-stu-id="b7f3f-600">int</span></span> |<span data-ttu-id="b7f3f-601">HTTP response code **[RFC2616]**.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-601">HTTP response code **[RFC2616]**.</span></span> |
| <span data-ttu-id="b7f3f-602">status-description</span><span class="sxs-lookup"><span data-stu-id="b7f3f-602">status-description</span></span> |<span data-ttu-id="b7f3f-603">Yes</span><span class="sxs-lookup"><span data-stu-id="b7f3f-603">Yes</span></span> |<span data-ttu-id="b7f3f-604">string</span><span class="sxs-lookup"><span data-stu-id="b7f3f-604">string</span></span> |<span data-ttu-id="b7f3f-605">Description of the status.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-605">Description of the status.</span></span> |

<span data-ttu-id="b7f3f-606">The client can call *put-token* repeatedly and for any entity in the messaging infrastructure.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-606">The client can call *put-token* repeatedly and for any entity in the messaging infrastructure.</span></span> <span data-ttu-id="b7f3f-607">The tokens are scoped to the current client and anchored on the current connection, meaning the server will drop any retained tokens when the connection drops.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-607">The tokens are scoped to the current client and anchored on the current connection, meaning the server will drop any retained tokens when the connection drops.</span></span>

<span data-ttu-id="b7f3f-608">The current Service Bus implementation only allows CBS in conjunction with the SASL method “ANONYMOUS”.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-608">The current Service Bus implementation only allows CBS in conjunction with the SASL method “ANONYMOUS”.</span></span> <span data-ttu-id="b7f3f-609">A SSL/TLS connection must always exist prior to the SASL handshake.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-609">A SSL/TLS connection must always exist prior to the SASL handshake.</span></span>

<span data-ttu-id="b7f3f-610">The ANONYMOUS mechanism must therefore be supported by the chosen AMQP 1.0 client.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-610">The ANONYMOUS mechanism must therefore be supported by the chosen AMQP 1.0 client.</span></span> <span data-ttu-id="b7f3f-611">Anonymous access means that the initial connection handshake, including creating of the initial session happens without Service Bus knowing who is creating the connection.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-611">Anonymous access means that the initial connection handshake, including creating of the initial session happens without Service Bus knowing who is creating the connection.</span></span>

<span data-ttu-id="b7f3f-612">Once the connection and session is established, attaching the links to the *$cbs* node and sending the *put-token* request are the only permitted operations.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-612">Once the connection and session is established, attaching the links to the *$cbs* node and sending the *put-token* request are the only permitted operations.</span></span> <span data-ttu-id="b7f3f-613">A valid token must be set successfully using a *put-token* request for some entity node within 20 seconds after the connection has been established, otherwise the connection is unilaterally dropped by Service Bus.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-613">A valid token must be set successfully using a *put-token* request for some entity node within 20 seconds after the connection has been established, otherwise the connection is unilaterally dropped by Service Bus.</span></span>

<span data-ttu-id="b7f3f-614">The client is subsequently responsible for keeping track of token expiration.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-614">The client is subsequently responsible for keeping track of token expiration.</span></span> <span data-ttu-id="b7f3f-615">When a token expires, Service Bus promptly drops all links on the connection to the respective entity.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-615">When a token expires, Service Bus promptly drops all links on the connection to the respective entity.</span></span> <span data-ttu-id="b7f3f-616">To prevent this, the client can replace the token for the node with a new one at any time through the virtual *$cbs* management node with the same *put-token* gesture, and without getting in the way of the payload traffic that flows on different links.</span><span class="sxs-lookup"><span data-stu-id="b7f3f-616">To prevent this, the client can replace the token for the node with a new one at any time through the virtual *$cbs* management node with the same *put-token* gesture, and without getting in the way of the payload traffic that flows on different links.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b7f3f-617">Next steps</span><span class="sxs-lookup"><span data-stu-id="b7f3f-617">Next steps</span></span>

<span data-ttu-id="b7f3f-618">To learn more about AMQP, visit the following links:</span><span class="sxs-lookup"><span data-stu-id="b7f3f-618">To learn more about AMQP, visit the following links:</span></span>

* <span data-ttu-id="b7f3f-619">[Service Bus AMQP overview]</span><span class="sxs-lookup"><span data-stu-id="b7f3f-619">[Service Bus AMQP overview]</span></span>
* <span data-ttu-id="b7f3f-620">[AMQP 1.0 support for Service Bus partitioned queues and topics]</span><span class="sxs-lookup"><span data-stu-id="b7f3f-620">[AMQP 1.0 support for Service Bus partitioned queues and topics]</span></span>
* <span data-ttu-id="b7f3f-621">[AMQP in Service Bus for Windows Server]</span><span class="sxs-lookup"><span data-stu-id="b7f3f-621">[AMQP in Service Bus for Windows Server]</span></span>

[this video course]: https://www.youtube.com/playlist?list=PLmE4bZU0qx-wAP02i0I7PJWvDWoCytEjD
[1]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-bus-messaging/media/service-bus-amqp-protocol-guide/amqp1.png
[2]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-bus-messaging/media/service-bus-amqp-protocol-guide/amqp2.png
[3]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-bus-messaging/media/service-bus-amqp-protocol-guide/amqp3.png
[4]: https://docstestmedia1.blob.core.windows.net/azure-media/articles/service-bus-messaging/media/service-bus-amqp-protocol-guide/amqp4.png

[Service Bus AMQP overview]: service-bus-amqp-overview.md
[AMQP 1.0 support for Service Bus partitioned queues and topics]: service-bus-partitioned-queues-and-topics-amqp-overview.md
[AMQP in Service Bus for Windows Server]: https://msdn.microsoft.com/library/dn574799.aspx




