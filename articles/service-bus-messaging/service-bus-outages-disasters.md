---
title: Insulating Azure Service Bus applications against outages and disasters | Microsoft Docs
description: Techniques to protect applications against a potential Service Bus outage.
services: service-bus-messaging
author: spelluru
manager: timlt
ms.service: service-bus-messaging
ms.topic: article
ms.date: 06/14/2018
ms.author: spelluru
ms.openlocfilehash: 5401d43f11c8afc02f48dd643fd4ff2f9611e06e
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44827786"
---
# <a name="best-practices-for-insulating-applications-against-service-bus-outages-and-disasters"></a><span data-ttu-id="6d3e8-103">Best practices for insulating applications against Service Bus outages and disasters</span><span class="sxs-lookup"><span data-stu-id="6d3e8-103">Best practices for insulating applications against Service Bus outages and disasters</span></span>

<span data-ttu-id="6d3e8-104">Mission-critical applications must operate continuously, even in the presence of unplanned outages or disasters.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-104">Mission-critical applications must operate continuously, even in the presence of unplanned outages or disasters.</span></span> <span data-ttu-id="6d3e8-105">This article describes techniques you can use to protect Service Bus applications against a potential service outage or disaster.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-105">This article describes techniques you can use to protect Service Bus applications against a potential service outage or disaster.</span></span>

<span data-ttu-id="6d3e8-106">An outage is defined as the temporary unavailability of Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-106">An outage is defined as the temporary unavailability of Azure Service Bus.</span></span> <span data-ttu-id="6d3e8-107">The outage can affect some components of Service Bus, such as a messaging store, or even the entire datacenter.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-107">The outage can affect some components of Service Bus, such as a messaging store, or even the entire datacenter.</span></span> <span data-ttu-id="6d3e8-108">After the problem has been fixed, Service Bus becomes available again.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-108">After the problem has been fixed, Service Bus becomes available again.</span></span> <span data-ttu-id="6d3e8-109">Typically, an outage does not cause loss of messages or other data.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-109">Typically, an outage does not cause loss of messages or other data.</span></span> <span data-ttu-id="6d3e8-110">An example of a component failure is the unavailability of a particular messaging store.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-110">An example of a component failure is the unavailability of a particular messaging store.</span></span> <span data-ttu-id="6d3e8-111">An example of a datacenter-wide outage is a power failure of the datacenter, or a faulty datacenter network switch.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-111">An example of a datacenter-wide outage is a power failure of the datacenter, or a faulty datacenter network switch.</span></span> <span data-ttu-id="6d3e8-112">An outage can last from a few minutes to a few days.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-112">An outage can last from a few minutes to a few days.</span></span>

<span data-ttu-id="6d3e8-113">A disaster is defined as the permanent loss of a Service Bus scale unit or datacenter.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-113">A disaster is defined as the permanent loss of a Service Bus scale unit or datacenter.</span></span> <span data-ttu-id="6d3e8-114">The datacenter may or may not become available again.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-114">The datacenter may or may not become available again.</span></span> <span data-ttu-id="6d3e8-115">Typically a disaster causes loss of some or all messages or other data.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-115">Typically a disaster causes loss of some or all messages or other data.</span></span> <span data-ttu-id="6d3e8-116">Examples of disasters are fire, flooding, or earthquake.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-116">Examples of disasters are fire, flooding, or earthquake.</span></span>

## <a name="current-architecture"></a><span data-ttu-id="6d3e8-117">Current architecture</span><span class="sxs-lookup"><span data-stu-id="6d3e8-117">Current architecture</span></span>
<span data-ttu-id="6d3e8-118">Service Bus uses multiple messaging stores to store messages that are sent to queues or topics.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-118">Service Bus uses multiple messaging stores to store messages that are sent to queues or topics.</span></span> <span data-ttu-id="6d3e8-119">A non-partitioned queue or topic is assigned to one messaging store.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-119">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="6d3e8-120">If this messaging store is unavailable, all operations on that queue or topic will fail.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-120">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span>

<span data-ttu-id="6d3e8-121">All Service Bus messaging entities (queues, topics, relays) reside in a service namespace, which is affiliated with a datacenter.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-121">All Service Bus messaging entities (queues, topics, relays) reside in a service namespace, which is affiliated with a datacenter.</span></span> <span data-ttu-id="6d3e8-122">Service Bus now supports [*Geo-disaster recovery* and *Geo-replication*](service-bus-geo-dr.md) at the namespace level.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-122">Service Bus now supports [*Geo-disaster recovery* and *Geo-replication*](service-bus-geo-dr.md) at the namespace level.</span></span>

## <a name="protecting-queues-and-topics-against-messaging-store-failures"></a><span data-ttu-id="6d3e8-123">Protecting queues and topics against messaging store failures</span><span class="sxs-lookup"><span data-stu-id="6d3e8-123">Protecting queues and topics against messaging store failures</span></span>
<span data-ttu-id="6d3e8-124">A non-partitioned queue or topic is assigned to one messaging store.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-124">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="6d3e8-125">If this messaging store is unavailable, all operations on that queue or topic will fail.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-125">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="6d3e8-126">A partitioned queue, on the other hand, consists of multiple fragments.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-126">A partitioned queue, on the other hand, consists of multiple fragments.</span></span> <span data-ttu-id="6d3e8-127">Each fragment is stored in a different messaging store.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-127">Each fragment is stored in a different messaging store.</span></span> <span data-ttu-id="6d3e8-128">When a message is sent to a partitioned queue or topic, Service Bus assigns the message to one of the fragments.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-128">When a message is sent to a partitioned queue or topic, Service Bus assigns the message to one of the fragments.</span></span> <span data-ttu-id="6d3e8-129">If the corresponding messaging store is unavailable, Service Bus writes the message to a different fragment, if possible.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-129">If the corresponding messaging store is unavailable, Service Bus writes the message to a different fragment, if possible.</span></span> <span data-ttu-id="6d3e8-130">Partitioned entities are no longer supported in the [Premium SKU](service-bus-premium-messaging.md).</span><span class="sxs-lookup"><span data-stu-id="6d3e8-130">Partitioned entities are no longer supported in the [Premium SKU](service-bus-premium-messaging.md).</span></span> 

<span data-ttu-id="6d3e8-131">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="6d3e8-131">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

## <a name="protecting-against-datacenter-outages-or-disasters"></a><span data-ttu-id="6d3e8-132">Protecting against datacenter outages or disasters</span><span class="sxs-lookup"><span data-stu-id="6d3e8-132">Protecting against datacenter outages or disasters</span></span>
<span data-ttu-id="6d3e8-133">To allow for a failover between two datacenters, you can create a Service Bus service namespace in each datacenter.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-133">To allow for a failover between two datacenters, you can create a Service Bus service namespace in each datacenter.</span></span> <span data-ttu-id="6d3e8-134">For example, the Service Bus service namespace **contosoPrimary.servicebus.windows.net** might be located in the United States North/Central region, and **contosoSecondary.servicebus.windows.net** might be located in the US South/Central region.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-134">For example, the Service Bus service namespace **contosoPrimary.servicebus.windows.net** might be located in the United States North/Central region, and **contosoSecondary.servicebus.windows.net** might be located in the US South/Central region.</span></span> <span data-ttu-id="6d3e8-135">If a Service Bus messaging entity must remain accessible in the presence of a datacenter outage, you can create that entity in both namespaces.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-135">If a Service Bus messaging entity must remain accessible in the presence of a datacenter outage, you can create that entity in both namespaces.</span></span>

<span data-ttu-id="6d3e8-136">For more information, see the "Failure of Service Bus within an Azure datacenter" section in [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability].</span><span class="sxs-lookup"><span data-stu-id="6d3e8-136">For more information, see the "Failure of Service Bus within an Azure datacenter" section in [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability].</span></span>

## <a name="protecting-relay-endpoints-against-datacenter-outages-or-disasters"></a><span data-ttu-id="6d3e8-137">Protecting relay endpoints against datacenter outages or disasters</span><span class="sxs-lookup"><span data-stu-id="6d3e8-137">Protecting relay endpoints against datacenter outages or disasters</span></span>
<span data-ttu-id="6d3e8-138">Geo-replication of relay endpoints allows a service that exposes a relay endpoint to be reachable in the presence of Service Bus outages.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-138">Geo-replication of relay endpoints allows a service that exposes a relay endpoint to be reachable in the presence of Service Bus outages.</span></span> <span data-ttu-id="6d3e8-139">To achieve geo-replication, the service must create two relay endpoints in different namespaces.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-139">To achieve geo-replication, the service must create two relay endpoints in different namespaces.</span></span> <span data-ttu-id="6d3e8-140">The namespaces must reside in different datacenters and the two endpoints must have different names.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-140">The namespaces must reside in different datacenters and the two endpoints must have different names.</span></span> <span data-ttu-id="6d3e8-141">For example, a primary endpoint can be reached under **contosoPrimary.servicebus.windows.net/myPrimaryService**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-141">For example, a primary endpoint can be reached under **contosoPrimary.servicebus.windows.net/myPrimaryService**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span></span>

<span data-ttu-id="6d3e8-142">The service then listens on both endpoints, and a client can invoke the service via either endpoint.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-142">The service then listens on both endpoints, and a client can invoke the service via either endpoint.</span></span> <span data-ttu-id="6d3e8-143">A client application randomly picks one of the relays as the primary endpoint, and sends its request to the active endpoint.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-143">A client application randomly picks one of the relays as the primary endpoint, and sends its request to the active endpoint.</span></span> <span data-ttu-id="6d3e8-144">If the operation fails with an error code, this failure indicates that the relay endpoint is not available.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-144">If the operation fails with an error code, this failure indicates that the relay endpoint is not available.</span></span> <span data-ttu-id="6d3e8-145">The application opens a channel to the backup endpoint and reissues the request.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-145">The application opens a channel to the backup endpoint and reissues the request.</span></span> <span data-ttu-id="6d3e8-146">At that point the active and the backup endpoints switch roles: the client application considers the old active endpoint to be the new backup endpoint, and the old backup endpoint to be the new active endpoint.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-146">At that point the active and the backup endpoints switch roles: the client application considers the old active endpoint to be the new backup endpoint, and the old backup endpoint to be the new active endpoint.</span></span> <span data-ttu-id="6d3e8-147">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-147">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

## <a name="protecting-queues-and-topics-against-datacenter-outages-or-disasters"></a><span data-ttu-id="6d3e8-148">Protecting queues and topics against datacenter outages or disasters</span><span class="sxs-lookup"><span data-stu-id="6d3e8-148">Protecting queues and topics against datacenter outages or disasters</span></span>
<span data-ttu-id="6d3e8-149">To achieve resilience against datacenter outages when using brokered messaging, Service Bus supports two approaches: *active* and *passive* replication.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-149">To achieve resilience against datacenter outages when using brokered messaging, Service Bus supports two approaches: *active* and *passive* replication.</span></span> <span data-ttu-id="6d3e8-150">For each approach, if a given queue or topic must remain accessible in the presence of a datacenter outage, you can create it in both namespaces.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-150">For each approach, if a given queue or topic must remain accessible in the presence of a datacenter outage, you can create it in both namespaces.</span></span> <span data-ttu-id="6d3e8-151">Both entities can have the same name.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-151">Both entities can have the same name.</span></span> <span data-ttu-id="6d3e8-152">For example, a primary queue can be reached under **contosoPrimary.servicebus.windows.net/myQueue**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/myQueue**.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-152">For example, a primary queue can be reached under **contosoPrimary.servicebus.windows.net/myQueue**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/myQueue**.</span></span>

<span data-ttu-id="6d3e8-153">If the application does not require permanent sender-to-receiver communication, the application can implement a durable client-side queue to prevent message loss and to shield the sender from any transient Service Bus errors.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-153">If the application does not require permanent sender-to-receiver communication, the application can implement a durable client-side queue to prevent message loss and to shield the sender from any transient Service Bus errors.</span></span>

## <a name="active-replication"></a><span data-ttu-id="6d3e8-154">Active replication</span><span class="sxs-lookup"><span data-stu-id="6d3e8-154">Active replication</span></span>
<span data-ttu-id="6d3e8-155">Active replication uses entities in both namespaces for every operation.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-155">Active replication uses entities in both namespaces for every operation.</span></span> <span data-ttu-id="6d3e8-156">Any client that sends a message sends two copies of the same message.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-156">Any client that sends a message sends two copies of the same message.</span></span> <span data-ttu-id="6d3e8-157">The first copy is sent to the primary entity (for example, **contosoPrimary.servicebus.windows.net/sales**), and the second copy of the message is sent to the secondary entity (for example, **contosoSecondary.servicebus.windows.net/sales**).</span><span class="sxs-lookup"><span data-stu-id="6d3e8-157">The first copy is sent to the primary entity (for example, **contosoPrimary.servicebus.windows.net/sales**), and the second copy of the message is sent to the secondary entity (for example, **contosoSecondary.servicebus.windows.net/sales**).</span></span>

<span data-ttu-id="6d3e8-158">A client receives messages from both queues.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-158">A client receives messages from both queues.</span></span> <span data-ttu-id="6d3e8-159">The receiver processes the first copy of a message, and the second copy is suppressed.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-159">The receiver processes the first copy of a message, and the second copy is suppressed.</span></span> <span data-ttu-id="6d3e8-160">To suppress duplicate messages, the sender must tag each message with a unique identifier.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-160">To suppress duplicate messages, the sender must tag each message with a unique identifier.</span></span> <span data-ttu-id="6d3e8-161">Both copies of the message must be tagged with the same identifier.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-161">Both copies of the message must be tagged with the same identifier.</span></span> <span data-ttu-id="6d3e8-162">You can use the [BrokeredMessage.MessageId][BrokeredMessage.MessageId] or [BrokeredMessage.Label][BrokeredMessage.Label] properties, or a custom property to tag the message.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-162">You can use the [BrokeredMessage.MessageId][BrokeredMessage.MessageId] or [BrokeredMessage.Label][BrokeredMessage.Label] properties, or a custom property to tag the message.</span></span> <span data-ttu-id="6d3e8-163">The receiver must maintain a list of messages that it has already received.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-163">The receiver must maintain a list of messages that it has already received.</span></span>

<span data-ttu-id="6d3e8-164">The [Geo-replication with Service Bus Brokered Messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates active replication of messaging entities.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-164">The [Geo-replication with Service Bus Brokered Messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates active replication of messaging entities.</span></span>

> [!NOTE]
> <span data-ttu-id="6d3e8-165">The active replication approach doubles the number of operations, therefore this approach can lead to higher cost.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-165">The active replication approach doubles the number of operations, therefore this approach can lead to higher cost.</span></span>
> 
> 

## <a name="passive-replication"></a><span data-ttu-id="6d3e8-166">Passive replication</span><span class="sxs-lookup"><span data-stu-id="6d3e8-166">Passive replication</span></span>
<span data-ttu-id="6d3e8-167">In the fault-free case, passive replication uses only one of the two messaging entities.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-167">In the fault-free case, passive replication uses only one of the two messaging entities.</span></span> <span data-ttu-id="6d3e8-168">A client sends the message to the active entity.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-168">A client sends the message to the active entity.</span></span> <span data-ttu-id="6d3e8-169">If the operation on the active entity fails with an error code that indicates the datacenter that hosts the active entity might be unavailable, the client sends a copy of the message to the backup entity.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-169">If the operation on the active entity fails with an error code that indicates the datacenter that hosts the active entity might be unavailable, the client sends a copy of the message to the backup entity.</span></span> <span data-ttu-id="6d3e8-170">At that point the active and the backup entities switch roles: the sending client considers the old active entity to be the new backup entity, and the old backup entity is the new active entity.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-170">At that point the active and the backup entities switch roles: the sending client considers the old active entity to be the new backup entity, and the old backup entity is the new active entity.</span></span> <span data-ttu-id="6d3e8-171">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-171">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="6d3e8-172">A client receives messages from both queues.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-172">A client receives messages from both queues.</span></span> <span data-ttu-id="6d3e8-173">Because there is a chance that the receiver receives two copies of the same message, the receiver must suppress duplicate messages.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-173">Because there is a chance that the receiver receives two copies of the same message, the receiver must suppress duplicate messages.</span></span> <span data-ttu-id="6d3e8-174">You can suppress duplicates in the same way as described for active replication.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-174">You can suppress duplicates in the same way as described for active replication.</span></span>

<span data-ttu-id="6d3e8-175">In general, passive replication is more economical than active replication because in most cases only one operation is performed.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-175">In general, passive replication is more economical than active replication because in most cases only one operation is performed.</span></span> <span data-ttu-id="6d3e8-176">Latency, throughput, and monetary cost are identical to the non-replicated scenario.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-176">Latency, throughput, and monetary cost are identical to the non-replicated scenario.</span></span>

<span data-ttu-id="6d3e8-177">When using passive replication, in the following scenarios messages can be lost or received twice:</span><span class="sxs-lookup"><span data-stu-id="6d3e8-177">When using passive replication, in the following scenarios messages can be lost or received twice:</span></span>

* <span data-ttu-id="6d3e8-178">**Message delay or loss**: Assume that the sender successfully sent a message m1 to the primary queue, and then the queue becomes unavailable before the receiver receives m1.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-178">**Message delay or loss**: Assume that the sender successfully sent a message m1 to the primary queue, and then the queue becomes unavailable before the receiver receives m1.</span></span> <span data-ttu-id="6d3e8-179">The sender sends a subsequent message m2 to the secondary queue.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-179">The sender sends a subsequent message m2 to the secondary queue.</span></span> <span data-ttu-id="6d3e8-180">If the primary queue is temporarily unavailable, the receiver receives m1 after the queue becomes available again.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-180">If the primary queue is temporarily unavailable, the receiver receives m1 after the queue becomes available again.</span></span> <span data-ttu-id="6d3e8-181">In case of a disaster, the receiver may never receive m1.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-181">In case of a disaster, the receiver may never receive m1.</span></span>
* <span data-ttu-id="6d3e8-182">**Duplicate reception**: Assume that the sender sends a message m to the primary queue.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-182">**Duplicate reception**: Assume that the sender sends a message m to the primary queue.</span></span> <span data-ttu-id="6d3e8-183">Service Bus successfully processes m but fails to send a response.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-183">Service Bus successfully processes m but fails to send a response.</span></span> <span data-ttu-id="6d3e8-184">After the send operation times out, the sender sends an identical copy of m to the secondary queue.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-184">After the send operation times out, the sender sends an identical copy of m to the secondary queue.</span></span> <span data-ttu-id="6d3e8-185">If the receiver is able to receive the first copy of m before the primary queue becomes unavailable, the receiver receives both copies of m at approximately the same time.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-185">If the receiver is able to receive the first copy of m before the primary queue becomes unavailable, the receiver receives both copies of m at approximately the same time.</span></span> <span data-ttu-id="6d3e8-186">If the receiver is not able to receive the first copy of m before the primary queue becomes unavailable, the receiver initially receives only the second copy of m, but then receives a second copy of m when the primary queue becomes available.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-186">If the receiver is not able to receive the first copy of m before the primary queue becomes unavailable, the receiver initially receives only the second copy of m, but then receives a second copy of m when the primary queue becomes available.</span></span>

<span data-ttu-id="6d3e8-187">The [Geo-replication with Service Bus brokered messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates passive replication of messaging entities.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-187">The [Geo-replication with Service Bus brokered messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates passive replication of messaging entities.</span></span>

## <a name="geo-replication"></a><span data-ttu-id="6d3e8-188">Geo-replication</span><span class="sxs-lookup"><span data-stu-id="6d3e8-188">Geo-replication</span></span>

<span data-ttu-id="6d3e8-189">Service Bus supports Geo-disaster recovery and Geo-replication, at the namespace level.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-189">Service Bus supports Geo-disaster recovery and Geo-replication, at the namespace level.</span></span> <span data-ttu-id="6d3e8-190">For more information, see [Azure Service Bus Geo-disaster recovery](service-bus-geo-dr.md).</span><span class="sxs-lookup"><span data-stu-id="6d3e8-190">For more information, see [Azure Service Bus Geo-disaster recovery](service-bus-geo-dr.md).</span></span> <span data-ttu-id="6d3e8-191">The disaster recovery feature, available for the [Premium SKU](service-bus-premium-messaging.md) only, implements metadata disaster recovery, and relies on primary and secondary disaster recovery namespaces.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-191">The disaster recovery feature, available for the [Premium SKU](service-bus-premium-messaging.md) only, implements metadata disaster recovery, and relies on primary and secondary disaster recovery namespaces.</span></span>

## <a name="availability-zones-preview"></a><span data-ttu-id="6d3e8-192">Availability Zones (preview)</span><span class="sxs-lookup"><span data-stu-id="6d3e8-192">Availability Zones (preview)</span></span>

<span data-ttu-id="6d3e8-193">The Service Bus Premium SKU supports [Availability Zones](../availability-zones/az-overview.md), providing fault-isolated locations within an Azure region.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-193">The Service Bus Premium SKU supports [Availability Zones](../availability-zones/az-overview.md), providing fault-isolated locations within an Azure region.</span></span> 

> [!NOTE]
> <span data-ttu-id="6d3e8-194">The Availability Zones preview is supported only in the **Central US**, **East US 2**, and **France Central** regions.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-194">The Availability Zones preview is supported only in the **Central US**, **East US 2**, and **France Central** regions.</span></span>

<span data-ttu-id="6d3e8-195">You can enable Availability Zones on new namespaces only, using the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-195">You can enable Availability Zones on new namespaces only, using the Azure portal.</span></span> <span data-ttu-id="6d3e8-196">Service Bus does not support migration of existing namespaces.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-196">Service Bus does not support migration of existing namespaces.</span></span> <span data-ttu-id="6d3e8-197">You cannot disable zone redundancy after enabling it on your namespace.</span><span class="sxs-lookup"><span data-stu-id="6d3e8-197">You cannot disable zone redundancy after enabling it on your namespace.</span></span>

![1][]

## <a name="next-steps"></a><span data-ttu-id="6d3e8-199">Next steps</span><span class="sxs-lookup"><span data-stu-id="6d3e8-199">Next steps</span></span>
<span data-ttu-id="6d3e8-200">To learn more about disaster recovery, see these articles:</span><span class="sxs-lookup"><span data-stu-id="6d3e8-200">To learn more about disaster recovery, see these articles:</span></span>

* [<span data-ttu-id="6d3e8-201">Azure Service Bus Geo-disaster recovery</span><span class="sxs-lookup"><span data-stu-id="6d3e8-201">Azure Service Bus Geo-disaster recovery</span></span>](service-bus-geo-dr.md)
* <span data-ttu-id="6d3e8-202">[Azure SQL Database Business Continuity][Azure SQL Database Business Continuity]</span><span class="sxs-lookup"><span data-stu-id="6d3e8-202">[Azure SQL Database Business Continuity][Azure SQL Database Business Continuity]</span></span>
* <span data-ttu-id="6d3e8-203">[Designing resilient applications for Azure][Azure resiliency technical guidance]</span><span class="sxs-lookup"><span data-stu-id="6d3e8-203">[Designing resilient applications for Azure][Azure resiliency technical guidance]</span></span>

[Service Bus Authentication]: service-bus-authentication-and-authorization.md
[Partitioned messaging entities]: service-bus-partitioning.md
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md#failure-of-service-bus-within-an-azure-datacenter
[BrokeredMessage.MessageId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId
[BrokeredMessage.Label]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label
[Geo-replication with Service Bus Brokered Messages]: https://github.com/Azure/azure-service-bus/tree/master/samples/DotNet/Microsoft.ServiceBus.Messaging/GeoReplication
[Azure SQL Database Business Continuity]: ../sql-database/sql-database-business-continuity.md
[Azure resiliency technical guidance]: /azure/architecture/resiliency

[1]: ./media/service-bus-outages-disasters/az.png