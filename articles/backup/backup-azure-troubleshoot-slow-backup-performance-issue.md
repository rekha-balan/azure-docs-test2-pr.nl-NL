---
title: Troubleshoot slow backup of files and folders in Azure Backup| Microsoft Docs
description: Provides troubleshooting guidance to help you diagnose the cause of Azure Backup performance issues
services: backup
documentationcenter: ''
author: genlin
manager: cshepard
editor: ''
ms.assetid: e379180a-db13-4e0c-90e4-28e5dd6f5b14
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/07/2017
ms.author: genli
ms.openlocfilehash: c6ca47fc7d4315697e94c96d245a8761fba9c771
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44555209"
---
# <a name="troubleshoot-slow-backup-of-files-and-folders-in-azure-backup"></a><span data-ttu-id="febf3-103">Troubleshoot slow backup of files and folders in Azure Backup</span><span class="sxs-lookup"><span data-stu-id="febf3-103">Troubleshoot slow backup of files and folders in Azure Backup</span></span>
<span data-ttu-id="febf3-104">This article provides troubleshooting guidance to help you diagnose the cause of slow backup performance for files and folders when you're using Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="febf3-104">This article provides troubleshooting guidance to help you diagnose the cause of slow backup performance for files and folders when you're using Azure Backup.</span></span> <span data-ttu-id="febf3-105">When you use the Azure Backup agent to back up files, the backup process might take longer than expected.</span><span class="sxs-lookup"><span data-stu-id="febf3-105">When you use the Azure Backup agent to back up files, the backup process might take longer than expected.</span></span> <span data-ttu-id="febf3-106">This delay might be caused by one or more of the following:</span><span class="sxs-lookup"><span data-stu-id="febf3-106">This delay might be caused by one or more of the following:</span></span>

* [<span data-ttu-id="febf3-107">There are performance bottlenecks on the computer that’s being backed up.</span><span class="sxs-lookup"><span data-stu-id="febf3-107">There are performance bottlenecks on the computer that’s being backed up.</span></span>](#cause1)
* [<span data-ttu-id="febf3-108">Another process or antivirus software is interfering with the Azure Backup process.</span><span class="sxs-lookup"><span data-stu-id="febf3-108">Another process or antivirus software is interfering with the Azure Backup process.</span></span>](#cause2)
* [<span data-ttu-id="febf3-109">The Backup agent is running on an Azure virtual machine (VM).</span><span class="sxs-lookup"><span data-stu-id="febf3-109">The Backup agent is running on an Azure virtual machine (VM).</span></span>](#cause3)  
* [<span data-ttu-id="febf3-110">You're backing up a large number (millions) of files.</span><span class="sxs-lookup"><span data-stu-id="febf3-110">You're backing up a large number (millions) of files.</span></span>](#cause4)

<span data-ttu-id="febf3-111">Before you start troubleshooting issues, we recommend that you download and install the [latest Azure Backup agent](http://aka.ms/azurebackup_agent).</span><span class="sxs-lookup"><span data-stu-id="febf3-111">Before you start troubleshooting issues, we recommend that you download and install the [latest Azure Backup agent](http://aka.ms/azurebackup_agent).</span></span> <span data-ttu-id="febf3-112">We make frequent updates to the Backup agent to fix various issues, add features, and improve performance.</span><span class="sxs-lookup"><span data-stu-id="febf3-112">We make frequent updates to the Backup agent to fix various issues, add features, and improve performance.</span></span>

<span data-ttu-id="febf3-113">We also strongly recommend that you review the [Azure Backup service FAQ](backup-azure-backup-faq.md) to make sure you're not experiencing any of the common configuration issues.</span><span class="sxs-lookup"><span data-stu-id="febf3-113">We also strongly recommend that you review the [Azure Backup service FAQ](backup-azure-backup-faq.md) to make sure you're not experiencing any of the common configuration issues.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

<a id="cause1"></a>

## <a name="cause-performance-bottlenecks-on-the-computer"></a><span data-ttu-id="febf3-114">Cause: Performance bottlenecks on the computer</span><span class="sxs-lookup"><span data-stu-id="febf3-114">Cause: Performance bottlenecks on the computer</span></span>
<span data-ttu-id="febf3-115">Bottlenecks on the computer that's being backed up can cause delays.</span><span class="sxs-lookup"><span data-stu-id="febf3-115">Bottlenecks on the computer that's being backed up can cause delays.</span></span> <span data-ttu-id="febf3-116">For example, the computer's ability to read or write to disk, or available bandwidth to send data over the network, can cause bottlenecks.</span><span class="sxs-lookup"><span data-stu-id="febf3-116">For example, the computer's ability to read or write to disk, or available bandwidth to send data over the network, can cause bottlenecks.</span></span>

<span data-ttu-id="febf3-117">Windows provides a built-in tool that's called [Performance Monitor](https://technet.microsoft.com/magazine/2008.08.pulse.aspx) (Perfmon) to detect these bottlenecks.</span><span class="sxs-lookup"><span data-stu-id="febf3-117">Windows provides a built-in tool that's called [Performance Monitor](https://technet.microsoft.com/magazine/2008.08.pulse.aspx) (Perfmon) to detect these bottlenecks.</span></span>

<span data-ttu-id="febf3-118">Here are some performance counters and ranges that can be helpful in diagnosing bottlenecks for optimal backups.</span><span class="sxs-lookup"><span data-stu-id="febf3-118">Here are some performance counters and ranges that can be helpful in diagnosing bottlenecks for optimal backups.</span></span>

| <span data-ttu-id="febf3-119">Counter</span><span class="sxs-lookup"><span data-stu-id="febf3-119">Counter</span></span> | <span data-ttu-id="febf3-120">Status</span><span class="sxs-lookup"><span data-stu-id="febf3-120">Status</span></span> |
| --- | --- |
| <span data-ttu-id="febf3-121">Logical Disk(Physical Disk)--%idle</span><span class="sxs-lookup"><span data-stu-id="febf3-121">Logical Disk(Physical Disk)--%idle</span></span> |<span data-ttu-id="febf3-122">• 100% idle to 50% idle = Healthy</span><span class="sxs-lookup"><span data-stu-id="febf3-122">• 100% idle to 50% idle = Healthy</span></span></br><span data-ttu-id="febf3-123">• 49% idle to 20% idle = Warning or Monitor</span><span class="sxs-lookup"><span data-stu-id="febf3-123">• 49% idle to 20% idle = Warning or Monitor</span></span></br><span data-ttu-id="febf3-124">• 19% idle to 0% idle = Critical or Out of Spec</span><span class="sxs-lookup"><span data-stu-id="febf3-124">• 19% idle to 0% idle = Critical or Out of Spec</span></span> |
| <span data-ttu-id="febf3-125">Logical Disk(Physical Disk)--%Avg. Disk Sec Read or Write</span><span class="sxs-lookup"><span data-stu-id="febf3-125">Logical Disk(Physical Disk)--%Avg. Disk Sec Read or Write</span></span> |<span data-ttu-id="febf3-126">• 0.001 ms to 0.015 ms  = Healthy</span><span class="sxs-lookup"><span data-stu-id="febf3-126">• 0.001 ms to 0.015 ms  = Healthy</span></span></br><span data-ttu-id="febf3-127">• 0.015 ms to 0.025 ms = Warning or Monitor</span><span class="sxs-lookup"><span data-stu-id="febf3-127">• 0.015 ms to 0.025 ms = Warning or Monitor</span></span></br><span data-ttu-id="febf3-128">• 0.026 ms or longer = Critical or Out of Spec</span><span class="sxs-lookup"><span data-stu-id="febf3-128">• 0.026 ms or longer = Critical or Out of Spec</span></span> |
| <span data-ttu-id="febf3-129">Logical Disk(Physical Disk)--Current Disk Queue Length (for all instances)</span><span class="sxs-lookup"><span data-stu-id="febf3-129">Logical Disk(Physical Disk)--Current Disk Queue Length (for all instances)</span></span> |<span data-ttu-id="febf3-130">80 requests for more than 6 minutes</span><span class="sxs-lookup"><span data-stu-id="febf3-130">80 requests for more than 6 minutes</span></span> |
| <span data-ttu-id="febf3-131">Memory--Pool Non Paged Bytes</span><span class="sxs-lookup"><span data-stu-id="febf3-131">Memory--Pool Non Paged Bytes</span></span> |<span data-ttu-id="febf3-132">• Less than 60% of pool consumed = Healthy</span><span class="sxs-lookup"><span data-stu-id="febf3-132">• Less than 60% of pool consumed = Healthy</span></span><br><span data-ttu-id="febf3-133">• 61% to 80% of pool consumed = Warning or Monitor</span><span class="sxs-lookup"><span data-stu-id="febf3-133">• 61% to 80% of pool consumed = Warning or Monitor</span></span></br><span data-ttu-id="febf3-134">• Greater than 80% pool consumed = Critical or Out of Spec</span><span class="sxs-lookup"><span data-stu-id="febf3-134">• Greater than 80% pool consumed = Critical or Out of Spec</span></span> |
| <span data-ttu-id="febf3-135">Memory--Pool Paged Bytes</span><span class="sxs-lookup"><span data-stu-id="febf3-135">Memory--Pool Paged Bytes</span></span> |<span data-ttu-id="febf3-136">• Less than 60% of pool consumed = Healthy</span><span class="sxs-lookup"><span data-stu-id="febf3-136">• Less than 60% of pool consumed = Healthy</span></span></br><span data-ttu-id="febf3-137">• 61% to 80% of pool consumed = Warning or Monitor</span><span class="sxs-lookup"><span data-stu-id="febf3-137">• 61% to 80% of pool consumed = Warning or Monitor</span></span></br><span data-ttu-id="febf3-138">• Greater than 80% pool consumed = Critical or Out of Spec</span><span class="sxs-lookup"><span data-stu-id="febf3-138">• Greater than 80% pool consumed = Critical or Out of Spec</span></span> |
| <span data-ttu-id="febf3-139">Memory--Available Megabytes</span><span class="sxs-lookup"><span data-stu-id="febf3-139">Memory--Available Megabytes</span></span> |<span data-ttu-id="febf3-140">• 50% of free memory available or more = Healthy</span><span class="sxs-lookup"><span data-stu-id="febf3-140">• 50% of free memory available or more = Healthy</span></span></br><span data-ttu-id="febf3-141">• 25% of free memory available = Monitor</span><span class="sxs-lookup"><span data-stu-id="febf3-141">• 25% of free memory available = Monitor</span></span></br><span data-ttu-id="febf3-142">• 10% of free memory available = Warning</span><span class="sxs-lookup"><span data-stu-id="febf3-142">• 10% of free memory available = Warning</span></span></br><span data-ttu-id="febf3-143">• Less than 100 MB or 5% of free memory available = Critical or Out of Spec</span><span class="sxs-lookup"><span data-stu-id="febf3-143">• Less than 100 MB or 5% of free memory available = Critical or Out of Spec</span></span> |
| <span data-ttu-id="febf3-144">Processor--\%Processor Time (all instances)</span><span class="sxs-lookup"><span data-stu-id="febf3-144">Processor--\%Processor Time (all instances)</span></span> |<span data-ttu-id="febf3-145">• Less than 60% consumed = Healthy</span><span class="sxs-lookup"><span data-stu-id="febf3-145">• Less than 60% consumed = Healthy</span></span></br><span data-ttu-id="febf3-146">• 61% to 90% consumed = Monitor or Caution</span><span class="sxs-lookup"><span data-stu-id="febf3-146">• 61% to 90% consumed = Monitor or Caution</span></span></br><span data-ttu-id="febf3-147">• 91% to 100% consumed = Critical</span><span class="sxs-lookup"><span data-stu-id="febf3-147">• 91% to 100% consumed = Critical</span></span> |

> [!NOTE]
> <span data-ttu-id="febf3-148">If you determine that the infrastructure is the culprit, we recommend that you defragment the disks regularly for better performance.</span><span class="sxs-lookup"><span data-stu-id="febf3-148">If you determine that the infrastructure is the culprit, we recommend that you defragment the disks regularly for better performance.</span></span>
>
>

<a id="cause2"></a>

## <a name="cause-another-process-or-antivirus-software-interfering-with-azure-backup"></a><span data-ttu-id="febf3-149">Cause: Another process or antivirus software interfering with Azure Backup</span><span class="sxs-lookup"><span data-stu-id="febf3-149">Cause: Another process or antivirus software interfering with Azure Backup</span></span>
<span data-ttu-id="febf3-150">We've seen several instances where other processes in the Windows system have negatively affected performance of the Azure Backup agent process.</span><span class="sxs-lookup"><span data-stu-id="febf3-150">We've seen several instances where other processes in the Windows system have negatively affected performance of the Azure Backup agent process.</span></span> <span data-ttu-id="febf3-151">For example, if you use both the Azure Backup agent and another program to back up data, or if antivirus software is running and has a lock on files to be backed up, the multiple locks on files might cause contention.</span><span class="sxs-lookup"><span data-stu-id="febf3-151">For example, if you use both the Azure Backup agent and another program to back up data, or if antivirus software is running and has a lock on files to be backed up, the multiple locks on files might cause contention.</span></span> <span data-ttu-id="febf3-152">In this situation, the backup might fail, or the job might take longer than expected.</span><span class="sxs-lookup"><span data-stu-id="febf3-152">In this situation, the backup might fail, or the job might take longer than expected.</span></span>

<span data-ttu-id="febf3-153">The best recommendation in this scenario is to turn off the other backup program to see whether the backup time for the Azure Backup agent changes.</span><span class="sxs-lookup"><span data-stu-id="febf3-153">The best recommendation in this scenario is to turn off the other backup program to see whether the backup time for the Azure Backup agent changes.</span></span> <span data-ttu-id="febf3-154">Usually, making sure that multiple backup jobs are not running at the same time is sufficient to prevent them from affecting each other.</span><span class="sxs-lookup"><span data-stu-id="febf3-154">Usually, making sure that multiple backup jobs are not running at the same time is sufficient to prevent them from affecting each other.</span></span>

<span data-ttu-id="febf3-155">For antivirus programs, we recommend that you exclude the following files and locations:</span><span class="sxs-lookup"><span data-stu-id="febf3-155">For antivirus programs, we recommend that you exclude the following files and locations:</span></span>

* <span data-ttu-id="febf3-156">C:\Program Files\Microsoft Azure Recovery Services Agent\bin\cbengine.exe as a process</span><span class="sxs-lookup"><span data-stu-id="febf3-156">C:\Program Files\Microsoft Azure Recovery Services Agent\bin\cbengine.exe as a process</span></span>
* <span data-ttu-id="febf3-157">C:\Program Files\Microsoft Azure Recovery Services Agent\ folders</span><span class="sxs-lookup"><span data-stu-id="febf3-157">C:\Program Files\Microsoft Azure Recovery Services Agent\ folders</span></span>
* <span data-ttu-id="febf3-158">Scratch location (if you're not using the standard location)</span><span class="sxs-lookup"><span data-stu-id="febf3-158">Scratch location (if you're not using the standard location)</span></span>

<a id="cause3"></a>

## <a name="cause-backup-agent-running-on-an-azure-virtual-machine"></a><span data-ttu-id="febf3-159">Cause: Backup agent running on an Azure virtual machine</span><span class="sxs-lookup"><span data-stu-id="febf3-159">Cause: Backup agent running on an Azure virtual machine</span></span>
<span data-ttu-id="febf3-160">If you're running the Backup agent on a VM, performance will be slower than when you run it on a physical machine.</span><span class="sxs-lookup"><span data-stu-id="febf3-160">If you're running the Backup agent on a VM, performance will be slower than when you run it on a physical machine.</span></span> <span data-ttu-id="febf3-161">This is expected due to IOPS limitations.</span><span class="sxs-lookup"><span data-stu-id="febf3-161">This is expected due to IOPS limitations.</span></span>  <span data-ttu-id="febf3-162">However, you can optimize the performance by switching the data drives that are being backed up to Azure Premium Storage.</span><span class="sxs-lookup"><span data-stu-id="febf3-162">However, you can optimize the performance by switching the data drives that are being backed up to Azure Premium Storage.</span></span> <span data-ttu-id="febf3-163">We're working on fixing this issue, and the fix will be available in a future release.</span><span class="sxs-lookup"><span data-stu-id="febf3-163">We're working on fixing this issue, and the fix will be available in a future release.</span></span>

<a id="cause4"></a>

## <a name="cause-backing-up-a-large-number-millions-of-files"></a><span data-ttu-id="febf3-164">Cause: Backing up a large number (millions) of files</span><span class="sxs-lookup"><span data-stu-id="febf3-164">Cause: Backing up a large number (millions) of files</span></span>
<span data-ttu-id="febf3-165">Moving a large volume of data will take longer than moving a smaller volume of data.</span><span class="sxs-lookup"><span data-stu-id="febf3-165">Moving a large volume of data will take longer than moving a smaller volume of data.</span></span> <span data-ttu-id="febf3-166">In some cases, backup time is related to not only the size of the data, but also the number of files or folders.</span><span class="sxs-lookup"><span data-stu-id="febf3-166">In some cases, backup time is related to not only the size of the data, but also the number of files or folders.</span></span> <span data-ttu-id="febf3-167">This is especially true when millions of small files (a few bytes to a few kilobytes) are being backed up.</span><span class="sxs-lookup"><span data-stu-id="febf3-167">This is especially true when millions of small files (a few bytes to a few kilobytes) are being backed up.</span></span>

<span data-ttu-id="febf3-168">This behavior occurs because while you're backing up the data and moving it to Azure, Azure is simultaneously cataloging your files.</span><span class="sxs-lookup"><span data-stu-id="febf3-168">This behavior occurs because while you're backing up the data and moving it to Azure, Azure is simultaneously cataloging your files.</span></span> <span data-ttu-id="febf3-169">In some rare scenarios, the catalog operation might take longer than expected.</span><span class="sxs-lookup"><span data-stu-id="febf3-169">In some rare scenarios, the catalog operation might take longer than expected.</span></span>

<span data-ttu-id="febf3-170">The following indicators can help you understand the bottleneck and accordingly work on the next steps:</span><span class="sxs-lookup"><span data-stu-id="febf3-170">The following indicators can help you understand the bottleneck and accordingly work on the next steps:</span></span>

* <span data-ttu-id="febf3-171">**UI is showing progress for the data transfer**.</span><span class="sxs-lookup"><span data-stu-id="febf3-171">**UI is showing progress for the data transfer**.</span></span> <span data-ttu-id="febf3-172">The data is still being transferred.</span><span class="sxs-lookup"><span data-stu-id="febf3-172">The data is still being transferred.</span></span> <span data-ttu-id="febf3-173">The network bandwidth or the size of data might be causing delays.</span><span class="sxs-lookup"><span data-stu-id="febf3-173">The network bandwidth or the size of data might be causing delays.</span></span>
* <span data-ttu-id="febf3-174">**UI is not showing progress for the data transfer**.</span><span class="sxs-lookup"><span data-stu-id="febf3-174">**UI is not showing progress for the data transfer**.</span></span> <span data-ttu-id="febf3-175">Open the logs located at C:\Microsoft Azure Recovery Services Agent\Temp, and then check for the FileProvider::EndData entry in the logs.</span><span class="sxs-lookup"><span data-stu-id="febf3-175">Open the logs located at C:\Microsoft Azure Recovery Services Agent\Temp, and then check for the FileProvider::EndData entry in the logs.</span></span> <span data-ttu-id="febf3-176">This entry signifies that the data transfer finished and the catalog operation is happening.</span><span class="sxs-lookup"><span data-stu-id="febf3-176">This entry signifies that the data transfer finished and the catalog operation is happening.</span></span> <span data-ttu-id="febf3-177">Don't cancel the backup jobs.</span><span class="sxs-lookup"><span data-stu-id="febf3-177">Don't cancel the backup jobs.</span></span> <span data-ttu-id="febf3-178">Instead, wait a little longer for the catalog operation to finish.</span><span class="sxs-lookup"><span data-stu-id="febf3-178">Instead, wait a little longer for the catalog operation to finish.</span></span> <span data-ttu-id="febf3-179">If the problem persists, contact [Azure support](https://portal.azure.com/#create/Microsoft.Support).</span><span class="sxs-lookup"><span data-stu-id="febf3-179">If the problem persists, contact [Azure support](https://portal.azure.com/#create/Microsoft.Support).</span></span>
