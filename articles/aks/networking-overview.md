---
title: Network configuration in Azure Kubernetes Service (AKS)
description: Learn about basic and advanced network configuration in Azure Kubernetes Service (AKS).
services: container-service
author: mmacy
manager: jeconnoc
ms.service: container-service
ms.topic: article
ms.date: 08/31/2018
ms.author: marsma
ms.openlocfilehash: 16349af5932987cc0db4295355a0365c8579fcbf
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44866713"
---
# <a name="network-configuration-in-azure-kubernetes-service-aks"></a><span data-ttu-id="3f1a6-103">Network configuration in Azure Kubernetes Service (AKS)</span><span class="sxs-lookup"><span data-stu-id="3f1a6-103">Network configuration in Azure Kubernetes Service (AKS)</span></span>

<span data-ttu-id="3f1a6-104">When you create an Azure Kubernetes Service (AKS) cluster, you can select from two networking options: **Basic** or **Advanced**.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-104">When you create an Azure Kubernetes Service (AKS) cluster, you can select from two networking options: **Basic** or **Advanced**.</span></span>

## <a name="basic-networking"></a><span data-ttu-id="3f1a6-105">Basic networking</span><span class="sxs-lookup"><span data-stu-id="3f1a6-105">Basic networking</span></span>

<span data-ttu-id="3f1a6-106">The **Basic** networking option is the default configuration for AKS cluster creation.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-106">The **Basic** networking option is the default configuration for AKS cluster creation.</span></span> <span data-ttu-id="3f1a6-107">The network configuration of the cluster and its pods is managed completely by Azure, and is appropriate for deployments that do not require custom VNet configuration.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-107">The network configuration of the cluster and its pods is managed completely by Azure, and is appropriate for deployments that do not require custom VNet configuration.</span></span> <span data-ttu-id="3f1a6-108">You do not have control over network configuration such as subnets or the IP address ranges assigned to the cluster when you select Basic networking.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-108">You do not have control over network configuration such as subnets or the IP address ranges assigned to the cluster when you select Basic networking.</span></span>

<span data-ttu-id="3f1a6-109">Nodes in an AKS cluster configured for Basic networking use the [kubenet][kubenet] Kubernetes plugin.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-109">Nodes in an AKS cluster configured for Basic networking use the [kubenet][kubenet] Kubernetes plugin.</span></span>

## <a name="advanced-networking"></a><span data-ttu-id="3f1a6-110">Advanced networking</span><span class="sxs-lookup"><span data-stu-id="3f1a6-110">Advanced networking</span></span>

<span data-ttu-id="3f1a6-111">**Advanced** networking places your pods in an Azure Virtual Network (VNet) that you configure, providing them automatic connectivity to VNet resources and integration with the rich set of capabilities that VNets offer.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-111">**Advanced** networking places your pods in an Azure Virtual Network (VNet) that you configure, providing them automatic connectivity to VNet resources and integration with the rich set of capabilities that VNets offer.</span></span> <span data-ttu-id="3f1a6-112">Advanced networking is available when deploying AKS clusters with the [Azure portal][portal], Azure CLI, or with a Resource Manager template.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-112">Advanced networking is available when deploying AKS clusters with the [Azure portal][portal], Azure CLI, or with a Resource Manager template.</span></span>

<span data-ttu-id="3f1a6-113">Nodes in an AKS cluster configured for Advanced networking use the [Azure Container Networking Interface (CNI)][cni-networking] Kubernetes plugin.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-113">Nodes in an AKS cluster configured for Advanced networking use the [Azure Container Networking Interface (CNI)][cni-networking] Kubernetes plugin.</span></span>

![Diagram showing two nodes with bridges connecting each to a single Azure VNet][advanced-networking-diagram-01]

## <a name="advanced-networking-features"></a><span data-ttu-id="3f1a6-115">Advanced networking features</span><span class="sxs-lookup"><span data-stu-id="3f1a6-115">Advanced networking features</span></span>

<span data-ttu-id="3f1a6-116">Advanced networking provides the following benefits:</span><span class="sxs-lookup"><span data-stu-id="3f1a6-116">Advanced networking provides the following benefits:</span></span>

* <span data-ttu-id="3f1a6-117">Deploy your AKS cluster into an existing VNet, or create a new VNet and subnet for your cluster.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-117">Deploy your AKS cluster into an existing VNet, or create a new VNet and subnet for your cluster.</span></span>
* <span data-ttu-id="3f1a6-118">Every pod in the cluster is assigned an IP address in the VNet, and can directly communicate with other pods in the cluster, and other nodes in the VNet.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-118">Every pod in the cluster is assigned an IP address in the VNet, and can directly communicate with other pods in the cluster, and other nodes in the VNet.</span></span>
* <span data-ttu-id="3f1a6-119">A pod can connect to other services in a peered VNet, and to on-premises networks over ExpressRoute and site-to-site (S2S) VPN connections.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-119">A pod can connect to other services in a peered VNet, and to on-premises networks over ExpressRoute and site-to-site (S2S) VPN connections.</span></span> <span data-ttu-id="3f1a6-120">Pods are also reachable from on-premises.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-120">Pods are also reachable from on-premises.</span></span>
* <span data-ttu-id="3f1a6-121">Expose a Kubernetes service externally or internally through the Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-121">Expose a Kubernetes service externally or internally through the Azure Load Balancer.</span></span> <span data-ttu-id="3f1a6-122">Also a feature of Basic networking.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-122">Also a feature of Basic networking.</span></span>
* <span data-ttu-id="3f1a6-123">Pods in a subnet that have service endpoints enabled can securely connect to Azure services, for example Azure Storage and SQL DB.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-123">Pods in a subnet that have service endpoints enabled can securely connect to Azure services, for example Azure Storage and SQL DB.</span></span>
* <span data-ttu-id="3f1a6-124">Use user-defined routes (UDR) to route traffic from pods to a Network Virtual Appliance.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-124">Use user-defined routes (UDR) to route traffic from pods to a Network Virtual Appliance.</span></span>
* <span data-ttu-id="3f1a6-125">Pods can access resources on the public Internet.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-125">Pods can access resources on the public Internet.</span></span> <span data-ttu-id="3f1a6-126">Also a feature of Basic networking.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-126">Also a feature of Basic networking.</span></span>

## <a name="advanced-networking-prerequisites"></a><span data-ttu-id="3f1a6-127">Advanced networking prerequisites</span><span class="sxs-lookup"><span data-stu-id="3f1a6-127">Advanced networking prerequisites</span></span>

* <span data-ttu-id="3f1a6-128">The virtual network for the AKS cluster must allow outbound internet connectivity.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-128">The virtual network for the AKS cluster must allow outbound internet connectivity.</span></span>
* <span data-ttu-id="3f1a6-129">Do not create more than one AKS cluster in the same subnet.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-129">Do not create more than one AKS cluster in the same subnet.</span></span>
* <span data-ttu-id="3f1a6-130">AKS clusters may not use `169.254.0.0/16`, `172.30.0.0/16`, or `172.31.0.0/16` for the Kubernetes service address range.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-130">AKS clusters may not use `169.254.0.0/16`, `172.30.0.0/16`, or `172.31.0.0/16` for the Kubernetes service address range.</span></span>
* <span data-ttu-id="3f1a6-131">The service principal used by the AKS cluster must have at least [Network Contributor](../role-based-access-control/built-in-roles.md#network-contributor) permissions on the subnet within your virtual network.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-131">The service principal used by the AKS cluster must have at least [Network Contributor](../role-based-access-control/built-in-roles.md#network-contributor) permissions on the subnet within your virtual network.</span></span> <span data-ttu-id="3f1a6-132">If you wish to define a [custom role](../role-based-access-control/custom-roles.md) instead of using the built-in Network Contributor role, the following permissions are required:</span><span class="sxs-lookup"><span data-stu-id="3f1a6-132">If you wish to define a [custom role](../role-based-access-control/custom-roles.md) instead of using the built-in Network Contributor role, the following permissions are required:</span></span>
  * `Microsoft.Network/virtualNetworks/subnets/join/action`
  * `Microsoft.Network/virtualNetworks/subnets/read`

## <a name="plan-ip-addressing-for-your-cluster"></a><span data-ttu-id="3f1a6-133">Plan IP addressing for your cluster</span><span class="sxs-lookup"><span data-stu-id="3f1a6-133">Plan IP addressing for your cluster</span></span>

<span data-ttu-id="3f1a6-134">Clusters configured with Advanced networking require additional planning.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-134">Clusters configured with Advanced networking require additional planning.</span></span> <span data-ttu-id="3f1a6-135">The size of your virtual network and its subnet must accommodate both the number of pods you plan to run as well as the number of nodes for the cluster.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-135">The size of your virtual network and its subnet must accommodate both the number of pods you plan to run as well as the number of nodes for the cluster.</span></span>

<span data-ttu-id="3f1a6-136">IP addresses for the pods and the cluster's nodes are assigned from the specified subnet within the virtual network.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-136">IP addresses for the pods and the cluster's nodes are assigned from the specified subnet within the virtual network.</span></span> <span data-ttu-id="3f1a6-137">Each node is configured with a primary IP, which is the IP of the node and 30 additional IP addresses pre-configured by Azure CNI that are assigned to pods scheduled to the node.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-137">Each node is configured with a primary IP, which is the IP of the node and 30 additional IP addresses pre-configured by Azure CNI that are assigned to pods scheduled to the node.</span></span> <span data-ttu-id="3f1a6-138">When you scale out your cluster, each node is similarly configured with IP addresses from the subnet.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-138">When you scale out your cluster, each node is similarly configured with IP addresses from the subnet.</span></span>

<span data-ttu-id="3f1a6-139">The IP address plan for an AKS cluster consists of a virtual network, at least one subnet for nodes and pods, and a Kubernetes service address range.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-139">The IP address plan for an AKS cluster consists of a virtual network, at least one subnet for nodes and pods, and a Kubernetes service address range.</span></span>

| <span data-ttu-id="3f1a6-140">Address range / Azure resource</span><span class="sxs-lookup"><span data-stu-id="3f1a6-140">Address range / Azure resource</span></span> | <span data-ttu-id="3f1a6-141">Limits and sizing</span><span class="sxs-lookup"><span data-stu-id="3f1a6-141">Limits and sizing</span></span> |
| --------- | ------------- |
| <span data-ttu-id="3f1a6-142">Virtual network</span><span class="sxs-lookup"><span data-stu-id="3f1a6-142">Virtual network</span></span> | <span data-ttu-id="3f1a6-143">The Azure virtual network can be as large as /8, but is limited to 65,536 configured IP addresses.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-143">The Azure virtual network can be as large as /8, but is limited to 65,536 configured IP addresses.</span></span> |
| <span data-ttu-id="3f1a6-144">Subnet</span><span class="sxs-lookup"><span data-stu-id="3f1a6-144">Subnet</span></span> | <span data-ttu-id="3f1a6-145">Must be large enough to accommodate the nodes, pods, and all Kubernetes and Azure resources that might be provisioned in your cluster.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-145">Must be large enough to accommodate the nodes, pods, and all Kubernetes and Azure resources that might be provisioned in your cluster.</span></span> <span data-ttu-id="3f1a6-146">For example, if you deploy an internal Azure Load Balancer, its front-end IPs are allocated from the cluster subnet, not public IPs.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-146">For example, if you deploy an internal Azure Load Balancer, its front-end IPs are allocated from the cluster subnet, not public IPs.</span></span> <p/><span data-ttu-id="3f1a6-147">To calculate *minimum* subnet size: `(number of nodes) + (number of nodes * pods per node)`</span><span class="sxs-lookup"><span data-stu-id="3f1a6-147">To calculate *minimum* subnet size: `(number of nodes) + (number of nodes * pods per node)`</span></span> <p/><span data-ttu-id="3f1a6-148">Example for a 50 node cluster: `(50) + (50 * 30) = 1,550` (/21 or larger)</span><span class="sxs-lookup"><span data-stu-id="3f1a6-148">Example for a 50 node cluster: `(50) + (50 * 30) = 1,550` (/21 or larger)</span></span> |
| <span data-ttu-id="3f1a6-149">Kubernetes service address range</span><span class="sxs-lookup"><span data-stu-id="3f1a6-149">Kubernetes service address range</span></span> | <span data-ttu-id="3f1a6-150">This range should not be used by any network element on or connected to this virtual network.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-150">This range should not be used by any network element on or connected to this virtual network.</span></span> <span data-ttu-id="3f1a6-151">Service address CIDR must be smaller than /12.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-151">Service address CIDR must be smaller than /12.</span></span> |
| <span data-ttu-id="3f1a6-152">Kubernetes DNS service IP address</span><span class="sxs-lookup"><span data-stu-id="3f1a6-152">Kubernetes DNS service IP address</span></span> | <span data-ttu-id="3f1a6-153">IP address within the Kubernetes service address range that will be used by cluster service discovery (kube-dns).</span><span class="sxs-lookup"><span data-stu-id="3f1a6-153">IP address within the Kubernetes service address range that will be used by cluster service discovery (kube-dns).</span></span> |
| <span data-ttu-id="3f1a6-154">Docker bridge address</span><span class="sxs-lookup"><span data-stu-id="3f1a6-154">Docker bridge address</span></span> | <span data-ttu-id="3f1a6-155">IP address (in CIDR notation) used as the Docker bridge IP address on nodes.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-155">IP address (in CIDR notation) used as the Docker bridge IP address on nodes.</span></span> <span data-ttu-id="3f1a6-156">Default of 172.17.0.1/16.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-156">Default of 172.17.0.1/16.</span></span> |

## <a name="maximum-pods-per-node"></a><span data-ttu-id="3f1a6-157">Maximum pods per node</span><span class="sxs-lookup"><span data-stu-id="3f1a6-157">Maximum pods per node</span></span>

<span data-ttu-id="3f1a6-158">The default maximum number of pods per node in an AKS cluster varies between Basic and Advanced networking, and the method of cluster deployment.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-158">The default maximum number of pods per node in an AKS cluster varies between Basic and Advanced networking, and the method of cluster deployment.</span></span>

### <a name="default-maximum"></a><span data-ttu-id="3f1a6-159">Default maximum</span><span class="sxs-lookup"><span data-stu-id="3f1a6-159">Default maximum</span></span>

<span data-ttu-id="3f1a6-160">These are the *default* maximums when you deploy an AKS cluster without specifying the maximum number of pods at deployment time:</span><span class="sxs-lookup"><span data-stu-id="3f1a6-160">These are the *default* maximums when you deploy an AKS cluster without specifying the maximum number of pods at deployment time:</span></span>

| <span data-ttu-id="3f1a6-161">Deployment method</span><span class="sxs-lookup"><span data-stu-id="3f1a6-161">Deployment method</span></span> | <span data-ttu-id="3f1a6-162">Basic</span><span class="sxs-lookup"><span data-stu-id="3f1a6-162">Basic</span></span> | <span data-ttu-id="3f1a6-163">Advanced</span><span class="sxs-lookup"><span data-stu-id="3f1a6-163">Advanced</span></span> | <span data-ttu-id="3f1a6-164">Configurable at deployment</span><span class="sxs-lookup"><span data-stu-id="3f1a6-164">Configurable at deployment</span></span> |
| -- | :--: | :--: | -- |
| <span data-ttu-id="3f1a6-165">Azure CLI</span><span class="sxs-lookup"><span data-stu-id="3f1a6-165">Azure CLI</span></span> | <span data-ttu-id="3f1a6-166">110</span><span class="sxs-lookup"><span data-stu-id="3f1a6-166">110</span></span> | <span data-ttu-id="3f1a6-167">30</span><span class="sxs-lookup"><span data-stu-id="3f1a6-167">30</span></span> | <span data-ttu-id="3f1a6-168">Yes</span><span class="sxs-lookup"><span data-stu-id="3f1a6-168">Yes</span></span> |
| <span data-ttu-id="3f1a6-169">Resource Manager template</span><span class="sxs-lookup"><span data-stu-id="3f1a6-169">Resource Manager template</span></span> | <span data-ttu-id="3f1a6-170">110</span><span class="sxs-lookup"><span data-stu-id="3f1a6-170">110</span></span> | <span data-ttu-id="3f1a6-171">30</span><span class="sxs-lookup"><span data-stu-id="3f1a6-171">30</span></span> | <span data-ttu-id="3f1a6-172">Yes</span><span class="sxs-lookup"><span data-stu-id="3f1a6-172">Yes</span></span> |
| <span data-ttu-id="3f1a6-173">Portal</span><span class="sxs-lookup"><span data-stu-id="3f1a6-173">Portal</span></span> | <span data-ttu-id="3f1a6-174">110</span><span class="sxs-lookup"><span data-stu-id="3f1a6-174">110</span></span> | <span data-ttu-id="3f1a6-175">30</span><span class="sxs-lookup"><span data-stu-id="3f1a6-175">30</span></span> | <span data-ttu-id="3f1a6-176">No</span><span class="sxs-lookup"><span data-stu-id="3f1a6-176">No</span></span> |

### <a name="configure-maximum---new-clusters"></a><span data-ttu-id="3f1a6-177">Configure maximum - new clusters</span><span class="sxs-lookup"><span data-stu-id="3f1a6-177">Configure maximum - new clusters</span></span>

<span data-ttu-id="3f1a6-178">To specify a different maximum number of pods per node when you deploy an AKS cluster:</span><span class="sxs-lookup"><span data-stu-id="3f1a6-178">To specify a different maximum number of pods per node when you deploy an AKS cluster:</span></span>

* <span data-ttu-id="3f1a6-179">**Azure CLI**: Specify the `--max-pods` argument when you deploy a cluster with the [az aks create][az-aks-create] command.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-179">**Azure CLI**: Specify the `--max-pods` argument when you deploy a cluster with the [az aks create][az-aks-create] command.</span></span>
* <span data-ttu-id="3f1a6-180">**Resource Manager template**: Specify the `maxPods` property in the [ManagedClusterAgentPoolProfile] object when you deploy a cluster with a Resource Manager template.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-180">**Resource Manager template**: Specify the `maxPods` property in the [ManagedClusterAgentPoolProfile] object when you deploy a cluster with a Resource Manager template.</span></span>
* <span data-ttu-id="3f1a6-181">**Azure portal**: You cannot modify the maximum number of pods per node when you deploy a cluster with the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-181">**Azure portal**: You cannot modify the maximum number of pods per node when you deploy a cluster with the Azure portal.</span></span> <span data-ttu-id="3f1a6-182">Advanced networking clusters are limited to 30 pods per node when deployed in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-182">Advanced networking clusters are limited to 30 pods per node when deployed in the Azure portal.</span></span>

### <a name="configure-maximum---existing-clusters"></a><span data-ttu-id="3f1a6-183">Configure maximum - existing clusters</span><span class="sxs-lookup"><span data-stu-id="3f1a6-183">Configure maximum - existing clusters</span></span>

<span data-ttu-id="3f1a6-184">You can't change the maximum pods per node on an existing AKS cluster.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-184">You can't change the maximum pods per node on an existing AKS cluster.</span></span> <span data-ttu-id="3f1a6-185">You can adjust the number only when you initially deploy the cluster.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-185">You can adjust the number only when you initially deploy the cluster.</span></span>

## <a name="deployment-parameters"></a><span data-ttu-id="3f1a6-186">Deployment parameters</span><span class="sxs-lookup"><span data-stu-id="3f1a6-186">Deployment parameters</span></span>

<span data-ttu-id="3f1a6-187">When you create an AKS cluster, the following parameters are configurable for advanced networking:</span><span class="sxs-lookup"><span data-stu-id="3f1a6-187">When you create an AKS cluster, the following parameters are configurable for advanced networking:</span></span>

<span data-ttu-id="3f1a6-188">**Virtual network**: The virtual network into which you want to deploy the Kubernetes cluster.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-188">**Virtual network**: The virtual network into which you want to deploy the Kubernetes cluster.</span></span> <span data-ttu-id="3f1a6-189">If you want to create a new virtual network for your cluster, select *Create new* and follow the steps in the *Create virtual network* section.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-189">If you want to create a new virtual network for your cluster, select *Create new* and follow the steps in the *Create virtual network* section.</span></span> <span data-ttu-id="3f1a6-190">For information about the limits and quotas for an Azure virtual network, see [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md#azure-resource-manager-virtual-networking-limits).</span><span class="sxs-lookup"><span data-stu-id="3f1a6-190">For information about the limits and quotas for an Azure virtual network, see [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md#azure-resource-manager-virtual-networking-limits).</span></span>

<span data-ttu-id="3f1a6-191">**Subnet**: The subnet within the virtual network where you want to deploy the cluster.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-191">**Subnet**: The subnet within the virtual network where you want to deploy the cluster.</span></span> <span data-ttu-id="3f1a6-192">If you want to create a new subnet in the virtual network for your cluster, select *Create new* and follow the steps in the *Create subnet* section.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-192">If you want to create a new subnet in the virtual network for your cluster, select *Create new* and follow the steps in the *Create subnet* section.</span></span>

<span data-ttu-id="3f1a6-193">**Kubernetes service address range**: This is the set of virtual IPs that Kubernetes assigns to [services][services] in your cluster.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-193">**Kubernetes service address range**: This is the set of virtual IPs that Kubernetes assigns to [services][services] in your cluster.</span></span> <span data-ttu-id="3f1a6-194">You can use any private address range that satisfies the following requirements:</span><span class="sxs-lookup"><span data-stu-id="3f1a6-194">You can use any private address range that satisfies the following requirements:</span></span>

* <span data-ttu-id="3f1a6-195">Must not be within the virtual network IP address range of your cluster</span><span class="sxs-lookup"><span data-stu-id="3f1a6-195">Must not be within the virtual network IP address range of your cluster</span></span>
* <span data-ttu-id="3f1a6-196">Must not overlap with any other virtual networks with which the cluster virtual network peers</span><span class="sxs-lookup"><span data-stu-id="3f1a6-196">Must not overlap with any other virtual networks with which the cluster virtual network peers</span></span>
* <span data-ttu-id="3f1a6-197">Must not overlap with any on-premises IPs</span><span class="sxs-lookup"><span data-stu-id="3f1a6-197">Must not overlap with any on-premises IPs</span></span>
* <span data-ttu-id="3f1a6-198">Must not be within the ranges `169.254.0.0/16`, `172.30.0.0/16`, or `172.31.0.0/16`</span><span class="sxs-lookup"><span data-stu-id="3f1a6-198">Must not be within the ranges `169.254.0.0/16`, `172.30.0.0/16`, or `172.31.0.0/16`</span></span>

<span data-ttu-id="3f1a6-199">Although it's technically possible to specify a service address range within the same virtual network as your cluster, doing so is not recommended.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-199">Although it's technically possible to specify a service address range within the same virtual network as your cluster, doing so is not recommended.</span></span> <span data-ttu-id="3f1a6-200">Unpredictable behavior can result if overlapping IP ranges are used.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-200">Unpredictable behavior can result if overlapping IP ranges are used.</span></span> <span data-ttu-id="3f1a6-201">For more information, see the [FAQ](#frequently-asked-questions) section of this article.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-201">For more information, see the [FAQ](#frequently-asked-questions) section of this article.</span></span> <span data-ttu-id="3f1a6-202">For more information on Kubernetes services, see [Services][services] in the Kubernetes documentation.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-202">For more information on Kubernetes services, see [Services][services] in the Kubernetes documentation.</span></span>

<span data-ttu-id="3f1a6-203">**Kubernetes DNS service IP address**:  The IP address for the cluster's DNS service.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-203">**Kubernetes DNS service IP address**:  The IP address for the cluster's DNS service.</span></span> <span data-ttu-id="3f1a6-204">This address must be within the *Kubernetes service address range*.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-204">This address must be within the *Kubernetes service address range*.</span></span>

<span data-ttu-id="3f1a6-205">**Docker Bridge address**: The IP address and netmask to assign to the Docker bridge.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-205">**Docker Bridge address**: The IP address and netmask to assign to the Docker bridge.</span></span> <span data-ttu-id="3f1a6-206">This IP address must not be within the virtual network IP address range of your cluster.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-206">This IP address must not be within the virtual network IP address range of your cluster.</span></span>

## <a name="configure-networking---cli"></a><span data-ttu-id="3f1a6-207">Configure networking - CLI</span><span class="sxs-lookup"><span data-stu-id="3f1a6-207">Configure networking - CLI</span></span>

<span data-ttu-id="3f1a6-208">When you create an AKS cluster with the Azure CLI, you can also configure advanced networking.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-208">When you create an AKS cluster with the Azure CLI, you can also configure advanced networking.</span></span> <span data-ttu-id="3f1a6-209">Use the following commands to create a new AKS cluster with advanced networking features enabled.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-209">Use the following commands to create a new AKS cluster with advanced networking features enabled.</span></span>

<span data-ttu-id="3f1a6-210">First, get the subnet resource ID for the existing subnet into which the AKS cluster will be joined:</span><span class="sxs-lookup"><span data-stu-id="3f1a6-210">First, get the subnet resource ID for the existing subnet into which the AKS cluster will be joined:</span></span>

```console
$ az network vnet subnet list --resource-group myVnet --vnet-name myVnet --query [].id --output tsv

/subscriptions/d5b9d4b7-6fc1-46c5-bafe-38effaed19b2/resourceGroups/myVnet/providers/Microsoft.Network/virtualNetworks/myVnet/subnets/default
```

<span data-ttu-id="3f1a6-211">Use the [az aks create][az-aks-create] command with the `--network-plugin azure` argument to create a cluster with advanced networking.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-211">Use the [az aks create][az-aks-create] command with the `--network-plugin azure` argument to create a cluster with advanced networking.</span></span> <span data-ttu-id="3f1a6-212">Update the `--vnet-subnet-id` value with the subnet ID collected in the previous step:</span><span class="sxs-lookup"><span data-stu-id="3f1a6-212">Update the `--vnet-subnet-id` value with the subnet ID collected in the previous step:</span></span>

```azurecli
az aks create --resource-group myAKSCluster --name myAKSCluster --network-plugin azure --vnet-subnet-id <subnet-id> --docker-bridge-address 172.17.0.1/16 --dns-service-ip 10.2.0.10 --service-cidr 10.2.0.0/24
```

## <a name="configure-networking---portal"></a><span data-ttu-id="3f1a6-213">Configure networking - portal</span><span class="sxs-lookup"><span data-stu-id="3f1a6-213">Configure networking - portal</span></span>

<span data-ttu-id="3f1a6-214">The following screenshot from the Azure portal shows an example of configuring these settings during AKS cluster creation:</span><span class="sxs-lookup"><span data-stu-id="3f1a6-214">The following screenshot from the Azure portal shows an example of configuring these settings during AKS cluster creation:</span></span>

![Advanced networking configuration in the Azure portal][portal-01-networking-advanced]

## <a name="frequently-asked-questions"></a><span data-ttu-id="3f1a6-216">Frequently asked questions</span><span class="sxs-lookup"><span data-stu-id="3f1a6-216">Frequently asked questions</span></span>

<span data-ttu-id="3f1a6-217">The following questions and answers apply to the **Advanced** networking configuration.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-217">The following questions and answers apply to the **Advanced** networking configuration.</span></span>

* <span data-ttu-id="3f1a6-218">*Can I deploy VMs in my cluster subnet?*</span><span class="sxs-lookup"><span data-stu-id="3f1a6-218">*Can I deploy VMs in my cluster subnet?*</span></span>

  <span data-ttu-id="3f1a6-219">No.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-219">No.</span></span> <span data-ttu-id="3f1a6-220">Deploying VMs in the subnet used by your Kubernetes cluster is not supported.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-220">Deploying VMs in the subnet used by your Kubernetes cluster is not supported.</span></span> <span data-ttu-id="3f1a6-221">VMs may be deployed in the same virtual network, but in a different subnet.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-221">VMs may be deployed in the same virtual network, but in a different subnet.</span></span>

* <span data-ttu-id="3f1a6-222">*Can I configure per-pod network policies?*</span><span class="sxs-lookup"><span data-stu-id="3f1a6-222">*Can I configure per-pod network policies?*</span></span>

  <span data-ttu-id="3f1a6-223">No.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-223">No.</span></span> <span data-ttu-id="3f1a6-224">Per-pod network policies are currently unsupported.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-224">Per-pod network policies are currently unsupported.</span></span>

* <span data-ttu-id="3f1a6-225">*Is the maximum number of pods deployable to a node configurable?*</span><span class="sxs-lookup"><span data-stu-id="3f1a6-225">*Is the maximum number of pods deployable to a node configurable?*</span></span>

  <span data-ttu-id="3f1a6-226">Yes, when you deploy a cluster with the Azure CLI or a Resource Manager template.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-226">Yes, when you deploy a cluster with the Azure CLI or a Resource Manager template.</span></span> <span data-ttu-id="3f1a6-227">See [Maximum pods per node](#maximum-pods-per-node).</span><span class="sxs-lookup"><span data-stu-id="3f1a6-227">See [Maximum pods per node](#maximum-pods-per-node).</span></span>

  <span data-ttu-id="3f1a6-228">You can't change the maximum number of pods per node on an existing cluster.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-228">You can't change the maximum number of pods per node on an existing cluster.</span></span>

* <span data-ttu-id="3f1a6-229">*How do I configure additional properties for the subnet that I created during AKS cluster creation? For example, service endpoints.*</span><span class="sxs-lookup"><span data-stu-id="3f1a6-229">*How do I configure additional properties for the subnet that I created during AKS cluster creation? For example, service endpoints.*</span></span>

  <span data-ttu-id="3f1a6-230">The complete list of properties for the virtual network and subnets that you create during AKS cluster creation can be configured in the standard virtual network configuration page in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-230">The complete list of properties for the virtual network and subnets that you create during AKS cluster creation can be configured in the standard virtual network configuration page in the Azure portal.</span></span>

* <span data-ttu-id="3f1a6-231">*Can I use a different subnet within my cluster virtual network for the* **Kubernetes service address range**?</span><span class="sxs-lookup"><span data-stu-id="3f1a6-231">*Can I use a different subnet within my cluster virtual network for the* **Kubernetes service address range**?</span></span>

  <span data-ttu-id="3f1a6-232">It's not recommended, but this configuration is possible.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-232">It's not recommended, but this configuration is possible.</span></span> <span data-ttu-id="3f1a6-233">The service address range is a set of virtual IPs (VIPs) that Kubernetes assigns to the services in your cluster.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-233">The service address range is a set of virtual IPs (VIPs) that Kubernetes assigns to the services in your cluster.</span></span> <span data-ttu-id="3f1a6-234">Azure Networking has no visibility into the service IP range of the Kubernetes cluster.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-234">Azure Networking has no visibility into the service IP range of the Kubernetes cluster.</span></span> <span data-ttu-id="3f1a6-235">Because of the lack of visibility into the cluster's service address range, it's possible to later create a new subnet in the cluster virtual network that overlaps with the service address range.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-235">Because of the lack of visibility into the cluster's service address range, it's possible to later create a new subnet in the cluster virtual network that overlaps with the service address range.</span></span> <span data-ttu-id="3f1a6-236">If such an overlap occurs, Kubernetes could assign a service an IP that's already in use by another resource in the subnet, causing unpredictable behavior or failures.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-236">If such an overlap occurs, Kubernetes could assign a service an IP that's already in use by another resource in the subnet, causing unpredictable behavior or failures.</span></span> <span data-ttu-id="3f1a6-237">By ensuring you use an address range outside the cluster's virtual network, you can avoid this overlap risk.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-237">By ensuring you use an address range outside the cluster's virtual network, you can avoid this overlap risk.</span></span>

## <a name="next-steps"></a><span data-ttu-id="3f1a6-238">Next steps</span><span class="sxs-lookup"><span data-stu-id="3f1a6-238">Next steps</span></span>

### <a name="networking-in-aks"></a><span data-ttu-id="3f1a6-239">Networking in AKS</span><span class="sxs-lookup"><span data-stu-id="3f1a6-239">Networking in AKS</span></span>

<span data-ttu-id="3f1a6-240">Learn more about networking in AKS in the following articles:</span><span class="sxs-lookup"><span data-stu-id="3f1a6-240">Learn more about networking in AKS in the following articles:</span></span>

- [<span data-ttu-id="3f1a6-241">Use a static IP address with the Azure Kubernetes Service (AKS) load balancer</span><span class="sxs-lookup"><span data-stu-id="3f1a6-241">Use a static IP address with the Azure Kubernetes Service (AKS) load balancer</span></span>](static-ip.md)
- [<span data-ttu-id="3f1a6-242">Use an internal load balancer with Azure Container Service (AKS)</span><span class="sxs-lookup"><span data-stu-id="3f1a6-242">Use an internal load balancer with Azure Container Service (AKS)</span></span>](internal-lb.md)

- <span data-ttu-id="3f1a6-243">[Create a basic ingress controller with external network connectivity][aks-ingress-basic]</span><span class="sxs-lookup"><span data-stu-id="3f1a6-243">[Create a basic ingress controller with external network connectivity][aks-ingress-basic]</span></span>
- <span data-ttu-id="3f1a6-244">[Enable the HTTP application routing add-on][aks-http-app-routing]</span><span class="sxs-lookup"><span data-stu-id="3f1a6-244">[Enable the HTTP application routing add-on][aks-http-app-routing]</span></span>
- <span data-ttu-id="3f1a6-245">[Create an ingress controller that uses an internal, private network and IP address][aks-ingress-internal]</span><span class="sxs-lookup"><span data-stu-id="3f1a6-245">[Create an ingress controller that uses an internal, private network and IP address][aks-ingress-internal]</span></span>
- <span data-ttu-id="3f1a6-246">[Create an ingress controller with a dynamic public IP and configure Let's Encrypt to automatically generate TLS certificates][aks-ingress-tls]</span><span class="sxs-lookup"><span data-stu-id="3f1a6-246">[Create an ingress controller with a dynamic public IP and configure Let's Encrypt to automatically generate TLS certificates][aks-ingress-tls]</span></span>
- <span data-ttu-id="3f1a6-247">[Create an ingress controller with a static public IP and configure Let's Encrypt to automatically generate TLS certificates][aks-ingress-static-tls]</span><span class="sxs-lookup"><span data-stu-id="3f1a6-247">[Create an ingress controller with a static public IP and configure Let's Encrypt to automatically generate TLS certificates][aks-ingress-static-tls]</span></span>

### <a name="acs-engine"></a><span data-ttu-id="3f1a6-248">ACS Engine</span><span class="sxs-lookup"><span data-stu-id="3f1a6-248">ACS Engine</span></span>

<span data-ttu-id="3f1a6-249">[Azure Container Service Engine (ACS Engine)][acs-engine] is an open-source project that generates Azure Resource Manager templates you can use for deploying Docker-enabled clusters on Azure.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-249">[Azure Container Service Engine (ACS Engine)][acs-engine] is an open-source project that generates Azure Resource Manager templates you can use for deploying Docker-enabled clusters on Azure.</span></span> <span data-ttu-id="3f1a6-250">Kubernetes, DC/OS, Swarm Mode, and Swarm orchestrators can be deployed with ACS Engine.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-250">Kubernetes, DC/OS, Swarm Mode, and Swarm orchestrators can be deployed with ACS Engine.</span></span>

<span data-ttu-id="3f1a6-251">Kubernetes clusters created with ACS Engine support both the [kubenet][kubenet] and [Azure CNI][cni-networking] plugins.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-251">Kubernetes clusters created with ACS Engine support both the [kubenet][kubenet] and [Azure CNI][cni-networking] plugins.</span></span> <span data-ttu-id="3f1a6-252">As such, both basic and advanced networking scenarios are supported by ACS Engine.</span><span class="sxs-lookup"><span data-stu-id="3f1a6-252">As such, both basic and advanced networking scenarios are supported by ACS Engine.</span></span>

<!-- IMAGES -->
[advanced-networking-diagram-01]: ./media/networking-overview/advanced-networking-diagram-01.png
[portal-01-networking-advanced]: ./media/networking-overview/portal-01-networking-advanced.png

<!-- LINKS - External -->
[acs-engine]: https://github.com/Azure/acs-engine
[cni-networking]: https://github.com/Azure/azure-container-networking/blob/master/docs/cni.md
[kubenet]: https://kubernetes.io/docs/concepts/cluster-administration/network-plugins/#kubenet
[services]: https://kubernetes.io/docs/concepts/services-networking/service/
[portal]: https://portal.azure.com

<!-- LINKS - Internal -->
[az-aks-create]: /cli/azure/aks?view=azure-cli-latest#az-aks-create
[aks-ssh]: ssh.md
[ManagedClusterAgentPoolProfile]: /azure/templates/microsoft.containerservice/managedclusters#managedclusteragentpoolprofile-object
[aks-ingress-basic]: ingress-basic.md
[aks-ingress-tls]: ingress-tls.md
[aks-ingress-static-tls]: ingress-static-ip.md
[aks-http-app-routing]: http-application-routing.md
[aks-ingress-internal]: ingress-internal-ip.md
