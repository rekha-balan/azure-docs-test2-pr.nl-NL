---
title: View Azure Kubernetes Service (AKS) controller logs
description: Learn how to enable and view the logs for the Kubernetes master node in Azure Kubernetes Service (AKS)
services: container-service
author: iainfoulds
ms.service: container-service
ms.topic: article
ms.date: 07/26/2018
ms.author: iainfou
ms.openlocfilehash: 04afd71183bcb8001d017b0027f29338b8d67ddb
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44856772"
---
# <a name="enable-and-review-kubernetes-master-node-logs-in-azure-kubernetes-service-aks"></a><span data-ttu-id="92ce1-103">Enable and review Kubernetes master node logs in Azure Kubernetes Service (AKS)</span><span class="sxs-lookup"><span data-stu-id="92ce1-103">Enable and review Kubernetes master node logs in Azure Kubernetes Service (AKS)</span></span>

<span data-ttu-id="92ce1-104">With Azure Kubernetes Service (AKS), the master components such as the *kube-apiserver* and *kube-controller-manager* are provided as a managed service.</span><span class="sxs-lookup"><span data-stu-id="92ce1-104">With Azure Kubernetes Service (AKS), the master components such as the *kube-apiserver* and *kube-controller-manager* are provided as a managed service.</span></span> <span data-ttu-id="92ce1-105">You create and manage the nodes that run the *kubelet* and container runtime, and deploy your applications through the managed Kubernetes API server.</span><span class="sxs-lookup"><span data-stu-id="92ce1-105">You create and manage the nodes that run the *kubelet* and container runtime, and deploy your applications through the managed Kubernetes API server.</span></span> <span data-ttu-id="92ce1-106">To help troubleshoot your application and services, you may need to view the logs generated by these master components.</span><span class="sxs-lookup"><span data-stu-id="92ce1-106">To help troubleshoot your application and services, you may need to view the logs generated by these master components.</span></span> <span data-ttu-id="92ce1-107">This article shows you how to use Azure Log Analytics to enable and query the logs from the Kubernetes master components.</span><span class="sxs-lookup"><span data-stu-id="92ce1-107">This article shows you how to use Azure Log Analytics to enable and query the logs from the Kubernetes master components.</span></span>

## <a name="before-you-begin"></a><span data-ttu-id="92ce1-108">Before you begin</span><span class="sxs-lookup"><span data-stu-id="92ce1-108">Before you begin</span></span>

<span data-ttu-id="92ce1-109">This article requires an existing AKS cluster running in your Azure account.</span><span class="sxs-lookup"><span data-stu-id="92ce1-109">This article requires an existing AKS cluster running in your Azure account.</span></span> <span data-ttu-id="92ce1-110">If you do not already have an AKS cluster, create one using the [Azure CLI][cli-quickstart] or [Azure portal][portal-quickstart].</span><span class="sxs-lookup"><span data-stu-id="92ce1-110">If you do not already have an AKS cluster, create one using the [Azure CLI][cli-quickstart] or [Azure portal][portal-quickstart].</span></span> <span data-ttu-id="92ce1-111">Log Analytics works with both RBAC and non-RBAC enabled AKS clusters.</span><span class="sxs-lookup"><span data-stu-id="92ce1-111">Log Analytics works with both RBAC and non-RBAC enabled AKS clusters.</span></span>

## <a name="enable-diagnostics-logs"></a><span data-ttu-id="92ce1-112">Enable diagnostics logs</span><span class="sxs-lookup"><span data-stu-id="92ce1-112">Enable diagnostics logs</span></span>

<span data-ttu-id="92ce1-113">To help collect and review data from multiple sources, Log Analytics provides a query language and analytics engine that provides insights to your environment.</span><span class="sxs-lookup"><span data-stu-id="92ce1-113">To help collect and review data from multiple sources, Log Analytics provides a query language and analytics engine that provides insights to your environment.</span></span> <span data-ttu-id="92ce1-114">A workspace is used to collate and analyze the data, and can integrate with other Azure services such as Application Insights and Security Center.</span><span class="sxs-lookup"><span data-stu-id="92ce1-114">A workspace is used to collate and analyze the data, and can integrate with other Azure services such as Application Insights and Security Center.</span></span> <span data-ttu-id="92ce1-115">To use a different platform to analyze the logs, you can instead choose to send diagnostic logs to an Azure storage account or event hub.</span><span class="sxs-lookup"><span data-stu-id="92ce1-115">To use a different platform to analyze the logs, you can instead choose to send diagnostic logs to an Azure storage account or event hub.</span></span> <span data-ttu-id="92ce1-116">For more information, see [What is Azure Log Analytics?][log-analytics-overview].</span><span class="sxs-lookup"><span data-stu-id="92ce1-116">For more information, see [What is Azure Log Analytics?][log-analytics-overview].</span></span>

<span data-ttu-id="92ce1-117">Log Analytics is enabled and managed in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="92ce1-117">Log Analytics is enabled and managed in the Azure portal.</span></span> <span data-ttu-id="92ce1-118">To enable log collection for the Kubernetes master components in your AKS cluster, open the Azure portal in a web browser and complete the following steps:</span><span class="sxs-lookup"><span data-stu-id="92ce1-118">To enable log collection for the Kubernetes master components in your AKS cluster, open the Azure portal in a web browser and complete the following steps:</span></span>

1. <span data-ttu-id="92ce1-119">Select the resource group for your AKS cluster, such as *myResourceGroup*.</span><span class="sxs-lookup"><span data-stu-id="92ce1-119">Select the resource group for your AKS cluster, such as *myResourceGroup*.</span></span> <span data-ttu-id="92ce1-120">Don't select the resource group that contains your individual AKS cluster resources, such as *MC_myResourceGroup_myAKSCluster_eastus*.</span><span class="sxs-lookup"><span data-stu-id="92ce1-120">Don't select the resource group that contains your individual AKS cluster resources, such as *MC_myResourceGroup_myAKSCluster_eastus*.</span></span>
1. <span data-ttu-id="92ce1-121">On the left-hand side, choose **Diagnostic settings**.</span><span class="sxs-lookup"><span data-stu-id="92ce1-121">On the left-hand side, choose **Diagnostic settings**.</span></span>
1. <span data-ttu-id="92ce1-122">Select your AKS cluster, such as *myAKSCluster*, then choose to **Turn on diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="92ce1-122">Select your AKS cluster, such as *myAKSCluster*, then choose to **Turn on diagnostics**.</span></span>
1. <span data-ttu-id="92ce1-123">Enter a name, such as *myAKSLogs*, then select the option to **Send to Log Analytics**.</span><span class="sxs-lookup"><span data-stu-id="92ce1-123">Enter a name, such as *myAKSLogs*, then select the option to **Send to Log Analytics**.</span></span>
    * <span data-ttu-id="92ce1-124">Choose to *Configure* Log Analytics, then select an existing workspace or **Create New Workspace**.</span><span class="sxs-lookup"><span data-stu-id="92ce1-124">Choose to *Configure* Log Analytics, then select an existing workspace or **Create New Workspace**.</span></span>
    * <span data-ttu-id="92ce1-125">If you need to create a workspace, provide a name, a resource group, and a location.</span><span class="sxs-lookup"><span data-stu-id="92ce1-125">If you need to create a workspace, provide a name, a resource group, and a location.</span></span>
1. <span data-ttu-id="92ce1-126">In the list of available logs, select the logs you wish to enable, such as *kube-apiserver*, *kube-controller-manager*, and *kube-scheduler*.</span><span class="sxs-lookup"><span data-stu-id="92ce1-126">In the list of available logs, select the logs you wish to enable, such as *kube-apiserver*, *kube-controller-manager*, and *kube-scheduler*.</span></span> <span data-ttu-id="92ce1-127">You can return and change the collected logs once Log Analytics are enabled.</span><span class="sxs-lookup"><span data-stu-id="92ce1-127">You can return and change the collected logs once Log Analytics are enabled.</span></span>
1. <span data-ttu-id="92ce1-128">When ready, select **Save** to enable collection of the selected logs.</span><span class="sxs-lookup"><span data-stu-id="92ce1-128">When ready, select **Save** to enable collection of the selected logs.</span></span>

<span data-ttu-id="92ce1-129">The following example portal screenshot shows the *Diagnostics settings* window and then option to create an OMS workspace:</span><span class="sxs-lookup"><span data-stu-id="92ce1-129">The following example portal screenshot shows the *Diagnostics settings* window and then option to create an OMS workspace:</span></span>

![Enable OMS workspace for Log Analytics of AKS cluster](media/view-master-logs/enable-oms-log-analytics.png)

## <a name="schedule-a-test-pod-on-the-aks-cluster"></a><span data-ttu-id="92ce1-131">Schedule a test pod on the AKS cluster</span><span class="sxs-lookup"><span data-stu-id="92ce1-131">Schedule a test pod on the AKS cluster</span></span>

<span data-ttu-id="92ce1-132">To generate some logs, create a new pod in your AKS cluster.</span><span class="sxs-lookup"><span data-stu-id="92ce1-132">To generate some logs, create a new pod in your AKS cluster.</span></span> <span data-ttu-id="92ce1-133">The following example YAML manifest can be used to create a basic NGINX instance.</span><span class="sxs-lookup"><span data-stu-id="92ce1-133">The following example YAML manifest can be used to create a basic NGINX instance.</span></span> <span data-ttu-id="92ce1-134">Create a file named `nginx.yaml` in an editor of your choice and paste the following content:</span><span class="sxs-lookup"><span data-stu-id="92ce1-134">Create a file named `nginx.yaml` in an editor of your choice and paste the following content:</span></span>

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - name: myfrontend
    image: nginx
    ports:
    - containerPort: 80
```

<span data-ttu-id="92ce1-135">Create the pod with the [kubectl create][kubectl-create] command and specify your YAML file, as shown in the following example:</span><span class="sxs-lookup"><span data-stu-id="92ce1-135">Create the pod with the [kubectl create][kubectl-create] command and specify your YAML file, as shown in the following example:</span></span>

```
$ kubectl create -f nginx.yaml

pod/nginx created
```

## <a name="view-collected-logs"></a><span data-ttu-id="92ce1-136">View collected logs</span><span class="sxs-lookup"><span data-stu-id="92ce1-136">View collected logs</span></span>

<span data-ttu-id="92ce1-137">It may take a few minutes for the diagnostics logs to be enabled and appear in the OMS workspace.</span><span class="sxs-lookup"><span data-stu-id="92ce1-137">It may take a few minutes for the diagnostics logs to be enabled and appear in the OMS workspace.</span></span> <span data-ttu-id="92ce1-138">In the Azure portal, select the resource group for your Log Analytics workspace, such as *myResourceGroup*, then choose your Log Analytics resource, such as *myAKSLogs*.</span><span class="sxs-lookup"><span data-stu-id="92ce1-138">In the Azure portal, select the resource group for your Log Analytics workspace, such as *myResourceGroup*, then choose your Log Analytics resource, such as *myAKSLogs*.</span></span>

![Select the Log Analytics workspace for your AKS cluster](media/view-master-logs/select-log-analytics-workspace.png)

<span data-ttu-id="92ce1-140">On the left-hand side, choose **Log Search**.</span><span class="sxs-lookup"><span data-stu-id="92ce1-140">On the left-hand side, choose **Log Search**.</span></span> <span data-ttu-id="92ce1-141">To view the *kube-apiserver*, enter the following query in the text box:</span><span class="sxs-lookup"><span data-stu-id="92ce1-141">To view the *kube-apiserver*, enter the following query in the text box:</span></span>

```
search *
| where Type == "AzureDiagnostics"
| where Category == "kube-apiserver"
| project log_s
```

<span data-ttu-id="92ce1-142">Many logs are likely returned for the API server.</span><span class="sxs-lookup"><span data-stu-id="92ce1-142">Many logs are likely returned for the API server.</span></span> <span data-ttu-id="92ce1-143">To scope down the query to view the logs about the NGINX pod created in the previous step, add an additional *where* statement to search for *pods/nginx* as shown in the following example query:</span><span class="sxs-lookup"><span data-stu-id="92ce1-143">To scope down the query to view the logs about the NGINX pod created in the previous step, add an additional *where* statement to search for *pods/nginx* as shown in the following example query:</span></span>

```
search *
| where Type == "AzureDiagnostics"
| where Category == "kube-apiserver"
| where log_s contains "pods/nginx"
| project log_s
```

<span data-ttu-id="92ce1-144">The specific logs for your NGINX pod are displayed, as shown in the following example screenshot:</span><span class="sxs-lookup"><span data-stu-id="92ce1-144">The specific logs for your NGINX pod are displayed, as shown in the following example screenshot:</span></span>

![Log Analytics query results for sample NGINX pod](media/view-master-logs/log-analytics-query-results.png)

<span data-ttu-id="92ce1-146">To view additional logs, you can update the query for the *Category* name to *kube-controller-manager* or *kube-scheduler*, depending on what additional logs you enable.</span><span class="sxs-lookup"><span data-stu-id="92ce1-146">To view additional logs, you can update the query for the *Category* name to *kube-controller-manager* or *kube-scheduler*, depending on what additional logs you enable.</span></span> <span data-ttu-id="92ce1-147">Additional *where* statements can then be used to refine the events you are looking for.</span><span class="sxs-lookup"><span data-stu-id="92ce1-147">Additional *where* statements can then be used to refine the events you are looking for.</span></span>

<span data-ttu-id="92ce1-148">For more information on how to query and filter your log data, see [View or analyze data collected with Log Analytics log search][analyze-log-analytics].</span><span class="sxs-lookup"><span data-stu-id="92ce1-148">For more information on how to query and filter your log data, see [View or analyze data collected with Log Analytics log search][analyze-log-analytics].</span></span>

## <a name="log-event-schema"></a><span data-ttu-id="92ce1-149">Log event schema</span><span class="sxs-lookup"><span data-stu-id="92ce1-149">Log event schema</span></span>

<span data-ttu-id="92ce1-150">To help analyze the log data, the following table details the schema used for each event:</span><span class="sxs-lookup"><span data-stu-id="92ce1-150">To help analyze the log data, the following table details the schema used for each event:</span></span>

| <span data-ttu-id="92ce1-151">Field name</span><span class="sxs-lookup"><span data-stu-id="92ce1-151">Field name</span></span>               | <span data-ttu-id="92ce1-152">Description</span><span class="sxs-lookup"><span data-stu-id="92ce1-152">Description</span></span> |
|--------------------------|-------------|
| <span data-ttu-id="92ce1-153">*resourceId*</span><span class="sxs-lookup"><span data-stu-id="92ce1-153">*resourceId*</span></span>             | <span data-ttu-id="92ce1-154">Azure resource that produced the log</span><span class="sxs-lookup"><span data-stu-id="92ce1-154">Azure resource that produced the log</span></span> |
| <span data-ttu-id="92ce1-155">*time*</span><span class="sxs-lookup"><span data-stu-id="92ce1-155">*time*</span></span>                   | <span data-ttu-id="92ce1-156">Timestamp of when the log was uploaded</span><span class="sxs-lookup"><span data-stu-id="92ce1-156">Timestamp of when the log was uploaded</span></span> |
| <span data-ttu-id="92ce1-157">*category*</span><span class="sxs-lookup"><span data-stu-id="92ce1-157">*category*</span></span>               | <span data-ttu-id="92ce1-158">Name of container/component generating the log</span><span class="sxs-lookup"><span data-stu-id="92ce1-158">Name of container/component generating the log</span></span> |
| <span data-ttu-id="92ce1-159">*operationName*</span><span class="sxs-lookup"><span data-stu-id="92ce1-159">*operationName*</span></span>          | <span data-ttu-id="92ce1-160">Always *Microsoft.ContainerService/managedClusters/diagnositicLogs/Read*</span><span class="sxs-lookup"><span data-stu-id="92ce1-160">Always *Microsoft.ContainerService/managedClusters/diagnositicLogs/Read*</span></span> |
| <span data-ttu-id="92ce1-161">*properties.log*</span><span class="sxs-lookup"><span data-stu-id="92ce1-161">*properties.log*</span></span>         | <span data-ttu-id="92ce1-162">Full text of the log from the component</span><span class="sxs-lookup"><span data-stu-id="92ce1-162">Full text of the log from the component</span></span> |
| <span data-ttu-id="92ce1-163">*properties.stream*</span><span class="sxs-lookup"><span data-stu-id="92ce1-163">*properties.stream*</span></span>      | <span data-ttu-id="92ce1-164">*stderr* or *stdout*</span><span class="sxs-lookup"><span data-stu-id="92ce1-164">*stderr* or *stdout*</span></span> |
| <span data-ttu-id="92ce1-165">*properties.pod*</span><span class="sxs-lookup"><span data-stu-id="92ce1-165">*properties.pod*</span></span>         | <span data-ttu-id="92ce1-166">Pod name that the log came from</span><span class="sxs-lookup"><span data-stu-id="92ce1-166">Pod name that the log came from</span></span> |
| <span data-ttu-id="92ce1-167">*properties.containerID*</span><span class="sxs-lookup"><span data-stu-id="92ce1-167">*properties.containerID*</span></span> | <span data-ttu-id="92ce1-168">Id of the docker container this log came from</span><span class="sxs-lookup"><span data-stu-id="92ce1-168">Id of the docker container this log came from</span></span> |

## <a name="next-steps"></a><span data-ttu-id="92ce1-169">Next steps</span><span class="sxs-lookup"><span data-stu-id="92ce1-169">Next steps</span></span>

<span data-ttu-id="92ce1-170">In this article, you learned how to enable and review the logs for the Kubernetes master components in your AKS cluster.</span><span class="sxs-lookup"><span data-stu-id="92ce1-170">In this article, you learned how to enable and review the logs for the Kubernetes master components in your AKS cluster.</span></span> <span data-ttu-id="92ce1-171">To monitor and troubleshoot further, you can also [view the Kubelet logs][kubelet-logs] and [enable SSH node access][aks-ssh].</span><span class="sxs-lookup"><span data-stu-id="92ce1-171">To monitor and troubleshoot further, you can also [view the Kubelet logs][kubelet-logs] and [enable SSH node access][aks-ssh].</span></span>

<!-- LINKS - external -->
[kubectl-create]: https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#create

<!-- LINKS - internal -->
[cli-quickstart]: kubernetes-walkthrough.md
[portal-quickstart]: kubernetes-walkthrough-portal.md
[log-analytics-overview]: ../log-analytics/log-analytics-overview.md
[analyze-log-analytics]: ../log-analytics/log-analytics-tutorial-viewdata.md
[kubelet-logs]: kubelet-logs.md
[aks-ssh]: ssh.md