---
title: Monitor network communication - tutorial - Azure portal | Microsoft Docs
description: Learn how to monitor network communication between two virtual machines with Azure Network Watcher's connection monitor capability.
services: network-watcher
documentationcenter: na
author: jimdial
manager: jeconnoc
editor: ''
tags: azure-resource-manager
Customer intent: I need to monitor communication between a VM and another VM. If the communication fails, I need to know why, so that I can resolve the problem.
ms.service: network-watcher
ms.devlang: na
ms.topic: tutorial
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/27/2018
ms.author: jdial
ms.custom: mvc
ms.openlocfilehash: 9b13b8ae0b64dc84e476f5fc5da59ea30702fd8d
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44856700"
---
# <a name="tutorial-monitor-network-communication-between-two-virtual-machines-using-the-azure-portal"></a><span data-ttu-id="9865e-103">Tutorial: Monitor network communication between two virtual machines using the Azure portal</span><span class="sxs-lookup"><span data-stu-id="9865e-103">Tutorial: Monitor network communication between two virtual machines using the Azure portal</span></span>

<span data-ttu-id="9865e-104">Successful communication between a virtual machine (VM) and an endpoint such as another VM, can be critical for your organization.</span><span class="sxs-lookup"><span data-stu-id="9865e-104">Successful communication between a virtual machine (VM) and an endpoint such as another VM, can be critical for your organization.</span></span> <span data-ttu-id="9865e-105">Sometimes, configuration changes are introduced which can break communication.</span><span class="sxs-lookup"><span data-stu-id="9865e-105">Sometimes, configuration changes are introduced which can break communication.</span></span> <span data-ttu-id="9865e-106">In this tutorial, you learn how to:</span><span class="sxs-lookup"><span data-stu-id="9865e-106">In this tutorial, you learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="9865e-107">Create two VMs</span><span class="sxs-lookup"><span data-stu-id="9865e-107">Create two VMs</span></span>
> * <span data-ttu-id="9865e-108">Monitor communication between VMs with the connection monitor capability of Network Watcher</span><span class="sxs-lookup"><span data-stu-id="9865e-108">Monitor communication between VMs with the connection monitor capability of Network Watcher</span></span>
> * <span data-ttu-id="9865e-109">Diagnose a communication problem between two VMs, and learn how you can resolve it</span><span class="sxs-lookup"><span data-stu-id="9865e-109">Diagnose a communication problem between two VMs, and learn how you can resolve it</span></span>

<span data-ttu-id="9865e-110">If you don't have an Azure subscription, create a [free account](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) before you begin.</span><span class="sxs-lookup"><span data-stu-id="9865e-110">If you don't have an Azure subscription, create a [free account](https://azure.microsoft.com/free/?WT.mc_id=A261C142F) before you begin.</span></span>

## <a name="sign-in-to-azure"></a><span data-ttu-id="9865e-111">Sign in to Azure</span><span class="sxs-lookup"><span data-stu-id="9865e-111">Sign in to Azure</span></span>

<span data-ttu-id="9865e-112">Sign in to the [Azure portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="9865e-112">Sign in to the [Azure portal](https://portal.azure.com).</span></span>

## <a name="create-vms"></a><span data-ttu-id="9865e-113">Create VMs</span><span class="sxs-lookup"><span data-stu-id="9865e-113">Create VMs</span></span>

<span data-ttu-id="9865e-114">Create two VMs.</span><span class="sxs-lookup"><span data-stu-id="9865e-114">Create two VMs.</span></span>

### <a name="create-the-first-vm"></a><span data-ttu-id="9865e-115">Create the first VM</span><span class="sxs-lookup"><span data-stu-id="9865e-115">Create the first VM</span></span>

1. <span data-ttu-id="9865e-116">Select **+ Create a resource** found on the upper, left corner of the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="9865e-116">Select **+ Create a resource** found on the upper, left corner of the Azure portal.</span></span>
2. <span data-ttu-id="9865e-117">Select **Compute**, and then select an operating system.</span><span class="sxs-lookup"><span data-stu-id="9865e-117">Select **Compute**, and then select an operating system.</span></span> <span data-ttu-id="9865e-118">In this tutorial, **Windows Server 2016 Datacenter** is used.</span><span class="sxs-lookup"><span data-stu-id="9865e-118">In this tutorial, **Windows Server 2016 Datacenter** is used.</span></span>
3. <span data-ttu-id="9865e-119">Enter, or select, the following information, accept the defaults for the remaining settings, and then select **OK**:</span><span class="sxs-lookup"><span data-stu-id="9865e-119">Enter, or select, the following information, accept the defaults for the remaining settings, and then select **OK**:</span></span>

    |<span data-ttu-id="9865e-120">Setting</span><span class="sxs-lookup"><span data-stu-id="9865e-120">Setting</span></span>|<span data-ttu-id="9865e-121">Value</span><span class="sxs-lookup"><span data-stu-id="9865e-121">Value</span></span>|
    |---|---|
    |<span data-ttu-id="9865e-122">Name</span><span class="sxs-lookup"><span data-stu-id="9865e-122">Name</span></span>|<span data-ttu-id="9865e-123">myVm1</span><span class="sxs-lookup"><span data-stu-id="9865e-123">myVm1</span></span>|
    |<span data-ttu-id="9865e-124">User name</span><span class="sxs-lookup"><span data-stu-id="9865e-124">User name</span></span>| <span data-ttu-id="9865e-125">Enter a user name of your choosing.</span><span class="sxs-lookup"><span data-stu-id="9865e-125">Enter a user name of your choosing.</span></span>|
    |<span data-ttu-id="9865e-126">Password</span><span class="sxs-lookup"><span data-stu-id="9865e-126">Password</span></span>| <span data-ttu-id="9865e-127">Enter a password of your choosing.</span><span class="sxs-lookup"><span data-stu-id="9865e-127">Enter a password of your choosing.</span></span> <span data-ttu-id="9865e-128">The password must be at least 12 characters long and meet the [defined complexity requirements](../virtual-machines/windows/faq.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json#what-are-the-password-requirements-when-creating-a-vm).</span><span class="sxs-lookup"><span data-stu-id="9865e-128">The password must be at least 12 characters long and meet the [defined complexity requirements](../virtual-machines/windows/faq.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json#what-are-the-password-requirements-when-creating-a-vm).</span></span>|
    |<span data-ttu-id="9865e-129">Subscription</span><span class="sxs-lookup"><span data-stu-id="9865e-129">Subscription</span></span>| <span data-ttu-id="9865e-130">Select your subscription.</span><span class="sxs-lookup"><span data-stu-id="9865e-130">Select your subscription.</span></span>|
    |<span data-ttu-id="9865e-131">Resource group</span><span class="sxs-lookup"><span data-stu-id="9865e-131">Resource group</span></span>| <span data-ttu-id="9865e-132">Select **Create new** and enter **myResourceGroup**.</span><span class="sxs-lookup"><span data-stu-id="9865e-132">Select **Create new** and enter **myResourceGroup**.</span></span>|
    |<span data-ttu-id="9865e-133">Location</span><span class="sxs-lookup"><span data-stu-id="9865e-133">Location</span></span>| <span data-ttu-id="9865e-134">Select **East US**</span><span class="sxs-lookup"><span data-stu-id="9865e-134">Select **East US**</span></span>|

4. <span data-ttu-id="9865e-135">Select a size for the VM and then select **Select**.</span><span class="sxs-lookup"><span data-stu-id="9865e-135">Select a size for the VM and then select **Select**.</span></span>
5. <span data-ttu-id="9865e-136">Under **Settings**, select **Extensions**.</span><span class="sxs-lookup"><span data-stu-id="9865e-136">Under **Settings**, select **Extensions**.</span></span> <span data-ttu-id="9865e-137">Select **Add extension**, and select **Network Watcher Agent for Windows**, as shown in the following picture:</span><span class="sxs-lookup"><span data-stu-id="9865e-137">Select **Add extension**, and select **Network Watcher Agent for Windows**, as shown in the following picture:</span></span>

    ![Network Watcher agent extension](./media/connection-monitor/nw-agent-extension.png)

6. <span data-ttu-id="9865e-139">Under **Network Watcher Agent for Windows**, select **Create**, under **Install extension** select **OK**, and then under **Extensions**, select **OK**.</span><span class="sxs-lookup"><span data-stu-id="9865e-139">Under **Network Watcher Agent for Windows**, select **Create**, under **Install extension** select **OK**, and then under **Extensions**, select **OK**.</span></span>
7. <span data-ttu-id="9865e-140">Accept the defaults for the remaining **Settings** and select **OK**.</span><span class="sxs-lookup"><span data-stu-id="9865e-140">Accept the defaults for the remaining **Settings** and select **OK**.</span></span>
8. <span data-ttu-id="9865e-141">Under **Create** of the **Summary**, select **Create** to start VM deployment.</span><span class="sxs-lookup"><span data-stu-id="9865e-141">Under **Create** of the **Summary**, select **Create** to start VM deployment.</span></span>

### <a name="create-the-second-vm"></a><span data-ttu-id="9865e-142">Create the second VM</span><span class="sxs-lookup"><span data-stu-id="9865e-142">Create the second VM</span></span>

<span data-ttu-id="9865e-143">Complete the steps in [Create the first VM](#create-the-first-vm) again, with the following changes:</span><span class="sxs-lookup"><span data-stu-id="9865e-143">Complete the steps in [Create the first VM](#create-the-first-vm) again, with the following changes:</span></span>

|<span data-ttu-id="9865e-144">Step</span><span class="sxs-lookup"><span data-stu-id="9865e-144">Step</span></span>|<span data-ttu-id="9865e-145">Setting</span><span class="sxs-lookup"><span data-stu-id="9865e-145">Setting</span></span>|<span data-ttu-id="9865e-146">Value</span><span class="sxs-lookup"><span data-stu-id="9865e-146">Value</span></span>|
|---|---|---|
| <span data-ttu-id="9865e-147">1</span><span class="sxs-lookup"><span data-stu-id="9865e-147">1</span></span> | <span data-ttu-id="9865e-148">Select **Ubuntu Server 17.10 VM**</span><span class="sxs-lookup"><span data-stu-id="9865e-148">Select **Ubuntu Server 17.10 VM**</span></span> |                                                                         |
| <span data-ttu-id="9865e-149">3</span><span class="sxs-lookup"><span data-stu-id="9865e-149">3</span></span> | <span data-ttu-id="9865e-150">Name</span><span class="sxs-lookup"><span data-stu-id="9865e-150">Name</span></span>                              | <span data-ttu-id="9865e-151">myVm2</span><span class="sxs-lookup"><span data-stu-id="9865e-151">myVm2</span></span>                                                                   |
| <span data-ttu-id="9865e-152">3</span><span class="sxs-lookup"><span data-stu-id="9865e-152">3</span></span> | <span data-ttu-id="9865e-153">Authentication type</span><span class="sxs-lookup"><span data-stu-id="9865e-153">Authentication type</span></span>               | <span data-ttu-id="9865e-154">Paste your SSH public key or select **Password**, and enter a password.</span><span class="sxs-lookup"><span data-stu-id="9865e-154">Paste your SSH public key or select **Password**, and enter a password.</span></span> |
| <span data-ttu-id="9865e-155">3</span><span class="sxs-lookup"><span data-stu-id="9865e-155">3</span></span> | <span data-ttu-id="9865e-156">Resource group</span><span class="sxs-lookup"><span data-stu-id="9865e-156">Resource group</span></span>                    | <span data-ttu-id="9865e-157">Select **Use existing** and select **myResourceGroup**.</span><span class="sxs-lookup"><span data-stu-id="9865e-157">Select **Use existing** and select **myResourceGroup**.</span></span>                 |
| <span data-ttu-id="9865e-158">6</span><span class="sxs-lookup"><span data-stu-id="9865e-158">6</span></span> | <span data-ttu-id="9865e-159">Extensions</span><span class="sxs-lookup"><span data-stu-id="9865e-159">Extensions</span></span>                        | <span data-ttu-id="9865e-160">**Network Agent for Linux**</span><span class="sxs-lookup"><span data-stu-id="9865e-160">**Network Agent for Linux**</span></span>                                             |

<span data-ttu-id="9865e-161">The VM takes a few minutes to deploy.</span><span class="sxs-lookup"><span data-stu-id="9865e-161">The VM takes a few minutes to deploy.</span></span> <span data-ttu-id="9865e-162">Wait for the VM to finish deploying before continuing with the remaining steps.</span><span class="sxs-lookup"><span data-stu-id="9865e-162">Wait for the VM to finish deploying before continuing with the remaining steps.</span></span>

## <a name="create-a-connection-monitor"></a><span data-ttu-id="9865e-163">Create a connection monitor</span><span class="sxs-lookup"><span data-stu-id="9865e-163">Create a connection monitor</span></span>

<span data-ttu-id="9865e-164">Create a connection monitor to monitor communication over TCP port 22 from *myVm1* to *myVm2*.</span><span class="sxs-lookup"><span data-stu-id="9865e-164">Create a connection monitor to monitor communication over TCP port 22 from *myVm1* to *myVm2*.</span></span>

1. <span data-ttu-id="9865e-165">On the left side of the portal, select **All services**.</span><span class="sxs-lookup"><span data-stu-id="9865e-165">On the left side of the portal, select **All services**.</span></span>
2. <span data-ttu-id="9865e-166">Start typing *network watcher* in the **Filter** box.</span><span class="sxs-lookup"><span data-stu-id="9865e-166">Start typing *network watcher* in the **Filter** box.</span></span> <span data-ttu-id="9865e-167">When **Network Watcher** appears in the search results, select it.</span><span class="sxs-lookup"><span data-stu-id="9865e-167">When **Network Watcher** appears in the search results, select it.</span></span>
3. <span data-ttu-id="9865e-168">Under **MONITORING**, select **Connection monitor**.</span><span class="sxs-lookup"><span data-stu-id="9865e-168">Under **MONITORING**, select **Connection monitor**.</span></span>
4. <span data-ttu-id="9865e-169">Select **+ Add**.</span><span class="sxs-lookup"><span data-stu-id="9865e-169">Select **+ Add**.</span></span>
5. <span data-ttu-id="9865e-170">Enter or select the information for the connection you want to monitor, and then select **Add**.</span><span class="sxs-lookup"><span data-stu-id="9865e-170">Enter or select the information for the connection you want to monitor, and then select **Add**.</span></span> <span data-ttu-id="9865e-171">In the example shown in the following picture, the connection monitored is from the *myVm1* VM to the *myVm2* VM over port 22:</span><span class="sxs-lookup"><span data-stu-id="9865e-171">In the example shown in the following picture, the connection monitored is from the *myVm1* VM to the *myVm2* VM over port 22:</span></span>

    | <span data-ttu-id="9865e-172">Setting</span><span class="sxs-lookup"><span data-stu-id="9865e-172">Setting</span></span>                  | <span data-ttu-id="9865e-173">Value</span><span class="sxs-lookup"><span data-stu-id="9865e-173">Value</span></span>               |
    | ---------                | ---------           |
    | <span data-ttu-id="9865e-174">Name</span><span class="sxs-lookup"><span data-stu-id="9865e-174">Name</span></span>                     | <span data-ttu-id="9865e-175">myVm1-myVm2(22)</span><span class="sxs-lookup"><span data-stu-id="9865e-175">myVm1-myVm2(22)</span></span>     |
    | <span data-ttu-id="9865e-176">Source</span><span class="sxs-lookup"><span data-stu-id="9865e-176">Source</span></span>                   |                     |
    | <span data-ttu-id="9865e-177">Virtual machine</span><span class="sxs-lookup"><span data-stu-id="9865e-177">Virtual machine</span></span>          | <span data-ttu-id="9865e-178">myVm1</span><span class="sxs-lookup"><span data-stu-id="9865e-178">myVm1</span></span>               |
    | <span data-ttu-id="9865e-179">Destination</span><span class="sxs-lookup"><span data-stu-id="9865e-179">Destination</span></span>              |                     |
    | <span data-ttu-id="9865e-180">Select a virtual machine</span><span class="sxs-lookup"><span data-stu-id="9865e-180">Select a virtual machine</span></span> |                     |
    | <span data-ttu-id="9865e-181">Virtual machine</span><span class="sxs-lookup"><span data-stu-id="9865e-181">Virtual machine</span></span>          | <span data-ttu-id="9865e-182">myVm2</span><span class="sxs-lookup"><span data-stu-id="9865e-182">myVm2</span></span>               |
    | <span data-ttu-id="9865e-183">Port</span><span class="sxs-lookup"><span data-stu-id="9865e-183">Port</span></span>                     | <span data-ttu-id="9865e-184">22</span><span class="sxs-lookup"><span data-stu-id="9865e-184">22</span></span>                  |

    ![Add Connection Monitor](./media/connection-monitor/add-connection-monitor.png)

## <a name="view-a-connection-monitor"></a><span data-ttu-id="9865e-186">View a connection monitor</span><span class="sxs-lookup"><span data-stu-id="9865e-186">View a connection monitor</span></span>

1. <span data-ttu-id="9865e-187">Complete steps 1-3 in [Create a connection monitor](#create-a-connection-monitor) to view connection monitoring.</span><span class="sxs-lookup"><span data-stu-id="9865e-187">Complete steps 1-3 in [Create a connection monitor](#create-a-connection-monitor) to view connection monitoring.</span></span> <span data-ttu-id="9865e-188">You see a list of existing connection monitors, as shown in the following picture:</span><span class="sxs-lookup"><span data-stu-id="9865e-188">You see a list of existing connection monitors, as shown in the following picture:</span></span>

    ![Connection monitors](./media/connection-monitor/connection-monitors.png)

2. <span data-ttu-id="9865e-190">Select the monitor with the name **myVm1-myVm2(22)**, as shown in the previous picture, to see details for the monitor, as shown in the following picture:</span><span class="sxs-lookup"><span data-stu-id="9865e-190">Select the monitor with the name **myVm1-myVm2(22)**, as shown in the previous picture, to see details for the monitor, as shown in the following picture:</span></span>

    ![Monitor details](./media/connection-monitor/vm-monitor.png)

    <span data-ttu-id="9865e-192">Note the following information:</span><span class="sxs-lookup"><span data-stu-id="9865e-192">Note the following information:</span></span>

    | <span data-ttu-id="9865e-193">Item</span><span class="sxs-lookup"><span data-stu-id="9865e-193">Item</span></span>                     | <span data-ttu-id="9865e-194">Value</span><span class="sxs-lookup"><span data-stu-id="9865e-194">Value</span></span>                      | <span data-ttu-id="9865e-195">Details</span><span class="sxs-lookup"><span data-stu-id="9865e-195">Details</span></span>                                                     |
    | ---------                | ---------                  |--------                                                     |
    | <span data-ttu-id="9865e-196">Status</span><span class="sxs-lookup"><span data-stu-id="9865e-196">Status</span></span>                   | <span data-ttu-id="9865e-197">Reachable</span><span class="sxs-lookup"><span data-stu-id="9865e-197">Reachable</span></span>                  | <span data-ttu-id="9865e-198">Lets you know whether the endpoint is reachable or not.</span><span class="sxs-lookup"><span data-stu-id="9865e-198">Lets you know whether the endpoint is reachable or not.</span></span>|
    | <span data-ttu-id="9865e-199">AVG.</span><span class="sxs-lookup"><span data-stu-id="9865e-199">AVG.</span></span> <span data-ttu-id="9865e-200">ROUND-TRIP</span><span class="sxs-lookup"><span data-stu-id="9865e-200">ROUND-TRIP</span></span>          | <span data-ttu-id="9865e-201">Lets you know the round-trip time to make the connection, in milliseconds.</span><span class="sxs-lookup"><span data-stu-id="9865e-201">Lets you know the round-trip time to make the connection, in milliseconds.</span></span> <span data-ttu-id="9865e-202">Connection monitor probes the connection every 60 seconds, so you can monitor latency over time.</span><span class="sxs-lookup"><span data-stu-id="9865e-202">Connection monitor probes the connection every 60 seconds, so you can monitor latency over time.</span></span>                                         |
    | <span data-ttu-id="9865e-203">Hops</span><span class="sxs-lookup"><span data-stu-id="9865e-203">Hops</span></span>                     | <span data-ttu-id="9865e-204">Connection monitor lets you know the hops between the two endpoints.</span><span class="sxs-lookup"><span data-stu-id="9865e-204">Connection monitor lets you know the hops between the two endpoints.</span></span> <span data-ttu-id="9865e-205">In this example, the connection is between two VMs in the same virtual network, so there is only one hop, to the 10.0.0.5 IP address.</span><span class="sxs-lookup"><span data-stu-id="9865e-205">In this example, the connection is between two VMs in the same virtual network, so there is only one hop, to the 10.0.0.5 IP address.</span></span> <span data-ttu-id="9865e-206">If any existing system or custom routes, route traffic between the VMs through a VPN gateway, or network virtual appliance, for example, additional hops are listed.</span><span class="sxs-lookup"><span data-stu-id="9865e-206">If any existing system or custom routes, route traffic between the VMs through a VPN gateway, or network virtual appliance, for example, additional hops are listed.</span></span>                                                                                                                         |
    | <span data-ttu-id="9865e-207">STATUS</span><span class="sxs-lookup"><span data-stu-id="9865e-207">STATUS</span></span>                   | <span data-ttu-id="9865e-208">The green check marks for each endpoint let you know that each endpoint is healthy.</span><span class="sxs-lookup"><span data-stu-id="9865e-208">The green check marks for each endpoint let you know that each endpoint is healthy.</span></span>    ||

## <a name="view-a-problem"></a><span data-ttu-id="9865e-209">View a problem</span><span class="sxs-lookup"><span data-stu-id="9865e-209">View a problem</span></span>

<span data-ttu-id="9865e-210">By default, Azure allows communication over all ports between VMs in the same virtual network.</span><span class="sxs-lookup"><span data-stu-id="9865e-210">By default, Azure allows communication over all ports between VMs in the same virtual network.</span></span> <span data-ttu-id="9865e-211">Over time, you, or someone in your organization, might override Azure's default rules, inadvertently causing a communication failure.</span><span class="sxs-lookup"><span data-stu-id="9865e-211">Over time, you, or someone in your organization, might override Azure's default rules, inadvertently causing a communication failure.</span></span> <span data-ttu-id="9865e-212">Complete the following steps to create a communication problem and then view the connection monitor again:</span><span class="sxs-lookup"><span data-stu-id="9865e-212">Complete the following steps to create a communication problem and then view the connection monitor again:</span></span>

1. <span data-ttu-id="9865e-213">In the search box at the top of the portal, enter *myResourceGroup*.</span><span class="sxs-lookup"><span data-stu-id="9865e-213">In the search box at the top of the portal, enter *myResourceGroup*.</span></span> <span data-ttu-id="9865e-214">When the **myResourceGroup** resource group appears in the search results, select it.</span><span class="sxs-lookup"><span data-stu-id="9865e-214">When the **myResourceGroup** resource group appears in the search results, select it.</span></span>
2. <span data-ttu-id="9865e-215">Select the **myVm2-nsg** network security group.</span><span class="sxs-lookup"><span data-stu-id="9865e-215">Select the **myVm2-nsg** network security group.</span></span>
3. <span data-ttu-id="9865e-216">Select **Inbound security rules**, and then select **Add**, as shown in the following picture:</span><span class="sxs-lookup"><span data-stu-id="9865e-216">Select **Inbound security rules**, and then select **Add**, as shown in the following picture:</span></span>

    ![Inbound security rules](./media/connection-monitor/inbound-security-rules.png)

4. <span data-ttu-id="9865e-218">The default rule that allows communication between all VMs in a virtual network is the rule named **AllowVnetInBound**.</span><span class="sxs-lookup"><span data-stu-id="9865e-218">The default rule that allows communication between all VMs in a virtual network is the rule named **AllowVnetInBound**.</span></span> <span data-ttu-id="9865e-219">Create a rule with a higher priority (lower number) than the **AllowVnetInBound** rule that denies inbound communication over port 22.</span><span class="sxs-lookup"><span data-stu-id="9865e-219">Create a rule with a higher priority (lower number) than the **AllowVnetInBound** rule that denies inbound communication over port 22.</span></span> <span data-ttu-id="9865e-220">Select, or enter, the following information, accept the remaining defaults, and then select **Add**:</span><span class="sxs-lookup"><span data-stu-id="9865e-220">Select, or enter, the following information, accept the remaining defaults, and then select **Add**:</span></span>

    | <span data-ttu-id="9865e-221">Setting</span><span class="sxs-lookup"><span data-stu-id="9865e-221">Setting</span></span>                 | <span data-ttu-id="9865e-222">Value</span><span class="sxs-lookup"><span data-stu-id="9865e-222">Value</span></span>          |
    | ---                     | ---            |
    | <span data-ttu-id="9865e-223">Destination port ranges</span><span class="sxs-lookup"><span data-stu-id="9865e-223">Destination port ranges</span></span> | <span data-ttu-id="9865e-224">22</span><span class="sxs-lookup"><span data-stu-id="9865e-224">22</span></span>             |
    | <span data-ttu-id="9865e-225">Action</span><span class="sxs-lookup"><span data-stu-id="9865e-225">Action</span></span>                  | <span data-ttu-id="9865e-226">Deny</span><span class="sxs-lookup"><span data-stu-id="9865e-226">Deny</span></span>           |
    | <span data-ttu-id="9865e-227">Priority</span><span class="sxs-lookup"><span data-stu-id="9865e-227">Priority</span></span>                | <span data-ttu-id="9865e-228">100</span><span class="sxs-lookup"><span data-stu-id="9865e-228">100</span></span>            |
    | <span data-ttu-id="9865e-229">Name</span><span class="sxs-lookup"><span data-stu-id="9865e-229">Name</span></span>                    | <span data-ttu-id="9865e-230">DenySshInbound</span><span class="sxs-lookup"><span data-stu-id="9865e-230">DenySshInbound</span></span> |

5. <span data-ttu-id="9865e-231">Since connection monitor probes at 60-second intervals, wait a few minutes and then on the left side of the portal, select **Network Watcher**, then **Connection monitor**, and then select the **myVm1-myVm2(22)** monitor again.</span><span class="sxs-lookup"><span data-stu-id="9865e-231">Since connection monitor probes at 60-second intervals, wait a few minutes and then on the left side of the portal, select **Network Watcher**, then **Connection monitor**, and then select the **myVm1-myVm2(22)** monitor again.</span></span> <span data-ttu-id="9865e-232">The results are different now, as shown in the following picture:</span><span class="sxs-lookup"><span data-stu-id="9865e-232">The results are different now, as shown in the following picture:</span></span>

    ![Monitor details fault](./media/connection-monitor/vm-monitor-fault.png)

    <span data-ttu-id="9865e-234">You can see that there's a red exclamation icon in the status column for the **myvm2529** network interface.</span><span class="sxs-lookup"><span data-stu-id="9865e-234">You can see that there's a red exclamation icon in the status column for the **myvm2529** network interface.</span></span>

6. <span data-ttu-id="9865e-235">To learn why the status has changed, select 10.0.0.5, in the previous picture.</span><span class="sxs-lookup"><span data-stu-id="9865e-235">To learn why the status has changed, select 10.0.0.5, in the previous picture.</span></span> <span data-ttu-id="9865e-236">Connection monitor informs you that the reason for the communication failure is: *Traffic blocked due to the following network security group rule: UserRule_DenySshInbound*.</span><span class="sxs-lookup"><span data-stu-id="9865e-236">Connection monitor informs you that the reason for the communication failure is: *Traffic blocked due to the following network security group rule: UserRule_DenySshInbound*.</span></span>

    <span data-ttu-id="9865e-237">If you didn't know that someone had implemented the security rule you created in step 4, you'd learn from connection monitor that the rule is causing the communication problem.</span><span class="sxs-lookup"><span data-stu-id="9865e-237">If you didn't know that someone had implemented the security rule you created in step 4, you'd learn from connection monitor that the rule is causing the communication problem.</span></span> <span data-ttu-id="9865e-238">You could then change, override, or remove the rule, to restore communication between the VMs.</span><span class="sxs-lookup"><span data-stu-id="9865e-238">You could then change, override, or remove the rule, to restore communication between the VMs.</span></span>

## <a name="clean-up-resources"></a><span data-ttu-id="9865e-239">Clean up resources</span><span class="sxs-lookup"><span data-stu-id="9865e-239">Clean up resources</span></span>

<span data-ttu-id="9865e-240">When no longer needed, delete the resource group and all of the resources it contains:</span><span class="sxs-lookup"><span data-stu-id="9865e-240">When no longer needed, delete the resource group and all of the resources it contains:</span></span>

1. <span data-ttu-id="9865e-241">Enter *myResourceGroup* in the **Search** box at the top of the portal.</span><span class="sxs-lookup"><span data-stu-id="9865e-241">Enter *myResourceGroup* in the **Search** box at the top of the portal.</span></span> <span data-ttu-id="9865e-242">When you see **myResourceGroup** in the search results, select it.</span><span class="sxs-lookup"><span data-stu-id="9865e-242">When you see **myResourceGroup** in the search results, select it.</span></span>
2. <span data-ttu-id="9865e-243">Select **Delete resource group**.</span><span class="sxs-lookup"><span data-stu-id="9865e-243">Select **Delete resource group**.</span></span>
3. <span data-ttu-id="9865e-244">Enter *myResourceGroup* for **TYPE THE RESOURCE GROUP NAME:** and select **Delete**.</span><span class="sxs-lookup"><span data-stu-id="9865e-244">Enter *myResourceGroup* for **TYPE THE RESOURCE GROUP NAME:** and select **Delete**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9865e-245">Next steps</span><span class="sxs-lookup"><span data-stu-id="9865e-245">Next steps</span></span>

<span data-ttu-id="9865e-246">In this tutorial, you learned how to monitor a connection between two VMs.</span><span class="sxs-lookup"><span data-stu-id="9865e-246">In this tutorial, you learned how to monitor a connection between two VMs.</span></span> <span data-ttu-id="9865e-247">You learned that a network security group rule prevented communication to a VM.</span><span class="sxs-lookup"><span data-stu-id="9865e-247">You learned that a network security group rule prevented communication to a VM.</span></span> <span data-ttu-id="9865e-248">To learn about all of the different responses connection monitor can return, see [response types](network-watcher-connectivity-overview.md#response).</span><span class="sxs-lookup"><span data-stu-id="9865e-248">To learn about all of the different responses connection monitor can return, see [response types](network-watcher-connectivity-overview.md#response).</span></span> <span data-ttu-id="9865e-249">You can also monitor a connection between a VM, a fully qualified domain name, a uniform resource identifier, or an IP address.</span><span class="sxs-lookup"><span data-stu-id="9865e-249">You can also monitor a connection between a VM, a fully qualified domain name, a uniform resource identifier, or an IP address.</span></span>

<span data-ttu-id="9865e-250">At some point, you may find that resources in a virtual network are unable to communicate with resources in other networks connected by an Azure virtual network gateway.</span><span class="sxs-lookup"><span data-stu-id="9865e-250">At some point, you may find that resources in a virtual network are unable to communicate with resources in other networks connected by an Azure virtual network gateway.</span></span> <span data-ttu-id="9865e-251">Advance to the next tutorial to learn how to diagnose a problem with a virtual network gateway.</span><span class="sxs-lookup"><span data-stu-id="9865e-251">Advance to the next tutorial to learn how to diagnose a problem with a virtual network gateway.</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="9865e-252">Diagnose communication problems between networks</span><span class="sxs-lookup"><span data-stu-id="9865e-252">Diagnose communication problems between networks</span></span>](diagnose-communication-problem-between-networks.md)
