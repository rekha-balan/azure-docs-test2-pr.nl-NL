---
title: Azure traffic analytics | Microsoft Docs
description: Learn how to analyze Azure network security group flow logs with traffic analytics.
services: network-watcher
documentationcenter: na
author: jimdial
manager: jeconnoc
editor: ''
ms.service: network-watcher
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 06/15/2018
ms.author: yagup;jdial
ms.openlocfilehash: ad26772650cf052926a2534d343f64765f47b78f
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44967739"
---
# <a name="traffic-analytics"></a><span data-ttu-id="d3afe-103">Traffic analytics</span><span class="sxs-lookup"><span data-stu-id="d3afe-103">Traffic analytics</span></span>

<span data-ttu-id="d3afe-104">Traffic analytics is a cloud-based solution that provides visibility into user and application activity in cloud networks.</span><span class="sxs-lookup"><span data-stu-id="d3afe-104">Traffic analytics is a cloud-based solution that provides visibility into user and application activity in cloud networks.</span></span> <span data-ttu-id="d3afe-105">Traffic analytics analyzes Network Watcher network security group (NSG) flow logs to provide insights into traffic flow in your Azure cloud.</span><span class="sxs-lookup"><span data-stu-id="d3afe-105">Traffic analytics analyzes Network Watcher network security group (NSG) flow logs to provide insights into traffic flow in your Azure cloud.</span></span> <span data-ttu-id="d3afe-106">With traffic analytics, you can:</span><span class="sxs-lookup"><span data-stu-id="d3afe-106">With traffic analytics, you can:</span></span>

- <span data-ttu-id="d3afe-107">Visualize network activity across your Azure subscriptions and identify hot spots.</span><span class="sxs-lookup"><span data-stu-id="d3afe-107">Visualize network activity across your Azure subscriptions and identify hot spots.</span></span>
- <span data-ttu-id="d3afe-108">Identify security threats to, and secure your network, with information such as open-ports, applications attempting internet access, and virtual machines (VM) connecting to rogue networks.</span><span class="sxs-lookup"><span data-stu-id="d3afe-108">Identify security threats to, and secure your network, with information such as open-ports, applications attempting internet access, and virtual machines (VM) connecting to rogue networks.</span></span>
- <span data-ttu-id="d3afe-109">Understand traffic flow patterns across Azure regions and the internet to optimize your network deployment for performance and capacity.</span><span class="sxs-lookup"><span data-stu-id="d3afe-109">Understand traffic flow patterns across Azure regions and the internet to optimize your network deployment for performance and capacity.</span></span>
- <span data-ttu-id="d3afe-110">Pinpoint network misconfigurations leading to failed connections in your network.</span><span class="sxs-lookup"><span data-stu-id="d3afe-110">Pinpoint network misconfigurations leading to failed connections in your network.</span></span>

## <a name="why-traffic-analytics"></a><span data-ttu-id="d3afe-111">Why traffic analytics?</span><span class="sxs-lookup"><span data-stu-id="d3afe-111">Why traffic analytics?</span></span>

<span data-ttu-id="d3afe-112">It is vital to monitor, manage, and know your own network for uncompromised security, compliance, and performance.</span><span class="sxs-lookup"><span data-stu-id="d3afe-112">It is vital to monitor, manage, and know your own network for uncompromised security, compliance, and performance.</span></span> <span data-ttu-id="d3afe-113">Knowing your own environment is of paramount importance to protect and optimize it.</span><span class="sxs-lookup"><span data-stu-id="d3afe-113">Knowing your own environment is of paramount importance to protect and optimize it.</span></span> <span data-ttu-id="d3afe-114">You often need to know the current state of the network, who is connecting, where they're connecting from, which ports are open to the internet, expected network behavior, irregular network behavior, and sudden rises in traffic.</span><span class="sxs-lookup"><span data-stu-id="d3afe-114">You often need to know the current state of the network, who is connecting, where they're connecting from, which ports are open to the internet, expected network behavior, irregular network behavior, and sudden rises in traffic.</span></span>

<span data-ttu-id="d3afe-115">Cloud networks are different than on-premises enterprise networks, where you have netflow or equivalent protocol capable routers and switches, which provide the capability to collect IP network traffic as it enters or exits a network interface.</span><span class="sxs-lookup"><span data-stu-id="d3afe-115">Cloud networks are different than on-premises enterprise networks, where you have netflow or equivalent protocol capable routers and switches, which provide the capability to collect IP network traffic as it enters or exits a network interface.</span></span> <span data-ttu-id="d3afe-116">By analyzing traffic flow data, you can build an analysis of network traffic flow and volume.</span><span class="sxs-lookup"><span data-stu-id="d3afe-116">By analyzing traffic flow data, you can build an analysis of network traffic flow and volume.</span></span>

<span data-ttu-id="d3afe-117">Azure virtual networks have NSG flow logs, which provide you information about ingress and egress IP traffic through a Network Security Group associated to individual network interfaces, VMs, or subnets.</span><span class="sxs-lookup"><span data-stu-id="d3afe-117">Azure virtual networks have NSG flow logs, which provide you information about ingress and egress IP traffic through a Network Security Group associated to individual network interfaces, VMs, or subnets.</span></span> <span data-ttu-id="d3afe-118">By analyzing raw NSG flow logs, and inserting intelligence of security, topology, and geography, traffic analytics can provide you with insights into traffic flow in your environment.</span><span class="sxs-lookup"><span data-stu-id="d3afe-118">By analyzing raw NSG flow logs, and inserting intelligence of security, topology, and geography, traffic analytics can provide you with insights into traffic flow in your environment.</span></span> <span data-ttu-id="d3afe-119">Traffic Analytics provides information such as most communicating hosts, most communicating application protocols, most conversing host pairs, allowed/blocked traffic, inbound/outbound traffic, open internet ports, most blocking rules, traffic distribution per Azure datacenter, virtual network, subnets, or, rogue networks.</span><span class="sxs-lookup"><span data-stu-id="d3afe-119">Traffic Analytics provides information such as most communicating hosts, most communicating application protocols, most conversing host pairs, allowed/blocked traffic, inbound/outbound traffic, open internet ports, most blocking rules, traffic distribution per Azure datacenter, virtual network, subnets, or, rogue networks.</span></span>

## <a name="key-components"></a><span data-ttu-id="d3afe-120">Key components</span><span class="sxs-lookup"><span data-stu-id="d3afe-120">Key components</span></span>

- <span data-ttu-id="d3afe-121">**Network security group (NSG)**: Contains a list of security rules that allow or deny network traffic to resources connected to an Azure Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="d3afe-121">**Network security group (NSG)**: Contains a list of security rules that allow or deny network traffic to resources connected to an Azure Virtual Network.</span></span> <span data-ttu-id="d3afe-122">NSGs can be associated to subnets, individual VMs (classic), or individual network interfaces (NIC) attached to VMs (Resource Manager).</span><span class="sxs-lookup"><span data-stu-id="d3afe-122">NSGs can be associated to subnets, individual VMs (classic), or individual network interfaces (NIC) attached to VMs (Resource Manager).</span></span> <span data-ttu-id="d3afe-123">For more information, see [Network security group overview](../virtual-network/security-overview.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="d3afe-123">For more information, see [Network security group overview](../virtual-network/security-overview.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json).</span></span>
- <span data-ttu-id="d3afe-124">**Network security group (NSG) flow logs**: Allow you to view information about ingress and egress IP traffic through a network security group.</span><span class="sxs-lookup"><span data-stu-id="d3afe-124">**Network security group (NSG) flow logs**: Allow you to view information about ingress and egress IP traffic through a network security group.</span></span> <span data-ttu-id="d3afe-125">NSG flow logs are written in json format and show outbound and inbound flows on a per rule basis, the NIC the flow applies to, five-tuple information about the flow (source/destination IP address, source/destination port, and protocol), and if the traffic was allowed or denied.</span><span class="sxs-lookup"><span data-stu-id="d3afe-125">NSG flow logs are written in json format and show outbound and inbound flows on a per rule basis, the NIC the flow applies to, five-tuple information about the flow (source/destination IP address, source/destination port, and protocol), and if the traffic was allowed or denied.</span></span> <span data-ttu-id="d3afe-126">For more information about NSG flow logs, see [NSG flow logs](network-watcher-nsg-flow-logging-overview.md).</span><span class="sxs-lookup"><span data-stu-id="d3afe-126">For more information about NSG flow logs, see [NSG flow logs](network-watcher-nsg-flow-logging-overview.md).</span></span>
- <span data-ttu-id="d3afe-127">**Log Analytics**: An Azure service that collects monitoring data and stores the data in a central repository.</span><span class="sxs-lookup"><span data-stu-id="d3afe-127">**Log Analytics**: An Azure service that collects monitoring data and stores the data in a central repository.</span></span> <span data-ttu-id="d3afe-128">This data can include events, performance data, or custom data provided through the Azure API.</span><span class="sxs-lookup"><span data-stu-id="d3afe-128">This data can include events, performance data, or custom data provided through the Azure API.</span></span> <span data-ttu-id="d3afe-129">Once collected, the data is available for alerting, analysis, and export.</span><span class="sxs-lookup"><span data-stu-id="d3afe-129">Once collected, the data is available for alerting, analysis, and export.</span></span> <span data-ttu-id="d3afe-130">Monitoring applications such as network performance monitor and traffic analytics are built using Log Analytics as a foundation.</span><span class="sxs-lookup"><span data-stu-id="d3afe-130">Monitoring applications such as network performance monitor and traffic analytics are built using Log Analytics as a foundation.</span></span> <span data-ttu-id="d3afe-131">For more information, see [Log analytics](../log-analytics/log-analytics-overview.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="d3afe-131">For more information, see [Log analytics](../log-analytics/log-analytics-overview.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json).</span></span>
- <span data-ttu-id="d3afe-132">**Log analytics workspace**: An instance of log analytics, where the data pertaining to an Azure account, is stored.</span><span class="sxs-lookup"><span data-stu-id="d3afe-132">**Log analytics workspace**: An instance of log analytics, where the data pertaining to an Azure account, is stored.</span></span> <span data-ttu-id="d3afe-133">For more information about log analytics workspaces, see [Create a Log Analytics workspace](../log-analytics/log-analytics-quick-create-workspace.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="d3afe-133">For more information about log analytics workspaces, see [Create a Log Analytics workspace](../log-analytics/log-analytics-quick-create-workspace.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json).</span></span>
- <span data-ttu-id="d3afe-134">**Network Watcher**: A regional service that enables you to monitor and diagnose conditions at a network scenario level in Azure.</span><span class="sxs-lookup"><span data-stu-id="d3afe-134">**Network Watcher**: A regional service that enables you to monitor and diagnose conditions at a network scenario level in Azure.</span></span> <span data-ttu-id="d3afe-135">You can turn NSG flow logs on and off with Network Watcher.</span><span class="sxs-lookup"><span data-stu-id="d3afe-135">You can turn NSG flow logs on and off with Network Watcher.</span></span> <span data-ttu-id="d3afe-136">For more information, see [Network Watcher](network-watcher-monitoring-overview.md).</span><span class="sxs-lookup"><span data-stu-id="d3afe-136">For more information, see [Network Watcher](network-watcher-monitoring-overview.md).</span></span>

## <a name="how-traffic-analytics-works"></a><span data-ttu-id="d3afe-137">How traffic analytics works</span><span class="sxs-lookup"><span data-stu-id="d3afe-137">How traffic analytics works</span></span>

<span data-ttu-id="d3afe-138">Traffic analytics examines the raw NSG flow logs and captures reduced logs by aggregating common flows among the same source IP address, destination IP address, destination port, and protocol.</span><span class="sxs-lookup"><span data-stu-id="d3afe-138">Traffic analytics examines the raw NSG flow logs and captures reduced logs by aggregating common flows among the same source IP address, destination IP address, destination port, and protocol.</span></span> <span data-ttu-id="d3afe-139">For example, Host 1 (IP address: 10.10.10.10) communicating to Host 2 (IP address: 10.10.20.10), 100 times over a period of 1 hour using port (for example, 80) and protocol (for example, http).</span><span class="sxs-lookup"><span data-stu-id="d3afe-139">For example, Host 1 (IP address: 10.10.10.10) communicating to Host 2 (IP address: 10.10.20.10), 100 times over a period of 1 hour using port (for example, 80) and protocol (for example, http).</span></span> <span data-ttu-id="d3afe-140">The reduced log has one entry, that Host 1 & Host 2 communicated 100 times over a period of 1 hour using port *80* and protocol *HTTP*, instead of having 100 entries.</span><span class="sxs-lookup"><span data-stu-id="d3afe-140">The reduced log has one entry, that Host 1 & Host 2 communicated 100 times over a period of 1 hour using port *80* and protocol *HTTP*, instead of having 100 entries.</span></span> <span data-ttu-id="d3afe-141">Reduced logs are enhanced with geography, security, and topology information, and then stored in a log analytics workspace.</span><span class="sxs-lookup"><span data-stu-id="d3afe-141">Reduced logs are enhanced with geography, security, and topology information, and then stored in a log analytics workspace.</span></span> <span data-ttu-id="d3afe-142">The following picture shows the data flow:</span><span class="sxs-lookup"><span data-stu-id="d3afe-142">The following picture shows the data flow:</span></span>

![Data flow for NSG flow logs processing](./media/traffic-analytics/data-flow-for-nsg-flow-log-processing.png)

## <a name="supported-regions"></a><span data-ttu-id="d3afe-144">Supported regions</span><span class="sxs-lookup"><span data-stu-id="d3afe-144">Supported regions</span></span>

<span data-ttu-id="d3afe-145">You can use traffic analytics for NSGs in any of the following regions: West Central US, East US, East US 2, North Central US, South Central US, Central US, West US, West US-2, West Europe, North Europe, West UK, South UK, Australia East, Australia Southeast, and Southeast Asia.</span><span class="sxs-lookup"><span data-stu-id="d3afe-145">You can use traffic analytics for NSGs in any of the following regions: West Central US, East US, East US 2, North Central US, South Central US, Central US, West US, West US-2, West Europe, North Europe, West UK, South UK, Australia East, Australia Southeast, and Southeast Asia.</span></span> <span data-ttu-id="d3afe-146">The log analytics workspace must exist in the West Central US, East US, West Europe, South UK, Australia Southeast, or the Southeast Asia region.</span><span class="sxs-lookup"><span data-stu-id="d3afe-146">The log analytics workspace must exist in the West Central US, East US, West Europe, South UK, Australia Southeast, or the Southeast Asia region.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="d3afe-147">Prerequisites</span><span class="sxs-lookup"><span data-stu-id="d3afe-147">Prerequisites</span></span>

### <a name="user-access-requirements"></a><span data-ttu-id="d3afe-148">User access requirements</span><span class="sxs-lookup"><span data-stu-id="d3afe-148">User access requirements</span></span>

<span data-ttu-id="d3afe-149">Your account must be a member of one of the following Azure [built-in roles](../role-based-access-control/built-in-roles.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json):</span><span class="sxs-lookup"><span data-stu-id="d3afe-149">Your account must be a member of one of the following Azure [built-in roles](../role-based-access-control/built-in-roles.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json):</span></span>

|<span data-ttu-id="d3afe-150">Deployment model</span><span class="sxs-lookup"><span data-stu-id="d3afe-150">Deployment model</span></span>   | <span data-ttu-id="d3afe-151">Role</span><span class="sxs-lookup"><span data-stu-id="d3afe-151">Role</span></span>                   |
|---------          |---------               |
|<span data-ttu-id="d3afe-152">Resource Manager</span><span class="sxs-lookup"><span data-stu-id="d3afe-152">Resource Manager</span></span>   | <span data-ttu-id="d3afe-153">Owner</span><span class="sxs-lookup"><span data-stu-id="d3afe-153">Owner</span></span>                  |
|                   | <span data-ttu-id="d3afe-154">Contributor</span><span class="sxs-lookup"><span data-stu-id="d3afe-154">Contributor</span></span>            |
|                   | <span data-ttu-id="d3afe-155">Reader</span><span class="sxs-lookup"><span data-stu-id="d3afe-155">Reader</span></span>                 |
|                   | <span data-ttu-id="d3afe-156">Network Contributor</span><span class="sxs-lookup"><span data-stu-id="d3afe-156">Network Contributor</span></span>    |
|<span data-ttu-id="d3afe-157">Classic</span><span class="sxs-lookup"><span data-stu-id="d3afe-157">Classic</span></span>            | <span data-ttu-id="d3afe-158">Account administrator</span><span class="sxs-lookup"><span data-stu-id="d3afe-158">Account administrator</span></span>  |
|                   | <span data-ttu-id="d3afe-159">Service administrator</span><span class="sxs-lookup"><span data-stu-id="d3afe-159">Service administrator</span></span>  |
|                   | <span data-ttu-id="d3afe-160">Co-administrator</span><span class="sxs-lookup"><span data-stu-id="d3afe-160">Co-administrator</span></span>       |

<span data-ttu-id="d3afe-161">If your account is not assigned to one of the built-in roles, it must be assigned to a [custom role](../role-based-access-control/custom-roles.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json) that is assigned the following actions, at the subscription level:</span><span class="sxs-lookup"><span data-stu-id="d3afe-161">If your account is not assigned to one of the built-in roles, it must be assigned to a [custom role](../role-based-access-control/custom-roles.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json) that is assigned the following actions, at the subscription level:</span></span>

- <span data-ttu-id="d3afe-162">"Microsoft.Network/applicationGateways/read"</span><span class="sxs-lookup"><span data-stu-id="d3afe-162">"Microsoft.Network/applicationGateways/read"</span></span>
- <span data-ttu-id="d3afe-163">"Microsoft.Network/connections/read"</span><span class="sxs-lookup"><span data-stu-id="d3afe-163">"Microsoft.Network/connections/read"</span></span>
- <span data-ttu-id="d3afe-164">"Microsoft.Network/loadBalancers/read"</span><span class="sxs-lookup"><span data-stu-id="d3afe-164">"Microsoft.Network/loadBalancers/read"</span></span>
- <span data-ttu-id="d3afe-165">"Microsoft.Network/localNetworkGateways/read"</span><span class="sxs-lookup"><span data-stu-id="d3afe-165">"Microsoft.Network/localNetworkGateways/read"</span></span>
- <span data-ttu-id="d3afe-166">"Microsoft.Network/networkInterfaces/read"</span><span class="sxs-lookup"><span data-stu-id="d3afe-166">"Microsoft.Network/networkInterfaces/read"</span></span>
- <span data-ttu-id="d3afe-167">"Microsoft.Network/networkSecurityGroups/read"</span><span class="sxs-lookup"><span data-stu-id="d3afe-167">"Microsoft.Network/networkSecurityGroups/read"</span></span>
- <span data-ttu-id="d3afe-168">"Microsoft.Network/publicIPAddresses/read"</span><span class="sxs-lookup"><span data-stu-id="d3afe-168">"Microsoft.Network/publicIPAddresses/read"</span></span>
- <span data-ttu-id="d3afe-169">"Microsoft.Network/routeTables/read"</span><span class="sxs-lookup"><span data-stu-id="d3afe-169">"Microsoft.Network/routeTables/read"</span></span>
- <span data-ttu-id="d3afe-170">"Microsoft.Network/virtualNetworkGateways/read"</span><span class="sxs-lookup"><span data-stu-id="d3afe-170">"Microsoft.Network/virtualNetworkGateways/read"</span></span>
- <span data-ttu-id="d3afe-171">"Microsoft.Network/virtualNetworks/read"</span><span class="sxs-lookup"><span data-stu-id="d3afe-171">"Microsoft.Network/virtualNetworks/read"</span></span>

<span data-ttu-id="d3afe-172">For information on how to check user access permissions, see [Traffic analytics FAQ](traffic-analytics-faq.md).</span><span class="sxs-lookup"><span data-stu-id="d3afe-172">For information on how to check user access permissions, see [Traffic analytics FAQ](traffic-analytics-faq.md).</span></span>

### <a name="enable-network-watcher"></a><span data-ttu-id="d3afe-173">Enable Network Watcher</span><span class="sxs-lookup"><span data-stu-id="d3afe-173">Enable Network Watcher</span></span>

<span data-ttu-id="d3afe-174">To analyze traffic, you need to have an existing network watcher, or [enable a network watcher](network-watcher-create.md) in each region that you have NSGs that you want to analyze traffic for.</span><span class="sxs-lookup"><span data-stu-id="d3afe-174">To analyze traffic, you need to have an existing network watcher, or [enable a network watcher](network-watcher-create.md) in each region that you have NSGs that you want to analyze traffic for.</span></span> <span data-ttu-id="d3afe-175">Traffic analytics can be enabled for NSGs hosted in any of the [supported regions](#supported-regions).</span><span class="sxs-lookup"><span data-stu-id="d3afe-175">Traffic analytics can be enabled for NSGs hosted in any of the [supported regions](#supported-regions).</span></span>

### <a name="re-register-the-network-resource-provider"></a><span data-ttu-id="d3afe-176">Re-register the network resource provider</span><span class="sxs-lookup"><span data-stu-id="d3afe-176">Re-register the network resource provider</span></span>

<span data-ttu-id="d3afe-177">Before you can use traffic analytics, you must re-register your network resource provider.</span><span class="sxs-lookup"><span data-stu-id="d3afe-177">Before you can use traffic analytics, you must re-register your network resource provider.</span></span> <span data-ttu-id="d3afe-178">Click **Try It** in the following code box to open the Azure Cloud Shell.</span><span class="sxs-lookup"><span data-stu-id="d3afe-178">Click **Try It** in the following code box to open the Azure Cloud Shell.</span></span> <span data-ttu-id="d3afe-179">The Cloud Shell automatically logs you into to your Azure subscription.</span><span class="sxs-lookup"><span data-stu-id="d3afe-179">The Cloud Shell automatically logs you into to your Azure subscription.</span></span> <span data-ttu-id="d3afe-180">Once the Cloud Shell is open, enter the following command to re-register the network resource provider:</span><span class="sxs-lookup"><span data-stu-id="d3afe-180">Once the Cloud Shell is open, enter the following command to re-register the network resource provider:</span></span>

```azurepowershell-interactive
Register-AzureRmResourceProvider -ProviderNamespace "Microsoft.Network"
```

### <a name="select-a-network-security-group"></a><span data-ttu-id="d3afe-181">Select a network security group</span><span class="sxs-lookup"><span data-stu-id="d3afe-181">Select a network security group</span></span>

<span data-ttu-id="d3afe-182">Before enabling NSG flow logging, you must have a network security group to log flows for.</span><span class="sxs-lookup"><span data-stu-id="d3afe-182">Before enabling NSG flow logging, you must have a network security group to log flows for.</span></span> <span data-ttu-id="d3afe-183">If you don't have a network security group, see [Create a network security group](../virtual-network/manage-network-security-group.md#create-a-network-security-group) to create one.</span><span class="sxs-lookup"><span data-stu-id="d3afe-183">If you don't have a network security group, see [Create a network security group](../virtual-network/manage-network-security-group.md#create-a-network-security-group) to create one.</span></span>

<span data-ttu-id="d3afe-184">On the left side of the Azure portal, select **Monitor**, then **Network watcher**, and then select **NSG flow logs**.</span><span class="sxs-lookup"><span data-stu-id="d3afe-184">On the left side of the Azure portal, select **Monitor**, then **Network watcher**, and then select **NSG flow logs**.</span></span> <span data-ttu-id="d3afe-185">Select the network security group that you want to enable an NSG flow log for, as shown in the following picture:</span><span class="sxs-lookup"><span data-stu-id="d3afe-185">Select the network security group that you want to enable an NSG flow log for, as shown in the following picture:</span></span>

![Selection of NSGs that require enablement of NSG flow log](./media/traffic-analytics/selection-of-nsgs-that-require-enablement-of-nsg-flow-logging.png)

<span data-ttu-id="d3afe-187">If you try to enable traffic analytics for an NSG that is hosted in any region other than the [supported regions](#supported-regions), you receive a "Not found" error.</span><span class="sxs-lookup"><span data-stu-id="d3afe-187">If you try to enable traffic analytics for an NSG that is hosted in any region other than the [supported regions](#supported-regions), you receive a "Not found" error.</span></span>

## <a name="enable-flow-log-settings"></a><span data-ttu-id="d3afe-188">Enable flow log settings</span><span class="sxs-lookup"><span data-stu-id="d3afe-188">Enable flow log settings</span></span>

<span data-ttu-id="d3afe-189">Before enabling flow log settings, you must complete the following tasks:</span><span class="sxs-lookup"><span data-stu-id="d3afe-189">Before enabling flow log settings, you must complete the following tasks:</span></span>

<span data-ttu-id="d3afe-190">Register the Azure Insights provider, if it's not already registered for your subscription:</span><span class="sxs-lookup"><span data-stu-id="d3afe-190">Register the Azure Insights provider, if it's not already registered for your subscription:</span></span>

```azurepowershell-interactive
Register-AzureRmResourceProvider -ProviderNamespace Microsoft.Insights
```

<span data-ttu-id="d3afe-191">If you don't already have an Azure Storage account to store NSG flow logs in, you must create a storage account.</span><span class="sxs-lookup"><span data-stu-id="d3afe-191">If you don't already have an Azure Storage account to store NSG flow logs in, you must create a storage account.</span></span> <span data-ttu-id="d3afe-192">You can create a storage account with the command that follows.</span><span class="sxs-lookup"><span data-stu-id="d3afe-192">You can create a storage account with the command that follows.</span></span> <span data-ttu-id="d3afe-193">Before running the command, replace `<replace-with-your-unique-storage-account-name>` with a name that is unique across all Azure locations, between 3-24 characters in length, using only numbers and lower-case letters.</span><span class="sxs-lookup"><span data-stu-id="d3afe-193">Before running the command, replace `<replace-with-your-unique-storage-account-name>` with a name that is unique across all Azure locations, between 3-24 characters in length, using only numbers and lower-case letters.</span></span> <span data-ttu-id="d3afe-194">You can also change the resource group name, if necessary.</span><span class="sxs-lookup"><span data-stu-id="d3afe-194">You can also change the resource group name, if necessary.</span></span>

```azurepowershell-interactive
New-AzureRmStorageAccount `
  -Location westcentralus `
  -Name <replace-with-your-unique-storage-account-name> `
  -ResourceGroupName myResourceGroup `
  -SkuName Standard_LRS `
  -Kind StorageV2
```

<span data-ttu-id="d3afe-195">Select the following options, as shown in the picture:</span><span class="sxs-lookup"><span data-stu-id="d3afe-195">Select the following options, as shown in the picture:</span></span>

1. <span data-ttu-id="d3afe-196">Select *On* for **Status**</span><span class="sxs-lookup"><span data-stu-id="d3afe-196">Select *On* for **Status**</span></span>
2. <span data-ttu-id="d3afe-197">Select an existing storage account to store the flow logs in.</span><span class="sxs-lookup"><span data-stu-id="d3afe-197">Select an existing storage account to store the flow logs in.</span></span> <span data-ttu-id="d3afe-198">If you want to store the data forever, set the value to *0*.</span><span class="sxs-lookup"><span data-stu-id="d3afe-198">If you want to store the data forever, set the value to *0*.</span></span> <span data-ttu-id="d3afe-199">You incur Azure Storage fees for the storage account.</span><span class="sxs-lookup"><span data-stu-id="d3afe-199">You incur Azure Storage fees for the storage account.</span></span>
3. <span data-ttu-id="d3afe-200">Set **Retention** to the number of days you want to store data for.</span><span class="sxs-lookup"><span data-stu-id="d3afe-200">Set **Retention** to the number of days you want to store data for.</span></span>
4. <span data-ttu-id="d3afe-201">Select *On* for **Traffic Analytics Status**.</span><span class="sxs-lookup"><span data-stu-id="d3afe-201">Select *On* for **Traffic Analytics Status**.</span></span>
5. <span data-ttu-id="d3afe-202">Select an existing Log Analytics (OMS) Workspace, or select **Create New Workspace** to create a new one.</span><span class="sxs-lookup"><span data-stu-id="d3afe-202">Select an existing Log Analytics (OMS) Workspace, or select **Create New Workspace** to create a new one.</span></span> <span data-ttu-id="d3afe-203">A Log Analytics workspace is used by Traffic Analytics  to store the aggregated and indexed data that is then used to generate the analytics.</span><span class="sxs-lookup"><span data-stu-id="d3afe-203">A Log Analytics workspace is used by Traffic Analytics  to store the aggregated and indexed data that is then used to generate the analytics.</span></span> <span data-ttu-id="d3afe-204">If you select an existing workspace, it must exist in one of the [supported regions](#traffic-analytics-supported-regions) and have been upgraded to the new query language.</span><span class="sxs-lookup"><span data-stu-id="d3afe-204">If you select an existing workspace, it must exist in one of the [supported regions](#traffic-analytics-supported-regions) and have been upgraded to the new query language.</span></span> <span data-ttu-id="d3afe-205">If you do not wish to upgrade an existing workspace, or do not have a workspace in a supported region, create a new one.</span><span class="sxs-lookup"><span data-stu-id="d3afe-205">If you do not wish to upgrade an existing workspace, or do not have a workspace in a supported region, create a new one.</span></span> <span data-ttu-id="d3afe-206">For more information about query languages, see [Azure Log Analytics upgrade to new log search](../log-analytics/log-analytics-log-search-upgrade.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="d3afe-206">For more information about query languages, see [Azure Log Analytics upgrade to new log search](../log-analytics/log-analytics-log-search-upgrade.md?toc=%2fazure%2fnetwork-watcher%2ftoc.json).</span></span>

    <span data-ttu-id="d3afe-207">The log analytics workspace hosting the traffic analytics solution and the NSGs do not have to be in the same region.</span><span class="sxs-lookup"><span data-stu-id="d3afe-207">The log analytics workspace hosting the traffic analytics solution and the NSGs do not have to be in the same region.</span></span> <span data-ttu-id="d3afe-208">For example, you may have traffic analytics in a workspace in the West Europe region, while you may have NSGs in East US and West US.</span><span class="sxs-lookup"><span data-stu-id="d3afe-208">For example, you may have traffic analytics in a workspace in the West Europe region, while you may have NSGs in East US and West US.</span></span> <span data-ttu-id="d3afe-209">Multiple NSGs can be configured in the same workspace.</span><span class="sxs-lookup"><span data-stu-id="d3afe-209">Multiple NSGs can be configured in the same workspace.</span></span>
6. <span data-ttu-id="d3afe-210">Select **Save**.</span><span class="sxs-lookup"><span data-stu-id="d3afe-210">Select **Save**.</span></span>

    ![Selection of storage account, Log Analytics workspace, and Traffic Analytics enablement](./media/traffic-analytics/selection-of-storage-account-log-analytics-workspace-and-traffic-analytics-enablement.png)

<span data-ttu-id="d3afe-212">Repeat the previous steps for any other NSGs for which you wish to enable traffic analytics for.</span><span class="sxs-lookup"><span data-stu-id="d3afe-212">Repeat the previous steps for any other NSGs for which you wish to enable traffic analytics for.</span></span> <span data-ttu-id="d3afe-213">Data from flow logs is sent to the workspace, so ensure that the local laws and regulations in your country permit data storage in the region where the workspace exists.</span><span class="sxs-lookup"><span data-stu-id="d3afe-213">Data from flow logs is sent to the workspace, so ensure that the local laws and regulations in your country permit data storage in the region where the workspace exists.</span></span>

<span data-ttu-id="d3afe-214">You can also configure traffic analytics using the [Set-AzureRmNetworkWatcherConfigFlowLog](/powershell/module/azurerm.network/set-azurermnetworkwatcherconfigflowlog) PowerShell cmdlet in AzureRm PowerShell module version 6.2.1 or later.</span><span class="sxs-lookup"><span data-stu-id="d3afe-214">You can also configure traffic analytics using the [Set-AzureRmNetworkWatcherConfigFlowLog](/powershell/module/azurerm.network/set-azurermnetworkwatcherconfigflowlog) PowerShell cmdlet in AzureRm PowerShell module version 6.2.1 or later.</span></span> <span data-ttu-id="d3afe-215">Run `Get-Module -ListAvailable AzureRM` to find your installed version.</span><span class="sxs-lookup"><span data-stu-id="d3afe-215">Run `Get-Module -ListAvailable AzureRM` to find your installed version.</span></span> <span data-ttu-id="d3afe-216">If you need to upgrade, see [Install Azure PowerShell module](/powershell/azure/install-azurerm-ps).</span><span class="sxs-lookup"><span data-stu-id="d3afe-216">If you need to upgrade, see [Install Azure PowerShell module](/powershell/azure/install-azurerm-ps).</span></span>

## <a name="view-traffic-analytics"></a><span data-ttu-id="d3afe-217">View traffic analytics</span><span class="sxs-lookup"><span data-stu-id="d3afe-217">View traffic analytics</span></span>

<span data-ttu-id="d3afe-218">On the left-side of the portal, select **All services**, then enter *Monitor* in the **Filter** box.</span><span class="sxs-lookup"><span data-stu-id="d3afe-218">On the left-side of the portal, select **All services**, then enter *Monitor* in the **Filter** box.</span></span> <span data-ttu-id="d3afe-219">When **Monitor** appears in the search results, select it.</span><span class="sxs-lookup"><span data-stu-id="d3afe-219">When **Monitor** appears in the search results, select it.</span></span> <span data-ttu-id="d3afe-220">To start exploring traffic analytics and its capabilities, select **Network watcher**, then **Traffic Analytics**.</span><span class="sxs-lookup"><span data-stu-id="d3afe-220">To start exploring traffic analytics and its capabilities, select **Network watcher**, then **Traffic Analytics**.</span></span>

![Accessing the Traffic Analytics dashboard](./media/traffic-analytics/accessing-the-traffic-analytics-dashboard.png)

<span data-ttu-id="d3afe-222">The dashboard may take up to 30 minutes to appear the first time because Traffic Analytics must first aggregate enough data for it to derive meaningful insights, before it can generate any reports.</span><span class="sxs-lookup"><span data-stu-id="d3afe-222">The dashboard may take up to 30 minutes to appear the first time because Traffic Analytics must first aggregate enough data for it to derive meaningful insights, before it can generate any reports.</span></span>

## <a name="usage-scenarios"></a><span data-ttu-id="d3afe-223">Usage scenarios</span><span class="sxs-lookup"><span data-stu-id="d3afe-223">Usage scenarios</span></span>

<span data-ttu-id="d3afe-224">Some of the insights you might want to gain after Traffic Analytics is fully configured, are as follows:</span><span class="sxs-lookup"><span data-stu-id="d3afe-224">Some of the insights you might want to gain after Traffic Analytics is fully configured, are as follows:</span></span>

### <a name="find-traffic-hotspots"></a><span data-ttu-id="d3afe-225">Find traffic hotspots</span><span class="sxs-lookup"><span data-stu-id="d3afe-225">Find traffic hotspots</span></span>

<span data-ttu-id="d3afe-226">**Look for**</span><span class="sxs-lookup"><span data-stu-id="d3afe-226">**Look for**</span></span>

- <span data-ttu-id="d3afe-227">Which hosts, subnets, and virtual networks are sending or receiving the most traffic, traversing maximum malicious traffic and blocking significant flows?</span><span class="sxs-lookup"><span data-stu-id="d3afe-227">Which hosts, subnets, and virtual networks are sending or receiving the most traffic, traversing maximum malicious traffic and blocking significant flows?</span></span>
    - <span data-ttu-id="d3afe-228">Check comparative chart for host, subnet, and virtual network.</span><span class="sxs-lookup"><span data-stu-id="d3afe-228">Check comparative chart for host, subnet, and virtual network.</span></span> <span data-ttu-id="d3afe-229">Understanding which hosts, subnets, and virtual networks are sending or receiving the most traffic can help you identify the hosts that are processing the most traffic, and whether the traffic distribution is done properly.</span><span class="sxs-lookup"><span data-stu-id="d3afe-229">Understanding which hosts, subnets, and virtual networks are sending or receiving the most traffic can help you identify the hosts that are processing the most traffic, and whether the traffic distribution is done properly.</span></span>
    - <span data-ttu-id="d3afe-230">You can evaluate if the volume of traffic is appropriate for a host.</span><span class="sxs-lookup"><span data-stu-id="d3afe-230">You can evaluate if the volume of traffic is appropriate for a host.</span></span> <span data-ttu-id="d3afe-231">Is the volume of traffic normal behavior, or does it merit further investigation?</span><span class="sxs-lookup"><span data-stu-id="d3afe-231">Is the volume of traffic normal behavior, or does it merit further investigation?</span></span>
- <span data-ttu-id="d3afe-232">How much inbound/outbound traffic is there?</span><span class="sxs-lookup"><span data-stu-id="d3afe-232">How much inbound/outbound traffic is there?</span></span>
    -   <span data-ttu-id="d3afe-233">Is the host expected to receive more inbound traffic than outbound, or vice-versa?</span><span class="sxs-lookup"><span data-stu-id="d3afe-233">Is the host expected to receive more inbound traffic than outbound, or vice-versa?</span></span>
- <span data-ttu-id="d3afe-234">Statistics of blocked traffic.</span><span class="sxs-lookup"><span data-stu-id="d3afe-234">Statistics of blocked traffic.</span></span>
    - <span data-ttu-id="d3afe-235">Why is a host blocking a significant volume of benign traffic?</span><span class="sxs-lookup"><span data-stu-id="d3afe-235">Why is a host blocking a significant volume of benign traffic?</span></span> <span data-ttu-id="d3afe-236">This behavior requires further investigation and probably optimization of configuration</span><span class="sxs-lookup"><span data-stu-id="d3afe-236">This behavior requires further investigation and probably optimization of configuration</span></span>
- <span data-ttu-id="d3afe-237">Statistics of malicious allowed/blocked traffic</span><span class="sxs-lookup"><span data-stu-id="d3afe-237">Statistics of malicious allowed/blocked traffic</span></span>
    - <span data-ttu-id="d3afe-238">Why is a host receiving malicious traffic and why flows from malicious source is allowed?</span><span class="sxs-lookup"><span data-stu-id="d3afe-238">Why is a host receiving malicious traffic and why flows from malicious source is allowed?</span></span> <span data-ttu-id="d3afe-239">This behavior requires further investigation and probably optimization of configuration.</span><span class="sxs-lookup"><span data-stu-id="d3afe-239">This behavior requires further investigation and probably optimization of configuration.</span></span>

    <span data-ttu-id="d3afe-240">Select **See all**, under **Host**, as shown in the following picture:</span><span class="sxs-lookup"><span data-stu-id="d3afe-240">Select **See all**, under **Host**, as shown in the following picture:</span></span>

    ![Dashboard showcasing host with most traffic details](media/traffic-analytics/dashboard-showcasing-host-with-most-traffic-details.png)

- <span data-ttu-id="d3afe-242">The following picture shows time trending for the top five talking hosts and the flow-related details (allowed – inbound/outbound and denied - inbound/outbound flows) for a host:</span><span class="sxs-lookup"><span data-stu-id="d3afe-242">The following picture shows time trending for the top five talking hosts and the flow-related details (allowed – inbound/outbound and denied - inbound/outbound flows) for a host:</span></span>

    ![Top five most-talking host trend](media/traffic-analytics/top-five-most-talking-host-trend.png)

<span data-ttu-id="d3afe-244">**Look for**</span><span class="sxs-lookup"><span data-stu-id="d3afe-244">**Look for**</span></span>

- <span data-ttu-id="d3afe-245">Which are the most conversing host pairs?</span><span class="sxs-lookup"><span data-stu-id="d3afe-245">Which are the most conversing host pairs?</span></span>
    - <span data-ttu-id="d3afe-246">Expected behavior like front-end or back-end communication or irregular behavior, like back-end internet traffic.</span><span class="sxs-lookup"><span data-stu-id="d3afe-246">Expected behavior like front-end or back-end communication or irregular behavior, like back-end internet traffic.</span></span>
- <span data-ttu-id="d3afe-247">Statistics of allowed/blocked traffic</span><span class="sxs-lookup"><span data-stu-id="d3afe-247">Statistics of allowed/blocked traffic</span></span>
    - <span data-ttu-id="d3afe-248">Why a host is allowing or blocking significant traffic volume</span><span class="sxs-lookup"><span data-stu-id="d3afe-248">Why a host is allowing or blocking significant traffic volume</span></span>
- <span data-ttu-id="d3afe-249">Most frequently used application protocol among most conversing host pairs:</span><span class="sxs-lookup"><span data-stu-id="d3afe-249">Most frequently used application protocol among most conversing host pairs:</span></span>
    - <span data-ttu-id="d3afe-250">Are these applications allowed on this network?</span><span class="sxs-lookup"><span data-stu-id="d3afe-250">Are these applications allowed on this network?</span></span>
    - <span data-ttu-id="d3afe-251">Are the applications configured properly?</span><span class="sxs-lookup"><span data-stu-id="d3afe-251">Are the applications configured properly?</span></span> <span data-ttu-id="d3afe-252">Are they using the appropriate protocol for communication?</span><span class="sxs-lookup"><span data-stu-id="d3afe-252">Are they using the appropriate protocol for communication?</span></span> <span data-ttu-id="d3afe-253">Select **See all** under **Frequent conversation**, as show in the following picture:</span><span class="sxs-lookup"><span data-stu-id="d3afe-253">Select **See all** under **Frequent conversation**, as show in the following picture:</span></span>

        ![Dashboard showcasing most frequent conversation](./media/traffic-analytics/dashboard-showcasing-most-frequent-conversation.png)

- <span data-ttu-id="d3afe-255">The following picture shows time trending for the top five conversations and the flow-related details such as allowed and denied inbound and outbound flows for a conversation pair:</span><span class="sxs-lookup"><span data-stu-id="d3afe-255">The following picture shows time trending for the top five conversations and the flow-related details such as allowed and denied inbound and outbound flows for a conversation pair:</span></span>

    ![Top five chatty conversation details and trend](./media/traffic-analytics/top-five-chatty-conversation-details-and-trend.png)

<span data-ttu-id="d3afe-257">**Look for**</span><span class="sxs-lookup"><span data-stu-id="d3afe-257">**Look for**</span></span>

- <span data-ttu-id="d3afe-258">Which application protocol is most used in your environment, and which conversing host pairs are using the application protocol the most?</span><span class="sxs-lookup"><span data-stu-id="d3afe-258">Which application protocol is most used in your environment, and which conversing host pairs are using the application protocol the most?</span></span>
    - <span data-ttu-id="d3afe-259">Are these applications allowed on this network?</span><span class="sxs-lookup"><span data-stu-id="d3afe-259">Are these applications allowed on this network?</span></span>
    - <span data-ttu-id="d3afe-260">Are the applications configured properly?</span><span class="sxs-lookup"><span data-stu-id="d3afe-260">Are the applications configured properly?</span></span> <span data-ttu-id="d3afe-261">Are they using the appropriate protocol for communication?</span><span class="sxs-lookup"><span data-stu-id="d3afe-261">Are they using the appropriate protocol for communication?</span></span> <span data-ttu-id="d3afe-262">Expected behavior is common ports such as 80 and 443.</span><span class="sxs-lookup"><span data-stu-id="d3afe-262">Expected behavior is common ports such as 80 and 443.</span></span> <span data-ttu-id="d3afe-263">For standard communication, if any unusual ports are displayed, they might require a configuration change.</span><span class="sxs-lookup"><span data-stu-id="d3afe-263">For standard communication, if any unusual ports are displayed, they might require a configuration change.</span></span> <span data-ttu-id="d3afe-264">Select **See all** under **Application port**, in the following picture:</span><span class="sxs-lookup"><span data-stu-id="d3afe-264">Select **See all** under **Application port**, in the following picture:</span></span>

        ![Dashboard showcasing top application protocols](./media/traffic-analytics/dashboard-showcasing-top-application-protocols.png)

- <span data-ttu-id="d3afe-266">The following pictures show time trending for the top five L7 protocols and the flow-related details (for example, allowed and denied flows) for an L7 protocol:</span><span class="sxs-lookup"><span data-stu-id="d3afe-266">The following pictures show time trending for the top five L7 protocols and the flow-related details (for example, allowed and denied flows) for an L7 protocol:</span></span>

    ![Top five layer 7 protocols details and trend](./media/traffic-analytics/top-five-layer-seven-protocols-details-and-trend.png)

    ![Flow details for application protocol in log search](./media/traffic-analytics/flow-details-for-application-protocol-in-log-search.png)

<span data-ttu-id="d3afe-269">**Look for**</span><span class="sxs-lookup"><span data-stu-id="d3afe-269">**Look for**</span></span>

- <span data-ttu-id="d3afe-270">Capacity utilization trends of a VPN gateway in your environment.</span><span class="sxs-lookup"><span data-stu-id="d3afe-270">Capacity utilization trends of a VPN gateway in your environment.</span></span>
    - <span data-ttu-id="d3afe-271">Each VPN SKU allows a certain amount of bandwidth.</span><span class="sxs-lookup"><span data-stu-id="d3afe-271">Each VPN SKU allows a certain amount of bandwidth.</span></span> <span data-ttu-id="d3afe-272">Are the VPN gateways underutilized?</span><span class="sxs-lookup"><span data-stu-id="d3afe-272">Are the VPN gateways underutilized?</span></span>
    - <span data-ttu-id="d3afe-273">Are your gateways reaching capacity?</span><span class="sxs-lookup"><span data-stu-id="d3afe-273">Are your gateways reaching capacity?</span></span> <span data-ttu-id="d3afe-274">Should you upgrade to the next higher SKU?</span><span class="sxs-lookup"><span data-stu-id="d3afe-274">Should you upgrade to the next higher SKU?</span></span>
- <span data-ttu-id="d3afe-275">Which are the most conversing hosts, via which VPN gateway, over which port?</span><span class="sxs-lookup"><span data-stu-id="d3afe-275">Which are the most conversing hosts, via which VPN gateway, over which port?</span></span>
    - <span data-ttu-id="d3afe-276">Is this pattern normal?</span><span class="sxs-lookup"><span data-stu-id="d3afe-276">Is this pattern normal?</span></span> <span data-ttu-id="d3afe-277">Select **See all** under **VPN gateway**, as shown in the following picture:</span><span class="sxs-lookup"><span data-stu-id="d3afe-277">Select **See all** under **VPN gateway**, as shown in the following picture:</span></span>

        ![Dashboard showcasing top active VPN connections](./media/traffic-analytics/dashboard-showcasing-top-active-vpn-connections.png)

- <span data-ttu-id="d3afe-279">The following picture shows time trending for capacity utilization of an Azure VPN Gateway and the flow-related details (such as allowed flows and ports):</span><span class="sxs-lookup"><span data-stu-id="d3afe-279">The following picture shows time trending for capacity utilization of an Azure VPN Gateway and the flow-related details (such as allowed flows and ports):</span></span>

    ![VPN gateway utilization trend and flow details](./media/traffic-analytics/vpn-gateway-utilization-trend-and-flow-details.png)

### <a name="visualize-traffic-distribution-by-geography"></a><span data-ttu-id="d3afe-281">Visualize traffic distribution by geography</span><span class="sxs-lookup"><span data-stu-id="d3afe-281">Visualize traffic distribution by geography</span></span>

<span data-ttu-id="d3afe-282">**Look for**</span><span class="sxs-lookup"><span data-stu-id="d3afe-282">**Look for**</span></span>

- <span data-ttu-id="d3afe-283">Traffic distribution per data center such as top sources of traffic to a datacenter, top rogue networks conversing with the data center, and top conversing application protocols.</span><span class="sxs-lookup"><span data-stu-id="d3afe-283">Traffic distribution per data center such as top sources of traffic to a datacenter, top rogue networks conversing with the data center, and top conversing application protocols.</span></span>
    - <span data-ttu-id="d3afe-284">If you observe more load on a data center, you can plan for efficient traffic distribution.</span><span class="sxs-lookup"><span data-stu-id="d3afe-284">If you observe more load on a data center, you can plan for efficient traffic distribution.</span></span>
    - <span data-ttu-id="d3afe-285">If rogue networks are conversing in the data center, then correct NSG rules to block them.</span><span class="sxs-lookup"><span data-stu-id="d3afe-285">If rogue networks are conversing in the data center, then correct NSG rules to block them.</span></span>

    <span data-ttu-id="d3afe-286">Select **View map** under **Your environment**, as shown in the following picture:</span><span class="sxs-lookup"><span data-stu-id="d3afe-286">Select **View map** under **Your environment**, as shown in the following picture:</span></span>

    ![Dashboard showcasing traffic distribution](./media/traffic-analytics/dashboard-showcasing-traffic-distribution.png)

- <span data-ttu-id="d3afe-288">The geo-map shows the top ribbon for selection of parameters such as data centers (Deployed/No-deployment/Active/Inactive/Traffic Analytics Enabled/Traffic Analytics Not Enabled) and countries contributing Benign/Malicious traffic to the active deployment:</span><span class="sxs-lookup"><span data-stu-id="d3afe-288">The geo-map shows the top ribbon for selection of parameters such as data centers (Deployed/No-deployment/Active/Inactive/Traffic Analytics Enabled/Traffic Analytics Not Enabled) and countries contributing Benign/Malicious traffic to the active deployment:</span></span>

    ![Geo map view showcasing active deployment](./media/traffic-analytics/geo-map-view-showcasing-active-deployment.png)

- <span data-ttu-id="d3afe-290">The geo-map shows the traffic distribution to a data center from countries and continents communicating to it in blue (Benign traffic) and red (malicious traffic) colored lines:</span><span class="sxs-lookup"><span data-stu-id="d3afe-290">The geo-map shows the traffic distribution to a data center from countries and continents communicating to it in blue (Benign traffic) and red (malicious traffic) colored lines:</span></span>

    ![Geo map view showcasing traffic distribution to countries and continents](./media/traffic-analytics/geo-map-view-showcasing-traffic-distribution-to-countries-and-continents.png)

    ![Flow details for traffic distribution in log search](./media/traffic-analytics/flow-details-for-traffic-distribution-in-log-search.png)

### <a name="visualize-traffic-distribution-by-virtual-networks"></a><span data-ttu-id="d3afe-293">Visualize traffic distribution by virtual networks</span><span class="sxs-lookup"><span data-stu-id="d3afe-293">Visualize traffic distribution by virtual networks</span></span>

<span data-ttu-id="d3afe-294">**Look for**</span><span class="sxs-lookup"><span data-stu-id="d3afe-294">**Look for**</span></span>

- <span data-ttu-id="d3afe-295">Traffic distribution per virtual network, topology, top sources of traffic to the virtual network, top rogue networks conversing to the virtual network, and top conversing application protocols.</span><span class="sxs-lookup"><span data-stu-id="d3afe-295">Traffic distribution per virtual network, topology, top sources of traffic to the virtual network, top rogue networks conversing to the virtual network, and top conversing application protocols.</span></span>
    - <span data-ttu-id="d3afe-296">Knowing which virtual network is conversing to which virtual network.</span><span class="sxs-lookup"><span data-stu-id="d3afe-296">Knowing which virtual network is conversing to which virtual network.</span></span> <span data-ttu-id="d3afe-297">If the conversation is not expected, it can be corrected.</span><span class="sxs-lookup"><span data-stu-id="d3afe-297">If the conversation is not expected, it can be corrected.</span></span>
    - <span data-ttu-id="d3afe-298">If rogue networks are conversing with a virtual network, you can correct NSG rules to block the rogue networks.</span><span class="sxs-lookup"><span data-stu-id="d3afe-298">If rogue networks are conversing with a virtual network, you can correct NSG rules to block the rogue networks.</span></span>
 
    <span data-ttu-id="d3afe-299">Select **View VNets** under **Your environment**, as shown in the following picture:</span><span class="sxs-lookup"><span data-stu-id="d3afe-299">Select **View VNets** under **Your environment**, as shown in the following picture:</span></span>

    ![Dashboard showcasing virtual network distribution](./media/traffic-analytics/dashboard-showcasing-virtual-network-distribution.png)

- <span data-ttu-id="d3afe-301">The Virtual Network Topology shows the top ribbon for selection of parameters like a virtual network’s (Inter virtual network Connections/Active/Inactive), External Connections, Active Flows, and Malicious flows of the virtual network.</span><span class="sxs-lookup"><span data-stu-id="d3afe-301">The Virtual Network Topology shows the top ribbon for selection of parameters like a virtual network’s (Inter virtual network Connections/Active/Inactive), External Connections, Active Flows, and Malicious flows of the virtual network.</span></span>
- <span data-ttu-id="d3afe-302">The Virtual Network Topology shows the traffic distribution to a virtual network with regards to flows (Allowed/Blocked/Inbound/Outbound/Benign/Malicious), application protocol, and network security groups, for example:</span><span class="sxs-lookup"><span data-stu-id="d3afe-302">The Virtual Network Topology shows the traffic distribution to a virtual network with regards to flows (Allowed/Blocked/Inbound/Outbound/Benign/Malicious), application protocol, and network security groups, for example:</span></span>

    ![Virtual network topology showcasing traffic distribution and flow details](./media/traffic-analytics/virtual-network-topology-showcasing-traffic-distribution-and-flow-details.png)

    ![Flow details for virtual network traffic distribution in log search](./media/traffic-analytics/flow-details-for-virtual-network-traffic-distribution-in-log-search.png)

<span data-ttu-id="d3afe-305">**Look for**</span><span class="sxs-lookup"><span data-stu-id="d3afe-305">**Look for**</span></span>

- <span data-ttu-id="d3afe-306">Traffic distribution per subnet, topology, top sources of traffic to the subnet, top rogue networks conversing to the subnet, and top conversing application protocols.</span><span class="sxs-lookup"><span data-stu-id="d3afe-306">Traffic distribution per subnet, topology, top sources of traffic to the subnet, top rogue networks conversing to the subnet, and top conversing application protocols.</span></span>
    - <span data-ttu-id="d3afe-307">Knowing which subnet is conversing to which subnet.</span><span class="sxs-lookup"><span data-stu-id="d3afe-307">Knowing which subnet is conversing to which subnet.</span></span> <span data-ttu-id="d3afe-308">If you see unexpected conversations, you can correct your configuration.</span><span class="sxs-lookup"><span data-stu-id="d3afe-308">If you see unexpected conversations, you can correct your configuration.</span></span>
    - <span data-ttu-id="d3afe-309">If rogue networks are conversing with a subnet, you are able to correct it by configuring NSG rules to block the rogue networks.</span><span class="sxs-lookup"><span data-stu-id="d3afe-309">If rogue networks are conversing with a subnet, you are able to correct it by configuring NSG rules to block the rogue networks.</span></span>
- <span data-ttu-id="d3afe-310">The Subnets Topology shows the top ribbon for selection of parameters such as Active/Inactive subnet, External Connections, Active Flows, and Malicious flows of the subnet.</span><span class="sxs-lookup"><span data-stu-id="d3afe-310">The Subnets Topology shows the top ribbon for selection of parameters such as Active/Inactive subnet, External Connections, Active Flows, and Malicious flows of the subnet.</span></span>
- <span data-ttu-id="d3afe-311">The Subnet Topology shows the traffic distribution to a virtual network with regards to flows (Allowed/Blocked/Inbound/Outbound/Benign/Malicious), application protocol, and NSGs, for example:</span><span class="sxs-lookup"><span data-stu-id="d3afe-311">The Subnet Topology shows the traffic distribution to a virtual network with regards to flows (Allowed/Blocked/Inbound/Outbound/Benign/Malicious), application protocol, and NSGs, for example:</span></span>

    ![Subnet topology showcasing traffic distribution a virtual network subnet with regards to flows](./media/traffic-analytics/subnet-topology-showcasing-traffic-distribution-to-a-virtual-subnet-with-regards-to-flows.png)

<span data-ttu-id="d3afe-313">**Look for**</span><span class="sxs-lookup"><span data-stu-id="d3afe-313">**Look for**</span></span>

<span data-ttu-id="d3afe-314">Traffic distribution per Application gateway & Load Balancer, topology, top sources of traffic, top rogue networks conversing to the Application gateway & Load Balancer, and top conversing application protocols.</span><span class="sxs-lookup"><span data-stu-id="d3afe-314">Traffic distribution per Application gateway & Load Balancer, topology, top sources of traffic, top rogue networks conversing to the Application gateway & Load Balancer, and top conversing application protocols.</span></span> 
    
 - <span data-ttu-id="d3afe-315">Knowing which subnet is conversing to which Application gateway or Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="d3afe-315">Knowing which subnet is conversing to which Application gateway or Load Balancer.</span></span> <span data-ttu-id="d3afe-316">If you observe unexpected conversations, you can correct your configuration.</span><span class="sxs-lookup"><span data-stu-id="d3afe-316">If you observe unexpected conversations, you can correct your configuration.</span></span>
 - <span data-ttu-id="d3afe-317">If rogue networks are conversing with an Application gateway or Load Balancer, you are able to correct it by configuring NSG rules to block the rogue networks.</span><span class="sxs-lookup"><span data-stu-id="d3afe-317">If rogue networks are conversing with an Application gateway or Load Balancer, you are able to correct it by configuring NSG rules to block the rogue networks.</span></span> 

    ![subnet-topology-showcasing-traffic-distribution-to-a-application-gateway-subnet-with-regards-to-flows](./media/traffic-analytics/subnet-topology-showcasing-traffic-distribution-to-a-application-gateway-subnet-with-regards-to-flows.png)

### <a name="view-ports-and-virtual-machines-receiving-traffic-from-the-internet"></a><span data-ttu-id="d3afe-319">View ports and virtual machines receiving traffic from the internet</span><span class="sxs-lookup"><span data-stu-id="d3afe-319">View ports and virtual machines receiving traffic from the internet</span></span>

<span data-ttu-id="d3afe-320">**Look for**</span><span class="sxs-lookup"><span data-stu-id="d3afe-320">**Look for**</span></span>

- <span data-ttu-id="d3afe-321">Which open ports are conversing over the internet?</span><span class="sxs-lookup"><span data-stu-id="d3afe-321">Which open ports are conversing over the internet?</span></span>
    - <span data-ttu-id="d3afe-322">If unexpected ports are found open, you can correct your configuration:</span><span class="sxs-lookup"><span data-stu-id="d3afe-322">If unexpected ports are found open, you can correct your configuration:</span></span>

    ![Dashboard showcasing ports receiving and sending traffic to the internet](./media/traffic-analytics/dashboard-showcasing-ports-receiving-and-sending-traffic-to-the-internet.png)

    ![Details of Azure destination ports and hosts](./media/traffic-analytics/details-of-azure-destination-ports-and-hosts.png)

<span data-ttu-id="d3afe-325">**Look for**</span><span class="sxs-lookup"><span data-stu-id="d3afe-325">**Look for**</span></span>

<span data-ttu-id="d3afe-326">Do you have malicious traffic in your environment?</span><span class="sxs-lookup"><span data-stu-id="d3afe-326">Do you have malicious traffic in your environment?</span></span> <span data-ttu-id="d3afe-327">Where is it originating from?</span><span class="sxs-lookup"><span data-stu-id="d3afe-327">Where is it originating from?</span></span> <span data-ttu-id="d3afe-328">Where is it destined to?</span><span class="sxs-lookup"><span data-stu-id="d3afe-328">Where is it destined to?</span></span>

![Malicious traffic flows detail in log search](./media/traffic-analytics/malicious-traffic-flows-detail-in-log-search.png)


### <a name="visualize-the-trends-in-nsgnsg-rules-hits"></a><span data-ttu-id="d3afe-330">Visualize the trends in NSG/NSG rules hits</span><span class="sxs-lookup"><span data-stu-id="d3afe-330">Visualize the trends in NSG/NSG rules hits</span></span>

<span data-ttu-id="d3afe-331">**Look for**</span><span class="sxs-lookup"><span data-stu-id="d3afe-331">**Look for**</span></span>

- <span data-ttu-id="d3afe-332">Which NSG/NSG rules have the most hits in comparative chart with flows distribution?</span><span class="sxs-lookup"><span data-stu-id="d3afe-332">Which NSG/NSG rules have the most hits in comparative chart with flows distribution?</span></span>
- <span data-ttu-id="d3afe-333">What are the top source and destination conversation pairs per NSG/NSG rules?</span><span class="sxs-lookup"><span data-stu-id="d3afe-333">What are the top source and destination conversation pairs per NSG/NSG rules?</span></span>

    ![Dashboard showcasing NSG hits statistics](./media/traffic-analytics/dashboard-showcasing-nsg-hits-statistics.png)

- <span data-ttu-id="d3afe-335">The following pictures show time trending for hits of NSG rules and source-destination flow details for a network security group:</span><span class="sxs-lookup"><span data-stu-id="d3afe-335">The following pictures show time trending for hits of NSG rules and source-destination flow details for a network security group:</span></span>

    - <span data-ttu-id="d3afe-336">Quickly detect which NSGs and NSG rules are traversing malicious flows and which are the top malicious IP addresses accessing your cloud environment</span><span class="sxs-lookup"><span data-stu-id="d3afe-336">Quickly detect which NSGs and NSG rules are traversing malicious flows and which are the top malicious IP addresses accessing your cloud environment</span></span>
    - <span data-ttu-id="d3afe-337">Identify which NSG/NSG rules are allowing/blocking significant network traffic</span><span class="sxs-lookup"><span data-stu-id="d3afe-337">Identify which NSG/NSG rules are allowing/blocking significant network traffic</span></span>
    - <span data-ttu-id="d3afe-338">Select top filters for granular inspection of an NSG or NSG rules</span><span class="sxs-lookup"><span data-stu-id="d3afe-338">Select top filters for granular inspection of an NSG or NSG rules</span></span>

    ![Showcasing time trending for NSG rule hits and top NSG rules](./media/traffic-analytics/showcasing-time-trending-for-nsg-rule-hits-and-top-nsg-rules.png)

    ![Top NSG rules statistics details in log search](./media/traffic-analytics/top-nsg-rules-statistics-details-in-log-search.png)

## <a name="frequently-asked-questions"></a><span data-ttu-id="d3afe-341">Frequently asked questions</span><span class="sxs-lookup"><span data-stu-id="d3afe-341">Frequently asked questions</span></span>

<span data-ttu-id="d3afe-342">To get answers to frequently asked questions, see [Traffic analytics FAQ](traffic-analytics-faq.md).</span><span class="sxs-lookup"><span data-stu-id="d3afe-342">To get answers to frequently asked questions, see [Traffic analytics FAQ](traffic-analytics-faq.md).</span></span>
