---
title: SAP HANA Azure Backup on file level | Microsoft Docs
description: There are two major backup possibilities for SAP HANA on Azure virtual machines, this article covers SAP HANA Azure Backup on file level
services: virtual-machines-linux
documentationcenter: ''
author: hermanndms
manager: jeconnoc
editor: ''
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 07/05/2018
ms.author: rclaus
ms.openlocfilehash: d3d1769766053b513a98df153cb635ae148f26b1
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44808085"
---
# <a name="sap-hana-azure-backup-on-file-level"></a><span data-ttu-id="24968-103">SAP HANA Azure Backup on file level</span><span class="sxs-lookup"><span data-stu-id="24968-103">SAP HANA Azure Backup on file level</span></span>

## <a name="introduction"></a><span data-ttu-id="24968-104">Introduction</span><span class="sxs-lookup"><span data-stu-id="24968-104">Introduction</span></span>

<span data-ttu-id="24968-105">This is part of a three-part series of related articles on SAP HANA backup.</span><span class="sxs-lookup"><span data-stu-id="24968-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="24968-106">[Backup guide for SAP HANA on Azure Virtual Machines](./sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA backup based on storage snapshots](./sap-hana-backup-storage-snapshots.md) covers the storage snapshot-based backup option.</span><span class="sxs-lookup"><span data-stu-id="24968-106">[Backup guide for SAP HANA on Azure Virtual Machines](./sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA backup based on storage snapshots](./sap-hana-backup-storage-snapshots.md) covers the storage snapshot-based backup option.</span></span>

<span data-ttu-id="24968-107">Different VM types in Azure allow a different number of VHDs attached.</span><span class="sxs-lookup"><span data-stu-id="24968-107">Different VM types in Azure allow a different number of VHDs attached.</span></span> <span data-ttu-id="24968-108">The exact details are documented in [Sizes for Linux virtual machines in Azure](../../linux/sizes.md).</span><span class="sxs-lookup"><span data-stu-id="24968-108">The exact details are documented in [Sizes for Linux virtual machines in Azure](../../linux/sizes.md).</span></span> <span data-ttu-id="24968-109">For the tests referred to in this documentation we used a GS5 Azure VM which allows 64 attached data disks.</span><span class="sxs-lookup"><span data-stu-id="24968-109">For the tests referred to in this documentation we used a GS5 Azure VM which allows 64 attached data disks.</span></span> <span data-ttu-id="24968-110">For larger SAP HANA systems, a significant number of disks might already be taken for data and log files, possibly in combination with software striping for optimal disk IO throughput.</span><span class="sxs-lookup"><span data-stu-id="24968-110">For larger SAP HANA systems, a significant number of disks might already be taken for data and log files, possibly in combination with software striping for optimal disk IO throughput.</span></span> <span data-ttu-id="24968-111">For more details on suggested disk configurations for SAP HANA deployments on Azure VMs, read the article [SAP HANA on Azure operations guide](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-vm-operations).</span><span class="sxs-lookup"><span data-stu-id="24968-111">For more details on suggested disk configurations for SAP HANA deployments on Azure VMs, read the article [SAP HANA on Azure operations guide](https://docs.microsoft.com/azure/virtual-machines/workloads/sap/hana-vm-operations).</span></span> <span data-ttu-id="24968-112">The recommendations made are including disk space recommendations for local backups as well.</span><span class="sxs-lookup"><span data-stu-id="24968-112">The recommendations made are including disk space recommendations for local backups as well.</span></span>

<span data-ttu-id="24968-113">There is no SAP HANA backup integration available with Azure Backup service at this time.</span><span class="sxs-lookup"><span data-stu-id="24968-113">There is no SAP HANA backup integration available with Azure Backup service at this time.</span></span> <span data-ttu-id="24968-114">The standard way to manage backup/restore at the file level is with a file-based backup via SAP HANA Studio or via SAP HANA SQL statements.</span><span class="sxs-lookup"><span data-stu-id="24968-114">The standard way to manage backup/restore at the file level is with a file-based backup via SAP HANA Studio or via SAP HANA SQL statements.</span></span> <span data-ttu-id="24968-115">See [SAP HANA SQL and System Views Reference](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) for more information.</span><span class="sxs-lookup"><span data-stu-id="24968-115">See [SAP HANA SQL and System Views Reference](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) for more information.</span></span>

![This figure shows the dialog of the backup menu item in SAP HANA Studio](media/sap-hana-backup-file-level/image022.png)

<span data-ttu-id="24968-117">This figure shows the dialog of the backup menu item in SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="24968-117">This figure shows the dialog of the backup menu item in SAP HANA Studio.</span></span> <span data-ttu-id="24968-118">When choosing type &quot;file,&quot; one has to specify a path in the file system where SAP HANA writes the backup files.</span><span class="sxs-lookup"><span data-stu-id="24968-118">When choosing type &quot;file,&quot; one has to specify a path in the file system where SAP HANA writes the backup files.</span></span> <span data-ttu-id="24968-119">Restore works the same way.</span><span class="sxs-lookup"><span data-stu-id="24968-119">Restore works the same way.</span></span>

<span data-ttu-id="24968-120">While this choice sounds simple and straight forward, there are some considerations.</span><span class="sxs-lookup"><span data-stu-id="24968-120">While this choice sounds simple and straight forward, there are some considerations.</span></span> <span data-ttu-id="24968-121">As mentioned before, an Azure VM has a limitation of number of data disks that can be attached.</span><span class="sxs-lookup"><span data-stu-id="24968-121">As mentioned before, an Azure VM has a limitation of number of data disks that can be attached.</span></span> <span data-ttu-id="24968-122">There might not be capacity to store SAP HANA backup files on the file systems of the VM, depending on the size of the database and disk throughput requirements, which might involve software striping across multiple data disks.</span><span class="sxs-lookup"><span data-stu-id="24968-122">There might not be capacity to store SAP HANA backup files on the file systems of the VM, depending on the size of the database and disk throughput requirements, which might involve software striping across multiple data disks.</span></span> <span data-ttu-id="24968-123">Various options for moving these backup files, and managing file size restrictions and performance when handling terabytes of data, are provided later in this article.</span><span class="sxs-lookup"><span data-stu-id="24968-123">Various options for moving these backup files, and managing file size restrictions and performance when handling terabytes of data, are provided later in this article.</span></span>

<span data-ttu-id="24968-124">Another option, which offers more freedom regarding total capacity, is Azure blob storage.</span><span class="sxs-lookup"><span data-stu-id="24968-124">Another option, which offers more freedom regarding total capacity, is Azure blob storage.</span></span> <span data-ttu-id="24968-125">While a single blob is also restricted to 1 TB, the total capacity of a single blob container is currently 500 TB.</span><span class="sxs-lookup"><span data-stu-id="24968-125">While a single blob is also restricted to 1 TB, the total capacity of a single blob container is currently 500 TB.</span></span> <span data-ttu-id="24968-126">Additionally, it gives customers the choice to select so-called &quot;cool&quot; blob storage, which has a cost benefit.</span><span class="sxs-lookup"><span data-stu-id="24968-126">Additionally, it gives customers the choice to select so-called &quot;cool&quot; blob storage, which has a cost benefit.</span></span> <span data-ttu-id="24968-127">See [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md) for details about cool blob storage.</span><span class="sxs-lookup"><span data-stu-id="24968-127">See [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md) for details about cool blob storage.</span></span>

<span data-ttu-id="24968-128">For additional safety, use a geo-replicated storage account to store the SAP HANA backups.</span><span class="sxs-lookup"><span data-stu-id="24968-128">For additional safety, use a geo-replicated storage account to store the SAP HANA backups.</span></span> <span data-ttu-id="24968-129">See [Azure Storage replication](../../../storage/common/storage-redundancy.md) for details about storage account replication.</span><span class="sxs-lookup"><span data-stu-id="24968-129">See [Azure Storage replication](../../../storage/common/storage-redundancy.md) for details about storage account replication.</span></span>

<span data-ttu-id="24968-130">One could place dedicated VHDs for SAP HANA backups in a dedicated backup storage account that is geo-replicated.</span><span class="sxs-lookup"><span data-stu-id="24968-130">One could place dedicated VHDs for SAP HANA backups in a dedicated backup storage account that is geo-replicated.</span></span> <span data-ttu-id="24968-131">Or else one could copy the VHDs that keep the SAP HANA backups to a geo-replicated storage account, or to a storage account that is in a different region.</span><span class="sxs-lookup"><span data-stu-id="24968-131">Or else one could copy the VHDs that keep the SAP HANA backups to a geo-replicated storage account, or to a storage account that is in a different region.</span></span>

## <a name="azure-backup-agent"></a><span data-ttu-id="24968-132">Azure backup agent</span><span class="sxs-lookup"><span data-stu-id="24968-132">Azure backup agent</span></span>

<span data-ttu-id="24968-133">Azure backup offers the option to not only back up complete VMs, but also files and directories via the backup agent, which has to be installed on the guest OS.</span><span class="sxs-lookup"><span data-stu-id="24968-133">Azure backup offers the option to not only back up complete VMs, but also files and directories via the backup agent, which has to be installed on the guest OS.</span></span> <span data-ttu-id="24968-134">But this agent is only supported on Windows (see [Back up a Windows Server or client to Azure using the Resource Manager deployment model](../../../backup/backup-configure-vault.md)).</span><span class="sxs-lookup"><span data-stu-id="24968-134">But this agent is only supported on Windows (see [Back up a Windows Server or client to Azure using the Resource Manager deployment model](../../../backup/backup-configure-vault.md)).</span></span>

<span data-ttu-id="24968-135">A workaround is to first copy SAP HANA backup files to a Windows VM on Azure (for example, via SAMBA share) and then use the Azure backup agent from there.</span><span class="sxs-lookup"><span data-stu-id="24968-135">A workaround is to first copy SAP HANA backup files to a Windows VM on Azure (for example, via SAMBA share) and then use the Azure backup agent from there.</span></span> <span data-ttu-id="24968-136">While it is technically possible, it would add complexity and slow down the backup or restore process quite a bit due to the copy between the Linux and the Windows VM.</span><span class="sxs-lookup"><span data-stu-id="24968-136">While it is technically possible, it would add complexity and slow down the backup or restore process quite a bit due to the copy between the Linux and the Windows VM.</span></span> <span data-ttu-id="24968-137">It is not recommended to follow this approach.</span><span class="sxs-lookup"><span data-stu-id="24968-137">It is not recommended to follow this approach.</span></span>

## <a name="azure-blobxfer-utility-details"></a><span data-ttu-id="24968-138">Azure blobxfer utility details</span><span class="sxs-lookup"><span data-stu-id="24968-138">Azure blobxfer utility details</span></span>

<span data-ttu-id="24968-139">To store directories and files on Azure storage, one could use CLI or PowerShell, or develop a tool using one of the [Azure SDKs](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="24968-139">To store directories and files on Azure storage, one could use CLI or PowerShell, or develop a tool using one of the [Azure SDKs](https://azure.microsoft.com/downloads/).</span></span> <span data-ttu-id="24968-140">There is also a ready-to-use utility, AzCopy, for copying data to Azure storage, but it is Windows only (see [Transfer data with the AzCopy Command-Line Utility](../../../storage/common/storage-use-azcopy.md)).</span><span class="sxs-lookup"><span data-stu-id="24968-140">There is also a ready-to-use utility, AzCopy, for copying data to Azure storage, but it is Windows only (see [Transfer data with the AzCopy Command-Line Utility](../../../storage/common/storage-use-azcopy.md)).</span></span>

<span data-ttu-id="24968-141">Therefore, blobxfer was used for copying SAP HANA backup files.</span><span class="sxs-lookup"><span data-stu-id="24968-141">Therefore, blobxfer was used for copying SAP HANA backup files.</span></span> <span data-ttu-id="24968-142">It is open source, used by many customers in production environments, and available on [GitHub](https://github.com/Azure/blobxfer).</span><span class="sxs-lookup"><span data-stu-id="24968-142">It is open source, used by many customers in production environments, and available on [GitHub](https://github.com/Azure/blobxfer).</span></span> <span data-ttu-id="24968-143">This tool allows one to copy data directly to either Azure blob storage or Azure file share.</span><span class="sxs-lookup"><span data-stu-id="24968-143">This tool allows one to copy data directly to either Azure blob storage or Azure file share.</span></span> <span data-ttu-id="24968-144">It also offers a range of useful features, like md5 hash or automatic parallelism when copying a directory with multiple files.</span><span class="sxs-lookup"><span data-stu-id="24968-144">It also offers a range of useful features, like md5 hash or automatic parallelism when copying a directory with multiple files.</span></span>

## <a name="sap-hana-backup-performance"></a><span data-ttu-id="24968-145">SAP HANA backup performance</span><span class="sxs-lookup"><span data-stu-id="24968-145">SAP HANA backup performance</span></span>

![This screenshot is of the SAP HANA backup console in SAP HANA Studio](media/sap-hana-backup-file-level/image023.png)

<span data-ttu-id="24968-147">This screenshot is of the SAP HANA backup console in SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="24968-147">This screenshot is of the SAP HANA backup console in SAP HANA Studio.</span></span> <span data-ttu-id="24968-148">It took about 42 minutes to do the backup of the 230 GB on a single Azure standard storage disk attached to the HANA VM using XFS file system.</span><span class="sxs-lookup"><span data-stu-id="24968-148">It took about 42 minutes to do the backup of the 230 GB on a single Azure standard storage disk attached to the HANA VM using XFS file system.</span></span>

![This screenshot is of YaST on the SAP HANA test VM](media/sap-hana-backup-file-level/image024.png)

<span data-ttu-id="24968-150">This screenshot is of YaST on the SAP HANA test VM.</span><span class="sxs-lookup"><span data-stu-id="24968-150">This screenshot is of YaST on the SAP HANA test VM.</span></span> <span data-ttu-id="24968-151">One can see the 1-TB single disk for SAP HANA backup as mentioned before.</span><span class="sxs-lookup"><span data-stu-id="24968-151">One can see the 1-TB single disk for SAP HANA backup as mentioned before.</span></span> <span data-ttu-id="24968-152">It took about 42 minutes to backup 230 GB.</span><span class="sxs-lookup"><span data-stu-id="24968-152">It took about 42 minutes to backup 230 GB.</span></span> <span data-ttu-id="24968-153">In addition, five 200-GB disks were attached and software RAID md0 created, with striping on top of these five Azure data disks.</span><span class="sxs-lookup"><span data-stu-id="24968-153">In addition, five 200-GB disks were attached and software RAID md0 created, with striping on top of these five Azure data disks.</span></span>

![Repeating the same backup on software RAID with striping across five attached Azure standard storage data disks](media/sap-hana-backup-file-level/image025.png)

<span data-ttu-id="24968-155">Repeating the same backup on software RAID with striping across five attached Azure standard storage data disks brought the backup time from 42 minutes down to 10 minutes.</span><span class="sxs-lookup"><span data-stu-id="24968-155">Repeating the same backup on software RAID with striping across five attached Azure standard storage data disks brought the backup time from 42 minutes down to 10 minutes.</span></span> <span data-ttu-id="24968-156">The disks were attached without caching to the VM.</span><span class="sxs-lookup"><span data-stu-id="24968-156">The disks were attached without caching to the VM.</span></span> <span data-ttu-id="24968-157">So it is obvious how important disk write throughput is for the backup time.</span><span class="sxs-lookup"><span data-stu-id="24968-157">So it is obvious how important disk write throughput is for the backup time.</span></span> <span data-ttu-id="24968-158">One could then switch to Azure Premium Storage to further accelerate the process for optimal performance.</span><span class="sxs-lookup"><span data-stu-id="24968-158">One could then switch to Azure Premium Storage to further accelerate the process for optimal performance.</span></span> <span data-ttu-id="24968-159">In general, Azure Premium Storage should be used for production systems.</span><span class="sxs-lookup"><span data-stu-id="24968-159">In general, Azure Premium Storage should be used for production systems.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-blob-storage"></a><span data-ttu-id="24968-160">Copy SAP HANA backup files to Azure blob storage</span><span class="sxs-lookup"><span data-stu-id="24968-160">Copy SAP HANA backup files to Azure blob storage</span></span>

<span data-ttu-id="24968-161">Another option to quickly store SAP HANA backup files is Azure blob storage.</span><span class="sxs-lookup"><span data-stu-id="24968-161">Another option to quickly store SAP HANA backup files is Azure blob storage.</span></span> <span data-ttu-id="24968-162">One single blob container has a limit of 500 TB, enough for some smaller SAP HANA systems, using M32ts, M32ls, M64ls, and GS5 VM types of Azure, to keep sufficient SAP HANA backups.</span><span class="sxs-lookup"><span data-stu-id="24968-162">One single blob container has a limit of 500 TB, enough for some smaller SAP HANA systems, using M32ts, M32ls, M64ls, and GS5 VM types of Azure, to keep sufficient SAP HANA backups.</span></span> <span data-ttu-id="24968-163">Customers have the choice between &quot;hot&quot; and &quot;cold&quot; blob storage (see [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md)).</span><span class="sxs-lookup"><span data-stu-id="24968-163">Customers have the choice between &quot;hot&quot; and &quot;cold&quot; blob storage (see [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md)).</span></span>

<span data-ttu-id="24968-164">With the blobxfer tool, it is easy to copy the SAP HANA backup files directly to Azure blob storage.</span><span class="sxs-lookup"><span data-stu-id="24968-164">With the blobxfer tool, it is easy to copy the SAP HANA backup files directly to Azure blob storage.</span></span>

![Here one can see the files of a full SAP HANA file backup](media/sap-hana-backup-file-level/image026.png)

<span data-ttu-id="24968-166">Here one can see the files of a full SAP HANA file backup.</span><span class="sxs-lookup"><span data-stu-id="24968-166">Here one can see the files of a full SAP HANA file backup.</span></span> <span data-ttu-id="24968-167">There are four files and the biggest one has roughly 230 GB.</span><span class="sxs-lookup"><span data-stu-id="24968-167">There are four files and the biggest one has roughly 230 GB.</span></span>

![It took roughly 3000 seconds to copy the 230 GB to an Azure standard storage account blob container](media/sap-hana-backup-file-level/image027.png)

<span data-ttu-id="24968-169">Not using md5 hash in the initial test, it took roughly 3000 seconds to copy the 230 GB to an Azure standard storage account blob container.</span><span class="sxs-lookup"><span data-stu-id="24968-169">Not using md5 hash in the initial test, it took roughly 3000 seconds to copy the 230 GB to an Azure standard storage account blob container.</span></span>

![In this screenshot, one can see how it looks on the Azure portal](media/sap-hana-backup-file-level/image028.png)

<span data-ttu-id="24968-171">In this screenshot, one can see how it looks on the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="24968-171">In this screenshot, one can see how it looks on the Azure portal.</span></span> <span data-ttu-id="24968-172">A blob container named &quot;sap-hana-backups&quot; was created and includes the four blobs, which represent the SAP HANA backup files.</span><span class="sxs-lookup"><span data-stu-id="24968-172">A blob container named &quot;sap-hana-backups&quot; was created and includes the four blobs, which represent the SAP HANA backup files.</span></span> <span data-ttu-id="24968-173">One of them has a size of roughly 230 GB.</span><span class="sxs-lookup"><span data-stu-id="24968-173">One of them has a size of roughly 230 GB.</span></span>

<span data-ttu-id="24968-174">The HANA Studio backup console allows one to restrict the max file size of HANA backup files.</span><span class="sxs-lookup"><span data-stu-id="24968-174">The HANA Studio backup console allows one to restrict the max file size of HANA backup files.</span></span> <span data-ttu-id="24968-175">In the sample environment, it improved performance by making it possible to have multiple smaller backup files, instead of one large 230-GB file.</span><span class="sxs-lookup"><span data-stu-id="24968-175">In the sample environment, it improved performance by making it possible to have multiple smaller backup files, instead of one large 230-GB file.</span></span>

![Setting the backup file size limit on the HANA side doesn&#39;t improve the backup time](media/sap-hana-backup-file-level/image029.png)

<span data-ttu-id="24968-177">Setting the backup file size limit on the HANA side doesn&#39;t improve the backup time, because the files are written sequentially as shown in this figure.</span><span class="sxs-lookup"><span data-stu-id="24968-177">Setting the backup file size limit on the HANA side doesn&#39;t improve the backup time, because the files are written sequentially as shown in this figure.</span></span> <span data-ttu-id="24968-178">The file size limit was set to 60 GB, so the backup created four large data files instead of the 230-GB single file.</span><span class="sxs-lookup"><span data-stu-id="24968-178">The file size limit was set to 60 GB, so the backup created four large data files instead of the 230-GB single file.</span></span> <span data-ttu-id="24968-179">Using multiple backup files is a necessity for backing up HANA databases that leverage the memory of larger Azure VMs like M64s, M64ms, M128s, and M128ms.</span><span class="sxs-lookup"><span data-stu-id="24968-179">Using multiple backup files is a necessity for backing up HANA databases that leverage the memory of larger Azure VMs like M64s, M64ms, M128s, and M128ms.</span></span>

![To test parallelism of the blobxfer tool, the max file size for HANA backups was then set to 15 GB](media/sap-hana-backup-file-level/image030.png)

<span data-ttu-id="24968-181">To test parallelism of the blobxfer tool, the max file size for HANA backups was then set to 15 GB, which resulted in 19 backup files.</span><span class="sxs-lookup"><span data-stu-id="24968-181">To test parallelism of the blobxfer tool, the max file size for HANA backups was then set to 15 GB, which resulted in 19 backup files.</span></span> <span data-ttu-id="24968-182">This configuration brought the time for blobxfer to copy the 230 GB to Azure blob storage from 3000 seconds down to 875 seconds.</span><span class="sxs-lookup"><span data-stu-id="24968-182">This configuration brought the time for blobxfer to copy the 230 GB to Azure blob storage from 3000 seconds down to 875 seconds.</span></span>

<span data-ttu-id="24968-183">This result is due to the limit of 60 MB/sec for writing an Azure blob.</span><span class="sxs-lookup"><span data-stu-id="24968-183">This result is due to the limit of 60 MB/sec for writing an Azure blob.</span></span> <span data-ttu-id="24968-184">Parallelism via multiple blobs solves the bottleneck, but there is a downside: increasing performance of the blobxfer tool to copy all these HANA backup files to Azure blob storage puts load on both the HANA VM and the network.</span><span class="sxs-lookup"><span data-stu-id="24968-184">Parallelism via multiple blobs solves the bottleneck, but there is a downside: increasing performance of the blobxfer tool to copy all these HANA backup files to Azure blob storage puts load on both the HANA VM and the network.</span></span> <span data-ttu-id="24968-185">Operation of HANA system becomes impacted.</span><span class="sxs-lookup"><span data-stu-id="24968-185">Operation of HANA system becomes impacted.</span></span>

## <a name="blob-copy-of-dedicated-azure-data-disks-in-backup-software-raid"></a><span data-ttu-id="24968-186">Blob copy of dedicated Azure data disks in backup software RAID</span><span class="sxs-lookup"><span data-stu-id="24968-186">Blob copy of dedicated Azure data disks in backup software RAID</span></span>

<span data-ttu-id="24968-187">Unlike the manual VM data disk backup, in this approach one does not back up all the data disks on a VM to save the whole SAP installation, including HANA data, HANA log files, and config files.</span><span class="sxs-lookup"><span data-stu-id="24968-187">Unlike the manual VM data disk backup, in this approach one does not back up all the data disks on a VM to save the whole SAP installation, including HANA data, HANA log files, and config files.</span></span> <span data-ttu-id="24968-188">Instead, the idea is to have dedicated software RAID with striping across multiple Azure data VHDs for storing a full SAP HANA file backup.</span><span class="sxs-lookup"><span data-stu-id="24968-188">Instead, the idea is to have dedicated software RAID with striping across multiple Azure data VHDs for storing a full SAP HANA file backup.</span></span> <span data-ttu-id="24968-189">One copies only these disks, which have the SAP HANA backup.</span><span class="sxs-lookup"><span data-stu-id="24968-189">One copies only these disks, which have the SAP HANA backup.</span></span> <span data-ttu-id="24968-190">They could easily be kept in a dedicated HANA backup storage account, or attached to a dedicated &quot;backup management VM&quot; for further processing.</span><span class="sxs-lookup"><span data-stu-id="24968-190">They could easily be kept in a dedicated HANA backup storage account, or attached to a dedicated &quot;backup management VM&quot; for further processing.</span></span>

![All VHDs involved were copied using the **start-azurestorageblobcopy** PowerShell command](media/sap-hana-backup-file-level/image031.png)

<span data-ttu-id="24968-192">After the backup to the local software RAID was completed, all VHDs involved were copied using the **start-azurestorageblobcopy** PowerShell command (see [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span><span class="sxs-lookup"><span data-stu-id="24968-192">After the backup to the local software RAID was completed, all VHDs involved were copied using the **start-azurestorageblobcopy** PowerShell command (see [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span></span> <span data-ttu-id="24968-193">As it only affects the dedicated file system for keeping the backup files, there are no concerns about SAP HANA data or log file consistency on the disk.</span><span class="sxs-lookup"><span data-stu-id="24968-193">As it only affects the dedicated file system for keeping the backup files, there are no concerns about SAP HANA data or log file consistency on the disk.</span></span> <span data-ttu-id="24968-194">A benefit of this command is that it works while the VM stays online.</span><span class="sxs-lookup"><span data-stu-id="24968-194">A benefit of this command is that it works while the VM stays online.</span></span> <span data-ttu-id="24968-195">To be certain that no process writes to the backup stripe set, be sure to unmount it before the blob copy, and mount it again afterwards.</span><span class="sxs-lookup"><span data-stu-id="24968-195">To be certain that no process writes to the backup stripe set, be sure to unmount it before the blob copy, and mount it again afterwards.</span></span> <span data-ttu-id="24968-196">Or one could use an appropriate way to &quot;freeze&quot; the file system.</span><span class="sxs-lookup"><span data-stu-id="24968-196">Or one could use an appropriate way to &quot;freeze&quot; the file system.</span></span> <span data-ttu-id="24968-197">For example, via xfs\_freeze for the XFS file system.</span><span class="sxs-lookup"><span data-stu-id="24968-197">For example, via xfs\_freeze for the XFS file system.</span></span>

![This screenshot shows the list of blobs in the vhds container on the Azure portal](media/sap-hana-backup-file-level/image032.png)

<span data-ttu-id="24968-199">This screenshot shows the list of blobs in the &quot;vhds&quot; container on the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="24968-199">This screenshot shows the list of blobs in the &quot;vhds&quot; container on the Azure portal.</span></span> <span data-ttu-id="24968-200">The screenshot shows the five VHDs, which were attached to the SAP HANA server VM to serve as the software RAID to keep SAP HANA backup files.</span><span class="sxs-lookup"><span data-stu-id="24968-200">The screenshot shows the five VHDs, which were attached to the SAP HANA server VM to serve as the software RAID to keep SAP HANA backup files.</span></span> <span data-ttu-id="24968-201">It also shows the five copies, which were taken via the blob copy command.</span><span class="sxs-lookup"><span data-stu-id="24968-201">It also shows the five copies, which were taken via the blob copy command.</span></span>

![For testing purposes, the copies of the SAP HANA backup software RAID disks were attached to the app server VM](media/sap-hana-backup-file-level/image033.png)

<span data-ttu-id="24968-203">For testing purposes, the copies of the SAP HANA backup software RAID disks were attached to the app server VM.</span><span class="sxs-lookup"><span data-stu-id="24968-203">For testing purposes, the copies of the SAP HANA backup software RAID disks were attached to the app server VM.</span></span>

![The app server VM was shut down to attach the disk copies](media/sap-hana-backup-file-level/image034.png)

<span data-ttu-id="24968-205">The app server VM was shut down to attach the disk copies.</span><span class="sxs-lookup"><span data-stu-id="24968-205">The app server VM was shut down to attach the disk copies.</span></span> <span data-ttu-id="24968-206">After starting the VM, the disks and the RAID were discovered correctly (mounted via UUID).</span><span class="sxs-lookup"><span data-stu-id="24968-206">After starting the VM, the disks and the RAID were discovered correctly (mounted via UUID).</span></span> <span data-ttu-id="24968-207">Only the mount point was missing, which was created via the YaST partitioner.</span><span class="sxs-lookup"><span data-stu-id="24968-207">Only the mount point was missing, which was created via the YaST partitioner.</span></span> <span data-ttu-id="24968-208">Afterwards the SAP HANA backup file copies became visible on OS level.</span><span class="sxs-lookup"><span data-stu-id="24968-208">Afterwards the SAP HANA backup file copies became visible on OS level.</span></span>

## <a name="copy-sap-hana-backup-files-to-nfs-share"></a><span data-ttu-id="24968-209">Copy SAP HANA backup files to NFS share</span><span class="sxs-lookup"><span data-stu-id="24968-209">Copy SAP HANA backup files to NFS share</span></span>

<span data-ttu-id="24968-210">To lessen the potential impact on the SAP HANA system from a performance or disk space perspective, one might consider storing the SAP HANA backup files on an NFS share.</span><span class="sxs-lookup"><span data-stu-id="24968-210">To lessen the potential impact on the SAP HANA system from a performance or disk space perspective, one might consider storing the SAP HANA backup files on an NFS share.</span></span> <span data-ttu-id="24968-211">Technically it works, but it means using a second Azure VM as the host of the NFS share.</span><span class="sxs-lookup"><span data-stu-id="24968-211">Technically it works, but it means using a second Azure VM as the host of the NFS share.</span></span> <span data-ttu-id="24968-212">It should not be a small VM size, due to the VM network bandwidth.</span><span class="sxs-lookup"><span data-stu-id="24968-212">It should not be a small VM size, due to the VM network bandwidth.</span></span> <span data-ttu-id="24968-213">It would make sense then to shut down this &quot;backup VM&quot; and only bring it up for executing the SAP HANA backup.</span><span class="sxs-lookup"><span data-stu-id="24968-213">It would make sense then to shut down this &quot;backup VM&quot; and only bring it up for executing the SAP HANA backup.</span></span> <span data-ttu-id="24968-214">Writing on an NFS share puts load on the network and impacts the SAP HANA system, but merely managing the backup files afterwards on the &quot;backup VM&quot; would not influence the SAP HANA system at all.</span><span class="sxs-lookup"><span data-stu-id="24968-214">Writing on an NFS share puts load on the network and impacts the SAP HANA system, but merely managing the backup files afterwards on the &quot;backup VM&quot; would not influence the SAP HANA system at all.</span></span>

![An NFS share from another Azure VM was mounted to the SAP HANA server VM](media/sap-hana-backup-file-level/image035.png)

<span data-ttu-id="24968-216">To verify the NFS use case, an NFS share from another Azure VM was mounted to the SAP HANA server VM.</span><span class="sxs-lookup"><span data-stu-id="24968-216">To verify the NFS use case, an NFS share from another Azure VM was mounted to the SAP HANA server VM.</span></span> <span data-ttu-id="24968-217">There was no special NFS tuning applied.</span><span class="sxs-lookup"><span data-stu-id="24968-217">There was no special NFS tuning applied.</span></span>

![It took 1 hour and 46 minutes to do the backup directly](media/sap-hana-backup-file-level/image036.png)

<span data-ttu-id="24968-219">The NFS share was a fast stripe set, like the one on the SAP HANA server.</span><span class="sxs-lookup"><span data-stu-id="24968-219">The NFS share was a fast stripe set, like the one on the SAP HANA server.</span></span> <span data-ttu-id="24968-220">Nevertheless, it took 1 hour and 46 minutes to do the backup directly on the NFS share instead of 10 minutes, when writing to a local stripe set.</span><span class="sxs-lookup"><span data-stu-id="24968-220">Nevertheless, it took 1 hour and 46 minutes to do the backup directly on the NFS share instead of 10 minutes, when writing to a local stripe set.</span></span>

![The alternative wasn't much quicker at 1 hour and 43 minutes](media/sap-hana-backup-file-level/image037.png)

<span data-ttu-id="24968-222">The alternative of doing a backup to a local stripe set and copying to the NFS share on OS level (a simple **cp -avr** command) wasn't much quicker.</span><span class="sxs-lookup"><span data-stu-id="24968-222">The alternative of doing a backup to a local stripe set and copying to the NFS share on OS level (a simple **cp -avr** command) wasn't much quicker.</span></span> <span data-ttu-id="24968-223">It took 1 hour and 43 minutes.</span><span class="sxs-lookup"><span data-stu-id="24968-223">It took 1 hour and 43 minutes.</span></span>

<span data-ttu-id="24968-224">So it works, but performance wasn't good for the 230-GB backup test.</span><span class="sxs-lookup"><span data-stu-id="24968-224">So it works, but performance wasn't good for the 230-GB backup test.</span></span> <span data-ttu-id="24968-225">It would look even worse for multi terabytes.</span><span class="sxs-lookup"><span data-stu-id="24968-225">It would look even worse for multi terabytes.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-files"></a><span data-ttu-id="24968-226">Copy SAP HANA backup files to Azure Files</span><span class="sxs-lookup"><span data-stu-id="24968-226">Copy SAP HANA backup files to Azure Files</span></span>

<span data-ttu-id="24968-227">It is possible to mount an Azure Files share inside an Azure Linux VM.</span><span class="sxs-lookup"><span data-stu-id="24968-227">It is possible to mount an Azure Files share inside an Azure Linux VM.</span></span> <span data-ttu-id="24968-228">The article [How to use Azure File storage with Linux](../../../storage/files/storage-how-to-use-files-linux.md) provides details on how to do it.</span><span class="sxs-lookup"><span data-stu-id="24968-228">The article [How to use Azure File storage with Linux](../../../storage/files/storage-how-to-use-files-linux.md) provides details on how to do it.</span></span> <span data-ttu-id="24968-229">Keep in mind that there is currently a 5-TB quota limit of one Azure file share, and a file size limit of 1 TB per file.</span><span class="sxs-lookup"><span data-stu-id="24968-229">Keep in mind that there is currently a 5-TB quota limit of one Azure file share, and a file size limit of 1 TB per file.</span></span> <span data-ttu-id="24968-230">See [Azure Storage Scalability and Performance Targets](../../../storage/common/storage-scalability-targets.md) for information on storage limits.</span><span class="sxs-lookup"><span data-stu-id="24968-230">See [Azure Storage Scalability and Performance Targets](../../../storage/common/storage-scalability-targets.md) for information on storage limits.</span></span>

<span data-ttu-id="24968-231">Tests have shown, however, that SAP HANA backup doesn&#39;t currently work directly with this kind of CIFS mount.</span><span class="sxs-lookup"><span data-stu-id="24968-231">Tests have shown, however, that SAP HANA backup doesn&#39;t currently work directly with this kind of CIFS mount.</span></span> <span data-ttu-id="24968-232">It is also stated in [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529) that CIFS is not recommended.</span><span class="sxs-lookup"><span data-stu-id="24968-232">It is also stated in [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529) that CIFS is not recommended.</span></span>

![This figure shows an error in the backup dialog in SAP HANA Studio](media/sap-hana-backup-file-level/image038.png)

<span data-ttu-id="24968-234">This figure shows an error in the backup dialog in SAP HANA Studio, when trying to back up directly to a CIFS-mounted Azure file share.</span><span class="sxs-lookup"><span data-stu-id="24968-234">This figure shows an error in the backup dialog in SAP HANA Studio, when trying to back up directly to a CIFS-mounted Azure file share.</span></span> <span data-ttu-id="24968-235">So one has to do a standard SAP HANA backup into a VM file system first, and then copy the backup files from there to Azure file service.</span><span class="sxs-lookup"><span data-stu-id="24968-235">So one has to do a standard SAP HANA backup into a VM file system first, and then copy the backup files from there to Azure file service.</span></span>

![This figure shows that it took about 929 seconds to copy 19 SAP HANA backup files](media/sap-hana-backup-file-level/image039.png)

<span data-ttu-id="24968-237">This figure shows that it took about 929 seconds to copy 19 SAP HANA backup files with a total size of roughly 230 GB to the Azure file share.</span><span class="sxs-lookup"><span data-stu-id="24968-237">This figure shows that it took about 929 seconds to copy 19 SAP HANA backup files with a total size of roughly 230 GB to the Azure file share.</span></span>

![The source directory structure on the SAP HANA VM was copied to the Azure file share](media/sap-hana-backup-file-level/image040.png)

<span data-ttu-id="24968-239">In this screenshot, one can see that the source directory structure on the SAP HANA VM was copied to the Azure file share: one directory (hana\_backup\_fsl\_15gb) and 19 individual backup files.</span><span class="sxs-lookup"><span data-stu-id="24968-239">In this screenshot, one can see that the source directory structure on the SAP HANA VM was copied to the Azure file share: one directory (hana\_backup\_fsl\_15gb) and 19 individual backup files.</span></span>

<span data-ttu-id="24968-240">Storing SAP HANA backup files on Azure files could be an interesting option in the future when SAP HANA file backups support it directly.</span><span class="sxs-lookup"><span data-stu-id="24968-240">Storing SAP HANA backup files on Azure files could be an interesting option in the future when SAP HANA file backups support it directly.</span></span> <span data-ttu-id="24968-241">Or when it becomes possible to mount Azure files via NFS and the maximum quota limit is considerably higher than 5 TB.</span><span class="sxs-lookup"><span data-stu-id="24968-241">Or when it becomes possible to mount Azure files via NFS and the maximum quota limit is considerably higher than 5 TB.</span></span>

## <a name="next-steps"></a><span data-ttu-id="24968-242">Next steps</span><span class="sxs-lookup"><span data-stu-id="24968-242">Next steps</span></span>
* <span data-ttu-id="24968-243">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span><span class="sxs-lookup"><span data-stu-id="24968-243">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="24968-244">[SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describes the storage snapshot-based backup option.</span><span class="sxs-lookup"><span data-stu-id="24968-244">[SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describes the storage snapshot-based backup option.</span></span>
* <span data-ttu-id="24968-245">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="24968-245">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
