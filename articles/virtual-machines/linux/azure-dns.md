---
title: DNS Name resolution options for Linux VMs in Azure
description: Name Resolution scenarios for Linux VMs in Azure IaaS, including provided DNS services, Hybrid external DNS and Bring Your Own DNS server.
services: virtual-machines
documentationcenter: na
author: RicksterCDN
manager: timlt
editor: tysonn
ms.assetid: 787a1e04-cebf-4122-a1b4-1fcf0a2bbf5f
ms.service: virtual-machines-linux
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/19/2016
ms.author: rclaus
ms.openlocfilehash: b37fbd59946f22911feaf3f5c552a6071184a281
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44564145"
---
# <a name="dns-name-resolution-options-for-linux-vms-in-azure"></a><span data-ttu-id="5c56e-103">DNS Name Resolution Options for Linux VMs in Azure</span><span class="sxs-lookup"><span data-stu-id="5c56e-103">DNS Name Resolution Options for Linux VMs in Azure</span></span>
<span data-ttu-id="5c56e-104">Azure provides DNS name resolution by default for all VMs contained within a single Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="5c56e-104">Azure provides DNS name resolution by default for all VMs contained within a single Virtual Network.</span></span> <span data-ttu-id="5c56e-105">You are able to implement your own DNS name resolution solution by configuring your own DNS services on your Azure hosted VMs.</span><span class="sxs-lookup"><span data-stu-id="5c56e-105">You are able to implement your own DNS name resolution solution by configuring your own DNS services on your Azure hosted VMs.</span></span> <span data-ttu-id="5c56e-106">The following scenarios should help you choose which one works better for your particular situation.</span><span class="sxs-lookup"><span data-stu-id="5c56e-106">The following scenarios should help you choose which one works better for your particular situation.</span></span>

* [<span data-ttu-id="5c56e-107">Azure-provided name resolution</span><span class="sxs-lookup"><span data-stu-id="5c56e-107">Azure-provided name resolution</span></span>](#azure-provided-name-resolution)
* [<span data-ttu-id="5c56e-108">Name resolution using your own DNS server</span><span class="sxs-lookup"><span data-stu-id="5c56e-108">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server) 

<span data-ttu-id="5c56e-109">The type of name resolution you use depends on how your VMs and role instances need to communicate with each other.</span><span class="sxs-lookup"><span data-stu-id="5c56e-109">The type of name resolution you use depends on how your VMs and role instances need to communicate with each other.</span></span>

<span data-ttu-id="5c56e-110">**The following table illustrates scenarios and corresponding name resolution solutions:**</span><span class="sxs-lookup"><span data-stu-id="5c56e-110">**The following table illustrates scenarios and corresponding name resolution solutions:**</span></span>

| <span data-ttu-id="5c56e-111">**Scenario**</span><span class="sxs-lookup"><span data-stu-id="5c56e-111">**Scenario**</span></span> | <span data-ttu-id="5c56e-112">**Solution**</span><span class="sxs-lookup"><span data-stu-id="5c56e-112">**Solution**</span></span> | <span data-ttu-id="5c56e-113">**Suffix**</span><span class="sxs-lookup"><span data-stu-id="5c56e-113">**Suffix**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="5c56e-114">Name resolution between role instances or VMs located in the same virtual network</span><span class="sxs-lookup"><span data-stu-id="5c56e-114">Name resolution between role instances or VMs located in the same virtual network</span></span> |[<span data-ttu-id="5c56e-115">Azure-provided name resolution</span><span class="sxs-lookup"><span data-stu-id="5c56e-115">Azure-provided name resolution</span></span>](#azure-provided-name-resolution) |<span data-ttu-id="5c56e-116">hostname or FQDN</span><span class="sxs-lookup"><span data-stu-id="5c56e-116">hostname or FQDN</span></span> |
| <span data-ttu-id="5c56e-117">Name resolution between role instances or VMs located in different virtual networks</span><span class="sxs-lookup"><span data-stu-id="5c56e-117">Name resolution between role instances or VMs located in different virtual networks</span></span> |<span data-ttu-id="5c56e-118">Customer-managed DNS servers forwarding queries between vnets for resolution by Azure (DNS proxy).</span><span class="sxs-lookup"><span data-stu-id="5c56e-118">Customer-managed DNS servers forwarding queries between vnets for resolution by Azure (DNS proxy).</span></span>  <span data-ttu-id="5c56e-119">see [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="5c56e-119">see [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="5c56e-120">FQDN only</span><span class="sxs-lookup"><span data-stu-id="5c56e-120">FQDN only</span></span> |
| <span data-ttu-id="5c56e-121">Resolution of on-premises computer and service names from role instances or VMs in Azure</span><span class="sxs-lookup"><span data-stu-id="5c56e-121">Resolution of on-premises computer and service names from role instances or VMs in Azure</span></span> |<span data-ttu-id="5c56e-122">Customer-managed DNS servers (for example, on-premise domain controller, local read-only domain controller, or a DNS secondary synced using zone transfers).</span><span class="sxs-lookup"><span data-stu-id="5c56e-122">Customer-managed DNS servers (for example, on-premise domain controller, local read-only domain controller, or a DNS secondary synced using zone transfers).</span></span>  <span data-ttu-id="5c56e-123">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="5c56e-123">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="5c56e-124">FQDN only</span><span class="sxs-lookup"><span data-stu-id="5c56e-124">FQDN only</span></span> |
| <span data-ttu-id="5c56e-125">Resolution of Azure hostnames from on-premise computers</span><span class="sxs-lookup"><span data-stu-id="5c56e-125">Resolution of Azure hostnames from on-premise computers</span></span> |<span data-ttu-id="5c56e-126">Forward queries to a customer-managed DNS proxy server in the corresponding vnet, the proxy server forwards queries to Azure for resolution.</span><span class="sxs-lookup"><span data-stu-id="5c56e-126">Forward queries to a customer-managed DNS proxy server in the corresponding vnet, the proxy server forwards queries to Azure for resolution.</span></span> <span data-ttu-id="5c56e-127">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span><span class="sxs-lookup"><span data-stu-id="5c56e-127">See [Name resolution using your own DNS server](#name-resolution-using-your-own-dns-server)</span></span> |<span data-ttu-id="5c56e-128">FQDN only</span><span class="sxs-lookup"><span data-stu-id="5c56e-128">FQDN only</span></span> |
| <span data-ttu-id="5c56e-129">Reverse DNS for internal IPs</span><span class="sxs-lookup"><span data-stu-id="5c56e-129">Reverse DNS for internal IPs</span></span> |[<span data-ttu-id="5c56e-130">Name resolution using your own DNS server</span><span class="sxs-lookup"><span data-stu-id="5c56e-130">Name resolution using your own DNS server</span></span>](#name-resolution-using-your-own-dns-server) |<span data-ttu-id="5c56e-131">n/a</span><span class="sxs-lookup"><span data-stu-id="5c56e-131">n/a</span></span> |

## <a name="azure-provided-name-resolution"></a><span data-ttu-id="5c56e-132">Azure-provided name resolution</span><span class="sxs-lookup"><span data-stu-id="5c56e-132">Azure-provided name resolution</span></span>
<span data-ttu-id="5c56e-133">Along with resolution of public DNS names, Azure provides internal name resolution for VMs and role instances that reside within the same virtual network.</span><span class="sxs-lookup"><span data-stu-id="5c56e-133">Along with resolution of public DNS names, Azure provides internal name resolution for VMs and role instances that reside within the same virtual network.</span></span>  <span data-ttu-id="5c56e-134">In ARM-based virtual networks, the DNS suffix is consistent across the virtual network (so the FQDN is not needed) and DNS names can be assigned to both NICs and VMs.</span><span class="sxs-lookup"><span data-stu-id="5c56e-134">In ARM-based virtual networks, the DNS suffix is consistent across the virtual network (so the FQDN is not needed) and DNS names can be assigned to both NICs and VMs.</span></span> <span data-ttu-id="5c56e-135">Although Azure-provided name resolution does not require any configuration, it is not the appropriate choice for all deployment scenarios, as seen on the preceding table.</span><span class="sxs-lookup"><span data-stu-id="5c56e-135">Although Azure-provided name resolution does not require any configuration, it is not the appropriate choice for all deployment scenarios, as seen on the preceding table.</span></span>

### <a name="features-and-considerations"></a><span data-ttu-id="5c56e-136">Features and Considerations</span><span class="sxs-lookup"><span data-stu-id="5c56e-136">Features and Considerations</span></span>
<span data-ttu-id="5c56e-137">**Features:**</span><span class="sxs-lookup"><span data-stu-id="5c56e-137">**Features:**</span></span>

* <span data-ttu-id="5c56e-138">Ease of use: No configuration is required to use Azure-provided name resolution.</span><span class="sxs-lookup"><span data-stu-id="5c56e-138">Ease of use: No configuration is required to use Azure-provided name resolution.</span></span>
* <span data-ttu-id="5c56e-139">The Azure-provided name resolution service is highly available, saving you the need to create and manage clusters of your own DNS servers.</span><span class="sxs-lookup"><span data-stu-id="5c56e-139">The Azure-provided name resolution service is highly available, saving you the need to create and manage clusters of your own DNS servers.</span></span>
* <span data-ttu-id="5c56e-140">Can be used along with your own DNS servers to resolve both on-premise and Azure hostnames.</span><span class="sxs-lookup"><span data-stu-id="5c56e-140">Can be used along with your own DNS servers to resolve both on-premise and Azure hostnames.</span></span>
* <span data-ttu-id="5c56e-141">Name resolution is provided between VMs in virtual networks without need for the FQDN.</span><span class="sxs-lookup"><span data-stu-id="5c56e-141">Name resolution is provided between VMs in virtual networks without need for the FQDN.</span></span> 
* <span data-ttu-id="5c56e-142">You can use hostnames that best describe your deployments, rather than working with auto-generated names.</span><span class="sxs-lookup"><span data-stu-id="5c56e-142">You can use hostnames that best describe your deployments, rather than working with auto-generated names.</span></span>

<span data-ttu-id="5c56e-143">**Considerations:**</span><span class="sxs-lookup"><span data-stu-id="5c56e-143">**Considerations:**</span></span>

* <span data-ttu-id="5c56e-144">The Azure-created DNS suffix cannot be modified.</span><span class="sxs-lookup"><span data-stu-id="5c56e-144">The Azure-created DNS suffix cannot be modified.</span></span>
* <span data-ttu-id="5c56e-145">You cannot manually register your own records.</span><span class="sxs-lookup"><span data-stu-id="5c56e-145">You cannot manually register your own records.</span></span>
* <span data-ttu-id="5c56e-146">WINS and NetBIOS are not supported.</span><span class="sxs-lookup"><span data-stu-id="5c56e-146">WINS and NetBIOS are not supported.</span></span>
* <span data-ttu-id="5c56e-147">Hostnames must be DNS-compatible (They must use only 0-9, a-z and '-', and cannot start or end with a '-'.</span><span class="sxs-lookup"><span data-stu-id="5c56e-147">Hostnames must be DNS-compatible (They must use only 0-9, a-z and '-', and cannot start or end with a '-'.</span></span> <span data-ttu-id="5c56e-148">See RFC 3696 section 2.)</span><span class="sxs-lookup"><span data-stu-id="5c56e-148">See RFC 3696 section 2.)</span></span>
* <span data-ttu-id="5c56e-149">DNS query traffic is throttled for each VM.</span><span class="sxs-lookup"><span data-stu-id="5c56e-149">DNS query traffic is throttled for each VM.</span></span> <span data-ttu-id="5c56e-150">This shouldn't impact most applications.</span><span class="sxs-lookup"><span data-stu-id="5c56e-150">This shouldn't impact most applications.</span></span>  <span data-ttu-id="5c56e-151">If request throttling is observed, ensure that client-side caching is enabled.</span><span class="sxs-lookup"><span data-stu-id="5c56e-151">If request throttling is observed, ensure that client-side caching is enabled.</span></span>  <span data-ttu-id="5c56e-152">For more information, see [Getting the most from Azure-provided name resolution](#Getting-the-most-from-Azure-provided-name-resolution).</span><span class="sxs-lookup"><span data-stu-id="5c56e-152">For more information, see [Getting the most from Azure-provided name resolution](#Getting-the-most-from-Azure-provided-name-resolution).</span></span>

### <a name="getting-the-most-from-azure-provided-name-resolution"></a><span data-ttu-id="5c56e-153">Getting the most from Azure-provided name resolution</span><span class="sxs-lookup"><span data-stu-id="5c56e-153">Getting the most from Azure-provided name resolution</span></span>
<span data-ttu-id="5c56e-154">**Client-side Caching:**</span><span class="sxs-lookup"><span data-stu-id="5c56e-154">**Client-side Caching:**</span></span>

<span data-ttu-id="5c56e-155">Not every DNS query is sent across the network.</span><span class="sxs-lookup"><span data-stu-id="5c56e-155">Not every DNS query is sent across the network.</span></span>  <span data-ttu-id="5c56e-156">Client-side caching helps reduce latency and improve resilience to network blips by resolving recurring DNS queries from a local cache.</span><span class="sxs-lookup"><span data-stu-id="5c56e-156">Client-side caching helps reduce latency and improve resilience to network blips by resolving recurring DNS queries from a local cache.</span></span>  <span data-ttu-id="5c56e-157">DNS records contain a Time-To-Live (TTL) which allows the cache to store the record for as long as possible without impacting record freshness.</span><span class="sxs-lookup"><span data-stu-id="5c56e-157">DNS records contain a Time-To-Live (TTL) which allows the cache to store the record for as long as possible without impacting record freshness.</span></span>  <span data-ttu-id="5c56e-158">Because of this, client-side caching is suitable for most situations.</span><span class="sxs-lookup"><span data-stu-id="5c56e-158">Because of this, client-side caching is suitable for most situations.</span></span>

<span data-ttu-id="5c56e-159">Some Linux distros do not include caching by default.</span><span class="sxs-lookup"><span data-stu-id="5c56e-159">Some Linux distros do not include caching by default.</span></span>  <span data-ttu-id="5c56e-160">It is recommended you add one to each Linux VM (after checking that there isn't a local cache already).</span><span class="sxs-lookup"><span data-stu-id="5c56e-160">It is recommended you add one to each Linux VM (after checking that there isn't a local cache already).</span></span>

<span data-ttu-id="5c56e-161">There are several different DNS caching packages available, for example dnsmasq, here are the steps to install dnsmasq on the most common distros:</span><span class="sxs-lookup"><span data-stu-id="5c56e-161">There are several different DNS caching packages available, for example dnsmasq, here are the steps to install dnsmasq on the most common distros:</span></span>

* <span data-ttu-id="5c56e-162">**Ubuntu (uses resolvconf)**:</span><span class="sxs-lookup"><span data-stu-id="5c56e-162">**Ubuntu (uses resolvconf)**:</span></span>
  * <span data-ttu-id="5c56e-163">install the dnsmasq package (“sudo apt-get install dnsmasq”).</span><span class="sxs-lookup"><span data-stu-id="5c56e-163">install the dnsmasq package (“sudo apt-get install dnsmasq”).</span></span>
* <span data-ttu-id="5c56e-164">**SUSE (uses netconf)**:</span><span class="sxs-lookup"><span data-stu-id="5c56e-164">**SUSE (uses netconf)**:</span></span>
  * <span data-ttu-id="5c56e-165">install the dnsmasq package (“sudo zypper install dnsmasq”)</span><span class="sxs-lookup"><span data-stu-id="5c56e-165">install the dnsmasq package (“sudo zypper install dnsmasq”)</span></span> 
  * <span data-ttu-id="5c56e-166">enable the dnsmasq service (“systemctl enable dnsmasq.service”)</span><span class="sxs-lookup"><span data-stu-id="5c56e-166">enable the dnsmasq service (“systemctl enable dnsmasq.service”)</span></span> 
  * <span data-ttu-id="5c56e-167">start the dnsmasq service (“systemctl start dnsmasq.service”)</span><span class="sxs-lookup"><span data-stu-id="5c56e-167">start the dnsmasq service (“systemctl start dnsmasq.service”)</span></span> 
  * <span data-ttu-id="5c56e-168">edit “/etc/sysconfig/network/config” and change NETCONFIG_DNS_FORWARDER="" to ”dnsmasq”</span><span class="sxs-lookup"><span data-stu-id="5c56e-168">edit “/etc/sysconfig/network/config” and change NETCONFIG_DNS_FORWARDER="" to ”dnsmasq”</span></span>
  * <span data-ttu-id="5c56e-169">update resolv.conf ("netconfig update") to set the cache as the local DNS resolver</span><span class="sxs-lookup"><span data-stu-id="5c56e-169">update resolv.conf ("netconfig update") to set the cache as the local DNS resolver</span></span>
* <span data-ttu-id="5c56e-170">**OpenLogic (uses NetworkManager)**:</span><span class="sxs-lookup"><span data-stu-id="5c56e-170">**OpenLogic (uses NetworkManager)**:</span></span>
  * <span data-ttu-id="5c56e-171">install the dnsmasq package (“sudo yum install dnsmasq”)</span><span class="sxs-lookup"><span data-stu-id="5c56e-171">install the dnsmasq package (“sudo yum install dnsmasq”)</span></span>
  * <span data-ttu-id="5c56e-172">enable the dnsmasq service (“systemctl enable dnsmasq.service”)</span><span class="sxs-lookup"><span data-stu-id="5c56e-172">enable the dnsmasq service (“systemctl enable dnsmasq.service”)</span></span>
  * <span data-ttu-id="5c56e-173">start the dnsmasq service (“systemctl start dnsmasq.service”)</span><span class="sxs-lookup"><span data-stu-id="5c56e-173">start the dnsmasq service (“systemctl start dnsmasq.service”)</span></span>
  * <span data-ttu-id="5c56e-174">add “prepend domain-name-servers 127.0.0.1;” to “/etc/dhclient-eth0.conf”</span><span class="sxs-lookup"><span data-stu-id="5c56e-174">add “prepend domain-name-servers 127.0.0.1;” to “/etc/dhclient-eth0.conf”</span></span>
  * <span data-ttu-id="5c56e-175">restart the network service (“service network restart”) to set the cache as the local DNS resolver</span><span class="sxs-lookup"><span data-stu-id="5c56e-175">restart the network service (“service network restart”) to set the cache as the local DNS resolver</span></span>

> [!NOTE]
> <span data-ttu-id="5c56e-176">: The 'dnsmasq' package is only one of the many DNS caches available for Linux.</span><span class="sxs-lookup"><span data-stu-id="5c56e-176">: The 'dnsmasq' package is only one of the many DNS caches available for Linux.</span></span>  <span data-ttu-id="5c56e-177">Before using it, check its suitability for your particular needs and that no other cache is installed.</span><span class="sxs-lookup"><span data-stu-id="5c56e-177">Before using it, check its suitability for your particular needs and that no other cache is installed.</span></span>
> 
> 

<span data-ttu-id="5c56e-178">**Client-side Retries:**</span><span class="sxs-lookup"><span data-stu-id="5c56e-178">**Client-side Retries:**</span></span>

<span data-ttu-id="5c56e-179">DNS is primarily a UDP protocol.</span><span class="sxs-lookup"><span data-stu-id="5c56e-179">DNS is primarily a UDP protocol.</span></span>  <span data-ttu-id="5c56e-180">As the UDP protocol doesn't guarantee message delivery, retry logic is handled in the DNS protocol itself.</span><span class="sxs-lookup"><span data-stu-id="5c56e-180">As the UDP protocol doesn't guarantee message delivery, retry logic is handled in the DNS protocol itself.</span></span>  <span data-ttu-id="5c56e-181">Each DNS client (operating system) can exhibit different retry logic depending on the creators preference:</span><span class="sxs-lookup"><span data-stu-id="5c56e-181">Each DNS client (operating system) can exhibit different retry logic depending on the creators preference:</span></span>

* <span data-ttu-id="5c56e-182">Windows operating systems retry after one second and then again after another two, four and another four seconds.</span><span class="sxs-lookup"><span data-stu-id="5c56e-182">Windows operating systems retry after one second and then again after another two, four and another four seconds.</span></span> 
* <span data-ttu-id="5c56e-183">The default Linux setup retries after five seconds.</span><span class="sxs-lookup"><span data-stu-id="5c56e-183">The default Linux setup retries after five seconds.</span></span>  <span data-ttu-id="5c56e-184">You should change this to retry five times at one-second intervals.</span><span class="sxs-lookup"><span data-stu-id="5c56e-184">You should change this to retry five times at one-second intervals.</span></span>  

<span data-ttu-id="5c56e-185">To check the current settings on a Linux VM, 'cat /etc/resolv.conf' and look at the 'options' line, for example:</span><span class="sxs-lookup"><span data-stu-id="5c56e-185">To check the current settings on a Linux VM, 'cat /etc/resolv.conf' and look at the 'options' line, for example:</span></span>

    options timeout:1 attempts:5

<span data-ttu-id="5c56e-186">The resolv.conf file is auto-generated and should not be edited.</span><span class="sxs-lookup"><span data-stu-id="5c56e-186">The resolv.conf file is auto-generated and should not be edited.</span></span>  <span data-ttu-id="5c56e-187">The specific steps for adding the 'options' line vary by distro:</span><span class="sxs-lookup"><span data-stu-id="5c56e-187">The specific steps for adding the 'options' line vary by distro:</span></span>

* <span data-ttu-id="5c56e-188">**Ubuntu** (uses resolvconf):</span><span class="sxs-lookup"><span data-stu-id="5c56e-188">**Ubuntu** (uses resolvconf):</span></span>
  * <span data-ttu-id="5c56e-189">add the options line to '/etc/resolveconf/resolv.conf.d/head'</span><span class="sxs-lookup"><span data-stu-id="5c56e-189">add the options line to '/etc/resolveconf/resolv.conf.d/head'</span></span> 
  * <span data-ttu-id="5c56e-190">run 'resolvconf -u' to update</span><span class="sxs-lookup"><span data-stu-id="5c56e-190">run 'resolvconf -u' to update</span></span>
* <span data-ttu-id="5c56e-191">**SUSE** (uses netconf):</span><span class="sxs-lookup"><span data-stu-id="5c56e-191">**SUSE** (uses netconf):</span></span>
  * <span data-ttu-id="5c56e-192">add 'timeout:1 attempts:5' to the NETCONFIG_DNS_RESOLVER_OPTIONS="" parameter in '/etc/sysconfig/network/config'</span><span class="sxs-lookup"><span data-stu-id="5c56e-192">add 'timeout:1 attempts:5' to the NETCONFIG_DNS_RESOLVER_OPTIONS="" parameter in '/etc/sysconfig/network/config'</span></span> 
  * <span data-ttu-id="5c56e-193">run 'netconfig update' to update</span><span class="sxs-lookup"><span data-stu-id="5c56e-193">run 'netconfig update' to update</span></span>
* <span data-ttu-id="5c56e-194">**OpenLogic** (uses NetworkManager):</span><span class="sxs-lookup"><span data-stu-id="5c56e-194">**OpenLogic** (uses NetworkManager):</span></span>
  * <span data-ttu-id="5c56e-195">add 'echo "options timeout:1 attempts:5"' to '/etc/NetworkManager/dispatcher.d/11-dhclient'</span><span class="sxs-lookup"><span data-stu-id="5c56e-195">add 'echo "options timeout:1 attempts:5"' to '/etc/NetworkManager/dispatcher.d/11-dhclient'</span></span> 
  * <span data-ttu-id="5c56e-196">run 'service network restart' to update</span><span class="sxs-lookup"><span data-stu-id="5c56e-196">run 'service network restart' to update</span></span>

## <a name="name-resolution-using-your-own-dns-server"></a><span data-ttu-id="5c56e-197">Name resolution using your own DNS server</span><span class="sxs-lookup"><span data-stu-id="5c56e-197">Name resolution using your own DNS server</span></span>
<span data-ttu-id="5c56e-198">There are several situations where your name resolution needs may go beyond the features provided by Azure, for example when you require DNS resolution between virtual networks (vnets).</span><span class="sxs-lookup"><span data-stu-id="5c56e-198">There are several situations where your name resolution needs may go beyond the features provided by Azure, for example when you require DNS resolution between virtual networks (vnets).</span></span>  <span data-ttu-id="5c56e-199">To cover this scenario, Azure provides the ability for you to use your own DNS servers.</span><span class="sxs-lookup"><span data-stu-id="5c56e-199">To cover this scenario, Azure provides the ability for you to use your own DNS servers.</span></span>  

<span data-ttu-id="5c56e-200">DNS servers within a virtual network can forward DNS queries to Azure's recursive resolvers to resolve hostnames within that virtual network.</span><span class="sxs-lookup"><span data-stu-id="5c56e-200">DNS servers within a virtual network can forward DNS queries to Azure's recursive resolvers to resolve hostnames within that virtual network.</span></span>  <span data-ttu-id="5c56e-201">For example, a DNS server running in Azure can respond to DNS queries for its own DNS zone files and forward all other queries to Azure.</span><span class="sxs-lookup"><span data-stu-id="5c56e-201">For example, a DNS server running in Azure can respond to DNS queries for its own DNS zone files and forward all other queries to Azure.</span></span>  <span data-ttu-id="5c56e-202">This allows VMs to see both your entries in your zone files and Azure-provided hostnames (via the forwarder).</span><span class="sxs-lookup"><span data-stu-id="5c56e-202">This allows VMs to see both your entries in your zone files and Azure-provided hostnames (via the forwarder).</span></span>  <span data-ttu-id="5c56e-203">Access to Azure's recursive resolvers is provided via the virtual IP 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="5c56e-203">Access to Azure's recursive resolvers is provided via the virtual IP 168.63.129.16.</span></span>

<span data-ttu-id="5c56e-204">DNS forwarding also enables inter-vnet DNS resolution and allows your on-premise machines to resolve Azure-provided hostnames.</span><span class="sxs-lookup"><span data-stu-id="5c56e-204">DNS forwarding also enables inter-vnet DNS resolution and allows your on-premise machines to resolve Azure-provided hostnames.</span></span>  <span data-ttu-id="5c56e-205">To resolve a VM's hostname, the DNS server VM must reside in the same virtual network and be configured to forward hostname queries to Azure.</span><span class="sxs-lookup"><span data-stu-id="5c56e-205">To resolve a VM's hostname, the DNS server VM must reside in the same virtual network and be configured to forward hostname queries to Azure.</span></span>  <span data-ttu-id="5c56e-206">As the DNS suffix is different in each vnet, you can use conditional forwarding rules to send DNS queries to the correct vnet for resolution.</span><span class="sxs-lookup"><span data-stu-id="5c56e-206">As the DNS suffix is different in each vnet, you can use conditional forwarding rules to send DNS queries to the correct vnet for resolution.</span></span>  <span data-ttu-id="5c56e-207">The following image shows two vnets and an on-premise network doing inter-vnet DNS resolution using this method:</span><span class="sxs-lookup"><span data-stu-id="5c56e-207">The following image shows two vnets and an on-premise network doing inter-vnet DNS resolution using this method:</span></span>

![Inter-vnet DNS](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/linux/media/azure-dns/inter-vnet-dns.png)

<span data-ttu-id="5c56e-209">When using Azure-provided name resolution, the Internal DNS suffix is provided to each VM using DHCP.</span><span class="sxs-lookup"><span data-stu-id="5c56e-209">When using Azure-provided name resolution, the Internal DNS suffix is provided to each VM using DHCP.</span></span>  <span data-ttu-id="5c56e-210">When using your own name resolution solution, this suffix is not supplied to VMs because it interferes with other DNS architectures.</span><span class="sxs-lookup"><span data-stu-id="5c56e-210">When using your own name resolution solution, this suffix is not supplied to VMs because it interferes with other DNS architectures.</span></span>  <span data-ttu-id="5c56e-211">To refer to machines by FQDN, or to configure the suffix on your VMs, the suffix can be determined using PowerShell or the API:</span><span class="sxs-lookup"><span data-stu-id="5c56e-211">To refer to machines by FQDN, or to configure the suffix on your VMs, the suffix can be determined using PowerShell or the API:</span></span>

* <span data-ttu-id="5c56e-212">For Azure Resource Management managed vnets, the suffix is available via the [network interface card](https://msdn.microsoft.com/library/azure/mt163668.aspx) resource or you can run the command `azure network public-ip show <resource group> <pip name>` to display the details of your public IP, including the FQDN of the nic.</span><span class="sxs-lookup"><span data-stu-id="5c56e-212">For Azure Resource Management managed vnets, the suffix is available via the [network interface card](https://msdn.microsoft.com/library/azure/mt163668.aspx) resource or you can run the command `azure network public-ip show <resource group> <pip name>` to display the details of your public IP, including the FQDN of the nic.</span></span>    

<span data-ttu-id="5c56e-213">If forwarding queries to Azure doesn't suit your needs, you need to provide your own DNS solution.</span><span class="sxs-lookup"><span data-stu-id="5c56e-213">If forwarding queries to Azure doesn't suit your needs, you need to provide your own DNS solution.</span></span>  <span data-ttu-id="5c56e-214">Your DNS solution needs to:</span><span class="sxs-lookup"><span data-stu-id="5c56e-214">Your DNS solution needs to:</span></span>

* <span data-ttu-id="5c56e-215">Provide appropriate hostname resolution, for example via [DDNS](../../virtual-network/virtual-networks-name-resolution-ddns.md).</span><span class="sxs-lookup"><span data-stu-id="5c56e-215">Provide appropriate hostname resolution, for example via [DDNS](../../virtual-network/virtual-networks-name-resolution-ddns.md).</span></span>  <span data-ttu-id="5c56e-216">Note, if using DDNS you may need to disable DNS record scavenging as Azure's DHCP leases are very long and scavenging may remove DNS records prematurely.</span><span class="sxs-lookup"><span data-stu-id="5c56e-216">Note, if using DDNS you may need to disable DNS record scavenging as Azure's DHCP leases are very long and scavenging may remove DNS records prematurely.</span></span> 
* <span data-ttu-id="5c56e-217">Provide appropriate recursive resolution to allow resolution of external domain names.</span><span class="sxs-lookup"><span data-stu-id="5c56e-217">Provide appropriate recursive resolution to allow resolution of external domain names.</span></span>
* <span data-ttu-id="5c56e-218">Be accessible (TCP and UDP on port 53) from the clients it serves and be able to access the internet.</span><span class="sxs-lookup"><span data-stu-id="5c56e-218">Be accessible (TCP and UDP on port 53) from the clients it serves and be able to access the internet.</span></span>
* <span data-ttu-id="5c56e-219">Be secured against access from the internet, to mitigate threats posed by external agents.</span><span class="sxs-lookup"><span data-stu-id="5c56e-219">Be secured against access from the internet, to mitigate threats posed by external agents.</span></span>

> [!NOTE]
> <span data-ttu-id="5c56e-220">For best performance, when using Azure VMs as DNS servers, IPv6 should be disabled and an [Instance-Level Public IP](../../virtual-network/virtual-networks-instance-level-public-ip.md) should be assigned to each DNS server VM.</span><span class="sxs-lookup"><span data-stu-id="5c56e-220">For best performance, when using Azure VMs as DNS servers, IPv6 should be disabled and an [Instance-Level Public IP](../../virtual-network/virtual-networks-instance-level-public-ip.md) should be assigned to each DNS server VM.</span></span>  
> 
> 


