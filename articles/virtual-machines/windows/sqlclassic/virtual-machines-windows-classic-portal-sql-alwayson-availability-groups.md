---
title: Configure Always On availability group in Azure Virtual Machines (classic) | Microsoft Docs
description: Create an Always On availability group with Azure Virtual Machines. This tutorial primarily uses the user interface and tools rather than scripting.
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: ''
tags: azure-service-management
ms.assetid: 8d48a3d2-79f8-4ab0-9327-2f30ee0b2ff1
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 03/17/2017
ms.author: mikeray
ms.openlocfilehash: 1a89787fb9bc04ae8ed2e3aad7a815a0fa313cb2
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44551276"
---
# <a name="configure-always-on-availability-group-in-azure-virtual-machines-classic"></a><span data-ttu-id="8c9d8-104">Configure Always On availability group in Azure Virtual Machines (classic)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-104">Configure Always On availability group in Azure Virtual Machines (classic)</span></span>
> [!div class="op_single_selector"]
> * [Classic: UI](../classic/portal-sql-alwayson-availability-groups.md)
> * [Classic: PowerShell](../classic/ps-sql-alwayson-availability-groups.md)
<br/>

<span data-ttu-id="8c9d8-107">Before you begin, consider that you can now complete this task in Azure Resource Manager model.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-107">Before you begin, consider that you can now complete this task in Azure Resource Manager model.</span></span> <span data-ttu-id="8c9d8-108">We recommend Azure Resource Manager model for new deployments.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-108">We recommend Azure Resource Manager model for new deployments.</span></span> <span data-ttu-id="8c9d8-109">See [SQL Server Always On availability groups on Azure virtual machines](../sql/virtual-machines-windows-portal-sql-availability-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-109">See [SQL Server Always On availability groups on Azure virtual machines](../sql/virtual-machines-windows-portal-sql-availability-group-overview.md).</span></span>

> [!IMPORTANT] 
> Microsoft recommends that most new deployments use the Resource Manager model. Azure has two different deployment models to create and work with resources: [Resource Manager and classic](../../../azure-resource-manager/resource-manager-deployment-model.md). This article explains how to use the classic deployment model. 

<span data-ttu-id="8c9d8-113">To complete this task with the Azure Resource Manager model, see [SQL Server Always On availability groups on Azure virtual machines](../sql/virtual-machines-windows-portal-sql-availability-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-113">To complete this task with the Azure Resource Manager model, see [SQL Server Always On availability groups on Azure virtual machines](../sql/virtual-machines-windows-portal-sql-availability-group-overview.md).</span></span>

<span data-ttu-id="8c9d8-114">This end-to-end tutorial shows you how to implement availability groups by using SQL Server Always On running on Azure Virtual Machines.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-114">This end-to-end tutorial shows you how to implement availability groups by using SQL Server Always On running on Azure Virtual Machines.</span></span>

<span data-ttu-id="8c9d8-115">At the end of the tutorial, your SQL Server Always On solution in Azure will consist of the following elements:</span><span class="sxs-lookup"><span data-stu-id="8c9d8-115">At the end of the tutorial, your SQL Server Always On solution in Azure will consist of the following elements:</span></span>

* <span data-ttu-id="8c9d8-116">A virtual network that contains multiple subnets and includes a frontend and a backend subnet</span><span class="sxs-lookup"><span data-stu-id="8c9d8-116">A virtual network that contains multiple subnets and includes a frontend and a backend subnet</span></span>
* <span data-ttu-id="8c9d8-117">A domain controller with an Active Directory (Azure AD) domain</span><span class="sxs-lookup"><span data-stu-id="8c9d8-117">A domain controller with an Active Directory (Azure AD) domain</span></span>
* <span data-ttu-id="8c9d8-118">Two virtual machines that run SQL Server and are deployed to the backend subnet and joined to the Azure AD domain</span><span class="sxs-lookup"><span data-stu-id="8c9d8-118">Two virtual machines that run SQL Server and are deployed to the backend subnet and joined to the Azure AD domain</span></span>
* <span data-ttu-id="8c9d8-119">A three-node failover cluster with the Node Majority quorum model</span><span class="sxs-lookup"><span data-stu-id="8c9d8-119">A three-node failover cluster with the Node Majority quorum model</span></span>
* <span data-ttu-id="8c9d8-120">An availability group that has two synchronous-commit replicas of an availability database</span><span class="sxs-lookup"><span data-stu-id="8c9d8-120">An availability group that has two synchronous-commit replicas of an availability database</span></span>

<span data-ttu-id="8c9d8-121">The following illustration is a graphical representation of the solution.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-121">The following illustration is a graphical representation of the solution.</span></span>

![Test lab architecture for availability groups in Azure](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC791912.png)

<span data-ttu-id="8c9d8-123">Note that this is one possible configuration.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-123">Note that this is one possible configuration.</span></span> <span data-ttu-id="8c9d8-124">For example, you can minimize the number of virtual machines for a two-replica availability group.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-124">For example, you can minimize the number of virtual machines for a two-replica availability group.</span></span> <span data-ttu-id="8c9d8-125">This configuration saves on compute hours in Azure by using the domain controller as the quorum file share witness in a two-node cluster.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-125">This configuration saves on compute hours in Azure by using the domain controller as the quorum file share witness in a two-node cluster.</span></span> <span data-ttu-id="8c9d8-126">This method reduces the virtual machine count by one from the illustrated configuration.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-126">This method reduces the virtual machine count by one from the illustrated configuration.</span></span>

<span data-ttu-id="8c9d8-127">This tutorial assumes the following:</span><span class="sxs-lookup"><span data-stu-id="8c9d8-127">This tutorial assumes the following:</span></span>

* <span data-ttu-id="8c9d8-128">You already have an Azure account.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-128">You already have an Azure account.</span></span>
* <span data-ttu-id="8c9d8-129">You already know how to use the GUI in the virtual machine gallery to provision a classic virtual machine that runs SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-129">You already know how to use the GUI in the virtual machine gallery to provision a classic virtual machine that runs SQL Server.</span></span>
* <span data-ttu-id="8c9d8-130">You already have a solid understanding of Always On availability groups.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-130">You already have a solid understanding of Always On availability groups.</span></span> <span data-ttu-id="8c9d8-131">For more information, see [Always On Availability Groups (SQL Server)](https://msdn.microsoft.com/library/hh510230.aspx).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-131">For more information, see [Always On Availability Groups (SQL Server)](https://msdn.microsoft.com/library/hh510230.aspx).</span></span>

> [!NOTE]
> If you are interested in using Always On availability groups with SharePoint, also see [Configure SQL Server 2012 Always On Availability Groups for SharePoint 2013](https://technet.microsoft.com/library/jj715261.aspx).
> 
> 

## <a name="create-the-virtual-network-and-domain-controller-server"></a><span data-ttu-id="8c9d8-133">Create the virtual network and domain controller server</span><span class="sxs-lookup"><span data-stu-id="8c9d8-133">Create the virtual network and domain controller server</span></span>
<span data-ttu-id="8c9d8-134">You begin with a new Azure trial account.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-134">You begin with a new Azure trial account.</span></span> <span data-ttu-id="8c9d8-135">After you set up your account, you should be on the home screen of the Azure classic portal.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-135">After you set up your account, you should be on the home screen of the Azure classic portal.</span></span>

1. <span data-ttu-id="8c9d8-136">Click the **New** button at the left corner of the bottom of the page, as shown in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-136">Click the **New** button at the left corner of the bottom of the page, as shown in the following screenshot.</span></span>
   
    ![Click New in the portal](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665511.gif)
2. <span data-ttu-id="8c9d8-138">Click **Network Services** > **Virtual Network** > **Custom Create**, as shown in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-138">Click **Network Services** > **Virtual Network** > **Custom Create**, as shown in the following screenshot.</span></span>
   
    ![Create Virtual Network](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665512.gif)
3. <span data-ttu-id="8c9d8-140">In the **CREATE A VIRTUAL NETWORK** dialog box, create a new virtual network by stepping through the pages and using the settings in the following table.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-140">In the **CREATE A VIRTUAL NETWORK** dialog box, create a new virtual network by stepping through the pages and using the settings in the following table.</span></span> 
   
   | <span data-ttu-id="8c9d8-141">Page</span><span class="sxs-lookup"><span data-stu-id="8c9d8-141">Page</span></span> | <span data-ttu-id="8c9d8-142">Settings</span><span class="sxs-lookup"><span data-stu-id="8c9d8-142">Settings</span></span> |
   | --- | --- |
   | <span data-ttu-id="8c9d8-143">Virtual Network Details</span><span class="sxs-lookup"><span data-stu-id="8c9d8-143">Virtual Network Details</span></span> |<span data-ttu-id="8c9d8-144">**NAME = ContosoNET**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-144">**NAME = ContosoNET**</span></span><br/><span data-ttu-id="8c9d8-145">**REGION = West US**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-145">**REGION = West US**</span></span> |
   | <span data-ttu-id="8c9d8-146">DNS Servers and VPN Connectivity</span><span class="sxs-lookup"><span data-stu-id="8c9d8-146">DNS Servers and VPN Connectivity</span></span> |<span data-ttu-id="8c9d8-147">None</span><span class="sxs-lookup"><span data-stu-id="8c9d8-147">None</span></span> |
   | <span data-ttu-id="8c9d8-148">Virtual Network Address Spaces</span><span class="sxs-lookup"><span data-stu-id="8c9d8-148">Virtual Network Address Spaces</span></span> |<span data-ttu-id="8c9d8-149">Settings are shown in the following screenshot:</span><span class="sxs-lookup"><span data-stu-id="8c9d8-149">Settings are shown in the following screenshot:</span></span> ![Create Virtual Network](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784620.png) |
4. <span data-ttu-id="8c9d8-151">Create the virtual machine that you will use as the domain controller (DC).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-151">Create the virtual machine that you will use as the domain controller (DC).</span></span> <span data-ttu-id="8c9d8-152">Click **New** > **Compute** > **Virtual Machine** > **From Gallery**, as shown in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-152">Click **New** > **Compute** > **Virtual Machine** > **From Gallery**, as shown in the following screenshot.</span></span>
   
    ![Create a virtual machine](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784621.png)
5. <span data-ttu-id="8c9d8-154">In the **CREATE A VIRTUAL MACHINE** dialog box, configure a new virtual machine by stepping through the pages and using the settings in the following table.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-154">In the **CREATE A VIRTUAL MACHINE** dialog box, configure a new virtual machine by stepping through the pages and using the settings in the following table.</span></span> 
   
   | <span data-ttu-id="8c9d8-155">Page</span><span class="sxs-lookup"><span data-stu-id="8c9d8-155">Page</span></span> | <span data-ttu-id="8c9d8-156">Settings</span><span class="sxs-lookup"><span data-stu-id="8c9d8-156">Settings</span></span> |
   | --- | --- |
   | <span data-ttu-id="8c9d8-157">Select the virtual machine operating system</span><span class="sxs-lookup"><span data-stu-id="8c9d8-157">Select the virtual machine operating system</span></span> |<span data-ttu-id="8c9d8-158">Windows Server 2012 R2 Datacenter</span><span class="sxs-lookup"><span data-stu-id="8c9d8-158">Windows Server 2012 R2 Datacenter</span></span> |
   | <span data-ttu-id="8c9d8-159">Virtual machine configuration</span><span class="sxs-lookup"><span data-stu-id="8c9d8-159">Virtual machine configuration</span></span> |<span data-ttu-id="8c9d8-160">**VERSION RELEASE DATE** = (latest)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-160">**VERSION RELEASE DATE** = (latest)</span></span><br/><span data-ttu-id="8c9d8-161">**VIRTUAL MACHINE NAME** = ContosoDC</span><span class="sxs-lookup"><span data-stu-id="8c9d8-161">**VIRTUAL MACHINE NAME** = ContosoDC</span></span><br/><span data-ttu-id="8c9d8-162">**TIER** = STANDARD</span><span class="sxs-lookup"><span data-stu-id="8c9d8-162">**TIER** = STANDARD</span></span><br/><span data-ttu-id="8c9d8-163">**SIZE** = A2 (2 cores)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-163">**SIZE** = A2 (2 cores)</span></span><br/><span data-ttu-id="8c9d8-164">**NEW USER NAME** = AzureAdmin</span><span class="sxs-lookup"><span data-stu-id="8c9d8-164">**NEW USER NAME** = AzureAdmin</span></span><br/><span data-ttu-id="8c9d8-165">**NEW PASSWORD** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="8c9d8-165">**NEW PASSWORD** = Contoso!000</span></span><br/><span data-ttu-id="8c9d8-166">**CONFIRM** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="8c9d8-166">**CONFIRM** = Contoso!000</span></span> |
   | <span data-ttu-id="8c9d8-167">Virtual machine configuration</span><span class="sxs-lookup"><span data-stu-id="8c9d8-167">Virtual machine configuration</span></span> |<span data-ttu-id="8c9d8-168">**CLOUD SERVICE** = Create a new cloud service</span><span class="sxs-lookup"><span data-stu-id="8c9d8-168">**CLOUD SERVICE** = Create a new cloud service</span></span><br/><span data-ttu-id="8c9d8-169">**CLOUD SERVICE DNS NAME** = A unique cloud service name</span><span class="sxs-lookup"><span data-stu-id="8c9d8-169">**CLOUD SERVICE DNS NAME** = A unique cloud service name</span></span><br/><span data-ttu-id="8c9d8-170">**DNS NAME** = A unique name (ex: ContosoDC123)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-170">**DNS NAME** = A unique name (ex: ContosoDC123)</span></span><br/><span data-ttu-id="8c9d8-171">**REGION/AFFINITY GROUP/VIRTUAL NETWORK** = ContosoNET</span><span class="sxs-lookup"><span data-stu-id="8c9d8-171">**REGION/AFFINITY GROUP/VIRTUAL NETWORK** = ContosoNET</span></span><br/><span data-ttu-id="8c9d8-172">**VIRTUAL NETWORK SUBNETS** = Back(10.10.2.0/24)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-172">**VIRTUAL NETWORK SUBNETS** = Back(10.10.2.0/24)</span></span><br/><span data-ttu-id="8c9d8-173">**STORAGE ACCOUNT** = Use an automatically generated storage account</span><span class="sxs-lookup"><span data-stu-id="8c9d8-173">**STORAGE ACCOUNT** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="8c9d8-174">**AVAILABILITY SET** = (None)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-174">**AVAILABILITY SET** = (None)</span></span> |
   | <span data-ttu-id="8c9d8-175">Virtual machine options</span><span class="sxs-lookup"><span data-stu-id="8c9d8-175">Virtual machine options</span></span> |<span data-ttu-id="8c9d8-176">Use defaults</span><span class="sxs-lookup"><span data-stu-id="8c9d8-176">Use defaults</span></span> |

<span data-ttu-id="8c9d8-177">After you configure the new virtual machine, wait for the virtual machine to be provsioned.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-177">After you configure the new virtual machine, wait for the virtual machine to be provsioned.</span></span> <span data-ttu-id="8c9d8-178">This process takes some time to finish.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-178">This process takes some time to finish.</span></span> <span data-ttu-id="8c9d8-179">If you click the **Virtual Machine** tab in the Azure classic portal, you can see ContosoDC cycling states from **Starting (Provisioning)** to **Stopped**, **Starting**, **Running (Provisioning)**, and finally **Running**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-179">If you click the **Virtual Machine** tab in the Azure classic portal, you can see ContosoDC cycling states from **Starting (Provisioning)** to **Stopped**, **Starting**, **Running (Provisioning)**, and finally **Running**.</span></span>

<span data-ttu-id="8c9d8-180">The DC server is now successfully provisioned.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-180">The DC server is now successfully provisioned.</span></span> <span data-ttu-id="8c9d8-181">Next, you will configure the Active Directory domain on this DC server.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-181">Next, you will configure the Active Directory domain on this DC server.</span></span>

## <a name="configure-the-domain-controller"></a><span data-ttu-id="8c9d8-182">Configure the domain controller</span><span class="sxs-lookup"><span data-stu-id="8c9d8-182">Configure the domain controller</span></span>
<span data-ttu-id="8c9d8-183">In the following steps, you configure the ContosoDC machine as a domain controller for corp.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-183">In the following steps, you configure the ContosoDC machine as a domain controller for corp.contoso.com.</span></span>

1. <span data-ttu-id="8c9d8-184">In the portal, select the **ContosoDC** machine.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-184">In the portal, select the **ContosoDC** machine.</span></span> <span data-ttu-id="8c9d8-185">On the **Dashboard** tab, click **Connect** to open a remote desktop (RDP) file for remote desktop access.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-185">On the **Dashboard** tab, click **Connect** to open a remote desktop (RDP) file for remote desktop access.</span></span>
   
    ![Connect to Vritual Machine](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784622.png)
2. <span data-ttu-id="8c9d8-187">Sign in with your configured administrator account (**\AzureAdmin**) and password (**Contoso!000**).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-187">Sign in with your configured administrator account (**\AzureAdmin**) and password (**Contoso!000**).</span></span>
3. <span data-ttu-id="8c9d8-188">By default, the **Server Manager** dashboard should be displayed.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-188">By default, the **Server Manager** dashboard should be displayed.</span></span>
4. <span data-ttu-id="8c9d8-189">Click the **Add roles and features** link on the dashboard.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-189">Click the **Add roles and features** link on the dashboard.</span></span>
   
    ![Server Explorer Add Roles](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784623.png)
5. <span data-ttu-id="8c9d8-191">Click **Next** until you get to the **Server Roles** section.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-191">Click **Next** until you get to the **Server Roles** section.</span></span>
6. <span data-ttu-id="8c9d8-192">Select the **Active Directory Domain Services** and **DNS Server** roles.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-192">Select the **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="8c9d8-193">When prompted, add more features that these roles require.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-193">When prompted, add more features that these roles require.</span></span>
   
   > [!NOTE]
   > You will get a validation warning that there is no static IP address. If you are testing the configuration, click **Continue**. For production scenarios [use PowerShell to set the static IP address of the domain controller machine](../../../virtual-network/virtual-networks-reserved-private-ip.md).
   > 
   > 
   
    ![Add Roles Dialog](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784624.png)
7. <span data-ttu-id="8c9d8-198">Click **Next** until you reach the **Confirmation** section.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-198">Click **Next** until you reach the **Confirmation** section.</span></span> <span data-ttu-id="8c9d8-199">Select the **Restart the destination server automatically if required** check box.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-199">Select the **Restart the destination server automatically if required** check box.</span></span>
8. <span data-ttu-id="8c9d8-200">Click **Install**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-200">Click **Install**.</span></span>
9. <span data-ttu-id="8c9d8-201">After the features are installed, return to the **Server Manager** dashboard.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-201">After the features are installed, return to the **Server Manager** dashboard.</span></span>
10. <span data-ttu-id="8c9d8-202">Select the new **AD DS** option on the left pane.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-202">Select the new **AD DS** option on the left pane.</span></span>
11. <span data-ttu-id="8c9d8-203">Click the **More** link on the yellow warning bar.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-203">Click the **More** link on the yellow warning bar.</span></span>
    
     ![AD DS dialog box on DNS server virtual machine](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784625.png)
12. <span data-ttu-id="8c9d8-205">In the **Action** column of the **All Server Task Details** dialog box, click **Promote this server to a domain controller**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-205">In the **Action** column of the **All Server Task Details** dialog box, click **Promote this server to a domain controller**.</span></span>
13. <span data-ttu-id="8c9d8-206">In the **Active Directory Domain Services Configuration Wizard**, use the following values:</span><span class="sxs-lookup"><span data-stu-id="8c9d8-206">In the **Active Directory Domain Services Configuration Wizard**, use the following values:</span></span>
    
    | <span data-ttu-id="8c9d8-207">Page</span><span class="sxs-lookup"><span data-stu-id="8c9d8-207">Page</span></span> | <span data-ttu-id="8c9d8-208">Setting</span><span class="sxs-lookup"><span data-stu-id="8c9d8-208">Setting</span></span> |
    | --- | --- |
    | <span data-ttu-id="8c9d8-209">Deployment Configuration</span><span class="sxs-lookup"><span data-stu-id="8c9d8-209">Deployment Configuration</span></span> |<span data-ttu-id="8c9d8-210">**Add a new forest** = Selected</span><span class="sxs-lookup"><span data-stu-id="8c9d8-210">**Add a new forest** = Selected</span></span><br/><span data-ttu-id="8c9d8-211">**Root domain name** = corp.contoso.com</span><span class="sxs-lookup"><span data-stu-id="8c9d8-211">**Root domain name** = corp.contoso.com</span></span> |
    | <span data-ttu-id="8c9d8-212">Domain Controller Options</span><span class="sxs-lookup"><span data-stu-id="8c9d8-212">Domain Controller Options</span></span> |<span data-ttu-id="8c9d8-213">**Password** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="8c9d8-213">**Password** = Contoso!000</span></span><br/><span data-ttu-id="8c9d8-214">**Confirm Password** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="8c9d8-214">**Confirm Password** = Contoso!000</span></span> |
14. <span data-ttu-id="8c9d8-215">Click **Next** to go through the other pages in the wizard.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-215">Click **Next** to go through the other pages in the wizard.</span></span> <span data-ttu-id="8c9d8-216">On the **Prerequisites Check** page, verify that you see the following message: **All prerequisite checks passed successfully**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-216">On the **Prerequisites Check** page, verify that you see the following message: **All prerequisite checks passed successfully**.</span></span> <span data-ttu-id="8c9d8-217">Note that you should review all applicable warning messages, but it is possible to continue with the installation.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-217">Note that you should review all applicable warning messages, but it is possible to continue with the installation.</span></span>
15. <span data-ttu-id="8c9d8-218">Click **Install**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-218">Click **Install**.</span></span> <span data-ttu-id="8c9d8-219">The **ContosoDC** virtual machine will automatically reboot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-219">The **ContosoDC** virtual machine will automatically reboot.</span></span>

## <a name="configure-domain-accounts"></a><span data-ttu-id="8c9d8-220">Configure domain accounts</span><span class="sxs-lookup"><span data-stu-id="8c9d8-220">Configure domain accounts</span></span>
<span data-ttu-id="8c9d8-221">The next steps configure the Active Directory accounts for later use.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-221">The next steps configure the Active Directory accounts for later use.</span></span>

1. <span data-ttu-id="8c9d8-222">Sign back in to the **ContosoDC** machine.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-222">Sign back in to the **ContosoDC** machine.</span></span>
2. <span data-ttu-id="8c9d8-223">In **Server Manager**, click **Tools** > **Active Directory Administrative Center**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-223">In **Server Manager**, click **Tools** > **Active Directory Administrative Center**.</span></span>
   
    ![Active Directory Administrative Center](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784626.png)
3. <span data-ttu-id="8c9d8-225">In the **Active Directory Administrative Center**, select **corp (local)** in the left pane.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-225">In the **Active Directory Administrative Center**, select **corp (local)** in the left pane.</span></span>
4. <span data-ttu-id="8c9d8-226">On the right **Tasks** pane, click **New** > **User**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-226">On the right **Tasks** pane, click **New** > **User**.</span></span> <span data-ttu-id="8c9d8-227">Use the following settings:</span><span class="sxs-lookup"><span data-stu-id="8c9d8-227">Use the following settings:</span></span>
   
   | <span data-ttu-id="8c9d8-228">Setting</span><span class="sxs-lookup"><span data-stu-id="8c9d8-228">Setting</span></span> | <span data-ttu-id="8c9d8-229">Value</span><span class="sxs-lookup"><span data-stu-id="8c9d8-229">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="8c9d8-230">**First Name**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-230">**First Name**</span></span> |<span data-ttu-id="8c9d8-231">Install</span><span class="sxs-lookup"><span data-stu-id="8c9d8-231">Install</span></span> |
   | <span data-ttu-id="8c9d8-232">**User SamAccountName**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-232">**User SamAccountName**</span></span> |<span data-ttu-id="8c9d8-233">Install</span><span class="sxs-lookup"><span data-stu-id="8c9d8-233">Install</span></span> |
   | <span data-ttu-id="8c9d8-234">**Password**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-234">**Password**</span></span> |<span data-ttu-id="8c9d8-235">Contoso!000</span><span class="sxs-lookup"><span data-stu-id="8c9d8-235">Contoso!000</span></span> |
   | <span data-ttu-id="8c9d8-236">**Confirm password**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-236">**Confirm password**</span></span> |<span data-ttu-id="8c9d8-237">Contoso!000</span><span class="sxs-lookup"><span data-stu-id="8c9d8-237">Contoso!000</span></span> |
   | <span data-ttu-id="8c9d8-238">**Other password options**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-238">**Other password options**</span></span> |<span data-ttu-id="8c9d8-239">Selected</span><span class="sxs-lookup"><span data-stu-id="8c9d8-239">Selected</span></span> |
   | <span data-ttu-id="8c9d8-240">**Password never expires**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-240">**Password never expires**</span></span> |<span data-ttu-id="8c9d8-241">Checked</span><span class="sxs-lookup"><span data-stu-id="8c9d8-241">Checked</span></span> |
5. <span data-ttu-id="8c9d8-242">Click **OK** to create the **Install** user.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-242">Click **OK** to create the **Install** user.</span></span> <span data-ttu-id="8c9d8-243">This account will be used to configure the failover cluster and the availability group.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-243">This account will be used to configure the failover cluster and the availability group.</span></span>
6. <span data-ttu-id="8c9d8-244">Create two additional users, **CORP\SQLSvc1** and **CORP\SQLSvc2**, with the same steps.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-244">Create two additional users, **CORP\SQLSvc1** and **CORP\SQLSvc2**, with the same steps.</span></span> <span data-ttu-id="8c9d8-245">These accounts will be used for the SQL Server instances.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-245">These accounts will be used for the SQL Server instances.</span></span> <span data-ttu-id="8c9d8-246">Next, you need to give **CORP\Install** the necessary permissions to configure Windows failover clustering.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-246">Next, you need to give **CORP\Install** the necessary permissions to configure Windows failover clustering.</span></span>
7. <span data-ttu-id="8c9d8-247">In the **Active Directory Administrative Center**, click **corp (local)** in the left pane.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-247">In the **Active Directory Administrative Center**, click **corp (local)** in the left pane.</span></span> <span data-ttu-id="8c9d8-248">In the **Tasks** pane, click **Properties**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-248">In the **Tasks** pane, click **Properties**.</span></span>
   
    ![CORP user properties](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784627.png)
8. <span data-ttu-id="8c9d8-250">Select **Extensions**, and then click the **Advanced** button on the **Security** tab.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-250">Select **Extensions**, and then click the **Advanced** button on the **Security** tab.</span></span>
9. <span data-ttu-id="8c9d8-251">In the **Advanced Security Settings for corp** dialog box, click **Add**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-251">In the **Advanced Security Settings for corp** dialog box, click **Add**.</span></span>
10. <span data-ttu-id="8c9d8-252">Click **Select a principal**, search for **CORP\Install**, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-252">Click **Select a principal**, search for **CORP\Install**, and then click **OK**.</span></span>
11. <span data-ttu-id="8c9d8-253">Select the **Read all properties** and **Create Computer objects** permissions.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-253">Select the **Read all properties** and **Create Computer objects** permissions.</span></span>
    
     ![Corp user permissions](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784628.png)
12. <span data-ttu-id="8c9d8-255">Click **OK**, and then click **OK** again.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-255">Click **OK**, and then click **OK** again.</span></span> <span data-ttu-id="8c9d8-256">Close the corp properties window.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-256">Close the corp properties window.</span></span>

<span data-ttu-id="8c9d8-257">Now that you configured Active Directory and the user objects, you will create three SQL Server virtual machines and join them to this domain.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-257">Now that you configured Active Directory and the user objects, you will create three SQL Server virtual machines and join them to this domain.</span></span>

## <a name="create-the-sql-server-virtual-machines"></a><span data-ttu-id="8c9d8-258">Create the SQL Server virtual machines</span><span class="sxs-lookup"><span data-stu-id="8c9d8-258">Create the SQL Server virtual machines</span></span>
<span data-ttu-id="8c9d8-259">Create three virtual machines.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-259">Create three virtual machines.</span></span> <span data-ttu-id="8c9d8-260">One is for a cluster node and two are for SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-260">One is for a cluster node and two are for SQL Server.</span></span> <span data-ttu-id="8c9d8-261">To create each of the virtual machines, go back to the Azure classic portal, click **New** > **Compute** > **Virtual Machine** > **From Gallery**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-261">To create each of the virtual machines, go back to the Azure classic portal, click **New** > **Compute** > **Virtual Machine** > **From Gallery**.</span></span> <span data-ttu-id="8c9d8-262">Then, use the templates in the following table to help you create the virtual machines.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-262">Then, use the templates in the following table to help you create the virtual machines.</span></span>

| <span data-ttu-id="8c9d8-263">Page</span><span class="sxs-lookup"><span data-stu-id="8c9d8-263">Page</span></span> | <span data-ttu-id="8c9d8-264">VM1</span><span class="sxs-lookup"><span data-stu-id="8c9d8-264">VM1</span></span> | <span data-ttu-id="8c9d8-265">VM2</span><span class="sxs-lookup"><span data-stu-id="8c9d8-265">VM2</span></span> | <span data-ttu-id="8c9d8-266">VM3</span><span class="sxs-lookup"><span data-stu-id="8c9d8-266">VM3</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="8c9d8-267">Select the virtual machine operating system</span><span class="sxs-lookup"><span data-stu-id="8c9d8-267">Select the virtual machine operating system</span></span> |<span data-ttu-id="8c9d8-268">**Windows Server 2012 R2 Datacenter**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-268">**Windows Server 2012 R2 Datacenter**</span></span> |<span data-ttu-id="8c9d8-269">**SQL Server 2014 RTM Enterprise**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-269">**SQL Server 2014 RTM Enterprise**</span></span> |<span data-ttu-id="8c9d8-270">**SQL Server 2014 RTM Enterprise**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-270">**SQL Server 2014 RTM Enterprise**</span></span> |
| <span data-ttu-id="8c9d8-271">Virtual machine configuration</span><span class="sxs-lookup"><span data-stu-id="8c9d8-271">Virtual machine configuration</span></span> |<span data-ttu-id="8c9d8-272">**VERSION RELEASE DATE** = (latest)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-272">**VERSION RELEASE DATE** = (latest)</span></span><br/><span data-ttu-id="8c9d8-273">**VIRTUAL MACHINE NAME** = ContosoWSFCNode</span><span class="sxs-lookup"><span data-stu-id="8c9d8-273">**VIRTUAL MACHINE NAME** = ContosoWSFCNode</span></span><br/><span data-ttu-id="8c9d8-274">**TIER** = STANDARD</span><span class="sxs-lookup"><span data-stu-id="8c9d8-274">**TIER** = STANDARD</span></span><br/><span data-ttu-id="8c9d8-275">**SIZE** = A2 (2 cores)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-275">**SIZE** = A2 (2 cores)</span></span><br/><span data-ttu-id="8c9d8-276">**NEW USER NAME** = AzureAdmin</span><span class="sxs-lookup"><span data-stu-id="8c9d8-276">**NEW USER NAME** = AzureAdmin</span></span><br/><span data-ttu-id="8c9d8-277">**NEW PASSWORD** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="8c9d8-277">**NEW PASSWORD** = Contoso!000</span></span><br/><span data-ttu-id="8c9d8-278">**CONFIRM** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="8c9d8-278">**CONFIRM** = Contoso!000</span></span> |<span data-ttu-id="8c9d8-279">**VERSION RELEASE DATE** = (latest)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-279">**VERSION RELEASE DATE** = (latest)</span></span><br/><span data-ttu-id="8c9d8-280">**VIRTUAL MACHINE NAME** = ContosoSQL1</span><span class="sxs-lookup"><span data-stu-id="8c9d8-280">**VIRTUAL MACHINE NAME** = ContosoSQL1</span></span><br/><span data-ttu-id="8c9d8-281">**TIER** = STANDARD</span><span class="sxs-lookup"><span data-stu-id="8c9d8-281">**TIER** = STANDARD</span></span><br/><span data-ttu-id="8c9d8-282">**SIZE** = A3 (4 cores)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-282">**SIZE** = A3 (4 cores)</span></span><br/><span data-ttu-id="8c9d8-283">**NEW USER NAME** = AzureAdmin</span><span class="sxs-lookup"><span data-stu-id="8c9d8-283">**NEW USER NAME** = AzureAdmin</span></span><br/><span data-ttu-id="8c9d8-284">**NEW PASSWORD** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="8c9d8-284">**NEW PASSWORD** = Contoso!000</span></span><br/><span data-ttu-id="8c9d8-285">**CONFIRM** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="8c9d8-285">**CONFIRM** = Contoso!000</span></span> |<span data-ttu-id="8c9d8-286">**VERSION RELEASE DATE** = (latest)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-286">**VERSION RELEASE DATE** = (latest)</span></span><br/><span data-ttu-id="8c9d8-287">**VIRTUAL MACHINE NAME** = ContosoSQL2</span><span class="sxs-lookup"><span data-stu-id="8c9d8-287">**VIRTUAL MACHINE NAME** = ContosoSQL2</span></span><br/><span data-ttu-id="8c9d8-288">**TIER** = STANDARD</span><span class="sxs-lookup"><span data-stu-id="8c9d8-288">**TIER** = STANDARD</span></span><br/><span data-ttu-id="8c9d8-289">**SIZE** = A3 (4 cores)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-289">**SIZE** = A3 (4 cores)</span></span><br/><span data-ttu-id="8c9d8-290">**NEW USER NAME** = AzureAdmin</span><span class="sxs-lookup"><span data-stu-id="8c9d8-290">**NEW USER NAME** = AzureAdmin</span></span><br/><span data-ttu-id="8c9d8-291">**NEW PASSWORD** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="8c9d8-291">**NEW PASSWORD** = Contoso!000</span></span><br/><span data-ttu-id="8c9d8-292">**CONFIRM** = Contoso!000</span><span class="sxs-lookup"><span data-stu-id="8c9d8-292">**CONFIRM** = Contoso!000</span></span> |
| <span data-ttu-id="8c9d8-293">Virtual machine configuration</span><span class="sxs-lookup"><span data-stu-id="8c9d8-293">Virtual machine configuration</span></span> |<span data-ttu-id="8c9d8-294">**CLOUD SERVICE** = Previously Created Unique Cloud Service DNS Name (ex: ContosoDC123)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-294">**CLOUD SERVICE** = Previously Created Unique Cloud Service DNS Name (ex: ContosoDC123)</span></span><br/><span data-ttu-id="8c9d8-295">**REGION/AFFINITY GROUP/VIRTUAL NETWORK** = ContosoNET</span><span class="sxs-lookup"><span data-stu-id="8c9d8-295">**REGION/AFFINITY GROUP/VIRTUAL NETWORK** = ContosoNET</span></span><br/><span data-ttu-id="8c9d8-296">**VIRTUAL NETWORK SUBNETS** = Back(10.10.2.0/24)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-296">**VIRTUAL NETWORK SUBNETS** = Back(10.10.2.0/24)</span></span><br/><span data-ttu-id="8c9d8-297">**STORAGE ACCOUNT** = Use an automatically generated storage account</span><span class="sxs-lookup"><span data-stu-id="8c9d8-297">**STORAGE ACCOUNT** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="8c9d8-298">**AVAILABILITY SET** = Create an availability set</span><span class="sxs-lookup"><span data-stu-id="8c9d8-298">**AVAILABILITY SET** = Create an availability set</span></span><br/><span data-ttu-id="8c9d8-299">**AVAILABILITY SET NAME** = SQLHADR</span><span class="sxs-lookup"><span data-stu-id="8c9d8-299">**AVAILABILITY SET NAME** = SQLHADR</span></span> |<span data-ttu-id="8c9d8-300">**CLOUD SERVICE** = Previously Created Unique Cloud Service DNS Name (ex: ContosoDC123)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-300">**CLOUD SERVICE** = Previously Created Unique Cloud Service DNS Name (ex: ContosoDC123)</span></span><br/><span data-ttu-id="8c9d8-301">**REGION/AFFINITY GROUP/VIRTUAL NETWORK** = ContosoNET</span><span class="sxs-lookup"><span data-stu-id="8c9d8-301">**REGION/AFFINITY GROUP/VIRTUAL NETWORK** = ContosoNET</span></span><br/><span data-ttu-id="8c9d8-302">**VIRTUAL NETWORK SUBNETS** = Back(10.10.2.0/24)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-302">**VIRTUAL NETWORK SUBNETS** = Back(10.10.2.0/24)</span></span><br/><span data-ttu-id="8c9d8-303">**STORAGE ACCOUNT** = Use an automatically generated storage account</span><span class="sxs-lookup"><span data-stu-id="8c9d8-303">**STORAGE ACCOUNT** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="8c9d8-304">**AVAILABILITY SET** = SQLHADR (You can also configure the availability set after the machine has been created.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-304">**AVAILABILITY SET** = SQLHADR (You can also configure the availability set after the machine has been created.</span></span> <span data-ttu-id="8c9d8-305">All three machines should be assigned to the SQLHADR availability set.)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-305">All three machines should be assigned to the SQLHADR availability set.)</span></span> |<span data-ttu-id="8c9d8-306">**CLOUD SERVICE** = Previously Created Unique Cloud Service DNS Name (ex: ContosoDC123)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-306">**CLOUD SERVICE** = Previously Created Unique Cloud Service DNS Name (ex: ContosoDC123)</span></span><br/><span data-ttu-id="8c9d8-307">**REGION/AFFINITY GROUP/VIRTUAL NETWORK** = ContosoNET</span><span class="sxs-lookup"><span data-stu-id="8c9d8-307">**REGION/AFFINITY GROUP/VIRTUAL NETWORK** = ContosoNET</span></span><br/><span data-ttu-id="8c9d8-308">**VIRTUAL NETWORK SUBNETS** = Back(10.10.2.0/24)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-308">**VIRTUAL NETWORK SUBNETS** = Back(10.10.2.0/24)</span></span><br/><span data-ttu-id="8c9d8-309">**STORAGE ACCOUNT** = Use an automatically generated storage account</span><span class="sxs-lookup"><span data-stu-id="8c9d8-309">**STORAGE ACCOUNT** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="8c9d8-310">**AVAILABILITY SET** = SQLHADR (You can also configure the availability set after the machine has been created.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-310">**AVAILABILITY SET** = SQLHADR (You can also configure the availability set after the machine has been created.</span></span> <span data-ttu-id="8c9d8-311">All three machines should be assigned to the SQLHADR availability set.)</span><span class="sxs-lookup"><span data-stu-id="8c9d8-311">All three machines should be assigned to the SQLHADR availability set.)</span></span> |
| <span data-ttu-id="8c9d8-312">Virtual machine options</span><span class="sxs-lookup"><span data-stu-id="8c9d8-312">Virtual machine options</span></span> |<span data-ttu-id="8c9d8-313">Use defaults</span><span class="sxs-lookup"><span data-stu-id="8c9d8-313">Use defaults</span></span> |<span data-ttu-id="8c9d8-314">Use defaults</span><span class="sxs-lookup"><span data-stu-id="8c9d8-314">Use defaults</span></span> |<span data-ttu-id="8c9d8-315">Use defaults</span><span class="sxs-lookup"><span data-stu-id="8c9d8-315">Use defaults</span></span> |

<br/>

> [!NOTE]
> The previous configuration suggests STANDARD tier virtual machines, because BASIC tier machines do not support load-balanced endpoints. You need load-balanced endpoints later to create an availability group listener. Also, the machine sizes that are suggested here are meant for testing availability groups in Azure Virtual Machines. For the best performance on production workloads, see the recommendations for SQL Server machine sizes and configuration in [Performance best practices for SQL Server in Azure Virtual Machines](../sql/virtual-machines-windows-sql-performance.md).
> 
> 

<span data-ttu-id="8c9d8-320">After the three virtual machines are fully provisioned, you need to join them to the **corp.contoso.com** domain and grant CORP\Install administrative rights to the machines.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-320">After the three virtual machines are fully provisioned, you need to join them to the **corp.contoso.com** domain and grant CORP\Install administrative rights to the machines.</span></span> <span data-ttu-id="8c9d8-321">To do this, use the following steps for each of the three virtual machines.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-321">To do this, use the following steps for each of the three virtual machines.</span></span>

1. <span data-ttu-id="8c9d8-322">First, change the preferred DNS server address.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-322">First, change the preferred DNS server address.</span></span> <span data-ttu-id="8c9d8-323">Download each virtual machine's RDP file to your local directory by selecting the virtual machine in the list and clicking the **Connect** button.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-323">Download each virtual machine's RDP file to your local directory by selecting the virtual machine in the list and clicking the **Connect** button.</span></span> <span data-ttu-id="8c9d8-324">To select a virtual machine, click anywhere but the first cell in the row, as shown in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-324">To select a virtual machine, click anywhere but the first cell in the row, as shown in the following screenshot.</span></span>
   
    ![Download the RDP file](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC664953.jpg)
2. <span data-ttu-id="8c9d8-326">Open the RDP file that you downloaded, and sign in to the virtual machine by using your configured administrator account (**BUILTIN\AzureAdmin**) and password (**Contoso!000**).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-326">Open the RDP file that you downloaded, and sign in to the virtual machine by using your configured administrator account (**BUILTIN\AzureAdmin**) and password (**Contoso!000**).</span></span>
3. <span data-ttu-id="8c9d8-327">After you sign in, you should see the **Server Manager** dashboard.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-327">After you sign in, you should see the **Server Manager** dashboard.</span></span> <span data-ttu-id="8c9d8-328">Click **Local Server** in the left pane.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-328">Click **Local Server** in the left pane.</span></span>
4. <span data-ttu-id="8c9d8-329">Click the **IPv4 address assigned by DHCP, IPv6 enabled** link.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-329">Click the **IPv4 address assigned by DHCP, IPv6 enabled** link.</span></span>
5. <span data-ttu-id="8c9d8-330">In the **Network Connections** dialog box, click the network icon.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-330">In the **Network Connections** dialog box, click the network icon.</span></span>
   
    ![Change the virtual machine preferred DNS server](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784629.png)
6. <span data-ttu-id="8c9d8-332">On the command bar, click **Change the settings of this connection**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-332">On the command bar, click **Change the settings of this connection**.</span></span> <span data-ttu-id="8c9d8-333">(Depending on the size of your window, you might have to click the double right arrow to see this command).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-333">(Depending on the size of your window, you might have to click the double right arrow to see this command).</span></span>
7. <span data-ttu-id="8c9d8-334">Select **Internet Protocol Version 4 (TCP/IPv4)**, and then click **Properties**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-334">Select **Internet Protocol Version 4 (TCP/IPv4)**, and then click **Properties**.</span></span>
8. <span data-ttu-id="8c9d8-335">Select **Use the following DNS server addresses** and then specify **10.10.2.4** in **Preferred DNS server**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-335">Select **Use the following DNS server addresses** and then specify **10.10.2.4** in **Preferred DNS server**.</span></span>
9. <span data-ttu-id="8c9d8-336">The **10.10.2.4** address is the address that's assigned to a virtual machine in the 10.10.2.0/24 subnet in an Azure virtual network.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-336">The **10.10.2.4** address is the address that's assigned to a virtual machine in the 10.10.2.0/24 subnet in an Azure virtual network.</span></span> <span data-ttu-id="8c9d8-337">That virtual machine is **ContosoDC**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-337">That virtual machine is **ContosoDC**.</span></span> <span data-ttu-id="8c9d8-338">To verify **ContosoDC**'s IP address, use **nslookup contosodc** in the command prompt window, as shown in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-338">To verify **ContosoDC**'s IP address, use **nslookup contosodc** in the command prompt window, as shown in the following screenshot.</span></span>
   
    ![Use NSLOOKUP to find IP address for domain controller](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC664954.jpg)
10. <span data-ttu-id="8c9d8-340">Click **OK** > **Close** to commit the changes.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-340">Click **OK** > **Close** to commit the changes.</span></span> <span data-ttu-id="8c9d8-341">You can now join the virtual machine to **corp.contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-341">You can now join the virtual machine to **corp.contoso.com**.</span></span>
11. <span data-ttu-id="8c9d8-342">Back in the **Local Server** window, click the **WORKGROUP** link.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-342">Back in the **Local Server** window, click the **WORKGROUP** link.</span></span>
12. <span data-ttu-id="8c9d8-343">In the **Computer Name** section, click **Change**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-343">In the **Computer Name** section, click **Change**.</span></span>
13. <span data-ttu-id="8c9d8-344">Select the **Domain** check box, type **corp.contoso.com** in the text box, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-344">Select the **Domain** check box, type **corp.contoso.com** in the text box, and then click **OK**.</span></span>
14. <span data-ttu-id="8c9d8-345">In the **Windows Security** dialog box, specify the credentials for the default domain administrator account (**CORP\AzureAdmin**) and the password (**Contoso!000**).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-345">In the **Windows Security** dialog box, specify the credentials for the default domain administrator account (**CORP\AzureAdmin**) and the password (**Contoso!000**).</span></span>
15. <span data-ttu-id="8c9d8-346">When you see the "Welcome to the corp.contoso.com domain" message, click **OK**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-346">When you see the "Welcome to the corp.contoso.com domain" message, click **OK**.</span></span>
16. <span data-ttu-id="8c9d8-347">Click **Close** > **Restart Now** in the dialog box.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-347">Click **Close** > **Restart Now** in the dialog box.</span></span>

### <a name="add-the-corpinstall-user-as-an-administrator-on-each-virtual-machine"></a><span data-ttu-id="8c9d8-348">Add the Corp\Install user as an administrator on each virtual machine</span><span class="sxs-lookup"><span data-stu-id="8c9d8-348">Add the Corp\Install user as an administrator on each virtual machine</span></span>
1. <span data-ttu-id="8c9d8-349">Wait until the virtual machine restarts, and then open the RDP file again to sign in to the virtual machine by using the **BUILTIN\AzureAdmin** account.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-349">Wait until the virtual machine restarts, and then open the RDP file again to sign in to the virtual machine by using the **BUILTIN\AzureAdmin** account.</span></span>
2. <span data-ttu-id="8c9d8-350">In **Server Manager** click **Tools** > **Computer Management**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-350">In **Server Manager** click **Tools** > **Computer Management**.</span></span>
   
    ![Computer Management](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784630.png)
3. <span data-ttu-id="8c9d8-352">In the **Computer Management** dialog box, expand **Local Users and Groups**, and then click **Groups**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-352">In the **Computer Management** dialog box, expand **Local Users and Groups**, and then click **Groups**.</span></span>
4. <span data-ttu-id="8c9d8-353">Double-click the **Administrators** group.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-353">Double-click the **Administrators** group.</span></span>
5. <span data-ttu-id="8c9d8-354">In the **Administrators Properties** dialog box, click the **Add** button.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-354">In the **Administrators Properties** dialog box, click the **Add** button.</span></span>
6. <span data-ttu-id="8c9d8-355">Enter the user **CORP\Install**, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-355">Enter the user **CORP\Install**, and then click **OK**.</span></span> <span data-ttu-id="8c9d8-356">When prompted for credentials, use the **AzureAdmin** account with the **Contoso!000** password.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-356">When prompted for credentials, use the **AzureAdmin** account with the **Contoso!000** password.</span></span>
7. <span data-ttu-id="8c9d8-357">Click **OK** to close the **Administrator Properties** dialog box.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-357">Click **OK** to close the **Administrator Properties** dialog box.</span></span>

### <a name="add-the-failover-clustering-feature-to-each-virtual-machine"></a><span data-ttu-id="8c9d8-358">Add the Failover Clustering feature to each virtual machine</span><span class="sxs-lookup"><span data-stu-id="8c9d8-358">Add the Failover Clustering feature to each virtual machine</span></span>
1. <span data-ttu-id="8c9d8-359">In the **Server Manager** dashboard, click **Add roles and features**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-359">In the **Server Manager** dashboard, click **Add roles and features**.</span></span>
2. <span data-ttu-id="8c9d8-360">In the **Add Roles and Features Wizard**, click **Next** until you get to the **Features** page.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-360">In the **Add Roles and Features Wizard**, click **Next** until you get to the **Features** page.</span></span>
3. <span data-ttu-id="8c9d8-361">Select **Failover Clustering**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-361">Select **Failover Clustering**.</span></span> <span data-ttu-id="8c9d8-362">When prompted, add other dependent features.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-362">When prompted, add other dependent features.</span></span>
   
    ![Add Failover Clustering Feature to virtual machine](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784631.png)
4. <span data-ttu-id="8c9d8-364">Click **Next**, and then click **Install** on the **Confirmation** page.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-364">Click **Next**, and then click **Install** on the **Confirmation** page.</span></span>
5. <span data-ttu-id="8c9d8-365">When the **Failover Clustering** feature installation is finished, click **Close**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-365">When the **Failover Clustering** feature installation is finished, click **Close**.</span></span>
6. <span data-ttu-id="8c9d8-366">Sign out of the virtual machine.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-366">Sign out of the virtual machine.</span></span>
7. <span data-ttu-id="8c9d8-367">Repeat the steps in this section for all three servers: **ContosoWSFCNode**, **ContosoSQL1**, and **ContosoSQL2**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-367">Repeat the steps in this section for all three servers: **ContosoWSFCNode**, **ContosoSQL1**, and **ContosoSQL2**.</span></span>

<span data-ttu-id="8c9d8-368">The SQL Server virtual machines are now provisioned and running, but each has the default options for SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-368">The SQL Server virtual machines are now provisioned and running, but each has the default options for SQL Server.</span></span>

## <a name="create-the-failover-cluster"></a><span data-ttu-id="8c9d8-369">Create the failover cluster</span><span class="sxs-lookup"><span data-stu-id="8c9d8-369">Create the failover cluster</span></span>
<span data-ttu-id="8c9d8-370">In this section, you create the failover cluster that will host the availability group that you will create later.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-370">In this section, you create the failover cluster that will host the availability group that you will create later.</span></span> <span data-ttu-id="8c9d8-371">By now, you should have done the following to each of the three virtual machines that you will use in the failover cluster:</span><span class="sxs-lookup"><span data-stu-id="8c9d8-371">By now, you should have done the following to each of the three virtual machines that you will use in the failover cluster:</span></span>

* <span data-ttu-id="8c9d8-372">Fully provisioned the virtual machine in Azure</span><span class="sxs-lookup"><span data-stu-id="8c9d8-372">Fully provisioned the virtual machine in Azure</span></span>
* <span data-ttu-id="8c9d8-373">Joined the virtual machine to the domain</span><span class="sxs-lookup"><span data-stu-id="8c9d8-373">Joined the virtual machine to the domain</span></span>
* <span data-ttu-id="8c9d8-374">Added **CORP\Install** to the local Administrators group</span><span class="sxs-lookup"><span data-stu-id="8c9d8-374">Added **CORP\Install** to the local Administrators group</span></span>
* <span data-ttu-id="8c9d8-375">Added the failover clustering feature</span><span class="sxs-lookup"><span data-stu-id="8c9d8-375">Added the failover clustering feature</span></span>

<span data-ttu-id="8c9d8-376">All these are prerequisites on each virtual machine before you can join it to the failover cluster.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-376">All these are prerequisites on each virtual machine before you can join it to the failover cluster.</span></span>

<span data-ttu-id="8c9d8-377">Also, note that the Azure virtual network does not behave in the same way as an on-premises network.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-377">Also, note that the Azure virtual network does not behave in the same way as an on-premises network.</span></span> <span data-ttu-id="8c9d8-378">You need to create the cluster in the following order:</span><span class="sxs-lookup"><span data-stu-id="8c9d8-378">You need to create the cluster in the following order:</span></span>

1. <span data-ttu-id="8c9d8-379">Create a single-node cluster on one node (**ContosoSQL1**).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-379">Create a single-node cluster on one node (**ContosoSQL1**).</span></span>
2. <span data-ttu-id="8c9d8-380">Modify the cluster IP address to an unused IP address (**10.10.2.101**).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-380">Modify the cluster IP address to an unused IP address (**10.10.2.101**).</span></span>
3. <span data-ttu-id="8c9d8-381">Bring the cluster name online.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-381">Bring the cluster name online.</span></span>
4. <span data-ttu-id="8c9d8-382">Add the other nodes (**ContosoSQL2** and **ContosoWSFCNode**).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-382">Add the other nodes (**ContosoSQL2** and **ContosoWSFCNode**).</span></span>

<span data-ttu-id="8c9d8-383">Use the following steps to complete the tasks that fully configure the cluster.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-383">Use the following steps to complete the tasks that fully configure the cluster.</span></span>

1. <span data-ttu-id="8c9d8-384">Open the RDP file for **ContosoSQL1**, and sign in by using the domain account **CORP\Install**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-384">Open the RDP file for **ContosoSQL1**, and sign in by using the domain account **CORP\Install**.</span></span>
2. <span data-ttu-id="8c9d8-385">In the **Server Manager** dashboard, click **Tools** > **Failover Cluster Manager**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-385">In the **Server Manager** dashboard, click **Tools** > **Failover Cluster Manager**.</span></span>
3. <span data-ttu-id="8c9d8-386">In the left pane, right-click **Failover Cluster Manager**, and then click **Create a Cluster**, as shown in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-386">In the left pane, right-click **Failover Cluster Manager**, and then click **Create a Cluster**, as shown in the following screenshot.</span></span>
   
    ![Create cluster](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784632.png)
4. <span data-ttu-id="8c9d8-388">In the Create Cluster Wizard, create a one-node cluster by stepping through the pages and using the settings in the following table:</span><span class="sxs-lookup"><span data-stu-id="8c9d8-388">In the Create Cluster Wizard, create a one-node cluster by stepping through the pages and using the settings in the following table:</span></span>
   
   | <span data-ttu-id="8c9d8-389">Page</span><span class="sxs-lookup"><span data-stu-id="8c9d8-389">Page</span></span> | <span data-ttu-id="8c9d8-390">Settings</span><span class="sxs-lookup"><span data-stu-id="8c9d8-390">Settings</span></span> |
   | --- | --- |
   | <span data-ttu-id="8c9d8-391">Before You Begin</span><span class="sxs-lookup"><span data-stu-id="8c9d8-391">Before You Begin</span></span> |<span data-ttu-id="8c9d8-392">Use defaults</span><span class="sxs-lookup"><span data-stu-id="8c9d8-392">Use defaults</span></span> |
   | <span data-ttu-id="8c9d8-393">Select Servers</span><span class="sxs-lookup"><span data-stu-id="8c9d8-393">Select Servers</span></span> |<span data-ttu-id="8c9d8-394">Type **ContosoSQL1** in **Enter server name** and click **Add**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-394">Type **ContosoSQL1** in **Enter server name** and click **Add**</span></span> |
   | <span data-ttu-id="8c9d8-395">Validation Warning</span><span class="sxs-lookup"><span data-stu-id="8c9d8-395">Validation Warning</span></span> |<span data-ttu-id="8c9d8-396">Select **No. I do not require support from Microsoft for this cluster, and therefore do not want to run the validation tests. When I click Next, continue creating the cluster**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-396">Select **No. I do not require support from Microsoft for this cluster, and therefore do not want to run the validation tests. When I click Next, continue creating the cluster**.</span></span> |
   | <span data-ttu-id="8c9d8-397">Access Point for Administering the Cluster</span><span class="sxs-lookup"><span data-stu-id="8c9d8-397">Access Point for Administering the Cluster</span></span> |<span data-ttu-id="8c9d8-398">Type **Cluster1** in **Cluster Name**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-398">Type **Cluster1** in **Cluster Name**</span></span> |
   | <span data-ttu-id="8c9d8-399">Confirmation</span><span class="sxs-lookup"><span data-stu-id="8c9d8-399">Confirmation</span></span> |<span data-ttu-id="8c9d8-400">Use defaults unless you are using Storage Spaces.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-400">Use defaults unless you are using Storage Spaces.</span></span> <span data-ttu-id="8c9d8-401">See the warning following this table.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-401">See the warning following this table.</span></span> |
   
   > [!WARNING]
   > If you are using [Storage Spaces](https://technet.microsoft.com/library/hh831739), which groups multiple disks into storage pools, you must clear the **Add all eligible storage to the cluster** check box on the **Confirmation** page. If you do not clear this option, the virtual disks will be detached during the clustering process. As a result, they will also not appear in Disk Manager or Explorer until the storage spaces are removed from the cluster and reattached by using PowerShell.
   > 
   > 
5. <span data-ttu-id="8c9d8-405">In the left pane, expand **Failover Cluster Manager**, and then click **Cluster1.corp.contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-405">In the left pane, expand **Failover Cluster Manager**, and then click **Cluster1.corp.contoso.com**.</span></span>
6. <span data-ttu-id="8c9d8-406">In the center pane, scroll down to the **Cluster Core Resources** section, and expand the **Name: Clutser1** details.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-406">In the center pane, scroll down to the **Cluster Core Resources** section, and expand the **Name: Clutser1** details.</span></span> <span data-ttu-id="8c9d8-407">You should see both the **Name** and the **IP Address** resources in the **Failed** state.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-407">You should see both the **Name** and the **IP Address** resources in the **Failed** state.</span></span> <span data-ttu-id="8c9d8-408">The IP address resource cannot be brought online because the cluster is assigned the same IP address as the machine itself, which is a duplicate address.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-408">The IP address resource cannot be brought online because the cluster is assigned the same IP address as the machine itself, which is a duplicate address.</span></span>
7. <span data-ttu-id="8c9d8-409">Right-click the failed **IP Address** resource, and then click **Properties**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-409">Right-click the failed **IP Address** resource, and then click **Properties**.</span></span>
   
    ![Cluster properties](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784633.png)
8. <span data-ttu-id="8c9d8-411">Select **Static IP Address**, specify **10.10.2.101** in the **Address** text box, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-411">Select **Static IP Address**, specify **10.10.2.101** in the **Address** text box, and then click **OK**.</span></span>
9. <span data-ttu-id="8c9d8-412">In the **Cluster Core Resources** section, right-click **Name: Cluster1**, and then click **Bring Online**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-412">In the **Cluster Core Resources** section, right-click **Name: Cluster1**, and then click **Bring Online**.</span></span> <span data-ttu-id="8c9d8-413">Wait until both resources are online.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-413">Wait until both resources are online.</span></span> <span data-ttu-id="8c9d8-414">When the cluster name resource comes online, the DC server is updated with a new Active Directory computer account.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-414">When the cluster name resource comes online, the DC server is updated with a new Active Directory computer account.</span></span> <span data-ttu-id="8c9d8-415">This Active Directory account will be used to run the availability group clustered service later.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-415">This Active Directory account will be used to run the availability group clustered service later.</span></span>
10. <span data-ttu-id="8c9d8-416">Add the remaining nodes to the cluster.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-416">Add the remaining nodes to the cluster.</span></span> <span data-ttu-id="8c9d8-417">In the browser tree, right-click **Cluster1.corp.contoso.com**, and then click **Add Node**, as shown in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-417">In the browser tree, right-click **Cluster1.corp.contoso.com**, and then click **Add Node**, as shown in the following screenshot.</span></span>
    
     ![Add node to the cluster](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC784634.png)
11. <span data-ttu-id="8c9d8-419">In the **Add Node Wizard**, click **Next** on the **Select Servers** page, add **ContosoSQL2** and **ContosoWSFCNode** to the list by typing the server name in **Enter server name** and then clicking **Add**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-419">In the **Add Node Wizard**, click **Next** on the **Select Servers** page, add **ContosoSQL2** and **ContosoWSFCNode** to the list by typing the server name in **Enter server name** and then clicking **Add**.</span></span> <span data-ttu-id="8c9d8-420">When you are done, click **Next**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-420">When you are done, click **Next**.</span></span>
12. <span data-ttu-id="8c9d8-421">On the **Validation Warning** page, click **No**, although in a production scenario, you should perform the validation tests.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-421">On the **Validation Warning** page, click **No**, although in a production scenario, you should perform the validation tests.</span></span> <span data-ttu-id="8c9d8-422">Then, click **Next**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-422">Then, click **Next**.</span></span>
13. <span data-ttu-id="8c9d8-423">On the **Confirmation** page, click **Next** to add the nodes.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-423">On the **Confirmation** page, click **Next** to add the nodes.</span></span>
    
    > [!WARNING]
    > If you are using [Storage Spaces](https://technet.microsoft.com/library/hh831739), which groups multiple disks into storage pools, you must clear the **Add all eligible storage to the cluster** check box. If you do not clear this option, the virtual disks will be detached during the clustering process. As a result, they will also not appear in Disk Manager or Explorer until the storage spaces are removed from cluster and reattached using PowerShell.
    > 
    > 
14. <span data-ttu-id="8c9d8-427">After the nodes are added to the cluster, click **Finish**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-427">After the nodes are added to the cluster, click **Finish**.</span></span> <span data-ttu-id="8c9d8-428">Failover Cluster Manager should now show that your cluster has three nodes and list them in the **Nodes** container.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-428">Failover Cluster Manager should now show that your cluster has three nodes and list them in the **Nodes** container.</span></span>
15. <span data-ttu-id="8c9d8-429">Sign out of the remote desktop session.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-429">Sign out of the remote desktop session.</span></span>

## <a name="prepare-the-sql-server-instances-for-availability-groups"></a><span data-ttu-id="8c9d8-430">Prepare the SQL Server instances for availability groups</span><span class="sxs-lookup"><span data-stu-id="8c9d8-430">Prepare the SQL Server instances for availability groups</span></span>
<span data-ttu-id="8c9d8-431">In this section, you will do the following on both **ContosoSQL1** and **contosoSQL2**:</span><span class="sxs-lookup"><span data-stu-id="8c9d8-431">In this section, you will do the following on both **ContosoSQL1** and **contosoSQL2**:</span></span>

* <span data-ttu-id="8c9d8-432">Add a login for **NT AUTHORITY\System** with necessary permissions set to the default SQL Server instance.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-432">Add a login for **NT AUTHORITY\System** with necessary permissions set to the default SQL Server instance.</span></span>
* <span data-ttu-id="8c9d8-433">Add **CORP\Install** as a sysadmin role to the default SQL Server instance.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-433">Add **CORP\Install** as a sysadmin role to the default SQL Server instance.</span></span>
* <span data-ttu-id="8c9d8-434">Open the firewall for remote access of SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-434">Open the firewall for remote access of SQL Server.</span></span>
* <span data-ttu-id="8c9d8-435">Enable the Always On availability groups feature.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-435">Enable the Always On availability groups feature.</span></span>
* <span data-ttu-id="8c9d8-436">Change the SQL Server service account to **CORP\SQLSvc1** and **CORP\SQLSvc2**, respectively.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-436">Change the SQL Server service account to **CORP\SQLSvc1** and **CORP\SQLSvc2**, respectively.</span></span>

<span data-ttu-id="8c9d8-437">These actions can be performed in any order.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-437">These actions can be performed in any order.</span></span> <span data-ttu-id="8c9d8-438">Nevertheless, the following steps will walk through them in order.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-438">Nevertheless, the following steps will walk through them in order.</span></span> <span data-ttu-id="8c9d8-439">Follow the steps for both **ContosoSQL1** and **ContosoSQL2**:</span><span class="sxs-lookup"><span data-stu-id="8c9d8-439">Follow the steps for both **ContosoSQL1** and **ContosoSQL2**:</span></span>

1. <span data-ttu-id="8c9d8-440">If you have not signed out of the remote desktop session for the virtual machine, do so now.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-440">If you have not signed out of the remote desktop session for the virtual machine, do so now.</span></span>
2. <span data-ttu-id="8c9d8-441">Open the RDP files for **ContosoSQL1** and **ContosoSQL2**, and sign in as **BUILTIN\AzureAdmin**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-441">Open the RDP files for **ContosoSQL1** and **ContosoSQL2**, and sign in as **BUILTIN\AzureAdmin**.</span></span>
3. <span data-ttu-id="8c9d8-442">Add **NT AUTHORITY\System** to the SQL Server logins with necessary permissions.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-442">Add **NT AUTHORITY\System** to the SQL Server logins with necessary permissions.</span></span> <span data-ttu-id="8c9d8-443">Open **SQL Server Management Studio**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-443">Open **SQL Server Management Studio**.</span></span>
4. <span data-ttu-id="8c9d8-444">Click **Connect** to connect to the default SQL Server instance.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-444">Click **Connect** to connect to the default SQL Server instance.</span></span>
5. <span data-ttu-id="8c9d8-445">In **Object Explorer**, expand **Security**, and then expand **Logins**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-445">In **Object Explorer**, expand **Security**, and then expand **Logins**.</span></span>
6. <span data-ttu-id="8c9d8-446">Right-click the **NT AUTHORITY\System** login, and then click **Properties**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-446">Right-click the **NT AUTHORITY\System** login, and then click **Properties**.</span></span>
7. <span data-ttu-id="8c9d8-447">On the **Securables** page, for the local server, select **Grant** for the following permissions, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-447">On the **Securables** page, for the local server, select **Grant** for the following permissions, and then click **OK**.</span></span>
   
   * <span data-ttu-id="8c9d8-448">Alter any availability group</span><span class="sxs-lookup"><span data-stu-id="8c9d8-448">Alter any availability group</span></span>
   * <span data-ttu-id="8c9d8-449">Connect SQL</span><span class="sxs-lookup"><span data-stu-id="8c9d8-449">Connect SQL</span></span>
   * <span data-ttu-id="8c9d8-450">View server state</span><span class="sxs-lookup"><span data-stu-id="8c9d8-450">View server state</span></span>
8. <span data-ttu-id="8c9d8-451">Add **CORP\Install** as a **sysadmin** role to the default SQL Server instance.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-451">Add **CORP\Install** as a **sysadmin** role to the default SQL Server instance.</span></span> <span data-ttu-id="8c9d8-452">In **Object Explorer**, right-click **Logins**, and then click **New Login**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-452">In **Object Explorer**, right-click **Logins**, and then click **New Login**.</span></span>
9. <span data-ttu-id="8c9d8-453">Type **CORP\Install** in **Login name**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-453">Type **CORP\Install** in **Login name**.</span></span>
10. <span data-ttu-id="8c9d8-454">On the **Server Roles** page, select **sysadmin**, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-454">On the **Server Roles** page, select **sysadmin**, and then click **OK**.</span></span> <span data-ttu-id="8c9d8-455">After you create the login, you can see it by expanding **Logins** in **Object Explorer**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-455">After you create the login, you can see it by expanding **Logins** in **Object Explorer**.</span></span>
11. <span data-ttu-id="8c9d8-456">To create a firewall rule for SQL Server, on the **Start** screen, open **Windows Firewall with Advanced Security**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-456">To create a firewall rule for SQL Server, on the **Start** screen, open **Windows Firewall with Advanced Security**.</span></span>
12. <span data-ttu-id="8c9d8-457">In the left pane, select **Inbound Rules**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-457">In the left pane, select **Inbound Rules**.</span></span> <span data-ttu-id="8c9d8-458">In the right pane, click **New Rule**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-458">In the right pane, click **New Rule**.</span></span>
13. <span data-ttu-id="8c9d8-459">On the **Rule Type** page, click **Program** > **Next**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-459">On the **Rule Type** page, click **Program** > **Next**.</span></span>
14. <span data-ttu-id="8c9d8-460">On the **Program** page, select **This program path**, type **%ProgramFiles%\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\Binn\sqlservr.exe** in the text box, and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-460">On the **Program** page, select **This program path**, type **%ProgramFiles%\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\Binn\sqlservr.exe** in the text box, and then click **Next**.</span></span> <span data-ttu-id="8c9d8-461">If you are following these directions but using SQL Server 2012, the SQL Server directory is **MSSQL11.MSSQLSERVER**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-461">If you are following these directions but using SQL Server 2012, the SQL Server directory is **MSSQL11.MSSQLSERVER**.</span></span>
15. <span data-ttu-id="8c9d8-462">On the **Action** page, keep **Allow the connection** selected, and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-462">On the **Action** page, keep **Allow the connection** selected, and then click **Next**.</span></span>
16. <span data-ttu-id="8c9d8-463">On the **Profile** page, accept the default settings, and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-463">On the **Profile** page, accept the default settings, and then click **Next**.</span></span>
17. <span data-ttu-id="8c9d8-464">On the **Name** page, specify a rule name, such as **SQL Server (Program Rule)**, in the **Name** text box, then click **Finish**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-464">On the **Name** page, specify a rule name, such as **SQL Server (Program Rule)**, in the **Name** text box, then click **Finish**.</span></span>
18. <span data-ttu-id="8c9d8-465">To enable the **Always On Availability Groups** feature, on the **Start** screen, open **SQL Server Configuration Manager**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-465">To enable the **Always On Availability Groups** feature, on the **Start** screen, open **SQL Server Configuration Manager**.</span></span>
19. <span data-ttu-id="8c9d8-466">In the browser tree, click **SQL Server Services**, right-click the **SQL Server (MSSQLSERVER)** service, and then click **Properties**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-466">In the browser tree, click **SQL Server Services**, right-click the **SQL Server (MSSQLSERVER)** service, and then click **Properties**.</span></span>
20. <span data-ttu-id="8c9d8-467">Click the **Always On High Availability** tab, select **Enable Always On Availability Groups**, as shown in the following screenshot, and then click **Apply**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-467">Click the **Always On High Availability** tab, select **Enable Always On Availability Groups**, as shown in the following screenshot, and then click **Apply**.</span></span> <span data-ttu-id="8c9d8-468">Click **OK** in the dialog box, and do not close the **Properties** dialog box yet.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-468">Click **OK** in the dialog box, and do not close the **Properties** dialog box yet.</span></span> <span data-ttu-id="8c9d8-469">You will restart the SQL Server service after you change the service account.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-469">You will restart the SQL Server service after you change the service account.</span></span>
    
     ![Enable Always On Availability Groups](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665520.gif)
21. <span data-ttu-id="8c9d8-471">To change the SQL Server service account, click the **Log On** tab, type **CORP\SQLSvc1** (for **ContosoSQL1**) or **CORP\SQLSvc2** (for **ContosoSQL2**) in **Account Name**, fill in and confirm the password, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-471">To change the SQL Server service account, click the **Log On** tab, type **CORP\SQLSvc1** (for **ContosoSQL1**) or **CORP\SQLSvc2** (for **ContosoSQL2**) in **Account Name**, fill in and confirm the password, and then click **OK**.</span></span>
22. <span data-ttu-id="8c9d8-472">In the dialog box that opens, click **Yes** to restart the SQL Server service.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-472">In the dialog box that opens, click **Yes** to restart the SQL Server service.</span></span> <span data-ttu-id="8c9d8-473">After the SQL Server service restarts, changes that you made in the **Properties** dialog box are effective.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-473">After the SQL Server service restarts, changes that you made in the **Properties** dialog box are effective.</span></span>
23. <span data-ttu-id="8c9d8-474">Sign out of the virtual machines.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-474">Sign out of the virtual machines.</span></span>

## <a name="create-the-availability-group"></a><span data-ttu-id="8c9d8-475">Create the availability group</span><span class="sxs-lookup"><span data-stu-id="8c9d8-475">Create the availability group</span></span>
<span data-ttu-id="8c9d8-476">You are now ready to configure an availability group.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-476">You are now ready to configure an availability group.</span></span> <span data-ttu-id="8c9d8-477">Below is an outline of what you will do:</span><span class="sxs-lookup"><span data-stu-id="8c9d8-477">Below is an outline of what you will do:</span></span>

* <span data-ttu-id="8c9d8-478">Create a new database (**MyDB1**) on **ContosoSQL1**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-478">Create a new database (**MyDB1**) on **ContosoSQL1**.</span></span>
* <span data-ttu-id="8c9d8-479">Take both a full backup and a transaction log backup of the database.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-479">Take both a full backup and a transaction log backup of the database.</span></span>
* <span data-ttu-id="8c9d8-480">Restore the full and log backups to **ContosoSQL2** with the **NORECOVERY** option.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-480">Restore the full and log backups to **ContosoSQL2** with the **NORECOVERY** option.</span></span>
* <span data-ttu-id="8c9d8-481">Create the availability group (**AG1**) with synchronous commit, automatic failover, and readable secondary replicas.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-481">Create the availability group (**AG1**) with synchronous commit, automatic failover, and readable secondary replicas.</span></span>

### <a name="create-the-mydb1-database-on-contososql1"></a><span data-ttu-id="8c9d8-482">Create the MyDB1 database on ContosoSQL1</span><span class="sxs-lookup"><span data-stu-id="8c9d8-482">Create the MyDB1 database on ContosoSQL1</span></span>
1. <span data-ttu-id="8c9d8-483">If you have not already signed out of the remote desktop sessions for **ContosoSQL1** and **ContosoSQL2**, do so now.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-483">If you have not already signed out of the remote desktop sessions for **ContosoSQL1** and **ContosoSQL2**, do so now.</span></span>
2. <span data-ttu-id="8c9d8-484">Open the RDP file for **ContosoSQL1**, and sign in as **CORP\Install**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-484">Open the RDP file for **ContosoSQL1**, and sign in as **CORP\Install**.</span></span>
3. <span data-ttu-id="8c9d8-485">In **File Explorer**, under **C:\\**, create a directory named **backup**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-485">In **File Explorer**, under **C:\\**, create a directory named **backup**.</span></span> <span data-ttu-id="8c9d8-486">You will use this directory to back up and restore your database.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-486">You will use this directory to back up and restore your database.</span></span>
4. <span data-ttu-id="8c9d8-487">Right-click the new directory, point to **Share with**, and then click **Specific people**, as shown in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-487">Right-click the new directory, point to **Share with**, and then click **Specific people**, as shown in the following screenshot.</span></span>
   
    ![Create a backup folder](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665521.gif)
5. <span data-ttu-id="8c9d8-489">Add **CORP\SQLSvc1**, and then give it the **Read/Write** permission.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-489">Add **CORP\SQLSvc1**, and then give it the **Read/Write** permission.</span></span> <span data-ttu-id="8c9d8-490">Add **CORP\SQLSvc2**, and then give it the **Read** permission, as shown in the following screenshot, and then click **Share**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-490">Add **CORP\SQLSvc2**, and then give it the **Read** permission, as shown in the following screenshot, and then click **Share**.</span></span> <span data-ttu-id="8c9d8-491">After the file-sharing process is finished, click **Done**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-491">After the file-sharing process is finished, click **Done**.</span></span>
   
    ![Grant permissions for backup folder](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665522.gif)
6. <span data-ttu-id="8c9d8-493">To create the database, from the **Start** menu, open **SQL Server Management Studio**, and then click **Connect** to connect to the default SQL Server instance.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-493">To create the database, from the **Start** menu, open **SQL Server Management Studio**, and then click **Connect** to connect to the default SQL Server instance.</span></span>
7. <span data-ttu-id="8c9d8-494">In **Object Explorer**, right-click **Databases**, and then click **New Database**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-494">In **Object Explorer**, right-click **Databases**, and then click **New Database**.</span></span>
8. <span data-ttu-id="8c9d8-495">In **Database name**, type **MyDB1**, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-495">In **Database name**, type **MyDB1**, and then click **OK**.</span></span>

### <a name="make-a-full-backup-of-mydb1-and-restore-it-on-contososql2"></a><span data-ttu-id="8c9d8-496">Make a full backup of MyDB1 and restore it on ContosoSQL2</span><span class="sxs-lookup"><span data-stu-id="8c9d8-496">Make a full backup of MyDB1 and restore it on ContosoSQL2</span></span>
1. <span data-ttu-id="8c9d8-497">To make a full backup of the database, in **Object Explorer**, expand **Databases**, right-click **MyDB1**, point to **Tasks**, and then click **Back Up**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-497">To make a full backup of the database, in **Object Explorer**, expand **Databases**, right-click **MyDB1**, point to **Tasks**, and then click **Back Up**.</span></span>
2. <span data-ttu-id="8c9d8-498">In the **Source** section, keep **Backup type** set to **Full**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-498">In the **Source** section, keep **Backup type** set to **Full**.</span></span> <span data-ttu-id="8c9d8-499">In the **Destination** section, click **Remove** to remove the default file path for the backup file.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-499">In the **Destination** section, click **Remove** to remove the default file path for the backup file.</span></span>
3. <span data-ttu-id="8c9d8-500">In the **Destination** section, click **Add**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-500">In the **Destination** section, click **Add**.</span></span>
4. <span data-ttu-id="8c9d8-501">In the **File name** text box, type **\\ContosoSQL1\backup\MyDB1.bak**, click **OK**, and then click **OK** again to back up the database.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-501">In the **File name** text box, type **\\ContosoSQL1\backup\MyDB1.bak**, click **OK**, and then click **OK** again to back up the database.</span></span> <span data-ttu-id="8c9d8-502">When the backup operation finishes, click **OK** again to close the dialog box.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-502">When the backup operation finishes, click **OK** again to close the dialog box.</span></span>
5. <span data-ttu-id="8c9d8-503">To make a transaction log backup of the database, in **Object Explorer**, expand **Databases**, right-click **MyDB1**, point to **Tasks**, and then click **Back Up**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-503">To make a transaction log backup of the database, in **Object Explorer**, expand **Databases**, right-click **MyDB1**, point to **Tasks**, and then click **Back Up**.</span></span>
6. <span data-ttu-id="8c9d8-504">In **Backup type**, select **Transaction Log**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-504">In **Backup type**, select **Transaction Log**.</span></span> <span data-ttu-id="8c9d8-505">Keep the **Destination** file path set to the one you specified earlier, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-505">Keep the **Destination** file path set to the one you specified earlier, and then click **OK**.</span></span> <span data-ttu-id="8c9d8-506">After the backup operation finishes, click **OK** again.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-506">After the backup operation finishes, click **OK** again.</span></span>
7. <span data-ttu-id="8c9d8-507">To restore the full and transaction log backups on **ContosoSQL2**, open the RDP file for **ContosoSQL2**, and sign in as **CORP\Install**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-507">To restore the full and transaction log backups on **ContosoSQL2**, open the RDP file for **ContosoSQL2**, and sign in as **CORP\Install**.</span></span> <span data-ttu-id="8c9d8-508">Leave the remote desktop session for **ContosoSQL1** open.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-508">Leave the remote desktop session for **ContosoSQL1** open.</span></span>
8. <span data-ttu-id="8c9d8-509">From the **Start** menu, open **SQL Server Management Studio**, and then click **Connect** to connect to the default SQL Server instance.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-509">From the **Start** menu, open **SQL Server Management Studio**, and then click **Connect** to connect to the default SQL Server instance.</span></span>
9. <span data-ttu-id="8c9d8-510">In **Object Explorer**, right-click **Databases**, and then click **Restore Database**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-510">In **Object Explorer**, right-click **Databases**, and then click **Restore Database**.</span></span>
10. <span data-ttu-id="8c9d8-511">In the **Source** section, select **Device**, and click the ellipsis **…**</span><span class="sxs-lookup"><span data-stu-id="8c9d8-511">In the **Source** section, select **Device**, and click the ellipsis **…**</span></span> <span data-ttu-id="8c9d8-512">button.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-512">button.</span></span>
11. <span data-ttu-id="8c9d8-513">In **Select backup devices**, click **Add**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-513">In **Select backup devices**, click **Add**.</span></span>
12. <span data-ttu-id="8c9d8-514">In **Backup file location**, type **\\ContosoSQL1\backup**, click **Refresh**, select **MyDB1.bak**, click **OK**, and then click **OK** again.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-514">In **Backup file location**, type **\\ContosoSQL1\backup**, click **Refresh**, select **MyDB1.bak**, click **OK**, and then click **OK** again.</span></span> <span data-ttu-id="8c9d8-515">You should now see the full backup and the log backup in the **Backup sets to restore** pane.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-515">You should now see the full backup and the log backup in the **Backup sets to restore** pane.</span></span>
13. <span data-ttu-id="8c9d8-516">Go to the **Options** page, select **RESTORE WITH NORECOVERY** in **Recovery state**, and then click **OK** to restore the database.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-516">Go to the **Options** page, select **RESTORE WITH NORECOVERY** in **Recovery state**, and then click **OK** to restore the database.</span></span> <span data-ttu-id="8c9d8-517">After the restore operation finishes, click **OK**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-517">After the restore operation finishes, click **OK**.</span></span>

### <a name="create-the-availability-group"></a><span data-ttu-id="8c9d8-518">Create the availability group</span><span class="sxs-lookup"><span data-stu-id="8c9d8-518">Create the availability group</span></span>
1. <span data-ttu-id="8c9d8-519">Go back to the remote desktop session for **ContosoSQL1**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-519">Go back to the remote desktop session for **ContosoSQL1**.</span></span> <span data-ttu-id="8c9d8-520">In **Object Explorer** in SQL Server Management Studio, right-click **Always On High Availability**, and then click **New Availability Group Wizard**, as shown in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-520">In **Object Explorer** in SQL Server Management Studio, right-click **Always On High Availability**, and then click **New Availability Group Wizard**, as shown in the following screenshot.</span></span>
   
    ![Start New Availability Group Wizard](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665523.gif)
2. <span data-ttu-id="8c9d8-522">On the **Introduction** page, click **Next**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-522">On the **Introduction** page, click **Next**.</span></span> <span data-ttu-id="8c9d8-523">On the **Specify Availability Group Name** page, type **AG1** in **Availability group name**, then click **Next** again.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-523">On the **Specify Availability Group Name** page, type **AG1** in **Availability group name**, then click **Next** again.</span></span>
   
    ![New Availability Group Wizard, Specify availability group name](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665524.gif)
3. <span data-ttu-id="8c9d8-525">On the **Select Databases** page, select **MyDB1**, and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-525">On the **Select Databases** page, select **MyDB1**, and then click **Next**.</span></span> <span data-ttu-id="8c9d8-526">The database meets the prerequisites for an availability group because you have taken at least one full backup on the intended primary replica.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-526">The database meets the prerequisites for an availability group because you have taken at least one full backup on the intended primary replica.</span></span>
   
    ![New Availabilty Group Wizard, Select databases](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665525.gif)
4. <span data-ttu-id="8c9d8-528">on the **Specify Replicas** page, click **Add Replica**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-528">on the **Specify Replicas** page, click **Add Replica**.</span></span>
   
    ![New Availabilty Group Wizard, Specify replicas](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665526.gif)
5. <span data-ttu-id="8c9d8-530">In the **Connect to Server** dialog box, type **ContosoSQL2** in **Server name**, and then click **Connect**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-530">In the **Connect to Server** dialog box, type **ContosoSQL2** in **Server name**, and then click **Connect**.</span></span>
   
    ![New Availabilty Group Wizard, Connect to server](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665527.gif)
6. <span data-ttu-id="8c9d8-532">Back on the **Specify Replicas** page, you should now see **ContosoSQL2** listed in **Available Replicas**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-532">Back on the **Specify Replicas** page, you should now see **ContosoSQL2** listed in **Available Replicas**.</span></span> <span data-ttu-id="8c9d8-533">Configure the replicas as shown in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-533">Configure the replicas as shown in the following screenshot.</span></span> <span data-ttu-id="8c9d8-534">When you are finished, click **Next**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-534">When you are finished, click **Next**.</span></span>
   
    ![New Availabilty Group Wizard, Specify replicas (Complete)](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665528.gif)
7. <span data-ttu-id="8c9d8-536">On the **Select Initial Data Synchronization** page, select **Join only**, and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-536">On the **Select Initial Data Synchronization** page, select **Join only**, and then click **Next**.</span></span> <span data-ttu-id="8c9d8-537">You already performed data synchronization manually when you made the full and transaction backups on **ContosoSQL1** and restored them on **ContosoSQL2**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-537">You already performed data synchronization manually when you made the full and transaction backups on **ContosoSQL1** and restored them on **ContosoSQL2**.</span></span> <span data-ttu-id="8c9d8-538">You can choose not to perform the backup and restore operations on your database and instead select **Full** to let the New Availability Group Wizard perform data synchronization for you.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-538">You can choose not to perform the backup and restore operations on your database and instead select **Full** to let the New Availability Group Wizard perform data synchronization for you.</span></span> <span data-ttu-id="8c9d8-539">However, we do not recommend this option for very large databases that are found in some enterprises.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-539">However, we do not recommend this option for very large databases that are found in some enterprises.</span></span>
   
    ![New Availabilty Group Wizard, Select initial data synchronization](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665529.gif)
8. <span data-ttu-id="8c9d8-541">On the **Validation** page, click **Next**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-541">On the **Validation** page, click **Next**.</span></span> <span data-ttu-id="8c9d8-542">This page should look similar to the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-542">This page should look similar to the following screenshot.</span></span> <span data-ttu-id="8c9d8-543">There is a warning for the listener configuration because you have not configured an availability group listener.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-543">There is a warning for the listener configuration because you have not configured an availability group listener.</span></span> <span data-ttu-id="8c9d8-544">You can ignore this warning, because this tutorial does not configure a listener.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-544">You can ignore this warning, because this tutorial does not configure a listener.</span></span> <span data-ttu-id="8c9d8-545">To configure the listener after you complete this tutorial, see [Configure an ILB listener for Always On Availability Groups in Azure](../classic/ps-sql-int-listener.md).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-545">To configure the listener after you complete this tutorial, see [Configure an ILB listener for Always On Availability Groups in Azure](../classic/ps-sql-int-listener.md).</span></span>
   
    ![New Availabilty Group Wizard, Validation](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665530.gif)
9. <span data-ttu-id="8c9d8-547">On the **Summary** page, click **Finish**, and then wait while the wizard configures the new availability group.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-547">On the **Summary** page, click **Finish**, and then wait while the wizard configures the new availability group.</span></span> <span data-ttu-id="8c9d8-548">On the **Progress** page, you can click **More details** to view the detailed progress.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-548">On the **Progress** page, you can click **More details** to view the detailed progress.</span></span> <span data-ttu-id="8c9d8-549">After the wizard finishes, inspect the **Results** page to verify that the availability group is successfully created, as shown in the following screenshot, and then click **Close** to exit the wizard.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-549">After the wizard finishes, inspect the **Results** page to verify that the availability group is successfully created, as shown in the following screenshot, and then click **Close** to exit the wizard.</span></span>
   
    ![New Availabilty Group Wizard, Results](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665531.gif)
10. <span data-ttu-id="8c9d8-551">In **Object Explorer**, expand **Always On High Availability**, and then expand **Availability Groups**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-551">In **Object Explorer**, expand **Always On High Availability**, and then expand **Availability Groups**.</span></span> <span data-ttu-id="8c9d8-552">You should now see the new availability group in this container.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-552">You should now see the new availability group in this container.</span></span> <span data-ttu-id="8c9d8-553">Right-click **AG1 (Primary)**, and then click **Show Dashboard**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-553">Right-click **AG1 (Primary)**, and then click **Show Dashboard**.</span></span>
    
     ![Show Availability Group Dashboard](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665532.gif)
11. <span data-ttu-id="8c9d8-555">Your **Always On Dashboard** should look similar to the one in the following screenshot.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-555">Your **Always On Dashboard** should look similar to the one in the following screenshot.</span></span> <span data-ttu-id="8c9d8-556">You can see the replicas, the failover mode of each replica, and the synchronization state.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-556">You can see the replicas, the failover mode of each replica, and the synchronization state.</span></span>
    
     ![Availability Group Dashboard](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665533.gif)
12. <span data-ttu-id="8c9d8-558">Return to **Server Manager**, click **Tools**, and then open **Failover Cluster Manager**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-558">Return to **Server Manager**, click **Tools**, and then open **Failover Cluster Manager**.</span></span>
13. <span data-ttu-id="8c9d8-559">Expand **Cluster1.corp.contoso.com**, and then expand **Services and applications**.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-559">Expand **Cluster1.corp.contoso.com**, and then expand **Services and applications**.</span></span> <span data-ttu-id="8c9d8-560">Select **Roles** and note that the **AG1** availability group role has been created.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-560">Select **Roles** and note that the **AG1** availability group role has been created.</span></span> <span data-ttu-id="8c9d8-561">Note that AG1 does not have an IP address by which database clients can connect to the availability group, because you did not configure a listener.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-561">Note that AG1 does not have an IP address by which database clients can connect to the availability group, because you did not configure a listener.</span></span> <span data-ttu-id="8c9d8-562">You can connect directly to the primary node for read-write operations and the secondary node for read-only queries.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-562">You can connect directly to the primary node for read-write operations and the secondary node for read-only queries.</span></span>
    
     ![AG in Failover Cluster Manager](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sqlclassic/media/virtual-machines-windows-classic-portal-sql-alwayson-availability-groups/IC665534.gif)

> [!WARNING]
> Do not try to fail over the availability group from the Failover Cluster Manager. All failover operations should be performed from within **Always On Dashboard** in SQL Server Management Studio. For more information, see [Restrictions on Using The Failover Cluster Manager with Availability Groups](https://msdn.microsoft.com/library/ff929171.aspx).
> 
> 

## <a name="next-steps"></a><span data-ttu-id="8c9d8-567">Next steps</span><span class="sxs-lookup"><span data-stu-id="8c9d8-567">Next steps</span></span>
<span data-ttu-id="8c9d8-568">You have now successfully implemented SQL Server Always On by creating an availability group in Azure.</span><span class="sxs-lookup"><span data-stu-id="8c9d8-568">You have now successfully implemented SQL Server Always On by creating an availability group in Azure.</span></span> <span data-ttu-id="8c9d8-569">To configure a listener for this availability group, see [Configure an ILB listener for Always On availability groups in Azure](../classic/ps-sql-int-listener.md).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-569">To configure a listener for this availability group, see [Configure an ILB listener for Always On availability groups in Azure](../classic/ps-sql-int-listener.md).</span></span>

<span data-ttu-id="8c9d8-570">For other information about using SQL Server in Azure, see [SQL Server on Azure Virtual Machines](../sql/virtual-machines-windows-sql-server-iaas-overview.md).</span><span class="sxs-lookup"><span data-stu-id="8c9d8-570">For other information about using SQL Server in Azure, see [SQL Server on Azure Virtual Machines](../sql/virtual-machines-windows-sql-server-iaas-overview.md).</span></span>




































