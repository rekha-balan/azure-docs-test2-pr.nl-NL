---
title: Performance best practices for SQL Server | Microsoft Docs
description: Provides best practices for optimizing SQL Server performance in Microsoft Azure VMs.
services: virtual-machines-windows
documentationcenter: na
author: rothja
manager: jhubbard
editor: ''
tags: azure-service-management
ms.assetid: a0c85092-2113-4982-b73a-4e80160bac36
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 01/09/2017
ms.author: jroth
ms.openlocfilehash: 7a2d1aebddc0c8dabe2331c789de777208bf7f30
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44555917"
---
# <a name="performance-best-practices-for-sql-server-in-azure-virtual-machines"></a><span data-ttu-id="92fea-103">Performance best practices for SQL Server in Azure Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="92fea-103">Performance best practices for SQL Server in Azure Virtual Machines</span></span>
## <a name="overview"></a><span data-ttu-id="92fea-104">Overview</span><span class="sxs-lookup"><span data-stu-id="92fea-104">Overview</span></span>
<span data-ttu-id="92fea-105">This topic provides best practices for optimizing SQL Server performance in Microsoft Azure Virtual Machine.</span><span class="sxs-lookup"><span data-stu-id="92fea-105">This topic provides best practices for optimizing SQL Server performance in Microsoft Azure Virtual Machine.</span></span> <span data-ttu-id="92fea-106">While running SQL Server in Azure Virtual Machines, we recommend that you continue using the same database performance tuning options that are applicable to SQL Server in on-premises server environment.</span><span class="sxs-lookup"><span data-stu-id="92fea-106">While running SQL Server in Azure Virtual Machines, we recommend that you continue using the same database performance tuning options that are applicable to SQL Server in on-premises server environment.</span></span> <span data-ttu-id="92fea-107">However, the performance of a relational database in a public cloud depends on many factors such as the size of a virtual machine, and the configuration of the data disks.</span><span class="sxs-lookup"><span data-stu-id="92fea-107">However, the performance of a relational database in a public cloud depends on many factors such as the size of a virtual machine, and the configuration of the data disks.</span></span>

<span data-ttu-id="92fea-108">When creating SQL Server images, [consider provisioning your VMs in the Azure portal](virtual-machines-windows-portal-sql-server-provision.md).</span><span class="sxs-lookup"><span data-stu-id="92fea-108">When creating SQL Server images, [consider provisioning your VMs in the Azure portal](virtual-machines-windows-portal-sql-server-provision.md).</span></span> <span data-ttu-id="92fea-109">SQL Server VMs provisioned in the Portal with Resource Manager implement all these best practices, including the storage configuration.</span><span class="sxs-lookup"><span data-stu-id="92fea-109">SQL Server VMs provisioned in the Portal with Resource Manager implement all these best practices, including the storage configuration.</span></span>

<span data-ttu-id="92fea-110">This article is focused on getting the *best* performance for SQL Server on Azure VMs.</span><span class="sxs-lookup"><span data-stu-id="92fea-110">This article is focused on getting the *best* performance for SQL Server on Azure VMs.</span></span> <span data-ttu-id="92fea-111">If your workload is less demanding, you might not require every optimization listed below.</span><span class="sxs-lookup"><span data-stu-id="92fea-111">If your workload is less demanding, you might not require every optimization listed below.</span></span> <span data-ttu-id="92fea-112">Consider your performance needs and workload patterns as you evaluate these recommendations.</span><span class="sxs-lookup"><span data-stu-id="92fea-112">Consider your performance needs and workload patterns as you evaluate these recommendations.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../../includes/learn-about-deployment-models-both-include.md)]

## <a name="quick-check-list"></a><span data-ttu-id="92fea-113">Quick check list</span><span class="sxs-lookup"><span data-stu-id="92fea-113">Quick check list</span></span>
<span data-ttu-id="92fea-114">The following is a quick check list for optimal performance of SQL Server on Azure Virtual Machines:</span><span class="sxs-lookup"><span data-stu-id="92fea-114">The following is a quick check list for optimal performance of SQL Server on Azure Virtual Machines:</span></span>

| <span data-ttu-id="92fea-115">Area</span><span class="sxs-lookup"><span data-stu-id="92fea-115">Area</span></span> | <span data-ttu-id="92fea-116">Optimizations</span><span class="sxs-lookup"><span data-stu-id="92fea-116">Optimizations</span></span> |
| --- | --- |
| [<span data-ttu-id="92fea-117">VM size</span><span class="sxs-lookup"><span data-stu-id="92fea-117">VM size</span></span>](#vm-size-guidance) |<span data-ttu-id="92fea-118">[DS3](../../virtual-machines-windows-sizes-memory.md) or higher for SQL Enterprise edition.</span><span class="sxs-lookup"><span data-stu-id="92fea-118">[DS3](../../virtual-machines-windows-sizes-memory.md) or higher for SQL Enterprise edition.</span></span><br/><br/><span data-ttu-id="92fea-119">[DS2](../../virtual-machines-windows-sizes-memory.md) or higher for SQL Standard and Web editions.</span><span class="sxs-lookup"><span data-stu-id="92fea-119">[DS2](../../virtual-machines-windows-sizes-memory.md) or higher for SQL Standard and Web editions.</span></span> |
| [<span data-ttu-id="92fea-120">Storage</span><span class="sxs-lookup"><span data-stu-id="92fea-120">Storage</span></span>](#storage-guidance) |<span data-ttu-id="92fea-121">Use [Premium Storage](../../../storage/storage-premium-storage.md).</span><span class="sxs-lookup"><span data-stu-id="92fea-121">Use [Premium Storage](../../../storage/storage-premium-storage.md).</span></span> <span data-ttu-id="92fea-122">Standard storage is only recommended for dev/test.</span><span class="sxs-lookup"><span data-stu-id="92fea-122">Standard storage is only recommended for dev/test.</span></span><br/><br/><span data-ttu-id="92fea-123">Keep the [storage account](../../../storage/storage-create-storage-account.md) and SQL Server VM in the same region.</span><span class="sxs-lookup"><span data-stu-id="92fea-123">Keep the [storage account](../../../storage/storage-create-storage-account.md) and SQL Server VM in the same region.</span></span><br/><br/><span data-ttu-id="92fea-124">Disable Azure [geo-redundant storage](../../../storage/storage-redundancy.md) (geo-replication) on the storage account.</span><span class="sxs-lookup"><span data-stu-id="92fea-124">Disable Azure [geo-redundant storage](../../../storage/storage-redundancy.md) (geo-replication) on the storage account.</span></span> |
| [<span data-ttu-id="92fea-125">Disks</span><span class="sxs-lookup"><span data-stu-id="92fea-125">Disks</span></span>](#disks-guidance) |<span data-ttu-id="92fea-126">Use a minimum of 2 [P30 disks](../../../storage/storage-premium-storage.md#scalability-and-performance-targets) (1 for log files; 1 for data files and TempDB).</span><span class="sxs-lookup"><span data-stu-id="92fea-126">Use a minimum of 2 [P30 disks](../../../storage/storage-premium-storage.md#scalability-and-performance-targets) (1 for log files; 1 for data files and TempDB).</span></span><br/><br/><span data-ttu-id="92fea-127">Avoid using operating system or temporary disks for database storage or logging.</span><span class="sxs-lookup"><span data-stu-id="92fea-127">Avoid using operating system or temporary disks for database storage or logging.</span></span><br/><br/><span data-ttu-id="92fea-128">Enable read caching on the disk(s) hosting the data files and TempDB.</span><span class="sxs-lookup"><span data-stu-id="92fea-128">Enable read caching on the disk(s) hosting the data files and TempDB.</span></span><br/><br/><span data-ttu-id="92fea-129">Do not enable caching on disk(s) hosting the log file.</span><span class="sxs-lookup"><span data-stu-id="92fea-129">Do not enable caching on disk(s) hosting the log file.</span></span><br/><br/><span data-ttu-id="92fea-130">Important: Stop the SQL Server service when changing the cache settings for an Azure VM disk.</span><span class="sxs-lookup"><span data-stu-id="92fea-130">Important: Stop the SQL Server service when changing the cache settings for an Azure VM disk.</span></span><br/><br/><span data-ttu-id="92fea-131">Stripe multiple Azure data disks to get increased IO throughput.</span><span class="sxs-lookup"><span data-stu-id="92fea-131">Stripe multiple Azure data disks to get increased IO throughput.</span></span><br/><br/><span data-ttu-id="92fea-132">Format with documented allocation sizes.</span><span class="sxs-lookup"><span data-stu-id="92fea-132">Format with documented allocation sizes.</span></span> |
| [<span data-ttu-id="92fea-133">I/O</span><span class="sxs-lookup"><span data-stu-id="92fea-133">I/O</span></span>](#io-guidance) |<span data-ttu-id="92fea-134">Enable database page compression.</span><span class="sxs-lookup"><span data-stu-id="92fea-134">Enable database page compression.</span></span><br/><br/><span data-ttu-id="92fea-135">Enable instant file initialization for data files.</span><span class="sxs-lookup"><span data-stu-id="92fea-135">Enable instant file initialization for data files.</span></span><br/><br/><span data-ttu-id="92fea-136">Limit or disable autogrow on the database.</span><span class="sxs-lookup"><span data-stu-id="92fea-136">Limit or disable autogrow on the database.</span></span><br/><br/><span data-ttu-id="92fea-137">Disable autoshrink on the database.</span><span class="sxs-lookup"><span data-stu-id="92fea-137">Disable autoshrink on the database.</span></span><br/><br/><span data-ttu-id="92fea-138">Move all databases to data disks, including system databases.</span><span class="sxs-lookup"><span data-stu-id="92fea-138">Move all databases to data disks, including system databases.</span></span><br/><br/><span data-ttu-id="92fea-139">Move SQL Server error log and trace file directories to data disks.</span><span class="sxs-lookup"><span data-stu-id="92fea-139">Move SQL Server error log and trace file directories to data disks.</span></span><br/><br/><span data-ttu-id="92fea-140">Setup default backup and database file locations.</span><span class="sxs-lookup"><span data-stu-id="92fea-140">Setup default backup and database file locations.</span></span><br/><br/><span data-ttu-id="92fea-141">Enable locked pages.</span><span class="sxs-lookup"><span data-stu-id="92fea-141">Enable locked pages.</span></span><br/><br/><span data-ttu-id="92fea-142">Apply SQL Server performance fixes.</span><span class="sxs-lookup"><span data-stu-id="92fea-142">Apply SQL Server performance fixes.</span></span> |
| [<span data-ttu-id="92fea-143">Feature specific</span><span class="sxs-lookup"><span data-stu-id="92fea-143">Feature specific</span></span>](#feature-specific-guidance) |<span data-ttu-id="92fea-144">Back up directly to blob storage.</span><span class="sxs-lookup"><span data-stu-id="92fea-144">Back up directly to blob storage.</span></span> |

<span data-ttu-id="92fea-145">For more information on *how* and *why* to make these optimizations, please review the details and guidance provided in following sections.</span><span class="sxs-lookup"><span data-stu-id="92fea-145">For more information on *how* and *why* to make these optimizations, please review the details and guidance provided in following sections.</span></span>

## <a name="vm-size-guidance"></a><span data-ttu-id="92fea-146">VM size guidance</span><span class="sxs-lookup"><span data-stu-id="92fea-146">VM size guidance</span></span>
<span data-ttu-id="92fea-147">For performance sensitive applications, it’s recommended that you use the following [virtual machines sizes](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json):</span><span class="sxs-lookup"><span data-stu-id="92fea-147">For performance sensitive applications, it’s recommended that you use the following [virtual machines sizes](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json):</span></span>

* <span data-ttu-id="92fea-148">**SQL Server Enterprise Edition**: DS3 or higher</span><span class="sxs-lookup"><span data-stu-id="92fea-148">**SQL Server Enterprise Edition**: DS3 or higher</span></span>
* <span data-ttu-id="92fea-149">**SQL Server Standard and Web Editions**: DS2 or higher</span><span class="sxs-lookup"><span data-stu-id="92fea-149">**SQL Server Standard and Web Editions**: DS2 or higher</span></span>

## <a name="storage-guidance"></a><span data-ttu-id="92fea-150">Storage guidance</span><span class="sxs-lookup"><span data-stu-id="92fea-150">Storage guidance</span></span>
<span data-ttu-id="92fea-151">DS-series (along with DSv2-series and GS-series) VMs support [Premium Storage](../../../storage/storage-premium-storage.md).</span><span class="sxs-lookup"><span data-stu-id="92fea-151">DS-series (along with DSv2-series and GS-series) VMs support [Premium Storage](../../../storage/storage-premium-storage.md).</span></span> <span data-ttu-id="92fea-152">Premium Storage is recommended for all production workloads.</span><span class="sxs-lookup"><span data-stu-id="92fea-152">Premium Storage is recommended for all production workloads.</span></span>

> [!WARNING]
> <span data-ttu-id="92fea-153">Standard Storage has varying latencies and bandwidth and is only recommended for dev/test workloads.</span><span class="sxs-lookup"><span data-stu-id="92fea-153">Standard Storage has varying latencies and bandwidth and is only recommended for dev/test workloads.</span></span> <span data-ttu-id="92fea-154">Production workloads should use Premium Storage.</span><span class="sxs-lookup"><span data-stu-id="92fea-154">Production workloads should use Premium Storage.</span></span>
>
>

<span data-ttu-id="92fea-155">In addition, we recommend that you create your Azure storage account in the same data center as your SQL Server virtual machines to reduce transfer delays.</span><span class="sxs-lookup"><span data-stu-id="92fea-155">In addition, we recommend that you create your Azure storage account in the same data center as your SQL Server virtual machines to reduce transfer delays.</span></span> <span data-ttu-id="92fea-156">When creating a storage account, disable geo-replication as consistent write order across multiple disks is not guaranteed.</span><span class="sxs-lookup"><span data-stu-id="92fea-156">When creating a storage account, disable geo-replication as consistent write order across multiple disks is not guaranteed.</span></span> <span data-ttu-id="92fea-157">Instead, consider configuring a SQL Server disaster recovery technology between two Azure data centers.</span><span class="sxs-lookup"><span data-stu-id="92fea-157">Instead, consider configuring a SQL Server disaster recovery technology between two Azure data centers.</span></span> <span data-ttu-id="92fea-158">For more information, see [High Availability and Disaster Recovery for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-high-availability-dr.md).</span><span class="sxs-lookup"><span data-stu-id="92fea-158">For more information, see [High Availability and Disaster Recovery for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-high-availability-dr.md).</span></span>

## <a name="disks-guidance"></a><span data-ttu-id="92fea-159">Disks guidance</span><span class="sxs-lookup"><span data-stu-id="92fea-159">Disks guidance</span></span>
<span data-ttu-id="92fea-160">There are three main disk types on an Azure VM:</span><span class="sxs-lookup"><span data-stu-id="92fea-160">There are three main disk types on an Azure VM:</span></span>

* <span data-ttu-id="92fea-161">**OS disk**: When you create an Azure Virtual Machine, the platform will attach at least one disk (labeled as the **C** drive) to the VM for your operating system disk.</span><span class="sxs-lookup"><span data-stu-id="92fea-161">**OS disk**: When you create an Azure Virtual Machine, the platform will attach at least one disk (labeled as the **C** drive) to the VM for your operating system disk.</span></span> <span data-ttu-id="92fea-162">This disk is a VHD stored as a page blob in storage.</span><span class="sxs-lookup"><span data-stu-id="92fea-162">This disk is a VHD stored as a page blob in storage.</span></span>
* <span data-ttu-id="92fea-163">**Temporary disk**: Azure Virtual Machines contain another disk called the temporary disk (labeled as the **D**: drive).</span><span class="sxs-lookup"><span data-stu-id="92fea-163">**Temporary disk**: Azure Virtual Machines contain another disk called the temporary disk (labeled as the **D**: drive).</span></span> <span data-ttu-id="92fea-164">This is a disk on the node that can be used for scratch space.</span><span class="sxs-lookup"><span data-stu-id="92fea-164">This is a disk on the node that can be used for scratch space.</span></span>
* <span data-ttu-id="92fea-165">**Data disks**: You can also attach additional disks to your virtual machine as data disks, and these will be stored in storage as page blobs.</span><span class="sxs-lookup"><span data-stu-id="92fea-165">**Data disks**: You can also attach additional disks to your virtual machine as data disks, and these will be stored in storage as page blobs.</span></span>

<span data-ttu-id="92fea-166">The following sections describe recommendations for using these different disks.</span><span class="sxs-lookup"><span data-stu-id="92fea-166">The following sections describe recommendations for using these different disks.</span></span>

### <a name="operating-system-disk"></a><span data-ttu-id="92fea-167">Operating system disk</span><span class="sxs-lookup"><span data-stu-id="92fea-167">Operating system disk</span></span>
<span data-ttu-id="92fea-168">An operating system disk is a VHD that you can boot and mount as a running version of an operating system and is labeled as **C** drive.</span><span class="sxs-lookup"><span data-stu-id="92fea-168">An operating system disk is a VHD that you can boot and mount as a running version of an operating system and is labeled as **C** drive.</span></span>

<span data-ttu-id="92fea-169">Default caching policy on the operating system disk is **Read/Write**.</span><span class="sxs-lookup"><span data-stu-id="92fea-169">Default caching policy on the operating system disk is **Read/Write**.</span></span> <span data-ttu-id="92fea-170">For performance sensitive applications, we recommend that you use data disks instead of the operating system disk.</span><span class="sxs-lookup"><span data-stu-id="92fea-170">For performance sensitive applications, we recommend that you use data disks instead of the operating system disk.</span></span> <span data-ttu-id="92fea-171">See the section on Data Disks below.</span><span class="sxs-lookup"><span data-stu-id="92fea-171">See the section on Data Disks below.</span></span>

### <a name="temporary-disk"></a><span data-ttu-id="92fea-172">Temporary disk</span><span class="sxs-lookup"><span data-stu-id="92fea-172">Temporary disk</span></span>
<span data-ttu-id="92fea-173">The temporary storage drive, labeled as the **D**: drive, is not persisted to Azure blob storage.</span><span class="sxs-lookup"><span data-stu-id="92fea-173">The temporary storage drive, labeled as the **D**: drive, is not persisted to Azure blob storage.</span></span> <span data-ttu-id="92fea-174">Do not store your user database files or user transaction log files on the **D**: drive.</span><span class="sxs-lookup"><span data-stu-id="92fea-174">Do not store your user database files or user transaction log files on the **D**: drive.</span></span>

<span data-ttu-id="92fea-175">For D-series, Dv2-series, and G-series VMs, the temporary drive on these VMs is SSD-based.</span><span class="sxs-lookup"><span data-stu-id="92fea-175">For D-series, Dv2-series, and G-series VMs, the temporary drive on these VMs is SSD-based.</span></span> <span data-ttu-id="92fea-176">If your workload makes heavy use of TempDB (e.g. for temporary objects or complex joins), storing TempDB on the **D** drive could result in higher TempDB throughput and lower TempDB latency.</span><span class="sxs-lookup"><span data-stu-id="92fea-176">If your workload makes heavy use of TempDB (e.g. for temporary objects or complex joins), storing TempDB on the **D** drive could result in higher TempDB throughput and lower TempDB latency.</span></span>

<span data-ttu-id="92fea-177">For VMs that support Premium Storage (DS-series, DSv2-series, and GS-series), we recommend storing TempDB on a disk that supports Premium Storage with read caching enabled.</span><span class="sxs-lookup"><span data-stu-id="92fea-177">For VMs that support Premium Storage (DS-series, DSv2-series, and GS-series), we recommend storing TempDB on a disk that supports Premium Storage with read caching enabled.</span></span> <span data-ttu-id="92fea-178">There is one exception to this recommendation; if your TempDB usage is write-intensive, you can achieve higher performance by storing TempDB on the local **D** drive, which is also SSD-based on these machine sizes.</span><span class="sxs-lookup"><span data-stu-id="92fea-178">There is one exception to this recommendation; if your TempDB usage is write-intensive, you can achieve higher performance by storing TempDB on the local **D** drive, which is also SSD-based on these machine sizes.</span></span>

### <a name="data-disks"></a><span data-ttu-id="92fea-179">Data disks</span><span class="sxs-lookup"><span data-stu-id="92fea-179">Data disks</span></span>
* <span data-ttu-id="92fea-180">**Use data disks for data and log files**: At a minimum, use 2 Premium Storage [P30 disks](../../../storage/storage-premium-storage.md#scalability-and-performance-targets) where one disk contains the log file(s) and the other contains the data and TempDB file(s).</span><span class="sxs-lookup"><span data-stu-id="92fea-180">**Use data disks for data and log files**: At a minimum, use 2 Premium Storage [P30 disks](../../../storage/storage-premium-storage.md#scalability-and-performance-targets) where one disk contains the log file(s) and the other contains the data and TempDB file(s).</span></span> <span data-ttu-id="92fea-181">Each Premium Storage disk provides a number of IOPs and bandwidth (MB/s) depending on its size, as described in the following article: [Using Premium Storage for Disks](../../../storage/storage-premium-storage.md).</span><span class="sxs-lookup"><span data-stu-id="92fea-181">Each Premium Storage disk provides a number of IOPs and bandwidth (MB/s) depending on its size, as described in the following article: [Using Premium Storage for Disks](../../../storage/storage-premium-storage.md).</span></span> 
* <span data-ttu-id="92fea-182">**Disk Striping**: For more throughput, you can add additional data disks and use Disk Striping.</span><span class="sxs-lookup"><span data-stu-id="92fea-182">**Disk Striping**: For more throughput, you can add additional data disks and use Disk Striping.</span></span> <span data-ttu-id="92fea-183">To determine the number of data disks, you need to analyze the number of IOPS and bandwidth required for your log file(s), and for your data and TempDB file(s).</span><span class="sxs-lookup"><span data-stu-id="92fea-183">To determine the number of data disks, you need to analyze the number of IOPS and bandwidth required for your log file(s), and for your data and TempDB file(s).</span></span> <span data-ttu-id="92fea-184">Notice that different VM sizes have different limits on the number of IOPs and bandwidth supported, see the tables on IOPS per [VM size](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="92fea-184">Notice that different VM sizes have different limits on the number of IOPs and bandwidth supported, see the tables on IOPS per [VM size](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span> <span data-ttu-id="92fea-185">Use the following guidelines:</span><span class="sxs-lookup"><span data-stu-id="92fea-185">Use the following guidelines:</span></span>

  * <span data-ttu-id="92fea-186">For Windows 8/Windows Server 2012 or later, use [Storage Spaces](https://technet.microsoft.com/library/hh831739.aspx).</span><span class="sxs-lookup"><span data-stu-id="92fea-186">For Windows 8/Windows Server 2012 or later, use [Storage Spaces](https://technet.microsoft.com/library/hh831739.aspx).</span></span> <span data-ttu-id="92fea-187">Set stripe size to 64 KB for OLTP workloads and 256 KB for data warehousing workloads to avoid performance impact due to partition misalignment.</span><span class="sxs-lookup"><span data-stu-id="92fea-187">Set stripe size to 64 KB for OLTP workloads and 256 KB for data warehousing workloads to avoid performance impact due to partition misalignment.</span></span> <span data-ttu-id="92fea-188">In addition, set column count = number of physical disks.</span><span class="sxs-lookup"><span data-stu-id="92fea-188">In addition, set column count = number of physical disks.</span></span> <span data-ttu-id="92fea-189">To configure a Storage Space with more than 8 disks you must use PowerShell (not Server Manager UI) to explicitly set the number of columns to match the number of disks.</span><span class="sxs-lookup"><span data-stu-id="92fea-189">To configure a Storage Space with more than 8 disks you must use PowerShell (not Server Manager UI) to explicitly set the number of columns to match the number of disks.</span></span> <span data-ttu-id="92fea-190">For more information on how to configure [Storage Spaces](https://technet.microsoft.com/library/hh831739.aspx), see [Storage Spaces Cmdlets in Windows PowerShell](https://technet.microsoft.com/library/jj851254.aspx)</span><span class="sxs-lookup"><span data-stu-id="92fea-190">For more information on how to configure [Storage Spaces](https://technet.microsoft.com/library/hh831739.aspx), see [Storage Spaces Cmdlets in Windows PowerShell](https://technet.microsoft.com/library/jj851254.aspx)</span></span>
  * <span data-ttu-id="92fea-191">For Windows 2008 R2 or earlier, you can use dynamic disks (OS striped volumes) and the stripe size is always 64 KB.</span><span class="sxs-lookup"><span data-stu-id="92fea-191">For Windows 2008 R2 or earlier, you can use dynamic disks (OS striped volumes) and the stripe size is always 64 KB.</span></span> <span data-ttu-id="92fea-192">Note that this option is deprecated as of Windows 8/Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="92fea-192">Note that this option is deprecated as of Windows 8/Windows Server 2012.</span></span> <span data-ttu-id="92fea-193">For information, see the support statement at [Virtual Disk Service is transitioning to Windows Storage Management API](https://msdn.microsoft.com/library/windows/desktop/hh848071.aspx).</span><span class="sxs-lookup"><span data-stu-id="92fea-193">For information, see the support statement at [Virtual Disk Service is transitioning to Windows Storage Management API](https://msdn.microsoft.com/library/windows/desktop/hh848071.aspx).</span></span>
  * <span data-ttu-id="92fea-194">If your workload is not log intensive and does not need dedicated IOPs, you can configure just one storage pool.</span><span class="sxs-lookup"><span data-stu-id="92fea-194">If your workload is not log intensive and does not need dedicated IOPs, you can configure just one storage pool.</span></span> <span data-ttu-id="92fea-195">Otherwise, create two storage pools, one for the log file(s) and another storage pool for the data file(s) and TempDB.</span><span class="sxs-lookup"><span data-stu-id="92fea-195">Otherwise, create two storage pools, one for the log file(s) and another storage pool for the data file(s) and TempDB.</span></span> <span data-ttu-id="92fea-196">Determine the number of disks associated with each storage pool based on your load expectations.</span><span class="sxs-lookup"><span data-stu-id="92fea-196">Determine the number of disks associated with each storage pool based on your load expectations.</span></span> <span data-ttu-id="92fea-197">Keep in mind that different VM sizes allow different numbers of attached data disks.</span><span class="sxs-lookup"><span data-stu-id="92fea-197">Keep in mind that different VM sizes allow different numbers of attached data disks.</span></span> <span data-ttu-id="92fea-198">For more information, see [Sizes for Virtual Machines](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="92fea-198">For more information, see [Sizes for Virtual Machines](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>
  * <span data-ttu-id="92fea-199">If you are not using Premium Storage (dev/test scenarios), the recommendation is to add the maximum number of data disks supported by your [VM size](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) and use Disk Striping.</span><span class="sxs-lookup"><span data-stu-id="92fea-199">If you are not using Premium Storage (dev/test scenarios), the recommendation is to add the maximum number of data disks supported by your [VM size](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) and use Disk Striping.</span></span>
* <span data-ttu-id="92fea-200">**Caching policy**: For Premium Storage data disks, enable read caching on the data disks hosting your data files and TempDB only.</span><span class="sxs-lookup"><span data-stu-id="92fea-200">**Caching policy**: For Premium Storage data disks, enable read caching on the data disks hosting your data files and TempDB only.</span></span> <span data-ttu-id="92fea-201">If you are not using Premium Storage, do not enable any caching on any data disks.</span><span class="sxs-lookup"><span data-stu-id="92fea-201">If you are not using Premium Storage, do not enable any caching on any data disks.</span></span> <span data-ttu-id="92fea-202">For instructions on configuring disk caching, see the following topics: [Set-AzureOSDisk](https://msdn.microsoft.com/library/azure/jj152847) and [Set-AzureDataDisk](https://msdn.microsoft.com/library/azure/jj152851.aspx).</span><span class="sxs-lookup"><span data-stu-id="92fea-202">For instructions on configuring disk caching, see the following topics: [Set-AzureOSDisk](https://msdn.microsoft.com/library/azure/jj152847) and [Set-AzureDataDisk](https://msdn.microsoft.com/library/azure/jj152851.aspx).</span></span>

  > [!WARNING]
  > <span data-ttu-id="92fea-203">Stop the SQL Server service when changing the cache setting of Azure VM disks to avoid the possibility of any database corruption.</span><span class="sxs-lookup"><span data-stu-id="92fea-203">Stop the SQL Server service when changing the cache setting of Azure VM disks to avoid the possibility of any database corruption.</span></span>
  >
  >
* <span data-ttu-id="92fea-204">**NTFS allocation unit size**: When formatting the data disk, it is recommended that you use a 64-KB allocation unit size for data and log files as well as TempDB.</span><span class="sxs-lookup"><span data-stu-id="92fea-204">**NTFS allocation unit size**: When formatting the data disk, it is recommended that you use a 64-KB allocation unit size for data and log files as well as TempDB.</span></span>
* <span data-ttu-id="92fea-205">**Disk management best practices**: When removing a data disk or changing its cache type, stop the SQL Server service during the change.</span><span class="sxs-lookup"><span data-stu-id="92fea-205">**Disk management best practices**: When removing a data disk or changing its cache type, stop the SQL Server service during the change.</span></span> <span data-ttu-id="92fea-206">When the caching settings are changed on the OS disk, Azure stops the VM, changes the cache type, and restarts the VM.</span><span class="sxs-lookup"><span data-stu-id="92fea-206">When the caching settings are changed on the OS disk, Azure stops the VM, changes the cache type, and restarts the VM.</span></span> <span data-ttu-id="92fea-207">When the cache settings of a data disk are changed, the VM is not stopped, but the data disk is detached from the VM during the change and then reattached.</span><span class="sxs-lookup"><span data-stu-id="92fea-207">When the cache settings of a data disk are changed, the VM is not stopped, but the data disk is detached from the VM during the change and then reattached.</span></span>

  > [!WARNING]
  > <span data-ttu-id="92fea-208">Failure to stop the SQL Server service during these operations can cause database corruption.</span><span class="sxs-lookup"><span data-stu-id="92fea-208">Failure to stop the SQL Server service during these operations can cause database corruption.</span></span>
  >
  >

## <a name="io-guidance"></a><span data-ttu-id="92fea-209">I/O guidance</span><span class="sxs-lookup"><span data-stu-id="92fea-209">I/O guidance</span></span>
* <span data-ttu-id="92fea-210">The best results with Premium Storage are achieved when you parallelize your application and requests.</span><span class="sxs-lookup"><span data-stu-id="92fea-210">The best results with Premium Storage are achieved when you parallelize your application and requests.</span></span> <span data-ttu-id="92fea-211">Premium Storage is designed for scenarios where the IO queue depth is greater than 1, so you will see little or no performance gains for single-threaded serial requests (even if they are storage intensive).</span><span class="sxs-lookup"><span data-stu-id="92fea-211">Premium Storage is designed for scenarios where the IO queue depth is greater than 1, so you will see little or no performance gains for single-threaded serial requests (even if they are storage intensive).</span></span> <span data-ttu-id="92fea-212">For example, this could impact the single-threaded test results of performance analysis tools, such as SQLIO.</span><span class="sxs-lookup"><span data-stu-id="92fea-212">For example, this could impact the single-threaded test results of performance analysis tools, such as SQLIO.</span></span>
* <span data-ttu-id="92fea-213">Consider using [database page compression](https://msdn.microsoft.com/library/cc280449.aspx) as it can help improve performance of I/O intensive workloads.</span><span class="sxs-lookup"><span data-stu-id="92fea-213">Consider using [database page compression](https://msdn.microsoft.com/library/cc280449.aspx) as it can help improve performance of I/O intensive workloads.</span></span> <span data-ttu-id="92fea-214">However, the data compression might increase the CPU consumption on the database server.</span><span class="sxs-lookup"><span data-stu-id="92fea-214">However, the data compression might increase the CPU consumption on the database server.</span></span>
* <span data-ttu-id="92fea-215">Consider enabling instant file initialization to reduce the time that is required for initial file allocation.</span><span class="sxs-lookup"><span data-stu-id="92fea-215">Consider enabling instant file initialization to reduce the time that is required for initial file allocation.</span></span> <span data-ttu-id="92fea-216">To take advantage of instant file initialization, you grant the SQL Server (MSSQLSERVER) service account with SE_MANAGE_VOLUME_NAME and add it to the **Perform Volume Maintenance Tasks** security policy.</span><span class="sxs-lookup"><span data-stu-id="92fea-216">To take advantage of instant file initialization, you grant the SQL Server (MSSQLSERVER) service account with SE_MANAGE_VOLUME_NAME and add it to the **Perform Volume Maintenance Tasks** security policy.</span></span> <span data-ttu-id="92fea-217">If you are using a SQL Server platform image for Azure, the default service account (NT Service\MSSQLSERVER) isn’t added to the **Perform Volume Maintenance Tasks** security policy.</span><span class="sxs-lookup"><span data-stu-id="92fea-217">If you are using a SQL Server platform image for Azure, the default service account (NT Service\MSSQLSERVER) isn’t added to the **Perform Volume Maintenance Tasks** security policy.</span></span> <span data-ttu-id="92fea-218">In other words, instant file initialization is not enabled in a SQL Server Azure platform image.</span><span class="sxs-lookup"><span data-stu-id="92fea-218">In other words, instant file initialization is not enabled in a SQL Server Azure platform image.</span></span> <span data-ttu-id="92fea-219">After adding the SQL Server service account to the **Perform Volume Maintenance Tasks** security policy, restart the SQL Server service.</span><span class="sxs-lookup"><span data-stu-id="92fea-219">After adding the SQL Server service account to the **Perform Volume Maintenance Tasks** security policy, restart the SQL Server service.</span></span> <span data-ttu-id="92fea-220">There could be security considerations for using this feature.</span><span class="sxs-lookup"><span data-stu-id="92fea-220">There could be security considerations for using this feature.</span></span> <span data-ttu-id="92fea-221">For more information, see [Database File Initialization](https://msdn.microsoft.com/library/ms175935.aspx).</span><span class="sxs-lookup"><span data-stu-id="92fea-221">For more information, see [Database File Initialization](https://msdn.microsoft.com/library/ms175935.aspx).</span></span>
* <span data-ttu-id="92fea-222">**autogrow** is considered to be merely a contingency for unexpected growth.</span><span class="sxs-lookup"><span data-stu-id="92fea-222">**autogrow** is considered to be merely a contingency for unexpected growth.</span></span> <span data-ttu-id="92fea-223">Do not manage your data and log growth on a day-to-day basis with autogrow.</span><span class="sxs-lookup"><span data-stu-id="92fea-223">Do not manage your data and log growth on a day-to-day basis with autogrow.</span></span> <span data-ttu-id="92fea-224">If autogrow is used, pre-grow the file using the Size switch.</span><span class="sxs-lookup"><span data-stu-id="92fea-224">If autogrow is used, pre-grow the file using the Size switch.</span></span>
* <span data-ttu-id="92fea-225">Make sure **autoshrink** is disabled to avoid unnecessary overhead that can negatively affect performance.</span><span class="sxs-lookup"><span data-stu-id="92fea-225">Make sure **autoshrink** is disabled to avoid unnecessary overhead that can negatively affect performance.</span></span>
* <span data-ttu-id="92fea-226">Move all databases to data disks, including system databases.</span><span class="sxs-lookup"><span data-stu-id="92fea-226">Move all databases to data disks, including system databases.</span></span> <span data-ttu-id="92fea-227">For more information, see [Move System Databases](https://msdn.microsoft.com/library/ms345408.aspx).</span><span class="sxs-lookup"><span data-stu-id="92fea-227">For more information, see [Move System Databases](https://msdn.microsoft.com/library/ms345408.aspx).</span></span>
* <span data-ttu-id="92fea-228">Move SQL Server error log and trace file directories to data disks.</span><span class="sxs-lookup"><span data-stu-id="92fea-228">Move SQL Server error log and trace file directories to data disks.</span></span> <span data-ttu-id="92fea-229">This can be done in SQL Server Configuration Manager by right-clicking your SQL Server instance and selecting properties.</span><span class="sxs-lookup"><span data-stu-id="92fea-229">This can be done in SQL Server Configuration Manager by right-clicking your SQL Server instance and selecting properties.</span></span> <span data-ttu-id="92fea-230">The error log and trace file settings can be changed in the **Startup Parameters** tab. The Dump Directory is specified in the **Advanced** tab. The following screenshot shows where to look for the error log startup parameter.</span><span class="sxs-lookup"><span data-stu-id="92fea-230">The error log and trace file settings can be changed in the **Startup Parameters** tab. The Dump Directory is specified in the **Advanced** tab. The following screenshot shows where to look for the error log startup parameter.</span></span>

    ![SQL ErrorLog Screenshot](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-sql-performance/sql_server_error_log_location.png)
* <span data-ttu-id="92fea-232">Setup default backup and database file locations.</span><span class="sxs-lookup"><span data-stu-id="92fea-232">Setup default backup and database file locations.</span></span> <span data-ttu-id="92fea-233">Use the recommendations in this topic, and make the changes in the Server properties window.</span><span class="sxs-lookup"><span data-stu-id="92fea-233">Use the recommendations in this topic, and make the changes in the Server properties window.</span></span> <span data-ttu-id="92fea-234">For instructions, see [View or Change the Default Locations for Data and Log Files (SQL Server Management Studio)](https://msdn.microsoft.com/library/dd206993.aspx).</span><span class="sxs-lookup"><span data-stu-id="92fea-234">For instructions, see [View or Change the Default Locations for Data and Log Files (SQL Server Management Studio)](https://msdn.microsoft.com/library/dd206993.aspx).</span></span> <span data-ttu-id="92fea-235">The following screenshot demonstrates where to make these changes.</span><span class="sxs-lookup"><span data-stu-id="92fea-235">The following screenshot demonstrates where to make these changes.</span></span>

    ![SQL Data Log and Backup files](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-sql-performance/sql_server_default_data_log_backup_locations.png)
* <span data-ttu-id="92fea-237">Enable locked pages to reduce IO and any paging activities.</span><span class="sxs-lookup"><span data-stu-id="92fea-237">Enable locked pages to reduce IO and any paging activities.</span></span> <span data-ttu-id="92fea-238">For more information, see [Enable the Lock Pages in Memory Option (Windows)](https://msdn.microsoft.com/library/ms190730.aspx).</span><span class="sxs-lookup"><span data-stu-id="92fea-238">For more information, see [Enable the Lock Pages in Memory Option (Windows)](https://msdn.microsoft.com/library/ms190730.aspx).</span></span>
* <span data-ttu-id="92fea-239">If you are running SQL Server 2012, install Service Pack 1 Cumulative Update 10.</span><span class="sxs-lookup"><span data-stu-id="92fea-239">If you are running SQL Server 2012, install Service Pack 1 Cumulative Update 10.</span></span> <span data-ttu-id="92fea-240">This update contains the fix for poor performance on I/O when you execute select into temporary table statement in SQL Server 2012.</span><span class="sxs-lookup"><span data-stu-id="92fea-240">This update contains the fix for poor performance on I/O when you execute select into temporary table statement in SQL Server 2012.</span></span> <span data-ttu-id="92fea-241">For information, see this [knowledge base article](http://support.microsoft.com/kb/2958012).</span><span class="sxs-lookup"><span data-stu-id="92fea-241">For information, see this [knowledge base article](http://support.microsoft.com/kb/2958012).</span></span>
* <span data-ttu-id="92fea-242">Consider compressing any data files when transferring in/out of Azure.</span><span class="sxs-lookup"><span data-stu-id="92fea-242">Consider compressing any data files when transferring in/out of Azure.</span></span>

## <a name="feature-specific-guidance"></a><span data-ttu-id="92fea-243">Feature specific guidance</span><span class="sxs-lookup"><span data-stu-id="92fea-243">Feature specific guidance</span></span>
<span data-ttu-id="92fea-244">Some deployments may achieve additional performance benefits using more advanced configuration techniques.</span><span class="sxs-lookup"><span data-stu-id="92fea-244">Some deployments may achieve additional performance benefits using more advanced configuration techniques.</span></span> <span data-ttu-id="92fea-245">The following list highlights some SQL Server features that can help you to achieve better performance:</span><span class="sxs-lookup"><span data-stu-id="92fea-245">The following list highlights some SQL Server features that can help you to achieve better performance:</span></span>

* <span data-ttu-id="92fea-246">**Backup to Azure storage**: When performing backups for SQL Server running in Azure virtual machines, you can use [SQL Server Backup to URL](https://msdn.microsoft.com/library/dn435916.aspx).</span><span class="sxs-lookup"><span data-stu-id="92fea-246">**Backup to Azure storage**: When performing backups for SQL Server running in Azure virtual machines, you can use [SQL Server Backup to URL](https://msdn.microsoft.com/library/dn435916.aspx).</span></span> <span data-ttu-id="92fea-247">This feature is available starting with SQL Server 2012 SP1 CU2 and recommended for backing up to the attached data disks.</span><span class="sxs-lookup"><span data-stu-id="92fea-247">This feature is available starting with SQL Server 2012 SP1 CU2 and recommended for backing up to the attached data disks.</span></span> <span data-ttu-id="92fea-248">When you backup/restore to/from Azure storage, follow the recommendations provided at [SQL Server Backup to URL Best Practices and Troubleshooting and Restoring from Backups Stored in Azure Storage](https://msdn.microsoft.com/library/jj919149.aspx).</span><span class="sxs-lookup"><span data-stu-id="92fea-248">When you backup/restore to/from Azure storage, follow the recommendations provided at [SQL Server Backup to URL Best Practices and Troubleshooting and Restoring from Backups Stored in Azure Storage](https://msdn.microsoft.com/library/jj919149.aspx).</span></span> <span data-ttu-id="92fea-249">You can also automate these backups using [Automated Backup for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-automated-backup.md).</span><span class="sxs-lookup"><span data-stu-id="92fea-249">You can also automate these backups using [Automated Backup for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-automated-backup.md).</span></span>

    <span data-ttu-id="92fea-250">Prior to SQL Server 2012, you can use [SQL Server Backup to Azure Tool](https://www.microsoft.com/download/details.aspx?id=40740).</span><span class="sxs-lookup"><span data-stu-id="92fea-250">Prior to SQL Server 2012, you can use [SQL Server Backup to Azure Tool](https://www.microsoft.com/download/details.aspx?id=40740).</span></span> <span data-ttu-id="92fea-251">This tool can help to increase backup throughput using multiple backup stripe targets.</span><span class="sxs-lookup"><span data-stu-id="92fea-251">This tool can help to increase backup throughput using multiple backup stripe targets.</span></span>
* <span data-ttu-id="92fea-252">**SQL Server Data Files in Azure**: This new feature, [SQL Server Data Files in Azure](https://msdn.microsoft.com/library/dn385720.aspx), is available starting with SQL Server 2014.</span><span class="sxs-lookup"><span data-stu-id="92fea-252">**SQL Server Data Files in Azure**: This new feature, [SQL Server Data Files in Azure](https://msdn.microsoft.com/library/dn385720.aspx), is available starting with SQL Server 2014.</span></span> <span data-ttu-id="92fea-253">Running SQL Server with data files in Azure demonstrates comparable performance characteristics as using Azure data disks.</span><span class="sxs-lookup"><span data-stu-id="92fea-253">Running SQL Server with data files in Azure demonstrates comparable performance characteristics as using Azure data disks.</span></span>

## <a name="next-steps"></a><span data-ttu-id="92fea-254">Next Steps</span><span class="sxs-lookup"><span data-stu-id="92fea-254">Next Steps</span></span>
<span data-ttu-id="92fea-255">If you are interested in exploring SQL Server and Premium Storage in more depth, see the article [Use Azure Premium Storage with SQL Server on Virtual Machines](../classic/sql-server-premium-storage.md).</span><span class="sxs-lookup"><span data-stu-id="92fea-255">If you are interested in exploring SQL Server and Premium Storage in more depth, see the article [Use Azure Premium Storage with SQL Server on Virtual Machines](../classic/sql-server-premium-storage.md).</span></span>

<span data-ttu-id="92fea-256">For security best practices, see [Security Considerations for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-security.md).</span><span class="sxs-lookup"><span data-stu-id="92fea-256">For security best practices, see [Security Considerations for SQL Server in Azure Virtual Machines](virtual-machines-windows-sql-security.md).</span></span>

<span data-ttu-id="92fea-257">Review other SQL Server Virtual Machine topics at [SQL Server on Azure Virtual Machines Overview](virtual-machines-windows-sql-server-iaas-overview.md).</span><span class="sxs-lookup"><span data-stu-id="92fea-257">Review other SQL Server Virtual Machine topics at [SQL Server on Azure Virtual Machines Overview](virtual-machines-windows-sql-server-iaas-overview.md).</span></span>


