---
title: Set up high availability for Azure Resource Manager VMs | Microsoft Docs
description: This tutorial shows you how to create an Always On availability group with Azure virtual machines in Azure Resource Manager mode.
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: craigg
editor: ''
tags: azure-resource-manager
ms.assetid: 64e85527-d5c8-40d9-bbe2-13045d25fc68
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 03/17/2017
ms.author: mikeray
ms.openlocfilehash: 4c07be354075417c7df9a16be1543fbc851ace7c
ms.sourcegitcommit: d1451406a010fd3aa854dc8e5b77dc5537d8050e
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 09/13/2018
ms.locfileid: "44790704"
---
# <a name="configure-always-on-availability-groups-in-azure-virtual-machines-automatically-resource-manager"></a><span data-ttu-id="75cfd-103">Configure Always On availability groups in Azure Virtual Machines automatically: Resource Manager</span><span class="sxs-lookup"><span data-stu-id="75cfd-103">Configure Always On availability groups in Azure Virtual Machines automatically: Resource Manager</span></span>

<span data-ttu-id="75cfd-104">This tutorial shows you how to create a SQL Server availability group that uses Azure Resource Manager virtual machines.</span><span class="sxs-lookup"><span data-stu-id="75cfd-104">This tutorial shows you how to create a SQL Server availability group that uses Azure Resource Manager virtual machines.</span></span> <span data-ttu-id="75cfd-105">The tutorial uses Azure blades to configure a template.</span><span class="sxs-lookup"><span data-stu-id="75cfd-105">The tutorial uses Azure blades to configure a template.</span></span> <span data-ttu-id="75cfd-106">You can review the default settings, type required settings, and update the blades in the portal as you walk through this tutorial.</span><span class="sxs-lookup"><span data-stu-id="75cfd-106">You can review the default settings, type required settings, and update the blades in the portal as you walk through this tutorial.</span></span>

<span data-ttu-id="75cfd-107">The complete tutorial creates a SQL Server availability group on Azure Virtual Machines that include the following elements:</span><span class="sxs-lookup"><span data-stu-id="75cfd-107">The complete tutorial creates a SQL Server availability group on Azure Virtual Machines that include the following elements:</span></span>

* <span data-ttu-id="75cfd-108">A virtual network that has multiple subnets, including a frontend and a backend subnet</span><span class="sxs-lookup"><span data-stu-id="75cfd-108">A virtual network that has multiple subnets, including a frontend and a backend subnet</span></span>
* <span data-ttu-id="75cfd-109">Two domain controllers that have an Active Directory domain</span><span class="sxs-lookup"><span data-stu-id="75cfd-109">Two domain controllers that have an Active Directory domain</span></span>
* <span data-ttu-id="75cfd-110">Two virtual machines that run SQL Server and are deployed to the backend subnet and joined to the Active Directory domain</span><span class="sxs-lookup"><span data-stu-id="75cfd-110">Two virtual machines that run SQL Server and are deployed to the backend subnet and joined to the Active Directory domain</span></span>
* <span data-ttu-id="75cfd-111">A three-node failover cluster with the Node Majority quorum model</span><span class="sxs-lookup"><span data-stu-id="75cfd-111">A three-node failover cluster with the Node Majority quorum model</span></span>
* <span data-ttu-id="75cfd-112">An availability group that has two synchronous-commit replicas of an availability database</span><span class="sxs-lookup"><span data-stu-id="75cfd-112">An availability group that has two synchronous-commit replicas of an availability database</span></span>

<span data-ttu-id="75cfd-113">The following illustration represents the complete solution.</span><span class="sxs-lookup"><span data-stu-id="75cfd-113">The following illustration represents the complete solution.</span></span>

![Test lab architecture for availability groups in Azure](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/0-EndstateSample.png)

<span data-ttu-id="75cfd-115">All resources in this solution belong to a single resource group.</span><span class="sxs-lookup"><span data-stu-id="75cfd-115">All resources in this solution belong to a single resource group.</span></span>

<span data-ttu-id="75cfd-116">Before you start this tutorial, confirm the following:</span><span class="sxs-lookup"><span data-stu-id="75cfd-116">Before you start this tutorial, confirm the following:</span></span>

* <span data-ttu-id="75cfd-117">You already have an Azure account.</span><span class="sxs-lookup"><span data-stu-id="75cfd-117">You already have an Azure account.</span></span> <span data-ttu-id="75cfd-118">If you don't have one, [sign up for a trial account](http://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="75cfd-118">If you don't have one, [sign up for a trial account](http://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="75cfd-119">You already know how to use the GUI to provision a SQL Server virtual machine from the virtual machine gallery.</span><span class="sxs-lookup"><span data-stu-id="75cfd-119">You already know how to use the GUI to provision a SQL Server virtual machine from the virtual machine gallery.</span></span> <span data-ttu-id="75cfd-120">For more information, see [Provisioning a SQL Server virtual machine on Azure](virtual-machines-windows-portal-sql-server-provision.md).</span><span class="sxs-lookup"><span data-stu-id="75cfd-120">For more information, see [Provisioning a SQL Server virtual machine on Azure](virtual-machines-windows-portal-sql-server-provision.md).</span></span>
* <span data-ttu-id="75cfd-121">You already have a solid understanding of availability groups.</span><span class="sxs-lookup"><span data-stu-id="75cfd-121">You already have a solid understanding of availability groups.</span></span> <span data-ttu-id="75cfd-122">For more information, see [Always On availability groups (SQL Server)](http://msdn.microsoft.com/library/hh510230.aspx).</span><span class="sxs-lookup"><span data-stu-id="75cfd-122">For more information, see [Always On availability groups (SQL Server)](http://msdn.microsoft.com/library/hh510230.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="75cfd-123">If you are interested in using availability groups with SharePoint, also see [Configure SQL Server 2012 Always On availability groups for SharePoint 2013](http://technet.microsoft.com/library/jj715261.aspx).</span><span class="sxs-lookup"><span data-stu-id="75cfd-123">If you are interested in using availability groups with SharePoint, also see [Configure SQL Server 2012 Always On availability groups for SharePoint 2013](http://technet.microsoft.com/library/jj715261.aspx).</span></span>
>
>

<span data-ttu-id="75cfd-124">In this tutorial, use the Azure portal to:</span><span class="sxs-lookup"><span data-stu-id="75cfd-124">In this tutorial, use the Azure portal to:</span></span>

* <span data-ttu-id="75cfd-125">Choose the Always On template from the portal.</span><span class="sxs-lookup"><span data-stu-id="75cfd-125">Choose the Always On template from the portal.</span></span>
* <span data-ttu-id="75cfd-126">Review the template settings and update a few configuration settings for your environment.</span><span class="sxs-lookup"><span data-stu-id="75cfd-126">Review the template settings and update a few configuration settings for your environment.</span></span>
* <span data-ttu-id="75cfd-127">Monitor Azure as it creates the entire environment.</span><span class="sxs-lookup"><span data-stu-id="75cfd-127">Monitor Azure as it creates the entire environment.</span></span>
* <span data-ttu-id="75cfd-128">Connect to a domain controller and then to a server that runs SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75cfd-128">Connect to a domain controller and then to a server that runs SQL Server.</span></span>

[!INCLUDE [availability-group-template](../../../../includes/virtual-machines-windows-portal-sql-alwayson-ag-template.md)]

## <a name="provision-the-cluster-from-the-gallery"></a><span data-ttu-id="75cfd-129">Provision the cluster from the gallery</span><span class="sxs-lookup"><span data-stu-id="75cfd-129">Provision the cluster from the gallery</span></span>
<span data-ttu-id="75cfd-130">Azure provides a gallery image for the entire solution.</span><span class="sxs-lookup"><span data-stu-id="75cfd-130">Azure provides a gallery image for the entire solution.</span></span> <span data-ttu-id="75cfd-131">To locate the template:</span><span class="sxs-lookup"><span data-stu-id="75cfd-131">To locate the template:</span></span>

1. <span data-ttu-id="75cfd-132">Sign in to the Azure portal by using your account.</span><span class="sxs-lookup"><span data-stu-id="75cfd-132">Sign in to the Azure portal by using your account.</span></span>
2. <span data-ttu-id="75cfd-133">In the Azure portal, click **Create a resource** to open the **New** pane.</span><span class="sxs-lookup"><span data-stu-id="75cfd-133">In the Azure portal, click **Create a resource** to open the **New** pane.</span></span>
3. <span data-ttu-id="75cfd-134">On the **New** pane, search for **AlwaysOn**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-134">On the **New** pane, search for **AlwaysOn**.</span></span>
   <span data-ttu-id="75cfd-135">![Find AlwaysOn Template](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/16-findalwayson.png)</span><span class="sxs-lookup"><span data-stu-id="75cfd-135">![Find AlwaysOn Template](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/16-findalwayson.png)</span></span>
4. <span data-ttu-id="75cfd-136">In the search results, locate **SQL Server AlwaysOn Cluster**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-136">In the search results, locate **SQL Server AlwaysOn Cluster**.</span></span>
   <span data-ttu-id="75cfd-137">![AlwaysOn Template](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/17-alwaysontemplate.png)</span><span class="sxs-lookup"><span data-stu-id="75cfd-137">![AlwaysOn Template](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/17-alwaysontemplate.png)</span></span>
5. <span data-ttu-id="75cfd-138">On **Select a deployment model**, choose **Resource Manager**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-138">On **Select a deployment model**, choose **Resource Manager**.</span></span>

### <a name="basics"></a><span data-ttu-id="75cfd-139">Basics</span><span class="sxs-lookup"><span data-stu-id="75cfd-139">Basics</span></span>
<span data-ttu-id="75cfd-140">Click **Basics** and configure the following settings:</span><span class="sxs-lookup"><span data-stu-id="75cfd-140">Click **Basics** and configure the following settings:</span></span>

* <span data-ttu-id="75cfd-141">**Administrator user name** is a user account that has domain administrator permissions and is a member of the SQL Server sysadmin fixed server role on both instances of SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75cfd-141">**Administrator user name** is a user account that has domain administrator permissions and is a member of the SQL Server sysadmin fixed server role on both instances of SQL Server.</span></span> <span data-ttu-id="75cfd-142">For this tutorial, use **DomainAdmin**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-142">For this tutorial, use **DomainAdmin**.</span></span>
* <span data-ttu-id="75cfd-143">**Password** is the password for the domain administrator account.</span><span class="sxs-lookup"><span data-stu-id="75cfd-143">**Password** is the password for the domain administrator account.</span></span> <span data-ttu-id="75cfd-144">Use a complex password.</span><span class="sxs-lookup"><span data-stu-id="75cfd-144">Use a complex password.</span></span> <span data-ttu-id="75cfd-145">Confirm the password.</span><span class="sxs-lookup"><span data-stu-id="75cfd-145">Confirm the password.</span></span>
* <span data-ttu-id="75cfd-146">**Subscription** is the subscription that Azure bills to run all deployed resources for the availability group.</span><span class="sxs-lookup"><span data-stu-id="75cfd-146">**Subscription** is the subscription that Azure bills to run all deployed resources for the availability group.</span></span> <span data-ttu-id="75cfd-147">If your account has multiple subscriptions, you can specify a different subscription.</span><span class="sxs-lookup"><span data-stu-id="75cfd-147">If your account has multiple subscriptions, you can specify a different subscription.</span></span>
* <span data-ttu-id="75cfd-148">**Resource group** is the name for the group to which all Azure resources that are created by this template belong.</span><span class="sxs-lookup"><span data-stu-id="75cfd-148">**Resource group** is the name for the group to which all Azure resources that are created by this template belong.</span></span> <span data-ttu-id="75cfd-149">For this tutorial, use **SQL-HA-RG**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-149">For this tutorial, use **SQL-HA-RG**.</span></span> <span data-ttu-id="75cfd-150">For more information, see [Azure Resource Manager overview](../../../azure-resource-manager/resource-group-overview.md#resource-groups).</span><span class="sxs-lookup"><span data-stu-id="75cfd-150">For more information, see [Azure Resource Manager overview](../../../azure-resource-manager/resource-group-overview.md#resource-groups).</span></span>
* <span data-ttu-id="75cfd-151">**Location** is the Azure region where the tutorial creates the resources.</span><span class="sxs-lookup"><span data-stu-id="75cfd-151">**Location** is the Azure region where the tutorial creates the resources.</span></span> <span data-ttu-id="75cfd-152">Choose an Azure region.</span><span class="sxs-lookup"><span data-stu-id="75cfd-152">Choose an Azure region.</span></span>

<span data-ttu-id="75cfd-153">The following screenshot is a completed **Basics** blade:</span><span class="sxs-lookup"><span data-stu-id="75cfd-153">The following screenshot is a completed **Basics** blade:</span></span>

![Basics](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/1-basics.png)

<span data-ttu-id="75cfd-155">Click **OK**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-155">Click **OK**.</span></span>

### <a name="domain-and-network-settings"></a><span data-ttu-id="75cfd-156">Domain and network settings</span><span class="sxs-lookup"><span data-stu-id="75cfd-156">Domain and network settings</span></span>
<span data-ttu-id="75cfd-157">This Azure gallery template creates a domain and domain controllers.</span><span class="sxs-lookup"><span data-stu-id="75cfd-157">This Azure gallery template creates a domain and domain controllers.</span></span> <span data-ttu-id="75cfd-158">It also creates a network and two subnets.</span><span class="sxs-lookup"><span data-stu-id="75cfd-158">It also creates a network and two subnets.</span></span> <span data-ttu-id="75cfd-159">The template cannot create servers in an existing domain or virtual network.</span><span class="sxs-lookup"><span data-stu-id="75cfd-159">The template cannot create servers in an existing domain or virtual network.</span></span> <span data-ttu-id="75cfd-160">The next step configures the domain and network settings.</span><span class="sxs-lookup"><span data-stu-id="75cfd-160">The next step configures the domain and network settings.</span></span>

<span data-ttu-id="75cfd-161">On the **Domain and network settings** blade, review the preset values for the domain and network settings:</span><span class="sxs-lookup"><span data-stu-id="75cfd-161">On the **Domain and network settings** blade, review the preset values for the domain and network settings:</span></span>

* <span data-ttu-id="75cfd-162">**Forest root domain name** is the domain name for the Active Directory domain that hosts the cluster.</span><span class="sxs-lookup"><span data-stu-id="75cfd-162">**Forest root domain name** is the domain name for the Active Directory domain that hosts the cluster.</span></span> <span data-ttu-id="75cfd-163">For the tutorial, use **contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-163">For the tutorial, use **contoso.com**.</span></span>
* <span data-ttu-id="75cfd-164">**Virtual Network name** is the network name for the Azure virtual network.</span><span class="sxs-lookup"><span data-stu-id="75cfd-164">**Virtual Network name** is the network name for the Azure virtual network.</span></span> <span data-ttu-id="75cfd-165">For the tutorial, use **autohaVNET**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-165">For the tutorial, use **autohaVNET**.</span></span>
* <span data-ttu-id="75cfd-166">**Domain Controller subnet name** is the name of a portion of the virtual network that hosts the domain controller.</span><span class="sxs-lookup"><span data-stu-id="75cfd-166">**Domain Controller subnet name** is the name of a portion of the virtual network that hosts the domain controller.</span></span> <span data-ttu-id="75cfd-167">Use **subnet-1**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-167">Use **subnet-1**.</span></span> <span data-ttu-id="75cfd-168">This subnet uses address prefix **10.0.0.0/24**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-168">This subnet uses address prefix **10.0.0.0/24**.</span></span>
* <span data-ttu-id="75cfd-169">**SQL Server subnet name** is the name of a portion of the virtual network that hosts the servers that run SQL Server and the file share witness.</span><span class="sxs-lookup"><span data-stu-id="75cfd-169">**SQL Server subnet name** is the name of a portion of the virtual network that hosts the servers that run SQL Server and the file share witness.</span></span> <span data-ttu-id="75cfd-170">Use **subnet-2**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-170">Use **subnet-2**.</span></span> <span data-ttu-id="75cfd-171">This subnet uses address prefix **10.0.1.0/26**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-171">This subnet uses address prefix **10.0.1.0/26**.</span></span>

<span data-ttu-id="75cfd-172">To learn more about virtual networks in Azure, see [Virtual network overview](../../../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="75cfd-172">To learn more about virtual networks in Azure, see [Virtual network overview](../../../virtual-network/virtual-networks-overview.md).</span></span>  

<span data-ttu-id="75cfd-173">The **Domain and network settings** should look like the following screenshot:</span><span class="sxs-lookup"><span data-stu-id="75cfd-173">The **Domain and network settings** should look like the following screenshot:</span></span>

![Domain and network settings](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/2-domain.png)

<span data-ttu-id="75cfd-175">If necessary, you can change these values.</span><span class="sxs-lookup"><span data-stu-id="75cfd-175">If necessary, you can change these values.</span></span> <span data-ttu-id="75cfd-176">For this tutorial, use the preset values.</span><span class="sxs-lookup"><span data-stu-id="75cfd-176">For this tutorial, use the preset values.</span></span>

<span data-ttu-id="75cfd-177">Review the settings, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-177">Review the settings, and then click **OK**.</span></span>

### <a name="availability-group-settings"></a><span data-ttu-id="75cfd-178">Availability group settings</span><span class="sxs-lookup"><span data-stu-id="75cfd-178">Availability group settings</span></span>
<span data-ttu-id="75cfd-179">On **Availability group settings**, review the preset values for the availability group and the listener.</span><span class="sxs-lookup"><span data-stu-id="75cfd-179">On **Availability group settings**, review the preset values for the availability group and the listener.</span></span>

* <span data-ttu-id="75cfd-180">**Availability group name** is the clustered resource name for the availability group.</span><span class="sxs-lookup"><span data-stu-id="75cfd-180">**Availability group name** is the clustered resource name for the availability group.</span></span> <span data-ttu-id="75cfd-181">For this tutorial, use **Contoso-ag**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-181">For this tutorial, use **Contoso-ag**.</span></span>
* <span data-ttu-id="75cfd-182">**Availability group listener name** is used by the cluster and the internal load balancer.</span><span class="sxs-lookup"><span data-stu-id="75cfd-182">**Availability group listener name** is used by the cluster and the internal load balancer.</span></span> <span data-ttu-id="75cfd-183">Clients that connect to SQL Server can use this name to connect to the appropriate replica of the database.</span><span class="sxs-lookup"><span data-stu-id="75cfd-183">Clients that connect to SQL Server can use this name to connect to the appropriate replica of the database.</span></span> <span data-ttu-id="75cfd-184">For this tutorial, use **Contoso-listener**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-184">For this tutorial, use **Contoso-listener**.</span></span>
* <span data-ttu-id="75cfd-185">**Availability group listener port** specifies the TCP port of the SQL Server listener.</span><span class="sxs-lookup"><span data-stu-id="75cfd-185">**Availability group listener port** specifies the TCP port of the SQL Server listener.</span></span> <span data-ttu-id="75cfd-186">For this tutorial, use the default port, **1433**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-186">For this tutorial, use the default port, **1433**.</span></span>

<span data-ttu-id="75cfd-187">If necessary, you can change these values.</span><span class="sxs-lookup"><span data-stu-id="75cfd-187">If necessary, you can change these values.</span></span> <span data-ttu-id="75cfd-188">For this tutorial, use the preset values.</span><span class="sxs-lookup"><span data-stu-id="75cfd-188">For this tutorial, use the preset values.</span></span>  

![availability group settings](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/3-availabilitygroup.png)

<span data-ttu-id="75cfd-190">Click **OK**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-190">Click **OK**.</span></span>

### <a name="virtual-machine-size-storage-settings"></a><span data-ttu-id="75cfd-191">Virtual machine size, storage settings</span><span class="sxs-lookup"><span data-stu-id="75cfd-191">Virtual machine size, storage settings</span></span>
<span data-ttu-id="75cfd-192">On **VM size, storage settings**, choose a SQL Server virtual machine size, and review the other settings.</span><span class="sxs-lookup"><span data-stu-id="75cfd-192">On **VM size, storage settings**, choose a SQL Server virtual machine size, and review the other settings.</span></span>

* <span data-ttu-id="75cfd-193">**SQL Server virtual machine size** is the size for both virtual machines that run SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75cfd-193">**SQL Server virtual machine size** is the size for both virtual machines that run SQL Server.</span></span> <span data-ttu-id="75cfd-194">Choose an appropriate virtual machine size for your workload.</span><span class="sxs-lookup"><span data-stu-id="75cfd-194">Choose an appropriate virtual machine size for your workload.</span></span> <span data-ttu-id="75cfd-195">If you are building this environment for the tutorial, use **DS2**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-195">If you are building this environment for the tutorial, use **DS2**.</span></span> <span data-ttu-id="75cfd-196">For production workloads, choose a virtual machine size that can support the workload.</span><span class="sxs-lookup"><span data-stu-id="75cfd-196">For production workloads, choose a virtual machine size that can support the workload.</span></span> <span data-ttu-id="75cfd-197">Many production workloads require **DS4** or larger.</span><span class="sxs-lookup"><span data-stu-id="75cfd-197">Many production workloads require **DS4** or larger.</span></span> <span data-ttu-id="75cfd-198">The template builds two virtual machines of this size and installs SQL Server on each one.</span><span class="sxs-lookup"><span data-stu-id="75cfd-198">The template builds two virtual machines of this size and installs SQL Server on each one.</span></span> <span data-ttu-id="75cfd-199">For more information, see [Sizes for virtual machines](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="75cfd-199">For more information, see [Sizes for virtual machines](../sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

> [!NOTE]
> <span data-ttu-id="75cfd-200">Azure installs the Enterprise Edition of SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75cfd-200">Azure installs the Enterprise Edition of SQL Server.</span></span> <span data-ttu-id="75cfd-201">The cost depends on the edition and the virtual machine size.</span><span class="sxs-lookup"><span data-stu-id="75cfd-201">The cost depends on the edition and the virtual machine size.</span></span> <span data-ttu-id="75cfd-202">For detailed information about current costs, see [virtual machines pricing](http://azure.microsoft.com/pricing/details/virtual-machines/#Sql).</span><span class="sxs-lookup"><span data-stu-id="75cfd-202">For detailed information about current costs, see [virtual machines pricing](http://azure.microsoft.com/pricing/details/virtual-machines/#Sql).</span></span>
>
>

* <span data-ttu-id="75cfd-203">**Domain controller virtual machine size** is the virtual machine size for the domain controllers.</span><span class="sxs-lookup"><span data-stu-id="75cfd-203">**Domain controller virtual machine size** is the virtual machine size for the domain controllers.</span></span> <span data-ttu-id="75cfd-204">For this tutorial use **D2**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-204">For this tutorial use **D2**.</span></span>
* <span data-ttu-id="75cfd-205">**File Share Witness virtual machine size** is the virtual machine size for the file share witness.</span><span class="sxs-lookup"><span data-stu-id="75cfd-205">**File Share Witness virtual machine size** is the virtual machine size for the file share witness.</span></span> <span data-ttu-id="75cfd-206">For this tutorial, use **A1**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-206">For this tutorial, use **A1**.</span></span>
* <span data-ttu-id="75cfd-207">**SQL Storage account** is the name of the storage account that holds the SQL Server data and operating system disks.</span><span class="sxs-lookup"><span data-stu-id="75cfd-207">**SQL Storage account** is the name of the storage account that holds the SQL Server data and operating system disks.</span></span> <span data-ttu-id="75cfd-208">For this tutorial, use **alwaysonsql01**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-208">For this tutorial, use **alwaysonsql01**.</span></span>
* <span data-ttu-id="75cfd-209">**DC Storage account** is the name of the storage account for the domain controllers.</span><span class="sxs-lookup"><span data-stu-id="75cfd-209">**DC Storage account** is the name of the storage account for the domain controllers.</span></span> <span data-ttu-id="75cfd-210">For this tutorial, use **alwaysondc01**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-210">For this tutorial, use **alwaysondc01**.</span></span>
* <span data-ttu-id="75cfd-211">**SQL Server data disk size** in TB is the size of the SQL Server data disk in TB.</span><span class="sxs-lookup"><span data-stu-id="75cfd-211">**SQL Server data disk size** in TB is the size of the SQL Server data disk in TB.</span></span> <span data-ttu-id="75cfd-212">Specify a number from 1 through 4.</span><span class="sxs-lookup"><span data-stu-id="75cfd-212">Specify a number from 1 through 4.</span></span> <span data-ttu-id="75cfd-213">For this tutorial, use **1**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-213">For this tutorial, use **1**.</span></span>
* <span data-ttu-id="75cfd-214">**Storage optimization** sets specific storage configuration settings for the SQL Server virtual machines based on the workload type.</span><span class="sxs-lookup"><span data-stu-id="75cfd-214">**Storage optimization** sets specific storage configuration settings for the SQL Server virtual machines based on the workload type.</span></span> <span data-ttu-id="75cfd-215">All SQL Server virtual machines in this scenario use premium storage with Azure disk host cache set to read-only.</span><span class="sxs-lookup"><span data-stu-id="75cfd-215">All SQL Server virtual machines in this scenario use premium storage with Azure disk host cache set to read-only.</span></span> <span data-ttu-id="75cfd-216">In addition, you can optimize SQL Server settings for the workload by choosing one of these three settings:</span><span class="sxs-lookup"><span data-stu-id="75cfd-216">In addition, you can optimize SQL Server settings for the workload by choosing one of these three settings:</span></span>

  * <span data-ttu-id="75cfd-217">**General workload** sets no specific configuration settings.</span><span class="sxs-lookup"><span data-stu-id="75cfd-217">**General workload** sets no specific configuration settings.</span></span>
  * <span data-ttu-id="75cfd-218">**Transactional processing** sets trace flag 1117 and 1118.</span><span class="sxs-lookup"><span data-stu-id="75cfd-218">**Transactional processing** sets trace flag 1117 and 1118.</span></span>
  * <span data-ttu-id="75cfd-219">**Data warehousing** sets trace flag 1117 and 610.</span><span class="sxs-lookup"><span data-stu-id="75cfd-219">**Data warehousing** sets trace flag 1117 and 610.</span></span>

<span data-ttu-id="75cfd-220">For this tutorial, use **General workload**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-220">For this tutorial, use **General workload**.</span></span>

![VM size storage settings](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/4-vm.png)

<span data-ttu-id="75cfd-222">Review the settings, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-222">Review the settings, and then click **OK**.</span></span>

#### <a name="a-note-about-storage"></a><span data-ttu-id="75cfd-223">A note about storage</span><span class="sxs-lookup"><span data-stu-id="75cfd-223">A note about storage</span></span>
<span data-ttu-id="75cfd-224">Additional optimizations depend on the size of the SQL Server data disks.</span><span class="sxs-lookup"><span data-stu-id="75cfd-224">Additional optimizations depend on the size of the SQL Server data disks.</span></span> <span data-ttu-id="75cfd-225">For each terabyte of data disk, Azure adds an additional 1 TB premium storage.</span><span class="sxs-lookup"><span data-stu-id="75cfd-225">For each terabyte of data disk, Azure adds an additional 1 TB premium storage.</span></span> <span data-ttu-id="75cfd-226">When a server requires 2 TB or more, the template creates a storage pool on each SQL Server virtual machine.</span><span class="sxs-lookup"><span data-stu-id="75cfd-226">When a server requires 2 TB or more, the template creates a storage pool on each SQL Server virtual machine.</span></span> <span data-ttu-id="75cfd-227">A storage pool is a form of storage virtualization where multiple discs are configured to provide higher capacity, resiliency, and performance.</span><span class="sxs-lookup"><span data-stu-id="75cfd-227">A storage pool is a form of storage virtualization where multiple discs are configured to provide higher capacity, resiliency, and performance.</span></span>  <span data-ttu-id="75cfd-228">The template then creates a storage space on the storage pool and presents a single data disk to the operating system.</span><span class="sxs-lookup"><span data-stu-id="75cfd-228">The template then creates a storage space on the storage pool and presents a single data disk to the operating system.</span></span> <span data-ttu-id="75cfd-229">The template designates this disk as the data disk for SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75cfd-229">The template designates this disk as the data disk for SQL Server.</span></span> <span data-ttu-id="75cfd-230">The template tunes the storage pool for SQL Server by using the following settings:</span><span class="sxs-lookup"><span data-stu-id="75cfd-230">The template tunes the storage pool for SQL Server by using the following settings:</span></span>

* <span data-ttu-id="75cfd-231">Stripe size is the interleave setting for the virtual disk.</span><span class="sxs-lookup"><span data-stu-id="75cfd-231">Stripe size is the interleave setting for the virtual disk.</span></span> <span data-ttu-id="75cfd-232">Transactional workloads use 64 KB.</span><span class="sxs-lookup"><span data-stu-id="75cfd-232">Transactional workloads use 64 KB.</span></span> <span data-ttu-id="75cfd-233">Data warehousing workloads use 256 KB.</span><span class="sxs-lookup"><span data-stu-id="75cfd-233">Data warehousing workloads use 256 KB.</span></span>
* <span data-ttu-id="75cfd-234">Resiliency is simple (no resiliency).</span><span class="sxs-lookup"><span data-stu-id="75cfd-234">Resiliency is simple (no resiliency).</span></span>

> [!NOTE]
> <span data-ttu-id="75cfd-235">Azure premium storage is locally redundant and keeps three copies of the data within a single region, so additional resiliency at the storage pool is not required.</span><span class="sxs-lookup"><span data-stu-id="75cfd-235">Azure premium storage is locally redundant and keeps three copies of the data within a single region, so additional resiliency at the storage pool is not required.</span></span>
>
>

* <span data-ttu-id="75cfd-236">Column count equals the number of disks in the storage pool.</span><span class="sxs-lookup"><span data-stu-id="75cfd-236">Column count equals the number of disks in the storage pool.</span></span>

<span data-ttu-id="75cfd-237">For additional information about storage space and storage pools, see:</span><span class="sxs-lookup"><span data-stu-id="75cfd-237">For additional information about storage space and storage pools, see:</span></span>

* [<span data-ttu-id="75cfd-238">Storage Spaces Overview</span><span class="sxs-lookup"><span data-stu-id="75cfd-238">Storage Spaces Overview</span></span>](http://technet.microsoft.com/library/hh831739.aspx)
* [<span data-ttu-id="75cfd-239">Windows Server Backup and Storage Pools</span><span class="sxs-lookup"><span data-stu-id="75cfd-239">Windows Server Backup and Storage Pools</span></span>](http://technet.microsoft.com/library/dn390929.aspx)

<span data-ttu-id="75cfd-240">For more information about SQL Server configuration best practices, see [Performance best practices for SQL Server in Azure virtual machines](virtual-machines-windows-sql-performance.md).</span><span class="sxs-lookup"><span data-stu-id="75cfd-240">For more information about SQL Server configuration best practices, see [Performance best practices for SQL Server in Azure virtual machines](virtual-machines-windows-sql-performance.md).</span></span>

### <a name="sql-server-settings"></a><span data-ttu-id="75cfd-241">SQL Server settings</span><span class="sxs-lookup"><span data-stu-id="75cfd-241">SQL Server settings</span></span>
<span data-ttu-id="75cfd-242">On **SQL Server settings**, review and modify the SQL Server virtual machine name prefix, SQL Server version, SQL Server service account and password, and the SQL auto-patching maintenance schedule.</span><span class="sxs-lookup"><span data-stu-id="75cfd-242">On **SQL Server settings**, review and modify the SQL Server virtual machine name prefix, SQL Server version, SQL Server service account and password, and the SQL auto-patching maintenance schedule.</span></span>

* <span data-ttu-id="75cfd-243">**SQL Server Name Prefix** is used to create a name for each SQL Server virtual machine.</span><span class="sxs-lookup"><span data-stu-id="75cfd-243">**SQL Server Name Prefix** is used to create a name for each SQL Server virtual machine.</span></span> <span data-ttu-id="75cfd-244">For this tutorial, use **sqlserver**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-244">For this tutorial, use **sqlserver**.</span></span> <span data-ttu-id="75cfd-245">The template names the SQL Server virtual machines *sqlserver-0* and *sqlserver-1*.</span><span class="sxs-lookup"><span data-stu-id="75cfd-245">The template names the SQL Server virtual machines *sqlserver-0* and *sqlserver-1*.</span></span>
* <span data-ttu-id="75cfd-246">**SQL Server version** is the version of SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75cfd-246">**SQL Server version** is the version of SQL Server.</span></span> <span data-ttu-id="75cfd-247">For this tutorial use **SQL Server 2014**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-247">For this tutorial use **SQL Server 2014**.</span></span> <span data-ttu-id="75cfd-248">You can also choose **SQL Server 2012** or **SQL Server 2016**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-248">You can also choose **SQL Server 2012** or **SQL Server 2016**.</span></span>
* <span data-ttu-id="75cfd-249">**SQL Server service account user name** is the domain account name for the SQL Server service.</span><span class="sxs-lookup"><span data-stu-id="75cfd-249">**SQL Server service account user name** is the domain account name for the SQL Server service.</span></span> <span data-ttu-id="75cfd-250">For this tutorial, use **sqlservice**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-250">For this tutorial, use **sqlservice**.</span></span>
* <span data-ttu-id="75cfd-251">**Password** is the password for the SQL Server service account.</span><span class="sxs-lookup"><span data-stu-id="75cfd-251">**Password** is the password for the SQL Server service account.</span></span>  <span data-ttu-id="75cfd-252">Use a complex password.</span><span class="sxs-lookup"><span data-stu-id="75cfd-252">Use a complex password.</span></span> <span data-ttu-id="75cfd-253">Confirm the password.</span><span class="sxs-lookup"><span data-stu-id="75cfd-253">Confirm the password.</span></span>
* <span data-ttu-id="75cfd-254">**SQL Auto Patching maintenance schedule** identifies the day of the week that Azure automatically patches the SQL Servers.</span><span class="sxs-lookup"><span data-stu-id="75cfd-254">**SQL Auto Patching maintenance schedule** identifies the day of the week that Azure automatically patches the SQL Servers.</span></span> <span data-ttu-id="75cfd-255">For this tutorial, type **Sunday**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-255">For this tutorial, type **Sunday**.</span></span>
* <span data-ttu-id="75cfd-256">**SQL Auto Patching maintenance start hour** is the time of day for the Azure region when automatic patching begins.</span><span class="sxs-lookup"><span data-stu-id="75cfd-256">**SQL Auto Patching maintenance start hour** is the time of day for the Azure region when automatic patching begins.</span></span>

> [!NOTE]
> <span data-ttu-id="75cfd-257">The patching window for each virtual machine is staggered by one hour.</span><span class="sxs-lookup"><span data-stu-id="75cfd-257">The patching window for each virtual machine is staggered by one hour.</span></span> <span data-ttu-id="75cfd-258">Only one virtual machine is patched at a time to prevent disruption of services.</span><span class="sxs-lookup"><span data-stu-id="75cfd-258">Only one virtual machine is patched at a time to prevent disruption of services.</span></span>
>
>

![SQL Server settings](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/5-sql.png)

<span data-ttu-id="75cfd-260">Review the settings, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-260">Review the settings, and then click **OK**.</span></span>

### <a name="summary"></a><span data-ttu-id="75cfd-261">Summary</span><span class="sxs-lookup"><span data-stu-id="75cfd-261">Summary</span></span>
<span data-ttu-id="75cfd-262">On the summary page, Azure validates the settings.</span><span class="sxs-lookup"><span data-stu-id="75cfd-262">On the summary page, Azure validates the settings.</span></span> <span data-ttu-id="75cfd-263">You can also download the template.</span><span class="sxs-lookup"><span data-stu-id="75cfd-263">You can also download the template.</span></span> <span data-ttu-id="75cfd-264">Review the summary.</span><span class="sxs-lookup"><span data-stu-id="75cfd-264">Review the summary.</span></span> <span data-ttu-id="75cfd-265">Click **OK**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-265">Click **OK**.</span></span>

### <a name="buy"></a><span data-ttu-id="75cfd-266">Buy</span><span class="sxs-lookup"><span data-stu-id="75cfd-266">Buy</span></span>
<span data-ttu-id="75cfd-267">This final blade contains **terms of use**, and **privacy policy**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-267">This final blade contains **terms of use**, and **privacy policy**.</span></span> <span data-ttu-id="75cfd-268">Review this information.</span><span class="sxs-lookup"><span data-stu-id="75cfd-268">Review this information.</span></span> <span data-ttu-id="75cfd-269">When you are ready for Azure to start to create the virtual machines and all the other required resources for the availability group, click **Create**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-269">When you are ready for Azure to start to create the virtual machines and all the other required resources for the availability group, click **Create**.</span></span>

<span data-ttu-id="75cfd-270">The Azure portal creates the resource group and all the resources.</span><span class="sxs-lookup"><span data-stu-id="75cfd-270">The Azure portal creates the resource group and all the resources.</span></span>

## <a name="monitor-deployment"></a><span data-ttu-id="75cfd-271">Monitor deployment</span><span class="sxs-lookup"><span data-stu-id="75cfd-271">Monitor deployment</span></span>
<span data-ttu-id="75cfd-272">Monitor the deployment progress from the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="75cfd-272">Monitor the deployment progress from the Azure portal.</span></span> <span data-ttu-id="75cfd-273">An icon that represents the deployment is automatically pinned to the Azure portal dashboard.</span><span class="sxs-lookup"><span data-stu-id="75cfd-273">An icon that represents the deployment is automatically pinned to the Azure portal dashboard.</span></span>

![Azure Dashboard](./media/virtual-machines-windows-portal-sql-alwayson-availability-groups/11-deploydashboard.png)

## <a name="connect-to-sql-server"></a><span data-ttu-id="75cfd-275">Connect to SQL Server</span><span class="sxs-lookup"><span data-stu-id="75cfd-275">Connect to SQL Server</span></span>
<span data-ttu-id="75cfd-276">The new instances of SQL Server are running on virtual machines that have internet-connected IP addresses.</span><span class="sxs-lookup"><span data-stu-id="75cfd-276">The new instances of SQL Server are running on virtual machines that have internet-connected IP addresses.</span></span> <span data-ttu-id="75cfd-277">You can remote desktop (RDP) directly to each SQL Server virtual machine.</span><span class="sxs-lookup"><span data-stu-id="75cfd-277">You can remote desktop (RDP) directly to each SQL Server virtual machine.</span></span>

<span data-ttu-id="75cfd-278">To RDP to a SQL Server, follow these steps:</span><span class="sxs-lookup"><span data-stu-id="75cfd-278">To RDP to a SQL Server, follow these steps:</span></span>

1. <span data-ttu-id="75cfd-279">From the Azure portal dashboard, verify that the deployment has succeeded.</span><span class="sxs-lookup"><span data-stu-id="75cfd-279">From the Azure portal dashboard, verify that the deployment has succeeded.</span></span>
2. <span data-ttu-id="75cfd-280">Click **Resources**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-280">Click **Resources**.</span></span>
3. <span data-ttu-id="75cfd-281">In the **Resources** blade, click **sqlserver-0**, which is the computer name of one of the virtual machines that's running SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75cfd-281">In the **Resources** blade, click **sqlserver-0**, which is the computer name of one of the virtual machines that's running SQL Server.</span></span>
4. <span data-ttu-id="75cfd-282">On the blade for **sqlserver-0**, click **Connect**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-282">On the blade for **sqlserver-0**, click **Connect**.</span></span> <span data-ttu-id="75cfd-283">Your browser asks if you want to open or save the remote connection object.</span><span class="sxs-lookup"><span data-stu-id="75cfd-283">Your browser asks if you want to open or save the remote connection object.</span></span> <span data-ttu-id="75cfd-284">Click **Open**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-284">Click **Open**.</span></span>
5. <span data-ttu-id="75cfd-285">**Remote desktop connection** might warn you that the publisher of this remote connection can’t be identified.</span><span class="sxs-lookup"><span data-stu-id="75cfd-285">**Remote desktop connection** might warn you that the publisher of this remote connection can’t be identified.</span></span> <span data-ttu-id="75cfd-286">Click **Connect**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-286">Click **Connect**.</span></span>
6. <span data-ttu-id="75cfd-287">Windows security prompts you to enter your credentials to connect to the IP address of the primary domain controller.</span><span class="sxs-lookup"><span data-stu-id="75cfd-287">Windows security prompts you to enter your credentials to connect to the IP address of the primary domain controller.</span></span> <span data-ttu-id="75cfd-288">Click **Use another account**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-288">Click **Use another account**.</span></span> <span data-ttu-id="75cfd-289">For **User name**, type **contoso\DomainAdmin**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-289">For **User name**, type **contoso\DomainAdmin**.</span></span> <span data-ttu-id="75cfd-290">You configured this account when you set the administrator user name in the template.</span><span class="sxs-lookup"><span data-stu-id="75cfd-290">You configured this account when you set the administrator user name in the template.</span></span> <span data-ttu-id="75cfd-291">Use the complex password that you chose when you configured the template.</span><span class="sxs-lookup"><span data-stu-id="75cfd-291">Use the complex password that you chose when you configured the template.</span></span>
7. <span data-ttu-id="75cfd-292">**Remote desktop** might warn you that the remote computer could not be authenticated due to problems with its security certificate.</span><span class="sxs-lookup"><span data-stu-id="75cfd-292">**Remote desktop** might warn you that the remote computer could not be authenticated due to problems with its security certificate.</span></span> <span data-ttu-id="75cfd-293">It shows you the security certificate name.</span><span class="sxs-lookup"><span data-stu-id="75cfd-293">It shows you the security certificate name.</span></span> <span data-ttu-id="75cfd-294">If you followed the tutorial, the name is **sqlserver-0.contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-294">If you followed the tutorial, the name is **sqlserver-0.contoso.com**.</span></span> <span data-ttu-id="75cfd-295">Click **Yes**.</span><span class="sxs-lookup"><span data-stu-id="75cfd-295">Click **Yes**.</span></span>

<span data-ttu-id="75cfd-296">You are now connected with RDP to the SQL Server virtual machine.</span><span class="sxs-lookup"><span data-stu-id="75cfd-296">You are now connected with RDP to the SQL Server virtual machine.</span></span> <span data-ttu-id="75cfd-297">You can open SQL Server Management Studio, connect to the default instance of SQL Server, and verify that the availability group is configured.</span><span class="sxs-lookup"><span data-stu-id="75cfd-297">You can open SQL Server Management Studio, connect to the default instance of SQL Server, and verify that the availability group is configured.</span></span>
