---
title: SQL Server availability groups - Azure virtual machines - Prereqs | Microsoft Docs
description: This tutorial shows how to configure the prerequisites for creating a SQL Server Always On availability group on Azure VMs.
services: virtual-machines
documentationCenter: na
authors: MikeRayMSFT
manager: jhubbard
editor: monicar
tags: azure-service-management
ms.assetid: c492db4c-3faa-4645-849f-5a1a663be55a
ms.service: virtual-machines-sql
ms.devlang: na
ms.custom: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 03/17/2017
ms.author: mikeray
ms.openlocfilehash: b064f4a500f258f6c30e4ba54df83bc6b850f7ff
ms.sourcegitcommit: 5b9d839c0c0a94b293fdafe1d6e5429506c07e05
ms.translationtype: HT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/02/2018
ms.locfileid: "44540780"
---
# <a name="complete-the-prerequisites-for-creating-always-on-availability-groups-on-azure-virtual-machines"></a><span data-ttu-id="46cc0-103">Complete the prerequisites for creating Always On availability groups on Azure virtual machines</span><span class="sxs-lookup"><span data-stu-id="46cc0-103">Complete the prerequisites for creating Always On availability groups on Azure virtual machines</span></span>

<span data-ttu-id="46cc0-104">This tutorial shows how to complete the prerequisites for creating a [SQL Server Always On availability group on Azure virtual machines (VMs)](virtual-machines-windows-portal-sql-availability-group-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="46cc0-104">This tutorial shows how to complete the prerequisites for creating a [SQL Server Always On availability group on Azure virtual machines (VMs)](virtual-machines-windows-portal-sql-availability-group-tutorial.md).</span></span> <span data-ttu-id="46cc0-105">When you've finished the prerequisites, you have a domain controller, two SQL Server VMs, and a witness server in a single resource group.</span><span class="sxs-lookup"><span data-stu-id="46cc0-105">When you've finished the prerequisites, you have a domain controller, two SQL Server VMs, and a witness server in a single resource group.</span></span>

<span data-ttu-id="46cc0-106">**Time estimate**: It might take a couple of hours to complete the prerequisites.</span><span class="sxs-lookup"><span data-stu-id="46cc0-106">**Time estimate**: It might take a couple of hours to complete the prerequisites.</span></span> <span data-ttu-id="46cc0-107">Much of this time is spent creating virtual machines.</span><span class="sxs-lookup"><span data-stu-id="46cc0-107">Much of this time is spent creating virtual machines.</span></span>

<span data-ttu-id="46cc0-108">The following diagram illustrates what you build in the tutorial.</span><span class="sxs-lookup"><span data-stu-id="46cc0-108">The following diagram illustrates what you build in the tutorial.</span></span>

![Availability group](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/00-EndstateSampleNoELB.png)

## <a name="review-availability-group-documentation"></a><span data-ttu-id="46cc0-110">Review availability group documentation</span><span class="sxs-lookup"><span data-stu-id="46cc0-110">Review availability group documentation</span></span>

<span data-ttu-id="46cc0-111">This tutorial assumes that you have a basic understanding of SQL Server Always On availability groups.</span><span class="sxs-lookup"><span data-stu-id="46cc0-111">This tutorial assumes that you have a basic understanding of SQL Server Always On availability groups.</span></span> <span data-ttu-id="46cc0-112">If you're not familiar with this technology, see [Overview of Always On Availability Groups (SQL Server)](http://msdn.microsoft.com/library/ff877884.aspx).</span><span class="sxs-lookup"><span data-stu-id="46cc0-112">If you're not familiar with this technology, see [Overview of Always On Availability Groups (SQL Server)](http://msdn.microsoft.com/library/ff877884.aspx).</span></span>


## <a name="create-an-azure-account"></a><span data-ttu-id="46cc0-113">Create an Azure account</span><span class="sxs-lookup"><span data-stu-id="46cc0-113">Create an Azure account</span></span>
<span data-ttu-id="46cc0-114">You need an Azure account.</span><span class="sxs-lookup"><span data-stu-id="46cc0-114">You need an Azure account.</span></span> <span data-ttu-id="46cc0-115">You can [open a free Azure account](/pricing/free-trial/?WT.mc_id=A261C142F) or [activate Visual Studio subscriber benefits](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F).</span><span class="sxs-lookup"><span data-stu-id="46cc0-115">You can [open a free Azure account](/pricing/free-trial/?WT.mc_id=A261C142F) or [activate Visual Studio subscriber benefits](/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F).</span></span>

## <a name="create-a-resource-group"></a><span data-ttu-id="46cc0-116">Create a resource group</span><span class="sxs-lookup"><span data-stu-id="46cc0-116">Create a resource group</span></span>
1. <span data-ttu-id="46cc0-117">Sign in to the [Azure portal](http://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="46cc0-117">Sign in to the [Azure portal](http://portal.azure.com).</span></span>
2. <span data-ttu-id="46cc0-118">Click **+** to create a new object in the portal.</span><span class="sxs-lookup"><span data-stu-id="46cc0-118">Click **+** to create a new object in the portal.</span></span>

   ![New object](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-portalplus.png)

3. <span data-ttu-id="46cc0-120">Type **resource group** in the **Marketplace** search window.</span><span class="sxs-lookup"><span data-stu-id="46cc0-120">Type **resource group** in the **Marketplace** search window.</span></span>

   ![Resource group](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-resourcegroupsymbol.png)
4. <span data-ttu-id="46cc0-122">Click **Resource group**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-122">Click **Resource group**.</span></span>
5. <span data-ttu-id="46cc0-123">Click **Create**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-123">Click **Create**.</span></span>
6. <span data-ttu-id="46cc0-124">On the **Resource group** blade, under **Resource group name**, type a name for the resource group.</span><span class="sxs-lookup"><span data-stu-id="46cc0-124">On the **Resource group** blade, under **Resource group name**, type a name for the resource group.</span></span> <span data-ttu-id="46cc0-125">For example, type **sql-ha-rg**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-125">For example, type **sql-ha-rg**.</span></span>
7. <span data-ttu-id="46cc0-126">If you have multiple Azure subscriptions, verify that the subscription is the Azure subscription that you want to create the availability group in.</span><span class="sxs-lookup"><span data-stu-id="46cc0-126">If you have multiple Azure subscriptions, verify that the subscription is the Azure subscription that you want to create the availability group in.</span></span>
8. <span data-ttu-id="46cc0-127">Select a location.</span><span class="sxs-lookup"><span data-stu-id="46cc0-127">Select a location.</span></span> <span data-ttu-id="46cc0-128">The location is the Azure region where you want to create the availability group.</span><span class="sxs-lookup"><span data-stu-id="46cc0-128">The location is the Azure region where you want to create the availability group.</span></span> <span data-ttu-id="46cc0-129">For this tutorial, we're going to build all resources in one Azure location.</span><span class="sxs-lookup"><span data-stu-id="46cc0-129">For this tutorial, we're going to build all resources in one Azure location.</span></span>
9. <span data-ttu-id="46cc0-130">Verify that **Pin to dashboard** is checked.</span><span class="sxs-lookup"><span data-stu-id="46cc0-130">Verify that **Pin to dashboard** is checked.</span></span> <span data-ttu-id="46cc0-131">This optional setting places a shortcut for the resource group on the Azure portal dashboard.</span><span class="sxs-lookup"><span data-stu-id="46cc0-131">This optional setting places a shortcut for the resource group on the Azure portal dashboard.</span></span>

   ![Resource group](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/01-resourcegroup.png)

10. <span data-ttu-id="46cc0-133">Click **Create** to create the resource group.</span><span class="sxs-lookup"><span data-stu-id="46cc0-133">Click **Create** to create the resource group.</span></span>

<span data-ttu-id="46cc0-134">Azure creates the resource group and pins a shortcut to the resource group in the portal.</span><span class="sxs-lookup"><span data-stu-id="46cc0-134">Azure creates the resource group and pins a shortcut to the resource group in the portal.</span></span>

## <a name="create-the-network-and-subnets"></a><span data-ttu-id="46cc0-135">Create the network and subnets</span><span class="sxs-lookup"><span data-stu-id="46cc0-135">Create the network and subnets</span></span>
<span data-ttu-id="46cc0-136">The next step is to create the networks and subnets in the Azure resource group.</span><span class="sxs-lookup"><span data-stu-id="46cc0-136">The next step is to create the networks and subnets in the Azure resource group.</span></span>

<span data-ttu-id="46cc0-137">The solution uses one virtual network with two subnets.</span><span class="sxs-lookup"><span data-stu-id="46cc0-137">The solution uses one virtual network with two subnets.</span></span> <span data-ttu-id="46cc0-138">The [Virtual network overview](../../../virtual-network/virtual-networks-overview.md) provides more information about networks in Azure.</span><span class="sxs-lookup"><span data-stu-id="46cc0-138">The [Virtual network overview](../../../virtual-network/virtual-networks-overview.md) provides more information about networks in Azure.</span></span>

<span data-ttu-id="46cc0-139">To create the virtual network:</span><span class="sxs-lookup"><span data-stu-id="46cc0-139">To create the virtual network:</span></span>

1. <span data-ttu-id="46cc0-140">In the Azure portal, in your resource group, click **+ Add**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-140">In the Azure portal, in your resource group, click **+ Add**.</span></span> <span data-ttu-id="46cc0-141">Azure opens the **Everything** blade.</span><span class="sxs-lookup"><span data-stu-id="46cc0-141">Azure opens the **Everything** blade.</span></span>

   ![New item](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/02-newiteminrg.png)
2. <span data-ttu-id="46cc0-143">Search for **virtual network**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-143">Search for **virtual network**.</span></span>

     ![Search virtual network](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/04-findvirtualnetwork.png)
3. <span data-ttu-id="46cc0-145">Click **Virtual network**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-145">Click **Virtual network**.</span></span>
4. <span data-ttu-id="46cc0-146">On the **Virtual network** blade, click the **Resource Manager** deployment model, and then click **Create**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-146">On the **Virtual network** blade, click the **Resource Manager** deployment model, and then click **Create**.</span></span>

    <span data-ttu-id="46cc0-147">The following table shows the settings for the virtual network:</span><span class="sxs-lookup"><span data-stu-id="46cc0-147">The following table shows the settings for the virtual network:</span></span>

   | <span data-ttu-id="46cc0-148">**Field**</span><span class="sxs-lookup"><span data-stu-id="46cc0-148">**Field**</span></span> | <span data-ttu-id="46cc0-149">Value</span><span class="sxs-lookup"><span data-stu-id="46cc0-149">Value</span></span> |
   | --- | --- |
   | <span data-ttu-id="46cc0-150">**Name**</span><span class="sxs-lookup"><span data-stu-id="46cc0-150">**Name**</span></span> |<span data-ttu-id="46cc0-151">autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="46cc0-151">autoHAVNET</span></span> |
   | <span data-ttu-id="46cc0-152">**Address space**</span><span class="sxs-lookup"><span data-stu-id="46cc0-152">**Address space**</span></span> |<span data-ttu-id="46cc0-153">10.33.0.0/24</span><span class="sxs-lookup"><span data-stu-id="46cc0-153">10.33.0.0/24</span></span> |
   | <span data-ttu-id="46cc0-154">**Subnet name**</span><span class="sxs-lookup"><span data-stu-id="46cc0-154">**Subnet name**</span></span> |<span data-ttu-id="46cc0-155">Admin</span><span class="sxs-lookup"><span data-stu-id="46cc0-155">Admin</span></span> |
   | <span data-ttu-id="46cc0-156">**Subnet address range**</span><span class="sxs-lookup"><span data-stu-id="46cc0-156">**Subnet address range**</span></span> |<span data-ttu-id="46cc0-157">10.33.0.0/29</span><span class="sxs-lookup"><span data-stu-id="46cc0-157">10.33.0.0/29</span></span> |
   | <span data-ttu-id="46cc0-158">**Subscription**</span><span class="sxs-lookup"><span data-stu-id="46cc0-158">**Subscription**</span></span> |<span data-ttu-id="46cc0-159">Specify the subscription that you intend to use.</span><span class="sxs-lookup"><span data-stu-id="46cc0-159">Specify the subscription that you intend to use.</span></span> <span data-ttu-id="46cc0-160">**Subscription** is blank if you only have one subscription.</span><span class="sxs-lookup"><span data-stu-id="46cc0-160">**Subscription** is blank if you only have one subscription.</span></span> |
   | <span data-ttu-id="46cc0-161">**Location**</span><span class="sxs-lookup"><span data-stu-id="46cc0-161">**Location**</span></span> |<span data-ttu-id="46cc0-162">Specify the Azure location.</span><span class="sxs-lookup"><span data-stu-id="46cc0-162">Specify the Azure location.</span></span> |

   <span data-ttu-id="46cc0-163">Your address space and subnet address range might be different from the table.</span><span class="sxs-lookup"><span data-stu-id="46cc0-163">Your address space and subnet address range might be different from the table.</span></span> <span data-ttu-id="46cc0-164">Depending on your subscription, the portal suggests an available address space and corresponding subnet address range.</span><span class="sxs-lookup"><span data-stu-id="46cc0-164">Depending on your subscription, the portal suggests an available address space and corresponding subnet address range.</span></span> <span data-ttu-id="46cc0-165">If no sufficient address space is available, use a different subscription.</span><span class="sxs-lookup"><span data-stu-id="46cc0-165">If no sufficient address space is available, use a different subscription.</span></span>

   <span data-ttu-id="46cc0-166">The example uses the subnet name **Admin**. This subnet is for the domain controllers.</span><span class="sxs-lookup"><span data-stu-id="46cc0-166">The example uses the subnet name **Admin**. This subnet is for the domain controllers.</span></span>

5. <span data-ttu-id="46cc0-167">Click **Create**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-167">Click **Create**.</span></span>

   ![Configure the virtual network](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/06-configurevirtualnetwork.png)

<span data-ttu-id="46cc0-169">Azure returns you to the portal dashboard and notifies you when the new network is created.</span><span class="sxs-lookup"><span data-stu-id="46cc0-169">Azure returns you to the portal dashboard and notifies you when the new network is created.</span></span>

### <a name="create-a-second-subnet"></a><span data-ttu-id="46cc0-170">Create a second subnet</span><span class="sxs-lookup"><span data-stu-id="46cc0-170">Create a second subnet</span></span>
<span data-ttu-id="46cc0-171">The new virtual network has one subnet, named **Admin**. The domain controllers use this subnet.</span><span class="sxs-lookup"><span data-stu-id="46cc0-171">The new virtual network has one subnet, named **Admin**. The domain controllers use this subnet.</span></span> <span data-ttu-id="46cc0-172">The SQL Server VMs use a second subnet named **SQL**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-172">The SQL Server VMs use a second subnet named **SQL**.</span></span> <span data-ttu-id="46cc0-173">To configure this subnet:</span><span class="sxs-lookup"><span data-stu-id="46cc0-173">To configure this subnet:</span></span>

1. <span data-ttu-id="46cc0-174">On your dashboard, click the resource group that you created, **SQL-HA-RG**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-174">On your dashboard, click the resource group that you created, **SQL-HA-RG**.</span></span> <span data-ttu-id="46cc0-175">Locate the network in the resource group under **Resources**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-175">Locate the network in the resource group under **Resources**.</span></span>

    <span data-ttu-id="46cc0-176">If **SQL-HA-RG** isn't visible, find it by clicking **Resource Groups** and filtering by the resource group name.</span><span class="sxs-lookup"><span data-stu-id="46cc0-176">If **SQL-HA-RG** isn't visible, find it by clicking **Resource Groups** and filtering by the resource group name.</span></span>
2. <span data-ttu-id="46cc0-177">Click **autoHAVNET** on the list of resources.</span><span class="sxs-lookup"><span data-stu-id="46cc0-177">Click **autoHAVNET** on the list of resources.</span></span> <span data-ttu-id="46cc0-178">Azure opens the network configuration blade.</span><span class="sxs-lookup"><span data-stu-id="46cc0-178">Azure opens the network configuration blade.</span></span>
3. <span data-ttu-id="46cc0-179">On the **autoHAVNET** virtual network blade, click **All settings**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-179">On the **autoHAVNET** virtual network blade, click **All settings**.</span></span>
4. <span data-ttu-id="46cc0-180">On the **Settings** blade, click **Subnets**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-180">On the **Settings** blade, click **Subnets**.</span></span>

    <span data-ttu-id="46cc0-181">Note the subnet that you already created.</span><span class="sxs-lookup"><span data-stu-id="46cc0-181">Note the subnet that you already created.</span></span>

   ![Configure the virtual network](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/07-addsubnet.png)
5. <span data-ttu-id="46cc0-183">Create a second subnet.</span><span class="sxs-lookup"><span data-stu-id="46cc0-183">Create a second subnet.</span></span> <span data-ttu-id="46cc0-184">Click **+ Subnet**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-184">Click **+ Subnet**.</span></span>
6. <span data-ttu-id="46cc0-185">On the **Add subnet** blade, configure the subnet by typing **sqlsubnet** under **Name**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-185">On the **Add subnet** blade, configure the subnet by typing **sqlsubnet** under **Name**.</span></span> <span data-ttu-id="46cc0-186">Azure automatically specifies a valid **Address range**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-186">Azure automatically specifies a valid **Address range**.</span></span> <span data-ttu-id="46cc0-187">Verify that this address range has at least 10 addresses in it.</span><span class="sxs-lookup"><span data-stu-id="46cc0-187">Verify that this address range has at least 10 addresses in it.</span></span> <span data-ttu-id="46cc0-188">In a production environment, you might require more addresses.</span><span class="sxs-lookup"><span data-stu-id="46cc0-188">In a production environment, you might require more addresses.</span></span>
7. <span data-ttu-id="46cc0-189">Click **OK**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-189">Click **OK**.</span></span>

    ![Configure the virtual network](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/08-configuresubnet.png)

<span data-ttu-id="46cc0-191">The following table summarizes the network configuration settings:</span><span class="sxs-lookup"><span data-stu-id="46cc0-191">The following table summarizes the network configuration settings:</span></span>

| <span data-ttu-id="46cc0-192">**Field**</span><span class="sxs-lookup"><span data-stu-id="46cc0-192">**Field**</span></span> | <span data-ttu-id="46cc0-193">Value</span><span class="sxs-lookup"><span data-stu-id="46cc0-193">Value</span></span> |
| --- | --- |
| <span data-ttu-id="46cc0-194">**Name**</span><span class="sxs-lookup"><span data-stu-id="46cc0-194">**Name**</span></span> |<span data-ttu-id="46cc0-195">**autoHAVNET**</span><span class="sxs-lookup"><span data-stu-id="46cc0-195">**autoHAVNET**</span></span> |
| <span data-ttu-id="46cc0-196">**Address space**</span><span class="sxs-lookup"><span data-stu-id="46cc0-196">**Address space**</span></span> |<span data-ttu-id="46cc0-197">This value depends on the available address spaces in your subscription.</span><span class="sxs-lookup"><span data-stu-id="46cc0-197">This value depends on the available address spaces in your subscription.</span></span> <span data-ttu-id="46cc0-198">A typical value is 10.0.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="46cc0-198">A typical value is 10.0.0.0/16.</span></span> |
| <span data-ttu-id="46cc0-199">**Subnet name**</span><span class="sxs-lookup"><span data-stu-id="46cc0-199">**Subnet name**</span></span> |<span data-ttu-id="46cc0-200">**admin**</span><span class="sxs-lookup"><span data-stu-id="46cc0-200">**admin**</span></span> |
| <span data-ttu-id="46cc0-201">**Subnet address range**</span><span class="sxs-lookup"><span data-stu-id="46cc0-201">**Subnet address range**</span></span> |<span data-ttu-id="46cc0-202">This value depends on the available address ranges in your subscription.</span><span class="sxs-lookup"><span data-stu-id="46cc0-202">This value depends on the available address ranges in your subscription.</span></span> <span data-ttu-id="46cc0-203">A typical value is 10.0.0.0/24.</span><span class="sxs-lookup"><span data-stu-id="46cc0-203">A typical value is 10.0.0.0/24.</span></span> |
| <span data-ttu-id="46cc0-204">**Subnet name**</span><span class="sxs-lookup"><span data-stu-id="46cc0-204">**Subnet name**</span></span> |<span data-ttu-id="46cc0-205">**sqlsubnet**</span><span class="sxs-lookup"><span data-stu-id="46cc0-205">**sqlsubnet**</span></span> |
| <span data-ttu-id="46cc0-206">**Subnet address range**</span><span class="sxs-lookup"><span data-stu-id="46cc0-206">**Subnet address range**</span></span> |<span data-ttu-id="46cc0-207">This value depends on the available address ranges in your subscription.</span><span class="sxs-lookup"><span data-stu-id="46cc0-207">This value depends on the available address ranges in your subscription.</span></span> <span data-ttu-id="46cc0-208">A typical value is 10.0.1.0/24.</span><span class="sxs-lookup"><span data-stu-id="46cc0-208">A typical value is 10.0.1.0/24.</span></span> |
| <span data-ttu-id="46cc0-209">**Subscription**</span><span class="sxs-lookup"><span data-stu-id="46cc0-209">**Subscription**</span></span> |<span data-ttu-id="46cc0-210">Specify the subscription that you intend to use.</span><span class="sxs-lookup"><span data-stu-id="46cc0-210">Specify the subscription that you intend to use.</span></span> |
| <span data-ttu-id="46cc0-211">**Resource Group**</span><span class="sxs-lookup"><span data-stu-id="46cc0-211">**Resource Group**</span></span> |<span data-ttu-id="46cc0-212">**SQL-HA-RG**</span><span class="sxs-lookup"><span data-stu-id="46cc0-212">**SQL-HA-RG**</span></span> |
| <span data-ttu-id="46cc0-213">**Location**</span><span class="sxs-lookup"><span data-stu-id="46cc0-213">**Location**</span></span> |<span data-ttu-id="46cc0-214">Specify the same location that you chose for the resource group.</span><span class="sxs-lookup"><span data-stu-id="46cc0-214">Specify the same location that you chose for the resource group.</span></span> |

## <a name="create-availability-sets"></a><span data-ttu-id="46cc0-215">Create availability sets</span><span class="sxs-lookup"><span data-stu-id="46cc0-215">Create availability sets</span></span>

<span data-ttu-id="46cc0-216">Before you create virtual machines, you need to create availability sets.</span><span class="sxs-lookup"><span data-stu-id="46cc0-216">Before you create virtual machines, you need to create availability sets.</span></span> <span data-ttu-id="46cc0-217">Availability sets reduce the downtime for planned or unplanned maintenance events.</span><span class="sxs-lookup"><span data-stu-id="46cc0-217">Availability sets reduce the downtime for planned or unplanned maintenance events.</span></span> <span data-ttu-id="46cc0-218">An Azure availability set is a logical group of resources that Azure places on physical fault domains and update domains.</span><span class="sxs-lookup"><span data-stu-id="46cc0-218">An Azure availability set is a logical group of resources that Azure places on physical fault domains and update domains.</span></span> <span data-ttu-id="46cc0-219">A fault domain ensures that the members of the availability set have separate power and network resources.</span><span class="sxs-lookup"><span data-stu-id="46cc0-219">A fault domain ensures that the members of the availability set have separate power and network resources.</span></span> <span data-ttu-id="46cc0-220">An update domain ensures that members of the availability set aren't brought down for maintenance at the same time.</span><span class="sxs-lookup"><span data-stu-id="46cc0-220">An update domain ensures that members of the availability set aren't brought down for maintenance at the same time.</span></span> <span data-ttu-id="46cc0-221">For more information, see [Manage the availability of virtual machines](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="46cc0-221">For more information, see [Manage the availability of virtual machines](../manage-availability.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

<span data-ttu-id="46cc0-222">You need two availability sets.</span><span class="sxs-lookup"><span data-stu-id="46cc0-222">You need two availability sets.</span></span> <span data-ttu-id="46cc0-223">One is for the domain controllers.</span><span class="sxs-lookup"><span data-stu-id="46cc0-223">One is for the domain controllers.</span></span> <span data-ttu-id="46cc0-224">The second is for the SQL Server VMs.</span><span class="sxs-lookup"><span data-stu-id="46cc0-224">The second is for the SQL Server VMs.</span></span>

<span data-ttu-id="46cc0-225">To create an availability set, go to the resource group and click **Add**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-225">To create an availability set, go to the resource group and click **Add**.</span></span> <span data-ttu-id="46cc0-226">Filter the results by typing **availability set**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-226">Filter the results by typing **availability set**.</span></span> <span data-ttu-id="46cc0-227">Click **Availability Set** in the results, and then click **Create**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-227">Click **Availability Set** in the results, and then click **Create**.</span></span>

<span data-ttu-id="46cc0-228">Configure two availability sets according to the parameters in the following table:</span><span class="sxs-lookup"><span data-stu-id="46cc0-228">Configure two availability sets according to the parameters in the following table:</span></span>

| <span data-ttu-id="46cc0-229">**Field**</span><span class="sxs-lookup"><span data-stu-id="46cc0-229">**Field**</span></span> | <span data-ttu-id="46cc0-230">Domain controller availability set</span><span class="sxs-lookup"><span data-stu-id="46cc0-230">Domain controller availability set</span></span> | <span data-ttu-id="46cc0-231">SQL Server availability set</span><span class="sxs-lookup"><span data-stu-id="46cc0-231">SQL Server availability set</span></span> |
| --- | --- | --- |
| <span data-ttu-id="46cc0-232">**Name**</span><span class="sxs-lookup"><span data-stu-id="46cc0-232">**Name**</span></span> |<span data-ttu-id="46cc0-233">adavailabilityset</span><span class="sxs-lookup"><span data-stu-id="46cc0-233">adavailabilityset</span></span> |<span data-ttu-id="46cc0-234">sqlavailabilityset</span><span class="sxs-lookup"><span data-stu-id="46cc0-234">sqlavailabilityset</span></span> |
| <span data-ttu-id="46cc0-235">**Resource group**</span><span class="sxs-lookup"><span data-stu-id="46cc0-235">**Resource group**</span></span> |<span data-ttu-id="46cc0-236">SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="46cc0-236">SQL-HA-RG</span></span> |<span data-ttu-id="46cc0-237">SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="46cc0-237">SQL-HA-RG</span></span> |
| <span data-ttu-id="46cc0-238">**Fault domains**</span><span class="sxs-lookup"><span data-stu-id="46cc0-238">**Fault domains**</span></span> |<span data-ttu-id="46cc0-239">3</span><span class="sxs-lookup"><span data-stu-id="46cc0-239">3</span></span> |<span data-ttu-id="46cc0-240">3</span><span class="sxs-lookup"><span data-stu-id="46cc0-240">3</span></span> |
| <span data-ttu-id="46cc0-241">**Update domains**</span><span class="sxs-lookup"><span data-stu-id="46cc0-241">**Update domains**</span></span> |<span data-ttu-id="46cc0-242">5</span><span class="sxs-lookup"><span data-stu-id="46cc0-242">5</span></span> |<span data-ttu-id="46cc0-243">3</span><span class="sxs-lookup"><span data-stu-id="46cc0-243">3</span></span> |

<span data-ttu-id="46cc0-244">After you create the availability sets, return to the resource group in the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="46cc0-244">After you create the availability sets, return to the resource group in the Azure portal.</span></span>

## <a name="create-domain-controllers"></a><span data-ttu-id="46cc0-245">Create domain controllers</span><span class="sxs-lookup"><span data-stu-id="46cc0-245">Create domain controllers</span></span>
<span data-ttu-id="46cc0-246">After you've created the network, subnets, availability sets, and an Internet-facing load balancer, you're ready to create the virtual machines for the domain controllers.</span><span class="sxs-lookup"><span data-stu-id="46cc0-246">After you've created the network, subnets, availability sets, and an Internet-facing load balancer, you're ready to create the virtual machines for the domain controllers.</span></span>

### <a name="create-virtual-machines-for-the-domain-controllers"></a><span data-ttu-id="46cc0-247">Create virtual machines for the domain controllers</span><span class="sxs-lookup"><span data-stu-id="46cc0-247">Create virtual machines for the domain controllers</span></span>
<span data-ttu-id="46cc0-248">To create and configure the domain controllers, return to the **SQL-HA-RG** resource group.</span><span class="sxs-lookup"><span data-stu-id="46cc0-248">To create and configure the domain controllers, return to the **SQL-HA-RG** resource group.</span></span>

1. <span data-ttu-id="46cc0-249">Click **Add**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-249">Click **Add**.</span></span> <span data-ttu-id="46cc0-250">The **Everything** blade opens.</span><span class="sxs-lookup"><span data-stu-id="46cc0-250">The **Everything** blade opens.</span></span>
2. <span data-ttu-id="46cc0-251">Type **Windows Server 2016 Datacenter**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-251">Type **Windows Server 2016 Datacenter**.</span></span>
3. <span data-ttu-id="46cc0-252">Click **Windows Server 2016 Datacenter**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-252">Click **Windows Server 2016 Datacenter**.</span></span> <span data-ttu-id="46cc0-253">In the **Windows Server 2016 Datacenter** blade, verify that the deployment model is **Resource Manager**, and then click **Create**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-253">In the **Windows Server 2016 Datacenter** blade, verify that the deployment model is **Resource Manager**, and then click **Create**.</span></span> <span data-ttu-id="46cc0-254">Azure opens the **Create virtual machine** blade.</span><span class="sxs-lookup"><span data-stu-id="46cc0-254">Azure opens the **Create virtual machine** blade.</span></span>

<span data-ttu-id="46cc0-255">Repeat the preceding steps to create two virtual machines.</span><span class="sxs-lookup"><span data-stu-id="46cc0-255">Repeat the preceding steps to create two virtual machines.</span></span> <span data-ttu-id="46cc0-256">Name the two virtual machines:</span><span class="sxs-lookup"><span data-stu-id="46cc0-256">Name the two virtual machines:</span></span>

* <span data-ttu-id="46cc0-257">ad-primary-dc</span><span class="sxs-lookup"><span data-stu-id="46cc0-257">ad-primary-dc</span></span>
* <span data-ttu-id="46cc0-258">ad-secondary-dc</span><span class="sxs-lookup"><span data-stu-id="46cc0-258">ad-secondary-dc</span></span>

  > [!NOTE]
  > <span data-ttu-id="46cc0-259">The **ad-secondary-dc** virtual machine is optional, to provide high availability for Active Directory Domain Services.</span><span class="sxs-lookup"><span data-stu-id="46cc0-259">The **ad-secondary-dc** virtual machine is optional, to provide high availability for Active Directory Domain Services.</span></span>
  >
  >

<span data-ttu-id="46cc0-260">The following table shows the settings for these two machines:</span><span class="sxs-lookup"><span data-stu-id="46cc0-260">The following table shows the settings for these two machines:</span></span>

| <span data-ttu-id="46cc0-261">**Field**</span><span class="sxs-lookup"><span data-stu-id="46cc0-261">**Field**</span></span> | <span data-ttu-id="46cc0-262">Value</span><span class="sxs-lookup"><span data-stu-id="46cc0-262">Value</span></span> |
| --- | --- |
| <span data-ttu-id="46cc0-263">**VM disk type**</span><span class="sxs-lookup"><span data-stu-id="46cc0-263">**VM disk type**</span></span> |<span data-ttu-id="46cc0-264">SSD</span><span class="sxs-lookup"><span data-stu-id="46cc0-264">SSD</span></span> |
| <span data-ttu-id="46cc0-265">**User name**</span><span class="sxs-lookup"><span data-stu-id="46cc0-265">**User name**</span></span> |<span data-ttu-id="46cc0-266">DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="46cc0-266">DomainAdmin</span></span> |
| <span data-ttu-id="46cc0-267">**Password**</span><span class="sxs-lookup"><span data-stu-id="46cc0-267">**Password**</span></span> |<span data-ttu-id="46cc0-268">Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="46cc0-268">Contoso!0000</span></span> |
| <span data-ttu-id="46cc0-269">**Subscription**</span><span class="sxs-lookup"><span data-stu-id="46cc0-269">**Subscription**</span></span> |<span data-ttu-id="46cc0-270">*Your subscription*</span><span class="sxs-lookup"><span data-stu-id="46cc0-270">*Your subscription*</span></span> |
| <span data-ttu-id="46cc0-271">**Resource group**</span><span class="sxs-lookup"><span data-stu-id="46cc0-271">**Resource group**</span></span> |<span data-ttu-id="46cc0-272">SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="46cc0-272">SQL-HA-RG</span></span> |
| <span data-ttu-id="46cc0-273">**Location**</span><span class="sxs-lookup"><span data-stu-id="46cc0-273">**Location**</span></span> |<span data-ttu-id="46cc0-274">*Your location*</span><span class="sxs-lookup"><span data-stu-id="46cc0-274">*Your location*</span></span> |
| <span data-ttu-id="46cc0-275">**Size**</span><span class="sxs-lookup"><span data-stu-id="46cc0-275">**Size**</span></span> |<span data-ttu-id="46cc0-276">DS1_V2</span><span class="sxs-lookup"><span data-stu-id="46cc0-276">DS1_V2</span></span> |
| <span data-ttu-id="46cc0-277">**Storage account**</span><span class="sxs-lookup"><span data-stu-id="46cc0-277">**Storage account**</span></span> |<span data-ttu-id="46cc0-278">*Automatically created*</span><span class="sxs-lookup"><span data-stu-id="46cc0-278">*Automatically created*</span></span> |
| <span data-ttu-id="46cc0-279">**Virtual network**</span><span class="sxs-lookup"><span data-stu-id="46cc0-279">**Virtual network**</span></span> |<span data-ttu-id="46cc0-280">autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="46cc0-280">autoHAVNET</span></span> |
| <span data-ttu-id="46cc0-281">**Subnet**</span><span class="sxs-lookup"><span data-stu-id="46cc0-281">**Subnet**</span></span> |<span data-ttu-id="46cc0-282">admin</span><span class="sxs-lookup"><span data-stu-id="46cc0-282">admin</span></span> |
| <span data-ttu-id="46cc0-283">**Public IP address**</span><span class="sxs-lookup"><span data-stu-id="46cc0-283">**Public IP address**</span></span> |<span data-ttu-id="46cc0-284">*Same name as the VM*</span><span class="sxs-lookup"><span data-stu-id="46cc0-284">*Same name as the VM*</span></span> |
| <span data-ttu-id="46cc0-285">**Network security group**</span><span class="sxs-lookup"><span data-stu-id="46cc0-285">**Network security group**</span></span> |<span data-ttu-id="46cc0-286">*Same name as the VM*</span><span class="sxs-lookup"><span data-stu-id="46cc0-286">*Same name as the VM*</span></span> |
| <span data-ttu-id="46cc0-287">**Availability set**</span><span class="sxs-lookup"><span data-stu-id="46cc0-287">**Availability set**</span></span> |<span data-ttu-id="46cc0-288">adavailabilityset</span><span class="sxs-lookup"><span data-stu-id="46cc0-288">adavailabilityset</span></span> |
| <span data-ttu-id="46cc0-289">**Diagnostics**</span><span class="sxs-lookup"><span data-stu-id="46cc0-289">**Diagnostics**</span></span> |<span data-ttu-id="46cc0-290">Enabled</span><span class="sxs-lookup"><span data-stu-id="46cc0-290">Enabled</span></span> |
| <span data-ttu-id="46cc0-291">**Diagnostics storage account**</span><span class="sxs-lookup"><span data-stu-id="46cc0-291">**Diagnostics storage account**</span></span> |<span data-ttu-id="46cc0-292">*Automatically created*</span><span class="sxs-lookup"><span data-stu-id="46cc0-292">*Automatically created*</span></span> |

   >[!IMPORTANT]
   ><span data-ttu-id="46cc0-293">You can only place a VM in an availability set when you create it.</span><span class="sxs-lookup"><span data-stu-id="46cc0-293">You can only place a VM in an availability set when you create it.</span></span> <span data-ttu-id="46cc0-294">You can't change the availability set after a VM is created.</span><span class="sxs-lookup"><span data-stu-id="46cc0-294">You can't change the availability set after a VM is created.</span></span> <span data-ttu-id="46cc0-295">See [Manage the availability of virtual machines](../manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="46cc0-295">See [Manage the availability of virtual machines](../manage-availability.md).</span></span>

<span data-ttu-id="46cc0-296">Azure creates the virtual machines.</span><span class="sxs-lookup"><span data-stu-id="46cc0-296">Azure creates the virtual machines.</span></span>

<span data-ttu-id="46cc0-297">After the virtual machines are created, configure the domain controller.</span><span class="sxs-lookup"><span data-stu-id="46cc0-297">After the virtual machines are created, configure the domain controller.</span></span>

### <a name="configure-the-domain-controller"></a><span data-ttu-id="46cc0-298">Configure the domain controller</span><span class="sxs-lookup"><span data-stu-id="46cc0-298">Configure the domain controller</span></span>
<span data-ttu-id="46cc0-299">In the following steps, configure the **ad-primary-dc** machine as a domain controller for corp.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="46cc0-299">In the following steps, configure the **ad-primary-dc** machine as a domain controller for corp.contoso.com.</span></span>

1. <span data-ttu-id="46cc0-300">In the portal, open the **SQL-HA-RG** resource group and select the **ad-primary-dc** machine.</span><span class="sxs-lookup"><span data-stu-id="46cc0-300">In the portal, open the **SQL-HA-RG** resource group and select the **ad-primary-dc** machine.</span></span> <span data-ttu-id="46cc0-301">On the **ad-primary-dc** blade, click **Connect** to open an RDP file for remote desktop access.</span><span class="sxs-lookup"><span data-stu-id="46cc0-301">On the **ad-primary-dc** blade, click **Connect** to open an RDP file for remote desktop access.</span></span>

    ![Connect to a virtual machine](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/20-connectrdp.png)
2. <span data-ttu-id="46cc0-303">Sign in with your configured administrator account (**\DomainAdmin**) and password (**Contoso!0000**).</span><span class="sxs-lookup"><span data-stu-id="46cc0-303">Sign in with your configured administrator account (**\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="46cc0-304">By default, the **Server Manager** dashboard should be displayed.</span><span class="sxs-lookup"><span data-stu-id="46cc0-304">By default, the **Server Manager** dashboard should be displayed.</span></span>
4. <span data-ttu-id="46cc0-305">Click the **Add roles and features** link on the dashboard.</span><span class="sxs-lookup"><span data-stu-id="46cc0-305">Click the **Add roles and features** link on the dashboard.</span></span>

    ![Server Manager - Add roles](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
5. <span data-ttu-id="46cc0-307">Select **Next** until you get to the **Server Roles** section.</span><span class="sxs-lookup"><span data-stu-id="46cc0-307">Select **Next** until you get to the **Server Roles** section.</span></span>
6. <span data-ttu-id="46cc0-308">Select the **Active Directory Domain Services** and **DNS Server** roles.</span><span class="sxs-lookup"><span data-stu-id="46cc0-308">Select the **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="46cc0-309">When you're prompted, add any additional features that are required by these roles.</span><span class="sxs-lookup"><span data-stu-id="46cc0-309">When you're prompted, add any additional features that are required by these roles.</span></span>

   > [!NOTE]
   > <span data-ttu-id="46cc0-310">Windows warns you that there is no static IP address.</span><span class="sxs-lookup"><span data-stu-id="46cc0-310">Windows warns you that there is no static IP address.</span></span> <span data-ttu-id="46cc0-311">If you're testing the configuration, click **Continue**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-311">If you're testing the configuration, click **Continue**.</span></span> <span data-ttu-id="46cc0-312">For production scenarios, set the IP address to static in the Azure portal, or [use PowerShell to set the static IP address of the domain controller machine](../../../virtual-network/virtual-networks-reserved-private-ip.md).</span><span class="sxs-lookup"><span data-stu-id="46cc0-312">For production scenarios, set the IP address to static in the Azure portal, or [use PowerShell to set the static IP address of the domain controller machine](../../../virtual-network/virtual-networks-reserved-private-ip.md).</span></span>
   >
   >

    ![Add Roles dialog](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/23-addroles.png)
7. <span data-ttu-id="46cc0-314">Click **Next** until you reach the **Confirmation** section.</span><span class="sxs-lookup"><span data-stu-id="46cc0-314">Click **Next** until you reach the **Confirmation** section.</span></span> <span data-ttu-id="46cc0-315">Select the **Restart the destination server automatically if required** check box.</span><span class="sxs-lookup"><span data-stu-id="46cc0-315">Select the **Restart the destination server automatically if required** check box.</span></span>
8. <span data-ttu-id="46cc0-316">Click **Install**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-316">Click **Install**.</span></span>
9. <span data-ttu-id="46cc0-317">After the features finish installing, return to the **Server Manager** dashboard.</span><span class="sxs-lookup"><span data-stu-id="46cc0-317">After the features finish installing, return to the **Server Manager** dashboard.</span></span>
10. <span data-ttu-id="46cc0-318">Select the new **AD DS** option on the left-hand pane.</span><span class="sxs-lookup"><span data-stu-id="46cc0-318">Select the new **AD DS** option on the left-hand pane.</span></span>
11. <span data-ttu-id="46cc0-319">Click the **More** link on the yellow warning bar.</span><span class="sxs-lookup"><span data-stu-id="46cc0-319">Click the **More** link on the yellow warning bar.</span></span>

    ![AD DS dialog on the DNS Server VM](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/24-addsmore.png)
12. <span data-ttu-id="46cc0-321">In the **Action** column of the **All Server Task Details** dialog, click **Promote this server to a domain controller**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-321">In the **Action** column of the **All Server Task Details** dialog, click **Promote this server to a domain controller**.</span></span>
13. <span data-ttu-id="46cc0-322">In the **Active Directory Domain Services Configuration Wizard**, use the following values:</span><span class="sxs-lookup"><span data-stu-id="46cc0-322">In the **Active Directory Domain Services Configuration Wizard**, use the following values:</span></span>

    | <span data-ttu-id="46cc0-323">**Page**</span><span class="sxs-lookup"><span data-stu-id="46cc0-323">**Page**</span></span> | <span data-ttu-id="46cc0-324">Setting</span><span class="sxs-lookup"><span data-stu-id="46cc0-324">Setting</span></span> |
    | --- | --- |
    | <span data-ttu-id="46cc0-325">**Deployment Configuration**</span><span class="sxs-lookup"><span data-stu-id="46cc0-325">**Deployment Configuration**</span></span> |<span data-ttu-id="46cc0-326">**Add a new forest**</span><span class="sxs-lookup"><span data-stu-id="46cc0-326">**Add a new forest**</span></span><br/> <span data-ttu-id="46cc0-327">**Root domain name** = corp.contoso.com</span><span class="sxs-lookup"><span data-stu-id="46cc0-327">**Root domain name** = corp.contoso.com</span></span> |
    | <span data-ttu-id="46cc0-328">**Domain Controller Options**</span><span class="sxs-lookup"><span data-stu-id="46cc0-328">**Domain Controller Options**</span></span> |<span data-ttu-id="46cc0-329">**DSRM Password** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="46cc0-329">**DSRM Password** = Contoso!0000</span></span><br/><span data-ttu-id="46cc0-330">**Confirm Password** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="46cc0-330">**Confirm Password** = Contoso!0000</span></span> |
14. <span data-ttu-id="46cc0-331">Click **Next** to go through the other pages in the wizard.</span><span class="sxs-lookup"><span data-stu-id="46cc0-331">Click **Next** to go through the other pages in the wizard.</span></span> <span data-ttu-id="46cc0-332">On the **Prerequisites Check** page, verify that you see the following message: **All prerequisite checks passed successfully**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-332">On the **Prerequisites Check** page, verify that you see the following message: **All prerequisite checks passed successfully**.</span></span> <span data-ttu-id="46cc0-333">You can review any applicable warning messages, but it's possible to continue with the installation.</span><span class="sxs-lookup"><span data-stu-id="46cc0-333">You can review any applicable warning messages, but it's possible to continue with the installation.</span></span>
15. <span data-ttu-id="46cc0-334">Click **Install**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-334">Click **Install**.</span></span> <span data-ttu-id="46cc0-335">The **ad-primary-dc** virtual machine automatically reboots.</span><span class="sxs-lookup"><span data-stu-id="46cc0-335">The **ad-primary-dc** virtual machine automatically reboots.</span></span>

### <a name="note-the-ip-address-of-the-primary-domain-controller"></a><span data-ttu-id="46cc0-336">Note the IP address of the primary domain controller</span><span class="sxs-lookup"><span data-stu-id="46cc0-336">Note the IP address of the primary domain controller</span></span>

<span data-ttu-id="46cc0-337">Use the primary domain controller for DNS.</span><span class="sxs-lookup"><span data-stu-id="46cc0-337">Use the primary domain controller for DNS.</span></span> <span data-ttu-id="46cc0-338">Note the primary domain controller IP address.</span><span class="sxs-lookup"><span data-stu-id="46cc0-338">Note the primary domain controller IP address.</span></span>

<span data-ttu-id="46cc0-339">One way to get the primary domain controller IP address is through the Azure portal.</span><span class="sxs-lookup"><span data-stu-id="46cc0-339">One way to get the primary domain controller IP address is through the Azure portal.</span></span>

1. <span data-ttu-id="46cc0-340">On the Azure portal, open the resource group.</span><span class="sxs-lookup"><span data-stu-id="46cc0-340">On the Azure portal, open the resource group.</span></span>

2. <span data-ttu-id="46cc0-341">Click the primary domain controller.</span><span class="sxs-lookup"><span data-stu-id="46cc0-341">Click the primary domain controller.</span></span>

3. <span data-ttu-id="46cc0-342">On the primary domain controller blade, click **Network interfaces**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-342">On the primary domain controller blade, click **Network interfaces**.</span></span>

![Network interfaces](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/25-primarydcip.png)

<span data-ttu-id="46cc0-344">Note the private IP address for this server.</span><span class="sxs-lookup"><span data-stu-id="46cc0-344">Note the private IP address for this server.</span></span>

### <a name="configure-the-second-domain-controller"></a><span data-ttu-id="46cc0-345">Configure the second domain controller</span><span class="sxs-lookup"><span data-stu-id="46cc0-345">Configure the second domain controller</span></span>
<span data-ttu-id="46cc0-346">After the primary domain controller reboots, you can configure the second domain controller.</span><span class="sxs-lookup"><span data-stu-id="46cc0-346">After the primary domain controller reboots, you can configure the second domain controller.</span></span> <span data-ttu-id="46cc0-347">This optional step is for high availability.</span><span class="sxs-lookup"><span data-stu-id="46cc0-347">This optional step is for high availability.</span></span> <span data-ttu-id="46cc0-348">Follow these steps to configure the second domain controller:</span><span class="sxs-lookup"><span data-stu-id="46cc0-348">Follow these steps to configure the second domain controller:</span></span>

1. <span data-ttu-id="46cc0-349">In the portal, open the **SQL-HA-RG** resource group and select the **ad-secondary-dc** machine.</span><span class="sxs-lookup"><span data-stu-id="46cc0-349">In the portal, open the **SQL-HA-RG** resource group and select the **ad-secondary-dc** machine.</span></span> <span data-ttu-id="46cc0-350">On the **ad-secondary-dc** blade, click **Connect** to open an RDP file for remote desktop access.</span><span class="sxs-lookup"><span data-stu-id="46cc0-350">On the **ad-secondary-dc** blade, click **Connect** to open an RDP file for remote desktop access.</span></span>
2. <span data-ttu-id="46cc0-351">Sign in to the VM by using your configured administrator account (**BUILTIN\DomainAdmin**) and password (**Contoso!0000**).</span><span class="sxs-lookup"><span data-stu-id="46cc0-351">Sign in to the VM by using your configured administrator account (**BUILTIN\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="46cc0-352">Change the preferred DNS server address to the address of the domain controller.</span><span class="sxs-lookup"><span data-stu-id="46cc0-352">Change the preferred DNS server address to the address of the domain controller.</span></span>
4. <span data-ttu-id="46cc0-353">In **Network and Sharing Center**, click the network interface.</span><span class="sxs-lookup"><span data-stu-id="46cc0-353">In **Network and Sharing Center**, click the network interface.</span></span>
   <span data-ttu-id="46cc0-354">![Network interface](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/26-networkinterface.png)</span><span class="sxs-lookup"><span data-stu-id="46cc0-354">![Network interface](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/26-networkinterface.png)</span></span>

5. <span data-ttu-id="46cc0-355">Click **Properties**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-355">Click **Properties**.</span></span>
6. <span data-ttu-id="46cc0-356">Select **Internet Protocol Version 4 (TCP/IPv4)** and click **Properties**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-356">Select **Internet Protocol Version 4 (TCP/IPv4)** and click **Properties**.</span></span>
7. <span data-ttu-id="46cc0-357">Select **Use the following DNS server addresses** and specify the address of the primary domain controller in **Preferred DNS server**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-357">Select **Use the following DNS server addresses** and specify the address of the primary domain controller in **Preferred DNS server**.</span></span>
8. <span data-ttu-id="46cc0-358">Click **OK**, and then **Close** to commit the changes.</span><span class="sxs-lookup"><span data-stu-id="46cc0-358">Click **OK**, and then **Close** to commit the changes.</span></span> <span data-ttu-id="46cc0-359">You are now able to join the VM to **corp.contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-359">You are now able to join the VM to **corp.contoso.com**.</span></span>

   >[!IMPORTANT]
   ><span data-ttu-id="46cc0-360">If you lose the connection to your remote desktop after changing the DNS setting, go to the Azure portal and restart the virtual machine.</span><span class="sxs-lookup"><span data-stu-id="46cc0-360">If you lose the connection to your remote desktop after changing the DNS setting, go to the Azure portal and restart the virtual machine.</span></span>

9. <span data-ttu-id="46cc0-361">From the remote desktop to the secondary domain controller, open **Server Manager Dashboard**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-361">From the remote desktop to the secondary domain controller, open **Server Manager Dashboard**.</span></span>
10. <span data-ttu-id="46cc0-362">Click the **Add roles and features** link on the dashboard.</span><span class="sxs-lookup"><span data-stu-id="46cc0-362">Click the **Add roles and features** link on the dashboard.</span></span>

    ![Server Manager - Add roles](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
11. <span data-ttu-id="46cc0-364">Select **Next** until you get to the **Server Roles** section.</span><span class="sxs-lookup"><span data-stu-id="46cc0-364">Select **Next** until you get to the **Server Roles** section.</span></span>
12. <span data-ttu-id="46cc0-365">Select the **Active Directory Domain Services** and **DNS Server** roles.</span><span class="sxs-lookup"><span data-stu-id="46cc0-365">Select the **Active Directory Domain Services** and **DNS Server** roles.</span></span> <span data-ttu-id="46cc0-366">When you're prompted, add any additional features that are required by these roles.</span><span class="sxs-lookup"><span data-stu-id="46cc0-366">When you're prompted, add any additional features that are required by these roles.</span></span>
13. <span data-ttu-id="46cc0-367">After the features finish installing, return to the **Server Manager** dashboard.</span><span class="sxs-lookup"><span data-stu-id="46cc0-367">After the features finish installing, return to the **Server Manager** dashboard.</span></span>
14. <span data-ttu-id="46cc0-368">Select the new **AD DS** option on the left-hand pane.</span><span class="sxs-lookup"><span data-stu-id="46cc0-368">Select the new **AD DS** option on the left-hand pane.</span></span>
15. <span data-ttu-id="46cc0-369">Click the **More** link on the yellow warning bar.</span><span class="sxs-lookup"><span data-stu-id="46cc0-369">Click the **More** link on the yellow warning bar.</span></span>
16. <span data-ttu-id="46cc0-370">In the **Action** column of the **All Server Task Details** dialog, click **Promote this server to a domain controller**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-370">In the **Action** column of the **All Server Task Details** dialog, click **Promote this server to a domain controller**.</span></span>
17. <span data-ttu-id="46cc0-371">Under **Deployment Configuration**, select **Add a domain controller to an existing domain**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-371">Under **Deployment Configuration**, select **Add a domain controller to an existing domain**.</span></span>
   <span data-ttu-id="46cc0-372">![Deployment configuration](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/28-deploymentconfig.png)</span><span class="sxs-lookup"><span data-stu-id="46cc0-372">![Deployment configuration](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/28-deploymentconfig.png)</span></span>
18. <span data-ttu-id="46cc0-373">Click **Select**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-373">Click **Select**.</span></span>
19. <span data-ttu-id="46cc0-374">Connect by using the administrator account (**CORP.CONTOSO.COM\domainadmin**) and password (**Contoso!0000**).</span><span class="sxs-lookup"><span data-stu-id="46cc0-374">Connect by using the administrator account (**CORP.CONTOSO.COM\domainadmin**) and password (**Contoso!0000**).</span></span>
20. <span data-ttu-id="46cc0-375">In **Select a domain from the forest**, click your domain, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-375">In **Select a domain from the forest**, click your domain, and then click **OK**.</span></span>
21. <span data-ttu-id="46cc0-376">In **Domain Controller Options**, use the default values and set a DSRM password.</span><span class="sxs-lookup"><span data-stu-id="46cc0-376">In **Domain Controller Options**, use the default values and set a DSRM password.</span></span>

   >[!NOTE]
   ><span data-ttu-id="46cc0-377">The **DNS Options** page might warn you that a delegation for this DNS server can't be created.</span><span class="sxs-lookup"><span data-stu-id="46cc0-377">The **DNS Options** page might warn you that a delegation for this DNS server can't be created.</span></span> <span data-ttu-id="46cc0-378">You can ignore this warning in non-production environments.</span><span class="sxs-lookup"><span data-stu-id="46cc0-378">You can ignore this warning in non-production environments.</span></span>
22. <span data-ttu-id="46cc0-379">Click **Next** until the dialog reaches the **Prerequisites** check.</span><span class="sxs-lookup"><span data-stu-id="46cc0-379">Click **Next** until the dialog reaches the **Prerequisites** check.</span></span> <span data-ttu-id="46cc0-380">Then click **Install**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-380">Then click **Install**.</span></span>

<span data-ttu-id="46cc0-381">After the server finishes the configuration changes, restart the server.</span><span class="sxs-lookup"><span data-stu-id="46cc0-381">After the server finishes the configuration changes, restart the server.</span></span>

### <a name=DomainAccounts></a> <span data-ttu-id="46cc0-382">Configure the domain accounts</span><span class="sxs-lookup"><span data-stu-id="46cc0-382">Configure the domain accounts</span></span>

<span data-ttu-id="46cc0-383">In the next steps, you configure the Active Directory accounts.</span><span class="sxs-lookup"><span data-stu-id="46cc0-383">In the next steps, you configure the Active Directory accounts.</span></span> <span data-ttu-id="46cc0-384">The following table shows the accounts:</span><span class="sxs-lookup"><span data-stu-id="46cc0-384">The following table shows the accounts:</span></span>

| |<span data-ttu-id="46cc0-385">Installation account</span><span class="sxs-lookup"><span data-stu-id="46cc0-385">Installation account</span></span><br/> |<span data-ttu-id="46cc0-386">sqlserver-0</span><span class="sxs-lookup"><span data-stu-id="46cc0-386">sqlserver-0</span></span> <br/><span data-ttu-id="46cc0-387">SQL Server and SQL Agent Service account</span><span class="sxs-lookup"><span data-stu-id="46cc0-387">SQL Server and SQL Agent Service account</span></span> |<span data-ttu-id="46cc0-388">sqlserver-1</span><span class="sxs-lookup"><span data-stu-id="46cc0-388">sqlserver-1</span></span><br/><span data-ttu-id="46cc0-389">SQL Server and SQL Agent Service account</span><span class="sxs-lookup"><span data-stu-id="46cc0-389">SQL Server and SQL Agent Service account</span></span>
| --- | --- | --- | ---
|<span data-ttu-id="46cc0-390">**First Name**</span><span class="sxs-lookup"><span data-stu-id="46cc0-390">**First Name**</span></span> |<span data-ttu-id="46cc0-391">Install</span><span class="sxs-lookup"><span data-stu-id="46cc0-391">Install</span></span> |<span data-ttu-id="46cc0-392">SQLSvc1</span><span class="sxs-lookup"><span data-stu-id="46cc0-392">SQLSvc1</span></span> | <span data-ttu-id="46cc0-393">SQLSvc2</span><span class="sxs-lookup"><span data-stu-id="46cc0-393">SQLSvc2</span></span>
|<span data-ttu-id="46cc0-394">**User SamAccountName**</span><span class="sxs-lookup"><span data-stu-id="46cc0-394">**User SamAccountName**</span></span> |<span data-ttu-id="46cc0-395">Install</span><span class="sxs-lookup"><span data-stu-id="46cc0-395">Install</span></span> |<span data-ttu-id="46cc0-396">SQLSvc1</span><span class="sxs-lookup"><span data-stu-id="46cc0-396">SQLSvc1</span></span> | <span data-ttu-id="46cc0-397">SQLSvc2</span><span class="sxs-lookup"><span data-stu-id="46cc0-397">SQLSvc2</span></span>

<span data-ttu-id="46cc0-398">Use the following steps to create each account.</span><span class="sxs-lookup"><span data-stu-id="46cc0-398">Use the following steps to create each account.</span></span>

1. <span data-ttu-id="46cc0-399">Sign in to the **ad-primary-dc** machine.</span><span class="sxs-lookup"><span data-stu-id="46cc0-399">Sign in to the **ad-primary-dc** machine.</span></span>
2. <span data-ttu-id="46cc0-400">In **Server Manager**, select **Tools**, and then click **Active Directory Administrative Center**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-400">In **Server Manager**, select **Tools**, and then click **Active Directory Administrative Center**.</span></span>   
3. <span data-ttu-id="46cc0-401">Select **corp (local)** from the left pane.</span><span class="sxs-lookup"><span data-stu-id="46cc0-401">Select **corp (local)** from the left pane.</span></span>
4. <span data-ttu-id="46cc0-402">On the right **Tasks** pane, select **New**, and then click **User**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-402">On the right **Tasks** pane, select **New**, and then click **User**.</span></span>
   <span data-ttu-id="46cc0-403">![Active Directory Administrative Center](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/29-addcnewuser.png)</span><span class="sxs-lookup"><span data-stu-id="46cc0-403">![Active Directory Administrative Center](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/29-addcnewuser.png)</span></span>

   >[!TIP]
   ><span data-ttu-id="46cc0-404">Set a complex password for each account.</span><span class="sxs-lookup"><span data-stu-id="46cc0-404">Set a complex password for each account.</span></span><br/> <span data-ttu-id="46cc0-405">For non-production environments, set the user account to never expire.</span><span class="sxs-lookup"><span data-stu-id="46cc0-405">For non-production environments, set the user account to never expire.</span></span>

5. <span data-ttu-id="46cc0-406">Click **OK** to create the user.</span><span class="sxs-lookup"><span data-stu-id="46cc0-406">Click **OK** to create the user.</span></span>
6. <span data-ttu-id="46cc0-407">Repeat the preceding steps for each of the three accounts.</span><span class="sxs-lookup"><span data-stu-id="46cc0-407">Repeat the preceding steps for each of the three accounts.</span></span>

### <a name="grant-the-required-permissions-to-the-installation-account"></a><span data-ttu-id="46cc0-408">Grant the required permissions to the installation account</span><span class="sxs-lookup"><span data-stu-id="46cc0-408">Grant the required permissions to the installation account</span></span>
1. <span data-ttu-id="46cc0-409">In the **Active Directory Administrative Center**, select **corp (local)** in the left pane.</span><span class="sxs-lookup"><span data-stu-id="46cc0-409">In the **Active Directory Administrative Center**, select **corp (local)** in the left pane.</span></span> <span data-ttu-id="46cc0-410">Then in the right-hand **Tasks** pane, click **Properties**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-410">Then in the right-hand **Tasks** pane, click **Properties**.</span></span>

    ![CORP user properties](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/31-addcproperties.png)
2. <span data-ttu-id="46cc0-412">Select **Extensions**, and then click the **Advanced** button on the **Security** tab.</span><span class="sxs-lookup"><span data-stu-id="46cc0-412">Select **Extensions**, and then click the **Advanced** button on the **Security** tab.</span></span>
3. <span data-ttu-id="46cc0-413">In the **Advanced Security Settings for corp** dialog, click **Add**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-413">In the **Advanced Security Settings for corp** dialog, click **Add**.</span></span>
4. <span data-ttu-id="46cc0-414">Click **Select a principal**, search for **CORP\Install**, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-414">Click **Select a principal**, search for **CORP\Install**, and then click **OK**.</span></span>
5. <span data-ttu-id="46cc0-415">Select the **Read all properties** check box.</span><span class="sxs-lookup"><span data-stu-id="46cc0-415">Select the **Read all properties** check box.</span></span>

6. <span data-ttu-id="46cc0-416">Select the **Create Computer objects** check box.</span><span class="sxs-lookup"><span data-stu-id="46cc0-416">Select the **Create Computer objects** check box.</span></span>

     ![Corp user permissions](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/33-addpermissions.png)
7. <span data-ttu-id="46cc0-418">Click **OK**, and then click **OK** again.</span><span class="sxs-lookup"><span data-stu-id="46cc0-418">Click **OK**, and then click **OK** again.</span></span> <span data-ttu-id="46cc0-419">Close the **corp** properties window.</span><span class="sxs-lookup"><span data-stu-id="46cc0-419">Close the **corp** properties window.</span></span>

<span data-ttu-id="46cc0-420">Now that you've finished configuring Active Directory and the user objects, create two SQL Server VMs and a witness server VM.</span><span class="sxs-lookup"><span data-stu-id="46cc0-420">Now that you've finished configuring Active Directory and the user objects, create two SQL Server VMs and a witness server VM.</span></span> <span data-ttu-id="46cc0-421">Then join all three to the domain.</span><span class="sxs-lookup"><span data-stu-id="46cc0-421">Then join all three to the domain.</span></span>

## <a name="create-sql-server-vms"></a><span data-ttu-id="46cc0-422">Create SQL Server VMs</span><span class="sxs-lookup"><span data-stu-id="46cc0-422">Create SQL Server VMs</span></span>
### <a name="create-and-configure-the-sql-server-vms"></a><span data-ttu-id="46cc0-423">Create and configure the SQL Server VMs</span><span class="sxs-lookup"><span data-stu-id="46cc0-423">Create and configure the SQL Server VMs</span></span>
<span data-ttu-id="46cc0-424">Next, create three VMs--two SQL Server VMs and a VM for an additional cluster node.</span><span class="sxs-lookup"><span data-stu-id="46cc0-424">Next, create three VMs--two SQL Server VMs and a VM for an additional cluster node.</span></span> <span data-ttu-id="46cc0-425">To create each of the VMs, go back to the **SQL-HA-RG** resource group, click **Add**, search for the appropriate gallery item, click **Virtual Machine**, and then click **From Gallery**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-425">To create each of the VMs, go back to the **SQL-HA-RG** resource group, click **Add**, search for the appropriate gallery item, click **Virtual Machine**, and then click **From Gallery**.</span></span> <span data-ttu-id="46cc0-426">Use the information in the following table to help you create the VMs:</span><span class="sxs-lookup"><span data-stu-id="46cc0-426">Use the information in the following table to help you create the VMs:</span></span>

| <span data-ttu-id="46cc0-427">Page</span><span class="sxs-lookup"><span data-stu-id="46cc0-427">Page</span></span> | <span data-ttu-id="46cc0-428">VM1</span><span class="sxs-lookup"><span data-stu-id="46cc0-428">VM1</span></span> | <span data-ttu-id="46cc0-429">VM2</span><span class="sxs-lookup"><span data-stu-id="46cc0-429">VM2</span></span> | <span data-ttu-id="46cc0-430">VM3</span><span class="sxs-lookup"><span data-stu-id="46cc0-430">VM3</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="46cc0-431">Select the appropriate gallery item</span><span class="sxs-lookup"><span data-stu-id="46cc0-431">Select the appropriate gallery item</span></span> |<span data-ttu-id="46cc0-432">**Windows Server 2016 Datacenter**</span><span class="sxs-lookup"><span data-stu-id="46cc0-432">**Windows Server 2016 Datacenter**</span></span> |<span data-ttu-id="46cc0-433">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span><span class="sxs-lookup"><span data-stu-id="46cc0-433">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span></span> |<span data-ttu-id="46cc0-434">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span><span class="sxs-lookup"><span data-stu-id="46cc0-434">**SQL Server 2016 SP1 Enterprise on Windows Server 2016**</span></span> |
| <span data-ttu-id="46cc0-435">Virtual machine configuration **Basics**</span><span class="sxs-lookup"><span data-stu-id="46cc0-435">Virtual machine configuration **Basics**</span></span> |<span data-ttu-id="46cc0-436">**Name** = cluster-fsw</span><span class="sxs-lookup"><span data-stu-id="46cc0-436">**Name** = cluster-fsw</span></span><br/><span data-ttu-id="46cc0-437">**User Name** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="46cc0-437">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="46cc0-438">**Password** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="46cc0-438">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="46cc0-439">**Subscription** = Your subscription</span><span class="sxs-lookup"><span data-stu-id="46cc0-439">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="46cc0-440">**Resource group** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="46cc0-440">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="46cc0-441">**Location** = Your azure location</span><span class="sxs-lookup"><span data-stu-id="46cc0-441">**Location** = Your azure location</span></span> |<span data-ttu-id="46cc0-442">**Name** = sqlserver-0</span><span class="sxs-lookup"><span data-stu-id="46cc0-442">**Name** = sqlserver-0</span></span><br/><span data-ttu-id="46cc0-443">**User Name** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="46cc0-443">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="46cc0-444">**Password** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="46cc0-444">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="46cc0-445">**Subscription** = Your subscription</span><span class="sxs-lookup"><span data-stu-id="46cc0-445">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="46cc0-446">**Resource group** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="46cc0-446">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="46cc0-447">**Location** = Your azure location</span><span class="sxs-lookup"><span data-stu-id="46cc0-447">**Location** = Your azure location</span></span> |<span data-ttu-id="46cc0-448">**Name** = sqlserver-1</span><span class="sxs-lookup"><span data-stu-id="46cc0-448">**Name** = sqlserver-1</span></span><br/><span data-ttu-id="46cc0-449">**User Name** = DomainAdmin</span><span class="sxs-lookup"><span data-stu-id="46cc0-449">**User Name** = DomainAdmin</span></span><br/><span data-ttu-id="46cc0-450">**Password** = Contoso!0000</span><span class="sxs-lookup"><span data-stu-id="46cc0-450">**Password** = Contoso!0000</span></span><br/><span data-ttu-id="46cc0-451">**Subscription** = Your subscription</span><span class="sxs-lookup"><span data-stu-id="46cc0-451">**Subscription** = Your subscription</span></span><br/><span data-ttu-id="46cc0-452">**Resource group** = SQL-HA-RG</span><span class="sxs-lookup"><span data-stu-id="46cc0-452">**Resource group** = SQL-HA-RG</span></span><br/><span data-ttu-id="46cc0-453">**Location** = Your azure location</span><span class="sxs-lookup"><span data-stu-id="46cc0-453">**Location** = Your azure location</span></span> |
| <span data-ttu-id="46cc0-454">Virtual machine configuration **Size**</span><span class="sxs-lookup"><span data-stu-id="46cc0-454">Virtual machine configuration **Size**</span></span> |<span data-ttu-id="46cc0-455">**SIZE** = DS1\_V2 (1 core, 3.5 GB)</span><span class="sxs-lookup"><span data-stu-id="46cc0-455">**SIZE** = DS1\_V2 (1 core, 3.5 GB)</span></span> |<span data-ttu-id="46cc0-456">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span><span class="sxs-lookup"><span data-stu-id="46cc0-456">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span></span> |<span data-ttu-id="46cc0-457">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span><span class="sxs-lookup"><span data-stu-id="46cc0-457">**SIZE** = DS2\_V2 (2 cores, 7 GB)</span></span> |
| <span data-ttu-id="46cc0-458">Virtual machine configuration **Settings**</span><span class="sxs-lookup"><span data-stu-id="46cc0-458">Virtual machine configuration **Settings**</span></span> |<span data-ttu-id="46cc0-459">**Storage** = Premium (SSD)</span><span class="sxs-lookup"><span data-stu-id="46cc0-459">**Storage** = Premium (SSD)</span></span><br/><span data-ttu-id="46cc0-460">**NETWORK SUBNETS** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="46cc0-460">**NETWORK SUBNETS** = autoHAVNET</span></span><br/><span data-ttu-id="46cc0-461">**STORAGE ACCOUNT** = Use an automatically generated storage account</span><span class="sxs-lookup"><span data-stu-id="46cc0-461">**STORAGE ACCOUNT** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="46cc0-462">**Subnet** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="46cc0-462">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="46cc0-463">**Public IP address** = None</span><span class="sxs-lookup"><span data-stu-id="46cc0-463">**Public IP address** = None</span></span><br/><span data-ttu-id="46cc0-464">**Network security group** = None</span><span class="sxs-lookup"><span data-stu-id="46cc0-464">**Network security group** = None</span></span><br/><span data-ttu-id="46cc0-465">**Monitoring Diagnostics** = Enabled</span><span class="sxs-lookup"><span data-stu-id="46cc0-465">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="46cc0-466">**Diagnostics storage account** = Use an automatically generated storage account</span><span class="sxs-lookup"><span data-stu-id="46cc0-466">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="46cc0-467">**AVAILABILITY SET** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="46cc0-467">**AVAILABILITY SET** = sqlAvailabilitySet</span></span><br/> |<span data-ttu-id="46cc0-468">**Storage** = Premium (SSD)</span><span class="sxs-lookup"><span data-stu-id="46cc0-468">**Storage** = Premium (SSD)</span></span><br/><span data-ttu-id="46cc0-469">**NETWORK SUBNETS** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="46cc0-469">**NETWORK SUBNETS** = autoHAVNET</span></span><br/><span data-ttu-id="46cc0-470">**STORAGE ACCOUNT** = Use an automatically generated storage account</span><span class="sxs-lookup"><span data-stu-id="46cc0-470">**STORAGE ACCOUNT** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="46cc0-471">**Subnet** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="46cc0-471">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="46cc0-472">**Public IP address** = None</span><span class="sxs-lookup"><span data-stu-id="46cc0-472">**Public IP address** = None</span></span><br/><span data-ttu-id="46cc0-473">**Network security group** = None</span><span class="sxs-lookup"><span data-stu-id="46cc0-473">**Network security group** = None</span></span><br/><span data-ttu-id="46cc0-474">**Monitoring Diagnostics** = Enabled</span><span class="sxs-lookup"><span data-stu-id="46cc0-474">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="46cc0-475">**Diagnostics storage account** = Use an automatically generated storage account</span><span class="sxs-lookup"><span data-stu-id="46cc0-475">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="46cc0-476">**AVAILABILITY SET** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="46cc0-476">**AVAILABILITY SET** = sqlAvailabilitySet</span></span><br/> |<span data-ttu-id="46cc0-477">**Storage** = Premium (SSD)</span><span class="sxs-lookup"><span data-stu-id="46cc0-477">**Storage** = Premium (SSD)</span></span><br/><span data-ttu-id="46cc0-478">**NETWORK SUBNETS** = autoHAVNET</span><span class="sxs-lookup"><span data-stu-id="46cc0-478">**NETWORK SUBNETS** = autoHAVNET</span></span><br/><span data-ttu-id="46cc0-479">**STORAGE ACCOUNT** = Use an automatically generated storage account</span><span class="sxs-lookup"><span data-stu-id="46cc0-479">**STORAGE ACCOUNT** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="46cc0-480">**Subnet** = sqlsubnet(10.1.1.0/24)</span><span class="sxs-lookup"><span data-stu-id="46cc0-480">**Subnet** = sqlsubnet(10.1.1.0/24)</span></span><br/><span data-ttu-id="46cc0-481">**Public IP address** = None</span><span class="sxs-lookup"><span data-stu-id="46cc0-481">**Public IP address** = None</span></span><br/><span data-ttu-id="46cc0-482">**Network security group** = None</span><span class="sxs-lookup"><span data-stu-id="46cc0-482">**Network security group** = None</span></span><br/><span data-ttu-id="46cc0-483">**Monitoring Diagnostics** = Enabled</span><span class="sxs-lookup"><span data-stu-id="46cc0-483">**Monitoring Diagnostics** = Enabled</span></span><br/><span data-ttu-id="46cc0-484">**Diagnostics storage account** = Use an automatically generated storage account</span><span class="sxs-lookup"><span data-stu-id="46cc0-484">**Diagnostics storage account** = Use an automatically generated storage account</span></span><br/><span data-ttu-id="46cc0-485">**AVAILABILITY SET** = sqlAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="46cc0-485">**AVAILABILITY SET** = sqlAvailabilitySet</span></span><br/> |
| <span data-ttu-id="46cc0-486">Virtual machine configuration **SQL Server settings**</span><span class="sxs-lookup"><span data-stu-id="46cc0-486">Virtual machine configuration **SQL Server settings**</span></span> |<span data-ttu-id="46cc0-487">Not applicable</span><span class="sxs-lookup"><span data-stu-id="46cc0-487">Not applicable</span></span> |<span data-ttu-id="46cc0-488">**SQL connectivity** = Private (within Virtual Network)</span><span class="sxs-lookup"><span data-stu-id="46cc0-488">**SQL connectivity** = Private (within Virtual Network)</span></span><br/><span data-ttu-id="46cc0-489">**Port** = 1433</span><span class="sxs-lookup"><span data-stu-id="46cc0-489">**Port** = 1433</span></span><br/><span data-ttu-id="46cc0-490">**SQL Authentication** = Disable</span><span class="sxs-lookup"><span data-stu-id="46cc0-490">**SQL Authentication** = Disable</span></span><br/><span data-ttu-id="46cc0-491">**Storage configuration** = General</span><span class="sxs-lookup"><span data-stu-id="46cc0-491">**Storage configuration** = General</span></span><br/><span data-ttu-id="46cc0-492">**Automated patching** = Sunday at 2:00</span><span class="sxs-lookup"><span data-stu-id="46cc0-492">**Automated patching** = Sunday at 2:00</span></span><br/><span data-ttu-id="46cc0-493">**Automated backup** = Disabled</span><span class="sxs-lookup"><span data-stu-id="46cc0-493">**Automated backup** = Disabled</span></span></br><span data-ttu-id="46cc0-494">**Azure Key Vault integration** = Disabled</span><span class="sxs-lookup"><span data-stu-id="46cc0-494">**Azure Key Vault integration** = Disabled</span></span> |<span data-ttu-id="46cc0-495">**SQL connectivity** = Private (within Virtual Network)</span><span class="sxs-lookup"><span data-stu-id="46cc0-495">**SQL connectivity** = Private (within Virtual Network)</span></span><br/><span data-ttu-id="46cc0-496">**Port** = 1433</span><span class="sxs-lookup"><span data-stu-id="46cc0-496">**Port** = 1433</span></span><br/><span data-ttu-id="46cc0-497">**SQL Authentication** = Disable</span><span class="sxs-lookup"><span data-stu-id="46cc0-497">**SQL Authentication** = Disable</span></span><br/><span data-ttu-id="46cc0-498">**Storage configuration** = General</span><span class="sxs-lookup"><span data-stu-id="46cc0-498">**Storage configuration** = General</span></span><br/><span data-ttu-id="46cc0-499">**Automated patching** = Sunday at 2:00</span><span class="sxs-lookup"><span data-stu-id="46cc0-499">**Automated patching** = Sunday at 2:00</span></span><br/><span data-ttu-id="46cc0-500">**Automated backup** = Disabled</span><span class="sxs-lookup"><span data-stu-id="46cc0-500">**Automated backup** = Disabled</span></span></br><span data-ttu-id="46cc0-501">**Azure Key Vault integration** = Disabled</span><span class="sxs-lookup"><span data-stu-id="46cc0-501">**Azure Key Vault integration** = Disabled</span></span> |

<br/>

> [!NOTE]
> <span data-ttu-id="46cc0-502">The machine sizes suggested here are meant for testing availability groups in Azure VMs.</span><span class="sxs-lookup"><span data-stu-id="46cc0-502">The machine sizes suggested here are meant for testing availability groups in Azure VMs.</span></span> <span data-ttu-id="46cc0-503">For the best performance on production workloads, see the recommendations for SQL Server machine sizes and configuration in [Performance best practices for SQL Server in Azure virtual machines](virtual-machines-windows-sql-performance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="46cc0-503">For the best performance on production workloads, see the recommendations for SQL Server machine sizes and configuration in [Performance best practices for SQL Server in Azure virtual machines](virtual-machines-windows-sql-performance.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>
>
>

<span data-ttu-id="46cc0-504">After the three VMs are fully provisioned, you need to join them to the **corp.contoso.com** domain and grant CORP\Install administrative rights to the machines.</span><span class="sxs-lookup"><span data-stu-id="46cc0-504">After the three VMs are fully provisioned, you need to join them to the **corp.contoso.com** domain and grant CORP\Install administrative rights to the machines.</span></span>

### <a name="set-dns-on-each-server"></a><span data-ttu-id="46cc0-505">Set DNS on each server</span><span class="sxs-lookup"><span data-stu-id="46cc0-505">Set DNS on each server</span></span>
<span data-ttu-id="46cc0-506">First, change the preferred DNS server address for each member server.</span><span class="sxs-lookup"><span data-stu-id="46cc0-506">First, change the preferred DNS server address for each member server.</span></span> <span data-ttu-id="46cc0-507">Follow these steps:</span><span class="sxs-lookup"><span data-stu-id="46cc0-507">Follow these steps:</span></span>

1. <span data-ttu-id="46cc0-508">In the portal, open the **SQL-HA-RG** resource group and select the **sqlserver-0** machine.</span><span class="sxs-lookup"><span data-stu-id="46cc0-508">In the portal, open the **SQL-HA-RG** resource group and select the **sqlserver-0** machine.</span></span> <span data-ttu-id="46cc0-509">On the **sqlserver-0** blade, click **Connect** to open an RDP file for remote desktop access.</span><span class="sxs-lookup"><span data-stu-id="46cc0-509">On the **sqlserver-0** blade, click **Connect** to open an RDP file for remote desktop access.</span></span>
2. <span data-ttu-id="46cc0-510">Sign in with your configured administrator account (**\DomainAdmin**) and password (**Contoso!0000**).</span><span class="sxs-lookup"><span data-stu-id="46cc0-510">Sign in with your configured administrator account (**\DomainAdmin**) and password (**Contoso!0000**).</span></span>
3. <span data-ttu-id="46cc0-511">By default, the **Server Manager** dashboard should be displayed.</span><span class="sxs-lookup"><span data-stu-id="46cc0-511">By default, the **Server Manager** dashboard should be displayed.</span></span> <span data-ttu-id="46cc0-512">Click **Local Server** in the left pane.</span><span class="sxs-lookup"><span data-stu-id="46cc0-512">Click **Local Server** in the left pane.</span></span>
4. <span data-ttu-id="46cc0-513">Select the **IPv4 address assigned by DHCP, IPv6 enabled** link.</span><span class="sxs-lookup"><span data-stu-id="46cc0-513">Select the **IPv4 address assigned by DHCP, IPv6 enabled** link.</span></span>
5. <span data-ttu-id="46cc0-514">In the **Network Connections** window, select the network icon.</span><span class="sxs-lookup"><span data-stu-id="46cc0-514">In the **Network Connections** window, select the network icon.</span></span>
6. <span data-ttu-id="46cc0-515">On the command bar, click **Change the settings of this connection**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-515">On the command bar, click **Change the settings of this connection**.</span></span> <span data-ttu-id="46cc0-516">If you don't see this option, click the double-right arrow.</span><span class="sxs-lookup"><span data-stu-id="46cc0-516">If you don't see this option, click the double-right arrow.</span></span>
7. <span data-ttu-id="46cc0-517">Select **Internet Protocol Version 4 (TCP/IPv4)** and click **Properties**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-517">Select **Internet Protocol Version 4 (TCP/IPv4)** and click **Properties**.</span></span>
8. <span data-ttu-id="46cc0-518">Select **Use the following DNS server addresses**, and then specify the address of the primary domain controller in **Preferred DNS server**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-518">Select **Use the following DNS server addresses**, and then specify the address of the primary domain controller in **Preferred DNS server**.</span></span>

   >[!TIP]
   ><span data-ttu-id="46cc0-519">To get the IP address of the server, use `nslookup`.</span><span class="sxs-lookup"><span data-stu-id="46cc0-519">To get the IP address of the server, use `nslookup`.</span></span><br/>
   ><span data-ttu-id="46cc0-520">From the command prompt, type `nslookup ad-primary-dc`.</span><span class="sxs-lookup"><span data-stu-id="46cc0-520">From the command prompt, type `nslookup ad-primary-dc`.</span></span>

9. <span data-ttu-id="46cc0-521">Click **OK**, and then click **Close** to commit the changes.</span><span class="sxs-lookup"><span data-stu-id="46cc0-521">Click **OK**, and then click **Close** to commit the changes.</span></span>

   >[!IMPORTANT]
   ><span data-ttu-id="46cc0-522">If you lose the connection to your remote desktop after changing the DNS setting, go to the Azure portal and restart the virtual machine.</span><span class="sxs-lookup"><span data-stu-id="46cc0-522">If you lose the connection to your remote desktop after changing the DNS setting, go to the Azure portal and restart the virtual machine.</span></span>

<span data-ttu-id="46cc0-523">Repeat these steps for all the servers.</span><span class="sxs-lookup"><span data-stu-id="46cc0-523">Repeat these steps for all the servers.</span></span>

### <a name="joinDomain"></a><span data-ttu-id="46cc0-524">Join the servers to the domain</span><span class="sxs-lookup"><span data-stu-id="46cc0-524">Join the servers to the domain</span></span>

<span data-ttu-id="46cc0-525">You're now able to join the VMs to **corp.contoso.com**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-525">You're now able to join the VMs to **corp.contoso.com**.</span></span> <span data-ttu-id="46cc0-526">Do the following for both the SQL Server VMs and the file share witness server:</span><span class="sxs-lookup"><span data-stu-id="46cc0-526">Do the following for both the SQL Server VMs and the file share witness server:</span></span>

1. <span data-ttu-id="46cc0-527">Remotely connect to the virtual machine with **BUILTIN\DomainAdmin**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-527">Remotely connect to the virtual machine with **BUILTIN\DomainAdmin**.</span></span>
2. <span data-ttu-id="46cc0-528">In **Server Manager**, click **Local Server**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-528">In **Server Manager**, click **Local Server**.</span></span>
3. <span data-ttu-id="46cc0-529">Click the **WORKGROUP** link.</span><span class="sxs-lookup"><span data-stu-id="46cc0-529">Click the **WORKGROUP** link.</span></span>
4. <span data-ttu-id="46cc0-530">In the **Computer Name** section, click **Change**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-530">In the **Computer Name** section, click **Change**.</span></span>
5. <span data-ttu-id="46cc0-531">Select the **Domain** check box and type **corp.contoso.com** in the text box.</span><span class="sxs-lookup"><span data-stu-id="46cc0-531">Select the **Domain** check box and type **corp.contoso.com** in the text box.</span></span> <span data-ttu-id="46cc0-532">Click **OK**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-532">Click **OK**.</span></span>
6. <span data-ttu-id="46cc0-533">In the **Windows Security** popup dialog, specify the credentials for the default domain administrator account (**CORP\DomainAdmin**) and the password (**Contoso!0000**).</span><span class="sxs-lookup"><span data-stu-id="46cc0-533">In the **Windows Security** popup dialog, specify the credentials for the default domain administrator account (**CORP\DomainAdmin**) and the password (**Contoso!0000**).</span></span>
7. <span data-ttu-id="46cc0-534">When you see the "Welcome to the corp.contoso.com domain" message, click **OK**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-534">When you see the "Welcome to the corp.contoso.com domain" message, click **OK**.</span></span>
8. <span data-ttu-id="46cc0-535">Click **Close**, and then click **Restart Now** in the popup dialog.</span><span class="sxs-lookup"><span data-stu-id="46cc0-535">Click **Close**, and then click **Restart Now** in the popup dialog.</span></span>

### <a name="add-the-corpinstall-user-as-an-administrator-on-each-cluster-vm"></a><span data-ttu-id="46cc0-536">Add the Corp\Install user as an administrator on each cluster VM</span><span class="sxs-lookup"><span data-stu-id="46cc0-536">Add the Corp\Install user as an administrator on each cluster VM</span></span>

<span data-ttu-id="46cc0-537">After each virtual machine restarts as a member of the domain, add **CORP\Install** as a member of the local administrators group.</span><span class="sxs-lookup"><span data-stu-id="46cc0-537">After each virtual machine restarts as a member of the domain, add **CORP\Install** as a member of the local administrators group.</span></span>

1. <span data-ttu-id="46cc0-538">Wait until the VM is restarted, then launch the RDP file again from the primary domain controller to sign in to **sqlserver-0** by using the **CORP\DomainAdmin** account.</span><span class="sxs-lookup"><span data-stu-id="46cc0-538">Wait until the VM is restarted, then launch the RDP file again from the primary domain controller to sign in to **sqlserver-0** by using the **CORP\DomainAdmin** account.</span></span>
   >[!TIP]
   ><span data-ttu-id="46cc0-539">Make sure that you sign in with the domain administrator account.</span><span class="sxs-lookup"><span data-stu-id="46cc0-539">Make sure that you sign in with the domain administrator account.</span></span> <span data-ttu-id="46cc0-540">In the previous steps, you were using the BUILT IN administrator account.</span><span class="sxs-lookup"><span data-stu-id="46cc0-540">In the previous steps, you were using the BUILT IN administrator account.</span></span> <span data-ttu-id="46cc0-541">Now that the server is in the domain, use the domain account.</span><span class="sxs-lookup"><span data-stu-id="46cc0-541">Now that the server is in the domain, use the domain account.</span></span> <span data-ttu-id="46cc0-542">In your RDP session, specify *DOMAIN*\\*username*.</span><span class="sxs-lookup"><span data-stu-id="46cc0-542">In your RDP session, specify *DOMAIN*\\*username*.</span></span>

2. <span data-ttu-id="46cc0-543">In **Server Manager**, select **Tools**, and then click **Computer Management**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-543">In **Server Manager**, select **Tools**, and then click **Computer Management**.</span></span>
3. <span data-ttu-id="46cc0-544">In the **Computer Management** window, expand **Local Users and Groups**, and then select **Groups**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-544">In the **Computer Management** window, expand **Local Users and Groups**, and then select **Groups**.</span></span>
4. <span data-ttu-id="46cc0-545">Double-click the **Administrators** group.</span><span class="sxs-lookup"><span data-stu-id="46cc0-545">Double-click the **Administrators** group.</span></span>
5. <span data-ttu-id="46cc0-546">In the **Administrators Properties** dialog, click the **Add** button.</span><span class="sxs-lookup"><span data-stu-id="46cc0-546">In the **Administrators Properties** dialog, click the **Add** button.</span></span>
6. <span data-ttu-id="46cc0-547">Enter the user **CORP\Install**, and then click **OK**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-547">Enter the user **CORP\Install**, and then click **OK**.</span></span>
7. <span data-ttu-id="46cc0-548">Click **OK** to close the **Administrator Properties** dialog.</span><span class="sxs-lookup"><span data-stu-id="46cc0-548">Click **OK** to close the **Administrator Properties** dialog.</span></span>
8. <span data-ttu-id="46cc0-549">Repeat the previous steps on **sqlserver-1** and **cluster-fsw**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-549">Repeat the previous steps on **sqlserver-1** and **cluster-fsw**.</span></span>

### <a name="setServiceAccount"></a><span data-ttu-id="46cc0-550">Set the SQL Server service accounts</span><span class="sxs-lookup"><span data-stu-id="46cc0-550">Set the SQL Server service accounts</span></span>

<span data-ttu-id="46cc0-551">On each SQL Server VM, set the SQL Server service account.</span><span class="sxs-lookup"><span data-stu-id="46cc0-551">On each SQL Server VM, set the SQL Server service account.</span></span> <span data-ttu-id="46cc0-552">Use the accounts that you created when you [configured the domain accounts](#DomainAccounts).</span><span class="sxs-lookup"><span data-stu-id="46cc0-552">Use the accounts that you created when you [configured the domain accounts](#DomainAccounts).</span></span>

1. <span data-ttu-id="46cc0-553">Open **SQL Server Configuration Manager**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-553">Open **SQL Server Configuration Manager**.</span></span>
2. <span data-ttu-id="46cc0-554">Right-click the SQL Server service, and then click **Properties**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-554">Right-click the SQL Server service, and then click **Properties**.</span></span>
3. <span data-ttu-id="46cc0-555">Set the account and password.</span><span class="sxs-lookup"><span data-stu-id="46cc0-555">Set the account and password.</span></span>
4. <span data-ttu-id="46cc0-556">Repeat these steps on the other SQL Server VM.</span><span class="sxs-lookup"><span data-stu-id="46cc0-556">Repeat these steps on the other SQL Server VM.</span></span>  

<span data-ttu-id="46cc0-557">For SQL Server availability groups, each SQL Server VM needs to run as a domain account.</span><span class="sxs-lookup"><span data-stu-id="46cc0-557">For SQL Server availability groups, each SQL Server VM needs to run as a domain account.</span></span>

### <a name="create-a-sign-in-on-each-sql-server-vm-for-the-installation-account"></a><span data-ttu-id="46cc0-558">Create a sign-in on each SQL Server VM for the installation account</span><span class="sxs-lookup"><span data-stu-id="46cc0-558">Create a sign-in on each SQL Server VM for the installation account</span></span>

<span data-ttu-id="46cc0-559">Use the installation account to configure the availability group.</span><span class="sxs-lookup"><span data-stu-id="46cc0-559">Use the installation account to configure the availability group.</span></span> <span data-ttu-id="46cc0-560">This account needs to be a member of the **sysadmin** fixed server role on each SQL Server VM.</span><span class="sxs-lookup"><span data-stu-id="46cc0-560">This account needs to be a member of the **sysadmin** fixed server role on each SQL Server VM.</span></span> <span data-ttu-id="46cc0-561">The following steps create a sign-in for the installation account:</span><span class="sxs-lookup"><span data-stu-id="46cc0-561">The following steps create a sign-in for the installation account:</span></span>

1. <span data-ttu-id="46cc0-562">Connect to the server through the Remote Desktop Protocol (RDP) by using the *\<MachineName\>\DomainAdmin* account.</span><span class="sxs-lookup"><span data-stu-id="46cc0-562">Connect to the server through the Remote Desktop Protocol (RDP) by using the *\<MachineName\>\DomainAdmin* account.</span></span>

1. <span data-ttu-id="46cc0-563">Open SQL Server Management Studio and connect to the local instance of SQL Server.</span><span class="sxs-lookup"><span data-stu-id="46cc0-563">Open SQL Server Management Studio and connect to the local instance of SQL Server.</span></span>

1. <span data-ttu-id="46cc0-564">In **Object Explorer**, click **Security**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-564">In **Object Explorer**, click **Security**.</span></span>

1. <span data-ttu-id="46cc0-565">Right-click **Logins**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-565">Right-click **Logins**.</span></span> <span data-ttu-id="46cc0-566">Click **New Login**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-566">Click **New Login**.</span></span>

1. <span data-ttu-id="46cc0-567">In **Login - New**, click **Search**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-567">In **Login - New**, click **Search**.</span></span>

1. <span data-ttu-id="46cc0-568">Click **Locations**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-568">Click **Locations**.</span></span>

1. <span data-ttu-id="46cc0-569">Enter the domain administrator network credentials.</span><span class="sxs-lookup"><span data-stu-id="46cc0-569">Enter the domain administrator network credentials.</span></span>

1. <span data-ttu-id="46cc0-570">Use the installation account.</span><span class="sxs-lookup"><span data-stu-id="46cc0-570">Use the installation account.</span></span>

1. <span data-ttu-id="46cc0-571">Set the sign-in to be a member of the **sysadmin** fixed server role.</span><span class="sxs-lookup"><span data-stu-id="46cc0-571">Set the sign-in to be a member of the **sysadmin** fixed server role.</span></span>

1. <span data-ttu-id="46cc0-572">Click **OK**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-572">Click **OK**.</span></span>

<span data-ttu-id="46cc0-573">Repeat the preceding steps on the other SQL Server VM.</span><span class="sxs-lookup"><span data-stu-id="46cc0-573">Repeat the preceding steps on the other SQL Server VM.</span></span>

## <a name="add-failover-clustering-features-to-both-sql-server-vms"></a><span data-ttu-id="46cc0-574">Add Failover Clustering features to both SQL Server VMs</span><span class="sxs-lookup"><span data-stu-id="46cc0-574">Add Failover Clustering features to both SQL Server VMs</span></span>

<span data-ttu-id="46cc0-575">To add Failover Clustering features, do the following on both SQL Server VMs:</span><span class="sxs-lookup"><span data-stu-id="46cc0-575">To add Failover Clustering features, do the following on both SQL Server VMs:</span></span>

1. <span data-ttu-id="46cc0-576">From the remote desktop to the secondary domain controller, open **Server Manager Dashboard**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-576">From the remote desktop to the secondary domain controller, open **Server Manager Dashboard**.</span></span>
2. <span data-ttu-id="46cc0-577">Click the **Add roles and features** link on the dashboard.</span><span class="sxs-lookup"><span data-stu-id="46cc0-577">Click the **Add roles and features** link on the dashboard.</span></span>

    ![Server Manager - Add roles](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/22-addfeatures.png)
3. <span data-ttu-id="46cc0-579">Select **Next** until you get to the **Server Features** section.</span><span class="sxs-lookup"><span data-stu-id="46cc0-579">Select **Next** until you get to the **Server Features** section.</span></span>
4. <span data-ttu-id="46cc0-580">In **Features**, select **Failover Clustering**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-580">In **Features**, select **Failover Clustering**.</span></span>
5. <span data-ttu-id="46cc0-581">Add any additional required features.</span><span class="sxs-lookup"><span data-stu-id="46cc0-581">Add any additional required features.</span></span>
6. <span data-ttu-id="46cc0-582">Click **Install** to add the features.</span><span class="sxs-lookup"><span data-stu-id="46cc0-582">Click **Install** to add the features.</span></span>

<span data-ttu-id="46cc0-583">Repeat the steps on the other SQL Server VM.</span><span class="sxs-lookup"><span data-stu-id="46cc0-583">Repeat the steps on the other SQL Server VM.</span></span>

## <a name="a-nameendpoint-firewall-configure-the-firewall-on-each-sql-server-vm"></a><span data-ttu-id="46cc0-584"><a name="endpoint-firewall"> Configure the firewall on each SQL Server VM</span><span class="sxs-lookup"><span data-stu-id="46cc0-584"><a name="endpoint-firewall"> Configure the firewall on each SQL Server VM</span></span>

<span data-ttu-id="46cc0-585">The solution requires the following TCP ports to be open in the firewall:</span><span class="sxs-lookup"><span data-stu-id="46cc0-585">The solution requires the following TCP ports to be open in the firewall:</span></span>

- <span data-ttu-id="46cc0-586">**SQL Server VM**:</span><span class="sxs-lookup"><span data-stu-id="46cc0-586">**SQL Server VM**:</span></span><br/>
   <span data-ttu-id="46cc0-587">Port 1433 for a default instance of SQL Server.</span><span class="sxs-lookup"><span data-stu-id="46cc0-587">Port 1433 for a default instance of SQL Server.</span></span>
- <span data-ttu-id="46cc0-588">**Azure load balancer probe:**</span><span class="sxs-lookup"><span data-stu-id="46cc0-588">**Azure load balancer probe:**</span></span><br/>
   <span data-ttu-id="46cc0-589">Any available port.</span><span class="sxs-lookup"><span data-stu-id="46cc0-589">Any available port.</span></span> <span data-ttu-id="46cc0-590">Examples frequently use 59999.</span><span class="sxs-lookup"><span data-stu-id="46cc0-590">Examples frequently use 59999.</span></span>
- <span data-ttu-id="46cc0-591">**Database mirroring endpoint:**</span><span class="sxs-lookup"><span data-stu-id="46cc0-591">**Database mirroring endpoint:**</span></span> <br/>
   <span data-ttu-id="46cc0-592">Any available port.</span><span class="sxs-lookup"><span data-stu-id="46cc0-592">Any available port.</span></span> <span data-ttu-id="46cc0-593">Examples frequently use 5022.</span><span class="sxs-lookup"><span data-stu-id="46cc0-593">Examples frequently use 5022.</span></span>

<span data-ttu-id="46cc0-594">The firewall ports need to be open on both SQL Server VMs.</span><span class="sxs-lookup"><span data-stu-id="46cc0-594">The firewall ports need to be open on both SQL Server VMs.</span></span>

<span data-ttu-id="46cc0-595">The method of opening the ports depends on the firewall solution that you use.</span><span class="sxs-lookup"><span data-stu-id="46cc0-595">The method of opening the ports depends on the firewall solution that you use.</span></span> <span data-ttu-id="46cc0-596">The next section explains how to open the ports in Windows Firewall.</span><span class="sxs-lookup"><span data-stu-id="46cc0-596">The next section explains how to open the ports in Windows Firewall.</span></span> <span data-ttu-id="46cc0-597">Open the required ports on each of your SQL Server VMs.</span><span class="sxs-lookup"><span data-stu-id="46cc0-597">Open the required ports on each of your SQL Server VMs.</span></span>

### <a name="open-a-tcp-port-in-the-firewall"></a><span data-ttu-id="46cc0-598">Open a TCP port in the firewall</span><span class="sxs-lookup"><span data-stu-id="46cc0-598">Open a TCP port in the firewall</span></span>

1. <span data-ttu-id="46cc0-599">On the first SQL Server **Start** screen, launch **Windows Firewall with Advanced Security**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-599">On the first SQL Server **Start** screen, launch **Windows Firewall with Advanced Security**.</span></span>
2. <span data-ttu-id="46cc0-600">On the left pane, select **Inbound Rules**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-600">On the left pane, select **Inbound Rules**.</span></span> <span data-ttu-id="46cc0-601">On the right pane, click **New Rule**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-601">On the right pane, click **New Rule**.</span></span>
3. <span data-ttu-id="46cc0-602">For **Rule Type**, choose **Port**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-602">For **Rule Type**, choose **Port**.</span></span>
4. <span data-ttu-id="46cc0-603">For the port, specify **TCP** and type the appropriate port numbers.</span><span class="sxs-lookup"><span data-stu-id="46cc0-603">For the port, specify **TCP** and type the appropriate port numbers.</span></span> <span data-ttu-id="46cc0-604">See the following example:</span><span class="sxs-lookup"><span data-stu-id="46cc0-604">See the following example:</span></span>

   ![SQL firewall](https://docstestmedia1.blob.core.windows.net/azure-media/articles/virtual-machines/windows/sql/media/virtual-machines-windows-portal-sql-availability-group-tutorial/35-tcpports.png)

5. <span data-ttu-id="46cc0-606">Click **Next**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-606">Click **Next**.</span></span>
6. <span data-ttu-id="46cc0-607">On the **Action** page, keep **Allow the connection** selected, and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-607">On the **Action** page, keep **Allow the connection** selected, and then click **Next**.</span></span>
7. <span data-ttu-id="46cc0-608">On the **Profile** page, accept the default settings, and then click **Next**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-608">On the **Profile** page, accept the default settings, and then click **Next**.</span></span>
8. <span data-ttu-id="46cc0-609">On the **Name** page, specify a rule name (such as **Azure LB Probe**) in the **Name** text box, and then click **Finish**.</span><span class="sxs-lookup"><span data-stu-id="46cc0-609">On the **Name** page, specify a rule name (such as **Azure LB Probe**) in the **Name** text box, and then click **Finish**.</span></span>

<span data-ttu-id="46cc0-610">Repeat these steps on the second SQL Server VM.</span><span class="sxs-lookup"><span data-stu-id="46cc0-610">Repeat these steps on the second SQL Server VM.</span></span>

## <a name="next-steps"></a><span data-ttu-id="46cc0-611">Next steps</span><span class="sxs-lookup"><span data-stu-id="46cc0-611">Next steps</span></span>

* [<span data-ttu-id="46cc0-612">Create a SQL Server Always On availability group on Azure virtual machines</span><span class="sxs-lookup"><span data-stu-id="46cc0-612">Create a SQL Server Always On availability group on Azure virtual machines</span></span>](virtual-machines-windows-portal-sql-availability-group-tutorial.md)






















